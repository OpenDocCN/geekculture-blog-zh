<html>
<head>
<title>Scraping a Dynamic Website, Selenium Part-II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">刮一个动态网站，硒第二部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/scraping-a-dynamic-website-selenium-part-ii-1f30a4b59285?source=collection_archive---------23-----------------------#2021-03-08">https://medium.com/geekculture/scraping-a-dynamic-website-selenium-part-ii-1f30a4b59285?source=collection_archive---------23-----------------------#2021-03-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e947" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在第一部中，我用一种不同的方法为餐馆的菜单搜集了doordash.com。这是我的第二种方法。</p><blockquote class="je"><p id="a46e" class="jf jg hi bd jh ji jj jk jl jm jn jc dx translated"><strong class="ak">第一次进场总结</strong></p></blockquote><p id="69de" class="pw-post-body-paragraph if ig hi ih b ii jo ik il im jp io ip iq jq is it iu jr iw ix iy js ja jb jc hb bi translated">抓取器导航到URL(doordash.com)，点击一个食品项目(这打开了纽约食品商店的页面)，点击每个商店，抓取菜单，返回商店的页面，重复这个循环，直到它抓取了10，000-10，050个菜单。如果需要，可以点击下一页按钮。</p><blockquote class="jt ju jv"><p id="192a" class="if ig jw ih b ii ij ik il im in io ip jx ir is it jy iv iw ix jz iz ja jb jc hb bi translated"><strong class="ih hj">第二部</strong></p></blockquote><h1 id="6b24" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">第二种方法(这一种)</h1><p id="6e11" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">这一次，我希望能够在终端中输入一个带有脚本名称的手动搜索字符串。为此，我不想打开脚本进行编辑。当它到达目标时，它给出完成的消息，将数据保存为CSV，并停止脚本。</p><p id="f046" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是我的解决方案:</p><p id="cb2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1-导入特定的库/模块</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="93e0" class="lm kb hi li b fi ln lo l lp lq"># importing required libraries<br/>import ctypes<br/>import time<br/>from typing import List<br/>import pandas as pd<br/>from bs4 import BeautifulSoup<br/>from selenium.webdriver import Chrome , ActionChains<br/>from selenium.webdriver.common.keys import Keys<br/>from selenium.webdriver.remote.webelement import WebElement<br/>from selenium.webdriver.support.wait import WebDriverWait<br/>from selenium.webdriver.chrome.options import Options<br/>from selenium_move_cursor.MouseActions import move_to_element_chromeimport sys</span></pre><p id="615a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2-在无头浏览器中打开URL</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="d9ac" class="lm kb hi li b fi ln lo l lp lq"># The URL</span><span id="0bd6" class="lm kb hi li b fi lr lo l lp lq">url = <strong class="li hj">'https://www.doordash.com/en-US'</strong></span><span id="bdf5" class="lm kb hi li b fi lr lo l lp lq"># defining driver and adding the “ — headless” argument<br/>opts = Options()<br/>opts.add_argument(<strong class="li hj">'— headless'</strong>)<br/>driver = Chrome(<strong class="li hj">'chromedriver'</strong>)<br/># open the URL<br/>driver.maximize_window()<br/>driver.get(url)<br/>driver.implicitly_wait(220)</span><span id="1da6" class="lm kb hi li b fi lr lo l lp lq">time.sleep(5)</span></pre><p id="5563" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3-聚焦当前窗口</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="846b" class="lm kb hi li b fi ln lo l lp lq"># to focus the current window<br/>driver.switch_to.window(driver.window_handles[0])</span><span id="3164" class="lm kb hi li b fi lr lo l lp lq">time.sleep(10)</span></pre><p id="5d1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4-下面的代码为食品店的位置设置默认的搜索字符串</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="9354" class="lm kb hi li b fi ln lo l lp lq"># to focus the current window<br/>driver.switch_to.window(driver.window_handles[0])</span><span id="a454" class="lm kb hi li b fi lr lo l lp lq">time.sleep(10)</span></pre><p id="0359" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5-下面的代码允许我们搜索手动位置的食品店。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="4f5a" class="lm kb hi li b fi ln lo l lp lq"># (Manual Search String, sys.argv will interact with the terminal, 2nd argument will is<br/># the search string of location<br/>if len(sys.argv) &gt;= 2:<br/>    search_query = sys.argv[1]<br/>    print(search_query)</span></pre><p id="b1cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在终端中，我们将在python脚本的名称之后写入这个位置名称(例如，纽约、华盛顿)。</p><figure class="ld le lf lg fd lt er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es ls"><img src="../Images/162163c419322eb40a441d6922c491d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u3PY0liITOQznbIhCWNByw.jpeg"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx">open the script with terminal</figcaption></figure><p id="fad2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6-在搜索输入中输入位置名称</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="0f24" class="lm kb hi li b fi ln lo l lp lq"># send location to search element<br/>driver.find_element_by_css_selector(<strong class="li hj">"input[class='sc-eZXMBi ghseVd']"</strong>).send_keys(search_query)<br/>time.sleep(3)<br/># click on search button<br/>driver.find_element_by_css_selector(<strong class="li hj">"button[class='sc-Ehqfj dtSIZX']"</strong>).click()<br/>driver.implicitly_wait(120)</span></pre><p id="eb93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7-定义存储名称和价格的列表</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="63e2" class="lm kb hi li b fi ln lo l lp lq"># lists<br/>names = []<br/>prices = []</span></pre><p id="45b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8-获取页面上商店的数量。这次只有一个包含所有商店的页面。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="5956" class="lm kb hi li b fi ln lo l lp lq">time.sleep(5)<br/>stores=driver.find_element_by_xpath (<strong class="li hj">"//div[@class='sc-kRCAcj exCpGm']</strong>\<br/><strong class="li hj">        //div[@class='sc-zDqdV iEhWpB']//span[@class='sc-bdVaJa hQDtnE']"</strong>)<br/>number=stores.text</span></pre><p id="a8f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正文中给出了商店的数量。所以，我们将从文本中提取数字。</p><figure class="ld le lf lg fd lt er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es me"><img src="../Images/1516ab01de595591c0b7ba7cf58a9af3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7dbC5Hc9UBuaLBKaVdtpwg.jpeg"/></div></div></figure><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="a6aa" class="lm kb hi li b fi ln lo l lp lq">strNo=[int (s) for s in number.split () if s.isdigit ()]<br/>for i in strNo :<br/>    i=i<br/>print(i)</span></pre><p id="bd86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，循环开始了。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="9348" class="lm kb hi li b fi ln lo l lp lq">x: int<br/>for x in range (0 , i , 1) :</span></pre><p id="032b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，“I”是从字符串中提取的商店的数量。</p><p id="277a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9-在页面上搜索商店(其余代码在上面的“for循环”下运行)</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="ec53" class="lm kb hi li b fi ln lo l lp lq">div2=driver.find_element_by_xpath (<strong class="li hj">"//div[@class='sc-jFpLkX lmxKtV'][1]"</strong>)<br/>element: List[WebElement] = div2.find_elements_by_xpath(<strong class="li hj">f"//div[@class='sc-EHOje eOpoWF']</strong>\<br/><strong class="li hj">                            //span[@class = 'sc-bdVaJa bTYYIJ']|//div[@class='sc-EHOje eOpoWF']</strong>\<br/><strong class="li hj">                            //span[@class = 'sc-bdVaJa lncAvd']"</strong>)</span></pre><p id="654a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">10-在“for循环”的每次迭代中，逐一点击每个商店，然后点击打开它</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="f457" class="lm kb hi li b fi ln lo l lp lq">time.sleep (10)<br/>WebDriverWait(driver, 60)<br/>strnm: WebElement=element[x]<br/>pos=strnm.location<br/>y=pos.get (<strong class="li hj">'y'</strong>)-70<br/>driver.execute_script (<strong class="li hj">f"window.scrollTo(0, </strong>{y}<strong class="li hj">)"</strong>)<br/>print (<strong class="li hj">f'</strong>{x}<strong class="li hj">- ' </strong>, strnm.text)<br/>time.sleep (4)<br/>move_to_element_chrome (driver , strnm , display_scaling=100)<br/>actions=ActionChains (driver)<br/>actions.send_keys_to_element (strnm , Keys.ENTER).perform()<br/>time.sleep (7)<br/>driver.implicitly_wait (360)<br/>time.sleep (10)</span></pre><p id="ce59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">11-点击每个商店后，在BeautifulSoup中设置页面源，并抓取菜单</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="5d10" class="lm kb hi li b fi ln lo l lp lq">result=driver.page_source<br/>time.sleep (11)<br/>soup=BeautifulSoup (result , <strong class="li hj">'html.parser'</strong>)<br/>div=soup.find (<strong class="li hj">'div' </strong>, class_=<strong class="li hj">'sc-eAyhxF cMeCVt'</strong>)<br/>if div is not None :<br/>    time.sleep (25)<br/>    for i in div.findAll (<strong class="li hj">'div' </strong>, class_=<strong class="li hj">"sc-bscRGj hsYyqR"</strong>) :<br/>        pros=i.find (<strong class="li hj">'span' </strong>, class_=<strong class="li hj">"sc-bdVaJa gImhEG"</strong>)<br/>        print (<strong class="li hj">'writing (' </strong>, pros.text , <strong class="li hj">') to disk'</strong>)<br/>        names.append (pros.text)<br/>        rates=i.find (<strong class="li hj">'span' </strong>, class_=<strong class="li hj">"sc-bdVaJa eEdxFA"</strong>)<br/>        # if there is no price for the food, append 'N/A' in the list of 'prices'<br/>        if rates is not None :<br/>            print (<strong class="li hj">'price: ' </strong>, rates.text)<br/>            rate=rates.text<br/>        else :<br/>            print (<strong class="li hj">'N/A'</strong>)<br/>            rate=<strong class="li hj">'N/A'<br/>        </strong>prices.append (rate)<br/>        length: int=len (names)</span></pre><p id="9210" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(在<a class="ae jd" rel="noopener" href="/swlh/scraping-a-dynamic-web-page-its-selenium-da161999c975"> Part-I </a>中，我已经解释了这几行。)</p><p id="c443" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">12-如果达到抓取目标，将结果保存为CSV，给出完成消息，并退出。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="6edc" class="lm kb hi li b fi ln lo l lp lq"># if menu record reaches the target, exit the script target completion message box<br/>            if length&gt;150 :<br/>                # save to dataframe<br/>                df=pd.DataFrame ({<strong class="li hj">'Name' </strong>: names , <strong class="li hj">'Price' </strong>: prices})</span><span id="390c" class="lm kb hi li b fi lr lo l lp lq">                # export as csv file<br/>                df.to_csv (<strong class="li hj">'doordash_menus.csv'</strong>)<br/>                driver.close ()<br/>                ctypes.windll.user32.MessageBoxW (0 ,<br/>                                                  <strong class="li hj">f'Congratulations! We have successfully </strong>\<br/><strong class="li hj">                                                  scraped </strong>{length}<strong class="li hj"> menus.' </strong>,<br/>                                                  <strong class="li hj">'Project Completion' </strong>, 1)<br/>                break<br/>                sys.exit()<br/>            else :<br/>                continue<br/>        driver.back ()<br/>        continue<br/>    else :<br/>        driver.back ()<br/>        continue<br/># Project Succeeded</span></pre><p id="f07f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">{按顺序进行。}</p><p id="04f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一个方法中，我想在没有BeautifulSoup的情况下使用它，并保存一个JSON输出。</p><p id="0f52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">快乐编码。</p></div></div>    
</body>
</html>