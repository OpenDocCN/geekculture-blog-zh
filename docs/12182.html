<html>
<head>
<title>Blockchain Analytics using Julia</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Julia进行区块链分析</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/blockchain-analytics-using-julia-7bf76124a8f2?source=collection_archive---------10-----------------------#2022-04-30">https://medium.com/geekculture/blockchain-analytics-using-julia-7bf76124a8f2?source=collection_archive---------10-----------------------#2022-04-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="a11a" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">让我们解析一些块，并找出真正的内容</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/dcc1fbfa55aeaf3b15fb10dc4eb1ccf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WzudnNWFjNay7fxr"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@theshubhamdhage?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Shubham Dhage</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="dbbb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">理解区块链的工作原理可能很棘手，尤其是对初学者而言。许多受欢迎的区块链项目(如比特币、以太坊等。)已经存在，尽管它们在底层结构上可能有一些相似之处，但最终的实现可能会完全不同。关于这个主题有一些很好的文献，但是，我认为数据驱动的实践方法是真正满足好奇心的最好方法之一。</p><p id="2f68" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为此，我们将重点关注比特币，这是首批区块链项目之一，也可以说是最受欢迎的项目。其区块链的复杂性和绝对大小(约424 GB)也是一个具有挑战性的数据科学问题。在本文中，我们将学习如何从原始数据块中解析和提取有价值的信息。我们将利用<a class="ae jn" href="https://github.com/gdkrmr/BTCParser.jl" rel="noopener ugc nofollow" target="_blank"> BTCParser.jl </a>，一个纯粹用Julia编写的快速解析器。代码在<a class="ae jn" href="https://github.com/fonsp/Pluto.jl" rel="noopener ugc nofollow" target="_blank"> Pluto.jl </a>笔记本中执行，可以从<a class="ae jn" href="https://github.com/vnegi10/BTC_blockchain_analytics" rel="noopener ugc nofollow" target="_blank">克隆到这里</a>。</p><h1 id="9a03" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">获取原始数据</h1><p id="08d5" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">比特币区块链可以在你的本地电脑上下载。为此，首先你需要使用<a class="ae jn" href="https://bitcoin.org/en/bitcoin-core/" rel="noopener ugc nofollow" target="_blank">比特币核心</a>运行一个完整的节点。一旦GUI启动，该软件会将整个区块链的副本下载到您的磁盘上。这意味着您将拥有从第一个区块(2009年开采)开始的数据，也称为genesis区块。默认下载位置通常在<code class="du lh li lj lk b">~/.bitcoin/</code>，但是您可以自由选择另一个位置。请记住，您需要大约424 GB的空间(截至2022年4月11日),以防您需要最新的数据块。您也可以提前停止同步，在这种情况下，您将只有该特定时间点之前的数据。这是获取真实可靠数据的推荐方式，因为数据是从一组可信的对等点获取的，这些对等点通常是运行在世界各地计算机上的其他节点。不要相信任何其他来源是明智的。然而，如果你真的没有耐心，你可以从一个朋友的本地节点复制数据。</p><p id="e460" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">初始同步可能要求很高，无论是在电脑上还是在网络上。在我的台式电脑上，我配备了锐龙5 3600、快速PCIe gen3 NVMe固态硬盘和32 GB内存(16 GB分配给比特币核心的dbcache以加速同步)，花了大约四个小时才达到最新的块高度。</p><h1 id="7461" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">解析块</h1><p id="dd02" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated"><a class="ae jn" href="https://github.com/gdkrmr/BTCParser.jl" rel="noopener ugc nofollow" target="_blank"> BTCParser.jl </a>尚未注册。有两种方法可以使用该软件包:</p><ul class=""><li id="1ce5" class="ll lm hi jq b jr js ju jv jx ln kb lo kf lp kj lq lr ls lt bi translated">在您的系统上克隆存储库，然后执行:<code class="du lh li lj lk b">Pkg.add("&lt;your path&gt;").</code>我还在包源代码中硬编码了我的区块链数据目录的定制路径。</li><li id="3389" class="ll lm hi jq b jr lu ju lv jx lw kb lx kf ly kj lq lr ls lt bi translated">直接从资源库添加:<code class="du lh li lj lk b">Pkg.add("https://github.com/gdkrmr/BTCParser.jl")</code></li></ul><p id="0c69" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">解析将在<strong class="jq hj"> blk*上完成。位于<strong class="jq hj">块</strong>文件夹中的dat </strong>文件。该目录的当前大小约为424 GB(检查日期为2022年4月11日),并且预计会随着时间的推移而增长。我PC上的磁盘IO相当快！即便如此，解析所有数据也需要大约10-12分钟。</p><p id="1223" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">比特币区块链是一个分布式账本，包含有序的区块序列。块数据(用于解析)是网络格式，包含关于块散列、输入/输出事务、块奖励、时间戳、难度等信息。我们可以遍历类型为<code class="du lh li lj lk b">BTCParser.Chain</code>的<code class="du lh li lj lk b">chain</code>对象，这对于收集所选块的统计数据非常方便。注意，索引从0开始(这与Julia不同)，以保持与区块链实现的一致性。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lz"><img src="../Images/3bc609c989d6c4238ebf868c8c4907c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*jXRLKFRInaz96Le41ePacA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Parsing chain data and checking object type</figcaption></figure><p id="8c26" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">链的大小等于找到数据的块数。如果我们继续同步本地节点，大小会增加，因为大约每10分钟就会添加一个新块。一旦同步完成，我们将拥有数据，直到具有最新<em class="ma">高度</em>的块。在这里，块<em class="ma">高度</em>简单地指链上距离w.r.t .到genesis块。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mb"><img src="../Images/9bef539f693498a265fccd36f4e9e08f.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*IrGQZ7xNlM6DrB-6ViwqvQ.png"/></div></figure><h1 id="8765" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">收集有用的信息</h1><p id="5c4e" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">通过迭代选择的块，我们可以收集相关信息，并使用以下函数将其存储在数据帧中:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="3733" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">此处显示了一个示例数据帧:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es me"><img src="../Images/d27d26ea64d637afb8f78b23be116c3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k0w-otJ2t_uimrNlyDPAAg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">DataFrame with information for block numbers 400000 to 729900</figcaption></figure><p id="5fcb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<strong class="jq hj"> df_blocks中，tstamp </strong>指的是块的创建时间，<strong class="jq hj"> diff </strong>是目标难度，<strong class="jq hj"> tx </strong>是块中包含的事务数量，<strong class="jq hj"> tx_value </strong>是通过使用下面所示的函数对给定块中的所有输出求和而获得的总事务值。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="99a3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们的最后一列是<strong class="jq hj"> block_rewards </strong>，这是每个区块创造的新硬币和相关交易费用的总和。请注意，基本单位是Satoshis，其中1比特币= 10⁸ Satoshis。每个区块的奖励和交易费归成功验证并将相应区块添加到区块链的矿工所有。这种机制对利用自己的资源来帮助保护网络的矿工来说是一种财务激励。关于如何管理奖励的更多细节可以在<a class="ae jn" href="https://en.bitcoin.it/wiki/Controlled_supply" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl mf mg gp mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hb hc hd he hf"><h1 id="9f6e" class="kk kl hi bd km kn mm kp kq kr mn kt ku io mo ip kw ir mp is ky iu mq iv la lb bi translated">每日块数据</h1><p id="8aec" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">我们的原始数据帧包含时间间隔约为10分钟的数据块。为了形象化，查看每天的时间间隔更有意义。因此，我们将组合给定日期的块数据，并创建一个新的数据帧。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="1b7d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们的示例数据帧将如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mr"><img src="../Images/8b49be1ecef9117b7db166a5fcd27fb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DwDAExyofWtBSismO0QK3w.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">DataFrame condensed into daily data</figcaption></figure><p id="83c2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Pluto.jl最棒的一点是能够设置交互式过滤器。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ms"><img src="../Images/f41ea45153d34203803b2f43131e9024.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*OkFzTs7-Ka4MXPrQUdNnzw.gif"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Interactive selection for dates</figcaption></figure><p id="1b0a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以根据所选的时间范围过滤<strong class="jq hj"> df_blocks_per_day </strong>，如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mt"><img src="../Images/c5be44f53603d7ff798fd2cffa8e40a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XIYH_TiO_NUB6VucSfR2Ag.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Filtered DataFrame</figcaption></figure><h1 id="6c2c" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">交易数量</h1><p id="a362" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">我们现在可以使用<a class="ae jn" href="https://github.com/queryverse/VegaLite.jl" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj"> VegaLite.jl </strong> </a>包中的<strong class="jq hj"> @vlplot </strong>宏来绘制给定时间范围内的每日事务数。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/b8b3c496f1778e101bd976dcacd40865.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GeGBtgJ6FRSkrFqh4sbfDQ.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mv"><img src="../Images/2deb24054664634b8fd73a4058867cc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-CTE2xI-BmHTU6UKEoIg9g.png"/></div></div></figure><h1 id="809d" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated"><strong class="ak">总成交金额</strong></h1><p id="566e" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">与前面的例子类似，我们也可以看到每天交易的比特币总量。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mw"><img src="../Images/749eaa56f3862ab4781bbd8fa110558c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8cU0vvgK2OGQ7zEMWocW-w.png"/></div></div></figure><p id="78ad" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">与前几年相比，2021年下半年的平均交易活动似乎更高。这可能是由于交易导致的有利价格行为。在2019年期间，似乎还有一个数据点出现了巨大的峰值。我们可以通过我们的数据框架进行过滤，以准确定位这种情况发生的日期(2019年8月21日)。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mx"><img src="../Images/2bd1494b7224f393bcbe49cfd75028fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9wybkzNxwxyIVpCo1umcqg.png"/></div></div></figure><h1 id="82a9" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">平均阻塞时间</h1><p id="3791" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">使用时间戳，我们可以计算连续块之间经过的时间。比特币网络调整难度，平均10分钟左右生成一个区块。因为难度调整不是瞬间的，所以也有持续时间更短或更长的区块。当网络速度显著增加，难度逐渐调整到一个更高的值时，块将更快地生成。相反，网络散列值的突然下降会增加块生成时间，直到难度重新调整到一个较低的值。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mc md l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es my"><img src="../Images/0bab16cd8b71f06fc2e8739e189c8106.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hSmD03b1DPqTDDLdY4Wwmw.png"/></div></div></figure><p id="b790" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">事实上，我们的样本时间范围内的大多数块都是以大约10分钟的平均持续时间生成的。</p><h1 id="5563" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">阻止奖励</h1><p id="ab63" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">比特币协议在每个区块发行固定数量的新币，与交易费一起作为对矿工的激励。创世积木的奖励从50个硬币开始。它被编程为每210，000个数据块减少50%，这大约需要4年时间。这就是俗称的<em class="ma">减半</em>。通过绘制<strong class="jq hj">块_奖励</strong>列w.r.t. <strong class="jq hj"> tstamp，</strong>我们可以<strong class="jq hj"> </strong>可视化减半事件何时发生。如下图所示，到目前为止已经发生了3次减半事件(50–25–12.5–6.25)。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/3c084c4c3034b1c25324d759c34c55e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-utI58lmm4mIkgyT5GMlmw.png"/></div></div></figure><p id="354c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果你仔细观察，你会发现在某些时间段(如2017–2018年，2020年年中至2021年年中)，总奖励明显高于块奖励。这意味着交易费在大宗报酬中的贡献高于通常水平。看历史价格图，比如这里的<a class="ae jn" href="https://bitinfocharts.com/comparison/bitcoin-price.html#alltime" rel="noopener ugc nofollow" target="_blank">这里的</a>，和价格有明显的相关性。随着价格的上涨，人们开始更频繁地进行交易，这导致了网络拥塞。在这种情况下，您最终要支付更高的费用来确保您的交易包含在一个块中。很迷人，不是吗？</p></div><div class="ab cl mf mg gp mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hb hc hd he hf"><h1 id="9cf6" class="kk kl hi bd km kn mm kp kq kr mn kt ku io mo ip kw ir mp is ky iu mq iv la lb bi translated">结论</h1><p id="0e42" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">区块链正在成为Julia快速和可扩展的数据科学图书馆的一个令人兴奋和具有挑战性的游乐场。我希望你在看完这篇文章后学到了一些有价值的东西。感谢您的宝贵时间！如果你想联系，这是我的LinkedIn。</p></div><div class="ab cl mf mg gp mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hb hc hd he hf"><h1 id="70e7" class="kk kl hi bd km kn mm kp kq kr mn kt ku io mo ip kw ir mp is ky iu mq iv la lb bi translated">参考</h1><ol class=""><li id="d491" class="ll lm hi jq b jr lc ju ld jx na kb nb kf nc kj nd lr ls lt bi translated"><a class="ae jn" href="https://files.ifi.uzh.ch/CSG/staff/scheid/extern/theses/BA-D-Sommer.pdf" rel="noopener ugc nofollow" target="_blank">https://files . ifi . uzh . ch/CSG/staff/scheid/extern/themes/BA-D-Sommer . pdf</a></li><li id="fefc" class="ll lm hi jq b jr lu ju lv jx lw kb lx kf ly kj nd lr ls lt bi translated"><a class="ae jn" href="https://bitcoindev.network/understanding-the-data/" rel="noopener ugc nofollow" target="_blank">https://bitcoindev . network/understanding-the-data/</a></li><li id="80cc" class="ll lm hi jq b jr lu ju lv jx lw kb lx kf ly kj nd lr ls lt bi translated"><a class="ae jn" href="https://en.bitcoin.it/wiki/Controlled_supply#What_happens_when_all_the_bitcoins_are_mined.3F" rel="noopener ugc nofollow" target="_blank">https://en . bitcoin . it/wiki/Controlled _ supply # What _ happens _ when _ all _ the _ bit coins _ are _ mined . 3f</a></li></ol></div></div>    
</body>
</html>