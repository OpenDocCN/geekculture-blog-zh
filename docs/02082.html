<html>
<head>
<title>Federate OKTA IdP + WSO2 API Manager as Gateway to Spring boot Microservices Integration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">联合OKTA IdP + WSO2 API管理器作为Spring boot微服务集成的网关</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/federate-okta-idp-wso2-api-manager-as-gateway-to-spring-boot-microservices-integration-ba567567e81?source=collection_archive---------25-----------------------#2021-05-03">https://medium.com/geekculture/federate-okta-idp-wso2-api-manager-as-gateway-to-spring-boot-microservices-integration-ba567567e81?source=collection_archive---------25-----------------------#2021-05-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="334d" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">实施OIDC平台+ OAuth 2.0 + WSO2 API管理器</h2><div class=""/><div class=""><h2 id="7763" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">OKTA作为WSO2 API管理器中的关键管理器</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/21bba341fd0eefda9daee80b428bb275.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ujXREqH0MyndybX0zlgE7A.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Guide to OIDC Platform + OAuth 2.0 + Gateway Integration to Microservices</figcaption></figure><h1 id="53b1" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">范围</h1><p id="5c0a" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">a.本文解释了联合身份提供者与WSO2 API管理器的集成，以及使用OIDC 2.0 + OAuth 2.0通过API网关访问受保护的微服务。<br/> b .通过WSO2 API Manager中的OKTA Key Manager配置，从WSO2 API Gateway发起访问令牌验证。<br/> c .虚拟服务、资源、端点、生命周期。<br/> d. Id令牌，访问令牌，X-JWT——断言传播到使用Spring boot / Spring框架开发的受保护微服务。<br/> e .开发并测试概念证明。</p><h1 id="b432" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">先决条件</h1><p id="4f0c" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">a.OKTA作为身份提供者。一个开发者帐户就足够了。<br/> b. WSO2 API Manager v3.2.0，作为API网关。提供免费产品下载。<br/> c .使用Spring boot / Spring框架，Java平台的微服务开发。使用Maven进行设计和开发，让任何味道都黯然失色。</p><h1 id="de52" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">WSO2 API管理器组件</h1><h2 id="1347" class="lk jx hi bd jy ll lm ln kc lo lp lq kg kx lr ls ki lb lt lu kk lf lv lw km ho bi translated">a.管理门户</h2><p id="e567" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">在本文中，它用于配置外部密钥管理器。在这里，我们将OKTA配置为密钥管理器。</p><h2 id="e627" class="lk jx hi bd jy ll lm ln kc lo lp lq kg kx lr ls ki lb lt lu kk lf lv lw km ho bi translated">b.发布者门户</h2><p id="c3c8" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">在本文中，它用于发布受保护的资源、配置虚拟服务、将虚拟服务映射到实际受保护的端点、发布API。</p><h2 id="8777" class="lk jx hi bd jy ll lm ln kc lo lp lq kg kx lr ls ki lb lt lu kk lf lv lw km ho bi translated">c.开发门户</h2><p id="ef23" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">在本文中，它用于创建一个新的客户机应用程序，该应用程序使用WSO2 API Manager中配置的OKTA Key manager生成动态客户机注册。这将在OKTA(外部身份提供者)中自动创建一个OIDC平台应用程序。WSO2 API管理器和OKTA之间的集成用于在访问受保护的API之前验证访问令牌。</p><h1 id="52f1" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">整合概念</h1><h2 id="89c4" class="lk jx hi bd jy ll lm ln kc lo lp lq kg kx lr ls ki lb lt lu kk lf lv lw km ho bi translated">管理门户中的配置</h2><p id="6a7d" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">a.在本文中，我们通过提供<br/> <strong class="kq hs"> <em class="lx"> /将OKTA配置为密钥管理器。众所周知的</em> </strong> <em class="lx">端点自动从IdP导入所需的URI。<br/> b. </em>提供客户端应用的<em class="lx">客户端id、客户端秘密</em>和<em class="lx"> API token </em>，将客户端从WSO2 API管理器<em class="lx">动态注册到</em> OKTA IdP。<br/> c. <em class="lx"> API token </em>可以在OKTA中创建，用于动态客户端注册。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ly"><img src="../Images/52bc5af03c24533d62c8b8a051304aa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3H5kafdKS9tU5MRWAapqJA.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">OKTA, as key manager</figcaption></figure><h2 id="2128" class="lk jx hi bd jy ll lm ln kc lo lp lq kg kx lr ls ki lb lt lu kk lf lv lw km ho bi translated">Publisher门户中的配置</h2><p id="0113" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">这种集成的目的有助于我们理解以下内容:- <br/> a .创建一个API来通过WSO2 API管理器公开受保护的资源访问。<br/> b. WSO2 API Manager充当<strong class="kq hs"><em class="lx"/></strong>网关，将用于将虚拟服务映射到实际端点。<br/> c .这将有利于<strong class="kq hs"> <em class="lx">解耦</em> </strong>实际服务端点，因为来自客户端应用程序的调用将指向WSO2 API管理器中配置的虚拟服务，该管理器将充当网关。<br/> d .端点将是部署受保护微服务的域。<br/>e . WSO2 API管理器中的虚拟服务路径将包含映射的<strong class="kq hs"> <em class="lx">上下文根/版本</em> </strong>。<br/> f .例如，如果实际端点API有一个资源路径<strong class="kq hs"> /secured </strong>，那么在WSO2 API管理器中配置的<strong class="kq hs"> <em class="lx">资源路径</em> </strong>将是/ <strong class="kq hs">安全的。</strong>为配置的<strong class="kq hs"> <em class="lx">资源路径</em> </strong>调用API网关时，该路径将被附加到实际端点。<em class="lx">下面显示一个例子:- </em></p><blockquote class="lz ma mb"><p id="0f54" class="ko kp lx kq b kr mc is kt ku md iv kw me mf kz la mg mh ld le mi mj lh li lj hb bi translated"><strong class="kq hs">虚拟服务资源路径</strong><em class="hi">http(s)://&lt;wso2apim.com&gt;:8280/gateway/version</em><strong class="kq hs"><em class="hi">/secured</em><br/></strong><em class="hi">将通过追加</em><strong class="kq hs"><em class="hi">/secured</em></strong><em class="hi"><br/></em><em class="hi">实际微服务资源端点</em>  <em class="hi"> <br/>来调用微服务</em></p></blockquote><p id="b94c" class="pw-post-body-paragraph ko kp hi kq b kr mc is kt ku md iv kw kx mf kz la lb mh ld le lf mj lh li lj hb bi translated">g.在发布者门户中创建API并发布它。</p><p id="6653" class="pw-post-body-paragraph ko kp hi kq b kr mc is kt ku md iv kw kx mf kz la lb mh ld le lf mj lh li lj hb bi translated">h.API应该<strong class="kq hs"> <em class="lx">订阅</em> </strong>到<strong class="kq hs"> <em class="lx">客户端应用</em> </strong>，以便通过OAuth 2.0访问令牌提供对受保护端点的授权访问。客户端应用程序将在WSO2开发门户中创建，WSO2开发门户是WSO2 API管理器中的一个组件。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mk"><img src="../Images/af54e1b8c2b8857c47026d661f11f33e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PDNfOh_1luJO5IAa3H3C1g.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">API created and published</figcaption></figure><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ml"><img src="../Images/04700baff87e859801f07aefb8006d52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GP4cASRzKIKXyOhIwQq7tQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">API subscribed to client application</figcaption></figure><h2 id="a661" class="lk jx hi bd jy ll lm ln kc lo lp lq kg kx lr ls ki lb lt lu kk lf lv lw km ho bi translated">开发门户中的配置</h2><p id="be29" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">a.在dev portal中创建一个客户端应用程序，它将依次调用在key manager中配置的动态客户端注册URI，在OKTA中创建一个OIDC平台应用程序。这种集成将用于在将访问令牌发送到受保护的资源端点之前验证访问令牌。</p><p id="9d0e" class="pw-post-body-paragraph ko kp hi kq b kr mc is kt ku md iv kw kx mf kz la lb mh ld le lf mj lh li lj hb bi translated">b.向客户端应用程序订阅API后，客户端应用程序可以通过配置的密钥管理器生成访问令牌。新创建的密钥管理器将显示在开发门户中，通过它应该生成访问令牌。在我们的示例中，关键经理是OKTA。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mm"><img src="../Images/00ee686e69e46c5eb80c2af9d879bd2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q9yooTJqHRpFtGZbyOzW1w.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">OKTA, as Key manager</figcaption></figure><h1 id="14f5" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">运行示例</h1><p id="f068" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">a.让我们在<strong class="kq hs">端口8082 </strong>中运行弹簧启动微服务</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mn"><img src="../Images/af9211929362ca6629db4f2d59e966ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iz1Ebl9tEgzRs8yJGRIE5Q.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Spring boot microservices — port 8082</figcaption></figure><p id="5845" class="pw-post-body-paragraph ko kp hi kq b kr mc is kt ku md iv kw kx mf kz la lb mh ld le lf mj lh li lj hb bi translated">b.让我们在<strong class="kq hs">端口9443 </strong>中运行WSO2 API管理器</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mo"><img src="../Images/2cb65cf2aab119f769b4e0921b59214c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oksgZ3Y86LAorlXARpEibA.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">WSO2 API Manager — port 9443</figcaption></figure><p id="5a23" class="pw-post-body-paragraph ko kp hi kq b kr mc is kt ku md iv kw kx mf kz la lb mh ld le lf mj lh li lj hb bi translated">c.打开浏览器，点击超链接<strong class="kq hs"> <em class="lx"> /authorize(获取授权码)</em> </strong> URI获取<strong class="kq hs"> <em class="lx">授权码授予</em> </strong>。这将首先用OKTA IdP认证用户，然后将把<strong class="kq hs"> <em class="lx">代码</em> </strong>传递给重定向URI。控制器将读取<strong class="kq hs">代码</strong>并通过rest模板调用<strong class="kq hs"><em class="lx">/令牌</em> </strong>端点将<strong class="kq hs"> <em class="lx">代码</em> </strong>换成<strong class="kq hs"><em class="lx"/></strong>。接收到的<strong class="kq hs"> <em class="lx">访问令牌</em> </strong>将被发送到<strong class="kq hs"> <em class="lx">网关</em> </strong>进行验证，一旦通过<strong class="kq hs"> <em class="lx">密钥管理器</em> </strong>验证成功，将通过传递访问令牌来调用受保护端点。将从受保护资源接收对客户端应用程序的响应。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mp"><img src="../Images/51958238a8b20e745f336541474c5182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IpAv9AzG7nLlI_AYImV6Ig.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Get Authorization Code</figcaption></figure><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mq"><img src="../Images/2105f9308959e2dbe500d68e7588c3fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3d9UxF33Zu3eG6DmqOJXiw.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Access Protected API resource with access token</figcaption></figure><h1 id="e979" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">结论</h1><p id="8550" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">本文是IAM初学者和中级人员学习如何集成不同IAM产品及其好处的起点。它分享了对OIDC平台+ OAuth 2.0 +密钥管理器、通过WSO2 API管理器公开的Spring boot微服务端点和联合身份提供者集成的见解。</p><h2 id="e9f4" class="lk jx hi bd jy ll lm ln kc lo lp lq kg kx lr ls ki lb lt lu kk lf lv lw km ho bi translated">发布于2021年5月3日</h2></div><div class="ab cl mr ms gp mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hb hc hd he hf"><blockquote class="lz ma mb"><p id="0d11" class="ko kp lx kq b kr mc is kt ku md iv kw me mf kz la mg mh ld le mi mj lh li lj hb bi translated"><strong class="kq hs"> <em class="hi">其他中等文章，</em>由<em class="hi">加内什</em> </strong>撰写</p><p id="1dae" class="ko kp lx kq b kr mc is kt ku md iv kw me mf kz la mg mh ld le mi mj lh li lj hb bi translated"><a class="ae my" rel="noopener" href="/geekculture/quest-syntax-tree-and-remedy-code-smell-using-japa-visitor-patterns-f023a89842cf"> <em class="hi">探索语法树和补救代码气味使用JAPA访客模式</em> </a></p><p id="d257" class="ko kp lx kq b kr mc is kt ku md iv kw me mf kz la mg mh ld le mi mj lh li lj hb bi translated"><a class="ae my" rel="noopener" href="/nerd-for-tech/asynchronous-websocket-messaging-middleware-and-microservices-1a50a8f14e4b">异步WebSocket消息中间件和微服务</a></p><p id="e00e" class="ko kp lx kq b kr mc is kt ku md iv kw me mf kz la mg mh ld le mi mj lh li lj hb bi translated"><a class="ae my" rel="noopener" href="/geekculture/amalgamate-angular-with-spring-cloud-architecture-through-cors-7f13b5fdb98f">通过CORS融合Angular和Spring Cloud架构</a></p><p id="748b" class="ko kp lx kq b kr mc is kt ku md iv kw me mf kz la mg mh ld le mi mj lh li lj hb bi translated"><a class="ae my" rel="noopener" href="/geekculture/multi-broker-insights-into-apache-kafka-cluster-architecture-617b0abfc53e"> <em class="hi">多代理洞察Apache Kafka集群架构</em> </a></p><p id="1a39" class="ko kp lx kq b kr mc is kt ku md iv kw me mf kz la mg mh ld le mi mj lh li lj hb bi translated"><a class="ae my" href="https://ganeshblog.medium.com/remote-queue-definition-ibm-mq-v9-2-c3ec4f568dab?source=user_profile---------5----------------------------" rel="noopener">远程队列定义:IBM MQ v9.2 </a></p><p id="c6b5" class="ko kp lx kq b kr mc is kt ku md iv kw me mf kz la mg mh ld le mi mj lh li lj hb bi translated"><a class="ae my" href="https://ganeshblog.medium.com/kubernetes-pods-docker-containers-spin-vm-using-virtual-box-in-windows-10-home-d3be783ff087?source=user_profile---------0----------------------------" rel="noopener">Kubernetes Pods&amp;Docker Containers:在Windows 10 Home中使用虚拟盒子旋转虚拟机</a></p><p id="aef2" class="ko kp lx kq b kr mc is kt ku md iv kw me mf kz la mg mh ld le mi mj lh li lj hb bi translated"><a class="ae my" href="https://ganesh-nagalingam.medium.com/integrate-service-providers-sps-with-okta-identity-provider-idp-ce64a4e262ae" rel="noopener"> <em class="hi">整合服务提供商(sp)与OKTA身份提供商(IdP) </em> </a></p><p id="8750" class="ko kp lx kq b kr mc is kt ku md iv kw me mf kz la mg mh ld le mi mj lh li lj hb bi translated"><a class="ae my" href="https://ganeshblog.medium.com/integrate-ibm-business-process-manager-with-hybrid-mobilefirst-application-5aed20841bf3?source=user_profile---------2----------------------------" rel="noopener">将IBM业务流程管理器与混合MobileFirst应用程序集成</a></p><p id="3389" class="ko kp lx kq b kr mc is kt ku md iv kw me mf kz la mg mh ld le mi mj lh li lj hb bi translated"><a class="ae my" href="https://ganeshblog.medium.com/kerberos-v5-sso-authentication-in-windows-10-home-using-apache-directory-studio-fb0151899185?source=user_profile---------3----------------------------" rel="noopener"> Kerberos v5:使用Apache directory studio在Windows 10 Home中进行SSO认证</a></p><p id="3816" class="ko kp lx kq b kr mc is kt ku md iv kw me mf kz la mg mh ld le mi mj lh li lj hb bi translated"><a class="ae my" href="https://ganeshblog.medium.com/integrate-ibm-websphere-service-registry-and-repository-with-ibm-process-server-f97eeb0e2ea?source=user_profile---------6----------------------------" rel="noopener">将IBM WebSphere Service Registry and Repository与IBM Process Server集成</a></p></blockquote></div></div>    
</body>
</html>