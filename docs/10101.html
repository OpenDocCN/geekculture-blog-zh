<html>
<head>
<title>How to define event-driven architectures using AsyncAPI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用AsyncAPI定义事件驱动架构</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-define-event-driven-architectures-using-asyncapi-63c7e1025093?source=collection_archive---------15-----------------------#2022-01-13">https://medium.com/geekculture/how-to-define-event-driven-architectures-using-asyncapi-63c7e1025093?source=collection_archive---------15-----------------------#2022-01-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/e05ee999507aeffcaa6b3b42506a9d4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*hnXtL8hAaKOqAnUORbRnOw.png"/></div><figcaption class="im in et er es io ip bd b be z dx">Source: <a class="ae iq" href="http://www.asyncapi.com" rel="noopener ugc nofollow" target="_blank">www.asyncapi.com</a></figcaption></figure><p id="aa42" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">事件驱动的应用程序本质上是分布式和松散耦合的，这可能导致您的架构中有许多独立的组件，由多个团队管理。</p><p id="1b92" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">AsyncAPI提供了允许您以机器可读的格式定义<a class="ae iq" href="https://www.youtube.com/watch?v=U8Z806b7-lg&amp;list=PLQbzkJk10-f4f6kn9jLFpPOIW-_GP54k9&amp;index=5" rel="noopener ugc nofollow" target="_blank">消息驱动的API</a>的规范。</p><p id="89ea" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">本文将描述如何使用AsyncAPI定义来定义事件驱动的架构。</p><p id="1d43" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">async API规范的各个部分是什么？</strong></p><ul class=""><li id="6306" class="jp jq hi it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx bi translated"><strong class="it hj"> API版本</strong>:定义了AsycnAPI的版本。</li><li id="0932" class="jp jq hi it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx bi translated"><strong class="it hj"> Info </strong>:在这个部分中，您将定义一些关于API的元数据。</li><li id="489f" class="jp jq hi it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx bi translated"><strong class="it hj">服务器</strong>:这个部分描述了您想要连接的服务器或代理。</li><li id="86d5" class="jp jq hi it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx bi translated"><strong class="it hj">通道</strong>:此部分包含消息通道信息。</li><li id="ad72" class="jp jq hi it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx bi translated"><strong class="it hj">组件</strong>:该部分定义了您将在通道内引用的消息定义。</li></ul><p id="bea0" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">async API最小定义示例</strong></p><p id="051f" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">下面是一个连接到Kafka的API定义示例；</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="f656" class="km kn hi ki b fi ko kp l kq kr">asyncapi: 2.0</span><span id="4182" class="km kn hi ki b fi ks kp l kq kr">info:</span><span id="e6de" class="km kn hi ki b fi ks kp l kq kr">title: Shopping process</span><span id="2553" class="km kn hi ki b fi ks kp l kq kr">version: 1.0</span><span id="08d2" class="km kn hi ki b fi ks kp l kq kr">servers:</span><span id="0c81" class="km kn hi ki b fi ks kp l kq kr">development:</span><span id="ad7f" class="km kn hi ki b fi ks kp l kq kr">url: localhost:{port}</span><span id="b8a1" class="km kn hi ki b fi ks kp l kq kr">protocol: kafka</span><span id="2b5f" class="km kn hi ki b fi ks kp l kq kr">variables:</span><span id="b40b" class="km kn hi ki b fi ks kp l kq kr">port:</span><span id="888e" class="km kn hi ki b fi ks kp l kq kr">default: '9092'</span><span id="243e" class="km kn hi ki b fi ks kp l kq kr">channels:</span><span id="c6c6" class="km kn hi ki b fi ks kp l kq kr">shopping.events.01:</span><span id="69f7" class="km kn hi ki b fi ks kp l kq kr">description: |-</span><span id="0bfd" class="km kn hi ki b fi ks kp l kq kr">This contains events related to shopping.</span><span id="b012" class="km kn hi ki b fi ks kp l kq kr">publish:</span><span id="affb" class="km kn hi ki b fi ks kp l kq kr">operationId: consumeShoppingEvent</span><span id="e1c6" class="km kn hi ki b fi ks kp l kq kr">message:</span><span id="69b0" class="km kn hi ki b fi ks kp l kq kr">$ref: '#/components/messages/shoppingEvent'</span><span id="024d" class="km kn hi ki b fi ks kp l kq kr">bindings:</span><span id="134a" class="km kn hi ki b fi ks kp l kq kr">kafka:</span><span id="ec37" class="km kn hi ki b fi ks kp l kq kr">groupId: myGroupId</span><span id="2497" class="km kn hi ki b fi ks kp l kq kr">components:</span><span id="7674" class="km kn hi ki b fi ks kp l kq kr">messages:</span><span id="01b1" class="km kn hi ki b fi ks kp l kq kr">shoppingEvent:</span><span id="25df" class="km kn hi ki b fi ks kp l kq kr">name: shoppingEvent</span><span id="ac4c" class="km kn hi ki b fi ks kp l kq kr">contentType: 'application/json'</span><span id="2ee5" class="km kn hi ki b fi ks kp l kq kr">payload:</span><span id="0d5f" class="km kn hi ki b fi ks kp l kq kr">$ref: '#/components/schemas/ShoppingEventPayload'</span><span id="3fbd" class="km kn hi ki b fi ks kp l kq kr">schemas:</span><span id="b43b" class="km kn hi ki b fi ks kp l kq kr">ShoppingEventPayload:</span><span id="47cc" class="km kn hi ki b fi ks kp l kq kr">type: object</span><span id="cdf5" class="km kn hi ki b fi ks kp l kq kr">properties:</span><span id="5c5d" class="km kn hi ki b fi ks kp l kq kr">ShoppingId:</span><span id="be19" class="km kn hi ki b fi ks kp l kq kr">description: Shopping Id</span><span id="4976" class="km kn hi ki b fi ks kp l kq kr">type: string</span><span id="76fa" class="km kn hi ki b fi ks kp l kq kr">amount:</span><span id="3ed6" class="km kn hi ki b fi ks kp l kq kr">type: integer</span></pre><p id="178d" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">如何阅读AsyncAPI定义</strong></p><p id="b864" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">通过<a class="ae iq" href="https://github.com/asyncapi/spec" rel="noopener ugc nofollow" target="_blank">异步通信</a>，应用程序可以使用事件，也可以发出事件。</p><p id="83d1" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">上述示例中的一个通道部分如下所示:</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="df5e" class="km kn hi ki b fi ko kp l kq kr">channels:</span><span id="b6d2" class="km kn hi ki b fi ks kp l kq kr">shopping.events.01:</span><span id="1cb5" class="km kn hi ki b fi ks kp l kq kr">description: |-</span><span id="65f5" class="km kn hi ki b fi ks kp l kq kr">This contains events related to shopping.</span><span id="6f03" class="km kn hi ki b fi ks kp l kq kr">publish:</span><span id="a7f7" class="km kn hi ki b fi ks kp l kq kr">operationId: consumeShoppingEvent</span><span id="6ab7" class="km kn hi ki b fi ks kp l kq kr">message:</span><span id="df7b" class="km kn hi ki b fi ks kp l kq kr">$ref: '#/components/messages/shoppingEvent'</span><span id="fc5a" class="km kn hi ki b fi ks kp l kq kr">bindings:</span><span id="fa95" class="km kn hi ki b fi ks kp l kq kr">kafka:</span><span id="8f6c" class="km kn hi ki b fi ks kp l kq kr">groupId: myGroupId</span></pre><p id="3233" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">channel部分中的publish部分包含操作Id、消息和绑定。</p><p id="e8be" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">当您阅读定义时，您必须从查看者的角度阅读，查看已经由提供者应用程序实现的API定义。</p><p id="f0f2" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">如果您希望与提供者的应用程序(实现了API定义的应用程序)进行交互，您必须使用shopping.events.01主题中的事件。</p><p id="9e56" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">代码生成</strong></p><p id="6f2a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">AsyncAPI提供了不同的模板来从API定义中创建代码。Java、Nodejs、HTML和python等语言有相当多的代码生成模板。</p><p id="5e79" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">要从模板生成代码，您需要使用异步生成器命令，您可以通过命令行安装该命令，或者使用docker映像来运行该命令。</p><p id="987b" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">要安装命令行实用工具，您需要运行以下命令；</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="3717" class="km kn hi ki b fi ko kp l kq kr">npm install -g @asyncapi/generator</span></pre><p id="d067" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">在上面给出的例子中，您将使用@asyncapi/java-spring-template来生成api提供者和查看器的代码。</p><p id="f931" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">然而，如果您使用<a class="ae iq" href="https://www.youtube.com/watch?v=a9OEC7lcZaY" rel="noopener ugc nofollow" target="_blank"> docker方式</a>来创建代码，可能需要一些时间来生成，因为它会在您每次运行命令时下载模板。</p><p id="4171" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">结论</strong></p><p id="0976" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">本文介绍了AsyncAPI的定义，并使用代码模板生成代码。即使初学者使用AsyncAPI定义和生成代码看起来很复杂，但它的文档可以帮助您完成。</p><p id="c238" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">参考文献</strong></p><p id="c7fe" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">https://www.asyncapi.com/docs/specifications/v2.0.0<a class="ae iq" href="https://www.asyncapi.com/docs/specifications/v2.0.0" rel="noopener ugc nofollow" target="_blank"/></p><p id="79bf" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">【https://github.com/asyncapi/spec T4】</p><p id="1a57" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><a class="ae iq" href="https://www.avenga.com/magazine/async-api/" rel="noopener ugc nofollow" target="_blank">https://www.avenga.com/magazine/async-api/</a></p></div></div>    
</body>
</html>