<html>
<head>
<title>Publishing NuGet packages to a private Azure Artifacts feed with YAML Build files.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将NuGet包发布到带有YAML构建文件的私有Azure工件提要。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/publishing-nuget-packages-to-a-private-azure-artifacts-feed-with-yaml-build-files-c9062b309c23?source=collection_archive---------12-----------------------#2021-05-02">https://medium.com/geekculture/publishing-nuget-packages-to-a-private-azure-artifacts-feed-with-yaml-build-files-c9062b309c23?source=collection_archive---------12-----------------------#2021-05-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3e64" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">我们可以通过YAML文件中定义的管道轻松地将NuGet包发布到Azure工件中托管的内部提要。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/e60fd8b4669bab8c3a2805236cfb3e41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wiPeZwP5lgotYENs.png"/></div></div></figure><p id="3c95" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">使用Azure工件，我们可以将NuGet包发布到私有(或公共)NuGet提要。这些提要可以在Azure DevOps中在组织级别或项目级别确定范围。</p><p id="5fff" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在Azure DevOps中创建一个私有的NuGet feed非常简单。下面这篇文章展示了你可以设置一个。如果你正在跟进，并且还没有建立一个内部feed，停止阅读这篇文章，看看下面的文章。一旦你完成了，你可以回到这里。</p><div class="kg kh ez fb ki kj"><a href="https://docs.microsoft.com/en-us/azure/devops/artifacts/get-started-nuget?view=azure-devops&amp;tabs=windows" rel="noopener  ugc nofollow" target="_blank"><div class="kk ab dw"><div class="kl ab km cl cj kn"><h2 class="bd hj fi z dy ko ea eb kp ed ef hh bi translated">NuGet包入门- Azure工件</h2><div class="kq l"><h3 class="bd b fi z dy ko ea eb kp ed ef dx translated">开发人员可以使用Azure工件在提要和公共注册中心之间发布和使用NuGet包…</h3></div><div class="kr l"><p class="bd b fp z dy ko ea eb kp ed ef dx translated">docs.microsoft.com</p></div></div><div class="ks l"><div class="kt l ku kv kw ks kx jh kj"/></div></div></a></div><p id="8589" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这篇文章将向您展示我们如何使用YAML构建文件将我们创建的NuGet包发布到Azure工件中我们自己的私有提要。</p><p id="8b31" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">现在你可能对YAML有一个总的看法，是的，我们可以通过经典的用户界面获得相同的结果，但是我喜欢能够在我们的代码库中包含我们的构建文件，并且让我能够使用那个YAML文件的git历史来检查我们的构建文件的历史。</p><p id="9313" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">要将我们的NuGet包发布到我们的内部提要，我们需要执行以下操作:</p><ul class=""><li id="9c47" class="ky kz hi jl b jm jn jp jq js la jw lb ka lc ke ld le lf lg bi translated">创建我们的NuGet包</li><li id="116a" class="ky kz hi jl b jm lh jp li js lj jw lk ka ll ke ld le lf lg bi translated">决定我们包的版本策略</li><li id="fce6" class="ky kz hi jl b jm lh jp li js lj jw lk ka ll ke ld le lf lg bi translated">将我们的包发布到我们的内部订阅源</li></ul><p id="5f2d" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在这篇文章中，我将使用我在自己的健康应用程序中使用的助手库。如果你在阅读这篇文章的时候想看看它(它包括YAML的文件)，看看这个:</p><div class="kg kh ez fb ki kj"><a href="https://github.com/willvelida/MyHealth.Common" rel="noopener  ugc nofollow" target="_blank"><div class="kk ab dw"><div class="kl ab km cl cj kn"><h2 class="bd hj fi z dy ko ea eb kp ed ef hh bi translated">willvelida/MyHealth。普通的</h2><div class="kq l"><h3 class="bd b fi z dy ko ea eb kp ed ef dx translated">Permalink无法加载最新的提交信息。适用于我的所有MyHealth应用程序的公共帮助程序库</h3></div><div class="kr l"><p class="bd b fp z dy ko ea eb kp ed ef dx translated">github.com</p></div></div><div class="ks l"><div class="lm l ku kv kw ks kx jh kj"/></div></div></a></div><p id="410f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">创建我们的NuGet包</strong></p><p id="0726" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在进入构建文件的主体之前，我们需要设置一些东西:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="a1e4" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">让我们来分解一下:</p><ul class=""><li id="2a33" class="ky kz hi jl b jm jn jp jq js la jw lb ka lc ke ld le lf lg bi translated">每当我们提交到我们的<em class="lp">主</em>分支时，我们就触发构建开始。</li><li id="b6e5" class="ky kz hi jl b jm lh jp li js lj jw lk ka ll ke ld le lf lg bi translated">我们设置了一些在整个构建过程中需要的公共变量。</li><li id="cdbd" class="ky kz hi jl b jm lh jp li js lj jw lk ka ll ke ld le lf lg bi translated">我们使用Linux映像作为我们的构建代理。</li><li id="053e" class="ky kz hi jl b jm lh jp li js lj jw lk ka ll ke ld le lf lg bi translated">然后我们安装。NET Core SDK，使用运行restore命令的<strong class="jl hj"> DotNetCoreCLI </strong>任务来恢复我们的项目，然后我们使用运行build命令的另一个任务来构建项目。</li></ul><p id="04f8" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">为了在我们的构建文件中创建一个NuGet包，我们需要添加一个<strong class="jl hj"> DotNetCoreCLI </strong>任务，如下所示:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="8b2b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在这个任务中，我们运行pack命令，并告诉任务打包我们的项目路径，这个路径是我之前在YAML文件中定义的。我已经将<strong class="jl hj"> nobuild </strong>参数设置为true，因为我已经构建了我的项目。</p><p id="9810" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我的包是一个. NET标准包。<em class="lp">为。网芯和。NET标准包</em>，微软推荐你使用<strong class="jl hj"> DotNetCoreCLI </strong>任务。如果你正在为……构建<em class="lp">包。NET Framework </em>，可以使用一个<strong class="jl hj"> NuGet </strong>任务。</p><div class="kg kh ez fb ki kj"><a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/package/nuget?view=azure-devops" rel="noopener  ugc nofollow" target="_blank"><div class="kk ab dw"><div class="kl ab km cl cj kn"><h2 class="bd hj fi z dy ko ea eb kp ed ef hh bi translated">NuGet还原、打包和发布任务- Azure管道</h2><div class="kq l"><h3 class="bd b fi z dy ko ea eb kp ed ef dx translated">Azure Pipelines | Azure devo PS Server 2020 | Azure devo PS Server 2019 | TFS 2018注意，NuGet身份验证任务是…</h3></div><div class="kr l"><p class="bd b fp z dy ko ea eb kp ed ef dx translated">docs.microsoft.com</p></div></div><div class="ks l"><div class="lq l ku kv kw ks kx jh kj"/></div></div></a></div><p id="edaa" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">版本化策略</strong></p><p id="974e" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">有几种方法可以做到这一点。在我的包裹里。<strong class="jl hj"> csproj </strong>文件，我已经像这样指定了我的版本号:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="92f4" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果我们想通过在YAML定义的构建任务来实现这一点，我们可以这样做:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="85ab" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">有了<strong class="jl hj"> NuGet </strong>任务，我们就可以用<strong class="jl hj"> Major了。Minor.Patch </strong>我们构建的语义版本化方案。然而，一旦产生了一个版本，我们不能更新或替换该版本。它们是不可改变的。为了在每次更新时生成新版本的包，我们可以执行以下操作:</p><ol class=""><li id="c20f" class="ky kz hi jl b jm jn jp jq js la jw lb ka lc ke lr le lf lg bi translated">使用<strong class="jl hj"> $(版本:。r) </strong>我们希望增加的版本号的变量。这将在我们每次推进到我们的分支时自动增加该变量的构建号，同时保持其他变量不变。</li><li id="1cde" class="ky kz hi jl b jm lh jp li js lj jw lk ka ll ke lr le lf lg bi translated">使用<strong class="jl hj"> $(日期:yyyyMMdd) </strong>变量。这是为构建创建预发布标签的理想选择，同时允许我们保持主要版本、次要版本和补丁版本不变。</li></ol><p id="b1bb" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">发布我们的包给feed </strong></p><p id="1148" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">现在我们有了一个包，我们可以将它发布到我们的feed。为了发布到我们的Azure工件提要，我们需要将<strong class="jl hj">项目集合构建服务</strong>身份设置为提要上的<strong class="jl hj">贡献者</strong>。</p><div class="kg kh ez fb ki kj"><a href="https://docs.microsoft.com/en-us/azure/devops/artifacts/feeds/feed-permissions?view=azure-devops#azure-artifacts-settings" rel="noopener  ugc nofollow" target="_blank"><div class="kk ab dw"><div class="kl ab km cl cj kn"><h2 class="bd hj fi z dy ko ea eb kp ed ef hh bi translated">使用订阅源权限管理包- Azure工件</h2><div class="kq l"><h3 class="bd b fi z dy ko ea eb kp ed ef dx translated">您在Azure工件中托管的包存储在一个提要中。通过设置订阅源的权限，您可以共享您的…</h3></div><div class="kr l"><p class="bd b fp z dy ko ea eb kp ed ef dx translated">docs.microsoft.com</p></div></div><div class="ks l"><div class="ls l ku kv kw ks kx jh kj"/></div></div></a></div><p id="63b1" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">一旦我们实现了这一点，我们就可以将下面的YAML添加到我们的构建管道中。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="1927" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这里，我们使用<strong class="jl hj"> NuGetAuthenticate </strong>命令来认证我们的构建服务器，以将包推送到我们的内部NuGet提要。然后，我们使用push命令运行一个<strong class="jl hj"> NuGetCommand </strong>任务，将我们的包(存储在工件暂存目录中)推送到我们的内部NuGet提要。</p><p id="84d9" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在这里，我们使用<em class="lp"> &lt;项目名称&gt; / &lt;提要名称&gt; </em>作为我们的VSTS提要来发布到。请记住，在Azure DevOps中，我们可以在项目级别或组织级别确定提要的范围。因为我的提要是在项目级别上，所以我需要在这里输入项目名称。</p><p id="2292" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我还包含了参数<strong class="jl hj"> nuGetFeedType </strong>,并声明我们的目标字段是一个内部提要。因为我们在NuGet命令任务中使用了<strong class="jl hj"> push </strong>命令，所以这个参数是必需的。</p><p id="5255" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">全YAML档案</strong></p><p id="3c04" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这是我们完整的YAML档案:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="97a2" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">结论</strong></p><p id="d98c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">希望您能看到将我们的NuGet包发布到Azure工件中的私有NuGet提要是多么简单。这不仅仅局限于私有的NuGet feeds，我们也可以发布从DevOps到NuGet的包。</p><p id="271c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果你想了解更多关于Azure工件的知识，我建议你查阅文档，这些文档涵盖了诸如配置提要、发布NuGet(和其他)类型的包等主题:</p><div class="kg kh ez fb ki kj"><a href="https://docs.microsoft.com/en-us/azure/devops/artifacts/?view=azure-devops" rel="noopener  ugc nofollow" target="_blank"><div class="kk ab dw"><div class="kl ab km cl cj kn"><h2 class="bd hj fi z dy ko ea eb kp ed ef hh bi translated">Azure工件文档</h2><div class="kq l"><h3 class="bd b fi z dy ko ea eb kp ed ef dx translated">只需编写一次代码，就可以在整个组织中共享软件包。托管您的私有NuGet、npm、Maven、Python和Universal…</h3></div><div class="kr l"><p class="bd b fp z dy ko ea eb kp ed ef dx translated">docs.microsoft.com</p></div></div><div class="ks l"><div class="lt l ku kv kw ks kx jh kj"/></div></div></a></div><p id="67f2" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果你对这篇文章有任何问题，请在评论中告诉我，或者你可以通过<a class="ae kf" href="https://twitter.com/willvelida" rel="noopener ugc nofollow" target="_blank"> Twitter </a>联系我。</p></div></div>    
</body>
</html>