<html>
<head>
<title>How to Host a Personal Email Server on Google Cloud (for Free!): Part V</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Google Cloud上托管个人邮件服务器(免费！):第五部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-host-a-personal-email-server-on-google-cloud-for-free-part-v-f9a4b3643622?source=collection_archive---------6-----------------------#2022-01-11">https://medium.com/geekculture/how-to-host-a-personal-email-server-on-google-cloud-for-free-part-v-f9a4b3643622?source=collection_archive---------6-----------------------#2022-01-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="1a80" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">使用Roundcube托管网络邮件</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/6b2e8f16b70af07c66f9c8ac6b6afd8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uZ5IoRx580iym_S42I5RpA.jpeg"/></div></div></figure><h1 id="7069" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">本系列文章</h1><ol class=""><li id="72bb" class="kb kc hi kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><a class="ae kt" href="https://lp3.medium.com/how-to-host-a-personal-email-server-on-google-cloud-for-free-part-i-8124d65d1d25" rel="noopener">简介&amp; GCP设置</a></li><li id="30c1" class="kb kc hi kd b ke ku kg kv ki kw kk kx km ky ko kp kq kr ks bi translated"><a class="ae kt" href="https://lp3.medium.com/how-to-host-a-personal-email-server-on-google-cloud-for-free-part-ii-20aaeb0ae9eb" rel="noopener">配置后缀、邮件枪、&amp; DNS记录</a></li><li id="87c6" class="kb kc hi kd b ke ku kg kv ki kw kk kx km ky ko kp kq kr ks bi translated"><a class="ae kt" href="https://lp3.medium.com/how-to-host-a-personal-email-server-on-google-cloud-for-free-part-iii-15e2db1f1f8e" rel="noopener">配置鸽笼&amp;加密</a></li><li id="3726" class="kb kc hi kd b ke ku kg kv ki kw kk kx km ky ko kp kq kr ks bi translated"><a class="ae kt" href="https://lp3.medium.com/how-to-host-a-personal-email-server-on-google-cloud-for-free-part-iv-1b5142cab9c" rel="noopener">使用MariaDB &amp; Postfixadmin </a>管理虚拟邮箱</li><li id="8930" class="kb kc hi kd b ke ku kg kv ki kw kk kx km ky ko kp kq kr ks bi translated"><strong class="kd hj"> <em class="kz">用Roundcube托管Webmail</em></strong></li><li id="4976" class="kb kc hi kd b ke ku kg kv ki kw kk kx km ky ko kp kq kr ks bi translated"><a class="ae kt" rel="noopener" href="/geekculture/how-to-host-a-personal-email-server-on-google-cloud-for-free-part-vi-6ea09f18d7df">用Rspamd &amp;筛子过滤垃圾邮件</a></li></ol><p id="5106" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">如果您还没有阅读本系列的前几篇文章，请按照上面的链接进行阅读。现在，我们已经将运行在GCP上的服务器配置为通过SMTP协议发送和接收电子邮件，并允许IMAP连接，同时使用TLS加密流量。我们的DNS记录配置正确，以确保电子邮件发送到我们，我们使用虚拟邮箱，因此每个邮箱不需要本地unix用户。这些文件存储在MariaDB数据库中，通过网络浏览器使用Postfixadmin进行管理。</p><p id="fd1c" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">我们已经从电子邮件客户端成功连接，但是如果我们无法访问个人设备，而需要访问我们的邮箱，该怎么办？拥有一个可以在浏览器中访问的网络邮件客户端肯定会很方便。<em class="kz"> Roundcube </em>提供的正是这个！这是一个用PHP编写的免费的、功能齐全的开源webmail客户端。最重要的是，感谢我们已经投入的所有工作，这将是添加到我们的私人电子邮件解决方案的一块蛋糕！让我们开始吧。</p><h1 id="ebe2" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">安装Roundcube</h1><p id="f2c8" class="pw-post-body-paragraph la lb hi kd b ke kf ij ld kg kh im lf ki lp lh li kk lq lk ll km lr ln lo ko hb bi translated">首先下载最新版本的<a class="ae kt" href="https://roundcube.net/download/" rel="noopener ugc nofollow" target="_blank"> Roundcube </a>。</p><pre class="iy iz ja jb fd ls lt lu lv aw lw bi"><span id="1a8f" class="lx jk hi lt b fi ly lz l ma mb">wget https://github.com/roundcube/roundcubemail/releases/download/<em class="kz">1.6.1</em>/roundcubemail-<em class="kz">1.6.1</em>-complete.tar.gz</span></pre><p id="7772" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">提取归档文件，并将内容移动到站点的根目录。</p><pre class="iy iz ja jb fd ls lt lu lv aw lw bi"><span id="e797" class="lx jk hi lt b fi ly lz l ma mb">tar -xf roundcubemail-1.6.1-complete.tar.gz<br/>sudo mv roundcubemail-1.6.1/* /var/www/mail/</span></pre><p id="fce5" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">然后，确保<strong class="kd hj"> <em class="kz">根</em> </strong>拥有该文件。例外是<strong class="kd hj"> <em class="kz"> www-data </em> </strong>需要拥有<code class="du mc md me lt b">temp/</code>和<code class="du mc md me lt b">logs/</code>目录的所有权。</p><pre class="iy iz ja jb fd ls lt lu lv aw lw bi"><span id="5416" class="lx jk hi lt b fi ly lz l ma mb">sudo chown -R root:root /var/www/mail/<br/>sudo chown -R www-data:www-data /var/www/mail/temp/ /var/www/mail/logs/</span></pre><p id="0b18" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">我们现在可以移除Nginx提供的默认<em class="kz">索引</em>文件。</p><pre class="iy iz ja jb fd ls lt lu lv aw lw bi"><span id="f029" class="lx jk hi lt b fi ly lz l ma mb">sudo rm /var/www/mail/index.nginx-debian.html</span></pre><h1 id="68c2" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">为Roundcube创建数据库和用户</h1><p id="7dba" class="pw-post-body-paragraph la lb hi kd b ke kf ij ld kg kh im lf ki lp lh li kk lq lk ll km lr ln lo ko hb bi translated">Roundcube需要一个数据库来存储用户信息，与我们之前设置的虚拟邮箱数据库分开。我们还需要为Roundcube创建一个具有适当权限的用户来访问数据库。运行<code class="du mc md me lt b">mysql</code>。</p><pre class="iy iz ja jb fd ls lt lu lv aw lw bi"><span id="710d" class="lx jk hi lt b fi ly lz l ma mb">sudo mysql</span></pre><p id="70ad" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">然后，运行以下命令来创建数据库和具有权限的用户。用您选择的密码替换<em class="kz">密码</em>。</p><pre class="iy iz ja jb fd ls lt lu lv aw lw bi"><span id="51cd" class="lx jk hi lt b fi ly lz l ma mb">CREATE DATABASE roundcube;<br/>CREATE USER roundcube@localhost IDENTIFIED BY '<em class="kz">password</em>';<br/>GRANT ALL PRIVILEGES ON roundcube.* TO roundcube@localhost;<br/>flush privileges;<br/>exit;</span></pre><p id="e63e" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">之后，将Roundcube提供的初始表导入数据库。</p><pre class="iy iz ja jb fd ls lt lu lv aw lw bi"><span id="43cd" class="lx jk hi lt b fi ly lz l ma mb">sudo mysql roundcube &lt; /var/www/mail/SQL/mysql.initial.sql</span></pre><h1 id="b521" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">在浏览器中完成安装</h1><p id="c833" class="pw-post-body-paragraph la lb hi kd b ke kf ij ld kg kh im lf ki lp lh li kk lq lk ll km lr ln lo ko hb bi translated">现在导航到https://<em class="kz">mail.example.com</em>/installer来完成安装，用你的邮件子域替换<em class="kz">mail.example.com</em>。如果您已经阅读了本系列的所有内容，您会发现我们缺少了Roundcube所需的三个PHP扩展。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mf"><img src="../Images/af3800028ff0dabdf5482f71ba3e6383.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gfxqMBQoFdbIYoEwqi6aIQ.png"/></div></div></figure><p id="738f" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">我们可以使用以下命令安装它们:</p><pre class="iy iz ja jb fd ls lt lu lv aw lw bi"><span id="616d" class="lx jk hi lt b fi ly lz l ma mb">sudo apt install php-xml php-intl -y</span></pre><p id="0934" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">刷新页面后，我们现在可以向下滚动到底部，并选择下一个继续安装。在大多数情况下，默认选择是好的，但是如果您想进一步定制您的安装，您可以在这里了解关于参数<a class="ae kt" href="https://github.com/roundcube/roundcubemail/wiki/Configuration" rel="noopener ugc nofollow" target="_blank">的更多信息。我们将不得不编辑一些部分，从<em class="kz">数据库设置</em>开始。填写用于设置我们的数据库的详细信息。</a></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mg"><img src="../Images/04b1168372e727b1d237e105b8d2d250.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4-HbGYNNvJHtDZE-7k8sAw.png"/></div></div></figure><p id="0834" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">接下来，我们需要告诉Roundcube在与Dovecot &amp; Postfix通信时使用安全的IMAP &amp; SMTP连接。使用您的邮件子域，在<em class="kz"> IMAP设置</em>部分输入以下内容。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mh"><img src="../Images/36ac4f4c3a94e02ceabc4197f48937ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eyl0J1zQmSmI5hG1JkhQng.png"/></div></div></figure><p id="c349" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">然后，按如下方式配置<em class="kz"> SMTP设置</em>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/ffbb85f038da000a775bef92029804fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yd9UzjoSSFGDLnAPVtUrgg.png"/></div></div></figure><p id="4cb8" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">我们必须在这里使用我们的子域，但是没有理由浪费宝贵的资源查询公共DNS来找到我们自己的服务器！让我们在<code class="du mc md me lt b">localhost</code>旁边为我们的子域添加一个本地DNS条目。更新第一行<code class="du mc md me lt b">/etc/hosts</code>。</p><pre class="iy iz ja jb fd ls lt lu lv aw lw bi"><span id="2d1f" class="lx jk hi lt b fi ly lz l ma mb">127.0.0.1       localhost <em class="kz">mail.example.com</em></span></pre><p id="34f0" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">有各种很棒的插件可以给Roundcube增加功能。向下滚动查看<em class="kz">插件</em>部分，在结束之前启用一些。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mj"><img src="../Images/545ca7a463c2a6b0a04d82fc7d0a9560.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-2UF9487iEkp9fc6MZTnow.png"/></div></div></figure><p id="38f3" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated"><strong class="kd hj">注意:</strong>有些插件可能需要额外的步骤才能正常启动和运行。一个简单的谷歌搜索插件将很容易找到关于如何做的信息。</p><p id="e454" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">完成后，选择<em class="kz">创建配置</em>创建配置。如下一页所述，我们需要复制配置并保存到<code class="du mc md me lt b">/var/www/mail/config/config.inc.php</code>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mk"><img src="../Images/dc2ccddfadfe14338ba4963adb005384.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xQ099eRRgRG-esfe5V6whw.png"/></div></div></figure><p id="6851" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">之后，点击<em class="kz">继续</em>。现在我们可以测试我们的SMTP和IMAP配置是否正确。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ml"><img src="../Images/8fd60fd863818b22938bf6c4d1f0d333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rbI8jfW8lcDA0o5VE6PiBQ.png"/></div></div></figure><p id="d839" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">如果任一测试失败，您可以使用页面顶部的链接返回并编辑配置。一旦成功，请务必从我们网站的根目录删除<code class="du mc md me lt b">installer</code>目录，因为这是一个安全风险。</p><pre class="iy iz ja jb fd ls lt lu lv aw lw bi"><span id="6734" class="lx jk hi lt b fi ly lz l ma mb">sudo rm -R /var/www/mail/installer/</span></pre><p id="7da0" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">现在在浏览器中导航到您的子域(即<em class="kz">https:</em>//【mail.example.com)并登录。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mm"><img src="../Images/0c4baaa41c61ee844e1467abcdc0bdcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CsLNulMJxcmE6MG7nfmJxA.png"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx">Roundcube Webmail Interface</figcaption></figure><h1 id="b622" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">结论</h1><p id="6cd5" class="pw-post-body-paragraph la lb hi kd b ke kf ij ld kg kh im lf ki lp lh li kk lq lk ll km lr ln lo ko hb bi translated">我们现在可以从任何带有网络浏览器的设备上访问我们的邮箱了！让我们回顾一下我们是如何做到这一点的。</p><ul class=""><li id="ba0e" class="kb kc hi kd b ke lc kg le ki mr kk ms km mt ko mu kq kr ks bi translated">我们将Roundcube下载到邮件站点的根目录下，并对所有文件设置适当的所有权。</li><li id="6fba" class="kb kc hi kd b ke ku kg kv ki kw kk kx km ky ko mu kq kr ks bi translated">我们为Roundcube创建了一个具有正确权限的数据库&amp; user。</li><li id="695e" class="kb kc hi kd b ke ku kg kv ki kw kk kx km ky ko mu kq kr ks bi translated">我们按照web浏览器中的Roundcube安装程序提供的说明进行操作，然后删除了安装程序。</li><li id="4b84" class="kb kc hi kd b ke ku kg kv ki kw kk kx km ky ko mu kq kr ks bi translated">我们还为我们的子域创建了一个本地DNS条目，以防止Roundcube在与Postfix &amp; Dovecot通信时查询公共DNS。</li></ul><p id="1a75" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">只剩一篇文章了！从技术上来说，如果你觉得自己足够幸运，能够让自己的电子邮件地址不落入坏人之手，那么你可以离开这里。我警告你，这不是我们生活的世界。垃圾邮件最终会找到你藏在云中的电子邮件服务器，当它出现时，我们会做好准备。在本系列的最后一篇文章中，我们将安装<em class="kz"> Rspamd </em> &amp; <em class="kz">筛子</em>，以便检测垃圾邮件并将其拒绝或发送到垃圾文件夹。</p><p id="bbfd" class="pw-post-body-paragraph la lb hi kd b ke lc ij ld kg le im lf ki lg lh li kk lj lk ll km lm ln lo ko hb bi translated">感谢您的阅读！如果你觉得这个系列或文章有帮助，请鼓掌，并在最后一篇文章发表后继续关注。</p></div></div>    
</body>
</html>