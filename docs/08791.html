<html>
<head>
<title>SFTP To Go on Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SFTP将登上Heroku</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/sftp-to-go-on-heroku-78aff427c566?source=collection_archive---------15-----------------------#2021-11-14">https://medium.com/geekculture/sftp-to-go-on-heroku-78aff427c566?source=collection_archive---------15-----------------------#2021-11-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="5113" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">集成强大的远程存储附件</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/303a53b3fdc9b7b67c0d19b76deb6952.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HKM3ztWjiUgRPxHszW2L-w.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@peterburdon?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Peter Burdon</a> on <a class="ae jn" href="https://unsplash.com/s/photos/imagine?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8373" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Heroku是一个云原生平台，用于开发各种语言的应用程序。它提供了许多功能(GitHub和Docker集成、Web UI和命令行、扩展插件和云服务列表等)，是启动个人/小型项目的理想场所。</p><p id="b2ff" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">但是有一个<strong class="jq hj">用例</strong>并不简单:<strong class="jq hj">存储文件。</strong></p><p id="175b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">[ <em class="kk">如果你感兴趣的话，我已经在另一篇文章中讨论过这个挑战了</em></p><div class="kl km ez fb kn ko"><a rel="noopener follow" target="_blank" href="/geekculture/files-on-heroku-cd09509ed285"><div class="kp ab dw"><div class="kq ab kr cl cj ks"><h2 class="bd hj fi z dy kt ea eb ku ed ef hh bi translated">赫罗库的档案</h2><div class="kv l"><h3 class="bd b fi z dy kt ea eb ku ed ef dx translated">克服Heroku短暂文件系统的选择。免费的。</h3></div><div class="kw l"><p class="bd b fp z dy kt ea eb ku ed ef dx translated">medium.com</p></div></div><div class="kx l"><div class="ky l kz la lb kx lc jh ko"/></div></div></a></div><blockquote class="ld le lf"><p id="04e5" class="jo jp kk jq b jr js ij jt ju jv im jw lg jy jz ka lh kc kd ke li kg kh ki kj hb bi translated">Heroku Dynos提供了一个<a class="ae jn" href="https://devcenter.heroku.com/articles/dynos#ephemeral-filesystem" rel="noopener ugc nofollow" target="_blank">短暂的</a>文件系统:本地更改在每次重新部署和应用程序重启时都会被丢弃，这使得它不适合持久化数据。</p></blockquote><p id="2b7b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">考虑到<code class="du lj lk ll lm b">Dyno Cycling</code>政策，这变得更加具有挑战性。</p><blockquote class="ld le lf"><p id="24d0" class="jo jp kk jq b jr js ij jt ju jv im jw lg jy jz ka lh kc kd ke li kg kh ki kj hb bi translated">每个Dyno(至少)每24小时重启一次，以保持系统的健康</p></blockquote><p id="b041" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">幸运的是，Heroku提供了各种各样的数据存储解决方案，从数据库到远程存储，符合S3标准的文件系统和SFTP存储库。</p><p id="0fa9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">本文介绍了<a class="ae jn" href="https://devcenter.heroku.com/articles/sftptogo" rel="noopener ugc nofollow" target="_blank"> SFTP To Go </a>附加组件、其特性、设置以及与Python代码的集成。<strong class="jq hj">如果您只对最终概述和最精彩部分感兴趣，请跳到结尾</strong>。</p><h1 id="ce69" class="ln lo hi bd lp lq lr ls lt lu lv lw lx io ly ip lz ir ma is mb iu mc iv md me bi translated">SFTP外带</h1><p id="c893" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated"><a class="ae jn" href="https://sftptogo.com/" rel="noopener ugc nofollow" target="_blank"> SFTP To Go </a>是一款为Heroku应用提供SFTP/FTPS存储的云解决方案。它以单击式附件的形式提供，提供了各种功能:</p><ul class=""><li id="2509" class="mk ml hi jq b jr js ju jv jx mm kb mn kf mo kj mp mq mr ms bi translated">零管理:SFTP的设置和管理对开发人员来说是透明的</li><li id="5d17" class="mk ml hi jq b jr mt ju mu jx mv kb mw kf mx kj mp mq mr ms bi translated">网络入站规则:定义可以访问服务器的IP地址</li><li id="eecb" class="mk ml hi jq b jr mt ju mu jx mv kb mw kf mx kj mp mq mr ms bi translated">亚马逊S3访问:使用S3兼容的API访问和管理文件</li><li id="f98e" class="mk ml hi jq b jr mt ju mu jx mv kb mw kf mx kj mp mq mr ms bi translated">大规模运行:构建在Amazon云平台之上，可以随着流量和文件大小的增加而扩展</li><li id="4864" class="mk ml hi jq b jr mt ju mu jx mv kb mw kf mx kj mp mq mr ms bi translated">Webhooks:当文件改变时通知应用程序</li></ul><h2 id="84d6" class="my lo hi bd lp mz na nb lt nc nd ne lx jx nf ng lz kb nh ni mb kf nj nk md nl bi translated">设置</h2><p id="8e48" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated">根据产品的<code class="du lj lk ll lm b">Zero Management</code>理念，设置是简单的。</p><pre class="iy iz ja jb fd nm lm nn no aw np bi"><span id="5e1b" class="my lo hi lm b fi nq nr l ns nt">heroku addons:create sftptogo:bronze -a APP_NAME</span></pre><p id="9871" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">该插件在后台相对快速地配置:一旦准备就绪，你可以直接从Heroku访问“SFTP Go”仪表板。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nu"><img src="../Images/81093f8e5b9ff6bb64baa53e73f1be14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nJ_bYty8baGyfG0Knt9Y_Q.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Heroku Administration UI — SFTP To Go link — Image by Author</figcaption></figure><p id="db5f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在“SFTP去”仪表板有你需要的一切:凭证(SFTP / FTPS访问和亚马逊S3)，网络安全配置和Webhooks(见下文)。</p><h2 id="0185" class="my lo hi bd lp mz na nb lt nc nd ne lx jx nf ng lz kb nh ni mb kf nj nk md nl bi translated">验证访问</h2><p id="0e9e" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated">安装完附加组件后，让我们尝试使用命令行访问存储库:</p><pre class="iy iz ja jb fd nm lm nn no aw np bi"><span id="5908" class="my lo hi lm b fi nq nr l ns nt">sftp a12b23c34******@<!-- -->repo.sftptogo.com<br/>sftp&gt; mkdir dir<br/>sftp&gt; ls<br/>dir</span></pre><p id="6862" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们也可以尝试使用SFTP的客户端，如<a class="ae jn" href="https://cyberduck.io/" rel="noopener ugc nofollow" target="_blank">赛博达克</a></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nv"><img src="../Images/814dd2c22d64271a3df49a33d02d6721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0B5qdTsmBeECd-nAzunkyw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Cyberduck Connection Configuration — Image by Author</figcaption></figure><h1 id="7d9e" class="ln lo hi bd lp lq lr ls lt lu lv lw lx io ly ip lz ir ma is mb iu mc iv md me bi translated">应用功能</h1><h2 id="fa95" class="my lo hi bd lp mz na nb lt nc nd ne lx jx nf ng lz kb nh ni mb kf nj nk md nl bi translated">通过S3进入</h2><p id="b170" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated">与AWS S3的兼容性使得该插件非常有吸引力，因为它可以很容易地与各种编程语言和框架集成。</p><p id="1df9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Python开发者可以使用<code class="du lj lk ll lm b"><a class="ae jn" href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html" rel="noopener ugc nofollow" target="_blank">boto3</a></code>包</p><pre class="iy iz ja jb fd nm lm nn no aw np bi"><span id="9a3e" class="my lo hi lm b fi nq nr l ns nt">session = boto3.session.Session()</span><span id="0fa3" class="my lo hi lm b fi nw nr l ns nt">s3 = session.client(<br/>    <strong class="lm hj">service_name</strong>=<strong class="lm hj">'</strong>s3<strong class="lm hj">'</strong>,<br/>    <strong class="lm hj">aws_access_key_id</strong>='####',<br/>    <strong class="lm hj">aws_secret_access_key</strong>='####',<br/>    <strong class="lm hj">region_name</strong>='eu-west-1'<br/>)</span><span id="0a51" class="my lo hi lm b fi nw nr l ns nt"># upload new file<br/>s3.upload_file(<strong class="lm hj">Bucket</strong>='', <strong class="lm hj">Key</strong>='myfile.txt', <strong class="lm hj">Filename</strong>='/tmp/myfile.txt')</span></pre><h2 id="af13" class="my lo hi bd lp mz na nb lt nc nd ne lx jx nf ng lz kb nh ni mb kf nj nk md nl bi translated">通过SFTP协议访问</h2><p id="8786" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated">开发者也可以选择FTP库，例如<code class="du lj lk ll lm b"><a class="ae jn" href="https://docs.python.org/3/library/ftplib.html" rel="noopener ugc nofollow" target="_blank">ftplib</a></code></p><pre class="iy iz ja jb fd nm lm nn no aw np bi"><span id="575f" class="my lo hi lm b fi nq nr l ns nt">filename='myfile.txt'<br/>filepath='/tmp/myfile.txt'</span><span id="d72f" class="my lo hi lm b fi nw nr l ns nt">s = ftplib.FTP_TLS(<strong class="lm hj">host</strong>='h.example.com', <strong class="lm hj">user</strong>='user', <strong class="lm hj">passwd</strong>='123')<br/>s.prot_p() <em class="kk"># data-channel protected by TLS<br/><br/></em>file = open(localfile, <strong class="lm hj">'rb'</strong>)  <em class="kk"># file to send<br/></em>s.storbinary(<strong class="lm hj">'STOR '</strong>+filename, filepath)  <em class="kk"># send the file</em></span><span id="38f0" class="my lo hi lm b fi nw nr l ns nt">file.close()  <em class="kk"><br/></em>s.quit()</span></pre><h2 id="39e9" class="my lo hi bd lp mz na nb lt nc nd ne lx jx nf ng lz kb nh ni mb kf nj nk md nl bi translated">Webhooks</h2><p id="f96a" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated">可以使用webhooks通知特殊事件(文件创建、文件删除):对于管理应用程序外部发生的数据更改来说，这是一个出色的特性。</p><p id="e649" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在仪表板中配置webhook详细信息(端点URL、授权头、要监控的事件类型)</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nx"><img src="../Images/3ae60078e2a44d3850f5a2e6b81378ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gSh5yRs8wg2VmKomSjTTBw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">SFTP To Go Add Webhook — Image by Author</figcaption></figure><p id="a87e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">实现一个REST端点，每当发生一个给定的事件时，处理“SFTP要走了”推送的POST请求。使用Flask这很简单:</p><pre class="iy iz ja jb fd nm lm nn no aw np bi"><span id="8692" class="my lo hi lm b fi nq nr l ns nt">@app.route(<strong class="lm hj">'/event'</strong>, methods=[<strong class="lm hj">'POST'</strong>])<br/>def<strong class="lm hj"> </strong>event_process():</span><span id="2c8d" class="my lo hi lm b fi nw nr l ns nt">  # Authorization Header (should be validated)<br/>  header = request.headers[<strong class="lm hj">'Authorization'</strong>]</span><span id="3cf2" class="my lo hi lm b fi nw nr l ns nt">  payload = request.get_json()</span><span id="dcf6" class="my lo hi lm b fi nw nr l ns nt">  print(f"Type of event {<strong class="lm hj">payload['Topic']</strong>}").   # file.created<br/>  print(f"Filepath {<strong class="lm hj">payload['Data']['Path']</strong>}"). # myfile.txt<br/>  print(f"Filesize {<strong class="lm hj">payload['Data']['Size']</strong>}"). # 1028</span></pre><h1 id="d959" class="ln lo hi bd lp lq lr ls lt lu lv lw lx io ly ip lz ir ma is mb iu mc iv md me bi translated">摘要</h1><p id="79df" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated">出色的功能:</p><ul class=""><li id="0512" class="mk ml hi jq b jr js ju jv jx mm kb mn kf mo kj mp mq mr ms bi translated">设置再简单不过了:一键创建和配置</li><li id="a46a" class="mk ml hi jq b jr mt ju mu jx mv kb mw kf mx kj mp mq mr ms bi translated">有效和优雅的仪表板:轻松找到您需要的东西和复制凭证</li><li id="b8a2" class="mk ml hi jq b jr mt ju mu jx mv kb mw kf mx kj mp mq mr ms bi translated">webhooks通知:优秀的特性，易于设置和管理(包括分析webhook交付及其JSON负载)</li><li id="c9df" class="mk ml hi jq b jr mt ju mu jx mv kb mw kf mx kj mp mq mr ms bi translated">广泛的安全功能:密码轮换、IP过滤、SSH密钥、多种凭据以实现细粒度的访问控制。</li></ul><p id="24e0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我希望看到的改进:</p><ul class=""><li id="5049" class="mk ml hi jq b jr js ju jv jx mm kb mn kf mo kj mp mq mr ms bi translated">可用的免费层:允许开发者免费开始小项目</li><li id="ac55" class="mk ml hi jq b jr mt ju mu jx mv kb mw kf mx kj mp mq mr ms bi translated">文件更新通知:允许webhooks在现有文件被修改时发出通知</li></ul><h1 id="4df7" class="ln lo hi bd lp lq lr ls lt lu lv lw lx io ly ip lz ir ma is mb iu mc iv md me bi translated">结论</h1><p id="4683" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated">对于需要灵活、可扩展且易于上手的远程文件存储的Heroku应用程序来说,“SFTP随身版”是一个很好的附件。</p><p id="94af" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你可以在我的GitHub知识库中找到文章中显示的代码片段(T4【SFTP】与S3 和<a class="ae jn" href="https://github.com/gcatanese/HerokuFiles/blob/main/app/sftp_to_go_ftp.py" rel="noopener ugc nofollow" target="_blank"> SFTP与FTP </a>)。如有问题和建议，请在<a class="ae jn" href="https://twitter.com/beppecatanese" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上联系我。</p><p id="23bc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下次见。✌️</p></div></div>    
</body>
</html>