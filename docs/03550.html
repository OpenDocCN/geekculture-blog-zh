<html>
<head>
<title>Swift - Write Cleaner Code Using Result Type</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用结果类型编写更干净的代码</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/swift-write-cleaner-code-using-result-type-a9412cecc205?source=collection_archive---------9-----------------------#2021-06-10">https://medium.com/geekculture/swift-write-cleaner-code-using-result-type-a9412cecc205?source=collection_archive---------9-----------------------#2021-06-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="5a75" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">错误处理甚至可以更加简单和易于实现</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/0b805e21df3cabb1df8db624617349ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HZarjiBN-UDhVQWnhNKudw.png"/></div></div></figure><p id="db38" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><a class="ae kf" href="https://developer.apple.com/documentation/swift/result" rel="noopener ugc nofollow" target="_blank">结果类型</a>是作为Swift 5中错误处理的改进而引入的。已经被iOS开发者广泛实现。自从它发布以来，所有第三方库也开始采用它。但是我注意到一些开发人员仍然在使用旧的实现，可能是因为他们已经习惯了很长时间。</p><p id="d996" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在本文中，我们将讨论和修改基本函数和完成方法中结果类型的基本用法。让我们看看没有和有结果类型的实现。</p><h1 id="c98c" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated"><strong class="ak">不使用结果</strong></h1><p id="3193" class="pw-post-body-paragraph jj jk hi jl b jm ky ij jo jp kz im jr js la ju jv jw lb jy jz ka lc kc kd ke hb bi translated">首先，我们将采用一个简单的方法来计算两个数的除法。我们知道数学中的除法法则，除数不能是0，否则答案是不确定的。</p><p id="a4f8" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">因此，我们将添加一个使用<code class="du ld le lf lg b">guard</code>检查除数的验证，如果失败则返回<code class="du ld le lf lg b">nil</code>。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lh li l"/></div></figure><h2 id="8e27" class="lj kh hi bd ki lk ll lm km ln lo lp kq js lq lr ks jw ls lt ku ka lu lv kw lw bi translated">有什么问题？</h2><p id="2af6" class="pw-post-body-paragraph jj jk hi jl b jm ky ij jo jp kz im jr js la ju jv jw lb jy jz ka lc kc kd ke hb bi translated">上面的<code class="du ld le lf lg b">divide()</code>方法看起来很好，直到我们调用它并出错。现在我们发现了问题，并且明白我们不能简单地返回细节错误。</p><h2 id="c63d" class="lj kh hi bd ki lk ll lm km ln lo lp kq js lq lr ks jw ls lt ku ka lu lv kw lw bi translated">可能的解决方案</h2><p id="ee22" class="pw-post-body-paragraph jj jk hi jl b jm ky ij jo jp kz im jr js la ju jv jw lb jy jz ka lc kc kd ke hb bi translated">是的，现在我们会考虑修改方法。我们可以尝试的选择很少。首先，也许我们可以使用一个返回多个值的完成方法，比如答案和错误消息。或者我们可以使用struct或tuple类型来组合答案和错误。</p><p id="c775" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这正是结果类型所做的，尽管它更通用，更容易实现。</p><h1 id="0acc" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">利用结果求解</h1><p id="6a6d" class="pw-post-body-paragraph jj jk hi jl b jm ky ij jo jp kz im jr js la ju jv jw lb jy jz ka lc kc kd ke hb bi translated">基本上是相同的方法，除了返回类型使用了<code class="du ld le lf lg b">Result</code>。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="d68c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">现在我们可以看到，新的<code class="du ld le lf lg b">divide()</code>方法可读性更好、更简单，并且有适当的错误处理。</p><h1 id="5f1b" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">在异步方法中使用结果</h1><p id="4ecd" class="pw-post-body-paragraph jj jk hi jl b jm ky ij jo jp kz im jr js la ju jv jw lb jy jz ka lc kc kd ke hb bi translated">正如我们已经知道的，异步方法需要一个完成处理程序来将结果或值返回给方法调用方。</p><p id="5177" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">常见的API请求方法基本上会有以下步骤。</p><ol class=""><li id="7689" class="lx ly hi jl b jm jn jp jq js lz jw ma ka mb ke mc md me mf bi translated">检查URL验证</li><li id="a80e" class="lx ly hi jl b jm mg jp mh js mi jw mj ka mk ke mc md me mf bi translated">使用URLSession请求URL</li><li id="e658" class="lx ly hi jl b jm mg jp mh js mi jw mj ka mk ke mc md me mf bi translated">然后在数据任务完成内部，我们将处理错误和成功数据</li><li id="02f2" class="lx ly hi jl b jm mg jp mh js mi jw mj ka mk ke mc md me mf bi translated">解码try块中的数据</li></ol><p id="246a" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">让我们看看下面的代码和结果实现。除了完成返回值之外，看起来没什么不同。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="e057" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">下面是我们如何调用方法和处理发生的错误。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lh li l"/></div></figure></div><div class="ab cl ml mm gp mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="hb hc hd he hf"><p id="7df2" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">太好了。我想我们已经完全涵盖了普通函数和完成方法的结果类型实现。我希望每个人都能理解并喜欢这个教程。请确保在您的项目中实现，以便我们可以在开发中应用良好的实践，并使我们的代码更干净。</p><p id="0b61" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">感谢阅读。编码快乐！</p><h1 id="6d73" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">参考</h1><p id="a0b3" class="pw-post-body-paragraph jj jk hi jl b jm ky ij jo jp kz im jr js la ju jv jw lb jy jz ka lc kc kd ke hb bi translated"><a class="ae kf" href="https://developer.apple.com/documentation/swift/result" rel="noopener ugc nofollow" target="_blank">https://developer.apple.com/documentation/swift/result</a></p><p id="57c2" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><a class="ae kf" href="https://developer.apple.com/documentation/swift/result/writing_failable_asynchronous_apis" rel="noopener ugc nofollow" target="_blank">https://developer . apple . com/documentation/swift/result/writing _ fail able _ asynchronous _ APIs</a></p></div></div>    
</body>
</html>