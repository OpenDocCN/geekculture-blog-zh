<html>
<head>
<title>Running Cypress Tests in Docker (Part 9)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Docker中运行Cypress测试(第9部分)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/running-cypress-tests-in-docker-part-9-51f95b2018e0?source=collection_archive---------0-----------------------#2022-03-26">https://medium.com/geekculture/running-cypress-tests-in-docker-part-9-51f95b2018e0?source=collection_archive---------0-----------------------#2022-03-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7a931496e196ee9555077373c461de78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OZyxgFQ_SaTV5yIqL83V0g.png"/></div></div></figure><p id="a48b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">こんにちは·孔尼奇瓦，</p><blockquote class="jo jp jq"><p id="8248" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated"><a class="ae jv" href="https://kushalbhalaik.xyz/blog/building-a-test-automation-framework-using-cypress-io-part-1/" rel="noopener ugc nofollow" target="_blank">本</a>文章系列一直使用Cypress v 5 . 2 . 0；在这一期中，我们将使用Cypress v9.2.0(为什么？稍后我会解释)</p></blockquote><h2 id="da4f" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jb kh ki kj jf kk kl km jj kn ko kp kq bi translated">我们可以通过多种方式利用Docker和Cypress设置，在这篇文章中，我主要关注如何将它与我们正在构建的框架最好地集成，所以不是完全没有偏见。</h2><h1 id="a5f5" class="kr jx hi bd jy ks kt ku kc kv kw kx kg ky kz la kj lb lc ld km le lf lg kp lh bi translated">为什么是Docker？</h1><p id="022d" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">如果你对<a class="ae jv" href="http://docker.com" rel="noopener ugc nofollow" target="_blank"> Docker </a>一窍不通，我建议你看看InfoWorld上的这篇好文章。</p><div class="ln lo ez fb lp lq"><a rel="noopener follow" target="_blank" href="/@zite/so-you-want-to-get-cypress-running-in-docker-7e8fb2837731"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hj fi z dy lv ea eb lw ed ef hh bi translated">你想让赛普拉斯在码头工作？</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">所以，这将是从一个绝对初学者的角度来看，赛普拉斯有很好的文件，但他们认为我有任何想法…</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">medium.com</p></div></div><div class="lz l"><div class="ma l mb mc md lz me io lq"/></div></div></a></div><p id="ad8a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">强调几点:</p><ol class=""><li id="b615" class="mf mg hi is b it iu ix iy jb mh jf mi jj mj jn mk ml mm mn bi translated">Docker能够更有效地利用系统资源</li><li id="7dc1" class="mf mg hi is b it mo ix mp jb mq jf mr jj ms jn mk ml mm mn bi translated">您只需创建一次映像，就可以在本地、ci/cd或任何其他设置中的任何地方运行它</li><li id="b56e" class="mf mg hi is b it mo ix mp jb mq jf mr jj ms jn mk ml mm mn bi translated">有了Cypress，您可以在您的连续测试设置中使用Docker来获得更好的结果</li></ol><p id="3a1f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，在我们开始之前，您也可以看看这篇简短的文章，了解一下它是如何工作的。</p><div class="ln lo ez fb lp lq"><a rel="noopener follow" target="_blank" href="/@zite/so-you-want-to-get-cypress-running-in-docker-7e8fb2837731"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hj fi z dy lv ea eb lw ed ef hh bi translated">你想让赛普拉斯在码头工作？</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">所以，这将是从一个绝对初学者的角度来看，赛普拉斯有很好的文件，但他们认为我有任何想法…</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">medium.com</p></div></div><div class="lz l"><div class="ma l mb mc md lz me io lq"/></div></div></a></div><h1 id="2fdb" class="kr jx hi bd jy ks kt ku kc kv kw kx kg ky kz la kj lb lc ld km le lf lg kp lh bi translated">起初</h1><p id="31cc" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">首先，您可以在这里克隆这个repo <a class="ae jv" href="https://github.com/far11ven/Cypress-TestFramework/tree/develop/Part%2009" rel="noopener ugc nofollow" target="_blank">，并在您的文件夹路径中打开的终端中运行下面的命令</a></p><pre class="mt mu mv mw fd mx my mz na aw nb bi"><span id="1f41" class="jw jx hi my b fi nc nd l ne nf">$ npm install</span></pre><p id="7ecf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将安装所有必需的节点依赖项。</p><blockquote class="jo jp jq"><p id="4b20" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated">我们不会从头开始为这个项目创建docker文件，而是使用<a class="ae jv" href="https://github.com/cypress-io/cypress-docker-images" rel="noopener ugc nofollow" target="_blank"> cypress-docker-images </a>。如果你想探索一下，看看<a class="ae jv" href="https://www.mariedrake.com/post/using-docker-to-run-your-cypress-tests" rel="noopener ugc nofollow" target="_blank">这篇文章</a></p></blockquote><blockquote class="ng"><p id="efe2" class="nh ni hi bd nj nk nl nm nn no np jn dx translated">有三种不同类型的cypress-docker-images[https://github.com/cypress-io/cypress-docker-images ],我们将使用cypress/included，原因很简单——它拥有一切！</p></blockquote><figure class="nr ns nt nu nv ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nq"><img src="../Images/dd377e54c305fcaf29be2f8570f9160c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T_4XjOvaxJmpBc-Kv4wodw.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">cypress-docker-images categories</figcaption></figure><p id="d1b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是链接:<a class="ae jv" href="https://github.com/cypress-io/cypress-docker-images/tree/master/included/9.2.0" rel="noopener ugc nofollow" target="_blank">cypress-docker-images/included/9 . 2 . 0</a></p><p id="5e8e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设你已经在你的机器上安装了Docker，让我们开始运行已经构建好的镜像<a class="ae jv" href="https://github.com/cypress-io/cypress-docker-images/tree/master/included/9.2.0" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">Cypress/included:9 . 2 . 0</strong></a>这也是我们首先将项目升级到<strong class="is hj"> Cypress v9.2.0 </strong>的唯一原因</p><p id="fbeb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在项目位置打开的终端中</p><pre class="mt mu mv mw fd mx my mz na aw nb bi"><span id="0461" class="jw jx hi my b fi nc nd l ne nf">$ docker run -it -v $PWD:/e2e -w /e2e cypress/included:9.2.0</span></pre><p id="bf59" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">或者，如果您像我一样运行windows，那么这个命令稍微修改为:</p><pre class="mt mu mv mw fd mx my mz na aw nb bi"><span id="bcfc" class="jw jx hi my b fi nc nd l ne nf">$ docker run -it -v ${PWD}:/e2e -w /e2e cypress/included:9.2.0</span></pre><p id="64d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该命令分为以下几个参数</p><figure class="mt mu mv mw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es oa"><img src="../Images/107fbe01604f79846a7b4beca8271cf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B2QQhWDkrL3W9fPq80hwew.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">Explanation of the “docker run” command-line arguments:</figcaption></figure><p id="9485" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该命令将通过从<strong class="is hj"> cypress.json </strong>文件中获取测试规范细节来运行一切，结果如下:</p><figure class="mt mu mv mw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ob"><img src="../Images/78ada4f05e074230128179f4b3af9f12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v0PPB55v2pPE89VQPv5KHg.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">Run Results</figcaption></figure><p id="b98e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对刚刚发生的事情做一点解释:</p><blockquote class="jo jp jq"><p id="eae4" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated"><strong class="is hj"> cypress/included:9.2.0 </strong>将入口点设置为["cypress "，" run"]，这相当于在您的本地机器<br/>上运行<strong class="is hj"> npx cypress run </strong>，这在我们的例子中并不那么有用，因为一切都是使用runner.js驱动的，runner . js在内部调用<a class="ae jv" href="https://docs.cypress.io/guides/guides/module-api" rel="noopener ugc nofollow" target="_blank"> Cypress模块API </a>。</p></blockquote><h1 id="f26c" class="kr jx hi bd jy ks kt ku kc kv kw kx kg ky kz la kj lb lc ld km le lf lg kp lh bi translated">保留容器(从容器内运行)</h1><p id="1460" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">每次运行"<strong class="is hj"> docker run" </strong>都会产生一个新的容器。测试完成后，容器停止运行，但是Cypress对此无能为力——是Docker命令"<strong class="is hj"> docker run … </strong>"控制这种行为。</p><p id="316c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您一次又一次地运行大量测试，您可能会使用Bash作为入口点启动容器一次，而不是默认的cypress命令。然后，您可以执行"<strong class="is hj"> cypress run </strong>"或任何其他命令，同时仍然在同一个容器中:</p><p id="c348" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在项目位置打开的终端中</p><pre class="mt mu mv mw fd mx my mz na aw nb bi"><span id="ff41" class="jw jx hi my b fi nc nd l ne nf">PS D:\My____\Workspace\Cypress-TestFramework\Part 09&gt; docker run -it -v ${PWD}:/e2e -w /e2e — entrypoint=/bin/bash cypress/included:9.2.0</span><span id="b024" class="jw jx hi my b fi oc nd l ne nf">root@BE4400671ae7:/e2e#</span></pre><p id="a5c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">进一步检查目录的内容，它与本地机器上的目录相同</p><pre class="mt mu mv mw fd mx my mz na aw nb bi"><span id="27f7" class="jw jx hi my b fi nc nd l ne nf">root@BE4400671ae7:/e2e# ls <br/>cypress cypress.json node_modules package-lock.json package.json reports runner.js</span></pre><p id="6f0a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您可以继续在docker中运行以下命令，它只是命令"<strong class="is hj">node runner . js cypress run—env TAGS = " @ API " config file = QA</strong>"的脚本别名</p><pre class="mt mu mv mw fd mx my mz na aw nb bi"><span id="3fad" class="jw jx hi my b fi nc nd l ne nf">root@c239a1b9c99b:/e2e# npm run cy:test:qa</span></pre><p id="f70f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用入口点<strong class="is hj"> /bin/bash </strong>在Cypress docker容器内执行测试。</p><figure class="mt mu mv mw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es od"><img src="../Images/1f2cec1f70b369529e92230b7e8df6b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qLk4bqrdiI7b3vH55ypW-A.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">Executing tests inside the docker container</figcaption></figure><p id="2ff3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如您所看到的，使用我们的定制脚本，我们只运行了带有@API标签的测试。</p><figure class="mt mu mv mw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es oe"><img src="../Images/74c21ce1868dbc0459ff98b3b24bcdb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NqpvDIr32_k9TQPbrnpQWw.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">Run Result</figcaption></figure><p id="0e5b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦所有的测试完成，结果将存储在原来的映射/e2e文件夹</p><figure class="mt mu mv mw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es of"><img src="../Images/f47ab069f85e4cb1270cedb4a6ea4310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6UfLWP6M7IRpQEo542JA2g.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">Reports Directory</figcaption></figure><h1 id="996d" class="kr jx hi bd jy ks kt ku kc kv kw kx kg ky kz la kj lb lc ld km le lf lg kp lh bi translated">结束语:</h1><p id="f286" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">在本文中，我们只看到了如何在Docker容器中从Cypress-TestFramework运行Cypress测试。我们如何在ci/cd中实际利用这一点，我们将在下一篇文章“<a class="ae jv" href="https://kushalbhalaik.medium.com/running-cypress-tests-in-github-actions-part-10-8a3d406668bc" rel="noopener">在Github Actions中运行Cypress测试(第10部分)</a>”中深入探讨。</p><p id="7893" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">免得读者抱怨；我没有涉及Docker的许多不同方面，比如构建自定义图像并将它们放入Docker registry(比如DockerHub ),我可能会在将来深入研究。</p><p id="b412" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">(编辑:你可以阅读<a class="ae jv" href="https://kushalbhalaik.xyz/blog/building-custom-docker-images-from-cypress-included/" rel="noopener ugc nofollow" target="_blank">这篇文章</a>了解更多信息)</p><p id="4660" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">さよなら再见</p><p id="a54e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">有用链接:</strong></p><div class="ln lo ez fb lp lq"><a href="https://glebbahmutov.com/blog/run-cypress-included-from-docker-container/" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hj fi z dy lv ea eb lw ed ef hh bi translated">运行码头集装箱中包含的Cypress</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">如何使用运行在Docker容器中的Cypress测试运行在本地主机上的web应用程序</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">glebbahmutov.com</p></div></div></div></a></div><div class="ln lo ez fb lp lq"><a href="https://docs.cypress.io/examples/examples/docker#Examples" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hj fi z dy lv ea eb lw ed ef hh bi translated">Docker | Cypress文档</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">https://github.com/cypress-io/cypress-docker-images这个回购持有本地运行赛普拉斯的各种码头图像…</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">docs.cypress.io</p></div></div><div class="lz l"><div class="og l mb mc md lz me io lq"/></div></div></a></div><div class="ln lo ez fb lp lq"><a href="https://www.cypress.io/blog/2019/05/02/run-cypress-with-a-single-docker-command/" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hj fi z dy lv ea eb lw ed ef hh bi translated">用一个Docker命令运行Cypress</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">如果你是Node.js开发人员，在你的package.json文件中安装Cypress作为一个开发依赖项，甚至通过直接…</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">www.cypress.io</p></div></div><div class="lz l"><div class="oh l mb mc md lz me io lq"/></div></div></a></div><blockquote class="jo jp jq"><p id="4e92" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated">Github代码:</p><p id="b270" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated"><a class="ae jv" href="https://github.com/far11ven/Cypress-TestFramework/tree/develop/Part%2009" rel="noopener ugc nofollow" target="_blank">https://github . com/far 11 ven/Cypress-test framework/tree/develop/Part 09</a></p></blockquote><p id="4467" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jr">最初发布于</em><a class="ae jv" href="https://kushalbhalaik.xyz/blog/running-cypress-tests-in-docker-part-9/" rel="noopener ugc nofollow" target="_blank">https://kushalbhalaik . XYZ</a></p></div></div>    
</body>
</html>