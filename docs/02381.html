<html>
<head>
<title>Avoid CI/CD Lock-in — Make Your Builds More Portable</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">避免CI/CD锁定—使您的构建更加可移植</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/avoid-ci-cd-lock-in-make-your-builds-more-portable-2d616e349185?source=collection_archive---------11-----------------------#2021-05-13">https://medium.com/geekculture/avoid-ci-cd-lock-in-make-your-builds-more-portable-2d616e349185?source=collection_archive---------11-----------------------#2021-05-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/bbca5c5530726e6b86eb27831985db47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HqhEfBWiQ9FY8TIL0LahFQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Our Gitlabs pipeline.</figcaption></figure><div class=""/><p id="1639" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们最近将Android CI/CD管道从Bitbucket/Bamboo迁移到了Gitlabs。如果你关注我的博客，这是我们在今年的<a class="ae js" href="https://proandroiddev.com/our-engineering-roadmap-1231dc5812" rel="noopener ugc nofollow" target="_blank">工程路线图</a>中计划要做的事情。这些CI/CD产品各有利弊，真正的问题不是哪个产品更好，而是当企业决定更换产品时，如何使迁移更容易。即使您没有使用Bitbucket/Bamboo或Gitlabs，遵循本文中概述的原则应该可以最大限度地减少将来迁移CI/CD的潜在工作量。在此之前，让我们看一下您的CI/CD的3个关键功能。</p><ol class=""><li id="2444" class="jt ju hx iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">scheduler——这允许您创建每日、每夜或每周的构建，等等。</li><li id="2397" class="jt ju hx iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">触发器—确定构建作业的启动方式。这通常是通过将代码推送到存储库来自动完成的，或者是通过按下UI中的按钮来手动完成的。</li><li id="d916" class="jt ju hx iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">orchestrator——如何组织不同的构建作业以形成管道。</li></ol><p id="581b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您记住了这一点，那么应该可以更容易地决定在哪里以及如何配置您的CI/CD。如果您在CI/CD中添加了额外的内容，请考虑将其移动到更合适的位置。</p><p id="68ca" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里有一些简单的技巧来帮助提高你的构建的可移植性；</p><ol class=""><li id="b6fa" class="jt ju hx iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">将构建脚本保存在代码库中。这意味着您可以轻松地跟踪变更，并在不影响其他分支的情况下变更您的构建。</li></ol><figure class="ki kj kk kl fd hk er es paragraph-image"><div class="er es kh"><img src="../Images/a5573be069bf65487ba96dcb101f6787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*WthiCZetHHRM-gU_ctw6DA.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">Directories in the repo.</figcaption></figure><p id="1b85" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">2.把你的Gradle命令放到一个shell脚本中。这意味着多个Gradle命令可以通过一个脚本轻松执行，并且很容易维护您的构建中使用的参数。一个格式良好的shell脚本在像Android Studio这样的编辑器中比在CI/CD的UI中更容易阅读。</p><figure class="ki kj kk kl fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es km"><img src="../Images/4e8b81330bcefa18ff21c52503e2c8fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VrqGuy4uVcLdZ3FI2Tyvlw.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">The mpc_ci_run.sh script to execute our build.</figcaption></figure><p id="c2a2" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">3.尽可能使用Gradle插件而不是CI/CD插件。所有Gradle命令可以在任何地方执行，但是CI/CD插件只能在您的CI/CD管道上执行。如果您没有使用Gradle，这也适用于任何其他构建技术，例如您可能正在使用的Maven。最受欢迎的CI/CD服务器之一拥有超过<a class="ae js" href="https://plugins.jenkins.io/" rel="noopener ugc nofollow" target="_blank"> 1500个插件</a>！</p><p id="4846" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">4.使用容器——它们确保你的构建是可移植的和可复制的，几乎所有的现代CI/CD解决方案都使用它们。</p><p id="8420" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">5.最小化CI/CD中的配置。如果您使用单个shell脚本(或最少数量的脚本)来执行每个构建工作，那么事情就会变得简单且易于维护。这意味着您的CI/CD配置中的配置应该很少改变。</p><figure class="ki kj kk kl fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kn"><img src="../Images/b8be65bf57ea77c5c79b3e9ab2704888.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E7-__DJgJn4v-dGOnmAKHA.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Our .gitlab-ci.yml file.</figcaption></figure><p id="c053" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们从Bitbucket/Bamboo的迁移轻而易举，令人惊讶的是，我们的Gitlab YAML文件不超过106行。我希望这些简单的提示对你有用，请继续关注。</p><p id="5aa6" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">注意:我不像以前那样写很多文章，主要原因是远程工作。我过去常常花大部分通勤时间写文章来打发时间，但现在不再这样了。也许当我们回到办公室的时候，你会看到更多的文章！</p></div></div>    
</body>
</html>