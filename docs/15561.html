<html>
<head>
<title>How to Run a Script as a Service in Linux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Linux中将脚本作为服务运行</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-run-a-script-as-a-service-in-linux-4fb92cab6818?source=collection_archive---------7-----------------------#2022-11-08">https://medium.com/geekculture/how-to-run-a-script-as-a-service-in-linux-4fb92cab6818?source=collection_archive---------7-----------------------#2022-11-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="239c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将NodeJS应用作为服务运行</p><blockquote class="jd je jf"><p id="5cc1" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">系统服务简介</p></blockquote><p id="6934" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Systemd是一个软件套件，它为Linux操作系统提供了一系列系统组件。它的主要目标是<strong class="ih hj">统一跨Linux发行版的服务配置和行为</strong>；“系统和服务管理器”是其主要组件。</p><p id="d295" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它是第一个初始化引导序列的服务，并且始终以PID 1运行。</p><ul class=""><li id="3de9" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc jp jq jr js bi translated"><strong class="ih hj"> init.d </strong>系统是Linux在启动时启动所有预期运行的服务和单元的第一个系统</li><li id="bf86" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc jp jq jr js bi translated">较新的Linux系统已经切换到system.d来提供服务</li></ul><p id="5f60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有几个<strong class="ih hj">系统的用例示例:</strong></p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="be7f" class="kh ki hi kd b fi kj kk l kl km"># swithc to root:<br/>sudo su -</span><span id="daad" class="kh ki hi kd b fi kn kk l kl km"># list all the services<br/>systemctl --type=service</span><span id="b09b" class="kh ki hi kd b fi kn kk l kl km"># start, stop and status of check tomcat service<br/>systemctl status tomcat<br/>systemctl stop tomcat<br/>systemctl start tomcat</span><span id="20ea" class="kh ki hi kd b fi kn kk l kl km">-----------------------</span><span id="4bb0" class="kh ki hi kd b fi kn kk l kl km"># list all the services<br/>service --status-all</span><span id="66fa" class="kh ki hi kd b fi kn kk l kl km"># start, stop and status of check tomcat service<br/>service tomcat status<br/>service tomcat stop<br/>service tomcat start</span></pre><p id="5b2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Systemd服务还可以运行自定义脚本，这些脚本在系统启动时启动，并继续在后台运行。因此，在本文中，我们将设置一个脚本，在Linux服务器上运行NodeJS应用程序，作为服务运行。</p><figure class="jy jz ka kb fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ko"><img src="../Images/7991d96a7a630c100bcb5a2d45c87ba5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xtQuif52HPTXID_hxqT_KQ.jpeg"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx">Image soruce: <a class="ae la" href="https://itsfoss.com/start-stop-restart-services-linux/" rel="noopener ugc nofollow" target="_blank">itsfoss.com</a></figcaption></figure></div><div class="ab cl lb lc gp ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="hb hc hd he hf"><h2 id="9144" class="kh ki hi bd li lj lk ll lm ln lo lp lq iq lr ls lt iu lu lv lw iy lx ly lz ma bi translated">在后台运行NodeJS应用程序</h2><p id="f420" class="pw-post-body-paragraph if ig hi ih b ii mb ik il im mc io ip iq md is it iu me iw ix iy mf ja jb jc hb bi translated">因此，在我们设置脚本之前，先简单回顾一下上下文。传统上，我们使用以下代码运行NodeJS应用程序:</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="3b81" class="kh ki hi kd b fi kj kk l kl km"># using NPM<br/>npm run start</span><span id="221d" class="kh ki hi kd b fi kn kk l kl km">#using node<br/>node your_app.js</span></pre><p id="d5c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种运行方式有两个局限性:</p><ul class=""><li id="bd65" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc jp jq jr js bi translated">不能在终端外运行或在您注销后运行</li><li id="79e7" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc jp jq jr js bi translated">您不能在同一个终端会话中运行多个应用程序</li></ul><p id="d543" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用进程管理器在后台运行一个或多个NodeJS应用程序，甚至在您退出Linux服务器之后。PM2是最新的NodeJS进程管理器之一，内置了负载均衡器。</p><blockquote class="jd je jf"><p id="5776" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated"><strong class="ih hj">对于本文的上下文，我已经使用PM2 </strong>运行了NodeJS应用程序和设置</p></blockquote><p id="304c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个我将用来运行我的NodeJS应用程序的脚本示例:</p><figure class="jy jz ka kb fd kp"><div class="bz dy l di"><div class="mg mh l"/></div></figure><h1 id="9d12" class="mi ki hi bd li mj mk ml lm mm mn mo lq mp mq mr lt ms mt mu lw mv mw mx lz my bi translated">将Node.js应用程序作为服务启动</h1><p id="7c3b" class="pw-post-body-paragraph if ig hi ih b ii mb ik il im mc io ip iq md is it iu me iw ix iy mf ja jb jc hb bi translated">要设置脚本将NodeJS应用程序作为服务运行，请执行以下步骤:</p><p id="0509" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj"> init.d </strong>目录中复制或创建您的脚本:</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="0117" class="kh ki hi kd b fi kj kk l kl km">sudo su -<br/>cd /etc/init.d<br/>cp /location_of_myAppexec /etc/init.d</span><span id="93ee" class="kh ki hi kd b fi kn kk l kl km"># make sure your script is excutable<br/>chmod +x myAppexec</span></pre><p id="3028" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，通过在rc3.d和rc5.d中创建符号链接，将该脚本复制到RC文件中:</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="55fb" class="kh ki hi kd b fi kj kk l kl km">ln -s /etc/init.d/myAppexec /etc/rc3.d/myAppexec<br/>ln -s /etc/init.d/myAppexec /etc/rc5.d/myAppexec</span></pre><blockquote class="jd je jf"><p id="a2f5" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">注意:</p><p id="a45b" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">综上，rc。d代表运行级别的“<strong class="ih hj">运行命令</strong>”，这是它们的实际用法。</p><p id="4304" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">rc1.d到rc3.d <strong class="ih hj">当系统改变运行级别</strong>时运行的脚本。运行级别1通常是单用户模式，运行级别2是多用户模式</p><p id="291e" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">rc3。d用于<strong class="ih hj">运行级别3 </strong>。所有这些目录都包含可执行脚本，这些脚本必须在Linux操作系统启动时启动。正如你所看到的，所有的脚本都是指向其他目录中的原始脚本的软链接</p></blockquote><p id="a61f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以通过运行以下两个命令来启动、重启、停止和检查NodeJS应用程序作为服务的状态或日志:</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="7e75" class="kh ki hi kd b fi kj kk l kl km"># you can run on CI Tool like Jenkins when building and deploying<br/># new change and assure that your applicate is restartert with the  # fresh code while still running in the background</span><span id="0c90" class="kh ki hi kd b fi kn kk l kl km">/etc/init.d/myAppexec start</span><span id="6731" class="kh ki hi kd b fi kn kk l kl km"># or on the server, you can check various state of your app <br/># by simply run the following commands:</span><span id="f0b9" class="kh ki hi kd b fi kn kk l kl km">service myAppexec status<br/>service myAppexec restart<br/>service myAppexec log<br/>service myAppexec stop<br/>service myAppexec start</span></pre><blockquote class="jd je jf"><p id="19df" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">如果你喜欢这篇文章，你可能也会喜欢；<a class="ae la" rel="noopener" href="/dev-genius/cron-logrotate-how-to-use-cron-to-automate-tasks-a93069d9185c"> Cron &amp; logrotate:如何使用Cron自动化任务</a></p></blockquote><blockquote class="mz"><p id="8821" class="na nb hi bd nc nd ne nf ng nh ni jc dx translated">干杯！！！</p></blockquote></div></div>    
</body>
</html>