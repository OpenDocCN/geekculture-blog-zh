<html>
<head>
<title>Where TypeScript Will Fail You</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TypeScript会让你失望的地方</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/where-typescript-will-fail-you-214e3d5e0538?source=collection_archive---------59-----------------------#2021-06-07">https://medium.com/geekculture/where-typescript-will-fail-you-214e3d5e0538?source=collection_archive---------59-----------------------#2021-06-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e2cfec9e1ddd34c8bd91620a58d287f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vedddwfKmg0DQkXm"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@gavla?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Gavin Allanwood</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="aac3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">TypeScript很棒。几年前，当我开始一个新项目时，我做了这个改变。从那以后我再也没有回头。我对我生成的代码更有信心，它将(大部分)按照我的预期工作。有时候，这种自信会反咬我一口。</p><p id="18c2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">今天，我给我们现有的一个<code class="du jt ju jv jw b">clearFilters</code>功能添加了一些功能。它看起来像这样:</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="cbd8" class="kf kg hi jw b fi kh ki l kj kk">const [activeFilters, setActiveFilters] = useState&lt;Filter[]&gt;(initialFilters)</span><span id="eaea" class="kf kg hi jw b fi kl ki l kj kk">const clearFilters = () =&gt; {<br/>   setActiveFilters([])<br/>}</span></pre><p id="8a07" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">很简单。我们有一个过滤系统，这个可以重置过滤器。它用在我们的<code class="du jt ju jv jw b">Filters</code>组件中，也作为一个共享函数，所以我们可以在需要的时候清除<code class="du jt ju jv jw b">Filters</code>组件之外的过滤器。</p><p id="1341" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<code class="du jt ju jv jw b">Filters</code>中，看起来是这样的:</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="ad55" class="kf kg hi jw b fi kh ki l kj kk">interface Props {<br/>  filters: Filter[]<br/>  clearFilters: () =&gt; void<br/>}</span><span id="56ab" class="kf kg hi jw b fi kl ki l kj kk">const Filters: React.FC&lt;Props&gt; = ({<br/>  return (<br/>    &lt;div&gt;<br/>      ... the filters</span><span id="e6bf" class="kf kg hi jw b fi kl ki l kj kk">      &lt;button<br/>        onClick={clearFilters}<br/>      &gt;<br/>        Clear All<br/>      &lt;/button&gt;<br/>    &lt;/div&gt;<br/>  )<br/>})</span></pre><p id="b122" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">同样，非常简单。单击<code class="du jt ju jv jw b">Clear All</code>按钮清除所有过滤器，这将触发对更高级组件中API的新查询。如果我想让它变得更复杂呢？我希望能够清除所有的过滤器<strong class="ix hj">，除了我想保留的几个</strong>。</p><p id="d735" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">太好了！让我们更新我们的<code class="du jt ju jv jw b">clearFilters</code>功能</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="61f6" class="kf kg hi jw b fi kh ki l kj kk">const clearFilters = (except?: FilterType[]) =&gt; {<br/>  if(except){<br/>    setActiveFilters(activeFilters.filter((f) =&gt; except.includes(f.type))  <br/>  } else {<br/>    setActiveFilters([])<br/>  }<br/>}</span></pre><p id="a6e6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们已经更新了图书馆。一切编译。没有类型脚本错误！万岁！把它推到戳！</p><h1 id="44d5" class="km kg hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">除...之外</h1><figure class="jx jy jz ka fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/87c035ed3c34f77ff5c6ac4270369c7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*puUYRYqNU5nQjD1f"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@csbphotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Conor Samuel</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><blockquote class="lk ll lm"><p id="83d1" class="iv iw ln ix b iy iz ja jb jc jd je jf lo jh ji jj lp jl jm jn lq jp jq jr js hb bi translated">每次我试图清除过滤器时，都会得到一个异常，说<code class="du jt ju jv jw b">except.includes</code>不是一个函数！什么什么？！</p></blockquote><p id="7702" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我想我真的用这个错误战胜了TypeScript。原来，这是一个非常简单的错误。但是就像所有的错误一样，一旦你想通了，事情就简单了。</p><h2 id="c7ec" class="kf kg hi bd kn lr ls lt kr lu lv lw kv jg lx ly kz jk lz ma ld jo mb mc lh md bi translated">我的(简单？)错误</h2><p id="1044" class="pw-post-body-paragraph iv iw hi ix b iy me ja jb jc mf je jf jg mg ji jj jk mh jm jn jo mi jq jr js hb bi translated">我们再来看看<code class="du jt ju jv jw b">Filters</code>。</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="ecb9" class="kf kg hi jw b fi kh ki l kj kk">interface Props {<br/>  filters: Filter[]<br/>  clearFilters: () =&gt; void<br/>}</span><span id="8c44" class="kf kg hi jw b fi kl ki l kj kk">const Filters: React.FC&lt;Props&gt; = ({<br/>  return (<br/>    &lt;div&gt;<br/>      ... the filters</span><span id="958d" class="kf kg hi jw b fi kl ki l kj kk">      &lt;button<br/>        onClick={clearFilters}<br/>      &gt;<br/>        Clear All<br/>      &lt;/button&gt;<br/>    &lt;/div&gt;<br/>  )<br/>})</span></pre><p id="5522" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">看到了吗？我的道具不再有效。我需要更新它们来反映新的<code class="du jt ju jv jw b">clearFilters</code>功能。</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="d13e" class="kf kg hi jw b fi kh ki l kj kk">interface Props {<br/>  filters: Filter[]<br/>  clearFilters: (except?: FilterType[]) =&gt; void<br/>}</span></pre><p id="601d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦我这样做了，我的<code class="du jt ju jv jw b">onClick={clearFilters}</code>行将抛出一个TypeScript编译错误。类型不匹配！<strong class="ix hj">将onClick设置为不带任何参数的函数意味着来自单击的鼠标事件将被传递给该函数。</strong></p><p id="9340" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了解决这个问题，我们做了另一个小小的更新:</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="4ab2" class="kf kg hi jw b fi kh ki l kj kk">&lt;button onClick={() =&gt; clearFilters()}&gt;All Clear&lt;/button&gt;</span></pre><p id="9b51" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们实际上都是在明确的，一切都在工作，因为它应该！</p><h2 id="ef01" class="kf kg hi bd kn lr ls lt kr lu lv lw kv jg lx ly kz jk lz ma ld jo mb mc lh md bi translated">经验教训</h2><ol class=""><li id="c847" class="mj mk hi ix b iy me jc mf jg ml jk mm jo mn js mo mp mq mr bi translated"><strong class="ix hj">将函数作为道具传递时，更新函数时更新类型</strong></li></ol><p id="4ac4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">TypeScript很棒，但是它只会做我让它做的事情。如果我直接导入了<code class="du jt ju jv jw b">clearFilters</code>函数，这里就不会有问题了。因为我把它作为参数传入，所以我需要确保prop类型与我传入的函数相匹配。</p><p id="2a67" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.<strong class="ix hj">编写自动化测试</strong></p><p id="07ef" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这种情况下，我的错误被构建服务器上的Cypress测试捕获。如果不是这样，很可能这些代码已经发布到产品中，而没有人意识到它被破坏了。这些自动化测试防止了大麻烦，尤其是在周五晚些时候的部署之前。</p></div><div class="ab cl ms mt gp mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="hb hc hd he hf"><p id="11ea" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">希望我的错误能让你在将来免于一些！在TypeScript中，您在哪里遇到过与您预期不同的事情？一路走来，你学到了什么教训？</p></div></div>    
</body>
</html>