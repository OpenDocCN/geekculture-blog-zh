<html>
<head>
<title>Displaying Altair Charts in Power BI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Power BI中显示牛郎星图表</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/displaying-altair-charts-in-power-bi-4673e0f80291?source=collection_archive---------3-----------------------#2021-02-17">https://medium.com/geekculture/displaying-altair-charts-in-power-bi-4673e0f80291?source=collection_archive---------3-----------------------#2021-02-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3b56" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">可视化与DAX的破折号和Python牛郎星胡椒</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/675a4ab3c1855b5c8558c0116d9279ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ICmWveiP0LjlaRDDOjmbCQ.png"/></div></div></figure><h2 id="fc16" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">方案</h2><p id="9be4" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">创建一个散点图，显示电视转播活动期间从观众推文中收集的表情符号的使用百分比。该数据集由表情符号(十进制表示)以及收集的推文中前十个表情符号的使用百分比组成。大多数表情符号只有一个Unicode和十进制表示，然而有一个是爱尔兰国旗表情符号，它是两个Unicode字符的串联。</p><p id="b0ae" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">为什么我没有在Power BI中使用标准或自定义散点图？我在Power BI中到处寻找散点图，该散点图将显示定量变量的值(作为文本)与分类变量(如这些表情符号)的关系，但找不到，因此决定在Power BI中使用Python库。如果你，作为读者，知道一个定制的可视化提供了这个功能，请评论。</p><h2 id="fc13" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">安装</strong></h2><p id="2eb4" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated"><strong class="kj hj"> Python库及其依赖</strong><br/>T5】Matplotlib<br/><a class="ae lf" href="https://altair-viz.github.io/getting_started/installation.html" rel="noopener ugc nofollow" target="_blank">牛郎星</a> <br/> <a class="ae lf" href="https://pypi.org/project/altair-saver/" rel="noopener ugc nofollow" target="_blank">牛郎星_保存</a></p><p id="7a00" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated"><strong class="kj hj">镀铬驱动<br/> 1。</strong>此处从<a class="ae lf" href="https://chromedriver.chromium.org/downloads/version-selection" rel="noopener ugc nofollow" target="_blank"> <strong class="kj hj">下载Chromedriver。</strong></a>我下载了一个与我的Chrome浏览器版本兼容的版本。<br/> 2。将可执行文件存储在一个目录中，比如C:\chromedriver_win32 <br/> 3。在系统环境PATH变量中设置Chrome驱动程序可执行文件的目录。</p><p id="dd83" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">您也可以在这里找到驱动程序和安装说明以及设置<a class="ae lf" href="https://github.com/mohaali/PowerBIExamples/tree/master/Python%20blog%20post%201%20-%20A%20new%20hope" rel="noopener ugc nofollow" target="_blank"> <strong class="kj hj">。</strong> </a> <strong class="kj hj"> </strong>报告的入门页面包含有关驱动程序和路径设置的必要信息。</p><h2 id="c142" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">数据集</strong></h2><ol class=""><li id="7958" class="lg lh hi kj b kk kl kn ko ju li jy lj kc lk kz ll lm ln lo bi translated">该数据集是使用Create table使用表情符号第1列中表情符号的十进制值创建的。那么，表情符号Col 2是怎么回事呢？嗯，有一些表情符号，如爱尔兰国旗表情符号“IE”，它由两个unicode字符组成，其十进制表示可以在下面的第七行看到。该查询被命名为“表情表”</li></ol><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lp"><img src="../Images/3ff106acac4e08c0dcc0a0f2353976d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ISNxv-tttotYSeqhwzgzg.png"/></div></div></figure><p id="9fce" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">2.使用DAX函数创建计算列，将十进制表示转换为表情符号，以便在轴上显示。使用UNICHAR(DAX函数)将十进制表情值转换为表情图像。当您有两个十进制表示时，使用&amp;来连接unicode。这将从爱尔兰表情符号中的I和E创建一个单一的表情符号。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lq"><img src="../Images/6cf0a9be80d21526faa14abc004aac32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7YeJwi2ZApnnNDfWJ1p60g.png"/></div></div></figure><h2 id="11bc" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">双原生散点图</h2><p id="08b7" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">Power BI的散点图确实支持表情符号和使用百分比的显示，但它似乎不支持标记旁边的值的显示(根据Power BI社区回复)。定制的视觉效果并没有表现出我所尝试的任务的本质。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lr"><img src="../Images/7c3b0a992637660e9d04e6fe2b1fff80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-gNSLxHBVlFv_K6wNmdmIQ.png"/></div></div></figure><h2 id="c037" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">Python可视化</h2><ol class=""><li id="cbdf" class="lg lh hi kj b kk kl kn ko ju li jy lj kc lk kz ll lm ln lo bi translated">要在Power BI中启用Python可视化，请在窗格中选择Py可视化。您还将“启用”脚本可视化，以允许执行Python脚本。</li></ol><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ls"><img src="../Images/b611957b7f6279f1dd4b5a0f0f6a1e61.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*_1YrWKebQQck8fXeLFVv3g.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx"><strong class="bd jl">Py visualization</strong></figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lx"><img src="../Images/a3194a8294727da0f111775b3c65ceb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ot0zBcK8YjB5n-AlUzb5Jw.png"/></div></div></figure><p id="7e56" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">这将在屏幕底部弹出一个窗口，提示如下:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ly"><img src="../Images/d34474ca9a605acd91ac9701b8eca483.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lFFoA69GD9HBlQ74Ga-a3g.png"/></div></div></figure><p id="da9c" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">2.将用于可视化的字段放入值池中。这些查询列现在可以在我们接下来要编写的Python脚本中使用了。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lz"><img src="../Images/9515ae5ed6fb8a228592403e1d17156d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*WmiRE-dNIlpmKCE-jOBrLA.gif"/></div></div></figure><h2 id="dfb1" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">代码</strong></h2><p id="3bc8" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">现在我们有了中的值，Python脚本编辑器将在Power BI称为“数据集”的数据帧中包含表情表查询。在下面的代码块中，您将看到注释掉的行，这些行是对开发人员开始编写代码的初始提示。</p><p id="0365" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">Altair支持使用图形语法构建可视化。因此，编码时的思维过程遵循数据集中数据的定义。例如，我们将使用位置沿着x轴展开分类的“名义”值表情图像，然后沿着Y轴指定数量值。</p><p id="d6ab" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated"><strong class="kj hj"> MARK_CIRCLE <br/> </strong>我们在本文中选择的“MARK”用于描绘使用率百分比的值是圆圈。</p><p id="af1a" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated"><strong class="kj hj"> X轴</strong> <br/>为了理顺图像，我们将labelAngle设置为0。<br/>要控制表情符号的大小，将labelFontSize设置为30。</p><p id="7066" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated"><strong class="kj hj"> Y轴<br/> </strong>在alt.Axis内用一个十进制数字和一个百分号格式化刻度标签。<br/>用titleFontSize和labelFontSize控制标题和标签大小。</p><p id="617d" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated"><strong class="kj hj">我们将用三种编码尺寸、颜色和文本来表示使用百分比值。</strong></p><p id="8a32" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated"><strong class="kj hj">尺寸</strong> <br/>当我们在编码中使用尺寸参数时，域和范围将使用百分比的值映射到标记最小和最大尺寸的比例范围。<br/> <strong class="kj hj">注</strong>:为了进一步了解尺度，<a class="ae lf" href="https://www.d3indepth.com/scales/" rel="noopener ugc nofollow" target="_blank">这篇文章</a>将会有所帮助</p><p id="a910" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated"><strong class="kj hj">颜色<br/> </strong>为了给使用百分比值添加另一种编码，我们使用了一种色标，这种色标类似于尺寸色标，将使用百分比值转换成范围颜色的色标。</p><p id="6c5e" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated"><strong class="kj hj"> Text (mark_text) <br/> </strong>最后我们给圆圈标记添加一个显式文本。因为我们提供的调整圆大小的比例也会调整它们旁边的文本，所以我们将覆盖此行为，用alt保持不变的文本大小。SizeValue(20)。<br/>该文本将在散点图上“分层”, Altair中的“+”操作符用于分层。</p><p id="3d8d" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated"><strong class="kj hj">在Power BI内部显示牛郎星图表<br/> </strong>牛郎星图表可以被捕获到一个变量中，如(plot+text)，然后可以通过调用show() <br/> (plot + text)来显示。show() <br/>这将打开一个新的浏览器窗口，其中显示可视化效果。</p><p id="760a" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">但是我们希望在Power BI中显示Altair生成的HTML。为此，我们将该图像保存为。PNG文件，并使用matplotlib的图像库来读取。PNG并展示出来。<br/>HTML将在Chrome驱动程序的帮助下显示在Power BI中。一定要确保在你的PATH变量(系统环境)中设置chrome驱动可执行文件的文件夹。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ma mb l"/></div></figure><h2 id="4ce6" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">运行代码</h2><p id="88da" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated"><strong class="kj hj">注意</strong>:点击执行后，可能需要几秒钟才能渲染图像。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mc"><img src="../Images/5571b13bd279c27f56b872a6383e7fb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*xTyOnR6GgUSx0VWfyaSwqg.gif"/></div></div></figure><h2 id="a09f" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">限制</h2><p id="9d78" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">失去互动性。由于图像是作为静态文件存储并加载显示的，Altair的交互能力不能传递给用户。</p><p id="cdde" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated"><strong class="kj hj">最后:<br/> </strong>你可以通过沿X轴排列表情符号来提高可视化效果。网格线怎么样？你能想到其他的改进吗？</p><p id="c162" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">评论和反馈在这里表达你的想法…</p></div></div>    
</body>
</html>