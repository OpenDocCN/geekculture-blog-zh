<html>
<head>
<title>How to automate a quick data report with shell scripting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用shell脚本自动生成快速数据报告</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-automatize-a-quick-data-report-with-shell-scripting-960bf18d95cd?source=collection_archive---------8-----------------------#2022-04-27">https://medium.com/geekculture/how-to-automatize-a-quick-data-report-with-shell-scripting-960bf18d95cd?source=collection_archive---------8-----------------------#2022-04-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/aea93f9f862e8e1ddf6fd93e6dd5b7da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9pyE-01rSVSc7Zsj"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@6heinz3r?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Gabriel Heinzer</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="bf1f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当我们的涉众需要经常看到我们的分析结果时，时间是宝贵的。因此，将任务自动化以节省我们的时间和精力是很重要的。如你所知，在深度分析和令人惊叹的可视化方面，有很多技术、编程语言和库可以创建。但是，当我们需要快速获得结果，进行演示或做出决定时，会发生什么呢？稍后我们会做一个难忘的EDA。</p><p id="1e41" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated">如果你想做到这一点，地狱脚本是一个好主意。使用<em class="kc"> bash、awk、sed </em>和<em class="kc">正则表达式</em>，我们可以对数据集进行初步分析，进行基本(或高级)特征工程，计算一些统计数据，并在静态<em class="kc"> html </em>文件中显示结果，例如，以一种快速的方式，无需安装任何额外的软件。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="3f37" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">请动手:健康问题</strong></h1><p id="b193" class="pw-post-body-paragraph iv iw hi ix b iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js hb bi translated">我不得不承认，在我发现shell的强大功能之前，它对我来说是一个黑洞。现在我尽可能多地使用它。</p><p id="74c2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了向您展示如何只用<strong class="ix hj"> shell脚本</strong>创建<strong class="ix hj">快速ETL管道</strong>，我选择了<a class="ae iu" href="https://www.kaggle.com/datasets/fedesoriano/heart-failure-prediction" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">心力衰竭预测Kaggle数据集</strong> </a>。在这本书里，我们有11个预测男性和女性心脏病事件的临床特征，我们将用它来发现两性之间的差异。目标是向您呈现一个静态报告，向您显示最终结果。</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/74a77228a7d4fb3869cb617756b288f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IY7nT_SbgFQrAMt-7OTG6g.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx"><a class="ae iu" href="https://www.kaggle.com/datasets/fedesoriano/heart-failure-prediction" rel="noopener ugc nofollow" target="_blank"><strong class="bd km">Heart Failure Prediction Kaggle dataset</strong></a></figcaption></figure><p id="1ac9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated"><span class="l ju jv jw bm jx jy jz ka kb di"> F </span>首先，我开发了一个简单的<em class="kc"> info.sh </em>文件来<strong class="ix hj">提取</strong>我们的数据并显示基本信息，如行数和列数，以及列名；如果我们添加-v参数:<em class="kc">info . sh</em><strong class="ix hj"><em class="kc">-v</em></strong>我们将看到更多关于数据集文件的详细信息，比如我们系统中的下载URL和文件格式元数据。</p><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="ls lt l"/></div><figcaption class="iq ir et er es is it bd b be z dx"><strong class="ak">info.sh -v file</strong></figcaption></figure><p id="7fe1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将使用-v参数查看详细的文件元数据信息:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/5b85d992a44c0da1bb6563e3d60a3b0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g2fc-wUA1DxgxUzgijdUcg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx"><strong class="bd km">File information in detail with -v argument</strong></figcaption></figure></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="4a9b" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">数据理解过程</h1><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/c981cc8af391782809bae5d3551590e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*v_EvLQqA55U4mJbS"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@swimstaralex?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Alexander Sinn</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3423" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated">下一步是理解我们的数据并对其进行预处理，以创建两个干净的按性别分类的csv文件。我使用了流编辑器<em class="kc"> sed </em>以便通过人类可读的表达式来翻译首字母缩写列名，最后，在完成所有转换后，我使用<strong class="ix hj">正则表达式</strong><em class="kc">(grep)</em>:<em class="kc">heart _ women . CSV</em>和<em class="kc"> heart_men.csv </em>创建了两个不同的数据集。</p><pre class="lo lp lq lr fd lw lx ly lz aw ma bi"><span id="53ef" class="mb kl hi lx b fi mc md l me mf"># Rename acronyms by human readable expressions with sed</span><span id="a1c0" class="mb kl hi lx b fi mg md l me mf"><strong class="lx hj">sed -E</strong> '{<br/># Sex: sex of the patient [M: Male, F: Female]<br/>s/,F,/,Female,/g<br/>s/,M,/,Male,/g<br/><br/># ChestPainType: chest pain type [TA: Typical Angina, ATA: Atypical Angina, NAP: Non-Anginal Pain, ASY: Asymptomatic]</span><span id="77ab" class="mb kl hi lx b fi mg md l me mf">s/,TA,/,Typical Angina,/g<br/>s/,ATA,/,Atypical Angina,/g<br/>s/,NAP,/,Non-Anginal Pain,/g<br/>s/,ASY,/,Asymptomatic,/g<br/><br/>...<br/><br/>}' heart.csv </span></pre><div class="mh mi ez fb mj mk"><a href="https://www.gnu.org/software/sed/" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab dw"><div class="mm ab mn cl cj mo"><h2 class="bd hj fi z dy mp ea eb mq ed ef hh bi translated">GNU sed - GNU项目自由软件基金会</h2><div class="mr l"><h3 class="bd b fi z dy mp ea eb mq ed ef dx translated">sed(流编辑器)是一个非交互式命令行文本编辑器。#示例:删除文件$ sed '4d '中的第4行…</h3></div><div class="ms l"><p class="bd b fp z dy mp ea eb mq ed ef dx translated">www.gnu.org</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my io mk"/></div></div></a></div><pre class="lo lp lq lr fd lw lx ly lz aw ma bi"><span id="1822" class="mb kl hi lx b fi mc md l me mf"># Separate in two individual files by gender (Female and Male)</span><span id="1eb2" class="mb kl hi lx b fi mg md l me mf">file_by_gender(){<br/><strong class="lx hj">grep -E</strong> '*,Female,*' $1 &gt; <strong class="lx hj">heart_women.csv</strong><br/><strong class="lx hj">grep -E</strong> '*,Male,*' $1 &gt; <strong class="lx hj">heart_men.csv</strong><br/>}<br/><br/># Call file_by_gender function with file name parameter<br/>file_by_gender heart_temp.csv</span></pre><p id="6b19" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是结果，按性别分类的csv:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mz"><img src="../Images/432f32079d3ff812cdb70b4c953797ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9xVDeyaz0VGvKDbKwWtPdQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx"><strong class="bd km">heart_women.csv clean file.</strong></figcaption></figure><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es na"><img src="../Images/de64243392ac0e268d1d146470a8d2c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p8MBVqhgFjOf7Gc-tp5kVQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx"><strong class="bd km">heart_men.csv clean file.</strong></figcaption></figure></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="9982" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">统计数据分析</h1><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nb"><img src="../Images/15f2323f61ba6a2b3db1ad03039e6205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-NqxVJQ67Z0pAIY2"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@nci?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">National Cancer Institute</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="db65" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated">作为<strong class="ix hj">转换层</strong>的一部分，我们的shell脚本ETL管道的下一步是获取之前按性别创建的文件，并用它们做一些基本的统计和数据分析。我们需要每个数据集的列的平均值、最大值和最小值，我们将把结果作为一行添加到第三个名为<em class="kc"> results.csv. </em>的文件中</p><p id="4e21" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为此，我使用了<em class="kc"> bash </em>来进行heart_men.csv数据分析，使用了<em class="kc"> awk </em>来进行heart_women.csv数据分析。这两个工具都是读取文件和处理数据的优秀工具，速度非常快，非常干净。在<em class="kc"> bash </em>文件中，我创建了函数<em class="kc"> calculate_avg </em>,将一个数组作为要计算的数据的参数传递给它:</p><pre class="lo lp lq lr fd lw lx ly lz aw ma bi"><span id="3f80" class="mb kl hi lx b fi mc md l me mf"># Function to calculate average from array</span><span id="bc91" class="mb kl hi lx b fi mg md l me mf">function<strong class="lx hj"> calculate_avg()</strong>{<br/> arr=("$@")<br/> tot=0<br/><br/>  for i in "${arr[@]}"; do<br/>   let tot+=$i<br/>  done<br/><br/> size=${#arr[@]}<br/> echo "scale=2; $tot/$size" | bc<br/>}<br/><br/># Get the max and min age values<br/>max_age=$(printf "%d\n" "${age[@]}" | sort -n | tail -1)<br/>min_age=$(printf "%d\n" "${age[@]}" | sort -n -r | tail -1)</span><span id="1952" class="mb kl hi lx b fi mg md l me mf"># Create a row with data stats values and add it to results.csv file.</span><span id="3618" class="mb kl hi lx b fi mg md l me mf">echo M,<br/>$(<strong class="lx hj">calculate_avg </strong>"${age[@]}"),<br/>$max_age,<br/>$min_age,<br/>$(<strong class="lx hj">calculate_avg</strong> "${asy[@]}"),<br/>$(<strong class="lx hj">calculate_avg</strong> "${ta[@]}"),  <br/>$(<strong class="lx hj">calculate_avg</strong> "${maxhr[@]}"),<br/>$(<strong class="lx hj">calculate_avg</strong> "${chol[@]}"),<br/>$(<strong class="lx hj">calculate_avg</strong> "${restbp[@]}"),<br/>$men,<br/>$men_1,  <br/>$(( $men_1*100/$men | bc -l )) &gt; <strong class="lx hj">results.csv</strong></span></pre><p id="e723" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最终结果将是一个csv文件，其中包含两性的计算数据结果，每个数据位于不同的行中。</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nc"><img src="../Images/3c58f4211fd0c0dbd2a72bcdb74bb8da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l1CUpcO62PSZ87F0eNbVyw.png"/></div></div></figure></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="bca1" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">给我看看结果</h1><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nd"><img src="../Images/2f546ccbb128bafb14770feb8e03b38d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nm5Pl_bi4DH2zF74"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@northfolk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">NORTHFOLK</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="94d3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated"><span class="l ju jv jw bm jx jy jz ka kb di">在</span>流程结束时，我们必须计算并<strong class="ix hj">加载</strong>results . CSV文件数据。在我们的案例中，我们不需要数据库，我们在一个静态html文件中显示分析结果，该文件可在笔记本电脑中显示或/和打印，并将其传递给医生(在这种情况下)。</p><p id="be4f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我已经开发了<em class="kc"> bash </em>中的最后一步，目标是计算和显示分析数据中的差异，并显示一个简单易读的报告，其中有三行:男性和女性数据及其基底，以便可视化有趣的差异。这里的策略是在嵌套的<em class="kc">中为</em>颊板获取两个阵列之间的基板。</p><pre class="lo lp lq lr fd lw lx ly lz aw ma bi"><span id="0dba" class="mb kl hi lx b fi mc md l me mf"><strong class="lx hj">for</strong> i in <strong class="lx hj">"${!men[@]}"</strong>; do<br/> <strong class="lx hj">for</strong> w in <strong class="lx hj">"${!women[@]}"</strong>; do<br/>  if (($i == $w)); then<br/>   a=`echo ${men[$i]}-${women[$i]} | bc -l`<br/>   echo "&lt;td&gt;"<br/>    echo $a<br/>   echo "&lt;/td&gt;"<br/>  fi<br/> done<br/>done</span></pre><p id="c510" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，我们有了results.html的<em class="kc">文件:</em></p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ne"><img src="../Images/61c2c95c765767fd27d85998b18b306e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YHRUT7n7O5xKFcWVxkw4IQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx"><strong class="bd km">results.html file</strong></figcaption></figure></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="f4ae" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">只有六条线；一条流水线</strong></h1><p id="0d00" class="pw-post-body-paragraph iv iw hi ix b iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js hb bi jt translated">最有趣的是<strong class="ix hj">执行</strong>一个<em class="kc"> run.sh </em>文件中只有六行的所有代码。这是实现我们目标的一种非常快速的方法:从原始数据中提取必要的信息，将其转换成有价值的统计数据，并最终在一个静态文件中显示结果。</p><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="f495" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">结论</h1><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2ebb0ac0c4c7c4c9376fdda53fa5f2d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MuDQA9Ya7ZNeMxx1"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@pablogamedev?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Pablo Arroyo</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="90b6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated"><span class="l ju jv jw bm jx jy jz ka kb di">正如</span>所见，使用<strong class="ix hj"> shell脚本</strong>开发<strong class="ix hj">管道</strong>是自动化流程和创建简单信息报告的好方法。脚本在开始时可能很难理解，但是如果你稍微练习一下，它会是一个很好的工具。</p><p id="239c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以在<a class="ae iu" href="https://github.com/jordilucas16/quick-report-scripting" rel="noopener ugc nofollow" target="_blank"> my <strong class="ix hj"> GitHub </strong>资源库</a>中查看并测试代码。</p></div></div>    
</body>
</html>