<html>
<head>
<title>Google Maps in Jetpack Compose Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jetpack中的谷歌地图合成Android</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/google-maps-in-jetpack-compose-android-ae7b1ad84e9?source=collection_archive---------10-----------------------#2021-05-25">https://medium.com/geekculture/google-maps-in-jetpack-compose-android-ae7b1ad84e9?source=collection_archive---------10-----------------------#2021-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7e74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与android xml相比，在jetpack compose中集成google maps有点困难。但是如果没有Xml，我们也不能将谷歌地图集成到jetpack compose android应用程序中。</p><p id="41f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了在jetpack compose中集成谷歌地图，您需要从<a class="ae jd" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云控制台</a>生成谷歌地图api密钥，然后您需要添加以下依赖项。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="c4c4" class="jn jo hi jj b fi jp jq l jr js"><em class="jt">implementation</em>("com.google.android.libraries.maps:maps:3.1.0-beta")<br/><em class="jt">implementation</em>("com.google.maps.android:maps-v3-ktx:2.2.0")<br/><em class="jt">implementation</em>("androidx.fragment:fragment:1.3.2")</span></pre><p id="1196" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，在android manifest.xml文件中添加带有google map api密钥和互联网权限的元数据标签</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="1ba3" class="jn jo hi jj b fi jp jq l jr js">&lt;uses-permission android:name="android.permission.INTERNET"/&gt;</span><span id="9e1b" class="jn jo hi jj b fi ju jq l jr js">&lt;meta-data android:name="com.google.android.geo.API_KEY"<br/>    android:value="Api_key_here"/&gt;</span></pre><p id="f661" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，在res目录下创建一个新目录，将其命名为layout，并创建一个新的资源文件，就像我创建layout_map.xml文件一样，并在该文件中添加以下代码</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="caf2" class="jn jo hi jj b fi jp jq l jr js">&lt;androidx.fragment.app.FragmentContainerView<br/>    xmlns:android="http://schemas.android.com/apk/res/android"<br/>    android:id="@+id/map"<br/>    android:name="com.google.android.gms.maps.SupportMapFragment"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent"/&gt;</span></pre><p id="8d17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你可能想知道我们如何在jetpack compose中使用它，所以不要担心，我也将向你展示这一点。</p><p id="91d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在创建一个新文件，我把它命名为MapUtils.kt，并在其中添加下面的代码</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="5cea" class="jn jo hi jj b fi jp jq l jr js">@Composable<br/>fun rememberMapViewWithLifecycle(): MapView {<br/>    val context = <em class="jt">LocalContext</em>.current<br/>    val mapView = <em class="jt">remember </em><strong class="jj hj">{<br/>        </strong>MapView(context).<em class="jt">apply </em><strong class="jj hj">{<br/>            </strong><em class="jt">id </em>= R.id.<em class="jt">map<br/>        </em><strong class="jj hj">}<br/>    }<br/><br/>    </strong>// Makes MapView follow the lifecycle of this composable<br/>    val lifecycleObserver = <em class="jt">rememberMapLifecycleObserver</em>(mapView)<br/>    val lifecycle = <em class="jt">LocalLifecycleOwner</em>.current.<em class="jt">lifecycle<br/>    DisposableEffect</em>(lifecycle) <strong class="jj hj">{<br/>        </strong>lifecycle.addObserver(lifecycleObserver)<br/>        onDispose <strong class="jj hj">{<br/>            </strong>lifecycle.removeObserver(lifecycleObserver)<br/>        <strong class="jj hj">}<br/>    }<br/><br/>    </strong>return mapView<br/>}<br/><br/>@Composable<br/>fun rememberMapLifecycleObserver(mapView: MapView): LifecycleEventObserver =<br/>    <em class="jt">remember</em>(mapView) <strong class="jj hj">{<br/>        </strong><em class="jt">LifecycleEventObserver </em><strong class="jj hj">{ </strong>_, event <strong class="jj hj">-&gt;<br/>            </strong>when (event) {<br/>                Lifecycle.Event.<em class="jt">ON_CREATE </em>-&gt; mapView.onCreate(Bundle())<br/>                Lifecycle.Event.<em class="jt">ON_START </em>-&gt; mapView.onStart()<br/>                Lifecycle.Event.<em class="jt">ON_RESUME </em>-&gt; mapView.onResume()<br/>                Lifecycle.Event.<em class="jt">ON_PAUSE </em>-&gt; mapView.onPause()<br/>                Lifecycle.Event.<em class="jt">ON_STOP </em>-&gt; mapView.onStop()<br/>                Lifecycle.Event.<em class="jt">ON_DESTROY </em>-&gt; mapView.onDestroy()<br/>                else -&gt; throw IllegalStateException()<br/>            }<br/>        <strong class="jj hj">}<br/>    }</strong></span></pre><p id="b113" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们将要使用的两个可组合的函数。这些功能是我从https://github.com/joreilly/GalwayBus<a class="ae jd" href="https://github.com/joreilly/GalwayBus" rel="noopener ugc nofollow" target="_blank">复制来的，你可以看看更多信息。</a></p><p id="35f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，你需要在你的活动组合函数中写下</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="711a" class="jn jo hi jj b fi jp jq l jr js">val mapView = <em class="jt">rememberMapViewWithLifecycle</em>()</span></pre><p id="d22d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以在可组合函数中使用AndroidView()来使用Xml布局文件</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="1e0d" class="jn jo hi jj b fi jp jq l jr js"><em class="jt">Column</em>(<br/>    modifier = Modifier<br/>        .<em class="jt">fillMaxHeight</em>()<br/>        .<em class="jt">fillMaxWidth</em>()<br/>        .<em class="jt">background</em>(Color.White)<br/>) <strong class="jj hj">{<br/>    </strong><em class="jt">AndroidView</em>(<strong class="jj hj">{ </strong>mapView<strong class="jj hj">}</strong>) <strong class="jj hj">{</strong>mapView<strong class="jj hj">-&gt;<br/>        </strong><em class="jt">CoroutineScope</em>(Dispatchers.Main).<em class="jt">launch </em><strong class="jj hj">{<br/>            </strong>val map = mapView.awaitMap()<br/>            map.<em class="jt">uiSettings</em>.<em class="jt">isZoomControlsEnabled </em>= true<br/><br/>            val pickUp =  LatLng(-35.016, 143.321)<br/>            val destination = LatLng(-32.491, 147.309)<br/>            map.moveCamera(CameraUpdateFactory.newLatLngZoom(destination,6f))<br/>            val markerOptions = MarkerOptions()<br/>                .title("Sydney Opera House")<br/>                .position(pickUp)<br/>            map.addMarker(markerOptions)<br/><br/>            val markerOptionsDestination = MarkerOptions()<br/>                .title("Restaurant Hubert")<br/>                .position(destination)<br/>            map.addMarker(markerOptionsDestination)<br/><br/>            map.addPolyline(PolylineOptions().add( pickUp,<br/>                 LatLng(-34.747, 145.592),<br/>             LatLng(-34.364, 147.891),<br/>             LatLng(-33.501, 150.217),<br/>             LatLng(-32.306, 149.248),<br/>             destination))<br/><br/>        <strong class="jj hj">}<br/><br/><br/><br/>    }<br/>}</strong></span></pre><p id="8386" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经在坐标范围内初始化了地图，并在地图上画了两个标记，然后我画了折线用于常规显示。</p><p id="1994" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后是输出:</p><figure class="je jf jg jh fd jw er es paragraph-image"><div class="er es jv"><img src="../Images/67eaafc97515844ddf975d7d72de7567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*tKS4TVrPjMbhbjiZT0rRqA.jpeg"/></div></figure><p id="16c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你面临任何问题，请发表评论，以便我可以帮助你。</p></div></div>    
</body>
</html>