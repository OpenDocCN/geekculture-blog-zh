<html>
<head>
<title>Human Traffic of Stadium : LeetCode</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">体育场的人流量:LeetCode</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/human-traffic-of-stadium-leetcode-beccaa98c83b?source=collection_archive---------1-----------------------#2022-05-11">https://medium.com/geekculture/human-traffic-of-stadium-leetcode-beccaa98c83b?source=collection_archive---------1-----------------------#2022-05-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7631" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">难度:难</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/691e645b290edb4c6919ba6ae7265c9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uLB-2vncy_p9_Uje"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@casparrubin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Caspar Camille Rubin</a> on <a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f12a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jt" href="https://leetcode.com/problems/human-traffic-of-stadium/submissions/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="ju">问题陈述:</em> </strong> </a>写一条SQL查询，显示三行或三行以上连续<strong class="ih hj"/><code class="du jv jw jx jy b">id</code>的记录，每一行人数大于等于100。</p><p id="99e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按<strong class="ih hj">升序</strong>返回按<code class="du jv jw jx jy b">visit_date</code>排序的结果表。</p><p id="5fb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">输入:</strong></p><pre class="je jf jg jh fd jz jy ka kb aw kc bi"><span id="be46" class="kd ke hi jy b fi kf kg l kh ki">+---------------+---------+<br/>| Column Name   | Type    |<br/>+---------------+---------+<br/>| id            | int     |<br/>| visit_date    | date    |<br/>| people        | int     |<br/>+---------------+---------+<br/>visit_date is the primary key for this table.<br/>Each row of this table contains the visit date and visit id to the stadium with the number of people during the visit.<br/>No two rows will have the same visit_date, and as the id increases, the dates increase as well.</span></pre><p id="bd29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">示例:</strong></p><pre class="je jf jg jh fd jz jy ka kb aw kc bi"><span id="e229" class="kd ke hi jy b fi kf kg l kh ki"><strong class="jy hj">Input:</strong> <br/>Stadium table:<br/>+------+------------+-----------+<br/>| id   | visit_date | people    |<br/>+------+------------+-----------+<br/>| 1    | 2017-01-01 | 10        |<br/>| 2    | 2017-01-02 | 109       |<br/>| 3    | 2017-01-03 | 150       |<br/>| 4    | 2017-01-04 | 99        |<br/>| 5    | 2017-01-05 | 145       |<br/>| 6    | 2017-01-06 | 1455      |<br/>| 7    | 2017-01-07 | 199       |<br/>| 8    | 2017-01-09 | 188       |<br/>+------+------------+-----------+<br/><strong class="jy hj">Output:</strong> <br/>+------+------------+-----------+<br/>| id   | visit_date | people    |<br/>+------+------------+-----------+<br/>| 5    | 2017-01-05 | 145       |<br/>| 6    | 2017-01-06 | 1455      |<br/>| 7    | 2017-01-07 | 199       |<br/>| 8    | 2017-01-09 | 188       |<br/>+------+------------+-----------+<br/><strong class="jy hj">Explanation:</strong> <br/>The four rows with ids 5, 6, 7, and 8 have consecutive ids and each of them has &gt;= 100 people attended. Note that row 8 was included even though the visit_date was not the next day after row 7.<br/>The rows with ids 2 and 3 are not included because we need at least three consecutive ids.</span></pre></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><h1 id="a1e7" class="kq ke hi bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">解决方案:-</h1><p id="b78e" class="pw-post-body-paragraph if ig hi ih b ii ln ik il im lo io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated"><strong class="ih hj">步骤1 : </strong>我们将使用WINDOW()函数来获取前向和后向值。</p><p id="aa82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要LAG()和LEAD()以及used过滤条件，这样我们就可以在人数大于100时获取连续的id。</p><pre class="je jf jg jh fd jz jy ka kb aw kc bi"><span id="bdd9" class="kd ke hi jy b fi kf kg l kh ki">with cte as (<br/>select id, <br/>       visit_date, <br/>       people, <br/>       LAG(id,1) OVER(order by id) as prevID_1, <br/>       LAG(id,2) OVER(order by id) as prevID_2,<br/>       LEAD(id,1) OVER(order by id) as nextID_1, <br/>       LEAD(id,2) OVER(order by id) as nextID_2<br/>from Stadium <br/>where people&gt;=100<br/>)</span></pre><p id="cce2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤2 : </strong>使用CASE条件来分隔3个连续序列中的第一行、中间行和最后一行。</p><p id="1329" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当id+1=nextID_1且id+2 = nextID_2 -&gt;第一行<br/>当id-1=prevID_1且id-2 = prevID_2 - &gt;最后一行<br/>当id-1 = prevID_1且id+1=nextID_1 - &gt;中间一行</p><pre class="je jf jg jh fd jz jy ka kb aw kc bi"><span id="60c3" class="kd ke hi jy b fi kf kg l kh ki">,cte2 as (<br/>select *, <br/>       CASE WHEN id+1=nextID_1 AND id+2 = nextID_2 then 'Y' <br/>            WHEN id-1=prevID_1 AND id-2 = prevID_2 then 'Y' <br/>            WHEN id-1 = prevID_1 and id+1=nextID_1 then 'Y'<br/>            ELSE 'N' END as flag<br/>from cte<br/>)</span></pre><p id="79b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤3 : 现在合并两个cte</p><pre class="je jf jg jh fd jz jy ka kb aw kc bi"><span id="7aba" class="kd ke hi jy b fi kf kg l kh ki">with filtered_data as (<br/>select id, <br/>       visit_date, <br/>       people, <br/>       LAG(id,1) OVER(order by id) as prevID_1, <br/>       LAG(id,2) OVER(order by id) as prevID_2,<br/>       LEAD(id,1) OVER(order by id) as nextID_1, <br/>       LEAD(id,2) OVER(order by id) as nextID_2<br/>from Stadium <br/>where people&gt;=100<br/>), ordered_filtered_data as (<br/>select *, <br/>       CASE WHEN id+1=nextID_1 AND id+2 = nextID_2 then 'Y' <br/>            WHEN id-1=prevID_1 AND id-2 = prevID_2 then 'Y' <br/>            WHEN id-1 = prevID_1 and id+1=nextID_1 then 'Y'<br/>            ELSE 'N' END as flag<br/>from filtered_data<br/>)<br/>select id, visit_date, people from ordered_filtered_data where flag = 'Y'</span></pre><p id="645b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jt" href="https://github.com/shefalibisht00/Leetcode/blob/main/601-human-traffic-of-stadium/601-human-traffic-of-stadium.sql" rel="noopener ugc nofollow" target="_blank"> <em class="ju">查看此链接获取完整代码</em> </a> <em class="ju">..</em></p><p id="b84b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> LeetCode问题输出:</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/0939e91e3fab391fb1af346fef72c57b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMtUJEOoJaxLbgvtTugVcg.png"/></div></div></figure></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><p id="8b84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你觉得这篇文章很有帮助，请与你的朋友和同事分享。如果还有其他问题，可以上<a class="ae jt" href="https://www.linkedin.com/in/shefali-bisht/" rel="noopener ugc nofollow" target="_blank"><em class="ju">Linkedin</em></a><em class="ju">找我。</em></p></div></div>    
</body>
</html>