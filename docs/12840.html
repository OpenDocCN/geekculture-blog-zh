<html>
<head>
<title>The Medium RSS Feed’s Missing Part</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">中型RSS源缺少的部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/the-medium-rss-feeds-missing-part-65a0b556dda1?source=collection_archive---------9-----------------------#2022-06-03">https://medium.com/geekculture/the-medium-rss-feeds-missing-part-65a0b556dda1?source=collection_archive---------9-----------------------#2022-06-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="50ba" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">检索中等帖子的统计信息(clapCount、voterCount、responseCount和readingTime)</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/e0992b54218269a2008c130925b25144.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nln9J0e0JIij-vLu9nBWvg.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@ryoji__iwata?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Ryoji Iwata</a> on <a class="ae jn" href="https://unsplash.com/s/photos/puzzle-missing-pieces?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e447" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在这篇文章中，我将解释如何使用REST API来检索Medium feed帖子的统计信息(<code class="du kk kl km kn b">claps count</code>、<code class="du kk kl km kn b">voter count</code>、<code class="du kk kl km kn b">response count</code>和<code class="du kk kl km kn b">reading time</code>)，Medium RSS feed中缺少这个特性是我创建这个高级Medium API的动机。这是我的第41篇媒体文章。</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="ed03" class="kv kw hi bd kx ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">最初的直觉</h1><blockquote class="ln lo lp"><p id="43e9" class="jo jp lq jq b jr js ij jt ju jv im jw lr jy jz ka ls kc kd ke lt kg kh ki kj hb bi translated">我想在开发我的个人网站时获得我的中等帖子的统计数据(<code class="du kk kl km kn b"><em class="hi">claps count</em></code>、<code class="du kk kl km kn b"><em class="hi">voter count</em></code>、<code class="du kk kl km kn b"><em class="hi">response count</em></code>和<code class="du kk kl km kn b"><em class="hi">reading time</em></code>)。2年前，当我在我的网站上实现medium widget时，我发现了<a class="ae jn" href="https://medium-widget.pixelpoint.io/" rel="noopener ugc nofollow" target="_blank"> Pixelpoint.io </a>，它生成了一个具有medium帖子鼓掌计数的widget。那一刻我很好奇他们是怎么实现的？后来我忘了研究它，但上个月我发现pixelpoint.io的小工具不工作了。我到处寻找满足我需求的解决方案，但是找不到，所以我别无选择，只能自己编码。</p></blockquote><p id="8621" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我最初的直觉是查看RSS提要，但是没有提供这样的细节，然后我查看了Medium的官方文档public <a class="ae jn" href="https://github.com/Medium/medium-api-docs" rel="noopener ugc nofollow" target="_blank"> REST API </a>，也没有任何内容。Medium REST API只允许你通过<code class="du kk kl km kn b">HTTP POST</code>方法创建一个Medium文章(参见<a class="ae jn" href="https://github.com/Medium/medium-api-docs#33-posts" rel="noopener ugc nofollow" target="_blank">第3.3节</a>)。<em class="lq">您不能使用媒体API检索或编辑媒体文章😔。</em></p><p id="a3b3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了理解如何在Medium post中检索有用的统计数据，我开始使用浏览器开发工具检查Medium。令人震惊的是，在所有的XHR呼叫中没有请求获得统计数据，这促使我查看Medium post的HTML响应。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lu"><img src="../Images/a2fa6e9b038f4a571a21f3a45fdfd958.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iK-81Yo7eR8z55mOJoXAow.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Inspecting a Medium post page.</figcaption></figure><pre class="iy iz ja jb fd lv kn lw lx aw ly bi"><span id="803e" class="lz kw hi kn b fi ma mb l mc md">curl <a class="ae jn" rel="noopener" href="/p/unique_Id_of_the_post">https://medium.com/p/unique_Id_of_the_post</a> &gt;&gt; post.html</span></pre><p id="ba73" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">作为一个javascript变量，鼓掌计数、投票计数、响应计数和阅读时间被直接注入到HTML响应中。您可以通过在Post页面的Javascript控制台中键入<code class="du kk kl km kn b">console.log(window.__APOLLO_STATE__); </code>来验证这一点。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es me"><img src="../Images/186bafb08f152a05bee88786434c8f01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1yjiDqp1gbUtEcpCh5wbQQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx"><code class="du kk kl km kn b">window.__APOLLO_STATE__ object</code></figcaption></figure><p id="85ad" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后我使用<code class="du kk kl km kn b"><a class="ae jn" href="https://github.com/request/request" rel="noopener ugc nofollow" target="_blank">request</a></code>和<code class="du kk kl km kn b"><a class="ae jn" href="https://cheerio.js.org/" rel="noopener ugc nofollow" target="_blank">cheerio</a></code>收集那些有用的统计数据。</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="de52" class="kv kw hi bd kx ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">如何抓取脚本标签中的数据</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mf"><img src="../Images/b050aba5a7433653b3ac8039f4da8866.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BWZQVQ3VD9uh6LVboW-E8w.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@kikesalazarn?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Kike Salazar N</a> on <a class="ae jn" href="https://unsplash.com/s/photos/scrape?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="eccb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在一篇中篇文章中，数据以JSON的形式出现在脚本标签中。通过使用javascript，这些数据在浏览器端被提取并呈现在DOM中。通常，脚本标记中的数据采用以下形式:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="672d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后我在没有无头浏览器的情况下抓取中等大小的帖子数据。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="0b58" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">首先，我得到网站，并寻找错误。然后我确认身体是否存在，并使用<code class="du kk kl km kn b">$</code>中的<code class="du kk kl km kn b">cheerio</code>载入身体。在<code class="du kk kl km kn b">try</code>块中，所有的标签脚本内容都被映射到一个数组中。然后找到包含<code class="du kk kl km kn b">window.__APOLLO_STATE__</code>的元素，用空字符串替换赋值<code class="du kk kl km kn b">window.__APOLLO_STATE__ = </code>。我将<code class="du kk kl km kn b">/&amp;quot;/g</code>替换为<code class="du kk kl km kn b">"</code>，并使用<code class="du kk kl km kn b">JSON.parse</code>进行解析。最后，从JSON中获取适当的值。</p><p id="1e5e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这种技术相对于无头浏览器的优势是速度超快，占用的处理和资源更少。</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="fd10" class="kv kw hi bd kx ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">如何使用高级媒体API</h1><p id="7f13" class="pw-post-body-paragraph jo jp hi jq b jr mi ij jt ju mj im jw jx mk jz ka kb ml kd ke kf mm kh ki kj hb bi translated">你可以使用我开发的<a class="ae jn" href="https://github.com/sabesansathananthan/advanced-medium-api/tree/develop" rel="noopener ugc nofollow" target="_blank">高级媒体API </a>，如下所示:</p><p id="a3a3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">有5种类型的请求。您可以通过使用<code class="du kk kl km kn b">HTTP GET</code>方法获得所有响应。</p><h2 id="1716" class="lz kw hi bd kx mn mo mp lb mq mr ms lf jx mt mu lh kb mv mw lj kf mx my ll mz bi translated">JSON中的中馈</h2><p id="690e" class="pw-post-body-paragraph jo jp hi jq b jr mi ij jt ju mj im jw jx mk jz ka kb ml kd ke kf mm kh ki kj hb bi translated">您可以通过使用以下链接(替换您的用户名而不是<code class="du kk kl km kn b">@username</code>)获得最近10篇中型文章的RSS提要。</p><pre class="iy iz ja jb fd lv kn lw lx aw ly bi"><span id="2b21" class="lz kw hi kn b fi ma mb l mc md"><em class="lq">medium.com/feed/@username <br/></em>or<em class="lq"> <br/>username.medium.com/feed</em></span></pre><p id="7998" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">API的以下请求给出了RSS提要的直接JSON转换。</p><pre class="iy iz ja jb fd lv kn lw lx aw ly bi"><span id="e3a3" class="lz kw hi kn b fi ma mb l mc md">curl <a class="ae jn" href="https://advanced-medium-api.herokuapp.com/medium/user/{userId}" rel="noopener ugc nofollow" target="_blank">https://advanced-medium-api.herokuapp.com/medium/user/{userId}</a></span></pre><h2 id="6a02" class="lz kw hi bd kx mn mo mp lb mq mr ms lf jx mt mu lh kb mv mw lj kf mx my ll mz bi translated">中等高级数据</h2><p id="47bc" class="pw-post-body-paragraph jo jp hi jq b jr mi ij jt ju mj im jw jx mk jz ka kb ml kd ke kf mm kh ki kj hb bi translated">您可以在JSON中获得缺少部分的介质进给，如<code class="du kk kl km kn b">clapCount</code>、<code class="du kk kl km kn b">voterCount</code>、<code class="du kk kl km kn b">responseCount</code>、<code class="du kk kl km kn b">readingTime</code>。在每个post(items)对象中注入每个缺失数据。</p><p id="aa1f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">API的以下请求给出了RSS提要的JSON转换，并注入了丢失的数据。</p><pre class="iy iz ja jb fd lv kn lw lx aw ly bi"><span id="3a3a" class="lz kw hi kn b fi ma mb l mc md">curl <a class="ae jn" href="https://advanced-medium-api.herokuapp.com/advanced/user/{userId}" rel="noopener ugc nofollow" target="_blank">https://advanced-medium-api.herokuapp.com/advanced/user/{userId}</a></span></pre><h2 id="f2ce" class="lz kw hi bd kx mn mo mp lb mq mr ms lf jx mt mu lh kb mv mw lj kf mx my ll mz bi translated">中等定制数据</h2><p id="c263" class="pw-post-body-paragraph jo jp hi jq b jr mi ij jt ju mj im jw jx mk jz ka kb ml kd ke kf mm kh ki kj hb bi translated">JSON转换的中等RSS提要是根据类别定制的。根据最近10篇文章中的使用次数对中等文章的标签进行排序，<code class="du kk kl km kn b">tagOrder</code>返回标签的排序。Medium的最新10篇文章被3除，每3篇文章被放入一个数组，这些数组被放入一个数组。有一种算法可以在该媒体帖子的其他标签中返回最适合该媒体帖子的标签。</p><p id="62e1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下面的API请求给出了JSON中媒体提要的定制版本</p><pre class="iy iz ja jb fd lv kn lw lx aw ly bi"><span id="aedd" class="lz kw hi kn b fi ma mb l mc md">curl <a class="ae jn" href="https://advanced-medium-api.herokuapp.com/customized/user/{userId}" rel="noopener ugc nofollow" target="_blank">https://advanced-medium-api.herokuapp.com/customized/user/{userId}</a></span></pre><h2 id="ea54" class="lz kw hi bd kx mn mo mp lb mq mr ms lf jx mt mu lh kb mv mw lj kf mx my ll mz bi translated">中型定制高级数据</h2><p id="b7d9" class="pw-post-body-paragraph jo jp hi jq b jr mi ij jt ju mj im jw jx mk jz ka kb ml kd ke kf mm kh ki kj hb bi translated">该响应包含注入了诸如<code class="du kk kl km kn b">clapCount</code>、<code class="du kk kl km kn b">voterCount</code>、<code class="du kk kl km kn b">responseCount</code>、<code class="du kk kl km kn b">readingTime</code>之类的缺失统计的媒体定制数据。</p><p id="5d91" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下面的API请求给出了JSON中介质提要的定制版本，其中缺少介质提要的一部分。</p><pre class="iy iz ja jb fd lv kn lw lx aw ly bi"><span id="4b58" class="lz kw hi kn b fi ma mb l mc md">curl <a class="ae jn" href="https://advanced-medium-api.herokuapp.com/advanced/customized/user/{userId}" rel="noopener ugc nofollow" target="_blank">https://advanced-medium-api.herokuapp.com/advanced/customized/user/{userId}</a></span></pre><h2 id="84ca" class="lz kw hi bd kx mn mo mp lb mq mr ms lf jx mt mu lh kb mv mw lj kf mx my ll mz bi translated">特定帖子的缺失数据。</h2><p id="a128" class="pw-post-body-paragraph jo jp hi jq b jr mi ij jt ju mj im jw jx mk jz ka kb ml kd ke kf mm kh ki kj hb bi translated">该响应仅包含特定介质柱的介质进给的缺失部分(<code class="du kk kl km kn b">clapCount</code>、<code class="du kk kl km kn b">voterCount</code>、<code class="du kk kl km kn b">responseCount</code>、<code class="du kk kl km kn b">readingTime</code>)。</p><p id="f356" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">请求</strong>💻 ➡ 🌎<strong class="jq hj"> : </strong></p><pre class="iy iz ja jb fd lv kn lw lx aw ly bi"><span id="5426" class="lz kw hi kn b fi ma mb l mc md">curl <a class="ae jn" href="https://advanced-medium-api.herokuapp.com/medium/post/{postId}" rel="noopener ugc nofollow" target="_blank">https://advanced-medium-api.herokuapp.com/medium/post/{postId}</a></span></pre><p id="67af" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">响应</strong>🌎➡💻：</p><pre class="iy iz ja jb fd lv kn lw lx aw ly bi"><span id="ba83" class="lz kw hi kn b fi ma mb l mc md">{<br/>  "clapCount": 98,<br/>  "responseCount": 4,<br/>  "voterCount": 12,<br/>  "readingTime": 4<br/>}</span></pre></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="3476" class="kv kw hi bd kx ky kz la lb lc ld le lf io lg ip lh ir li is lj iu lk iv ll lm bi translated">结论</h1><p id="6a46" class="pw-post-body-paragraph jo jp hi jq b jr mi ij jt ju mj im jw jx mk jz ka kb ml kd ke kf mm kh ki kj hb bi translated">这个API是开源的，我欢迎你的贡献。过去两年，我使用了来自<a class="ae jn" href="https://medium-widget.pixelpoint.io/" rel="noopener ugc nofollow" target="_blank"> Pixelpoint.io </a>的medium widget，它生成了一个具有中等帖子鼓掌计数的widget。当我使用Pixelpoint.io时，我没有做研究来获得介质馈送的丢失部分。但是在Pixelpoint.io不工作的2个月前，这个事件影响了我的个人网站。因此，我推动自己，创造了这个API。</p></div></div>    
</body>
</html>