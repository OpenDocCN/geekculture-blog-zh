<html>
<head>
<title>System Design Notes #1. Gradual Improvement. Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">系统设计笔记#1。逐步改善。第一部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/system-design-notes-1-gradual-improvement-part-1-e138a407dc4d?source=collection_archive---------6-----------------------#2022-05-11">https://medium.com/geekculture/system-design-notes-1-gradual-improvement-part-1-e138a407dc4d?source=collection_archive---------6-----------------------#2022-05-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="59da" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如何将系统从单个用户扩展到数百万活跃用户。第1部分:负载平衡器、Web服务器伸缩、数据库复制和缓存。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/cc76e1f76ea5609f9f503f8c95dd9018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D7ZKQHGLEDSgopFKHNEmyQ.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@darshan394" rel="noopener ugc nofollow" target="_blank">Deva Darshan</a> from <a class="ae jn" href="https://unsplash.com/photos/Jt9syHEhrPE" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="bd8a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是一系列关于系统设计的笔记。我做这些笔记的主要动机是为了更好地理解系统设计主题。如果您需要复习一些常见的主题或获得主题的大纲，您也会发现它们很有用。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="8bbb" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">单一服务器</h1><p id="f43c" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">这是一些软件项目应该使用的起点。单服务器系统假设您有唯一的Web服务器，甚至没有数据库。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lo"><img src="../Images/6682faa80cb10b72c891e3b52bd4e2a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lStUgHFNnyRRxE7DH2ZurA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Pic. 1. A Single Server System</figcaption></figure><p id="fd11" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这个系统是这样工作的:</p><ol class=""><li id="a45b" class="lp lq hi jq b jr js ju jv jx lr kb ls kf lt kj lu lv lw lx bi translated">用户想要访问“mrbalov.io”网页。浏览器转到DNS并检索适当的IP地址。</li><li id="a850" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj lu lv lw lx bi translated">DNS以“mrbalov.io”域的IP地址作为响应。</li><li id="9309" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj lu lv lw lx bi translated">然后浏览器使用一个IP地址到达网络服务器。</li><li id="e0b3" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj lu lv lw lx bi translated">Web服务器用HTML页面或JSON数据进行响应。</li></ol><h1 id="3431" class="kr ks hi bd kt ku md kw kx ky me la lb io mf ip ld ir mg is lf iu mh iv lh li bi translated">数据库ˌ资料库</h1><p id="2e4b" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">以前的系统没有存储数据。它唯一做的就是用静态数据来响应:JSON的HTML。存储数据(例如，用户、威尔士矮脚狗等)。)，我们需要在系统中添加一个数据库。我们开始吧！</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/514942d9e7719825fa1d935aca506278.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j-uSWdOKeCDb2tHB6zoS0g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Pic. 2. A System with Database</figcaption></figure><p id="916c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">有两种类型的可用数据库:</p><ul class=""><li id="7c14" class="lp lq hi jq b jr js ju jv jx lr kb ls kf lt kj mj lv lw lx bi translated">关系型(MySQL、PostgreSQL)</li><li id="9e27" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj mj lv lw lx bi translated">非关系的，或NoSQL (Redis，Memcached，MongoDB)</li></ul><p id="7fbc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">关系数据库对于可能彼此有关系的结构化数据很有用。例如，表“users”可能有一个“corgiId”字段指向“corgis”表中的某个实体。</p><p id="5892" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">非关系数据库对于非结构化数据很有用。此外，当要求低延迟时，它们也很有用。或者当数据量很大时。</p><h1 id="f66d" class="kr ks hi bd kt ku md kw kx ky me la lb io mf ip ld ir mg is lf iu mh iv lh li bi translated">缩放比例</h1><p id="0cb9" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">有两种缩放类型:</p><ul class=""><li id="c2ae" class="lp lq hi jq b jr js ju jv jx lr kb ls kf lt kj mj lv lw lx bi translated">垂直(纵向扩展)</li><li id="1d6f" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj mj lv lw lx bi translated">水平(横向扩展)</li></ul><p id="72cd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">垂直扩展</strong>意味着您为现有服务器增加更多功能:CPU、RAM等等。这种方法有几个主要缺点:</p><ul class=""><li id="804e" class="lp lq hi jq b jr js ju jv jx lr kb ls kf lt kj mj lv lw lx bi translated">高成本</li><li id="b43a" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj mj lv lw lx bi translated">硬缩放限制</li><li id="2962" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj mj lv lw lx bi translated">单点故障(如果一台服务器出现故障，没有任何东西可以替代它)</li><li id="169a" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj mj lv lw lx bi translated">缺乏冗余(没有“空”的空间来应对不断增长的压力</li></ul><p id="69fa" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">水平扩展</strong>是指增加更多同时工作的服务器。这种方法解决了上述问题。但是设置起来可能相当复杂。我们需要解决的第一个问题是路由到正确的服务器。</p><h1 id="4645" class="kr ks hi bd kt ku md kw kx ky me la lb io mf ip ld ir mg is lf iu mh iv lh li bi translated">负载平衡器</h1><p id="2ec6" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">负载平衡器的目的是在Web服务器之间分配连接。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mk"><img src="../Images/f41ad1ef4888ded5af4835e1aaa6737e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FEWdPzm28xdwx-Bwu-I0Fg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Pic. 3. A System with Load Balancer</figcaption></figure><p id="d3af" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">请注意，为了安全起见，负载平衡器使用私有IP。</p><p id="7922" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这就是负载平衡器如何帮助我们想象的系统:</p><ul class=""><li id="cc85" class="lp lq hi jq b jr js ju jv jx lr kb ls kf lt kj mj lv lw lx bi translated">如果其中一个Web服务器出现故障，负载平衡器会将流量路由到活动的服务器。</li><li id="63cc" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj mj lv lw lx bi translated">当流量突然增加时，更多的Web服务器可能会被添加到池中。</li></ul><p id="8028" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">因此，现在Web层具有以下属性:</p><ul class=""><li id="0d2f" class="lp lq hi jq b jr js ju jv jx lr kb ls kf lt kj mj lv lw lx bi translated">故障转移—这是一种在Web服务器停机时进行恢复的能力。</li><li id="abb6" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj mj lv lw lx bi translated">冗余——这是一种类似“空白空间”的东西，允许处理突然增加的流量。</li></ul><p id="bd11" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下一步是改进Web层。</p><h1 id="3773" class="kr ks hi bd kt ku md kw kx ky me la lb io mf ip ld ir mg is lf iu mh iv lh li bi translated">数据库复制</h1><p id="0c69" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">数据库复制意味着拥有一个数据库的多个副本。复制的目的是将读取操作与变异操作(插入、删除、更新)分开。这很有帮助，因为大多数系统都有大量的读取操作，而变异操作要少得多。</p><p id="617e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">主/从方法是最常见的。下图对此进行了描述。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ml"><img src="../Images/4c42c2cdb12257978c3651f3ff02250a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XwRBLOts3_28IK_OTO3EUw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Pic. 4. A System with Database Replication</figcaption></figure><p id="ad6d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">数据库复制有以下优点:</p><ul class=""><li id="79e0" class="lp lq hi jq b jr js ju jv jx lr kb ls kf lt kj mj lv lw lx bi translated">性能(因为突变的高读取率)</li><li id="8303" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj mj lv lw lx bi translated">可靠性(如果一个数据库失效，还有其他可运行的数据库)</li><li id="295b" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj mj lv lw lx bi translated">可用性(当复制的数据库位于不同位置时)</li></ul><h1 id="ea6a" class="kr ks hi bd kt ku md kw kx ky me la lb io mf ip ld ir mg is lf iu mh iv lh li bi translated">贮藏</h1><p id="1307" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">这是缩短响应时间的常用技术。我们将在我们想象的系统中添加缓存撕裂，以提高从数据库中读取数据的响应时间。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mm"><img src="../Images/8f889f834e38d7176be19e3d182a27a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oOK-T55xhhU6MaY3n2fLFg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Pic. 5. Cache Tier</figcaption></figure><p id="2136" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">向系统添加缓存层时，有一些有用的注意事项。</p><ul class=""><li id="27cc" class="lp lq hi jq b jr js ju jv jx lr kb ls kf lt kj mj lv lw lx bi translated">当数据被频繁读取时，缓存是有用的。</li><li id="96ad" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj mj lv lw lx bi translated">想想<strong class="jq hj">到期策略</strong>。这是数据被缓存的时间。这不应该太短或太长。</li><li id="5b12" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj mj lv lw lx bi translated">当缓存层是分布式的时，可能会出现一致性问题。</li><li id="2bfc" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj mj lv lw lx bi translated">缓存层可能是一个<strong class="jq hj">单点故障</strong> (SPOF)。作为避免这种情况的一种选择，缓存层必须是分布式的。</li><li id="4d21" class="lp lq hi jq b jr ly ju lz jx ma kb mb kf mc kj mj lv lw lx bi translated">应该考虑<strong class="jq hj">驱逐政策</strong>。这意味着当存储已满时删除冗余数据。一些流行的驱逐政策:最不常用(LFE)，先进先出(先进先出)。</li></ul><h1 id="b5ef" class="kr ks hi bd kt ku md kw kx ky me la lb io mf ip ld ir mg is lf iu mh iv lh li bi translated">中间总结</h1><p id="4148" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">这是我们现在有的系统图。这不是最终的解决方案。而且，实际上，改进任何系统的过程都是无止境的！在接下来的章节中，我们将改善目前的状况。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mn"><img src="../Images/619a1dd5245d4972a3aa1d5c9a99b5ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3x3H4VndvFZxR74AgIO9xA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Pic. 6. Intermediate System Diagram. This will be improved soon!</figcaption></figure></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><p id="1344" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是“逐步改进”论文的第一部分。在下一部分中，我们将了解CDN、StatefulStateless Web层、数据中心、数据库扩展和其他主题。</p><p id="b1a9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae jn" rel="noopener" href="/@balovbohdan/system-design-notes-2-gradual-improvement-part-2-874447785c6c">未完待续……</a></p></div></div>    
</body>
</html>