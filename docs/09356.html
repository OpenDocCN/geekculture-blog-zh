<html>
<head>
<title>How to install a specific Node.js version in an alpine Docker image?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在alpine Docker镜像中安装特定的Node.js版本？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-install-a-specific-node-js-version-in-an-alpine-docker-image-3edc1c2c64be?source=collection_archive---------0-----------------------#2021-12-07">https://medium.com/geekculture/how-to-install-a-specific-node-js-version-in-an-alpine-docker-image-3edc1c2c64be?source=collection_archive---------0-----------------------#2021-12-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/75f0b5040b61e5099fa4ee9b14c28fab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W-rGmqMH8XIJ8myvbd1zcw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Why is this so complicated?</figcaption></figure><p id="1e8b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">就像这些人问的:<a class="ae js" href="https://stackoverflow.com/questions/45973481/alpine-linux-in-docker-container-env-cant-execute-node-no-such-file-or" rel="noopener ugc nofollow" target="_blank"> 1 </a>、<a class="ae js" href="https://stackoverflow.com/questions/62915459/add-a-specific-node-version-in-ruby-alpine-docker-image" rel="noopener ugc nofollow" target="_blank"> 2 </a>、<a class="ae js" href="https://stackoverflow.com/questions/58725215/how-to-install-nodejs-v13-0-1-in-alpine3-8" rel="noopener ugc nofollow" target="_blank"> 3 </a>、<a class="ae js" href="https://stackoverflow.com/questions/64243684/install-node-js-from-source-on-alpine" rel="noopener ugc nofollow" target="_blank"> 4 </a>等等。</p><p id="46d0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">除非您从节点映像开始，否则您可能会遇到这个令人惊讶的复杂问题。</p><p id="de21" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">原来，<a class="ae js" href="https://pkgs.alpinelinux.org/packages" rel="noopener ugc nofollow" target="_blank"> alpine package repo </a>只为每个包存储一个版本。因此，如果您正在固定一个严格的节点版本(正如您应该做的那样)，很可能您在那里找不到它。更糟糕的是，如果你真的找到它并开始用这个设置开发，他们会在有新版本可用时立即删除这个包。所以你不得不更新或者寻找更好的解决方案。另见:<a class="ae js" href="https://stschindler.medium.com/the-problem-with-docker-and-alpines-package-pinning-18346593e891" rel="noopener">Docker和Alpine的包销问题</a></p><p id="44b6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae js" href="https://gitlab.alpinelinux.org/alpine/abuild/-/issues/9996#note_87135" rel="noopener ugc nofollow" target="_blank">据高山团队</a>:</p><blockquote class="jt ju jv"><p id="d5e6" class="iu iv jw iw b ix iy iz ja jb jc jd je jx jg jh ji jy jk jl jm jz jo jp jq jr hb bi translated">官方的建议是保留您自己的镜像/存储库，其中包含您可能想要使用的所有特定包及其版本。</p></blockquote><p id="0ef1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我想这是可行的，但是假设你没有疯狂到这样做，这里有一些其他的选择。</p></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><h1 id="a3fd" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">1、使用二进制</h1><p id="9098" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">这并不像听起来那么简单。简单地使用你的平台的官方节点二进制文件<a class="ae js" href="https://stackoverflow.com/questions/45973481/alpine-linux-in-docker-container-env-cant-execute-node-no-such-file-or" rel="noopener ugc nofollow" target="_blank">将会失败</a>，你要么安装额外的依赖项，要么自己构建二进制文件(你可以<a class="ae js" href="https://github.com/oznu/alpine-node" rel="noopener ugc nofollow" target="_blank">找到</a>构建的二进制文件)。</p><p id="9efb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是一个流行的解决方案，但是您失去了跨平台支持。随着ARM平台(如Apple silicon)的普及，应该避免这种已经次优的解决方案。</p><h1 id="c37b" class="kh ki hi bd kj kk lk km kn ko ll kq kr ks lm ku kv kw ln ky kz la lo lc ld le bi translated">2、使用节点版本管理器，如NVM</h1><p id="cff5" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">安装越来越多的工具违背了使用Alpine映像的目的，但无论如何，nvm在最新的Alpine上对我不起作用。</p><h1 id="a724" class="kh ki hi bd kj kk lk km kn ko ll kq kr ks lm ku kv kw ln ky kz la lo lc ld le bi translated">3、从官方节点镜像复制二进制文件</h1><p id="a8a8" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">这非常有效。它是跨平台的，即使下面这个幼稚的实现也不会复制太多或者覆盖任何会导致问题的东西。</p><pre class="lp lq lr ls fd lt lu lv lw aw lx bi"><span id="d5dc" class="ly ki hi lu b fi lz ma l mb mc">FROM node:$NODE_VERSION-alpine AS node</span><span id="09bb" class="ly ki hi lu b fi md ma l mb mc">FROM base</span><span id="4885" class="ly ki hi lu b fi md ma l mb mc">COPY --from=node /usr/lib /usr/lib<br/>COPY --from=node /usr/local/share /usr/local/share<br/>COPY --from=node /usr/local/lib /usr/local/lib<br/>COPY --from=node /usr/local/include /usr/local/include<br/>COPY --from=node /usr/local/bin /usr/local/bin</span></pre><p id="ba06" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你可以看到它在这里练习<a class="ae js" href="https://github.com/thisismydesign/ruby-node-alpine/blob/e81bf76c7c348b2832480d112d40f13768461297/Dockerfile" rel="noopener ugc nofollow" target="_blank"/>，我用它来启用最后一个选项:</p><h1 id="f189" class="kh ki hi bd kj kk lk km kn ko ll kq kr ks lm ku kv kw ln ky kz la lo lc ld le bi translated">4、找到预装节点的镜像</h1><p id="f664" class="pw-post-body-paragraph iu iv hi iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr hb bi translated">所以您的基本映像没有节点，因为您使用的是其他框架，比如Ruby、Python等。但是也有可能找到安装了节点的基本Alpine映像。</p><p id="5ccd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于Ruby，<a class="ae js" href="https://github.com/timbru31/docker-ruby-node" rel="noopener ugc nofollow" target="_blank"> docker-ruby-node </a>做到了这一点，但是，你不能锁定确切的节点版本，当有节点更新时，它们也会覆盖映像，这就给你留下了与Alpine包管理器相同的问题。</p><p id="6ca1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">出于这个原因，我创建了<a class="ae js" href="https://github.com/thisismydesign/ruby-node-alpine" rel="noopener ugc nofollow" target="_blank"> ruby-node-alpine </a>:一个能够为定制的特定版本构建Ruby + Node Alpine映像的项目。</p></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><p id="43d9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你也可以在<a class="ae js" href="https://hub.docker.com/repository/docker/thisismydesign/ruby-node-alpine" rel="noopener ugc nofollow" target="_blank"> DockerHub </a>上找到这些图片:</p><pre class="lp lq lr ls fd lt lu lv lw aw lx bi"><span id="9299" class="ly ki hi lu b fi lz ma l mb mc">docker run thisismydesign/ruby-node-alpine:3.0.2-16.13.0-alpine /bin/sh -c "ruby --version &amp;&amp; node --version"</span></pre><p id="eb2e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我很确定这个平庸的问题浪费了数千小时的开发时间。终于，我再也不用关心它了！🎉</p></div></div>    
</body>
</html>