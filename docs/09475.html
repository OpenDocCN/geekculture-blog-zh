<html>
<head>
<title>How I built an E-commerce API with NodeJs, Express and MongoDB(Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何用NodeJs、Express和MongoDB构建电子商务API(第2部分)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-i-built-an-e-commerce-api-with-nodejs-express-and-mongodb-part-2-c729b1e74336?source=collection_archive---------3-----------------------#2021-12-13">https://medium.com/geekculture/how-i-built-an-e-commerce-api-with-nodejs-express-and-mongodb-part-2-c729b1e74336?source=collection_archive---------3-----------------------#2021-12-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3ccf40509849290ebc6614eeb62ff827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kMMtO2szrWyPTQBZP4ns8w.jpeg"/></div></div></figure><p id="3f37" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是本系列的第二部分。</p><p id="2dae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在第一部分中，我们建立了我们的项目，并解释了我们将使用的各种工具。</p><p id="d6e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这一部分，我们将构建模型、<strong class="is hj">购物车、商品和用户。</strong></p><p id="30c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你没有看过第一部分，这里有链接。</p><div class="jo jp ez fb jq jr"><a rel="noopener follow" target="_blank" href="/geekculture/how-i-built-an-e-commerce-api-with-nodejs-express-and-mongodb-7b42b5253ffb"><div class="js ab dw"><div class="jt ab ju cl cj jv"><h2 class="bd hj fi z dy jw ea eb jx ed ef hh bi translated">我如何用NodeJs、Express和MongoDB构建电子商务API</h2><div class="jy l"><h3 class="bd b fi z dy jw ea eb jx ed ef dx translated">第1部分:设置项目</h3></div><div class="jz l"><p class="bd b fp z dy jw ea eb jx ed ef dx translated">medium.com</p></div></div><div class="ka l"><div class="kb l kc kd ke ka kf io jr"/></div></div></a></div></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><p id="14e5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们使用MongoDB作为我们的数据库，我们将使用Mongoose与它进行交互。</p><p id="645e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了保持有序，我们将在根目录下创建一个名为<strong class="is hj"> models、</strong>的新文件夹，在里面，我们创建三个文件，<strong class="is hj"> User、Cart、Item、</strong> with”。js”扩展名。</p><p id="d174" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">用户模型。</strong></p><p id="92c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们首先导入所有需要的模块，<strong class="is hj">mongose、validator、bcrypt和jwt。</strong></p><p id="dfe9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du kn ko kp kq b">const mongoose = require(‘mongoose’)<br/>const validator = require(‘validator’)<br/>const bcrypt = require(‘bcryptjs’)<br/>const jwt = require(‘jsonwebtoken’)</code></p><p id="a7ea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后我们创建我们的用户模式。这将成为创造新用户的一种方式。</p><pre class="kr ks kt ku fd kv kq kw kx aw ky bi"><span id="7f8d" class="kz la hi kq b fi lb lc l ld le">const userSchema = new mongoose.Schema({<br/>name: {<br/>   type: String,<br/>   required: true,<br/>   trim: true,<br/>   lowercase: true<br/> },<br/>email: {<br/>   type: String,<br/>   required: true,<br/>   unique: true,<br/>   lowercase: true,<br/>     validate( <em class="lf">value</em> ) {<br/>           if( !validator.isEmail( value )) {<br/>                throw new Error( ‘Email is invalid’ )<br/>                 }<br/>            }<br/>  }<br/>password: {<br/>    type: String,<br/>    required: true,<br/>    minLength: 7,<br/>    trim: true,<br/>    validate(<em class="lf">value</em>) {<br/>       if( value.toLowerCase().includes(‘password’)) {<br/>       throw new Error(‘password musn\’t contain password’)<br/>      }<br/>   }<br/>},<br/>tokens: [{<br/>  token: {<br/>  type: String,<br/>  required: true<br/>    }<br/>  }]<br/>}, {<br/>timestamps: true<br/>})</span></pre><p id="46ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该模式中有各种字段，这将是每个用户都有的参数。</p><p id="3a68" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我会花时间来解释每一个和他们做什么。</p><ol class=""><li id="df1d" class="lg lh hi is b it iu ix iy jb li jf lj jj lk jn ll lm ln lo bi translated"><strong class="is hj">姓名</strong> —该字段保存每个用户的姓名。它属于字符串类型，并且是必填字段，因此除非您提供此字段，否则无法注册。我们正在修剪，以消除尾随和前导空格，并转换为小写。</li><li id="6eb4" class="lg lh hi is b it lp ix lq jb lr jf ls jj lt jn ll lm ln lo bi translated"><strong class="is hj">电子邮件</strong> —该字段包含用户的电子邮件。它是必填字段，也是一个字符串。我们希望我们的电子邮件是唯一的，所以我们将其设置为true，我们还希望检查电子邮件的格式是否正确，所以我们使用validator的<strong class="is hj"> validate </strong>方法进行检查。如果电子邮件的格式不正确，我们会抛出一个新的错误。</li><li id="a328" class="lg lh hi is b it lp ix lq jb lr jf ls jj lt jn ll lm ln lo bi translated"><strong class="is hj">密码</strong> —包含用户密码。它的类型是string，是必需的，我们也希望它的长度超过7个字符，所以我们包含了minLength属性。我们还在这里使用validate来检查密码是否包含“password ”,如果包含，则抛出一个错误。</li><li id="8727" class="lg lh hi is b it lp ix lq jb lr jf ls jj lt jn ll lm ln lo bi translated"><strong class="is hj">令牌</strong> —令牌是包含jwt生成的令牌的对象数组。在接下来的部分中，我们将使用这些令牌来认证用户。</li><li id="dde6" class="lg lh hi is b it lp ix lq jb lr jf ls jj lt jn ll lm ln lo bi translated"><strong class="is hj">时间戳</strong> —这将自动为我们的模型创建一个createdAt和updatedAt字段。</li></ol><p id="ab11" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们创建模型并导出它</p><pre class="kr ks kt ku fd kv kq kw kx aw ky bi"><span id="2b42" class="kz la hi kq b fi lb lc l ld le">const User = mongoose.model(‘User’, userSchema)<br/>module.exports = User</span></pre><p id="2a3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">物品型号</strong></p><p id="21dd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要创建的下一个模型是<em class="lf">项目</em>模型。在这里，我们将为商店中用户将要购买的商品设计模式。我们将保持我们的项目模式简单，现在将不包括<em class="lf">图像。你当然可以添加产品图片或任何你想添加的额外字段。</em></p><p id="ffba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将在models文件夹内名为<strong class="is hj"> <em class="lf"> Item.js </em> </strong>的文件中构建我们的<em class="lf">项</em>模型。我们首先需要<em class="lf">mongose</em>并创建模式对象。</p><pre class="kr ks kt ku fd kv kq kw kx aw ky bi"><span id="d83e" class="kz la hi kq b fi lb lc l ld le">const mongoose = require(‘mongoose’)<br/>const ObjectID = mongoose.Schema.Types.ObjectId</span></pre><p id="48bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ObjectID是在mongoDB中创建的每个文档的唯一标识符。我们需要用它来将每个创建的条目与创建它的用户联系起来。</p><p id="7bd2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们设计模式</p><pre class="kr ks kt ku fd kv kq kw kx aw ky bi"><span id="9c9f" class="kz la hi kq b fi lb lc l ld le">const itemSchema = new mongoose.Schema({</span><span id="e0f0" class="kz la hi kq b fi lu lc l ld le">owner : {<br/>   type: ObjectID,<br/>   required: true,<br/>   ref: 'User'<br/>},<br/>name: {<br/>   type: String,<br/>   required: true,<br/>   trim: true<br/>},<br/>description: {<br/>  type: String,<br/>  required: true<br/>},<br/>category: {<br/>   type: String,<br/>   required: true<br/>},<br/>price: {<br/>   type: Number,<br/>   required: true<br/>}<br/>}, {<br/>timestamps: true<br/>})</span></pre><p id="b055" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“所有者”字段包含创建该项目的用户的id。它的类型是<strong class="is hj"> <em class="lf"> ObjectID </em> </strong>，因为我们只想要这个用户的ID，而ref是‘User’。ref指向我们想要id的型号。</p><p id="9580" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">项目的名称，它的描述，类别和它的价格是不言自明的。</p><p id="1c0c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们创建模型并导出它。</p><pre class="kr ks kt ku fd kv kq kw kx aw ky bi"><span id="4a50" class="kz la hi kq b fi lb lc l ld le">const Item = mongoose.model('Item', itemSchema)</span><span id="97ec" class="kz la hi kq b fi lu lc l ld le">module.exports = Item</span></pre><p id="043b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">推车型号</strong></p><p id="ff4d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们要构建的下一个模型是购物车模型。购物车包含用户要购买的所有商品。</p><p id="b250" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">购物车模型将包括字段，如所有者，项目和总账单。</p><p id="9753" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们从加载所需的模块开始</p><pre class="kr ks kt ku fd kv kq kw kx aw ky bi"><span id="3c16" class="kz la hi kq b fi lb lc l ld le">const mongoose = require('mongoose')</span><span id="719e" class="kz la hi kq b fi lu lc l ld le">const ObjectID = mongoose.Schema.Types.ObjectId</span></pre><p id="9695" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后我们定义我们的模式</p><pre class="kr ks kt ku fd kv kq kw kx aw ky bi"><span id="f5ff" class="kz la hi kq b fi lb lc l ld le">const cartSchema = new mongoose.Schema({</span><span id="f579" class="kz la hi kq b fi lu lc l ld le">owner : {<br/>  type: ObjectID,<br/>   required: true,<br/>   ref: 'User'<br/> },<br/>items: [{<br/>  itemId: {<br/>   type: ObjectID,<br/>   ref: 'Item',<br/>   required: true<br/>},<br/>name: String,<br/>quantity: {<br/>   type: Number,<br/>   required: true,<br/>   min: 1,<br/>   default: 1},<br/>   price: Number<br/> }],<br/>bill: {<br/>    type: Number,<br/>    required: true,<br/>   default: 0<br/>  }<br/>}, {<br/>timestamps: true<br/>})</span></pre><p id="e1b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该模式有三个字段——所有者、项目和账单。</p><p id="9a97" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Owner </strong> —顾名思义，包含拥有特定购物车的用户的id。</p><p id="46ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">条目</strong> —用户添加到购物车中的所有条目的数组。它还包括一些子字段；<strong class="is hj"> itemId </strong>(加入购物车的物品的唯一id)<strong class="is hj">name</strong>(物品的名称)<strong class="is hj"> quantity </strong>(物品的数量，默认为一个)。</p><p id="3e53" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">账单— </strong>购物车的总账单，如果购物车是空的，默认为0。</p><p id="fbf4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们创建模型并导出它，</p><pre class="kr ks kt ku fd kv kq kw kx aw ky bi"><span id="f4fe" class="kz la hi kq b fi lb lc l ld le">const Cart = mongoose.model('Cart', cartSchema)<br/>module.exports = Cart</span></pre><p id="ba13" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">既然我们已经完成了模型。我们继续创建我们的路由和身份验证。</p><p id="d021" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一部分再见。</p><p id="2661" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae lv" rel="noopener" href="/geekculture/how-i-built-an-e-commerce-api-with-nodejs-express-and-mongodb-part-3-60150d354587">点击此处阅读本系列的第三部分</a></p></div></div>    
</body>
</html>