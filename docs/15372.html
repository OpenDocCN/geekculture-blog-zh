<html>
<head>
<title>How To Connect Database Using IAM Authentication.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用IAM认证连接数据库？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-connect-database-using-iam-authentication-f6733868a976?source=collection_archive---------7-----------------------#2022-10-28">https://medium.com/geekculture/how-to-connect-database-using-iam-authentication-f6733868a976?source=collection_archive---------7-----------------------#2022-10-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ce63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我们将了解IAM认证的实现</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/2cd85bffd8d039c4a7941927c68fd7ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rh0kD_0q96_5YPWxR2CueQ.png"/></div></div></figure><ul class=""><li id="8ed5" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">使用IAM用户或角色凭据和身份验证令牌连接RDS DB实例或集群的IAM身份验证。</li><li id="8a99" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">它比本机身份验证方法更安全</li><li id="08a1" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">这些令牌是使用AWS访问密钥生成的。您不需要存储数据库用户凭证。</li><li id="040b" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">它的寿命只有15分钟，所以我们不需要强制重置密码。</li><li id="71a2" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">如果我们使用EC2实例来连接RDS实例，那么我们可以使用您的EC2实例配置文件凭证来访问数据库。您不需要在实例中存储数据库密码</li></ul><p id="bfb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> S-1在数据库实例上激活IAM数据库验证:</strong></p><ul class=""><li id="2a98" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">打开亚马逊RDS控制台</li><li id="09ba" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">选择<strong class="ih hj">数据库</strong>。</li><li id="eed2" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">选择我们要修改的数据库实例。</li><li id="0321" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">选择<strong class="ih hj">修改</strong></li><li id="8b41" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">在<strong class="ih hj">数据库认证</strong>部分，选择<strong class="ih hj">密码和IAM数据库认证</strong>来启用IAM数据库认证</li><li id="71fa" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">继续</li><li id="29ee" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">选择<strong class="ih hj">立即应用</strong></li></ul><p id="c6ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> S-2创建一个使用AWS认证令牌的数据库用户帐户。</strong></p><ul class=""><li id="4b91" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">创建用户“dbtest ”,并为该用户分配“rds_iam”角色(完成第一步后，我们可以看到rds_iam角色)</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kd"><img src="../Images/80b0362d26b37b058cffad919a852f5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DdUIi4FIJAuphnGUlprwCg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ke"><img src="../Images/a03f1c983f614ed2d61e50222a452b41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bdCQAxnETBI0NINJ1_H_tw.png"/></div></div></figure><p id="645e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> S-3添加将数据库用户映射到IAM角色的IAM策略。</strong></p><ul class=""><li id="6de3" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">选择IAM服务</li><li id="a1df" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">选择<strong class="ih hj">策略</strong></li><li id="ec4f" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">选择创建策略"<strong class="ih hj"> IAM_Authentication </strong>"</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kf"><img src="../Images/e120dc8103e1ddc36aa739c88b0188e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*QgQzi_ODW9kgjg3odZNY_Q.png"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx">5. Choose Next: Tags.</figcaption></figure><ul class=""><li id="11f4" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">选择下一个:<strong class="ih hj">复习</strong>。</li><li id="fef4" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">对于<strong class="ih hj">名称</strong>，输入一个策略名称。</li><li id="8ef3" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">选择<strong class="ih hj">创建策略</strong>。</li></ul><p id="1c2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">S-4将策略附加到IAM角色。</p><ul class=""><li id="1e28" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">选择<strong class="ih hj"> IAM </strong></li><li id="daea" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">从导航窗格中选择<strong class="ih hj">角色</strong>。</li><li id="9b51" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">选择<strong class="ih hj">创建角色“dbtest”并附加IAM策略</strong></li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kk"><img src="../Images/2d6d28537a0e608e5724e6cdbce1b104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*nzQWx7u2Ikslwq2uhcddeA.png"/></div></figure><p id="9f1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> S-5将IAM角色附加到Amazon EC2实例上</strong></p><ul class=""><li id="d10e" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">选择EC2</li><li id="85a1" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">选择ec2机器，我们将通过该Ec2机器将RDS DB连接到该机器</li><li id="15ce" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">选择实例，选择<strong class="ih hj">动作</strong>、<strong class="ih hj">安全</strong>，以及<strong class="ih hj">修改IAM角色</strong>。</li><li id="4b6f" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">选择要附加到实例的IAM角色，并选择<strong class="ih hj">保存</strong>。</li></ul><p id="3ad9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> S-6生成一个AWS认证令牌来标识IAM角色</strong></p><ul class=""><li id="26db" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">要导出RDS主机</li></ul><pre class="je jf jg jh fd kl km kn ko aw kp bi"><span id="379a" class="kq kr hi km b fi ks kt l ku kv">export RDSHOST= psql-test-cpigussgckk-ap-south-1.rds.amazon.com<br/></span></pre><ul class=""><li id="91f4" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">生成AWS身份验证令牌</li></ul><pre class="je jf jg jh fd kl km kn ko aw kp bi"><span id="e5f7" class="kq kr hi km b fi ks kt l ku kv">export PGPASSWORD="$(aws rds generate-db-auth-token --hostname $RDSHOST --port 5432--username dbtest)"</span></pre><ul class=""><li id="89c5" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">要查看密码</li></ul><pre class="je jf jg jh fd kl km kn ko aw kp bi"><span id="3481" class="kq kr hi km b fi ks kt l ku kv">echo $PGPASSWORD</span></pre><ul class=""><li id="8c6b" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">使用psql客户端连接数据库。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/6f454db64666a7c910e6f76b3d455ea3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*GBUqyPmn-emxkp__OBJckg.png"/></div></figure></div></div>    
</body>
</html>