<html>
<head>
<title>How I Create a Whatsapp REST API and CLI to Automate My Messages With Golang (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何创建Whatsapp REST API和CLI来用Golang自动化我的消息(第1部分)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-i-create-a-whatsapp-rest-api-and-cli-to-automate-my-messages-with-golang-part-1-3dd5b805462?source=collection_archive---------5-----------------------#2021-03-25">https://medium.com/geekculture/how-i-create-a-whatsapp-rest-api-and-cli-to-automate-my-messages-with-golang-part-1-3dd5b805462?source=collection_archive---------5-----------------------#2021-03-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/98a0929aea06d08a82eba5f7351f3757.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dw0L2nMd5EtBsWZV"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Photo by <a class="ae hv" href="https://unsplash.com/@jstrippa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">James Harrison</a> on <a class="ae hv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="77a4" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在过去的周末，我在寻找一些编码挑战，在我的搜索中，我发现了一个<a class="ae hv" href="https://github.com/Rhymen/go-whatsapp" rel="noopener ugc nofollow" target="_blank"> golang库</a>，它允许我在扫描库生成的字符串二维码时连接，发送和接收消息，之后这个想法出现在我的脑海中！为什么不创建一个REST API来获取二维码，并创建端点来使用我的WhatsApp会话向任何号码发送消息？</p><h1 id="c18c" class="jt ju hy bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">尝试连接请求中的会话</h1><p id="4de2" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我想到的第一个方法是创建端点，并在请求执行中运行并发WhatsApp连接，比如:</p><figure class="kw kx ky kz fd hk"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="32e2" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是行不通的，我后来发现了这一点，因为响应是在Whatsapp连接关闭后编写的，但二维码是在执行时生成的，所以我想到了一种更大胆的方法来实现响应，而不是停止Whatsapp连接，在开发过程中，我创建了自己的CLI来自动创建样板项目，所以如果我想为Whatsapp连接创建CLI程序，速度非常快。 我认为这样一来，我可以使用Whatsapp REST API中的程序，并且在相同的情况下，CLI将继续运行，假设REST API运行在docker容器上。</p><p id="7b81" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，我向您展示Whatsapp消息传递的CLI:</p><p id="0dfd" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">【https://github.com/jsdaniell/whats-cli T4】</p><p id="c606" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你也可以把它作为一个npm包来安装，或者直接使用它<code class="du lc ld le lf b">npx</code>。如果你的机器上安装了NodeJS，我使用gorelease来生成我将来会在REST API上使用的二进制文件，你可以很容易地用<code class="du lc ld le lf b">npx whats-cli connect-qr</code>进行测试。您可以在<a class="ae hv" href="https://github.com/jsdaniell/whats-cli" rel="noopener ugc nofollow" target="_blank">库</a>上看到其他命令。</p><h1 id="761a" class="jt ju hy bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">在REST API中使用CLI</h1><p id="ebc1" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">现在，我的REST API代码的主要变化是添加CLI二进制下载以使用请求控制器中的命令，所以在运行API之前，我的代码是这样的:</p><figure class="kw kx ky kz fd hk"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="18ca" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">获取Whatsapp CLI，现在只需要运行请求中的命令，并获取响应服务器的执行时输出，因此CLI程序将在执行REST API的Docker机器上继续该过程，我的connect函数现在是:</p><figure class="kw kx ky kz fd hk"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="140d" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">到目前为止，它只支持每个实例一个连接，但它只添加了一个参数来在API运行的docker映像目录上创建一个不同的文件session.gob。</p><h2 id="3214" class="lg ju hy bd jv lh li lj jz lk ll lm kd jg ln lo kh jk lp lq kl jo lr ls kp lt bi translated">在本地测试API</h2><p id="1dd3" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">为了在本地测试API，<a class="ae hv" href="https://github.com/jsdaniell/whats-api" rel="noopener ugc nofollow" target="_blank">克隆git存储库</a>，下载模块依赖项，并运行主文件。</p><p id="0cbc" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lc ld le lf b">go mod download</code></p><p id="b0c6" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lc ld le lf b">go run main.go</code></p><p id="5ed9" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">到目前为止，API的端点有:</p><p id="9ef7" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">获取</strong> : <code class="du lc ld le lf b">https://localhost:9000/getQrCode</code> &gt; <br/> <em class="lu">返回响应上的二维码PNG。</em></p><p id="c932" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">获取</strong> : <code class="du lc ld le lf b">https://localhost:9000/disconnect</code> &gt; <br/> <em class="lu">断开服务器上实际登录的会话。</em></p><p id="1c82" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">发</strong> : <code class="du lc ld le lf b">https://localhost:9000/send</code> &gt; <br/> <em class="lu">给某个号码发消息。</em></p><pre class="kw kx ky kz fd lv lf lw lx aw ly bi"><span id="fd81" class="lg ju hy lf b fi lz ma l mb mc">{<br/> "number": "558599999999",<br/> "message": "Message"<br/>}</span></pre><div class="hh hi ez fb hj md"><a href="https://github.com/jsdaniell/whats-api" rel="noopener  ugc nofollow" target="_blank"><div class="me ab dw"><div class="mf ab mg cl cj mh"><h2 class="bd hz fi z dy mi ea eb mj ed ef hx bi translated">jsdaniell/whats-api</h2><div class="mk l"><h3 class="bd b fi z dy mi ea eb mj ed ef dx translated">这是一个REST API客户端，处理jsdaniell/whats-cli对服务器的HTTP请求，连接和发送消息…</h3></div><div class="ml l"><p class="bd b fp z dy mi ea eb mj ed ef dx translated">github.com</p></div></div><div class="mm l"><div class="mn l mo mp mq mm mr hp md"/></div></div></a></div><p id="026c" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我喜欢写我的存储库，这也是又一个学习自动化的周末，这是在开发中，但所有的工具都准备好了，现在是时候编写自动化工具的代码并撰写本文的第2部分了。</p></div></div>    
</body>
</html>