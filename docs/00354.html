<html>
<head>
<title>How to Deploy a Django App on Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Heroku上部署Django应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-deploy-a-django-app-on-heroku-4d696b458272?source=collection_archive---------0-----------------------#2021-01-22">https://medium.com/geekculture/how-to-deploy-a-django-app-on-heroku-4d696b458272?source=collection_archive---------0-----------------------#2021-01-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="8775" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">一步一步的指南。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/638dc08dfcab1bc1cc228da71a00a538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PK2u6RWGJyiEkpeN"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@jstrippa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">James Harrison</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="101e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是一些开发人员感到失落的时刻:部署时间。一些应该是微不足道的事情，有时不是，但它根本不应该这么难——事实上，它不是。希望在本指南结束时，您能够在Heroku上托管您的Django项目，Heroku是一个很好的云服务，尤其是因为Heroku是一个云PaaS(平台即服务),并且还提供了一个免费的计划，您可以使用该计划部署您的项目，并提供完整的数据库供应。</p><p id="cfa3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在开始之前，您必须对您的项目进行一些配置，以使它在服务器上工作。开发和生产之间是有区别的，本教程将引导你通过它。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><p id="6259" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="kk">注意:我假设你使用的是</em> <strong class="jq hj"> <em class="kk">虚拟环境</em> </strong> <em class="kk">。您还必须创建一个</em> <code class="du ks kt ku kv b"><strong class="jq hj"><em class="kk">requirements.txt</em></strong></code> <em class="kk">文件，并将运行web应用程序所需的所有python包(包括Django本身)添加到其中。如果您还没有创建这个文件，那么您可以在您的终端上运行下面的命令:</em></p><pre class="iy iz ja jb fd kw kv kx ky aw kz bi"><span id="9952" class="la lb hi kv b fi lc ld l le lf"><em class="kk">pip3 freeze &gt; requirements.txt</em></span></pre></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><p id="5030" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">首先你需要一个<code class="du ks kt ku kv b"><strong class="jq hj">Procfile</strong></code>，用来声明应用进程类型。该文件必须位于项目的根目录中。您可以在终端上运行以下命令来创建一个:</p><pre class="iy iz ja jb fd kw kv kx ky aw kz bi"><span id="afae" class="la lb hi kv b fi lc ld l le lf"><em class="kk">echo "</em><em class="kk">web: gunicorn PROJECT_NAME.wsgi" &gt; Procfile</em></span></pre><p id="a88e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">其中<code class="du ks kt ku kv b"><strong class="jq hj">PROJECT_NAME</strong></code>是您的Django项目的名称。</p><p id="dff1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">接下来，您需要安装一些包来使应用程序在服务器上工作。这些是必需的软件包:</p><ul class=""><li id="6f21" class="lg lh hi jq b jr js ju jv jx li kb lj kf lk kj ll lm ln lo bi translated">gunicorn(一个应用服务器)</li><li id="db62" class="lg lh hi jq b jr lp ju lq jx lr kb ls kf lt kj ll lm ln lo bi translated">DJ-数据库-url(用于数据库)</li><li id="727d" class="lg lh hi jq b jr lp ju lq jx lr kb ls kf lt kj ll lm ln lo bi translated">whitenoise(用于服务静态文件)</li><li id="ebe0" class="lg lh hi jq b jr lp ju lq jx lr kb ls kf lt kj ll lm ln lo bi translated">psycopg2(用于postgres数据库)</li></ul><p id="9b13" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要一次性安装它们，只需在您的终端上运行:</p><p id="dbab" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><code class="du ks kt ku kv b"><em class="kk">pip3 install gunicorn dj-database-url whitenoise psycopg2-binary</em></code></p><p id="68b3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">安装完成后，将它们添加到您的需求中。</p><p id="9fd6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><code class="du ks kt ku kv b"><em class="kk">pip3 freeze &gt; requirements.txt</em></code></p><p id="bc84" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在您必须在根目录下创建一个<code class="du ks kt ku kv b"><strong class="jq hj">runtime.txt</strong></code>文件——就像Procfile一样——并添加您正在使用的python版本。要检查您使用的python版本，请运行:</p><pre class="iy iz ja jb fd kw kv kx ky aw kz bi"><span id="b240" class="la lb hi kv b fi lc ld l le lf"><em class="kk">python3 --version</em></span></pre><p id="6c0a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">输出将是这样的:</p><pre class="iy iz ja jb fd kw kv kx ky aw kz bi"><span id="2342" class="la lb hi kv b fi lc ld l le lf"><em class="kk">Python 3.8.5</em></span></pre><p id="62e0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">由于我使用的是<strong class="jq hj"> Python 3.8.5 </strong>，为了创建<em class="kk">运行时</em>文件并添加Python版本，我可以运行以下命令:</p><pre class="iy iz ja jb fd kw kv kx ky aw kz bi"><span id="c15b" class="la lb hi kv b fi lc ld l le lf"><em class="kk">echo "python-3.8.5" &gt; runtime.txt</em></span></pre><p id="6e16" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你还应该创建一个<code class="du ks kt ku kv b"><strong class="jq hj">.gitignore</strong></code>文件，并在其中添加<em class="kk"> sqlite </em> <em class="kk">数据库</em>，只要<em class="kk">虚拟环境文件夹</em>。要执行此运行，请执行以下操作:</p><pre class="iy iz ja jb fd kw kv kx ky aw kz bi"><span id="088b" class="la lb hi kv b fi lc ld l le lf">echo "db.sqlite3" &gt; .gitignore<br/>echo "env/" &gt;&gt; .gitignore</span></pre><p id="db06" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">其中<code class="du ks kt ku kv b"><strong class="jq hj">env/</strong></code>是您的虚拟环境的名称。</p><p id="39e0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="kk">注意:第二个命令应该使用两个箭头(&gt; &gt;)，而不是一个箭头(&gt;)，因为你要追加到文件中。使用一个单独的箭头(&gt;)将文件内容替换为新的内容。</em> </strong></p><p id="7e50" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，您必须配置一些项目文件，以使应用程序在服务器上工作。首先，转到<code class="du ks kt ku kv b"><strong class="jq hj">settings.py</strong></code>文件并执行以下操作:</p><ul class=""><li id="30b0" class="lg lh hi jq b jr js ju jv jx li kb lj kf lk kj ll lm ln lo bi translated">为了让<code class="du ks kt ku kv b"><strong class="jq hj">whitenoise</strong></code>处理静态文件，您必须在<code class="du ks kt ku kv b"><strong class="jq hj">INSTALLED_APPS</strong></code>的列表中添加下面一行:</li></ul><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lu lv l"/></div></figure><ul class=""><li id="97d9" class="lg lh hi jq b jr js ju jv jx li kb lj kf lk kj ll lm ln lo bi translated">将以下行添加到<code class="du ks kt ku kv b"><strong class="jq hj">ALLOWED_HOSTS</strong></code>列表中:</li></ul><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lu lv l"/></div></figure><ul class=""><li id="c382" class="lg lh hi jq b jr js ju jv jx li kb lj kf lk kj ll lm ln lo bi translated">您还必须将<strong class="jq hj">调试</strong>设置为<strong class="jq hj">假</strong>:</li></ul><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lu lv l"/></div></figure><ul class=""><li id="dc7f" class="lg lh hi jq b jr js ju jv jx li kb lj kf lk kj ll lm ln lo bi translated">现在您必须将<code class="du ks kt ku kv b"><strong class="jq hj">whitenoise</strong></code>添加到<code class="du ks kt ku kv b"><strong class="jq hj">MIDDLEWARE</strong></code>列表中，但这部分比较棘手—<em class="kk"/><strong class="jq hj"><em class="kk">whiten waise中间件应该包含在</em> </strong> <em class="kk"> </em> <code class="du ks kt ku kv b"><strong class="jq hj"><em class="kk">django.middleware.security.SecurityMiddleware</em></strong></code>之后</li></ul><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lu lv l"/></div></figure><ul class=""><li id="3dc9" class="lg lh hi jq b jr js ju jv jx li kb lj kf lk kj ll lm ln lo bi translated">现在您必须添加静态文件的配置。在你的<code class="du ks kt ku kv b"><strong class="jq hj">settings.py</strong></code>底部，加上这几行:</li></ul><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lu lv l"/></div></figure><h2 id="9166" class="la lb hi bd lw lx ly lz ma mb mc md me jx mf mg mh kb mi mj mk kf ml mm mn mo bi translated">最后，但同样重要的是，您必须配置Postgres数据库</h2><ul class=""><li id="8ab0" class="lg lh hi jq b jr mp ju mq jx mr kb ms kf mt kj ll lm ln lo bi translated">在<code class="du ks kt ku kv b"><strong class="jq hj">DATABASES</strong></code>字典之后，添加以下几行:</li></ul><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="96e3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">是的，这是很多，但现在你的应用程序已经准备好了。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h2 id="0b3a" class="la lb hi bd lw lx ly lz ma mb mc md me jx mf mg mh kb mi mj mk kf ml mm mn mo bi translated">Heroku部分</h2><p id="8b0d" class="pw-post-body-paragraph jo jp hi jq b jr mp ij jt ju mq im jw jx mu jz ka kb mv kd ke kf mw kh ki kj hb bi translated">现在你必须建立你的Heroku账户(如果你没有的话)。这里可以做<a class="ae jn" href="https://signup.heroku.com/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="7e73" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你还必须安装Heroku-CLI 。如果您在Mac上，您可以安装运行:</p><pre class="iy iz ja jb fd kw kv kx ky aw kz bi"><span id="4141" class="la lb hi kv b fi lc ld l le lf"><em class="kk">brew install heroku/brew/heroku</em></span></pre><p id="2884" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果您使用的是Linux (Ubuntu)，请运行:</p><pre class="iy iz ja jb fd kw kv kx ky aw kz bi"><span id="d1af" class="la lb hi kv b fi lc ld l le lf"><em class="kk">sudo snap install heroku --classic</em></span></pre><p id="ba87" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在Windows上，你必须下载安装程序，这可以从<a class="ae jn" href="https://devcenter.heroku.com/articles/getting-started-with-python#set-up" rel="noopener ugc nofollow" target="_blank">这个页面</a>完成。</p><p id="99e5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">安装完成后，您必须登录。在您的终端上，运行:</p><pre class="iy iz ja jb fd kw kv kx ky aw kz bi"><span id="2180" class="la lb hi kv b fi lc ld l le lf"><em class="kk">heroku login</em></span></pre><p id="1459" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">…并按照说明进行操作。</p><p id="88cb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，要创建一个新的应用程序，运行:</p><pre class="iy iz ja jb fd kw kv kx ky aw kz bi"><span id="0d6f" class="la lb hi kv b fi lc ld l le lf"><em class="kk">heroku create PROJECT_NAME</em></span></pre><p id="1a43" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">其中<code class="du ks kt ku kv b"><strong class="jq hj">PROJECT_NAME</strong></code>是项目的名称。</p><p id="9b40" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">接下来，提交您的更改并推动您的项目部署您的应用程序:</p><pre class="iy iz ja jb fd kw kv kx ky aw kz bi"><span id="ce47" class="la lb hi kv b fi lc ld l le lf"><em class="kk">git add -A<br/>git commit -am "commit message"<br/>git push heroku master</em></span></pre><p id="72c4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">就这样，恭喜你！您刚刚部署了您的应用。但是您仍然需要配置数据库。要添加Postgres附加组件，您必须运行:</p><pre class="iy iz ja jb fd kw kv kx ky aw kz bi"><span id="2c0d" class="la lb hi kv b fi lc ld l le lf"><em class="kk">heroku addons:create heroku-postgresql:hobby-dev --app PROJECT_NAME</em></span></pre><p id="0793" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">其中<code class="du ks kt ku kv b"><strong class="jq hj">PROJECT_NAME</strong></code>是您项目的名称。</p><p id="bfdc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在您迁移到数据库:</p><pre class="iy iz ja jb fd kw kv kx ky aw kz bi"><span id="76c3" class="la lb hi kv b fi lc ld l le lf"><em class="kk">heroku run python manage.py migrate</em></span></pre><p id="b291" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后，您必须创建一个超级用户:</p><pre class="iy iz ja jb fd kw kv kx ky aw kz bi"><span id="95f9" class="la lb hi kv b fi lc ld l le lf"><em class="kk">heroku run python manage.py createsuperuser</em></span></pre><p id="807b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果一切顺利，您已经成功部署了Django应用程序。要打开您的应用程序，请运行:</p><pre class="iy iz ja jb fd kw kv kx ky aw kz bi"><span id="fa02" class="la lb hi kv b fi lc ld l le lf"><em class="kk">heroku open</em></span></pre><h1 id="525c" class="mx lb hi bd lw my mz na ma nb nc nd me io ne ip mh ir nf is mk iu ng iv mn nh bi translated">全部完成！</h1><p id="e417" class="pw-post-body-paragraph jo jp hi jq b jr mp ij jt ju mq im jw jx mu jz ka kb mv kd ke kf mw kh ki kj hb bi translated">如果你走到这一步，恭喜你！你不仅将你的项目部署到了Heroku，还学到了很多新东西——我希望如此。</p><p id="784e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">感谢阅读！</p></div></div>    
</body>
</html>