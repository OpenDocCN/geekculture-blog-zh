<html>
<head>
<title>Trajectory Generation in C++</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">C++中的轨迹生成</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/trajectory-generation-in-c-da36521128aa?source=collection_archive---------4-----------------------#2022-02-27">https://medium.com/geekculture/trajectory-generation-in-c-da36521128aa?source=collection_archive---------4-----------------------#2022-02-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/eb1850ec429a62bf43aa768ebd95a8d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N4Fo5TI9Gs_w9JSmzJu_qw.png"/></div></div></figure><div class=""/><p id="d960" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面的文章展示了机器人(这里是工业机械手)轨迹生成的常用方法。在我以前的文章中，我描述了找到目标的算法。例如，我们可以看到<a class="ae jo" rel="noopener" href="/geekculture/3d-rrt-algorithm-for-robot-path-planner-in-c-222133509d28"><strong class="is hu"/></a>或<a class="ae jo" rel="noopener" href="/geekculture/graph-algorithms-in-c-161d2d3c245"> <strong class="is hu"> Dijkstra </strong> </a>算法在起作用。算法找到了到达目标的最短或最佳路径。我在2D和3D空间中描绘了解决方案。<br/>在机器人控制系统中，路径规划器负责寻找无碰撞路径(请再次考虑下图)。</p><p id="edb5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请不要忘记本文中的模拟是用C++生成的。源代码你会在我的<a class="ae jo" href="https://github.com/markusbuchholz/trajectory_generation_in_cpp" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> GitHub </strong> </a>上找到。图由外部库生成，您可以下载并添加到项目中，如下所示:</p><p id="17de" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://github.com/lava/matplotlib-cpp" rel="noopener ugc nofollow" target="_blank">头文件</a>(用于绘图库)必须与你的cpp在同一个文件夹中。</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="2c06" class="jy jz ht ju b fi ka kb l kc kd">//compile<br/>g++ my_prog.cpp -o my_prog -I/usr/include/python3.8 -lpython3.8</span><span id="b557" class="jy jz ht ju b fi ke kb l kc kd">//run<br/>./my_prog</span><span id="17ee" class="jy jz ht ju b fi ke kb l kc kd">//folder tree<br/>├── my_prog<br/>├── my_prog.cpp<br/>├── matplotlibcpp.h</span></pre><p id="e6ff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了解代数方程，我还使用了特征库。为了下载并实现到您的代码讨论库中，请遵循以下步骤:</p><p id="dca9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了使用<a class="ae jo" href="https://eigen.tuxfamily.org/index.php?title=Main_Page" rel="noopener ugc nofollow" target="_blank"> Eigen C++库</a>，请访问网站。将eigen repo下载到机器上您最喜欢的位置，并(对于Linux用户)创建软链接。</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="ef04" class="jy jz ht ju b fi ka kb l kc kd">git clone <a class="ae jo" href="https://gitlab.com/libeigen/eigen.git" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/libeigen/eigen.git</a></span><span id="2d0b" class="jy jz ht ju b fi ke kb l kc kd">sudo ln -s /usr/include/eigen3/Eigen /usr/local/include/</span><span id="fe0d" class="jy jz ht ju b fi ke kb l kc kd">/usr/include/eigen3/Eigen  -- location of your clone library</span></pre><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kf"><img src="../Images/d293b85500cfed07193f562aa222ebc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ch_qsW0kpLeXjKh7MzbraQ.png"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx">by author</figcaption></figure><p id="5967" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">路径规划器为机器人准备了地图，但是没有指定速度和加速度。在这一阶段，机器人没有关于在路径的每一步应该达到的时间、速度或加速度的信息。这里的时间步长与机器人控制器时间步长相关，即控制信号产生的频率。此时，我们无法预测机器人的运动(我们不指定机器人路径上的机器人速度或加速度)，因此机器人的运动可能是不平稳的。当物体以一定速度移动时，我们不能给机器人指令，机器人必须跟随物体。另外我们不能规定机器人过渡到目标的时间。</p><p id="0799" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些约束迫使寻找<strong class="is hu">机器人轨迹，</strong>机器人轨迹从计算路径(在路径规划器中)导出，然后映射到时间函数中(机器人在时域中的位置、速度和加速度)。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><p id="3fbb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请记住(简化)。当机器人需要到达某个点时，不管路径如何(当物体必须被拾取到某个随机位置时的拾取和放置应用，例如由摄像机感知)，第一个路径规划器计算路径(点到点)。有了无碰撞路径、时间和速度约束(通常还有加速度),就可以计算每个关节的轨迹。实现点对点的路径几乎有无限的可能性(轨迹)。当在<strong class="is hu">关节空间</strong>中计算轨迹时，不需要计算逆运动学。</p><p id="1ed4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在机器人的末端执行器必须线性移动的情况下——<strong class="is hu">任务空间</strong>(如喷漆机器人或焊接机器人)，因此在这种情况下，必须应用反向运动学来计算关节的位置。在这篇文章中，我不打算描述这种情况，悬停反向运动学求解器在C++我在这篇文章中讨论。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="bcfc" class="kr jz ht bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">轨迹生成。点对点运动</h1><p id="453e" class="pw-post-body-paragraph iq ir ht is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">当机器人从一点移动到另一点时(在关节空间配置中)，必须计算时标轨迹<strong class="is hu"> s(t) </strong>。轨迹的计算方式必须确保机器人的运动是平稳的，并且满足某些约束条件，如速度和加速度。</p><p id="5102" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">取决于机械手运动约束:机器人位置、速度和加速度，必须应用多项式的适当阶来计算关节轨迹。</p><p id="9634" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通常应用<strong class="is hu">三阶(三次)</strong>多项式(四个未知系数)允许考虑四个约束。初始位置，最终位置，初始速度和最终速度。<br/>为了考虑初始和最终加速度，我们必须应用<strong class="is hu">五次多项式(五次)</strong>。<br/>此外，加加速度(初始和最终)也可作为运动约束进行评估。这种情况需要七阶多项式。请注意，在计算由四个点指定的轨迹运动时，同阶多项式(七阶)可以重复使用(后面的例子。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lt"><img src="../Images/8891708e2e831dc5bd023c8495521cfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VyKCJ7I4L0dmp_TMELqSxg.png"/></div></div></figure></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="2ce6" class="kr jz ht bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">三次多项式轨迹</h1><p id="356b" class="pw-post-body-paragraph iq ir ht is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">三次多项式定义如下，</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lu"><img src="../Images/a46e3aa3b93fb98a8cd36315b66ee3eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*juCpKALsWFWSFVwH3TxkBg.png"/></div></div></figure><p id="4854" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为它包括四个未知系数，所以我们能够指定四个约束(两个用于位置，两个用于速度)。对于开始和结束时间，这些等式可以表示如下:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lv"><img src="../Images/9a96275131b73e519b46a7b490d7658f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rMIHIkeoGOzZ_YoSVxYAZQ.png"/></div></div></figure><p id="e6bf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，给定的方程可以组合成矩阵方程，</p><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es lw"><img src="../Images/6609dcc040460115b8115b0150ada551.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*MQlQEt-m-Rzztk0Dgn8iQw.png"/></div></figure></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><p id="72d7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每个矩阵方程(用C++描述和实现)已经使用特征库求解。</p><p id="4ed4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">矩阵方程可以表示为:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lx"><img src="../Images/bee0bee74144b5457415f3ad1d45684d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lRRmnIek-DE3MzG6fAWe-w.png"/></div></div></figure><p id="25dd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">求解方法(对于三次多项式)也适用于下面文章中演示的其他阶多项式(五次和七次)。</p><p id="c432" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有了多项式系数，我们就能够计算(在迭代过程中)轨迹(参见C++代码)。</p><p id="2648" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设(见代码)一个机器人关节t0 = 0；TF = 2；Q0 = 10度，qf = 14度，v 0 = 50度/秒；vf =度/秒；我们可以计算运动轨迹:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ly"><img src="../Images/b81547a03d8a5a18f2e6481280004dbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SSXjXiNbOKNtlUK9jrIZJw.png"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx">blue, orange means respectively: joint position and velocity</figcaption></figure></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="5bad" class="kr jz ht bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated"><strong class="ak">五次多项式</strong></h1><p id="b349" class="pw-post-body-paragraph iq ir ht is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">类似于三次多项式，我们可以为五次多项式指定方程。这种类型的多项式由六个未知系数指定，因此加速度作为约束可以包括在机器人运动的规范中。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lz"><img src="../Images/a4b6799f12c66c4cfe6f20be06febfc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yHEiJaFeh0ATfVDiXYoi1w.png"/></div></div></figure><p id="88b6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设(见代码)一个机器人关节t0 = 0；TF = 2；Q0 = 0度，qf = 40度，v 0 = 50度/秒；vf =度/秒；acc0 =度/S2；accf = 0 deg/S2；我们可以计算运动轨迹:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ma"><img src="../Images/87ac5f9f1ef62865a3011354d81f5c50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Et_ohksEs9aw3R08krI2g.png"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx">blue, orange, green means respectively: joint position, velocity and acceleration</figcaption></figure></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="00a5" class="kr jz ht bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">7阶多项式</h1><p id="6c9b" class="pw-post-body-paragraph iq ir ht is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">这种类型的多项式由八个未知系数指定，因此加速度的导数(加加速度)作为约束可以包括在机器人运动的规范中。如前所述，我在计算由四个点指定轨迹运动时使用了这种类型的多项式(见下面的例子和C++代码)。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mb"><img src="../Images/ad10ecd76dbab840aa710b7caf9e739a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qquDYjUz5y-eOt7HxepbGg.png"/></div></div></figure><p id="d453" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设(见代码)一个机器人关节t0 = 0；TF = 1；q0 =度，qf = 45度，v 0 = 50度/秒；vf =度/秒；acc0 =度/S2；accf = 0 deg/S2；Q1(0.4s)= 20度；Q1(0.7s)= 30度我们可以计算运动轨迹:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mc"><img src="../Images/5e41b6660c3ff596ecef7f2bb8eeb590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MkjMj35MOvKnWZgrY6ZSPg.png"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx">blue, orange, green, red means respectively: joint position, velocity, acceleration and jerk. Note : curves are scaled -&gt; see code.</figcaption></figure><p id="f961" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>