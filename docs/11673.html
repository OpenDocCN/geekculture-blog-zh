<html>
<head>
<title>Using SiriDB for IoT applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将SiriDB用于物联网应用</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/using-siridb-for-iot-applications-c9c7ef53ade5?source=collection_archive---------12-----------------------#2022-04-03">https://medium.com/geekculture/using-siridb-for-iot-applications-c9c7ef53ade5?source=collection_archive---------12-----------------------#2022-04-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c7a836c8f0c6b4289a9c4cdabbf34773.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f39rlxGnke1rCcMtKgs1Mg.png"/></div></div></figure><p id="c9c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">物联网长期以来一直是最受欢迎的技术趋势之一，这是有道理的。它提供了许多可能性和优势。这包括监测数据，如家中的温度或空气质量。但是这些数据必须存储在某个地方以备后用。最好是通过使用非常高效的解决方案，因为物联网设备通常没有很多计算能力。一个非常合适的解决方案是SiriDB。一个超级快速和非常强大的时间序列数据库。</p><p id="d17a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本帖中，我们将向您展示如何轻松构建一个气象站，使用SiriDB作为其所有测量的数据库。对于这个气象站，我们使用了树莓皮(3型号B)与Sense帽子相结合。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="eb58" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">先决条件</strong></h1><p id="882d" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated"><strong class="is hj">硬件</strong></p><ul class=""><li id="dd3c" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">树莓派</li><li id="3dc8" class="ky kz hi is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">感官帽</li></ul><p id="2f53" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">软件</strong></p><p id="997a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您将需要最新版本的Raspberry Pi操作系统，它已经包含以下软件包:</p><ul class=""><li id="ae5c" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">Python 3</li><li id="2fe1" class="ky kz hi is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">Python 3的Sense HAT</li></ul><p id="055d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果出于任何原因，您需要手动安装Sense HAT包，请在您的Raspberry Pi上执行以下命令:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="89fa" class="lw jw hi ls b fi lx ly l lz ma">$ sudo apt-get install sense-hat</span></pre></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="b19b" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">设置</strong></h1><p id="05c5" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">现在我们的Raspberry Pi已经准备好了，我们需要遵循几个步骤来安装SiriDB。</p><p id="d43e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，安装所需的SiriDB依赖项:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="ad5c" class="lw jw hi ls b fi lx ly l lz ma">$ sudo apt install libcleri-dev libpcre2-dev libuv1-dev libyajl-dev uuid-dev</span></pre><p id="4316" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下载SiriDB的源代码:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="64e4" class="lw jw hi ls b fi lx ly l lz ma">$ wget <a class="ae lm" href="https://github.com/SiriDB/siridb-server/archive/refs/tags/2.0.46.zip`" rel="noopener ugc nofollow" target="_blank">https://github.com/SiriDB/siridb-server/archive/refs/tags/2.0.46.zip</a></span></pre><blockquote class="mb mc md"><p id="5db7" class="iq ir me is b it iu iv iw ix iy iz ja mf jc jd je mg jg jh ji mh jk jl jm jn hb bi translated"><strong class="is hj">注意</strong>:修改URL中的版本，获取最新版本的SiriDB。</p></blockquote><p id="3238" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在解压缩下载的zip文件:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="9f10" class="lw jw hi ls b fi lx ly l lz ma">$ unzip 2.0.46.zip`</span></pre><p id="b58a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之后，编译源代码:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="c448" class="lw jw hi ls b fi lx ly l lz ma">$ cd siridb-server-2.0.46/Release/<br/>$ make clean<br/>$ make</span></pre><p id="53c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后安装SiriDB:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="53f2" class="lw jw hi ls b fi lx ly l lz ma">$ sudo make install`</span></pre><p id="cc45" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，使用pip安装Python 的<a class="ae lm" href="https://pypi.org/project/siridb-connector/" rel="noopener ugc nofollow" target="_blank"> SiriDB连接器(推荐)，该连接器将在后面的步骤中使用:</a></p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="0e7e" class="lw jw hi ls b fi lx ly l lz ma">$ pip install siridb-connector</span></pre></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="b351" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">配置</strong></h1><p id="ce22" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">太好了！SiriDB现已安装。但是为了让SiriDB在启动时自动启动，需要将下面名为<code class="du mi mj mk ls b">siridb-server.service</code>的文件添加到<code class="du mi mj mk ls b">/etc/systemd/system</code>文件夹中:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="da62" class="lw jw hi ls b fi lx ly l lz ma">[Unit]<br/>Description=SiriDB Server<br/>After=network.target</span><span id="8f01" class="lw jw hi ls b fi ml ly l lz ma">[Service]<br/>Environment=”SIRIDB_HTTP_API_PORT=9020"<br/>ExecStart=/usr/bin/siridb-server<br/>StandardOutput=journal<br/>LimitNOFILE=65535<br/>TimeoutStartSec=10<br/>TimeoutStopSec=300</span><span id="7d32" class="lw jw hi ls b fi ml ly l lz ma">[Install]<br/>WantedBy=multi-user.target</span></pre><blockquote class="mb mc md"><p id="3a94" class="iq ir me is b it iu iv iw ix iy iz ja mf jc jd je mg jg jh ji mh jk jl jm jn hb bi translated"><strong class="is hj">注意</strong>:必须添加环境变量<code class="du mi mj mk ls b">SIRIDB_HTTP_API_PORT</code>，因为如果不设置HTTP API端口(或0)，SiriDB的API服务将不会启动。查看<a class="ae lm" href="https://docs.siridb.net/getting_started/configuration/" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多关于在SiriDB中使用环境变量的信息。</p></blockquote><p id="4d12" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们需要重新加载守护进程，让系统知道新添加的服务:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="3ea9" class="lw jw hi ls b fi lx ly l lz ma">$ sudo systemctl daemon-reload</span></pre><p id="8554" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们启用我们的服务，以便它在Raspberry Pi重启时不会被禁用:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="e149" class="lw jw hi ls b fi lx ly l lz ma">$ sudo systemctl enable siridb-server.service</span></pre><p id="7fbb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们开始我们的服务:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="97ef" class="lw jw hi ls b fi lx ly l lz ma">$ sudo systemctl start siridb-server.service</span></pre><p id="e2ed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">SiriDB服务器现在在后台运行。</p><p id="8fd2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就配置而言，唯一要做的就是在SiriDB中创建一个数据库。为此，我们使用了<a class="ae lm" href="https://docs.siridb.net/connect/http_api/" rel="noopener ugc nofollow" target="_blank"> SiriDB HTTP API </a>。SiriDB有一个默认的<a class="ae lm" href="https://docs.siridb.net/overview/service_account/" rel="noopener ugc nofollow" target="_blank">服务帐户</a>，用户名为<code class="du mi mj mk ls b">sa</code>，密码为<code class="du mi mj mk ls b">siri</code>，我们将使用这个帐户。对于我们的教程，我们只需要第二个精度数据库。我们还为这个数据库选择了一个持续时间为6小时的<a class="ae lm" href="https://docs.siridb.net/shards/" rel="noopener ugc nofollow" target="_blank">分片</a>，因为我们的测量间隔只有几秒钟。有时，您可能希望每小时甚至每天存储一个测量值。在这种情况下，通过使用更大的碎片持续时间，您的数据库会有更好的性能。</p><p id="a990" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在端口9020上运行的SiriDB服务器上使用cURL和基本身份验证创建数据库:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="5c1e" class="lw jw hi ls b fi lx ly l lz ma">$ curl --location --request POST ‘http://localhost:9020/new-database' \<br/>--header ‘Content-Type: application/json’ \<br/>--header ‘Authorization: Basic c2E6c2lyaQ==’ \<br/>--header ‘Content-Type: text/plain’ \<br/>--data-raw ‘{<br/>    “dbname”: “iot”,<br/>    “time_precision”: “s”,<br/>    “buffer_size”: 8192,<br/>    “duration_num”: “6h”,<br/>    “duration_log”: “3d”<br/>}’</span></pre><blockquote class="mb mc md"><p id="ae91" class="iq ir me is b it iu iv iw ix iy iz ja mf jc jd je mg jg jh ji mh jk jl jm jn hb bi translated"><strong class="is hj">注意</strong>:传递给头参数<code class="du mi mj mk ls b">Authorization</code>的值是单词Basic word后跟一个空格和一个base64编码的字符串<code class="du mi mj mk ls b">username:password</code>。有关SiriDB中认证的更多信息，请参见<a class="ae lm" href="https://docs.siridb.net/connect/http_api/#authentication" rel="noopener ugc nofollow" target="_blank">文档</a>。</p></blockquote></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="b225" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">收集数据</strong></h1><p id="41db" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">为了收集数据，我们使用Python 3和Sense HAT包。</p><p id="c1bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面名为<code class="du mi mj mk ls b">sense.py</code>的Python脚本包含了使用Raspberry Pi Sense HAT收集一些关键测量值并将其写入SiriDB所需的最少代码:</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="1ce3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将脚本添加到您的Raspberry Pi中，并以下列内容开始:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="4047" class="lw jw hi ls b fi lx ly l lz ma">$ python sense.py</span></pre><p id="fd77" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了验证一切工作正常，您现在应该每10秒钟在Sense Hat上看到一条消息:</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/1292ace9bacfdf249283eefaa43eea46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bQ6rNZwH0PdKWLsQ5fPAag.jpeg"/></div></div><figcaption class="mp mq et er es mr ms bd b be z dx">Image 1, Our weather station running the Python script.</figcaption></figure><blockquote class="mb mc md"><p id="552a" class="iq ir me is b it iu iv iw ix iy iz ja mf jc jd je mg jg jh ji mh jk jl jm jn hb bi translated"><strong class="is hj">注意</strong>:我们的摄像头无法很好地捕捉到来自LED矩阵的信息，但它确实显示了正确的温度。(当然，假设你相信我们🙂)</p></blockquote></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="9d5e" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">可视化</strong></h1><p id="af35" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">仅此而已。一些关键测量现在每10秒自动收集一次并写入SiriDB。</p><p id="325e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，如果能从这些数据中获得一些见解，那就更有价值了。这可以使用Grafana这样的可视化应用程序来完成，SiriDB为此制作了一个现成的插件:<a class="ae lm" href="https://github.com/SiriDB/grafana-siridb-http-datasource" rel="noopener ugc nofollow" target="_blank">Grafana-SiriDB-http-data source</a>。</p><p id="2d40" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Grafana如何与SiriDB结合使用在这里解释<a class="ae lm" href="https://siridb.com/blog/update-example-grafana-using-siridb-http-api/" rel="noopener ugc nofollow" target="_blank">。但在下面，您已经可以看到该应用中的测量数据:</a></p><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/eb706e6a3e9c10a0aee49ee4b2f6b1d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dkY7BvRgEOd75CK5Z-KSVA.png"/></div></div><figcaption class="mp mq et er es mr ms bd b be z dx">Image 2, Collected data visualized in Grafana.</figcaption></figure></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="c47f" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">结论</strong></h1><p id="641d" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">在这篇博客文章中，我们一步一步地展示了为物联网应用部署SiriDB是多么容易和有效。现在你已经有足够的信息可以自己开始使用SiriDB了！</p><p id="7bbb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想了解更多关于SiriDB的信息，你可以访问位于https://docs.siridb.netT4的官方文档页面。</p></div></div>    
</body>
</html>