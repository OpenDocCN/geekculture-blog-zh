<html>
<head>
<title>Face Detection in 2 Minutes using OpenCV &amp; Python — Google colab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OpenCV和Python在2分钟内进行人脸检测——Google colab</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/face-detection-in-2-minutes-using-opencv-python-google-colab-f32531c64741?source=collection_archive---------3-----------------------#2021-07-25">https://medium.com/geekculture/face-detection-in-2-minutes-using-opencv-python-google-colab-f32531c64741?source=collection_archive---------3-----------------------#2021-07-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/4f1e963e9efb8590bc32a057945814b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VMpxQUN9y0t4YaALS4SLlg.png"/></div></div></figure><h2 id="c592" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">在这篇快速的帖子中，我想分享一种在OpenCV和Python中使用Haar级联检测人脸的非常流行和简单的方法</h2><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es jo"><img src="../Images/9743b19d3f594069ce697f743354b5fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*8stdZMTY3tWlrM_33gS3cQ.gif"/></div></figure><p id="0b50" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated">为此我使用了google collab，首先，确保你已经安装了OpenCV。您可以使用pip安装它:</p><pre class="jp jq jr js fd ko kp kq kr aw ks bi"><span id="b4cd" class="iq ir hi kp b fi kt ku l kv kw">pip install opencv-python</span></pre><p id="407f" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated">请确保已经安装了这些库。</p><p id="0b82" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated"><strong class="jv hj">步骤01，02，03，04 </strong></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/26d94020f4dc89e530b8b39c90cc6edf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jSvOZuAVWnATnPpwEgxhLA.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx">Step 01,02,03,04</figcaption></figure><p id="914d" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated">在检测面部之前，我们应该使用google collab打开网络摄像头。</p><p id="f1bc" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated"><strong class="jv hj">第05步</strong></p><pre class="jp jq jr js fd ko kp kq kr aw ks bi"><span id="8d66" class="iq ir hi kp b fi kt ku l kv kw">from IPython.display import display, Javascript</span><span id="19a4" class="iq ir hi kp b fi lc ku l kv kw">from google.colab.output import eval_js</span><span id="af5c" class="iq ir hi kp b fi lc ku l kv kw">from base64 import b64decode</span><span id="598e" class="iq ir hi kp b fi lc ku l kv kw">def take_photo(filename='photo.jpg', quality=0.8):</span><span id="b4e4" class="iq ir hi kp b fi lc ku l kv kw">js = Javascript('''</span><span id="ed4c" class="iq ir hi kp b fi lc ku l kv kw">async function takePhoto(quality) {</span><span id="2b56" class="iq ir hi kp b fi lc ku l kv kw">const div = document.createElement('div');</span><span id="dab6" class="iq ir hi kp b fi lc ku l kv kw">const capture = document.createElement('button');</span><span id="7980" class="iq ir hi kp b fi lc ku l kv kw">capture.textContent = 'Capture';</span><span id="af3d" class="iq ir hi kp b fi lc ku l kv kw">div.appendChild(capture);</span><span id="73b8" class="iq ir hi kp b fi lc ku l kv kw">const video = document.createElement('video');</span><span id="6e48" class="iq ir hi kp b fi lc ku l kv kw">video.style.display = 'block';</span><span id="bf64" class="iq ir hi kp b fi lc ku l kv kw">const stream = await navigator.mediaDevices.getUserMedia({video: true});</span><span id="d2e2" class="iq ir hi kp b fi lc ku l kv kw">document.body.appendChild(div);</span><span id="482e" class="iq ir hi kp b fi lc ku l kv kw">div.appendChild(video);</span><span id="f530" class="iq ir hi kp b fi lc ku l kv kw">video.srcObject = stream;</span><span id="eab0" class="iq ir hi kp b fi lc ku l kv kw">await video.play();</span><span id="ef80" class="iq ir hi kp b fi lc ku l kv kw">// Resize the output to fit the video element.</span><span id="781a" class="iq ir hi kp b fi lc ku l kv kw">google.colab.output.setIframeHeight(document.documentElement.scrollHeight, true);</span><span id="0072" class="iq ir hi kp b fi lc ku l kv kw">// Wait for Capture to be clicked.</span><span id="f9ca" class="iq ir hi kp b fi lc ku l kv kw">await new Promise((resolve) =&gt; capture.onclick = resolve);</span><span id="6bd7" class="iq ir hi kp b fi lc ku l kv kw">const canvas = document.createElement('canvas');</span><span id="bcef" class="iq ir hi kp b fi lc ku l kv kw">canvas.width = video.videoWidth;</span><span id="aae8" class="iq ir hi kp b fi lc ku l kv kw">canvas.height = video.videoHeight;</span><span id="36f9" class="iq ir hi kp b fi lc ku l kv kw">canvas.getContext('2d').drawImage(video, 0, 0);</span><span id="8628" class="iq ir hi kp b fi lc ku l kv kw">stream.getVideoTracks()[0].stop();</span><span id="bf31" class="iq ir hi kp b fi lc ku l kv kw">div.remove();</span><span id="c023" class="iq ir hi kp b fi lc ku l kv kw">return canvas.toDataURL('image/jpeg', quality);</span><span id="0571" class="iq ir hi kp b fi lc ku l kv kw">}</span><span id="5d75" class="iq ir hi kp b fi lc ku l kv kw">''')</span><span id="b2bc" class="iq ir hi kp b fi lc ku l kv kw">display(js)</span><span id="b553" class="iq ir hi kp b fi lc ku l kv kw">data = eval_js('takePhoto({})'.format(quality))</span><span id="1564" class="iq ir hi kp b fi lc ku l kv kw">binary = b64decode(data.split(',')[1])</span><span id="ca4e" class="iq ir hi kp b fi lc ku l kv kw">with open(filename, 'wb') as f:</span><span id="c6e3" class="iq ir hi kp b fi lc ku l kv kw">f.write(binary)</span><span id="38bd" class="iq ir hi kp b fi lc ku l kv kw">return filename</span></pre><p id="8c32" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated"><strong class="jv hj">第06步</strong></p><pre class="jp jq jr js fd ko kp kq kr aw ks bi"><span id="6200" class="iq ir hi kp b fi kt ku l kv kw">from IPython.display import Image</span><span id="529f" class="iq ir hi kp b fi lc ku l kv kw">try:</span><span id="4c33" class="iq ir hi kp b fi lc ku l kv kw">filename = take_photo()</span><span id="ed43" class="iq ir hi kp b fi lc ku l kv kw">print('Saved to {}'.format(filename))</span><span id="7e0e" class="iq ir hi kp b fi lc ku l kv kw"># Show the image which was just taken.</span><span id="992a" class="iq ir hi kp b fi lc ku l kv kw">display(Image(filename))</span><span id="d187" class="iq ir hi kp b fi lc ku l kv kw">except Exception as err:</span><span id="964e" class="iq ir hi kp b fi lc ku l kv kw"># Errors will be thrown if the user does not have a webcam or if they do not</span><span id="3423" class="iq ir hi kp b fi lc ku l kv kw"># grant the page permission to access it.</span><span id="929e" class="iq ir hi kp b fi lc ku l kv kw">print(str(err))</span></pre><p id="8056" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated">运行这两个代码后，网络摄像头打开，您可以拍摄照片。</p><p id="956c" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated">照片被保存为photo.jpg。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es jo"><img src="../Images/b7be3b8c9725d7738eaab71d1733f517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*2SNbBnvaA0aFz5D4PSpNbQ.jpeg"/></div></figure><p id="715e" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated">使用哈尔级联的人脸检测是一种基于机器学习的方法，其中用一组输入数据训练级联函数。OpenCV已经包含了许多预先训练好的人脸、眼睛、微笑等分类器。今天我们将使用面部分类器。您也可以尝试其他分类器。</p><p id="c28a" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated">若要检测图像中的人脸:</p><p id="0c9f" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated"><strong class="jv hj">第07步</strong></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ld"><img src="../Images/ee646e70af6897bb93cd30d9ef0f1f75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rauzecb0Nprm0F2Mc0iB6A.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx">Step 07</figcaption></figure><p id="02b7" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated">需要注意一些事情:</p><ul class=""><li id="41a7" class="le lf hi jv b jw jx ka kb jb lg jf lh jj li kn lj lk ll lm bi translated">该检测仅对灰度图像有效。因此，将彩色图像转换为灰度图像非常重要。(第3行)</li></ul><pre class="jp jq jr js fd ko kp kq kr aw ks bi"><span id="58cb" class="iq ir hi kp b fi kt ku l kv kw">gray_img=cv2.cvtColor(img,cv2.COLOR_BGR2GRAY)</span></pre><ul class=""><li id="70c7" class="le lf hi jv b jw jx ka kb jb lg jf lh jj li kn lj lk ll lm bi translated"><strong class="jv hj"> detectMultiScale </strong>函数(第7行)用于检测人脸。它采用3个参数—输入图像、<em class="ln">比例因子、</em>和minN <em class="ln">邻居</em>。<em class="ln">比例因子</em>指定图像尺寸随每个比例缩小多少。<em class="ln">最小邻居</em>指定每个候选矩形应该有多少邻居来保留它。你可以<a class="ae lo" href="https://www.bogotobogo.com/python/OpenCV_Python/python_opencv3_Image_Object_Detection_Face_Detection_Haar_Cascade_Classifiers.php" rel="noopener ugc nofollow" target="_blank">在这里</a>详细了解。您可能需要调整这些值以获得最佳结果。</li><li id="fc01" class="le lf hi jv b jw lp ka lq jb lr jf ls jj lt kn lj lk ll lm bi translated"><em class="ln">面</em>包含了找到面的矩形区域的坐标列表。我们使用这些坐标来绘制图像中的矩形。</li></ul><p id="e95e" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated">接下来，我们可以使用绿色矩形来检测人脸。</p><p id="c3c6" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated"><strong class="jv hj">第08步</strong></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/50a7b198a98dd13def79aa6fe6c4565f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pYeDl-Fif0PS3HzD09vUjg.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx">Step 08</figcaption></figure><p id="d5f4" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated">要查看检测到的面部，</p><p id="0e30" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated"><strong class="jv hj">第09步</strong></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/7bad53ac1e1e74782b3684083716c091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nsambanRepHo749Dn0VtNQ.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx">Step 09</figcaption></figure><p id="d009" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated">转到文件并打开photo_detected.jpg。</p><p id="0f3d" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated">结果:</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es jo"><img src="../Images/f5c4cfa8386c18b6a64347003bbfaa4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*Y7Ofqa_x1rsWqlsUSyOAQQ.jpeg"/></div></figure><p id="46c2" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jb ke kf kg jf kh ki kj jj kk kl km kn hb bi translated">希望这对你有用。如果你在实现这个过程中有任何困难或者你需要任何帮助，请联系我。</p></div></div>    
</body>
</html>