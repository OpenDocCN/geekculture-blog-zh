<html>
<head>
<title>Use Strategy Design Pattern to Create Analytic Feature in iOS App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用策略设计模式在iOS应用程序中创建分析功能</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/use-strategy-design-pattern-to-create-analytic-feature-in-ios-app-ae18277ed42f?source=collection_archive---------7-----------------------#2021-11-15">https://medium.com/geekculture/use-strategy-design-pattern-to-create-analytic-feature-in-ios-app-ae18277ed42f?source=collection_archive---------7-----------------------#2021-11-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="336c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">策略设计模式是我们可以用来构建可伸缩系统的众多武器之一。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b5f89391bf2bac8b931cff6b00616fa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fBFeD7AxM6jlQvpF"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@thombradley?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Thom Bradley</a> on <a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="71dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分析跟踪功能可能是当今许多移动应用程序最重要的功能之一。我们可以从用户使用我们的应用程序时的日常行为中获得许多数据，然后我们可以分析这些数据，使其成为有用的信息，以确定我们移动应用程序开发的下一步。</p><p id="384f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实际上，有大量的工具可以用来在iOS中实现分析功能。也许我们可以使用Google analytic SDK，或者iCloud analytic SDK，甚至我们可以自己开发分析跟踪器SDK。那么，我们如何设计一个架构系统来实现分析跟踪功能是相当具有挑战性的。我们希望实现可扩展性，这意味着我们可以扩展我们的代码库，而不需要很大的成本。我们还希望我们的代码库可以在不破坏当前实现的情况下轻松扩展。也许我们也希望我们的代码库可以很容易地被测试。那我们怎样才能实现这个目标呢？</p><p id="61c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是为什么作为一名iOS工程师，甚至作为一名移动开发者，理解如何设计系统是我们需要具备的重要技能。从长远来看，我们的决定非常重要。理解设计原则和许多设计模式将帮助我们确定“我需要使用哪种武器来处理这个问题？”</p><h2 id="118a" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">引入策略设计模式</h2><p id="12cc" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">策略设计模式定义了一组可在运行时设置可切换对象。请看这张简单的图表:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ku"><img src="../Images/360a047cf341873fa448da06a346c45a.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*eMSrEkCw25uN7oFGnGEoPQ.png"/></div></figure><p id="e446" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">必须存在的第一个组件是我们有一个依赖的对象，并且它符合策略协议。策略协议要求具体的实现对象应该实现它。为了实现这种策略模式，我们可以使用依赖注入技术。看一下这个示例实现:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="8e30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们有一个简单的对象叫做<code class="du kx ky kz la b">HomeRepository</code>。它与类型<code class="du kx ky kz la b">LocalStorage</code>有一个依赖关系，并且是一个协议。在现实世界中，我们可以实现具有许多选项的本地存储，如核心数据、领域、用户默认值等。我们可以从本地存储选项创建具体的实现，并使其符合<code class="du kx ky kz la b">LocalStorage</code>协议。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="9745" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面代码中的图表如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lb"><img src="../Images/b2a5c609b075881a19664a5c799ce07f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*ztA78qhXuJEKYJxFoA-lrg.png"/></div></figure><h2 id="de88" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">战略设计模式的好处</h2><ul class=""><li id="b8c9" class="lc ld hi ih b ii kp im kq iq le iu lf iy lg jc lh li lj lk bi translated">它使我们能够对使用策略的对象隐藏具体的实现。我们可以在不破坏根对象实现的情况下改变实现。</li><li id="b577" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">它是可测试的，使用策略协议，我们可以创建一些用于单元测试目的的对象，如符合策略协议的模拟或间谍对象。</li><li id="c353" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">你可以认为策略模式有点类似于委托模式。它使用另一个对象来帮助这个对象完成它的任务。然而，策略模式的目的是我们可以定义可切换的具体实现，并且系统可以容易地扩展或改变。</li></ul><p id="4657" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么我们如何使用这种策略模式来帮助我们开发iOS中的分析功能呢？首先我们需要定义完整的需求，然后我们可以直接设计系统。</p><h2 id="2014" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">追踪器事件</h2><p id="014c" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">通常任何类型的事件跟踪器都需要一个我们需要提供的公共数据。例如，当用户打开主页时，我们需要发送时间戳、设备版本、操作系统版本和事件类型名称。另一个例子是，当用户点击列表中的一张卡片时，它需要与我之前提到的相同的数据，但也许我们需要发送额外的信息，如卡片中的数据序列？还是卡里的某个状态？</p><p id="590e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了在系统中表示跟踪器数据，我们可以使用一些选项，如enum、struct或protocol。哪个更好？<br/>我会按照协议解决。为什么我们不使用枚举？通常在一个大型应用程序中，有数百个事件跟踪器实现。如果我们使用enum，基本上它会违反开闭原则，因为每当我们添加一个新的tracker事件类型时，它会破坏switch语句的实现，我们需要修改它。Struct比enum好，但是protocol更强大。我将告诉你如何使用协议来实现这个目标。</p><p id="e659" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就像我之前说的，事件类型是我们需要提供的一组相似的数据。我们可以创建一个协议来表示这种事件类型，如下所示:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="2126" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，如果我们想添加新的分析跟踪器，我们可以创建新的类型，并符合它上面的例子。使用这种实现，我们的图表将如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lq"><img src="../Images/ef293c314e25ef1a4531c955452cf88f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EO8s32CebX_r4-9D2kr7Xw.png"/></div></div></figure><p id="1653" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们表示跟踪器事件类型的协议现在完成了。下一步是我们如何创建一个具有一个职责的对象，该职责是将事件类型发送到分析服务。就像我们之前已经讨论过的，分析服务可以是Google Analytic SDK，或者其他的分析SDK。你猜怎么着？是时候实施战略模式了！</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="dbe4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像我们之前的讨论一样，策略模式需要一个协议作为策略抽象，它有一个功能需求，即发送分析跟踪数据。我们的具体策略实现是<code class="du kx ky kz la b">GoogleAnalyticService</code>和<code class="du kx ky kz la b">ICloudAnalyticService</code>需要实现策略协议需求。最后一步是创建使用策略协议作为其依赖项的对象。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="fc20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们最终的系统图如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lq"><img src="../Images/2b39a51db4dbd4b6a90637e44343fed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5KqllNu3DfNWASiAj15mpQ.png"/></div></div></figure><h2 id="c0a8" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">要点</h2><p id="ecc5" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">策略设计模式是我们可以用来创建可伸缩系统的最强大的模式之一。它定义了一个可切换具体实现，我们可以在运行时使用它。但是作为一名软件工程师，如果你学习另一种设计模式和设计原则会很好，这将使你有更多的武器来解决现实世界的问题。谢谢大家，编码愉快:]</p></div></div>    
</body>
</html>