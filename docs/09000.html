<html>
<head>
<title>Recreating animated numerical counters in React from scratch (better than existing libraries)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从头开始在React中重新创建动画数字计数器(比现有的库更好)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/recreating-animated-numerical-counters-in-react-from-scratch-better-than-existing-libraries-2fa6d3056b33?source=collection_archive---------16-----------------------#2021-11-22">https://medium.com/geekculture/recreating-animated-numerical-counters-in-react-from-scratch-better-than-existing-libraries-2fa6d3056b33?source=collection_archive---------16-----------------------#2021-11-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9b2a" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">另一天，另一个组件进行逆向工程</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/558aadc748a6cdac380f0b55c89c537f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HzyEN1CczYQ1rdwr"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">The classic odometer, the OG animated counter</figcaption></figure><p id="fa60" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">与之前的帖子一样，这是因为我发现了一个想要复制的UI小部件。这一次，它是Timothée Roussilhe 的美丽的<a class="ae kj" href="https://timroussilhe.com/" rel="noopener ugc nofollow" target="_blank">网站。引起我注意的部分是里程表一样的动画部分计数器:</a></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es kk"><img src="../Images/272710af7bf20c8ad2a2a2dab81351f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/1*5XMoPN6bcIiGxCKGLidpRQ.gif"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screen-capped from <a class="ae kj" href="https://timroussilhe.com/" rel="noopener ugc nofollow" target="_blank">Tim Roussilhe — Interactive Developer</a></figcaption></figure><p id="198a" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><em class="kl">旁注:我知道里程表动画并不是特别新。如果你不想像我一样自己动手做，这里是你应该使用的库。</em>  <em class="kl">(顺便说一下，那个站点是用页面堆砌的，</em> <a class="ae kj" rel="noopener" href="/geekculture/recreating-page-piling-in-react-for-your-personal-sites-without-extra-libraries-23fcde868ed9"> <em class="kl">我在React之前的一个帖子里逆向工程过的东西</em> </a> <em class="kl">！)</em></p><p id="ede0" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我想到了通常的两个想法:1。很好。2.我大概能做到。我做到了！</p><h1 id="5ff3" class="km kn hi bd ko kp kq kr ks kt ku kv kw io kx ip ky ir kz is la iu lb iv lc ld bi translated">要求</h1><p id="c55b" class="pw-post-body-paragraph jn jo hi jp b jq le ij js jt lf im jv jw lg jy jz ka lh kc kd ke li kg kh ki hb bi translated">对里程表的要求很简单:</p><ul class=""><li id="f166" class="lj lk hi jp b jq jr jt ju jw ll ka lm ke ln ki lo lp lq lr bi translated">如果数字增加，数字应该向上移动到新值。</li><li id="5856" class="lj lk hi jp b jq ls jt lt jw lu ka lv ke lw ki lo lp lq lr bi translated">如果数字减小，数字应该向下移动到新值。</li></ul><p id="4ab5" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">(使它成为区段计数器的分母并不重要，因为它是静态的。)</p><h1 id="09fe" class="km kn hi bd ko kp kq kr ks kt ku kv kw io kx ip ky ir kz is la iu lb iv lc ld bi translated">我的方法</h1><p id="43ac" class="pw-post-body-paragraph jn jo hi jp b jq le ij js jt lf im jv jw lg jy jz ka lh kc kd ke li kg kh ki hb bi translated"><a class="ae kj" href="https://weiming-odometer.netlify.app/" rel="noopener ugc nofollow" target="_blank">你可以在这里</a>看到演示，在这里<a class="ae kj" href="https://github.com/weimingw/weiming-odometer" rel="noopener ugc nofollow" target="_blank">看到Github回购</a>。组件的<a class="ae kj" href="https://github.com/weimingw/weiming-odometer/blob/main/src/components/odometer/Odometer.js" rel="noopener ugc nofollow" target="_blank">特定文件在这里。</a></p><p id="d1d4" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我将在概念层面上解释该组件的作用:</p><ul class=""><li id="3933" class="lj lk hi jp b jq jr jt ju jw ll ka lm ke ln ki lo lp lq lr bi translated">像一个真正的里程表一样，我使用独立移动滚动的每个数字的列来重新创建大的数字，所以我为每个数字渲染两次从0到9的一列数字<em class="kl"/>(后面将解释原因)。</li><li id="90b5" class="lj lk hi jp b jq ls jt lt jw lu ka lv ke lw ki lo lp lq lr bi translated"><code class="du lx ly lz ma b">overflow-y: hidden;</code>、<code class="du lx ly lz ma b">position: absolute;</code>和<code class="du lx ly lz ma b">transform: translateY(x)</code>创建一个可见窗口，其中列中只有一个数字可见。每个数字都有一个特定的行高(2em)，这使得计算对应于可见数字的<code class="du lx ly lz ma b">x</code>值变得很容易。</li><li id="1930" class="lj lk hi jp b jq ls jt lt jw lu ka lv ke lw ki lo lp lq lr bi translated">动画就是用<code class="du lx ly lz ma b">requestAnimationFrame()</code>反复调用一个函数(<code class="du lx ly lz ma b">tick()</code>)。<code class="du lx ly lz ma b">tick()</code>将“从现在到动画开始的时间”插入到值<code class="du lx ly lz ma b">x</code>中，通过一系列增加或减少<code class="du lx ly lz ma b">x</code>来创建动画。</li></ul><p id="97cf" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">要将高级描述翻译成代码:</p><ul class=""><li id="77a6" class="lj lk hi jp b jq jr jt ju jw ll ka lm ke ln ki lo lp lq lr bi translated">将<code class="du lx ly lz ma b">RollingNumber</code>中的<code class="du lx ly lz ma b">x</code>翻译成<code class="du lx ly lz ma b">currentPosition</code></li><li id="64c7" class="lj lk hi jp b jq ls jt lt jw lu ka lv ke lw ki lo lp lq lr bi translated">将<code class="du lx ly lz ma b">target</code>解释为我们想要显示的数字。</li><li id="2a82" class="lj lk hi jp b jq ls jt lt jw lu ka lv ke lw ki lo lp lq lr bi translated"><code class="du lx ly lz ma b">easeInOutCubic</code>是插值函数，需要存储一个<code class="du lx ly lz ma b">startPosition</code>和<code class="du lx ly lz ma b">endPosition</code>。(此外，如果<code class="du lx ly lz ma b">target</code>在动画中间发生变化，由于我们想要保持动画，我们必须在每次<code class="du lx ly lz ma b">target</code>发生变化时重新初始化<code class="du lx ly lz ma b">tick()</code>，并使旧的初始化无效。)</li></ul><h2 id="6d8f" class="mb kn hi bd ko mc md me ks mf mg mh kw jw mi mj ky ka mk ml la ke mm mn lc mo bi translated">现在我将解决房间里的复制大象:为什么渲染0到9两次？</h2><p id="b2f4" class="pw-post-body-paragraph jn jo hi jp b jq le ij js jt lf im jv jw lg jy jz ka lh kc kd ke li kg kh ki hb bi translated">考虑这样一种情况，你必须从9增加到10，一位数从9增加到0。如果列中只有一个0，那么<em class="kl">动画将从底部数字9向上移动</em>到顶部数字0，但是<em class="kl">我们希望它向下移动</em>，但是这要求组件在9下面总是有一个0数字，如果你在底部，这就不会发生，对吗？</p><p id="e713" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">第二次渲染0到9，<em class="kl">我可以保证在9 </em>下面有一个0，因为即使窗口显示底部的9位数，<em class="kl">我也可以(对最终用户不可见)将</em> <code class="du lx ly lz ma b"><em class="kl">translateY</em></code> <em class="kl">偏移到顶部的9位数并滚动到那个数字下面的0！</em>(从0值到9值递减时，相同的原则适用于相反方向)。</p><p id="a637" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">一定要看看演示——它有一个暴露的里程表，你可以看到它在行动！</p><h1 id="624e" class="km kn hi bd ko kp kq kr ks kt ku kv kw io kx ip ky ir kz is la iu lb iv lc ld bi translated">比图书馆好吗？</h1><p id="14da" class="pw-post-body-paragraph jn jo hi jp b jq le ij js jt lf im jv jw lg jy jz ka lh kc kd ke li kg kh ki hb bi translated">为什么我声称它比现有的库更好？</p><p id="f1b5" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">js通过只包含带有可视或动画数字的元素来操作DOM。DOM操作会导致回流，这是对可见UI最耗费性能的一种更新。我通过只操作<code class="du lx ly lz ma b">transform</code> CSS属性来避免这种方法，它只触发一个重画，这是最不耗费性能的类型。</p><p id="757a" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">与此同时，Tim Roussilhe的方法使用了<code class="du lx ly lz ma b">transform</code>，但是为每个支持的数字呈现了一个数字组合——为他的19个支持值呈现了19个数字！目前还不错，但当它开始达到数千个时，就根本无法扩展了。与此同时，我的将呈现20个新的数字每10个新的量级。</p><h1 id="80a5" class="km kn hi bd ko kp kq kr ks kt ku kv kw io kx ip ky ir kz is la iu lb iv lc ld bi translated">外卖食品</h1><p id="a354" class="pw-post-body-paragraph jn jo hi jp b jq le ij js jt lf im jv jw lg jy jz ka lh kc kd ke li kg kh ki hb bi translated">我从这个练习中学到的是在我的JS编码生涯中第一次使用<code class="du lx ly lz ma b">requestAnimationFrame </code>。弄清楚如何进行无限循环也是一次很好的脑力锻炼，我希望这能帮助你在遇到困难的项目需求时跳出框框思考。</p></div></div>    
</body>
</html>