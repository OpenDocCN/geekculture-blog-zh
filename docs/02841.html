<html>
<head>
<title>PyNetlogo Tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PyNetlogo教程</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/pynetlogo-tutorial-ea3146188561?source=collection_archive---------28-----------------------#2021-05-26">https://medium.com/geekculture/pynetlogo-tutorial-ea3146188561?source=collection_archive---------28-----------------------#2021-05-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2c2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">PyNetlogo是一个python包，用于将Netlog链接到Python。最新版本是0.3。我不认为在0.3版本发布后它得到了很好的管理。有以下三个重要网页:</p><p id="99d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="http://jasss.soc.surrey.ac.uk/21/2/4.html" rel="noopener ugc nofollow" target="_blank">论文:PyNetLogo:用Python链接NetLogo</a><br/><a class="ae jd" href="https://pynetlogo.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">PyNetLogo主页</a><br/><a class="ae jd" href="https://github.com/quaquel/pyNetLogo" rel="noopener ugc nofollow" target="_blank">PyNetLogo Github</a></p><p id="5b99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有一个:<br/> <a class="ae jd" href="https://www.youtube.com/watch?v=qLBzT85Z-aM" rel="noopener ugc nofollow" target="_blank">我的PyNetlogo教程</a></p><h1 id="ca5a" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">安装和虚拟环境</h1><p id="a25d" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我强烈建议为新的包创建一个虚拟环境。JPype包在Pyhton 3.8或更老版本中更稳定。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="d308" class="kq jf hi km b fi kr ks l kt ku">conda create -n netlogo-env python=3.8</span><span id="e4a1" class="kq jf hi km b fi kv ks l kt ku"># For JPype<br/>conda install -c conda-forge jpype1<br/>   <br/># For PyNetLogo<br/>pip install pynetlogo</span></pre><h1 id="15cd" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">导入库</h1><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="e5b0" class="kq jf hi km b fi kr ks l kt ku">import pandas as pd<br/>import numpy as np<br/>from scipy import stats<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>import pyNetLogo<br/></span><span id="157e" class="kq jf hi km b fi kv ks l kt ku">sns.set_style('white')<br/>sns.set_context('talk')</span><span id="9785" class="kq jf hi km b fi kv ks l kt ku">%matplotlib inline</span></pre><h1 id="0629" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">从Netlogo模拟中获取数据:<code class="du kw kx ky km b">.command</code>和<code class="du kw kx ky km b">.report</code></h1><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="026f" class="kq jf hi km b fi kr ks l kt ku"># open Netlogo<br/>netlogo = pyNetLogo.NetLogoLink(gui=True)</span><span id="e8a2" class="kq jf hi km b fi kv ks l kt ku"># Load the Model<br/>netlogo.load_model('C:/Program Files/NetLogo 6.1.1/.../Wolf Sheep Predation.nlogo')</span><span id="a8bc" class="kq jf hi km b fi kv ks l kt ku"># Setup and Choose  model-version = "sheep-wolves-grass"<br/>netlogo.command('setup')<br/></span><span id="937f" class="kq jf hi km b fi kv ks l kt ku"># Get the coordinates of agents(sheep) from Netlogo<br/>x = netlogo.report('map [s -&gt; [xcor] of s] sort sheep')<br/>y = netlogo.report('map [s -&gt; [ycor] of s] sort sheep') <br/></span><span id="cd34" class="kq jf hi km b fi kv ks l kt ku"># Make a plot<br/>fig, ax = plt.subplots(1)<br/>ax.scatter(x, y, s=4)<br/>ax.set_xlabel('xcor')<br/>ax.set_ylabel('ycor')<br/>ax.set_aspect('equal')<br/>fig.set_size_inches(5,5)<br/>plt.show()</span></pre><figure class="kh ki kj kk fd la er es paragraph-image"><div class="er es kz"><img src="../Images/e4864c64e04b1b8590bd565d8e8b9ade.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/0*HrgLKYhFNKNyp47v.png"/></div></figure><h1 id="16a2" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用<code class="du kw kx ky km b">.command</code>或<code class="du kw kx ky km b">.repeat_report</code>重复模型模拟</h1><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="19c7" class="kq jf hi km b fi kr ks l kt ku"># Run 100ticks <br/>netlogo.command('repeat 100 [go]')</span><span id="f754" class="kq jf hi km b fi kv ks l kt ku"># or</span><span id="d23c" class="kq jf hi km b fi kv ks l kt ku"># Run 100 ticks and Report 'count wolves'<br/>netlogo.repeat_report(['count wolves'], 100, go='go')</span></pre><h1 id="543a" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">将数据导入Netlogo模型:<code class="du kw kx ky km b">.write_NetLogo_attriblist</code></h1><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="316e" class="kq jf hi km b fi kr ks l kt ku"># ex_data is a pandas DataFrame having three columns : col1, col2, and col3.<br/>ex_data[['col1','col2','col3']]</span><span id="5b3c" class="kq jf hi km b fi kv ks l kt ku"># Import the data to col1, col2 and col3 attributes of the 'breed'<br/>netlogo.write_NetLogo_attriblist(ex_data[['col1','col2','col3']], 'breed')</span></pre><h1 id="721c" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><code class="du kw kx ky km b">.patch_report</code>不起作用。</h1><p id="ccd6" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">为了从补丁中获取数据，我们需要使用<code class="du kw kx ky km b">.patch_report</code>。但是它给出了一个错误信息。或者，我用<code class="du kw kx ky km b">.report</code>。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="bf46" class="kq jf hi km b fi kr ks l kt ku"># Error<br/>countdown_df = netlogo.patch_report('countdown')</span><span id="568a" class="kq jf hi km b fi kv ks l kt ku"># Alternative way<br/>countdown_df=netlogo.report('map [s -&gt; [countdown] of s] sort patches')</span><span id="1387" class="kq jf hi km b fi kv ks l kt ku"># Reshape for 51 by 51 square<br/>countdown_df=countdown_df.reshape(51,51) </span><span id="81bd" class="kq jf hi km b fi kv ks l kt ku"># Convert to DataFrame<br/>countdown_df = pd.DataFrame(countdown_df)<br/></span><span id="9d8c" class="kq jf hi km b fi kv ks l kt ku"># Change index and column names<br/>countdown_df.columns=[list(range(-25,26))]<br/>countdown_df.index=[list(range(-25,26))]</span><span id="a223" class="kq jf hi km b fi kv ks l kt ku"># Make a plot<br/>fig, ax = plt.subplots(1)<br/>patches = sns.heatmap(countdown_df, xticklabels=5, yticklabels=5,<br/>                      cbar_kws={'label':'countdown'}, ax=ax) <br/>ax.set_xlabel('pxcor')<br/>ax.set_ylabel('pycor')<br/>ax.set_aspect('equal')<br/>fig.set_size_inches(20,10)<br/>plt.show()</span></pre><figure class="kh ki kj kk fd la er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ld"><img src="../Images/2c2302e403d1297b711839f2381e4a3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MKwKMGUFvIl2UK5D.png"/></div></div></figure><h1 id="ee32" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">导出补丁数据和更改补丁数据:<code class="du kw kx ky km b">.to_excel</code>和<code class="du kw kx ky km b">.patch_set</code> &gt;</h1><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="4084" class="kq jf hi km b fi kr ks l kt ku">countdown_df.to_excel('countdown.xlsx')</span><span id="4704" class="kq jf hi km b fi kv ks l kt ku">netlogo.patch_set('countdown', countdown_df.max()-countdown_df)</span></pre><h1 id="bf76" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">敏感性分析—使用SALib</h1><p id="fe49" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我认为PyNetlogo网站需要更新敏感性分析部分，因为<strong class="ih hj">代码不起作用</strong>。<strong class="ih hj"> SALib </strong>有两个视图用于分析。一个叫<code class="du kw kx ky km b">Direct view</code>，一个叫<code class="du kw kx ky km b">Load balanced view</code>。我找不到一个替代方法来使用网站所使用的后者。在本教程中，我使用<strong class="ih hj"> SALib直接视图</strong>方法进行灵敏度分析。</p><p id="6ed1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导入两个函数用于采样和分析。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="e717" class="kq jf hi km b fi kr ks l kt ku">from SALib.sample import saltelli<br/>from SALib.analyze import sobol</span></pre><ol class=""><li id="a6d7" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">确定参数及其范围</li></ol><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="e1b9" class="kq jf hi km b fi kr ks l kt ku">problem = {<br/>  'num_vars': 6,<br/>  'names': ['random-seed',<br/>            'grass-regrowth-time',<br/>            'sheep-gain-from-food',<br/>            'wolf-gain-from-food',<br/>            'sheep-reproduce',<br/>            'wolf-reproduce'],<br/>  'bounds': [[1, 100000],<br/>             [20., 40.],<br/>             [2., 8.],<br/>             [16., 32.],<br/>             [2., 8.],<br/>             [2., 8.]]<br/>  }</span></pre><ol class=""><li id="a6f2" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">使用<code class="du kw kx ky km b">saltelli</code>采样功能设置采样参数</li></ol><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="d793" class="kq jf hi km b fi kr ks l kt ku">n = 1000<br/>param_values = saltelli.sample(problem, n, calc_second_order=True)</span><span id="4a24" class="kq jf hi km b fi kv ks l kt ku"># We can get 14,000 parameter sets.</span></pre><ol class=""><li id="84c3" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">使用参数设置运行<code class="du kw kx ky km b">Target model</code></li></ol><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="9130" class="kq jf hi km b fi kr ks l kt ku"># Definition for simulation  </span><span id="93aa" class="kq jf hi km b fi kv ks l kt ku">def simulation(experiment):</span><span id="0e07" class="kq jf hi km b fi kv ks l kt ku">    #Set the input parameters<br/>    for i, name in enumerate(problem['names']):<br/>        if name == 'random-seed':<br/>            #The NetLogo random seed requires a different syntax<br/>            netlogo.command('random-seed {}'.format(experiment[i]))<br/>        else:<br/>            #Otherwise, assume the input parameters are global variables<br/>            netlogo.command('set {0} {1}'.format(name, experiment[i]))</span><span id="d144" class="kq jf hi km b fi kv ks l kt ku">    netlogo.command('setup')<br/>    #Run for 100 ticks and return the number of sheep and wolf agents at each time step<br/>    counts = netlogo.repeat_report(['count sheep','count wolves'], 100)</span><span id="ce80" class="kq jf hi km b fi kv ks l kt ku">    results = pd.Series([counts['count sheep'].values.mean(),<br/>                         counts['count wolves'].values.mean()],<br/>                         index=['Avg. sheep', 'Avg. wolves'])</span><span id="d0e5" class="kq jf hi km b fi kv ks l kt ku">    return results</span></pre><p id="bc80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于<strong class="ih hj">并联</strong></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="e57c" class="kq jf hi km b fi kr ks l kt ku"># DO NOT RUN this in the Jupyter Notebook</span><span id="b1df" class="kq jf hi km b fi kv ks l kt ku"># Run it in the Terminal<br/># I choose 8,but you can choose 4<br/></span><span id="0d0e" class="kq jf hi km b fi kv ks l kt ku">ipcluster start -n 8</span><span id="788c" class="kq jf hi km b fi kv ks l kt ku">import ipyparallel as ipp</span><span id="358a" class="kq jf hi km b fi kv ks l kt ku">client = ipp.Client()  # client - setup<br/>client.ids</span></pre><p id="f10a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<strong class="ih hj">直接查看</strong></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="0c02" class="kq jf hi km b fi kr ks l kt ku"># Allow direct view to use all engines<br/>direct_view = client[:]<br/></span><span id="2f12" class="kq jf hi km b fi kv ks l kt ku"># For Parallel Engine access<br/>import os<br/>direct_view.push(dict(cwd=os.getcwd()))<br/>direct_view.push(dict(problem=problem))</span><span id="89cd" class="kq jf hi km b fi kv ks l kt ku"># Run Engines<br/>%%px  </span><span id="4fb0" class="kq jf hi km b fi kv ks l kt ku"># Load the Netlogo model</span><span id="8190" class="kq jf hi km b fi kv ks l kt ku">import os<br/>os.chdir(cwd)</span><span id="3b76" class="kq jf hi km b fi kv ks l kt ku">import pyNetLogo<br/>import pandas as pd</span><span id="28df" class="kq jf hi km b fi kv ks l kt ku">netlogo = pyNetLogo.NetLogoLink(gui=True)<br/>netlogo.load_model('Wolf Sheep Predation_pynetlogo.nlogo')<br/></span><span id="e42a" class="kq jf hi km b fi kv ks l kt ku"># Run the Model with parallel Engines</span><span id="e4e0" class="kq jf hi km b fi kv ks l kt ku">results = pd.DataFrame(direct_view.map_sync(simulation, param_values))</span><span id="2213" class="kq jf hi km b fi kv ks l kt ku"># Make Plots for the results<br/>import scipy</span><span id="1238" class="kq jf hi km b fi kv ks l kt ku">fig, ax = plt.subplots(2, 3, sharey=True)</span><span id="9525" class="kq jf hi km b fi kv ks l kt ku">y = results['Avg. sheep']</span><span id="88bf" class="kq jf hi km b fi kv ks l kt ku">for i, a in enumerate(ax.flatten()): <br/>    x = param_values[:,i]            <br/>    <br/>    sns.regplot(x=x, y=y, ax=a, ci=None, color='k',scatter_kws={'alpha':0.2, 's':4, 'color':'gray'}) <br/>        <br/>    pearson = scipy.stats.pearsonr(x, y)<br/>    a.annotate("r= {:.3f}".format(pearson[0]), xy=(0.15, 0.85), xycoords='axes fraction',fontsize=13) <br/>    a.annotate("p= {:.3f}".format(pearson[1]), xy=(0.15, 0.8), xycoords='axes fraction',fontsize=10) <br/>    <br/>    if divmod(i,3)[1]&gt;0:                 <br/>        a.get_yaxis().set_visible(False)<br/>                                           <br/>    <br/>    a.set_xlabel(problem['names'][i])<br/>    a.set_ylim([0, 1.1*np.max(y)])  </span><span id="6dff" class="kq jf hi km b fi kv ks l kt ku">    <br/>    <br/>fig.set_size_inches(12,10,forward=True)</span><span id="c46c" class="kq jf hi km b fi kv ks l kt ku">fig.subplots_adjust(wspace=0.2, hspace=0.3)<br/>plt.show()</span></pre><figure class="kh ki kj kk fd la er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es lr"><img src="../Images/ecbbf9aef726c3bcfe79477b53d8766a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LRN0N3mioQO79d5m.png"/></div></div></figure><ol class=""><li id="ed69" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated"><strong class="ih hj">灵敏度分析</strong>使用<code class="du kw kx ky km b">Sobol</code>功能</li><li id="8ecc" class="li lj hi ih b ii ls im lt iq lu iu lv iy lw jc ln lo lp lq bi translated">Sobol函数生成三个指标:<br/><strong class="ih hj">【S1】</strong>:单参数对产出方差的贡献。<br/>单参数→输出。<br/>T5【S2】T6:两个参数的交互→输出。<br/> <strong class="ih hj"> ST </strong>:一个或多个参数→输出。</li></ol><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="e26e" class="kq jf hi km b fi kr ks l kt ku">Si = sobol.analyze(problem, results['Avg. sheep'].values, calc_second_order=True, print_to_console=True)</span></pre><p id="95f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为<strong class="ih hj"> S1 </strong>、<strong class="ih hj">圣</strong>、<strong class="ih hj"> S2 </strong>制作数据帧。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="ecad" class="kq jf hi km b fi kr ks l kt ku"># For S1 and ST</span><span id="b569" class="kq jf hi km b fi kv ks l kt ku">Si_filter = {k:Si[k] for k in ['ST','ST_conf','S1','S1_conf']}<br/>Si_df = pd.DataFrame(Si_filter, index=problem['names'])<br/></span><span id="bbaa" class="kq jf hi km b fi kv ks l kt ku"># For S2<br/>Si2_filter = {k:Si[k] for k in ['S2', 'S2_conf']} <br/>Si2_df = pd.DataFrame(Si2_filter['S2'], columns=problem['names'],index=problem['names'])</span><span id="7ace" class="kq jf hi km b fi kv ks l kt ku">Si2_conf = pd.DataFrame(Si2_filter['S2_conf'], columns=problem['names'],index=problem['names'])</span></pre><p id="d629" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为<strong class="ih hj"> S1 </strong>和<strong class="ih hj">圣</strong>制作剧情</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="49e1" class="kq jf hi km b fi kr ks l kt ku">fig, ax = plt.subplots(1)</span><span id="a43c" class="kq jf hi km b fi kv ks l kt ku">indices = Si_df[['S1','ST']]<br/>err = Si_df[['S1_conf','ST_conf']]</span><span id="4092" class="kq jf hi km b fi kv ks l kt ku">indices.plot.bar(yerr=err.values.T, ax=ax) </span><span id="e494" class="kq jf hi km b fi kv ks l kt ku">fig.set_size_inches(8,4)<br/>plt.show()</span></pre><figure class="kh ki kj kk fd la er es paragraph-image"><div class="er es lx"><img src="../Images/c7d066c6ad12f1aabbaa4255f86548e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/0*Odv4UX-dZG-wxood.png"/></div></figure><p id="a793" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为所有指数绘图</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="149f" class="kq jf hi km b fi kr ks l kt ku">import itertools<br/>from math import pi</span><span id="89ff" class="kq jf hi km b fi kv ks l kt ku">#sobol_indices = Si</span><span id="b4ce" class="kq jf hi km b fi kv ks l kt ku">def normalize(x, xmin, xmax):<br/>    return (x-xmin)/(xmax-xmin)</span><span id="66c5" class="kq jf hi km b fi kv ks l kt ku">def plot_circles(ax, locs, names, max_s, stats, smax, smin, fc, ec, lw, <br/>                 zorder):<br/>    s = np.asarray([stats[name] for name in names])<br/>    s = 0.01 + max_s * np.sqrt(normalize(s, smin, smax))<br/>    <br/>    fill = True<br/>    for loc, name, si in zip(locs, names, s):<br/>        if fc=='w':<br/>            fill=False<br/>        else:<br/>            ec='none'<br/>            <br/>        x = np.cos(loc)<br/>        y = np.sin(loc)<br/>        <br/>        circle = plt.Circle((x,y), radius=si, ec=ec, fc=fc, transform=ax.transData._b,<br/>                            zorder=zorder, lw=lw, fill=True)<br/>        ax.add_artist(circle)<br/>    <br/>    <br/>    <br/>    <br/>    <br/>## Create filtered_names, filtered_locs</span><span id="f7ef" class="kq jf hi km b fi kv ks l kt ku">def filter(sobol_indices, names, locs, criterion, threshold):<br/>    if criterion in ['ST', 'S1', 'S2']:<br/>        data = sobol_indices[criterion]<br/>        data = np.abs(data)<br/>        data = data.flatten() # flatten in case of S2<br/>        <br/>        # TODO:: remove nans<br/>        <br/>        filtered = ([(name, locs[i]) for i, name in enumerate(names) if data[i]&gt;threshold])<br/>        filtered_names, filtered_locs = zip(*filtered) <br/>    <br/>    elif criterion in ['ST_conf', 'S1_conf', 'S2_conf']:<br/>        raise NotImplementedError<br/>    else:<br/>        raise ValueError('unknown value for criterion')</span><span id="1247" class="kq jf hi km b fi kv ks l kt ku">    return filtered_names, filtered_locs</span><span id="4f54" class="kq jf hi km b fi kv ks l kt ku">#######<br/>## Main<br/>########<br/>def plot_sobol_indices(sobol_indices, criterion='ST', threshold=0.01):<br/>    <br/>    '''plot sobol indices on a radial plot<br/>    <br/>    Parameters<br/>    ----------<br/>    sobol_indices : dict<br/>                    the return from SAlib<br/>    criterion : {'ST', 'S1', 'S2', 'ST_conf', 'S1_conf', 'S2_conf'}, optional<br/>    threshold : float<br/>                only visualize variables with criterion larger than cutoff<br/>             <br/>    '''<br/>    max_linewidth_s2 = 15#25*1.8<br/>    max_s_radius = 0.3<br/>    <br/>    # prepare data<br/>    # use the absolute values of all the indices<br/>    #sobol_indices = {key:np.abs(stats) for key, stats in sobol_indices.items()}<br/>    <br/>    # dataframe with ST and S1<br/>    sobol_stats = {key:sobol_indices[key] for key in ['ST', 'S1']}<br/>    sobol_stats = pd.DataFrame(sobol_stats, index=problem['names'])</span><span id="860e" class="kq jf hi km b fi kv ks l kt ku">    smax = sobol_stats.max().max()<br/>    smin = sobol_stats.min().min()<br/> <br/></span><span id="46b8" class="kq jf hi km b fi kv ks l kt ku">    # dataframe with s2<br/>    s2 = pd.DataFrame(sobol_indices['S2'], index=problem['names'], <br/>                      columns=problem['names'])<br/>    s2[s2&lt;0.0]=0. #Set negative values to 0 (artifact from small sample sizes)<br/>    s2max = s2.max().max()<br/>    s2min = s2.min().min()</span><span id="4326" class="kq jf hi km b fi kv ks l kt ku">    names = problem['names']<br/>    n = len(names)<br/>    ticklocs = np.linspace(0, 2*pi, n+1)<br/>    locs = ticklocs[0:-1]</span><span id="7e19" class="kq jf hi km b fi kv ks l kt ku">    filtered_names, filtered_locs = filter(sobol_indices, names, locs,<br/>                                           criterion, threshold)<br/>    <br/>    <br/>####################    <br/>####################    <br/># setup figure<br/>####################<br/>#####################</span><span id="7e1f" class="kq jf hi km b fi kv ks l kt ku">    fig = plt.figure()<br/>    ax = fig.add_subplot(111, polar=True)<br/>    ax.grid(False)<br/>    ax.spines['polar'].set_visible(False)<br/>    ax.set_xticks(locs)                         ##  Fixed ##</span><span id="02d7" class="kq jf hi km b fi kv ks l kt ku">    ax.set_xticklabels(names, fontsize=12)                     <br/>    ax.set_yticklabels([]) <br/>    ax.set_ylim(top=1.4)<br/>    legend(ax)</span><span id="0a97" class="kq jf hi km b fi kv ks l kt ku">    # plot ST<br/>    plot_circles(ax, filtered_locs, filtered_names, max_s_radius, <br/>                 sobol_stats['ST'], smax, smin, 'w', 'k', 1, 9)</span><span id="fee3" class="kq jf hi km b fi kv ks l kt ku">    # plot S1<br/>    plot_circles(ax, filtered_locs, filtered_names, max_s_radius, <br/>                 sobol_stats['S1'], smax, smin, 'k', 'k', 1, 10)</span><span id="134d" class="kq jf hi km b fi kv ks l kt ku">    # plot S2<br/>    for name1, name2 in itertools.combinations(zip(filtered_names, filtered_locs), 2):<br/>        name1, loc1 = name1<br/>        name2, loc2 = name2</span><span id="b81a" class="kq jf hi km b fi kv ks l kt ku">        weight = s2.loc[name1, name2]<br/>        lw = 0.5+max_linewidth_s2*normalize(weight, s2min, s2max)<br/>        ax.plot([loc1, loc2], [1,1], c='darkgray', lw=lw, zorder=1)</span><span id="2de1" class="kq jf hi km b fi kv ks l kt ku">    return fig<br/></span><span id="69d2" class="kq jf hi km b fi kv ks l kt ku">from matplotlib.legend_handler import HandlerPatch<br/>class HandlerCircle(HandlerPatch):<br/>    def create_artists(self, legend, orig_handle,<br/>                       xdescent, ydescent, width, height, fontsize, trans):<br/>        center = 0.5 * width - 0.5 * xdescent, 0.5 * height - 0.5 * ydescent<br/>        p = plt.Circle(xy=center, radius=orig_handle.radius)<br/>        self.update_prop(p, orig_handle, legend)<br/>        p.set_transform(trans)<br/>        return [p]</span><span id="4570" class="kq jf hi km b fi kv ks l kt ku">def legend(ax):<br/>    some_identifiers = [plt.Circle((0,0), radius=5, color='k', fill=False, lw=1),<br/>                        plt.Circle((0,0), radius=5, color='k', fill=True),<br/>                        plt.Line2D([0,0.5], [0,0.5], lw=8, color='darkgray')]<br/>    ax.legend(some_identifiers, ['ST', 'S1', 'S2'],<br/>              loc=(1,0.75), borderaxespad=0.1, mode='expand',<br/>              handler_map={plt.Circle: HandlerCircle()})<br/>    <br/>    <br/>## plot   </span><span id="f8b0" class="kq jf hi km b fi kv ks l kt ku">sns.set_style('whitegrid')</span><span id="652f" class="kq jf hi km b fi kv ks l kt ku">fig = plot_sobol_indices(Si, criterion='ST', threshold=0.005)</span><span id="8d12" class="kq jf hi km b fi kv ks l kt ku">fig.set_size_inches(15,10)<br/>plt.show()</span></pre><figure class="kh ki kj kk fd la er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ly"><img src="../Images/0fba1a2e6a716b91b32c0fa19b141e9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bBK1CFJS4ovIKz48.png"/></div></div></figure></div></div>    
</body>
</html>