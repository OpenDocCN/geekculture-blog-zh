<html>
<head>
<title>Train ML Model and Build Android Application Using TensorFlow Lite &amp; Keras</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TensorFlow Lite &amp; Keras训练ML模型并构建Android应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/train-ml-model-and-build-android-application-using-tensorflow-lite-keras-6bf23d07309a?source=collection_archive---------5-----------------------#2021-04-09">https://medium.com/geekculture/train-ml-model-and-build-android-application-using-tensorflow-lite-keras-6bf23d07309a?source=collection_archive---------5-----------------------#2021-04-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/1b194451f394790396b7d9efe8a0fd27.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*ghMaqZgVvIRzUmFRY91ZLA.jpeg"/></div><figcaption class="im in et er es io ip bd b be z dx">ML + Android</figcaption></figure></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><p id="65a2" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">在这篇博客中，我将使用TensorFlow和Keras训练一个非常基本的机器学习模型，然后我们将为这个训练好的模型开发一个android应用程序。</p><p id="0350" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">我们将使用Anaconda来训练我们的机器学习模型，然后我们将把这个模型转换成一种<strong class="iz hj"> tflite </strong>格式。之后，我们将使用Android studio用java开发一个Android应用程序。因此，最终，您将拥有自己的基于机器学习的Android应用程序。</p><p id="cd88" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><em class="jv">大多数人不清楚Tensorflow lite在Android中的使用情况，但在这个示例中，我们将使用一个非常简单的示例进行解释。</em></p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es jw"><img src="../Images/9b649278432d333ff0978eeaa28411c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/format:webp/1*VZiqUttzjBnIkONJyUaLqQ.jpeg"/></div></figure><p id="bc44" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">让我们开始…</p><p id="d1b3" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">第一步</strong>:导入需要的库</p><blockquote class="kb kc kd"><p id="c22c" class="ix iy jv iz b ja jb jc jd je jf jg jh ke jj jk jl kf jn jo jp kg jr js jt ju hb bi translated"><em class="hi">将tensorflow作为tf导入<br/>将numpy作为np导入<br/>从tensorflow导入keras，lite </em></p></blockquote><p id="a34a" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">Tensorflow将用于训练我们的模型，numpy将用于创建数据集。Keras将用于生成神经网络模型。使用lite，我们将把模型转换成Android的tflite格式。</p><p id="1dbf" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">第二步:</strong>创建一个数据集。</p><p id="8ffb" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">基本数据集将有两个变量x和y。变量之间的关系模式将是<strong class="iz hj"> y=2x-1。</strong>这里y是标签，x是特征。</p><blockquote class="kb kc kd"><p id="ad20" class="ix iy jv iz b ja jb jc jd je jf jg jh ke jj jk jl kf jn jo jp kg jr js jt ju hb bi translated">x = np.array([-1.0，0.0，1.0，2.0，3.0，4.0]，dtype=float)<br/>y = NP . array([-3.0，-1.0，1.0，3.0，5.0，7.0]，dtype = float)</p></blockquote><p id="df3f" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">步骤3: </strong>使用Keras训练模型</p><p id="2b29" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">该包具有与神经网络包类似的行为。隐藏层是使用Keras创建的。层次。密集()。这个密集()将提供当前和先前神经元的连接。</p><blockquote class="kb kc kd"><p id="ec0d" class="ix iy jv iz b ja jb jc jd je jf jg jh ke jj jk jl kf jn jo jp kg jr js jt ju hb bi translated">型号= keras。sequential([keras.layers.Dense(units=1，input_shape=[1]))，keras . layers . dense(units = 1，input _ shape =[1]))<br/>model . compile(optimizer = ' SGD '，loss='mean_squared_error ')</p></blockquote><p id="c5cf" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">units=1将告诉您它将有1个神经元，并且前一层的input_shape为1，因为我们仅使用1个特征(即<strong class="iz hj"> x </strong>)。然后，我们编译模型。参数优化器和损失值。损失定义了预测值和实际值之间的差异。由于这是监督ML，我们已经标记了数据，我们将得到预测结果，我们将与实际值进行比较。</p><p id="6692" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">第四步:对模型进行训练</p><blockquote class="kb kc kd"><p id="d1f1" class="ix iy jv iz b ja jb jc jd je jf jg jh ke jj jk jl kf jn jo jp kg jr js jt ju hb bi translated">model.fit(x，y，epochs = 500)<br/>print(model . predict([10])</p></blockquote><p id="49fa" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">x和y值表示用500个历元训练模型的输入和输出值，这意味着我们要训练该数据集500次。</p><p id="f01a" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">然后，预测x=10的值。</p><p id="d54a" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">理想情况下，y的值应该是19。执行代码后的预测值是18.9999。因此，该模型相当准确。</p><p id="668d" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">第五步:</strong>保存模型，创建h5和tflite文件格式</p><blockquote class="kb kc kd"><p id="9e5d" class="ix iy jv iz b ja jb jc jd je jf jg jh ke jj jk jl kf jn jo jp kg jr js jt ju hb bi translated">keras _ file = " linear . H5 "<br/>TF . keras . models . save _ model(model，keras_file) <br/> converter = lite。tflitecoverter . from _ keras _ model(model)<br/>TF model = converter . convert()</p><p id="0734" class="ix iy jv iz b ja jb jc jd je jf jg jh ke jj jk jl kf jn jo jp kg jr js jt ju hb bi translated">open("linear.tflite "，" wb ")。写入(tfmodel)</p></blockquote><p id="0866" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">第六步</strong>:创建安卓应用</p><p id="dba8" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">转到Android Studio -&gt;创建新项目。</p><p id="a439" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">最初，您需要在代码中添加以下依赖项:</p><ol class=""><li id="a495" class="kh ki hi iz b ja jb je jf ji kj jm kk jq kl ju km kn ko kp bi translated">将以下包添加到build.gradle文件的依赖项中-</li></ol><blockquote class="kb kc kd"><p id="218c" class="ix iy jv iz b ja jb jc jd je jf jg jh ke jj jk jl kf jn jo jp kg jr js jt ju hb bi translated">实现' org . tensor flow:tensor flow-lite:+'</p></blockquote><p id="9e54" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">然后，我们需要在依赖项上方添加下面的代码</p><blockquote class="kb kc kd"><p id="8ecf" class="ix iy jv iz b ja jb jc jd je jf jg jh ke jj jk jl kf jn jo jp kg jr js jt ju hb bi translated">选项<strong class="iz hj">{<br/></strong>no compress " TF lite "<br/>no compress " lite "<br/><strong class="iz hj">}</strong></p></blockquote><p id="e50c" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">这指定tflite文件不应该像其他文件一样被压缩。</p><p id="be51" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">同步项目，gradle应该可以成功编译。</p><p id="db46" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">2.将tflite文件添加到Android项目的assets文件夹中。</p><p id="4dc2" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">3.在Java文件中添加以下函数</p><blockquote class="kb kc kd"><p id="cb0f" class="ix iy jv iz b ja jb jc jd je jf jg jh ke jj jk jl kf jn jo jp kg jr js jt ju hb bi translated">private MappedByteBuffer loadModelFile()抛出io exception<br/>{<br/>asset file descriptor asset file descriptor = this . getassets()。openFd(" linear . tflite ")；<br/>file inputstream file inputstream = new file inputstream(assetfile descriptor . getfile descriptor())；<br/>file channel file channel = file inputstream . get channel()；<br/><br/>long start offset = asset file descriptor . getstart offset()；<br/>long len = assetfile descriptor . getlength()；<br/> <br/>返回file channel . map(file channel . map mode .<em class="hi">只读_只读</em>，startOffset，len)；<br/> }</p></blockquote><p id="74ad" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">这将把tflite模型文件转换成MappedByteBuffer格式。这是一种优化的格式，有助于我们提高效率和速度。</p><p id="f307" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">4.添加一个解释器，它将使用模型解释数据的输入和输出。</p><blockquote class="kb kc kd"><p id="1689" class="ix iy jv iz b ja jb jc jd je jf jg jh ke jj jk jl kf jn jo jp kg jr js jt ju hb bi translated">Interpreter = new Interpreter(loadModelFile()，null)；</p></blockquote><p id="e997" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">5.在下面添加doInference()函数来计算表达式，并在模型的帮助下获得输出。</p><blockquote class="kb kc kd"><p id="cff5" class="ix iy jv iz b ja jb jc jd je jf jg jh ke jj jk jl kf jn jo jp kg jr js jt ju hb bi translated">public float do inference(String val)<br/>{<br/>float[]input = new float[1]；<br/>输入[0] =浮点。<em class="hi">parse float</em>(val)；<br/>float[][]output = new float[1][1]；<br/> <br/>(输入，输出)；<br/>返回输出[0][0]；<br/> }</p></blockquote><p id="d152" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">参数val是用户给定的输入值。</p><p id="7f31" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">由于模型是基于浮点值开发的，我们将输入字符串值转换为浮点值。然后，我们创建了一个2D输出数组(因为它只有一行和一列)。稍后，解释器将根据输入值产生输出，并将其保存在第0行第0列的输出变量中。</p><p id="9767" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">输出是…..</p><div class="jx jy jz ka fd ab cb"><figure class="kq ij kr ks kt ku kv paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><img src="../Images/dd454963b62d554e000a47531e10021b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*KeJ2ArF86mMF9QigqJDD5w.jpeg"/></div></figure><figure class="kq ij la ks kt ku kv paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><img src="../Images/961631d4d13654921533ae74e089e66c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*ErN5UCz3rdWBx1aiSP2VKQ.jpeg"/></div></figure></div><p id="7b83" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">你可以在<a class="ae lb" href="https://github.com/ShuklaAnuja/Python-ML---Android-Kit" rel="noopener ugc nofollow" target="_blank"><strong class="iz hj"><em class="jv">Github</em></strong></a><strong class="iz hj"><em class="jv">上找到完整的代码片段。</em> </strong></p><p id="b2a8" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">我希望你喜欢这个博客！！！</p><p id="c838" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">请随时发表您的意见和反馈…</p><p id="a60c" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj"/></p><p id="5ae9" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">此外，欢迎新的想法。</p><p id="8e36" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">谢谢大家！:)</p></div></div>    
</body>
</html>