<html>
<head>
<title>Building a Visual Similarity-based Recommendation System Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python构建基于视觉相似性的推荐系统</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/building-a-visual-similarity-based-recommendation-system-using-python-872a5bea568e?source=collection_archive---------4-----------------------#2021-04-15">https://medium.com/geekculture/building-a-visual-similarity-based-recommendation-system-using-python-872a5bea568e?source=collection_archive---------4-----------------------#2021-04-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="39e9" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">从头开始执行基于图像的推荐的全面指南</h2></div><p id="092a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在当今竞争激烈的技术世界中，对于一个成长中的<em class="jt">电子商务平台</em>来说，吸引客户并保持一致的品牌体验至关重要。<strong class="iz hj"> <em class="jt">推荐</em> </strong>这样的相关项目，而不是让用户为了得到他们想要的项目而进行一次又一次的搜索，这更令人印象深刻，并且提供了更好的满足感。</p><p id="a65f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> <em class="jt">产品推荐</em> </strong>通过分析客户之前的购买行为和目前的平台使用情况，可以非常有效地应对这样的挑战。</p><p id="d665" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">产品推荐</em>可以帮助:</p><ul class=""><li id="6a73" class="ju jv hi iz b ja jb jd je jg jw jk jx jo jy js jz ka kb kc bi translated">将购物者转化为顾客</li><li id="7481" class="ju jv hi iz b ja kd jd ke jg kf jk kg jo kh js jz ka kb kc bi translated">吸引客户</li><li id="2651" class="ju jv hi iz b ja kd jd ke jg kf jk kg jo kh js jz ka kb kc bi translated">提高销售额和收入</li><li id="f60d" class="ju jv hi iz b ja kd jd ke jg kf jk kg jo kh js jz ka kb kc bi translated">提供最相关的内容</li><li id="167f" class="ju jv hi iz b ja kd jd ke jg kf jk kg jo kh js jz ka kb kc bi translated">维护品牌体验</li></ul><p id="39e8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">概括地说，有两种推荐方法:</p><ol class=""><li id="a57d" class="ju jv hi iz b ja jb jd je jg jw jk jx jo jy js ki ka kb kc bi translated"><strong class="iz hj">基于内容的推荐</strong></li><li id="fa2c" class="ju jv hi iz b ja kd jd ke jg kf jk kg jo kh js ki ka kb kc bi translated"><strong class="iz hj">协同过滤</strong></li></ol><p id="0cc4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">顾名思义，<em class="jt">基于内容的</em>方法基于<em class="jt">关于客户或产品的</em>附加内容(元数据)进行推荐。对于产品，该<em class="jt">内容</em>可以是产品名称、描述、图片、类别/子类别、规格等。</p><p id="df58" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，这种方法<em class="jt">通过基于<em class="jt">内容</em>找到与给定产品最相似的产品来推荐</em>产品。</p><blockquote class="kj kk kl"><p id="5e21" class="ix iy jt iz b ja jb ij jc jd je im jf km jh ji jj kn jl jm jn ko jp jq jr js hb bi translated"><em class="hi">在本帖中，我们将利用</em>产品图片<em class="hi">实现一个</em>基于内容的<em class="hi">推荐系统。基本上，目标是推荐与最近购买/检查的</em>产品图片<em class="hi">非常相似的</em>产品图片<em class="hi">。</em></p></blockquote><p id="afba" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，这种基于<strong class="iz hj"> <em class="jt">图像的</em> </strong>推荐将有助于<em class="jt">基于顾客最近的购物行为/平台使用向其推荐</em>最相似的产品。</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es kp"><img src="../Images/52e96d10094a7300da643a60988f4974.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5wuv75PVNAFJK97tBcZfPw.png"/></div></div></figure><p id="f021" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们开始使用<a class="ae lb" href="https://www.kaggle.com/vikashrajluhaniwal/fashion-images" rel="noopener ugc nofollow" target="_blank">时尚产品图像数据集</a>来实现这一点。该数据集包含2906张<em class="jt">产品图片</em>，涵盖四个不同的<em class="jt">性别</em>类别(男人、女人、男孩和女孩)。它还包含各种产品特征，如标题、类别、子类别、颜色、性别、类型、用途等。</p><blockquote class="kj kk kl"><p id="18c8" class="ix iy jt iz b ja jb ij jc jd je im jf km jh ji jj kn jl jm jn ko jp jq jr js hb bi translated"><em class="hi">补充说明:为了访问完整的python代码，请遵循kaggle内核</em> <a class="ae lb" href="https://www.kaggle.com/vikashrajluhaniwal/building-visual-similarity-based-recommendation" rel="noopener ugc nofollow" target="_blank"> <em class="hi">此处</em></a><em class="hi">(</em><a class="ae lb" href="https://www.kaggle.com/vikashrajluhaniwal/building-visual-similarity-based-recommendation" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/vikashrajluhaniwal/building-visual-similarity-based-recommendation</a><em class="hi">)。</em></p></blockquote><h2 id="99c7" class="lc ld hi bd le lf lg lh li lj lk ll lm jg ln lo lp jk lq lr ls jo lt lu lv lw bi translated">1.基础数据分析</h2><p id="a7ee" class="pw-post-body-paragraph ix iy hi iz b ja lx ij jc jd ly im jf jg lz ji jj jk ma jm jn jo mb jq jr js hb bi translated">数据集中的前几条记录如下所示。</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es mc"><img src="../Images/b6fda766cdcb233a6a7baa93b9852639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N0uR2zXf8igI2E3DPtaCVQ.png"/></div></div><figcaption class="md me et er es mf mg bd b be z dx">First 5 records from the data</figcaption></figure><p id="c32a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> a. </strong> <strong class="iz hj">基本统计—产品数量、子类别&amp;性别</strong></p><figure class="kq kr ks kt fd ku"><div class="bz dy l di"><div class="mh mi l"/></div></figure><figure class="kq kr ks kt fd ku er es paragraph-image"><div class="er es mj"><img src="../Images/53d770b7a2edcafebefd8899406dbba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*FxswHyOXoIuIotk68ovLfg.png"/></div></figure><p id="b131" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如前所述，该数据集包含9个不同<em class="jt">子类别</em>的2906种产品，涵盖4种不同<em class="jt">性别</em>类型。</p><p id="4083" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> b .每种性别的频率</strong></p><figure class="kq kr ks kt fd ku er es paragraph-image"><div class="er es mk"><img src="../Images/186409851718067e05425549651dab2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*z2x29p8XS6yVStOWlEy-wg.jpeg"/></div></figure><p id="65d8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从输出中，我们可以观察到大部分产品属于<code class="du ml mm mn mo b">Men</code>类别，然后是<code class="du ml mm mn mo b">Women</code>，以此类推。</p><p id="29b0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> c .产品的性别分布</strong></p><figure class="kq kr ks kt fd ku"><div class="bz dy l di"><div class="mh mi l"/></div></figure><figure class="kq kr ks kt fd ku er es paragraph-image"><div class="er es mp"><img src="../Images/0f53c984e9154036566c1b5b03f802c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*SlRFGBHJEt-KI0PDEV659Q.png"/></div></figure><p id="a0f2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从条形图中，我们还可以观察到<code class="du ml mm mn mo b">Men</code>的产品数量最多。同样，数据集几乎是平衡的。</p><h2 id="b7b6" class="lc ld hi bd le lf lg lh li lj lk ll lm jg ln lo lp jk lq lr ls jo lt lu lv lw bi translated">2.数据准备</h2><p id="b18b" class="pw-post-body-paragraph ix iy hi iz b ja lx ij jc jd ly im jf jg lz ji jj jk ma jm jn jo mb jq jr js hb bi translated">既然跨品类<em class="jt">推荐</em>不优选，比如<em class="jt">向一个光棍推荐</em>女生的产品。因此，让我们将数据<em class="jt">按性别划分为4个不同的数据帧。</em></p><figure class="kq kr ks kt fd ku"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="82ee" class="lc ld hi bd le lf lg lh li lj lk ll lm jg ln lo lp jk lq lr ls jo lt lu lv lw bi translated">3.使用ResNet的特征提取</h2><p id="935a" class="pw-post-body-paragraph ix iy hi iz b ja lx ij jc jd ly im jf jg lz ji jj jk ma jm jn jo mb jq jr js hb bi translated">通常，产品图像包含独特的图案及其颜色、形状和边缘。</p><p id="3d96" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">具有同类特征的图像应该是相似的。因此，从图像中提取这些特征将非常有助于<em class="jt">向</em>推荐最相似的产品。</p><p id="aa1a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">如何从图像中提取特征？</strong></p><p id="6f0f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">计算机视觉技术可用于从图像中提取特征。这里，由于我们在数据大小、计算资源和时间上有限制，所以让我们使用标准的<em class="jt">预训练的</em>模型，如<strong class="iz hj"> ResNet </strong>来提取特征。这种<em class="jt">预训练的</em>模型已经在一个巨大的数据集上进行微调和训练(像<strong class="iz hj"> ImageNet </strong>)。这个过程也被称为<em class="jt">迁移学习</em>。</p><p id="b393" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> ResNet </strong></p><p id="d8e4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ResNet是<em class="jt">残差网络</em>的简称，由何于2015年首次提出。目前，它被认为是许多计算机视觉任务的经典神经网络。在2015年的<strong class="iz hj"> ImageNet </strong>挑战赛中，这款机型的表现超过了之前的机型，如<em class="jt"> GoogleNet </em>、<em class="jt"> VGGNet </em>和<em class="jt"> AlexNet </em>。</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es mq"><img src="../Images/0b0da9a0bcd16c662d6f179d0ffdfaa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LHjPgojb9DBsuR9_pHmaig.png"/></div></div><figcaption class="md me et er es mf mg bd b be z dx">ResNet Architecture</figcaption></figure><p id="40a7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该体系结构允许我们成功地训练一个具有152层的非常深和宽的网络。在我们的实现中，我们将使用<em class="jt"> ResNet50 </em>(缩小版的<em class="jt"> ResNet152 </em>)来提取特征。</p><figure class="kq kr ks kt fd ku"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="d391" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt"> extract_features() </em>函数从给定的图像中提取特征。首先根据<em class="jt"> ResNet </em>标准，我们将图像的大小调整为224 x 224，并使用<code class="du ml mm mn mo b">Keras</code>中可用的<strong class="iz hj"> ImageDataGenerator </strong>对其进行归一化。最后，每个图像被表示为一个<em class="jt"> 100352维的</em>特征向量。</p><p id="7efa" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了避免部署后的运行时特性提取，提取的特性保存在<code class="du ml mm mn mo b">NumPy</code>数组中。我们在这里分别为产品id和提取的特性维护两个数组。</p><p id="7c61" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">类似地，同样的<em class="jt">特征提取</em>过程按性别对其他产品图像重复进行。</p><h2 id="c9ac" class="lc ld hi bd le lf lg lh li lj lk ll lm jg ln lo lp jk lq lr ls jo lt lu lv lw bi translated">4.计算欧几里德距离并推荐相似产品</h2><p id="2dea" class="pw-post-body-paragraph ix iy hi iz b ja lx ij jc jd ly im jf jg lz ji jj jk ma jm jn jo mb jq jr js hb bi translated"><em class="jt">距离</em>是评估项目/记录之间相似性的最优选的度量。距离越小，相似度越高，而距离越大，相似度越低。</p><p id="e0a0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">根据几何学有各种类型的距离，如<em class="jt">欧几里德距离</em>、<em class="jt">余弦距离</em>、<em class="jt">曼哈顿距离</em>等。我们将使用<em class="jt">欧几里德距离</em>来计算相似度。</p><p id="a651" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因为我们已经提取了图像特征，所以可以使用<em class="jt">pairwise _ distances()</em>函数形式<em class="jt"> sklearn.metrics </em>轻松计算<em class="jt">欧几里德距离</em>。</p><p id="b48a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦计算出这个距离，我们就可以很容易地按照距离的升序<em class="jt">推荐</em>产品。我们开始吧！</p><p id="8652" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> a .加载提取的特征</strong></p><figure class="kq kr ks kt fd ku"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="64c5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> b .距离计算和建议</strong></p><figure class="kq kr ks kt fd ku"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="f399" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面的<em class="jt">get _ similar _ products _ CNN()</em>函数<em class="jt">根据提取的特征向查询商品推荐</em> 5个最相似的商品。该函数接受两个参数—最近购买/检查的商品的<em class="jt">产品id </em>和推荐的<em class="jt">产品数量</em>。</p><p id="ae15" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">针对产品id <em class="jt"> 13683 </em>推荐的前5 <em class="jt">产品如下图所示。</em></p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es mr"><img src="../Images/c34f49241cafbda1ff145c5bcfc273b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*oIH0zmbZHmSWeoMPyBTLeA.gif"/></div></div></figure><p id="f414" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">同样，我们也可以针对其他性别类型的产品向<em class="jt">推荐</em>产品。让我们看看使用<strong class="iz hj"> Streamlit </strong>的最终部署。</p><h2 id="391e" class="lc ld hi bd le lf lg lh li lj lk ll lm jg ln lo lp jk lq lr ls jo lt lu lv lw bi translated">5.部署解决方案</h2><p id="2387" class="pw-post-body-paragraph ix iy hi iz b ja lx ij jc jd ly im jf jg lz ji jj jk ma jm jn jo mb jq jr js hb bi translated"><strong class="iz hj"> <em class="jt"> Streamlit </em> </strong>是一个交互式库/框架，用于构建数据应用&amp; web应用和部署机器学习工作负载。最重要的是，它不需要任何网页设计和开发的知识。Python知识足以与之交互，因为它是Python兼容的。</p><figure class="kq kr ks kt fd ku"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="8c1e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里，下面的内置函数用于进行交互式部署:</p><ul class=""><li id="3416" class="ju jv hi iz b ja jb jd je jg jw jk jx jo jy js jz ka kb kc bi translated">st.text_input() —接受用户的动态输入</li><li id="d6af" class="ju jv hi iz b ja kd jd ke jg kf jk kg jo kh js jz ka kb kc bi translated">st.write() —将消息/参数写入应用程序</li><li id="f953" class="ju jv hi iz b ja kd jd ke jg kf jk kg jo kh js jz ka kb kc bi translated">ST . title()-显示图像或图像列表。</li></ul><p id="a641" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">像前面一样，这里的<em class="jt">get _ similar _ products _ CNN()</em>函数<em class="jt">根据指定的参数推荐</em>最相似的产品。</p><p id="d352" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要在终端类型中执行此部署脚本:</p><pre class="kq kr ks kt fd ms mo mt mu aw mv bi"><span id="4c15" class="lc ld hi mo b fi mw mx l my mz">streamlit run recom_deployment.py</span></pre><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es na"><img src="../Images/0b7ac4ab59b72a5f9134ae46274c4c81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*08uZt5bV6Q3ZbAcXC7R8wg.gif"/></div></div></figure><p id="e126" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">提示:这个完整的部署代码可以从</em> <a class="ae lb" href="https://drive.google.com/file/d/123XGxKvRY7sk2pnTmVOyLp9FH-iFL5oN/view?usp=sharing" rel="noopener ugc nofollow" target="_blank"> <em class="jt">这里</em> </a> <em class="jt">下载。</em></p><h2 id="919a" class="lc ld hi bd le lf lg lh li lj lk ll lm jg ln lo lp jk lq lr ls jo lt lu lv lw bi translated">结束注释</h2><p id="320e" class="pw-post-body-paragraph ix iy hi iz b ja lx ij jc jd ly im jf jg lz ji jj jk ma jm jn jo mb jq jr js hb bi translated">在这篇文章中，我们讨论了关于<em class="jt">产品推荐</em>的内容，并通过使用<em class="jt"> ResNet </em>利用可用的产品图片实现了一个<em class="jt">基于视觉相似性的推荐</em>系统。</p></div></div>    
</body>
</html>