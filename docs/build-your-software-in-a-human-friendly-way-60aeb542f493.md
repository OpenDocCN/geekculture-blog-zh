# 以人类友好的方式构建可维护的软件

> 原文：<https://medium.com/geekculture/build-your-software-in-a-human-friendly-way-60aeb542f493?source=collection_archive---------23----------------------->

我在亚马逊做了 5 年的软件工程师(对那些知道的人来说，我是一只黄獾)。我在亚马逊零售，Kindle，AWS 都有过。这三个部门有着完全不同的业务目标，他们使用不同的技术堆栈构建完全不同的软件，然而在这三个团队中，我总是从人们那里听到一个单一的话题:“XXX(某个工程师)写了这样奇怪的代码，我却无法理解它！！!"

这句话在我的职业生涯中至少说过 101 次。我非常肯定，其他人说的不止这些。我个人一直沉浸在代码中，代码中有 12 层不同的嵌套 for 和 in 循环，大量的 try-catch 块穿透了至少 5 个方法调用堆栈，变量名与方法名不匹配，数据库是我们的服务所依赖的，但没有关于其模式的文档。至少可以说，这些并不有趣。

我开始思考，为什么软件是一个如此困难的问题？为什么我们不能开发出这样的软件，让像我这样的软件经理不必花费尴尬的时间去讨好我们团队的代码库不是那么糟糕，并且是可维护的？你可能会说软件很难，是的，有些软件问题很难，比如“NP = P 吗？”或者拜占庭将军的问题，但我敢打赌，你在工业生产软件中看到的 90%的代码并不难，因为我们已经建立了像 AWS 这样的云服务来完成大量繁重的工作。

我认为其中一个问题是，工程学校、课程，甚至公司的入门材料都更关注工具，比如如何编写 java 代码、如何连接到 RDB、如何设计高度可用的架构等。很少，我会看到这些程序关注人类，工具的使用者。

为什么我们不多谈谈人类，那些实际上会和软件互动的人呢？人类将负责编写代码、审查代码、将代码部署到产品中、测试代码、监控代码和扩展代码。你怎么能让人类维护一个完全为了反人类而构建的代码库呢？

> 一个男人是多么了不起的作品啊！理性是多么高尚！教员是多么无限啊！在形式和移动多么表达和令人钦佩！在行动上多么像一个天使！在忧虑中多么像一个神！世界之美！动物的典范
> 
> **——*哈姆雷特*(2 . 2 . 295–302)，哈姆雷特到罗森格兰兹和吉尔登斯滕**

虽然人类在莎士比亚眼中是很神奇的，但是有一些事实我相信工程师在开发软件的时候应该记住。

# 事实 1。人类会忘记

从今天算起整整 57 天前，我晚餐吃了什么？没有人能准确地回答这个问题，除非你有一本记录了你所有活动的日历。在我说写技术文档，在你复杂的逻辑中写注释等之前。我很乐意进一步扩展这个概念。

一旦掌握了高层次的概念和结构，人类就擅长记忆，但他们不擅长记忆细节。使用历史事实的一个例子是，应该相对容易记住“在工业时代，美国有一些垄断企业控制着重要的经济部门”，然后记住像“在 1890 年，标准石油公司控制着美国 80%的石油”这样的细节。

我们可以构建利用这些特性的软件，这样人类就可以有效地使用软件。您可以围绕您的软件构建概念，并让代码注释详细描述所有示例。例如，我曾经构建了一个服务于大约 50 个 API 的实时请求-响应服务。它们都遵循 java 代码中如下所示的模式:API 处理程序方法签名总是“public XResponse XHandler(XRequest)”其中 X 是 API 名称，位于名为“dao”的模块中的所有数据访问对象(DAO)都通过 Google Guice 注入到该类中。您可能没有注意到，但是如果您在整个 50 个 API 中遵循这两条规则，这个概念就是一个文档，可以指导您的工程师在哪里找到代码。他们很容易记住这一点。

至于细节，你需要在你写的代码中更加警惕。总是问自己这个问题，“30 天后你还能记得这件事吗？”我个人发现这些类型的数据特别容易忘记:

1.  **可以有多种解释的事实**。一个例子是“TTL”。问个小问题，如果您刚刚接管了一个关系数据库，它有一个名为“TTL”的列，那么应该很容易知道这应该是数据应该被删除的 UNIX 时间戳。但现在的问题是，“单位是毫秒还是秒？”你去看代码，你看到变量名只是“TTL ”,不知道它是什么单位。因此，您需要认真思考，假设它是“第二个”，部署到生产系统，并开始写入新条目，用秒的 TTL 更新现有条目。一段时间后，您将整个数据库清除干净，因为它实际上是以毫秒为单位的。所以，如果这个变量是一个有意义的数字，并且没有出错的余地，请把单位放在它的名字里。
2.  **自营业务逻辑**。假设你操作一个高度专业化的领域，比如“我需要基于 X 机器学习模型、Y 领域、Z 外部 API 等过滤我的搜索结果”。除非你天天看着他们，因为这不是常识，很有可能会忘记。

所以如果你需要文档，要知道不是所有的内容都是一样的。你需要确保有效地记录。如果你的软件遵循模式，那么你只需要记录模式的异常。如果你的软件有容易被遗忘的信息，把它们写在人们知道去哪里搜索的地方。(另一种模式)

# 事实 2。人类会犯错

不管有没有压力，人类都会犯错。过去，金融行业出现了许多失误。我个人最喜欢的是[胖手指错误](https://en.wikipedia.org/wiki/Fat-finger_error)。编写 bug 是软件工程师最常犯的错误，工程师也会犯操作上的错误，比如不小心掉了一张生产表。虽然一些错误，如青霉素的发现，改变了人类历史的进程，但大多数错误并不那么令人印象深刻。

软件工程师操作关键软件。也许没有核电站的安全检查员工作重要。但是对于一些公司的业务来说，这是非常重要的，即使是凌晨 2 点，他们也会呼叫 oncall 工程师。有一些方法可以防止人们犯错误，这些方法应该被采用，并且应该经常被检查，因为它们可能是昂贵的并且对效率有害。

1.  **双人你的软件**。发射导弹时采用军方的双人规则，以确保设定正确的目标。总是有第二个人审查代码的错误，监视一个人在生产系统上按下哪个按钮，以及其他关键操作。
2.  **限制人类互动**。人类当然会犯错，所以不要让他们碰任何东西。因此，如果您有一个手动软件发布机制，其中工程师需要将 java zip 文件 SCP 到服务主机上，并运行带有 100 个参数的脚本来启动服务，请使用自动化 CI/CD 管道来实现自动化。不知什么原因，人类一直在侵入主机？使用最低特权原则来限制他们对实际需求的访问。你需要做一个 DNS 逐步切换，可以在你的警报响起时立即回滚？写个程序来做，程序总是比人更准确更快。
3.  让机器来做无聊的工作。如果现在我给你一个有 2000 个文件的 zip 文件，我想让你为你的 CTO 的一个超级重要的项目把压缩格式从 GZIP 改成 WinRAR。当然，你可以手工完成，但是你能自信地告诉你的 CTO 你已经完成了每一个文件，没有任何错误吗？你确定你没有因为多按了半秒钟向下滚动键而跳过任何文件吗？如果不能自信，就写个程序来做。这将是一个简单的 for 循环。并且知道一件事，当你对单调乏味的工作感到厌倦时，机器会毫无怨言地愉快地接受它，只要你正确地执行，它会 100%正确地完成它。

人类会犯错误，所以不要设计你的软件，让人类去执行冗长乏味的机器任务。通过限制人的访问，不要给人犯错的空间。

# 事实 3。人类无法同时处理大量信息

你知道为什么你的电话号码大部分地方写的是 111–111–1111 的格式而不是 11111111111 吗？*(如果你仔细阅读，我实际上在我的第一稿中多按了一个 1，我故意保留了下来。我很确定大多数读者在阅读时会错过它。如果你没有，恭喜你！)*因为分离使每个任务变得更小，你也更容易理解数字。这个例子也表明，人类的理解力更喜欢“更多更小的任务”，而不是“少数更大的任务”。不知何故，人脑容量似乎更倾向于水平可伸缩模型。

作为一名软件工程师，你设计和实现的软件不应该充斥着信息。“信息”的范围延伸到代码、日志、操作仪表板、指标。

1.  **看你的代码** [**圈复杂度**](https://en.wikipedia.org/wiki/Cyclomatic_complexity) 。我建议您将圈复杂度放入 checkstyle 规则集中，如果这种复杂度变得很高，那么实际上代码发布过程就会失败。有很多方法可以降低复杂性，我不会在这里一一列举。但是一些简单的概念非常有效，比如使用子方法来分解大方法，使用依赖注入来将复杂的对象分解成更小的、易于理解的对象，等等。
2.  **经常查看您的日志和仪表板**。更好的是，让其他从未评估过你的系统的人来评估一下。您的仪表板传达的是关于系统健康和业务健康的重要信息，还是无用的噪音？如果现在有一个关键的软件问题，您的日志和仪表板能提供足够的信息或过多的噪音来确定哪个组件有问题吗？

不要提供对人类来说太重的工件，这样可以使你的软件易于维护。当然，你不能依靠人类来做这项工作。因为他们会犯错误，或者只是情绪化，不想去做。你需要自动化、工具和流程来提高人类的低效率。

# 摘要

我希望这篇文章能从人的角度给你一个清晰的软件工程视角。我真的相信，软件应该被构建得对人类友好，便于维护、扩展甚至弃用。这需要工程师对人类行为有很好的洞察力，以及如何让人类的能力发光发亮，并限制他们的弱点的影响。