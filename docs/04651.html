<html>
<head>
<title>Handle null / empty value from X12 schema to database schema</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理从X12模式到数据库模式的空值</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/handle-null-empty-value-from-x12-schema-to-database-schema-9f2e8c5b8aad?source=collection_archive---------61-----------------------#2021-06-30">https://medium.com/geekculture/handle-null-empty-value-from-x12-schema-to-database-schema-9f2e8c5b8aad?source=collection_archive---------61-----------------------#2021-06-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="519e" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">BizTalk —以EDI 850(X12 _ 00401)N1 looking部分为例</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/a6f3b8ab7b1ab09a1ddf173496b1d709.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/0*CLRdRwwTHhqIQiVP.png"/></div><figcaption class="jf jg et er es jh ji bd b be z dx">Photo from: <a class="ae jj" href="https://safe-software.gitbooks.io/fme-desktop-basic-training-2017/content/DesktopBasic2Transformation/2.04.SchemaMapping.html" rel="noopener ugc nofollow" target="_blank">https://safe-software.gitbooks.io/fme-desktop-basic-training-2017/content/DesktopBasic2Transformation/2.04.SchemaMapping.html</a></figcaption></figure><p id="73ca" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">处理EDI850的默认途径可能是:</p><pre class="iy iz ja jb fd kg kh ki kj aw kk bi"><span id="ea73" class="kl km hi kh b fi kn ko l kp kq">1. Receiving EDI850 (source in)<br/>2. BizTalk mapping and processing<br/>3. Store into database table (target)<br/>4. ERP processing<br/>5. Others...</span></pre><p id="e21c" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">根据EDI 850模式，我们在报头部分有如下定义的N1元素。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es kr"><img src="../Images/06e27c115f357b107a46d94791ba3e13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*j0AmSzTapCWjoInd-SW7LA.png"/></div></figure><p id="9fe7" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">查看N1的原始数据可能如下所示:</p><pre class="iy iz ja jb fd kg kh ki kj aw kk bi"><span id="a30c" class="kl km hi kh b fi kn ko l kp kq">N1*BT* Accts Payable~<br/>N3*P.O. Box 149257~<br/>N4*Austin*TX*78714-4927~<br/>N1*ST*Address IT~<br/>N2*Address CO*Address IT~<br/>N3*Address*15/Address, IT Address~<br/>N4*Address*IA*76763*US*SP*TEST~<br/><a class="ae jj" href="mailto:PER*BD**TE*515-242-3492*EM*Mail@domin.COM" rel="noopener ugc nofollow" target="_blank">PER*BD**TE*515-242-3492*EM*Mail@domin.COM</a>~</span></pre><p id="9478" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">以下是EDI元素→数据库字段之间N4扇区设计的物理映射:</p><pre class="iy iz ja jb fd kg kh ki kj aw kk bi"><span id="4c32" class="kl km hi kh b fi kn ko l kp kq"># IF <em class="ks">N101</em> IS <strong class="kh hj">BT</strong><br/>N401 --&gt; BILL_TO_CITY_NAME<br/>N402 --&gt; BILL_TO_STATE<br/>N403 --&gt; BILL_TO_POST_CODE<br/>N404 --&gt; BILL_TO_CNTY_CODE<br/>N405 --&gt; By Pass(Fixed code: SP for this case)<br/>N406 --&gt; BILL_TO_LOCA_ID<br/><br/># IF <em class="ks">N1101</em> IS <strong class="kh hj">ST</strong><br/>N401 --&gt; SHIP_TO_CITY_NAME<br/>N402 --&gt; SHIP_TO_STATE<br/>N403 --&gt; SHIP_TO_POST_CODE<br/>N404 --&gt; SHIP_TO_CNTY_CODE<br/>N405 --&gt; By Pass(Fixed code: SP for this case)<br/>N406 --&gt; SHIP_TO_LOCA_ID</span></pre><p id="e1d8" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">因此，N1循环总体映射图可能如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es kt"><img src="../Images/95ede99ea79c62fbbc37536a18ccdc0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mn0HTwxKiOvSVCUfxZ66pQ.png"/></div></div></figure><blockquote class="ky kz la"><p id="b649" class="jk jl ks jm b jn jo ij jp jq jr im js lb ju jv jw lc jy jz ka ld kc kd ke kf hb bi translated">注意，我们有N405:SP的固定值，所以我们决定此时不传递给数据库。</p></blockquote><p id="5967" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">我们在N1循环上做了些手脚:</p><pre class="iy iz ja jb fd kg kh ki kj aw kk bi"><span id="c464" class="kl km hi kh b fi kn ko l kp kq">1) Concatenate Functoid<br/>  - Separated each element with in delimiter '，'<br/>  - Separated whole N1 sector with in delimiter '；'</span></pre><p id="3d52" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">功能输入如下:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es le"><img src="../Images/3936fd17131564802691cef2cd0fe657.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*exZfyWyQO_F9Fb9R1VTLNw.png"/></div></figure><pre class="iy iz ja jb fd kg kh ki kj aw kk bi"><span id="6bc9" class="kl km hi kh b fi kn ko l kp kq">2) Cumulative Concatenate Functoid<br/> - Input the string of concatenate from step-(1)<br/> - Output cumulative concatenate string to script </span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lf"><img src="../Images/ce50d05fc7a7a3ea13f591af89fcec94.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*z8LcPQcHElYi_zDDaYOwMw.png"/></div></figure><p id="b9af" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">在脚本内部，我们在内联C#下面写下:</p><pre class="iy iz ja jb fd kg kh ki kj aw kk bi"><span id="5180" class="kl km hi kh b fi kn ko l kp kq">// source data combined two parts<br/>// using code (N101: BT/ST) to decide the part<br/>// the Idx: index sequence of location that create by the step-(1)<br/>// return the value of each element (N101/N102...N406)<br/>public string GetData (string SourceData, string Code, int Idx) {<br/>      string Result = "";<br/>      string[] a = SourceData.Split ('；');<br/>      foreach (string word in a) {<br/>          string[] b = word.Split ('，');<br/>          if (b[0] == Code) {<br/>              Result = b[Idx];<br/>              break;<br/>          }<br/>      }<br/>      return Result;<br/>  }</span></pre><p id="5902" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">根据“脚本”functoid，我们可以设置相应的“代码”和“Idx”输入，以获取所需的元素并映射到目标数据库字段。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lg"><img src="../Images/b7d47ada4c563305c9ef0e1a7b97470b.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*j5DYVA-nq2DZ32FKsP3p4Q.png"/></div></figure><p id="2140" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">这里我们面临的问题是，根据EDI定义，N405和N406对应该是存在或不存在的对。但是，有时我们会遇到接收以下格式的问题:</p><pre class="iy iz ja jb fd kg kh ki kj aw kk bi"><span id="a8d7" class="kl km hi kh b fi kn ko l kp kq"># N4 without N405 &amp; N406<br/>N4*Address*IA*76763*US*~</span></pre><p id="9d8e" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">N4条目的格式导致目标数据库字段SHIP_TO_LOCA_ID变成了<em class="ks"> "" </em>(空值)而不是<em class="ks"> null </em>值。所以我们补充道:</p><pre class="iy iz ja jb fd kg kh ki kj aw kk bi"><span id="5b81" class="kl km hi kh b fi kn ko l kp kq">3) Size Functoid<br/>  - Input from the step-(2)</span><span id="9403" class="kl km hi kh b fi lh ko l kp kq">4) Greater Than Fuctoid<br/> - Input from the step-(3)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es li"><img src="../Images/a10ca1de84f1446f19e35299772a22d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*eVu2FAh2qc9dSXOtYsooUw.png"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es le"><img src="../Images/cc2fb6b81bbb288897667bd5528fd032.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*CvoYWY_06k1HGUiyJEEiqw.png"/></div></figure><p id="0e54" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">所以我们有了最后一步:</p><pre class="iy iz ja jb fd kg kh ki kj aw kk bi"><span id="86f5" class="kl km hi kh b fi kn ko l kp kq">5)  Value Mapping Fucntoid<br/>-  If the Sizeof(step-(4)) &gt; 0 then assign the value of step-(4) to the target database field<br/>- Otherwise the target database remain null</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lj"><img src="../Images/ee9eb28638cb044d4be0130bf72e5e57.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*-s4MW0bLBDp_5n66HjVEsw.png"/></div></figure><h1 id="8449" class="lk km hi bd ll lm ln lo lp lq lr ls lt io lu ip lv ir lw is lx iu ly iv lz ma bi translated">参考</h1><ul class=""><li id="aeff" class="mb mc hi jm b jn md jq me jt mf jx mg kb mh kf mi mj mk ml bi translated"><a class="ae jj" href="https://blog.sandro-pereira.com/2014/06/12/biztalk-mapper-working-with-nillable-values-xsiniltrue/" rel="noopener ugc nofollow" target="_blank">https://blog . Sandro-Pereira . com/2014/06/12/biztalk-mapper-working-with-nil lable-values-xsiniltrue/</a></li><li id="9ec3" class="mb mc hi jm b jn mm jq mn jt mo jx mp kb mq kf mi mj mk ml bi translated"><a class="ae jj" href="https://docs.microsoft.com/en-us/biztalk/core/technical-reference/cumulative-concatenate-functoid" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/biztalk/core/technical-reference/cumulative-concatenate-functoid</a></li><li id="4f8b" class="mb mc hi jm b jn mm jq mn jt mo jx mp kb mq kf mi mj mk ml bi translated"><a class="ae jj" href="https://stackoverflow.com/questions/60898340/concatenating-values-from-the-repeating-nodes-under-repeating-nodes-in-biztalk-m" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/60898340/concatenating-values-from-the-repeating-nodes-under-repeating-nodes-in-biztalk-m</a></li></ul></div></div>    
</body>
</html>