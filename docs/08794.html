<html>
<head>
<title>How To Implement Kontent Previews in Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Next.js中实现Kontent预览</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-implement-kontent-previews-in-next-js-c2ad58f8243e?source=collection_archive---------18-----------------------#2021-11-14">https://medium.com/geekculture/how-to-implement-kontent-previews-in-next-js-c2ad58f8243e?source=collection_archive---------18-----------------------#2021-11-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/449fd3f449247ce56b95a95f73074d01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p7q_wQn_YZEeoAxI"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@synkevych?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Roman Synkevych</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e269" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">他们说前端开发就是很好地展示数据。我相信这是真的，将数据/内容从代码中分离出来是朝着这个方向迈出的一大步。使用像Kontent这样的CMS可以将内容编辑和网站架构分离开来，特别是在像营销网站或博客这样的内容密集型网站中。</p><p id="681a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从CMS获取内容是好的，但是让你的内容编辑能够预览他们的修改更好(也可以防止破坏网站)。以下是如何用Kontent CMS和一个Next.js应用程序来实现。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jt"><img src="../Images/680659de1cf127613e05768d102f60b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CIqvh1yUxoCNB2rH"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@florianklauer?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Florian Klauer</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b854" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们如何实现这一目标？令人欣慰的是，Next.js提供了开箱即用的特性，即API路由，是为静态网站量身定制的。</p><p id="e8d7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本质上，我们将通过自定义API路由“捕捉”预览请求，并重定向到要预览的页面，但页面将被告知它应该从Kontent的预览API而不是常规的交付API获取。</p><p id="65d5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本教程有几个假设:你已经在你的Next.js应用中实现了Kontent，你想要预览的页面已经在其<em class="jy"> getStaticProps </em>函数中获取了内容(你也有Next.js的工作知识)。</p><p id="2d95" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，获取你的项目的预览API密匙，位于Kontent上你的项目的<strong class="ix hj">项目设置</strong>中。使用主键:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jz"><img src="../Images/38a301c49ed27f7867e4a258c80b94f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RY7umUw8kXBa4Fve9asqWQ.png"/></div></div></figure><p id="5d31" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将把它放在我们的<em class="jy">中。env </em>文件，并将其命名为KONTENT_PREVIEW_KEY。</p><p id="5ba7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，让我们修改我们的数据获取函数，使其也能够从预览API中获取数据。现在，这个函数应该看起来像这样:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ka"><img src="../Images/e2b5e74ce06e8d7728873d4a8329e06a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3zJmRudw6l6n6uLmsVAlPQ.png"/></div></div></figure><p id="98c9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将向它添加一个预览布尔参数，并相应地配置我们的查询:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kb"><img src="../Images/d5bfd6fc6d0f4f5e5da99bbc965418b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NSPlZbIC9VbjdKwQdiKoiw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Kontent data fetching function, with preview logic</figcaption></figure><p id="8f99" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，当我们给这个函数传递一个“true”参数时，它将获取我们内容的预览版本。但首先，我们需要做一点设置。</p><p id="3852" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在Next.js项目中，在<strong class="ix hj"> src </strong>文件夹中，创建一个名为<strong class="ix hj"> api </strong>的文件夹。在<strong class="ix hj"> src/api </strong>内部，创建一个名为<strong class="ix hj"> preview.js </strong>的文件。现在这是一个API路由，因此，我们可以通过使用一个处理函数来处理来自它(来自Kontent)的请求:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kc"><img src="../Images/f823bef8fb946da7ac7d0f45700af548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DzYSoz0YnIdcdyPoQFWhGg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">The handler function, setting a preview cookie on the page</figcaption></figure><p id="448d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面代码的第3行设置了预览cookies，我们将在页面内部使用它来知道获取哪种数据(如<a class="ae iu" href="https://nextjs.org/docs/advanced-features/preview-mode#step-1-create-and-access-a-preview-api-route" rel="noopener ugc nofollow" target="_blank"> Next.js文档</a>中所解释的)。第4行利用请求中的查询参数来了解要显示哪个页面。</p><p id="8da9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">既然我们已经设置了API路由，我们需要向它发送Kontent请求。在本例中，我们要预览的页面位于<em class="jy">yourdomain.com</em>T20/我的预览页面</p><p id="9daa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们只需要在<strong class="ix hj">项目设置/预览URL</strong>中设置Kontent预览。找到与您的页面对应的内容模型，并指定URL:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/2e0087b844ab6afa2a52e9bd83fd326e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XLu07kcMTuiBEBBFuKJ4Jg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">In production, replace localhost with your actual domain name</figcaption></figure><p id="b26f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将调用我们的API路径(位于<strong class="ix hj"> /api/preview </strong>)并为处理函数提供我们希望在预览中看到的页面的名称。</p><p id="5c3c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，现在我们只需要编辑页面本身的数据获取逻辑，以获取预览数据或发布数据。在预览之前，逻辑应该如下所示:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ke"><img src="../Images/17f8bd232623f5cbaf98c4f8604c970b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B4vhOKLVKnJaudpzWvnJuQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">getStaticProps code before without preview logic</figcaption></figure><p id="b04e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">同样，为了简单起见，这个例子是人为设计的。现在，当处于预览模式时，我们的页面将从我们的API路由处理函数传递一个上下文对象，该对象将具有一个预览布尔值。我们只需要将该参数传递给我们的数据获取函数，当处于预览模式时，它将从预览API中获取数据:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kf"><img src="../Images/e77900690703c5cff63060fd1dd14c83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SGYOsj7dVT8swrrWXt1JIw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">getStaticProps with preview logic</figcaption></figure><p id="bff1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Next.js的预览模式会在运行时出现异常并获取数据。其余时间，Next.js将照常在构建时获取发布的数据。</p><p id="03f7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就对了。你现在可以利用Kontent的预览功能。只需导航到您在<strong class="ix hj">预览网址</strong>中设置的内容，然后点击“预览”按钮。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/24cffdfd665b53e959f3aecc4b42db88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NdomZvjOEKl5NnNW86AxAg.png"/></div></div></figure><p id="f08c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Next.js Kontent示例:<a class="ae iu" href="https://github.com/vercel/next.js/tree/canary/examples/cms-kontent" rel="noopener ugc nofollow" target="_blank">https://github . com/ver cel/next . js/tree/canary/examples/CMS-Kontent</a></p><p id="c31b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Next.js预览文件:<a class="ae iu" href="https://nextjs.org/docs/advanced-features/preview-mode" rel="noopener ugc nofollow" target="_blank">https://nextjs.org/docs/advanced-features/preview-mode</a></p><p id="b25c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">kontent docs on preview:<a class="ae iu" href="https://docs.kontent.ai/tutorials/develop-apps/build-strong-foundation/set-up-preview" rel="noopener ugc nofollow" target="_blank">https://docs . kontent . ai/tutorials/develop-apps/build-strong-foundation/setup-preview</a></p></div></div>    
</body>
</html>