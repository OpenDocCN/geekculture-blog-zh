<html>
<head>
<title>Graph Database in Practice on Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes上的图形数据库实践</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/graph-database-in-practice-on-kubernetes-38932dc3396f?source=collection_archive---------15-----------------------#2022-09-29">https://medium.com/geekculture/graph-database-in-practice-on-kubernetes-38932dc3396f?source=collection_archive---------15-----------------------#2022-09-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/34669e6f572b9d47197f26da5e22bb25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sDhFGcnijvZNyHp_.png"/></div></div></figure><h1 id="315f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是Kubernetes</h1><p id="3878" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">Kubernetes是一个开源平台，用于管理云平台上多个主机上的容器化应用程序。Kubernetes旨在使用户能够简单高效地部署容器化的应用程序。它为用户提供了一套部署、规划、更新和维护应用程序的机制。</p><p id="1f50" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在架构上，Kubernetes为用户部署、维护和扩展应用程序提供了一系列构建块。构成Kubernetes的组件是松散耦合和可伸缩的，旨在支持各种工作负载。可伸缩性主要是由Kubernetes APIs实现的，这些API主要用作伸缩的内部组件和运行在Kubernetes上的容器。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/7100d4bff8f612068cd85e863a933cd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FYDRFSxWFBjJFdPS.png"/></div></div></figure><p id="f2e9" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Kubernetes主要由以下核心组件组成:</p><ul class=""><li id="9e24" class="kw kx hi jq b jr km jv kn jz ky kd kz kh la kl lb lc ld le bi translated"><code class="du lf lg lh li b">etcd</code>。存储整个集群的状态。</li><li id="6557" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated"><code class="du lf lg lh li b">kube-apiserver</code>。提供操作资源的唯一条目，并提供验证、身份验证、访问控制以及API注册和查找操作。</li><li id="ca65" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated"><code class="du lf lg lh li b">kube-controller-manager</code>。观察集群的状态，例如故障检测、自动扩展和滚动更新。</li><li id="e2f8" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated"><code class="du lf lg lh li b">kube-scheduler</code>。计划资源。调度器根据预定义的调度策略将pod分配给相应的节点。</li><li id="77e8" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated"><code class="du lf lg lh li b">kubelet</code>。维护容器的生命周期并管理卷和网络。</li><li id="f6dd" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated"><code class="du lf lg lh li b">kube-proxy</code>。在群集内提供服务发现和负载平衡。</li></ul><h1 id="373c" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">Kubernetes和数据库</h1><p id="6b53" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">数据库容器化现在非常流行，那么Kubernetes能给数据库带来什么呢？</p><ul class=""><li id="84e0" class="kw kx hi jq b jr km jv kn jz ky kd kz kh la kl lb lc ld le bi translated"><strong class="jq hj">故障恢复</strong> : Kubernetes提供故障恢复特性。如果一个数据库部署在Kubernetes上，当应用程序停止运行时，Kubernetes允许它自动重启或迁移到集群中的另一个节点。</li><li id="bbc2" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated"><strong class="jq hj">存储管理</strong> : Kubernetes支持各种存储解决方案，因此部署在其上的数据库可以透明地使用不同的存储解决方案。</li><li id="d5b2" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated"><strong class="jq hj">负载平衡</strong> : Kubernetes服务提供了负载平衡功能，因此它可以平衡对数据库实例的不同副本的外部访问。</li><li id="3e25" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated"><strong class="jq hj">水平可伸缩性</strong>:根据数据库集群的资源利用率，Kubernetes可以扩展副本的数量以提高资源利用率。</li></ul><p id="f35e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">到目前为止，许多数据库，如MySQL、MongoDB和TiDB，在Kubernetes集群上运行良好。</p><h1 id="e87f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">Kubernetes上实践中的星云图</h1><p id="47b8" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">NebulaGraph是一个分布式开源图形数据库。它有三个主要组件:用于查询引擎的nebula-graphd、用于数据存储的nebula-stored和用于元数据的nebula-metad。Kubernetes为NebulaGraph带来了以下好处:</p><ul class=""><li id="b2f3" class="kw kx hi jq b jr km jv kn jz ky kd kz kh la kl lb lc ld le bi translated">Kubernetes可以在nebula-graph、nebula-metad和nebula-stored的不同副本之间平衡负载。它们可以通过Kubernetes的域服务自动发现彼此。</li><li id="ef22" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">使用StorageClass，用户不需要感知PVC (PersistentVolumeClaim)和PV (PersistentVolume)的设计。Kubernetes可以透明地访问本地卷或云存储。</li><li id="2f60" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">在Kubernetes上部署NebulaGraph集群只需几秒钟，而且Kubernetes还可以在用户察觉不到的情况下升级集群。</li><li id="f6e2" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">Kubernetes能够自动恢复星云星团。如果单个副本崩溃，Kubernetes可以自动恢复它，无需人工干预。</li><li id="904f" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">Kubernetes可以根据资源利用率弹性地扩展星云星团以提高其性能。</li></ul><p id="5011" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，我来详细介绍一下这种做法。</p><h1 id="365c" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">集群部署</h1><h2 id="6c68" class="lo ir hi bd is lp lq lr iw ls lt lu ja jz lv lw je kd lx ly ji kh lz ma jm mb bi translated">软件和硬件要求</h2><p id="e301" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">以下是本练习中涉及的硬件和操作系统的规格:</p><ul class=""><li id="af1e" class="kw kx hi jq b jr km jv kn jz ky kd kz kh la kl lb lc ld le bi translated">操作系统是CentOS-7.6.1810 x86_64。</li><li id="9725" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">虚拟机配置:</li><li id="6b87" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">4个CPU</li><li id="7cc8" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">8G内存</li><li id="23f6" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">50G系统盘</li><li id="7114" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">50G数据磁盘A</li><li id="b3cd" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">50G数据磁盘B</li><li id="1f04" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">Kubernetes版本:1.14或更高版本</li><li id="946e" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">NebulaGraph版本:2.0.0-rc1</li><li id="6630" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">数据存储:本地PV</li><li id="c7e3" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">CoreDNS版本:1.6.0或更高版本</li></ul><h2 id="a010" class="lo ir hi bd is lp lq lr iw ls lt lu ja jz lv lw je kd lx ly ji kh lz ma jm mb bi translated">集群的规划</h2><p id="e5d8" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">下表列出了集群的组成方式。</p><p id="8ee0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">服务器IPNebula服务192 . 168 . 0 . 1主机192.168.0.2graphd，metad-0，存储-0节点192.168.0.3graphd，metad-1，存储-1节点192.168.0.4graphd，metad-2，存储-2节点</p><h2 id="5f19" class="lo ir hi bd is lp lq lr iw ls lt lu ja jz lv lw je kd lx ly ji kh lz ma jm mb bi translated">要部署的组件</h2><ul class=""><li id="4e13" class="kw kx hi jq b jr js jv jw jz mc kd md kh me kl lb lc ld le bi translated">舵3</li><li id="1444" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">本地卷和本地卷的插件</li><li id="33fd" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl lb lc ld le bi translated">星云图</li></ul><h1 id="1dec" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">安装舵3</h1><p id="ddf5" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">Helm是Kubernetes的包装经理。Helm可以简化Kubernetes上应用程序的部署。我不会在这篇文章中涉及Helm的细节。如果你有兴趣，请参考舵手的<a class="ae mf" href="https://www.hi-linux.com/posts/21466.html" rel="noopener ugc nofollow" target="_blank">快速入门指南。在本练习中，将使用舵3。</a></p><ol class=""><li id="d60d" class="kw kx hi jq b jr km jv kn jz ky kd kz kh la kl mg lc ld le bi translated">下载并安装Helm 3:打开一个终端，运行以下代码。</li></ol><pre class="ks kt ku kv fd mh li mi mj aw mk bi"><span id="475e" class="lo ir hi li b fi ml mm l mn mo">$ wget https://get.helm.sh/helm-v3.5.2-linux-amd64.tar.gz<br/>$ tar -zxvf helm/helm-v3.5.2-linux-amd64.tgz<br/>$ mv linux-amd64/helm /usr/bin/helm</span></pre><p id="1125" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">2.查看头盔版本</p><p id="e3f8" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">要查看Helm的版本，请运行<code class="du lf lg lh li b">helm version</code>。在此示例中，将返回以下行。</p><pre class="ks kt ku kv fd mh li mi mj aw mk bi"><span id="8818" class="lo ir hi li b fi ml mm l mn mo">version.BuildInfo{Version:"v3.5.2", <br/>GitCommit:"167aac70832d3a384f65f9745335e9fb40169dc2", <br/>GitTreeState:"dirty", GoVersion:"go1.15.7"}<br/>}</span></pre><h1 id="5d56" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">配置本地卷</h1><p id="de69" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在每台服务器上，完成以下配置:</p><ol class=""><li id="0e46" class="kw kx hi jq b jr km jv kn jz ky kd kz kh la kl mg lc ld le bi translated">创建一个名为<code class="du lf lg lh li b">/mnt/disks</code>的挂载点。</li></ol><pre class="ks kt ku kv fd mh li mi mj aw mk bi"><span id="791c" class="lo ir hi li b fi ml mm l mn mo">$ sudo mkdir -p /mnt/disks</span></pre><p id="df3f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">2.格式化数据磁盘。</p><pre class="ks kt ku kv fd mh li mi mj aw mk bi"><span id="6ad0" class="lo ir hi li b fi ml mm l mn mo">$ sudo mkfs.ext4 /dev/diskA <br/>$ sudo mkfs.ext4 /dev/diskB</span></pre><p id="4007" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">3.在挂载点上挂载数据磁盘。</p><pre class="ks kt ku kv fd mh li mi mj aw mk bi"><span id="a99e" class="lo ir hi li b fi ml mm l mn mo">$ DISKA_UUID=$(blkid -s UUID -o value /dev/diskA) <br/>$ DISKB_UUID=$(blkid -s UUID -o value /dev/diskB) <br/>$ sudo mkdir /mnt/disks/$DISKA_UUID<br/>$ sudo mkdir /mnt/disks/$DISKB_UUID<br/>$ sudo mount -t ext4 /dev/diskA /mnt/disks/$DISKA_UUID<br/>$ sudo mount -t ext4 /dev/diskB /mnt/disks/$DISKB_UUID</span><span id="d8f2" class="lo ir hi li b fi mp mm l mn mo">$ echo UUID=`sudo blkid -s UUID -o value /dev/diskA` /mnt/disks/$DISKA_UUID ext4 defaults 0 2 | sudo tee -a /etc/fstab<br/>$ echo UUID=`sudo blkid -s UUID -o value /dev/diskB` /mnt/disks/$DISKB_UUID ext4 defaults 0 2 | sudo tee -a /etc/fstab</span></pre><p id="a005" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">4.为本地卷安装插件。</p><pre class="ks kt ku kv fd mh li mi mj aw mk bi"><span id="563c" class="lo ir hi li b fi ml mm l mn mo">$ curl https://github.com/kubernetes-sigs/sig-storage-local-static-provisioner/archive/v2.4.0.zip<br/>$ unzip v2.4.0.zip</span></pre><p id="4e9c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">5.修改<code class="du lf lg lh li b">v2.4.0/helm/provisioner/values.yaml</code>中的<code class="du lf lg lh li b">classes</code>部分:将<code class="du lf lg lh li b">hostDir: /mnt/fast-disks</code>替换为<code class="du lf lg lh li b">hostDir: /mnt/disks</code>，删除<code class="du lf lg lh li b"># storageClass: true</code>中的<code class="du lf lg lh li b">#</code>。然后运行以下命令:</p><pre class="ks kt ku kv fd mh li mi mj aw mk bi"><span id="f208" class="lo ir hi li b fi ml mm l mn mo">$ helm install local-static-provisioner --namespace default sig-storage-local-static-provisioner/helm/provisioner</span><span id="4f4d" class="lo ir hi li b fi mp mm l mn mo"># View the deployment of local-static-provisioner<br/>$ helm list<br/>NAME                        NAMESPACE   REVISION    UPDATED                                 STATUS      CHART               APP VERSION<br/>local-volume-provisioner    default     1           2021-02-10 11:06:34.3540341 +0800 CST   deployed    provisioner-2.4.0   2.4.0</span></pre><h1 id="8c5f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">部署星云图集群</h1><h2 id="8603" class="lo ir hi bd is lp lq lr iw ls lt lu ja jz lv lw je kd lx ly ji kh lz ma jm mb bi translated">下载星云图</h2><pre class="ks kt ku kv fd mh li mi mj aw mk bi"><span id="9cc3" class="lo ir hi li b fi ml mm l mn mo"># Download nebula-charts<br/>$ helm repo add nebula-charts https://vesoft-inc.github.io/nebula-docker-compose/charts<br/>$ helm pull nebula-charts/nebula<br/>$ tar -zxvf nebula-0.2.0.tgz</span></pre><h2 id="e91c" class="lo ir hi bd is lp lq lr iw ls lt lu ja jz lv lw je kd lx ly ji kh lz ma jm mb bi translated">设置Kubernetes节点</h2><p id="5bee" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">下表列出了Kubernetes集群的所有节点。一些节点必须被标记以便调度。在这个例子中，我用<code class="du lf lg lh li b">nebula: "cloud"</code>标记了<code class="du lf lg lh li b">192.168.0.2</code>、<code class="du lf lg lh li b">192.168.0.3</code>和<code class="du lf lg lh li b">192.168.0.4</code>。</p><p id="fe13" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">服务器IPkubernetes角色dename 192 . 168 . 0 . 1主机192 . 168 . 0 . 1192 . 168 . 0 . 2节点192 . 168 . 0 . 2192 . 168 . 0 . 3节点192 . 168 . 0 . 3192.168.0.4节点192 . 168 . 0 . 4</p><p id="2001" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这些命令如下所示。</p><pre class="ks kt ku kv fd mh li mi mj aw mk bi"><span id="9615" class="lo ir hi li b fi ml mm l mn mo">$ kubectl  label node 192.168.0.2 nebula="cloud" --overwrite <br/>$ kubectl  label node 192.168.0.3 nebula="cloud" --overwrite<br/>$ kubectl  label node 192.168.0.4 nebula="cloud" --overwrite</span></pre><h2 id="860d" class="lo ir hi bd is lp lq lr iw ls lt lu ja jz lv lw je kd lx ly ji kh lz ma jm mb bi translated">更改默认值</h2><p id="e53f" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">这是星云图目录的层次结构。</p><pre class="ks kt ku kv fd mh li mi mj aw mk bi"><span id="be00" class="lo ir hi li b fi ml mm l mn mo">master/kubernetes/<br/>└── helm<br/>    ├── Chart.yaml<br/>    ├── templates<br/>    │&amp;nbsp;&amp;nbsp; ├── configmap.yaml<br/>    │&amp;nbsp;&amp;nbsp; ├── deployment.yaml<br/>    │&amp;nbsp;&amp;nbsp; ├── _helpers.tpl<br/>    │&amp;nbsp;&amp;nbsp; ├── NOTES.txt<br/>    │&amp;nbsp;&amp;nbsp; ├── pdb.yaml<br/>    │&amp;nbsp;&amp;nbsp; ├── serviceaccount.yaml<br/>    │&amp;nbsp;&amp;nbsp; ├── service.yaml<br/>    │&amp;nbsp;&amp;nbsp; └── statefulset.yaml<br/>    └── values.yaml</span><span id="b4b9" class="lo ir hi li b fi mp mm l mn mo">1 directory, 11 files</span></pre><p id="0e4f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">您可以更改<code class="du lf lg lh li b">charts/nebula/values.yaml</code>文件中的默认值以满足您的要求。</p><h2 id="c175" class="lo ir hi bd is lp lq lr iw ls lt lu ja jz lv lw je kd lx ly ji kh lz ma jm mb bi translated">用头盔安装星云图数据库</h2><pre class="ks kt ku kv fd mh li mi mj aw mk bi"><span id="6e39" class="lo ir hi li b fi ml mm l mn mo">$ helm install nebula charts/nebula <br/># View the deployment status<br/>$ helm status nebula<br/>NAME: nebula<br/>LAST DEPLOYED: Fri Feb 19 12:58:16 2021<br/>NAMESPACE: default<br/>STATUS: deployed<br/>REVISION: 1<br/>TEST SUITE: None<br/>NOTES:<br/>NebulaGraph Cluster installed!</span><span id="a26e" class="lo ir hi li b fi mp mm l mn mo">1. Watch all containers come up.<br/>  $ kubectl get pods --namespace=default -l app.kubernetes.io=nebula -w<br/># View the status of the NebulaGraph cluster deployed on K8s<br/>$ kubectl get pods --namespace=default -l app.kubernetes.io=nebula<br/>NAME                             READY   STATUS    RESTARTS   AGE<br/>nebula-graphd-676cfcf797-4q7mk   1/1     Running   0          6m<br/>nebula-graphd-676cfcf797-whwqp   1/1     Running   0          6m<br/>nebula-graphd-676cfcf797-zn5l6   1/1     Running   0          6m<br/>nebula-metad-0                   1/1     Running   0          6m<br/>nebula-metad-1                   1/1     Running   0          6m<br/>nebula-metad-2                   1/1     Running   0          6m<br/>nebula-storaged-0                1/1     Running   0          6m<br/>nebula-storaged-1                1/1     Running   0          6m<br/>nebula-storaged-2                1/1     Running   0          6m</span></pre><p id="619a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">连接到图表服务</p><pre class="ks kt ku kv fd mh li mi mj aw mk bi"><span id="a7f0" class="lo ir hi li b fi ml mm l mn mo">$ kubectl get service nebula-graphd<br/>NAME            TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)                                          AGE<br/>nebula-graphd   NodePort   10.105.47.116   &lt;none&gt;        9669:31646/TCP,19669:30554/TCP,19670:32386/TCP   22m</span><span id="7b92" class="lo ir hi li b fi mp mm l mn mo"># Use nebula-console to test the Graph service.<br/>$ docker run --rm -ti --entrypoint=/bin/sh vesoft/nebula-console:v2-nightly</span><span id="5477" class="lo ir hi li b fi mp mm l mn mo"># Connect to the Graph service with the NodePort mode<br/>/ $ nebula-console -addr 192.168.0.4 -port 31646 -u root -p vesoft<br/>2021/02/19 05:04:55 [INFO] connection pool is initialized successfully</span><span id="df2a" class="lo ir hi li b fi mp mm l mn mo">Welcome to NebulaGraph v2.0.0-rc1!</span><span id="57d2" class="lo ir hi li b fi mp mm l mn mo">(root@nebula) [(none)]&gt; show hosts;<br/>+---------------------------------------------------------------+------+----------+--------------+----------------------+------------------------+<br/>| Host                                                          | Port | Status   | Leader count | Leader distribution  | Partition distribution |<br/>+---------------------------------------------------------------+------+----------+--------------+----------------------+------------------------+<br/>| "nebula-storaged-0.nebula-storaged.default.svc.cluster.local" | 9779 | "ONLINE" | 0            | "No valid partition" | "No valid partition"   |<br/>+---------------------------------------------------------------+------+----------+--------------+----------------------+------------------------+<br/>| "nebula-storaged-1.nebula-storaged.default.svc.cluster.local" | 9779 | "ONLINE" | 0            | "No valid partition" | "No valid partition"   |<br/>+---------------------------------------------------------------+------+----------+--------------+----------------------+------------------------+<br/>| "nebula-storaged-2.nebula-storaged.default.svc.cluster.local" | 9779 | "ONLINE" | 0            | "No valid partition" | "No valid partition"   |<br/>+---------------------------------------------------------------+------+----------+--------------+----------------------+------------------------+<br/>| "Total"                                                       |      |          | 0            |                      |                        |<br/>+---------------------------------------------------------------+------+----------+--------------+----------------------+------------------------+<br/>Got 4 rows (time spent 2608/4258 us)</span></pre><h1 id="ce66" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">常见问题解答</h1><blockquote class="mq mr ms"><p id="de21" class="jo jp mt jq b jr km jt ju jv kn jx jy mu ko kb kc mv kp kf kg mw kq kj kk kl hb bi translated"><em class="hi">如何创建Kubernetes集群？</em></p></blockquote><p id="cf75" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">要创建高可用的Kubernetes集群，请参考文档:<a class="ae mf" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/high-availability/" rel="noopener ugc nofollow" target="_blank">https://Kubernetes . io/docs/setup/production-environment/tools/kube ADM/high-avail ability/</a>。</p><blockquote class="mq mr ms"><p id="b728" class="jo jp mt jq b jr km jt ju jv kn jx jy mu ko kb kc mv kp kf kg mw kq kj kk kl hb bi translated">如何调整部署星云星团的参数？</p></blockquote><p id="4d29" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">使用<code class="du lf lg lh li b">helm install</code>命令中的<code class="du lf lg lh li b">--set</code>覆盖<code class="du lf lg lh li b">nebula-charts</code>目录下的<code class="du lf lg lh li b">values.yaml</code>文件中的变量。更多信息，请参考<a class="ae mf" href="https://helm.sh/docs/intro/using_helm/" rel="noopener ugc nofollow" target="_blank">https://helm.sh/docs/intro/using_helm/</a></p><blockquote class="mq mr ms"><p id="4985" class="jo jp mt jq b jr km jt ju jv kn jx jy mu ko kb kc mv kp kf kg mw kq kj kk kl hb bi translated"><em class="hi">如何从K8s星团外部访问NebulaGraph的内部组件？</em></p></blockquote><p id="1048" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在本例中，通过节点端口模式访问图表服务。您也可以通过主机端口、主机网络、入口或负载平衡器模式来访问它。您可以选择合适的选项来满足您的环境要求。</p><blockquote class="mq mr ms"><p id="0f09" class="jo jp mt jq b jr km jt ju jv kn jx jy mu ko kb kc mv kp kf kg mw kq kj kk kl hb bi translated">如何查看已部署的星云图星团的状态？</p></blockquote><p id="71e7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">运行<code class="du lf lg lh li b">kubectl get pods --namespace=default -l app.kubernetes.io=nebula</code>命令。或者使用Kubernetes Dashboard查看集群的状态。</p><blockquote class="mq mr ms"><p id="1753" class="jo jp mt jq b jr km jt ju jv kn jx jy mu ko kb kc mv kp kf kg mw kq kj kk kl hb bi translated"><em class="hi">如何使用其他类型的储物解决方案？</em></p></blockquote><p id="648c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">请参考<a class="ae mf" href="https://kubernetes.io/zh/docs/concepts/storage/storage-classes/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/zh/docs/concepts/storage/storage-classes/</a></p><h1 id="b331" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">你可能也会喜欢</h1><ol class=""><li id="9c07" class="kw kx hi jq b jr js jv jw jz mc kd md kh me kl mg lc ld le bi translated"><a class="ae mf" href="https://nebula-graph.io/posts/nebula-graph-architecture-overview/" rel="noopener ugc nofollow" target="_blank">星云图建筑——鸟瞰图</a></li><li id="e80b" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl mg lc ld le bi translated"><a class="ae mf" href="https://nebula-graph.io/posts/nebula-graph-storage-engine-overview/" rel="noopener ugc nofollow" target="_blank">nebula graph的存储引擎介绍</a></li><li id="6148" class="kw kx hi jq b jr lj jv lk jz ll kd lm kh ln kl mg lc ld le bi translated"><a class="ae mf" href="https://nebula-graph.io/posts/nebula-graph-query-engine-overview/" rel="noopener ugc nofollow" target="_blank">nebula graph的查询引擎介绍</a></li></ol></div></div>    
</body>
</html>