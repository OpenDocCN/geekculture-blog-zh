<html>
<head>
<title>How to Write an Empty Success Marker file in AWS Glue Job</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在AWS粘合作业中写入空的成功标记文件</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-write-an-empty-success-marker-file-in-aws-glue-job-968cb8013706?source=collection_archive---------12-----------------------#2021-08-01">https://medium.com/geekculture/how-to-write-an-empty-success-marker-file-in-aws-glue-job-968cb8013706?source=collection_archive---------12-----------------------#2021-08-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="76c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇短文中，我将向你展示如何使用基于Spark的AWS粘合作业编写一个空的成功标记文件。</p><p id="ac9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">拥有一个空的成功标记文件是为了表明写操作已经成功完成。Spark似乎默认启用了这个选项，但AWS Glue的spark不会在作业完成时自动写入一个<code class="du jd je jf jg b">_SUCCESS</code>文件。</p><p id="9a56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">文档中没有谈到如何启用这个选项，不幸的是，很少有资源谈到这个选项。</p><p id="b383" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，让我们定义一个<code class="du jd je jf jg b">sparkSession</code>对象。</p><pre class="jh ji jj jk fd jl jg jm jn aw jo bi"><span id="6fd7" class="jp jq hi jg b fi jr js l jt ju">val spark: SparkContext = new SparkContext()<br/>val glueContext: GlueContext = new GlueContext(spark)<br/>val sparkSession: SparkSession = glueContext.getSparkSession</span></pre><p id="a532" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设您有一个包含一些内容的数据框架<code class="du jd je jf jg b">df</code>。</p><pre class="jh ji jj jk fd jl jg jm jn aw jo bi"><span id="e78c" class="jp jq hi jg b fi jr js l jt ju">val data = Seq[Row](Row(1, "purple", "100$"), Row(2, "red", "50$"))<br/>val df = sparkSession<br/>.createDataFrame(sparkSession.sparkContext.parallelize(data))</span></pre><p id="32b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，如果需要将数据帧中的数据写入S3存储桶，可以使用以下方法:</p><pre class="jh ji jj jk fd jl jg jm jn aw jo bi"><span id="08ea" class="jp jq hi jg b fi jr js l jt ju">df.write.mode("overwrite").csv("s3://&lt;bucket_name&gt;/data.csv")</span></pre><p id="a05f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的write语句不会生成成功标记，因为AWS Glue job没有默认启用的成功标记选项。</p><p id="be93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用下面的<code class="du jd je jf jg b">option</code>来启用该选项。</p><pre class="jh ji jj jk fd jl jg jm jn aw jo bi"><span id="f12a" class="jp jq hi jg b fi jr js l jt ju">df.write<br/>.mode("overwrite")<br/>.option("mapreduce.fileoutputcommitter.marksuccessfuljobs", true)<br/>.csv("s3://&lt;bucket_name&gt;/&lt;my_directory_path&gt;/")</span></pre><p id="d6cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，一旦发出了<code class="du jd je jf jg b">df.write</code>，一个空的<code class="du jd je jf jg b">_SUCCESS</code>文件也将被写入目录。</p><p id="6379" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:我们提供了一个S3目录路径，而不是指定文件名，因为Spark可能会根据输出文件的大小将文件分成多个部分。</p><p id="352d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在官方文档中读到更多关于AWS Glue输出选项的内容。</p><div class="jv jw ez fb jx jy"><a href="https://docs.aws.amazon.com/glue/latest/dg/aws-glue-programming-etl-format.html" rel="noopener  ugc nofollow" target="_blank"><div class="jz ab dw"><div class="ka ab kb cl cj kc"><h2 class="bd hj fi z dy kd ea eb ke ed ef hh bi translated">AWS Glue中ETL输入和输出的格式选项</h2><div class="kf l"><h3 class="bd b fi z dy kd ea eb ke ed ef dx translated">“格式”和“格式选项”参数的可用设置。</h3></div><div class="kg l"><p class="bd b fp z dy kd ea eb ke ed ef dx translated">docs.aws.amazon.com</p></div></div></div></a></div></div></div>    
</body>
</html>