<html>
<head>
<title>Serve your React app with AWS Cloudfront using Gitlab and Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Gitlab和Terraform，通过AWS Cloudfront为您的React应用提供服务</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/serve-your-react-app-with-aws-cloudfront-using-gitlab-and-terraform-322b2526943e?source=collection_archive---------3-----------------------#2021-07-04">https://medium.com/geekculture/serve-your-react-app-with-aws-cloudfront-using-gitlab-and-terraform-322b2526943e?source=collection_archive---------3-----------------------#2021-07-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f4fac2f7c3e069e52983426b5e3c302f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BC6GrydGqh58xTXe"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@alexmachado?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Alex Machado</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8802" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我们将看到如何使用Terraform为AWS配置和Gitlab CI为部署在Cloudfront后面部署React应用程序。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="db2c" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated"><strong class="ak">地形初始化</strong></h1><p id="5b0c" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">我们将在本教程中使用terraform，所以让我们从初始化工作空间开始。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="4965" class="lm kb hi li b fi ln lo l lp lq">$ mkdir terraform-react &amp;&amp; cd terraform-react<br/>$ terraform init</span></pre></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="2554" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">S3桶创作</h1><p id="d44a" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">我们首先需要的是一个空的S3桶，我们将把React编译后的文件上传到这个桶中。</p><p id="6e4f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建一个新的main.tf文件，并为我们的bucket添加配置。<strong class="ix hj"> <em class="lr">本教程使用的桶名为“我的-反应-桶”。在AWS上，存储桶名称是全局唯一的，因此您需要为自己唯一的存储桶更改名称。</em> </strong></p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><blockquote class="lu lv lw"><p id="5c57" class="iv iw lr ix b iy iz ja jb jc jd je jf lx jh ji jj ly jl jm jn lz jp jq jr js hb bi translated"><strong class="ix hj">注意:</strong>我们希望我们的文件只被Cloudfront访问，所以我们添加了AWS _ S3 _ bucket _ public _ access _ block terra form块来禁止我们的文件公开。</p></blockquote><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="fd43" class="lm kb hi li b fi ln lo l lp lq">$ terraform init<br/>$ terraform apply</span><span id="2de3" class="lm kb hi li b fi ma lo l lp lq">Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:<br/>  + create</span><span id="9e6f" class="lm kb hi li b fi ma lo l lp lq">Terraform will perform the following actions:</span><span id="e65e" class="lm kb hi li b fi ma lo l lp lq"># aws_s3_bucket.static_react_bucket will be created<br/>  + resource "aws_s3_bucket" "static_react_bucket" {<br/>      + acceleration_status         = (known after apply)<br/>      + acl                         = "private"<br/>      + arn                         = (known after apply)<br/>      + bucket                      = "my-react-bucket"<br/>      + bucket_domain_name          = (known after apply)<br/>      + bucket_regional_domain_name = (known after apply)<br/>      + force_destroy               = false<br/>      + hosted_zone_id              = (known after apply)<br/>      + id                          = (known after apply)<br/>      + region                      = (known after apply)<br/>      + request_payer               = (known after apply)<br/>      + tags                        = {<br/>          + "Name" = "my-react-bucket"<br/>        }<br/>      + tags_all                    = {<br/>          + "Name" = "my-react-bucket"<br/>        }<br/>      + website_domain              = (known after apply)<br/>      + website_endpoint            = (known after apply)</span><span id="924d" class="lm kb hi li b fi ma lo l lp lq">+ versioning {<br/>          + enabled    = true<br/>          + mfa_delete = false<br/>        }<br/>    }</span><span id="2f04" class="lm kb hi li b fi ma lo l lp lq"># aws_s3_bucket_public_access_block.block_public_access will be created<br/>  + resource "aws_s3_bucket_public_access_block" "block_public_access" {<br/>      + block_public_acls       = true<br/>      + block_public_policy     = true<br/>      + bucket                  = (known after apply)<br/>      + id                      = (known after apply)<br/>      + ignore_public_acls      = true<br/>      + restrict_public_buckets = true<br/>    }</span><span id="490d" class="lm kb hi li b fi ma lo l lp lq">Plan: 2 to add, 0 to change, 0 to destroy.</span><span id="2e33" class="lm kb hi li b fi ma lo l lp lq">Do you want to perform these actions?<br/>  Terraform will perform the actions described above.<br/>  Only 'yes' will be accepted to approve.</span><span id="59aa" class="lm kb hi li b fi ma lo l lp lq">Enter a value: yes</span><span id="4cd8" class="lm kb hi li b fi ma lo l lp lq">aws_s3_bucket.static_react_bucket: Creating...<br/>aws_s3_bucket.static_react_bucket: Creation complete after 3s [id=my-react-bucket]<br/>aws_s3_bucket_public_access_block.block_public_access: Creating...<br/>aws_s3_bucket_public_access_block.block_public_access: Creation complete after 1s [id=my-react-bucket]</span><span id="1cc0" class="lm kb hi li b fi ma lo l lp lq">Apply complete! Resources: 2 added, 0 changed, 0 destroyed.</span></pre></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="99f4" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">gitlab的IAM访问</h1><p id="8aa3" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">Gitlab CI将被配置为自动将我们的React代码上传到我们新创建的S3存储桶。在AWS中，权限由一个名为IAM(身份和访问管理)的服务管理。让我们为Gitlab用户创建一个新策略，让它访问我们的bucket。</p><p id="a865" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">去<a class="ae iu" href="https://console.aws.amazon.com/iam/home?region=us-east-1#/users" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/iam/home?region=us-east-1#/users </a>并创建一个名为“gitlab-user”的仅具有编程访问权限的新用户。暂时不要给予任何许可，我们将通过terraform处理此事。<strong class="ix hj">下载访问密钥，因为我们将需要它们来配置Gitlab CI。</strong></p><p id="6129" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在terraform- react文件夹中创建一个新的iam.tf文件，内容如下:</p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="d9f3" class="lm kb hi li b fi ln lo l lp lq">$ terraform apply<br/>...<br/>Plan: 2 to add, 0 to change, 0 to destroy.</span><span id="72bd" class="lm kb hi li b fi ma lo l lp lq">Do you want to perform these actions?<br/>  Terraform will perform the actions described above.<br/>  Only 'yes' will be accepted to approve.</span><span id="57b7" class="lm kb hi li b fi ma lo l lp lq">Enter a value: yes</span><span id="90c7" class="lm kb hi li b fi ma lo l lp lq">aws_iam_policy.ci_policy: Creating...<br/>aws_iam_policy.ci_policy: Creation complete after 2s [id=arn:aws:iam::XXXXXXXXXXXX:policy/gitlab-ci-policy]<br/>aws_iam_policy_attachment.gitlab_ci_attachment: Creating...<br/>aws_iam_policy_attachment.gitlab_ci_attachment: Creation complete after 1s [id=gitlab-ci-attachment]</span><span id="15b4" class="lm kb hi li b fi ma lo l lp lq">Apply complete! Resources: 2added, 0 changed, 0 destroyed.</span></pre><p id="b0a3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们现在有一个gitlab-user IAM用户，他被允许在我们的S3桶上上传文件。接下来，我们将配置Gitlab CI来自动化部署。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="61bc" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">配置Gitlab CI</h1><p id="c79f" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated"><strong class="ix hj">首先</strong>，我们需要告诉gitlab CI在运行管道时使用我们的用户。为此，转到CI设置(设置- &gt; CI/CD - &gt;变量)。</p><p id="f30a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">用之前获得的值添加变量AWS_ACCESS_KEY_ID。<br/>用之前得到的值添加变量AWS_SECRET_ACCESS_KEY。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/eb27fddf7586e354503bde52d9c833e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-wFNloaM14_iXYWD3UHinw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Gitlab CI variables configuration</figcaption></figure><p id="90e7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第二个</strong>，在React项目的根目录下创建一个名为<em class="lr">的新文件。gitlab-ci.yml </em>。该文件将包含Gitlab CI运行程序运行的配置和阶段。对于本教程，我们将创建一个基本文件，它将只处理两个步骤:建立应用程序，并将其上传到S3。</p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="eb63" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以在gitlab上查看管道状态。一旦管道成功，您可以使用aws cli验证文件是否在存储桶上。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="62dd" class="lm kb hi li b fi ln lo l lp lq">$ aws s3 ls s3://my-react-bucket<br/>                           PRE static/<br/>2021-07-04 17:34:05       1092 asset-manifest.json<br/>2021-07-04 17:34:05       3870 favicon.ico<br/>2021-07-04 17:34:05       3032 index.html<br/>2021-07-04 17:34:05       5347 logo192.png<br/>2021-07-04 17:34:05       9664 logo512.png<br/>2021-07-04 17:34:05        492 manifest.json<br/>2021-07-04 17:34:05         67 robots.txt</span></pre><p id="2211" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们停在这里，看看我们在哪里！我们已经创建了CI配置，因此每次在master上推送时，我们的代码都是在S3上构建和上传的。我们的gitlab-user IAM用户只能访问这个bucket，并且只能上传对象，这是首选，因为它不需要任何其他权限。</p><p id="bcbf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的bucket是私有的，不允许公共文件，那么我们如何访问这些文件呢？</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="facb" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated"><strong class="ak">云锋分布</strong></h1><p id="39b1" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">Cloudfront是主要的CDN(内容交付网络)之一。它允许高效的缓存和快速的文件传送给用户。你不需要为S3和Cloudfront之间的带宽付费，只需要支付Cloudfront之外的带宽。</p><blockquote class="lu lv lw"><p id="97d6" class="iv iw lr ix b iy iz ja jb jc jd je jf lx jh ji jj ly jl jm jn lz jp jq jr js hb bi translated"><strong class="ix hj">注意:</strong>你可以查看这篇博客文章，更好地了解在S3使用Cloudfront的优势:<a class="ae iu" href="https://aws.amazon.com/blogs/networking-and-content-delivery/amazon-s3-amazon-cloudfront-a-match-made-in-the-cloud/" rel="noopener ugc nofollow" target="_blank">https://AWS . Amazon . com/blogs/networking-and-content-delivery/Amazon-S3-Amazon-Cloudfront-a-match-made-in-the-cloud/</a></p></blockquote><p id="f111" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将使用terraform来创建我们的Cloudfront web发行版。</p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="7b6f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们来看看React的一些特性:</p><ul class=""><li id="3952" class="mc md hi ix b iy iz jc jd jg me jk mf jo mg js mh mi mj mk bi translated"><em class="lr"> default_cache_behavior </em>:这个块将允许高效的缓存(基本上我们缓存所有东西:)。此外，我们将所有http调用重定向到https。最后，我们要求cloudfront压缩我们的静态文件，以减少带宽使用。</li><li id="7e04" class="mc md hi ix b iy ml jc mm jg mn jk mo jo mp js mh mi mj mk bi translated"><em class="lr"> ordered_cache_behavior </em>:当你发布一个新版本的应用时，你的代码会发生变化。JS文件将在它们的名字中包含新的散列，允许浏览器检索新文件。然而，您的index.html文件仍将被称为index.html，因此仍将被缓存至少86400秒。为了避免这种行为，我们添加了一条规则来告诉Cloudfront不要缓存index.html。这样，每次部署新代码时，用户都会得到新的index.html文件。</li><li id="8144" class="mc md hi ix b iy ml jc mm jg mn jk mo jo mp js mh mi mj mk bi translated"><em class="lr"> custom_error_response </em>:如果你使用React Router这样的库，你会使用S3上不存在的路径(默认情况下，如果你想有一条/home路由，并尝试直接导航到这条路由，cloudfront会尝试在S3上找到它。因为它不存在，您将得到一个403错误)。为了处理这种情况，我们添加了两个自定义错误响应，将403和404重定向到index.html文件。</li></ul><p id="8bbe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您可以使用这个新文件运行terraform。耐心点☕ cloudfront发行版需要一段时间才能创建。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="2056" class="lm kb hi li b fi ln lo l lp lq">$ terraform apply<br/>...<br/>Plan: 2 to add, 0 to change, 0 to destroy.</span><span id="82fa" class="lm kb hi li b fi ma lo l lp lq">Do you want to perform these actions?<br/>  Terraform will perform the actions described above.<br/>  Only 'yes' will be accepted to approve.</span><span id="8043" class="lm kb hi li b fi ma lo l lp lq">Enter a value: yes</span><span id="2890" class="lm kb hi li b fi ma lo l lp lq">aws_cloudfront_origin_access_identity.oai: Creating...<br/>aws_cloudfront_origin_access_identity.oai: Creation complete after 1s [id=E11IPI5S9FK6LQ]<br/>aws_cloudfront_distribution.cf_distribution: Creating...<br/>aws_cloudfront_distribution.cf_distribution: Still creating... [10s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still creating... [20s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still creating... [30s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still creating... [40s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still creating... [50s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still creating... [1m0s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still creating... [1m10s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still creating... [1m20s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still creating... [1m30s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still creating... [1m40s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still creating... [1m50s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still creating... [2m0s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still creating... [2m10s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still creating... [2m20s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still creating... [2m30s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Creation complete after 2m31s [id=E1Q7A09488OCJI]</span><span id="a1f8" class="lm kb hi li b fi ma lo l lp lq">Apply complete! Resources: 2 added, 0 changed, 0 destroyed.</span></pre><blockquote class="lu lv lw"><p id="72dc" class="iv iw lr ix b iy iz ja jb jc jd je jf lx jh ji jj ly jl jm jn lz jp jq jr js hb bi translated"><strong class="ix hj">注意:</strong>导航至<a class="ae iu" href="https://console.aws.amazon.com/cloudfront/home?region=us-east-1#" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/cloudfront/home</a>以检索分发URL</p></blockquote><p id="5427" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您现在尝试访问index.html文件，将会收到403错误</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/751f30c702fa3b4ef19488e23b34a1ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vFoZx5Wp7Kq0FZEPSGnCww.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">403 issue when requesting index.html</figcaption></figure><p id="a3a9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">问题是现在你的S3桶仍然是私有的，不允许任何人访问桶的内容。我们需要让我们的Cloudfront发行版访问S3桶。</p><p id="3268" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将以下内容添加到terraform main.tf文件中。</p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="8cd9" class="lm kb hi li b fi ln lo l lp lq">$ terraform apply<br/>...<br/>Plan: 1 to add, 0 to change, 0 to destroy.</span><span id="ba48" class="lm kb hi li b fi ma lo l lp lq">Do you want to perform these actions?<br/>  Terraform will perform the actions described above.<br/>  Only 'yes' will be accepted to approve.</span><span id="89b2" class="lm kb hi li b fi ma lo l lp lq">Enter a value: yes</span><span id="f085" class="lm kb hi li b fi ma lo l lp lq">aws_s3_bucket_policy.react_app_bucket_policy: Creating...<br/>aws_s3_bucket_policy.react_app_bucket_policy: Creation complete after 1s [id=my-react-bucket-20210704]</span><span id="8a6d" class="lm kb hi li b fi ma lo l lp lq">Apply complete! Resources: 1 added, 0 changed, 0 destroyed.</span></pre><p id="c21f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">重试调用你的发行版上的index.html页面，你现在应该看到你的应用程序！</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/c38fa30c7f470614819896a08b72ab74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mtu4O-CVmQKzIfSPUOF0nw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Basic CRA index.html</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="b3f9" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">奖励:使用你自己的域名</h1><p id="69ed" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">到目前为止我们使用的是Cloudfront分发默认域(https://….cloudfront.net)。一般来说，您会希望使用自己的域作为入口点。Cloudfront也会考虑到这一点。让我们看看如何实现它。</p><p id="2418" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="lr">首先</em>，在<strong class="ix hj"> us-east-1 </strong>地区的ACM(亚马逊证书管理器)中创建一个新证书。您必须使用此区域，您的证书才有资格与Cloudfront一起使用。前往https://console.aws.amazon.com/acm/home?region=us-east-1的<a class="ae iu" href="https://console.aws.amazon.com/acm/home?region=us-east-1" rel="noopener ugc nofollow" target="_blank"/>为您的域名创建证书(在我们的例子中是example.com)。记下证书ARN，以备将来使用。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><blockquote class="lu lv lw"><p id="f2e4" class="iv iw lr ix b iy iz ja jb jc jd je jf lx jh ji jj ly jl jm jn lz jp jq jr js hb bi translated"><strong class="ix hj">注意:</strong>我没有包括ACM请求的terraform代码，因为您需要为此更改提供商的地区。如果你想有一个多地区供应商的工作实例，请参考我的另一篇文章。</p></blockquote><div class="ms mt ez fb mu mv"><a href="https://m1ck43l-c.medium.com/create-your-own-url-minifier-using-s3-cloudfront-and-terraform-a3c0f5a1af8b" rel="noopener follow" target="_blank"><div class="mw ab dw"><div class="mx ab my cl cj mz"><h2 class="bd hj fi z dy na ea eb nb ed ef hh bi translated">使用S3、Cloudfront和Terraform创建您自己的URL minifier</h2><div class="nc l"><h3 class="bd b fi z dy na ea eb nb ed ef dx translated">你有没有想过如何创建你自己的网址迷你服务？</h3></div><div class="nd l"><p class="bd b fp z dy na ea eb nb ed ef dx translated">m1ck43l-c.medium.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj io mv"/></div></div></a></div></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="d361" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="lr">第二个</em>，创建route53记录:</p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="d85e" class="lm kb hi li b fi ln lo l lp lq">$ terraform apply<br/>...<br/>Plan: 1 to add, 0 to change, 0 to destroy.</span><span id="3b8d" class="lm kb hi li b fi ma lo l lp lq">Do you want to perform these actions?<br/>  Terraform will perform the actions described above.<br/>  Only 'yes' will be accepted to approve.</span><span id="18ed" class="lm kb hi li b fi ma lo l lp lq">Enter a value: yes</span><span id="82fb" class="lm kb hi li b fi ma lo l lp lq">aws_route53_record.cf_dns: Creating...<br/>aws_route53_record.cf_dns: Still creating... [10s elapsed]<br/>aws_route53_record.cf_dns: Still creating... [20s elapsed]<br/>aws_route53_record.cf_dns: Still creating... [30s elapsed]<br/>aws_route53_record.cf_dns: Creation complete after 33s [id=Z07080572RGHUGWY9O1KG_example.com_A]</span><span id="1cf6" class="lm kb hi li b fi ma lo l lp lq">Apply complete! Resources: 1 added, 0 changed, 0 destroyed.</span></pre><p id="ad73" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的域已经准备好了，现在我们可以更新我们的Cloudfront发行版来支持这个域。</p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><blockquote class="lu lv lw"><p id="7c7d" class="iv iw lr ix b iy iz ja jb jc jd je jf lx jh ji jj ly jl jm jn lz jp jq jr js hb bi translated">不要忘记删除之前的viewer_certificate块！</p></blockquote><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="d742" class="lm kb hi li b fi ln lo l lp lq">$ terraform apply<br/>...<br/>Plan: 0 to add, 1 to change, 0 to destroy.</span><span id="5331" class="lm kb hi li b fi ma lo l lp lq">Do you want to perform these actions?<br/>  Terraform will perform the actions described above.<br/>  Only 'yes' will be accepted to approve.</span><span id="666e" class="lm kb hi li b fi ma lo l lp lq">Enter a value: yes</span><span id="1fdb" class="lm kb hi li b fi ma lo l lp lq">aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 10s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 20s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 30s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 40s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 50s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 1m0s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 1m10s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 1m20s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 1m30s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 1m40s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 1m50s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 2m0s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 2m10s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 2m20s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 2m30s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 2m40s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 2m50s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 3m0s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 3m10s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 3m20s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 3m30s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 3m40s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 3m50s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 4m0s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 4m10s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 4m20s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 4m30s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 4m40s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 4m50s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Still modifying... [id=E1Q7A09488OCJI, 5m0s elapsed]<br/>aws_cloudfront_distribution.cf_distribution: Modifications complete after 5m7s [id=E1Q7A09488OCJI]</span><span id="6e0b" class="lm kb hi li b fi ma lo l lp lq">Apply complete! Resources: 0 added, 1 changed, 0 destroyed.</span></pre><p id="2786" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">🚀现在可以从您自己的域访问您的应用程序了！</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="7b8a" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">结论</h1><p id="c272" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">使用S3和Cloudfront在AWS上托管React应用很容易，并且允许以非常有限的成本进行几乎无限的扩展。</p><p id="1413" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，由于Gitlab CI集成，每次您在master上推送时，您的应用程序都会自动部署。</p></div></div>    
</body>
</html>