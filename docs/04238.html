<html>
<head>
<title>Deploying an Express, Node.js, React App (with TypeScript) to Azure Web Apps Using GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub操作将Express、Node.js、React应用程序(带TypeScript)部署到Azure Web应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/deploying-an-express-node-js-react-app-with-typescript-to-azure-web-apps-using-github-actions-25e4e59203e?source=collection_archive---------5-----------------------#2021-06-23">https://medium.com/geekculture/deploying-an-express-node-js-react-app-with-typescript-to-azure-web-apps-using-github-actions-25e4e59203e?source=collection_archive---------5-----------------------#2021-06-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/49ddc257977bfd54471ff22c0137cb1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mvH6nyO2MCxlvuqOY8oWlQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Source: Google</figcaption></figure><h2 id="b68b" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">介绍</h2><p id="b8e9" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km hb bi translated">在这篇文章中，我将讨论用TypeScript构建一个带有React前端的基本Express-Node应用程序，并使用GitHub操作将其部署到Azure Web应用程序。这是一个冗长乏味的过程，需要将各种博客文章和StackOverflow线程拼凑在一起。我在下面的参考文献中链接了它们。</p><p id="f0e9" class="pw-post-body-paragraph js jt hi ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km hb bi translated">这是我们将要设置的文件夹结构。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es ks"><img src="../Images/6286241bb72b8b96d81deacc434f9d91.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/format:webp/1*WV7w9AnTNBgzpGdRsiF-8g.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Folder Structure</figcaption></figure><h2 id="c3b7" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">1.初始化项目</h2><p id="bcaf" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km hb bi translated">为您的项目创建根文件夹，并在其中运行以下命令来初始化项目。这将创建一个<code class="du kx ky kz la b">package.json</code>文件。</p><pre class="kt ku kv kw fd lb la lc ld aw le bi"><span id="d0bf" class="iu iv hi la b fi lf lg l lh li">npm init -y</span></pre><h2 id="9020" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">2.安装依赖项</h2><p id="2de0" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km hb bi translated">在根文件夹中运行以下命令来安装所需的软件包。save-dev标志将包安装为<a class="ae lj" href="https://nodejs.dev/learn/npm-dependencies-and-devdependencies" rel="noopener ugc nofollow" target="_blank">开发依赖项</a>。我们将在本地开发期间使用<code class="du kx ky kz la b">ts-node</code>直接运行TypeScript文件，而不需要使用<code class="du kx ky kz la b">tsc</code>进行预编译。<code class="du kx ky kz la b">concurrently</code>将用于同时运行React前端和Express服务器。</p><pre class="kt ku kv kw fd lb la lc ld aw le bi"><span id="f5cf" class="iu iv hi la b fi lf lg l lh li">npm install express<br/>npm install typescript tslint ts-node --save-dev<br/>npm install @types/express @types/node --save-dev<br/>npm install concurrently nodemon --save-dev</span></pre><h2 id="5ecf" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">3.TypeScript配置设置</h2><p id="9eb9" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km hb bi translated">我们将使用<code class="du kx ky kz la b">ts-lint</code>来检查可读性、可维护性和功能性错误。在根文件夹中运行以下命令来创建<code class="du kx ky kz la b">tslint.json</code>文件。</p><pre class="kt ku kv kw fd lb la lc ld aw le bi"><span id="8cf5" class="iu iv hi la b fi lf lg l lh li">tslint --init</span></pre><p id="40eb" class="pw-post-body-paragraph js jt hi ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km hb bi translated">接下来，创建一个<code class="du kx ky kz la b">tsconfig.json</code>文件，并向其中添加以下内容。可以根据需要添加或更改选项。</p><pre class="kt ku kv kw fd lb la lc ld aw le bi"><span id="ea86" class="iu iv hi la b fi lf lg l lh li">{<br/>  "compilerOptions": {<br/>    "target": "es6",<br/>    "module": "commonjs",<br/>    "outDir": "./dist",<br/>    "esModuleInterop": true,<br/>    "baseUrl": ".",<br/>    "paths": {<br/>      "*": ["node_modules/*"]<br/>    },<br/>  },<br/>  "include": ["server/**/*"]<br/>}</span></pre><h2 id="fd53" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">4.反应客户端</h2><p id="a1ee" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km hb bi translated">在根文件夹中，运行以下命令用TypeScript设置React前端。</p><pre class="kt ku kv kw fd lb la lc ld aw le bi"><span id="f84e" class="iu iv hi la b fi lf lg l lh li">npx create-react-app client --template typescript</span></pre><p id="a675" class="pw-post-body-paragraph js jt hi ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km hb bi translated">确保<code class="du kx ky kz la b">package.json</code>在如图所示的客户端文件夹中。<code class="du kx ky kz la b">build</code>文件夹将在运行构建脚本时创建，我们将在稍后执行。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/be28dcf1e8f547ecab5ab165a30a2817.png" data-original-src="https://miro.medium.com/v2/resize:fit:290/format:webp/1*qQBh6riWgmBIsVP-E8zd1A.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Client folder structure</figcaption></figure><p id="4867" class="pw-post-body-paragraph js jt hi ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km hb bi translated">将下面一行添加到<code class="du kx ky kz la b">client</code>文件夹中的package.json。在本地开发过程中，需要将请求代理到我们的Express服务器。</p><pre class="kt ku kv kw fd lb la lc ld aw le bi"><span id="ba95" class="iu iv hi la b fi lf lg l lh li">"proxy": "http://localhost:5000/"</span></pre><h2 id="b4ee" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">5.计算机网络服务器</h2><p id="bb71" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km hb bi translated">在根文件夹中，创建一个名为server的文件夹，并在其中创建一个文件<code class="du kx ky kz la b">server.ts</code>。向其中添加以下代码。</p><p id="b4ef" class="pw-post-body-paragraph js jt hi ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km hb bi translated">express服务器运行在端口5000上。我们有一个简单的hello API和代码来显示React应用程序时被要求，这将是部署时所必需的。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><h2 id="59d1" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">6.package.json</h2><p id="aab5" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km hb bi translated">将以下内容添加到<strong class="ju hj"> </strong> <code class="du kx ky kz la b">server</code> <strong class="ju hj"> </strong>文件夹中的package.json中。</p><pre class="kt ku kv kw fd lb la lc ld aw le bi"><span id="8386" class="iu iv hi la b fi lf lg l lh li">"scripts": {<br/>    "start": "node dist/server.js",<br/>    "prebuild": "tslint -c tslint.json -p tsconfig.json --fix",<br/>    "build": "tsc --project .",<br/>    "build-prod": "cd client &amp;&amp; npm install &amp;&amp; npm run build &amp;&amp; cd .. &amp;&amp; npm install &amp;&amp; npm run build",<br/>    "server": "nodemon --verbose --watch \"server\" --ext \"ts,json\" --exec ts-node server/server.ts",<br/>    "client": "cd client &amp;&amp; npm start &amp;&amp; cd ..",<br/>    "dev": "concurrently \"npm run client\" \"npm run server\""<br/>}</span></pre><p id="8119" class="pw-post-body-paragraph js jt hi ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km hb bi translated">在部署期间将使用<code class="du kx ky kz la b">build-prod</code>脚本。它将创建一个包含来自TypeScript后端的已编译JavaScript的<code class="du kx ky kz la b">dist</code>文件夹，以及一个包含前端静态文件的客户端文件夹中的<code class="du kx ky kz la b">build</code>文件夹。首先构建客户机代码，因为服务器代码稍后服务于生成的<code class="du kx ky kz la b">build</code>文件夹。</p><p id="cd1f" class="pw-post-body-paragraph js jt hi ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km hb bi translated"><code class="du kx ky kz la b">dev</code>脚本将在本地开发中使用。</p><h2 id="3d75" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">7.从React向节点发出HTTP请求</h2><p id="2779" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km hb bi translated">通过在React组件中添加以下代码，从React调用hello API，例如在<code class="du kx ky kz la b">App.tsx</code>中。</p><pre class="kt ku kv kw fd lb la lc ld aw le bi"><span id="a609" class="iu iv hi la b fi lf lg l lh li">useEffect(() =&gt; {<br/>    const sayHello = async () =&gt; {<br/>      const response = await fetch("/api/hello");<br/>      const body = await response.json();<br/>      console.log(body);<br/>    };<br/>    sayHello();<br/>}, []);</span></pre><p id="a432" class="pw-post-body-paragraph js jt hi ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km hb bi translated">在根文件夹中运行以下命令启动localhost服务器。</p><pre class="kt ku kv kw fd lb la lc ld aw le bi"><span id="4cca" class="iu iv hi la b fi lf lg l lh li">npm run dev</span></pre><p id="7b63" class="pw-post-body-paragraph js jt hi ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km hb bi translated">这将在您的浏览器中打开<a class="ae lj" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>，并在您的浏览器控制台中记录“Hello”。</p><h2 id="9e66" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">8.网页配置</h2><p id="e43b" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km hb bi translated">Azure Web应用程序使用需要一个<code class="du kx ky kz la b">web.config</code>文件的IIS Web服务器。将以下内容添加到您的根文件夹。这将使用<code class="du kx ky kz la b">dist</code>文件夹中的<code class="du kx ky kz la b">server.js</code>文件作为Node.js应用程序。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><h2 id="4482" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">9.创建Azure Web应用资源</h2><p id="f9df" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km hb bi translated">将您的代码推送到GitHub repo。</p><p id="490e" class="pw-post-body-paragraph js jt hi ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km hb bi translated">从Azure门户创建Azure Web应用程序。如图所示选择运行时堆栈。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/7dcca0f77246b0b77650778442766f17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4pW8U6CTeH6V0NXHLib8Hg.png"/></div></div></figure><p id="fb7c" class="pw-post-body-paragraph js jt hi ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km hb bi translated">一旦应用程序被创建，按照<a class="ae lj" href="https://docs.microsoft.com/en-us/azure/app-service/deploy-github-actions?tabs=applevel#use-the-deployment-center" rel="noopener ugc nofollow" target="_blank">这些步骤</a>来设置GitHub Actions集成到您的repo。这将在您的GitHub存储库中创建一个<code class="du kx ky kz la b">.yml</code>工作流文件。如第26行所示进行更改，以使用我们在前面的<code class="du kx ky kz la b">package.json</code>中定义的<code class="du kx ky kz la b">build-prod</code>脚本。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="69f6" class="pw-post-body-paragraph js jt hi ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km hb bi translated">提交您的更改，并等待操作完成。你的应用应该被部署到Azure。唷！</p><p id="3e11" class="pw-post-body-paragraph js jt hi ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km hb bi translated">对于任何诊断，您都可以通过添加以下内容导航到您的web应用程序的Kudu控制台。scm到您的web应用程序地址。例如，如果你的地址是https://react-node-app.azurewebsites.net，去https://react-node-app.scm.azurewebsites.net/DebugConsole.</p><h1 id="eee5" class="lo iv hi bd iw lp lq lr ja ls lt lu je lv lw lx ji ly lz ma jm mb mc md jq me bi translated">参考</h1><ul class=""><li id="0669" class="mf mg hi ju b jv jw jz ka jf mh jj mi jn mj km mk ml mm mn bi translated"><a class="ae lj" href="https://levelup.gitconnected.com/node-typescript-azure-web-apps-what-could-go-wrong-a-lessons-learnt-guide-2def97a59f1f" rel="noopener ugc nofollow" target="_blank">Matthew Barben的Node，TypeScript，Azure Web Apps</a></li><li id="2fa9" class="mf mg hi ju b jv mo jz mp jf mq jj mr jn ms km mk ml mm mn bi translated"><a class="ae lj" href="https://docs.microsoft.com/en-us/azure/app-service/deploy-github-actions?tabs=applevel#use-the-deployment-center" rel="noopener ugc nofollow" target="_blank">带有GitHub动作的Azure Web App</a>在MS Docs上</li><li id="028f" class="mf mg hi ju b jv mo jz mp jf mq jj mr jn ms km mk ml mm mn bi translated"><a class="ae lj" href="https://www.freecodecamp.org/news/how-to-create-a-react-app-with-a-node-backend-the-complete-guide/" rel="noopener ugc nofollow" target="_blank">如何创建带有节点后端的React应用程序:完整指南(freecodecamp.org)</a></li><li id="cf3c" class="mf mg hi ju b jv mo jz mp jf mq jj mr jn ms km mk ml mm mn bi translated"><a class="ae lj" href="https://stackoverflow.com/questions/35879626/running-node-js-on-azure-web-app/35882245#35882245" rel="noopener ugc nofollow" target="_blank">Azure上Node.js的web . config(stack overflow)</a></li></ul></div></div>    
</body>
</html>