<html>
<head>
<title>Video Calling Integration Using Agora IO and Socket IO in Flutter.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter中使用Agora IO和Socket IO的视频通话集成。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/video-calling-integration-using-agora-io-and-socket-io-in-flutter-66b5731c07e?source=collection_archive---------3-----------------------#2021-05-04">https://medium.com/geekculture/video-calling-integration-using-agora-io-and-socket-io-in-flutter-66b5731c07e?source=collection_archive---------3-----------------------#2021-05-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="24fb" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">随时随地享受高清视频通信</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/27f743c15a488605c0509a7bcc7762c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bd5GWBv7-XVSkv_72nvgGQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx"><a class="ae jn" href="https://www.agora.io/en" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="d95c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Flutter发展很快，Flutter应用程序开发也是如此。当谈到在定制应用程序中集成新特性和功能时，Flutter仍然是世界各地应用程序开发人员的首选。</p><p id="2e5d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最近，当我投入到我的一个代表Flutter应用程序中视频通话集成的项目任务中时，我浏览了一下<a class="ae jn" href="https://www.agora.io/en/" rel="noopener ugc nofollow" target="_blank"> Agora io </a>仪表盘。在做了一些研究之后，我下定决心要发表一篇关于如何用socket io在Flutter中实现视频通话的文章。</p><blockquote class="kk kl km"><p id="9b31" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><strong class="jq hj"> Agora.io </strong>是一个实时互动平台，用于<em class="hi">有意义的人际联系，以便随时随地进行高清视频通信</em>。</p></blockquote></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><p id="5113" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们首先记下这些任务:</p><ol class=""><li id="5afb" class="ky kz hi jq b jr js ju jv jx la kb lb kf lc kj ld le lf lg bi translated">使用android studio或visual studio代码作为编辑器进行开发。</li><li id="1661" class="ky kz hi jq b jr lh ju li jx lj kb lk kf ll kj ld le lf lg bi translated">在<a class="ae jn" href="https://www.agora.io/en/" rel="noopener ugc nofollow" target="_blank"> Agora.io </a>仪表盘上创建一个账户。</li><li id="3ac4" class="ky kz hi jq b jr lh ju li jx lj kb lk kf ll kj ld le lf lg bi translated"><a class="ae jn" href="https://developer.android.com/" rel="noopener ugc nofollow" target="_blank">安卓</a>原生配置。</li><li id="931a" class="ky kz hi jq b jr lh ju li jx lj kb lk kf ll kj ld le lf lg bi translated"><a class="ae jn" href="https://developer.apple.com/" rel="noopener ugc nofollow" target="_blank"> iOS </a>原生配置。</li><li id="7698" class="ky kz hi jq b jr lh ju li jx lj kb lk kf ll kj ld le lf lg bi translated">将Agora SDK集成到你的flutter代码中，并加入其他与视频通话相关的内容。</li><li id="f880" class="ky kz hi jq b jr lh ju li jx lj kb lk kf ll kj ld le lf lg bi translated">从服务器端和其他套接字相关的后端生成Agora令牌。</li></ol><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lm"><img src="../Images/2ed90dddc5c9940ce29c0782961843c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PU5z0ujDLq6tm_JU"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@sergeytrofimov?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Serghei Trofimov</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><p id="64ec" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们开始整合，实现您的里程碑……</p><h1 id="bd57" class="ln lo hi bd lp lq lr ls lt lu lv lw lx io ly ip lz ir ma is mb iu mc iv md me bi translated">在Agora Io上创建帐户</h1><p id="673a" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated">转到<a class="ae jn" href="https://www.agora.io/en/" rel="noopener ugc nofollow" target="_blank"> Agora IO </a>网站，然后注册并登录。</p><p id="d700" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">创建Agora IO帐户后，转到<a class="ae jn" href="https://console.agora.io/" rel="noopener ugc nofollow" target="_blank">仪表板</a>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mk"><img src="../Images/eb494e3ad0d072d15e506fab2a92d1d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4hTitMwa90gvqaNZVrslKA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx"><a class="ae jn" href="https://sso.agora.io/en/login" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="12c1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">请完成在agora.io上注册的所有步骤。之后，请导航至仪表板。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ml"><img src="../Images/8cd60259fa4e1cea973cd95e2b861515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AxiQWhIrJkHuUGr1I9akKw.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx"><a class="ae jn" href="https://console.agora.io/" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="31bf" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">从Agora Dashboard获取您的<strong class="jq hj">应用ID </strong>，该ID将用于集成。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mm"><img src="../Images/648cecea80c83f17de00c5b4b5e321c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gnFGZwesuN3OJcYSu_XYxA.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx"><a class="ae jn" href="https://console.agora.io/" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="c8f3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Agora仪表板中Agora IO的所有设置和配置都已完成。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mn"><img src="../Images/cf62ddf5c47fe9980b05ec8aff16dad1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yJUOKmapbCZ6ctut"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@simmerdownjpg?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jackson Simmer</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h2 id="388c" class="mo lo hi bd lp mp mq mr lt ms mt mu lx jx mv mw lz kb mx my mb kf mz na md nb bi translated">为原生Android集成Agora IO相关配置:</h2><p id="b02d" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated">请在<code class="du nc nd ne nf b">AndroidManifest.xml</code>中添加以下权限，因为Agora Video SDK需要<code class="du nc nd ne nf b">camera</code>和<code class="du nc nd ne nf b">microphone</code>的权限才能开始视频通话。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><h2 id="58f7" class="mo lo hi bd lp mp mq mr lt ms mt mu lx jx mv mw lz kb mx my mb kf mz na md nb bi translated">为原生iOS集成Agora IO相关配置:</h2><p id="2e6c" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated">请在iOS文件夹的<code class="du nc nd ne nf b">info.plist</code>文件中添加以下键和值。</p><ul class=""><li id="2388" class="ky kz hi jq b jr js ju jv jx la kb lb kf lc kj ni le lf lg bi translated"><code class="du nc nd ne nf b">Privacy - Microphone Usage Description</code></li><li id="ae44" class="ky kz hi jq b jr lh ju li jx lj kb lk kf ll kj ni le lf lg bi translated"><code class="du nc nd ne nf b">Privacy - Camera Usage Description</code></li></ul><blockquote class="kk kl km"><p id="69d4" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated">注意:由于Agora io SDK使用<code class="du nc nd ne nf b">PlatformView</code>，你应该在你的<code class="du nc nd ne nf b"><em class="hi">info.plist</em></code>中设置<code class="du nc nd ne nf b">io.flutter.embedded_views_preview</code>为<code class="du nc nd ne nf b">YES</code></p></blockquote><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h2 id="f8b8" class="mo lo hi bd lp mp mq mr lt ms mt mu lx jx mv mw lz kb mx my mb kf mz na md nb bi translated">将Agora SDK集成到您的dart代码中:</h2><p id="f096" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated">请将以下插件添加到<code class="du nc nd ne nf b">pubspec.yaml</code>文件中。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><p id="2ad4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你可以在这里找到Agora SDK相关插件<code class="du nc nd ne nf b"><a class="ae jn" href="https://pub.dev/packages/agora_rtc_engine" rel="noopener ugc nofollow" target="_blank">agora_rtc_engine</a></code>。</p><p id="cb03" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们必须征得用户对麦克风和摄像头的许可。所以我们必须将这个插件集成到我们的项目中。</p><p id="b058" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">众所周知，在来电/视频通话过程中，应该会有任何声音或铃声提示我们正在通话。因此，我们必须添加另一个插件来播放基于特定平台的铃声或声音。这个功能将由<code class="du nc nd ne nf b"><a class="ae jn" href="https://pub.dev/packages/flutter_ringtone_player" rel="noopener ugc nofollow" target="_blank">flutter_ringtone_player</a></code>插件来完成。</p><p id="f04f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在还有一个场景，视频通话的时候，整个通话过程都要开着屏幕。因此，我们必须添加另一个插件来实现这个特性，这就是<code class="du nc nd ne nf b"><a class="ae jn" href="https://pub.dev/packages/wakelock" rel="noopener ugc nofollow" target="_blank">wakelock</a></code>插件。</p><p id="f396" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最重要的插件，以一种简单的方式实现视频通话，接受和拒绝来自另一个用户的呼叫，<code class="du nc nd ne nf b"><a class="ae jn" href="https://pub.dev/packages/socket_io_client" rel="noopener ugc nofollow" target="_blank">socket_io_client</a></code> <strong class="jq hj"> </strong>是帮助我们实现这一功能的插件。</p><p id="698a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">首先，Agora提供了一个启动项目来在您的项目中设置视频通话，但在我们的实际项目中，我们必须做一些启动GitHub项目中没有提供的其他事情。所以我认为这将有助于那些不仅仅是从用户体验角度出发的开发者。因此，让我们为视频通话的整个周期添加一些其他功能，从接听电话到视频通话。</p><p id="f05f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">首先，我们将实现与套接字相关的东西……</p><p id="0b39" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们在<code class="du nc nd ne nf b">socket_constants.dart</code>文件中声明一些套接字相关的常量。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><blockquote class="kk kl km"><p id="6db4" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated">套接字事件和视频通话事件相关的常数</p></blockquote><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><blockquote class="kk kl km"><p id="b0d4" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">socketUrl </code> : &lt;您的套接字服务器URL&gt;</p></blockquote><blockquote class="nj"><p id="597a" class="nk nl hi bd nm nn no np nq nr ns kj dx translated">注意:这是一个示例项目，所以我们将向套接字传递静态id，但您可以在实时项目中传递授权令牌或唯一id。</p></blockquote><figure class="nt nu nv nw nx jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><blockquote class="kk kl km"><p id="c57c" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">agoraAppId</code> : &lt;您的Agora应用Id &gt;</p></blockquote><p id="df7d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们创建一个dart文件来管理所有与套接字相关的事件。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><p id="59e1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你应该调用<code class="du nc nd ne nf b">common_screen.dart</code>的<code class="du nc nd ne nf b">initState </code>方法中的<code class="du nc nd ne nf b">initSocketManager</code>方法来初始化套接字。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><p id="c471" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">到目前为止，我们已经实现了基本的套接字相关的东西。现在是时候深呼吸一下，从UI部分开始了。</p><p id="5f70" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们用简单的3个步骤来完成:</p><ol class=""><li id="e7a4" class="ky kz hi jq b jr js ju jv jx la kb lb kf lc kj ld le lf lg bi translated">公共屏幕</li><li id="41c2" class="ky kz hi jq b jr lh ju li jx lj kb lk kf ll kj ld le lf lg bi translated">拾取屏幕</li><li id="1905" class="ky kz hi jq b jr lh ju li jx lj kb lk kf ll kj ld le lf lg bi translated">视频通话屏幕</li><li id="bf0e" class="ky kz hi jq b jr lh ju li jx lj kb lk kf ll kj ld le lf lg bi translated">拒绝呼叫对话框</li></ol><h2 id="9743" class="mo lo hi bd lp mp mq mr lt ms mt mu lx jx mv mw lz kb mx my mb kf mz na md nb bi translated">公共屏幕:</h2><p id="8597" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated">我们需要为学生和教师实现一个共同的屏幕，因此，我们必须为相同的像下面做一些用户界面/UX。你可以从<code class="du nc nd ne nf b"><a class="ae jn" href="https://github.com/JaimilPatel/AgoraVideoCall/blob/master/lib/ui/common/common_screen.dart" rel="noopener ugc nofollow" target="_blank">common_screen.dart</a></code>找到这个文件的代码。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ny"><img src="../Images/c0e84e29caab9726518da2cf3341b77c.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*T3cn11LwhYFjPDwFP92AFA.jpeg"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Common Screen</figcaption></figure><h2 id="9cd5" class="mo lo hi bd lp mp mq mr lt ms mt mu lx jx mv mw lz kb mx my mb kf mz na md nb bi translated">拾取屏幕:</h2><p id="917d" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated">我们需要为接受/拒绝呼叫实现一个拾取屏幕。因此，我们必须做一些用户界面/UX，如下图所示。你可以从<code class="du nc nd ne nf b"><a class="ae jn" href="https://github.com/JaimilPatel/AgoraVideoCall/blob/master/lib/ui/pickup/pickup_screen.dart" rel="noopener ugc nofollow" target="_blank">pickup_screen.dart</a></code>找到这个文件的代码。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ny"><img src="../Images/a55da9b39559b9e36cca03954604cc62.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*D5h4V-Vfy4638zylHR3_Qw.jpeg"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Incoming Call To Teacher</figcaption></figure><h2 id="5015" class="mo lo hi bd lp mp mq mr lt ms mt mu lx jx mv mw lz kb mx my mb kf mz na md nb bi translated">视频通话屏幕:</h2><p id="1df3" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated">现在让我们来表演你们都在等着表演的主要魔术…..</p><p id="71e6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对于这个屏幕，我们需要注意一些重要的事情。</p><ol class=""><li id="d4b5" class="ky kz hi jq b jr js ju jv jx la kb lb kf lc kj ld le lf lg bi translated">应用程序ID(来自仪表板)</li><li id="17f4" class="ky kz hi jq b jr lh ju li jx lj kb lk kf ll kj ld le lf lg bi translated">生成的令牌(后端服务器)</li><li id="cace" class="ky kz hi jq b jr lh ju li jx lj kb lk kf ll kj ld le lf lg bi translated">频道名称(后端服务器)</li></ol><p id="9aad" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们需要为视频通话屏幕下面同样的一些用户界面/UX。你可以从<code class="du nc nd ne nf b"><a class="ae jn" href="https://github.com/JaimilPatel/AgoraVideoCall/blob/master/lib/ui/call/video_call_screen.dart" rel="noopener ugc nofollow" target="_blank">video_calling_screen.dart</a></code>中找到这个文件的代码。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ny"><img src="../Images/e0e0bd7f8a250b72d9d6a9578ccb6f37.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*9atzHUGKWArm8566H_v-2A.jpeg"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Video Call Screen</figcaption></figure><p id="79d1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们在一片混乱中为广场相关的配置做好准备。你应该在颤振生命周期的<code class="du nc nd ne nf b">initState</code>方法中调用<code class="du nc nd ne nf b">initalizeCalling</code>。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><blockquote class="kk kl km"><p id="ec70" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">agoraAppId</code> : &lt;您的Agora应用Id &gt;</p><p id="c138" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">widget.token</code>:通过后端</p><p id="39c6" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">widget.channelName</code>:通过后端</p><p id="9432" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">VideoOutputOrientationMode.Adaptative</code>:横向&amp;纵向支持。</p></blockquote><p id="1b14" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">只是不要忘记在处置时调用<code class="du nc nd ne nf b">leaveChannel()</code>和<code class="du nc nd ne nf b">destroy()</code>方法。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><p id="1d50" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">视频通话屏幕的Ui/Ux:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><blockquote class="kk kl km"><p id="3ce8" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">_renderLocalPreview</code>:预览本地摄像机视图</p><p id="c022" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">_renderRemoteVideo</code>:预览远程摄像机视图</p></blockquote><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><blockquote class="kk kl km"><p id="70b4" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">_cancelCallView</code>:取消通话按钮Ui/Ux</p></blockquote><p id="659f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，在这两个屏幕之后，我们将创建一个拒绝通话对话框来结束通话。所以请看下面的界面，从<code class="du nc nd ne nf b"><a class="ae jn" href="https://github.com/JaimilPatel/AgoraVideoCall/blob/master/lib/utils/widgets/leave_dialog.dart" rel="noopener ugc nofollow" target="_blank">leave_dialog.dart</a></code>中找到这个文件的代码。</p><h2 id="694a" class="mo lo hi bd lp mp mq mr lt ms mt mu lx jx mv mw lz kb mx my mb kf mz na md nb bi translated">拒绝呼叫对话框:</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ny"><img src="../Images/a2026864507b8d61ba016685dd28f258.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*DEttjt27MKYhd1zF9LnSfQ.jpeg"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">End Call Alert Dialog</figcaption></figure><p id="7e29" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在所有的用户界面/UX部分都完成了。</p></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><p id="fe43" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们实现Agora视频呼叫相关的套接字事件，并以编程方式发出它们。</p><p id="5bd5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">从一个用户流向另一个用户的通话:</p><ol class=""><li id="e4df" class="ky kz hi jq b jr js ju jv jx la kb lb kf lc kj ld le lf lg bi translated">老师正在点击按钮叫学生。</li><li id="1249" class="ky kz hi jq b jr lh ju li jx lj kb lk kf ll kj ld le lf lg bi translated">学生收到一个来电屏幕。</li><li id="7a65" class="ky kz hi jq b jr lh ju li jx lj kb lk kf ll kj ld le lf lg bi translated">学生将通过接受/拒绝按钮接受/拒绝呼叫。</li><li id="74b3" class="ky kz hi jq b jr lh ju li jx lj kb lk kf ll kj ld le lf lg bi translated">接受后，学生或教师可以使用位于右上角的按钮切断呼叫。</li><li id="a100" class="ky kz hi jq b jr lh ju li jx lj kb lk kf ll kj ld le lf lg bi translated">切断通话后，双方都被重定向到公共屏幕。</li></ol><p id="f936" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">所以让我们在dart中实现这个流程。</p><p id="1bfc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">将下面的代码粘贴到<code class="du nc nd ne nf b">common_screen.dart.</code>中按钮的<code class="du nc nd ne nf b">onPressed</code>方法中</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><blockquote class="kk kl km"><p id="950c" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">ArgParams.connectId</code> : &lt;其他用户的Id&gt;</p><p id="8cb5" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">ArgParams.isForOutGoing</code>:真&gt;是呼出</p></blockquote><blockquote class="nj"><p id="e218" class="nk nl hi bd nm nn no np nq nr ns kj dx translated">注意:这是一个示例项目，所以我们将向套接字传递静态id，但您可以在实时项目中基于服务器响应传递唯一id。</p></blockquote><p id="c507" class="pw-post-body-paragraph jo jp hi jq b jr nz ij jt ju oa im jw jx ob jz ka kb oc kd ke kf od kh ki kj hb bi translated">您必须在<code class="du nc nd ne nf b">connectCall</code>套接字事件中传递另一个用户的id。</p><p id="0b71" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我制作了两个模型类，分别命名为<code class="du nc nd ne nf b"><a class="ae jn" href="https://github.com/JaimilPatel/AgoraVideoCall/blob/master/lib/socket/model/res_call_accept_model.dart" rel="noopener ugc nofollow" target="_blank">ResCallAcceptModel</a></code>和<code class="du nc nd ne nf b"> <a class="ae jn" href="https://github.com/JaimilPatel/AgoraVideoCall/blob/master/lib/socket/model/res_call_request_model.dart" rel="noopener ugc nofollow" target="_blank">ResCallRequestModel</a></code>，以便于组织代码。</p><p id="e322" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">当教师从公共屏幕呼叫学生时，学生将会听到<code class="du nc nd ne nf b">onCallRequest</code> socket事件并导航到拾取屏幕。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><blockquote class="kk kl km"><p id="1c87" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">ArgParams.isForOutGoing</code>:假&gt;有来电</p></blockquote><p id="ec31" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">因此，在那个时候，学生将有两个选择来给出答案，接受和拒绝。如果学生想要拒绝来电，那么他应该按下来电屏幕的拒绝按钮。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><blockquote class="kk kl km"><p id="e9b5" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">Wakelock.disable()</code>:睡眠时间过后，屏幕将关闭。</p><p id="83df" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">Wakelock.enable()</code>:即使过了睡眠时间，屏幕也会打开。</p><p id="db31" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">FlutterRingtonePlayer.stop()</code>:铃声将停止播放。</p><p id="dccc" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><code class="du nc nd ne nf b">FlutterRingtonePlayer.play()</code>:铃声将开始播放。</p></blockquote><p id="c6c5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">因此，那时教师将监听<code class="du nc nd ne nf b">onRejectCall</code>套接字事件并导航到上一个屏幕。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><p id="f0c3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果学生想要接听电话，他应该按下来电屏幕的接受按钮，然后导航到视频通话屏幕。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><p id="2fe5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">因此，那时教师将监听<code class="du nc nd ne nf b">onAcceptCall</code> socket事件并导航到视频通话屏幕。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><p id="c03a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">所以现在我们已经成功实现了视频通话流程。</p><p id="76a3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">每当学生/教师想要取消视频通话时，他们可以通过位于视频通话屏幕右上角的按钮来取消，单击该取消按钮后，画面中将出现结束通话提醒对话框。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><p id="c926" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">因此在那个时候，其他用户将监听<code class="du nc nd ne nf b">onRejectCall</code>套接字事件并导航到前一个屏幕。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><p id="df02" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们为agora和socket事件相关的东西实现后端部分。</p><h2 id="c04f" class="mo lo hi bd lp mp mq mr lt ms mt mu lx jx mv mw lz kb mx my mb kf mz na md nb bi translated">从服务器端生成Agora令牌:</h2><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><h2 id="1361" class="mo lo hi bd lp mp mq mr lt ms mt mu lx jx mv mw lz kb mx my mb kf mz na md nb bi translated">服务器端的套接字事件实现:</h2><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure><h2 id="efa5" class="mo lo hi bd lp mp mq mr lt ms mt mu lx jx mv mw lz kb mx my mb kf mz na md nb bi translated">。后端的环境文件:</h2><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ng nh l"/></div></figure></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><p id="63f7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">感谢<a class="oe of ge" href="https://medium.com/u/44002fa60b46?source=post_page-----66b5731c07e--------------------------------" rel="noopener" target="_blank">林卡尔·戈赫尔</a>对后端相关的支持。</p><p id="fb77" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你会在我的GitHub repo中找到其他与后端(agora-call-backed)相关的东西。所以我们现在完成了实现。你可以在这个博客的末尾找到GitHub repo的链接。</p><p id="95d6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们看看下面视频中的实施总结。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es og"><img src="../Images/c1320641562684b26322ae996006a807.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*IMDFmjbUBs8cbqesoAYP_A.gif"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Incoming Call</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es og"><img src="../Images/00c60469ed878c40961d09f0b9144f2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*ADIcAkyigeJAztSXq-oKiQ.gif"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Outgoing Call</figcaption></figure></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="oh nh l"/></div></figure><h1 id="e00b" class="ln lo hi bd lp lq lr ls lt lu lv lw lx io ly ip lz ir ma is mb iu mc iv md me bi translated">结论</h1><p id="7153" class="pw-post-body-paragraph jo jp hi jq b jr mf ij jt ju mg im jw jx mh jz ka kb mi kd ke kf mj kh ki kj hb bi translated">我们已经用socket完成了Agora视频通话的所有实现。如果你想实现直播的目的，那么你也可以用agora来实现。</p><p id="878e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">所以，这就是在Flutter中使用Socket和Agora IO的<strong class="jq hj">视频通话集成。</strong></p><p id="55d7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你可以在Git库上找到整个项目的<strong class="jq hj"> clean architecture </strong>:</p><div class="oi oj ez fb ok ol"><a href="https://github.com/JaimilPatel/AgoraVideoCall" rel="noopener  ugc nofollow" target="_blank"><div class="om ab dw"><div class="on ab oo cl cj op"><h2 class="bd hj fi z dy oq ea eb or ed ef hh bi translated">JaimilPatel/AgoraVideoCall</h2><div class="os l"><h3 class="bd b fi z dy oq ea eb or ed ef dx translated">随时随地享受高清视频通信，访问…</h3></div><div class="ot l"><p class="bd b fp z dy oq ea eb or ed ef dx translated">github.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz jh ol"/></div></div></a></div></div></div>    
</body>
</html>