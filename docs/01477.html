<html>
<head>
<title>Making More to Relative Path to File to Work</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使更多到文件的相对路径工作</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/making-more-yo-relative-path-to-file-to-work-fbf6280f9511?source=collection_archive---------21-----------------------#2021-04-11">https://medium.com/geekculture/making-more-yo-relative-path-to-file-to-work-fbf6280f9511?source=collection_archive---------21-----------------------#2021-04-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="2cba" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">而不用担心当前的工作目录(Python)。</h1><p id="df28" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果您有一些使用相对路径的脚本或应用程序，并且您想从另一个目录调用它，该怎么办？让事情变得更复杂。也许你的“外部”代码也使用<em class="kb">相对</em>路径，但是<em class="kb">相对</em>到另一个目录。在这里，我将描述如何让所有这些工作的秘诀。</p><p id="3b13" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">假设您编写了一些脚本或应用程序，打包并安装为YourApp(也就是说，它安装在site-packages或venv中)。大概是这样的:</p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es kh"><img src="../Images/70b221be6fc3329110fceffae5cc8d33.png" data-original-src="https://miro.medium.com/v2/resize:fit:412/format:webp/1*CVU04MTjNw--g9nbz7pPIA.png"/></div></figure><p id="7458" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><code class="du kp kq kr ks b">app.py</code>的代码:</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="2c54" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj">注意:</strong>这里我使用的是<em class="kb"> init_app_conf </em>模块。你可以在这里阅读<a class="ae kv" rel="noopener" href="/analytics-vidhya/my-major-init-app-conf-module-1a5d9fb3998c"/>。</p><p id="9364" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">通常，在脚本/应用程序的<code class="du kp kq kr ks b">main()</code>函数的末尾有以下几行:</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="eda2" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">它们被设计成当文件作为脚本被调用时，将调用转发给<code class="du kp kq kr ks b">main()</code>函数，通常是从放置<code class="du kp kq kr ks b">app.py</code>的目录(<code class="du kp kq kr ks b">cd YourApp</code>)中调用，类似这样的调用叫做:<code class="du kp kq kr ks b">python app.py</code>。</p><p id="68cd" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">现在，<em class="kb">想从另一个目录调用</em> <code class="du kp kq kr ks b"><em class="kb">app.py</em></code> <em class="kb">(或者是</em> <code class="du kp kq kr ks b"><em class="kb">main()</em></code> <em class="kb">函数)怎么办？</em></p><p id="6053" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">如果您有类似于第17行的代码，它将会失败。其本质问题在于我的代码使用<em class="kb">相对</em>路径，所以<strong class="jf hj">假设我的工作目录与</strong> <code class="du kp kq kr ks b"><strong class="jf hj">app.py</strong></code> <strong class="jf hj">文件</strong>相同。</p><p id="9f60" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">另一种方法可能是提供一些<code class="du kp kq kr ks b">runner.py</code>文件，如下所示:</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="c69b" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">注意，这个文件也没有:</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="8c44" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">最后。</p><p id="5c47" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">它基本上调用由<code class="du kp kq kr ks b">FixRelCwd</code>上下文管理器修饰的<code class="du kp kq kr ks b">app.py</code> <code class="du kp kq kr ks b">main()</code>函数。我将在下面回到<code class="du kp kq kr ks b">FixRelCwd</code>。</p><p id="7094" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">现在，在一些不相关的目录中，您应该有这样的内容:</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="4902" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">这就是<code class="du kp kq kr ks b">main</code>的“真实”方法。如果你想在<code class="du kp kq kr ks b">app.py</code>或<code class="du kp kq kr ks b">main()</code>函数之前或之后放一些额外的代码。你可以把它放在第15行和第17行。</p><p id="7ae4" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><a class="ae kv" rel="noopener" href="/analytics-vidhya/integrating-pythons-logging-and-warnings-packages-7ffd6f65e02d">在这里</a>你可以阅读我的故事，它描述了我配置日志的方式。</p><p id="ae6b" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><a class="ae kv" rel="noopener" href="/@alex_ber/making-relative-path-to-file-to-work-d5d0f1da67bf">在这里</a>你可以阅读关于<code class="du kp kq kr ks b"><a class="ae kv" href="https://github.com/alex-ber/AlexBerUtils/blob/master/alexber/utils/mains.py" rel="noopener ugc nofollow" target="_blank"><em class="kb">mains</em></a></code> <em class="kb"> </em>模块中的<code class="du kp kq kr ks b"><a class="ae kv" href="https://github.com/alex-ber/AlexBerUtils/blob/master/alexber/utils/mains.py#L12" rel="noopener ugc nofollow" target="_blank"><em class="kb">fixabscwd()</em></a><em class="kb"> </em></code>功能或者<a class="ae kv" rel="noopener" href="/@alex_ber/making-relative-path-to-file-to-work-d5d0f1da67bf">制作相对路径文件来工作</a>。</p><p id="3aae" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">简单地说，除了第2行和第16行，这是典型的<code class="du kp kq kr ks b">main()</code>函数。我想调用安装在<code class="du kp kq kr ks b">YourApp</code>包中的<code class="du kp kq kr ks b">app.py</code>脚本/应用程序。具体来说，执行以下代码:</p><pre class="ki kj kk kl fd kw ks kx ky aw kz bi"><span id="da1f" class="la ig hi ks b fi lb lc l ld le"><em class="kb">python -m pip uninstall --yes </em>YourApp<br/><em class="kb">python setup.py sdist bdist_wheel<br/>python -m pip install --find-links=./dist </em>YourApp</span></pre><p id="4574" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">所以，因为我们安装了<code class="du kp kq kr ks b">YourApp</code>包，所以我们可以导入(的包装器，为什么它是包装器很重要将在下面说明)<code class="du kp kq kr ks b">main() </code>函数，并在适当的时候定期调用它(如果我们愿意，我们可以在它之前和/或之后添加一些代码)。</p></div><div class="ab cl lf lg gp lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hb hc hd he hf"><p id="7005" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">让我们快些应用程序，我们有什么。我们有<code class="du kp kq kr ks b">YourApp </code>脚本应用程序。它被安装到站点包或venv中。它有带<code class="du kp kq kr ks b">main()</code>函数的<code class="du kp kq kr ks b">app.py</code>文件，该文件执行一些计算。我们有一些由<code class="du kp kq kr ks b">FixRelCwd</code>上下文管理器修饰的<code class="du kp kq kr ks b">main() </code>函数的<code class="du kp kq kr ks b">runner.py </code>。而我们有一些“真实”文件具有如上<code class="du kp kq kr ks b">main()</code>的“真实”功能。</p><p id="7ab3" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">所以，真正的权力在<code class="du kp kq kr ks b">FixRelCwd.</code></p></div><div class="ab cl lf lg gp lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hb hc hd he hf"><h1 id="0e6d" class="if ig hi bd ih ii lm ik il im ln io ip iq lo is it iu lp iw ix iy lq ja jb jc bi translated"><code class="du kp kq kr ks b">FixRelCwd </code>如何工作？</h1><p id="f9cc" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><code class="du kp kq kr ks b">FixRelCwd</code>是<em class="kb">上下文管理器。它需要<em class="kb"> relPackage </em>和可选的<em class="kb">记录器</em>。<em class="kb"> <br/> </em>临时将当前工作目录改为安装<em class="kb"> relPackage </em>的目录。如果没有指定<em class="kb">记录器</em>，那么将使用一些默认的记录器。</em></p><p id="013e" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">如果在REPL或IPython笔记本中调用这个函数，它什么也不做。</p><p id="3f2b" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">这个函数没有从冻结的python脚本(使用py2exe冻结)中测试过，但是它应该可以工作(不做任何事情)。</p><p id="7b38" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">基本上，它首先存储<code class="du kp kq kr ks b">os.chdir</code>以备后用，然后在<em class="kb"> relPackage </em>模块中寻找<code class="du kp kq kr ks b">__file__</code>属性，从那里获取目录并为其设置cwd(通过调用<code class="du kp kq kr ks b">os.chdir</code>)。</p><p id="970e" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">在退出时，它恢复<code class="du kp kq kr ks b">os.chdir,</code>,这样您的“外部”代码可以照常运行。</p></div><div class="ab cl lf lg gp lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hb hc hd he hf"><p id="8c37" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">源代码你可以在这里找到<a class="ae kv" href="https://github.com/alex-ber/AlexBerUtils/blob/master/alexber/utils/mains.py" rel="noopener ugc nofollow" target="_blank"/>。它是我的AlexBerUtils项目的一部分。</p><p id="0763" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">您可以从PyPi安装AlexBerUtils:</p><p id="614f" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><code class="du kp kq kr ks b">python3 -m pip install -U alex-ber-utils</code></p><p id="724b" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">关于如何安装的更多详细说明，请参见此处的<a class="ae kv" href="https://github.com/alex-ber/AlexBerUtils" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl lf lg gp lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hb hc hd he hf"><h1 id="e57b" class="if ig hi bd ih ii lm ik il im ln io ip iq lo is it iu lp iw ix iy lq ja jb jc bi translated">另请参见:</h1><ul class=""><li id="d2d2" class="lr ls hi jf b jg jh jk jl jo lt js lu jw lv ka lw lx ly lz bi translated"><a class="ae kv" rel="noopener" href="/analytics-vidhya/integrating-pythons-logging-and-warnings-packages-7ffd6f65e02d">集成Python的日志和警告包</a>。</li><li id="f5bc" class="lr ls hi jf b jg ma jk mb jo mc js md jw me ka lw lx ly lz bi translated"><code class="du kp kq kr ks b"><a class="ae kv" href="https://github.com/alex-ber/AlexBerUtils/blob/master/alexber/utils/mains.py" rel="noopener ugc nofollow" target="_blank"><em class="kb">mains</em></a></code> <em class="kb"> </em>模块中的<code class="du kp kq kr ks b"><a class="ae kv" href="https://github.com/alex-ber/AlexBerUtils/blob/master/alexber/utils/mains.py#L12" rel="noopener ugc nofollow" target="_blank"><em class="kb">fixabscwd()</em></a><em class="kb"> </em></code>功能或<a class="ae kv" rel="noopener" href="/@alex_ber/making-relative-path-to-file-to-work-d5d0f1da67bf">制作文件的相对路径来工作</a>。</li><li id="0d78" class="lr ls hi jf b jg ma jk mb jo mc js md jw me ka lw lx ly lz bi translated"><code class="du kp kq kr ks b"><a class="ae kv" href="https://github.com/alex-ber/AlexBerUtils/blob/master/alexber/utils/mains.py" rel="noopener ugc nofollow" target="_blank"><em class="kb">mains</em></a></code> <em class="kb"> </em>模块中的<code class="du kp kq kr ks b"><a class="ae kv" href="https://github.com/alex-ber/AlexBerUtils/blob/master/alexber/utils/mains.py#L237" rel="noopener ugc nofollow" target="_blank"><em class="kb">fix_retry_env</em></a><em class="kb">() </em></code>函数或<a class="ae kv" href="https://alex-ber.medium.com/make-path-to-file-on-windows-works-on-linux-402ed3624f66" rel="noopener">Make path to file on Windows works on Linux。</a></li><li id="b782" class="lr ls hi jf b jg ma jk mb jo mc js md jw me ka lw lx ly lz bi translated"><code class="du kp kq kr ks b"><a class="ae kv" href="https://github.com/alex-ber/AlexBerUtils/blob/master/alexber/utils/mains.py" rel="noopener ugc nofollow" target="_blank"><em class="kb">mains</em></a></code> <em class="kb"> </em>模块中的<code class="du kp kq kr ks b"><a class="ae kv" href="https://github.com/alex-ber/AlexBerUtils/blob/master/alexber/utils/mains.py#L263" rel="noopener ugc nofollow" target="_blank">FixRelCwd()</a></code>功能或<a class="ae kv" href="https://alex-ber.medium.com/making-more-yo-relative-path-to-file-to-work-fbf6280f9511" rel="noopener">使更多到文件的相对路径工作</a></li><li id="3378" class="lr ls hi jf b jg ma jk mb jo mc js md jw me ka lw lx ly lz bi translated"><code class="du kp kq kr ks b"><a class="ae kv" href="https://github.com/alex-ber/AlexBerUtils/blob/master/alexber/utils/mains.py" rel="noopener ugc nofollow" target="_blank"><em class="kb">mains</em></a></code> <em class="kb"> </em>模块中的<code class="du kp kq kr ks b"><a class="ae kv" href="https://github.com/alex-ber/AlexBerUtils/blob/master/alexber/utils/mains.py#L295" rel="noopener ugc nofollow" target="_blank">GuardedWorkerException()</a></code>函数或<a class="ae kv" href="https://alex-ber.medium.com/exception-propagation-from-another-process-bb09894ba4ce" rel="noopener">异常从另一个进程</a>传播</li><li id="4d27" class="lr ls hi jf b jg ma jk mb jo mc js md jw me ka lw lx ly lz bi translated"><code class="du kp kq kr ks b"><a class="ae kv" href="https://github.com/alex-ber/AlexBerUtils/blob/master/alexber/utils/files.py" rel="noopener ugc nofollow" target="_blank"><em class="kb">files </em></a></code>模块中的<code class="du kp kq kr ks b"><a class="ae kv" href="https://github.com/alex-ber/AlexBerUtils/blob/master/alexber/utils/files.py#L9" rel="noopener ugc nofollow" target="_blank">join_files()</a></code>功能或<a class="ae kv" href="https://alex-ber.medium.com/join-files-cc5e38e3c658" rel="noopener">加入文件</a>。</li><li id="bb05" class="lr ls hi jf b jg ma jk mb jo mc js md jw me ka lw lx ly lz bi translated"><a class="ae kv" href="https://github.com/alex-ber/AlexBerUtils/blob/master/alexber/utils/stdlogging.py" rel="noopener ugc nofollow" target="_blank"> <em class="kb"> stdLogging </em> </a>模块，或<a class="ae kv" href="https://alex-ber.medium.com/stdlogging-module-d5d69ff7103f" rel="noopener">我的stdLogging模块</a></li></ul></div></div>    
</body>
</html>