<html>
<head>
<title>Puppeteer, Headless Chrome and CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">木偶师，无头铬和CircleCI</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/puppeteer-headless-chrome-and-circleci-1438d90a2357?source=collection_archive---------16-----------------------#2021-07-12">https://medium.com/geekculture/puppeteer-headless-chrome-and-circleci-1438d90a2357?source=collection_archive---------16-----------------------#2021-07-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2565" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我想介绍一个我在更新旧的回购协议时遇到的问题。在这种情况下，我正在让它在CircleCi版本2上工作。更具体地说，是从“karma-phantomjs-launcher”:“1 . 0 . 4”到“karma-chrome-launcher”:“3 . 1 . 0”的迁移。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/f2b39a0cf1acffe2d6f716d41962e8bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CuPIPvcFdDANwPydGUPToQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@wocintechchat?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Christina @ wocintechchat.com</a> on <a class="ae jt" href="https://unsplash.com/s/photos/web-browser?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c8c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这包括将karma从1.5.0更新到6.3.4，将karma-webpack从2.0.3更新到5.0.0，并添加了puppeter 10 . 1 . 0。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ju"><img src="../Images/8a8afdfaf3f01ac857dbfd3c87f6f020.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PVQYtXamheycwc1k"/></div></div></figure><p id="471f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的本地windows环境中，一切看起来都很好，但是当推送到我的远程GitHub repo时，出现了更多的问题，导致我需要:</p><p id="69ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将docker映像从节点:7.10更新到节点:14.1。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ju"><img src="../Images/00187d59f8c832f3faa701e72e1616b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Qjj7dsTQwOKRXdH2"/></div></div></figure><p id="6cbd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后把我的node-sass从4.12.0更新到支持node v14的6.0.1(虽然我的本地是v12.16.2)。</p><p id="6119" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就在我认为我是安全的时候，我在Webpack编译之后遇到了几个错误，第一个是:</p><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="c085" class="ka kb hi jw b fi kc kd l ke kf">08 07 2021 17:17:42.889:ERROR [launcher]: Cannot start ChromeHeadless</span><span id="3da2" class="ka kb hi jw b fi kg kd l ke kf">/home/circleci/repo/node_modules/puppeteer/.local-chromium/linux-884014/chrome-linux/chrome: error while loading shared libraries: libnss3.so: cannot open shared object file: No such file or directory</span></pre><h1 id="c20c" class="kh kb hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">解决方法:</h1><p id="25ef" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">在我的CircleCI配置中，在我的npm install命令之后添加这一行。</p><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="fdff" class="ka kb hi jw b fi kc kd l ke kf">run: sudo apt-get install gconf-service libasound2 libatk1.0–0 libc6 libcairo2 libcups2 libdbus-1–3 libexpat1 libfontconfig1 libgbm-dev libgcc1 libgconf-2–4 libgdk-pixbuf2.0–0 libglib2.0–0 libgtk-3–0 libnspr4 libpango-1.0–0 libpangocairo-1.0–0 libstdc++6 libx11–6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 ca-certificates fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils wget</span></pre><h1 id="5631" class="kh kb hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">该修复程序解释道:</h1><p id="8f0d" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">在谷歌上搜索了一下之后，我了解到虽然在windows上安装npm会安装上面列出的puppeteers依赖项，但CircleCi项目是在linux上运行的，需要一个额外的步骤才能运行。希望这能帮助任何遇到这个问题的人。</p><h1 id="3fab" class="kh kb hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">奖金:</h1><p id="7d54" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">虽然您可能不会遇到这种情况，但我发现在我的CircleCi项目的构建和测试步骤中，Webpack的缩小文件给我带来了问题，因此在我的测试中添加一个停止缩小的条件似乎效果不错。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lj"><img src="../Images/6f2da14b3922f5f1759bd3bf68ca1b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/0*S1mYRjGFE5m7uWZH"/></div></figure></div></div>    
</body>
</html>