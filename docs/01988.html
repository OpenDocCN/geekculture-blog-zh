<html>
<head>
<title>Make Your Own TileMap with Vanilla Javascript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用普通的Javascript制作你自己的TileMap</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/make-your-own-tile-map-with-vanilla-javascript-a627de67b7d9?source=collection_archive---------2-----------------------#2021-05-01">https://medium.com/geekculture/make-your-own-tile-map-with-vanilla-javascript-a627de67b7d9?source=collection_archive---------2-----------------------#2021-05-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2be7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文的目标是解释我用javascript制作tilemaps的过程。我将解释设计地图，然后编写一个函数在浏览器中渲染地图的过程。我将要解释的这个项目的一个实例可以在<a class="ae jd" href="https://tjconti12.github.io/Cat-Crusader/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。源代码也可以在<a class="ae jd" href="https://github.com/tjconti12/Cat-Crusader" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><p id="0251" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的游戏猫十字军中，我知道我想建立一个tilemap。不熟悉tilemap是什么？玩过超级马里奥兄弟吗？</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/b8cbfe917dc85d23751b8f873368193c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WQhbpRr6ZSeHok1bkzZ9YA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Example of a tilemap used in-game</figcaption></figure><p id="5164" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个老派经典是一个使用标题地图的游戏的完美例子。从本质上来说，tilemap是可以放在一起组成游戏地图的图块集合。把它想象成做一个拼图，除了你可以重复使用碎片！Tilemaps存储在项目中，称为tile atlas。这实际上是一个图像，包含了您可以使用的所有可能的图块。免费磁贴地图的一个很好的资源是<a class="ae jd" href="https://opengameart.org/" rel="noopener ugc nofollow" target="_blank"> opengameart </a>。这是猫十字军第一关使用的tilemap。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ju"><img src="../Images/50379d1fa09f9072ea309159edbbf1c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*AUJjroWwWJGr3AZCzdHCJA.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx">House Level Tilemap. Map courtesy of Sharm, HughSpectrum, and LPC</figcaption></figure><p id="58a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">变成了这样:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jv"><img src="../Images/8a83e8a50523b64ade91a574d8231dfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BliZQ0fIvTUlAlABsluqcA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">House Level in Cat Crusader</figcaption></figure><h1 id="a19d" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">制作自定义地图</h1><p id="a8f2" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">使用tilemaps可以做的事情真的令人印象深刻！我到底是如何设计这些地图的呢？有一个令人惊叹的免费开源应用程序叫做tiled。这里可以下载<a class="ae jd" href="https://www.mapeditor.org/" rel="noopener ugc nofollow" target="_blank">。开始的时候，学习平铺地图的曲线有点陡，但是只要花一点时间和练习，你就可以制作出一些令人惊叹的地图！打开tiled时，首先创建一个新的tileset。</a></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kz"><img src="../Images/83d69e105d91ff43535827302caf5a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*XamhB-ki2hMKNcbGIbCiTg.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Tiled application opening page</figcaption></figure><p id="9b7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以在这里上传您选择的图块图集。了解地图中每个图块的大小非常重要。大多数时候它们不是16就是32像素。如果您下载的源没有指定，请尝试16或32px，看看它是否正确。您还必须选择边距和间距，但是大多数tilesets不需要这样做。给你的tileset一个名字并保存它！</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es la"><img src="../Images/90947d333cc7c76e85ee14c106b0f2c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*8SloRIDgN5nqDbF9jT1nhQ.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Creating new Tileset</figcaption></figure><p id="d631" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您现在所看到的，tiled突出显示了tileset中的每个图块。现在你可以点击创建一个新的地图开始设计！。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lb"><img src="../Images/9a29028b258648494aedbcc312b22993.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*F0Ai-PkPhOz9rlTWHm63ig.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Newly Created Tileset</figcaption></figure><p id="df27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您需要指定地图的宽度和高度。您还需要再次以像素为单位给出图块大小。(需要代码时，您将需要这些信息)</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lc"><img src="../Images/6e0f85bfd46baf90ae4e670b0a26f02b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*OhOvW4nPXsYfdViPYtUTBw.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Create New Map</figcaption></figure><p id="82ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你可以抓住个别瓷砖和设计了！</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ld"><img src="../Images/159630160e80958a43e4b51525b232a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qEe2P1BAwM_gOWkyarY7-Q.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Designing the Map</figcaption></figure><p id="e5d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">平铺使我们能够添加多个图层到我们的地图。例如，如果我们想在地板瓷砖上添加一个椅子瓷砖，而不使地板消失。平铺使这个非常简单的层视图。添加多个层需要记住的唯一一点是，这会使代码更加复杂。当我们看到代码时，我会向你展示它的效果。现在tile能够将地图导出为javascript地图文件或JSON地图文件。我选择使用javascript地图文件，因为我只对静态地图感兴趣。我相信你可以使用JSON地图文件来创建更大的地图，随着玩家的进展来加载。</p><p id="33e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">新创建的javascript映射文件将包含大量信息。我们只对数据数组感兴趣。这告诉我们哪块瓷砖应该放在哪个位置。例如，第一个数字是17。这意味着地图集的第17个分块应该在地图上的第一个位置。保存这个数组，现在，我们将在以后的绘图函数中使用它。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es le"><img src="../Images/c411d0720159eab23d68f247af5a4747.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-hpGwSydp3fWd3lRrYZkGg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Example of the Data Array</figcaption></figure><h1 id="445e" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">用Javascript实现地图</h1><p id="905f" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">现在我们有了漂亮的地图，我们需要用javascript写一些代码来绘制这些地图。为此，我们将使用一个名为canvas的javascript元素(<a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial" rel="noopener ugc nofollow" target="_blank">这里的</a>是指向文档的链接)。canvas元素本质上允许我们将图像绘制到将由浏览器显示的画布上。这些元素可以使用普通的CSS(或在cat crusader中使用的scss)进行样式化。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="4adb" class="lk jx hi lg b fi ll lm l ln lo">&lt;! -- HTML code --&gt;<br/>&lt;canvas id="test-canvas"&gt;&lt;/canvas&gt;</span><span id="53d9" class="lk jx hi lg b fi lp lm l ln lo">/* CSS code */<br/>#test-canvas {<br/>   width: 500px;<br/>   height: 250px;<br/>}</span></pre><p id="ab5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要编写一个函数，允许我们从tileset到canvas绘制正确的瓷砖。Canvas使用一个名为getContext的函数来允许我们绘制图像、形状等。例如，在画布元素上绘制一个简单的矩形。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="1cfd" class="lk jx hi lg b fi ll lm l ln lo">const canvas = document.getElementById('test-canvas');<br/>const ctx = canvas.getContext('2d');</span><span id="5658" class="lk jx hi lg b fi lp lm l ln lo">// Setting the color of the rectangle<br/>ctx.fillStyle = 'blue';</span><span id="6da5" class="lk jx hi lg b fi lp lm l ln lo">// First parameter is the starting x position on the canvas<br/>  // an x value of 0 would start drawing all the way to the left<br/>// Second parameter is the starting y position on the canvas<br/>  // a y value of 0 would start drawing all the way to the top<br/>// The third and fourth parameters are for the width and height of the rectangle</span><span id="8f1a" class="lk jx hi lg b fi lp lm l ln lo">ctx.fillRect(50, 50, 100, 100);</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lq"><img src="../Images/928bb12d66d6e515d766012517fcb246.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/1*tuDtamU_RQhwveiw7XRuXA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Blue Square Rendered on a Canvas</figcaption></figure><p id="586a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的代码将生成一个100x100px的蓝色正方形。它还将从左边50个像素开始绘制正方形，从顶部50个像素开始绘制。<a class="ae jd" href="https://codepen.io/tjconti12/pen/abpgVEd" rel="noopener ugc nofollow" target="_blank">这里的</a>是我为这个例子制作的代码笔的链接。</p><p id="e8f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这个项目，有几种不同的方法来处理javascript中的图像。你可以使用<code class="du lr ls lt lg b">document.createElement(‘img’)</code>功能。然而，javascript有一个类构造函数，使得这变得更加容易。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="b1df" class="lk jx hi lg b fi ll lm l ln lo">const tileAtlas = new Image();<br/>tileAtlas.src = 'path to image';<br/>tileAtlas.onload = drawFunction;</span></pre><p id="692c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在来说说我们刚刚做了什么。我们使用javascript中的<code class="du lr ls lt lg b">new Image()</code>来创建一个新的图像元素。然后，我们将其源设置为图块地图集的路径(不是我们创建的实际地图，只是包含所有图块的地图集)。一旦图像被加载到javascript中，我们就可以使用<code class="du lr ls lt lg b">.onload</code>方法来调用我们的draw函数。</p><p id="ce05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们加载了图块图集，我们需要设置一些变量。这不是必需的，但是，这将使代码更容易编辑和重用不同大小的级别和不同的图块地图集像素大小(记住前面的示例使用32像素大小的图块)。首先，我们将为单个图块大小、期望的图块输出大小(稍后将详细介绍)和新更新的图块大小声明一个变量。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="e684" class="lk jx hi lg b fi ll lm l ln lo">let tileSize = 32;<br/>let tileOutputSize = 1.5 // can set to 1 for 32px or higher<br/>let updatedTileSize = tileSize * tileOutputSize;</span></pre><p id="efbe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将在我们的draw函数中使用这些变量，所以将来很容易在不同的级别重用该函数。我决定使用<code class="du lr ls lt lg b">tileOutputSize</code>变量，因为这允许我轻松地放大或缩小地图的尺寸，以确保它适合画布。</p><p id="5f91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要为图块图集设置更多的变量。每个图块图集将具有不同数量的图块行和列。例如，房屋级别的图块地图集包含16列和14行图块。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lb"><img src="../Images/27fe35757f4d369301db49995875f1fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*G1ltBI0Hd-IwtmM0hgPesw.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Tile Atlas Rows and Columns Highlighted</figcaption></figure><p id="bedb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">地图本身有25列和14行。让我们继续为地图集和地图创建变量。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="b960" class="lk jx hi lg b fi ll lm l ln lo">let atlasCol = 16;<br/>let atlasRow = 14;</span><span id="8a1f" class="lk jx hi lg b fi lp lm l ln lo">let mapCols = 25;<br/>let mapRows = 14;<br/>let mapHeight = mapRows * tileSize;<br/>let mapWidth = mapCols * tileSize</span></pre><p id="320d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们也加入先前保存的数据数组。我把它重新命名为有意义的东西(例如。level1Map)。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="2638" class="lk jx hi lg b fi ll lm l ln lo">let level1Map = [<br/>17, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132,  132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 19, 17, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 19, 17, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 19, 17, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 19, 17, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 19, 17, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 148, 148, 132, 132, 19, 17, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 19, 17, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 19, 17, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 19, 17, 132, 132, 148, 148, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 132, 19, 17, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 148, 19, 17, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 164, 19, 17, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 19, 17, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 188, 19]</span></pre><p id="a8ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在该写draw函数了。本质上，我们的目标是从x位置0和y位置0开始渲染地图。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lu"><img src="../Images/82dfedf5a95bfcb3a5fef60741fc6cef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*pKL-BCT8I-4CUj2IuHqs-Q.gif"/></div><figcaption class="jq jr et er es js jt bd b be z dx">How the Tiles are rendered onto the Canvas</figcaption></figure><p id="ef38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们将编写一个嵌套的for循环。我们希望遍历地图中每一列的每一行。该函数还需要三个变量，我们将在循环之前声明它们。这是完整的绘图功能。每个部分的详细解释将在后面。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="cd7b" class="lk jx hi lg b fi ll lm l ln lo">let mapIndex = 0;<br/>let sourceX = 0;<br/>let sourceY = 0;</span><span id="7fca" class="lk jx hi lg b fi lp lm l ln lo">function draw() {</span><span id="2436" class="lk jx hi lg b fi lp lm l ln lo">   for (let col = 0; col &lt; mapHeight; col += tileSize) {<br/>      for (let row = 0; row &lt; mapWidth; row += tileSize) {<br/>         let tileVal = level1Map[mapIndex];<br/>         if(tileVal !=0) {<br/>            tileVal -= 1;<br/>            sourceY = Math.floor(tileVal/atlasCol) * tileSize;<br/>            sourceX = (tileVal % atlasCol) * tileSize;<br/>            ctx.drawImage(tileAtlas, sourceX, sourceY, tileSize,<br/>            tileSize, row * tileOutputSize, col * tileOutputSize,<br/>            updatedTileSize, updatedTileSize);<br/>         }<br/>         mapIndex ++;<br/>      }<br/>   }<br/>}</span></pre><p id="4ff2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个变量mapIndex表示在<code class="du lr ls lt lg b">level1Map</code>数组中的位置。这将从0开始，并在每次内循环运行时递增。这将评估<code class="du lr ls lt lg b">level1Map</code>数组中的每个值。接下来的两个变量是X和Y源。<code class="du lr ls lt lg b">ctx.drawImage()</code>需要准确地知道沿着<code class="du lr ls lt lg b">tileAtlas</code>的X轴和Y轴有多少像素开始切割。我们只是在这里初始化值。</p><p id="f1bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每次内部for循环运行时，它将表示地图上要绘制的位置。例如，嵌套的<code class="du lr ls lt lg b">for</code>循环第一次运行时，我们试图绘制地图左上角的方块。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lv"><img src="../Images/803c43714138f90d02a11bf4e8b3d1ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TRrc1hZRmOz7ccJiWXS2BQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">First Square Highlighted</figcaption></figure><p id="01db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该函数将首先确定<code class="du lr ls lt lg b">level1Map</code>数组中的值。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="83d6" class="lk jx hi lg b fi ll lm l ln lo">let tileVal = level1Map[mapindex];<br/>// tileVal would be equal to 17 the first time the loop runs</span></pre><p id="8fa4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们添加一些逻辑，以防平铺值为0。(如果使用多个层，会出现这种情况，因为不是每个层都有与每个单幅图块相关联的值。然而，它不适用于这个例子)如果值是0，则对于特定的正方形，不在画布上绘制任何东西，并且循环重复。如果该值不为0，我们需要从<code class="du lr ls lt lg b">tileAtlas</code>中确定要切割的X和Y源。对于此示例，第一个值是17，它是指图块图集第二行上的第一个图块。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lb"><img src="../Images/440e3feeff36670ebcf667ca01524b60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*RNQZYQj8t3nsUwNY8x533w.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Tile Atlas Highlighted Showing the Position of the 17th Square</figcaption></figure><p id="4030" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们用来创建地图的平铺软件从1开始计数。所以<code class="du lr ls lt lg b">level1Map</code>数组中的每个值实际上相差1。要纠正这个错误，在if语句中，从<code class="du lr ls lt lg b">tileVal</code>中减去1。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="b266" class="lk jx hi lg b fi ll lm l ln lo">tileVal -= 1;</span></pre><p id="b3bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要告诉<code class="du lr ls lt lg b">ctx.drawImage()</code>函数在X位置0和Y位置32px开始切割。(图集中每个图块为32px)对于源自图集第一行的任何图块，其<code class="du lr ls lt lg b">sourceY</code>应等于0。如果它来自第二行，那么它的<code class="du lr ls lt lg b">sourceY</code>应该等于32，依此类推。在本例中，第一行是0-15之间的任何值。要确定图块是否位于第一行，请将图块值除以图块图集的列数。如果数字小于1，那么它从0的Y位置开始。如果数字大于1但小于2，则它从32的Y位置开始。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="9a84" class="lk jx hi lg b fi ll lm l ln lo">sourceY = Math.floor(tileVal/atlasCol) * tileSize;</span><span id="ef8e" class="lk jx hi lg b fi lp lm l ln lo">// For a tile originating in the first row of the atlas<br/>sourceY = Math.floor(1/16) * 32; which will equal 0</span><span id="39f2" class="lk jx hi lg b fi lp lm l ln lo">// For the first tile of this example<br/>// sourceY = Math.floor(16/16) * 32; which will equal 32</span></pre><p id="ac1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于X位置，我们可以使用javascript模数运算符<code class="du lr ls lt lg b">%</code>。对于源自图集的第一列的任何图块，其<code class="du lr ls lt lg b">sourceX</code>应该等于0。对于第二列，应该是32，以此类推。在这个例子中，图集有16列。我们想数一下我们离左边有多少列。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lb"><img src="../Images/184ef50259c3631f3c6c4a68d9027268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*yxBslMb9n-6mRJpPqx5k1g.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Tile Atlas Highlighted showing the First Two Rows</figcaption></figure><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="ec28" class="lk jx hi lg b fi ll lm l ln lo">sourceX = tileVal * tileSize;</span></pre><p id="1664" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">0到15之间的任何值都很好。然而，任何超过15的都会引起问题。如果该值大于15，我们需要将它重置回0。这就是模数运算符的用武之地。</p><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="151b" class="lk jx hi lg b fi ll lm l ln lo">sourceX = (tileVal % atlasCol) * tileSize;</span><span id="4fa8" class="lk jx hi lg b fi lp lm l ln lo">// Our first map tile has the value of 16<br/>// sourceX = (16 % 16) * 32; which would equal 0</span><span id="5031" class="lk jx hi lg b fi lp lm l ln lo">// For a tile in the second row and second column<br/>// sourceX = (17 % 16) * 32; which would equal 32</span></pre><p id="4fe1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然我们已经知道从哪里开始从图集上切割瓷砖，我们需要将这些信息导入到<code class="du lr ls lt lg b">cts.drawImage()</code>函数中。这个函数接受9个参数。</p><ol class=""><li id="2a12" class="lw lx hi ih b ii ij im in iq ly iu lz iy ma jc mb mc md me bi translated">地图集的来源。对图像的引用。在示例中，我们称之为<code class="du lr ls lt lg b">tileAtlas</code>。</li><li id="1709" class="lw lx hi ih b ii mf im mg iq mh iu mi iy mj jc mb mc md me bi translated"><code class="du lr ls lt lg b">sx</code>:我们应该从X轴上的多少像素开始切割。这将是变量<code class="du lr ls lt lg b">sourceX</code>。</li><li id="0364" class="lw lx hi ih b ii mf im mg iq mh iu mi iy mj jc mb mc md me bi translated"><code class="du lr ls lt lg b">sy</code>:我们应该从Y轴上的多少像素开始切割。这将是变量<code class="du lr ls lt lg b">sourceY</code>。</li><li id="2fd7" class="lw lx hi ih b ii mf im mg iq mh iu mi iy mj jc mb mc md me bi translated"><code class="du lr ls lt lg b">sWidth</code>:源宽度。要在X轴上剪切多少像素。这应该就是<code class="du lr ls lt lg b">tileSize</code>了。</li><li id="3cfc" class="lw lx hi ih b ii mf im mg iq mh iu mi iy mj jc mb mc md me bi translated"><code class="du lr ls lt lg b">sHeight</code>:源高度。Y轴上要剪切多少像素。这应该也是<code class="du lr ls lt lg b">tileSize</code>。</li><li id="d6eb" class="lw lx hi ih b ii mf im mg iq mh iu mi iy mj jc mb mc md me bi translated"><code class="du lr ls lt lg b">dx</code>:目的画布X坐标。这是目标画布中应该绘制图块左上角的位置。</li><li id="f96b" class="lw lx hi ih b ii mf im mg iq mh iu mi iy mj jc mb mc md me bi translated"><code class="du lr ls lt lg b">dy</code>:目标画布Y坐标。这是目标画布中应该绘制图块左上角的位置。</li><li id="6821" class="lw lx hi ih b ii mf im mg iq mh iu mi iy mj jc mb mc md me bi translated"><code class="du lr ls lt lg b">dWidth</code>:要在目标画布上绘制的图块的宽度。</li><li id="870e" class="lw lx hi ih b ii mf im mg iq mh iu mi iy mj jc mb mc md me bi translated"><code class="du lr ls lt lg b">dHeight</code>:要在目标画布上绘制的图块的高度。</li></ol><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mk"><img src="../Images/4a1b95fc32d903057b0bc24d9a581568.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*m86406jhoPYMq2A3cqT2Zg.jpeg"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Canvas draw function example. Source <a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage" rel="noopener ugc nofollow" target="_blank">MDN Docs</a></figcaption></figure><pre class="jf jg jh ji fd lf lg lh li aw lj bi"><span id="df65" class="lk jx hi lg b fi ll lm l ln lo">ctx.drawImage(tileAtlas, sourceX, sourceY, tileSize, tileSize, row * tileOutputSize, col * tileOutputSize, updatedTileSize, updatedTileSize);</span></pre><h1 id="36f2" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">分层</h1><p id="691b" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">现在你有一个完整的函数来绘制tilemaps了！只需改变几个变量，就可以很容易地对不同的地图重复这个函数。如果要向地图添加多个图层，切片也允许您这样做。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ml"><img src="../Images/92b7e89f376324cc0ff5028a3603ca4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/1*fT79hNN322pzztEzBuKFTw.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Example of Layering. The chair and table tiles are on top of the floor tiles.</figcaption></figure><p id="8756" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您将地图导出为javascript地图文件时，您将为创建的每个图层获得一个数据数组。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mm"><img src="../Images/36c779079600f211db357d38b6caf7de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_UyjmvjkOIKCYl77fX2wtQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">The data arrays of three different layers. This one is from the Cat Crusader level 1</figcaption></figure><p id="2bdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您所要做的就是为您想要创建的每个层创建一个画布元素。对每一层重复该功能，并绘制到该层对应的<code class="du lr ls lt lg b">ctx</code>元素。</p><h1 id="e04c" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">结论</h1><p id="d9c7" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">我希望这个快速教程是有帮助的。如果你想知道这是如何在游戏中实现的，一定要看看源代码。敬请关注未来关于猫十字军发展的帖子！我打算写一写我是如何为碰撞、重力和摩擦创建游戏引擎逻辑的！大声喊出<a class="ae jd" href="https://www.youtube.com/channel/UCdS3ojA8RL8t1r18Gj1cl6w" rel="noopener ugc nofollow" target="_blank">坑爹编程</a>的教程视频，帮助这个游戏成为现实。</p></div></div>    
</body>
</html>