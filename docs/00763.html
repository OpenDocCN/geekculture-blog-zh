<html>
<head>
<title>Vue Custom Input</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue自定义输入</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/vue-custom-input-501c48788a2f?source=collection_archive---------23-----------------------#2021-03-12">https://medium.com/geekculture/vue-custom-input-501c48788a2f?source=collection_archive---------23-----------------------#2021-03-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="dc2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们大多数人都面临过这个问题:构建一个定制的输入组件。这背后有多种原因，但总的来说，它有自定义的风格，我们应该能够重用它。</p><p id="b405" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然这听起来很简单，但它有一些问题，我们最终会不时地浏览文档来检查一些细节。如果你不太熟悉一些Vue概念，事情会变得有点复杂。</p><p id="81be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上个月，2021年2月，又发生了。当可能的时候，我试着去帮助一个弱势群体中的人，这个问题再次出现。不完全是这个问题，但用户在构建自定义输入组件时遇到了问题。这个问题与一些概念有关。</p><p id="3ee8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了巩固我自己的知识，并把它作为其他人的某种文档，我决定结束编写定制输入的过程。</p><h1 id="c45d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">v型车和<code class="du kb kc kd ke b">&lt;input&gt;</code></h1><p id="eb3d" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">一旦我们开始用Vue构建表单，我们就学习了指令<code class="du kb kc kd ke b">v-model</code>。它为我们做了很多艰苦的工作:它将一个值绑定到一个输入。这意味着每当我们改变输入的值时，变量也会被更新。</p><p id="c770" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">官方文件很好地解释了它是如何工作的:<a class="ae kk" href="https://vuejs.org/v2/guide/forms.html" rel="noopener ugc nofollow" target="_blank">https://vuejs.org/v2/guide/forms.html</a></p><p id="1f5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简而言之，我们可以有下面的模板，我们很好:</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kl"><img src="../Images/2d824f1c3d1ccaa747ee2bf522b7f38f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uv1ci4WDYMYqSubnu078xw.png"/></div></div></figure><p id="9ca6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将有一个以<code class="du kb kc kd ke b">Initial value</code>为初始值的输入，一旦我们改变输入的值，用户名数据将自动更新。</p><p id="a0b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述组件的问题是我们不能重用它。假设我们有一个需要用户名和电子邮件的页面，上面的组件不会处理电子邮件的情况，因为数据在组件本身内部，而不是在其他地方(例如，像父组件)。这是定制输入组件的亮点，也是它的挑战之一:保持<code class="du kb kc kd ke b">v-model</code>行为的一致性。</p><h1 id="68e1" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">错误的自定义输入组件</h1><p id="fdea" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">为什么我要展示这个例子？答案是:这是我们大多数人会尝试的第一种方法。</p><p id="7169" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看如何使用我们的自定义输入组件:</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kx"><img src="../Images/9d11f8df08fd3cffd62b14cf5522c68d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MLNwrF3mC1GQlpNf1jTihw.png"/></div></div></figure><p id="8c54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种情况下，自定义输入需要一个<code class="du kb kc kd ke b">label</code>和一个<code class="du kb kc kd ke b">v-model</code>，看起来像下面的组件:</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kx"><img src="../Images/892b63d94ef19f424075eeecd9f42706.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CbCWdvO91W0Zb_m-pQdYWw.png"/></div></div></figure><p id="4c7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，它期望将<code class="du kb kc kd ke b">label</code>作为属性，并在此基础上计算<code class="du kb kc kd ke b">name</code>(它也可以是一个属性)。第二，它期待一个<code class="du kb kc kd ke b">value</code>属性，并通过<code class="du kb kc kd ke b">v-model</code>将其绑定到<code class="du kb kc kd ke b">&lt;input&gt;</code>。背后的原因可以在文档中找到<a class="ae kk" href="https://vuejs.org/v2/guide/components.html#Using-v-model-on-Components" rel="noopener ugc nofollow" target="_blank">，但简而言之，当我们在自定义组件中使用<code class="du kb kc kd ke b">v-model</code>时，它将获得<code class="du kb kc kd ke b">value</code>作为属性，这是所使用的<code class="du kb kc kd ke b">v-model</code>变量的值。在我们的例子中，它将是在<code class="du kb kc kd ke b">App.vue</code>中定义的<code class="du kb kc kd ke b">model</code>的值。</a></p><p id="b115" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们尝试上面的代码，它会像预期的那样工作，但是为什么它是错误的呢？如果我们打开控制台，我们会看到类似这样的内容:</p><pre class="km kn ko kp fd ky ke kz la aw lb bi"><span id="68f3" class="lc je hi ke b fi ld le l lf lg">[Vue warn]: Avoid mutating a prop directly since the value will be overwritten whenever the parent component re-renders. Instead, use a data or computed property based on the prop's value. Prop being mutated: "value"</span></pre><p id="4966" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它抱怨说我们正在改变一个属性。Vue的工作方式是:子组件拥有来自父组件的属性，子组件向父组件发出更改。将<code class="du kb kc kd ke b">v-model</code>与我们从父组件获得的<code class="du kb kc kd ke b">value</code>属性一起使用违反了它。</p><p id="b5d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看待这个问题的另一种方式是这样重写<code class="du kb kc kd ke b">App.vue</code>:</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es lh"><img src="../Images/c039086a7faf2f82babc6820edf204d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p9ciqqmypyBDzvOYUmzcVA.png"/></div></div></figure><p id="8ed4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">主要区别是使用<code class="du kb kc kd ke b">:value</code>而不是<code class="du kb kc kd ke b">v-model</code>。在这种情况下，我们只是将<code class="du kb kc kd ke b">model</code>传递给<code class="du kb kc kd ke b">value</code>属性。该示例仍然有效，我们在控制台中得到相同的消息。</p><p id="f187" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是重做上面的例子，并确保它像预期的那样工作。</p><h1 id="2a6e" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">快乐的自定义输入组件</h1><p id="2181" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">令人高兴的自定义输入组件不会改变其属性，而是将更改发送给父组件。</p><p id="56a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">文档中有这个确切的例子，但我们在这里会更深入一点。如果我们遵循文档，我们的<code class="du kb kc kd ke b">CustomInput</code>应该如下所示:</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es li"><img src="../Images/e76a7b482ef0df3161c1bb5aeb3deb94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U8fp5zT9nx0f-JlrpQhPhw.png"/></div></div></figure><p id="afbd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这足以让它发挥作用。我们甚至可以用两种方式来测试它:一种是使用<code class="du kb kc kd ke b">App.vue</code>的，一切正常；另一种是只使用<code class="du kb kc kd ke b">:value</code>的，当我们停止改变属性时，它不再正常工作。</p><h2 id="e44a" class="lc je hi bd jf lj lk ll jj lm ln lo jn iq lp lq jr iu lr ls jv iy lt lu jz lv bi translated">添加验证(或数据更改操作)</h2><p id="fda6" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">如果我们需要在数据改变时做一些事情，例如检查它是否为空并显示错误消息，我们需要提取emit。我们将对组件进行以下更改:</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es lw"><img src="../Images/d73fc77780397e86965b4bc1386f0a64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GI30SnJOdV64fsMIxfK7yA.png"/></div></div></figure><p id="7258" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们添加空白支票:</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es lx"><img src="../Images/911d226d99f697b1f2cc1353d4de153a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rtONZWgOE18tZXk5ZWfuvA.png"/></div></div></figure><p id="0548" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它有点工作，首先它不显示任何错误，如果我们键入然后删除它会显示错误信息。问题是错误信息永远不会消失。要解决这个问题，我们需要向value属性添加一个观察器，并在更新时清除错误消息。</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es ly"><img src="../Images/5b550ec138322a9f6f58d803c8ff42f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0tm9A9eVcN1EL3L_V67fHw.png"/></div></div></figure><p id="8e15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以在<code class="du kb kc kd ke b">onInput</code>中添加一个<code class="du kb kc kd ke b">else</code>来获得类似的结果。如果需要，使用观察器使我们能够在用户更新输入值之前进行验证。</p><p id="e6a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们添加更多的东西，我们很可能会进一步扩展这个组件，并且东西会遍布整个<code class="du kb kc kd ke b">&lt;script&gt;</code>区块。为了对事物进行分组，我们可以尝试不同的方法:将computed与<code class="du kb kc kd ke b">v-model</code>一起使用。</p><h2 id="4cd6" class="lc je hi bd jf lj lk ll jj lm ln lo jn iq lp lq jr iu lr ls jv iy lt lu jz lv bi translated">结合计算和<code class="du kb kc kd ke b">v-model</code></h2><p id="d6d9" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">我们可以利用<code class="du kb kc kd ke b">v-model</code>和<code class="du kb kc kd ke b">computed</code>的能力，而不是监听<code class="du kb kc kd ke b">input</code>事件，然后再次发出它。这是我们最接近错误的方法，但仍然是正确的😅<br/>让我们像这样重写我们的组件:</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kx"><img src="../Images/0d85c87b29e5b7993dd3e46c75a8b21e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aaSa6myUm8S4KpL0Yru_NA.png"/></div></div></figure><p id="5803" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以去掉<code class="du kb kc kd ke b">onInput</code>方法，也可以去掉观察器，因为我们可以从computed属性处理<code class="du kb kc kd ke b">get/set</code>函数中的一切。</p><p id="8523" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以实现的一件很酷的事情是使用修饰符，比如之前需要手动编写的<code class="du kb kc kd ke b">.trim/number</code>。</p><p id="34de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于简单的输入组件来说，这是一个很好的方法。事情可能会变得有点复杂，这种方法并不能满足所有的用例，如果我们需要绑定值和监听事件的话。一个很好的例子是，如果您想在父组件中支持<code class="du kb kc kd ke b">.lazy</code>修饰符，您将需要手动监听<code class="du kb kc kd ke b">input</code>和<code class="du kb kc kd ke b">change</code>。</p><h1 id="88bc" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">extra:<code class="du kb kc kd ke b">model</code>属性</h1><p id="d64f" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated"><code class="du kb kc kd ke b"><a class="ae kk" href="https://vuejs.org/v2/api/#model" rel="noopener ugc nofollow" target="_blank">model</a></code> <a class="ae kk" href="https://vuejs.org/v2/api/#model" rel="noopener ugc nofollow" target="_blank">属性</a>允许你定制一点<code class="du kb kc kd ke b">v-model</code>的行为。您可以指定将映射哪个属性，默认为<code class="du kb kc kd ke b">value</code>，以及将发出哪个事件，当使用<code class="du kb kc kd ke b">.lazy</code>时，默认为<code class="du kb kc kd ke b">input</code>或<code class="du kb kc kd ke b">change</code>。</p><p id="4631" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想将<code class="du kb kc kd ke b">value</code>属性用于其他用途，这尤其有用，因为它可能对特定的上下文更有意义，或者只是想让事情更明确，例如将<code class="du kb kc kd ke b">value</code>重命名为<code class="du kb kc kd ke b">model</code>。在大多数情况下，当获取对象作为输入时，我们可能会使用它来定制复选框/单选按钮。</p><h1 id="4aef" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">那又怎样？</h1><p id="fa0e" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">我的观点来自于您的定制输入需要有多复杂:</p><ul class=""><li id="c8dc" class="lz ma hi ih b ii ij im in iq mb iu mc iy md jc me mf mg mh bi translated">它是为了将样式集中在一个组件中而创建的，它的API几乎是在Vue的API之上:<code class="du kb kc kd ke b">computed</code> + <code class="du kb kc kd ke b">v-model</code>。它很像我们的例子，它有简单的道具，没有复杂的验证。</li></ul><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kx"><img src="../Images/4b497d1917a79fd32130ab0222ba422c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JDeyQVQlHOxOURITXl3jKw.png"/></div></div></figure><ul class=""><li id="1403" class="lz ma hi ih b ii ij im in iq mb iu mc iy md jc me mf mg mh bi translated">其他一切(这意味着您需要对之前的设置进行大量调整以支持您需要的东西):监听器、观察器以及您可能需要的其他东西。它可能有多个状态(想想异步验证，加载状态可能是有用的)或者你想从父组件支持<code class="du kb kc kd ke b">.lazy</code>修饰符，是避免第一种方法的好例子。</li></ul><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es li"><img src="../Images/12e2b14772722b4e9dfdf5970b74c538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hr79A2mLO3gXekAOvCkUVw.png"/></div></div></figure><p id="41e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mi">感谢</em> <a class="mj mk ge" href="https://medium.com/u/9242a15941fc?source=post_page-----501c48788a2f--------------------------------" rel="noopener" target="_blank"> <em class="mi">达尼洛·沃兹尼亚克</em> </a> <em class="mi">的点评</em></p></div></div>    
</body>
</html>