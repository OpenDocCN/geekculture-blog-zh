<html>
<head>
<title>Decorators — Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">装饰者— Python</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/decorators-python-ad5531ae3658?source=collection_archive---------45-----------------------#2021-08-02">https://medium.com/geekculture/decorators-python-ad5531ae3658?source=collection_archive---------45-----------------------#2021-08-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/211e50c046fb01a2f577ec7031ac0ca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*_SptB3Fhou6MbrOmLXG6Sw.jpeg"/></div><figcaption class="im in et er es io ip bd b be z dx">Photo by <a class="ae iq" href="https://unsplash.com/@sixteenmilesout?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Sixteen Miles Out</a> on <a class="ae iq" href="https://unsplash.com/s/photos/olive-plant-with-bird?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1149" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">一年前，我写了一篇关于装饰者的文章，现在当我重温它时，我认为我可以做得更好，尤其是在下半年。所以在这里补偿它。作为先决条件，您应该理解<a class="ae iq" href="https://dkhambu.medium.com/closure-python-53c7f896aef" rel="noopener">闭包</a>是如何工作的。</p><p id="c0df" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">在本文中，我们将通过<strong class="it hj">简单</strong>、<strong class="it hj">堆叠</strong>和<strong class="it hj">参数化</strong>装饰器的例子来<strong class="it hj">了解</strong>什么是<strong class="it hj">装饰器</strong>。我们还有动态装饰者作为奖励。</p><p id="164a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">让我们看一个简单的例子:</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="e3dc" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">运行该文件时，我们得到:</p><pre class="jq jr js jt fd jw jx jy jz aw ka bi"><span id="6f81" class="kb kc hi jx b fi kd ke l kf kg">9*2= 18<br/>prod called 1 times.</span></pre><p id="118d" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">现在让我们剖析一下<code class="du kh ki kj jx b">counter</code>函数:</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es kk"><img src="../Images/d5e12bd8c75e984e2bd0ed60c8f6e995.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*2CrkenaqK8Qgw9feNoZKvQ.png"/></div><figcaption class="im in et er es io ip bd b be z dx">closure depicted in dashed lines</figcaption></figure><p id="d341" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">如虚线所示，<code class="du kh ki kj jx b">counter</code>函数使用其局部变量<code class="du kh ki kj jx b">fn</code>和<code class="du kh ki kj jx b">count</code>将<code class="du kh ki kj jx b">inner</code>函数包围起来。</p><p id="44e2" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我们调用<code class="du kh ki kj jx b">counter</code>函数的方式是将<code class="du kh ki kj jx b">prod</code>函数传递给它。<code class="du kh ki kj jx b">counter</code>函数返回<code class="du kh ki kj jx b">inner</code>函数，该函数通过向其传递参数来调用，并由调用<code class="du kh ki kj jx b">counter</code>函数期间传递的<code class="du kh ki kj jx b">prod</code>函数使用。</p><p id="37fd" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">代码的第13行和第14行执行这些调用:</p><pre class="jq jr js jt fd jw jx jy jz aw ka bi"><span id="141e" class="kb kc hi jx b fi kd ke l kf kg">inner = counter(prod)<br/>inner(9,2)</span></pre><p id="bb29" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我们可以使用<code class="du kh ki kj jx b">@&lt;decorator-name&gt;</code>符号进行同样的调用。因此，我们不必像第13行那样调用嵌套函数。</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="d40f" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">当一个函数被修饰时，你可以把它想象成<strong class="it hj">整个函数</strong>得到<strong class="it hj">传递给装饰器</strong>并在装饰器的<strong class="it hj">内部</strong>函数中得到使用。</p><p id="1a1b" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">让我们用一个例子来看看堆栈装饰器:</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="76c9" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">运行该文件时，我们得到:</p><pre class="jq jr js jt fd jw jx jy jz aw ka bi"><span id="4f99" class="kb kc hi jx b fi kd ke l kf kg">running dash function...<br/>running upper function...<br/>C-R-O-W-N- -O-F- -W-I-L-D- -O-L-I-V-E</span></pre><p id="5b44" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">正如您在输出中看到的，如果有<strong class="it hj">堆叠的装饰器</strong>，那么之外的<strong class="it hj">中的装饰器将它下面的装饰器<strong class="it hj">作为参数</strong>传递给它。它递归地到达最里面的装饰器，并完成每个内部函数调用。</strong></p><p id="1af3" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">所以这里先执行<code class="du kh ki kj jx b">upper(fn)</code>的<code class="du kh ki kj jx b">inner</code>方法，然后执行<code class="du kh ki kj jx b">dash(fn)</code>的<code class="du kh ki kj jx b">inner</code>方法。</p><p id="cc98" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">以下是解释的图表:</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kl"><img src="../Images/ba13b4f5b366fc4b52ff2a0c0280414c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0JDkbtw0bhb31e5Y5yb2kA.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx">stacked decorators schematic diagram</figcaption></figure><p id="4915" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">让我们做一个小的修改，这样我们可以调用这个堆栈装饰器5次。</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="30a4" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">运行该文件时，我们得到:</p><pre class="jq jr js jt fd jw jx jy jz aw ka bi"><span id="1362" class="kb kc hi jx b fi kd ke l kf kg">C-R-O-W-N- -O-F- -W-I-L-D- -O-L-I-V-E<br/>C-R-O-W-N- -O-F- -W-I-L-D- -O-L-I-V-E<br/>C-R-O-W-N- -O-F- -W-I-L-D- -O-L-I-V-E<br/>C-R-O-W-N- -O-F- -W-I-L-D- -O-L-I-V-E<br/>C-R-O-W-N- -O-F- -W-I-L-D- -O-L-I-V-E</span></pre><p id="dc37" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我们所做的是定义参数化的外部装饰器<code class="du kh ki kj jx b">rep</code>，它接受值<code class="du kh ki kj jx b">times</code>并包含<code class="du kh ki kj jx b">dash</code>装饰器。<code class="du kh ki kj jx b">dash</code> decorator的内部方法使用<code class="du kh ki kj jx b">rep</code>的参数进行迭代。</p><p id="70ce" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我们装修工做的基本都是装修功能！</p><p id="e7dc" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">这就是装修工的全部工作。希望这对您的理解有所帮助。如果你有任何澄清，请评论。</p><p id="3b92" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">祝贺完成！🎈我的下一篇文章将讨论元组和命名元组。到时候见。</p><p id="de16" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><em class="jp">奖励</em>:这可能有点吓人<strong class="it hj">动态堆叠</strong>装饰器，用于将中间层节点映射到较低层设备。看看吧，玩一玩，应该是对处理装饰器概念的一个很好的温度测试。<em class="jp">先决条件:</em> <a class="ae iq" href="https://dkhambu.medium.com/closure-python-53c7f896aef" rel="noopener"> <em class="jp">闭包</em> </a> <em class="jp">，</em><a class="ae iq" rel="noopener" href="/geekculture/lambda-function-python-b8fa9167fd3b"><em class="jp">λ函数</em> </a></p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="3212" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">运行该文件时，我们得到:</p><pre class="jq jr js jt fd jw jx jy jz aw ka bi"><span id="4d38" class="kb kc hi jx b fi kd ke l kf kg">lower-node-1 is mapped to ['router-x-1', 'router-x-2']<br/>lower-node-2 is mapped to ['firewall-x-1']<br/>lower-node-3 is mapped to ['firewall-next-gen-x-1', 'vm-2.2']<br/>Not a valid mapping</span></pre></div><div class="ab cl kq kr gp ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hb hc hd he hf"><p id="9b71" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">灵感</strong>:</p><ul class=""><li id="fcf3" class="kx ky hi it b iu iv iy iz jc kz jg la jk lb jo lc ld le lf bi translated"><a class="ae iq" href="https://www.udemy.com/course/python-3-deep-dive-part-1/" rel="noopener ugc nofollow" target="_blank"> Python 3:深潜(功能性)</a></li></ul><p id="b18d" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">你可以在<a class="ae iq" href="https://www.patreon.com/dkhambu" rel="noopener ugc nofollow" target="_blank"> Patreon </a>支持我！谢谢大家！</p></div></div>    
</body>
</html>