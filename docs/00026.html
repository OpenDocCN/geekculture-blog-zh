<html>
<head>
<title>Painless GPU and tensorflow/PyTorch integration on Ubuntu 18.04</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ubuntu 18.04上的无痛GPU和tensorflow/PyTorch集成</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/painless-gpu-and-tensorflow-pytorch-integration-on-ubuntu-18-04-48006b49bcb5?source=collection_archive---------0-----------------------#2019-04-24">https://medium.com/geekculture/painless-gpu-and-tensorflow-pytorch-integration-on-ubuntu-18-04-48006b49bcb5?source=collection_archive---------0-----------------------#2019-04-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b09c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">互联网上有很多关于设置GPU的帖子。我试图按照他们中的许多人来设置我的机器，但不知何故不能这样做。在这个过程中有如此多的变量，从nvidia驱动程序版本，cuda工具包版本，CUDnn版本，python版本，tensorflow版本等。这样的例子不胜枚举。在这里看看你的GPU是否支持CUDA集成<a class="ae jd" href="https://developer.nvidia.com/cuda-gpus" rel="noopener ugc nofollow" target="_blank">也是一个好主意。</a></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/c4b30db8edc2f9a16990f0e0cfe3bd7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sHDFh9MVxTm2qlxY"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Photo by <a class="ae jd" href="https://unsplash.com/@christnerfurt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Christian Erfurt</a> on <a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3e3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我假设如下:</p><ol class=""><li id="59b8" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">机器上没有以前的nvidia驱动程序。如果有，我建议先卸载它们，否则按照我的指示可能会或可能不会工作。</li><li id="6be9" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">Python已经安装在机器上。我推荐使用anaconda，因为它使得跟踪库版本和虚拟环境的工作变得非常容易。</li></ol><p id="dab3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我是这样做的:</p><h2 id="8695" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated"><strong class="ak"> 1。通过ubuntu库安装NVIDIA驱动程序</strong></h2><p id="2cbd" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">打开终端并运行以下命令。</p><pre class="jf jg jh ji fd li lj lk ll aw lm bi"><span id="197a" class="ki kj hi lj b fi ln lo l lp lq">$ sudo add-apt-repository ppa:graphics-drivers/ppa <br/>$ sudo apt update <br/>$ sudo apt install nvidia-390 <br/>$ sudo reboot <br/>$ nvidia-smi</span></pre><p id="f8d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果一切按计划进行，您将能够在屏幕上看到类似的输出。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lr"><img src="../Images/a707162d68402e93bfee1f93ac25826b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1hUiN-s24FN2cDBxryT-0A.png"/></div></div></figure><h2 id="5d4e" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">2.安装CUDA工具包(9.0)</h2><p id="fb9b" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">点击<a class="ae jd" href="https://developer.nvidia.com/cuda-90-download-archive" rel="noopener ugc nofollow" target="_blank">这里</a>下载适用于linux、x86_64、ubuntu、17.04、deb的工具包。</p><p id="70d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下载完成后，在基本安装程序的目录中打开一个终端，并运行以下命令:</p><pre class="jf jg jh ji fd li lj lk ll aw lm bi"><span id="528c" class="ki kj hi lj b fi ln lo l lp lq">$ sudo dpkg -i cuda-repo-ubuntu1704-9-0-local_9.0.176-1_amd64.deb<br/>$ sudo apt-key add /var/cuda-repo-9-0-local/7fa2af80.pub<br/>$ sudo apt-get update <br/>$ sudo apt-get install cuda </span></pre><p id="ecaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">也下载并安装一些补丁(可选)，这些补丁是对cuBLAS的一些改进。</p><h2 id="4e5d" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">3.更新路径变量</h2><p id="8dd1" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">将这两行添加到。bashrc文件位于主目录中</p><pre class="jf jg jh ji fd li lj lk ll aw lm bi"><span id="0ef7" class="ki kj hi lj b fi ln lo l lp lq">export PATH=/usr/local/cuda-9.0/bin${PATH:+:${PATH}}$</span><span id="e13e" class="ki kj hi lj b fi ls lo l lp lq">export LD_LIBRARY_PATH=/usr/local/cuda- 9.0/lib64${LD_LIBRARY_PATH:+${LD_LIBRARY_PATH}}</span></pre><p id="a956" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不要忘记获取。bashrc文件中进行更改后。</p><h2 id="00bd" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">4.安装CUDNN 7.0.5</h2><p id="423a" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">去<a class="ae jd" href="https://developer.nvidia.com/cudnn" rel="noopener ugc nofollow" target="_blank">这里</a>选择cud nn 7 . 0 . 5(2017年12月5日)为CUDA 9.0。如果您还没有帐户，您需要在此处创建一个帐户。下载tar文件，并通过终端导航到它所在的位置。然后键入以下命令。</p><pre class="jf jg jh ji fd li lj lk ll aw lm bi"><span id="e0e2" class="ki kj hi lj b fi ln lo l lp lq">$ tar -xzvf cuda-9.0-linux-x64-v7.tgz<br/>$ sudo cp cuda/include/cudnn.h /ur/local/cuda/include<br/>$ sudo cp cuda cuda/lib64/libcudnn* /usr/local/cuda/lib64<br/>$ sudo chmod a+r /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib64/libcudnn* </span></pre><h2 id="70ea" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">5.安装Tensorflow GPU</h2><p id="900e" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">我假设您的系统上已经安装了anaconda。不幸的是，最新的python 3.7版本与cuda集成有一些兼容性问题。为了绕过这一点，我创建了一个新的python 3.6环境。</p><pre class="jf jg jh ji fd li lj lk ll aw lm bi"><span id="b36b" class="ki kj hi lj b fi ln lo l lp lq">$ conda create -n tfgpu python=3.6 <br/>$ conda activate tfgpu </span></pre><p id="8c4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要摆脱这种环境，只需输入conda deactivate。</p><p id="8aaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是安装tensorflow GPU版本的最后一部分。</p><pre class="jf jg jh ji fd li lj lk ll aw lm bi"><span id="4682" class="ki kj hi lj b fi ln lo l lp lq">$ conda install tensorflow-gpu==1.12 cudatoolkit==9.0 cudnn==7.1.2 h5py</span></pre><p id="d369" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装此安装附带的所有依赖项。如果一切顺利，基本上我们就完成了！该检查安装了。</p><pre class="jf jg jh ji fd li lj lk ll aw lm bi"><span id="367b" class="ki kj hi lj b fi ln lo l lp lq">$ python<br/>&gt;&gt;&gt; import tensorflow as tf <br/>&gt;&gt;&gt; sess = tf.Session(config=tf.ConfigProto(log_device_placement=True))<br/>2019-04-24 21:57:54.300645: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA<br/>2019-04-24 21:57:54.516014: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:964] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero<br/>2019-04-24 21:57:54.516685: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1432] Found device 0 with properties: <br/>name: Quadro P1000 major: 6 minor: 1 memoryClockRate(GHz): 1.5185<br/>pciBusID: 0000:01:00.0<br/>totalMemory: 3.94GiB freeMemory: 2.67GiB<br/>2019-04-24 21:57:54.516704: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1511] Adding visible gpu devices: 0<br/>2019-04-24 21:57:56.372624: I tensorflow/core/common_runtime/gpu/gpu_device.cc:982] Device interconnect StreamExecutor with strength 1 edge matrix:<br/>2019-04-24 21:57:56.372706: I tensorflow/core/common_runtime/gpu/gpu_device.cc:988]      0 <br/>2019-04-24 21:57:56.372732: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1001] 0:   N <br/>2019-04-24 21:57:56.373124: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 2370 MB memory) -&gt; physical GPU (device: 0, name: Quadro P1000, pci bus id: 0000:01:00.0, compute capability: 6.1)<br/>Device mapping:<br/>/job:localhost/replica:0/task:0/device:XLA_CPU:0 -&gt; device: XLA_CPU device<br/>/job:localhost/replica:0/task:0/device:XLA_GPU:0 -&gt; device: XLA_GPU device<br/>/job:localhost/replica:0/task:0/device:GPU:0 -&gt; device: 0, name: Quadro P1000, pci bus id: 0000:01:00.0, compute capability: 6.1<br/>2019-04-24 21:57:56.376584: I tensorflow/core/common_runtime/direct_session.cc:307] Device mapping:<br/>/job:localhost/replica:0/task:0/device:XLA_CPU:0 -&gt; device: XLA_CPU device<br/>/job:localhost/replica:0/task:0/device:XLA_GPU:0 -&gt; device: XLA_GPU device<br/>/job:localhost/replica:0/task:0/device:GPU:0 -&gt; device: 0, name: Quadro P1000, pci bus id: 0000:01:00.0, compute capability: 6.1</span></pre><h2 id="f72e" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">6.使用GPU支持安装PyTorch</h2><p id="c574" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">由于我们已经通过安装cuda toolkit、CUDNN和python的互兼容版本完成了繁重的工作，安装PyTorch就变成了一行任务。</p><pre class="jf jg jh ji fd li lj lk ll aw lm bi"><span id="bb73" class="ki kj hi lj b fi ln lo l lp lq">$ conda install pytorch torchvision cuda90 -c pytorch<br/>$ python <br/>&gt;&gt;&gt; import torch <br/>&gt;&gt;&gt; torch.cuda.get_device_name(0)<br/>'Quadro P1000'<br/>&gt;&gt;&gt; torch.cuda.is_available()<br/>True<br/>&gt;&gt;&gt; torch.cuda.device_count()<br/>1<br/>&gt;&gt;&gt;</span></pre></div></div>    
</body>
</html>