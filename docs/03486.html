<html>
<head>
<title>Paraphrase A Bad Code Through Refactoring</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过重构改写一段糟糕的代码</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/paraphrase-a-bad-code-through-refactoring-1dbee39b9de2?source=collection_archive---------64-----------------------#2021-06-08">https://medium.com/geekculture/paraphrase-a-bad-code-through-refactoring-1dbee39b9de2?source=collection_archive---------64-----------------------#2021-06-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/165b4d515600e411f33cc22ceaac1b65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6hujCVcRZ9iK9YMwC-p3_g.png"/></div></div></figure><blockquote class="iq"><p id="53c0" class="ir is hi bd it iu iv iw ix iy iz ja dx translated">他的文章是为PPL CSUI 2021撰写的个人评论的一部分</p></blockquote><p id="0970" class="pw-post-body-paragraph jb jc hi jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ja hb bi translated">写代码成为软件工程师的一种习惯。在编写代码时，我经常会查看另一个示例代码。当我不知道代码在做什么时，这很烦人。然后我想，是我的代码惹到别人了吗？</p><p id="5a8f" class="pw-post-body-paragraph jb jc hi jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hb bi translated">为了减轻我心中的不安全感，我试图在我的开发过程中编写“干净的代码”。我写了一篇关于<a class="ae kd" rel="noopener" href="/geekculture/how-i-clean-my-code-90d1f0ea0175">干净代码</a>的文章，你可以看看。文章中提到的东西已经被我实现了。但是，如果代码不够干净怎么办？</p><p id="b73c" class="pw-post-body-paragraph jb jc hi jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hb bi translated">来了<strong class="jd hj">重构</strong>拯救你的一天！</p><blockquote class="ke kf kg"><p id="99af" class="jb jc kh jd b je jy jg jh ji jz jk jl ki ka jo jp kj kb js jt kk kc jw jx ja hb bi translated">重构是一个改进代码的系统化过程，不需要创建新的功能来将混乱的代码转化为干净的代码和简单的设计。<br/> —重构古鲁</p></blockquote><p id="f6ad" class="pw-post-body-paragraph jb jc hi jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hb bi translated">根据上面的定义，我们可以简化重构，使用<strong class="jd hj">使代码更干净</strong> <strong class="jd hj">，而不改变它们之前拥有的功能</strong>。</p><h1 id="49d1" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">我通常如何重构代码</h1><p id="6e06" class="pw-post-body-paragraph jb jc hi jd b je lj jg jh ji lk jk jl jm ll jo jp jq lm js jt ju ln jw jx ja hb bi translated">在我目前的软件工程项目(SISIDANG)中，我应该优先交付给定任务的功能，而不是用干净的代码编写它。这是因为我和我的团队在开发过程中使用了敏捷方法。偶尔我会写满“代码味”的代码</p><p id="d962" class="pw-post-body-paragraph jb jc hi jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hb bi translated">例如，下面的代码将名为“place”的属性转换为特定的字符串。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="1f14" class="lx km hi lt b fi ly lz l ma mb">def extract_place(place):<br/>    if '.' in place:<br/>        temp1 = place.split('.')<br/>        if temp1[0] == '1':<br/>            temp1[0] = 'A'<br/>        elif temp1[0] == '2':<br/>            temp1[0] = 'B'<br/>        elif temp1[0] == '3':<br/>            temp1[0] = 'C'</span><span id="5260" class="lx km hi lt b fi mc lz l ma mb">place = 'Ruang ' + place + ' Gd. ' + temp1[0] + ' lt ' + temp1[1][0]<br/>    elif 'None' in place:<br/>        place = 'to be informed'<br/>    return place</span></pre><p id="42a0" class="pw-post-body-paragraph jb jc hi jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hb bi translated">代码<strong class="jd hj">包含许多可以<strong class="jd hj">简化</strong>的条件</strong>。除此之外，变量<strong class="jd hj"> temp1 </strong>并不能让我们更好地理解代码。字符串格式可以调整到更好的版本。这是重构阶段的结果。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="fe95" class="lx km hi lt b fi ly lz l ma mb">from collections import defaultdict<br/>BUILDINGS = defaultdict(<br/>    lambda: '',<br/>    {<br/>        '1': 'A',<br/>        '2': 'B',<br/>        '3': 'C'<br/>    }<br/>)</span><span id="6d5a" class="lx km hi lt b fi mc lz l ma mb">def extract_place(place):<br/>    res = place<br/>    if '.' in place:<br/>        place_detail = place.split('.')<br/>        res = 'Ruang {} Gd. {} lt {}'.format(<br/>            place, BUILDINGS[place_detail[0]], place_detail[1][0]<br/>        )<br/>    elif 'None' in place:<br/>        res = 'to be informed'<br/>    return res</span></pre><p id="44bf" class="pw-post-body-paragraph jb jc hi jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hb bi translated">重构的一些关键点</p><ul class=""><li id="2230" class="md me hi jd b je jy ji jz jm mf jq mg ju mh ja mi mj mk ml bi translated">创建特定的字典有助于减少不堪重负的条件语句</li><li id="4d06" class="md me hi jd b je mm ji mn jm mo jq mp ju mq ja mi mj mk ml bi translated">美化字符串格式，使其更易于阅读</li><li id="c518" class="md me hi jd b je mm ji mn jm mo jq mp ju mq ja mi mj mk ml bi translated">我通常不会改变任何参数。相反，我把它复制到其他变量，这样参数就保持了整个方法不变</li><li id="83db" class="md me hi jd b je mm ji mn jm mo jq mp ju mq ja mi mj mk ml bi translated">变量名更改以增加可读性</li></ul><p id="4702" class="pw-post-body-paragraph jb jc hi jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hb bi translated">这是我在任务实现阶段的一段代码。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="821c" class="lx km hi lt b fi ly lz l ma mb">def set_image_dpi(self, image, dpi=72):<br/>    image_resize = image<br/>    file = tempfile.NamedTemporaryFile(delete=False, suffix='.png')<br/>    filename = file.name<br/>    image_resize.save(filename, dpi=(dpi, dpi))<br/>    return filename</span></pre><p id="2281" class="pw-post-body-paragraph jb jc hi jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hb bi translated">上面的代码改变了图像的DPI，并将它存储在一个临时文件中。需要对代码进行一些小的调整。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="452d" class="lx km hi lt b fi ly lz l ma mb">def set_image_dpi(self, image, dpi=72):<br/>    temp_file = tempfile.NamedTemporaryFile(delete=False, suffix='.png')<br/>    temp_filename = temp_file.name<br/>    image.save(temp_filename, dpi=(dpi, dpi))<br/>    return temp_filename</span></pre><p id="bad6" class="pw-post-body-paragraph jb jc hi jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hb bi translated">我对代码所做的修改是:</p><ul class=""><li id="2c13" class="md me hi jd b je jy ji jz jm mf jq mg ju mh ja mi mj mk ml bi translated">移除image_resize，因为它什么也没做。</li><li id="cd39" class="md me hi jd b je mm ji mn jm mo jq mp ju mq ja mi mj mk ml bi translated">变量命名更改。当我再次阅读代码时，我被变量file和filename弄糊涂了。我认为这是一个原始图像文件，尽管它是一个临时文件</li></ul><h2 id="2bc4" class="lx km hi bd kn mr ms mt kr mu mv mw kv jm mx my kz jq mz na ld ju nb nc lh nd bi translated">进行重构的好处</h2><p id="8a18" class="pw-post-body-paragraph jb jc hi jd b je lj jg jh ji lk jk jl jm ll jo jp jq lm js jt ju ln jw jx ja hb bi translated">以下几点是我和我的团队从重构中得到的东西:</p><ul class=""><li id="718a" class="md me hi jd b je jy ji jz jm mf jq mg ju mh ja mi mj mk ml bi translated">让代码更干净。其他人和我可以很容易地阅读代码</li><li id="8219" class="md me hi jd b je mm ji mn jm mo jq mp ju mq ja mi mj mk ml bi translated">降低代码的复杂性</li><li id="74f7" class="md me hi jd b je mm ji mn jm mo jq mp ju mq ja mi mj mk ml bi translated">更易于维护</li><li id="e32f" class="md me hi jd b je mm ji mn jm mo jq mp ju mq ja mi mj mk ml bi translated">当需要查看旧代码时，提高生产率</li></ul></div><div class="ab cl ne nf gp ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="hb hc hd he hf"><h1 id="420d" class="kl km hi bd kn ko nl kq kr ks nm ku kv kw nn ky kz la no lc ld le np lg lh li bi translated">结论</h1><p id="3786" class="pw-post-body-paragraph jb jc hi jd b je lj jg jh ji lk jk jl jm ll jo jp jq lm js jt ju ln jw jx ja hb bi translated">进行重构有助于我和其他人更好地理解代码。除此之外，您编写代码的效率会更高。</p><h1 id="01f2" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">参考</h1><ol class=""><li id="7414" class="md me hi jd b je lj ji lk jm nq jq nr ju ns ja nt mj mk ml bi translated"><a class="ae kd" href="https://refactoring.guru/refactoring" rel="noopener ugc nofollow" target="_blank">https://refactoring.guru/refactoring</a></li></ol></div></div>    
</body>
</html>