<html>
<head>
<title>Two Weapons to Instantly Buff Your R Coding Power-Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">两种武器，立即缓冲你的R编码能力-第1部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/two-weapons-to-instantly-buff-your-r-coding-power-part-1-79446ddb8cd0?source=collection_archive---------17-----------------------#2021-05-01">https://medium.com/geekculture/two-weapons-to-instantly-buff-your-r-coding-power-part-1-79446ddb8cd0?source=collection_archive---------17-----------------------#2021-05-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/69c3e6083993b11d51c2e6d60288b695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8LbznaQVUYTKdq4sB6AczQ.jpeg"/></div></div></figure><p id="7f95" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">是的，没错。R初学者可以通过掌握两件事来快速升级自己的R编程能力:管道操作(%&gt;%)和自己编写函数，用于绘图、数据角力、回归结果提取等等。</p><p id="dfbe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设你刚刚开始学习如何在工作中使用R——就像我的一些MBA学生一样，他们第一次从我这里听说了MSE，现在你很高兴在R-Studio中编写代码，例如，运行基于逻辑回归的分类。在这种情况下，是时候加速你的R编码技能了。我的意思是用更简单、更短、更清晰、更少错误、更易理解的代码来做同样的工作。除非你通过你写的代码行获得报酬，否则你应该认真考虑遵循这篇文章和下一篇文章告诉你要做的事情。它们将显著提高你的编码技术。</p><p id="676d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇文章是关于使用pipe的，这是由两个包<em class="jp"> dplyr </em>和<em class="jp"> tidyr </em>共同支持的一系列操作。像往常一样，我将重点关注一些最常见的操作场景。</p><p id="289b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">什么是管道操作？从一个数据帧开始作为初始输入，管道操作使用上一个操作的结果作为下一个操作的输入，并继续下去，直到得到想要的结果(例如..修改的数据帧，绘图)。管道符号%&gt;%像管道一样连接操作，使数据流顺畅，而不会创建临时输出。</p><h2 id="0948" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated"><em class="kl">数据框操作</em></h2><p id="e457" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">首先，我们用一个简单的例子来说明管道操作。使用钻石数据，选择4c和price，保留价格&gt; 10000，克拉大于1的钻石，计算价格/克拉的比值作为一个新的变量，创建一个新的dataframe，命名为big.stone.df来存储这五个变量。如果不使用管道，您可能会编写这样的代码</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="5002" class="jq jr hi kw b fi la lb l lc ld">data("diamonds",package="ggplot2")<br/>df1=diamonds[,c("carat","cut","clarity","color","price")]<br/>big.stone.df<!-- -->=<!-- -->df1[df1$price&gt;10000&amp;df1$carat&gt;1,]<br/>big.stone.df<!-- -->$ratio=<!-- -->big.stone.df<!-- -->$carat/<!-- -->big.stone.df<!-- -->$price</span></pre><p id="72b0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">或者您可以使用<em class="jp"> names </em>命令来获取列id并直接引用id。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="f209" class="jq jr hi kw b fi la lb l lc ld">names(data)<br/>df1=diamonds[,c(1:4,7)]</span></pre><p id="1441" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用管道，它只是一条线。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="764e" class="jq jr hi kw b fi la lb l lc ld">diamonds%&gt;%select(c(1:4,7))%&gt;% filter(price&gt;10000&amp;carat&gt;1) %&gt;% mutate(ratio=carat/price)-&gt;big.stone.df</span></pre><p id="abd5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，将操作结果分配给新数据帧的参数可以放在开头。我更喜欢=而不是-&gt;。同样的结果。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="0b73" class="jq jr hi kw b fi la lb l lc ld">big.stone.df=diamonds%&gt;% select(c(1:4,7)) %&gt;% filter(price&gt;10000&amp;carat&gt;1) %&gt;% mutate(ratio=carat/price)</span></pre><p id="991d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">仅供参考，管道操作允许您轻松地调试代码，以查看“堵塞”在哪里。从头开始，您可以逐个管道地选择要执行代码的部分，如下所示。</p><figure class="kr ks kt ku fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es le"><img src="../Images/d5bfcd9161ee2c20e0444a36be758044.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O1xKQMjHgbhvfalTXKHeJA.jpeg"/></div></div></figure><p id="f63b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">FYII，注意示例中使用的那些函数，<em class="jp">选择</em>修剪列，<em class="jp">过滤</em>修剪行。<em class="jp">突变</em>添加列。这三个函数可能是管道操作中最常用的。</p><p id="6884" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">自己练。如果我想如下修剪数据帧:添加一个ID列，它只是数据帧中的行ID，然后只保留x，y，z(是的，diamonds数据中的最后三列称为x，y和z)，并保留x &gt; 5或y的行&lt; 6. How to write the code?</p><h2 id="838f" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated">Data wrangling using pipe</h2><p id="3087" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">The following example is to create pivot-table alike output using pipe. I used a pipe example in my first <a class="ae jo" rel="noopener" href="/geekculture/employing-r-to-serve-excel-spreadsheet-pivot-table-generation-multiple-worksheets-creation-and-6a01751dd767#8bcb-69b2d35433d2">中的文章</a>关于挂钩R和Excel，我收到了几个查询。以下是方法。假设我们想知道钻石数据中每种颜色的平均价格和平均克拉数。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="9270" class="jq jr hi kw b fi la lb l lc ld">diamonds %&gt;% group_by(color) %&gt;% summarize(mean.carat=mean(carat),mean.price=mean(price))</span></pre><p id="4747" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用<em class="jp"> group_by </em>应用“分组”功能，然后<em class="jp">汇总</em>计算功能。<em class="jp">表示</em>可以被你选择的其他统计函数代替(<em class="jp">中值</em>、<em class="jp">标清</em>)。</p><p id="9503" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您想获得每个子组中的频率/计数，</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="75c1" class="jq jr hi kw b fi la lb l lc ld">diamonds %&gt;% group_by(color) %&gt;% count(color)<br/>diamonds %&gt;% group_by(color) %&gt;% summarize(freq=n())</span></pre><p id="cd57" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面两行是等价的。</p><p id="37fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您想计算每个切割和颜色组合，有多少钻石，只需将切割添加到<em class="jp"> group_by </em>参数中。请注意，任何未添加到<em class="jp"> group_by </em>中的变量都将从输出中删除。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="b203" class="jq jr hi kw b fi la lb l lc ld">diamonds %&gt;% group_by(color,cut) %&gt;% summarize(freq=n())</span></pre><p id="b59d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是一个“长形状”的数据；使用<em class="jp">展开</em>或<em class="jp"> pivot_wider </em>功能，您可以将其转换为“宽形状”关于long和wide数据类型的详细解释和操作，请参见本文。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="2429" class="jq jr hi kw b fi la lb l lc ld">diamonds %&gt;% group_by(color,cut) %&gt;% summarize(freq=n()) %&gt;% pivot_wider(names_from=cut,values_from=freq,values_fill=0)</span></pre><p id="33d1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面的例子说明了管道操作的便利性:只需为新的操作添加另一个管道。结果可以通过在末尾添加<em class="jp"> - &gt; dataframe.name </em>保存到数据帧中。</p><h2 id="627b" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated">焊接和配管</h2><p id="9890" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">第三个例子是管道到地块。假设我们要为随机抽样的3000克拉创建一个价格和克拉的散点图，用不同的切工着色，并添加一条模拟回归线来拟合数据。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="236f" class="jq jr hi kw b fi la lb l lc ld">set.seed(450)<br/>diamonds %&gt;% sample_n(3000) %&gt;% <br/>  ggplot()+<br/>  geom_point(aes(x=carat,y=price,color=cut)) +  geom_smooth(aes(x=carat,y=price),color="sandybrown",method="lm",se=T)</span></pre><p id="1fa9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我使用一个简单的ggplot来说明管道操作。处理后，数据被用作<em class="jp"> ggplot </em>()中的输入。剩下的都是ggplot演练。您可以像处理普通ggplot编码一样，将其他绘图元素和美学样式添加到绘图中。</p><figure class="kr ks kt ku fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lf"><img src="../Images/eb15a56fca781afddf2201a6f5c81bed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RDFDE42855LFDviXI1aUHQ.png"/></div></div></figure><p id="5308" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">FYIII，<em class="jp"> sample_n </em>是在管道作业中创建随机样本的一种便捷方式。<em class="jp"> set.seed(450) </em>是为了保证每次你都得到相同的随机样本，这样你就可以复制你的结果。</p><h2 id="6e8e" class="jq jr hi bd js jt ju jv jw jx jy jz ka jb kb kc kd jf ke kf kg jj kh ki kj kk bi translated"><span class="l lg lh li bm lj lk ll lm ln di">P</span>T34】iping出回归结果</h2><p id="1f38" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">最后一个例子是用管道输出回归结果。假设我想研究所选钻石的价格与x，y，z的线性关系，只需要系数估计和p值。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="b03d" class="jq jr hi kw b fi la lb l lc ld">set.seed(450)<br/>diamonds %&gt;% sample_n(3000) %&gt;% filter(carat&gt;1|color=="E") %&gt;% lm(price~x+y+z,data=.)</span></pre><p id="1987" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以上是我们最初尝试的代码。我们直接使用<em class="jp"> lm </em>函数。注意，<em class="jp"> lm </em>函数中的<em class="jp">数据</em>自变量:<em class="jp">数据=。</em></p><p id="24ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个。就是替换输入。管道操作最适合接受输入作为第一个参数的函数。例如<em class="jp">选择(数据，列名)</em>，<em class="jp">过滤(数据，条件)</em>。对于其他数据参数不是第一个的函数，比如<em class="jp"> lm(formula，data)，我们用</em>。来代替管道输送的东西。您不能使用<em class="jp"> data= diamonds </em>，因为传递给lm的不是原始的diamond数据。</p><p id="4076" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以通过在管道末尾添加<em class="jp"> summary </em>()来获得更详细的结果。有些人可能会满意，但仍然不是我们想要的。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="de39" class="jq jr hi kw b fi la lb l lc ld">set.seed(450)<br/>diamonds %&gt;% sample_n(3000) %&gt;% filter(carat&gt;1|color=="E") %&gt;% lm(price~x+y+z,data=.)%&gt;% summary()</span></pre><p id="8e06" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以将摘要保存为一个对象lm.sum，用它来玩。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="b57e" class="jq jr hi kw b fi la lb l lc ld">set.seed(450)<br/>diamonds %&gt;% sample_n(3000) %&gt;% filter(carat&gt;1|color=="E") %&gt;% lm(price~x+y+z,data=.)%&gt;% summary()-&gt;lm.sum</span><span id="4279" class="jq jr hi kw b fi lo lb l lc ld">lm.sum#check</span><span id="c786" class="jq jr hi kw b fi lo lb l lc ld">unlist(lm.sum$coefficients[,c(1,4)]) %&gt;% as.data.frame() %&gt;% setNames(c("Coefficient","p-value"))</span></pre><p id="4ca6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您熟悉线性回归的汇总结果，您会知道系数估计值存储在列表的第1列，p值存储在称为系数的第4列。一个简单的<em class="jp"> unlist </em>函数将它们提取出来，并再次通过管道转换成data.frame(如果你的目的是导出的话)。SetNames 帮助定制你选择的列名。</p><p id="dc86" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">FYIV。我的大数据营销课程的学生在第一天学习了管道操作。他们能做到，你也能。</p><p id="b0f6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果这篇文章让你觉得学到了什么，请继续升级到下一级:<a class="ae jo" href="https://martinqiu.medium.com/two-weapons-to-instantly-buff-your-r-coding-power-part-2-de8e95b92dc2" rel="noopener"> <strong class="is hj">第二部分构建自己的R函数</strong> </a> <strong class="is hj">。</strong></p><p id="1ef2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jp">专门介绍贸易工具的系列文章。</em></p></div></div>    
</body>
</html>