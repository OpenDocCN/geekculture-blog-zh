<html>
<head>
<title>Tasker and Fitbit Integration: tasks overview</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Tasker和Fitbit集成:任务概述</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/tasker-and-fitbit-integration-tasks-overview-4d752c027a77?source=collection_archive---------36-----------------------#2021-06-27">https://medium.com/geekculture/tasker-and-fitbit-integration-tasks-overview-4d752c027a77?source=collection_archive---------36-----------------------#2021-06-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="452d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将展示并详细解释我在故事<a class="ae jd" rel="noopener" href="/geekculture/tasker-and-fitbit-integration-4fc51d6eb186"> Tasker和Fitbit Integration </a>中描述的任务。</p><h1 id="b36d" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">检查并更新Fitbit令牌</h1><p id="20c9" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">一个概要文件和两个任务是用来完成这些操作的元素。</p><p id="2bec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该配置文件具有基于时间的简单条件。它调用<em class="kh"> Fitbit令牌检查</em>任务。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ki"><img src="../Images/d72c3e04b6d93c14ca49b1edecfba609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FRI96wcsTDR8nW3_YzYBlg.png"/></div></div></figure><p id="c5fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kh"> Fitbit令牌检查</em>任务调用Fitbit来验证存储的令牌是否仍然有效。</p><p id="c694" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该调用是对<a class="ae jd" href="https://dev.fitbit.com/build/reference/web-api/explore/#/Auth/introspect" rel="noopener ugc nofollow" target="_blank">自省API </a>的HTTP请求。请求的响应存储在<em class="kh"> %http_data </em>中，是一个具有以下结构的JSON。通过检查<em class="kh">有效</em>键的值，可以验证令牌有效性。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div class="er es ku"><img src="../Images/c6118dbfb3fe97bc7951dc6d0637cc48.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*5-chOPjq4UAeBHKTAxj5rQ.png"/></div></figure><p id="0ad4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果<em class="kh">的值为$。活动</em>为假，它显示一个具有三个动作的通知:</p><ul class=""><li id="375e" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated"><em class="kh">再试一次</em>:重新启动任务。</li><li id="6732" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><em class="kh">刷新令牌</em>:运行<em class="kh"> Fitbit刷新令牌</em>任务。</li><li id="105d" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><em class="kh">更新令牌</em>:运行<em class="kh"> Fitbit更新令牌</em>任务。</li></ul><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lj"><img src="../Images/63f6cdfcf946e46eaeca6f0ba7922ec8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ERqu9BaDf-TNsv2WBRickg.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx">In the second screenshot, the <strong class="bd jg">%fitbitAccessToken</strong> is a variable that stores the token.</figcaption></figure><p id="706f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kh"> Fitbit刷新令牌</em>任务打开带有URL的浏览器，以执行登录并获取令牌。网址如下，<em class="kh"> %fitbitClientId </em>为app <em class="kh"> clientId </em>。</p><blockquote class="lo lp lq"><p id="14b1" class="if ig kh ih b ii ij ik il im in io ip lr ir is it ls iv iw ix lt iz ja jb jc hb bi translated"><a class="ae jd" href="https://www.fitbit.com/oauth2/authorize?response_type=token&amp;client_id=%fitbitClientId&amp;scope=settings&amp;expires_in=31536000" rel="noopener ugc nofollow" target="_blank">https://www.fitbit.com/oauth2/authorize?response_type=token&amp;client _ id = % fitbitClientId&amp;scope = settings&amp;expires _ in = 31536000</a></p></blockquote><p id="2306" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kh"> Fitbit更新令牌</em>任务打开一个输入，让用户在登录后粘贴URL。然后，它拆分URL以获取令牌，并将其存储到<em class="kh"> %fitbitAccessToken </em>。它完成调用<em class="kh"> Fitbit令牌检查</em>任务。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lu"><img src="../Images/9b74a1ebb2f7c189d8d597fc386279ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qYZpHwd8Gm4TRIar6rO_lQ.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx">The first screenshot is the <strong class="bd jg"><em class="lv">Refresh Token</em></strong><em class="lv"> task; the second is the </em><strong class="bd jg"><em class="lv">Update Token</em></strong> task.</figcaption></figure><h1 id="2405" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">选择要切换的警报</h1><p id="d4b3" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated"><em class="kh"> Fitbit选择报警</em>是一个简单的任务，它查询<a class="ae jd" href="https://dev.fitbit.com/build/reference/web-api/explore/#/Devices/getAlarms" rel="noopener ugc nofollow" target="_blank">获取报警API </a>。请求的响应存储在<em class="kh"> %http_data </em>中，是一个具有以下结构的JSON。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lw"><img src="../Images/a9ce6a0b6140b3529e8e6558e77339ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hMQFieGhbZ-j7NPOuN5AeA.png"/></div></div></figure><p id="4cb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<em class="kh">$ http _ data[tracker alarms]()</em>数组上有一个用于周期的<a class="ae jd" href="https://tasker.joaoapps.com/userguide/en/flowcontrol.html" rel="noopener ugc nofollow" target="_blank">，它询问用户应该管理哪些报警。它将被管理对象的<em class="kh">报警</em>保存在<em class="kh"> %fitbitAlarms </em>数组变量中。</a></p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lw"><img src="../Images/cac1504dddf567b071454c4397f3f3e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6gTBYJ63EGLxSYiRXUbU7Q.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx">In the second screenshot, the <strong class="bd jg">%fitbitAccessToken</strong> is a variable that stores the token, and the black rectangle is the <strong class="bd jg">%fitbitDeviceId</strong>.</figcaption></figure><h1 id="d3d9" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">更新选定的警报</h1><p id="f1d0" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated"><em class="kh"> Fitbit Update Alarm </em>是一个定义是否启用或禁用告警的任务，调用<a class="ae jd" href="https://dev.fitbit.com/build/reference/web-api/explore/#/Devices/getAlarms" rel="noopener ugc nofollow" target="_blank"> Get Alarms API </a>检索告警信息，调用<a class="ae jd" href="https://dev.fitbit.com/build/reference/web-api/explore/#/Devices/updateAlarms" rel="noopener ugc nofollow" target="_blank"> Update Alarms API </a>更新告警。</p><p id="dae8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在前五个动作中，它根据条件将<em class="kh"> %fitbitAlarmEnabled </em>设置为true。第六个动作执行与前面任务相同的请求，并将输出保存在<em class="kh">% fitbitAlarmsTempResponse</em>变量中。</p><p id="aa86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在循环的<em class="kh">中，</em>第9个动作检查报警是否在<em class="kh"> %fitbitAlarms </em>数组变量中，如果是，任务更新它。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lu"><img src="../Images/0ad39e3a062e1c4e745beae411a000e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y4KwPSXmXB5SCK0fA-L-9g.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx">The project you can download in the other story does not set the <strong class="bd jg">%fitbitAlarmEnabled</strong> variable as in this screenshot. Assign the value true or false to it before calling the task.</figcaption></figure><p id="fab3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图第一张截图是第9个动作。如果报警在数组中，它会在<em class="kh"> %fitbitIndex </em>变量中将索引设置为大于0的数字。<a class="ae jd" href="https://tasker.joaoapps.com/userguide/en/variables.html" rel="noopener ugc nofollow" target="_blank">变量</a>用户指南中的<em class="kh">变量数组</em>部分详细解释了其工作原理。</p><p id="480f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第二张截图是第11个动作。它将<em class="kh">更新警报</em>调用的请求体设置为<em class="kh"> %fitbitBody </em>变量。前一幅图像中从12到14的动作使用<em class="kh">变量搜索替换</em>动作将此变量转换为<a class="ae jd" href="https://en.wikipedia.org/wiki/Percent-encoding#Reserved_characters" rel="noopener ugc nofollow" target="_blank">编码URL </a>。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lw"><img src="../Images/6141fa21cad991efa03e58a380d78e5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DMFjI3pfq4tjKLvTsajlPA.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx">In the third screenshot <strong class="bd jg"><em class="lv">%fitbitAlarms(%fitbitIndex)</em></strong><em class="lv"> stores the </em><strong class="bd jg"><em class="lv">alarmId</em></strong><em class="lv"> it is updating, </em>and the black rectangle is the <strong class="bd jg">%fitbitDeviceId</strong>.</figcaption></figure></div></div>    
</body>
</html>