<html>
<head>
<title>Info.plist based Certificate Pinning on iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS上基于Info.plist的证书锁定</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/info-plist-based-certificate-pinning-on-ios-7bd87c52c24d?source=collection_archive---------5-----------------------#2022-05-01">https://medium.com/geekculture/info-plist-based-certificate-pinning-on-ios-7bd87c52c24d?source=collection_archive---------5-----------------------#2022-05-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2e45de1e2a91dc2faf5af1eba27b1ace.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2ATSfpYr_yyG2K9o"/></div></div></figure><p id="cfba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">过去，你可能会使用第三方库，如<a class="ae jo" href="https://github.com/datatheorem/TrustKit" rel="noopener ugc nofollow" target="_blank"> TrustKit </a>或<a class="ae jo" href="https://github.com/Alamofire/Alamofire" rel="noopener ugc nofollow" target="_blank"> Alamofire </a>来保护你的应用免受<a class="ae jo" href="https://www.raywenderlich.com/1484288-preventing-man-in-the-middle-attacks-in-ios-with-ssl-pinning" rel="noopener ugc nofollow" target="_blank">中间人攻击</a>，因为这些库支持SSL公钥锁定。</p><p id="fdeb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可能不知道，苹果在iOS 14 🥳中引入了对SSL公钥锁定的原生支持</p><p id="b3ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你不熟悉这个原生功能，我推荐你阅读苹果的文章<a class="ae jo" href="https://developer.apple.com/news/?id=g9ejcf8y" rel="noopener ugc nofollow" target="_blank">身份锁定:如何为你的应用配置服务器证书</a>。以下是总结:</p><ul class=""><li id="660f" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">您可以在您的<code class="du jy jz ka kb b">Info.plist</code>中指定一组证书，App Transport Security (ATS)在连接到命名域时会用到这些证书。</li><li id="a26a" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated">固定的CA公钥必须出现在证书链中的中间证书或根证书中</li><li id="f2cf" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated">pin码始终与一个域名相关联，除非满足pin码要求，否则应用程序将拒绝连接到该域名。</li><li id="40ef" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated">您可以将多个公钥与一个域名相关联。</li></ul><p id="7982" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这种内置的锁定对<code class="du jy jz ka kb b">URLSession</code>很有效，但是<strong class="is hj">对</strong> <code class="du jy jz ka kb b"><strong class="is hj">CFNetwork</strong></code>之上的所有API都有效吗？</p><p id="729c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可悲的事实是<strong class="is hj">没有</strong>。😔</p><p id="8a9c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果SSL公钥与<code class="du jy jz ka kb b">Info.plist</code>中指定的不一致，则<code class="du jy jz ka kb b">WKWebView</code>仍将连接并从域中加载内容。</p><p id="721d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du jy jz ka kb b">SFSafariViewController</code>也不支持<code class="du jy jz ka kb b">Info.plist</code>中的设置。考虑到<code class="du jy jz ka kb b">SFSafariViewController</code> <a class="ae jo" href="https://developer.apple.com/videos/play/wwdc2015-504/?time=494" rel="noopener ugc nofollow" target="_blank">在一个单独的进程</a>中运行，这种行为可能不那么令人惊讶。</p><p id="fcd5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我在各种版本上测试了这些API，包括最新的iOS 15.4。</p><figure class="kh ki kj kk fd ij"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="485c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以用我开源的一个测试应用来验证我的观察。</p><div class="kn ko ez fb kp kq"><a href="https://github.com/MarcoEidinger/TestingNSPinnedDomains" rel="noopener  ugc nofollow" target="_blank"><div class="kr ab dw"><div class="ks ab kt cl cj ku"><h2 class="bd hj fi z dy kv ea eb kw ed ef hh bi translated">GitHub-MarcoEidinger/TestingNSPinnedDomains:测试SSL锁定的应用程序(NSPinnedDomains，iOS 14+)</h2><div class="kx l"><h3 class="bd b fi z dy kv ea eb kw ed ef dx translated">测试SSL锁定的应用程序(NSPinnedDomains，iOS 14+)测试NSPinnedDomains.mov苹果承认WKWebView的错误…</h3></div><div class="ky l"><p class="bd b fp z dy kv ea eb kw ed ef dx translated">github.com</p></div></div><div class="kz l"><div class="la l lb lc ld kz le io kq"/></div></div></a></div><p id="4bd6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">苹果的<a class="ae jo" href="https://developer.apple.com/forums/thread/681734" rel="noopener ugc nofollow" target="_blank">回答并不令人满意</a>，因为还不清楚哪些API应该遵守<code class="du jy jz ka kb b">Info.plist</code>中指定的证书。</p><p id="b10b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我相信基于<code class="du jy jz ka kb b">NSPinnedDomains</code>的SSL pinning应该可以自动与所有基于CFNetwork的API一起工作，比如</p><ul class=""><li id="08da" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated"><code class="du jy jz ka kb b">URLSession</code></li><li id="1226" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated"><code class="du jy jz ka kb b">WKWebView</code>。</li><li id="d354" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated"><code class="du jy jz ka kb b">SFSafariViewController</code></li><li id="28cf" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated"><code class="du jy jz ka kb b">ASWebAuthenticationSession</code></li></ul><p id="dccf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">也许有一天…</p></div><div class="ab cl lf lg gp lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hb hc hd he hf"><p id="af38" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lm">最初发布于</em><a class="ae jo" href="https://blog.eidinger.info/infoplist-based-certificate-pinning-on-ios" rel="noopener ugc nofollow" target="_blank"><em class="lm">https://blog . ei dinger . info</em></a><em class="lm">。</em></p></div></div>    
</body>
</html>