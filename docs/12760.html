<html>
<head>
<title>Designing a Revolutionary Web App 👊</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设计革命性的网络应用👊</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/designing-a-revolutionary-web-app-d602494c221?source=collection_archive---------2-----------------------#2022-05-30">https://medium.com/geekculture/designing-a-revolutionary-web-app-d602494c221?source=collection_archive---------2-----------------------#2022-05-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a26199f937b95fd2e620cf713b0410f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jWt5DdbMcMDJXAofzqoUcA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">The landing page2</figcaption></figure><p id="d528" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">2021年10月25日，苏丹军方在一次军事政变中控制了政府。在此之前，许多苏丹人死于抗议，在50度的高温下静坐数小时，希望有一个更好的政府。可悲的是，政变破坏了大部分工作。</p><p id="e3c3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我想做点什么来帮助他们，所以我开发了一个网络应用来保存苏丹革命艺术<a class="ae js" href="https://sudan-art.com" rel="noopener ugc nofollow" target="_blank">https://sudan-art.com</a>。代码是开源的，现在还处于早期阶段，所以欢迎投稿🔥！</p><p id="02c4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">去年，我在缅甸的反政变抵抗运动中做了很多工作。我注意到抗议运动是如何迅速地淡出新闻，以及将革命艺术和材料存档是多么困难。然后我发现了一个叫做https://threefingers.org<a class="ae js" href="https://threefingers.org" rel="noopener ugc nofollow" target="_blank">的神奇网站，那里收集了大量杰出的缅甸艺术品，所以我决定做一些类似的事情。</a></p><p id="787a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我认为这些是需要解决的重要问题。保持在新闻中的存在保持了对非法政府的国际压力。在我看来，将艺术存档有助于提醒人们一场革命确实发生了。苏丹许多描绘革命的壁画已经被抹去。许多缅甸革命者被逮捕或者更糟。</p><p id="99da" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一路上，我学到了不少有趣的东西。我将把它们分成三篇不同的博文，按照编程领域和堆栈进行组织:</p><p id="6f7a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="jt"> Python &amp; Django —第一部</em></p><ol class=""><li id="894b" class="ju jv hi iw b ix iy jb jc jf jw jj jx jn jy jr jz ka kb kc bi translated">如何通过减小图像的文件大小和剥离元数据来正确地预处理图像以便上传；</li><li id="bbb3" class="ju jv hi iw b ix kd jb ke jf kf jj kg jn kh jr jz ka kb kc bi translated">如何接受上传图片100%安全是不可能的，如何管理随之而来的风险；</li><li id="f466" class="ju jv hi iw b ix kd jb ke jf kf jj kg jn kh jr jz ka kb kc bi translated">如何为处理图像上传的Django视图编写测试；</li></ol><p id="2cde" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae js" rel="noopener" href="/geekculture/designing-a-revolutionary-web-app-part-ii-a9b9356143a6"> <em class="jt"> JavaScript/React —第二部分</em> </a></p><ol class=""><li id="c46a" class="ju jv hi iw b ix iy jb jc jf jw jj jx jn jy jr jz ka kb kc bi translated">如何避免布局偏移，并在页面完全加载后只显示一整页的图片；</li><li id="9992" class="ju jv hi iw b ix kd jb ke jf kf jj kg jn kh jr jz ka kb kc bi translated">或者，如何显示图像的占位符，使它们在加载前看起来不错；</li><li id="2ec5" class="ju jv hi iw b ix kd jb ke jf kf jj kg jn kh jr jz ka kb kc bi translated">如何设计一个简洁的图像标签组件；</li></ol><p id="615d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae js" rel="noopener" href="/geekculture/designing-a-revolutionary-web-app-part-iii-bb228d550897"><em class="jt">devo PS/数字海洋—第三部分</em> </a></p><p id="a4ec" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，如果你想花100美元试用数字海洋60天，点击<a class="ae js" href="https://m.do.co/c/914e910aa17b" rel="noopener ugc nofollow" target="_blank">这个</a>链接。</p><ol class=""><li id="a81e" class="ju jv hi iw b ix iy jb jc jf jw jj jx jn jy jr jz ka kb kc bi translated">如何使用docker compose为MVP部署到数字海洋；</li><li id="0056" class="ju jv hi iw b ix kd jb ke jf kf jj kg jn kh jr jz ka kb kc bi translated">如何在使用反向代理服务器的安全生产部署中服务Django/React with NGINX；</li><li id="e0ea" class="ju jv hi iw b ix kd jb ke jf kf jj kg jn kh jr jz ka kb kc bi translated">如何设置一个简单的Github actions工作流来自动化代码林挺、测试和部署的CI/CD管道。</li></ol><h1 id="d8d0" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">第一部分</h1><h2 id="1ec8" class="lg kj hi bd kk lh li lj ko lk ll lm ks jf ln lo kw jj lp lq la jn lr ls le lt bi translated">如何通过减小文件大小和剥离元数据来正确地预处理图像以便上传</h2><p id="f992" class="pw-post-body-paragraph iu iv hi iw b ix lu iz ja jb lv jd je jf lw jh ji jj lx jl jm jn ly jp jq jr hb bi translated">在开发这个应用的时候，我很快意识到在后端正确地预处理图像是非常重要的。从前端开发人员的角度来看，图像占据了巨大的空间。</p><p id="fdec" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一张图片甚至可能花费你整个代码库甚至更多的下载时间。所以我认为尽可能减小文件大小是个好主意。</p><p id="ead2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然而，图像被过度压缩后看起来并不太好。所以我也决定在我网站的数据库中保存一张高分辨率的图片，让用户下载，这是一个好主意。</p><p id="ad70" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我在这里遇到的最后一个问题是净化上传。默认设置下的现代DSLR的图像包含了惊人的元数据量。我觉得这一点特别重要，因为我网站上的大多数图片都是政治性和批判性的。</p><p id="7e8d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以，我是这样解决这些问题的:</p><figure class="lz ma mb mc fd ij"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="d8a9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里发生的事情还真不少！如果你看一下第34行的save函数，它覆盖了属于我的<code class="du mf mg mh mi b">Artwork</code>类继承的<code class="du mf mg mh mi b">models.Model</code>类的<code class="du mf mg mh mi b">save</code>方法。</p><p id="0552" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这很方便，因为这意味着每当我将一些数据保存到视图中的数据库时，就会运行这段代码。因此，我在这里做了一些预处理，确保每张图片都经过了第45行定义的<code class="du mf mg mh mi b">reduce_image_size</code>函数。</p><p id="3e79" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">该函数创建一个缩略图，并通过将图像读入字节流，然后再次保存到文件中来剥离所有图像元数据。它通过创建一个来自django核心库的新的<code class="du mf mg mh mi b">File</code>对象来做到这一点，因此它与我在<code class="du mf mg mh mi b">Artwork</code>类中定义的<code class="du mf mg mh mi b">ImageField</code>很好地配合。</p><p id="aac8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">到下一个…</p><h2 id="d2b8" class="lg kj hi bd kk lh li lj ko lk ll lm ks jf ln lo kw jj lp lq la jn lr ls le lt bi translated">如何接受上传图片100%安全是不可能的，如何管理随之而来的风险</h2><p id="0047" class="pw-post-body-paragraph iu iv hi iw b ix lu iz ja jb lv jd je jf lw jh ji jj lx jl jm jn ly jp jq jr hb bi translated">很难完美地保护图像。因为你的用户正在上传一个不同类型的大文件，这就有了一个巨大的攻击面。因此，很难用自己的测试套件真正正确地验证图像。</p><p id="08a3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我知道有些人做的一件事是旋转一个容器，用杀毒产品扫描里面的文件，然后杀死这个容器。我认为这是一个好主意，但这是一个很大的工程开销…你可能会希望这是异步的，并需要想出一种方法来做芹菜任务或类似的事情。</p><p id="ce13" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我并不是说这是个坏主意，但对于这个更像是爱好的小型个人项目来说，这实在是太多的工作了。因此，我选择只依赖Django的<code class="du mf mg mh mi b">ImageField</code>内置验证，然后将图像存储在数字海洋空间中，与我的应用程序的其余部分分开。这一点很重要，因为这意味着攻击者无法从上传的图像转到运行我的web应用程序的环境中——相反，他们会被困在数字海洋空间中😜</p><p id="8ad8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以，这就是你在上面第21-30行看到的。如果我在本地运行应用程序，那么<code class="du mf mg mh mi b">settings.DEBUG</code>将为真，所以我不需要这样做。但是如果我在生产中运行它，我已经在数字海洋中配置了使用S3桶的东西。</p><p id="40ee" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这利用了Django storages，这里有一些关于数字海洋<a class="ae js" href="https://django-storages.readthedocs.io/en/latest/backends/digital-ocean-spaces.html" rel="noopener ugc nofollow" target="_blank">配置的细节</a>。我用它在这里创建了存储类，这就是上面定义中的<code class="du mf mg mh mi b">PublicMediaStorage</code>所指的。</p><figure class="lz ma mb mc fd ij"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="e246" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要做到这一点，你需要在你的应用程序的<code class="du mf mg mh mi b">settings.py</code>中配置一些其他的东西，但是这些在Digital Ocean的文档中有详细的描述。</p><p id="a8b9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因为我使用Django Rest框架为这个服务构建了一个后端api，所以您需要在视图中做一些事情来确保您的图片上传实际上使用了Django的<code class="du mf mg mh mi b">ImageField</code>。这对于rest框架来说非常好。</p><p id="f2bb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你有一个这样的<code class="du mf mg mh mi b">views.py</code>:</p><figure class="lz ma mb mc fd ij"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="72f9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后，这将为您的模型使用一个序列化程序，您可以在<code class="du mf mg mh mi b">serializers.py</code>中这样定义:</p><figure class="lz ma mb mc fd ij"><div class="bz dy l di"><div class="md me l"/></div></figure><h2 id="a8d5" class="lg kj hi bd kk lh li lj ko lk ll lm ks jf ln lo kw jj lp lq la jn lr ls le lt bi translated">如何为处理图像上传的Django视图编写测试</h2><p id="ac60" class="pw-post-body-paragraph iu iv hi iw b ix lu iz ja jb lv jd je jf lw jh ji jj lx jl jm jn ly jp jq jr hb bi translated">最后但并非最不重要的是，一旦这些都完成了，就该写一些测试了！但是对于涉及图片上传的Django视图，如何做到这一点呢？</p><p id="6d04" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">像这个☺️:</p><figure class="lz ma mb mc fd ij"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="9bdb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我在这里做的第一件事是创建一个基类，我可以在编写其他测试时继承它。这只是使用我在测试文件夹中获得的样本图像向数据库添加一个对象，然后从<code class="du mf mg mh mi b">settings.MEDIA_ROOT</code>值中删除所有内容，该值是存储所有图像的文件夹。</p><p id="ba6d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一旦完成，上传图片并测试它是否被添加到数据库就变得非常简单了，因为Django实际上使用数据库进行测试，所以没有必要模仿所有的东西。</p><p id="c2eb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了更容易运行测试，我喜欢做的一件事是为测试创建一个单独的<code class="du mf mg mh mi b">settings.py</code>,以便它们在内存sql lite数据库上运行。如果您在应用程序中使用大量postgres之类的语法，这可能不起作用，但如果起作用，那么这是很方便的，因为这意味着您不需要为运行标准Django测试套件设置任何类型的数据库。</p><p id="d5a1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">看起来是这样的:</p><figure class="lz ma mb mc fd ij"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="85e8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后您可以用<code class="du mf mg mh mi b">python manage.py test --settings=&lt;path to test_settings.py</code>调用测试。</p><p id="a263" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在你知道了！</p></div></div>    
</body>
</html>