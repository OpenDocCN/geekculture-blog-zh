<html>
<head>
<title>Tasker and Telegram integration: live location</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Tasker和电报集成:现场位置</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/tasker-and-telegram-integration-live-location-e375c71da882?source=collection_archive---------8-----------------------#2021-07-16">https://medium.com/geekculture/tasker-and-telegram-integration-live-location-e375c71da882?source=collection_archive---------8-----------------------#2021-07-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d37d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个故事中，我将整合任务以共享您在<a class="ae jd" rel="noopener" href="/geekculture/tasker-and-telegram-integration-278c53ab1d00?sk=3dd91b2aa2ebaf534c0688dc9d0a9335"> Tasker中显示的位置，并将电报整合</a>改为发送实时位置。</p><p id="de0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要理解的基本事情是，机器人不能自己更新实时位置。任务不得不做。</p><h1 id="1ea3" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">电报机器人API</h1><p id="879e" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">您可以在下面的<a class="ae jd" href="https://core.telegram.org/bots/api#available-methods" rel="noopener ugc nofollow" target="_blank">可用方法</a>页面上找到所有使用的API。</p><p id="9b36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下任务中的<em class="kh"> %par1 </em>是聊天标识。看了开头链接的文章就明白怎么弄了。</p><h2 id="8cec" class="ki jf hi bd jg kj kk kl jk km kn ko jo iq kp kq js iu kr ks jw iy kt ku ka kv bi translated">方法发送位置</h2><p id="4080" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">调用<a class="ae jd" href="https://core.telegram.org/bots/api#sendlocation" rel="noopener ugc nofollow" target="_blank"> sendLocation </a>具有可选参数<em class="kh"> live_period </em>，允许我们通过指定60 (1分钟)和86400 (24小时)之间的正数秒数来发送实时位置。</p><p id="fe69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面的截图中，可以看到调用这个方法的任务。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es kw"><img src="../Images/4c247cb630d8080506797c724ff8ee4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5dII9pde9U0jrUIPTpSEhg.png"/></div></div></figure><p id="e53f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它执行以下操作:</p><ol class=""><li id="9e05" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated"><strong class="ih hj">获取位置v2 </strong>:获取我的当前位置。您可以在<a class="ae jd" href="https://tasker.joaoapps.com/userguide/en/help/ah_get_current_location.html" rel="noopener ugc nofollow" target="_blank">获取位置v2 </a>用户指南中了解更多详情。</li><li id="5756" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj"> HTTP请求</strong>:调用API，如右图截图所示。<em class="kh"> %telegramToken </em>是<em class="kh"> BotFather </em>给我的令牌，<em class="kh"> %par1 </em>和<em class="kh"> %par2 </em>是任务收到的参数。</li><li id="af4a" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj"> Return </strong>:给调用者任务一个值。使用<em class="kh"> %http_data[message_id] </em>，它返回消息标识符，以便稍后更新和/或停止实时位置。</li></ol><h2 id="304e" class="ki jf hi bd jg kj kk kl jk km kn ko jo iq kp kq js iu kr ks jw iy kt ku ka kv bi translated">方法editMessageLiveLocation</h2><p id="cf33" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">调用<a class="ae jd" href="https://core.telegram.org/bots/api#editmessagelivelocation" rel="noopener ugc nofollow" target="_blank">editMessageLiveLocation</a>允许机器人更新使用先前方法发送的实时位置。除了<em class="kh"> message_id </em>是直播位置消息的标识符之外，其他参数完全相同。</p><p id="d9f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面的截图中，可以看到调用这个方法的任务。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es kw"><img src="../Images/e0d6801c523515312a04299fa443ec09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UYJoN2BM0j974oaTxlh2Tw.png"/></div></div></figure><p id="268c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它执行以下操作:</p><ol class=""><li id="6953" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated"><strong class="ih hj">获取位置v2 </strong>:获取我的当前位置。</li><li id="a273" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj"> HTTP请求</strong>:调用右边截图所示的API更新<em class="kh"> %par2 </em>标识的live location消息。</li></ol><h2 id="139a" class="ki jf hi bd jg kj kk kl jk km kn ko jo iq kp kq js iu kr ks jw iy kt ku ka kv bi translated">方法stopMessageLiveLocation</h2><p id="f2e2" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在<em class="kh"> live_period </em>结束之前，调用<a class="ae jd" href="https://core.telegram.org/bots/api#stopmessagelivelocation" rel="noopener ugc nofollow" target="_blank"> stopMessageLiveLocation </a>结束用第一种方法发送的live位置。它需要参数<em class="kh">消息id </em>。</p><p id="86c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面的截图中，可以看到调用这个方法的任务。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es kw"><img src="../Images/ddc7e651de6ed10dcd30804dcb32d61e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IDhEnBQa2g2olv3WsvXtAw.png"/></div></div></figure><p id="fbc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它执行一个调用API的<strong class="ih hj"> HTTP请求</strong>，如右边截图所示，以结束由<em class="kh"> %par2 </em>标识的实时位置消息。</p></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><p id="d0d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在这里下载<a class="ae jd" href="https://taskernet.com/shares/?user=AS35m8nzU8Z2OxB1WGqHbYHDLajdlq0DG%2B8k8f7L2XfQM3eHbHEAthA2xNvalA2%2FZaJvRZj2roE7ow%3D%3D&amp;id=Project%3ATelegram#" rel="noopener ugc nofollow" target="_blank">讲解的所有任务。</a></p><h1 id="e227" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">发送实时位置任务</h1><p id="4c22" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">现在可以发送实时位置信息，更新它并最终停止它。</p><p id="760f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的任务询问用户应该多久更新一次实时位置，更新多少次，并显示一个通知，以便随时更新或停止更新。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es md"><img src="../Images/d74b8cd398f79527914e8b06092b36dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HBHuXDzzJ_dq7y2oBQbn2Q.jpeg"/></div></div></figure><p id="3451" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它执行以下操作:</p><ol class=""><li id="6540" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated"><strong class="ih hj">输入对话框</strong>:询问用户多久更新一次位置，以分钟为单位。</li><li id="d346" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">变量集</strong>:将用户输入保存在<em class="kh">% familyLocationInterval</em>变量中。</li><li id="6d0b" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">输入对话框</strong>:询问用户应该更新多少次位置。</li><li id="0155" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">变量集</strong>:将用户输入保存在<em class="kh"> %familyLocationTimes </em>变量中。</li><li id="61df" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">变量集</strong>:这样计算<em class="kh"> live_period </em>参数:(<em class="kh">% familyLocationInterval</em>*(<em class="kh">% familyLocationTimes+</em>1))* 60。它增加了一个时间，以确保慢速网络不会干扰。</li><li id="8fb2" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">通知</strong>:发送通知，让用户手动更新和停止位置。</li><li id="9712" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">执行任务</strong>:向群组发送电报消息，通知他们正在做什么。</li><li id="da98" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">变量集</strong>:将<em class="kh"> %familyLocationIndex </em>变量设置为0。</li><li id="3b72" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">执行任务</strong>:使用之前解释的第一种方法将实时位置发送给群组。它将返回值保存在<em class="kh">% familyLocationMessageId</em>变量中。</li><li id="a324" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj"> If </strong>:检查消息是否已发送，id是否已返回。</li><li id="a513" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">等待:</strong>等待<em class="kh">% familyLocationInterval</em>分钟。</li><li id="f9c2" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">执行任务</strong>:使用<em class="kh">editMessageLiveLocation</em>方法更新实时位置。</li><li id="0a5a" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">变量添加</strong>:将<em class="kh"> %familyLocationIndex </em>变量增加1。</li><li id="fae7" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">转到</strong>:如果索引小于次数，则回到位置11的<strong class="ih hj">等待</strong>动作。</li></ol><p id="eacd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后一个操作调用以下任务。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div class="er es me"><img src="../Images/8db9c70fbe93713e80eee4f23ba2e965.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*U7Ie6OM_S0wHtHlnNRUmuw.png"/></div></figure><p id="06ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它取消通知，清除变量，并使用<em class="kh"> stopMessageLiveLocation </em>方法来停止实时位置消息。</p></div></div>    
</body>
</html>