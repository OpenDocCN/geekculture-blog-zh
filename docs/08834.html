<html>
<head>
<title>PHP, what are dynamic properties?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP，什么是动态属性？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/php-what-are-dynamic-properties-2509c6fbccf8?source=collection_archive---------2-----------------------#2021-11-16">https://medium.com/geekculture/php-what-are-dynamic-properties-2509c6fbccf8?source=collection_archive---------2-----------------------#2021-11-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1a30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最近我们听到很多关于PHP中的动态属性，以及它在8.2版本中被弃用的可能性，只是在9版本中消失了。这个提议被记录在一个专门的RFC<a class="ae jd" href="https://wiki.php.net/rfc/deprecate_dynamic_properties" rel="noopener ugc nofollow" target="_blank">https://wiki.php.net/rfc/deprecate_dynamic_properties</a>中，并且在社交网络(如twitter等)上引起了很多讨论。).</p><h1 id="5bca" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">什么是动态属性？</h1><p id="34ca" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">属性是在类中声明的属性/变量。例如，<em class="kh"> $name </em>是类<em class="kh">用户</em>的属性。我们可以在类的开头声明<em class="kh"> $name </em>，我们可以声明可见性(在本例中为<em class="kh"> public </em>)，我们可以声明属性的类型(在本例中为<em class="kh"> string </em>):</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="947f" class="kr jf hi kn b fi ks kt l ku kv">class User {<br/>    public string $name;<br/>}<br/></span></pre><p id="ad4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在类的方法中，我们可以访问声明的属性:</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="225f" class="kr jf hi kn b fi ks kt l ku kv">class User {<br/>    public string $name;</span><span id="3868" class="kr jf hi kn b fi kw kt l ku kv">    public function __construct($name="") {<br/>        $this-&gt;name = $name;<br/>    }<br/>}</span></pre><p id="a0b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">动态属性是未在类中声明的属性，但在类的代码中，您希望使用未声明的属性:</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="190b" class="kr jf hi kn b fi ks kt l ku kv">class User {<br/>    public string $name;</span><span id="5a0a" class="kr jf hi kn b fi kw kt l ku kv">    public function __construct($name="", $age = 0) {<br/>        $this-&gt;name = $name;<br/>        // Assigns the not existent property age<br/>        $this-&gt;age = $age;<br/>    }<br/>}</span></pre><p id="4b86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的例子中，在构造函数方法中，我通过<em class="kh"> $this- &gt; age </em>访问了<em class="kh"> age </em>属性。在这种情况下，PHP将动态创建属性。</p><h1 id="289b" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">具有动态特性的示例</h1><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="5d73" class="kr jf hi kn b fi ks kt l ku kv">class User {<br/>    public string $name;</span><span id="d55a" class="kr jf hi kn b fi kw kt l ku kv">public function __construct($name="", $age = 0) {<br/>        $this-&gt;name = $name;<br/>        // Assigns the not existent property age<br/>        $this-&gt;age = $age;<br/>    }<br/>}</span><span id="85d7" class="kr jf hi kn b fi kw kt l ku kv">$user = new User;<br/>// Assigns declared property User::$name.<br/>$user-&gt;name = "foo";</span><span id="1d17" class="kr jf hi kn b fi kw kt l ku kv">// Oops, a typo:<br/>$user-&gt;nane = "foo";<br/>// PHP &lt;= 8.1: Silently creates dynamic $user-&gt;nane property.<br/>// PHP    8.2: Raises deprecation warning, still creates dynamic property.<br/>// PHP    9.0: Throws Error exception.<br/>echo $user-&gt;nane;</span></pre><p id="3713" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该示例取自<a class="ae jd" href="https://wiki.php.net/rfc/deprecate_dynamic_properties" rel="noopener ugc nofollow" target="_blank">https://wiki.php.net/rfc/deprecate_dynamic_properties</a>，并修改为添加<em class="kh">年龄</em>参数，以显示您在访问该物业时出现打字错误的示例。这是一个“隐藏的”bug，因为您认为您执行了一个正确的赋值，但是最后由于输入错误(nane而不是name)导致了一个意外的行为。</p><p id="ee42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在PHP 8.0和8.1中，PHP将创建一个名为<em class="kh"> nane </em>的动态属性。</p><p id="49c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于PHP 8.2，在执行过程中会有一个警告，但是会创建动态属性。</p><p id="4cce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在PHP 9.0中，你会有一个例外。</p><h1 id="4734" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">你今天能做什么？</h1><p id="34d2" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我强烈建议使用一个代码静态分析工具，比如PHPstan或Psalm。</p><p id="c3e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用PHPstan，您可以用级别2来执行它，以捕捉任何动态属性的使用。</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="d3c0" class="kr jf hi kn b fi ks kt l ku kv">phpstan analyze --level=2 .</span></pre><p id="4647" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最新的例子是:</p><ul class=""><li id="e975" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated"><em class="kh">访问未定义的属性用户::$age </em>因为访问构造函数中的age；</li><li id="f648" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><em class="kh">访问一个未定义的属性用户::$nane </em>因为输入错误(nane代替name)。</li></ul><figure class="ki kj kk kl fd lm er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es ll"><img src="../Images/1bee5a4a5b40e3712003707cc7bc10c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vm6Wl-tMBvLZbhvZ9cE-sw.png"/></div></div></figure><h1 id="e272" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">我的考虑</h1><p id="b20c" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">这是一个很好的特性，目标是提高质量和降低隐藏的错误。</p><p id="9fe2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个特性可能会对现有的代码产生很大的负面影响。我们确定吗？</p><p id="65db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一些注意事项:</p><ul class=""><li id="8ca6" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">看了PHP 8的路线图和预测，我们可以用PHP 8进行多年的“遗留代码”；</li><li id="5353" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">如果你使用静态代码分析，很可能你的代码不使用动态属性；</li><li id="6d69" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">如果您没有使用静态代码，那么首先要做的是用level 2启动phpstan。</li></ul><p id="54c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以…欢迎来到“PHP RFC:不赞成动态属性”让我们为未来做好准备；)</p><p id="4b7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你喜欢还是不喜欢「不赞成动态属性」？</p></div></div>    
</body>
</html>