<html>
<head>
<title>Write a Custom Gradle Plugin (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写一个定制的Gradle插件(第2部分)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/write-a-custom-gradle-plugin-part-2-1732ac39ff96?source=collection_archive---------1-----------------------#2021-01-11">https://medium.com/geekculture/write-a-custom-gradle-plugin-part-2-1732ac39ff96?source=collection_archive---------1-----------------------#2021-01-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/c27f520be1f79df7ad19a387683b6e6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7D_xKISQXnS8OdMN.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Image Credit: <a class="ae hv" href="https://gradle.org/" rel="noopener ugc nofollow" target="_blank">https://gradle.org/</a></figcaption></figure><div class=""/><div class=""><h2 id="9775" class="pw-subtitle-paragraph iv hx hy bd b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm dx translated">带有配置的自定义梯度任务</h2></div><p id="783a" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在<a class="ae hv" href="https://rupeshurmaliya.medium.com/write-a-custom-gradle-plugin-part-1-22b37c3b7326" rel="noopener">之前的博客</a>中，我已经解释了如何创建一个简单的Gradle插件。在这里，我将更深入地讨论Gradle task以及如何在应用期间配置插件的参数。</p><h2 id="8766" class="kj kk hy bd kl km kn ko kp kq kr ks kt jw ku kv kw ka kx ky kz ke la lb lc ld bi translated">让我们开始编写一个定制的Gradle任务:</h2><p id="eff9" class="pw-post-body-paragraph jn jo hy jp b jq le iz js jt lf jc jv jw lg jy jz ka lh kc kd ke li kg kh ki hb bi translated">让我们举一个例子，我将从<strong class="jp hz"> JSON </strong>为一个android应用程序创建一个资源(XML)文件。</p><p id="0125" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">首先，我们将创建一个自定义的Gradle任务，并将其添加到插件中。</p><figure class="lj lk ll lm fd hk"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="4de9" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在我们必须将这个任务添加到插件中。</p><figure class="lj lk ll lm fd hk"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="c26d" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在通过使用以下命令触发<code class="du lp lq lr ls b"><strong class="jp hz">uploadArchive</strong></code>任务或从终端执行:</p><figure class="lj lk ll lm fd hk"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="5ec0" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在从应用程序运行<code class="du lp lq lr ls b">SimpleTask</code>,我们将得到下面的输出。</p><figure class="lj lk ll lm fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lt"><img src="../Images/d216c31641bfabbd693e5642d8242e60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jCxeB774m3kkAuKEzHE-iw.png"/></div></div></figure><p id="fb70" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><em class="lu">现在让我们更进一步，读取JSON文件并从该任务创建资源文件。</em></p></div><div class="ab cl lv lw gp lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hb hc hd he hf"><h2 id="b1da" class="kj kk hy bd kl km kn ko kp kq kr ks kt jw ku kv kw ka kx ky kz ke la lb lc ld bi translated">生成资源:</h2><p id="5c84" class="pw-post-body-paragraph jn jo hy jp b jq le iz js jt lf jc jv jw lg jy jz ka lh kc kd ke li kg kh ki hb bi translated">首先，让我们创建一个<code class="du lp lq lr ls b">resource.json</code>文件，并把它放在应用程序目录中(这只是为了演示。您可以指定任何路径)。</p><figure class="lj lk ll lm fd hk"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="dcaa" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在我们将解析这个<strong class="jp hz"> JSON </strong>并将其转换成一个<strong class="jp hz">颜色资源文件</strong>。为了实现这一点，我们需要对我们的<strong class="jp hz"> SimpleTask进行修改。这里我们需要两件主要的东西:</strong></p><ol class=""><li id="5378" class="mc md hy jp b jq jr jt ju jw me ka mf ke mg ki mh mi mj mk bi translated">输入文件路径<code class="du lp lq lr ls b">(<strong class="jp hz">resource.json</strong>)</code></li><li id="5a8c" class="mc md hy jp b jq ml jt mm jw mn ka mo ke mp ki mh mi mj mk bi translated">输出文件路径<code class="du lp lq lr ls b">(<strong class="jp hz">resource.xml</strong>)</code></li></ol><p id="8930" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在我们的<strong class="jp hz">简单任务</strong>将会是这样的:</p><figure class="lj lk ll lm fd hk"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="c3d7" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在我们必须将两个文件的路径都传递给<strong class="jp hz"> SimpleTask。</strong></p><figure class="lj lk ll lm fd hk"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="c5a3" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">再次导出带有新代码更改的插件，并从应用程序运行<strong class="jp hz">简单任务</strong>。现在<code class="du lp lq lr ls b"><strong class="jp hz">resource.xml</strong></code>将被添加到<code class="du lp lq lr ls b"><strong class="jp hz">app/src/main/res/values</strong></code> <strong class="jp hz"> </strong>目录中。</p></div><div class="ab cl lv lw gp lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hb hc hd he hf"><h2 id="54a7" class="kj kk hy bd kl km kn ko kp kq kr ks kt jw ku kv kw ka kx ky kz ke la lb lc ld bi translated">将配置从应用程序传递到插件:</h2><p id="9d8d" class="pw-post-body-paragraph jn jo hy jp b jq le iz js jt lf jc jv jw lg jy jz ka lh kc kd ke li kg kh ki hb bi translated">要将文件路径传递给插件，我们必须为插件添加一个扩展名。我为此创建了一个类<strong class="jp hz"> PluginConfig </strong>，并作为扩展添加到插件中。</p><figure class="lj lk ll lm fd hk"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="e351" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">作为扩展添加到插件</p><figure class="lj lk ll lm fd hk"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="d45e" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在让我们从应用程序中传递插件配置。为此，在应用程序的<code class="du lp lq lr ls b">build.gradle</code>(模块级)中添加以下代码行:</p><figure class="lj lk ll lm fd hk"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="eec1" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">为了在插件中检索这个配置，我们最终的<strong class="jp hz">sample plugin</strong>&amp;<strong class="jp hz">simple task</strong>类将如下所示:</p><figure class="lj lk ll lm fd hk"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="4dc8" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">下面几行代码是从我们的应用程序的<code class="du lp lq lr ls b">build.gradle</code>(模块级)传来的插件中检索输入文件的值。</p><figure class="lj lk ll lm fd hk"><div class="bz dy l di"><div class="ln lo l"/></div></figure><h2 id="025d" class="kj kk hy bd kl km kn ko kp kq kr ks kt jw ku kv kw ka kx ky kz ke la lb lc ld bi translated">简单任务:</h2><figure class="lj lk ll lm fd hk"><div class="bz dy l di"><div class="ln lo l"/></div></figure></div><div class="ab cl lv lw gp lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hb hc hd he hf"><h2 id="5b72" class="kj kk hy bd kl km kn ko kp kq kr ks kt jw ku kv kw ka kx ky kz ke la lb lc ld bi translated"><strong class="ak">任务分组:</strong></h2><p id="c552" class="pw-post-body-paragraph jn jo hy jp b jq le iz js jt lf jc jv jw lg jy jz ka lh kc kd ke li kg kh ki hb bi translated">我们可以使用下面的代码将所有的任务分组。</p><figure class="lj lk ll lm fd hk"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="9abf" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在，如果我们检查应用程序项目，任务将分组如下:</p><figure class="lj lk ll lm fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mq"><img src="../Images/437b73a92cd7c8eab687e1d42cd1fd29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YRsyVDbqx2f2dvk9GwOt_A.png"/></div></div></figure></div><div class="ab cl lv lw gp lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hb hc hd he hf"><p id="6ed0" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在，如果我们运行此任务，我们会看到新文件将被添加到以下路径目录中:</p><figure class="lj lk ll lm fd hk"><div class="bz dy l di"><div class="ln lo l"/></div></figure><figure class="lj lk ll lm fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mr"><img src="../Images/e350f6336be784c2173d4d2533893b93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bIsi5ZTxsBTUU93rgLpoCQ.png"/></div></div></figure></div><div class="ab cl lv lw gp lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hb hc hd he hf"><p id="87ab" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hz"> <em class="lu">感谢阅读此文。在下一部分，我将讨论插件的单元&amp;功能测试。</em> </strong></p></div><div class="ab cl lv lw gp lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hb hc hd he hf"><h2 id="e2e3" class="kj kk hy bd kl km kn ko kp kq kr ks kt jw ku kv kw ka kx ky kz ke la lb lc ld bi translated">参考资料:</h2><div class="hh hi ez fb hj ms"><a href="https://docs.gradle.org/current/userguide/custom_tasks.html" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab dw"><div class="mu ab mv cl cj mw"><h2 class="bd hz fi z dy mx ea eb my ed ef hx bi translated">开发自定义梯度任务类型</h2><div class="mz l"><h3 class="bd b fi z dy mx ea eb my ed ef dx translated">Gradle支持两种类型的任务。一种这样的类型是简单任务，其中您用一个动作闭包来定义任务…</h3></div><div class="na l"><p class="bd b fp z dy mx ea eb my ed ef dx translated">docs.gradle.org</p></div></div></div></a></div><div class="hh hi ez fb hj ms"><a href="https://docs.gradle.org/current/userguide/custom_gradle_types.html" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab dw"><div class="mu ab mv cl cj mw"><h2 class="bd hz fi z dy mx ea eb my ed ef hx bi translated">开发自定义梯度类型</h2><div class="mz l"><h3 class="bd b fi z dy mx ea eb my ed ef dx translated">Gradle有几种不同的“附加组件”可以开发，比如插件、任务、项目…</h3></div><div class="na l"><p class="bd b fp z dy mx ea eb my ed ef dx translated">docs.gradle.org</p></div></div></div></a></div><div class="hh hi ez fb hj ms"><a href="https://docs.gradle.org/current/userguide/more_about_tasks.html" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab dw"><div class="mu ab mv cl cj mw"><h2 class="bd hz fi z dy mx ea eb my ed ef hx bi translated">创作任务</h2><div class="mz l"><h3 class="bd b fi z dy mx ea eb my ed ef dx translated">作为一个例子，我们来看看Gradle提供的复制任务。要为您的构建创建一个复制任务，您可以在…</h3></div><div class="na l"><p class="bd b fp z dy mx ea eb my ed ef dx translated">docs.gradle.org</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng hp ms"/></div></div></a></div></div></div>    
</body>
</html>