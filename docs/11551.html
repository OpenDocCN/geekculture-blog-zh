<html>
<head>
<title>Partitioning in Azure CosmosDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure CosmosDB中的分区</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/partitioning-in-azure-cosmosdb-5eca80ad4a3c?source=collection_archive---------13-----------------------#2022-03-28">https://medium.com/geekculture/partitioning-in-azure-cosmosdb-5eca80ad4a3c?source=collection_archive---------13-----------------------#2022-03-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f4fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分区是一种数据存储功能，它允许将表和大型数据集分割成较小的子集，以实现更快的读取速度。Azure CosmosDB用于存储大型数据集，同时保持快速读取访问，这只有在存储的数据分区良好的情况下才有可能。</p><p id="ecf5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Azure CosmosDB的资源模型源自存放CosmosDB数据库的CosmosDB帐户，然后数据库被分成包含保存数据的项目的容器。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/1019e0033f90832e9f68154d137d21e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jzFlZXsh9yjTbh58osJi5A.png"/></div></div></figure><p id="5bc9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当分区键应用于数据时，从其创建的子集被称为<strong class="ih hj"> <em class="jp">逻辑分区。</em> </strong>在这种情况下，逻辑分区是一组共享同一个分区键的数据。可以存在的逻辑分区的数量没有限制，假设选择了一个好的分区键，数据将充分地分布在各个逻辑分区上。</p><p id="4819" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果选择了无效的分区键，将会导致某些逻辑分区中的数据聚集，从而导致针对这些逻辑分区的查询运行时间更长。对于任何数据集来说，一个好的分区键都有很大范围的可能值，因此会产生更多的逻辑分区。</p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><p id="ee70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在创建过程中选择的分区键，如Cosmos DB API，一旦选择就不能更改。对于被认为是最佳的分区键，它应该:</p><ul class=""><li id="4b4c" class="jx jy hi ih b ii ij im in iq jz iu ka iy kb jc kc kd ke kf bi translated">是一个值不变的属性。</li><li id="bb0c" class="jx jy hi ih b ii kg im kh iq ki iu kj iy kk jc kc kd ke kf bi translated">基数很高。换句话说，属性应该有很大范围的可能值。</li><li id="13fa" class="jx jy hi ih b ii kg im kh iq ki iu kj iy kk jc kc kd ke kf bi translated">在所有逻辑分区中平均分配请求单元(RU)消耗和数据存储。这确保了在您的物理分区之间均匀的RU消耗和存储分布。</li></ul><p id="9838" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于读取量大的容器，可以选择使用的查询过滤器作为分区键。这样做的最大好处是减少了跨分区查询的可能性，这在RU成本和延迟方面是很昂贵的。</p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><p id="90d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从一个更实际的角度来看这个问题:<strong class="ih hj"> <em class="jp">假设我们有一段Fifa球员的信息，如下所示。提供的列包括id、姓名、全名、出生日期、年龄、身高、体重、职位和国籍。从这些列中选择最合适的分区键</em> </strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kl"><img src="../Images/e9576988ee53fb19083da441cff47676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4bGNr_F6d1EpgcjwTUiDow.png"/></div></div></figure><p id="2bd3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在所提供的列中，以下列不能作为正确的分区键:</p><ul class=""><li id="361a" class="jx jy hi ih b ii ij im in iq jz iu ka iy kb jc kc kd ke kf bi translated"><strong class="ih hj"><em class="jp">ID</em></strong>——假设我们只存储一个与每场比赛相关的记录，我们最终将拥有与联盟中的球员一样多的逻辑分区。每个逻辑分区只有一条记录。拥有以这种方式分割数据的分区键是无效的。</li><li id="6d54" class="jx jy hi ih b ii kg im kh iq ki iu kj iy kk jc kc kd ke kf bi translated"><strong class="ih hj"> <em class="jp">【出生日期】、姓名和全名</em> </strong> —这些列会遇到在ID列下讨论的相同问题，它们可能具有较高的基数，但是它们缺少跨记录的均匀数据分布。</li><li id="5e09" class="jx jy hi ih b ii kg im kh iq ki iu kj iy kk jc kc kd ke kf bi translated"><strong class="ih hj"> <em class="jp">、年龄、身高_厘米、体重_公斤</em> </strong> —这些列可能会以固定的间隔变化，或者倾向于随机变化，因此不会是有效的部分键。如上所述，分区键不应该改变。</li><li id="cdcc" class="jx jy hi ih b ii kg im kh iq ki iu kj iy kk jc kc kd ke kf bi translated"><strong class="ih hj"> Positions — </strong>这不是一个有效的键，因为它是一个多值数据类型。它包含多个独立的值，代表球员在职业生涯中的某个时刻所担任的所有位置。</li></ul><p id="2d10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于我们排除了所有其他列，剩下的一列是<strong class="ih hj">国籍。</strong>它符合上面详述的所有标准:它不会改变，并且考虑到国际足联球员来自的国家范围，我们最终会有相当数量的逻辑分区。</p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><p id="b7bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择逻辑分区的一部分是要很好地理解组织使用的数据，这种知识会影响分区键的选择。</p></div></div>    
</body>
</html>