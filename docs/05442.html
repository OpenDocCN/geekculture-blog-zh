<html>
<head>
<title>Interactive Dashboards in Apache Superset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apache超集中的交互式仪表板</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/interactive-dashboards-in-apache-superset-ec4a3bf9bc82?source=collection_archive---------3-----------------------#2021-07-21">https://medium.com/geekculture/interactive-dashboards-in-apache-superset-ec4a3bf9bc82?source=collection_archive---------3-----------------------#2021-07-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="0410" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想让您的仪表板更具交互性，该怎么办？如果您的数据集有一个复杂的SQL查询，并且您必须实现一个算法，该算法将依赖于您在仪表板中设置的过滤器，甚至基于来自该特定仪表板的链接的参数，该怎么办？所有问题的答案都是Jinja模板。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/f052c4e33eddccaad0f67bfbaebd4e93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MtnNaMD5bkS6rk_o"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@kellysikkema?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kelly Sikkema</a> on <a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="e69c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，如果你以前没有这样做过，你需要激活Jinja模板。为此，您应该在您的<strong class="ih hj"> superset_config.py </strong>中的<strong class="ih hj"> FEATURE_FLAGS </strong>字典中添加另一个元素。元素的键将是<strong class="ih hj">ENABLE _ TEMPLATE _ PROCESSING</strong>，值将为True。下面是它的样子:</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="d5b8" class="kg kh hi kc b fi ki kj l kk kl">FEATURE_FLAGS = {<br/>    ...  # your existing flags<br/>    "ENABLE_TEMPLATE_PROCESSING": True,<br/>}</span></pre><p id="ef60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加参数后，如果在容器中使用超集，应该重新构建Docker映像。这里是我的两篇文章，可以帮助你<a class="ae jt" rel="noopener" href="/geekculture/run-apache-superset-locally-in-10-minutes-30bc70ed808c">在10分钟内在本地运行Apache超集</a>和<a class="ae jt" rel="noopener" href="/geekculture/custom-security-manager-for-apache-superset-c91f413a8be7">通过superset_config.py </a>更改设置。</p><p id="11b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，是时候在我们的SQL查询中使用Jinja宏了！例如，你可以从标准超集宏开始。如果您要编辑您的虚拟数据集，您可以为Jinja处理器使用<code class="du km kn ko kc b">{{to_dttm}}</code>占位符。Jinja将用您设置的时间范围过滤器的结束界限替换该占位符。让我们从一个示例查询MariaDB开始:</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="c05b" class="kg kh hi kc b fi ki kj l kk kl">SELECT DATE_SUB(NOW(), INTERVAL 1 DAY) AS XDATE</span></pre><p id="d420" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用它在我们的系统中创建新的虚拟数据集，方法是单击EXPLORE按钮并保存。然后，我们将用名称<code class="du km kn ko kc b">test_table_chart</code>保存一个表格图表。现在，我们看到查询结果如下:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kp"><img src="../Images/d451c333fb5d1c7c67c993db7dce6853.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*hmv7h-kveoVC0XeTdwECOQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx">Result of the query execution</figcaption></figure><p id="e01a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们通过用<code class="du km kn ko kc b">{{to_dttm}}</code> Jinja宏替换<code class="du km kn ko kc b">NOW()</code>函数来更改虚拟数据集中的查询，并保存:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kq"><img src="../Images/2cb327e2abd745af0f26983c20aadc8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V4Rov9r-9XOBIGpNsUdnSg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Changed virtual dataset with Jinja macro</figcaption></figure><p id="2e0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您现在尝试运行您的图表，它将返回<code class="du km kn ko kc b">N/A</code>，因为模板处理器看不到任何与此图表相关联的时间范围过滤器。要解决这个问题，你必须把你的图表和一个过滤器放在一个新的仪表板上。如果您现在打开控制面板，您将会看到我们预期的查询结果，即表示时间范围筛选器结束界限前一天的日期:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/1c96bd9aaad311b920213771a9e2f32f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8vDIkeGV0nB0R7841zDaaQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Chart based on a dataset that uses to_dttm macro</figcaption></figure><p id="8e8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">哇，很酷，不是吗？摆弄过滤器，检查它对<code class="du km kn ko kc b">test_table_chart</code>的影响。</p><p id="ed48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有许多内置宏可用于模板化。你知道HTML是以表格可视化类型呈现的吧？例如，您可以使用<code class="du km kn ko kc b">{{ url_param('your_custom_parameter') }}</code>在您的仪表板中使用定制的GET请求参数，并使它们真正具有交互性。您可以通过SQL中的<code class="du km kn ko kc b">&lt;a&gt;</code>标记构建链接，如下所示:</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="d1d0" class="kg kh hi kc b fi ki kj l kk kl">SELECT &lt;a href="http://superset?page=777"&gt;Page #777&lt;/a&gt; AS MY_LINK</span></pre><p id="c551" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该链接将引导用户到详细的仪表板，其中数据集是基于通过从您的链接获取参数填充的<code class="du km kn ko kc b">{{ url_param('page') }}</code>！</p><p id="1dac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于其他内置Jinja宏的更多信息可以在<strong class="ih hj"> jinja_context.py </strong> <a class="ae jt" href="https://github.com/apache/superset/blob/master/superset/jinja_context.py" rel="noopener ugc nofollow" target="_blank">源代码</a>中找到。此外，您可以定义自己的宏，并通过数据集属性中的模板参数使其可用于数据集中的模板化。太棒了。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="9e7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望，你喜欢这篇文章，这条信息将帮助你建立迷人的有用的可视化。如果有，请在<a class="ae jt" rel="noopener" href="/@agordienko"> Medium </a>、<a class="ae jt" href="https://github.com/aleksandrgordienko" rel="noopener ugc nofollow" target="_blank"> GitHub </a>、<a class="ae jt" href="https://twitter.com/data_diving" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae jt" href="https://www.linkedin.com/in/aleksandrgordienko/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上关注我。</p></div></div>    
</body>
</html>