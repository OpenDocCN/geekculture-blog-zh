<html>
<head>
<title>Sign in through Steam using NodeJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用NodeJS通过Steam登录</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/sign-in-through-steam-using-nodejs-e3202d4719?source=collection_archive---------3-----------------------#2021-05-29">https://medium.com/geekculture/sign-in-through-steam-using-nodejs-e3202d4719?source=collection_archive---------3-----------------------#2021-05-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/edb43d44bf3a7cc81530bfed2972ba93.png" data-original-src="https://miro.medium.com/v2/resize:fit:360/format:webp/1*38v1Ob5d2dTjkzSWw6FUyQ.png"/></div><figcaption class="im in et er es io ip bd b be z dx">Valve’s preferred “Sign in through Steam” image.</figcaption></figure><p id="1177" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你正在运营一个以任何方式连接到steam服务的网站，那么允许你的用户通过Steam登录是必不可少的。这种认证方式允许你无缝地收集用户的SteamID64，从而允许你看到他们的Steam清单，个人资料图片等。在这篇文章中，我将教你如何使用NodeJS在你的网站上建立一个“通过Steam登录”系统。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="ec9c" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">NPM安装</h1><p id="1c5d" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">首先，我们需要安装一些npm。需要进行以下安装:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="6bc6" class="lh jw hi ld b fi li lj l lk ll">npm install express</span><span id="22b5" class="lh jw hi ld b fi lm lj l lk ll">npm install express-session</span><span id="1a61" class="lh jw hi ld b fi lm lj l lk ll">npm install passport</span><span id="c400" class="lh jw hi ld b fi lm lj l lk ll">npm install --save passport-steam</span></pre><p id="fd6d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">没有安装npm？前往<a class="ae ln" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">nodejs.org</a>安装你选择的操作系统。</p><h1 id="9534" class="jv jw hi bd jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks bi translated">开始构建服务器</h1><p id="6af7" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">假设我们正在处理一个普通的项目，我们将需要从构建一个简单的服务器的必要代码开始。所有代码都可以在<a class="ae ln" href="https://github.com/kevalane/sign-in-through-steam" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="64ef" class="lh jw hi ld b fi li lj l lk ll">// Require all the installs<br/>var express = require('express');<br/>var passport = require('passport');<br/>var session = require('express-session');<br/>var passportSteam = require('passport-steam');<br/>var SteamStrategy = passportSteam.Strategy;<br/>var app = express();</span><span id="4173" class="lh jw hi ld b fi lm lj l lk ll">// Let's set a port<br/>var port = 3000;</span><span id="0f63" class="lh jw hi ld b fi lm lj l lk ll">// Spin up the server<br/>app.listen(port, () =&gt; {<br/> console.log('Listening, port ' + port);<br/>});</span></pre><p id="0241" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以使用(假设您将应用程序文件命名为app.js)来运行这段代码:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="abcf" class="lh jw hi ld b fi li lj l lk ll">node app.js</span></pre><p id="f69c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果此时出现任何错误，请确保所有软件包都已正确安装。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="df45" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">设置API密钥</h1><p id="44e2" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">若要继续，您需要使用您的steam帐户设置一个API密钥。头转向https://steamcommunity.com/dev/apikey的<a class="ae ln" href="https://steamcommunity.com/dev/apikey" rel="noopener ugc nofollow" target="_blank"/>，它看起来会是这样的:</p><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es lt"><img src="../Images/ef5692c49428137a52f8e58199e410f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*walTzNpdKmvbFq5RXGKpOA.png"/></div></div></figure><p id="9d8c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">键入“localhost”作为域名，同意条款并点击“注册”您将被重定向到一个带有您的steam API密钥的页面，复制它(您将在下一步中需要它)。</p><h1 id="5247" class="jv jw hi bd jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks bi translated">建立蒸汽策略</h1><p id="8d3b" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">现在，我们需要添加大量代码来使身份验证正常工作。以下是必需的:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="d72b" class="lh jw hi ld b fi li lj l lk ll">// Required to get data from user for sessions<br/>passport.serializeUser((user, done) =&gt; {<br/> done(null, user);<br/>});</span><span id="1e00" class="lh jw hi ld b fi lm lj l lk ll">passport.deserializeUser((user, done) =&gt; {<br/> done(null, user);<br/>});</span><span id="ce11" class="lh jw hi ld b fi lm lj l lk ll">// Initiate Strategy<br/>passport.use(new SteamStrategy({<br/> returnURL: '<a class="ae ln" href="http://localhost:'" rel="noopener ugc nofollow" target="_blank">http://localhost:'</a> + port + '/api/auth/steam/return',<br/> realm: '<a class="ae ln" href="http://localhost:'" rel="noopener ugc nofollow" target="_blank">http://localhost:'</a> + port + '/',<br/> apiKey: 'YOUR_API_KEY'<br/> }, function (identifier, profile, done) {<br/>  process.nextTick(function () {<br/>   profile.identifier = identifier;<br/>   return done(null, profile);<br/>  });<br/> }<br/>));</span><span id="39c0" class="lh jw hi ld b fi lm lj l lk ll">app.use(session({<br/> secret: 'Whatever_You_Want',<br/> saveUninitialized: true,<br/> resave: false,<br/> cookie: {<br/>  maxAge: 3600000<br/> }<br/>}))<br/>app.use(passport.initialize());<br/>app.use(passport.session());</span></pre><p id="234e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">简而言之，下面这段代码允许我们对用户进行身份验证，并将他们存储在一个会话中，这对于构建一个具有持久登录会话的网站是必不可少的。我鼓励进一步阅读<a class="ae ln" href="http://www.passportjs.org/" rel="noopener ugc nofollow" target="_blank"> Passport.js </a>和<a class="ae ln" href="https://www.npmjs.com/package/express-session" rel="noopener ugc nofollow" target="_blank"> Express Sessions </a>以加深理解。</p><p id="21f5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意“YOUR_API_KEY ”,您需要在这里添加上一步中的API密钥。“Whatever_You_Want”只是快速会话的一个秘密字符串，它可以被更改为您想要的任何内容。</p><h1 id="7d95" class="jv jw hi bd jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks bi translated">创建路线</h1><p id="2d53" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">我们最不需要的是处理来自前端的请求的路由。</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="d7f5" class="lh jw hi ld b fi li lj l lk ll">// Routes<br/>app.get('/', (req, res) =&gt; {<br/> res.send(req.user);<br/>});</span><span id="7a3a" class="lh jw hi ld b fi lm lj l lk ll">app.get('/api/auth/steam', passport.authenticate('steam', {failureRedirect: '/'}), function (req, res) {<br/> res.redirect('/')<br/>});</span><span id="6384" class="lh jw hi ld b fi lm lj l lk ll">app.get('/api/auth/steam/return', passport.authenticate('steam', {failureRedirect: '/'}), function (req, res) {<br/> res.redirect('/')<br/>});</span></pre><p id="0951" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“/”路由仅作为我们在身份验证后重定向到的备用路由。</p><p id="8c76" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“/api/auth/steam”路径是我们使用一个简单的href从前端将用户重定向到的路径:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="75b9" class="lh jw hi ld b fi li lj l lk ll">&lt;a href="http://localhost:3000/api/auth/steam"&gt;Sign in&lt;/a&gt;</span></pre><p id="7cb6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">添加完这段代码后，启动您的服务器并导航到上述URL，您应该会看到以下熟悉的官方steam页面:</p><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es ly"><img src="../Images/ae261545bda7a9a02a8e957081437eb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MjzrRAp11ceX4HSmtqF0Gg.png"/></div></div></figure><p id="b714" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，使用您自己的Steam帐户登录，您将被重定向到主页面localhost:3000/，在这里您将看到以下内容:</p><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es lz"><img src="../Images/f0af63423944871beb5a6a3f3da393f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9j1Bee8kBHsB0i9E_TxQpA.png"/></div></div></figure><p id="900a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这只是' req.user '的主体(见'/'路由，这里可以看到res.send())。从这些JSON数据中，你可以得到用户的Steamname，Avatar(不同大小)，SteamID64等等。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="0490" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个示例只是作为一个简单的设置供您构建。例如，一个真实的网站可能会有一个存储用户信息的数据库，因此您需要在认证后操作JSON数据，并将必要的信息插入到您选择的数据库中。</p><p id="9550" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您有任何问题，请留下您的评论，我将确保回复。如果你的故事提供了任何价值，考虑一下<strong class="is hj">在媒体上关注</strong>我——他们不再向拥有&lt; 100名关注者的创作者支付报酬</p></div></div>    
</body>
</html>