<html>
<head>
<title>Creating an Array with Affected CIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建包含受影响配置项的阵列</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-create-an-array-from-affected-cis-76c895ea41a7?source=collection_archive---------48-----------------------#2021-05-25">https://medium.com/geekculture/how-to-create-an-array-from-affected-cis-76c895ea41a7?source=collection_archive---------48-----------------------#2021-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3824" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated"><strong class="ak">使用</strong> JavaScript <strong class="ak"> push()方法将CI名称列表添加到一个数组中。</strong></h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/40be9260f484781a6e6c5b7fa834ff31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i7lsjZyVnJxDEIg8Qibdlw.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@pawel_czerwinski?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Pawel Czerwinski</a> on <a class="ae jn" href="https://unsplash.com/s/photos/array?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="edd1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">当处理与第三方应用程序的集成时，知道如何从ServiceNow中的表创建元素数组会很方便。</p><p id="0258" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">假设我们有一个事件记录和该事件的受影响配置项。我们希望用事件的受影响配置项列表填充字符串类型字段<code class="du kk kl km kn b">u_affected_cis</code>。</p><p id="2b83" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了实现这一点，我们在task_ci表中的之后创建一个<em class="ko">业务规则，它在<em class="ko"> create </em>和<em class="ko"> delete上运行。</em>因此，对于每个新的或删除的受影响配置项，系统将使用刷新的配置项名称列表更新事件字段u _ affected CIs。</em></p><p id="9e1d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">首先，我们使用数组文字语法声明ciList。</p><pre class="iy iz ja jb fd kp kn kq kr aw ks bi"><span id="e26d" class="kt ku hi kn b fi kv kw l kx ky">var ciList = [];</span></pre><p id="971d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后，我们创建一个GlideRecord来查询task_ci表。GlideRecord为task_ci表创建一个GlideRecord类的实例。</p><pre class="iy iz ja jb fd kp kn kq kr aw ks bi"><span id="5fdc" class="kt ku hi kn b fi kv kw l kx ky">var gr = new GlideRecord('task_ci');  </span></pre><p id="4c2a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后，我们查询表task_ci。</p><pre class="iy iz ja jb fd kp kn kq kr aw ks bi"><span id="458d" class="kt ku hi kn b fi kv kw l kx ky">gr.addQuery('task', current.task);</span></pre><p id="d356" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们从查询结果中遍历受影响的配置项列表。toString()方法返回一个String对象的值，push()方法将新的项添加到数组的末尾。</p><pre class="iy iz ja jb fd kp kn kq kr aw ks bi"><span id="bdfe" class="kt ku hi kn b fi kv kw l kx ky"><br/>var gr = new GlideRecord('task_ci'); <br/>    gr.addQuery('task', current.task); <br/>    gr.query(); <br/> while (gr.next()) {<br/>     var affectedCIs = gr.ci_item.name.toString();<br/>            ciList.push(affectedCIs);<br/>          }</span></pre><p id="c10a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦我们用来自CI名称的元素填充了ciList数组。我们查询事件表，其中sys_id =当前删除或添加的task_ci记录，并填充字段u_affected_cis</p><pre class="iy iz ja jb fd kp kn kq kr aw ks bi"><span id="55f0" class="kt ku hi kn b fi kv kw l kx ky">var gr2 = new GlideRecord('incident');<br/>   gr2.addQuery('sys_id', current.task);<br/>   gr2.query();<br/>        if (gr2.next()) {<br/>            gr2.u_affected_cis = ciList.toString(); <br/>            gr2.update();<br/>         }</span></pre><p id="9940" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">完整的业务规则。</p><pre class="iy iz ja jb fd kp kn kq kr aw ks bi"><span id="0db0" class="kt ku hi kn b fi kv kw l kx ky">(function executeRule(current, previous /*null when async*/ ) {<br/> var ciList = [];<br/> var gr = new GlideRecord(‘task_ci’); <br/> gr.addQuery(‘task’, current.task); <br/> gr.query(); <br/> while (gr.next()) {<br/> var affectedCIs = gr.ci_item.name.toString(); <br/> ciList.push(affectedCIs); //Add new items to the end of the array<br/> }<br/> var gr2 = new GlideRecord(‘incident’);<br/> gr2.addQuery(‘sys_id’, current.task);<br/> gr2.query();<br/> if (gr2.next()) {<br/> gr2.u_affected_cis = ciList.toString(); //populate u_affected_cis<br/> gr2.update();<br/> }<br/> })(current, previous);</span></pre><h1 id="4b5d" class="kz ku hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">关键注意事项</h1><p id="ba06" class="pw-post-body-paragraph jo jp hi jq b jr lq ij jt ju lr im jw jx ls jz ka kb lt kd ke kf lu kh ki kj hb bi translated"><code class="du kk kl km kn b">push() </code>方法向数组中添加新的项并返回新的长度。方法在数组末尾添加新项。此方法更改数组的长度。</p></div></div>    
</body>
</html>