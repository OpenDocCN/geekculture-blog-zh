<html>
<head>
<title>Simple Pedometer in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift中的简单计步器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/simple-pedometer-in-swift-482099cf7bbd?source=collection_archive---------8-----------------------#2021-06-13">https://medium.com/geekculture/simple-pedometer-in-swift-482099cf7bbd?source=collection_archive---------8-----------------------#2021-06-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ada4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">学习在Swift中实现一个简单的计步器来计算步数。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/3f1bda0937f6684c29902ff43c3c0b80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*f7xKItqoZp4GgP9e"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@artur_luczka?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Artur Łuczka</a> on <a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9d67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi ju translated"><span class="l jv jw jx bm jy jz ka kb kc di"> H </span>我大家。这是yua，我是WeWALK的软件工程师。大约有一年多的时间，因为疫情，我们被隔离在家里。但是为了保持身材，我们不应该放弃散步和锻炼。在这个故事中，我们将在Swift中实现一个简单的计步器来记录我们的步数。您可以在任何项目中应用相同的方法。所以我们开始练习吧。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="55ad" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">获得许可</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es li"><img src="../Images/d691621072a02af15231efbc91ce1a89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nAmBHD9pJkRxTU5k"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@dncerullo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Danielle Cerullo</a> on <a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="fdbc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们必须获得用户的许可，以便跟踪他们的动作使用情况。为了实现这一点，我们应该将下面几行添加到我们的<strong class="ih hj"> info.plist </strong>中。</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="83bd" class="lo kl hi lk b fi lp lq l lr ls">&lt;key&gt;NSMotionUsageDescription&lt;/key&gt;</span><span id="c6af" class="lo kl hi lk b fi lt lq l lr ls">&lt;string&gt;We are using motion usage in order to track your step count.&lt;/string&gt;</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lu"><img src="../Images/bacbd9828a4abb791f38f9996af348d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*004gyhg_GBn2yjYc4G32QQ.png"/></div></div></figure><p id="c8f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太好了！就是这样。我们希望得到用户的许可。现在，我们可以转到代码部分了。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="18e8" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">创建计步器</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/c02ad6a4cabf33de9dd8a96802ecf14d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OCmSIjl2YP9WZR7i"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@artur_luczka?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Artur Łuczka</a> on <a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="acff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们需要做的第一件事是导入<code class="du lv lw lx lk b"><a class="ae jt" href="https://developer.apple.com/documentation/coremotion" rel="noopener ugc nofollow" target="_blank">CoreMotio</a>n</code>并创建<code class="du lv lw lx lk b"><a class="ae jt" href="https://developer.apple.com/documentation/coremotion/cmmotionactivitymanager" rel="noopener ugc nofollow" target="_blank">CMMotionActivityManager</a></code>和<code class="du lv lw lx lk b"><a class="ae jt" href="https://developer.apple.com/documentation/coremotion/cmpedometer" rel="noopener ugc nofollow" target="_blank">CMPedometer</a></code>。为了能够做到这一点，我们可以添加下面几行。</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="8c19" class="lo kl hi lk b fi lp lq l lr ls"><strong class="lk hj">import</strong> CoreMotion</span><span id="e2af" class="lo kl hi lk b fi lt lq l lr ls">/// Provides to create an instance of the <strong class="lk hj">CMMotionActivityManager</strong>.<br/><strong class="lk hj">private</strong> <strong class="lk hj">let</strong> activityManager = CMMotionActivityManager()</span><span id="35b6" class="lo kl hi lk b fi lt lq l lr ls">/// Provides to create an instance of the <strong class="lk hj">CMPedometer</strong>.<br/><strong class="lk hj">private</strong> <strong class="lk hj">let</strong> pedometer = CMPedometer()</span></pre><p id="2994" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我们将使用<code class="du lv lw lx lk b">CMMotionActivityManager()</code>来监控活动类型，如步行和跑步，同时我们将使用<code class="du lv lw lx lk b">CMPedometer()</code>来获取当前的步数。下面就分别实现这些吧。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="cfb7" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">跟踪活动类型</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/ebd3a9fa87787f38a0c0c9777d2fccd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0ZyNR17kGL8s6eOW"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@areksan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Arek Adeoye</a> on <a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="83e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以用<a class="ae jt" href="https://developer.apple.com/documentation/coremotion/cmmotionactivitymanager/1615945-startactivityupdates" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">startActivityUpdates(to:with handler:)</strong></a>来监控活动类型。这个方法为我们提供了获取当前运动数据的更新。通过下面的源代码，我们将获得当前的活动类型。</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="d63c" class="lo kl hi lk b fi lp lq l lr ls">activityManager.startActivityUpdates(to: OperationQueue.main) { (activity: CMMotionActivity?) <strong class="lk hj">in</strong><br/>    <strong class="lk hj">guard</strong> <strong class="lk hj">let</strong> activity = activity <strong class="lk hj">else</strong> { <strong class="lk hj">return</strong> }</span><span id="e695" class="lo kl hi lk b fi lt lq l lr ls">    DispatchQueue.main.async {<br/>        <strong class="lk hj">if</strong> activity.stationary {<br/>            print("Stationary")<br/>        } <strong class="lk hj">else</strong> <strong class="lk hj">if</strong> activity.walking {<br/>            print("Walking")<br/>        } <strong class="lk hj">else</strong> <strong class="lk hj">if</strong> activity.running {<br/>            print("Running")<br/>        } <strong class="lk hj">else</strong> <strong class="lk hj">if</strong> activity.automotive {<br/>            print("Automotive")<br/>        }<br/>    }<br/>}</span></pre></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="68aa" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">获取步数</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lz"><img src="../Images/54963f45ac774f4722f80b7c25aa43d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Eelo1yX8_R8nNJjF"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@dylu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jacek Dylag</a> on <a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="cf8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后但同样重要的是，我们将使用<a class="ae jt" href="https://developer.apple.com/documentation/coremotion/cmpedometer/1613950-startupdates" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">start updates(from:with handler:)</strong></a>来获取更新后的步数。我们可以使用下面这段代码。</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="8912" class="lo kl hi lk b fi lp lq l lr ls"><strong class="lk hj">if</strong> CMPedometer.isStepCountingAvailable() {<br/>    pedometer.startUpdates(from: Date()) { pedometerData, error <strong class="lk hj">in</strong><br/>        <strong class="lk hj">guard</strong> <strong class="lk hj">let</strong> pedometerData = pedometerData, error == <strong class="lk hj">nil</strong> <strong class="lk hj">else</strong> { <strong class="lk hj">return</strong> }<br/>        <br/>        DispatchQueue.main.async {<br/>            print(pedometerData.numberOfSteps.intValue)<br/>        }<br/>    }<br/>}</span></pre><p id="3d90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，<strong class="ih hj">cmpedometer . isstepcountingavailable()</strong>将使用我们在上面的<strong class="ih hj"> info.plist </strong>中写的描述，通过显示警告来试图获得用户的许可。通过<strong class="ih hj">start updates(from:with handler:)</strong>，它将从现在开始计算步数。如果我们不会遇到任何错误，并且数据不是<strong class="ih hj">零</strong>，我们将能够获得步数。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="7058" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">结论</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/19337c6c5cd87b17a7d4d105baed52f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lgHbcJ_reKJ7cDyH"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@artur_luczka?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Artur Łuczka</a> on <a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="571e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总之；我们学习了使用CoreMotion及其功能在Swift中逐步实现一个简单的计步器。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><p id="8d59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">更新:</strong>我有个好消息要告诉你！你可能知道,“我们行走”曾被《时代》杂志评为年度最佳发明之一。现在，WeWALK已经被亚马逊评选为5大创业公司之一。获胜者将在7月7日之前通过公众投票选出，并将由亚马逊宣布为“年度创业公司”凭借€100，000奖金，我们将把它用于向世界各地更多的视障人士提供智能手杖。请投票支持我们的使命。</p><p id="b07d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是链接:<a class="ae jt" href="http://www.wewalk.io/amazon" rel="noopener ugc nofollow" target="_blank">www.wewalk.io/amazon</a></p><p id="7cf3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢大家的支持！</p><p id="f5a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">祝大家有个健康的一天！</p><p id="bdbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"># IOs # swift # coremotion #计步器</strong></p></div></div>    
</body>
</html>