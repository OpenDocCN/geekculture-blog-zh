<html>
<head>
<title>A Full Stack E-Commerce Application using Spring Boot and making a Docker container.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个使用Spring Boot和Docker容器的全栈电子商务应用程序。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/a-full-stack-e-commerce-application-using-spring-boot-and-making-a-docker-container-eff46f6f4e14?source=collection_archive---------3-----------------------#2021-04-16">https://medium.com/geekculture/a-full-stack-e-commerce-application-using-spring-boot-and-making-a-docker-container-eff46f6f4e14?source=collection_archive---------3-----------------------#2021-04-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7c7622b22683aeb31647a4979a5aab09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*v-t5n_h8FYoDn6WD"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@minkmingle?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Mink Mingle</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2d25" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">啊，Spring Boot这个名字会让你想起繁花似锦、气候宜人的春天。然而，如果没有一个合适的指导，使用弹簧靴工作可能不会那么愉快。本文旨在提供一个Spring Boot应用程序的演练。</p><h1 id="9eb7" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">什么是Spring Boot？</h1><p id="9ddd" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">从官方文件来看，</p><blockquote class="kw kx ky"><p id="6eb8" class="iv iw kz ix b iy iz ja jb jc jd je jf la jh ji jj lb jl jm jn lc jp jq jr js hb bi translated">Spring Boot使得创建独立的、生产级的基于Spring的应用程序变得容易，你可以“直接运行”。</p><p id="e426" class="iv iw kz ix b iy iz ja jb jc jd je jf la jh ji jj lb jl jm jn lc jp jq jr js hb bi translated">我们对Spring平台和第三方库有自己的看法，所以你可以毫不费力地开始。大多数Spring Boot应用需要最小的弹簧配置。</p></blockquote><p id="4ce7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您来自servlet背景，那么您应该熟悉设置Tomcat服务器来服务web文件以及手动设置端点和过滤器来处理web应用程序所需的基本内容的痛苦。Spring boot along向前迈出了一步，并以最简单的方式完成了这些任务。有些是-</p><ul class=""><li id="5a56" class="ld le hi ix b iy iz jc jd jg lf jk lg jo lh js li lj lk ll bi translated">创建独立的Spring应用程序</li><li id="1c7a" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">直接嵌入Tomcat、Jetty或Undertow(无需部署WAR文件)</li><li id="30c5" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">提供自以为是的“初学者”依赖项，以简化您的构建配置</li></ul><p id="e9d3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最重要的特性是依赖注入的特性。依赖注入是一种对象接收它所依赖的其他对象的技术。它允许组件的松散耦合。</p><p id="bca8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们直接进入代码。对于这个例子，我们将为一家服装店构建一个<strong class="ix hj"> API </strong>，它包括用户注册和登录，并在应用程序的整个生命周期中维护用户会话。产品项目将被存储在数据库中。Spring boot提供了与MySQL、Postgresql、Cassandra等流行数据库的<strong class="ix hj"> JDBC连接</strong>。对于这个例子，我们将使用<strong class="ix hj"> postgresql </strong>来存储和查询产品项目。页面上显示的项目类型取决于当前用户会话以及用户与产品项目的<strong class="ix hj">交互。来自服务器的项目被分页。Spring Boot大力支持分页。</strong></p><p id="c1a1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将是项目的最终设置。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="2044" class="ma ju hi lw b fi mb mc l md me">.<br/>├── main<br/>│   ├── java<br/>│   │   └── com<br/>│   │       └── flamup<br/>│   │           └── spring<br/>│   │               ├── Application.java<br/>│   │               ├── Controllers<br/>│   │               │   ├── AuthController.java<br/>│   │               │   ├── CartServiceController.java<br/>│   │               │   ├── ProductController.java<br/>│   │               │   ├── RegistrationController.java<br/>│   │               │   ├── SessionController.java<br/>│   │               │   └── TestGetController.java<br/>│   │               ├── DTO<br/>│   │               │   ├── OrderDTO.java<br/>│   │               │   └── UpdateOrderDTO.java<br/>│   │               ├── Models<br/>│   │               │   ├── AppUserRole.java<br/>│   │               │   ├── ApplicationUser.java<br/>│   │               │   ├── OrderItem.java<br/>│   │               │   ├── Product.java<br/>│   │               │   ├── RegistrationRequest.java<br/>│   │               │   └── ShoppingCart.java<br/>│   │               ├── Repositories<br/>│   │               │   ├── ApplicationUserRepository.java<br/>│   │               │   ├── CartRepository.java<br/>│   │               │   ├── OrderRepository.java<br/>│   │               │   └── ProductRepository.java<br/>│   │               ├── Services<br/>│   │               │   ├── CartService.java<br/>│   │               │   ├── CustomLogoutHandler.java<br/>│   │               │   ├── ProductService.java<br/>│   │               │   └── RegistrationService.java<br/>│   │               ├── auth<br/>│   │               │   └── AppUserService.java<br/>│   │               └── security<br/>│   │                   ├── PasswordEncoder.java<br/>│   │                   ├── RestAuthEntryPoint.java<br/>│   │                   ├── SwaggerConfig.java<br/>│   │                   └── WebSecurityConfig.java<br/>│   └── resources<br/>│       ├── application.properties<br/>│       ├── application.yml<br/>│       ├── data-postgres.sql<br/>│       └── static<br/>└── test<br/>    └── java<br/>        └── com<br/>            └── flamup<br/>                └── spring<br/>                    └── ApplicationTests.java</span></pre><p id="c1d6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">没有必要被吓倒，我们会详细介绍每一个方面。</p><p id="17ea" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将使用maven作为该项目的构建工具。你可以自由使用gradle。</p><p id="d48c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们检查一下我们同样需要的依赖项。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="a87a" class="ma ju hi lw b fi mb mc l md me">&lt;dependencies&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>        &lt;artifactId&gt;spring-boot-starter-data-jdbc&lt;/artifactId&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>        &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>        &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;<br/>        &lt;artifactId&gt;spring-session-core&lt;/artifactId&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;<br/>        &lt;artifactId&gt;spring-session-jdbc&lt;/artifactId&gt;<br/>    &lt;/dependency&gt;<br/><br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;io.springfox&lt;/groupId&gt;<br/>        &lt;artifactId&gt;springfox-boot-starter&lt;/artifactId&gt;<br/>        &lt;version&gt;3.0.0&lt;/version&gt;<br/>    &lt;/dependency&gt;<br/><br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.postgresql&lt;/groupId&gt;<br/>        &lt;artifactId&gt;postgresql&lt;/artifactId&gt;<br/>        &lt;scope&gt;runtime&lt;/scope&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br/>        &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br/>        &lt;optional&gt;true&lt;/optional&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br/>        &lt;scope&gt;test&lt;/scope&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;<br/>        &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;<br/>        &lt;scope&gt;test&lt;/scope&gt;<br/>    &lt;/dependency&gt;<br/>&lt;/dependencies&gt;</span></pre><p id="5c29" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">spring-boot-data-jpa允许我们通过JDBC连接到数据库，并为我们提供查询数据和添加数据的界面。基本上，它为API的所有CRUD操作提供了接口。</p><p id="e3d9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">项目的结构通常如下:</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="fe82" class="ma ju hi lw b fi mb mc l md me"><br/> - Models<br/> - Controllers<br/> - Repositories<br/> - Services</span></pre><p id="1115" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">车型。</strong>它包含实体POJO(Plain Old Java Object ),表示关系数据库中的一个表，在我们的例子中是postgres。javax.persistence包中有许多注释，适合让spring boot理解POJO的细节，并将它们转换成关系数据库的表。</p><p id="31ad" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">控制者。</strong>这为API与外界的通信提供了配置。所有类型的请求映射，如GET、PUT、POST、DELETE，都可以在控制器中配置，并用于为外部世界创建api端点。</p><p id="fe68" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">知识库。</strong>这通常是扩展其他类的接口，提供一些基本方法来处理CRUD操作和其他复杂任务。</p><figure class="lr ls lt lu fd ij er es paragraph-image"><div class="er es mf"><img src="../Images/719b215a294cc94f6b06f24f2e046bdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*sk4Kes5RA--OF8P4Pi71yw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Source : <a class="ae iu" href="https://www.netsurfingzone.com/jpa/spring-data-jpa-interview-questions-and-answers/" rel="noopener ugc nofollow" target="_blank">https://www.netsurfingzone.com/jpa/spring-data-jpa-interview-questions-and-answers/</a></figcaption></figure><p id="a5f3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">作为层次结构，CrudRepository位于顶部，分页和排序存储库具有CrudRepository的方法，并支持对结果进行分页和排序。JPA存储库位于最高级别，支持CrudRepository和分页存储库提供的各种功能。</p><p id="006b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">服务。</strong>这些是控制器调用的实际类，它们依次调用存储库的功能与数据库交互。因此，服务充当了数据库或存储库与控制器或API外部世界之间的桥梁。</p><p id="e06d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们动手看看模型的UML设计。</p><figure class="lr ls lt lu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/139c6d34242c351e06037cd01bbb5ad0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*55VQlx4nkMpBU-mssjRO6w.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Source : <a class="ae iu" href="https://www.jhipster.tech/jdl-studio/" rel="noopener ugc nofollow" target="_blank">https://www.jhipster.tech/jdl-studio/</a></figcaption></figure><p id="dfa6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面的UML图是用JHipster JDL工作室制作的，下面是相同的代码。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="e4d6" class="ma ju hi lw b fi mb mc l md me">entity ApplicationUser{<br/> id Long required,<br/>    firstName String required,<br/>    lastName String required,<br/>    userName String required,<br/>    password String required,<br/>    gender Gender required,<br/>    role AppUserRole required<br/>}</span><span id="71fc" class="ma ju hi lw b fi mh mc l md me">enum AppUserRole{<br/> ADMIN,<br/>    USER<br/>}<br/>enum Gender{<br/> MALE,<br/>    FEMALE<br/>}</span><span id="f90c" class="ma ju hi lw b fi mh mc l md me">entity Product{<br/> id Long required,<br/>    sex Sex required,<br/>    dresstype String required,<br/>    // image uri<br/>    image String required,<br/>    // price as Rs.2,299<br/>    price String required,<br/>    // arrival as "new" or "old"<br/>    arrival String required, <br/>    // discounted price<br/>    discount String required,<br/>    <br/>}</span><span id="9770" class="ma ju hi lw b fi mh mc l md me">enum Sex{<br/> MALE,<br/>    FEMALE<br/>}</span><span id="08eb" class="ma ju hi lw b fi mh mc l md me">entity ShoppingCart{<br/> id Long required,<br/>    userId String required,<br/>}</span><span id="5171" class="ma ju hi lw b fi mh mc l md me">entity OrderItem{<br/> id Long required,<br/>    product Product required,<br/>    quantity Int required,<br/>    cart ShoppingCart required<br/>}</span><span id="bfc8" class="ma ju hi lw b fi mh mc l md me">relationship OneToOne{<br/> OrderItem{product} to Product<br/>}</span><span id="959f" class="ma ju hi lw b fi mh mc l md me">relationship ManyToOne{<br/> OrderItem to ShoppingCart<br/>}</span></pre><p id="b6f1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦我们有了UML设计的想法，让我们开始设计实际的模型或实体类。</p><p id="14a1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我们有应用程序用户类，它实现了spring安全的userDetails。这样做是为了通过spring security执行身份验证。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="b26b" class="ma ju hi lw b fi mb mc l md me"><em class="kz">import </em>lombok.*;<br/><em class="kz">import </em>org.springframework.security.core.GrantedAuthority;<br/><em class="kz">import </em>org.springframework.security.core.authority.SimpleGrantedAuthority;<br/><em class="kz">import </em>org.springframework.security.core.userdetails.UserDetails;<br/><em class="kz">import </em>javax.persistence.*;<br/><em class="kz">import </em>java.util.Collection;<br/><em class="kz">import </em>java.util.Collections;<br/><br/><br/><br/><br/><br/><em class="kz">@Entity<br/>@NoArgsConstructor<br/>@Data<br/>public class </em>ApplicationUser <em class="kz">implements </em>UserDetails {<br/><br/><br/>    <em class="kz">public enum </em>Gender{<br/>        MALE,<br/>        FEMALE<br/>    }<br/><br/>    <em class="kz">@SequenceGenerator</em>(<br/>            name = "student_sequence",<br/>            sequenceName = "student_sequence",<br/>            allocationSize = 1<br/>    )<br/><br/>    <em class="kz">@Id<br/>    @GeneratedValue</em>(<br/>            strategy = GenerationType.SEQUENCE,<br/>            generator = "student_sequence"<br/>    )<br/>    <em class="kz">private </em>Long id;<br/>    <em class="kz">private </em>String firstName;<br/>    <em class="kz">private </em>String lastName;<br/>    <em class="kz">private </em>String username;<br/><br/>    <em class="kz">private </em>String password;<br/>    <em class="kz">private </em>String email;<br/>    <em class="kz">@Enumerated</em>(EnumType.STRING)<em class="kz"><br/>    private </em>AppUserRole appUserRole;<br/>    <em class="kz">@Enumerated</em>(EnumType.STRING)<br/>    <em class="kz">private </em>Gender gender;<br/><br/><br/>    <em class="kz">public </em>ApplicationUser(String firstName,<br/>                           String lastName,<br/>                           String username,<br/>                           String password,<br/>                           String email,<br/>                           AppUserRole appUserRole,<br/>                           Gender gender) {<br/>        <em class="kz">this</em>.firstName = firstName;<br/>        <em class="kz">this</em>.lastName = lastName;<br/>        <em class="kz">this</em>.username = username;<br/>        <em class="kz">this</em>.password = password;<br/>        <em class="kz">this</em>.email = email;<br/>        <em class="kz">this</em>.appUserRole = appUserRole;<br/>        <em class="kz">this</em>.gender = gender;<br/>    }<br/><br/>    <em class="kz">public </em>Long getId(){<br/>        <em class="kz">return  </em>id;<br/>    }<br/>    <em class="kz">public </em>String getFirstName() {<br/>        <em class="kz">return </em>firstName;<br/>    }<br/><br/>    <em class="kz">public void </em>setFirstName(String firstName) {<br/>        <em class="kz">this</em>.firstName = firstName;<br/>    }<br/><br/>    <em class="kz">public </em>String getLastName() {<br/>        <em class="kz">return </em>lastName;<br/>    }<br/><br/>    <em class="kz">public void </em>setLastName(String lastName) {<br/>        <em class="kz">this</em>.lastName = lastName;<br/>    }<br/><br/><br/>    <em class="kz">public </em>String getEmail() { <em class="kz">return </em>username; }<br/><br/>    <em class="kz">public void </em>setEmail(String email) { <em class="kz">this</em>.email = email; }<br/><br/><br/><br/><br/>    <em class="kz">@Override<br/>    public </em>Collection&lt;? <em class="kz">extends </em>GrantedAuthority&gt; getAuthorities() {<br/>        SimpleGrantedAuthority authority =<br/>                <em class="kz">new </em>SimpleGrantedAuthority(appUserRole.name());<br/>        <em class="kz">return </em>Collections.singletonList(authority);<br/>    }<br/><br/>    <em class="kz">@Override<br/>    public </em>String getPassword() {<br/>        <em class="kz">return </em>password;<br/>    }<br/><br/>    <em class="kz">@Override<br/>    public </em>String getUsername() {<br/>        <em class="kz">return </em>email;<br/>    }<br/><br/>    <em class="kz">@Override<br/>    public boolean </em>isAccountNonExpired() {<br/>        <em class="kz">return true</em>;<br/>    }<br/><br/>    <em class="kz">@Override<br/>    public boolean </em>isAccountNonLocked() {<br/>        <em class="kz">return true</em>;<br/>    }<br/><br/>    <em class="kz">@Override<br/>    public boolean </em>isCredentialsNonExpired() {<br/>        <em class="kz">return true</em>;<br/>    }<br/><br/>    <em class="kz">@Override<br/>    public boolean </em>isEnabled() {<br/>        <em class="kz">return true</em>;<br/>    }<br/><br/>    <em class="kz">public void </em>setPassword( String password){<br/>        <em class="kz">this</em>.password = password;<br/>    }<br/><br/>    <em class="kz">public void </em>setUsername( String username ){<br/>        <em class="kz">this</em>.username = username;<br/>    }<br/><br/><br/><br/>}</span></pre><p id="1308" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，正如我们所看到的，有许多重复的Getter和Setter，可以通过<strong class="ix hj"> Lombok </strong>注释、@Getter和@Setter来避免。</p><p id="0145" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是产品项目的模型类。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="3535" class="ma ju hi lw b fi mb mc l md me"><em class="kz">import </em>lombok.*;<br/><br/><em class="kz">import </em>javax.persistence.*;<br/><br/><em class="kz">@Entity<br/>@Table</em>(name = "clothes")<br/><em class="kz">@Getter<br/>@Setter<br/>@NoArgsConstructor<br/>@AllArgsConstructor<br/>@ToString<br/>public class </em>Product {<br/><br/>    <em class="kz">public enum </em>sex{<br/>        MALE,<br/>        FEMALE<br/>    }<br/><br/>    <em class="kz">@Id<br/>    </em>Long id;<br/>    <em class="kz">@Enumerated</em>(EnumType.STRING)<br/><br/>    <em class="kz">@Column</em>(name = "sex")<br/>    sex a_sex;<br/>    <em class="kz">@Column</em>(name = "dresstype")<br/>    String b_dresstype;<br/>    <em class="kz">@Column</em>(name = "image")<br/>    String c_image;<br/>    <em class="kz">@Column</em>(name = "price")<br/>    String d_price;<br/>    <em class="kz">@Column</em>(name = "arrival")<br/>    String e_arrival;<br/>    <em class="kz">@Column</em>(name = "discount")<br/>    <em class="kz">int </em>f_discount;<br/><br/><br/>}</span></pre><p id="0ddd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意“a_”和“b_”这样的语法。这样做是为了让它们按照预定的顺序存储在数据库中，因为Spring JPA按照字母顺序将属性存储为表中的列。</p><p id="0920" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是购物车中每个订单项目的模型，它特定于单个用户(由他/她的电子邮件定义)。ManyToOne注释服务于这个目的。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="9684" class="ma ju hi lw b fi mb mc l md me"><em class="kz">import </em>com.fasterxml.jackson.annotation.<em class="kz">JsonIgnore</em>;<br/><em class="kz">import </em>com.flamup.spring.DTO.OrderDTO;<br/><em class="kz">import </em>lombok.<em class="kz">AllArgsConstructor</em>;<br/><em class="kz">import </em>lombok.<em class="kz">Getter</em>;<br/><em class="kz">import </em>lombok.<em class="kz">NoArgsConstructor</em>;<br/><em class="kz">import </em>lombok.<em class="kz">Setter</em>;<br/><br/><em class="kz">import </em>javax.persistence.*;<br/><em class="kz">import </em>java.util.UUID;<br/><br/><br/><em class="kz">@Entity<br/>@Table</em>(name = "item")<br/><em class="kz">@Getter<br/>@Setter<br/>@NoArgsConstructor<br/>@AllArgsConstructor<br/>public class </em>OrderItem {<br/><br/>    <em class="kz">@Id<br/>    private </em>String id;<br/><br/>    <em class="kz">@OneToOne<br/>    private </em>Product product;<br/><br/>    <em class="kz">@ManyToOne</em>(fetch = FetchType.LAZY, optional = <em class="kz">false</em>)<br/>    <em class="kz">@JoinColumn</em>(name ="cart_id" , nullable = <em class="kz">false</em>)<br/>    <em class="kz">@JsonIgnore<br/>    private </em>ShoppingCart cart;<br/><br/>    <em class="kz">private int </em>quantity;<br/><br/>    <em class="kz">public void </em>fromDto(Product p, ShoppingCart cart, <em class="kz">int </em>quantity ){<br/>        id = UUID.randomUUID().toString().replace("-", "");<br/>        product = p;<br/>        <em class="kz">this</em>.cart = cart;<br/>        <em class="kz">this</em>.quantity = quantity;<br/><br/>    }<br/><br/>}</span></pre><p id="e17d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是购物车的模型类。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="320a" class="ma ju hi lw b fi mb mc l md me"><br/><em class="kz">import </em>lombok.*;<br/><br/><em class="kz">import </em>javax.persistence.*;<br/><em class="kz">import </em>java.time.LocalDateTime;<br/><em class="kz">import </em>java.util.HashSet;<br/><em class="kz">import </em>java.util.Set;<br/><br/><em class="kz">@Entity<br/>@Table</em>(name = "cart")<br/><em class="kz">@AllArgsConstructor<br/>@NoArgsConstructor<br/>@Getter<br/>@Setter<br/>@ToString<br/>public class </em>ShoppingCart {<br/><br/><br/>    <em class="kz">@Id<br/>    @GeneratedValue</em>(strategy = GenerationType.IDENTITY)<br/>    <em class="kz">private </em>Long id;<br/>    <em class="kz">@Column</em>(name = "user_id")<br/>    <em class="kz">private </em>String userId;<br/><br/><br/>    <em class="kz">@OneToMany</em>( mappedBy = "cart", cascade = CascadeType.ALL, fetch = FetchType.LAZY )<br/>    <em class="kz">private </em>Set&lt;OrderItem&gt; items = <em class="kz">new </em>HashSet&lt;&gt;();<br/><br/><br/><br/>}</span></pre><p id="a105" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">唷！我们就快到了，现在让我们看看接受来自服务的调用并与模型一起工作的存储库。</p><p id="3b91" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们看看认证过程是如何工作的。</p><p id="c8fd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先我们有注册控制器，它在获得对“/api/register”的POST请求时调用registrationService的register方法。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="9381" class="ma ju hi lw b fi mb mc l md me"><em class="kz">@RestController<br/>@RequestMapping</em>(path = "api/register")<br/><em class="kz">@AllArgsConstructor<br/>public class </em>RegistrationController {<br/><br/>    <em class="kz">private </em>RegistrationService registrationService;<br/><br/>    <em class="kz">@PostMapping<br/>    public </em>ResponseEntity&lt;String&gt; register(<em class="kz">@RequestBody </em>RegistrationRequest request ){<br/>        <em class="kz">return  new </em>ResponseEntity&lt;String&gt;(registrationService.register(request),HttpStatus.OK);<br/>    }<br/><br/>}</span></pre><p id="8ed0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这项服务有一个功能，可以检查重复的电子邮件，从而用密码编码器对明文密码进行编码，然后将用户的详细信息保存到数据库中。在登录过程中，会检查这些详细信息是否存在于数据库中。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="fac2" class="ma ju hi lw b fi mb mc l md me"><em class="kz">public </em>String signupUser( ApplicationUser applicationUser){<br/>    <em class="kz">boolean </em>userExists = applicationUserRepository<br/>            .findApplicationUsersByEmail(applicationUser.getUsername())<br/>            .isPresent();<br/><br/>    <em class="kz">if </em>( userExists ){<br/>        <em class="kz">throw  new </em>IllegalStateException("email already used, try logging in");<br/>    }<br/><br/>    String encodedPassword = bCryptPasswordEncoder.encode(applicationUser.getPassword());<br/>    applicationUser.setPassword(encodedPassword);<br/><br/>    System.out.println("IN appUserService" + applicationUser);<br/>    applicationUserRepository.save(applicationUser);<br/>    <em class="kz">return </em>"SUCCESS";<br/>}</span></pre><p id="3041" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们稍后将讨论登录部分，因为它将是spring安全配置的一部分。</p><p id="64a6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们看看分页是如何为服务器的GET请求服务的。分页大大有助于减少服务器的负载。</p><p id="e162" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们有产品控制器作为</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="697c" class="ma ju hi lw b fi mb mc l md me"><em class="kz">import </em>javax.servlet.http.HttpServletRequest;<br/><em class="kz">import </em>java.util.ArrayList;<br/><em class="kz">import </em>java.util.HashMap;<br/><em class="kz">import </em>java.util.List;<br/><em class="kz">import </em>java.util.Map;<br/><em class="kz">import </em>java.util.stream.Collectors;<br/><br/><em class="kz">@RestController<br/>@RequestMapping</em>(path = "api/v1/")<br/><em class="kz">@AllArgsConstructor<br/>public class </em>ProductController {<br/><br/>    <em class="kz">private final </em>ProductService productService;<br/><br/>    <em class="kz">@GetMapping</em>(path = "dresses")<br/>    <em class="kz">public </em>HashMap&lt;String, Object&gt; getProductsByDressTypeOnSearch(<em class="kz">@RequestParam</em>(name = "dress") String dress){<br/>        HashMap&lt;String, Object&gt; hs = <em class="kz">new </em>HashMap&lt;&gt;();<br/>        List&lt;Product&gt; products = productService.getProductsByDressType(dress);<br/>        hs.put("products", products);<br/>        hs.put("length" , products.size());<br/>        <em class="kz">return </em>hs;<br/>    }<br/><br/><br/>    <em class="kz">@GetMapping</em>( path = "clothes")<br/>    <em class="kz">public </em>HashMap&lt;String, Object&gt; getProductsBySexAndSession(<br/>            <em class="kz">@RequestParam</em>(name = "sex") String sex,<br/>            <em class="kz">@RequestParam</em>(defaultValue = "10") Integer items,<br/>            <em class="kz">@RequestParam</em>(defaultValue = "0") Integer page,<br/>            HttpServletRequest request){<br/><br/>        List&lt;String&gt; messages = (List&lt;String&gt;) request.getSession().getAttribute("SESSION_STORE");<br/><br/>        <em class="kz">if </em>( messages == <em class="kz">null</em>){<br/>            messages = <em class="kz">new </em>ArrayList&lt;&gt;();<br/>        }<br/><br/>        Map&lt;Boolean, Long&gt; countByType = messages.stream().collect(<br/>                Collectors.partitioningBy(<br/>                        (String msg) -&gt; (msg.equals("O")), Collectors.counting() ));<br/><br/>        <em class="kz">return </em>productService.getProductsBySex(sex,  items, page, countByType);<br/><br/>    }<br/><br/><br/><br/><br/>}</span></pre><p id="befd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">函数<strong class="ix hj">getProductsBySexAndSession</strong>接受两个可选参数，分别表示页面和当前页面中的项目数量。<strong class="ix hj"> countByType </strong>统计新服装与旧服装的交互次数。这调用了productionService的一个函数。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="6fe9" class="ma ju hi lw b fi mb mc l md me"><em class="kz">public </em>HashMap&lt;String, Object&gt; getProductsBySex(String sex, Integer pageSize, Integer page, Map&lt;Boolean, Long&gt; countBySex){<br/><br/>    Pageable paging = PageRequest.of(page , pageSize);<br/>    Page&lt;Product&gt; prods = productRepository.findProductByA_sex(sex, paging);<br/>    List&lt;Product&gt; newProds = productRepository.findProductsByE_arrivalAndA_sex("new" ,sex);<br/>    Integer totalPages = prods.getTotalPages();<br/>    List&lt;Product&gt; products = prods.getContent();<br/>    products = rearrange(products, countBySex, newProds);<br/>    Integer current = page;<br/>    HashMap&lt;String, Object&gt; hs = <em class="kz">new </em>HashMap&lt;&gt;();<br/>    hs.put("current" , current);<br/>    hs.put("products" , products);<br/>    hs.put("total" , totalPages);<br/>    <em class="kz">return </em>hs;<br/><br/>}<br/><br/><br/><em class="kz">private </em>List&lt;Product&gt; rearrange( List&lt;Product&gt; products, Map&lt;Boolean, Long&gt; countBySex, List&lt;Product&gt; newProds){<br/><br/>    List&lt;Product&gt; ll = <em class="kz">new </em>ArrayList&lt;&gt;(products);<br/>    Product ptemp = ll.get(0);<br/>    ll.remove(ptemp);<br/>    ll.add(0, newProds.get(0));<br/><br/><br/>    <em class="kz">if </em>( (<em class="kz">long</em>)( countBySex.get(<em class="kz">true</em>) + countBySex.get(<em class="kz">false</em>) ) == 0){<br/>        <em class="kz">return </em>ll;<br/>    }<br/><br/>    Integer toShift =<br/>            (<em class="kz">int</em>)(<em class="kz">long</em>)( (<em class="kz">double</em>) countBySex.get(<em class="kz">false</em>)  / (countBySex.get(<em class="kz">true</em>) + countBySex.get(<em class="kz">false</em>)) * products.size()) ;<br/><br/>    System.out.println("toShift" + toShift);<br/>    <em class="kz">int </em>pivot = Math.max( 0 , (<em class="kz">int</em>) (Math.random() * 50) - 5 );<br/>    <em class="kz">for </em>( <em class="kz">int </em>start =0; start &lt; Math.min(Math.min(Math.min( products.size() , toShift), newProds.size() ), 7) ; start++){<br/>        Product p = ll.get(start );<br/>        ll.remove(p);<br/>        ll.add(0, newProds.get(start + pivot ));<br/>    }<br/>    <em class="kz">return </em>ll;<br/>}</span></pre><p id="346f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以上是根据相关网站的每页商品数量及其交互返回商品的算法。下面是产品存储库的代码。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="bd05" class="ma ju hi lw b fi mb mc l md me"><em class="kz">@Repository<br/>@Transactional<br/>public interface </em>ProductRepository <em class="kz">extends </em>JpaRepository&lt;Product, Long&gt; {<br/><br/><br/>    Optional&lt;Product&gt; findProductById( Long id);<br/><br/>    <em class="kz">@Query</em>("select p from Product p where LOWER(p.b_dresstype) LIKE LOWER(CONCAT('%', :type, '%'))")<br/>    List&lt;Product&gt; findProductsByB_Dresstype(<em class="kz">@Param</em>("type") String type);<br/><br/>    <em class="kz">@Query</em>(value = "select p from Product p where LOWER(p.a_sex)=lower(:sex) order by p.e_arrival desc ")<br/>    Page&lt;Product&gt; findProductByA_sex(<em class="kz">@Param</em>("sex") String sex, Pageable paging);<br/><br/>    <em class="kz">@Query</em>(value = "select p from Product p where LOWER(p.e_arrival)=LOWER(:arrival) and LOWER(p.a_sex)=LOWER(:sex)")<br/>    List&lt;Product&gt; findProductsByE_arrivalAndA_sex(<em class="kz">@Param</em>("arrival") String arrival, <em class="kz">@Param</em>("sex") String sex);<br/><br/><br/>}</span></pre><p id="184f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，查询注释用于为我们的目的编写定制查询。Spring boot支持原生查询，即包含原始SQL语句，而不是Hibernate创建的SQL语句。</p><p id="1513" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，我们只剩下购物车服务，它具有在购物车中添加商品、更新购物车中商品的数量以及从购物车中删除商品的功能。</p><p id="9fc2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是用于定义后端将被调用的端点的控制器，</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="e9f3" class="ma ju hi lw b fi mb mc l md me"><em class="kz">@RestController<br/>@RequestMapping</em>(path = "api/v1/")<br/><em class="kz">@AllArgsConstructor<br/>public class </em>CartServiceController {<br/><br/>    <em class="kz">private final </em>CartService cartService;<br/><br/><br/>    <em class="kz">@PostMapping</em>( path = "add")<br/>    <em class="kz">public </em>ResponseEntity&lt;String&gt; addProduct(<em class="kz">@RequestBody </em>OrderDTO orderDTO ){<br/>        <em class="kz">return new </em>ResponseEntity&lt;String&gt;(cartService.addToCart(orderDTO) , HttpStatus.CREATED);<br/>    }<br/><br/>    <em class="kz">@GetMapping</em>( path = "orders")<br/>    <em class="kz">public </em>ResponseEntity&lt;HashMap&lt;String , Object&gt;&gt; getOrders(){<br/>        <em class="kz">return new </em>ResponseEntity&lt;&gt;(cartService.getProducts(), HttpStatus.OK);<br/>    }<br/><br/>    <em class="kz">@PutMapping</em>(path = "order")<br/>    <em class="kz">public </em>ResponseEntity&lt;String&gt; updateOrder(<em class="kz">@RequestBody </em>UpdateOrderDTO updateOrderDTO){<br/>        <em class="kz">return new </em>ResponseEntity&lt;&gt;(cartService.updateOrder( updateOrderDTO ), HttpStatus.CREATED);<br/>    }<br/><br/>    <em class="kz">@DeleteMapping</em>( path = "order/{id}")<br/>    <em class="kz">public </em>ResponseEntity&lt;String&gt; deleteOrder(<em class="kz">@PathVariable </em>String id){<br/>        <em class="kz">return new </em>ResponseEntity&lt;&gt;(cartService.deleteOrder(id), HttpStatus.OK);<br/>    }<br/><br/><br/>}</span></pre><p id="8106" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们有两个数据传输对象(DTO)。DTO用于在客户端和API的服务之间传输信息。</p><p id="3bf0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们来定义一下，</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="5ecf" class="ma ju hi lw b fi mb mc l md me"><em class="kz">@Getter<br/>@Setter<br/>@NoArgsConstructor<br/>@AllArgsConstructor<br/>public class </em>OrderDTO {<br/><br/>    <em class="kz">private </em>Long productId;<br/>    <em class="kz">private int </em>quantity;<br/><br/>}</span><span id="4f14" class="ma ju hi lw b fi mh mc l md me"><em class="kz">@Getter<br/>@Setter<br/>@NoArgsConstructor<br/>@AllArgsConstructor<br/>public class </em>UpdateOrderDTO {<br/>    <em class="kz">private </em>String id;<br/>    <em class="kz">private </em>Integer quantity;<br/>}</span></pre><p id="8e00" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们看看购物车服务，</p><p id="84b0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如我们所见，它支持POST、GET、PUT、DELETE，是一个完美的例子。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="eab0" class="ma ju hi lw b fi mb mc l md me"><em class="kz">@Service<br/>public class </em>CartService {<br/><br/>    <em class="kz">private final </em>CartRepository cartRepository;<br/>    <em class="kz">private final </em>ProductRepository productRepository;<br/>    <em class="kz">private final </em>OrderRepository orderRepository;<br/><br/><br/>    <em class="kz">@Autowired<br/>    public </em>CartService(CartRepository cartRepository,<br/>                       ProductRepository productRepository,<br/>                       OrderRepository orderRepository<br/>                       ) {<br/>        <em class="kz">this</em>.cartRepository = cartRepository;<br/>        <em class="kz">this</em>.productRepository = productRepository;<br/>        <em class="kz">this</em>.orderRepository = orderRepository;<br/>    }<br/><br/>    <em class="kz">public </em>String addToCart(OrderDTO order){<br/>        Object principal = SecurityContextHolder.getContext().getAuthentication().getPrincipal();<br/><br/>        <em class="kz">if </em>( principal <em class="kz">instanceof </em>UserDetails) {<br/><br/>            Optional&lt;ShoppingCart&gt; cartFromRepo = cartRepository.findByUserId(((UserDetails) principal).getUsername());<br/>            ShoppingCart cart;<br/>            <em class="kz">if </em>( ! cartFromRepo.isPresent() ){<br/>                cart = <em class="kz">new </em>ShoppingCart();<br/>                cart.setUserId(((UserDetails) principal).getUsername());<br/>                cartRepository.save(cart);<br/>            }<br/>            <em class="kz">else</em>{<br/>                cart = cartFromRepo.get();<br/>            }<br/><br/>            OrderItem item = <em class="kz">new </em>OrderItem();<br/>            Product pt = productRepository.findProductById(order.getProductId())<br/>                    .orElseThrow( () -&gt; <em class="kz">new </em>IllegalStateException("product not found"));<br/>            item.fromDto(pt, cart, order.getQuantity());<br/><br/>            orderRepository.save(item);<br/>            <em class="kz">return </em>"SUCCESS";<br/>        }<br/>        <em class="kz">else</em>{<br/>            <em class="kz">throw  new </em>IllegalStateException("user not authenticated");<br/>        }<br/>    }<br/><br/><br/>    <em class="kz">private </em>Integer sanitizePrice( String price) {<br/>        <em class="kz">// price with Rs.2,244 --&gt; 2244<br/>        </em>price  = price.substring(3).replace(",", "");<br/>        <em class="kz">return </em>Integer.parseInt(price);<br/>    }<br/><br/><br/><br/>    <em class="kz">public </em>HashMap&lt;String, Object&gt; getProducts(){<br/>        Object principal = SecurityContextHolder.getContext().getAuthentication().getPrincipal();<br/>        HashMap&lt;String, Object&gt; hs = <em class="kz">new </em>HashMap&lt;&gt;();<br/>        hs.put("products" , <em class="kz">new </em>ArrayList&lt;&gt;());<br/>        hs.put("total" , 0);<br/>        <em class="kz">if </em>( principal <em class="kz">instanceof </em>UserDetails) {<br/>            Optional&lt;ShoppingCart&gt; cartFromRepo = cartRepository.findByUserId(((UserDetails) principal).getUsername());<br/>            ShoppingCart cart;<br/>            <em class="kz">if </em>( ! cartFromRepo.isPresent() ){<br/>                <em class="kz">return </em>hs;<br/>            }<br/>            cart = cartFromRepo.get();<br/>            ArrayList&lt;OrderItem&gt; orders = <em class="kz">new </em>ArrayList&lt;&gt;(orderRepository.findByCart_Id(cart.getId()));<br/>            hs.put("products" ,  orders);<br/>            <em class="kz">int </em>price =0;<br/>            <em class="kz">for </em>( OrderItem order : orders ){<br/>                <em class="kz">if </em>( order.getProduct().getE_arrival().toLowerCase(Locale.ROOT).equals("old")){<br/>                    price += order.getQuantity() * order.getProduct().getF_discount();<br/>                }<br/>                <em class="kz">else </em>{<br/>                    price += order.getQuantity() * sanitizePrice(order.getProduct().getD_price());<br/>                }<br/>            }<br/>            hs.put("total", price);<br/>            <em class="kz">return </em>hs;<br/>        }<br/>        <em class="kz">else</em>{<br/>            <em class="kz">throw  new </em>IllegalStateException("user not authenticated");<br/>        }<br/>    }<br/><br/><br/><br/>    <em class="kz">public </em>String updateOrder(UpdateOrderDTO updateOrderDTO){<br/>        OrderItem item = orderRepository.findById(updateOrderDTO.getId())<br/>                .orElseThrow(()-&gt;<em class="kz">new </em>IllegalStateException("order does not exist"));<br/><br/>        item.setQuantity(updateOrderDTO.getQuantity());<br/>        orderRepository.save(item);<br/>        <em class="kz">return </em>"SUCCESS";<br/>    }<br/><br/><br/>    <em class="kz">public </em>String deleteOrder( String id){<br/>        OrderItem item = orderRepository.findById(id)<br/>                .orElseThrow(()-&gt;<em class="kz">new </em>IllegalStateException("order does not exist"));<br/>        orderRepository.delete(item);<br/>        <em class="kz">return </em>"DELETED";<br/>    }<br/><br/><br/>}</span></pre><p id="191c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，在介绍了服务之后，让我们定义spring安全配置，它将定义会话管理以及用户登录和注册到我们的web应用程序。现在，我们将通过JDBC身份验证来执行用户登录，还有许多其他身份验证方法，您可以在文档中查看。Spring security是一个很大的话题，值得一学。</p><p id="8d10" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是安全配置，</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="f307" class="ma ju hi lw b fi mb mc l md me"><em class="kz">@Configuration<br/>@EnableWebSecurity<br/>public class </em>WebSecurityConfig <em class="kz">extends </em>WebSecurityConfigurerAdapter {<br/><br/>    <em class="kz">private final </em>PasswordEncoder passwordEncoder;<br/>    <em class="kz">private final </em>AppUserService appUserService;<br/><br/>    <em class="kz">@Autowired<br/>    </em>RestAuthEntryPoint restAuthEntryPoint;<br/><br/>    <em class="kz">@Autowired<br/>    private </em>CustomLogoutHandler logoutHandler;<br/>    <br/>    <em class="kz">@Autowired<br/>    public </em>WebSecurityConfig(PasswordEncoder passwordEncoder, AppUserService appUserService) {<br/>        <em class="kz">this</em>.passwordEncoder = passwordEncoder;<br/>        <em class="kz">this</em>.appUserService = appUserService;<br/>    }<br/><br/>    <em class="kz">@Override<br/>    public void </em>configure(WebSecurity registry) <em class="kz">throws </em>Exception {<br/>        registry.ignoring()<br/>                .antMatchers("/docs/**")<br/>                .antMatchers("/actuator/**")<br/>                .antMatchers("/swagger-ui.html")<br/>                .antMatchers("/webjars/**");<br/>    }<br/><br/>    <em class="kz">@Override<br/>    protected void </em>configure(AuthenticationManagerBuilder auth) <em class="kz">throws </em>Exception {<br/>        auth.authenticationProvider(daoAuthenticationProvider());<br/>        <br/>    }<br/><br/>    <br/><br/>    <em class="kz">@Override<br/>    protected void </em>configure(HttpSecurity http) <em class="kz">throws </em>Exception {<br/>        http.<br/>                csrf().disable()<br/>                .authorizeRequests()<br/>                .antMatchers("/","/static/**", "index*", "/css/*", "/js/*","/media/*","*.ico","*.png").permitAll()<br/>                .antMatchers("/api/register").permitAll()<br/>                .antMatchers("/api/auth").permitAll()<br/>                .antMatchers("/api/persist/**").authenticated()<br/><br/>                .antMatchers("/api/v1/**").authenticated()<br/>                .antMatchers("/admin/api/**").hasRole(ADMIN.name())<br/>                .and()<br/>                .exceptionHandling()<br/>                .authenticationEntryPoint(restAuthEntryPoint)<br/>                .and()<br/>                .formLogin()<br/>                    .loginProcessingUrl("/api/login")<br/>                    .permitAll()<br/>                .and()<br/>                .logout()<br/>                .logoutUrl("/api/logout")<br/>                .invalidateHttpSession(<em class="kz">true</em>)<br/>                .deleteCookies("JSESSIONID")<br/>                .clearAuthentication(<em class="kz">true</em>)<br/>                .addLogoutHandler(logoutHandler)<br/>                .logoutSuccessHandler(<em class="kz">new </em>HttpStatusReturningLogoutSuccessHandler(HttpStatus.OK));<br/>        <br/>    }<br/><br/><br/>    <em class="kz">@Bean<br/>    public </em>DaoAuthenticationProvider daoAuthenticationProvider(){<br/>        DaoAuthenticationProvider provider = <em class="kz">new </em>DaoAuthenticationProvider();<br/>        provider.setPasswordEncoder(passwordEncoder);<br/>        provider.setUserDetailsService(appUserService);<br/>        <em class="kz">return </em>provider;<br/>    }<br/>}</span></pre><p id="324a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">antMathers匹配任何带有提供给服务器的url的regex，并被配置为authenticated或permitAll()。我们同样使用form-login，即它接受对配置中定义的端点“api/login”的<strong class="ix hj">应用程序/x-www-form-urlencoded </strong> post请求。注销发生在URL“API/logout ”,并清除所有cookies和验证。该配置用于基于ReactJs的前端，它是一个单页面web应用程序，或者从应用程序的静态内容或资源文件夹提供单个index.html页面。让我们看一下我们的application.properties文件。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="24b0" class="ma ju hi lw b fi mb mc l md me">server.error.include-message=always<br/>server.error.include-binding-errors=always<br/><br/><br/>spring.datasource.url=jdbc:postgresql://db:5432/flamup<br/>spring.datasource.username=postgres<br/>spring.datasource.password=postgres<br/><br/>spring.jpa.hibernate.ddl-auto=update<br/>spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect<br/>spring.jpa.properties.hibernate.format-sql=true<br/>spring.jpa.show-sql=<em class="kz">true<br/><br/><br/></em>spring.session.jdbc.initialize-schema=always<br/>spring.session.jdbc.table-name=SPRING_SESSION<br/>spring.session.store-type=jdbc</span></pre><p id="bb7e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">数据源url中的db是在docker配置中定义的，它的uri在运行时存在。</p><p id="f0c7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">随着万物被春天覆盖，让我们看看我们如何能把它整理好。</p><p id="4ea8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">码头工人简介</strong></p><figure class="lr ls lt lu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/c0be435cc92cdfb4de2054677e6737d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9f3zr-y_JEa-qAtC"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@exdigy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Dominik Lückmann</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><blockquote class="kw kx ky"><p id="c19b" class="iv iw kz ix b iy iz ja jb jc jd je jf la jh ji jj lb jl jm jn lc jp jq jr js hb bi translated">Docker是一组平台即服务产品，使用操作系统级虚拟化来交付称为容器的软件包中的软件。容器是相互隔离的，捆绑了它们自己的软件、库和配置文件；他们可以通过明确定义的渠道相互交流。</p></blockquote><p id="99bb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最重要的是，docker帮助我们将应用程序容器化，并为不同的应用程序相互通信提供一个公共的网桥。</p><p id="5586" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了形成一个容器，我们需要在项目的根目录中定义一个DockerFile。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="bbb6" class="ma ju hi lw b fi mb mc l md me">FROM maven:3.6.1-jdk-8-slim AS build<br/>RUN mkdir -p workspace<br/>WORKDIR workspace<br/>COPY pom.xml /workspace<br/>COPY src /workspace/src<br/>COPY frontend /workspace/frontend<br/>COPY data2.csv /workspace<br/>RUN mvn -f pom.xml clean install -DskipTests=true</span><span id="77c4" class="ma ju hi lw b fi mh mc l md me"><em class="kz"><br/></em>FROM openjdk:8-alpine<br/>COPY --from=build /workspace/target/*.jar app.jar<em class="kz"><br/></em>EXPOSE 8080<br/>ENTRYPOINT ["java","-jar","app.jar"]</span></pre><p id="8085" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，我们获取一个maven映像，首先通过将所有必需的文件复制到容器中来构建jar文件。</p><p id="8983" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">jar文件形成后，我们从maven容器中复制jar文件，并将其复制到openjdk容器中，最终运行编译器。然而除此之外，我们还需要一个postgres数据库来运行我们的容器。因此，我们需要一个postgres映像和我们应用程序的容器，postgres容器应该通过一个<strong class="ix hj">公共网络</strong>连接起来，以便它们通过彼此通信。有两种方法可以实现这一点，第一种是</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="9bfa" class="ma ju hi lw b fi mb mc l md me">docker create network net1<br/>docker run postgres --network net1 -e POSTGRES_USER=postgres ...<br/>...</span></pre><p id="9506" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而这需要写太多的配置参数不是很合适。Docker-Compose是另一种拯救方法，它将不同的服务结合起来，并通过所需的网络将它们结合起来，以便它们可以通过彼此通信。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="8c00" class="ma ju hi lw b fi mb mc l md me">version: '3'<br/><br/>services:<br/><br/>  db:<br/>    image: "postgres:9.6-alpine"<br/>    container_name: db<br/>    restart: always<br/><br/>    ports:<br/>      - 5432:5432<br/><br/><em class="kz">    volumes:<br/>      - postgres_data:/var/lib/postgresql/data<br/><br/>    </em>environment:<br/>      - POSTGRES_DB=flamup<br/>      - POSTGRES_USER=postgres<br/>      - POSTGRES_PASSWORD=postgres<br/>      - PGDATA=/var/lib/postgresql/data/pgdata<br/><br/><br/>  flamup:<br/>    build: ./<br/>    container_name: flamup<br/>    environment:<br/>      - DB_SERVER:db<br/>      - POSTGRES_DB=flamup<br/>      - POSTGRES_USER=postgres<br/>      - POSTGRES_PASSWORD=postgres<br/>    ports:<br/>      - 8080:8080 <em class="kz"># Forward the exposed port 8080 on the container to port 8080 on the host machine<br/><br/>    </em>depends_on:<br/>      - db<br/><br/><br/><br/>volumes:<br/>  postgres_data:</span></pre><p id="e6bd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，默认情况下，docker-compose会根据flamup服务中的依赖参数创建一个默认网络。db服务将容器端口5432映射到主机端口5432，而flamup或web-app服务将容器端口5432映射到主机端口5432。我们还可以定义容器所需的环境变量。</p><p id="465c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行这个非常简单，只要在系统上安装了docker和docker，只需一行代码就可以完成。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="0d20" class="ma ju hi lw b fi mb mc l md me">docker-compose up --build</span></pre><figure class="lr ls lt lu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/1676f5a021914ce4d2a0cbce6b22156e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JgsBClGy0AYIZvZE3wD7Lg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Running of docker-compose up</figcaption></figure><p id="443c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦构建了容器，就可以在下一次运行。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="d424" class="ma ju hi lw b fi mb mc l md me">docker-compose up</span></pre><p id="2ed7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，应用程序已经启动并运行，可以通过<a class="ae iu" href="http://localhost:8080." rel="noopener ugc nofollow" target="_blank"> http://localhost:8080进行访问。</a></p><figure class="lr ls lt lu fd ij er es paragraph-image"><div class="er es mk"><img src="../Images/db9f3b2ed776b8735be4133d6685c499.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*VPAWzCG1MbFX8wdw6ea2yA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">A register post request</figcaption></figure><figure class="lr ls lt lu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/2c0f285dfe1c976b26400aad34090c3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tRRr6DgieoDEbgx4DaUk7g.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">A login post request</figcaption></figure><p id="b503" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以本文到此结束。我将在基于ReactJS和material-UI库的前端基础上写两篇文章。这里是前端的一瞥。</p><figure class="lr ls lt lu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/e0765b89cbc8b46583d90bf91441b1c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MDoDEOScFX4v8XTLPGYuEg.png"/></div></div></figure><figure class="lr ls lt lu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/3d44df09150289f6d2e52cb8e2d8ff0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XeHMz-ehgN47UKWBUTyUSg.png"/></div></div></figure><p id="2b05" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在讨论了前端之后，我还会写一篇文章来讨论AWS上这个应用程序的托管以及未来的展望。所以一定要保持关注，一定要关注我。</p><p id="b52f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://twitter.com/TheSYNcoder" rel="noopener ugc nofollow" target="_blank">Twitter</a><a class="ae iu" href="https://www.linkedin.com/in/shuvayan-ghosh-dastidar-3b5383166/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a></p><p id="f97c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，我们将在另一篇文章中再见。</p><p id="e522" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">再见。</p><h2 id="7329" class="ma ju hi bd jv mn mo mp jz mq mr ms kd jg mt mu kh jk mv mw kl jo mx my kp mz bi translated">参考</h2><p id="97f9" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">[1]春安安全登出—<a class="ae iu" href="https://www.baeldung.com/spring-security-logout" rel="noopener ugc nofollow" target="_blank">https://www.baeldung.com/spring-security-logout</a></p><p id="1914" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">[2] JPA查询注释—<a class="ae iu" href="https://www.petrikainulainen.net/programming/spring-framework/spring-data-jpa-tutorial-creating-database-queries-with-the-query-annotation/" rel="noopener ugc nofollow" target="_blank">https://www . petrikainulainen . net/programming/spring-framework/spring-data-JPA-tutorial-creating-database-queries-with-the-Query-annotation/</a></p><p id="2076" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">[3] JPA一对多映射—<a class="ae iu" href="https://grokonez.com/spring-framework/spring-boot/spring-jpa-hibernate-one-to-many-association-postgresql-springboot-crud-restapis-post-get-put-delete-example" rel="noopener ugc nofollow" target="_blank">https://grokonez . com/spring-framework/spring-boot/spring-JPA-hibernate-一对多关联-PostgreSQL-spring boot-crud-restapis-post-get-put-delete-example</a></p><p id="5ced" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">[4]Spring Boot应用程序Docker Compose—<a class="ae iu" href="https://dev.to/techtter/docker-compose-demo-example-with-angular-spring-boot-postgresql-3do8" rel="noopener ugc nofollow" target="_blank">https://dev . to/tech tter/Docker-Compose-demo-example-with-angular-spring-boot-PostgreSQL-3d o8</a></p></div></div>    
</body>
</html>