<html>
<head>
<title>Build a Web Application to Chat With Your Facebook Page Users</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个Web应用程序来与您的脸书页面用户聊天</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/build-a-web-application-to-chat-with-your-facebook-page-users-8daef45b3c26?source=collection_archive---------18-----------------------#2021-12-06">https://medium.com/geekculture/build-a-web-application-to-chat-with-your-facebook-page-users-8daef45b3c26?source=collection_archive---------18-----------------------#2021-12-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6201fc8ba230edf774de8f313cb83754.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7h-nTzbYsGw-4psFfb321g.png"/></div></div></figure><h1 id="2a20" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">介绍</h1><p id="a6a9" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated"><a class="ae km" href="https://developer.nexmo.com/messages/overview" rel="noopener ugc nofollow" target="_blank">消息API </a>正在被集成到<a class="ae km" href="https://developer.nexmo.com/client-sdk/overview" rel="noopener ugc nofollow" target="_blank">客户端SDK </a>中。这将提供一个简单的方法，让你的客户可以通过Facebook Messenger、WhatsApp、Viber等等与你创建的应用程序进行交流。</p><p id="5769" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">在这篇博文结束时，您将拥有一个能够从您的脸书页面和页面信使发送和接收消息的web应用程序。将提供示例代码，并解释消息API集成的相关部分。</p><h1 id="210f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">创建脸书页面</h1><p id="c28e" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">登录脸书和<a class="ae km" href="https://www.facebook.com/pages/creation/" rel="noopener ugc nofollow" target="_blank">创建一个测试脸书页面</a>。您也可以使用已经存在的页面进行测试。</p><h1 id="8781" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">设置示例web应用程序</h1><p id="907f" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">通过<a class="ae km" href="https://glitch.com/edit/#!/remix/messages-inbound-demo" rel="noopener ugc nofollow" target="_blank">重新混合这个小故障</a>，制作您的示例web应用程序的副本。要设置应用程序，请按照自述文件中的步骤操作。示例应用程序遵循代理登录仪表板的场景，以及脸书页面客户和代理之间的当前对话。左侧是所有对话发生的地方，代理可以加入其中一个。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/067d6802bfd086be5ae61c8ab3e21db1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*THzAE2WZWAtm2KQENkKi3g.png"/></div></div></figure><p id="80a7" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">当代理单击一个对话时，与脸书用户的聊天应用程序将在一个新窗口中打开。聊天应用程序基于在<a class="ae km" href="https://developer.nexmo.com/client-sdk/tutorials/in-app-messaging" rel="noopener ugc nofollow" target="_blank">创建聊天应用程序教程</a>中创建的应用程序。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/a639225504037c8ccabc57f51e58ff6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R4gDIOGMEvAU-aqJ_bCYNQ.png"/></div></div></figure><h1 id="03c0" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">将您的脸书页面链接到您的Vonage应用程序</h1><p id="5045" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">剩下的设置就是将您的脸书页面连接到web应用程序，以便它们可以相互通信。以下是步骤:</p><ul class=""><li id="77b2" class="ky kz hi jq b jr kn jv ko jz la kd lb kh lc kl ld le lf lg bi translated">登录<a class="ae km" href="https://dashboard.nexmo.com" rel="noopener ugc nofollow" target="_blank"> Vonage仪表盘</a></li><li id="12f5" class="ky kz hi jq b jr lh jv li jz lj kd lk kh ll kl ld le lf lg bi translated">在“消息和调度”下，点击“社交渠道”</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lm"><img src="../Images/9e1163dbcdb52cc0363bd99dfcd6cad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:534/format:webp/1*9dIiVTbecsSfwA6I8JmAYg.png"/></div></figure><ul class=""><li id="c2d4" class="ky kz hi jq b jr kn jv ko jz la kd lb kh lc kl ld le lf lg bi translated">在“社交频道”页面，点击Facebook Messenger</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/df1078dbe3a0cbc1874f40738bc61b44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JZXs0s4Wcje70WvnJkf_3w.png"/></div></div></figure><ul class=""><li id="8787" class="ky kz hi jq b jr kn jv ko jz la kd lb kh lc kl ld le lf lg bi translated">按照步骤将您的脸书页面连接到您的Vonage帐户</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/b81e41dd0d5503af6725e61474bb69bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eeCB8wD8GrwPQX-YYvQdFA.png"/></div></div></figure><ul class=""><li id="ea6c" class="ky kz hi jq b jr kn jv ko jz la kd lb kh lc kl ld le lf lg bi translated">选择要连接到Vonage的脸书页面</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/a82f55bb0cb2152e9fe11049a74cfa1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-9Z-1j4C7I-lhZxHisEgsg.png"/></div></div></figure><ul class=""><li id="974b" class="ky kz hi jq b jr kn jv ko jz la kd lb kh lc kl ld le lf lg bi translated">验证您使用的是正确的脸书帐户</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/42f3c2ccd1dcbf8d81319d040c6a8839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KYYjsegOGLeH13PppdhFwA.png"/></div></div></figure><ul class=""><li id="1bc1" class="ky kz hi jq b jr kn jv ko jz la kd lb kh lc kl ld le lf lg bi translated">查看授予Vonage的权限</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/678f76c4c639ac2cd99b23050c1bb433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9JMFB4A3GdOad9tBzE82nQ.png"/></div></div></figure><ul class=""><li id="2a0a" class="ky kz hi jq b jr kn jv ko jz la kd lb kh lc kl ld le lf lg bi translated">确认Vonage能够成功链接</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/ceb7a9e680c48f41cb4cb16ae6c22c2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WeweUMfvifeCRQuX75fFYQ.png"/></div></div></figure><ul class=""><li id="62e5" class="ky kz hi jq b jr kn jv ko jz la kd lb kh lc kl ld le lf lg bi translated">选择链接到Vonage的脸书页面并完成设置</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/225aad9aee7780f449ad6f92be20ee11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WnBFmJUP_ReSld98xwQCSg.png"/></div></div></figure><ul class=""><li id="657b" class="ky kz hi jq b jr kn jv ko jz la kd lb kh lc kl ld le lf lg bi translated">祝贺您，您的脸书页面已成功连接</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/5445ae5b45ddf30039da2bfcadddbb70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4UMjK8zUUD9N2Cxv5hOtBA.png"/></div></div></figure><ul class=""><li id="ab91" class="ky kz hi jq b jr kn jv ko jz la kd lb kh lc kl ld le lf lg bi translated">现在，Vonage知道了您的脸书页面，让我们连接到您的Vonage应用程序，它是在您用Glitch设置示例时创建的。单击“链接到应用程序”或转到仪表板的“应用程序”部分。</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/b2c85ef55e2cd7c08fd9f2eadec9338d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oo43nvHu4fjON12hie5pjw.png"/></div></div></figure><ul class=""><li id="2a66" class="ky kz hi jq b jr kn jv ko jz la kd lb kh lc kl ld le lf lg bi translated">选择您在设置故障样本时创建的应用程序，然后单击“链接”。</li></ul><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/ac80b6654a7e67e7ccf3496a8c7ba8c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pvwsDwGFCXU7XIb71CAEig.png"/></div></div></figure><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/2d2e91c2af3e6b0606d4c15d34ea8261.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vBI1l6MPluZYAFwFbro0sg.png"/></div></div></figure><h1 id="0ff8" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">尝试一下</h1><p id="cd58" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">将网络应用程序放在一个浏览器窗口中，在另一个窗口中打开<a class="ae km" href="https://messenger.com" rel="noopener ugc nofollow" target="_blank"> Facebook Messenger </a>，并在必要时登录。如果您还没有，请在web应用程序中输入一个名称以进入仪表板。把这个当成你的名字或者代理的名字，只是一个简单的“登录”方式。现在，在Messenger中，找到您链接到该应用程序的脸书页面并发送消息。在web应用程序的窗口中,“所有对话”部分应该会出现一个小卡片。单击join，将打开一个聊天应用程序，您应该会在聊天中看到该消息。从聊天应用程序发送消息，它应该会出现在您的Facebook Messenger中。</p><h1 id="8045" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">正在发生什么</h1><p id="9dfe" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">让我们来看看实现上述功能所涉及的代码。当用户向您的脸书页面发送消息时，它会被Vonage发送到您的web应用程序的入站webhook。webhook返回一个对象，让Vonage知道如何处理消息。在这种情况下，我们发送回客户端SDK消息API集成将脸书用户与您的web应用程序连接起来进行对话所需的信息。这包括脸书用户的id和对话名称(我们将其设置为脸书用户的id，这样它是唯一的)。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="6257" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">如果这是脸书用户第一次发送消息，则会创建一个新对话。这发出了一个我们在events webhook上监听的<code class="du ly lz ma mb b">conversation:created</code>事件。web应用程序的后端接收该事件，并将其重新打包为一个定制事件<code class="du ly lz ma mb b">custom:new_conv</code>，该事件可用于通知代理的仪表板显示新的对话。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="ab5c" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">在聊天应用程序的代码中，有一个<code class="du ly lz ma mb b">message:received</code>事件监听器，当收到来自脸书用户的消息时会触发这个监听器。然后，它获取消息并将其添加到聊天显示中。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="007e" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">当代理回复脸书用户时，这是一条出站消息。客户端SDK中出站消息的完全实现将在未来的版本中完成。在此之前，就像监听何时创建新对话一样，我们可以监听何时将<code class="du ly lz ma mb b">custom:chat</code>事件发送到events webhook。Vonage节点SDK用于将代理的消息转发给脸书用户。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="6299" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">对于那些想知道的人，<code class="du ly lz ma mb b">FB_RECIPIENT_ID</code>也是脸书用户发送初始消息时设置的对话名称。获取脸书页面Id<code class="du ly lz ma mb b">FB_SENDER_ID</code>的值稍微复杂一些。当一个代理打开一个聊天时，一个请求被发送到服务器的<code class="du ly lz ma mb b">getChatAppAccounts</code>端点，该端点使用管理员JWT调用Vonage的<code class="du ly lz ma mb b">chatapp-accounts</code> API。脸书页面Id在响应中，我们将其发送回客户端。好消息是，当出站消息被集成时，您将不必担心这些，客户端SDK会处理好一切。这是一个客户端SDK在开发应用程序时非常有用的例子。</p><h1 id="241f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">小陷阱</h1><p id="2dbf" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如果您的出站消息突然停止工作，请检查您的服务器日志中是否有任何错误。如果您遇到这样的错误:</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="a8a7" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">这意味着您的脸书页面令牌已过期，需要刷新。登录Vonage仪表盘，进入<a class="ae km" href="https://dashboard.nexmo.com/messages/social-channels" rel="noopener ugc nofollow" target="_blank">消息和调度，然后进入社交频道</a>。在你的脸书页面旁边应该有一个按钮来刷新你的令牌。</p><h1 id="31b3" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">结论</h1><p id="d4d4" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">就是这样！有了集成到客户端SDK中的Messages API，从您自己的web应用程序与脸书用户通信就容易多了。</p><h1 id="34e5" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">后续步骤</h1><p id="9b04" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">请看看我们的<a class="ae km" href="https://developer.nexmo.com/client-sdk/overview" rel="noopener ugc nofollow" target="_blank">客户端SDK文档</a>。还有更多关于创建代理仪表板的方法的信息，以及教程、指南等。演示应用程序遇到过任何问题吗？想增加新功能吗？任何问题、评论和/或反馈，请在我们的<a class="ae km" href="https://developer.nexmo.com/slack" rel="noopener ugc nofollow" target="_blank">社区Slack频道</a>中告诉我们</p></div><div class="ab cl mc md gp me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hb hc hd he hf"><p id="29bc" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated"><em class="mj">最初发布于</em><a class="ae km" href="https://learn.vonage.com/blog/2021/10/14/build-a-web-application-to-chat-with-your-facebook-page-users/" rel="noopener ugc nofollow" target="_blank"><em class="mj">https://learn . vonage . com/blog/2021/10/14/build-a-web-application-to-chat-with-your-Facebook-page-users/</em></a></p></div></div>    
</body>
</html>