<html>
<head>
<title>Working with details of location in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Swift中处理位置细节</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/working-with-details-of-location-in-swiftui-faf7b139270b?source=collection_archive---------3-----------------------#2022-07-26">https://medium.com/geekculture/working-with-details-of-location-in-swiftui-faf7b139270b?source=collection_archive---------3-----------------------#2022-07-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es im"><img src="../Images/de1daff4a75e1c58bda28a80f2426b60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tvpyC4jZUYIBmsIA"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx">Photo by <a class="ae jc" href="https://unsplash.com/@claybanks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Clay Banks</a> on <a class="ae jc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f18a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在这篇文章中，我们将获取基于坐标的位置细节，反之亦然。这两段代码在使用MapKit时非常有用。</p><h2 id="96f2" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jo km kn ko js kp kq kr jw ks kt ku kv bi translated">基于坐标提取细节</h2><p id="a47d" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo ky jq jr js kz ju jv jw la jy jz ka hb bi translated">CLLocationManager用于获取用户的坐标。我们将使我们的视图模型委托给CLLocationManager。然后CLLocationManager将使用' didUpdateLocations '为我们提供坐标。</p><p id="0efb" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">一旦我们获得用户的坐标，我们将使用CLGeocoder的reverseGeocodeLocation函数来获得CLPlacemark。从这个地标，我们将解码位置细节如下:</p><pre class="in io ip iq fd lb lc ld le aw lf bi"><span id="6749" class="kb kc hi lc b fi lg lh l li lj">func update() {</span><span id="266b" class="kb kc hi lc b fi lk lh l li lj">let latitude = location?.latitude ?? 0</span><span id="4b66" class="kb kc hi lc b fi lk lh l li lj">let longitude = location?.longitude ?? 0</span><span id="81ae" class="kb kc hi lc b fi lk lh l li lj">self.region = MKCoordinateRegion(center:CLLocationCoordinate2D(latitude:                                                                       CLLocationDegrees(latitude), longitude: CLLocationDegrees(longitude)), span:                                 MKCoordinateSpan(latitudeDelta: 0.5, longitudeDelta: 0.5))</span><span id="9d4a" class="kb kc hi lc b fi lk lh l li lj">CLGeocoder().reverseGeocodeLocation(CLLocation(latitude: latitude, longitude: longitude)) { placemarks, error in</span><span id="a1ad" class="kb kc hi lc b fi lk lh l li lj">guard let placemark = placemarks?.first else {return}</span><span id="e93e" class="kb kc hi lc b fi lk lh l li lj">let reversedGeoLocation = GeoLocation(with: placemark)<br/>self.name = reversedGeoLocation.name<br/> <br/>  }<br/> <br/>}</span></pre><p id="6569" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">地理位置是我们用来解码地标细节的自定义模型。</p><pre class="in io ip iq fd lb lc ld le aw lf bi"><span id="bfcc" class="kb kc hi lc b fi lg lh l li lj">struct GeoLocation {</span><span id="0494" class="kb kc hi lc b fi lk lh l li lj">let name: String</span><span id="f016" class="kb kc hi lc b fi lk lh l li lj">let streetName: String</span><span id="4bf6" class="kb kc hi lc b fi lk lh l li lj">let city: String</span><span id="b68c" class="kb kc hi lc b fi lk lh l li lj">let state: String</span><span id="e847" class="kb kc hi lc b fi lk lh l li lj">let zipCode: String</span><span id="a0a1" class="kb kc hi lc b fi lk lh l li lj">let country: String</span><span id="87e3" class="kb kc hi lc b fi lk lh l li lj">init(with placemark: CLPlacemark) {</span><span id="9b1f" class="kb kc hi lc b fi lk lh l li lj">self.name           = placemark.name ?? ""</span><span id="748c" class="kb kc hi lc b fi lk lh l li lj">self.streetName     = placemark.thoroughfare ?? ""</span><span id="f131" class="kb kc hi lc b fi lk lh l li lj">self.city           = placemark.locality ?? ""</span><span id="a3fb" class="kb kc hi lc b fi lk lh l li lj">self.state          = placemark.administrativeArea ?? ""</span><span id="2074" class="kb kc hi lc b fi lk lh l li lj">self.zipCode        = placemark.postalCode ?? ""</span><span id="734b" class="kb kc hi lc b fi lk lh l li lj">self.country        = placemark.country ?? ""</span><span id="c921" class="kb kc hi lc b fi lk lh l li lj">}</span><span id="6089" class="kb kc hi lc b fi lk lh l li lj">}</span></pre><p id="68e1" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">通过这种方式，我们可以使用坐标获取位置的详细信息。</p><h2 id="20ab" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jo km kn ko js kp kq kr jw ks kt ku kv bi translated">根据地址获取坐标</h2><p id="ff00" class="pw-post-body-paragraph jd je hi jf b jg kw ji jj jk kx jm jn jo ky jq jr js kz ju jv jw la jy jz ka hb bi translated">当用户以任何方式输入地址时，我们可以使用CLGeocoder对地址字符串进行如下地理编码:</p><pre class="in io ip iq fd lb lc ld le aw lf bi"><span id="a795" class="kb kc hi lc b fi lg lh l li lj">func reverseUpdate() {</span><span id="150a" class="kb kc hi lc b fi lk lh l li lj">let geocoder = CLGeocoder()</span><span id="7c27" class="kb kc hi lc b fi lk lh l li lj">geocoder.geocodeAddressString(name) { placemarks, error in<br/>            <br/>guard error == nil else { return}<br/>            <br/>guard let placemark = placemarks?[0] else {return}</span><span id="904a" class="kb kc hi lc b fi lk lh l li lj">let coord = placemark.location?.coordinate ?? CLLocationCoordinate2D(latitude:<br/>CLLocationDegrees(0), longitude: CLLocationDegrees(0))<br/>            </span><span id="6a72" class="kb kc hi lc b fi lk lh l li lj">self.region = MKCoordinateRegion(center: coord, span:<br/>MKCoordinateSpan(latitudeDelta: 0.5, longitudeDelta: 0.5))</span><span id="abed" class="kb kc hi lc b fi lk lh l li lj">self.location = CLLocationCoordinate2D(latitude: placemark.location?.coordinate.latitude ?? 0, longitude: placemark.location?.coordinate.longitude ?? 0)<br/>            <br/>}</span></pre><p id="2ba3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">CLGeocoder将给出CLPlacemark，我们将通过它获得位置的坐标。</p><p id="75fb" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hj">完整视图模型:</strong></p><p id="3f34" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">以下代码可以与来自<a class="ae jc" rel="noopener" href="/@maheshsai252/search-using-mapkit-in-swiftui-636426836ab"> post </a>的代码一起使用:</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="bcd8" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">你可能也会觉得这篇文章很有用:</p><p id="e060" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae jc" rel="noopener" href="/@maheshsai252/search-using-mapkit-in-swiftui-636426836ab">https://medium . com/@ maheshsai 252/search-using-map kit-in-swift ui-636426836 ab</a></p></div></div>    
</body>
</html>