<html>
<head>
<title>Continuous Integration with Laravel and GitHub Actions.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与Laravel和GitHub操作的持续集成。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/continuous-integration-with-laravel-and-github-actions-b30b11fbd995?source=collection_archive---------15-----------------------#2021-08-18">https://medium.com/geekculture/continuous-integration-with-laravel-and-github-actions-b30b11fbd995?source=collection_archive---------15-----------------------#2021-08-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6275df785dbfc1e4d794177057b98b5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5s9L2WpBfu8KkKiqGznXhg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Laravel Code Quality Testing via Github Actions</figcaption></figure><p id="1473" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在本文中，我们将使用Github Actions实现Laravel项目的持续集成部分。在本文的最后，您将有一个工作流程，如果您将代码推送到Github，它将测试您的代码的测试用例、命名约定、重复和不可用性。让我们开始工作吧…</p><p id="962c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">注:假设你熟悉<a class="ae js" href="https://laravel.com/docs/8.x" rel="noopener ugc nofollow" target="_blank">拉勒维尔</a>、<a class="ae js" href="https://github.com/" rel="noopener ugc nofollow" target="_blank"> Github </a>和<a class="ae js" href="https://getcomposer.org/" rel="noopener ugc nofollow" target="_blank">作曲</a>。</p><p id="b2a5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在开始之前，如果您还没有git repo，请按照本教程设置laravel项目。</p><div class="jt ju ez fb jv jw"><a rel="noopener follow" target="_blank" href="/@ujalajha/connecting-the-laravel-project-on-github-73acf55bbd63"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hj fi z dy kb ea eb kc ed ef hh bi translated">连接GitHub上的Laravel项目。</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">因此，今天我们将介绍如何将GitHub帐户连接到我们的项目。简而言之，我们将学习如何使用git来推送…</h3></div><div class="ke l"><p class="bd b fp z dy kb ea eb kc ed ef dx translated">medium.com</p></div></div><div class="kf l"><div class="kg l kh ki kj kf kk io jw"/></div></div></a></div><p id="5a8a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以我创建了一个laravel项目和GitHub repo，命名为<strong class="iw hj"> laravel-github-actions。</strong></p><p id="00a1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了测试我们的代码，我们将使用两个包，它们可以通过composer安装在您的项目中。从现在开始，我们运行的每个命令都将在我们的项目目录中，所以请导航到您的项目目录。</p><p id="3f09" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在导航到您的git存储库并打开actions选项卡。</p><p id="c765" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">网址:https://github.com/<user-name>/<repo-name/></user-name></p><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/c8a70afb4f14286b527d5cf4678958f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AUYUhPbeefxcSOuANIPJeA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Actions Tab</figcaption></figure><p id="52b8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在<strong class="iw hj"> Actions </strong>选项卡下，<strong class="iw hj"> </strong>您将找到<strong class="iw hj">持续集成工作流</strong>标题，在该列表中，您可以找到多个随时可用的CI流。对于我们的应用程序，我们需要找到Laravel设置。</p><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/f9fce4b0eaf6d48b04b43b1f4989ea76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gUm421BNqDKL4rOGAoy0fw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx"><em class="kr">List of Continuous Integration Workflows</em></figcaption></figure><p id="4c44" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您在上面的列表中找不到，点击列表末端的<em class="ks">更多持续集成工作流程</em>按钮，将加载一个新列表，您可以在其中搜索laravel并找到Laravel工作流程设置。</p><figure class="km kn ko kp fd ij er es paragraph-image"><div class="er es kt"><img src="../Images/ff88346f8108c78d92f4d88297074441.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*GyzZSx8tSD5xxBZhVXbUPQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Laravel Setup for GithubActions</figcaption></figure><p id="d88b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">点击<strong class="iw hj">设置此工作流程</strong>按钮，将打开一个新页面，其中包含可编辑的laravel.yml文件，如下图所示:</p><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ku"><img src="../Images/8bd3113e853eed0f1b6dba2a6628bfd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wh9SyLxXVJKycpocBsfpAQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">laravel.yml file</figcaption></figure><p id="46b6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，不要对文件做任何更改，我们稍后会编辑它。只需点击屏幕右上角的绿色<strong class="iw hj">开始提交</strong>。然后将打开一个下拉菜单，选择<em class="ks">直接提交到主</em>选项，并点击提交按钮。在这之后，转到您的本地机器，在终端中导航到project dir并运行<strong class="iw hj"> <em class="ks"> git pull </em> </strong>来获取您的本地分支中laravel.yml的更改。</p><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/81b4adf19f0b2b46836ae7ad188b74b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wcAAMmjzDMbxqlNHuxzAtw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">pull changes in your local</figcaption></figure><p id="d20d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们要安装<a class="ae js" href="https://github.com/sebastianbergmann/phpcpd" rel="noopener ugc nofollow" target="_blank"><strong class="iw hj">phpcpd</strong></a><strong class="iw hj"/>用于检查代码重复。运行以下命令来安装该软件包:</p><blockquote class="kw kx ky"><p id="a651" class="iu iv ks iw b ix iy iz ja jb jc jd je kz jg jh ji la jk jl jm lb jo jp jq jr hb bi translated">作曲家需要塞巴斯蒂安/phpcpd</p></blockquote><p id="b357" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">之后，在编辑器中打开<strong class="iw hj"> laravel.yml </strong>文件，并将以下代码复制粘贴到文件底部。</p><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="ae60" class="lh li hi ld b fi lj lk l ll lm">- name: Check the duplicate code in app directory<br/>  run: ./vendor/bin/phpcpd app/ --min-lines=5 --min-tokens=10</span><span id="7e6f" class="lh li hi ld b fi ln lk l ll lm">Only copy above part.</span><span id="0ae6" class="lh li hi ld b fi ln lk l ll lm">app/ =&gt; Directory in which we are checking the duplicate code. To add another directory copy paste the same command again with another directory.</span><span id="9c7e" class="lh li hi ld b fi ln lk l ll lm">--min-lines=5 =&gt; This will throw error when min 5 lines are duplicated. You can change this according to your requirement. </span><span id="3342" class="lh li hi ld b fi ln lk l ll lm">-min-tokens=10 =&gt; This will throw error when min 10 tokens are duplicated. You can change this according to your requirement.</span></pre><p id="2fb5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，您的laravel.yml文件应该如下所示。</p><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/788bb0a72cf66833884e37e2c14946a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZqkNBlkU4DmcZgI82B79kQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">laravel.yml file after adding phpcpd command</figcaption></figure><p id="78ea" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里请注意，我已经从文件中删除了拉请求代码，现在我们只关注<strong class="iw hj">推</strong>事件。此外，确保文件中的缩进是正确的，否则代码将无法工作，因为它使用了yml。现在继续在你的应用程序目录中创建一个文件，并添加一些重复的函数。您也可以使用下面的代码进行测试:</p><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="c0d7" class="lh li hi ld b fi lj lk l ll lm"><em class="ks">/**<br/>* @return bool<br/>*/</em></span><span id="ec05" class="lh li hi ld b fi ln lk l ll lm">public function <strong class="ld hj">function1</strong>(): bool</span><span id="da48" class="lh li hi ld b fi ln lk l ll lm">{<br/>$use = 1;<br/>do {<br/><strong class="ld hj">echo</strong> "The number is: $use &lt;br&gt;";<br/>$use++;<br/>} while ($use &lt;= 5);<br/>for ($use = 0; $use &lt;= 100; $use += 10) {<br/><strong class="ld hj">echo</strong> "The number is: $use &lt;br&gt;";<br/>}<br/>return false;<br/>}</span><span id="bafb" class="lh li hi ld b fi ln lk l ll lm"><em class="ks">/**<br/>* @return bool<br/>*/</em></span><span id="bebb" class="lh li hi ld b fi ln lk l ll lm">public function <strong class="ld hj">function2</strong>(): bool<br/>{<br/>$use = 1;<br/>do {<br/><strong class="ld hj">echo</strong> "The number is: $use &lt;br&gt;";<br/>$use++;<br/>} while ($use &lt;= 5);<br/>for ($use = 0; $use &lt;= 100; $use += 10) {<br/><strong class="ld hj">echo</strong> "The number is: $use &lt;br&gt;";<br/>}<br/>return false;<br/>}</span></pre><p id="f8e0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在继续，提交您的代码并将其推送到您的分支。然后导航到存储库的Actions选项卡(见图片<em class="ks"> Actions选项卡</em>)。您可以看到构建已经失败，在检查报告时，您可能会看到如下内容:</p><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/58710b0d37e78b470ca200109696fa3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fl7_dyJ_ApRHUmVl8ShFDQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Php code duplicate check.</figcaption></figure><p id="a03a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您删除重复的代码并再次推送代码，您可以看到构建已经通过，它将显示绿色的勾号。见下文:</p><figure class="km kn ko kp fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/22c0bec57d6ab1c720686421597387ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*A3DVo5IUNZkyBd5TaANCag.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Github build passed successfully.</figcaption></figure><p id="3c89" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">既然我们已经检查了代码重复，我们继续检查编码约定。为此，我们将安装一个新的软件包，运行下面的命令来安装。</p><blockquote class="kw kx ky"><p id="3357" class="iu iv ks iw b ix iy iz ja jb jc jd je kz jg jh ji la jk jl jm lb jo jp jq jr hb bi translated">composer需要phpmd/phpmd</p></blockquote><p id="14f9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">安装完这个包之后，我们需要创建一个XML文件，其中包含PHP代码需要遵循的规则。因此，继续在您的项目目录中创建一个phpmdrules.xml，并向其中添加以下代码:</p><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="8b18" class="lh li hi ld b fi lj lk l ll lm">&lt;?xml version="1.0"?&gt;</span><span id="af70" class="lh li hi ld b fi ln lk l ll lm">&lt;ruleset name="My first PHPMD rule set"<br/><br/>xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://pmd.sf.net/ruleset/1.0.0</span><span id="589a" class="lh li hi ld b fi ln lk l ll lm">http://pmd.sf.net/ruleset_xml_schema.xsd" xsi:noNamespaceSchemaLocation="http://pmd.sf.net/ruleset_xml_schema.xsd"&gt;</span><span id="acbd" class="lh li hi ld b fi ln lk l ll lm">&lt;description&gt;<br/>My custom rule set that checks my code...<br/>&lt;/description&gt;</span><span id="429e" class="lh li hi ld b fi ln lk l ll lm">&lt;!--Rules to check the code--&gt;</span><span id="149d" class="lh li hi ld b fi ln lk l ll lm">&lt;rule ref="rulesets/codesize.xml" /&gt;<br/>&lt;rule ref="rulesets/cleancode.xml" /&gt;<br/>&lt;rule ref="rulesets/controversial.xml" /&gt;<br/>&lt;rule ref="rulesets/design.xml" /&gt;<br/>&lt;rule ref="rulesets/naming.xml" /&gt;<br/>&lt;rule ref="rulesets/unusedcode.xml" /&gt;</span><span id="dbf2" class="lh li hi ld b fi ln lk l ll lm">&lt;!--Files and folders which needs to be excluded from checking--&gt;</span><span id="df92" class="lh li hi ld b fi ln lk l ll lm">&lt;exclude-pattern&gt;bootstrap/cache/*&lt;/exclude-pattern&gt;<br/>&lt;exclude-pattern&gt;bootstrap/autoload.php&lt;/exclude-pattern&gt;<br/>&lt;exclude-pattern&gt;*/migrations/*&lt;/exclude-pattern&gt;<br/>&lt;exclude-pattern&gt;*/seeds/*&lt;/exclude-pattern&gt;<br/>&lt;exclude-pattern&gt;*.blade.php&lt;/exclude-pattern&gt;<br/>&lt;exclude-pattern&gt;*.js&lt;/exclude-pattern&gt;<br/>&lt;exclude-pattern&gt;/app/Console/Kernel.php&lt;/exclude-pattern&gt;<br/>&lt;exclude-pattern&gt;/app/Exceptions/Handler.php&lt;/exclude-pattern&gt;&lt;exclude-pattern&gt;app/Providers/BroadcastServiceProvider.php&lt;/exclude-pattern&gt;<br/>&lt;exclude-pattern&gt;app/Providers/RouteServiceProvider.php&lt;/exclude-pattern&gt;<br/>&lt;exclude-pattern&gt;tests&lt;/exclude-pattern&gt;<br/>&lt;/ruleset&gt;</span></pre><p id="1592" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这些检查将由在规则标签中作为<strong class="iw hj"> ref </strong>传递的文件来执行。在exclude-pattern标记中，我们添加了一些不需要检查这些规则的文件和文件夹。您可以根据需要修改规则和排除模式。codesize.xml、cleancode.xml、contractive . XML、design.xml、naming.xml、unusedcode.xml等规则的所有XML文件都可以在以下位置找到:</p><blockquote class="kw kx ky"><p id="4957" class="iu iv ks iw b ix iy iz ja jb jc jd je kz jg jh ji la jk jl jm lb jo jp jq jr hb bi translated">vendor/phpmd/phpmd/src/main/resources/rulesets/</p></blockquote><p id="40bb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你可以在<strong class="iw hj"> phpmd </strong>的官方文档中获得更多关于规则的信息。<a class="ae js" href="https://phpmd.org/documentation/" rel="noopener ugc nofollow" target="_blank">https://phpmd.org/documentation/</a></p><p id="d208" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，像我们在<strong class="iw hj"> phpcpd </strong>期间所做的那样，在laravel.yml文件的底部添加以下代码。</p><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="b3c3" class="lh li hi ld b fi lj lk l ll lm">- name: Perform phpmd script<br/>  run: ./vendor/bin/phpmd app/ github phpmdrules.xml</span></pre><p id="d888" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您还记得，我们创建了一个文件来测试重复代码。您可以使用同一个文件并添加一些不遵循约定的代码，如添加变量，不要使用它，不要在camelCase中保留函数名。提交代码并将其推送到master，然后在Actions选项卡下检查构建。它应该会失败，并显示如下输出:</p><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/220de34e5b18c99bcd42fd375450ac42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KEVVuvjCM_fZIAJIthIhgg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">phpmd code check fail</figcaption></figure><p id="9121" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在更正错误并再次推送代码，您的代码将通过。</p><p id="354e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于PHPUnit测试用例，我们不需要添加任何包。Laravel自带预装的PHPUnit包。您所要做的就是将命令保存在laravel.yml文件中，Github就会执行它。因此，继续在laravel.yml文件的末尾添加这些代码，编写一些错误的测试用例并检查它。</p><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="0f71" class="lh li hi ld b fi lj lk l ll lm">- name: Execute tests (Unit and Feature tests) via PHPUnit<br/>  env:<br/>    DB_CONNECTION: sqlite<br/>    DB_DATABASE: database/database.sqlite<br/>  run: vendor/bin/phpunit</span></pre><p id="a1e8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">就是这样。所有的检查都已经添加了，现在GitHub将检查代码并通知您错误。你现在可以玩它了。您也可以在创建PR时禁用merge按钮，以合并主分支中的代码，但为此，您必须购买Github订阅并在您的存储库中配置设置。</p><p id="6301" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最后一件事。您可以为代码定义哪些分支需要检查，哪些不应该检查。为此，您必须在push事件的branches标记下添加以下代码:</p><blockquote class="kw kx ky"><p id="39c3" class="iu iv ks iw b ix iy iz ja jb jc jd je kz jg jh ji la jk jl jm lb jo jp jq jr hb bi translated">- name** = &gt;这将为所有以name开头的分支构建</p></blockquote><figure class="km kn ko kp fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/9b78ba8bda8b9d2617097935f21a165c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*5EcNaaMEsWopnhrQBgdn4g.png"/></div></figure><p id="b837" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我希望这篇文章能帮助你设计你的应用程序的工作流程。请在评论中告诉我错误/改进/建议。</p><p id="b8a3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">编码快乐！</p></div></div>    
</body>
</html>