<html>
<head>
<title>Docker build with Mac M1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与麦克·M1一起建造码头</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/docker-build-with-mac-m1-d668c802ab96?source=collection_archive---------0-----------------------#2021-12-12">https://medium.com/geekculture/docker-build-with-mac-m1-d668c802ab96?source=collection_archive---------0-----------------------#2021-12-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="07b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为多种架构构建映像的简明指南</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/a108b331cb45da9b6ba6cf31640998c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*2ukfL32pkU02LMYzElcQwA.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">Error about the architecture mismatch (image by author)</figcaption></figure><p id="7e60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在使用了十多年的苹果电脑后，我最近买了一台苹果(迷你)M1来取代我那快要报废的笔记本电脑。由于潜在的软件不兼容，我一直在犹豫要不要买一台，但谢天谢地，一切都很好。<em class="jp">大多是</em>。我在Docker上没有任何问题，直到这个版本被放到一个活动的ubuntu服务器上(见上图中的错误)。哎呀。我以为Docker的意思是“it-works-everywhere”，但是我忘记了架构。</p><p id="1ed2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jp">这里声明我最近从Ampps转而使用Docker进行本地开发——我几乎不懂Docker文件。由于我是双重初学者(M1和码头工人)，这不是专家指南。因为我发现了很多冗长的文章(老实说，我没有读过)，所以在这里我将只尝试一个最简单的答案，并列出我采取的步骤——作为日志供将来参考，以防其他人需要:</em></p><h1 id="dc49" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">求解步骤</h1><p id="5cf2" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">Docker有一个扩展版本，叫做‘buildx ’,它应该已经和Docker一起安装了。我们将使用它来构建图像。</p><h2 id="b57c" class="kt jr hi bd js ku kv kw jw kx ky kz ka iq la lb ke iu lc ld ki iy le lf km lg bi translated">第一步</h2><p id="0fe7" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">我们将需要创造一个“建设者”。我就叫它<code class="du lh li lj lk b">mybuilder</code>。</p><p id="a9df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lh li lj lk b">docker buildx create --name mybuilder</code></p><h2 id="3010" class="kt jr hi bd js ku kv kw jw kx ky kz ka iq la lb ke iu lc ld ki iy le lf km lg bi translated">第二步</h2><p id="ee52" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">然后我们告诉buildx使用<code class="du lh li lj lk b">mybuilder</code>。</p><p id="61f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lh li lj lk b">docker buildx use mybuilder</code></p><h2 id="52fd" class="kt jr hi bd js ku kv kw jw kx ky kz ka iq la lb ke iu lc ld ki iy le lf km lg bi translated">第三步</h2><p id="ff1b" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">我们可以检查<code class="du lh li lj lk b">mybuilder</code>只是为了确保安全。</p><p id="813c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lh li lj lk b">docker buildx inspect --bootstrap</code></p><p id="4237" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们会看到一些打印输出，但我特别检查了以下内容:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/c8626842202abe91bd9579448a156c66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*CuyyRtfuiMyZfRuLQRsfLg.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">As we can see, <code class="du lh li lj lk b">linux/arm64</code> and <code class="du lh li lj lk b">linux/amd64</code> are both listed (image by author).</figcaption></figure><h2 id="16cb" class="kt jr hi bd js ku kv kw jw kx ky kz ka iq la lb ke iu lc ld ki iy le lf km lg bi translated">步骤4a</h2><p id="7e6b" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">构建映像(假设您在docker文件所在的目录中)。</p><p id="ae9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lh li lj lk b">docker buildx build --tag [image-tag] -o type=image --platform=linux/arm64,linux/amd64 .</code></p><h2 id="05c0" class="kt jr hi bd js ku kv kw jw kx ky kz ka iq la lb ke iu lc ld ki iy le lf km lg bi translated">步骤4b</h2><p id="2901" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">我们也可以直接构建并推送至Docker Hub(假设已经登录Docker)。</p><p id="a8be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lh li lj lk b">docker buildx build --push --tag [docker-hubid/image-tag] --platform=linux/arm64,linux/amd64 .</code></p><p id="2ec7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了快速复查，我们可以登录Docker Hub。在Tags &amp; Scans下，我们可以看到推送尝试，在OS列下，我们可以看到mouseover上列出的所有体系结构。</p><h2 id="a5e7" class="kt jr hi bd js ku kv kw jw kx ky kz ka iq la lb ke iu lc ld ki iy le lf km lg bi translated">临时演员</h2><p id="33c0" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">我们可以通过输入以下命令来检查当前的构建器:</p><p id="8c03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lh li lj lk b">docker buildx ls</code></p><p id="391a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当前的构建器旁边会有一个<code class="du lh li lj lk b">*</code>。</p><p id="69c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jp">瞧吧！这是真的。</em>我希望这足够简单直接，也希望我没有犯任何错误。</p></div></div>    
</body>
</html>