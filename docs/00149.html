<html>
<head>
<title>How to use Native Image Lazy Loading and lazysizes Library to increase Performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用本机映像延迟加载和lazysizes库来提高性能</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-use-native-image-lazy-loading-and-lazysizes-library-to-increase-performance-1cec9fda1dc6?source=collection_archive---------2-----------------------#2020-08-04">https://medium.com/geekculture/how-to-use-native-image-lazy-loading-and-lazysizes-library-to-increase-performance-1cec9fda1dc6?source=collection_archive---------2-----------------------#2020-08-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/3ae55b4a7c3729777f20372098091472.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fmx_58_2p1-qL5rBzSOORQ.jpeg"/></div></div></figure><div class=""/><p id="f738" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你真的想提高你的网站的性能，并且你正在寻找一个简单的图片延迟加载的方法，请到这里来，我们将会提高这一部分。</p><p id="c2ee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们需要太多的图像，我们将使用一个网站，它创建随机图像，它被称为picsum照片。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es jo"><img src="../Images/e0dd375ce3cb0d51aeff1bc551247443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SaKDVkB7G4siVVTTplMoKw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Example adding images on our index.html</figcaption></figure><h1 id="ef87" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">添加本机延迟加载</h1><p id="747e" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated">记住在chrome 76以后，我们可以使用这个属性<strong class="is hu"> loading="lazy" </strong>并有三个值<strong class="is hu"> auto </strong>就好像我们不使用它一样，<strong class="is hu"> lazy </strong>是最重要的，因为它在视口达到计算的距离时工作，而<strong class="is hu"> eager </strong>只立即加载资源。</p><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="0a69" class="lf jy ht lb b fi lg lh l li lj">&lt;div <em class="lk">class</em>="con-img"&gt;<br/>    &lt;img <em class="lk">loading</em>="lazy"               <em class="lk">src</em>="https://picsum.photos/seed/picsum/500/300" <br/><em class="lk">alt</em>=""&gt;<br/>&lt;/div&gt;</span></pre><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ll"><img src="../Images/5b7411bd097da8c89db370786c16f90e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ClnhIRT9PoRRuR1z5GbWw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Example native lazy loading in action</figcaption></figure><p id="092e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但不是所有的浏览器都支持这种原生属性，这就是为什么我们需要lazysizes。</p><h1 id="c792" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">懒人图书馆</h1><p id="ffec" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated">这是一个非常有用的图像快速惰性加载库，要使用它，我们只需要添加这个库，把src换成data-src，然后添加lazyload类，就这样。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lm"><img src="../Images/08bfb9a18ce40dc9799c51c91c6b53d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LGZVds17WCzeG2iaUev4mw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Adding lazysizes libary to our index.html</figcaption></figure><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="b130" class="lf jy ht lb b fi lg lh l li lj">&lt;div <em class="lk">class</em>="con-img"&gt;<br/>   &lt;img <em class="lk">class</em>="lazyload" <em class="lk">data-src</em>="https://picsum.photos/seed/picsum/500/300" <em class="lk">alt</em>=""&gt;<br/>&lt;/div&gt;</span></pre><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ln"><img src="../Images/8189186057a6c810cf6e1ea9891460e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eqm6DnGseg-eRebOmkE7_g.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Example lazysizes in action</figcaption></figure><h1 id="ea87" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">如何使用这两者</h1><p id="f271" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated">如果浏览器支持和不支持本地惰性加载，我们需要添加本地和惰性到图像标签。</p><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="3178" class="lf jy ht lb b fi lg lh l li lj">&lt;div <em class="lk">class</em>="con-img"&gt;<br/>   &lt;img <em class="lk">loading</em>="lazy" <em class="lk">class</em>="lazyload" <em class="lk">data-src</em>="https://picsum.photos/seed/picsum/500/300" <em class="lk">alt</em>=""&gt;<br/>&lt;/div&gt;</span></pre><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lo"><img src="../Images/ff2946da6b12bc4d3e002fc55adb7c17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rkF9BjJG78llrAo0u8yl4g.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Example adding both of them to the img tag</figcaption></figure><p id="d60f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之后，我们使用一个简单的if来检查事件是否被分配给了HTMLimage.prototype。如果是，我们调用所有带有loading属性的图像，并添加带有数据路由的src属性-src。</p><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="10ac" class="lf jy ht lb b fi lg lh l li lj">if('loading' in <em class="lk">HTMLImageElement</em>.prototype){</span><span id="88e1" class="lf jy ht lb b fi lp lh l li lj">const images = document.querySelectorAll('img[loading="lazy"]')</span><span id="e7d0" class="lf jy ht lb b fi lp lh l li lj">images.forEach( <em class="lk">image</em> =&gt; {<em class="lk">image</em>.src = <em class="lk">image</em>.dataset.src})</span><span id="8ae0" class="lf jy ht lb b fi lp lh l li lj">}</span></pre><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lq"><img src="../Images/ae6211903e54907dfb391c720d3ff450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NEP52cyTMHqbLd8SyKlYGg.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Example check is supports the native lazy loading attribute</figcaption></figure><p id="42eb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们只使用JavaScript创建一个脚本，将lazysizes库的路由或CDN路由添加到src属性中，并使用appendChild方法将脚本添加到主体中。</p><pre class="jp jq jr js fd la lb lc ld aw le bi"><span id="1781" class="lf jy ht lb b fi lg lh l li lj">else{<br/> const script = document.createElement('script')</span><span id="dca5" class="lf jy ht lb b fi lp lh l li lj">script.src = 'https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js'</span><span id="a31e" class="lf jy ht lb b fi lp lh l li lj">  document.body.appendChild(script)<br/>}</span></pre><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lr"><img src="../Images/0e44032172acfb782341e7765b0cea50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oEVAt4ykd4pgvmurM1SMDw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Example if the browser doesn’t support the native lazy laoding</figcaption></figure><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ls"><img src="../Images/f8894e3960b9d9fcdd6bf6d4fb1afc2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LM9m2IjQlhda7mbnvrd5VA.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Complete code for JavaScript</figcaption></figure><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lt"><img src="../Images/45be5d3c8f8fc799e8f1c102f3558e9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YyvfYtnlDF6bIuz5qKJ5iw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Example how the images load really fast</figcaption></figure><h1 id="748a" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">结论</h1><p id="3b82" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated">如果你想提高图片的加载量，这是一种提高性能的方法，而且非常简单，试试看，享受灯塔测试的新数据吧。</p><h1 id="5f72" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">来源</h1><p id="30cf" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated"><a class="ae lu" href="https://web.dev/native-lazy-loading/?utm_source=lighthouse&amp;utm_medium=devtools" rel="noopener ugc nofollow" target="_blank">https://web.dev/native-lazy-loading/?utm_source=lighthouse&amp;UTM _ medium = devtools</a><br/><a class="ae lu" href="https://picsum.photos/" rel="noopener ugc nofollow" target="_blank">https://picsum.photos/</a><br/><a class="ae lu" href="https://github.com/aFarkas/lazysizes" rel="noopener ugc nofollow" target="_blank">https://github.com/aFarkas/lazysizes</a></p></div></div>    
</body>
</html>