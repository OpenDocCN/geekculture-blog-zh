<html>
<head>
<title>How I saved my MacOS Docker development experience</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何保存我的MacOS Docker开发经验</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-i-saved-my-macos-docker-development-experience-6fce6a81a456?source=collection_archive---------5-----------------------#2022-11-15">https://medium.com/geekculture/how-i-saved-my-macos-docker-development-experience-6fce6a81a456?source=collection_archive---------5-----------------------#2022-11-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e20b1148f367d987dce67539b33012dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IrguB8wYSVInUt5ndwSPrQ.jpeg"/></div></div></figure><h1 id="ee03" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">介绍</h1><p id="c74b" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我敢肯定，你们大多数人都经历过MacOS上的docker缺乏光彩和令人沮丧的经历。如果不是，那么请让我知道你是如何生存了这么久。这并不是要抨击MacOS，我喜欢整个MacOS开发人员的体验和环境，但它是一个大的，但当谈到docker时，它下降得如此之平，令人害怕。</p><p id="537c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">诚然，你可以在Macbook上使用docker，但是这非常慢，如果它不慢，我肯定是因为你正在做非常一维的事情，并且可能只使用已经从docker hub构建的docker映像。如果你是，那么它非常有用，你不应该有很多性能问题。</p><h1 id="0104" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">问题</h1><p id="2e8d" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">当我在Macbook上构建新映像或使用cli工具(如AWS Sam或AWS CoPilot)构建和安装映像时，或者当我需要构建生产映像以在ECS容器中托管时，我真的很难使用docker。</p><p id="41bd" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我有Macbook Pro M1 Pro芯片16GB型号作为参考，所以它一点也不慢。我确实理解docker在MacOs和Windows上运行缓慢的原因，这归结为几个方面，但主要是docker在这些操作系统上的虚拟机中运行，而不是像在Linux上那样本机运行。</p><p id="5bfe" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">大多数问题可以通过在CI/CD管道中构建这些来解决。这里有几个问题，这是唯一的答案:</p><ol class=""><li id="85b2" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">这主要与本地开发流程和经验有关，而不是部署</li><li id="bbe2" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">我需要在本地测试我的容器，并在某些情况下构建一个生产版本</li><li id="9480" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">使用AWS Sam和Copilot进行本地测试也需要在本地进行构建</li><li id="59c6" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">CI/CD需要资金来托管和运行构建和部署</li></ol><p id="49a2" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">最后一根稻草是试图为我们正在开发的NextJS应用程序构建生产映像，也是在星期五(我知道这是一个星期五，任何与生产环境有关的事情都很危险)。</p><p id="d521" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">docker文件或我正在做的任何特别的东西都没有什么不寻常的，但是仍然建立这个图像花费了惊人的33分钟…<strong class="jq hj"> 33分钟</strong>我不得不做了好几次，因为我在测试为什么只有一个生产错误而没有在开发中，这是一个愚蠢的原因，但这个愚蠢的原因花费了我2个多小时，因为实际构建映像需要<strong class="jq hj">时间</strong>。</p><p id="389b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这不是唯一需要花费时间的事情，AWS SAM无服务器api构建一个非常简单的api需要10多分钟，不要让我开始使用<strong class="jq hj"> sam local start-api </strong>在本地测试这些API</p><p id="f131" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">AWS副驾驶不是那么糟糕，但仍然需要一些时间。</p><p id="73db" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">但你明白我的意思，这只是一个可怕的经历，我们讨厌等待我们的机器赶上来的工程师。这会影响工作效率，尤其是当你需要做这些构建或者运行容器来解决一些bug，并且需要重复构建你的容器的时候。</p><h1 id="1fa7" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">解决方案</h1><p id="4b0c" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如果你每天都使用容器，这个问题的解决是非常简单的。但是如果你爱MacOS呢？也许你和我一样太深入它的生态系统了？</p><p id="878a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">嗯，有一个解决方案，这可能不会解决所有人的问题，但它在很大程度上解决了我的问题！我非常支持拥有一个家庭实验室。如果您像我一样需要性能，那么在Linux上运行docker绝对是正确的选择。</p><p id="a3a4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在走这条路之前，我也尝试了docker桌面的实验性特性。</p><p id="4d11" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">您的Homelab不需要在本地，可以在云中，有几个选项，如Github Codespaces，AWS有类似的东西，或者可以尝试Oracle的免费层，它非常慷慨，我认为您可以获得4个内核和24GB Ram，这是完美的！</p><p id="0a55" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">然而，我的主要家庭实验室是一个10岁的i7 32GB内存和1TB固态硬盘，只是一个普通的桌面级规格，没有服务器级组件。</p><p id="6c37" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在我的HomeLab上，我做的事情有一点不同，它不只是安装在Linux上，虽然这很好。我安装了一个名为Proxmox的第1层管理程序(它是免费的，非常棒)</p><p id="5ffe" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我的家庭实验室为我做了一大堆事情，我很可能会写一篇关于它的文章，以及它在未来所做的一切，因为它真的是一个工程师拥有的令人惊叹的工具。</p><p id="7693" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在最后的33分钟里(我还是不得不说！)build我迅速登录我的Proxmox仪表盘，创建了一个Ubuntu 20.4实例。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lf"><img src="../Images/4d1b60726b27fc666e36b538bc8e5d8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UtkDva7AI8CcFmby"/></div></div></figure><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/15b69cbf7a1268f39acd7ad77599777b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8hjjLyALeBxxmUVp"/></div></div></figure><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/f5633b2e969571a39c89eac082a32879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6HD61XHB3Wqp4CGD"/></div></div></figure><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lf"><img src="../Images/1ac262b7fd65f47c6879e2981c8032a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JEphE2eLK6xGx6XV"/></div></div></figure><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/1bd13281702ce3218faac30645f72dae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TE7ujqViZ2qMJkri"/></div></div></figure><p id="5efc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我给它分配了4个内核和16GB内存以及100GB硬盘空间，这将是我的远程代码服务器。</p><p id="328f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我设置了它，并确保安装了OpenSSH客户端，这非常重要！</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/0cf78d133c2636433d78ec48d61c9970.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EwzK12_eQSmbVSWb"/></div></div></figure><p id="5555" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">一旦安装完毕，我就可以通过SSH进入机器了。我安装了<a class="ae ln" href="https://code.visualstudio.com/docs/remote/remote-overview" rel="noopener ugc nofollow" target="_blank"> VSCode远程开发扩展</a></p><p id="b97b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">安装后，您将能够通过SSH直接通过VSCode连接到您的虚拟机实例</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lo"><img src="../Images/3db0b53925ef0f9f57c62eaa3c0588f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/0*v8t4Y27sz-sns4xE"/></div></figure><p id="7ada" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">然后，一切都与您在本地机器上的情况非常相似！它非常棒，最棒的是，讨厌的MacOS Docker问题已经成为过去！我的33分钟(呸！)构建时间减少到4分钟，这还包括下载一个新的节点16-alpine图像！这是一个巨大的进步！哦，这里的踢球者，我做了这整个设置在更少的时间，然后我的33分钟最终建立本地花了事实上，我开始了这一进程，因为它是建设。</p><p id="980a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">就像我提到的，这个解决方案并不适合所有人，但是到目前为止，它对我来说非常有效！如果你有任何关于MacOS docker的建议，请告诉我，我知道这是我试过的性能最好的解决方案。</p></div></div>    
</body>
</html>