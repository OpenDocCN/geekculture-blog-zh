<html>
<head>
<title>Arduino: Implementing a Simple Terminal Prompt</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Arduino:实现一个简单的终端提示符</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/arduino-implementing-a-simple-terminal-prompt-1ec756f99a3d?source=collection_archive---------33-----------------------#2021-09-13">https://medium.com/geekculture/arduino-implementing-a-simple-terminal-prompt-1ec756f99a3d?source=collection_archive---------33-----------------------#2021-09-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c573dfb17480b257fbe038aa16c15024.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QircZQLTQgkNnh0IoVhVVg.png"/></div></div></figure><p id="b744" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Arduinos是嵌入式项目的优秀微控制器。在我的一个项目中，我希望有一个简单的命令提示符来触发Arduino上的命令，例如在LCD显示器上打印消息，或者移动连接有超声波传感器的伺服电机。听一个字符并把它当作一个命令是很容易的，但是如果你来自Linux或Mac，你会习惯于使用丰富的CLI工具。</p><p id="1a16" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在下面的文章中，我将解释如何为您的Arduino构建一个简单的终端提示符。我在用<a class="ae jo" href="https://platformio.org/" rel="noopener ugc nofollow" target="_blank">平台IO </a> IDE写Arduino程序，所有代码示例都是C++。</p><p id="6611" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jp">本文原载于我的博客</em><a class="ae jo" href="https://admantium.com/blog/micro10_tutorial_arduino_terminal_prompt/" rel="noopener ugc nofollow" target="_blank"><em class="jp">admantium.com</em></a>。</p><h1 id="5b03" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">终端提示基础</h1><p id="99a1" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">当Arduino启动时，它应该显示一个小的启动信息，然后列出所有可用的命令。命令应该提供一些关于如何操作它们的信息。然后，当我输入任何命令时，或者更具体地说，当我按下任何按钮时，我希望立即看到变化。按enter键终止命令，并将其发送到Arduino进行处理。</p><p id="b940" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要启动提示，请使用以下方法:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="950a" class="lc jr hi ky b fi ld le l lf lg">void helpMsg() {<br/>  Serial.println("\<br/>Please select a command\n\<br/>- LED {msg}     Print msg to LED Matrix \n\<br/>- LOG {msg}     Log msg \n\<br/>- EXIT          Restart the program\n");<br/>}</span></pre><p id="ac5f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们定义一个多行字符串，表示为字符串文字，并打印到串行。</p><p id="e6bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来是提示，表明用户需要输入。使用任何你喜欢的输入提示符号。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="14a8" class="lc jr hi ky b fi ld le l lf lg">void promptMsg() {<br/>  Serial.print("&gt; ");<br/>}</span></pre><p id="1ca9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">两种方法都在<code class="du lh li lj ky b">setup()</code>期间被调用。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="bf08" class="lc jr hi ky b fi ld le l lf lg">void setup() {<br/>  Serial.begin(9600);<br/>  helpMsg();<br/>  promptMsg();<br/>}</span><span id="c296" class="lc jr hi ky b fi lk le l lf lg">void loop() { /* ... */ }</span></pre><p id="2454" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好了，第一部分完成了。让我们继续阅读输入。</p><h1 id="f7ee" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">阅读输入</h1><p id="9b8c" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">Arduino库提供了许多读取输入的方法。最常见的是<code class="du lh li lj ky b">Serial.read()</code>，它按一个字节发送串行缓冲区，并返回一个<code class="du lh li lj ky b">char</code>。我们需要使用这种方法，为了满足即时反馈的要求，我们不能使用任何<code class="du lh li lj ky b">delay()</code>方法。然而，与此同时，我们还需要等待命令完成，需要等待用户按下enter按钮。</p><p id="9d21" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">解决方案是在输入可用时立即读取任何输入，将该输入添加到缓冲区，并将其打印回串行。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="75f3" class="lc jr hi ky b fi ld le l lf lg">String cmd;<br/>char car;</span><span id="a90d" class="lc jr hi ky b fi lk le l lf lg">void loop() {  <br/>  if (Serial.available()) {<br/>    car = Serial.read();<br/>    cmd += String(car);<br/>    Serial.print(car);<br/>  }</span><span id="e2d3" class="lc jr hi ky b fi lk le l lf lg">  if (cmd.indexOf('\n') &gt; -1) {<br/>    process();<br/>    cmd = "";<br/>    promptMsg();<br/>  }<br/>}</span></pre><p id="6261" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这几行中，我们用<code class="du lh li lj ky b">Serial.read()</code>读取用户输入，并将值存储在一个<code class="du lh li lj ky b">Char</code>变量中。该字符被添加到<code class="du lh li lj ky b">String</code> <code class="du lh li lj ky b">cmd</code>中，并打印到屏幕上。</p><p id="eace" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之后，我们检查<code class="du lh li lj ky b">cmd</code>字符串是否包含一个新行字符，这意味着用户已经按下了enter。如果是，我们调用方法<code class="du lh li lj ky b">process()</code>——见下一节——然后重置<code class="du lh li lj ky b">cmd</code>并再次显示提示。</p><h1 id="7b83" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">指令处理</h1><p id="87d3" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">当用户按下Enter键时，调用<code class="du lh li lj ky b">process()</code>功能。它调查输入的<code class="du lh li lj ky b">cmd</code>并决定做什么。同样，我们使用来自<code class="du lh li lj ky b">String</code>类的方法。使用<code class="du lh li lj ky b">.indexOf()</code>我们可以确定字符串是否包含另一个子串。使用<code class="du lh li lj ky b">.substring</code>，我们从字符串中提取部分。</p><p id="7a99" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在下面几行中，我们检查<code class="du lh li lj ky b">cmd</code>是否包含任何关键字<code class="du lh li lj ky b">LED</code>、<code class="du lh li lj ky b">LOG</code>或<code class="du lh li lj ky b">EXIT</code>。对于<code class="du lh li lj ky b">LED</code>和<code class="du lh li lj ky b">LOG</code>，我们还检查命令后是否有任何有效载荷。如果匹配，我们从索引<code class="du lh li lj ky b">[4, cmd.length() -2]</code>中的<code class="du lh li lj ky b">cmd</code>字符串中提取有效载荷，并进一步处理它。出于演示的目的，这里我们只打印匹配。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="c39e" class="lc jr hi ky b fi ld le l lf lg">void process() {<br/>  int index;<br/>  if((index = cmd.indexOf("LOG")) &gt; -1 &amp;&amp; cmd.length() &gt; 4) {<br/>    String msg = cmd.substring(index + 4, cmd.length() -2);<br/>    Serial.println("LOG &gt;&gt;" + msg + "&lt;&lt;");<br/>  } else if((index = cmd.indexOf("LED")) &gt; -1 &amp;&amp; cmd.length() &gt; 4) {<br/>    String msg = cmd.substring(index + 4, cmd.length() -2 );<br/>    Serial.println("LED &gt;&gt;" + msg + "&lt;&lt;");<br/>    printStringOnMatrix(msg);<br/>  } else if((index = cmd.indexOf("EXIT")) &gt; -1) {<br/>    Serial.println("Reboot ...");<br/>  }<br/>}</span></pre><p id="fd04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在所有其他情况下，什么都不会发生——对于一个小的DIY项目，我不关心捕捉任何输入错误。</p><h1 id="a8a2" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">完整程序</h1><p id="310a" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">以下是完整的程序:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="3522" class="lc jr hi ky b fi ld le l lf lg">void bootupMsg() {<br/>  Serial.println("+++ RADU MKI v0.2 Booting +++");<br/>}</span><span id="226c" class="lc jr hi ky b fi lk le l lf lg">void helpMsg() {<br/>  Serial.println("\<br/>Please select a command\n\<br/>- LED {msg}- Print msg to LED Matrix \n\<br/>- LOG {msg}- Log msg \n\<br/>- EXIT - Restart the program\n");<br/>}</span><span id="87fc" class="lc jr hi ky b fi lk le l lf lg">void promptMsg() {<br/>  Serial.print("&gt; ");<br/>}</span><span id="f18a" class="lc jr hi ky b fi lk le l lf lg">void process() {<br/>  int index;<br/>  if((index = cmd.indexOf("LOG")) &gt; -1) {<br/>    String msg = cmd.substring(index + 4, cmd.length() -2);<br/>    Serial.println("LOG &gt;&gt;" + msg + "&lt;&lt;");<br/>  } else if((index = cmd.indexOf("LED")) &gt; -1) {<br/>    String msg = cmd.substring(index + 4, cmd.length() -2);<br/>    Serial.println("LED &gt;&gt;" + msg + "&lt;&lt;");<br/>    printStringOnMatrix(msg);<br/>  } else if((index = cmd.indexOf("EXIT")) &gt; -1) {<br/>    Serial.println("Reboot ...");<br/>    reboot();<br/>  }<br/>}</span><span id="e778" class="lc jr hi ky b fi lk le l lf lg">void setup() {<br/>  Serial.begin(9600);<br/>  initMatrix();<br/>  bootupMsg();<br/>  helpMsg();<br/>  promptMsg();<br/>}</span><span id="bbc5" class="lc jr hi ky b fi lk le l lf lg">void loop() {  <br/>  if (Serial.available()) {<br/>    car = Serial.read();<br/>    cmd += String(car);<br/>    Serial.print(car);<br/>  }</span><span id="613c" class="lc jr hi ky b fi lk le l lf lg">  if (cmd.indexOf('\n') &gt; -1) {<br/>    process();<br/>    cmd = "";<br/>    promptMsg();<br/>  }<br/>}</span></pre><h1 id="5d76" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结论</h1><p id="bce8" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">本文展示了如何在Arduino上实现一个简单的终端程序。有了它，你可以将Arduino连接到seral显示器，查看命令列表并开始与之交互。在我的项目中，我附加了一个LED点阵，任何带有<code class="du lh li lj ky b">LED</code>前缀的输入文本都会被打印出来。另一个命令触发超声波传感器的测量。现在，你将如何在你的项目中使用终端程序？</p></div></div>    
</body>
</html>