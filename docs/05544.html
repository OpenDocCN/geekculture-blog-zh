<html>
<head>
<title>Where can I get the IP address of an elastic beanstalk load-balanced application?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在哪里可以获得弹性beanstalk负载平衡应用程序的IP地址？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/where-can-i-get-the-ip-address-of-an-elastic-beanstalk-load-balanced-application-a2279d323dac?source=collection_archive---------8-----------------------#2021-07-24">https://medium.com/geekculture/where-can-i-get-the-ip-address-of-an-elastic-beanstalk-load-balanced-application-a2279d323dac?source=collection_archive---------8-----------------------#2021-07-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4998" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">TL；DR: </strong>我们成功地为VPC设置了公共和私有子网，在新VPC创建了新的EB环境，公共子网中有负载平衡器，私有子网中有实例。</p><p id="33c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我的第一篇文章，所以请原谅我写得不好。我会尽量开门见山。</p><p id="a4d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本周，我们的邮件服务出现了一个问题。我们的邮件服务帐户被封锁，因为它已达到每月发送25，000的限制。原来，其中一个API密钥遭到破坏，并被用于发送垃圾邮件。</p><p id="ae0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中一个解决方案是通过将一个IP地址列入白名单来限制API键，在本例中，是一个弹性beanstalk负载平衡应用程序。</p><p id="0812" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，请记住，到今天为止，我处理AWS服务的经验正好是一个月。我的“另一个”解决方案是将EC2实例的所有IP地址列入白名单。我认为这可能不是一个好的实践，因为我们需要跟踪随着时间的推移产生和销毁的所有实例。我刚刚想到，这是一个常见的情况，弹性beanstalk应用程序可能有一个静态IP地址。于是谷歌搜索开始了。</p><p id="5770" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从google搜索结果中，我了解到我们必须首先配置环境的网络才能看到它。但是，当我去我的应用程序的配置中检查它时，它被写为“此环境不是VPC的一部分”。没有显示编辑按钮，这应该是谷歌搜索结果中提到的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/00a44dc5157e7daf7df6b37a421e70e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Sk-ZlD4KpDGGwVnj8sbXog.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">Elastic Beanstalk environment Network configuration</figcaption></figure><p id="7553" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基本上，在创建环境的过程中，如果我们没有在网络配置中选择任何子网，那么Elastic Beanstalk会在环境的默认VPC中启动实例，但是不幸的是，它不允许我们在以后编辑它。</p><p id="4a42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">现有环境中的问题是</strong>:</p><ol class=""><li id="0ffd" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">如果我们在创建过程中没有选择VPC，那么Elastic Beanstalk不允许我们在以后编辑任何网络配置。</li><li id="91f9" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">如果我们在创建过程中选择了VPC(甚至是默认的VPC)，那么我们可以在以后修改Elastic Beanstalk和EC2的子网，但是不改变VPC本身。</li></ol></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><p id="efd0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在与我的上级反复沟通之后，我们决定联系AWS支持部门。长话短说，在支持会话结束后，要获得静态IP地址，我们需要大致遵循以下步骤:</p><ol class=""><li id="b925" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">有一个<strong class="ih hj"> VPC </strong>与<strong class="ih hj">私有</strong>和<strong class="ih hj">公有</strong>子网。</li><li id="6bc9" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">在公共子网中有一个<strong class="ih hj"> NAT网关，在私有子网路由表中，增加一条NAT网关规则(<strong class="ih hj"> 0.0.0.0/0 - &gt; NAT网关</strong>)。</strong></li><li id="5354" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">当创建弹性beanstalk环境时，选择此VPC和<strong class="ih hj">作为实例子网，只检查私有子网</strong>以便ec2只在私有子网中。</li><li id="06da" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">该设置将通过NAT网关路由来自EC2s的所有传出流量。现在这个<strong class="ih hj"> NAT网关有了一个静态弹性IP </strong>，这将是弹性beanstalk的输出IP。</li></ol></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><p id="fa47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将在下面演示VPC的步骤。</p><ol class=""><li id="af1a" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">去创造一个新的<strong class="ih hj"> VPC </strong>。至于<strong class="ih hj"> IPv4 CIDR块</strong>，你可以设置为<strong class="ih hj"> 10.0.0.0/16 </strong>。有一个信息按钮可以获取更多信息。</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kk"><img src="../Images/58bf5e18ff83ef75e09d97bfa10926ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TXX45DbfD0NI1K3jyDndMA.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">VPC Creation</figcaption></figure><p id="a48f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.创建后，单击VPC id。然后，点击操作和<strong class="ih hj">编辑DNS主机名</strong>。检查DNS主机名的<strong class="ih hj">启用</strong>。</p><p id="f87c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.转到<strong class="ih hj">子网</strong>并创建4个子网。例如，您可以将其命名为public-subnet-1、private-subnet-1，以区分公共子网和私有子网，这在下一节中会很方便。对于<strong class="ih hj">可用性区域</strong>，为每种类型的子网选择不同的区域。对于<strong class="ih hj"> IPv4 CIDR </strong>，您可以在下面查看。</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="1897" class="ku kv hi kq b fi kw kx l ky kz">+-------------------+----------------------+-------------+<br/>|      <strong class="kq hj">Subnets      </strong>|   <strong class="kq hj">Availability Zone</strong>  |  <strong class="kq hj">IPv4 CIDR  </strong>|<br/>+-------------------+----------------------+-------------+<br/>| public-subnet-1   | ap-southeast-1a      | 10.0.1.0/24 |<br/>| public-subnet-2   | ap-southeast-1b      | 10.0.2.0/24 |<br/>| private-subnet-1  | ap-southeast-1a      | 10.0.3.0/24 |<br/>| private-subnet-2  | ap-southeast-1b      | 10.0.4.0/24 |<br/>+-------------------+----------------------+-------------+</span></pre><p id="cf61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.创建子网后，您应该会看到每个子网中只有一条针对本地的路由表记录。现在转到<strong class="ih hj">互联网网关</strong>并创建一个新的。</p><p id="d87a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.在新的互联网网关内部，您应该看到<strong class="ih hj">状态</strong>被<strong class="ih hj">分离</strong>。你必须把它装在新的VPC上。点击动作并<strong class="ih hj">连接到VPC </strong>。选择新的VPC。此操作将为VPC中的所有子网添加到internet网关的路由。您可以通过查看子网<strong class="ih hj">路由表</strong>中的路由表来验证。</p><p id="1b4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.转到<strong class="ih hj"> NAT网关</strong>和<strong class="ih hj">创建NAT网关</strong>。对于子网，选择任何公共子网，如果你遵循我的命名惯例。为<strong class="ih hj">连接类型</strong>选择<strong class="ih hj">公共</strong>。<strong class="ih hj">没有就分配弹性IP </strong>。需要弹性IP。</p><p id="5721" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.现在我们需要为应该指向NAT网关的私有子网创建一个新的路由表。转到<strong class="ih hj">路由表</strong>并创建路由表。例如，您可以将其命名为私有路由表1。</p><p id="1321" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.在新路由表中，点击<strong class="ih hj">编辑路线，再添加一条路线。</strong>使用新的NAT网关ID作为目标。</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="bf4f" class="ku kv hi kq b fi kw kx l ky kz">+-------------+--------+<br/>| <strong class="kq hj">Destination</strong> | <strong class="kq hj">Target </strong>|<br/>+-------------+--------+<br/>| 0.0.0.0/0   | nat-id |<br/>+-------------+--------+</span></pre><p id="9d26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9.添加新路由后，进入<strong class="ih hj">子网关联</strong>和<strong class="ih hj">编辑子网关联。检查2个私有子网</strong>并保存。这将使子网成为私有子网。您可以通过查看所选子网的<strong class="ih hj">路由表</strong>来验证它，您应该看到目的地0.0.0.0/0 - &gt; nat-id。</p><p id="ebf6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这应该结束了VPC的最低设置。现在对于弹性豆茎部分，我们需要创建一个新的环境。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="739e" class="la kv hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">环境的网络配置</strong></h1><ol class=""><li id="2636" class="jp jq hi ih b ii lx im ly iq lz iu ma iy mb jc ju jv jw jx bi translated">创建环境后，在<strong class="ih hj">网络配置</strong>中，选择<strong class="ih hj">新VPC </strong>。</li><li id="f61a" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated"><strong class="ih hj">对于负载平衡环境</strong>，也就是我的情况，我们应该看到一个<strong class="ih hj">负载平衡器设置和实例设置</strong>。<strong class="ih hj">选择公共可见性</strong>和<strong class="ih hj">检查公共子网。</strong>在我的例子中，我们使用应用负载平衡器，这要求<strong class="ih hj">在不同的可用性区域中至少有2个公共子网。</strong></li><li id="9313" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">对于实例设置，<strong class="ih hj">取消选中公共IP地址</strong>和<strong class="ih hj">检查所有私有子网</strong>。</li><li id="0f46" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">应用并继续环境创建。</li></ol><p id="4159" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这应该包括为弹性beanstalk负载平衡应用程序实现静态IP地址所需的步骤。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><p id="17ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我提到的，<strong class="ih hj"> NAT网关有一个静态弹性IP </strong>，这是我需要的IP地址，用于限制邮件服务提供商中的API密钥。</p><p id="7392" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另外，我确实验证了流出的流量是通过IP地址的。</p><p id="61d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用bastion host，我ssh到一个私有实例并运行:</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="94c0" class="ku kv hi kq b fi kw kx l ky kz">$ curl ifconfig.me</span></pre><p id="348f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">IP地址应该与NAT网关弹性IP地址相同。</p><p id="c774" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结束了。</p></div></div>    
</body>
</html>