<html>
<head>
<title>A Simple Automated Reporting: COVID-19 Dashboard</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简单的自动报告:新冠肺炎仪表板</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/a-simple-automated-reporting-covid-19-dashboard-8a610b90b2f?source=collection_archive---------6-----------------------#2021-11-17">https://medium.com/geekculture/a-simple-automated-reporting-covid-19-dashboard-8a610b90b2f?source=collection_archive---------6-----------------------#2021-11-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="70a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自动化现在已经成为一种必然，包括在数据领域。数据字段中的自动化可用于自动获取数据、处理数据和更新仪表板。这样我们就不需要在每次数据/仪表板需要更新的时候都运行源代码或语法。这一次，我将向您展示如何为新冠肺炎仪表板进行简单的自动化报告。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/c645ff533dea716c9817e1705e236c9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*2M5m00q53FnwB4vPqYrYUg.jpeg"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">Fig. 1 — Reporting Automation Workflow</figcaption></figure><p id="eae5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下文中，我将提到构建使用任务调度器自动更新的仪表板的步骤。要使用的新冠肺炎数据直接取自API(应用程序编程接口)，可从<a class="ae jp" href="https://data.covid19.go.id/public/api/" rel="noopener ugc nofollow" target="_blank"> covid19.go.id </a>获得。从API检索数据的一种方法是使用python中的请求库。此方法是从特定服务器检索数据的最常用方法。</p><h1 id="0cd8" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak"> 1。从covid19.go.id </strong>中检索数据</h1><p id="7d99" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">在第一步中，我们需要使用以下命令导入所需的库:</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="fdc1" class="ky jr hi ku b fi kz la l lb lc">import request</span></pre><p id="eabd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您没有安装这个库，那么您必须首先使用以下命令安装它:</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="0b4e" class="ky jr hi ku b fi kz la l lb lc">$ pip install requests</span></pre><p id="bb89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以通过使用<strong class="ih hj"> request.get('url') </strong>从特定的资源中检索数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ld"><img src="../Images/d517a027c3034d18c7a71bde59f48685.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1fce0_p2ql8cdhgnRwQBZw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Fig. 2 — Retrieve COVID-19 data</figcaption></figure><p id="6f9e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如图2所示。，我检索万丹省的新冠肺炎数据，<strong class="ih hj"> resp_banten </strong>是响应对象。运行代码后，您可以在上面看到状态代码为“200 ”,表示数据请求成功，请求的内容可供提取。与GET请求相关的几个状态代码:</p><ul class=""><li id="5082" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">一切顺利，结果已经返回(如果有的话)。</li><li id="34b9" class="li lj hi ih b ii lu im lv iq lw iu lx iy ly jc ln lo lp lq bi translated"><code class="du lr ls lt ku b">301</code>:服务器正在将您重定向到不同的端点。当公司切换域名或端点名称更改时，可能会发生这种情况。</li><li id="b440" class="li lj hi ih b ii lu im lv iq lw iu lx iy ly jc ln lo lp lq bi translated"><code class="du lr ls lt ku b">400</code>:服务器认为你提出了一个错误的请求。当你没有发送正确的数据时，就会发生这种情况。</li><li id="e4b1" class="li lj hi ih b ii lu im lv iq lw iu lx iy ly jc ln lo lp lq bi translated"><code class="du lr ls lt ku b">401</code>:服务器认为你没有通过认证。许多API需要登录凭证，所以当您没有发送正确的凭证来访问API时，就会发生这种情况。</li><li id="860c" class="li lj hi ih b ii lu im lv iq lw iu lx iy ly jc ln lo lp lq bi translated"><code class="du lr ls lt ku b">403</code>:你试图访问的资源被禁止:你没有权限查看。</li><li id="ea9c" class="li lj hi ih b ii lu im lv iq lw iu lx iy ly jc ln lo lp lq bi translated"><code class="du lr ls lt ku b">404</code>:在服务器上找不到您试图访问的资源。</li><li id="f59b" class="li lj hi ih b ii lu im lv iq lw iu lx iy ly jc ln lo lp lq bi translated"><code class="du lr ls lt ku b">503</code>:服务器没有准备好处理请求。</li></ul><p id="86f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于状态码的更多信息，你可以在这里阅读<a class="ae jp" href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes" rel="noopener ugc nofollow" target="_blank">HTTP状态码列表——维基百科</a>。在我们知道请求成功后，我们可以使用<strong class="ih hj">头属性</strong>知道我们请求的文件类型。对于这个案例研究，请求的内容在JSON文件中。如图3所示，我使用了<strong class="ih hj">。json() </strong>方法，看看我们将从API接收到什么。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es lz"><img src="../Images/ab4615aa51c1279fde5f8109550b11db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zulwP0nTBcmUWPaN9nAZ5g.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Fig. 3 — Convert JSON to a Pandas DataFrame</figcaption></figure><h1 id="5e2f" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak"> 2。将JSON转换成熊猫数据帧</strong></h1><p id="84d5" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">我们从API得到的JSON文件是“key-value ”,类似于Python中的字典。因为它与Python中的Dictionary足够相似，所以我们可以直接将其转换为Pandas数据帧。</p><h1 id="d640" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak"> 3。将所有数据合并成一个数据帧</strong></h1><p id="be30" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">在得到印尼所有省份的新冠肺炎数据后，我们需要使用<strong class="ih hj">将这些数据组合起来。merge() </strong>或<strong class="ih hj">。concat() </strong>方法。结果如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ma"><img src="../Images/c8ccbde29a7188ac765c9827ee3cbe10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mM1dpaZ_TlgKxJbzjlZYyw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Fig. 4 — A Combined DataFrame that contains COVID-19 data of all provinces in Indonesia</figcaption></figure><h1 id="a64a" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak"> 4。将数据上传至谷歌工作表</strong></h1><p id="2f51" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">接下来，我们需要将新冠肺炎的数据上传到Google工作表中。这是必要的，以便仪表板可以持续获得数据更新。将数据上传到google sheets的过程不像导出数据那样是手动的。csv或。xls格式，然后我们每次有新数据的时候就导入到google sheet中。我们没有手动完成，但是为了节省时间，我们将使用python自动完成。所以我们会在每次有新数据的时候用python把数据上传到Google Sheet，那么Google Sheet里的数据就会自动更新。在我们继续我们的步骤之前，我们必须确定我们是否已经有一个谷歌帐户。</p><p id="bd8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 4.1创建谷歌服务账户</strong></p><ul class=""><li id="8bf7" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">首先，我们应该在<a class="ae jp" href="https://console.cloud.google.com/apis/dashboard?pli=1" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>创建一个开发者账户。单击“创建新项目”或选择我们现有的一个项目。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es mb"><img src="../Images/78602aa58a1f13e69637c385a32198d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R7ONtLu9eR-dbuVKT0o9UQ.jpeg"/></div></div></figure><ul class=""><li id="7432" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">您将被重定向到项目仪表板，在那里单击“启用API和服务”。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es mc"><img src="../Images/e135add79bdc1c5ba84352ae2a00fba4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Ys8ZpO4yJ8m-ThIyHj53g.png"/></div></div></figure><ul class=""><li id="d94d" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">在API库中，我们搜索“Sheets API”和“Google Drive API”，然后为这两个库单击“Enable”。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es md"><img src="../Images/f0251c2c26dddc76a56fedcd3bd6454d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1zHRoKF1J_3cGIrmFyVBNA.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es me"><img src="../Images/9e223d0c77f13f89fb4609e614797ff2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pxPXZ7DyLPmAYZzK7rv-Cg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es mf"><img src="../Images/bbe857e474ce6132345aa914d230a0c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Px2cqtWKRrwAf7Lj-UHnzw.png"/></div></div></figure><ul class=""><li id="c25e" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">当我们启用这两个库时，在Google Drive API中点击“管理”,然后我们会看到一个如下的屏幕。单击“创建凭据”创建服务帐户。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es mg"><img src="../Images/d7d053280711d22ee09bf147721dabe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i6DIy4Z-S75AzuuitiHZMw.png"/></div></div></figure><ul class=""><li id="71e0" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">选择一个API→“Google Drive API”。其余的我们随意填充。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mh"><img src="../Images/e31d3c20d409a8f2eaa4b2606803cbda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*qMQRo-W0AZabrr15ri_wiA.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es mi"><img src="../Images/2044b2b83785c1f098a35dd2b493b951.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tVz0qBHJfaYyp0HmbgAYCA.png"/></div></div></figure><ul class=""><li id="01af" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">在服务帐户中，单击“管理密钥”。这里我们选择JSON作为键类型。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es mb"><img src="../Images/ba5c2cd5e0e2afc54e237885b2dcc958.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SrvAHaHonyRmUOfvdqDutA.jpeg"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mj"><img src="../Images/b60bde427008dd52ffe8965f34996b88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*W7m78kNhdivPY_CTn7U9Dw.png"/></div></figure><p id="f3cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 4.2安装</strong></p><p id="11b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用<a class="ae jp" href="http://gspread - gspread 4.0.0 documentation" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> gspread </strong> </a>和<strong class="ih hj"> oauth2client </strong>服务来授权和启用API访问Google云平台。我们可以使用以下命令安装库:</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="96b3" class="ky jr hi ku b fi kz la l lb lc">$ pip install gspread<br/>$ pip <!-- -->install --upgrade google-api-python-client oauth2client <br/>##(depreceated)</span></pre><p id="4f85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是现在outh2client被<a class="ae jp" href="https://google-auth.readthedocs.io/en/master/" rel="noopener ugc nofollow" target="_blank">弃用</a>，所以我们改为安装<a class="ae jp" href="https://google-auth.readthedocs.io/en/master/" rel="noopener ugc nofollow" target="_blank"> google-auth </a>。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="5534" class="ky jr hi ku b fi kz la l lb lc">$ pip install --upgrade google-auth</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es mk"><img src="../Images/500e211b808bab54420af673cbbcfdbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sd9ya05coT_qreJJpDONyA.png"/></div></div></figure><p id="217c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 4.3授权</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ml"><img src="../Images/773d23277f9d79fad41b10801d22f9ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GQN7mu7GwYZytNS4QLKZzQ.png"/></div></div></figure><p id="ee69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 4.4将数据导出或更新至Google工作表</strong></p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="414f" class="ky jr hi ku b fi kz la l lb lc">worksheet = sh.get_worksheet(0) #First worksheet</span><span id="dd01" class="ky jr hi ku b fi mm la l lb lc">#### Append data to sheet ###<br/>cov_prov_id = prov_id<br/>set_with_dataframe(worksheet, cov_prov_id)</span></pre><p id="d697" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:当我们想要更新数据时，我们有两种方法:<br/> 1。清除谷歌工作表中的所有数据，然后我们导出最新更新的数据。(这个项目我用的就是这种方式)。</p><p id="250f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.我们将新更新的数据插入最后一行+ i。</p><h1 id="7938" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak"> 5。从谷歌工作表数据构建仪表板</strong></h1><p id="5060" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">我做的简单仪表板可以在这里看到<a class="ae jp" href="https://fahmiam2.github.io/Covid19-Report-Indonesia/" rel="noopener ugc nofollow" target="_blank">https://fahmiam2.github.io/Covid19-Report-Indonesia/</a>。</p><p id="cc7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每次我们想要更新仪表板时，只需点击<code class="du lr ls lt ku b">CTRL + E</code>。</p><h1 id="de06" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">6。使用任务调度器自动更新数据</h1><p id="d2ab" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">在最后一步中，我们将使用任务调度器自动更新数据。任务调度器根据我们指定的时间运行我们的python脚本，例如，每1小时、每5小时或每24小时。使用任务计划程序的好处是它免费且易于使用。缺点是电脑操作系统必须开启并连接互联网。</p><ul class=""><li id="a2dd" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">首先，从jupyter notebook(.ipynb)变成。py文件格式。有两种方式:<strong class="ih hj"> (I) </strong>使用jupyter笔记本上的下载功能或者<strong class="ih hj"> (II) </strong>使用CMD或Anaconda提示符下的命令行。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es mn"><img src="../Images/7715636de421e56a020effc35e4a4a0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxECYh6cMguq-drRNPue2w.png"/></div></div></figure><ul class=""><li id="df06" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">点击Windows搜索，搜索“任务调度器”。</li><li id="824c" class="li lj hi ih b ii lu im lv iq lw iu lx iy ly jc ln lo lp lq bi translated">点击“操作”→“创建基本任务”</li><li id="9b69" class="li lj hi ih b ii lu im lv iq lw iu lx iy ly jc ln lo lp lq bi translated">将我们的python.exe位置放在“程序/脚本”，将我们的脚本位置放在“开始于(可选)”。你可以把你的python的文件(。py)在“添加参数(可选)”处。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mo"><img src="../Images/fa61ab157909fe41413d70bd07178c78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*WBShRwSROg5vL2kBMNuVqg.png"/></div></figure><ul class=""><li id="a7ed" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">接下来，我们导航到“触发器部分”。这里，我们创建了一个新的触发器，以我们想要的时间表运行我们的程序。</li><li id="9afa" class="li lj hi ih b ii lu im lv iq lw iu lx iy ly jc ln lo lp lq bi translated">结束</li></ul><p id="cea9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，伙计们，我们已经完成了创建简单自动报告的步骤。希望这对你有用。如果你有任何建议，请随时与我分享。感谢你阅读这篇文章，祝你有美好的一天！</p></div></div>    
</body>
</html>