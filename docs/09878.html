<html>
<head>
<title>Build a REST API with Golang and MongoDB — Gin-gonic Version</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Golang和MongoDB构建一个REST API—Gin-gonic版本</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/build-a-rest-api-with-golang-and-mongodb-gin-gonic-version-6213083a86fe?source=collection_archive---------3-----------------------#2022-01-03">https://medium.com/geekculture/build-a-rest-api-with-golang-and-mongodb-gin-gonic-version-6213083a86fe?source=collection_archive---------3-----------------------#2022-01-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b632f389be8b82fab99eba2373513785.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pMMIcmi24UEGOL_WBof5bQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">cover photo</figcaption></figure><p id="2f13" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">表述性状态转移(REST)是一种指导应用程序编程接口(API)设计和开发的架构模式。REST APIs已经成为产品的服务器部分和它的客户机之间的通信标准，以提高性能、可伸缩性、简单性、可修改性、可见性、可移植性和可靠性。</p><p id="f30d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这篇文章将讨论使用<a class="ae js" href="https://github.com/gin-gonic/gin" rel="noopener ugc nofollow" target="_blank"> Gin-gonic </a>框架和<a class="ae js" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>用Golang构建一个用户管理应用。在本教程的最后，我们将学习如何构建一个Gin-gonic应用程序，构建一个REST API并使用MongoDB持久化我们的数据。</p><p id="6fb1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Gin-gonic，俗称<strong class="iw hj"> Gin </strong>，是一个用Golang编写的HTTP web框架，具有性能和生产力支持。Gin使用定制版本的<a class="ae js" href="https://github.com/julienschmidt/httprouter" rel="noopener ugc nofollow" target="_blank"> HttpRouter </a>，这是一个轻量级、高性能的HTTP请求路由器，它在API路由中的导航速度比大多数框架都要快。</p><p id="d93c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">MongoDB是一个基于文档的数据库管理程序，用作关系数据库的替代方案。MongoDB支持处理大型分布式数据集，并提供无缝存储或检索信息的选项。</p><p id="28dd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可以在这个<a class="ae js" href="https://github.com/Mr-Malomz/gin-mongo-api" rel="noopener ugc nofollow" target="_blank">库</a>中找到完整的源代码。</p><h1 id="f6a0" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">先决条件</h1><p id="0cc3" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">这篇文章中的以下步骤需要Golang经验。使用MongoDB的经验不是必需的，但是拥有它是很好的。</p><p id="749d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们还需要以下物品:</p><ul class=""><li id="adac" class="kw kx hi iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">一个<a class="ae js" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB帐户</a>来托管数据库。<a class="ae js" href="https://www.mongodb.com/cloud/atlas/register" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj">报名</strong> </a> <strong class="iw hj">完全免费</strong>。</li><li id="948b" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><a class="ae js" href="https://www.postman.com/downloads/" rel="noopener ugc nofollow" target="_blank"> Postman </a>或者你选择的任何API测试应用</li></ul><h1 id="3114" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">让我们编码</h1><h2 id="b2e7" class="lk ju hi bd jv ll lm ln jz lo lp lq kd jf lr ls kh jj lt lu kl jn lv lw kp lx bi translated">入门指南</h2><p id="703d" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">首先，我们需要导航到所需的目录，并在我们的终端中运行下面的命令</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="dc36" class="lk ju hi md b fi mh mi l mj mk">mkdir gin-mongo-api &amp;&amp; cd gin-mongo-api</span></pre><p id="ee11" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">该命令创建一个<code class="du ml mm mn md b">gin-mongo-api</code>文件夹，并导航到项目目录。</p><p id="1179" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们需要通过运行以下命令来初始化Go模块以管理项目依赖关系:</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="103f" class="lk ju hi md b fi mh mi l mj mk">go mod init gin-mongo-api</span></pre><p id="a9ea" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">该命令将创建一个<code class="du ml mm mn md b">go.mod</code>文件，用于跟踪项目依赖关系。</p><p id="7a3e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们继续安装所需的依赖项:</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="acc2" class="lk ju hi md b fi mh mi l mj mk">go get -u github.com/gin-gonic/gin go.mongodb.org/mongo-driver/mongo github.com/joho/godotenv github.com/go-playground/validator/v10</span></pre><p id="6fee" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ml mm mn md b">github.com/gin-gonic/gin</code>是一个用于构建web应用程序的框架。</p><p id="597c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ml mm mn md b">go.mongodb.org/mongo-driver/mongo</code>是连接MongoDB的驱动。</p><p id="a758" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ml mm mn md b">github.com/joho/godotenv</code>是一个管理环境变量的库。</p><p id="cc24" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ml mm mn md b">github.com/go-playground/validator/v10</code>是一个用于验证结构和字段的库。</p><h1 id="bf16" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">应用程序入口点</h1><p id="b604" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">安装好项目依赖项后，我们需要在根目录下创建<code class="du ml mm mn md b">main.go</code>文件，并添加下面的代码片段:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="6111" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的代码片段执行了以下操作:</p><ul class=""><li id="0500" class="kw kx hi iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">导入所需的依赖项。</li><li id="f9bf" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">使用<code class="du ml mm mn md b">Default</code>配置初始化Gin路由器。默认功能用默认中间件(记录器和恢复)配置Gin路由器。</li><li id="9e70" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">使用<code class="du ml mm mn md b">Get</code>函数路由到<code class="du ml mm mn md b">/</code>路径和返回<code class="du ml mm mn md b">JSON of Hello from Gin-gonic &amp; mongoDB</code>的处理函数。</li><li id="f266" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">使用<code class="du ml mm mn md b">Run</code>功能将路由器连接到<strong class="iw hj"> http。服务器</strong>并开始监听和服务<code class="du ml mm mn md b">localhost:6000</code>上的HTTP请求。</li></ul><p id="2dc9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们可以通过在终端中运行下面的命令来启动开发服务器，从而测试我们的应用程序。</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="19fd" class="lk ju hi md b fi mh mi l mj mk">go run main.go</span></pre><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/be0651162d0af9dc897e3d3eff7379e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ypR45Pjc8yhOgC3e.png"/></div></div></figure><h1 id="3df2" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">Golang的模块化</h1><p id="9ea3" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">对于我们的项目来说，有一个好的文件夹结构是很重要的。良好的项目结构简化了我们在应用程序中处理依赖关系的方式，并使我们和其他人更容易阅读我们的代码库。</p><p id="7a05" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为此，我们需要在我们的项目目录中创建<code class="du ml mm mn md b">configs</code>、<code class="du ml mm mn md b">controllers</code>、<code class="du ml mm mn md b">models</code>、<code class="du ml mm mn md b">responses</code>和<code class="du ml mm mn md b">routes</code>文件夹。</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div class="er es mr"><img src="../Images/3d5e16a7b5ddf0fd975603f61fb946e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/0*MyI30XCwJCvRRb3n.png"/></div></figure><p id="2333" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">PS</strong>:<em class="ms"/><code class="du ml mm mn md b"><em class="ms">go.sum</em></code><em class="ms">文件包含所有的依赖校验和，由</em> <code class="du ml mm mn md b"><em class="ms">go</em></code> <em class="ms">工具管理。我们不必为此担心。</em></p><p id="63cd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ml mm mn md b">configs</code>用于模块化项目配置文件</p><p id="f5bb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">控制器用于模块化应用逻辑。</p><p id="5e50" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ml mm mn md b">models</code>用于模块化数据和数据库逻辑。</p><p id="373c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ml mm mn md b">responses</code>用于模块化文件，描述我们希望API给出的响应。这一点以后会变得更加清楚。</p><p id="d566" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ml mm mn md b">routes</code>用于模块化URL模式和处理程序信息。</p><h1 id="b0ca" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">设置MongoDB</h1><p id="9c59" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">完成后，我们需要登录或注册我们的<a class="ae js" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>账户。点击项目下拉菜单并点击<strong class="iw hj">新项目</strong>按钮。</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/17b94dbdc2f672e5b64f512165a71006.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*N_usJv5Qhb3jitXk.png"/></div></div></figure><p id="7b5b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">输入<code class="du ml mm mn md b">golang-api</code>作为项目名称，点击下一个<strong class="iw hj">，点击<strong class="iw hj">创建项目。</strong></strong></p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/af63e074ce5eb7595605845c750d1131.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*L9GQSa3mKyFUhFnH.png"/></div></div></figure><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/763a7d2748cc5deac431382d966208d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*60ynVaEIDb1SHNCX.png"/></div></div></figure><p id="c60e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">点击<strong class="iw hj">建立数据库</strong></p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/e12dc6f1bc6acc8f8e6c40a40e890071.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Scm-ObhYtgZCMxCF.png"/></div></div></figure><p id="ad12" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">选择<strong class="iw hj">共享</strong>作为数据库类型。</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/109131f76f9b96db04c6d13135c87d4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LvWCPx4XMhB6qLhZ.png"/></div></div></figure><p id="e037" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">点击<strong class="iw hj">创建</strong>以设置集群。这可能需要一些时间来设置。</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/6393f7c63c3b45030c9a162719d2a9a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kgEwGK5ldZwzfIsc.png"/></div></div></figure><p id="3457" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们需要通过输入<strong class="iw hj">用户名</strong>、<strong class="iw hj">密码</strong>然后点击<strong class="iw hj">创建用户</strong>来创建一个从外部访问数据库的用户。我们还需要添加我们的IP地址，以便通过点击<strong class="iw hj">添加我当前的IP地址</strong>按钮安全地连接到数据库。然后点击<strong class="iw hj">完成并关闭</strong>保存更改。</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/418c9b337955e72701bdaf08534ecb2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DxAh-GnDgZrogQg7.png"/></div></div></figure><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/90778640ec4a902e3778010334626a9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Bbt3cmnt_iZ2dExo.png"/></div></div></figure><p id="fc6f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">保存更改后，我们应该会看到一个数据库部署屏幕，如下所示:</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/5f892cff5a3065b3bc4968c98c6e0faf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wi8xoICo0iSAGjBU.png"/></div></div></figure><h1 id="90f5" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">将我们的应用程序连接到MongoDB</h1><p id="9c95" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">配置完成后，我们需要将应用程序与创建的数据库连接起来。为此，点击<strong class="iw hj">连接</strong>按钮</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/57b574cbbaf742ffc2156ca6fd3d6f7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VdEnvLPb1HinPQps.png"/></div></div></figure><p id="fca2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">点击<strong class="iw hj">连接你的应用</strong>，更改<strong class="iw hj">驱动</strong>即可，而<strong class="iw hj">版本</strong>如下图所示。然后点击复制图标<strong class="iw hj">复制连接字符串。</strong></p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/485bb14bd084d73ced8bf1820ec6a53c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nFR_HOP8l-uHHIZj.png"/></div></div></figure><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/7c3e825dedfb235d45d2967513d0a0d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-hO0PuFzHbMuq4r4.png"/></div></div></figure><p id="a6e1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">设置环境变量<br/> </strong>接下来，我们必须用我们之前创建的用户密码修改复制的连接字符串，并更改数据库名称。为此，首先，我们需要在根目录中创建一个<code class="du ml mm mn md b">.env</code>文件，并在该文件中添加下面的代码片段:</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="06bf" class="lk ju hi md b fi mh mi l mj mk">MONGOURI=mongodb+srv://&lt;YOUR USERNAME HERE&gt;:&lt;YOUR PASSWORD HERE&gt;@cluster0.e5akf.mongodb.net/myFirstDatabese?retryWrites=true&amp;w=majority</span></pre><p id="9d85" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下面是正确填充的连接字符串示例:</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="50ce" class="lk ju hi md b fi mh mi l mj mk">MONGOURI=mongodb+srv://malomz:malomzPassword@cluster0.e5akf.mongodb.net/golangDB?retryWrites=true&amp;w=majority</span></pre><figure class="ly lz ma mb fd ij er es paragraph-image"><div class="er es mu"><img src="../Images/27d2201f6f03e6f52c242f9e4b9924d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/0*eQdybkejuxSchO_2.png"/></div></figure><p id="3f5a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">加载环境变量<br/> </strong>完成后，我们需要创建一个助手函数来使用我们之前安装的<code class="du ml mm mn md b">github.com/joho/godotenv</code>库加载环境变量。为此，我们需要导航到<code class="du ml mm mn md b">configs</code>文件夹，在这个文件夹中，创建一个<code class="du ml mm mn md b">env.go</code>文件，并添加下面的代码片段:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="0c32" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的代码片段执行了以下操作:</p><ul class=""><li id="434f" class="kw kx hi iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">导入所需的依赖项。</li><li id="9c88" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个<code class="du ml mm mn md b">EnvMongoURI</code>函数，检查环境变量是否被正确加载并返回环境变量。</li></ul><p id="282d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">连接到MongoDB <br/> </strong>要从我们的应用程序连接到MongoDB数据库，首先我们需要导航到<code class="du ml mm mn md b">configs</code>文件夹，在这个文件夹中，创建一个<code class="du ml mm mn md b">setup.go</code>文件并添加下面的代码片段:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="4e43" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的代码片段执行了以下操作:</p><ul class=""><li id="7517" class="kw kx hi iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">导入所需的依赖项。</li><li id="3f53" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个<code class="du ml mm mn md b">ConnectDB</code>函数，首先配置客户机使用正确的URI并检查错误。其次，我们定义了一个10秒的超时，我们希望在尝试连接时使用。第三，检查连接到数据库时是否有错误，如果连接时间超过10秒，则取消连接。最后，我们pinged数据库来测试我们的连接，并返回客户端实例。</li><li id="4dc8" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个<code class="du ml mm mn md b">ConnectDB</code>的<code class="du ml mm mn md b">DB</code>变量实例。这将在创建收藏时派上用场。</li><li id="8ab8" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个<code class="du ml mm mn md b">GetCollection</code>函数来检索并在数据库上创建<code class="du ml mm mn md b">collections</code>。</li></ul><p id="ea8f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们需要在应用程序启动时连接到数据库。为此，我们需要修改<code class="du ml mm mn md b">main.go</code>，如下所示:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><h1 id="0316" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">设置API路由处理程序和回应类型</h1><p id="53e3" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated"><strong class="iw hj"> Route Handler <br/> </strong>完成后，我们需要在<code class="du ml mm mn md b">routes</code>文件夹中创建一个<code class="du ml mm mn md b">user_route.go</code>文件来管理应用程序中所有与用户相关的路线，如下所示:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="3b38" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们需要将新创建的路由附加到<strong class="iw hj"> http。通过修改<code class="du ml mm mn md b">main.go</code>中的服务器</strong>，如下所示:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="3c21" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们需要创建一个可重用的结构来描述我们的API的响应。为此，导航到<code class="du ml mm mn md b">responses</code>文件夹，在该文件夹中，创建一个<code class="du ml mm mn md b">user_response.go</code>文件并添加以下代码片段:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="c984" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的代码片段创建了一个具有<code class="du ml mm mn md b">Status</code>、<code class="du ml mm mn md b">Message</code>和<code class="du ml mm mn md b">Data</code>属性的<code class="du ml mm mn md b">UserResponse</code>结构来表示API响应类型。</p><p id="81f9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> PS </strong> : <code class="du ml mm mn md b"><em class="ms">json:”status”</em></code> <em class="ms">，</em> <code class="du ml mm mn md b"><em class="ms">json:”message”</em></code> <em class="ms">，</em> <code class="du ml mm mn md b"><em class="ms">json:”data”</em></code> <em class="ms">称为</em> <strong class="iw hj"> <em class="ms"> struct标签</em> </strong> <em class="ms">。结构标签允许我们将元信息附加到相应的结构属性上。换句话说，我们使用它们来重新格式化API返回的JSON响应。</em></p><h1 id="f6ba" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">最后，创建REST API</h1><p id="6258" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">接下来，我们需要一个模型来表示我们的应用程序数据。为此，我们需要导航到<code class="du ml mm mn md b">models</code>文件夹，在该文件夹中，创建一个<code class="du ml mm mn md b">user_model.go</code>文件并添加下面的代码片段:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="1b13" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的代码片段执行了以下操作:</p><ul class=""><li id="819c" class="kw kx hi iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">导入所需的依赖项。</li><li id="c834" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个具有所需属性的<code class="du ml mm mn md b">User</code>结构。我们将<code class="du ml mm mn md b">omitempty</code>和<code class="du ml mm mn md b">validate:”required”</code>添加到struct标签中，分别告诉Gin-gonic忽略空字段并使字段成为必填字段。</li></ul><p id="2bcf" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">创建用户端点<br/> </strong>有了模型设置，我们现在可以创建一个函数来创建用户。为此，我们需要导航到<code class="du ml mm mn md b">controllers</code>文件夹，在该文件夹中，创建一个<code class="du ml mm mn md b">user_controller.go</code>文件并添加下面的代码片段:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="44d1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的代码片段执行了以下操作:</p><ul class=""><li id="8de3" class="kw kx hi iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">导入所需的依赖项。</li><li id="634e" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建<code class="du ml mm mn md b">userCollection</code>和<code class="du ml mm mn md b">validate</code>变量，分别使用我们之前安装的<code class="du ml mm mn md b">github.com/go-playground/validator/v10</code>库来创建集合和验证模型。</li><li id="ec73" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个返回Gin-gonic处理程序的<code class="du ml mm mn md b">CreateUser</code>函数。在返回的处理程序中，当将用户插入到文档中时，我们首先定义了一个10秒的超时，使用验证器库来验证请求体和必填字段。我们使用之前创建的<code class="du ml mm mn md b">UserResponse</code>结构返回了适当的消息和状态代码。其次，我们创建了一个<code class="du ml mm mn md b">newUser</code>变量，使用<code class="du ml mm mn md b">userCollection.InsertOne</code>函数插入它，并检查是否有错误。最后，如果插入成功，我们返回正确的响应。</li></ul><p id="1b05" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们需要用路由API URL和相应的控制器更新<code class="du ml mm mn md b">user_routes.go</code>,如下所示:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="0a72" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">获取一个用户端点<br/> </strong>要获取一个用户的详细信息，我们需要修改<code class="du ml mm mn md b">user_controller.go</code>如下所示:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="ee14" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的代码片段执行了以下操作:</p><ul class=""><li id="0d77" class="kw kx hi iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">导入所需的依赖项。</li><li id="da54" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个返回Gin-gonic处理程序的<code class="du ml mm mn md b">GetAUser</code>函数。在返回的处理程序中，我们首先定义了在文档中查找用户时10秒的超时，一个从URL参数中获取用户Id的userId变量和一个用户变量。我们将<code class="du ml mm mn md b">userId</code>从字符串转换为<code class="du ml mm mn md b">primitive.ObjectID</code>类型，即MongoDB使用的<strong class="iw hj"> BSON </strong>类型。其次，我们使用<code class="du ml mm mn md b">userCollection.FindOne</code>搜索用户，将<code class="du ml mm mn md b">objId</code>作为过滤器传递，并使用<code class="du ml mm mn md b">Decode</code>属性方法获取相应的对象。最后，我们返回解码的响应。</li></ul><p id="01df" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们需要用route API URL和相应的控制器更新<code class="du ml mm mn md b">user_routes.go</code>,如下所示:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="1ad0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> PS: </strong> <em class="ms">我们还传递了一个</em> <code class="du ml mm mn md b"><em class="ms">userId</em></code> <em class="ms">作为URL路径的参数。指定的参数必须与我们在控制器中指定的参数相匹配。</em></p><p id="1b61" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">编辑用户端点</strong></p><p id="29bf" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要编辑用户，我们需要修改<code class="du ml mm mn md b">user_controller.go</code>，如下所示:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="1e87" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的<code class="du ml mm mn md b">EditAUser</code>功能与<code class="du ml mm mn md b">CreateUser</code>功能的作用相同。然而，我们包含了一个<code class="du ml mm mn md b">update</code>变量来获取更新的字段，并使用<code class="du ml mm mn md b">userCollection.UpdateOne</code>更新了集合。最后，我们搜索更新后的用户详细信息，并返回解码后的响应。</p><p id="402d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们需要用路由API URL和相应的控制器更新<code class="du ml mm mn md b">user_routes.go</code>,如下所示:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="c75f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">删除用户端点<br/> </strong>要删除用户，我们需要修改<code class="du ml mm mn md b">user_controller.go</code>如下所示:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="c583" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ml mm mn md b">DeleteAUser</code>功能遵循前面的步骤，使用<code class="du ml mm mn md b">userCollection.DeleteOne</code>删除匹配的记录。我们还检查一个项目是否被成功删除，并返回适当的响应。</p><p id="7719" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们需要用路由API URL和相应的控制器更新<code class="du ml mm mn md b">user_routes.go</code>,如下所示:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="e92e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">获取用户列表端点<br/> </strong>要获取用户列表，我们需要修改<code class="du ml mm mn md b">user_controller.go</code>如下所示:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="998c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ml mm mn md b">GetAllUsers</code>函数遵循前面的步骤，使用<code class="du ml mm mn md b">userCollection.Find</code>获取用户列表。我们还使用<code class="du ml mm mn md b">Next</code>属性方法遍历返回的用户列表，以最佳方式读取返回的列表。</p><p id="deca" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们需要用路由API URL和相应的控制器更新user_routes.go，如下所示:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="22d1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">完成user_controller.go </strong></p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="10b6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">完成user_route.go </strong></p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mo mp l"/></div></figure><p id="4809" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">完成后，我们可以通过在终端中运行下面的命令启动开发服务器来测试我们的应用程序。</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="3bab" class="lk ju hi md b fi mh mi l mj mk">go run main.go</span></pre><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/e2c850b46038c89712df036922be9e3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pc-TXXZb3jsUS4os.png"/></div></div></figure><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mw"><img src="../Images/45410a2bc5a837d5bd899357690e4674.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HSPlT1nLQHRHRhCQ.png"/></div></div></figure><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/088115ed9beba14d2cce9ec9bea54a52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kBHQzluZFiH0dZpc.png"/></div></div></figure><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/c8404cd1accec3ee8fb5e6096e97cf05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7ECbHgtneSsTIbql.png"/></div></div></figure><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/74fcb9711fc7daf9834b7d9d90a289cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SXiB5-3UofwveBRW.png"/></div></div></figure><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/ca664a0c0fa96c1666368d4b064f9fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mGIKfYlCORVYzEWj.png"/></div></div></figure><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/e3e956ab79a25b7ae36c3ea12b668d1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2eQK-kcpTPj5yMk8.png"/></div></div></figure><h1 id="afe4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="f7ec" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">这篇文章讨论了如何构建Gin-gonic应用程序，构建REST API，以及使用MongoDB持久化我们的数据。</p><p id="dc07" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可能会发现这些资源很有帮助:</p><ul class=""><li id="cca1" class="kw kx hi iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated"><a class="ae js" href="https://github.com/gin-gonic/gin" rel="noopener ugc nofollow" target="_blank"> Gin-gonic </a></li><li id="1f27" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><a class="ae js" href="https://docs.mongodb.com/drivers/go/current/" rel="noopener ugc nofollow" target="_blank"> MongoDB Go驱动</a></li><li id="d4ab" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><a class="ae js" href="https://github.com/go-playground/validator" rel="noopener ugc nofollow" target="_blank"> Go验证器</a></li><li id="2c12" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><a class="ae js" href="https://github.com/joho/godotenv" rel="noopener ugc nofollow" target="_blank">转到环境加载器</a></li></ul></div></div>    
</body>
</html>