<html>
<head>
<title>How to setup Kotlin Multiplatform on M1 and get the best possible results.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在M1上设置Kotlin多平台并获得最佳效果。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-setup-kotlin-multiplatform-on-m1-and-get-the-best-possible-results-b4fb759ec8b7?source=collection_archive---------8-----------------------#2021-08-25">https://medium.com/geekculture/how-to-setup-kotlin-multiplatform-on-m1-and-get-the-best-possible-results-b4fb759ec8b7?source=collection_archive---------8-----------------------#2021-08-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f2caab41bc8b1d6e237f59782575b706.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GOGOsG6S0cBz5WtV"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@cmalquist?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Clayton</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="26b3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">比方说，你刚买了一台新的M1 Mac，你很兴奋地跳上了kotlin多平台列车，你已经做了Android，你已经设置你的Mac运行与支持JDK的<strong class="ix hj"> arm64 </strong>如<a class="ae iu" href="https://www.azul.com/downloads/?package=jdk" rel="noopener ugc nofollow" target="_blank">阿苏尔JDK </a>。</p><p id="3c0f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你已经得到了这个你想要检验的多平台项目，或者你刚刚用KMM插件自己创建了一个新项目。</p><p id="d8a0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一切都很好，你运行android应用程序(在Android Studio上),它将kotlin多平台模块视为一个库，一切都很好。</p><p id="ee94" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后运行iOS应用程序(在XCode上),它使用kotlin native将模块捆绑成一个框架，然后…..失败了？😲</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="18ec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你疯狂地在谷歌上搜索一个解决方案，但你很快就会发现几个解决方案，比如这里的<a class="ae iu" href="https://github.com/JetBrains/kotlin-native/issues/4034#issuecomment-837950575" rel="noopener ugc nofollow" target="_blank">和这个旧的</a><a class="ae iu" href="https://youtrack.jetbrains.com/issue/KT-43596" rel="noopener ugc nofollow" target="_blank"> youtrack问题</a>，建议你应该使用<strong class="ix hj">英特尔x64 jdk </strong>。</p><p id="9871" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您还会发现这篇关于问题的<a class="ae iu" href="https://yaxarat.medium.com/setting-up-the-correct-environment-for-kotlin-multiplatform-mobile-development-in-m1-apple-silicon-fa9ee62d0c1d" rel="noopener">详细文章，它会让您明白，您可能不得不放弃一些您目前享受的M1性能优势。</a></p><div class="jz ka ez fb kb kc"><a href="https://github.com/JetBrains/kotlin-native/issues/4034#issuecomment-837950575" rel="noopener  ugc nofollow" target="_blank"><div class="kd ab dw"><div class="ke ab kf cl cj kg"><h2 class="bd hj fi z dy kh ea eb ki ed ef hh bi translated">NoClassDefFoundError:无法初始化类llvm.llvm问题#4034 JetBrains/kotlin-native</h2><div class="kj l"><h3 class="bd b fi z dy kh ea eb ki ed ef dx translated">此存储库已由所有者存档。它现在是只读的。此时您不能执行该操作。你…</h3></div><div class="kk l"><p class="bd b fp z dy kh ea eb ki ed ef dx translated">github.com</p></div></div><div class="kl l"><div class="km l kn ko kp kl kq io kc"/></div></div></a></div><p id="d98b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你像我一样抱怨(我有😂)，有一种方法可以在实现多平台的同时获得原生优势。首先，您必须了解问题的存在是因为kotlin本机编译器版本konan不支持arm64 jdk，从而导致了低级虚拟机(llvm)的问题。</p><p id="c66c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在做了一点研究后，我发现有一种方法可以在<a class="ae iu" href="https://blog.jetbrains.com/kotlin/2021/07/kotlin-1-5-30-m1-released/" rel="noopener ugc nofollow" target="_blank"> jetbrains博客</a>上获得对M1的早期访问支持。</p><div class="jz ka ez fb kb kc"><a href="https://blog.jetbrains.com/kotlin/2021/07/kotlin-1-5-30-m1-released/" rel="noopener  ugc nofollow" target="_blank"><div class="kd ab dw"><div class="ke ab kf cl cj kg"><h2 class="bd hj fi z dy kh ea eb ki ed ef hh bi translated">Kotlin 1.5.30预览版，支持原生Apple芯片，针对CocoaPods改进了Kotlin DSL</h2><div class="kj l"><h3 class="bd b fi z dy kh ea eb ki ed ef dx translated">成为第一个尝试Kotlin 1.5.30中的新功能和改进的人:原生Apple芯片支持，以及…</h3></div><div class="kk l"><p class="bd b fp z dy kh ea eb ki ed ef dx translated">blog.jetbrains.com</p></div></div><div class="kl l"><div class="kr l kn ko kp kl kq io kc"/></div></div></a></div><p id="0667" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以改变多平台koltin gradle插件指向1.5.30-M1 <a class="ae iu" href="https://search.maven.org/artifact/org.jetbrains.kotlin/kotlin-gradle-plugin/1.5.30-M1/jar" rel="noopener ugc nofollow" target="_blank">依赖</a>应该能解决问题吧？</p><div class="jz ka ez fb kb kc"><a href="https://search.maven.org/artifact/org.jetbrains.kotlin/kotlin-gradle-plugin/1.5.30-M1/jar" rel="noopener  ugc nofollow" target="_blank"><div class="kd ab dw"><div class="ke ab kf cl cj kg"><h2 class="bd hj fi z dy kh ea eb ki ed ef hh bi translated">Maven中央存储库搜索</h2><div class="kj l"><h3 class="bd b fi z dy kh ea eb ki ed ef dx translated">Maven中央存储库维护者的官方搜索</h3></div><div class="kk l"><p class="bd b fp z dy kh ea eb ki ed ef dx translated">search.maven.org</p></div></div></div></a></div><p id="6ed9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">嗯…不完全是。如果你在iPhone上运行应用程序，你应该没有问题，但如果你的目标设备是一个模拟器，你会遇到这个问题。</p><blockquote class="ks kt ku"><p id="7a8e" class="iv iw kv ix b iy iz ja jb jc jd je jf kw jh ji jj kx jl jm jn ky jp jq jr js hb bi translated">ld:警告:为iOS Simulator-arm64构建，但试图链接为iOS Simulator-x86_64构建的文件</p></blockquote><p id="5bea" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">震惊是因为文章明确写明支持<strong class="ix hj"> iosSimulatorArm64。</strong>你疯狂地在谷歌上搜索其他解决方案，但很快找到一个建议，你应该<a class="ae iu" href="https://stackoverflow.com/a/68301640/7093155" rel="noopener ugc nofollow" target="_blank">在rosetta </a>下运行XCode来让它工作。</p><p id="0cbf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你再次抱怨，有一个解决方案是从模拟器构建中排除arm64。这应该可以让你的应用程序在XCode中启动并运行。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kz"><img src="../Images/a66964d36e5212779dc330bca610d110.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RhBNCpEjKjcMlhsprKJqWw.jpeg"/></div></div></figure><p id="3331" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">总之，你不需要改变你的jdk，你只需要改变插件版本，此外，如果你想在模拟器上运行，同时保留M1本地的性能，你只需要对XCode做一个小的调整。</p><p id="795b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢阅读，保持咖啡因！</p></div></div>    
</body>
</html>