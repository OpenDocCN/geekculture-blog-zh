<html>
<head>
<title>How To BackUp &amp; Restore Your Dockerized Oracle Databases</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何备份和恢复您的归档Oracle数据库</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-backup-restore-your-dockerized-oracle-databases-2c1e263322bc?source=collection_archive---------6-----------------------#2022-06-28">https://medium.com/geekculture/how-to-backup-restore-your-dockerized-oracle-databases-2c1e263322bc?source=collection_archive---------6-----------------------#2022-06-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a2a03c7aefce915cdcab4c38f3ac646a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m9yNOu1Fd387gaBU"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@woolyart?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">B K</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="be4a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最近，我正在处理一项关于Oracle数据库的工作任务，我必须备份我的工作数据库，以确保我不会浪费将数据填充到这些数据库中所花费的时间。但是我很难在网上找到一个来源，在一个dockerized oracle数据库的上下文中解释这一点。因此，经过一番挖掘，我能够让它工作，并想到写这篇短文。</p><p id="77ea" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将使用Oracle Database 19c Docker映像，它是按照Oracle Github<a class="ae iu" href="https://github.com/oracle/docker-images/tree/main/OracleDatabase/SingleInstance" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj"><em class="jt"/></strong></a><strong class="ix hj"><em class="jt">，</em> </strong>中的说明在本地构建的，我假设您已经在本地/远程机器上设置了数据库。</p><p id="b441" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，您应该使用下面的命令使用<code class="du ju jv jw jx b">docker exec</code>在docker容器内部进行bash。</p><pre class="jy jz ka kb fd kc jx kd ke aw kf bi"><span id="5214" class="kg kh hi jx b fi ki kj l kk kl">docker exec -it &lt;NAME-OF-DOCKER-CONTAINER&gt;</span></pre><p id="884a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在其中，您应该使用<code class="du ju jv jw jx b">sqlplus</code>作为<code class="du ju jv jw jx b">sysdba</code>用户登录到您的数据库实例。</p><pre class="jy jz ka kb fd kc jx kd ke aw kf bi"><span id="4bbe" class="kg kh hi jx b fi ki kj l kk kl">sqlplus / as sysdba@&lt;NAME-OF-YOUR-PDB/CDB&gt;</span></pre><p id="85b7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我们应该在我们的PDB中创建一个<code class="du ju jv jw jx b">DIRECTORY</code>数据库对象，它将本地(docker容器的)文件系统中的一个位置映射到我们的数据库。</p><pre class="jy jz ka kb fd kc jx kd ke aw kf bi"><span id="0835" class="kg kh hi jx b fi ki kj l kk kl">ALTER SESSION SET CONTAINER=&lt;PDB-NAME&gt;;</span><span id="49a0" class="kg kh hi jx b fi km kj l kk kl">CREATE OR REPLACE DIRECTORY EXP_DIR AS '/home/oracle';</span></pre><p id="0a50" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后向您的用户授予对创建的目录对象的读/写权限。</p><pre class="jy jz ka kb fd kc jx kd ke aw kf bi"><span id="c4b3" class="kg kh hi jx b fi ki kj l kk kl">GRANT READ, WRITE ON DIRECTORY EXP_DIR TO &lt;USERNAME&gt;;</span></pre><p id="fe6d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">并授予导出和导入权限。</p><pre class="jy jz ka kb fd kc jx kd ke aw kf bi"><span id="aefa" class="kg kh hi jx b fi ki kj l kk kl">GRANT datapump_exp_full_database TO &lt;USERNAME&gt;;<br/>GRANT datapump_imp_full_database TO &lt;USERNAME&gt;;</span></pre><p id="daca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，在数据库端完成了必要的设置。键入<code class="du ju jv jw jx b">exit;</code>,再次退出bash终端。</p><p id="9ee1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在您可以使用内置的<code class="du ju jv jw jx b">expdp</code>实用程序来导出您的数据库；</p><pre class="jy jz ka kb fd kc jx kd ke aw kf bi"><span id="662c" class="kg kh hi jx b fi ki kj l kk kl">expdp &lt;ORIGINAL-DATABASE-USERNAME&gt;/&lt;PASSWORD&gt;@&lt;PDB-NAME&gt; schemas=&lt;ORIGINAL-DATABASE-USERNAME&gt; directory=EXP_DIR dumpfile=db1.dmp logfile=db1.log</span></pre><p id="d55d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，我有一个名为AMDB的用户/数据库，在PDB的密码是“test123”，“ORCL”。所以我的导出命令看起来像这样。</p><pre class="jy jz ka kb fd kc jx kd ke aw kf bi"><span id="101c" class="kg kh hi jx b fi ki kj l kk kl">expdp AMDB/test123@ORCL schemas=AMDB directory=EXP_DIR dumpfile=db1.dmp logfile=db1.log</span></pre><p id="7f44" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果所有给定的设置都正确，该命令将触发数据库导出，这将需要一些时间。</p><p id="6ab3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该命令完成后，您将看到映射目录中的两个文件，在本例中是<code class="du ju jv jw jx b">/home/oracle</code>目录。</p><p id="0ccc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您的数据库已成功备份，这两个文件可用于恢复您的数据库。</p><p id="192d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们来看看这个过程。</p><p id="3845" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为此，您可以使用oracle提供的<code class="du ju jv jw jx b">impdp</code>实用程序。</p><pre class="jy jz ka kb fd kc jx kd ke aw kf bi"><span id="9a83" class="kg kh hi jx b fi ki kj l kk kl">impdp system/&lt;SYSTEM-PASSWORD&gt;@&lt;PDB-NAME&gt; schemas=&lt;ORIGNAL-USERNAME&gt;  remap_schema=&lt;ORIGNAL-USERNAME&gt;:&lt;NEW-USERNAME-TO-BE-CREATED&gt; directory=EXP_DIR dumpfile=db1.dmp logfile=db1.log</span></pre><p id="35dd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就我而言，</p><pre class="jy jz ka kb fd kc jx kd ke aw kf bi"><span id="b3b0" class="kg kh hi jx b fi ki kj l kk kl">impdp system/password@ORCL schemas=AMDB  remap_schema=AMDB:AMDB_BKUP directory=EXP_DIR dumpfile=db1.dmp logfile=db1.log</span></pre><p id="245b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这也将触发一组新的过程，在此过程结束时，您的新数据库/用户将以您提供的名称AMDB_BKUP创建。</p><p id="c028" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就像这样，您可以使用Oracle内部提供的工具轻松备份和恢复您的数据库！</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/6432b3e78203e672c61345122daa5285.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*x7He5gf_48w2kb5j"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Sigmund</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="95c8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望这篇文章对你有用，我会列出一些我在写这篇文章时喜欢的资源。如果你想了解更多关于Java、API、微服务和数据库的内容，请关注我们！干杯。</p><div class="ko kp ez fb kq kr"><a href="https://www.linkedin.com/in/rashmin95/" rel="noopener  ugc nofollow" target="_blank"><div class="ks ab dw"><div class="kt ab ku cl cj kv"><h2 class="bd hj fi z dy kw ea eb kx ed ef hh bi translated">Ravindu Rashmin -软件工程师- WSO2 | LinkedIn</h2><div class="ky l"><h3 class="bd b fi z dy kw ea eb kx ed ef dx translated">在世界上最大的职业社区LinkedIn上查看Ravindu Rashmin的个人资料。Ravindu列出了7个工作…</h3></div><div class="kz l"><p class="bd b fp z dy kw ea eb kx ed ef dx translated">www.linkedin.com</p></div></div><div class="la l"><div class="lb l lc ld le la lf io kr"/></div></div></a></div><p id="8d88" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">资源—</p><div class="ko kp ez fb kq kr"><a href="https://docs.oracle.com/cd/B19306_01/server.102/b14200/statements_5007.htm" rel="noopener  ugc nofollow" target="_blank"><div class="ks ab dw"><div class="kt ab ku cl cj kv"><h2 class="bd hj fi z dy kw ea eb kx ed ef hh bi translated">创建目录</h2><div class="ky l"><h3 class="bd b fi z dy kw ea eb kx ed ef dx translated">目的使用CREATE DIRECTORY语句创建目录对象。目录对象为…指定别名</h3></div><div class="kz l"><p class="bd b fp z dy kw ea eb kx ed ef dx translated">docs.oracle.com</p></div></div></div></a></div><div class="ko kp ez fb kq kr"><a href="https://oracle-base.com/articles/10g/oracle-data-pump-10g" rel="noopener  ugc nofollow" target="_blank"><div class="ks ab dw"><div class="kt ab ku cl cj kv"><h2 class="bd hj fi z dy kw ea eb kx ed ef hh bi translated">Oracle数据库10g、11g、12c、18c、19c、21c中的Oracle数据泵(expdp、impdp)</h2><div class="ky l"><h3 class="bd b fi z dy kw ea eb kx ed ef dx translated">Oracle数据泵是一种更新、更快、更灵活的替代工具，可以替代以前使用的“exp”和“imp”工具</h3></div><div class="kz l"><p class="bd b fp z dy kw ea eb kx ed ef dx translated">oracle-base.com</p></div></div><div class="la l"><div class="lg l lc ld le la lf io kr"/></div></div></a></div><div class="ko kp ez fb kq kr"><a href="https://docs.oracle.com/en/database/oracle/oracle-database/19/sutil/oracle-data-pump-export-utility.html" rel="noopener  ugc nofollow" target="_blank"><div class="ks ab dw"><div class="kt ab ku cl cj kv"><h2 class="bd hj fi z dy kw ea eb kx ed ef hh bi translated">公用事业</h2><div class="ky l"><h3 class="bd b fi z dy kw ea eb kx ed ef dx translated">注意:有几个系统方案无法导出，因为它们不是用户方案。它们包含Oracle管理的数据…</h3></div><div class="kz l"><p class="bd b fp z dy kw ea eb kx ed ef dx translated">docs.oracle.com</p></div></div><div class="la l"><div class="lh l lc ld le la lf io kr"/></div></div></a></div></div></div>    
</body>
</html>