<html>
<head>
<title>Reversing ELF | TryHackMe Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">逆转ELF | TryHackMe报道</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/reversing-elf-tryhackme-writeup-3d528bcf7fce?source=collection_archive---------3-----------------------#2021-08-04">https://medium.com/geekculture/reversing-elf-tryhackme-writeup-3d528bcf7fce?source=collection_archive---------3-----------------------#2021-08-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="78bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">链接到房间:<a class="ae jd" href="https://tryhackme.com/room/reverselfiles" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/reverselfiles</a></p><p id="f158" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个房间允许你测试你的反向工程精灵二进制的技能，总共给你8个有趣的挑战来解决。设置相当简单，因为你只需要一台Linux机器，一些你选择的逆向工程工具和基本的RE知识。您还需要下载并授予每个二进制文件执行权限。我从解决这些问题中获得了很多乐趣，我希望你也一样，:D</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/92aaa380145a7aa594eec8b74806bb33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VvwLHs5gxSpplTvoHKFSUA.png"/></div></div></figure></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h1 id="98a1" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">破解1: </strong></h1><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/3c5938f00608f6239979d4c8101880de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pn5kHpRQBAFknOITPAXT9g.png"/></div></div></figure><p id="1e42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个二进制非常简单，不需要任何努力，因为它只是测试你的计算机技能。不带任何参数地执行这个二进制文件，你将得到你的第一个标志。</p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h1 id="41bb" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">破解2 </strong></h1><div class="jf jg jh ji fd ab cb"><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/89c3638f435a56611ad96bcd1a107a7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*CD1RyqMwSEjlDGGEK4_crA.png"/></div></figure><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/6ce98d8304a7d6063e3cb8dc3dc34e65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*G4q4qscDLMPJzzKANYI3rw.png"/></div></figure></div><p id="c349" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第二项任务是挑战的开始。为了解决这个问题，我使用了Radare 2，因为这是我通常用来处理简单二进制文件的工具。这里我用r2 <name_of_file>打开了文件。然后我用aaa分析二进制文件，用afl列出所有函数，最后用pdf @main打开主函数。</name_of_file></p><div class="jf jg jh ji fd ab cb"><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/a9fd4d226d840abad3760022a074b7da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*mOQsUjgJrC-DNQ2d-vPYPQ.png"/></div></figure><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/37ed114147ba5b49a45febcba78f4f0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*69UPycmihzogcnzjBDIxeA.png"/></div></figure></div><p id="d4e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在打开主函数时，我们可以非常清楚地看到用作秘密密码的字符串。然后我们可以把这个字符串作为第一个参数传递给二进制文件，我们得到了我们的标志。</p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h1 id="f61d" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">破解3 </strong></h1><div class="jf jg jh ji fd ab cb"><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/320f2981be3fdaea21dd06f9db92727c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*8xxXI5QASB5iytya7jlENg.png"/></div></figure><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/5ca4f2807d5862d273d1b0e1d47f927c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*-fSHXoQbs-U8MBuUnA9wTg.png"/></div></figure></div><p id="8650" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第三个挑战是当事情变得越来越复杂时，我切换到Ghidra，因为它的导航更好，它提供了一个反编译视图，因为我正在努力提高我的Ghidra技能。在这里，我们看到一个字符串比较正在与一个长字符串进行比较，这个长字符串看起来是经过编码的，这使我猜测是Base64，幸运的是，解码结果是正确的。</p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h1 id="ea96" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">破解4 </strong></h1><div class="jf jg jh ji fd ab cb"><figure class="kv jj lb kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/03af0ea214fef30a1309b06588483565.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*3cNgAWHcs-_HhDZ-vtHXjw.png"/></div></figure><figure class="kv jj lb kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/a84425a415c33811a7af178842d98b67.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Pp2ha1ZF_OK2TX3g5_ZlAg.png"/></div></figure><figure class="kv jj lb kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/825c8209b4b945411405e7878f6effa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*9TYsLagwfGP_2TnJj1SILA.png"/></div></figure></div><p id="b7d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个二进制文件也使用了字符串比较，但是反序列化并没有多大用处，因为它似乎是用一个不能揭示太多信息的函数来计算标志。一个更简单的方法是用gdb启动并运行程序，这样我们就可以在执行字符串比较之前检查寄存器。我们用gdb打开二进制，列出所有函数，找到字符串比较的地址然后设置一个断点，在函数被调用时停止程序。</p><div class="jf jg jh ji fd ab cb"><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/56809993f3cb8c46374860add78c92fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*GT0wr4h9y6glDWpYc2DbCA.png"/></div></figure><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/b50bae6e4d09a5186cf4d62d11465f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*qT39Yg-WwUbzG8zgpJttIw.png"/></div></figure></div><p id="046f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查寄存器会发现有一些值被保存，因此我们首先检查rax，因为它是最重要的寄存器之一。通过检查存储在该内存位置的十六进制值，并将其转换为一个字符串，我们得到了该标志。</p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h1 id="9f21" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">破解5 </strong></h1><div class="jf jg jh ji fd ab cb"><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/419881b6ac6639997dccc561d187c74c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*v5FKbtRszJsrnT_FF2tkeg.png"/></div></figure><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/3407e770ee4dac641986d460270ed45a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*AQhoL_BOSdLUReQ_f7S6hQ.png"/></div></figure></div><p id="117c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然可以对二进制文件进行静态分析，Crackme5就把我们带回了Ghidra。我们开始探索main函数，但是这让我们开始了一段回溯实际密码存储位置的旅程。首先，我们输入compare_pwd，然后它似乎使用my_secure_test返回true或false，这将进一步推进程序，向我们显示这是主要检查最有可能发生的地方。</p><div class="jf jg jh ji fd ab cb"><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/3de07057a2bf0b5088df352986b483b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*N3Lj3gN4lUFoV0AkA8QYMw.png"/></div></figure><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/818d66478d482a2dc16dee1076ff6884.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*RNdH1t7jbCiVisTHCCWnPQ.png"/></div></figure></div><p id="92f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看来我们是正确的，因为这个函数包含许多条件语句，这些语句检查我们提供给程序的第一个参数中的一组字母，以及每个字母下的十六进制值，该值等于true，然后用于返回密码检查的状态。然后，我们可以将所有的值拼接在一起，以获得标志。</p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h1 id="f547" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">破解7 </strong></h1><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/3dc32ab577752e13a99c65c4ef50f7d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e9EBeqsmVoGCDmBYCkLUkg.png"/></div></div></figure><p id="45cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个二进制文件比其他的更复杂，这导致我首先通过运行二进制文件来检查每个输入，但是这并没有揭示任何东西。</p><div class="jf jg jh ji fd ab cb"><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/ce4e48faa68d7cc56ee61eae65a1dc90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*iCXpu0NhEt1ORTocE45xHw.png"/></div></figure><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/74cd21f97a144f643b33f641cdb2f607.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*KpuNby_2r9V8usz7CCrh3Q.png"/></div></figure></div><p id="954b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我浏览反编译视图时，我注意到一个模式，它向我揭示了二进制文件可以采用的所有不同路径，其中一个非常突出，因为它包含了一个有趣的信息。为了达到这一点，我们需要提供一个特殊的值，我们可以通过右键单击它并查看它的所有不同表示，Ghidra很好地呈现了它。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/9985b84f8cecc1ad9f74f70c72e1eb7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CpYc67jXiRFpXFYBpDvSgA.png"/></div></div></figure><p id="4b51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我可以看到，它似乎不是一个字符串，所以我把它作为一个十进制数传递，因为这是最有意义的，我得到了标志。</p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h1 id="7013" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak"> Crackme8 </strong></h1><div class="jf jg jh ji fd ab cb"><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/e0bd56a7811b47ce867c99b30d3f4dac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*PY4wrWIMiTzfwp1eRgkZPQ.png"/></div></figure><figure class="kv jj kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/b5fd110e32e62b6bfa7d8edc593af4c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*TgEQGUmTRM9pJv8nEJovgg.png"/></div></figure></div><p id="6a2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我仔细查看反编译后的代码时，最终的二进制文件比我想象的要简单。一旦int值等于硬编码值，程序就被解锁。上面的atoi函数转换我们的程序参数字符串，并把它变成一个int值，这使我在前面的任务中做了同样的事情。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/0b006413c7000736790cf7c11ae10837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Y8Wp7PDRiYCImx_Wy3frg.png"/></div></div></figure><p id="dd40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将该值作为程序的第一个参数传入，并获得最终的标志:D</p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><p id="3091" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个房间完成起来很有趣，因为二进制文件探索起来很有趣，而且它们既不太容易也不太难。我开始练习我的调试和Ghidra技能，同时学习更多关于ELF二进制文件内部的知识。</p></div></div>    
</body>
</html>