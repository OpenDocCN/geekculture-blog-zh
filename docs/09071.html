<html>
<head>
<title>Football Prediction Performance: How to Calculate Hit-ratio and Log-loss</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">足球预测性能:如何计算命中率和对数损失</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/football-prediction-performance-how-to-calculate-hit-ratio-and-log-loss-1e5e22310497?source=collection_archive---------3-----------------------#2021-11-25">https://medium.com/geekculture/football-prediction-performance-how-to-calculate-hit-ratio-and-log-loss-1e5e22310497?source=collection_archive---------3-----------------------#2021-11-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="bbe2" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">机器学习变得简单</h2><div class=""/><div class=""><h2 id="60b3" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">你永远不会做错</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/29f59011b966b27bffeff5039a6dda97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9vw79L_JOCmIYrGbteDhug.jpeg"/></div></div></figure><p id="6b89" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">无论您是在做研究、打赌，还是只是比较预测，衡量模型的性能都是必不可少的一步。这篇短文展示了如何使用<a class="ae ko" href="https://github.com/octosport/octopy/blob/master/notebooks/Football_Prediction_Performance.ipynb" rel="noopener ugc nofollow" target="_blank">代码</a>和示例计算1x2足球预测的命中率和对数损失。这两个损失通常用于足球分析和全球机器学习。本文所用数据由<a class="ae ko" href="https://www.sportmonks.com/" rel="noopener ugc nofollow" target="_blank"> Sportmonks </a>提供。</p><h1 id="abae" class="kp kq hi bd kr ks kt ku kv kw kx ky kz ix la iy lb ja lc jb ld jd le je lf lg bi translated">预测足球是一个概率分类问题</h1><p id="0ad0" class="pw-post-body-paragraph js jt hi ju b jv lh is jx jy li iv ka kb lj kd ke kf lk kh ki kj ll kl km kn hb bi translated">在衡量一个模型的性能之前，我们需要了解我们正在处理什么问题。我们希望预测A队和B队之间的足球比赛结果。结果和预测可以采用三个不同的值，称为<em class="lm">类</em>:<strong class="ju hs">A队赢</strong>，<strong class="ju hs">B队赢</strong>，<strong class="ju hs">平局</strong>。因为我们只有三个类别，所以这个问题是一个分类任务。但是，我们也对每个结果的概率感兴趣。这些概率给出了你对结果确信程度的信息。原来我们现在有一个<strong class="ju hs">概率分类问题。</strong></p><blockquote class="ln lo lp"><p id="f71d" class="js jt lm ju b jv jw is jx jy jz iv ka lq kc kd ke lr kg kh ki ls kk kl km kn hb bi translated">我们只有三种结果，每场比赛都有同样多的概率。我们知道，这三种概率之和总是等于1。因此，与最大概率相关联的预测类别将总是具有等于1/3的大概率。</p></blockquote><p id="a3de" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">在1x2预测情况下，A队和B队之间比赛的预测结果有两个关联的答案:</p><ul class=""><li id="0564" class="lt lu hi ju b jv jw jy jz kb lv kf lw kj lx kn ly lz ma mb bi translated"><strong class="ju hs">概率预测</strong>:这是由数学模型、博彩公司、投票等完成的任务。</li><li id="cc62" class="lt lu hi ju b jv mc jy md kb me kf mf kj mg kn ly lz ma mb bi translated"><strong class="ju hs">类别预测</strong>:这是与最大概率相关的结果。</li></ul><p id="edf0" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">例如，如果A队有30%的获胜概率，B队有45%的获胜概率，平局是25%，那么预测的级别(结果)是<strong class="ju hs">B队赢</strong>。注意，我们有30%+45%+25%=100%。</p><p id="02e3" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">由于我们对预测问题有两个稍微不同的答案，所以我们有两个不同的性能度量。log-loss衡量预测概率的质量，命中率衡量预测类的正确性。</p><h1 id="799d" class="kp kq hi bd kr ks kt ku kv kw kx ky kz ix la iy lb ja lc jb ld jd le je lf lg bi translated">对数损失和命中率</h1><p id="2943" class="pw-post-body-paragraph js jt hi ju b jv lh is jx jy li iv ka kb lj kd ke kf lk kh ki kj ll kl km kn hb bi translated"><strong class="ju hs">命中率</strong>(或准确度)可能是评估分类模型最常用和最容易理解的度量。很容易理解你10%的预测是正确的。在我们的例子中，我们想要测量一个三类模型的命中率。</p><p id="f596" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">假设我们有200个与他们的结果和预测类相匹配的结果。我们需要做的就是将预测的类与实际结果进行比较。如果相同，则计为1，如果不相同，则计为0。我们对200个匹配进行这样的操作，取平均值，并获得命中率。数学上我们可以写:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es mh"><img src="../Images/6537caed86e3823d8c141df280371dab.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/0*hE0e797kkdfelXaD"/></div><figcaption class="mi mj et er es mk ml bd b be z dx">the hit-ratio formula for 200 matches</figcaption></figure><p id="359b" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">我们希望命中率尽可能高，并且总是在0到1之间。</p><p id="da35" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">另一方面，<strong class="ju hs"/><strong class="ju hs"/>的对数损耗要复杂一点。这个损失给你一个概率质量的度量。思考这个问题的一种方法是分别考虑每种结果。</p><p id="47e1" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">例如，以团队A获胜预测为例。如果实际结果是A队获胜，那么任何A队获胜概率超过34%的模型都将做出正确的预测。但是，一个概率为95%的模型应该被视为比预测概率为55%的模型更好的模型。即使两者都有正确的结果。</p><p id="463f" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">正如你所看到的，我们所需要的是测量<strong class="ju hs">当正确的结果为真</strong>(分别为假)时，概率距离1 (分别为0) <strong class="ju hs">有多远。事实上，如果A队赢了，已知的<em class="lm">概率</em>是<strong class="ju hs"> 1 </strong>，我们想知道我们的预测与此有多远。“有多远”可以用不同的方法来计算，但我们将把重点放在对数损失上。在我们的团队中，成功的例子很简单:</strong></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es mm"><img src="../Images/1a9028179bef64f4329dfa3bb55d03e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:336/0*0Ez2Zhhmn9dbtftK"/></div><figcaption class="mi mj et er es mk ml bd b be z dx">the log-loss of A win</figcaption></figure><p id="7dc8" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">如果A队输了比赛，它就是0，但是如果A队赢了，它就变得有趣了。在这种情况下，10%概率的损失值为-2.30，50%概率的损失值为-0.69，90%概率的损失值为-0.01。如果概率是100%，损失是0。事实上，<strong class="ju hs">我们希望对数损耗尽可能接近零。</strong>对数损失始终在0和负无穷大之间。概率越接近实际结果，对数损失越好。</p><blockquote class="ln lo lp"><p id="7f1b" class="js jt lm ju b jv jw is jx jy jz iv ka lq kc kd ke lr kg kh ki ls kk kl km kn hb bi translated">在这个例子中，我们知道A队赢了比赛。在这种情况下，另外两个结果的对数损失为0。所以对于每场比赛来说，只有与正确结果相关的概率才是输球的关键。</p></blockquote><p id="d374" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">如果我们再取200个匹配，则总对数损失为:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es mn"><img src="../Images/a9245d5746c5b6d32254144ccd9bd675.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/0*9S_fAa4z9-HsFvmc"/></div><figcaption class="mi mj et er es mk ml bd b be z dx">the log-loss formula for 200 matches</figcaption></figure><p id="8a9a" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">估计了命中率和对数损失。匹配的数量越多，这个估计就越准确。对于对数损失来说尤其如此，错误的概率会对对数损失平均值产生很大的负面影响。</p><h1 id="d18f" class="kp kq hi bd kr ks kt ku kv kw kx ky kz ix la iy lb ja lc jb ld jd le je lf lg bi translated">具体的例子</h1><p id="bd97" class="pw-post-body-paragraph js jt hi ju b jv lh is jx jy li iv ka kb lj kd ke kf lk kh ki kj ll kl km kn hb bi translated">我们用数据算一个例子。计算这两个指标的python代码可以在<a class="ae ko" href="https://github.com/octosport/octopy" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。这些功能非常简单，使用相同的输入。第一个参数是<code class="du mo mp mq mr b">probabilities</code>，一个<a class="ae ko" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank"> pandas </a> dataframe，其中的列包含“1”、“2”和“X”结果的概率，每一行都是匹配的。第二个参数是包含真实结果的熊猫系列。检查输入以确保将返回正确的值。这两个功能是:</p><pre class="jh ji jj jk fd ms mr mt mu aw mv bi"><span id="af0a" class="mw kq hi mr b fi mx my l mz na">def compute_1x2_log_loss(probabilities, true_results):<br/>    <em class="lm">'''<br/>    Compute the log-loss for 1x2 football results.<br/><br/>    '''<br/><br/></em>def compute_1x2_hit_ratio(probabilities, true_results):<br/>    <em class="lm">'''<br/>    Compute the hit-ratio for 1x2 football results.<br/></em>    <em class="lm">'''</em></span></pre><p id="6e90" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">例如，<code class="du mo mp mq mr b">probabilities</code>数据帧如下:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es nb"><img src="../Images/d1c15ea4a3d2ce8639af8598d60e3172.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GCaKVNk5V29T2AuU4U9rBA.png"/></div></div><figcaption class="mi mj et er es mk ml bd b be z dx">The probabilities pandas dataframe</figcaption></figure><p id="9a1b" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">而<code class="du mo mp mq mr b">true_results</code>将会是:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es nc"><img src="../Images/fa566d8d11b55e236150d7191b285138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XdmZeXn0Dq3A1l6gNMxzQg.png"/></div></div><figcaption class="mi mj et er es mk ml bd b be z dx">The true result pandas series</figcaption></figure><p id="b3eb" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">那么损耗可以很容易地计算如下:</p><pre class="jh ji jj jk fd ms mr mt mu aw mv bi"><span id="d0a2" class="mw kq hi mr b fi mx my l mz na">log_loss = compute_1x2_log_loss(probabilities,true_result)</span><span id="f31d" class="mw kq hi mr b fi nd my l mz na">hit_ratio = compute_1x2_hit_ratio(probabilities,true_result)</span></pre><p id="d0d5" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">一个完整的例子可以在笔记本<a class="ae ko" href="https://github.com/octosport/octopy/blob/master/notebooks/Football_Prediction_Performance.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="29b7" class="kp kq hi bd kr ks kt ku kv kw kx ky kz ix la iy lb ja lc jb ld jd le je lf lg bi translated">结论</h1><p id="0903" class="pw-post-body-paragraph js jt hi ju b jv lh is jx jy li iv ka kb lj kd ke kf lk kh ki kj ll kl km kn hb bi translated">本文展示了如何计算1x2概率模型的对数损失和命中率。我们还提供了代码，以便于理解和自己进行计算。所提出的函数可以扩展到其他类型的预测，如两队得分或比赛过多或过少。</p></div></div>    
</body>
</html>