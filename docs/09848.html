<html>
<head>
<title>Using AWS SDK in PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在PHP中使用AWS SDK</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/using-aws-sdk-in-php-dcbd5513b6dc?source=collection_archive---------5-----------------------#2022-01-01">https://medium.com/geekculture/using-aws-sdk-in-php-dcbd5513b6dc?source=collection_archive---------5-----------------------#2022-01-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="cfc5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于使用凭据的概述指南</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/d2cbbd82158cea576c961aedd0ddf346.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pRsgefzbenyAWrwd"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@sunriseking?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Sunrise King</a> on <a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9003" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">AWS提供了一个SDK来调用它的各种服务，并且它需要凭证来触发这些方法。有几种方法可以做到这一点，但这里我只记录我做了什么。</p><h1 id="4b6b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">步骤0a:检查区域</h1><p id="18c4" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">根据我们将使用的方法，如果区域设置不正确，SDK调用可能会失败。检查资源在哪里，并记下相应的区域代码。</p><h1 id="b292" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">步骤0b:创建访问密钥</h1><p id="c0fa" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">凭据需要访问密钥才能工作。我们可以通过转到<strong class="ih hj"> IAM &gt;用户&gt;安全凭证</strong>来创建一个。</p><p id="08c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，这个秘密只显示一次。如果它丢失或遗忘，我们将需要创建一个新的密钥。如果已经有两个现有的键，我们需要先删除其中一个。</p><h1 id="85ba" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated"><strong class="ak">第一步:获取SDK </strong></h1><p id="f87e" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">有几种方法可以获得SDK，如AWS <a class="ae jt" href="https://docs.aws.amazon.com/sdk-for-php/v3/developer-guide/getting-started_installation.html" rel="noopener ugc nofollow" target="_blank">这里</a>所提供的。我用的是. phar文件。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="89ef" class="lc jv hi ky b fi ld le l lf lg">&lt;?php<br/>   require '/path/to/aws.phar';<br/>?&gt;</span></pre><h1 id="4a2b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">步骤2a:创建凭据—外部文件</h1><p id="9e25" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">我在这个特定的场景中使用Docker，所以我没有设置要求我将凭证文件放在根目录下的操作系统环境。</p><p id="e303" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，“更好”的方法仍然是将凭证放在另一个地方，而不是与主项目的其余部分编码在一起。在我参与的一个项目中，有人不小心将凭证上传到了代码库中。它将永远留在那里。对他们来说幸运的是，这是一个相对而言的私有仓库。</p><p id="fa45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是AWS给出的文件外观示例(摘自<a class="ae jt" href="https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/loading-node-credentials-shared.html" rel="noopener ugc nofollow" target="_blank">这里是</a>):</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="191e" class="lc jv hi ky b fi ld le l lf lg">[default]<br/>aws_access_key_id = &lt;YOUR_ACCESS_KEY_ID&gt;<br/>aws_secret_access_key = &lt;YOUR_SECRET_ACCESS_KEY&gt;</span></pre><p id="ef2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想补充两点:</p><ol class=""><li id="81cc" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">密钥名必须分别为<strong class="ih hj"> aws_access_key_id </strong>和<strong class="ih hj"> aws_secret_access_key </strong>。在我找到这个页面之前，我最初只是输入了access_key和access_secret，当然，事情失败了。</li><li id="29e4" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">您的字符串必须在<strong class="ih hj">双撇号</strong>中，而不是单引号中。我是在PHP环境中，所以我根本没有注意到它的影响。(参见<a class="ae jt" href="https://en.wikipedia.org/wiki/INI_file" rel="noopener ugc nofollow" target="_blank">维基百科</a>中INI文件的示例)</li></ol><p id="841d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">换句话说，您的凭证文件应该如下所示:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="37dc" class="lc jv hi ky b fi ld le l lf lg">[default]<br/>aws_access_key_id = "key_value"<br/>aws_secret_access_key = "secret_value"</span></pre><p id="137f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们可以创建<strong class="ih hj"> CredentialProvider </strong>对象。我在这里使用的是<strong class="ih hj"> ApiGatewayClient </strong>，但它也可以是SDK中的任何其他方法，例如SESClient:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="1526" class="lc jv hi ky b fi ld le l lf lg">use Aws\Credentials\CredentialProvider;<br/>use Aws\ApiGateway\ApiGatewayClient;</span><span id="52e2" class="lc jv hi ky b fi lw le l lf lg">$profile = 'default'; // this matches the [default] in the cred file<br/>$path = 'path_to_cred';<br/>$region = 'region_code'; //change this to our region</span><span id="aa25" class="lc jv hi ky b fi lw le l lf lg">$provider = CredentialProvider::ini($profile, $path);<br/>$provider = CredentialProvider::memoize($provider);</span><span id="d76c" class="lc jv hi ky b fi lw le l lf lg">$apiGatewayClient = new ApiGatewayClient([<br/>    'region' =&gt; $region, <br/>    'version' =&gt; 'latest',<br/>    'credentials' =&gt; $provider<br/>]);</span></pre><h1 id="d353" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">步骤2b:创建凭证—硬编码</h1><p id="6494" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">只是为了比较，我也将描述硬编码的方法。这既不需要外部凭证文件，也不需要<strong class="ih hj"> CredentialProvider </strong>对象:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="7846" class="lc jv hi ky b fi ld le l lf lg">use Aws\ApiGateway\ApiGatewayClient;<br/>$region = 'region_code'; //change this to our region</span><span id="5e4d" class="lc jv hi ky b fi lw le l lf lg">$key = 'key_value';<br/>$secret = 'secret_value';</span><span id="520d" class="lc jv hi ky b fi lw le l lf lg">$apiGatewayClient = new ApiGatewayClient([<br/>    'region' =&gt; $region, <br/>    'version' =&gt; 'latest',<br/>    <!-- -->'credentials' =&gt; [<br/>        'key' =&gt; $key,<br/>        'secret' =&gt; $secret,<br/>    ]<br/>]);</span></pre><p id="2267" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，对于实际的“实时”项目，不推荐使用这种方法。</p><h1 id="8995" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">步骤3:测试API调用</h1><p id="6f68" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">最后是检验的时候了。SDK的官方AWS文档是这里的<a class="ae jt" href="https://docs.aws.amazon.com/aws-sdk-php/v3/api/api-apigateway-2015-07-09.html" rel="noopener ugc nofollow" target="_blank"/>。我为APIGateway选择了(我认为是)最简单的方法:<strong class="ih hj"> getRestApis </strong>。它应该只列出我在该地区的所有API，下面是描述:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="3c18" class="lc jv hi ky b fi ld le l lf lg">$result = $client-&gt;getRestApis([<br/>    'limit' =&gt; &lt;integer&gt;,<br/>    'position' =&gt; '&lt;string&gt;',<br/>]);</span></pre><p id="51ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参数<strong class="ih hj">极限</strong>很容易理解，但是<strong class="ih hj">位置</strong>有点神秘。我试图将它保留为空字符串' '(毕竟它说预期类型是&lt;字符串&gt;)，但这不起作用。经过一番搜索，我发现我可以简单地使用一个空值:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="316d" class="lc jv hi ky b fi ld le l lf lg">$result = $apiGatewayClient-&gt;getRestApis([<br/>    'limit' =&gt; 10,<br/>    'position' =&gt; null,<br/>]);</span></pre><p id="fb98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧啊。如果我们执行$result的var_dump，我们应该会看到列表的打印输出。</p></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><p id="aa20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您读到这里，如果我有任何错误或者可以进一步简化，请告诉我。如果你感兴趣，也请查看我的其他文章或在Twitter上关注我。再次感谢！</p></div></div>    
</body>
</html>