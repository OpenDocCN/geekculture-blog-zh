<html>
<head>
<title>Reverse engineering the medium app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对中型应用程序进行逆向工程</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/reverse-engineering-the-medium-app-6c4009bbf28a?source=collection_archive---------13-----------------------#2022-07-05">https://medium.com/geekculture/reverse-engineering-the-medium-app-6c4009bbf28a?source=collection_archive---------13-----------------------#2022-07-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="03fa" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">逆向工程</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/474fa1f7c407c33bb639ecc4af682179.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fLu6U9VEYtrV4LKDmtZhcg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">photo by <a class="ae jn" href="https://thesaurus.plus/img/antonyms/639/dismantle.png" rel="noopener ugc nofollow" target="_blank">thesaurus.plus</a></figcaption></figure><p id="ebbe" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi kk translated">逆向工程，分解产品以确定其功能。</p><p id="8278" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在我进一步说之前，让我解释一下我是如何走到这一步的。在一位安全分析师最近表示，我开发的一个应用程序很容易被逆向工程以读取/写入代码并窃取重要信息之后，逆向工程引起了我的注意。</p><p id="ec83" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我像往常一样向我的搜索引擎查询同样的事情，她提供了高层次的理由。我开始搜索这一切是因为，作为一个普通人，我没有一下子得到它。</p><p id="5b29" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最终能够对软件进行逆向工程来读取代码。</p><p id="0405" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">嗯！！我猜你想知道“写”部分发生了什么。</p><p id="c0a2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我会说到这一点，但你熟悉这一部分吗？当您使用或创建软件时，有多少代码必须被压缩并翻译成另一种语言才能运行？</p><p id="90b1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">由系统构建、运行或编译的程序确实要经过编译步骤。</p><h1 id="4790" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">编译程序</h1><p id="6719" class="pw-post-body-paragraph jo jp hi jq b jr ll ij jt ju lm im jw jx ln jz ka kb lo kd ke kf lp kh ki kj hb bi translated">对人类可读代码如何进入我们的CPU理解的字节序列的高级概述。</p><ul class=""><li id="d6a2" class="lq lr hi jq b jr js ju jv jx ls kb lt kf lu kj lv lw lx ly bi translated"><strong class="jq hj">预处理阶段:</strong>遍历源代码，执行注释移除、宏展开、条件移除、包含展开。</li><li id="cfcb" class="lq lr hi jq b jr lz ju ma jx mb kb mc kf md kj lv lw lx ly bi translated"><strong class="jq hj">编译阶段:</strong>将任意语言(python、java、kotlin、HTML、dart、C)编写的源代码转换成汇编语言。</li><li id="a04d" class="lq lr hi jq b jr lz ju ma jx mb kb mc kf md kj lv lw lx ly bi translated"><strong class="jq hj">汇编阶段:</strong>汇编器将汇编代码转换成二进制操作码/目标代码。</li><li id="a265" class="lq lr hi jq b jr lz ju ma jx mb kb mc kf md kj lv lw lx ly bi translated"><strong class="jq hj">链接阶段:</strong>入口点，在这里所有的目标代码得到一个内存来解决。</li></ul><p id="943b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">互联网上有足够多的工具可以帮助对软件进行逆向工程，如Ghidra、x64dbg、OllyDbg、apktool、jadx等</p><p id="0bfb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">理论到此为止。让我们看看我是如何破解Medium应用程序的。</p><h1 id="2003" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">中型APK</h1><p id="e26a" class="pw-post-body-paragraph jo jp hi jq b jr ll ij jt ju lm im jw jx ln jz ka kb lo kd ke kf lp kh ki kj hb bi translated">为了反编译源代码，我使用了一些工具，比如<a class="ae jn" href="https://ibotpeaches.github.io/Apktool/" rel="noopener ugc nofollow" target="_blank"> apktool </a>(生成<strong class="jq hj"/><a class="ae jn" href="https://github.com/JesusFreke/smali/wiki/Registers" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj">Smali</strong></a><strong class="jq hj">文件</strong>)，<a class="ae jn" href="https://github.com/skylot/jadx" rel="noopener ugc nofollow" target="_blank"> Jadx </a>(试图为那些美味的Java文件付出额外的努力)。然后，我可以通过将应用程序反编译成Dalvik字节码，然后将其翻译成粗略估计的Java代码来检查功能。</p><p id="c723" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对介质apk进行反向工程时，会创建一个文件夹，其中包含与其相关的所有文件，如下图所示。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es me"><img src="../Images/98ced914784bd9f5af5914b183d80a92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cmnRObSIshS3M7OMJoe2QQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">image by author</figcaption></figure><p id="6047" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">smali类中的代码类似于下图</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mf"><img src="../Images/41094a6bddc980eb42ba1069aaf822b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PID6SmbSewBT57QKk8Q4Kw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">smali code — image by author</figcaption></figure><p id="c7b3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae jn" href="https://github.com/JesusFreke/smali/wiki/Registers" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">斯马利</strong></a><strong class="jq hj">——</strong>由于二进制代码很难解释或编辑，因此有一些工具可以用来与人类可读的表示形式进行相互转换。Smali是最典型的人类可读格式。</p><p id="7d00" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下图显示了Smali在JAVA中的表现。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mg"><img src="../Images/381aa28e93b74539d177c42930091326.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*HYJJJu7a8cjOZTtkN-hrzg.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">smali to java</figcaption></figure><h1 id="3649" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">免费制作所有故事</h1><p id="1539" class="pw-post-body-paragraph jo jp hi jq b jr ll ij jt ju lm im jw jx ln jz ka kb lo kd ke kf lp kh ki kj hb bi translated">我有媒体的所有源代码，所以试图让所有的故事免费，因为媒体每月只免费提供3个故事来阅读会员要求的故事。</p><p id="bdf6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在应用程序的源代码中游了一夜之后，我弄清楚了从启动屏幕到故事预览流程的功能。</p><pre class="iy iz ja jb fd mh mi mj mk aw ml bi"><span id="e188" class="mm ku hi mi b fi mn mo l mp mq">The main root for membership verification was within this path</span><span id="ebb4" class="mm ku hi mi b fi mr mo l mp mq"><strong class="mi hj"><em class="ms">medium\smali_classes3\com\medium\android\common\metrics</em></strong></span><span id="caca" class="mm ku hi mi b fi mr mo l mp mq">And there where i made the changes to the code</span></pre><div class="iy iz ja jb fd ab cb"><figure class="mt jc mu mv mw mx my paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><img src="../Images/ecef7981a8eb3077eb20ae5189b9e197.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*81kAI2UXzJkgO_TWZFQnGg.png"/></div></figure><figure class="mt jc mz mv mw mx my paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><img src="../Images/dd8512e0079d3b52d38414a4b83fc9e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*4rWFx8XQPRKEsEoFq2pyEw.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx na di nb nc">left image edited java code, right image edited smali code</figcaption></figure></div><p id="06fc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们无法完全获得Java应用程序的源代码。因此，我们必须在汇编级别进行任何必要的更改，以便能够重新编译我们的应用程序(我们有应用程序的完整汇编源代码)。</p><p id="7e3e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">修改汇编文件听起来可能很可怕，但也没那么糟糕。特别是如果我们在讨论Java字节码汇编(Java虚拟机和Dalvik虚拟机都有相对高级的指令集，这里不是LC-3或x86)。</p><p id="f2a4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在将这些行添加到应用程序代码之后，我们必须重新编译所有内容。我们将再次利用Apktool从Smali文件构建一个APK。我们现在有一个改变了的APK。</p><p id="4642" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">还没完，安卓设备不允许被篡改的apk安装，除非登录。</p><blockquote class="nd"><p id="4980" class="ne nf hi bd ng nh ni nj nk nl nm kj dx translated">尽管我尽了最大努力，但我观察到介质足够聪明，可以验证cookie来验证成员资格。在那里，我没有遇到</p></blockquote></div><div class="ab cl nn no gp np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="hb hc hd he hf"><p id="e032" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">当我学习逆向工程时，这个资源对我帮助很大。那就是YouTube系列的<strong class="jq hj"> HackadayU </strong>上的<strong class="jq hj"> </strong> <a class="ae jn" href="https://www.youtube.com/watch?v=d4Pgi5XML8E&amp;list=PLcSbrXYDkKywrtGtuo4OMV7QMHuiV6JHV&amp;index=1&amp;t=907s" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">与Ghidra </strong> </a>的逆向工程</p></div><div class="ab cl nn no gp np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="hb hc hd he hf"><h1 id="093a" class="kt ku hi bd kv kw nu ky kz la nv lc ld io nw ip lf ir nx is lh iu ny iv lj lk bi translated">参考</h1><ul class=""><li id="367d" class="lq lr hi jq b jr ll ju lm jx nz kb oa kf ob kj lv lw lx ly bi translated"><a class="ae jn" href="http://pallergabor.uw.hu/androidblog/dalvik_opcodes.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">达尔维克操作码</strong> </a></li><li id="328f" class="lq lr hi jq b jr lz ju ma jx mb kb mc kf md kj lv lw lx ly bi translated"><a class="ae jn" href="https://github.com/JesusFreke/smali" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">斯马利</strong> </a></li><li id="927c" class="lq lr hi jq b jr lz ju ma jx mb kb mc kf md kj lv lw lx ly bi translated"><a class="ae jn" href="https://cryptax.medium.com/reversing-an-android-sample-which-uses-flutter-23c3ff04b847" rel="noopener"> <strong class="jq hj">反转一个使用了Flutter </strong> </a>的Android样本</li><li id="4c04" class="lq lr hi jq b jr lz ju ma jx mb kb mc kf md kj lv lw lx ly bi translated"><a class="ae jn" href="https://cryptax.medium.com/live-reverse-engineering-of-a-trojanized-medical-app-android-joker-632d114073c1" rel="noopener"> <strong class="jq hj">某木马化医疗app的现场逆向工程——Android/Joker</strong></a></li><li id="39ff" class="lq lr hi jq b jr lz ju ma jx mb kb mc kf md kj lv lw lx ly bi translated"><a class="ae jn" rel="noopener" href="/@parfaitayassor/reverse-engineering-of-android-applications-6e25460a48c8"> <strong class="jq hj">安卓应用的逆向工程</strong> </a></li></ul></div><div class="ab cl nn no gp np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="hb hc hd he hf"><p id="8f92" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">请不要起诉媒体🙏🙏🙏<strong class="jq hj"> <br/> </strong>这一切都是出于教育目的。</p></div><div class="ab cl nn no gp np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="hb hc hd he hf"><p id="76e5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="ms">感谢您花时间阅读本文。如果你觉得这个帖子有用又有趣，请鼓掌推荐。</em></p><p id="e832" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果我做错了什么，请在评论中提出来。我很想进步。</p></div></div>    
</body>
</html>