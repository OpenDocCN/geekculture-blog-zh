<html>
<head>
<title>GraphQL with MongoDB and ExpressJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用MongoDB和ExpressJS的GraphQL</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/graphql-with-mongodb-and-expressjs-26e1b94ab886?source=collection_archive---------0-----------------------#2021-05-17">https://medium.com/geekculture/graphql-with-mongodb-and-expressjs-26e1b94ab886?source=collection_archive---------0-----------------------#2021-05-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d8805343d4e9a59a7691c690670104c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JAsysNrEa3PpM18l1CvL0w.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Pic Courtesy: <a class="ae iu" href="https://www.multidots.com/graphql-efficient-alternative-rest/" rel="noopener ugc nofollow" target="_blank">Multidots</a></figcaption></figure><p id="9810" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">GraphQL，即图形查询语言，是一种用于API的查询语言。它赋予您以下能力:</p><blockquote class="jt"><p id="6108" class="ju jv hi bd jw jx jy jz ka kb kc js dx translated">询问你需要什么数据，你会得到确切的数据<br/>——在单个请求中获得许多资源<br/>——添加新的字段并改进你的API而无需版本。</p><p id="0cad" class="ju jv hi bd jw jx jy jz ka kb kc js dx translated">参考资料:<a class="ae iu" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank"> GraphQL </a></p></blockquote><p id="7506" class="pw-post-body-paragraph iv iw hi ix b iy kd ja jb jc ke je jf jg kf ji jj jk kg jm jn jo kh jq jr js hb bi translated">您可以查看官方文档来了解更多关于GraphQL特性的信息。</p><p id="ac10" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们来谈谈实现。我们将使用MongoDB创建一个express-graphql服务器来保存数据。</p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="8d40" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们开始吧，</p><ul class=""><li id="5fb5" class="kp kq hi ix b iy iz jc jd jg kr jk ks jo kt js ku kv kw kx bi translated">通过运行以下命令创建package.json，</li></ul><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="caac" class="lh li hi ld b fi lj lk l ll lm">npm init</span></pre><ul class=""><li id="e418" class="kp kq hi ix b iy iz jc jd jg kr jk ks jo kt js ku kv kw kx bi translated">安装开发依赖项，</li></ul><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="441d" class="lh li hi ld b fi lj lk l ll lm">npm i --save-dev babel-cli babel-preset-env babel-preset-stage-0 @types/node</span></pre><ul class=""><li id="cd69" class="kp kq hi ix b iy iz jc jd jg kr jk ks jo kt js ku kv kw kx bi translated">安装项目依赖项，</li></ul><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="5f6f" class="lh li hi ld b fi lj lk l ll lm">npm i --save apollo-server-express express graphql mongodb mongoose nodemon</span></pre><blockquote class="ln lo lp"><p id="65d3" class="iv iw lq ix b iy iz ja jb jc jd je jf lr jh ji jj ls jl jm jn lt jp jq jr js hb bi translated"><strong class="ix hj"> apollo-server-express </strong>:这是GraphQL服务器的express和Connect集成。Apollo Server是一个社区维护的开源GraphQL服务器，可以与许多Node.js HTTP服务器框架一起工作。</p><p id="3e66" class="iv iw lq ix b iy iz ja jb jc jd je jf lr jh ji jj ls jl jm jn lt jp jq jr js hb bi translated"><strong class="ix hj"> express </strong> : NodeJS web应用框架。</p><p id="e117" class="iv iw lq ix b iy iz ja jb jc jd je jf lr jh ji jj ls jl jm jn lt jp jq jr js hb bi translated"><strong class="ix hj">graph QL</strong>:graph QL的JavaScript参考实现。</p><p id="26a4" class="iv iw lq ix b iy iz ja jb jc jd je jf lr jh ji jj ls jl jm jn lt jp jq jr js hb bi translated"><strong class="ix hj">mongodb</strong>:node . js的官方MongoDB驱动。</p><p id="5b0a" class="iv iw lq ix b iy iz ja jb jc jd je jf lr jh ji jj ls jl jm jn lt jp jq jr js hb bi translated"><strong class="ix hj">mongose</strong>:mongose是一个MongoDB对象建模工具，设计用于在异步环境中工作。</p><p id="ee78" class="iv iw lq ix b iy iz ja jb jc jd je jf lr jh ji jj ls jl jm jn lt jp jq jr js hb bi translated"><strong class="ix hj"> nodemon </strong> : nodemon是一个帮助开发node的工具。基于js的应用程序，方法是在检测到目录中的文件更改时自动重新启动节点应用程序。</p></blockquote><p id="ddd7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">安装完所有依赖项后，您的package.json应该如下所示，</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><ul class=""><li id="6be0" class="kp kq hi ix b iy iz jc jd jg kr jk ks jo kt js ku kv kw kx bi translated">现在，如果package.json已经准备好了，那么在根文件夹下创建一个带有预置的. babelrc配置文件，</li></ul><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><ul class=""><li id="cc98" class="kp kq hi ix b iy iz jc jd jg kr jk ks jo kt js ku kv kw kx bi translated">对于graphql支持，在带有内容的根文件夹下添加一个graphql.config.js文件，这将添加支持并突出graphql语法。</li></ul><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="252b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，让我们为应用程序和MongoDB连接字符串添加一个配置文件。我们可以看到下面的文件，我们已经定义了服务器端口和数据库连接字符串。</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="3735" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们将使用mongoose工具为MongoDB定义不同的模式。与关系数据库类似，模式包含我们将在数据库中创建的各种表的结构。</p><p id="d805" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将为此演示创建两个模式。</p><ol class=""><li id="ad2e" class="kp kq hi ix b iy iz jc jd jg kr jk ks jo kt js lw kv kw kx bi translated">FriendsSchema(关于他/她的朋友的信息)</li><li id="28a8" class="kp kq hi ix b iy lx jc ly jg lz jk ma jo mb js lw kv kw kx bi translated">SeriesSchema(电视剧模式)。</li></ol><blockquote class="ln lo lp"><p id="05be" class="iv iw lq ix b iy iz ja jb jc jd je jf lr jh ji jj ls jl jm jn lt jp jq jr js hb bi translated">编译。ts文件，然后运行应用程序将它们传输到。js文件。</p></blockquote><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="9d8e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于我们已经定义了各种数据库模式，现在我们可以初始化我们的MongoDB连接。</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><blockquote class="ln lo lp"><p id="a2ce" class="iv iw lq ix b iy iz ja jb jc jd je jf lr jh ji jj ls jl jm jn lt jp jq jr js hb bi translated">这个文件使用必需的环境变量、连接字符串和注册到数据库的模式来配置MongoDB连接。</p></blockquote></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="b61a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">到目前为止，我们已经初始化了我们的应用程序，安装了依赖项，添加了数据库支持。现在我们将转移到配置GraphQL实例的主要任务。</p><ol class=""><li id="c073" class="kp kq hi ix b iy iz jc jd jg kr jk ks jo kt js lw kv kw kx bi translated">我们将首先定义graphql模式，使用来自<a class="ae iu" href="https://www.apollographql.com/docs/apollo-server/" rel="noopener ugc nofollow" target="_blank"> apollo-server-express </a>的graphql-query-language(gql)工具。graphQL服务器使用一个<strong class="ix hj">模式</strong>来描述数据图的形状。这个模式定义了一个<strong class="ix hj">类型</strong>的层次结构，其中的字段是从后端数据存储中填充的。该模式还精确地指定了哪些<strong class="ix hj">查询</strong>和<strong class="ix hj">突变</strong>可供客户端针对您的数据图执行。</li></ol><blockquote class="ln lo lp"><p id="da76" class="iv iw lq ix b iy iz ja jb jc jd je jf lr jh ji jj ls jl jm jn lt jp jq jr js hb bi translated">这里，我们定义了不同的类型以及查询和变异入口点。</p></blockquote><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="1093" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.现在，我们将定义GraphQL解析器。服务器需要知道如何为模式中的每个字段填充数据，以便能够响应对该数据的请求。为此，它使用解析器。</p><blockquote class="ln lo lp"><p id="778c" class="iv iw lq ix b iy iz ja jb jc jd je jf lr jh ji jj ls jl jm jn lt jp jq jr js hb bi translated"><strong class="ix hj">解析器是负责为模式中的单个字段填充数据的函数。</strong>它可以以您定义的任何方式填充数据，例如从后端数据库或第三方API获取数据。</p></blockquote><p id="0953" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，我们可以看到不同类型的查询类型和变异类型的解析器。这些是在schema.graphql文件中定义的相同函数和类型。</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="6e49" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果到目前为止我们已经完成了所有的配置，那么我们就成功地初始化、设置了我们的MongoDB、GraphQL Apollo服务器。</p><p id="c7ef" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们剩下的最后一块拼图是要初始化的express-server。这个服务器将是我们整个服务器的入口点。</p><figure class="ky kz la lb fd ij"><div class="bz dy l di"><div class="lu lv l"/></div></figure></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="daca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">至此，我们已经完成了所有配置的设置任务。现在，是运行服务器的时候了。</p><p id="e973" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">尝试安装依赖项，如果没有，运行下面的命令。</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="5273" class="lh li hi ld b fi lj lk l ll lm">npm install<br/>OR<br/>yarn</span></pre><p id="5f74" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，通过运行以下命令来运行服务器</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="09a6" class="lh li hi ld b fi lj lk l ll lm">npm start</span></pre><p id="9ada" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您将看到服务器将开始在<a class="ae iu" href="http://localhost:8080/graphql" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/graph QL</a>上运行。它将打开一个GraphQL游乐场。(当您在非生产环境中运行GraphQL Playground时，Apollo Server会自动托管它)。了解关于这个<a class="ae iu" href="https://www.apollographql.com/docs/apollo-server/getting-started/#step-8-execute-your-first-query" rel="noopener ugc nofollow" target="_blank"> GraphQL游乐场</a>的更多信息。</p><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/6ca8da12f1c4eb096e90bcf8e10085fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*BKrlIkXFOM5tG-AB_co6jg.gif"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">GraphQL Apollo Server Playground</figcaption></figure></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="4b52" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">到此，我们结束这篇文章。您可以在下面的Github资源库中查看完整的代码库。</p><p id="38ee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">务必启动存储库以获得GraphQL的未来更新。</p><p id="a2d2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">另外，如果您喜欢这篇文章，请鼓掌，它对您的GraphQL服务器设置有所帮助。😊</p><div class="md me ez fb mf mg"><a href="https://github.com/akrsh24/GraphQL-Medium" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab dw"><div class="mi ab mj cl cj mk"><h2 class="bd hj fi z dy ml ea eb mm ed ef hh bi translated">akrsh 24/graph QL-中等</h2><div class="mn l"><h3 class="bd b fi z dy ml ea eb mm ed ef dx translated">使用MongoDB和Apollo Server的GraphQL教程的存储库- akrsh24/GraphQL-Medium</h3></div><div class="mo l"><p class="bd b fp z dy ml ea eb mm ed ef dx translated">github.com</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu io mg"/></div></div></a></div><div class="md me ez fb mf mg"><a href="https://www.apollographql.com/docs/apollo-server/" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab dw"><div class="mi ab mj cl cj mk"><h2 class="bd hj fi z dy ml ea eb mm ed ef hh bi translated">阿波罗服务器简介</h2><div class="mn l"><h3 class="bd b fi z dy ml ea eb mm ed ef dx translated">Apollo Server是一个开源的、符合规范的GraphQL服务器，它与任何GraphQL客户端兼容，包括…</h3></div><div class="mo l"><p class="bd b fp z dy ml ea eb mm ed ef dx translated">www.apollographql.com</p></div></div><div class="mp l"><div class="mv l mr ms mt mp mu io mg"/></div></div></a></div></div></div>    
</body>
</html>