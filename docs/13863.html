<html>
<head>
<title>How Do I Use Redis In .Net Core</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何使用Redis？网络核心</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-do-i-use-redis-in-net-core-2c8160608a2d?source=collection_archive---------7-----------------------#2022-08-02">https://medium.com/geekculture/how-do-i-use-redis-in-net-core-2c8160608a2d?source=collection_archive---------7-----------------------#2022-08-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="029a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Redis是一个NoSQL数据库。它不仅仅是一个键值类型的数据库，它还有类型支持。它还支持一致性。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/63edd678ca995e5c38c63d6318f59675.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9_5t7dREEWPPxoAjVAY2lg.png"/></div></div></figure><p id="a186" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">先说安装；</p><p id="2569" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据您的操作系统，您可以从Redis的官方页面遵循这些步骤。</p><p id="ab90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是对于本文，我们将使用docker。因此，我们需要打开docker hub 并从那里搜索Redis。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="20bf" class="jv jw hi jr b fi jx jy l jz ka">docker run -p 6380:6379 --name some-redis -d redis</span></pre><p id="e048" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的命令将检查我们的系统是否有Redis映像，它将打开该映像，如果没有，它将下载最新版本的Redis，然后运行它</p><p id="2934" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要redis桌面管理器来查看redis中的内容。这是付费版本，但你可以通过这个<a class="ae jp" href="https://resp.app/" rel="noopener ugc nofollow" target="_blank">链接</a>注册试用版。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="a25e" class="jv jw hi jr b fi jx jy l jz ka">docker exec -it 0ef sh</span></pre><p id="9cdd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行上面的命令后，你就可以打开桌面管理器了。您需要设置连接配置。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kb"><img src="../Images/f205cf6afe208059bfa3b4acf06e1e2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*rX7YwzkGc-1qUT5nB6z8Sw.png"/></div></figure><p id="36ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击确定按钮后，您将看到。雷迪斯数据库。让我们试一试。再次打开命令提示符并键入..</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kc"><img src="../Images/5b594b956bfb58f95aced1436c5113b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*HbgomsflI3QFgJHlOaEKlw.png"/></div></figure><p id="44cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您返回并刷新桌面管理器时，您将看到您的第一条消息。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kd"><img src="../Images/de586d8e8d64e1b9df7c634817b6fa21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v8XprmWrtu6J7jCteDx2Cw.png"/></div></div></figure><p id="7e49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以看到数据类型。redis中可以使用哪种数据类型？</p><p id="fb30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">字符串</strong>:我们可以将字符串保存在Redis中。如果是数值，可以增加或减少</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ke"><img src="../Images/5403a8f3782f40b901da7320adcb8851.png" data-original-src="https://miro.medium.com/v2/resize:fit:474/format:webp/1*nF_pSwyLzz_Gxjr6d22_Cg.png"/></div></figure><p id="d580" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> List </strong>:像数组一样保存数据。它类似于链表</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kf"><img src="../Images/4a8ed1b665c9779cee01c49dc0f34f9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*aq3IWHXCAubmtgqO2MW3MQ.png"/></div></figure><p id="36a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">设置</strong>:喜欢列表。但是数据必须是不同的，我们不能选择写入数据的位置</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kg"><img src="../Images/4073139b45aa6b4fb445cdebd31e5da0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*LmOnIlekXM7HC-TRmomf-g.png"/></div></figure><p id="42eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">排序列表</strong>:保持数据排序。我们可以定义它们的分值。像集合一样，值应该是唯一的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kh"><img src="../Images/6b439258ce49c01ed8f2799af7116bcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*Ro0UJwE8QnLOoiCjL5VT3g.png"/></div></figure><p id="abf0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Hash </strong>:像字典一样保存数据。我们可以定义它们的分值。像集合一样，值应该是唯一的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ki"><img src="../Images/948cbb96f0efa1e88319599635e30f19.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*CuD1JvnqBA8spjzJPVoT2Q.png"/></div></figure><p id="38c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预知知识到此结束:)我们写点代码吧</p></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><p id="65e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建新的web应用程序。然后借助nuget拿下<strong class="ih hj">微软。extensions . caching . stackexchangeredis</strong>包。</p><ul class=""><li id="990c" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">使用redis服务器的端口向program.cs文件添加服务</li></ul><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="90b0" class="jv jw hi jr b fi jx jy l jz ka">builder.Services.AddStackExchangeRedisCache(options =&gt;<br/>{<br/>    options.Configuration = "localhost:6380";<br/>});</span></pre><ul class=""><li id="c23c" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">创建一个控制器并通过依赖注入得到<strong class="ih hj"> IDistrubutedCache </strong>接口。</li><li id="d6a5" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">编写索引方法来设置数据</li></ul><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="c515" class="jv jw hi jr b fi jx jy l jz ka">public IActionResult Index()<br/>        {<br/>            DistributedCacheEntryOptions cacheOptions = new DistributedCacheEntryOptions();<br/>            cacheOptions.AbsoluteExpiration = DateTime.Now.AddMinutes(1);<br/>            _redisCache.SetString("RedisCache", "Hello", cacheOptions);<br/>            return View();<br/>        }</span></pre><ul class=""><li id="1aa3" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">然后将数据写入显示方法</li></ul><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="eb4c" class="jv jw hi jr b fi jx jy l jz ka">public IActionResult Show()<br/>        {<br/>            ViewBag.Message =  _redisCache.GetString("RedisCache");<br/>            //to remove data from cache<br/>           _redisCache.Remove("RedisCache");<br/>            return View();<br/>        }</span></pre><p id="a10c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这只是字符串操作。对于复杂的对象，请遵循以下步骤。</p><ul class=""><li id="b9a2" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">创建方法名称可以是“复杂的”。</li></ul><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="ab5b" class="jv jw hi jr b fi jx jy l jz ka">public async Task&lt;IActionResult&gt; Complex()<br/>        {<br/>            DistributedCacheEntryOptions cacheOptions = new DistributedCacheEntryOptions();<br/>            cacheOptions.AbsoluteExpiration = DateTime.Now.AddMinutes(20);<br/>            Car car = new Car { Id = 1, Age = 2, Model = "Audi" };<br/>            string jsonCar = JsonConvert.SerializeObject(car);<br/>            await  _redisCache.SetStringAsync("car:1", jsonCar, cacheOptions);<br/>            return View();<br/>        }</span></pre><ul class=""><li id="2d69" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">对于读取操作</li></ul><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="b152" class="jv jw hi jr b fi jx jy l jz ka">public IActionResult CDataShow()<br/>        {<br/>            string jsonCar = _redisCache.GetString("car:1");<br/>            Car c = JsonConvert.DeserializeObject&lt;Car&gt;(jsonCar);<br/>            ViewBag.Name = c.Model;<br/>            return View();<br/>        }</span></pre><ul class=""><li id="2af2" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">文件缓存:缓存文件或图像。</li></ul><p id="37a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其实很简单。只需用set函数将文件转换成二进制。将二进制字符串发送到缓存。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="58b0" class="jv jw hi jr b fi jx jy l jz ka">public IActionResult ImageCache()<br/>        {<br/>            string path = Path.Combine(Directory.GetCurrentDirectory(), "wwwroot/images/image.png");<br/>            byte[] imageByte = System.IO.File.ReadAllBytes(path);<br/>            _redisCache.Set("image", imageByte);<br/>            return View();<br/>        }</span><span id="66b0" class="jv jw hi jr b fi le jy l jz ka">public IActionResult ShowImage()<br/>        {<br/>            byte[] imageByte = _redisCache.Get("image");<br/>            return File(imageByte, "image/png");<br/>        }</span></pre><p id="3fb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我上面说的是redis上的简单缓存。对于简单的缓存，我们可以使用IDistrubutedCache接口。让我们看看如何使用脚本开头的命令和<strong class="ih hj"> StackExchange </strong>。</p></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><p id="d84c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于StackExchange，我创建了一个新的MVC应用程序。加上StackExchange就行了。Redis包。我想在一个班级中管理所有与Redis相关的员工。为此，我创建了一个服务类。这个类的初始版本如下。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="0244" class="jv jw hi jr b fi jx jy l jz ka">public class RedisService<br/>    {<br/>        private const string Server = "localhost";<br/>        private const string Port = "6380";</span><span id="7a7d" class="jv jw hi jr b fi le jy l jz ka">private ConnectionMultiplexer _redis;<br/>        public IDatabase db { get; set; }</span><span id="1333" class="jv jw hi jr b fi le jy l jz ka">public void Connect()<br/>        {<br/>            var connectionSetting = $"{Server}:{Port}";</span><span id="2e59" class="jv jw hi jr b fi le jy l jz ka">_redis = ConnectionMultiplexer.Connect(connectionSetting);<br/>        }</span><span id="b73a" class="jv jw hi jr b fi le jy l jz ka">public IDatabase GetDb(int db)<br/>        {<br/>            return _redis.GetDatabase(db);<br/>        }<br/>    }</span></pre><p id="dfb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看那个服务是怎么回事。ConnectionMultiplexer来自nuget (StackExchange。Redis)包。有了这个，我们可以连接我们的Redis服务器。GetDb方法给了我们想要连接的数据库。</p><p id="f491" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是的，但是我们想在某个地方打电话联系。这是一个程序文件。首先，我们需要用singleton添加我们的RedisService。因为我们想得到redis的对象。所以从应用程序开始工作是很好的。</p><p id="e7a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">也许我们可以为它编写定制的中间件，但这篇redis文章将重点介绍这一点。所以程序文件如下。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="c869" class="jv jw hi jr b fi jx jy l jz ka">builder.Services.AddSingleton&lt;RedisService&gt;();<br/><br/><br/>var redisService = app.Services.GetService&lt;RedisService&gt;();</span><span id="bebf" class="jv jw hi jr b fi le jy l jz ka">redisService.Connect();</span></pre><p id="7230" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将分享项目代码。如果您的代码不起作用，请不要惊慌:)</p><p id="1b6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是的，下一步…让我们看看<strong class="ih hj">字符串</strong>方法</p><p id="cb9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Exchange Api非常容易。对于字符串操作，有太多的方法可以尝试使用。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="9392" class="jv jw hi jr b fi jx jy l jz ka">public IActionResult Index()<br/>        {<br/>           <br/>            _db.StringSet("Data", "Barkın Kızılkaya");<br/>            _db.StringSet("Count", 500);<br/>            return View();</span><span id="b0eb" class="jv jw hi jr b fi le jy l jz ka">}</span><span id="08d7" class="jv jw hi jr b fi le jy l jz ka">public async Task&lt;IActionResult&gt; Show()<br/>        {<br/>           var value =  _db.StringGet("Data");<br/>            _db.StringIncrement("Count", 1);<br/>            await _db.StringDecrementAsync("Count", 5);<br/>            _db.StringLength("Data");<br/>            if(value.HasValue)<br/>            {<br/>                ViewBag.value = value;<br/>            }<br/>            return View();<br/>        }</span></pre><p id="8dca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后我们可以看看列表方法。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="c812" class="jv jw hi jr b fi jx jy l jz ka">public IActionResult Index()<br/>        {</span><span id="175f" class="jv jw hi jr b fi le jy l jz ka">_db.ListRightPush("List", 1);</span><span id="39e0" class="jv jw hi jr b fi le jy l jz ka">return View();<br/>        }<br/>    }</span></pre><p id="8719" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实际上，使用exchange API，您可以做更多的事情，但是没有时间处理所有的方法。如果你使用这个API，那么你会从做API文档中得到。</p><p id="a4f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">祝你有美好的一天继续编码</p></div></div>    
</body>
</html>