<html>
<head>
<title>Folding Options Menu in Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter中的折叠选项菜单</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/folding-options-menu-in-flutter-c7dc8c95e6c5?source=collection_archive---------19-----------------------#2021-06-27">https://medium.com/geekculture/folding-options-menu-in-flutter-c7dc8c95e6c5?source=collection_archive---------19-----------------------#2021-06-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/96b84c1d08bfbab1725b1ac7d77ed8f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QZebFDhIxA5PJzVVoaGx8A.jpeg"/></div></div></figure><p id="ed13" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">菜单是任何现代移动应用程序中最重要的部分之一。应用程序中主要有两种类型的菜单，上下文菜单和选项菜单。我已经创建了一个<a class="ae jo" href="https://youtu.be/Y2XyyJcSTQo" rel="noopener ugc nofollow" target="_blank">聚焦菜单</a>包，它将帮助你获得应用程序上下文菜单的独特感觉，现在我想介绍这个<a class="ae jo" href="https://pub.dev/packages/folding_menu" rel="noopener ugc nofollow" target="_blank">折叠菜单</a>包，你可以在你的Flutter应用程序中使用它作为选项菜单。</p><p id="cadb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用包装是好的，但是在本文中，我将帮助您理解制作这个包的代码。首先，让我们看看这是如何工作的…</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es jp"><img src="../Images/9754f2f83fd1a9ff94b44d6df3ee6e8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*BQJ3hKWf7FVIJai0Udyutg.gif"/></div></figure><p id="64a5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好吧，那我们开始吧</p><p id="0063" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要做的第一件事是创建一个名为<strong class="is hj"> <em class="ju"> FoldingMenu的新的有状态小部件。</em> </strong>该文件夹菜单工作所需的三个基本属性是:</p><ol class=""><li id="c7d0" class="jv jw hi is b it iu ix iy jb jx jf jy jj jz jn ka kb kc kd bi translated"><strong class="is hj"> <em class="ju"> children: </em> </strong>显示为每个折叠图块的一组子部件。</li><li id="5f7d" class="jv jw hi is b it ke ix kf jb kg jf kh jj ki jn ka kb kc kd bi translated"><strong class="is hj"> <em class="ju">折叠:</em> </strong>从父控件控制菜单的折叠状态，即从屏幕的AppBar动作按钮控制该菜单的折叠。</li><li id="1ee6" class="jv jw hi is b it ke ix kf jb kg jf kh jj ki jn ka kb kc kd bi translated"><strong class="is hj"> <em class="ju">持续时间:</em> </strong>描述菜单折叠/展开所需的时间。它看起来会像这样:</li></ol><p id="eedb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">生成的小部件看起来会像这样:</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="4e8e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦这个完成了。我们需要关心的第一件事是，菜单小部件将如何响应<strong class="is hj"> <em class="ju">【折叠】</em> </strong>状态的变化。好了，为此我们有了一个很好的简单的覆盖<strong class="is hj"><em class="ju">"</em></strong><a class="ae jo" href="https://api.flutter.dev/flutter/widgets/State/didUpdateWidget.html" rel="noopener ugc nofollow" target="_blank"><strong class="is hj"><em class="ju">diddupdatewidget</em></strong></a><strong class="is hj"><em class="ju">"</em></strong>由有状态小部件类给我们。这为我们提供了小部件的前一个实例，即FoldingMenu，我们可以将其与当前实例进行比较，并根据结果决定执行一组操作。代码看起来会像这样:</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="7f0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们知道，我们将如何检测折叠状态的变化，以及我们的小部件将如何响应。让我们来看看当折叠状态改变时我们需要做些什么…..你猜对了！我们需要制作小部件的动画，为此，我们需要在小部件中设置一个<a class="ae jo" href="https://api.flutter.dev/flutter/animation/AnimationController-class.html" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">动画控制器</strong> </a>和<a class="ae jo" href="https://api.flutter.dev/flutter/animation/Animation-class.html" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">动画</strong> </a>实例。因为我想让我们的动画有一个漂亮平滑的感觉，我还会在我们的状态中创建一个<a class="ae jo" href="https://api.flutter.dev/flutter/animation/CurvedAnimation-class.html" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">curved animation</strong></a>的实例，这样我们就可以在所有的动画中使用它。我们还将在<strong class="is hj"> <em class="ju"> initState </em> </strong>函数中向AnimationController实例添加一个监听器，用每个新值<em class="ju">(确保在dispose函数中处理它)</em>更新UI。让我向您展示我们的代码此时应该是什么样子，然后我将解释一切是如何工作的:</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="15d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，在上面的代码中，有一些事情可能会让你感到惊讶。你可以看到我们这里有两个动画实例，分别是<strong class="is hj"> <em class="ju"> _animation </em> </strong>和<strong class="is hj"> <em class="ju"> _transAnimation。</em> </strong>这是因为，当菜单关闭时，它的每一个磁贴都会同时平移(上下移动)和旋转，因此我们必须同时对它们进行动画处理。我们将对这些使用相同的CurvedAnimation和AnimationController实例。</p><p id="2c96" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">与此同时，还有一个名为<strong class="is hj"> <em class="ju">的函数initiate imations</em></strong>，它采用了一个参数<strong class="is hj"> <em class="ju">【折叠】</em> </strong> <em class="ju">。</em>基于这个折叠状态，我们初始化/复位<strong class="is hj"><em class="ju">_动画</em> </strong>和<strong class="is hj"><em class="ju">_动画</em> </strong>。transAnimation的值将从0到1，我们将<strong class="is hj"> <em class="ju">乘以这些瓷砖必须覆盖的距离(取决于瓷砖的高度)</em> </strong>，而_animation的值将从0到1.57弧度，相当于90度。同样，一旦我们在<strong class="is hj"><em class="ju">initiate animations</em></strong>中为动画设置了值，我们就必须重置AnimationController并通过调用<strong class="is hj"> <em class="ju"> forward() </em> </strong>函数来重启它。</p><p id="6839" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们在哪里调用这个<strong class="is hj"><em class="ju">initiate imations</em></strong>函数呢？</p><p id="5886" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">嗯，我们在初始化AnimationController和CurvedAnimation之后，在<strong class="is hj"> <em class="ju"> initState </em> </strong>函数中使用这个函数，然后在<strong class="is hj"> <em class="ju"> didUpdateWidget </em> </strong>函数中调用这个函数，以便根据新的折叠状态更新动画。</p><p id="8e65" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好了，只是为了一些视觉上的上下文，我将在<strong class="is hj"> <em class="ju"> build </em> </strong>函数中添加一些代码，以基于<strong class="is hj"> <em class="ju"> _animation </em> </strong>值来<strong class="is hj"> <em class="ju">转换</em> </strong>子部件。</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="d876" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的代码中，我们使用一个列从上到下对子部件进行排序，并且我们将使用一个Transform部件分别对它们进行动画处理。</p><blockquote class="kl km kn"><p id="fa08" class="iq ir ju is b it iu iv iw ix iy iz ja ko jc jd je kp jg jh ji kq jk jl jm jn hb bi translated">如果你不知道变换和透视是如何工作的，我建议你看看这篇令人惊叹的<a class="ae jo" rel="noopener" href="/flutter-community/advanced-flutter-matrix4-and-perspective-transformations-a79404a0d828"> <strong class="is hj"> <em class="hi">文章</em> </strong> </a>作者<a class="kr ks ge" href="https://medium.com/u/abc8b1aeb318?source=post_page-----c7dc8c95e6c5--------------------------------" rel="noopener" target="_blank"> Deven Joshi </a>。</p></blockquote><p id="bc4f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们使用这个折叠菜单，看看我们的用户界面是什么样子的:</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="1f32" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们使用Stack作为父布局在我们的主屏幕内容上显示折叠菜单，目前，我们正在传递两个参数<strong class="is hj"> <em class="ju">子菜单</em> </strong> <em class="ju">(带有4个ListTile小部件)</em> <strong class="is hj"> <em class="ju"> </em> </strong>和<strong class="is hj"> <em class="ju">折叠菜单</em> </strong> <em class="ju">(值为“openMenu”)</em>来控制菜单<em class="ju">的折叠和展开。</em>结果将是这样的:</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es kt"><img src="../Images/858037e5104d183082b099a3cad4af60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/1*lJUZzmp22bO7fB3Di2ZlIQ.gif"/></div></figure><p id="c883" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，图块是如何旋转的，对齐方式为<strong class="is hj"> <em class="ju">顶部居中。</em> </strong>但是我们真的希望它们这样旋转吗？</p><p id="4811" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想一想，我们想要的行为是相对于百叶窗而言的。第一个图块(即奇数图块)应从其<strong class="is hj"> <em class="ju">顶部中心</em> </strong>旋转，而第二个图块(即偶数图块)应从其<strong class="is hj"> <em class="ju">底部中心</em> </strong>旋转。</p><p id="3fa5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，请注意，瓷砖是固定在一个位置，我们希望它们在菜单打开时向下移动，在菜单关闭时向上移动。为此，我们必须计算瓷砖的高度。请记住，每个瓷砖的高度应该相等。为了得到这个高度，我们可以使用<strong class="is hj"> <em class="ju"> WidgetsBinding </em> </strong>类的<strong class="is hj"><em class="ju">addpostframcallback</em></strong>函数。当小部件的第一帧被渲染时，这个函数被调用。关于这个<a class="ae jo" href="https://api.flutter.dev/flutter/scheduler/SchedulerBinding/addPostFrameCallback.html" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> <em class="ju">你可以在这里</em> </strong> </a>了解更多。</p><p id="3de5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这一切都很好，但是，即使在<strong class="is hj"><em class="ju">addPostFrameCallback</em></strong>中，我们如何在不引用每个图块的情况下获得图块的高度呢？为此，我们必须获取FoldingMenu中的<strong class="is hj"><em class="ju"/></strong>子元素，并遍历它们来创建一个新的<strong class="is hj"> <em class="ju">列表</em> </strong>，称为<strong class="is hj"><em class="ju">“widgets”。</em> </strong>在这个循环中，我们将获取每个孩子并用容器小部件包装它，同时为它分配一个新的<strong class="is hj"> <em class="ju"> GlobalKey </em> </strong>实例作为key <em class="ju">(我们也将把它放在一个名为</em><strong class="is hj"><em class="ju">【keys】</em></strong><em class="ju">)</em>的列表中，我们将获取每个孩子的索引。我们将把这个值列表<strong class="is hj"> <em class="ju">【索引，容器】</em> </strong>添加到<strong class="is hj"> <em class="ju">【小部件】</em> </strong>列表中。这个索引将帮助我们检测列表平铺是偶数还是奇数。然后我们将在<strong class="is hj"> addPostFrameCallback </strong>中使用这个键来获得列表平铺的高度。除此之外，我们还必须获得每个图块的<strong class="is hj">位置</strong>，以便在制作动画时将它们准确地转换到它们应该在的位置。我们将把这个放在一个名为<strong class="is hj"> <em class="ju">位置</em> </strong>的地图实例中。这段代码将进入<strong class="is hj"> <em class="ju"> initState </em> </strong>函数，现在看起来像这样:</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="dc68" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，让我们更新构建函数，以利用这些新的集合(键、小部件、位置等)</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="1f35" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以看到，基于我们之前所做的，我们现在循环通过我们在<strong class="is hj"> <em class="ju"> initState </em> </strong>中创建的列表<strong class="is hj"><em class="ju">【widgets】</em></strong>，而不是循环通过我们在FoldingMenu中接收的raw "<strong class="is hj"><em class="ju">widgets . children "</em></strong>。我们还使用索引来检测奇数/偶数<strong class="is hj"><em class="ju"/></strong>图块<strong class="is hj"> <em class="ju"> </em> </strong>并使用<strong class="is hj"> <em class="ju"> isOdd </em> </strong>来选择适当的<strong class="is hj"> <em class="ju">对齐和旋转值。</em> </strong>这样的结果会是这样的:</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es kt"><img src="../Images/b1e5a79af9728116328ad47a630bc7fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/1*vqyA6kdrbYL2a7OXPS6M_Q.gif"/></div><figcaption class="ku kv et er es kw kx bd b be z dx">With Rotation Transformation</figcaption></figure><p id="4e72" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，让我们进行图块翻译，为此我们将使用<strong class="is hj"><em class="ju">_ transAnimation</em></strong>实例<strong class="is hj"> <em class="ju"> </em> </strong>和<strong class="is hj"> <em class="ju">位置</em> </strong>列表。在这段代码的前面，我们计算了瓷砖的高度，并将其存储在一个名为<strong class="is hj"> <em class="ju"> elementHeight的变量中。</em> </strong>现在使用这个，我们将从FoldingMenu的顶部平移瓷砖到每个瓷砖应该到达的位置。有了这个，我们的构建函数将如下所示:</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="d0e9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于平移，我们用另一个变换来包装先前的旋转变换。这种对齐将始终是<strong class="is hj"> <em class="ju"> TopCenter </em> </strong>并且我们将使用Matrix4的<strong class="is hj"><em class="ju">translation values</em></strong>函数为<strong class="is hj"> <em class="ju">变换提供值。</em> </strong>我们只提供“Y”平移值<em class="ju">(上面代码片段的第13、14行)</em>，因为我们只需要垂直移动图块。经过这一小小的改动，我们的应用程序将如下运行:</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es kt"><img src="../Images/831386044cd2c14111f796624ddccbad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/1*mJBrf1RwEccURDVLDPJRhw.gif"/></div></figure><p id="a87a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有了这个，我们现在有了一个工作折叠菜单。唯一留下的就是你在原包装中看到的阴影。</p><p id="ad41" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为这篇文章已经太长了，我把它作为一个挑战留给你🎯。如果你在实现阴影时有问题，你可以在这里查看原始的包代码:</p><div class="ky kz ez fb la lb"><a href="https://github.com/retroportalstudio/folding_menu/blob/main/lib/folding_menu.dart" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab dw"><div class="ld ab le cl cj lf"><h2 class="bd hj fi z dy lg ea eb lh ed ef hh bi translated">倒车影像/折叠_菜单</h2><div class="li l"><h3 class="bd b fi z dy lg ea eb lh ed ef dx translated">一个用于颤振应用的简单易用的折叠菜单-retro portal studio/Folding _ Menu</h3></div><div class="lj l"><p class="bd b fp z dy lg ea eb lh ed ef dx translated">github.com</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp io lb"/></div></div></a></div><p id="c13d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以，我希望你从这篇文章中学到了很多。另外，查看在您自己的应用程序中使用这个包的教程。链接如下👇🏻：</p><blockquote class="kl km kn"><p id="7104" class="iq ir ju is b it iu iv iw ix iy iz ja ko jc jd je kp jg jh ji kq jk jl jm jn hb bi translated"><strong class="is hj">Youtube:</strong><a class="ae jo" href="https://youtu.be/xheS5wDodX4" rel="noopener ugc nofollow" target="_blank">https://youtu.be/xheS5wDodX4</a></p><p id="5239" class="iq ir ju is b it iu iv iw ix iy iz ja ko jc jd je kp jg jh ji kq jk jl jm jn hb bi translated"><strong class="is hj">包:</strong>T64】https://pub.dev/packages/folding_menu</p></blockquote><p id="53c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想支持我的工作，请考虑关注我:</p><blockquote class="kl km kn"><p id="fd4d" class="iq ir ju is b it iu iv iw ix iy iz ja ko jc jd je kp jg jh ji kq jk jl jm jn hb bi translated"><em class="hi"> 推特: </em> <a class="ae jo" href="https://www.youtube.com/theretroportal" rel="noopener ugc nofollow" target="_blank"> <em class="hi"> https://www.youtube.com/theretroportal </em> </a></p><p id="272f" class="iq ir ju is b it iu iv iw ix iy iz ja ko jc jd je kp jg jh ji kq jk jl jm jn hb bi translated"><em class="hi">Instagram:</em><a class="ae jo" href="https://www.instagram.com/retroportalstudio" rel="noopener ugc nofollow" target="_blank"><em class="hi">https://www.instagram.com/retroportalstudio </em></a></p><p id="d17d" class="iq ir ju is b it iu iv iw ix iy iz ja ko jc jd je kp jg jh ji kq jk jl jm jn hb bi translated"><em class="hi">LinkedIn:</em><a class="ae jo" href="https://www.linkedin.com/in/parasjainrps/" rel="noopener ugc nofollow" target="_blank"><em class="hi">https://www.linkedin.com/in/parasjainrps </em></a></p><p id="f36d" class="iq ir ju is b it iu iv iw ix iy iz ja ko jc jd je kp jg jh ji kq jk jl jm jn hb bi translated"><em class="hi"> Github: </em> <a class="ae jo" href="https://github.com/retroportalstudio" rel="noopener ugc nofollow" target="_blank"> <em class="hi"> https://github.com/retroportalstudio </em> </a></p></blockquote><p id="1492" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Happy Coding! ⚠️</p></div></div>    
</body>
</html>