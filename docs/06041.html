<html>
<head>
<title>DevSecOps series No. 2 — Automatic checking Dockerfiles for security</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DevSecOps系列2 —自动检查docker文件的安全性</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/devsecops-series-no-2-automatic-checking-dockerfiles-for-security-8709249c2367?source=collection_archive---------30-----------------------#2021-08-04">https://medium.com/geekculture/devsecops-series-no-2-automatic-checking-dockerfiles-for-security-8709249c2367?source=collection_archive---------30-----------------------#2021-08-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="ab fe cl ij"><img src="../Images/6d65fc774f6d5d2d2bd83eaf5c6165c7.png" data-original-src="https://miro.medium.com/v2/format:webp/1*jZsOe5EYNXGnZf3mPNqO8A.png"/></div></figure><p id="2d4a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">关于Docker安全性以及如何创建安全的Docker文件已经写了很多。你可以在谷歌上找到安全提示和最佳实践。</p><p id="16fa" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这很好，但仍有一个大问题需要解决:如何自动化安全检查。</p><h1 id="a4e1" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">构建Docker映像的步骤</h1><p id="211c" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">创建docker映像有两个步骤:</p><ul class=""><li id="946a" class="kn ko hi io b ip iq it iu ix kp jb kq jf kr jj ks kt ku kv bi translated">写文档。</li><li id="dda6" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated">从这个Docker文件构建Docker映像。</li></ul><p id="ce54" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这种情况下，我们将关注问题的第一部分:<strong class="io hj">docker file</strong>的内容(在接下来的帖子中，我将介绍构建图像的安全检查)。</p><h1 id="80b7" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">自动对文档进行安全检查</h1><p id="98ad" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">通常安全团队的资源有限。因此，将安全性包含在开发管道中的唯一方法是自动化该过程。</p><p id="7719" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">不管你用的是什么管道系统(Jenkins，Bamboo，Github actions，Gitlab pipelines，Bitbucket pipelines…)概念必须是相同的:当在docker文件中发现关键问题时，停止构建过程。</p><p id="50b6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这一点上，你可能会去Github寻找一些自动工具来检查Dockerfiles上的安全问题。别担心。我为你做的。</p><p id="b038" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我发现最有趣的工具有两个:</p><ul class=""><li id="3ec0" class="kn ko hi io b ip iq it iu ix kp jb kq jf kr jj ks kt ku kv bi translated">哈多林特:<a class="ae lb" href="https://github.com/hadolint/hadolint" rel="noopener ugc nofollow" target="_blank">https://github.com/hadolint/hadolint</a></li><li id="e002" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated">docker file-security:<a class="ae lb" href="https://github.com/cr0hn/dockerfile-security" rel="noopener ugc nofollow" target="_blank">https://github.com/cr0hn/dockerfile-security</a>(剧透，我是它的作者)</li></ul><p id="7f87" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们分析两者。</p><h1 id="11b9" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">哈多林特</h1><p id="0bd1" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">Hadolint是非常好的工具。它是基于规则的，有很多内置的规则，不仅仅是为了安全。</p><p id="a9a2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是一个单一的二进制工具。非常快而且是用Haskell写的。此外，有许多选项来定制分析。</p><p id="8a8f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">该项目提供了该工具的在线版本，您无需在计算机中安装任何东西即可使用:</p><figure class="lc ld le lf fd ii er es paragraph-image"><div class="ab fe cl ij"><img src="../Images/e23279f9c6519f28f62a06e6f89e82e9.png" data-original-src="https://miro.medium.com/v2/format:webp/1*8CrwZC2t4UAQ3wQ2lUANzA.png"/></div></figure><h1 id="02be" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">docker file-安全性</h1><p id="2795" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">Dockerfile-security it是一个没有Hadolint那么雄心勃勃的工具。它更简单，被设计用于C.I .(持续集成)系统。</p><p id="f6c2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个工具专注于安全性。它是基于规则的，就像Hadolint一样。它也很快，是用Python写的，可以用Python包管理器<code class="du lg lh li lj b">pip</code>安装。</p><p id="630b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">它提供了一些内置的通用规则(称为<strong class="io hj">核心规则</strong>)和一些针对特定场景的规则(例如，Java特定规则)。</p><figure class="lc ld le lf fd ii er es paragraph-image"><div class="ab fe cl ij"><img src="../Images/0bf499d6324bc363d53273ca2c527fbb.png" data-original-src="https://miro.medium.com/v2/format:webp/1*iGUNgbWJVT2LGaK703kN-A.png"/></div></figure><h1 id="4bdc" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">Hadolint vs Dockerfile-security</h1><p id="7134" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">两者各有优缺点。</p><h2 id="697f" class="lk jl hi bd jm ll lm ln jq lo lp lq ju ix lr ls jy jb lt lu kc jf lv lw kg lx bi translated">Hadolint优点</h2><ul class=""><li id="6a6a" class="kn ko hi io b ip ki it kj ix ly jb lz jf ma jj ks kt ku kv bi translated">大量的内置规则，不仅仅是为了安全。</li><li id="e911" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated">独立二进制。</li><li id="f3fd" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated">非常快。</li><li id="e42f" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated">对发现的问题的友好反馈。</li><li id="ee74" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated">在线版本</li></ul><h2 id="849e" class="lk jl hi bd jm ll lm ln jq lo lp lq ju ix lr ls jy jb lt lu kc jf lv lw kg lx bi translated">Hadolint缺点</h2><ul class=""><li id="3e7b" class="kn ko hi io b ip ki it kj ix ly jb lz jf ma jj ks kt ku kv bi translated">Hadolint是用Haskell os编写的，如果你需要包含一个新的规则，你必须用Haskell编写你的规则，然后重新编译这个工具。</li><li id="4fbb" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated">Hadolint没有以可解析格式导出结果的选项，比如JSON o XML。</li></ul><h2 id="588a" class="lk jl hi bd jm ll lm ln jq lo lp lq ju ix lr ls jy jb lt lu kc jf lv lw kg lx bi translated">docker file-安全专业人员</h2><ul class=""><li id="ec69" class="kn ko hi io b ip ki it kj ix ly jb lz jf ma jj ks kt ku kv bi translated">关注安全。</li><li id="66cd" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated">DevSecOps聚焦。</li><li id="e051" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated">非常快。</li><li id="d357" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated">对发现的问题的友好反馈。</li><li id="f373" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated">添加新规则非常简单。规则是基于纯YAML文本的。</li><li id="1e40" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated">可以从远程站点获取规则，提供完整的URL。</li><li id="95b8" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated">结果可以导出为JSON文件。</li></ul><h2 id="15d2" class="lk jl hi bd jm ll lm ln jq lo lp lq ju ix lr ls jy jb lt lu kc jf lv lw kg lx bi translated">docker file-安全骗局</h2><ul class=""><li id="24c9" class="kn ko hi io b ip ki it kj ix ly jb lz jf ma jj ks kt ku kv bi translated">规则比Hadolint简单。</li><li id="cadd" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated">不是独立的二进制。</li></ul><h1 id="4e25" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">使用Hadolint还是Dockefile-security</h1><p id="4d76" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">没有正确的答案。这取决于您的需求:</p><ul class=""><li id="c1c9" class="kn ko hi io b ip iq it iu ix kp jb kq jf kr jj ks kt ku kv bi translated">如果您不仅需要安全规则，Hadolint可能是一个不错的选择。</li><li id="8248" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated">如果您需要自己的自定义规则，Dockerfile-security是最佳选择。</li></ul><p id="851b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">还有第三种选择:为什么只使用一种呢？为什么不两个都用？两者都非常快，很容易集成。所以…为什么不呢？</p><h1 id="ffe4" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">更多关于DevSecOps系列的帖子</h1><p id="62c7" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">前一篇文章:<strong class="io hj"> DevSecOps系列第1期——通过使用邪恶的Git库破解CI/CD</strong></p><div class="mb mc ez fb md me"><a href="https://cr0hn.medium.com/devsecops-series-1-breaking-the-ci-cd-by-using-evil-git-repositories-2eaa460f5d5b" rel="noopener follow" target="_blank"><div class="mf ab dw"><div class="mg ab mh cl cj mi"><h2 class="bd hj fi z dy mj ea eb mk ed ef hh bi translated">DevSecOps系列1 —通过使用邪恶的Git库破坏CI/CD</h2><div class="ml l"><h3 class="bd b fi z dy mj ea eb mk ed ef dx translated">编辑描述</h3></div><div class="mm l"><p class="bd b fp z dy mj ea eb mk ed ef dx translated">cr0hn.medium.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms ik me"/></div></div></a></div><p id="bd15" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下一篇:<strong class="io hj"> DevSecOps系列第三期DevOps中的旧时尚问题:拉链炸弹</strong></p><div class="mb mc ez fb md me"><a href="https://cr0hn.medium.com/devsecops-series-no-3-old-fashion-issues-in-devops-zip-bombs-d0045ffd57bd" rel="noopener follow" target="_blank"><div class="mf ab dw"><div class="mg ab mh cl cj mi"><h2 class="bd hj fi z dy mj ea eb mk ed ef hh bi translated">DevSecOps系列第3期DevOps的老问题:拉链炸弹。</h2><div class="ml l"><h3 class="bd b fi z dy mj ea eb mk ed ef dx translated">今天我将谈论一种会影响您的生产系统的新旧攻击:Zip炸弹。</h3></div><div class="mm l"><p class="bd b fp z dy mj ea eb mk ed ef dx translated">cr0hn.medium.com</p></div></div><div class="mn l"><div class="mt l mp mq mr mn ms ik me"/></div></div></a></div></div></div>    
</body>
</html>