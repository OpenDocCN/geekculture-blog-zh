<html>
<head>
<title>Postman: Automating Rest APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">邮递员:自动化Rest APIs</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/automating-rest-apis-with-postman-c740049b56dd?source=collection_archive---------6-----------------------#2021-05-03">https://medium.com/geekculture/automating-rest-apis-with-postman-c740049b56dd?source=collection_archive---------6-----------------------#2021-05-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e2d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Postman是测试API的优秀工具。后端开发人员、web开发人员、移动开发人员和QA测试人员都可以使用它。Postman不仅用于手动测试API，也是一个很好的自动化工具。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/a4f176c3f533191da7385cb34a45de1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rY_hm9orJKCC3D0w1hYHag.jpeg"/></div></div></figure><p id="3e57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以使用JavaScript编写自动化脚本，在<a class="ae jp" href="https://www.chaijs.com/" rel="noopener ugc nofollow" target="_blank"> chai.js </a>中编写断言，这是一个BDD/TDD断言库。Postman允许与<a class="ae jp" href="https://www.getpostman.com/docs/v6/postman/collection_runs/command_line_integration_with_newman" rel="noopener ugc nofollow" target="_blank">纽曼</a>一起运行测试，并添加到您的构建管道中。您还可以使用<a class="ae jp" href="https://junit.org/junit5/" rel="noopener ugc nofollow" target="_blank"> Junit </a>和Newman导出测试报告。本文的范围仅限于编写测试脚本。</p><h2 id="8f02" class="jq jr hi bd js jt ju jv jw jx jy jz ka iq kb kc kd iu ke kf kg iy kh ki kj kk bi translated">编写测试脚本</h2><p id="4829" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq kn is it iu ko iw ix iy kp ja jb jc hb bi translated">你可以在Postman的两个地方添加Javascript代码。</p><ol class=""><li id="1efc" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated"><a class="ae jp" href="https://learning.postman.com/docs/writing-scripts/pre-request-scripts/" rel="noopener ugc nofollow" target="_blank">预请求脚本</a>:在请求运行之前，您可以在Postman中使用预请求脚本来执行JavaScript。在<strong class="ih hj">预请求脚本</strong>选项卡下，您可以添加JavaScript代码来设置变量值、参数、标题和请求主体数据。</li><li id="3132" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated"><a class="ae jp" href="https://learning.postman.com/docs/writing-scripts/test-scripts/" rel="noopener ugc nofollow" target="_blank">测试脚本</a>:您可以使用<strong class="ih hj">测试</strong>标签来编写测试脚本。您的测试脚本可以使用动态变量，对响应数据执行测试断言，并在请求之间传递数据。测试脚本将在请求运行后执行。您将能够在响应数据旁边的<strong class="ih hj">测试结果</strong>选项卡中看到输出。</li></ol><p id="6b65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以将预请求和测试脚本添加到集合、文件夹、集合中的请求或未保存到集合的请求中。</p><p id="abdd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将讨论如何自动化POST、GET、PUT和DELETE APIs。在Postman中实现自动化需要基本的JavaScript知识。</p><h2 id="bffc" class="jq jr hi bd js jt ju jv jw jx jy jz ka iq kb kc kd iu ke kf kg iy kh ki kj kk bi translated"><strong class="ak">发布请求</strong></h2><p id="1925" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq kn is it iu ko iw ix iy kp ja jb jc hb bi translated">在自动化过程中，我们将考虑以下请求和响应。</p><p id="477b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="le">终点:</em> </strong></p><blockquote class="lf lg lh"><p id="2b93" class="if ig le ih b ii ij ik il im in io ip li ir is it lj iv iw ix lk iz ja jb jc hb bi translated">http://some-web-地址/库存/汽车</p></blockquote><p id="8b20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="le">请求体:</em> </strong></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="e04d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="le">回复正文:</em> </strong></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="303e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每次触发请求时，API需要不同的id(整数)、name(字符串)、displayName(字符串)。让我们看看如何将随机值传递给这些字段。</p><p id="8aa2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以使用以下函数/库在请求中生成随机/动态数据。</p><ol class=""><li id="fb71" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated"><a class="ae jp" href="https://www.npmjs.com/package/faker" rel="noopener ugc nofollow" target="_blank"> faker.js </a> : Faker.js是一个JavaScript库，它公开了在运行时生成随机数据的函数。</li><li id="ec68" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated"><code class="du ln lo lp lq b">Math.random()</code>:此方法返回大于等于0.0小于1.0的伪随机双精度值。</li><li id="d147" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">JavaScript Lodash _ : <code class="du ln lo lp lq b"> _.random (min,max)</code>生成给定范围内的随机整数。</li></ol><p id="7f55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="le">前置请求脚本</em> </strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lr"><img src="../Images/37e6d87d0e8fd71d1c16bf0f9f1383a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WWt-GEhD6KPIGuQfMYWU3w.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Pre-request Script</figcaption></figure><p id="c9bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的脚本中，我们首先使用<code class="du ln lo lp lq b">Math.random()</code>来生成随机字符串。<strong class="ih hj">名称</strong>和<strong class="ih hj">显示名称</strong>。接下来，我们创建一个环境变量<strong class="ih hj"> cargroupName </strong>并将其值设置为<strong class="ih hj">名称</strong>和变量<strong class="ih hj"> cargroupDisplayName </strong>并将其值设置为<strong class="ih hj">显示名称</strong>。为了设置环境变量<strong class="ih hj"> id </strong>的值，我们使用了<code class="du ln lo lp lq b">faker.js</code>提供的函数<code class="du ln lo lp lq b">$randomInt</code>。</p><p id="fcec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者，我们可以使用<code class="du ln lo lp lq b">pm.environment.set(“id”,_.random(1000,10000))</code>来设置环境变量<strong class="ih hj"> id </strong>的值。其返回值介于1000和10000之间。</p><p id="c4dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">环境变量中设置的所有值都将在请求正文中使用。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/104b63238536bef038d4ac7bb52f32b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lEQL_dnSFhWXdL7SVslnxA.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Request Body</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lx"><img src="../Images/383663d135fcf02535a1bca01c71d5cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JH7orqiqRnknP3HeZ6ZspA.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Environment Variables</figcaption></figure><p id="8d58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在执行之前，将运行预请求脚本并设置变量值。这些值将在请求正文中使用。现在让我们看看测试脚本看起来会是什么样子。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/69558fa52e13bdd6ac246344c3d59c31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I6Tk17p4FrOCQBlKxD-nuA.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Test Script And Response</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lz"><img src="../Images/eb15128c01f9db7f834a81b1cd741459.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k-Nz01ZVooIV2xyy-pnZYw.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Passed Test</figcaption></figure><p id="6cef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经使用<code class="du ln lo lp lq b">chai.js</code>编写了断言。上面的测试脚本包含了三个由<code class="du ln lo lp lq b">pm.test()</code>定义的测试。我们也可以使用<code class="du ln lo lp lq b">console.log</code>登录到postman控制台。让我们看看失败的测试是什么样的</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ma"><img src="../Images/7b915106a8b8f0c65bfe21091848d006.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*thfVsh5WrvtkqLka3EhRNg.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Failed Test</figcaption></figure><h2 id="54b5" class="jq jr hi bd js jt ju jv jw jx jy jz ka iq kb kc kd iu ke kf kg iy kh ki kj kk bi translated">获取请求:</h2><p id="147f" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq kn is it iu ko iw ix iy kp ja jb jc hb bi translated">现在我们想使用GET请求读取创建的资源，id应该从POST响应中传递。我们只需要将<strong class="ih hj"> id </strong>放入API端点，因为它已经被设置为环境变量。</p><p id="98bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="le">终点:</em> </strong></p><blockquote class="lf lg lh"><p id="36d2" class="if ig le ih b ii ij ik il im in io ip li ir is it lj iv iw ix lk iz ja jb jc hb bi translated"><a class="ae jp" href="http://some-web-address/inventory/car/{{id}}" rel="noopener ugc nofollow" target="_blank">http://some-web-address/inventory/car/{ { id } }</a></p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mb"><img src="../Images/e97a62efbdb5ed257f35f1ffdcebb6ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ArIK4VVA0rnClq-O0NShFQ.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Response and Test Script</figcaption></figure><p id="077f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，在从GET请求接收到响应之后，它被更新，并且JSON中的<strong class="ih hj">优先级</strong>字段被更新为10。更新后的JSON被保存到环境变量中，以便在PUT请求中使用。</p><h2 id="61f9" class="jq jr hi bd js jt ju jv jw jx jy jz ka iq kb kc kd iu ke kf kg iy kh ki kj kk bi translated"><strong class="ak">上传请求:</strong></h2><p id="e1ce" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq kn is it iu ko iw ix iy kp ja jb jc hb bi translated">环境变量<strong class="ih hj"> savedData </strong>可以直接在PUT请求中使用，您可以在响应中看到<strong class="ih hj">优先级</strong>字段被更改为10。</p><p id="1b8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="le">终点:</em> </strong></p><blockquote class="lf lg lh"><p id="095b" class="if ig le ih b ii ij ik il im in io ip li ir is it lj iv iw ix lk iz ja jb jc hb bi translated">http://some-web-address/inventory/car/{ { id } }</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mc"><img src="../Images/e386bf4fd251fcb7d7bba10b5d301f89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0t-bUpDz2TUM5HBLT5GMCQ.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Request Body And Response</figcaption></figure><h2 id="8b0c" class="jq jr hi bd js jt ju jv jw jx jy jz ka iq kb kc kd iu ke kf kg iy kh ki kj kk bi translated"><strong class="ak">删除请求:</strong></h2><p id="c8c7" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq kn is it iu ko iw ix iy kp ja jb jc hb bi translated">同样，我们可以使用环境变量<strong class="ih hj"> id </strong>调用删除请求来执行删除操作。</p><p id="d173" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="le">终点:</em> </strong></p><blockquote class="lf lg lh"><p id="0d25" class="if ig le ih b ii ij ik il im in io ip li ir is it lj iv iw ix lk iz ja jb jc hb bi translated">http://some-web-address/inventory/car/{ { id } }</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/7958e7b2312916cd875e07674e42e8ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NaOhb8vTRpGftmt-u3SGWg.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Delete Request</figcaption></figure><p id="c6e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">执行删除后，获取检查状态的请求。在这里，您可以看到状态更改为0。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es me"><img src="../Images/82ba415202b7e5582b0465f5084b0b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oytAPlCvcoD0YbvbwX7bwg.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Get Request After Delete</figcaption></figure><h2 id="c161" class="jq jr hi bd js jt ju jv jw jx jy jz ka iq kb kc kd iu ke kf kg iy kh ki kj kk bi translated">正在执行集合</h2><p id="e4bf" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq kn is it iu ko iw ix iy kp ja jb jc hb bi translated">邮差允许我们管理整个系列。API可以按照所需的顺序排列，在执行集合时，API将按照定义的顺序运行。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mf"><img src="../Images/9d12f4366347c6061e1a0b1b458ad9e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*PuST3a_m_yyF4ESoGFgS7w.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Run Sequence of APIs In Collection</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mg"><img src="../Images/53bd2a392f855342763d5adfedd3a437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yutVXM49ZDRMsXw6FPXNWg.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Run Collection Window</figcaption></figure><p id="4f8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，您可以选择包含哪些API，定义迭代次数，保存响应和其他事情。点击<strong class="ih hj">运行自动化示例</strong>按钮运行收集。自动化示例是集合的名称。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mh"><img src="../Images/2b14636b55898f4df8906e4464d6c8bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xK8j_bTPuiGZy8k69Rjabg.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Running a Collection</figcaption></figure><h2 id="938e" class="jq jr hi bd js jt ju jv jw jx jy jz ka iq kb kc kd iu ke kf kg iy kh ki kj kk bi translated">邮递员自动化的利与弊</h2><p id="f049" class="pw-post-body-paragraph if ig hi ih b ii kl ik il im km io ip iq kn is it iu ko iw ix iy kp ja jb jc hb bi translated"><strong class="ih hj">优点:</strong></p><ol class=""><li id="a8d7" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">您不需要创建或维护自动化框架。</li><li id="d298" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">易于使用，不需要代码连接到REST客户端或生成报告。</li><li id="1cee" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">提供的代码片段使脚本开发速度更快。</li></ol><p id="7181" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">缺点:</p><ol class=""><li id="3c83" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">测试脚本/预请求脚本不能重用，因此没有代码可重用性。</li><li id="d710" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">无法与allure、范围报告等报告框架集成。</li><li id="4308" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">不支持连接到数据库或excel文件。</li><li id="36e0" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">难以在多个数据集上测试脚本。</li></ol><p id="06e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想自动化小型微服务的CRUD APIs，Postman是一个很好的工具，因为它很简单，你不需要创建任何框架。</p><p id="620f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="le">完整项目和更多库可以在我的</em><a class="ae jp" href="https://github.com/attrideepak" rel="noopener ugc nofollow" target="_blank"><em class="le">github</em></a><em class="le">上找到。</em></p></div></div>    
</body>
</html>