<html>
<head>
<title>How to Connect Strapi to PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Strapi连接到PostgreSQL</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-connect-strapi-to-postgresql-7610d1c1c9a0?source=collection_archive---------37-----------------------#2021-07-19">https://medium.com/geekculture/how-to-connect-strapi-to-postgresql-7610d1c1c9a0?source=collection_archive---------37-----------------------#2021-07-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c26da7c4728a073e24ac076018a09f09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nL0Nf4DFJOgg71bd9cTbgg.jpeg"/></div></div></figure><p id="26f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我们将学习如何将Strapi连接到PostgreSQL。默认情况下，Strapi使用SQLite进行内容存储，并且Strapi不仅限于使用SQLite作为数据库，它还可以配置为使用其他数据库，如<a class="ae jo" href="https://masteringbackend.com/posts/mongodb-tutorial-the-ultimate-guide" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>、MySQL、MariaDB、PostgreSQL等。</p><p id="f5e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如何将一个Strapi实例连接到一个Postgres数据库经常令人困惑，许多来回总是与它相关联，但是在本文中，我将揭开所有这些背后的神秘面纱。我将用例子和图片展示我们如何配置一个Strapi实例来使用Postgres数据库。</p><p id="bf96" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们还将学习如何:</p><ul class=""><li id="40da" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">在Strapi上创建集合。</li><li id="0369" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">在我们的机器上建立一个Postgres数据库。</li><li id="6d49" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">如何在Strapi上手动添加API端点？</li><li id="14f6" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">在React中创建一个银行管理应用程序来使用Strapi API端点。</li></ul><h1 id="c007" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">斯特拉皮</h1><p id="5926" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated"><a class="ae jo" href="https://strapi.io/" rel="noopener ugc nofollow" target="_blank"> Strapi </a>是一个基于Nodejs的开源无头CMS，用于设计api和管理内容。</p><p id="cf03" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Strapi帮助我们非常快速地搭建我们的后端，构建api并从客户端使用API。客户端可以是移动的、web的、桌面的、cURL的等等。</p><p id="b46a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">api是从Strapi UI管理面板创建的。我们创建单一类型的集合。Strapi中的集合映射到端点:</p><ul class=""><li id="d627" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">发布<code class="du lg lh li lj b">/YOUR_COLLECTION_s</code>:创建新内容。</li><li id="813e" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">获取<code class="du lg lh li lj b">/YOUR_COLLECTION_s</code>:获取所有内容。</li><li id="6a3a" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">获取<code class="du lg lh li lj b">/YOUR_COLLECTION_s/:ID</code>:根据ID获取单个内容。</li><li id="24b0" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">上传<code class="du lg lh li lj b">/YOUR_COLLECTION_s/:ID</code>:编辑内容</li><li id="940b" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">删除<code class="du lg lh li lj b">/YOUR_COLLECTION_s/:ID</code>:删除一个内容。</li></ul><p id="9715" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">默认情况下，Strapi为我们提供RESTful APIs，但是我们也可以在Strapi中创建GraphQL APIs。然后，我们可以在浏览器中使用GraphQL Playground来运行查询和变异。设置Strapi非常容易。我们只需运行下面的命令:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="8767" class="ls ke hi lj b fi lt lu l lv lw">npx create-strapi-app strapi-api<br/>    # OR<br/>    yarn create strapi-api strapi-api</span></pre><p id="b0a3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们运行<code class="du lg lh li lj b">yarn develop</code>命令在<code class="du lg lh li lj b">localhost:1337</code>启动服务器。API端点是从<code class="du lg lh li lj b">localhost:1337</code> URL消费的。此外，我们可以在<code class="du lg lh li lj b">localhost:1337/admin</code>从同一个URL加载管理UI。</p><p id="2b1a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Strapi包含一个服务器和一个数据库。服务器托管API，数据库用于存储应用程序的内容。Strapi为其服务器使用了<a class="ae jo" href="https://koajs.com/" rel="noopener ugc nofollow" target="_blank"> Koajs </a>框架。</p><p id="10a4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要验证这一点，请转到<code class="du lg lh li lj b">strapi-API/config/</code>文件夹。</p><p id="65b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将看到以下内容:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="2c2b" class="ls ke hi lj b fi lt lu l lv lw">config/<br/>            functions/<br/>                responses/<br/>                    404.js<br/>                bootstrap.js<br/>                cron.js<br/>            database.js<br/>            server.js</span></pre><p id="a4e1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是保存Strapi配置的地方。<code class="du lg lh li lj b">404.js</code>文件用于返回自定义的404消息。</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="8aed" class="ls ke hi lj b fi lt lu l lv lw">"use strict";<br/>    <br/>    module.exports = async (/* ctx */) =&gt; {<br/>      // return ctx.notFound('My custom message 404');<br/>    };</span></pre><p id="a942" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lg lh li lj b">cron.js</code>文件是我们可以在Strapi上设置cron作业的地方。这些作业根据我们输入的格式定期运行:<code class="du lg lh li lj b">[SECOND (optional)] [MINUTE] [HOUR] [DAY OF MONTH] [MONTH OF YEAR] [DAY OF WEEK]</code>。</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="db3a" class="ls ke hi lj b fi lt lu l lv lw">"use strict";<br/>    <br/>    module.exports = {};</span></pre><p id="138b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lg lh li lj b">server.js</code>是我们配置Strapi服务器的地方。我们可以设置我们的主机、端口和身份验证。默认情况下，Strapi在端口1337的<code class="du lg lh li lj b">0.0.0.0</code>提供服务。我们可以在这个文件中更改它们。</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="1f21" class="ls ke hi lj b fi lt lu l lv lw">module.exports = ({ env }) =&gt; ({<br/>      host: env("HOST", "0.0.0.0"),<br/>      port: env.int("PORT", 1337),<br/>      admin: {<br/>        auth: {<br/>          secret: env("ADMIN_JWT_SECRET", "9c8eb554ab87ab3e95d1e32ca140e304"),<br/>        },<br/>      },<br/>    });</span></pre><p id="78b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lg lh li lj b">database.js</code>是配置要使用的数据库的地方。<a class="ae jo" href="https://masteringbackend.com/posts/top-10-database-clients-for-developers" rel="noopener ugc nofollow" target="_blank">数据库的客户端</a>，主机名，端口等。，都设置在这里。</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="03db" class="ls ke hi lj b fi lt lu l lv lw">module.exports = ({ env }) =&gt; ({<br/>      defaultConnection: "default",<br/>      connections: {<br/>        default: {<br/>          connector: "bookshelf",<br/>          settings: {<br/>            client: "sqlite",<br/>            filename: env("DATABASE_FILENAME", ".tmp/data.db"),<br/>          },<br/>          options: {<br/>            useNullAsDefault: true,<br/>          },<br/>        },<br/>      },<br/>    });</span></pre><p id="fe8b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以在这里看到这些是Strapi的默认数据库设置。正如我们前面所说，它使用的是SQLite数据库。</p><ul class=""><li id="aaeb" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated"><code class="du lg lh li lj b">defaultConnection</code>是模型在查询数据库时使用的默认连接。默认值是默认值。您可以将其设置为connections对象中的任何属性键。</li><li id="14d4" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">connections</code>设置我们可以用来访问数据库的连接类型。我们有一个连接到SQLite数据库的默认连接。</li><li id="6855" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">client</code>是创建连接的数据库客户机。</li><li id="dcf8" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">filename</code>是数据库文件的路径。</li><li id="926c" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">这个<code class="du lg lh li lj b">file</code>允许我们设置我们的Strapi应用程序使用PostgreSQL、MySQL、SQLServer或MongoDB。</li></ul><p id="94c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在下一节中，我们将安装PostgreSQL二进制文件。</p><h1 id="7243" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">PostgresDB设置</h1><p id="293c" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">我们需要设置和安装PostgreSQL。如果您的机器上没有安装PostgreSQL，请转到<a class="ae jo" href="https://www.postgresql.org/download/" rel="noopener ugc nofollow" target="_blank">PostgreSQL下载</a>并为您的机器下载二进制文件。</p><ul class=""><li id="9260" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated"><a class="ae jo" href="https://www.postgresql.org/download/linux/" rel="noopener ugc nofollow" target="_blank"> Linux </a></li><li id="779d" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><a class="ae jo" href="https://www.postgresql.org/download/macosx/" rel="noopener ugc nofollow" target="_blank"> macOS </a></li><li id="3084" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><a class="ae jo" href="https://www.postgresql.org/download/solaris/" rel="noopener ugc nofollow" target="_blank">索拉里斯</a></li><li id="6ac3" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><a class="ae jo" href="https://www.postgresql.org/download/windows/" rel="noopener ugc nofollow" target="_blank">窗户</a></li><li id="ea39" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><a class="ae jo" href="https://www.postgresql.org/download/bsd/" rel="noopener ugc nofollow" target="_blank"> BSD </a></li></ul><p id="acf6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装后，启动Postgres服务器。请务必记住Postgres端口、用户名和密码，因为我们将使用它们将Strapi连接到Postgres。</p><p id="e749" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在PostgreSQL中创建一个数据库，将其命名为<code class="du lg lh li lj b">bank</code>,因为我们将构建一个银行应用程序来进一步演示如何通过Strapi使用PostgreSQL DB。</p><p id="6305" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另外，如果您想从源代码构建PostgreSQL，请从这里的<a class="ae jo" href="https://www.postgresql.org/ftp/source/" rel="noopener ugc nofollow" target="_blank">下载源代码并编译它。</a></p><h1 id="2860" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">在Strapi中配置PostgreSQL</h1><p id="8acc" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">为了配置我们的Strapi来使用我们的PostgreSQL，我们将在我们的<code class="du lg lh li lj b">strapi-api/config/database.js</code>文件中添加一些配置。</p><p id="d2c9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">打开<code class="du lg lh li lj b">strapi-api/config/database.js</code>，将下面的代码粘贴到文件中:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="c2d6" class="ls ke hi lj b fi lt lu l lv lw">// strapi-api/config/database.js<br/>    module.exports = ({ env }) =&gt; ({<br/>      defaultConnection: "default",<br/>      connections: {<br/>        default: {<br/>          connector: "bookshelf",<br/>          settings: {<br/>            client: "postgres",<br/>            host: env("DATABASE_HOST", "localhost"),<br/>            port: env.int("DATABASE_PORT", 5432),<br/>            database: env("DATABASE_NAME", "bank"),<br/>            username: env("DATABASE_USERNAME", "postgres"),<br/>            password: env("DATABASE_PASSWORD", "0000"),<br/>            schema: env("DATABASE_SCHEMA", "public"),<br/>          },<br/>          options: {},<br/>        },<br/>      },<br/>    });</span></pre><ul class=""><li id="e46e" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">在<code class="du lg lh li lj b">connections</code>对象中，我们只有一个<code class="du lg lh li lj b">default</code>连接。</li><li id="a5fb" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">在这个<code class="du lg lh li lj b">default</code>连接中，我们将<code class="du lg lh li lj b">connector</code>设置为书架。</li><li id="bdf3" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">在<code class="du lg lh li lj b">settings</code>中，我们将<code class="du lg lh li lj b">client</code>设置为<code class="du lg lh li lj b">Postgres</code>。这个客户机是PostgresSQL数据库客户机，用于创建到DB的连接。</li><li id="0dbc" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">host</code>是我们设置为<code class="du lg lh li lj b">localhost</code>的PostgreSQL服务器的主机名。</li><li id="bc91" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">port</code>设置为5432，这是PostgreSQL服务器的默认端口。</li><li id="0ccc" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">name</code>设置为bank，这是我们在PostgreSQL服务器中创建的数据库的名称。</li><li id="cf42" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">password</code>是我们PostgreSQL服务器的密码。</li><li id="2c95" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">username</code>是我们的PostgreSQL的用户名。它被设置为<code class="du lg lh li lj b">Postgres</code>，因为它是我们的PostgreSQL服务器的用户名。</li><li id="4217" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">schema</code>是数据库模式，这里设置为<code class="du lg lh li lj b">public</code>。该模式用于向公众公开数据库。</li></ul><p id="c165" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这样，我们的Strapi使用PostgreSQL来持久化我们的api内容。现在开始斯特拉皮。</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="0590" class="ls ke hi lj b fi lt lu l lv lw">yarn develop</span></pre><p id="c57f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Strapi将在我们的浏览器上加载<code class="du lg lh li lj b">localhost:1337/admin</code>。现在注册并点击<code class="du lg lh li lj b">LET'S START</code>按钮，这将带你到管理面板。</p><h1 id="983a" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">打造我们的收藏</h1><p id="ae59" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">一切准备就绪。我们已经将我们的Strapi应用程序连接到PostgreSQL。现在，我们开始建立我们的收藏。我们正在建立一个银行应用程序，这是一个银行管理应用程序，银行家将使用Strapi管理账户，数据库持久性将是PostgreSQL。</p><p id="c32b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面就把我们银行app的核心功能写出来。</p><ul class=""><li id="aa86" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">可以在应用程序中创建新帐户。</li><li id="1a64" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">可以进行交易，即可以从一个用户向另一个用户汇款。</li></ul><p id="c56b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，我们将有两个模型:帐户和交易。</p><p id="150b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">账户持有银行账户，交易持有已完成的交易。</p><p id="3af8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">客户模型:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="d1a8" class="ls ke hi lj b fi lt lu l lv lw">Account {<br/>        name<br/>        balance<br/>    }</span></pre><p id="4712" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lg lh li lj b">name</code>字段将保存账户持有人的姓名。<code class="du lg lh li lj b">balance</code>将持有账户持有人的美元余额。</p><p id="8a04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">交易模式:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="641d" class="ls ke hi lj b fi lt lu l lv lw">Transact {<br/>        sender<br/>        receiver<br/>        amount<br/>    }</span></pre><p id="f829" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lg lh li lj b">sender</code>字段保存转账账户持有人的姓名。<code class="du lg lh li lj b">receiver</code>是受益者。<code class="du lg lh li lj b">amount</code>是发送方发送给接收方的金额。</p><p id="6709" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我们开始在我们的Strapi管理中创建集合。我们将从<code class="du lg lh li lj b">Account</code>型号开始。</p><p id="2836" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击<code class="du lg lh li lj b">Create First Content Type</code>按钮，输入“账户”作为收款名称。</p><p id="f4cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们为<code class="du lg lh li lj b">account</code>集合添加字段:</p><ul class=""><li id="b3d8" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">点击<code class="du lg lh li lj b">+ Add another field</code>按钮，选择<code class="du lg lh li lj b">Text</code>并输入<code class="du lg lh li lj b">name</code>，然后点击<code class="du lg lh li lj b">+ Add another field</code>按钮添加另一个字段。</li><li id="ea10" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">选择<code class="du lg lh li lj b">Number</code>并在<code class="du lg lh li lj b">Number format</code>上选择<code class="du lg lh li lj b">float (ex. 3.3333333)</code>，然后输入<code class="du lg lh li lj b">balance</code>并点击<code class="du lg lh li lj b">Finish</code>按钮。</li><li id="23cd" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">在出现的<code class="du lg lh li lj b">Account</code>页面上，点击页面右上角的<code class="du lg lh li lj b">Save</code>按钮。</li></ul><p id="dc7c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们生成<code class="du lg lh li lj b">Transact</code>集合:</p><ul class=""><li id="5fac" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">点击<code class="du lg lh li lj b">+ Create new collection type</code>链接，会出现一个模态，输入<code class="du lg lh li lj b">transact</code>。点击<code class="du lg lh li lj b">+ Add another field</code>按钮。</li><li id="9e7c" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">添加字段:<code class="du lg lh li lj b">sender</code>、<code class="du lg lh li lj b">receiver</code>和<code class="du lg lh li lj b">amount</code>。字段<code class="du lg lh li lj b">sender</code>和<code class="du lg lh li lj b">receiver</code>将是<code class="du lg lh li lj b">Text</code>字段，而<code class="du lg lh li lj b">amount</code>将是具有<code class="du lg lh li lj b">float (ex. 3.333333)</code>数字格式的<code class="du lg lh li lj b">Number</code>字段。</li><li id="3a45" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">添加后，点击<code class="du lg lh li lj b">Finish</code>按钮和<code class="du lg lh li lj b">Save</code>按钮。</li></ul><p id="be70" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们已经创建了自己的系列。</p><h1 id="39f4" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">业务逻辑</h1><p id="8fc2" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">我们需要实现我们的业务逻辑。这个业务逻辑将是一个API端点，将资金从发送方转移到接收方。</p><p id="20d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">逻辑是这样的:</p><ul class=""><li id="8edf" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">从寄件人处扣除金额</li><li id="96da" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">将金额添加到接收方</li><li id="31f7" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">添加交易以处理收款</li></ul><p id="8ff7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我希望在<code class="du lg lh li lj b">/transfer</code> API中完成，这是一个POST方法。传输HTTP请求将如下所示:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="1de1" class="ls ke hi lj b fi lt lu l lv lw">http://localhost:1337/transfer<br/>    Method: POST<br/>    Body:<br/>    {<br/>        sender: nnamdi<br/>        receiver: chidme<br/>        amount:  10<br/>    }</span></pre><p id="9fc5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我们看到集合不能处理这个。这是一个单一端点。单一类型不适合我。我通常发现很难从Strapi管理面板创建单个API端点，所以我转到项目源代码来添加它。</p><p id="abef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Strapi项目中的api保存在<code class="du lg lh li lj b">api</code>文件夹中。因此，我们转到我们的<code class="du lg lh li lj b">api</code>文件夹，我们将看到为我们的API创建的文件夹:<code class="du lg lh li lj b">transact</code>和<code class="du lg lh li lj b">account</code>。</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="0bb5" class="ls ke hi lj b fi lt lu l lv lw">strapi-api<br/>        api/<br/>            account/<br/>                config/<br/>                    routes.json<br/>                controllers/<br/>                    account.js<br/>                models/<br/>                services/<br/>            transact/<br/>            ...</span></pre><p id="f366" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lg lh li lj b">routes.json</code>文件包含API中包含的端点。</p><p id="b69d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lg lh li lj b">controllers</code>文件夹包含用户可以用来在API中定制端点的文件。用户可以为一个端点应用他的逻辑。</p><p id="94cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这两件事是我们在创建我们的<code class="du lg lh li lj b">transfer</code> API时所需要的。因此，我们在<code class="du lg lh li lj b">api</code>文件夹中创建一个<code class="du lg lh li lj b">transfer</code>文件夹:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="6847" class="ls ke hi lj b fi lt lu l lv lw">mkdir transfer</span></pre><p id="1eeb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们在<code class="du lg lh li lj b">transfer</code>文件夹中创建<code class="du lg lh li lj b">config</code>和<code class="du lg lh li lj b">controllers</code>文件夹。</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="9330" class="ls ke hi lj b fi lt lu l lv lw">mkdir transfer/config transfer/controllers</span></pre><p id="a62f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<code class="du lg lh li lj b">config</code>文件夹中创建一个<code class="du lg lh li lj b">routes.json</code>文件:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="66cd" class="ls ke hi lj b fi lt lu l lv lw">touch transfer/config/routes.json</span></pre><p id="cd46" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在它里面，我们定义了一个<code class="du lg lh li lj b">/transfer</code>端点和一个POST HTTP方法。然后，我们将让处理程序指向一个将从<code class="du lg lh li lj b">controllers</code>导出的<code class="du lg lh li lj b">index</code>函数。</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="6970" class="ls ke hi lj b fi lt lu l lv lw">{<br/>      "routes": [<br/>        {<br/>          "method": "POST",<br/>          "path": "/transfer",<br/>          "handler": "Transfer.index",<br/>          "config": {<br/>            "policies": []<br/>          }<br/>        }<br/>      ]<br/>    }</span></pre><p id="286d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<code class="du lg lh li lj b">controllers</code>文件夹中创建一个<code class="du lg lh li lj b">transfer</code>文件。</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="70fd" class="ls ke hi lj b fi lt lu l lv lw">touch transfer/controllers/transfer.js</span></pre><p id="a3a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，我们将导出一个<code class="du lg lh li lj b">index</code>函数。这个函数将在发出<code class="du lg lh li lj b">localhost:1337/transfer</code> HTTP请求时被调用。该函数将处理该请求。在这里，我们将应用我们的业务逻辑，从一个帐户向另一个受益人帐户汇款。</p><p id="6f70" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">参见下面的代码:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="87f6" class="ls ke hi lj b fi lt lu l lv lw">// strapi-api/api/transfer/controllers/transfer.js<br/>    <br/>    const { sanitizeEntity } = require("strapi-utils");<br/>    <br/>    module.exports = {<br/>      async index(ctx) {<br/>        const { sender, receiver, amount } = ctx.request.body;<br/>    <br/>        let entity;<br/>    <br/>        // deduct amount from sender<br/>        // add amount to reciver<br/>        // add the transaction to transact<br/>    <br/>        const senderAcc = await strapi.services.account.findOne({<br/>          name: sender,<br/>        });<br/>        const receiverAcc = await strapi.services.account.findOne({<br/>          name: receiver,<br/>        });<br/>    <br/>        senderAcc.balance = parseFloat(senderAcc.balance) - parseFloat(amount);<br/>        receiverAcc.balance = parseFloat(receiverAcc.balance) + parseFloat(amount);<br/>    <br/>        await strapi.services.account.update({ name: sender }, senderAcc);<br/>        await strapi.services.account.update({ name: receiver }, receiverAcc);<br/>        entity = await strapi.services.transact.create({<br/>          sender,<br/>          receiver,<br/>          amount,<br/>        });<br/>        return sanitizeEntity(entity, { model: strapi.models.transact });<br/>      },<br/>    };</span></pre><p id="357d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lg lh li lj b">ctx</code>固定<code class="du lg lh li lj b">res</code>和<code class="du lg lh li lj b">req</code>就像在Expressjs或Koajs中一样。<code class="du lg lh li lj b">ctx</code>是一个包含属性和方法的对象，用于访问传入的消息和响应客户端。</p><p id="086b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">看，我们从<code class="du lg lh li lj b">ctx.request.body</code>中取回了<code class="du lg lh li lj b">sender</code>、<code class="du lg lh li lj b">receiver</code>和<code class="du lg lh li lj b">amount</code>。注意我们有一个strapi对象。是的，它是一个在Strapi项目中是全局的Strapi对象。我们使用对象来访问不同的属性和方法。</p><p id="4650" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里我们用它来访问<code class="du lg lh li lj b">.services</code>对象，它包含了访问数据库的方法。看里面的函数:<code class="du lg lh li lj b">create</code>、<code class="du lg lh li lj b">update</code>、<code class="du lg lh li lj b">find</code>、<code class="du lg lh li lj b">findOne</code>等。它们用于在数据库中创建数据、更新数据库、从数据库中检索值。</p><p id="e384" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，我们检索了发送者的帐户详细信息以及接收者的帐户详细信息。然后，我们进行交易，从发送方的余额中减去<code class="du lg lh li lj b">amount</code>，并添加接收方的余额。</p><p id="2426" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们用新值更新了数据库中发送方和接收方的余额。</p><p id="1928" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，我们在<code class="du lg lh li lj b">transact</code>表中创建了一个新的事务，最后，我们返回新事务的结果。</p><p id="c92a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lg lh li lj b">sanitizeEntity</code>函数从模型及其关系中移除所有私有字段。保存文件，这将重启我们的Strapi服务器。你不会看到<code class="du lg lh li lj b">transfer</code> API出现在管理面板上，它是一个独立的API，而不是一个集合类型。</p><h1 id="ef92" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">允许访问</h1><p id="9081" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">现在，我们将允许访问我们所有的API。</p><p id="1a83" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击侧边栏菜单上的<code class="du lg lh li lj b">Settings</code>项，然后点击出现的第二个侧边栏菜单上的<code class="du lg lh li lj b">Roles</code>项。在右侧部分，点击<code class="du lg lh li lj b">Public</code>项目并向下滚动。您将看到所有的API及其处理程序。点击<code class="du lg lh li lj b">Select all</code>复选框，并点击顶部的<code class="du lg lh li lj b">Save</code>按钮。这将允许公众访问我们的Strapi项目中的所有api:</p><ul class=""><li id="2b6d" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">账户</li><li id="4c42" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">交易</li><li id="65a1" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">转移</li></ul><h1 id="bfcd" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">种子数据</h1><p id="55d7" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">现在，我们播种我们的数据。</p><p id="8c3c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击侧边栏中的<code class="du lg lh li lj b">Accounts</code>。点击<code class="du lg lh li lj b">+ Add New Accounts</code>按钮。</p><p id="11a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">添加数据:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="3f62" class="ls ke hi lj b fi lt lu l lv lw">name -&gt; nnamdi<br/>balance -&gt; 2000000</span></pre><p id="df42" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击<code class="du lg lh li lj b">Save</code>按钮和<code class="du lg lh li lj b">Publish</code>按钮。</p><p id="1e51" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">添加其他数据:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="06cb" class="ls ke hi lj b fi lt lu l lv lw">name -&gt; chidume<br/>balance -&gt; 1000000</span></pre><p id="bcf7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击<code class="du lg lh li lj b">Save</code>按钮和<code class="du lg lh li lj b">Publish</code>按钮。</p><p id="3b99" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">查看我们的PostgreSQL用户界面，内容保存在PostgreSQL上:</p><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/2ac786025ac049ccc6620a13a7e9bdd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_oBcs2q2tSRA09J9.png"/></div></div></figure><h1 id="ad92" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">构建我们的前端—银行管理</h1><p id="9ae9" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">我们的前端将是一个银行管理应用程序。我们将使用Nextjs来构建应用程序。所以我们搭建了我们的项目。</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="7e54" class="ls ke hi lj b fi lt lu l lv lw">yarn create next-app strapi-bank</span></pre><p id="ba90" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的应用程序将有两个页面路径:</p><ul class=""><li id="735c" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated"><code class="du lg lh li lj b">/</code></li><li id="0387" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">/account/[id]</code></li></ul><p id="38ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">索引<code class="du lg lh li lj b">/</code>路径将显示系统上的所有账户。</p><p id="2e2f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lg lh li lj b">/account/[id]</code>路线将显示特定账户的详细信息。这是一个动态的路由，<code class="du lg lh li lj b">id</code>可以容纳任何值，它是动态的，并且它将是一个帐户的唯一id。</p><p id="416f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将有组件:</p><ul class=""><li id="53d8" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated"><code class="du lg lh li lj b">Header</code>:这将呈现标题。</li><li id="4390" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">AccountCard</code>:这个组件将在<code class="du lg lh li lj b">/</code>路径中显示一些账户的详细信息。</li><li id="478c" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">AddAccountDialog</code>:这是一个对话框，呈现我们将用于向系统添加新帐户的UI。</li><li id="d265" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">TransactionDialog</code>:这个对话框显示了将要进行交易的界面，从一个账户向另一个账户汇款。</li><li id="f778" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">TransactionCard</code>:该组件将呈现用户的交易。</li><li id="61f1" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">Accounts</code>:这是<code class="du lg lh li lj b">/</code>页面的页面组件。它显示了银行中的所有账户。</li><li id="fb2b" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du lg lh li lj b">Account</code>:这是<code class="du lg lh li lj b">/account/[id]</code>页面的页面组件。</li></ul><p id="d6b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们最终的应用程序将如下所示:</p><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/362d8f74d1a13097bff797fed638759b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*et-1WhQfIGOnE_LZ.png"/></div></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/2dede4e4039664f009f9ea40f914541b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-DI4sBH7sBsxhfhh.png"/></div></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/dab8a12f1d4b343aef0fe1516affe4c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uOrw06tPGRLOtMsm.png"/></div></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/df2469bad9d9b04f1e33f1e4e41c19fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1Vzk9ogTYQ8rK7uS.png"/></div></div></figure><p id="4837" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好，我们开始创建组件。</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="5c63" class="ls ke hi lj b fi lt lu l lv lw">mkdir components</span><span id="7740" class="ls ke hi lj b fi ly lu l lv lw">mkdir components/TransactionCard<br/>touch components/TransactionCard/index.js<br/>touch components/TransactionCard/TransactionCard.module.css</span><span id="b91b" class="ls ke hi lj b fi ly lu l lv lw">mkdir components/TransactionDialog<br/>touch components/TransactionDialog/index.js</span><span id="b61c" class="ls ke hi lj b fi ly lu l lv lw">mkdir components/AddAccountDialog<br/>touch components/AddAccountDialog/index.js</span><span id="e5ed" class="ls ke hi lj b fi ly lu l lv lw">mkdir components/AccountCard<br/>touch components/AccountCard/index.js<br/>touch components/AccountCard/AccountCard.module.css</span><span id="7042" class="ls ke hi lj b fi ly lu l lv lw">mkdir components/Header<br/>touch components/Header/index.js<br/>touch components/Header/Header.module.css</span><span id="b76e" class="ls ke hi lj b fi ly lu l lv lw">touch styles/AccountView.module.css<br/>mkdir pages/account<br/>touch pages/account/[id].js</span></pre><p id="fe70" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">页眉</p><p id="c0cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将是一个简单的用户界面，它将显示文本<code class="du lg lh li lj b">Bank Admin</code>。将以下代码粘贴在<code class="du lg lh li lj b">components/Header/index.js</code>上:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="b816" class="ls ke hi lj b fi lt lu l lv lw">import { header, headerName } from "./Header.module.css";<br/>    <br/>    export default function Header() {<br/>      return (<br/>        &lt;section className={header}&gt;<br/>          &lt;div className={headerName}&gt;Bank Admin&lt;/div&gt;<br/>        &lt;/section&gt;<br/>      );<br/>    }</span></pre><p id="e6fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">AccountCard这个组件将由<code class="du lg lh li lj b">Accounts</code>组件呈现。它将显示一个帐户的迷你细节。</p><p id="9b3d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将以下代码粘贴到<code class="du lg lh li lj b">components/AccountCard/index.js</code>中:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="d2a4" class="ls ke hi lj b fi lt lu l lv lw">import styles from "./AccountCard.module.css";<br/>    import Link from "next/link";<br/>    <br/>    export default function AccountCard({ account }) {<br/>      const { id, name, balance, created_at } = account;<br/>    <br/>      return (<br/>        &lt;Link href={`account/${id}`}&gt;<br/>          &lt;div className={styles.account}&gt;<br/>            &lt;div className={styles.accountdetails}&gt;<br/>              &lt;div className={styles.accountname}&gt;<br/>                &lt;h3&gt;<br/>                  &lt;span style={{ fontWeight: "100" }}&gt;Account: &lt;/span&gt;<br/>                  {name}<br/>                &lt;/h3&gt;<br/>              &lt;/div&gt;<br/>              &lt;div className={styles.accountbalance}&gt;<br/>                &lt;span&gt;<br/>                  &lt;span style={{ fontWeight: "100" }}&gt;Balance($): &lt;/span&gt;<br/>                  {balance}<br/>                &lt;/span&gt;<br/>              &lt;/div&gt;<br/>              &lt;div className={styles.accountcreated_at}&gt;<br/>                &lt;span&gt;Created: {created_at}&lt;/span&gt;<br/>              &lt;/div&gt;<br/>            &lt;/div&gt;<br/>          &lt;/div&gt;<br/>        &lt;/Link&gt;<br/>      );<br/>    }</span></pre><p id="d624" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它在其<code class="du lg lh li lj b">props</code>参数中接收<code class="du lg lh li lj b">account</code>对象。接下来，我们从<code class="du lg lh li lj b">account</code>对象中析构<code class="du lg lh li lj b">id</code>、<code class="du lg lh li lj b">name</code>、<code class="du lg lh li lj b">balance</code>、<code class="du lg lh li lj b">created_at</code>。是的，<code class="du lg lh li lj b">id</code>和<code class="du lg lh li lj b">created_at</code>是Strapi在每个模型内容中设置的字段。</p><p id="b80d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，<code class="du lg lh li lj b">AccountCard</code>组件呈现细节。</p><p id="c8b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">TransactionCard该组件将呈现传递给它的特定事务。将显示发送的<code class="du lg lh li lj b">sender</code>、<code class="du lg lh li lj b">receiver</code>和<code class="du lg lh li lj b">amount</code>。帐户页面组件呈现该组件以显示帐户用户完成的交易——借方和贷方。</p><p id="126b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将下面的代码粘贴到<code class="du lg lh li lj b">components/TransactionCard/index.js</code>中:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="3fce" class="ls ke hi lj b fi lt lu l lv lw">import styles from "./TransactionCard.module.css";<br/>    <br/>    export default function TransactionCard({ transaction }) {<br/>      const { sender, receiver, amount, created_at } = transaction;<br/>      return (<br/>        &lt;div className={styles.transactionCard}&gt;<br/>          &lt;div className={styles.transactionCardDetails}&gt;<br/>            &lt;div className={styles.transactionCardName}&gt;<br/>              &lt;h4&gt;<br/>                &lt;span&gt;Sender: &lt;/span&gt;<br/>                &lt;span style={{ fontWeight: "bold" }}&gt;{sender}&lt;/span&gt;<br/>              &lt;/h4&gt;<br/>            &lt;/div&gt;<br/>            &lt;div className={styles.transactionCardName}&gt;<br/>              &lt;h4&gt;<br/>                &lt;span&gt;Receiver: &lt;/span&gt;<br/>                &lt;span style={{ fontWeight: "bold" }}&gt;{receiver}&lt;/span&gt;<br/>              &lt;/h4&gt;<br/>            &lt;/div&gt;<br/>            &lt;div className={styles.transactionCardName}&gt;<br/>              &lt;h4&gt;<br/>                &lt;span&gt;Amount($): &lt;/span&gt;<br/>                &lt;span style={{ fontWeight: "bold" }}&gt;{amount}&lt;/span&gt;<br/>              &lt;/h4&gt;<br/>            &lt;/div&gt;<br/>            &lt;div className={styles.transactionCardName}&gt;<br/>              &lt;h4&gt;<br/>                &lt;span&gt;Created At: &lt;/span&gt;<br/>                &lt;span style={{ fontWeight: "bold" }}&gt;{created_at}&lt;/span&gt;<br/>              &lt;/h4&gt;<br/>            &lt;/div&gt;<br/>          &lt;/div&gt;<br/>        &lt;/div&gt;<br/>      );<br/>    }</span></pre><p id="3f09" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它在其props中接收一个<code class="du lg lh li lj b">transaction</code>对象。字段<code class="du lg lh li lj b">sender</code>、<code class="du lg lh li lj b">receiver</code>、<code class="du lg lh li lj b">amount</code>、<code class="du lg lh li lj b">created_at</code>由<code class="du lg lh li lj b">transaction</code>对象析构而来。然后这些由组件呈现。</p><p id="d631" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Accounts该组件在导航索引页面<code class="du lg lh li lj b">/</code>时呈现。该组件将向Strapi后端发出HTTP请求，以检索帐户列表并呈现它们。</p><p id="f88f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将以下代码粘贴到<code class="du lg lh li lj b">pages/index.js</code>上:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="629c" class="ls ke hi lj b fi lt lu l lv lw">import Head from "next/head";<br/>    import styles from "../styles/Home.module.css";<br/>    import Header from "../components/Header";<br/>    import AccountCard from "../components/AccountCard";<br/>    import { useEffect, useState } from "react";<br/>    import axios from "axios";<br/>    import TransactDialog from "../components/TransactDialog";<br/>    import AddAccountDialog from "../components/AddAccountDialog";<br/>    <br/>    export default function Home() {<br/>      const [accounts, setAccounts] = useState([]);<br/>      const [showTransactModal, setShowTransactModal] = useState(false);<br/>      const [showAddAccountModal, setShowAddAccountModal] = useState(false);<br/>    <br/>      useEffect(async () =&gt; {<br/>        const data = await axios.get("http://localhost:1337/accounts");<br/>        setAccounts(data?.data);<br/>      }, []);<br/>    <br/>      return (<br/>        &lt;div className={styles.container}&gt;<br/>          &lt;Head&gt;<br/>            &lt;title&gt;Bank Admin&lt;/title&gt;<br/>            &lt;link rel="icon" href="/favicon.ico" /&gt;<br/>          &lt;/Head&gt;<br/>    <br/>          &lt;main className={styles.main}&gt;<br/>            &lt;div className={styles.breadcrumb}&gt;<br/>              &lt;div&gt;<br/>                &lt;span style={{ margin: "1px" }}&gt;<br/>                  &lt;button onClick={() =&gt; setShowTransactModal(true)}&gt;<br/>                    Transact<br/>                  &lt;/button&gt;<br/>                &lt;/span&gt;<br/>                &lt;span style={{ margin: "1px" }}&gt;<br/>                  &lt;button onClick={() =&gt; setShowAddAccountModal(true)}&gt;<br/>                    Add Account<br/>                  &lt;/button&gt;<br/>                &lt;/span&gt;<br/>              &lt;/div&gt;<br/>            &lt;/div&gt;<br/>    <br/>            &lt;div className={styles.accountcontainer}&gt;<br/>              &lt;div className={styles.youraccounts}&gt;<br/>                &lt;h3&gt;Accounts&lt;/h3&gt;<br/>              &lt;/div&gt;<br/>              &lt;div&gt;<br/>                {accounts.map((account, i) =&gt; (<br/>                  &lt;AccountCard key={i} account={account} /&gt;<br/>                ))}<br/>              &lt;/div&gt;<br/>            &lt;/div&gt;<br/>            {showAddAccountModal ? (<br/>              &lt;AddAccountDialog<br/>                closeModal={() =&gt; setShowAddAccountModal((pV) =&gt; !pV)}<br/>              /&gt;<br/>            ) : null}<br/>            {showTransactModal ? (<br/>              &lt;TransactDialog<br/>                closeModal={() =&gt; setShowTransactModal((pV) =&gt; !pV)}<br/>              /&gt;<br/>            ) : null}<br/>          &lt;/main&gt;<br/>        &lt;/div&gt;<br/>      );<br/>    }</span></pre><p id="4288" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们有三个状态:<code class="du lg lh li lj b">accounts</code>:保存从<code class="du lg lh li lj b">/accounts</code>端点检索的账户的状态。<code class="du lg lh li lj b">showTransactModal</code>:这是一个布尔状态，用于切换<code class="du lg lh li lj b">TransactionModal</code>的可见性。<code class="du lg lh li lj b">showAddAccountModal</code>:这也是一个布尔状态，用于显示和删除<code class="du lg lh li lj b">AddAccountModal</code>。</p><p id="bd45" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lg lh li lj b">useEffect</code>回调调用<code class="du lg lh li lj b">/accounts</code>端点，结果设置为<code class="du lg lh li lj b">accounts</code>状态。</p><p id="aeae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由<code class="du lg lh li lj b">AccountCard</code>组件渲染<code class="du lg lh li lj b">accounts</code>数组和每个账户，每个账户通过其<code class="du lg lh li lj b">account</code>道具传递给<code class="du lg lh li lj b">AccountCard</code>。</p><p id="fd0b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，我们正在有条件地呈现<code class="du lg lh li lj b">AddAccountDialog</code>和<code class="du lg lh li lj b">TransactDialog</code>对话框组件。<code class="du lg lh li lj b">Transact</code>按钮拨动<code class="du lg lh li lj b">TransactDialog</code>按钮，<code class="du lg lh li lj b">Add Account</code>按钮拨动<code class="du lg lh li lj b">AddAccountDialog</code>。</p><p id="099c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，我们通过<code class="du lg lh li lj b">closeModal</code>道具向每个对话框传递一个函数。该函数将使对话框能够从它们的组件中自行关闭。</p><p id="3711" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Account这是在导航<code class="du lg lh li lj b">/account/[id]</code>路线时呈现的页面组件。该组件显示帐户详细信息及其交易。我们也可以从那里删除一个帐户。</p><p id="bb00" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将以下代码粘贴到<code class="du lg lh li lj b">pages/account/[id].js</code>中:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="e307" class="ls ke hi lj b fi lt lu l lv lw">import styles from "../../styles/AccountView.module.css";<br/>    import { useRouter } from "next/router";<br/>    import TransactionCard from "../../components/TransactionCard";<br/>    import axios from "axios";<br/>    import { useEffect, useState } from "react";<br/>    <br/>    export default function Account() {<br/>      const router = useRouter();<br/>      const {<br/>        query: { id },<br/>      } = router;<br/>    <br/>      const [account, setAccount] = useState();<br/>      const [transactions, setTransactions] = useState([]);<br/>      useEffect(async () =&gt; {<br/>        const AccountData = await axios.get("http://localhost:1337/accounts/" + id);<br/>        var transactsData = await axios.get("http://localhost:1337/transacts");<br/>        transactsData = transactsData?.data?.filter(<br/>          (tD) =&gt;<br/>            tD.sender == AccountData?.data?.name ||<br/>            tD.receiver == AccountData?.data?.name<br/>        );<br/>        console.log(transactsData);<br/>        setAccount(AccountData?.data);<br/>        setTransactions(transactsData);<br/>      }, [id]);<br/>    <br/>      async function deleteAccount() {<br/>        if (confirm("Do you really want to delete this account?")) {<br/>          await axios.delete("http://localhost:1337/accounts/" + id);<br/>          router.push("/");<br/>        }<br/>      }<br/>    <br/>      return (<br/>        &lt;div className={styles.accountviewcontainer}&gt;<br/>          &lt;div className={styles.accountviewmain}&gt;<br/>            &lt;div style={{ width: "100%" }}&gt;<br/>              &lt;div className={styles.accountviewname}&gt;<br/>                &lt;h1&gt;{account?.name}&lt;/h1&gt;<br/>              &lt;/div&gt;<br/>              &lt;div className={styles.accountviewminidet}&gt;<br/>                &lt;div&gt;<br/>                  &lt;span style={{ marginRight: "4px", color: "rgb(142 142 142)" }}&gt;<br/>                    Balance($):<br/>                  &lt;/span&gt;<br/>                  &lt;span style={{ fontWeight: "600" }}&gt;{account?.balance}&lt;/span&gt;<br/>                &lt;/div&gt;<br/>                &lt;div style={{ padding: "14px 0" }}&gt;<br/>                  &lt;span&gt;<br/>                    &lt;button onClick={deleteAccount} className="btn-danger"&gt;<br/>                      Delete<br/>                    &lt;/button&gt;<br/>                  &lt;/span&gt;<br/>                &lt;/div&gt;<br/>              &lt;/div&gt;<br/>              &lt;div className={styles.accountviewtransactionscont}&gt;<br/>                &lt;div className={styles.accountviewtransactions}&gt;<br/>                  &lt;h2&gt;Transactions&lt;/h2&gt;<br/>                &lt;/div&gt;<br/>                &lt;div className={styles.accountviewtransactionslist}&gt;<br/>                  {!transactions || transactions?.length &lt;= 0<br/>                    ? "No transactions yet."<br/>                    : transactions?.map((transaction, i) =&gt; (<br/>                        &lt;TransactionCard key={i} transaction={transaction} /&gt;<br/>                      ))}<br/>                &lt;/div&gt;<br/>              &lt;/div&gt;<br/>            &lt;/div&gt;<br/>          &lt;/div&gt;<br/>        &lt;/div&gt;<br/>      );<br/>    }</span></pre><p id="743a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该组件从URL中检索<code class="du lg lh li lj b">id</code>。我们有州<code class="du lg lh li lj b">account</code>和<code class="du lg lh li lj b">transactions</code>，它们分别持有账户和交易。</p><p id="f18a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lg lh li lj b">useEffect</code>钩子回调用<code class="du lg lh li lj b">id</code>值调用<code class="du lg lh li lj b">/accounts/" + id</code>端点，通过它的id获取账户。接下来，它调用<code class="du lg lh li lj b">/transacts</code>端点来检索交易，并过滤掉当前帐户用户进行或接收的交易。结果设置在<code class="du lg lh li lj b">transactions</code>状态，而账户详情设置在<code class="du lg lh li lj b">account</code>状态。</p><p id="8a0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，UI会显示帐户详细信息及其交易。</p><p id="db74" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有一个<code class="du lg lh li lj b">Delete</code>按钮，点击后删除当前账户用户。它通过使用帐户id调用DELETE HTTP方法上的端点<code class="du lg lh li lj b">/accounts/" + id</code>来实现这一点。这使得Strapi删除了帐户。</p><p id="5eaf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个组件是一个对话框，我们用它来添加一个新的帐户。</p><p id="cfe7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将以下代码粘贴到<code class="du lg lh li lj b">components/AddAccountDialog/index.js</code>中:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="ad3f" class="ls ke hi lj b fi lt lu l lv lw">import { useState } from "react";<br/>    import EpisodeCard from "../TransactionCard";<br/>    import axios from "axios";<br/>    <br/>    export default function AddAccountDialog({ closeModal }) {<br/>      const [disable, setDisable] = useState(false);<br/>    <br/>      async function addAccount() {<br/>        setDisable(true);<br/>        const accountName = window.accountName.value;<br/>        const accountBalance = window.accountBalance.value;<br/>    <br/>        // add account<br/>        await axios.post("http://localhost:1337/accounts", {<br/>          name: accountName,<br/>          balance: parseFloat(accountBalance),<br/>        });<br/>        setDisable(false);<br/>        closeModal();<br/>        location.reload();<br/>      }<br/>    <br/>      return (<br/>        &lt;div className="modal"&gt;<br/>          &lt;div className="modal-backdrop" onClick={closeModal}&gt;&lt;/div&gt;<br/>          &lt;div className="modal-content"&gt;<br/>            &lt;div className="modal-header"&gt;<br/>              &lt;h3&gt;Add New Account&lt;/h3&gt;<br/>              &lt;span<br/>                style={{ padding: "10px", cursor: "pointer" }}<br/>                onClick={closeModal}<br/>              &gt;<br/>                X<br/>              &lt;/span&gt;<br/>            &lt;/div&gt;<br/>            &lt;div className="modal-body content"&gt;<br/>              &lt;div style={{ display: "flex", flexWrap: "wrap" }}&gt;<br/>                &lt;div className="inputField"&gt;<br/>                  &lt;div className="label"&gt;<br/>                    &lt;label&gt;Name&lt;/label&gt;<br/>                  &lt;/div&gt;<br/>                  &lt;div&gt;<br/>                    &lt;input id="accountName" type="text" /&gt;<br/>                  &lt;/div&gt;<br/>                &lt;/div&gt;<br/>                &lt;div className="inputField"&gt;<br/>                  &lt;div className="label"&gt;<br/>                    &lt;label&gt;Balance($):&lt;/label&gt;<br/>                  &lt;/div&gt;<br/>                  &lt;div&gt;<br/>                    &lt;input id="accountBalance" type="text" /&gt;<br/>                  &lt;/div&gt;<br/>                &lt;/div&gt;<br/>              &lt;/div&gt;<br/>            &lt;/div&gt;<br/>            &lt;div className="modal-footer"&gt;<br/>              &lt;button<br/>                disabled={disable}<br/>                className="btn-danger"<br/>                onClick={closeModal}<br/>              &gt;<br/>                Cancel<br/>              &lt;/button&gt;<br/>              &lt;button disabled={disable} className="btn" onClick={addAccount}&gt;<br/>                Add Account<br/>              &lt;/button&gt;<br/>            &lt;/div&gt;<br/>          &lt;/div&gt;<br/>        &lt;/div&gt;<br/>      );<br/>    }</span></pre><p id="f021" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们有输入框输入账户名称和它的初始存款余额。点击<code class="du lg lh li lj b">Add Account</code>按钮调用<code class="du lg lh li lj b">addAccount</code>功能。这个函数检索帐户名和余额，并通过POST HTTP使用有效负载:帐户名和余额调用<code class="du lg lh li lj b">/accounts</code>端点。这将使用此有效负载创建一个新帐户。</p><p id="5147" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">TransactionDialog这个组件是我们从一个帐户向另一个帐户汇款的地方。</p><p id="6a1d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将以下代码粘贴到<code class="du lg lh li lj b">components/TransactionDialog/index.js</code>:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="e098" class="ls ke hi lj b fi lt lu l lv lw">import { useState } from "react";<br/>    import TransactionCard from "../TransactionCard";<br/>    import axios from "axios";<br/>    <br/>    export default function TransactDialog({ closeModal }) {<br/>      const [disable, setDisable] = useState(false);<br/>    <br/>      async function transact() {<br/>        setDisable(true);<br/>        const sender = window.sender.value;<br/>        const receiver = window.receiver.value;<br/>        const amount = window.amount.value;<br/>    <br/>        await axios.post("http://localhost:1337/transfer", {<br/>          sender,<br/>          receiver,<br/>          amount,<br/>        });<br/>    <br/>        setDisable(false);<br/>        closeModal();<br/>        location.reload();<br/>      }<br/>    <br/>      return (<br/>        &lt;div className="modal"&gt;<br/>          &lt;div className="modal-backdrop" onClick={closeModal}&gt;&lt;/div&gt;<br/>          &lt;div className="modal-content"&gt;<br/>            &lt;div className="modal-header"&gt;<br/>              &lt;h3&gt;Transaction&lt;/h3&gt;<br/>              &lt;span<br/>                style={{ padding: "10px", cursor: "pointer" }}<br/>                onClick={closeModal}<br/>              &gt;<br/>                X<br/>              &lt;/span&gt;<br/>            &lt;/div&gt;<br/>            &lt;div className="modal-body content"&gt;<br/>              &lt;div style={{ display: "flex", flexWrap: "wrap" }}&gt;<br/>                &lt;div className="inputField"&gt;<br/>                  &lt;div className="label"&gt;<br/>                    &lt;label&gt;Sender&lt;/label&gt;<br/>                  &lt;/div&gt;<br/>                  &lt;div&gt;<br/>                    &lt;input id="sender" type="text" /&gt;<br/>                  &lt;/div&gt;<br/>                &lt;/div&gt;<br/>                &lt;div className="inputField"&gt;<br/>                  &lt;div className="label"&gt;<br/>                    &lt;label&gt;Receiver&lt;/label&gt;<br/>                  &lt;/div&gt;<br/>                  &lt;div&gt;<br/>                    &lt;input id="receiver" type="text" /&gt;<br/>                  &lt;/div&gt;<br/>                &lt;/div&gt;<br/>                &lt;div className="inputField"&gt;<br/>                  &lt;div className="label"&gt;<br/>                    &lt;label&gt;Amount($)&lt;/label&gt;<br/>                  &lt;/div&gt;<br/>                  &lt;div&gt;<br/>                    &lt;input id="number" id="amount" type="text" /&gt;<br/>                  &lt;/div&gt;<br/>                &lt;/div&gt;<br/>              &lt;/div&gt;<br/>            &lt;/div&gt;<br/>            &lt;div className="modal-footer"&gt;<br/>              &lt;button<br/>                disabled={disable}<br/>                className="btn-danger"<br/>                onClick={closeModal}<br/>              &gt;<br/>                Cancel<br/>              &lt;/button&gt;<br/>              &lt;button disabled={disable} className="btn" onClick={transact}&gt;<br/>                Transact<br/>              &lt;/button&gt;<br/>            &lt;/div&gt;<br/>          &lt;/div&gt;<br/>        &lt;/div&gt;<br/>      );<br/>    }</span></pre><p id="e1c9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输入框收集汇款人和收款人的姓名以及汇款金额。</p><p id="c0fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lg lh li lj b">transact</code>功能完成这项工作。它从输入框中检索发送者、接收者和金额值，然后通过HTTP POST调用端点<code class="du lg lh li lj b">/transfer</code>,将发送者、接收者和金额作为有效负载传入。然后<code class="du lg lh li lj b">/transfer</code>端点将<code class="du lg lh li lj b">amount</code>从<code class="du lg lh li lj b">sender</code>转移到<code class="du lg lh li lj b">receiver</code>。</p><p id="a796" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们已经完成了组件的构建，让我们测试一下。</p><h1 id="9c9e" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">试验</h1><p id="1c42" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">添加新帐户</p><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/820b6fec80396b343aac1875220c742f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0vyJ9sACIOF-CVtO.png"/></div></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/b9ca232c2d9afd464e2de71f1c7aa6c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pOK9kPzWyUrOxUAv.png"/></div></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/0cfec8092fc9cfe1d9da7ccd4ff90ecd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lJSKhoOsig78fYa8.png"/></div></div></figure><p id="6063" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">做一些交易</p><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/2dfaa3898e6ab5bacf805d8131da697d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9eDpdKkG3U23TyBr.png"/></div></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/65a95985b69b3600112708403d86d0ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JaNPIX3IiRxGd4rn.png"/></div></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/64c38282dfc5c074b697070ffb3e1b02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vY0Z_aiV20s4CUQO.png"/></div></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/56606f566528ac912ecdeca1921b0964.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TXL-pTO6oDqSeNNk.png"/></div></div></figure><p id="f185" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">删除账户</p><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/86ae4fe76dbd15bc914242c1ec6abad0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bP-tI5sNEWOhEs0X.png"/></div></div></figure><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/6ca10fb7b8e376488f8593f960f7e5c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BuQs66U1dJNfawj6.png"/></div></div></figure><h1 id="b26f" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">源代码</h1><ul class=""><li id="0624" class="jp jq hi is b it lb ix lc jb lz jf ma jj mb jn ju jv jw jx bi translated"><a class="ae jo" href="https://github.com/strapi-prjs/strapi-postgresql-bank" rel="noopener ugc nofollow" target="_blank">前端代码</a></li><li id="e1f0" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><a class="ae jo" href="https://github.com/strapi-prjs/strapi-postgresql-api" rel="noopener ugc nofollow" target="_blank">后端代码</a></li></ul><h1 id="f866" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论</h1><p id="208b" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">斯特拉皮太棒了！太棒了。您可以看到我们是如何将PostgreSQL无缝集成到我们的Strapi项目中的。</p><p id="b750" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们从介绍Strapi和它给软件开发带来的好处开始。后来，我们了解了它用于数据持久性的默认DB。</p><p id="e775" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们介绍了PostgreSQL并展示了在哪里下载和安装它。我们学习了如何配置一个Strapi项目，以使用PostgreSQL作为数据库来存储其应用程序内容。</p><p id="58cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们进一步构建了一个银行应用程序来演示如何在Strapi中最充分地使用PostgreSQL。</p><p id="7025" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">总是考虑在你的项目中使用Strapi。它简单明了，高度可配置。</p></div></div>    
</body>
</html>