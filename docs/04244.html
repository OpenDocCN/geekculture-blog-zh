<html>
<head>
<title>Creating a Azure API Management Instance using Bicep Lang via Azure DevOps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Azure DevOps使用Bicep Lang创建Azure API管理实例</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/creating-a-azure-api-management-instance-using-bicep-lang-via-azure-devops-873d05998e01?source=collection_archive---------11-----------------------#2021-06-23">https://medium.com/geekculture/creating-a-azure-api-management-instance-using-bicep-lang-via-azure-devops-873d05998e01?source=collection_archive---------11-----------------------#2021-06-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e9538375eb341a556291628f92ca17d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*izEnKRTBWhO3fHaO.png"/></div></div></figure><h1 id="f220" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">介绍</h1><p id="190d" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我越用二头肌，我就越喜欢它。这就是ARM模板应该有的样子。说到IaC，我一般用Terraform。这是我上次演出时使用的IaC工具，我喜欢它支持多种云。</p><p id="80b4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">然而，我最近换了工作，我发现我越来越多地使用ARM模板。考虑到这一点，我一直想学习二头肌并在我自己的个人项目中使用它，所以当有一天我必须将ARM模板转换为二头肌代码时，我会做好准备😂</p><p id="d4eb" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">回到本文，我正在开发一个个人健康应用程序，它有一堆与我的数据交互的API(使用Azure Functions ⚡构建)。理想情况下，我希望将它集成到Azure API管理中。我使用Azure DevOps部署这些API，因此为了保持一致，我希望通过Azure DevOps使用IaC部署APIM。</p><p id="9ae7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我将向您展示我们如何使用Bicep代码提供Azure API管理实例，然后使用Azure DevOps部署它。</p><p id="9777" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在我们开始之前要注意的一件事是，在撰写本文时，Azure DevOps中还没有官方支持的Bicep任务。对于Terraform和ARM模板，我们可以使用DevOps中的任务来部署我们的基础架构。对于本文，我使用了一些AZ CLI任务来构建和部署我的Bicep模板。</p><p id="17ae" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">因此，如果你在将来读到这篇文章，我们可以在DevOps中使用官方支持的二头肌任务，请记住这一点😊</p><h1 id="0cf0" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是二头肌郎？</h1><p id="d5d9" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">Bicep是一种特定于领域的语言，它使用声明性语法来部署Azure资源。当我们编写ARM模板时，我们本质上是在编写JSON来将资源部署到Azure。这种方法的语法可能会有点复杂，对于复杂的东西，我们需要编写复杂的表达式才能让它工作。</p><p id="d8b6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">二头肌长头训练显著降低了复杂性。Bicep是对ARM模板的透明抽象，当我们部署Bicep模板时，它附带了一个CLI，可以将Bicep文件转换为ARM模板JSON。</p><p id="b2c0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">从v0.3开始，Bicep受到微软的支持，并且与ARM模板100%对等，这意味着您可以开始将它用于生产工作负载！</p><p id="ae4f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果你想了解更多关于二头肌的知识，你可以查看这里的文档:</p><div class="kr ks ez fb kt ku"><a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">Bicep文档</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">了解如何开发Bicep文件并使用它们来部署Azure资源</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">docs.microsoft.com</p></div></div><div class="ld l"><div class="le l lf lg lh ld li io ku"/></div></div></a></div><h1 id="f58e" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是API管理</h1><p id="807d" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">API管理(APIM)允许我们为后端服务创建一致的API网关。使用APIM，我们可以发布API并让外部和内部开发人员使用。</p><p id="1fb1" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">APIM由以下几部分组成:</p><ul class=""><li id="5ad8" class="lj lk hi jq b jr km jv kn jz ll kd lm kh ln kl lo lp lq lr bi translated"><strong class="jq hj">网关</strong>是接受API调用并将它们路由到正确后端的端点，验证API密钥，强制执行使用配额和速率限制等。</li><li id="e05d" class="lj lk hi jq b jr ls jv lt jz lu kd lv kh lw kl lo lp lq lr bi translated"><strong class="jq hj">Azure门户</strong>允许管理我们的API程序，定义API模式，将API打包到产品中，设置策略等。</li><li id="a310" class="lj lk hi jq b jr ls jv lt jz lu kd lv kh lw kl lo lp lq lr bi translated"><strong class="jq hj">开发者门户</strong>作为开发者的主要网站，为他们提供API文档，允许他们通过交互式控制台试用API，并创建一个可以用来订阅API的帐户。</li></ul><p id="57fe" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果您想更深入地了解APIM，请查阅相关文档:</p><div class="kr ks ez fb kt ku"><a href="https://docs.microsoft.com/en-us/azure/api-management/" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">API管理文档</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">了解如何使用API管理安全、大规模地向外部、合作伙伴和员工开发人员发布API…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">docs.microsoft.com</p></div></div><div class="ld l"><div class="lx l lf lg lh ld li io ku"/></div></div></a></div><h1 id="5823" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">为API管理编写Bicep代码</h1><p id="ee4c" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">让我们开始编写二头肌代码吧！💪编写Bicep代码最好的工具是Visual Studio代码。还有一个很棒的扩展可以下载，它将帮助验证你的Bicep代码并提供智能感知:<a class="ae ly" href="https://github.com/Azure/bicep/blob/main/docs/installing.md#install-the-bicep-vs-code-extension" rel="noopener ugc nofollow" target="_blank">https://github . com/Azure/Bicep/blob/main/docs/installing . MD # install-the-Bicep-vs-code-extension</a></p><p id="9cb0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在本教程中，我不会过多关注APIM复杂的一面。我只想提供一个简单的配置来开始。</p><p id="5b38" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">根据我从文件中看到的，看起来我需要以下属性:</p><ul class=""><li id="b43c" class="lj lk hi jq b jr km jv kn jz ll kd lm kh ln kl lo lp lq lr bi translated"><strong class="jq hj">名称</strong>(APIM服务的名称)</li><li id="8d39" class="lj lk hi jq b jr ls jv lt jz lu kd lv kh lw kl lo lp lq lr bi translated"><strong class="jq hj"> Type </strong>(我们将提供的资源类型)</li><li id="7e0f" class="lj lk hi jq b jr ls jv lt jz lu kd lv kh lw kl lo lp lq lr bi translated"><strong class="jq hj"> ApiVersion </strong>(我们将使用的ARM API的版本)</li><li id="ebd1" class="lj lk hi jq b jr ls jv lt jz lu kd lv kh lw kl lo lp lq lr bi translated"><strong class="jq hj">属性</strong>(我们要配置的APIM的属性，主要是发布者邮箱和名称)</li><li id="ff7a" class="lj lk hi jq b jr ls jv lt jz lu kd lv kh lw kl lo lp lq lr bi translated"><strong class="jq hj">位置</strong>(我们将在这里提供我们的APIM实例)</li><li id="1cc1" class="lj lk hi jq b jr ls jv lt jz lu kd lv kh lw kl lo lp lq lr bi translated"><strong class="jq hj"> SKU </strong>(我们APIM实例的SKU属性)</li></ul><p id="2e93" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">你可以在这里看到APIM模板的完整参考:</p><div class="kr ks ez fb kt ku"><a href="https://docs.microsoft.com/en-us/azure/templates/microsoft.apimanagement/2019-01-01/service?tabs=bicep" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">微软。API management/service 2019-01-01-ARM模板参考</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">要创建Microsoft.ApiManagement/service资源，请将以下JSON添加到模板的resources部分。</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">docs.microsoft.com</p></div></div><div class="ld l"><div class="lz l lf lg lh ld li io ku"/></div></div></a></div><p id="180e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">记住上述属性，我们可以编写以下二头肌代码:</p><pre class="ma mb mc md fd me mf mg mh aw mi bi"><span id="2c7e" class="mj ir hi mf b fi mk ml l mm mn">param apimName string<br/>param apimLocation string<br/>param publisherName string<br/>param publisherEmail string<br/><br/>resource myhealthapim 'Microsoft.ApiManagement/service@2019-12-01' = {<br/>  name: apimName<br/>  location: apimLocation<br/>  sku: {<br/>    name: 'Developer'<br/>    capacity: 1<br/>  }<br/>  properties: {<br/>    publisherEmail: publisherEmail<br/>    publisherName: publisherName<br/>  }<br/>}</span></pre><p id="e88d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如您所见，我已经为我的APIM实例的一些配置值使用了一些参数。我们来讨论一下二头肌中的这些是什么。</p><h1 id="cab7" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">使用参数</h1><p id="020f" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在Bicep中，当我们部署Bicep模板时，我们可以使用参数向它们提供信息。这使得我们可以重用我们的二头肌模板。</p><p id="2632" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在上面的代码中，我们使用关键字<strong class="jq hj"> param </strong>声明了我们的参数。这里有一个例子:</p><pre class="ma mb mc md fd me mf mg mh aw mi bi"><span id="5b65" class="mj ir hi mf b fi mk ml l mm mn">param parameterName string</span></pre><ul class=""><li id="065c" class="lj lk hi jq b jr km jv kn jz ll kd lm kh ln kl lo lp lq lr bi translated">param —向Bicep表明我们正在使用一个参数</li><li id="3877" class="lj lk hi jq b jr ls jv lt jz lu kd lv kh lw kl lo lp lq lr bi translated">parameterName —我们的参数的名称</li><li id="5615" class="lj lk hi jq b jr ls jv lt jz lu kd lv kh lw kl lo lp lq lr bi translated">字符串-指参数的类型</li></ul><p id="befa" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们可以通过文件提供参数。使用JSON创建参数文件。如果我们将资源部署到多个环境，我们可以为每个环境创建一个参数文件，并根据环境提供不同的值。</p><p id="5362" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">对于本教程，我已经创建了以下文件。</p><pre class="ma mb mc md fd me mf mg mh aw mi bi"><span id="e01a" class="mj ir hi mf b fi mk ml l mm mn">{<br/>    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",<br/>    "contentVersion": "1.0.0.0",<br/>    "parameters": {<br/>        "apimName": {<br/>            "value": "myhealthapiportal"<br/>        },<br/>        "apimLocation": {<br/>            "value": "australiaeast"<br/>        },<br/>        "publisherName": {<br/>            "value": "MyHealth API Portal"<br/>        },<br/>        "publisherEmail": {<br/>            "value": "willvelida@hotmail.co.uk"<br/>        }<br/>    }<br/>}</span></pre><p id="a635" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果你想学习如何在二头肌参数，看看这个学习课程:</p><div class="kr ks ez fb kt ku"><a href="https://docs.microsoft.com/en-us/learn/modules/build-reusable-bicep-templates-parameters/2-understand-parameters" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">了解参数-学习</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">通过参数，您可以在部署时向Bicep模板提供信息。可以做个二头肌模板…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">docs.microsoft.com</p></div></div><div class="ld l"><div class="mo l lf lg lh ld li io ku"/></div></div></a></div><h1 id="ca41" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">为Azure DevOps创建服务连接</h1><p id="0adb" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">为了部署我们的Bicep模板，我们需要DevOps中的一个服务连接，它被授权向Azure部署资源。</p><p id="952d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果您需要进行设置，请查阅以下文档:</p><div class="kr ks ez fb kt ku"><a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/library/service-endpoints?view=azure-devops&amp;tabs=yaml#create-a-service-connection" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">Azure管道中的服务连接- Azure管道</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">注在Microsoft Team Foundation Server(TFS)2018和以前的版本中，生成和发布管道称为…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">docs.microsoft.com</p></div></div><div class="ld l"><div class="mp l lf lg lh ld li io ku"/></div></div></a></div><h1 id="ed79" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">创建和运行我们的发布渠道</h1><p id="13dd" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">现在我有了我的Bicep模板和参数文件，我们可以开始创建我们的发布管道了。</p><p id="71dd" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我有点搬起石头砸了自己的脚。我有一个超级repo，用于我编写的所有IaC代码，以将资源部署到Azure。因此，对于本教程，我将使用经典的发布管道，而不是YAML。</p><p id="5e57" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">对于这个版本，我使用了以下任务:</p><figure class="ma mb mc md fd ij er es paragraph-image"><div class="er es mq"><img src="../Images/70d89266f756c7ff5053ff18fbcf8260.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/0*af14xnmcngvO2N3t.png"/></div></figure><p id="ae77" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">让我们完成每项任务。</p><p id="53e7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">对于我们的复制文件任务，我只是将文件从GitHub工件复制到构建代理的默认工作目录中。</p><figure class="ma mb mc md fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/52a00d0780119579b0968be9c9bba0d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jrIxcIDx4RgnBMlB.png"/></div></div></figure><p id="fc64" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们将使用目标目录中的文件来运行Bicep命令。</p><p id="aec4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">让我们来看看我们的第一个Azure CLI任务:</p><figure class="ma mb mc md fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/120d05b0647eae0b691ee178a7fe48f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6JENUq6ieqZ2IWuL.png"/></div></div></figure><p id="f610" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这里，我们正在运行以下az cli命令:</p><pre class="ma mb mc md fd me mf mg mh aw mi bi"><span id="b579" class="mj ir hi mf b fi mk ml l mm mn">az bicep build --file "$env:SYSTEM_DEFAULTWORKINGDIRECTORY/main.bicep"</span></pre><p id="feeb" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在这里，我们正在建立我们的二头肌文件。我们可以这样做来构建由bicep文件创建的ARM模板，它可以用于运行自动化测试，或者用于将它添加到模板规范中，模板规范可以与我们团队中的其他用户共享。</p><p id="bb24" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">为了在命令中引用我们的构建文件，我使用我们的系统默认工作目录作为环境。这是我们之前复制文件的文件夹。我们可以访问发布管道中的变量，以便在整个发布管道中传输和交换数据:</p><div class="kr ks ez fb kt ku"><a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/release/variables?view=azure-devops&amp;tabs=batch#default-variables" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">经典版本和工件变量——Azure管道</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">注在Microsoft Team Foundation Server(TFS)2018和以前的版本中，生成和发布管道称为…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">docs.microsoft.com</p></div></div><div class="ld l"><div class="mr l lf lg lh ld li io ku"/></div></div></a></div><p id="43e0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在让我们进入最后一项任务，我们将部署我们的二头肌模板:</p><figure class="ma mb mc md fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a98a33231f11705a330bdbaeabff1dc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GMTgmTxMrGKPWBNB.png"/></div></div></figure><p id="611c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在此AZ CLI任务中，我们将运行以下命令:</p><pre class="ma mb mc md fd me mf mg mh aw mi bi"><span id="1fc9" class="mj ir hi mf b fi mk ml l mm mn">az group create -l australiaeast -n myhealthapiportal-rg<br/>az deployment group create --template-file "$env:SYSTEM_DEFAULTWORKINGDIRECTORY/main.bicep" --parameters "$env:SYSTEM_DEFAULTWORKINGDIRECTORY/main.parameters.json" --resource-group myhealthapiportal-rg</span></pre><p id="4be7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在我们的第一个命令中，我们在Azure中创建了一个名为myhealthapiportal-rg的资源组来部署我们的APIM实例。</p><p id="c0e4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在我们的第二个命令中，我们在订阅范围内创建一个部署，使用main.bicep文件作为我们想要部署的模板，使用main.parameters.json文件作为我们将用于这个部署的参数。我还对我之前创建的资源组进行了硬编码，我希望将我们的APIM资源部署到该资源组。</p><p id="6571" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">设置好这些之后，我们现在可以运行我们的发布管道，它应该会将我们的APIM实例部署到Azure</p><figure class="ma mb mc md fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5d3fd07a30e50fcd7a3cbfb28b39c6da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XHxLU8K5q62TK10V.png"/></div></div></figure><p id="67ab" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">验证我们是否部署到Azure:</p><figure class="ma mb mc md fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6138fbd795b53311639d4af33d7a075c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uowZIUvsqHwgopoy.png"/></div></div></figure><p id="9a91" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这花了我很多时间，主要是摆弄AZ CLI命令，让它们指向我们的文件。</p><p id="5d1e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">另一件需要注意的事情是，我第一次成功部署了APIM，但是部署任务花了一个多小时还是失败了，尽管当我进入我的Azure门户时部署是成功的。</p><h1 id="c9c0" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">想了解更多？</h1><p id="9598" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">感谢阅读这篇文章。在撰写本文时，Azure DevOps中还没有Bicep的官方任务，所以我在这里做的事情有点麻烦，但很有效。</p><p id="5060" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果你想了解更多关于肱二头肌的知识，我推荐你从微软学习网站查看以下资源:</p><div class="kr ks ez fb kt ku"><a href="https://docs.microsoft.com/en-us/learn/modules/introduction-to-infrastructure-as-code-using-bicep/" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">使用Bicep - Learn介绍作为代码的基础设施</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">描述使用基础设施作为代码、Azure资源管理器和Bicep的好处，以便快速、自信地…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">docs.microsoft.com</p></div></div><div class="ld l"><div class="ms l lf lg lh ld li io ku"/></div></div></a></div><div class="kr ks ez fb kt ku"><a href="https://docs.microsoft.com/en-us/learn/modules/deploy-azure-resources-by-using-bicep-templates/" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">建立你的第一个二头肌模板-学习</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">在Bicep模板中定义Azure资源。提高部署的一致性和可靠性，减少…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">docs.microsoft.com</p></div></div><div class="ld l"><div class="mt l lf lg lh ld li io ku"/></div></div></a></div><div class="kr ks ez fb kt ku"><a href="https://docs.microsoft.com/en-us/learn/modules/build-reusable-bicep-templates-parameters/" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">使用参数学习建立可重复使用的二头肌模板</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">本模块描述了如何在每次部署期间使用Bicep参数为模板提供信息…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">docs.microsoft.com</p></div></div><div class="ld l"><div class="mu l lf lg lh ld li io ku"/></div></div></a></div><div class="kr ks ez fb kt ku"><a href="https://docs.microsoft.com/en-us/learn/modules/build-flexible-bicep-templates-conditions-loops/" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">使用条件和循环构建灵活的二头肌模板-学习</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">了解如何仅在存在特定约束的情况下使用条件来部署资源。还要学习如何使用…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">docs.microsoft.com</p></div></div><div class="ld l"><div class="mv l lf lg lh ld li io ku"/></div></div></a></div><div class="kr ks ez fb kt ku"><a href="https://docs.microsoft.com/en-us/learn/modules/child-extension-bicep-templates/" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">使用Bicep - Learn部署子资源和扩展资源</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">这个模块展示了如何在Bicep代码中部署各种Azure资源。了解孩子和扩展…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">docs.microsoft.com</p></div></div><div class="ld l"><div class="mw l lf lg lh ld li io ku"/></div></div></a></div><div class="kr ks ez fb kt ku"><a href="https://docs.microsoft.com/en-us/learn/modules/deploy-resources-scopes-bicep/" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">使用Bicep - Learn将资源部署到订阅、管理组和租户</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">在订阅、管理组和租户范围部署Azure资源。了解这些资源是什么，为什么您…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">docs.microsoft.com</p></div></div><div class="ld l"><div class="mx l lf lg lh ld li io ku"/></div></div></a></div><p id="3ee8" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">编码快乐！👩‍💻👨‍💻</p></div></div>    
</body>
</html>