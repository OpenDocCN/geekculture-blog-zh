<html>
<head>
<title>Headless WooCommerce &amp; Next.js: Set up Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Headless WooCommerce &amp; Next.js:设置Next.js</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/headless-woocommerce-next-js-set-up-next-js-b8d2193b2688?source=collection_archive---------0-----------------------#2021-07-30">https://medium.com/geekculture/headless-woocommerce-next-js-set-up-next-js-b8d2193b2688?source=collection_archive---------0-----------------------#2021-07-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d23bc443ee07c3dc44ce6557276c1bf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O2aJdgQ1TJGo85G2"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@dnevozhai?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Denys Nevozhai</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a989" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我选择在这个项目中使用Next.js，因为它是一个静态站点生成器，也使得处理后端功能变得容易。</p><p id="eb25" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">默认情况下，Next.js会预先渲染每个页面以生成HTML，从而获得更好的性能和SEO。Next.js建议在预渲染时使用静态生成，以便在构建时生成HTML，并在每个请求中重用。</p><p id="1229" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当获取数据时，我们可以使用<code class="du jt ju jv jw b">getStaticProps</code>,它在构建时获取数据，如果数据在用户请求之前可用，可以提高性能。我的产品<em class="jx">在构建时就有</em>可用，但是如果我以后更改了任何细节，该怎么办？<code class="du jt ju jv jw b">getStaticProps</code>的巧妙之处在于它不是完全静态的——它有一个<code class="du jt ju jv jw b">revalidate</code>特性，允许在预定的时间后重新生成页面。重新生成在后台进行，一旦可用，将提供包含新数据的新页面。</p><h1 id="74cf" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">设置您的Next.js项目</h1><p id="2ba6" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated">在创建我的Next.js项目时，我选择了使用TypeScript，但是你可以选择你喜欢的。我也使用纱线，但你同样可以使用npm。</p><pre class="lb lc ld le fd lf jw lg lh aw li bi"><span id="114a" class="lj jz hi jw b fi lk ll l lm ln">yarn create next-app woocommerce-nextjs --typescript</span><span id="5855" class="lj jz hi jw b fi lo ll l lm ln">npx create-next-app woocommerce-nextjs --ts</span></pre><p id="911c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我最近学习了TypeScript，并试图在我的项目中使用它来熟悉它。有一个由Academind 制作的很好的<a class="ae iu" href="https://www.youtube.com/watch?v=BwuLxPH8IDs" rel="noopener ugc nofollow" target="_blank"> YouTube视频，从初学者的角度给出了一个很好的概述。TypeScript有助于您在开发代码时避免大多数运行时错误，这在您与团队合作时尤其有用，这样其他开发人员就可以明确地了解他们需要使用什么类型，并依靠他们的IDE来标记出现的错误。</a></p><p id="4f14" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦设置好，你就可以运行<code class="du jt ju jv jw b">yarn dev</code>或<code class="du jt ju jv jw b">npm run start</code>来启动你的本地开发服务器，并在<code class="du jt ju jv jw b">localhost:3000</code>看到你的网站。您将看到默认的Next.js欢迎屏幕。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/ece7e5624a52c52f6e9d7a9237d44430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0de0uRljgM2ZRT6CMThbFw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Screenshot of default Next.js welcome screen</figcaption></figure><h1 id="af56" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">从WooCommerce获取产品</h1><p id="b8cc" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated">我们可以也可能应该用虚拟数据设计一些前端组件，然后用动态数据替换。但是，我将直接开始获取数据，这样您就可以看到它是如何完成的，然后在自己实现数据获取之前，可以尽情地进行自己的前端设计。</p><p id="e99f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">创建一个获取函数</strong></p><p id="1900" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在上一篇文章中，我指出了WooCommerce REST API认证对于HTTP (OAuth 1.0a)和HTTP <strong class="ix hj"> S </strong> (Bearer Auth)是不同的。我们在本地Wordpress站点使用HTTP，所以我们需要OAuth 1.0a认证。</p><p id="f211" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最初，我使用<code class="du jt ju jv jw b">oauth-1.0a</code>、<code class="du jt ju jv jw b">crypto</code>和<code class="du jt ju jv jw b">axios</code>库进行API调用，但是WooCommerce有一个官方的JavaScript库<a class="ae iu" href="https://www.npmjs.com/package/@woocommerce/woocommerce-rest-api" rel="noopener ugc nofollow" target="_blank">所以我想尝试使用这个。</a></p><pre class="lb lc ld le fd lf jw lg lh aw li bi"><span id="15d4" class="lj jz hi jw b fi lk ll l lm ln">yarn add @woocommerce/woocommerce-rest-api --dev</span><span id="2dbb" class="lj jz hi jw b fi lo ll l lm ln">npm install --save @woocommerce/woocommerce-rest-api</span></pre><p id="01bd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个包没有自己的类型定义——您可以从DefinitelyTyped资源中获得社区创建的类型。</p><pre class="lb lc ld le fd lf jw lg lh aw li bi"><span id="16be" class="lj jz hi jw b fi lk ll l lm ln">yarn add @types/woocommerce__woocommerce-rest-api --dev</span><span id="70a6" class="lj jz hi jw b fi lo ll l lm ln">npm install --save @types/woocommerce__woocommerce-rest-api</span></pre><p id="d2a3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们需要做的第一件事是创建一个从WooCommerce获取产品的函数。我在根结构中创建了一个<code class="du jt ju jv jw b">utils</code>文件夹，并在那里创建了一个文件<code class="du jt ju jv jw b">wooCommerceApi.ts</code>来保存我的函数。</p><figure class="lb lc ld le fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="79ca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你会看到我们需要用密钥凭证初始化<code class="du jt ju jv jw b">WooCommerceRestApi</code>。如果你记得的话，你已经从WooCommerce设置中获得了消费者密钥和秘密。我想保持密钥和秘密的私密性，避免被人窥探，所以我使用了环境变量。</p><p id="7d86" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意:对于Next.js，除非添加前缀<code class="du jt ju jv jw b">NEXT_PUBLIC_</code>，否则环境变量只在服务器端可用。添加<code class="du jt ju jv jw b">NEXT_PUBLIC_</code>(例如<code class="du jt ju jv jw b">NEXT_PUBLIC_WOOCOMMERCE_KEY</code>)会将这个环境变量暴露给浏览器，这样您就可以在客户端使用它。然而，暴露给浏览器的环境变量仍然可以被知道如何将秘密留给环境更安全的服务器端的人检索到。</p><p id="cca0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意:在上面的要点中，我在环境变量的末尾使用了感叹号，只是为了解决一个类型错误，即当必须传递一个字符串时，可能会出现空值。感叹号表示肯定会有值。</p><p id="9cda" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">取产品</strong></p><p id="c845" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们有了一个函数来获取我们需要使用的产品！对于这个例子，我们可以使用<code class="du jt ju jv jw b">index.tsx</code>页面，我们现在只想看到产品的控制台日志。</p><p id="f5a2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我在介绍中提到了<code class="du jt ju jv jw b">getStaticProps</code>，这正是我们将要使用的。我们在<code class="du jt ju jv jw b">getStaticProps</code>函数(Next.js特有的)中进行数据提取，这样提取在构建时进行，结果是一个更快的网站，因为它是预渲染的。</p><p id="2c03" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">看一下<a class="ae iu" href="https://nextjs.org/docs/basic-features/data-fetching" rel="noopener ugc nofollow" target="_blank"> Next.js开发人员文档</a>，了解更多关于它如何处理数据获取的信息。我不会深究它，但您会在下面的要点中看到，我们的数据获取的响应是作为一个对象返回的，这在功能组件本身的props中变得可用。</p><p id="9854" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du jt ju jv jw b">return ()</code>中的一切都只是Next.js附带的样板代码，是欢迎屏幕。现在这些都没有必要。我们对<code class="du jt ju jv jw b">getStaticProps</code>感兴趣。</p><figure class="lb lc ld le fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="7a93" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你使用的是普通的JavaScript而不是TypeScript，那么你应该能够看到你在WooCommerce中添加的产品的控制台日志。</p><p id="8934" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">那些关注我的教程的人会注意到，我已经为Props声明了类型接口，并在那里传递了产品的自定义类型定义。你可以通过<code class="du jt ju jv jw b">any[]</code>，那会工作得很好，但我想我会试着正确地做它，我在rrrhys 的这个<a class="ae iu" href="https://github.com/rrrhys/wootoapp-rewrite/blob/master/app/types/woocommerce.d.ts" rel="noopener ugc nofollow" target="_blank"> GitHub repo中找到了WooCommerce产品对象的类型定义，我使用了它，并通过与</a><a class="ae iu" href="https://woocommerce.github.io/woocommerce-rest-api-docs/?javascript#product-properties" rel="noopener ugc nofollow" target="_blank"> WooCommerce开发人员文档</a>的交叉引用对它进行了轻微的更新。</p><p id="cd44" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我把它放在我在<code class="du jt ju jv jw b">utils</code>文件夹中创建的一个<code class="du jt ju jv jw b">wooCommerceTypes.ts</code>文件中。这些都在下面的要点里，但是它很长，可能会让人害怕。</p><p id="1700" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在并不是所有的都相关，但是大部分有用的类型都在那里，所以都在里面。如果你花点时间梳理每个界面，你会发现它们只是简单地描述了对象和我们所期望的(例如账单地址、订单)。</p><p id="9894" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们把这篇文章留在这里，这样在这篇<em class="jx">长</em>要点之后就没有其他重要的东西了。</p><figure class="lb lc ld le fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure></div><div class="ab cl ls lt gp lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hb hc hd he hf"><p id="86ef" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-create-a-local-wordpress-with-woocommerce-4411b24a160e" rel="noopener">第1部分:用WooCommerce创建一个本地WordPress】</a></p><p id="f895" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-set-up-woocommerce-test-with-postman-5e7859c65626" rel="noopener">第2部分:设置WooCommerce &amp;测试与邮递员</a></p><p id="ad3a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-set-up-next-js-b8d2193b2688" rel="noopener">第3部分:设置Next.js </a></p><p id="b99d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-set-up-styled-components-with-typescript-and-next-js-18cc047ccd79" rel="noopener">第4部分:用TypeScript和Next.js设置样式组件</a></p><p id="9883" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-display-products-and-create-orders-593a6c5aee86" rel="noopener">第五部分:展示产品并创建订单</a></p><p id="e794" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-set-up-redux-toolkit-for-state-management-c605adda58fe" rel="noopener">第六部分:建立Redux状态管理工具包</a></p><p id="907f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-create-a-cart-8a3e49b90076" rel="noopener">第7部分:创建购物车</a></p><p id="2804" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-set-up-stripe-and-create-checkout-d01333607a66" rel="noopener">第8部分:设置条带并创建检验</a></p></div></div>    
</body>
</html>