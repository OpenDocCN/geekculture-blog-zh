<html>
<head>
<title>Machine Learning Model inside a Docker Container</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Docker容器中的机器学习模型</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/machine-learning-model-inside-a-docker-container-1bf7c7076a0c?source=collection_archive---------30-----------------------#2021-05-27">https://medium.com/geekculture/machine-learning-model-inside-a-docker-container-1bf7c7076a0c?source=collection_archive---------30-----------------------#2021-05-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="aedd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自过去十年以来，人们比以往任何时候都更需要整合不同领域的技术。这些集成了来自多个领域的技术的领域需求很大，因为它们为公司的软件/服务生产流水线提供了灵活性。这种杂交域的例子有DevOps、MLOps等。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/f211b28f6569de1a53bab01213a66201.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*gqOD2OfJSc6vS4jf2SSPkg.png"/></div></figure><p id="ef7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文将讨论一个MLOps域的最基本功能的例子。我们将在Docker容器中部署我们的机器学习模型。我们将使用Red Hat Linux 8作为docker主机，使用Centos的映像作为Docker映像。</p><p id="a5f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Docker 使开发人员能够将应用程序(在我们的例子中，是一个机器学习预测器脚本)打包到容器中——标准化的可执行组件，这些组件将源代码与在任何环境中运行代码所需的所有操作系统(OS)库和依赖项相结合。简而言之，我们将能够在一个单独的操作系统中运行一个机器学习代码，只需要满足我们的脚本执行所需的要求。</p><h1 id="092c" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">让我们开始这个项目吧</h1><h2 id="ff09" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">创建项目目录</h2><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="1985" class="kj jm hi ky b fi lc ld l le lf">$ mkdir profit_predict/</span></pre><h2 id="f842" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">获取python脚本和所需的文件</h2><p id="7297" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我准备了一个python脚本，将用于预测。该模型预测了创业公司的利润，考虑了“R&amp;D支出”、“管理支出”、“营销支出”、“国家支出”等因素。这是一个回归任务。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="d119" class="kj jm hi ky b fi lc ld l le lf">$ cat profit_predict/profit_predict.py</span><span id="1236" class="kj jm hi ky b fi ll ld l le lf">#!/usr/bin/python3</span><span id="97b8" class="kj jm hi ky b fi ll ld l le lf">import joblib<br/>import pandas as pd</span><span id="2785" class="kj jm hi ky b fi ll ld l le lf">model = joblib.load('profit.pkl')<br/>ohe = joblib.load('state_ohe.pkl')</span><span id="b5ef" class="kj jm hi ky b fi ll ld l le lf">class Profit:<br/>      <br/>    def __init__(self,data):<br/>        self.data = data<br/>        <br/>    def predict(self):<br/>        d_data = ohe.transform(data)<br/>        predict = model.predict(d_data)[0]<br/>        print(f"This approximate profit made by the startup is: ${predict}\n")<br/>                <br/>if __name__ == "__main__":<br/>    print("************************")<br/>    print("Statup Profit Calculator")<br/>    print("************************\n\n")<br/>    rnd = float(input('Enter Rnd Cost: '))<br/>    admin = float(input('Enter Administation Cost: '))<br/>    market = float(input('Enter Marketing Spend: '))<br/>    city = input('Enter State [New York,California,Florida]: ')<br/>    data = pd.DataFrame([rnd,admin,market,city],index=['R&amp;D Spend', 'Administration', 'Marketing Spend', 'State']).T<br/>    obj = Profit(data)<br/>    obj.predict()</span></pre><p id="3f1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经复制了python脚本所需的pickle文件目录。此外，我们需要一个requirements.txt文件来在容器上安装模块和依赖项。</p><p id="687c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">requirements.txt文件可以由</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="81bf" class="kj jm hi ky b fi lc ld l le lf">$ pip3 freeze &gt; profit_predict/requirements.txt</span></pre><p id="14ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们的目录看起来像这样:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lm"><img src="../Images/6cfa555309ed56a47164af49fc218085.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*kCstI_QuPsHMX82fMig_MQ.png"/></div></figure><p id="1870" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保您的Docker守护程序已启动并正在运行:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es ln"><img src="../Images/df5a2e9a5ff175c08afe0b66a572bd21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*47bQIv-ArjmeFX-QVYNyfA.png"/></div></div></figure><h2 id="1c32" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">从DockerHub中提取Docker图像</h2><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="df62" class="kj jm hi ky b fi lc ld l le lf">$ sudo docker pull centos:latest</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es ls"><img src="../Images/374525fafe4202a1dcdcc72d09b7a42e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7QXOK-oV3co6OOV4PK_mzg.png"/></div></div></figure><h2 id="8b4f" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated"><strong class="ak">创建Dockerfile </strong></h2><p id="fb92" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">让我们创建一个Dockerfile来执行容器内部的各种操作。</p><p id="3f4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lt">注:创建Dockerfile </em> <strong class="ih hj"> <em class="lt">外</em> </strong> <em class="lt">项目目录【profit _ predictor】</em></p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="df3f" class="kj jm hi ky b fi lc ld l le lf">$ cat Dockerfile</span><span id="d718" class="kj jm hi ky b fi ll ld l le lf">FROM centos:latest</span><span id="5fab" class="kj jm hi ky b fi ll ld l le lf">COPY /profit_predictor  .</span><span id="8e14" class="kj jm hi ky b fi ll ld l le lf">RUN yum install python3 -y  &amp;&amp; pip3 install -r requirements.txt</span><span id="7877" class="kj jm hi ky b fi ll ld l le lf">ENTRYPOINT ["./profit_predictor.py"]</span></pre><p id="757f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个docker文件将使用centos映像将profit_predictor目录的内容复制到容器的root用户的主目录中。然后我们将安装python3，后面是requirements.txt文件。最后，我们将提供可执行脚本的位置作为容器的入口点。</p><p id="3346" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">整个树应该看起来像这样:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lu"><img src="../Images/9af9dfab03e9bd2700fc9d1bf8a13c5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*0YdTh-E89wjGboa-cgwC0Q.png"/></div></figure><h2 id="0a0e" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">构建DockerFile文件</h2><p id="4e82" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">一旦我们的项目空间准备就绪，让我们使用docker文件构建图像。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="8e51" class="kj jm hi ky b fi lc ld l le lf">$ sudo docker build -t profit_predictor:v0.01</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es lv"><img src="../Images/55f16461afe9cab404b97459f4a30f34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zPLQFJeOWyrIEYp7e499vg.png"/></div></div></figure><p id="8ed2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">映像已成功创建…</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es lw"><img src="../Images/af4fca1b8d3983985dc61a94806aed6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ymnFr91fUVKCjeUdEz8Rsw.png"/></div></div></figure><h2 id="9849" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">运行容器</h2><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="fa39" class="kj jm hi ky b fi lc ld l le lf">$ sudo docker run -it --name ml_container profit_predictor:v0.01</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es lx"><img src="../Images/413b6863ab9a1290c0f0444d70dcd725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3SH0OYnDyFBznbFOFIGmCQ.gif"/></div></div></figure><p id="2ab3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经在docker容器中成功运行了机器学习模型！</p><p id="58d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以在下面的资源库中找到代码:</p><div class="ly lz ez fb ma mb"><a href="https://github.com/gitwit-mistry/Profit_Predictor_Docker" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab dw"><div class="md ab me cl cj mf"><h2 class="bd hj fi z dy mg ea eb mh ed ef hh bi translated">git wit-Mistry/Profit _ Predictor _ Docker</h2><div class="mi l"><h3 class="bd b fi z dy mg ea eb mh ed ef dx translated">通过在GitHub上创建一个帐户，为git wit-Mistry/Profit _ Predictor _ Docker开发做出贡献。</h3></div><div class="mj l"><p class="bd b fp z dy mg ea eb mh ed ef dx translated">github.com</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp jj mb"/></div></div></a></div><p id="c8e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以通过以下方式与我联系:</p><div class="ly lz ez fb ma mb"><a href="https://www.linkedin.com/in/prathamesh-mistry/" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab dw"><div class="md ab me cl cj mf"><h2 class="bd hj fi z dy mg ea eb mh ed ef hh bi translated">Prathamesh Mistry - MLOPS暑期实习生-Linux world Informatics Pvt Ltd | LinkedIn</h2><div class="mi l"><h3 class="bd b fi z dy mg ea eb mh ed ef dx translated">查看Prathamesh Mistry在世界上最大的职业社区LinkedIn上的个人资料。Prathamesh列出了4项工作…</h3></div><div class="mj l"><p class="bd b fp z dy mg ea eb mh ed ef dx translated">www.linkedin.com</p></div></div></div></a></div></div></div>    
</body>
</html>