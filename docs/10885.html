<html>
<head>
<title>Privacy friendly website analytics with Umami and NextJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Umami和NextJS进行隐私友好型网站分析</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/privacy-friendly-website-analytics-with-umami-and-nextjs-8b587aecc916?source=collection_archive---------14-----------------------#2022-02-20">https://medium.com/geekculture/privacy-friendly-website-analytics-with-umami-and-nextjs-8b587aecc916?source=collection_archive---------14-----------------------#2022-02-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/ff80abbb57e3a749fa14f289213c0973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eew4GWybTmz_cdDB0BEVxQ.png"/></div></div></figure><div class=""/><p id="cae0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">网站分析确实是一件非常重要的事情。我们可以很好地了解我们的受众，并可以根据受众定制我们的内容，以提高参与度。<a class="ae jo" href="https://analytics.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌分析</a>一直是首选解决方案，因为它很受欢迎，易于设置，并提供大量数据。</p><p id="187a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，谷歌分析也有自己的一系列问题。使用Google Analytics必须获得cookie许可，因为Google Analytics使用cookie。谷歌分析脚本也很大，众所周知会降低网站速度。最近有指控称谷歌分析对隐私不友好，而且<a class="ae jo" href="https://techcrunch.com/2022/02/10/cnil-google-analytics-gdpr-breach/" rel="noopener ugc nofollow" target="_blank">许多欧洲当局也发现它违反了GDPR </a>。</p><p id="83c9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那么，解决办法是什么呢？</p><p id="4ff8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">多年来，出现了许多隐私友好的分析解决方案，包括<a class="ae jo" href="https://usefathom.com/" rel="noopener ugc nofollow" target="_blank"> Fathom Analytics </a>、<a class="ae jo" href="https://plausible.io/" rel="noopener ugc nofollow" target="_blank">似是而非的分析</a>和<a class="ae jo" href="https://umami.is/" rel="noopener ugc nofollow" target="_blank">鲜味分析</a>。最后两个是开源的，三个都没有cookie，有一个轻量级的脚本，不会影响网站的加载时间。</p><p id="46a5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我们将关注鲜味</p><h1 id="239a" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">关于鲜味的一点点</h1><p id="ee32" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">Umami是一个开源的自托管分析服务。这意味着任何人都可以访问源代码，并且必须自己托管它。现在，你可能会说这要花钱，而且不是免费的，但是今天我们要看看我们如何免费托管它。此外，Umami使用NextJS API路由作为后端，因此它可以在任何无服务器架构上运行。我们今天将在<a class="ae jo" href="https://railway.app/" rel="noopener ugc nofollow" target="_blank">铁路</a>上设置它，然而，它也可以在<a class="ae jo" href="https://vercel.com/dashboard" rel="noopener ugc nofollow" target="_blank"> Vercel </a>或<a class="ae jo" href="https://www.netlify.com/" rel="noopener ugc nofollow" target="_blank"> Netlify </a>上托管。我们还将考虑在NextJS应用程序中添加分析功能。</p><p id="6ce0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以在此处看到该平台的<a class="ae jo" href="https://app.umami.is/share/8rmHaheU/umami.is" rel="noopener ugc nofollow" target="_blank">现场演示</a></p><p id="b3dd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有趣的事实:<a class="ae jo" href="https://hashnode.com/" rel="noopener ugc nofollow" target="_blank"> Hashnode </a>也使用鲜味，并推出了鲜味仪表板作为高级分析😎</p><p id="d7c9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以在这里看到我博客的<a class="ae jo" href="https://stats.hashnode.com/share/VDldVSkU/9f4dd26c-c7e6-4fa1-88aa-87d90a0dba43" rel="noopener ugc nofollow" target="_blank">公共分析</a></p><h1 id="f1f8" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">在铁路上免费招待鲜味</h1><p id="6811" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated"><a class="ae jo" href="https://railway.app/" rel="noopener ugc nofollow" target="_blank"> Railway </a>是一个非常棒的托管平台，可以让你快速轻松地托管应用程序。免费计划允许每月使用5美元，这对一些中小型网站来说已经足够了。</p><p id="b30f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">事实上，我在过去的3-4个月里一直在使用它，这是一次令人惊奇的经历。我的使用成本通常低于每月2美元，因此我从未支付任何费用。甚至不需要链接信用卡！</p><p id="7b35" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我本月的使用情况(3个网站)</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ks"><img src="../Images/ce307248c9e9d51b6fe2905c055156c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hsswvzyzw0DOaC_l"/></div></div></figure><p id="9b17" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你也可以链接一张信用卡，每月免费使用10美元(超过10美元的部分将向你收费)。</p><p id="d320" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以在这里报名<a class="ae jo" href="https://railway.app?referralCode=AnishDe12020" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="214a" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">建立铁路项目</h1><p id="9e7e" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我们将遵循<a class="ae jo" href="https://umami.is/docs/running-on-railway" rel="noopener ugc nofollow" target="_blank">官方指南在铁路上举办</a></p><p id="c906" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先要分叉知识库。这将帮助我们对源代码进行修改以适应我们自己的需要，更重要的是，在将来接收更新(正如我们将在本教程后面看到的)。前往<a class="ae jo" href="https://github.com/mikecao/umami" rel="noopener ugc nofollow" target="_blank"> Umami GitHub库</a>并点击右上角的fork</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div class="er es kx"><img src="../Images/2eed55ed78b0f5cd831d38ff5dd2200f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/0*q9_o1FNdVxC8BgyS"/></div></figure><p id="9bfd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可能会被要求选择您的个人帐户或组织，如果您在任何。我会建议去个人帐户，除非是为一个组织。</p><p id="b6ae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦你注册了一个帐户，点击“新项目”(注意，我已经有一个现有的项目，因此布局看起来像这样。对你来说可能不一样)—</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/ba17b018bdde485b23aaea36d199fb18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OO2EI-72GN1eZGWK"/></div></div></figure><p id="44b3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，在新项目屏幕上选择“从回购部署”</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/a7254a7d332d9063833cb85cda460e6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6Ey12zHQvobdNmzO"/></div></div></figure><p id="c9ae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，如果您没有注册GitHub，系统会提示您连接GitHub帐户。</p><p id="b26d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在那里搜索并选择鲜味。</p><p id="7ea6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">确保已选择主分支。现在点击部署-</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/3e5cecd7e609f645c442f359fb1decbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OOwGBl2zf0cMQNAs"/></div></div></figure><p id="6d78" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这可能需要一些时间(2-5分钟)。</p><p id="621c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是部署后它应该看起来的样子(请注意，我目前正在使用Metro UI，布局可能看起来有点不同)</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/70b541097fcc1553d3dd8a86479b6d25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jkn5MuZiBr2c7Gs6"/></div></div></figure><p id="b310" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们需要添加一个数据库。在这个例子中，我们将使用PostgreSQL。现在，Railway内置了对数据库的支持，因此我们可以在Railway内部免费构建PostgreSQL实例。</p><p id="ae4e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击这个“新建”按钮-</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div class="er es kz"><img src="../Images/262bc41fdb9a432f5fae51d89319dcdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/0*sQY-QZXiWQHiyUXK"/></div></figure><p id="369d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">选择“数据库”，然后选择“PostgreSQL”</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div class="er es la"><img src="../Images/20065e36f5fc85279b8142af61d048f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/0*SmI271CxSS5I2wKf"/></div></figure><p id="54eb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这可能也需要一些时间。</p><p id="1e05" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，如果你使用旧的用户界面，你必须选择“添加插件”按钮。</p><p id="8472" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们需要添加两个环境变量，<code class="du lb lc ld le b">PORT</code>和<code class="du lb lc ld le b">HASH_SALT</code>。点击写着“鲜味”的卡片，进入“变量”标签-</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/6ab973c6b95a67dcf5257ffe84563c79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aUMcQEoeeCY7CfI_"/></div></div></figure><p id="0d8e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在旧的UI中，侧边栏会有一个名为“变量”的按钮。单击它，然后在“custom”下添加以下变量。</p><p id="9a6f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要为环境变量<code class="du lb lc ld le b">HASH_SALT</code>放置一个随机字符串。使用任何随机字符串发生器，如<a class="ae jo" href="https://devkit.one/generators/random-string" rel="noopener ugc nofollow" target="_blank">这个</a>。让我们用20个字符，包括大写和小写字母，数字和符号-</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/ac31be9e609d1c4ce1e9c215b08efd7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oaZUo1pVrHqSwwOC"/></div></div></figure><p id="5405" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在把它粘贴到铁路上，点击“添加”</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lf"><img src="../Images/4c8604a20de8dc5019856ed161190b78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HVNUmbTMITzOljwz"/></div></div></figure><p id="af26" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另外，添加一个名为<code class="du lb lc ld le b">PORT</code>的环境变量，并将其设置为<code class="du lb lc ld le b">3000</code></p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/5edbf3a91e67fda76252c1ec68b77b68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*udUKogOuL1s-3eU4"/></div></div></figure><p id="bf34" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，每次我们添加环境变量时，Railway都会重新部署我们的应用程序。</p><h1 id="afe3" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">设置我们的数据库模式</h1><p id="8980" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">现在，我们需要在数据库中制作表格。为此，我们需要在本地克隆这个项目。继续用git克隆它，并在该存储库中打开一个终端(我在这里使用GitHub CLI克隆，但您也可以使用<code class="du lb lc ld le b">git</code>)</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lg"><img src="../Images/d27c76eb219f930a6c2673faf355dec7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9u1_YLkVkqE_t-u7"/></div></div></figure><p id="fba9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们需要<a class="ae jo" href="https://docs.railway.app/develop/cli" rel="noopener ugc nofollow" target="_blank">安装铁路CLI </a>。您可以用NPM安装它，命令如下-</p><pre class="kt ku kv kw fd lh le li lj aw lk bi"><span id="d5ec" class="ll jq ht le b fi lm ln l lo lp">npm i -g @railway/cli</span></pre><p id="d5f4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你也可以用下面的命令用<a class="ae jo" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank"> Homebrew </a>安装它</p><pre class="kt ku kv kw fd lh le li lj aw lk bi"><span id="0544" class="ll jq ht le b fi lm ln l lo lp">brew install railwayapp/railway/railway</span></pre><p id="3100" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在运行以下命令，使用您的Railway帐户验证CLI</p><pre class="kt ku kv kw fd lh le li lj aw lk bi"><span id="3995" class="ll jq ht le b fi lm ln l lo lp">railway </span></pre><p id="246f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，如果您在执行此操作时遇到任何问题，您也可以尝试使用以下命令登录</p><pre class="kt ku kv kw fd lh le li lj aw lk bi"><span id="c099" class="ll jq ht le b fi lm ln l lo lp">railway login --browserless</span></pre><p id="c623" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在运行以下命令将本地目录与您的铁路项目链接起来-</p><pre class="kt ku kv kw fd lh le li lj aw lk bi"><span id="4ad9" class="ll jq ht le b fi lm ln l lo lp">railway link</span></pre><p id="6dd4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，前往Railway，单击PostgreSQL卡，进入“变量”选项卡-</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/2e5ae7874c79d80b19d0e984318b2b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2mKmC6XCmJT54yJd"/></div></div></figure><p id="2fc1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在在终端中运行以下命令-</p><pre class="kt ku kv kw fd lh le li lj aw lk bi"><span id="5d34" class="ll jq ht le b fi lm ln l lo lp">railway run psql -h PGHOST -U PGUSER -d PGDATABASE -f sql/schema.postgresql.sql</span></pre><p id="efb6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用Railway仪表板中的相应值替换值上限(从上一步中PostgreSQL的环境变量选项卡中)</p><p id="59e2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在按回车键运行命令。</p><p id="75c3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，为此您需要PostgreSQL CLI。如果没有，可以按照<a class="ae jo" href="https://www.timescale.com/blog/how-to-install-psql-on-mac-ubuntu-debian-windows/" rel="noopener ugc nofollow" target="_blank">这个指南安装</a>。</p><p id="8b56" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在运行以下命令来部署它-</p><pre class="kt ku kv kw fd lh le li lj aw lk bi"><span id="7e15" class="ll jq ht le b fi lm ln l lo lp">railway up</span></pre><p id="61ef" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">万岁，我们成功部署了🥳鲜味</p><h1 id="aad4" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">使用鲜味</h1><p id="a5e9" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">部署后，您将获得登录到CLI的部署URL。您也可以从Railway web应用程序中检索此URL。</p><p id="63cb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您也可以从Umami dashboard设置一个自定义子域(甚至自定义域)</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/4db824bf0b0f29dcdbc148d4f1465e21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lwJOKUDeuBq2_wVb"/></div></div></figure><p id="c1ae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您将看到一个登录屏幕。用户名是“admin”，默认密码是“umami”(我们会更改这个)。</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/439c7a40098a327406d194348f95bfe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lRGPc4xsr4PHX3xB"/></div></div></figure><p id="80cb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的仪表板现在应该是这样的-</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/9d11403e68640e3dcf48ef03682e4110.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lrLJWvmfsJacAWcs"/></div></div></figure><p id="631f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，有一个横幅说有一个新版本出来了！在写这个教程的时候，鲜味的创造者<a class="ae jo" href="https://github.com/mikecao" rel="noopener ugc nofollow" target="_blank"> Mikecao </a>推了一个新版本😅</p><p id="7c94" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是一件好事，因为现在我要向你们展示如何更新鲜味😎</p><p id="6f35" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在此之前，让我们快速更改我们的密码，因为“鲜味”不是一个安全的密码。</p><p id="074d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">转到设置→个人资料，点击“更改密码”</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/37bbad58496b0079852bc5e21ee6af95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*42IWPJV8fO18e-ie"/></div></div></figure><p id="9c79" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在“当前密码”字段中输入“umami ”,然后设置新的安全密码并点击“保存”</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div class="er es lq"><img src="../Images/d1f3db631febb408c589f60c9e51fd31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/0*WDWnTkixMyUFyv3M"/></div></figure><h1 id="589e" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">更新鲜味</h1><p id="1aeb" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">前往GitHub上的分叉鲜味库。您应该看到我们的分支落后了几个提交-</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lr"><img src="../Images/0884155c05c440bf1b505d2c116cad08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WXbIoJxtRFGGnIEm"/></div></div></figure><p id="0d45" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击“获取上游”，然后点击“获取并合并”</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ls"><img src="../Images/4fc4cb77de17a5740af317228f9e4940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XZ3_rDNMLWL7soZX"/></div></div></figure><p id="9285" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就是这样！新的部署将在Railway上启动，几分钟后，您应该可以启动并运行最新版本-</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lt"><img src="../Images/0b964b460862a5cc5d6caa7b828759e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IwfAeOfWqLYc9So8"/></div></div></figure><h1 id="ce24" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">向NextJS网站添加鲜味</h1><p id="69bc" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">现在，让我们来看看如何向NextJS网站添加鲜味。为此，让我们首先创建一个新的NextJS应用程序(注意，它也可以与现有的NextJS应用程序一起工作)</p><pre class="kt ku kv kw fd lh le li lj aw lk bi"><span id="8d69" class="ll jq ht le b fi lm ln l lo lp">npx create-next-app umami-tutorial</span></pre><p id="3245" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们进入目录-</p><pre class="kt ku kv kw fd lh le li lj aw lk bi"><span id="43cc" class="ll jq ht le b fi lm ln l lo lp">cd umami-tutorial</span></pre><p id="7395" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，在您最喜欢的文本编辑器中打开它。我们将在本教程中使用VSCode</p><pre class="kt ku kv kw fd lh le li lj aw lk bi"><span id="4c24" class="ll jq ht le b fi lm ln l lo lp">code .</span></pre><p id="3835" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，打开<code class="du lb lc ld le b">pages/_app.js</code>文件。应该是这样的-</p><figure class="kt ku kv kw fd hk"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="f83a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，让我们为鲜味添加脚本标记。这就是我们的<code class="du lb lc ld le b">_app.js</code>现在的样子-</p><figure class="kt ku kv kw fd hk"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="66dd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，我们使用了<a class="ae jo" href="https://nextjs.org/docs/api-reference/next/script" rel="noopener ugc nofollow" target="_blank"> NextJS脚本组件</a>并延迟加载脚本，这样它就不会阻止我们网站的加载。</p><p id="f170" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们还需要添加环境变量，但在此之前，我们需要将网站添加到鲜味。</p><p id="d8c7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">前往鲜味，然后前往设置→网站-</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/2999443c91983ec3707d247c0c7579ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ERpHRHS9iIWONxho"/></div></div></figure><p id="8733" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，点击“添加网站”</p><p id="e98c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将这个命名为“鲜味教程”,但是你可以随意命名。在下一个字段中，请确保输入域，而不是网站的URL。请注意，我已经快速创建了一个GitHub存储库，并将这个NextJS应用程序部署到了<a class="ae jo" href="https://vercel.com/" rel="noopener ugc nofollow" target="_blank"> Vercel </a>中。我也检查了“启用分享网址”,这样我就可以与你们分享这个网站的分析😁</p><p id="506a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就是这里——<a class="ae jo" href="https://umami-tutorial.up.railway.app/share/3lOPyajp/Umami%20Tutorial" rel="noopener ugc nofollow" target="_blank">https://Umami-tutorial . up . railway . app/share/3lOPyajp/Umami % 20 tutorial</a></p><figure class="kt ku kv kw fd hk er es paragraph-image"><div class="er es lw"><img src="../Images/70d979645cffeb6ad99613d3244d77e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/0*ZF_HcrAmlGwWmihQ"/></div></figure><p id="b790" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，点击“保存”，然后“获取跟踪代码”</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lx"><img src="../Images/bb4c1daef767931b8c6ce9b285862593.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g7G_kWUjJ7_O1AtU"/></div></div></figure><p id="d236" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从出现的模态中，复制<code class="du lb lc ld le b">data-website-id</code>和<code class="du lb lc ld le b">src</code>的值即可</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ly"><img src="../Images/2d3e2dfb1aeb8b26883eee3d50fc91d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1oc-O1kSIWf-hi3J"/></div></div></figure><p id="4d32" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，在NextJS应用程序中创建一个名为<code class="du lb lc ld le b">.env.local</code>的新文件，并添加以下环境变量</p><figure class="kt ku kv kw fd hk"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="8bed" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，在你的浏览器上访问这个网站，看看鲜味仪表板，它应该在“实时”标签下记录一个视图和一次访问-</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/92a7b881508ae54d52bab91697904e70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5Ym5Taipand9eMTH"/></div></div></figure><p id="0b55" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以在网站的详细页面下看到更多详细的分析-</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/bf7c412500d476a9cfaedab5cf6f1670.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YzBw0HmhDVlMT_2S"/></div></div></figure><p id="d7bb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当你的网站开始吸引访问者时，更多的数据会堆积起来</p><p id="c36e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意:一些浏览器，比如brave，有内置的广告拦截器，在很多情况下会阻止这些脚本的加载。甚至第三方广告拦截器也可能对此负责。如果您的Umami dashboard中没有显示任何数据，请尝试一个没有广告拦截器的浏览器(或私有模式)，尝试重新启动您的开发服务器，并确保环境变量的值是正确的。</p><p id="7836" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">哇哦，太多了！</p><h1 id="dc61" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="ce80" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我们建立并运行了Umami，并向NextJS应用程序添加了分析功能。鲜味更像是记录事件。查看<a class="ae jo" href="https://umami.is/docs" rel="noopener ugc nofollow" target="_blank">他们的文档了解更多信息</a></p><p id="7003" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我希望你一切顺利。请随意评论这篇文章，或者在<a class="ae jo" href="https://twitter.com/AnishDe12020" rel="noopener ugc nofollow" target="_blank">推特</a>上联系我，我会帮你解决问题😄</p><h1 id="a23c" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">重要链接</h1><ul class=""><li id="0279" class="lz ma ht is b it kn ix ko jb mb jf mc jj md jn me mf mg mh bi translated"><a class="ae jo" href="https://umami.is/" rel="noopener ugc nofollow" target="_blank">鲜味</a></li><li id="859c" class="lz ma ht is b it mi ix mj jb mk jf ml jj mm jn me mf mg mh bi translated"><a class="ae jo" href="https://umami.is/docs/about" rel="noopener ugc nofollow" target="_blank">鲜味文件</a></li><li id="99eb" class="lz ma ht is b it mi ix mj jb mk jf ml jj mm jn me mf mg mh bi translated"><a class="ae jo" href="https://umami.is/docs/running-on-railway" rel="noopener ugc nofollow" target="_blank">关于在铁路上设置鲜味的官方指南</a></li><li id="339a" class="lz ma ht is b it mi ix mj jb mk jf ml jj mm jn me mf mg mh bi translated"><a class="ae jo" href="https://railway.app/" rel="noopener ugc nofollow" target="_blank">铁路</a></li><li id="64dd" class="lz ma ht is b it mi ix mj jb mk jf ml jj mm jn me mf mg mh bi translated"><a class="ae jo" href="https://github.com/AnishDe12020/umami-tutorial" rel="noopener ugc nofollow" target="_blank">本教程的资源库</a></li><li id="2922" class="lz ma ht is b it mi ix mj jb mk jf ml jj mm jn me mf mg mh bi translated"><a class="ae jo" href="https://umami-tutorial.vercel.app/" rel="noopener ugc nofollow" target="_blank">本教程的演示网站</a></li><li id="b1e1" class="lz ma ht is b it mi ix mj jb mk jf ml jj mm jn me mf mg mh bi translated"><a class="ae jo" href="https://umami-tutorial.up.railway.app/share/3lOPyajp/Umami%20Tutorial" rel="noopener ugc nofollow" target="_blank">演示网站的公共分析</a></li></ul></div><div class="ab cl mn mo gp mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="hb hc hd he hf"><p id="3c5e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mu">原载于</em><a class="ae jo" href="https://blog.anishde.dev/privacy-friendly-website-analytics-with-umami-and-nextjs" rel="noopener ugc nofollow" target="_blank"><em class="mu">https://blog . anishde . dev</em></a><em class="mu">。</em></p></div></div>    
</body>
</html>