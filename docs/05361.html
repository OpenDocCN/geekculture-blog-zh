<html>
<head>
<title>Recoil : Efficient state management library for React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反冲:React的高效状态管理库</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/recoil-efficient-state-management-library-for-react-b9e158b74460?source=collection_archive---------18-----------------------#2021-07-19">https://medium.com/geekculture/recoil-efficient-state-management-library-for-react-b9e158b74460?source=collection_archive---------18-----------------------#2021-07-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e2b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jd je jf jg b">selector</code>关于测验的初始提示页面也执行这些。它有<code class="du jd je jf jg b">get</code> QueryData <code class="du jd je jf jg b">atom</code>和异步API请求服务器获取测验数据。</p><pre class="jh ji jj jk fd jl jg jm bn jn jo bi"><span id="9f1c" class="jp jq hi jg b be jr js l jt ju">export default selector&lt;TResponseData&gt;({<br/>  key: 'initilaOrderState',<br/>  get: async ({ get }) =&gt; {<br/>    const queryData = get(QueryDataState);<br/>  <br/>    if (queryData == undefined || window.location.pathname != `/${QUIZ_PAGENAME}`) return undefined;<br/><br/>    const { amount, difficulty } = queryData;<br/>  <br/>    const axios = customAxios();<br/>    const response = await axios({<br/>      method: 'GET',<br/>      params: {<br/>        amount,<br/>        difficulty,<br/>        type: 'multiple',<br/>      },<br/>    });<br/>  <br/>    const decodedResponseData = {<br/>      ...response.data,<br/>      ...<br/>    };<br/>   <br/>   return decodedResponseData;<br/>  },<br/>});</span></pre><p id="f4fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">执行异步请求后，<code class="du jd je jf jg b">selector</code>返回响应数据，即全局状态值。有一个组件需要获取该值(例如，测验组件)。然后，怎么渲染呢？</p><h1 id="fb9a" class="jv jq hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">用<code class="du jd je jf jg b">React.suspense</code>用异步数据渲染组件</h1><p id="f52c" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated"><code class="du jd je jf jg b">Quiz component</code>在QuizPage中，获取异步全局状态(initialProps)以呈现来自服务器的测验数据。所以，它用<code class="du jd je jf jg b">InitialPropsState</code>执行<code class="du jd je jf jg b">useRecoilValue</code>。</p><pre class="jh ji jj jk fd jl jg jm bn jn jo bi"><span id="c515" class="jp jq hi jg b be jr js l jt ju">import { useEffect, useRef, useState } from 'react';<br/>import { useRecoilState, useRecoilValue, useSetRecoilState } from 'recoil';<br/>import {<br/>  InitialPropsState,<br/>  CurrentQuizIndexState,<br/>  SelectedAnswerState,<br/>  QuizResultsState,<br/>} from 'src/state';<br/><br/>const Quiz = () =&gt; {<br/>  const initialProps = useRecoilValue(InitialPropsState);<br/>  const currentQuizIndex = useRecoilValue(CurrentQuizIndexState);<br/>  const currentQuiz = (initialProps as TResponseData).results[currentQuizIndex];<br/>  <br/>  ...<br/> <br/>  return (<br/>    &lt;Content<br/>      header={`QUIZ ${currentQuizIndex + 1} / ${(initialProps as TResponseData).results.length}`}<br/>      headerRight={currentQuiz.difficulty}&gt;<br/>        &lt;Atoms.Div ... &gt;<br/>          &lt;Atoms.Div&gt;<br/>            &lt;Atoms.Div fontSize="24px"&gt;{currentQuiz.question&lt;/Atoms.Div&gt;<br/>            &lt;Atoms.Ul&gt;<br/>              {currentQuiz.examples.map((answer: string, i: number) =&gt; (&lt;Atoms.Li key={answer} value={answer}&gt;<br/>      &lt;Atoms.Checkbox<br/>        id={answer}<br/>        name={answer}<br/>        disabled={selectedAnswer != undefined}<br/>        onChange={handleChange}<br/>      /&gt;<br/>        &lt;Atoms.Label<br/>          isSelected={selectedAnswer == answer}<br/>          isCorrect={selectedAnswer == currentQuiz.correct_answer}&gt;{answer}&lt;/Atoms.Label&gt;<br/>      &lt;/Atoms.Li&gt;))}<br/>            &lt;/Atoms.Ul&gt;<br/>        &lt;/Atoms.Div&gt;<br/>      &lt;/Atoms.Div&gt;<br/>    &lt;/Content&gt;<br/>  );<br/>};<br/><br/>export default Quiz;</span></pre><p id="eadf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，<code class="du jd je jf jg b">QuizPage component</code>渲染<code class="du jd je jf jg b">Quiz component</code></p><pre class="jh ji jj jk fd jl jg jm bn jn jo bi"><span id="6826" class="jp jq hi jg b be jr js l jt ju">import { Quiz, QuizFooter, QuizResult } from 'components/Organisms';<br/><br/>const QuizPage = () =&gt; {<br/>  return (<br/>    &lt;&gt;<br/>      &lt;Quiz /&gt;<br/>      &lt;QuizResult /&gt;<br/>      &lt;QuizFooter /&gt;<br/>    &lt;/&gt;<br/>  );<br/>};<br/><br/>export default QuizPage;</span></pre><p id="055b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后用<code class="du jd je jf jg b">Suspense</code>在<code class="du jd je jf jg b">Router.tsx</code>中渲染<code class="du jd je jf jg b">QuizPage component</code>。</p><pre class="jh ji jj jk fd jl jg jm bn jn jo bi"><span id="a87a" class="jp jq hi jg b be jr js l jt ju">import { Suspense } from 'react';<br/>import { Helmet } from 'react-helmet';<br/>import { Route, Switch } from 'react-router';<br/>import { BrowserRouter } from 'react-router-dom';<br/>import { QUIZ_PAGENAME, RESULT_PAGENAME } from 'src/constant';<br/>import { ErrorBoundary, LandingPage, QuizPage, ResultsPage, ShimmerPage} from 'src/components/Pages';<br/><br/>const Router = () =&gt; {<br/>  return (<br/>    &lt;BrowserRouter&gt;<br/>      &lt;ErrorBoundary&gt;<br/>        &lt;Suspense fallback={&lt;ShimmerPage /&gt;}&gt;<br/>          &lt;Switch&gt;<br/>            &lt;Route path={`/${QUIZ_PAGENAME}`}&gt;<br/>              &lt;Helmet title="Quiz page" /&gt;<br/>              &lt;QuizPage /&gt;<br/>            &lt;/Route&gt;<br/>            ...<br/>          &lt;/Switch&gt;<br/>        &lt;/Suspense&gt;<br/>      &lt;/ErrorBoundary&gt;<br/>    &lt;/BrowserRouter&gt;<br/>  );<br/>};<br/><br/>export default Router;</span></pre><p id="7b41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jd je jf jg b">Suspense</code>是一个拥有子组件的组件，该子组件从服务器获取带有异步数据的全局状态(例如，<code class="du jd je jf jg b">Quiz component</code>带有<code class="du jd je jf jg b">initialPropsState</code>)。它还有名为<code class="du jd je jf jg b">fallback</code>的道具，必须分配一个组件。当异步请求在子组件的全局状态下开始时，它被呈现，其状态将是<code class="du jd je jf jg b">loading</code>。执行异步请求后，状态为<code class="du jd je jf jg b">hasValue</code>,<code class="du jd je jf jg b">Suspense</code>的子组件被渲染。</p><p id="ac41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果异步请求状态是<code class="du jd je jf jg b">hasError</code>，<code class="du jd je jf jg b">ErrorBoundary</code>被渲染。因为它可以用<code class="du jd je jf jg b">getDerivedStateFromError</code>方法处理错误。</p><p id="161b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅此而已。</p><h1 id="7262" class="jv jq hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">结论</h1><p id="a418" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">我们可以从这篇文章中学到一些东西，比如</p><ul class=""><li id="a1b5" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">原子</li><li id="52b8" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">选择器</li><li id="7db9" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">如何通过React .悬念呈现带有异步数据的组件</li></ul><p id="acf7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些不仅容易学习，而且使你的代码简洁。使用完这些，你会觉得反冲是一个强大的状态管理库。所以，试试吧，快乐编码。</p></div></div>    
</body>
</html>