<html>
<head>
<title>Trino + dbt = a match in SQL heaven?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">trino+dbt = SQL天堂里的匹配？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/trino-dbt-a-match-in-sql-heaven-1df2a3d12b5e?source=collection_archive---------8-----------------------#2021-06-14">https://medium.com/geekculture/trino-dbt-a-match-in-sql-heaven-1df2a3d12b5e?source=collection_archive---------8-----------------------#2021-06-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8095d42430665e88f0f529395d654183.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C3-L7Wr316rQKVNiVKLdqg.png"/></div></div></figure><p id="69f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您可以利用两个最成功的开源数据项目的力量，仅通过SQL查询来混合和加载来自不同来源(内部或云)的数据，会怎么样？</p><p id="e5dc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为什么不使用一流的dbt和Trino解决方案作为强大的ETL工具呢？</p><ul class=""><li id="8eff" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated"><a class="ae jx" href="https://www.getdbt.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> dbt </strong> </a>(数据构建工具)使分析工程师能够通过简单地编写SQL select语句来转换他们仓库中的数据。dbt负责将这些SQL select语句转换成表和视图(<a class="ae jx" href="https://docs.getdbt.com/docs/introduction" rel="noopener ugc nofollow" target="_blank">更多细节</a>)。</li><li id="6b56" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated"><a class="ae jx" href="https://trino.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Trino </strong> </a>，前身为<a class="ae jx" href="https://trino.io/blog/2020/12/27/announcing-trino.html" rel="noopener ugc nofollow" target="_blank"> PrestoSQL </a>，是一款用于大数据分析的快速分布式SQL查询引擎，可帮助您探索您的数据世界并混合多个数据源(<a class="ae jx" href="https://trino.io/docs/current/overview/use-cases.html" rel="noopener ugc nofollow" target="_blank">更多详细信息</a>)。</li></ul><p id="d3ea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Trino通过1个连接连接到多个不同的数据源(<a class="ae jx" href="https://trino.io/docs/current/connector.html" rel="noopener ugc nofollow" target="_blank">可用连接器</a>)，并大规模快速处理SQL查询，而dbt则处理这些SQL转换查询以创建表或视图。</p><p id="4f32" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完美契合，不是吗？会不会是SQL天堂里的天作之合？</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="bb3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们通过一个演示来看看我们可以用dbt和Trino做什么。通过这个简单的项目示例，您将能够:</p><ul class=""><li id="1d86" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">启动Trino服务器。</li><li id="27d7" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated">从Trino连接到Google BigQuery数据集和内部PostgreSQL数据库。</li><li id="e0c2" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated">通过dbt项目，连接BigQuery表和PostgreSQL表，并将结果写入本地PostgreSQL表。</li></ul><p id="6531" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">代码和解释可在<a class="ae jx" href="https://github.com/victorcouste/trino-dbt-demo" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><h1 id="0be4" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">要求</h1><p id="e80e" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">安装:</p><ul class=""><li id="9f68" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated"><strong class="is hj"> Trino </strong> — <a class="ae jx" href="https://trino.io/docs/current/installation/deployment.html" rel="noopener ugc nofollow" target="_blank">安装说明</a>，可以进行单机测试和演示。</li><li id="4662" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated"><strong class="is hj"> dbt </strong> — <a class="ae jx" href="https://docs.getdbt.com/dbt-cli/installation" rel="noopener ugc nofollow" target="_blank">安装说明</a></li><li id="5451" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated"><strong class="is hj"> dbt-presto </strong> — <a class="ae jx" href="https://docs.getdbt.com/reference/warehouse-profiles/presto-profile#installation-and-distribution" rel="noopener ugc nofollow" target="_blank">安装说明</a>，这是Presto dbt Python插件。08/09/21更新:新的<a class="ae jx" href="https://docs.getdbt.com/reference/warehouse-profiles/trino-profile" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Trino dbt插件</strong> </a>现已推出，使用起来会更好(<a class="ae jx" href="https://github.com/starburstdata/dbt-trino" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">安装、配置和源代码</strong> </a>)</li></ul></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><h1 id="34c2" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">设置</h1><h1 id="0bd5" class="kq kr hi bd ks kt lt kv kw kx lu kz la lb lv ld le lf lw lh li lj lx ll lm ln bi translated">特里诺</h1><p id="a75d" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">如这里的<a class="ae jx" href="https://trino.io/docs/current/installation/deployment.html#configuring-trino" rel="noopener ugc nofollow" target="_blank">所述</a>，在启动Trino服务器之前，您需要:</p><ul class=""><li id="f8a9" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">在<strong class="is hj"> /etc </strong>文件夹中设置您的配置和属性文件。</li><li id="e483" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated">用数据源连接定义您的<a class="ae jx" href="https://trino.io/docs/current/installation/deployment.html#catalog-properties" rel="noopener ugc nofollow" target="_blank">目录</a>。</li></ul><p id="3457" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于这个演示项目，您可以使用在<a class="ae jx" href="https://github.com/victorcouste/trino-dbt-demo/blob/main/trino_etc" rel="noopener ugc nofollow" target="_blank"> trino_etc </a> github文件夹中找到的配置、属性和目录文件。只需将这个<strong class="is hj"> /trino_etc </strong>文件夹的内容复制到您的trino服务器安装下的一个<strong class="is hj"> /etc </strong>文件夹中即可。</p><h2 id="3ad3" class="ly kr hi bd ks lz ma mb kw mc md me la jb mf mg le jf mh mi li jj mj mk lm ml bi translated">配置:</h2><p id="c745" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">由于<a class="ae jx" href="https://trino.io/blog/2020/12/27/announcing-trino.html" rel="noopener ugc nofollow" target="_blank"> PrestoSQL到Trino的重命名</a>，您需要强制将协议头命名为Presto，以便dbt-presto插件能够很好地与最新的Trino版本一起工作。为此，需要在Trino配置文件<a class="ae jx" href="https://github.com/victorcouste/trino-dbt-demo/blob/main/trino_etc/config.properties" rel="noopener ugc nofollow" target="_blank">config . properties</a>(<a class="ae jx" href="https://trino.io/docs/current/admin/properties-general.html?highlight=alternate%20header#protocol-v1-alternate-header-name" rel="noopener ugc nofollow" target="_blank">文档</a>)中添加额外的<code class="du mm mn mo mp b">protocol.v1.alternate-header-name=Presto</code>属性。</p><pre class="kd ke kf kg fd mq mp mr ms aw mt bi"><span id="0bfb" class="ly kr hi mp b fi mu mv l mw mx">coordinator=true<br/>node-scheduler.include-coordinator=true<br/>http-server.http.port=8080<br/>query.max-memory=5GB<br/>query.max-memory-per-node=1GB<br/>query.max-total-memory-per-node=2GB<br/>discovery-server.enabled=true<br/>discovery.uri=http://localhost:8080<br/>protocol.v1.alternate-header-name=Presto</span></pre><p id="3f4c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">08/09/21更新:使用新的<a class="ae jx" href="https://docs.getdbt.com/reference/warehouse-profiles/trino-profile" rel="noopener ugc nofollow" target="_blank"> Trino dbt插件</a> ( <a class="ae jx" href="https://github.com/starburstdata/dbt-trino" rel="noopener ugc nofollow" target="_blank"> GitHu </a> b)，您不再需要更改<code class="du mm mn mo mp b">protocol.v1.alternate-header-name</code>属性。</p><h2 id="970d" class="ly kr hi bd ks lz ma mb kw mc md me la jb mf mg le jf mh mi li jj mj mk lm ml bi translated">目录:</h2><p id="18c6" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">您需要定义想要通过Trino连接的数据源。</p><p id="2e93" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本演示中，我们将连接到一个Google BigQuery数据集和一个内部PostgreSQL数据库。</p><p id="3355" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> PostgreSQL </strong></p><p id="d30e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">必须将<a class="ae jx" href="https://github.com/victorcouste/trino-dbt-demo/blob/main/trino_etc/catalog/postgresql.properties" rel="noopener ugc nofollow" target="_blank"> postgres.properties </a>文件复制到您的<strong class="is hj"> etc/catalog </strong> Trino文件夹中。您需要设置PostgreSQL数据库的主机名、数据库和凭证(<a class="ae jx" href="https://trino.io/docs/current/connector/postgresql.html" rel="noopener ugc nofollow" target="_blank"> Trino doc </a>)，如下所示:</p><pre class="kd ke kf kg fd mq mp mr ms aw mt bi"><span id="ebc6" class="ly kr hi mp b fi mu mv l mw mx">connector.name=postgresql<br/>connection-url=jdbc:postgresql://example.net:5432/database<br/>connection-user=root<br/>connection-password=secret<br/>allow-drop-table=true</span></pre><p id="b134" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意，您需要添加<code class="du mm mn mo mp b">allow-drop-table=true</code>以便dbt可以通过Trino删除表。</p><p id="e23b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> BigQuery </strong></p><p id="c158" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于BigQuery，我们将连接到dbt公共项目<strong class="is hj"> dbt-tutorial </strong>。必须将<a class="ae jx" href="https://github.com/victorcouste/trino-dbt-demo/blob/main/trino_etc/catalog/bigquery.properties" rel="noopener ugc nofollow" target="_blank"> bigquery.properties </a>文件复制到您的<strong class="is hj"> etc/catalog </strong> Trino文件夹中，并且您需要使用您的Google Cloud项目密钥设置<strong class="is hj">big query . credentials-file</strong>或<strong class="is hj">big query . credentials-key</strong>(<a class="ae jx" href="https://trino.io/docs/current/connector/bigquery.html" rel="noopener ugc nofollow" target="_blank">Trino doc</a>)。</p><p id="2e3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要获得这个项目的json密钥文件，你可以阅读<a class="ae jx" href="https://cloud.google.com/docs/authentication/getting-started" rel="noopener ugc nofollow" target="_blank"> Google文档</a>或<a class="ae jx" href="https://docs.getdbt.com/tutorial/setting-up#create-a-bigquery-project" rel="noopener ugc nofollow" target="_blank"> dbt文档</a>中关于BigQuery项目和JSON密钥文件创建的解释。</p><pre class="kd ke kf kg fd mq mp mr ms aw mt bi"><span id="e1eb" class="ly kr hi mp b fi mu mv l mw mx">connector.name=bigquery<br/>bigquery.project-id=dbt-tutorial<br/>bigquery.credentials-file=/your_folder/google-serviceaccount.json</span></pre><h1 id="ca10" class="kq kr hi bd ks kt lt kv kw kx lu kz la lb lv ld le lf lw lh li lj lx ll lm ln bi translated">dbt</h1><h2 id="69ad" class="ly kr hi bd ks lz ma mb kw mc md me la jb mf mg le jf mh mi li jj mj mk lm ml bi translated">个人资料:</h2><p id="78b2" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">您需要将<a class="ae jx" href="https://github.com/victorcouste/trino-dbt-demo/blob/main/trino_profile.yml" rel="noopener ugc nofollow" target="_blank"> trino_profile.yml </a>文件复制为您家中的profiles.yml。dbt文件夹<strong class="is hj"> ~/。dbt/profiles.yml </strong>。</p><p id="92ed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">关于<a class="ae jx" href="https://docs.getdbt.com/dbt-cli/configure-your-profile" rel="noopener ugc nofollow" target="_blank"> dbt轮廓</a>文件和<a class="ae jx" href="https://docs.getdbt.com/reference/warehouse-profiles/presto-profile" rel="noopener ugc nofollow" target="_blank"> Presto/Trino轮廓</a>的文件。</p><p id="400c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">默认目录是PostgreSQL，因为我们将在PostgreSQL中编写。</p><pre class="kd ke kf kg fd mq mp mr ms aw mt bi"><span id="3608" class="ly kr hi mp b fi mu mv l mw mx">trino:<br/>  target: dev<br/>  outputs:<br/>    dev:<br/>      type: presto<br/>      method: none  # optional, one of {none | ldap | kerberos}<br/>      user: admin<br/>      password:  # required if method is ldap or kerberos<br/>      catalog: postgresql<br/>      host: localhost<br/>      port: 8080<br/>      schema: public<br/>      threads: 1</span></pre><p id="575d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">08/09/21更新:使用新的<a class="ae jx" href="https://docs.getdbt.com/reference/warehouse-profiles/trino-profile" rel="noopener ugc nofollow" target="_blank"> Trino dbt插件</a> ( <a class="ae jx" href="https://github.com/starburstdata/dbt-trino" rel="noopener ugc nofollow" target="_blank"> GitHu </a> b)，概要文件<code class="du mm mn mo mp b">type</code>将被替换为<code class="du mm mn mo mp b">trino</code>、<a class="ae jx" href="https://docs.getdbt.com/reference/warehouse-profiles/trino-profile#set-up-a-trino-target" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><h2 id="f71a" class="ly kr hi bd ks lz ma mb kw mc md me la jb mf mg le jf mh mi li jj mj mk lm ml bi translated">项目:</h2><p id="86c0" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">在<a class="ae jx" href="https://docs.getdbt.com/reference/dbt_project.yml" rel="noopener ugc nofollow" target="_blank"> dbt项目文件</a>、<a class="ae jx" href="https://github.com/victorcouste/trino-dbt-demo/blob/main/dbt_project.yml" rel="noopener ugc nofollow" target="_blank"> dbt_project.yml </a>中，我们:</p><ul class=""><li id="21ce" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">使用trino配置文件</li><li id="07e6" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated">为BigQuery目录<strong class="is hj"> bigquery_catalog </strong>和模式(数据集)<strong class="is hj"> bigquery_schema </strong>定义变量</li><li id="42eb" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated">为输出设置默认PostgreSQL目录和模式(在模型下)</li></ul><pre class="kd ke kf kg fd mq mp mr ms aw mt bi"><span id="cf0e" class="ly kr hi mp b fi mu mv l mw mx">name: 'trino_project'<br/>version: '1.0.0'<br/>config-version: 2</span><span id="5673" class="ly kr hi mp b fi my mv l mw mx">profile: 'trino'</span><span id="325f" class="ly kr hi mp b fi my mv l mw mx">source-paths: ["models"]<br/>analysis-paths: ["analysis"]<br/>test-paths: ["tests"]<br/>data-paths: ["data"]<br/>macro-paths: ["macros"]<br/>snapshot-paths: ["snapshots"]</span><span id="beb3" class="ly kr hi mp b fi my mv l mw mx">target-path: "target"<br/>clean-targets:<br/>    - "target"<br/>    - "dbt_modules"</span><span id="b748" class="ly kr hi mp b fi my mv l mw mx">vars:<br/>  bigquery_catalog: bigquery<br/>  bigquery_schema: data_prep</span><span id="7981" class="ly kr hi mp b fi my mv l mw mx">models:<br/>  trino_project:<br/>      materialized: table<br/>      catalog: postgresql<br/>      schema: public</span></pre><p id="8814" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们还需要定义一个<a class="ae jx" href="https://docs.getdbt.com/docs/building-a-dbt-project/jinja-macros#macros" rel="noopener ugc nofollow" target="_blank"> dbt宏</a>来改变dbt在模型中生成和使用新模式的方式(BigQuery和PostgreSQL之间的变化)。宏文件<a class="ae jx" href="https://github.com/victorcouste/trino-dbt-demo/blob/main/macros/generate_schema_name.sql" rel="noopener ugc nofollow" target="_blank">generate _ schema _ name . SQL</a>。</p><pre class="kd ke kf kg fd mq mp mr ms aw mt bi"><span id="a9a2" class="ly kr hi mp b fi mu mv l mw mx">{% macro generate_schema_name(custom_schema_name, node) -%}</span><span id="9766" class="ly kr hi mp b fi my mv l mw mx">    {%- set default_schema = target.schema -%}<br/>    {%- if custom_schema_name is none -%}</span><span id="b432" class="ly kr hi mp b fi my mv l mw mx">        {{ default_schema }}</span><span id="425d" class="ly kr hi mp b fi my mv l mw mx">    {%- else -%}</span><span id="f971" class="ly kr hi mp b fi my mv l mw mx">        {{ custom_schema_name | trim }}</span><span id="c2f3" class="ly kr hi mp b fi my mv l mw mx">    {%- endif -%}</span><span id="dbe2" class="ly kr hi mp b fi my mv l mw mx">{%- endmacro %}</span></pre><h2 id="f181" class="ly kr hi bd ks lz ma mb kw mc md me la jb mf mg le jf mh mi li jj mj mk lm ml bi translated">型号:</h2><p id="551a" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">在<a class="ae jx" href="https://github.com/victorcouste/trino-dbt-demo/blob/main/models/customers.sql" rel="noopener ugc nofollow" target="_blank"> customers.sql </a>模型中，您可以看到我们:</p><ol class=""><li id="3691" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn mz ju jv jw bi translated">从jaffle_shop_orders BigQuery表中计算第一个和最后一个订单日期以及每个客户的订单数。</li><li id="859b" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn mz ju jv jw bi translated">将前面的结果与PostgreSQL jaffle _ shop _ customers表连接。</li><li id="4b7c" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn mz ju jv jw bi translated">将结果写入新的customers PostgreSQL表中。</li></ol><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="na ki l"/></div></figure></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><h1 id="ff7b" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">使用项目</h1><p id="5db6" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated"><a class="ae jx" href="https://trino.io/docs/current/installation/deployment.html#running-trino" rel="noopener ugc nofollow" target="_blank">用<code class="du mm mn mo mp b">./bin/launcher start</code>启动Trino服务器</a></p><p id="bf61" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Trino将默认监听8080端口。</p><p id="1268" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于dbt，运行以下命令:</p><ul class=""><li id="10b0" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated"><code class="du mm mn mo mp b">dbt --version</code>检查dbt是否安装了presto-dbt插件。</li><li id="a819" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated"><code class="du mm mn mo mp b">dbt debug</code>检查dbt项目和与Presto的连接。</li><li id="5e02" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated"><code class="du mm mn mo mp b">dbt seed</code>加载PostgreSQL中的<a class="ae jx" href="https://github.com/victorcouste/trino-dbt-demo/blob/main/data/jaffle_shop_customers.csv" rel="noopener ugc nofollow" target="_blank">jaffle _ shop _ customers . CSV</a>文件。</li><li id="3852" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated"><code class="du mm mn mo mp b">dbt run</code>要运行<a class="ae jx" href="https://github.com/victorcouste/trino-dbt-demo/blob/main/models/customers.sql" rel="noopener ugc nofollow" target="_blank">客户</a>模型，使用聚合的BigQuery表进行连接，并创建客户PostgreSQL表。</li><li id="824b" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated"><code class="du mm mn mo mp b">dbt test</code>测试customers表中两列的数据质量。</li></ul><p id="9291" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可以打开8080端口上启动的Trino Web UI(<a class="ae jx" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a>)来检查和监控dbt运行的SQL查询。</p></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><h1 id="5cfc" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">扩展项目</h1><p id="2044" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">对于输入数据集，您可以想象使用Google BigQuery公共数据集<a class="ae jx" href="https://cloud.google.com/bigquery/public-data" rel="noopener ugc nofollow" target="_blank"> bigquery-public-data </a>。</p><p id="e544" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您还可以使用以下命令直接在SQL模型文件中更改Trino目录和模式:</p><pre class="kd ke kf kg fd mq mp mr ms aw mt bi"><span id="855b" class="ly kr hi mp b fi mu mv l mw mx">{{<br/>    config(<br/>        catalog="bigquery",<br/>        schema="data_prep"<br/>     )<br/>}}</span></pre><p id="b526" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，您可以连接到另一个现有的Trino或<a class="ae jx" href="https://www.starburst.io/platform/starburst-enterprise/" rel="noopener ugc nofollow" target="_blank">star burst Enterprise</a>(Trino Enterprise edition)部署或集群，以获得更高的可扩展性、安全性和性能。</p><p id="3e84" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">玩得开心！</p></div></div>    
</body>
</html>