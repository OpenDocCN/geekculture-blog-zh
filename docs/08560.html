<html>
<head>
<title>Testing Express.js with Jest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Jest测试Express.js</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/testing-express-js-with-jest-8c6855945f03?source=collection_archive---------1-----------------------#2021-11-06">https://medium.com/geekculture/testing-express-js-with-jest-8c6855945f03?source=collection_archive---------1-----------------------#2021-11-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/faedd5dfcc878d2f391c2534fab741d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gxOcf0cBOxBsW1oR.jpg"/></div></div></figure><div class=""/><p id="5b8a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你好，我正在阅读关于Node.js的QA，他们谈到Jest是Node.js和React.js等其他库的一个非常好的选择，实际上我正在做一个小的Node.js项目，我们将用Jest测试他！</p><p id="2418" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你还没有从<a class="ae jo" rel="noopener" href="/geekculture/how-to-create-a-small-server-with-express-js-using-handlebars-aab529be375a"> Node.js </a>开始查看我最近的帖子</p><p id="fbea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">或者这边动态数据用<a class="ae jo" rel="noopener" href="/geekculture/how-to-insert-dynamic-data-using-express-js-and-handlebars-8b82461d0c7"> Node.js </a></p><p id="9b32" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重要！因为Express-handlebar更新了它的库，所以您需要更改导入</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="987b" class="jy jz ht ju b fi ka kb l kc kd">import { engine } from 'express-handlebars';</span></pre><p id="5e78" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并为此更改handleExp</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="c4fc" class="jy jz ht ju b fi ka kb l kc kd">app.engine( 'handlebars', engine({<br/>defaultLayout: 'main'<br/>}))</span></pre><p id="d352" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你也可以看视频</p><figure class="jp jq jr js fd hk"><div class="bz dy l di"><div class="ke kf l"/></div><figcaption class="kg kh et er es ki kj bd b be z dx">Complete post</figcaption></figure><h1 id="3641" class="kk jz ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">安装Jest</h1><p id="96ec" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">要安装Jest，您只需添加以下命令</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="42f1" class="jy jz ht ju b fi ka kb l kc kd">npm i --save-dev jest</span></pre><h1 id="aab0" class="kk jz ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">将命令添加到包JSON中</h1><p id="070a" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">要运行Jest测试，请将这个脚本添加到您的JSON包中</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="e16b" class="jy jz ht ju b fi ka kb l kc kd">"test": "jest"</span></pre><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es lm"><img src="../Images/ed3a04de6debe278c17f707d4aefcb0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*MQv_NYTg-gHTDhwuG4JnaQ.png"/></div><figcaption class="kg kh et er es ki kj bd b be z dx">Example script to the package JSON</figcaption></figure><h1 id="fc6a" class="kk jz ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">结构</h1><p id="515e" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">我们强烈建议创建一个名为__test__的目录，并在其中为您想要测试的每个部分添加您的测试文件，文件名为nameyouwant.test.js在这种情况下，您可以节省搜索测试文件的时间。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es ln"><img src="../Images/eae802d719a2dd679112e8f46d4b3417.png" data-original-src="https://miro.medium.com/v2/resize:fit:436/format:webp/1*3y_JlAhWzVfCidrEnnCIHQ.png"/></div><figcaption class="kg kh et er es ki kj bd b be z dx">Example test directory and test file</figcaption></figure><h1 id="a38a" class="kk jz ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">独立功能</h1><p id="f8be" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">我们需要分离我们用来呈现页面的每个函数，首先我们需要创建一个文件来封装这些函数，并且我们需要导出</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lo"><img src="../Images/02243fae0e389b6b058c26d71101c6ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SBgZzHNmJX1kwomSSWW9Yg.png"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx">Example encapsulate function and using exports</figcaption></figure><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="17ab" class="jy jz ht ju b fi ka kb l kc kd">const {fortune} = require( './index' )<br/><em class="lp">exports</em>.home = ( <em class="lp">req</em>, <em class="lp">res</em> ) =&gt; <em class="lp">res</em>.render( 'home' )<br/><em class="lp">exports</em>.about = ( <em class="lp">req</em>, <em class="lp">res</em> ) =&gt; <em class="lp">res</em>.render( 'about' )<br/><em class="lp">exports</em>.fortunes = ( <em class="lp">req</em>, <em class="lp">res</em> ) =&gt;  <em class="lp">res</em>.render('fortunes', { fortune: fortune() } )<em class="lp">exports</em>.notFound = ( <em class="lp">req</em>, <em class="lp">res</em> ) =&gt; <em class="lp">res</em>.render( '404' )<br/><em class="lp">exports</em>.errorServ = ( <em class="lp">err</em>, <em class="lp">req</em>, <em class="lp">res</em>, <em class="lp">next</em>) =&gt; <em class="lp">res</em>.render( '500' )</span></pre><h1 id="79fe" class="kk jz ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">创建我们的测试文件并开始测试</h1><p id="6f51" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">其次，我们需要创建handlers.test.js文件</p><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es lq"><img src="../Images/37d6b8b8e9e922cfc56cec7ce1eea368.png" data-original-src="https://miro.medium.com/v2/resize:fit:424/format:webp/1*9LyqcXRHdA-O1ySwmgsf-Q.png"/></div><figcaption class="kg kh et er es ki kj bd b be z dx">handlers test file</figcaption></figure><p id="01d0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第三，我们需要将所有函数导入到一个名为handlers的变量中，然后我们需要开始测试</p><p id="c5d6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了测试我们的函数，我们需要从需要两个参数的测试函数开始，第一个参数是测试的名称，第二个参数是一个函数，在这个函数中你可以预期你需要什么，例如我们需要测试render，它必须是home。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lr"><img src="../Images/a78743a16ed7a305d4b2cc8b17e7c72e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*7cdMlAwvA6DKyY8WyJIAPg.png"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx">Example testing home page</figcaption></figure><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="31b2" class="jy jz ht ju b fi ka kb l kc kd">const handlers = require( './../handlers' )<br/>test( 'testing home page', () =&gt; {<br/>const req = {},<br/>res = { render: jest.fn() }<br/>handlers.home( req, res )<br/>expect( res.render.mock.calls[ 0 ][ 0 ] ).toBe( 'home' )<br/>})</span></pre><p id="c211" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你看到我们有req和res变量，但是res变量有render和一个jest函数fn来模拟，然后我们期望render是home。</p><h1 id="fd65" class="kk jz ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">开玩笑</h1><p id="5886" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">要运行命令，请使用以下命令</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="f732" class="jy jz ht ju b fi ka kb l kc kd">npm run jest</span></pre><p id="355d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将运行测试，我们将在控制台输出中看到它们</p><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es ls"><img src="../Images/22321ffa57a556fd2329620eaaee6918.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*pZSfhTmmrqYbCiUQjwqoVw.png"/></div><figcaption class="kg kh et er es ki kj bd b be z dx">Example run test complete</figcaption></figure><p id="1a22" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果一切正常，我们可以看到“测试主页”通过了</p><p id="f588" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以用其他的来做，因为它们是一样的，我们可以用上面的例子，但是如果我们需要测试其他的东西，我们可以在需要测试对象的时候使用财富页面</p><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es lt"><img src="../Images/9664b7dbab45f3b0b995f25b5e7a4f92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*vh85ARVioOTNyBGf6zJs1g.png"/></div><figcaption class="kg kh et er es ki kj bd b be z dx">Example testing fortune page and object</figcaption></figure><p id="c470" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这几乎是一样的，除非我们需要检查动态变量的对象，在这种情况下，我们使用Jest文档中的调用[ 0 ][ 1 ]和expect.objectContaining()来检查对象和检查字符串，我们可以使用expect.any( String)或expect.stringMatching( /\w/)，它们可以接受正则表达式或字符串</p><h1 id="edab" class="kk jz ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">结束</h1><p id="c06a" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">再次运行命令，我们可以看到一切都是正确的！</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lu"><img src="../Images/2d4dfa0e0de7b8cb5399d530c4f2013f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*4uJjYYP_n5zjzC31-WQyXw.png"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx">Example all test in Jest</figcaption></figure><h1 id="b67b" class="kk jz ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">结论</h1><p id="c2a5" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">总之，Jest是测试我们的项目(如Express.js)的极好工具，文档非常棒，我真的找到了我需要的对象字符串、数字等。为了让你的项目保持高标准，你可以使用Jest。</p><h1 id="db2d" class="kk jz ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">来源</h1><div class="hh hi ez fb hj lv"><a href="https://jestjs.io/" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab dw"><div class="lx ab ly cl cj lz"><h2 class="bd hu fi z dy ma ea eb mb ed ef hs bi translated">玩笑</h2><div class="mc l"><h3 class="bd b fi z dy ma ea eb mb ed ef dx translated">Jest是一个JavaScript测试框架，旨在确保任何JavaScript代码库的正确性。它允许您…</h3></div><div class="md l"><p class="bd b fp z dy ma ea eb mb ed ef dx translated">jet js . io</p></div></div><div class="me l"><div class="mf l mg mh mi me mj hp lv"/></div></div></a></div><div class="hh hi ez fb hj lv"><a href="https://jestjs.io/docs/expect" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab dw"><div class="lx ab ly cl cj lz"><h2 class="bd hu fi z dy ma ea eb mb ed ef hs bi translated">期待笑话</h2><div class="mc l"><h3 class="bd b fi z dy ma ea eb mb ed ef dx translated">当您编写测试时，您经常需要检查值是否满足某些条件。expect让您可以访问…</h3></div><div class="md l"><p class="bd b fp z dy ma ea eb mb ed ef dx translated">jet js . io</p></div></div><div class="me l"><div class="mk l mg mh mi me mj hp lv"/></div></div></a></div><div class="hh hi ez fb hj lv"><a href="https://www.amazon.com/Web-Development-Node-Express-Leveraging/dp/1492053511" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab dw"><div class="lx ab ly cl cj lz"><h2 class="bd hu fi z dy ma ea eb mb ed ef hs bi translated">使用Node和Express进行Web开发:利用JavaScript堆栈</h2><div class="mc l"><h3 class="bd b fi z dy ma ea eb mb ed ef dx translated">使用Node和Express进行Web开发:利用Amazon.com的JavaScript堆栈。*免费*送货到…</h3></div><div class="md l"><p class="bd b fp z dy ma ea eb mb ed ef dx translated">www.amazon.com</p></div></div><div class="me l"><div class="ml l mg mh mi me mj hp lv"/></div></div></a></div></div></div>    
</body>
</html>