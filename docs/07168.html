<html>
<head>
<title>Authentication flow in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular中的认证流程</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/authentication-flow-in-angular-93bd79080908?source=collection_archive---------0-----------------------#2021-09-10">https://medium.com/geekculture/authentication-flow-in-angular-93bd79080908?source=collection_archive---------0-----------------------#2021-09-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3f65" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">OpenId连接</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/292487f63edbf8cbbd7de2087749c9c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ytww7CdYV5noFmZO1fhJGQ.png"/></div></div></figure><p id="6d54" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">每个网站都有关闭的资源。为了获得这些资源，用户必须拥有这样做的权利。这意味着我们的网站必须有一个认证流程。在本文中，我们在一个angular项目中实现了OpenId Connect/OAuth2。</p><p id="9892" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在本文中，我们只讨论前端部分。但是前端离不开后端。我们的服务器必须有一个OpenID连接的实现。当服务器端准备就绪时，就该设置前端部分了。</p><p id="bf8a" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">首先，我们需要安装一个oidc客户端。根据npm <a class="ae kf" href="https://www.npmjs.com/package/oidc-client" rel="noopener ugc nofollow" target="_blank">网站</a>的说法，我们需要编写一个命令</p><p id="56af" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">npm安装oidc-客户端</p><p id="7c78" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">下一步是创建AuthenticationService。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kg"><img src="../Images/0b7511bd106e1e4c9cdfa425f3a24df8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tmh5XZNMGT4xl1-ZoJrLmw.png"/></div></div></figure><p id="4100" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">AuthenticationService的主要部分是来自oidc的UserManager。在我们使用UserManager之前，我们需要初始化它。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kh"><img src="../Images/d118d2ac5cba3caee1009cef1392373a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9_eDYlQI9nXV9nlNDw3Kcg.png"/></div></div></figure><p id="5fea" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">要初始化UserManager，我们必须创建一个设置模型。我描述了我们需要填充的所有必要属性。如果你对这些属性有疑问，你需要阅读<a class="ae kf" href="https://openid.net/connect/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ki"><img src="../Images/9d16ceaf6dba5f3ddaeac5990bb6cd08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c7i-YZFur8c_CHyfHHIPQA.png"/></div></div></figure><p id="ded5" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在属性redirect_uri、post_logout_redirect_uri、silent_redirect_uri中，我们为使用我们的AuthenticationService的特定逻辑的组件编写URL。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kj"><img src="../Images/d9c5c65790845e77a1957f56474cfc08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cHZNPO3KiuBZ1WfwMAce2Q.png"/></div></div></figure><p id="e73b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这些组件中的每一个都使用AuthenticationService中的方法，然后我们将用户重定向到home组件。只有静默重定向不会重定向用户，因为oidc是在幕后进行的。</p><p id="c8b3" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在route模块中，您可以看到home路由有AuthGuard。该安全检查是用户登录与否。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kk"><img src="../Images/55f0a41708e7e2d3772b204fd931409e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CN0K7FIRtzMtBUNm4TLS8w.png"/></div></div></figure><p id="fe49" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">用户登录后，oidc提供一个访问令牌。我们需要在请求中使用这个令牌。最好的方法是使用拦截器。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kl"><img src="../Images/61a0058ef0d4f63611f424acb76fdd5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x3dvhwjWLk786YAPN7pVlQ.png"/></div></div></figure><p id="a77f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">就是这样。现在，您的angular应用程序被读取以进行身份验证。</p><p id="0ca9" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果你需要仔细看看<a class="ae kf" href="https://github.com/8Tesla8/angular-oidc" rel="noopener ugc nofollow" target="_blank">这个项目，这里是</a> <a class="ae kf" href="https://github.com/8Tesla8/angular-theme-scss" rel="noopener ugc nofollow" target="_blank">的链接。</a></p></div><div class="ab cl km kn gp ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="hb hc hd he hf"><p id="9452" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><em class="kt">原载于2021年9月10日http://tomorrowmeannever.wordpress.com</em><em class="kt">的</em> <a class="ae kf" href="https://tomorrowmeannever.wordpress.com/2021/09/10/authentication-flow-with-openid-connect-in-angular/" rel="noopener ugc nofollow" target="_blank"> <em class="kt">。</em></a></p></div></div>    
</body>
</html>