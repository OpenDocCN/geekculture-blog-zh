<html>
<head>
<title>Continuous Integration and Delivery using AWS and Github</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS和Github进行持续集成和交付</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/continuous-integration-and-delivery-using-aws-and-github-bafe848261b1?source=collection_archive---------15-----------------------#2021-05-06">https://medium.com/geekculture/continuous-integration-and-delivery-using-aws-and-github-bafe848261b1?source=collection_archive---------15-----------------------#2021-05-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="1f34" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">使用CodeBuild &amp; Elastic Beanstalk部署Node.js应用程序</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/5881848b7153a70bb99ef88c06e985f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eynr5wEkZAcreeoy1-zH4w.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx"><a class="ae jn" href="https://www.google.com/url?sa=i&amp;url=https%3A%2F%2Fdeanna.dev%2Fall-about-cicd%2F&amp;psig=AOvVaw277fPYWgxOSC9owEVB8BIV&amp;ust=1620349686496000&amp;source=images&amp;cd=vfe&amp;ved=0CAIQjRxqFwoTCLCTto7vs_ACFQAAAAAdAAAAABAD" rel="noopener ugc nofollow" target="_blank">source</a></figcaption></figure><p id="9c00" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">当与团队一起开发时，您可能希望为代码何时能够合并到您的主分支建立规则，并控制新代码何时以及如何部署到特定环境。</p><p id="6f6b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">例如，当团队成员准备将新代码合并到主分支中时:</p><ul class=""><li id="2868" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated">我们首先要确保它至少有另一个团队成员的批准</li><li id="cc36" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">新的变化不会破坏任何现有的测试</li></ul><p id="82fd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦一个拉请求满足了上面的标准，我们希望合并到我们的主分支，以自动地将变更部署到一个分段环境中。</p><h1 id="12e5" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">应用程序</h1><p id="fa5d" class="pw-post-body-paragraph jo jp hi jq b jr lq ij jt ju lr im jw jx ls jz ka kb lt kd ke kf lu kh ki kj hb bi translated">出于演示的目的，我创建了一个<a class="ae jn" href="https://github.com/brianfromlife/aws-ci-cd" rel="noopener ugc nofollow" target="_blank">小型Express应用程序</a>，您可以重新创建自己或者克隆它。</p><ul class=""><li id="8b5c" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated">应用程序有一个成功返回“hello”的基本路由。</li><li id="18fd" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">您可以运行<em class="lv"> npm运行测试</em>来查看测试示例</li></ul><p id="a33f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">📔<strong class="jq hj">默认情况下，Elastic Beanstalk会监听端口8080，所以这个应用程序会监听这个端口。</strong></p><h1 id="871c" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">创建一个弹性Beanstalk应用程序</h1><p id="9551" class="pw-post-body-paragraph jo jp hi jq b jr lq ij jt ju lr im jw jx ls jz ka kb lt kd ke kf lu kh ki kj hb bi translated">首先，让我们创建一个新的弹性Beanstalk应用程序。出于本文的目的，我们将保持简单并使用默认配置。</p><p id="6943" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">导航到Elastic Beanstalk门户并单击<strong class="jq hj">创建应用程序</strong>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lw"><img src="../Images/46d83b4f975a26db48b8318e887da524.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3lCGNKZKVU3ArMuLk1aFGA.png"/></div></div></figure><p id="76e2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">输入一个<strong class="jq hj">应用程序名</strong>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lx"><img src="../Images/f18b8a7a239be42008efbf5be81008ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6j-N1SJxacKzMSCX73nAww.png"/></div></div></figure><p id="cd30" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">选择Node.js作为<strong class="jq hj">平台</strong>，使用最新或推荐的<strong class="jq hj">平台分支</strong>和<strong class="jq hj">平台版本</strong>。然后选择<strong class="jq hj">样本应用</strong>。最后，点击<strong class="jq hj">创建应用</strong>按钮。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ly"><img src="../Images/fb4b1987f1ea7130e0a6c40dd54391e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fhX1I7L_z79u6MyezlLX_w.png"/></div></div></figure><p id="d983" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">基础设施配置完成后，示例应用程序将在由Elastic Beanstalk生成的URL上可用。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lz"><img src="../Images/cfe11a1823d938ed7ebe349fd6bda5a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*COXeyr17GbUOi4EpI6DM2g.png"/></div></div></figure><h1 id="6d3f" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">创建S3存储桶</h1><p id="50ea" class="pw-post-body-paragraph jo jp hi jq b jr lq ij jt ju lr im jw jx ls jz ka kb lt kd ke kf lu kh ki kj hb bi translated">我们将使用S3来存储一个包含新应用程序代码的zip文件。当我们部署一个新的应用程序时，Elastic Beanstalk会在S3文件夹中查找源代码。</p><ol class=""><li id="37b0" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj ma kq kr ks bi translated">导航到S3门户网站并点击<strong class="jq hj">创建存储桶</strong>。</li><li id="30b0" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj ma kq kr ks bi translated">输入唯一的存储桶名称。</li><li id="4590" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj ma kq kr ks bi translated">点击屏幕底部的<strong class="jq hj">创建存储桶</strong>。</li></ol><h1 id="2eb5" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">创建IAM用户</h1><p id="fe72" class="pw-post-body-paragraph jo jp hi jq b jr lq ij jt ju lr im jw jx ls jz ka kb lt kd ke kf lu kh ki kj hb bi translated">在CodeBuild中，我们将使用命令行将zip文件部署到S3，并更新Elastic Beanstalk环境。让我们创建一个对这两种AWS服务都有权限的CLI用户。</p><p id="70b0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> ⚠️出于演示目的，新的IAM将完全访问S3和EBS。这不是最佳实践，因为您应该将访问权限限制在仅需要的范围内。</strong></p><p id="0caa" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">导航到IAM门户。在左侧选择<strong class="jq hj">用户</strong>，然后点击<strong class="jq hj">添加用户</strong>按钮。</p><p id="9cff" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">输入一个<strong class="jq hj">用户名</strong>并给用户<strong class="jq hj">编程访问</strong>。然后，点击<strong class="jq hj">下一步:权限</strong>按钮。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mb"><img src="../Images/26faa065686214270e80b44e19c87583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uKJI96F3qhiDJIQM4QqkAg.png"/></div></div></figure><p id="5834" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">选择<strong class="jq hj">直接附加现有策略</strong>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mc"><img src="../Images/ab0cde990e5435ed4a9d5a09e3e5cd58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n0O4GTK4liP8GorTiWwe3g.png"/></div></div></figure><p id="2d43" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在策略选择列表中，选中<strong class="jq hj"> AmazonS3FullAccess </strong>和<strong class="jq hj">administrator access-AWSElasticBeanstalk</strong>的复选框。然后点击<strong class="jq hj">下一步:标签</strong>按钮。</p><p id="bb45" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在标签页面上，单击<strong class="jq hj"> Next: Review </strong>按钮，因为我们不会为这篇文章添加标签。</p><p id="9436" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在“查看”页面上，您应该看到以下内容:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es md"><img src="../Images/301b441d18fd6d202035c742cb0109ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YLvpcxdscqcHqDjjdzNVIw.png"/></div></div></figure><p id="2d6a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果权限看起来正确，点击<strong class="jq hj">创建用户</strong>按钮。</p><p id="09c4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">⚠️在下一个屏幕上，确保将<strong class="jq hj">访问密钥ID </strong>和<strong class="jq hj">秘密访问密钥</strong>暂时复制到安全位置。我们将在后面的代码构建步骤中使用这些值。</p><h1 id="977c" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">拉请求的代码生成项目</h1><p id="14b0" class="pw-post-body-paragraph jo jp hi jq b jr lq ij jt ju lr im jw jx ls jz ka kb lt kd ke kf lu kh ki kj hb bi translated">首先，我们希望创建一个CodeBuild项目来安装Node.js依赖项并运行任何测试。如果测试通过，CodeBuild将通知Github测试已经通过，并更新pull请求的状态检查。</p><p id="786a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">导航到CodeBuild门户并点击<strong class="jq hj">创建项目</strong>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es me"><img src="../Images/549c88bc0935957c67eb13349f64fb31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jkgH8Bd-ijKHHjNFdFVqRg.png"/></div></div></figure><p id="0af5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<em class="lv">项目配置</em>部分，输入<strong class="jq hj">项目名称。</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mf"><img src="../Images/bde1122ae2937c5569bd45bd51090871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wi7Rkko8WNvNPyLYoNsUjA.png"/></div></div></figure><p id="0752" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<em class="lv">源</em>部分，选择GitHub作为<strong class="jq hj">源提供者。</strong>如果你还没有连接你的Github帐户来访问代码构建。然后，在我的GitHub账户中选择<strong class="jq hj">资源库。在<strong class="jq hj"> Github资源库</strong>下拉菜单中，选择包含本文代码的资源库。</strong></p><p id="13c7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">当您的构建开始时，单击复选框<strong class="jq hj">向源代码提供者报告构建状态。</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mg"><img src="../Images/d281f8aba7326cabd049fa451c810169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C5J2qsHyxegztX3wOCbEiA.png"/></div></div></figure><p id="9940" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<strong class="jq hj">主源webhook事件</strong>部分的<strong class="jq hj">，</strong>中，每次代码变更被推送到这个库时，点击<strong class="jq hj">重建的复选框。</strong>然后在<strong class="jq hj">事件类型</strong>下拉列表中，选择<em class="lv"> PULL_REQUEST_CREATED </em>和<em class="lv"> PULL_REQUEST_UPDATED </em>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mh"><img src="../Images/de437aeeac1882c751cb262e48b4b7e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CN7RLAhBJ9xGEsd0sgUmaQ.png"/></div></div></figure><p id="d590" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<em class="lv">环境</em>部分，选择<strong class="jq hj">管理镜像</strong>。然后操作系统选择<strong class="jq hj">亚马逊Linux 2 </strong>。对于运行时间，选择<strong class="jq hj">标准</strong>，然后选择最新的图像。选择<strong class="jq hj"> Linux </strong>作为环境类型。最后，允许CodeBuild创建一个新的服务角色。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/7d752a3a9f8f5c6012a97170d814fc26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L0NWGmL6-73xN_UCpHiFcA.png"/></div></div></figure><p id="5c18" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<strong class="jq hj"> Buildspec </strong>部分，选择<strong class="jq hj">使用一个Buildspec文件。</strong>将Buildspec名称设置为<em class="lv"> pipeline/build.yml. </em>在我们的存储库中，这是我们将存储该代码构建步骤的文件夹路径和文件。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mj"><img src="../Images/0332460d9067fce1c3b20396c7c18f7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5fpGakmQ6Ru9E-dycnDn8A.png"/></div></div></figure><p id="4801" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后点击页面底部的<strong class="jq hj">创建构建项目</strong>。</p><h1 id="62d9" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">用于合并的代码生成项目</h1><p id="ca8c" class="pw-post-body-paragraph jo jp hi jq b jr lq ij jt ju lr im jw jx ls jz ka kb lt kd ke kf lu kh ki kj hb bi translated">我们还想创建一个CodeBuild项目，当一些东西合并到主分支时，它会将我们的应用程序部署到Elastic Beanstalk。步骤与之前完全相同，除了一些小的变化:</p><ul class=""><li id="ac41" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated">在<strong class="jq hj">源</strong>部分，将<strong class="jq hj">源版本</strong>设置为<em class="lv">主版本</em>。</li><li id="0f27" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">为该CodeBuild项目指定另一个名称，以指示其用于部署。比如我把我的命名为<em class="lv">AWS-ci-CD-staging-deploy</em>。</li><li id="7e77" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">在<strong class="jq hj">主源webhook事件中，</strong>选择<strong class="jq hj"> PULL_REQUEST_MERGED </strong>作为<strong class="jq hj">事件类型</strong>。</li><li id="7234" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">在<strong class="jq hj"> Buildspec </strong>部分，使<strong class="jq hj"> Buildspec名称</strong><em class="lv">pipeline/deploy . yml .</em></li></ul><p id="7a04" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">此外，在<strong class="jq hj">环境</strong>部分，展开<strong class="jq hj">附加配置部分</strong>并添加以下环境变量。</p><p id="7d05" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对于<strong class="jq hj"> DEPLOY_BUCKET </strong>，使用您之前创建的BUCKET名称。对于<strong class="jq hj"> EBS_APP_NAME </strong>和<strong class="jq hj"> EBS_ENV_NAME </strong>，使用来自Elastic Beanstalk应用程序的应用程序和环境名称。对于<strong class="jq hj"> AWS_ACCESS_KEY_ID </strong>和<strong class="jq hj"> AWS_SECRET_ACCESS_KEY </strong>环境变量，使用前面IAM步骤中的访问ID和访问键。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mk"><img src="../Images/9a6d59d0dbf5e2d5a236e6d9c53508c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*bdLL7t9VmzPEHuopN17zKw.png"/></div></figure><p id="5bbd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这些值将用于存储库中的<em class="lv">管道/部署. yml </em>文件。</p><p id="1ee9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">完成后，点击页面底部的<strong class="jq hj">创建构建项目</strong>。</p><h1 id="2ffb" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">创建一个新的分支和拉请求</h1><p id="0d52" class="pw-post-body-paragraph jo jp hi jq b jr lq ij jt ju lr im jw jx ls jz ka kb lt kd ke kf lu kh ki kj hb bi translated">在测试新功能之前，让我们创建一个新的拉请求。我做了一个小改动，创建了一个新分支，并创建了一个拉请求。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ml"><img src="../Images/fe64f06ee75a4ad8515094f05de8eafd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d4Ak942rV1Z58yMC0Nw8NA.png"/></div></div></figure><p id="23f2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">到目前为止，您应该能够毫无问题地合并到新代码中。让我们对存储库设置进行一些更改，这样我们可以确保测试通过，并且在合并之前我们有来自另一个团队成员的审查。</p><h1 id="abd9" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">保护Github中的主要分支</h1><p id="3dac" class="pw-post-body-paragraph jo jp hi jq b jr lq ij jt ju lr im jw jx ls jz ka kb lt kd ke kf lu kh ki kj hb bi translated">在本文的存储库中，转到存储库的<strong class="jq hj">设置</strong>选项卡。在左侧选择<strong class="jq hj">分支</strong>，然后点击<strong class="jq hj">添加规则</strong>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mm"><img src="../Images/f61ae88ff72213f2d7f78ae205caa7d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m906XSRAjUGUceikFtdI7Q.png"/></div></div></figure><p id="8029" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<strong class="jq hj">保护匹配分支</strong>部分，给分支规则命名，然后我们需要选择几个值。</p><ul class=""><li id="12ac" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated"><strong class="jq hj">合并前要求拉式请求审核，</strong>设置为1</li><li id="7f34" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated"><strong class="jq hj">要求在合并前通过状态检查</strong>和<strong class="jq hj">要求在合并前分支是最新的</strong></li><li id="84e8" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">在status checks列表中，为pull请求选择具有您的CodeBuild项目名称的选项(我在本文的测试中有多个项目)。</li><li id="7bd2" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">选择<strong class="jq hj">包含管理员</strong>，这样你就不能直接推送至主分支。</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mn"><img src="../Images/49291cfd86fb62aa6bd553bed360995e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7DWCzEqoQR9wWGYGpbrXVA.png"/></div></div></figure><p id="62af" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">⚠️如果你是一个单独的开发者，或者只是想立即看到更新，你可以删除对评论数量的要求，这样PR就可以只与通过测试的项目合并。</p><p id="6c15" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">完成后，点击页面底部的<strong class="jq hj">保存更改</strong>。</p><p id="8388" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果我们导航回“拉”请求，我们可以看到一个新的需求:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mo"><img src="../Images/f4df7c2a1e860bf4cdda083582d1abb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DYkbiJV0q2aUlQZqfOiMvw.png"/></div></div></figure><p id="fd62" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们将测试更新为失败。在<em class="lv"> app.test.js </em>文件中，将预期响应文本从<em class="lv"> hello、</em>更改为<em class="lv"> hell </em>，然后上推更改<em class="lv">。</em>过一会儿，您应该会看到pull请求更新了CodeBuild执行的结果。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mp"><img src="../Images/f8099fdb5a1f20be1fe542e5badbdc71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TXSbXlZk40-2umi_Zwa8Sg.png"/></div></div></figure><p id="4265" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果你点击<strong class="jq hj"> <em class="lv"> Details </em> </strong>链接，它会直接带你到CodeBuild项目的日志，看看为什么测试失败了。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mq"><img src="../Images/16141284b557876f566855f9c26b2396.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KkVFo6FwgqTofRJtpl6R1A.png"/></div></div></figure><p id="a4de" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">把测试改回来，这样它就能通过，并把修改推回来。拉请求现在将显示测试通过。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mr"><img src="../Images/7d82b0c6a77c1fa58a61f2bdca7fbaad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n1pG1IOHaK_G46D345wRwg.png"/></div></div></figure><p id="fe47" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，要么删除另一个审阅的分支要求，要么让另一个用户批准该提取请求。</p><p id="67d4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后，将拉请求合并到主分支中。</p><p id="0c04" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，如果您访问Elastic Beanstalk应用程序门户中的URL，您应该会看到新代码，它返回<em class="lv"> hello </em>。</p><h1 id="ddbe" class="ky kz hi bd la lb lc ld le lf lg lh li io lj ip lk ir ll is lm iu ln iv lo lp bi translated">它是如何工作的</h1><p id="27ac" class="pw-post-body-paragraph jo jp hi jq b jr lq ij jt ju lr im jw jx ls jz ka kb lt kd ke kf lu kh ki kj hb bi translated">要了解发生了什么，请查看存储库的pipeline文件夹中的<em class="lv"> build.yml </em>和<em class="lv"> deploy.yml </em>。代码非常简单，它完成了工作。</p><p id="e30e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对于部署步骤，我们基本上:</p><ul class=""><li id="303d" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated">安装依赖项</li><li id="a5c6" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">为弹性豆茎所需的一切创建一个zip文件</li><li id="d7ef" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">将新的zip文件推送到我们的S3文件夹</li><li id="ea66" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">为我们的Elastic Beanstalk应用程序创建一个新的应用程序版本，并将源代码设置为S3文件，使用内部版本号作为版本号</li><li id="bc1c" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">更新环境以获得新的源代码，并将其部署到我们的实例中</li></ul><p id="7b50" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果部署出现任何问题，在Elastic Beanstalk门户中，您可以选择一个应用程序版本，并使用select<strong class="jq hj">Actions&gt;Deploy</strong>来重新部署该版本。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ms"><img src="../Images/ac4df320d0fc410063d6e310c7285e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VGWVGTyPYyq8__DOzNNvkQ.png"/></div></div></figure></div><div class="ab cl mt mu gp mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="hb hc hd he hf"><p id="7030" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">感谢阅读！</p></div></div>    
</body>
</html>