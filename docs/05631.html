<html>
<head>
<title>AKS with Calico Network Policies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带Calico网络策略的AK</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/aks-with-calico-network-policies-8cdfa996e6bb?source=collection_archive---------4-----------------------#2021-07-27">https://medium.com/geekculture/aks-with-calico-network-policies-8cdfa996e6bb?source=collection_archive---------4-----------------------#2021-07-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/9184d1b04c65a94c6769369b05dc6746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oeI24CEd4oJLyYKkuGGxQw.png"/></div></div></figure><div class=""/><div class=""><h2 id="f785" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">将Calico网络策略用于Azure Kubernetes服务器</h2></div><p id="e3a7" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu"><a class="ae ke" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">中的</strong> </a>网络策略Kubernetes </strong> </a>本质上是针对pod的防火墙。默认情况下，可以从任何没有保护的地方访问pod。如果您喜欢使用<a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">网络策略</strong> </a>，您需要安装一个支持此功能的<a class="ae ke" href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">网络插件</strong> </a>。本文将演示如何在<a class="ae ke" href="https://azure.microsoft.com/services/kubernetes-service/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> AKS </strong> </a>上使用<a class="ae ke" href="https://www.tigera.io/project-calico/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Calico </strong> </a>网络插件来使用此功能。</p><h2 id="0b80" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">默认Kubenet网络插件</h2><p id="465f" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated"><a class="ae ke" href="https://azure.microsoft.com/services/kubernetes-service/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> AKS </strong> </a>以及许多其他<a class="ae ke" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Kubernetes </strong> </a>实现的默认网络插件是<a class="ae ke" href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/#kubenet" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">kubenet</strong></a><strong class="jk hu">:</strong></p><blockquote class="lf lg lh"><p id="f963" class="ji jj li jk b jl jm iu jn jo jp ix jq lj js jt ju lk jw jx jy ll ka kb kc kd hb bi translated">一个非常基本、简单的网络插件，仅在Linux上。它本身不实现更高级的功能，如跨节点联网或网络策略(<a class="ae ke" href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/#kubenet" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> ref </strong> </a>)</p></blockquote><p id="7207" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">虽然<a class="ae ke" href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/#kubenet" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> kubenet </strong> </a>网络插件有限，但它提供了一些安全性，因为pod位于NAT后面的覆盖网络上。因此，除非操作员(您)配置一个<a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">服务</strong> </a> <strong class="jk hu"> </strong>资源(<code class="du lm ln lo lp b">NodePort</code>或<code class="du lm ln lo lp b">LoadBalancer</code>)或一个<a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/ingress/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">入口</strong> </a>资源，否则无法从集群外部访问pod。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lq"><img src="../Images/426e19f4230d2a3d3e20e03420b7d634.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CtioDjNVL67lQrE-e8RgVg.png"/></div></div></figure><p id="ea4a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><strong class="jk hu">关于图</strong>:使用<a class="ae ke" href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/#kubenet" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> kubenet </strong> </a>，向运行在同一个工作者节点上的pod前进的流量，然后它将只去本地桥<code class="du lm ln lo lp b">cbr0</code>到达目标pod。如果目的地是另一个工作节点上的pod，那么流量将通过IP转发发送到节点外部，并使用Azure UDR(用户定义的路由)，将到达正确的工作节点，然后向下发送到该节点的本地桥<code class="du lm ln lo lp b">cbr0</code>。</p><h2 id="e882" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">保护内部群集流量</h2><blockquote class="lf lg lh"><p id="c380" class="ji jj li jk b jl jm iu jn jo jp ix jq lj js jt ju lk jw jx jy ll ka kb kc kd hb bi translated">为什么我们需要对容器之间的网络数据包进行粒度控制？(参考<a class="ae ke" href="https://www.linkedin.com/in/eclansky/" rel="noopener ugc nofollow" target="_blank">同事</a></p></blockquote><p id="fda3" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">定义网络策略允许您在为多级应用服务时启用类似于<a class="ae ke" href="https://en.wikipedia.org/wiki/Defense_in_depth_(computing)" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">深度防御</strong> </a>的功能。从本质上讲，您可能希望限制对传统虚拟机服务的访问的任何原因都与您希望限制对运行在容器上的服务的访问是一样的。</p><p id="9e1e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">如果恶意或错误的实体破坏顶层，例如提供web服务的容器，<a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">网络策略</strong> </a>可以限制可以到达的进一步访问或层。</p><p id="44f4" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">下面是一些可以使用<a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">网络策略</strong> </a>的明显场景:</p><ul class=""><li id="8d90" class="lv lw ht jk b jl jm jo jp jr lx jv ly jz lz kd ma mb mc md bi translated">限制后台敏感的或T2关键的服务，如数据库、秘密金库、管理等。</li><li id="2c4e" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated">限制<em class="li">单个租户</em>之间的流量，以便包含客户<em class="li">租户</em>的服务的pod无法与其他客户<em class="li">租户</em>通信。</li><li id="c74d" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated">限制来自<a class="ae ke" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Kubernetes </strong> </a>集群外部的外部流量，尤其是当网络插件将pod与其他虚拟机停放在同一子网上时。</li><li id="235d" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated">在服务不应该与未知服务通信的地方限制出站流量，尤其是在公共互联网上。</li></ul><h2 id="45a7" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">Azure网络插件</h2><p id="17d2" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">Azure提供了一个更强大的插件，名为<a class="ae ke" href="https://github.com/Azure/azure-container-networking" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">Azure CNI</strong></a><strong class="jk hu"/>，它将把pod与虚拟机停放在同一子网中。这对于其他虚拟机在不通过<a class="ae ke" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Kubernetes </strong> </a>服务的情况下访问<a class="ae ke" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">Kubernetes</strong></a>pods非常有用。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lq"><img src="../Images/5b98329bbfb099426d13dca515a47f73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_a2rBQ5H9M8yu087MhWv7A.png"/></div></div></figure><p id="3984" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">这里明显的<strong class="jk hu"> <em class="li">危险</em> </strong>是所有的pod现在都暴露在<a class="ae ke" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Kubernetes </strong> </a>集群之外的外部流量中，因此<a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">网络策略</strong> </a>在这种情况下肯定变得至关重要。</p><p id="0afd" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><strong class="jk hu">注意</strong>:<a class="ae ke" href="https://github.com/Azure/azure-container-networking" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">Azure CNI</strong></a>网络插件附带了<a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">网络策略</strong> </a>功能的有限子集，并依赖于底层Azure网络基础设施。使用<a class="ae ke" href="https://www.tigera.io/project-calico/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Calico </strong> </a>，您可以享受全套网络策略功能，而无需依赖Azure网络基础设施。</p><h2 id="b704" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">教程概述</h2><p id="abd1" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">本文介绍了如何在一个真实的场景中使用网络策略，该场景包含一个敏感且关键的服务:一个名为d graph的高性能分布式图形数据库。</p><p id="5c30" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">本文将通过这些测试或步骤来运行:</p><ol class=""><li id="52c7" class="lv lw ht jk b jl jm jo jp jr lx jv ly jz lz kd mj mb mc md bi translated">在单独的名称空间中部署分布式图形数据库<a class="ae ke" href="https://dgraph.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Dgraph </strong> </a>和<a class="ae ke" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Python </strong> </a>客户端pod</li><li id="5a5f" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd mj mb mc md bi translated">部署一个<a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">网络策略</strong> </a>，阻止所有流量，除了来自相同名称空间内的pod或来自具有所需标签的名称空间内的pod</li><li id="2d50" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd mj mb mc md bi translated">在包含客户机pod的名称空间上添加所需的标签，以允许访问数据库服务(<a class="ae ke" href="https://dgraph.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Dgraph </strong> </a>)</li></ol><h1 id="d16c" class="mk kg ht bd kh ml mm mn kl mo mp mq kp iz mr ja ks jc ms jd kv jf mt jg ky mu bi translated">系列文章</h1><p id="4362" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">本系列展示了如何保护gRPC和HTTP流量并对其进行负载平衡。</p><ol class=""><li id="c66d" class="lv lw ht jk b jl jm jo jp jr lx jv ly jz lz kd mj mb mc md bi translated"><a class="ae ke" href="https://joachim8675309.medium.com/aks-with-azure-container-registry-b7ff8a45a8a" rel="noopener">带Azure容器注册表的AKS</a></li><li id="e8b0" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd mj mb mc md bi translated"><a class="ae ke" href="https://joachim8675309.medium.com/aks-with-calico-network-policies-8cdfa996e6bb" rel="noopener"><strong class="jk hu">【AKS】与</strong> </a> <strong class="jk hu"> </strong>(本文)</li><li id="691f" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd mj mb mc md bi translated"><a class="ae ke" href="https://joachim8675309.medium.com/linkerd-service-mesh-on-aks-a75d60ef4f5a" rel="noopener">带Linkerd服务网格的AKS</a></li><li id="5606" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd mj mb mc md bi translated"><a class="ae ke" href="https://joachim8675309.medium.com/istio-service-mesh-on-aks-1b6ed16f6890" rel="noopener">带Istio服务网格的AKS</a></li></ol><h1 id="876a" class="mk kg ht bd kh ml mm mn kl mo mp mq kp iz mr ja ks jc ms jd kv jf mt jg ky mu bi translated">前一篇文章</h1><p id="68e6" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">在上一篇文章中，我记录了如何构建容器映像并将其推送到<a class="ae ke" href="https://azure.microsoft.com/services/container-registry/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Azure容器注册表</strong> </a>。本文的部分内容将被重用来演示服务被阻塞时的<a class="ae ke" href="https://developer.mozilla.org/docs/Web/HTTP" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> HTTP </strong> </a>和<a class="ae ke" href="https://grpc.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> gRPC </strong> </a>连接。</p><div class="hh hi ez fb hj mv"><a href="https://joachim8675309.medium.com/aks-with-azure-container-registry-b7ff8a45a8a" rel="noopener follow" target="_blank"><div class="mw ab dw"><div class="mx ab my cl cj mz"><h2 class="bd hu fi z dy na ea eb nb ed ef hs bi translated">带有Azure容器注册表的AKS</h2><div class="nc l"><h3 class="bd b fi z dy na ea eb nb ed ef dx translated">通过Azure Kubernetes服务器使用Azure容器注册表</h3></div><div class="nd l"><p class="bd b fp z dy na ea eb nb ed ef dx translated">joachim8675309.medium.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj hp mv"/></div></div></a></div><h1 id="1279" class="mk kg ht bd kh ml mm mn kl mo mp mq kp iz mr ja ks jc ms jd kv jf mt jg ky mu bi translated">要求</h1><p id="73d8" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">要创建<a class="ae ke" href="https://azure.microsoft.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Azure </strong> </a>云资源，您需要订阅，以便创建资源。</p><h2 id="58ff" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">所需工具</h2><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nk"><img src="../Images/7225cfcc6a1dfd780c6d331fbad4a7ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QnM1Sp-tk5RGZHla8-ycEQ.png"/></div></div></figure><p id="d53b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">本文需要这些工具:</p><ul class=""><li id="b85d" class="lv lw ht jk b jl jm jo jp jr lx jv ly jz lz kd ma mb mc md bi translated"><a class="ae ke" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Azure CLI工具</strong> </a> ( <code class="du lm ln lo lp b">az</code>):与Azure API交互的命令行工具。</li><li id="c3af" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated"><a class="ae ke" href="https://kubernetes.io/docs/tasks/tools/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Kubernetes客户端工具</strong> </a> ( <code class="du lm ln lo lp b">kubectl</code>):与Kubernetes API交互的命令行工具</li><li id="78d9" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated"><a class="ae ke" href="https://helm.sh/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Helm </strong> </a> ( <code class="du lm ln lo lp b">helm</code>):命令行工具，用于"<em class="li">模板化和共享Kubernetes清单</em> " ( <a class="ae ke" href="https://tanzu.vmware.com/developer/guides/kubernetes/helmfile-what-is/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> ref </strong> </a>)，捆绑成Helm chart包。</li><li id="7f0e" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated"><a class="ae ke" href="https://github.com/databus23/helm-diff" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> helm-diff </strong> </a>插件:允许您在应用更改之前查看用<code class="du lm ln lo lp b">helm</code>或<code class="du lm ln lo lp b">helmfile</code>所做的更改。</li><li id="5901" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated"><a class="ae ke" href="https://github.com/roboll/helmfile" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">Helm file</strong></a>(<code class="du lm ln lo lp b">helmfile</code>):命令行工具，使用“<em class="li">声明性规范在多种环境中部署掌舵图</em>”(<a class="ae ke" href="https://tanzu.vmware.com/developer/guides/kubernetes/helmfile-what-is/" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">ref</strong></a>)。</li><li id="41ee" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated"><a class="ae ke" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">Docker</strong></a><strong class="jk hu"/>(<code class="du lm ln lo lp b">docker</code>):构建、测试、推送Docker镜像的命令行工具。</li></ul><h2 id="74e5" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">可选工具</h2><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nk"><img src="../Images/e3c862e6d12a2318bbf96bb2faa5f622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Azk156albrWhDCa_actH3g.png"/></div></div></figure><p id="c6fd" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">由于大多数与<a class="ae ke" href="https://grpc.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> gRPC </strong> </a>或<a class="ae ke" href="https://developer.mozilla.org/docs/Web/HTTP" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> HTTP </strong> </a>交互的工具都包含在<a class="ae ke" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Docker </strong> </a>镜像中，所以只推荐shell来管理环境变量和运行脚本:</p><ul class=""><li id="19a9" class="lv lw ht jk b jl jm jo jp jr lx jv ly jz lz kd ma mb mc md bi translated"><a class="ae ke" href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">POSIX shell</strong></a><strong class="jk hu"/>(<code class="du lm ln lo lp b">sh</code>)如<a class="ae ke" href="https://www.gnu.org/software/bash/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> GNU Bash </strong> </a> ( <code class="du lm ln lo lp b">bash</code>)或<a class="ae ke" href="https://www.zsh.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Zsh </strong> </a> ( <code class="du lm ln lo lp b">zsh</code>):本指南中的这些脚本已经在macOS和Ubuntu Linux上使用这些shell中的任何一个进行了测试。</li></ul><h1 id="492d" class="mk kg ht bd kh ml mm mn kl mo mp mq kp iz mr ja ks jc ms jd kv jf mt jg ky mu bi translated">项目设置</h1><p id="e420" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">下面是本文将使用的文件结构:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="fefa" class="kf kg ht lp b fi np nq l nr ns">~/azure_calico/<br/>├── env.sh<br/>└── examples<br/>    ├── dgraph<br/>    │   ├── helmfile.yaml<br/>    │   └── network_policy.yaml<br/>    └── pydgraph<br/>        ├── Dockerfile<br/>        ├── Makefile<br/>        ├── helmfile.yaml<br/>        ├── requirements.txt<br/>        ├── load_data.py<br/>        ├── sw.nquads.rdf<br/>        └── sw.schema</span></pre><p id="0668" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">使用<a class="ae ke" href="https://www.gnu.org/software/bash/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Bash </strong> </a>或<a class="ae ke" href="https://www.zsh.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Zsh </strong> </a>，您可以使用以下命令创建文件结构:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="2478" class="kf kg ht lp b fi np nq l nr ns"><strong class="lp hu">mkdir</strong> -p ~/azure_calico/examples/{dgraph,pydgraph}<br/><strong class="lp hu">cd</strong> ~/azure_calico<br/>  <br/><strong class="lp hu">touch</strong> \<br/> env.sh \<br/> ./examples/dgraph/network_policy.yaml \<br/> ./examples/{dgraph,pydgraph}/helmfile.yaml \<br/> ./examples/pydgraph/{Dockerfile,Makefile,requirements.txt} \<br/> ./examples/pydgraph/{load_data.py,sw.schema,sw.nquads.rdf}</span></pre><h2 id="1e4b" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">项目环境变量</h2><p id="5551" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">在下面设置这些环境变量，以便在本文中使用的不同工具之间保持一致的环境。如果您正在使用一个<a class="ae ke" href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> POSIX shell </strong> </a>，您可以将它们保存到一个脚本中，并在需要时获取该脚本。</p><p id="d3d0" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">复制该源脚本并另存为<code class="du lm ln lo lp b">env.sh</code>:</p><figure class="lr ls lt lu fd hk"><div class="bz dy l di"><div class="nt nu l"/></div></figure><h1 id="8fbf" class="mk kg ht bd kh ml mm mn kl mo mp mq kp iz mr ja ks jc ms jd kv jf mt jg ky mu bi translated">提供Azure资源</h1><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nv"><img src="../Images/43bffd5c70e037ba3db252f4d328c504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jzooiLqWoVg07dZP4leD7A.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">Azure Resources</figcaption></figure><p id="0436" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><a class="ae ke" href="https://azure.microsoft.com/services/kubernetes-service/" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">AKS</strong></a><strong class="jk hu"/><a class="ae ke" href="https://github.com/Azure/azure-container-networking" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">Azure CNI</strong></a>和<a class="ae ke" href="https://www.tigera.io/project-calico/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Calico </strong> </a>网络策略和<a class="ae ke" href="https://azure.microsoft.com/services/container-registry/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> ACR </strong> </a>云资源都可以通过下面脚本中概述的以下步骤进行调配:</p><figure class="lr ls lt lu fd hk"><div class="bz dy l di"><div class="nt nu l"/></div></figure><h2 id="a083" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">验证AKS和KUBCONFIG</h2><p id="9b1d" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">通过运行以下命令，验证<a class="ae ke" href="https://azure.microsoft.com/services/kubernetes-service/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> AKS </strong> </a>集群是否已创建，以及您是否拥有被授权访问该集群的<strong class="jk hu"> KUBCONFIG </strong>:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="3f8a" class="kf kg ht lp b fi np nq l nr ns"><strong class="lp hu">source</strong> env.sh<br/><strong class="lp hu">kubectl</strong> get all <strong class="lp hu">--all-namespaces</strong></span></pre><p id="a0fa" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">结果应该类似于以下内容:</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es oa"><img src="../Images/2db4ec818b225c1009c0bdd6fb42c9e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O2gv-zRsTvKKC7V6gSp5kA.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx"><strong class="bd kh">AKS with Calico (before 2021-Aug-01)</strong></figcaption></figure><p id="a78b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><strong class="jk hu">注意</strong>:最近的变化(2021年8月1日)已经将<a class="ae ke" href="https://www.tigera.io/project-calico/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">印花布</strong> </a> <strong class="jk hu"> </strong>组件移动到它们自己的名称空间中。</p><p id="1892" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">对于节点本身，您可以闪烁显示信息，如节点名称和IP地址:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="ce46" class="kf kg ht lp b fi np nq l nr ns"><strong class="lp hu">JP</strong>='{range .items[*]}{@.metadata.name}{"\t"}{@.status.addresses[?(@.type == "InternalIP")].address}{"\n"}{end}'</span><span id="c9c4" class="kf kg ht lp b fi ob nq l nr ns"><strong class="lp hu">kubectl</strong> get nodes <strong class="lp hu">--output</strong> jsonpath="<strong class="lp hu">$JP</strong>"</span></pre><p id="6a6a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">这将显示<a class="ae ke" href="https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Azure VNET </strong> </a>子网中的工作节点及其IP地址:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="3d47" class="kf kg ht lp b fi np nq l nr ns">aks-nodepool1-56788426-vmss000000       10.240.0.4<br/>aks-nodepool1-56788426-vmss000001       10.240.0.35<br/>aks-nodepool1-56788426-vmss000002       10.240.0.66</span></pre><h1 id="b128" class="mk kg ht bd kh ml mm mn kl mo mp mq kp iz mr ja ks jc ms jd kv jf mt jg ky mu bi translated">数据图表服务</h1><p id="cbb7" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated"><a class="ae ke" href="https://dgraph.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Dgraph </strong> </a>是一个分布式图形数据库，可通过以下步骤安装。</p><p id="d680" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">将以下内容另存为<code class="du lm ln lo lp b">examples/dgraph/helmfile.yaml</code>:</p><figure class="lr ls lt lu fd hk"><div class="bz dy l di"><div class="nt nu l"/></div></figure><p id="a8bd" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">现在运行下面的代码来部署<a class="ae ke" href="https://dgraph.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Dgraph </strong> </a>服务:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="9e67" class="kf kg ht lp b fi np nq l nr ns"><strong class="lp hu">source</strong> env.sh<br/><strong class="lp hu">helmfile --file</strong> examples/dgraph/helmfile.yaml apply</span></pre><p id="9ff4" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">完成后，<a class="ae ke" href="https://dgraph.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">图</strong> </a>簇准备就绪大约需要2分钟。您可以通过以下方式进行检查:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="9ba2" class="kf kg ht lp b fi np nq l nr ns"><strong class="lp hu">kubectl</strong> <strong class="lp hu">--namespace</strong> dgraph get all</span></pre><p id="6022" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">这应该会显示如下内容:</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es oc"><img src="../Images/5a2b1f4924db75e6081fb94a6e08a28c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3tPGNCXKdtfuK86r07-v6g.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">Dgraph deployment</figcaption></figure><p id="d61f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">有趣的是，您可以查看分配给pod的IP地址，而不是它们是<a class="ae ke" href="https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Azure VNET </strong> </a>子网，虚拟机使用的子网与<a class="ae ke" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Kubernetes </strong> </a>工作节点共享的子网相同:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="ad13" class="kf kg ht lp b fi np nq l nr ns"><strong class="lp hu">JP</strong>='{range .items[*]}{@.metadata.name}{"\t"}{@.status.podIP}{"\n"}{end}'</span><span id="9a6c" class="kf kg ht lp b fi ob nq l nr ns"><strong class="lp hu">kubectl</strong> get pods <strong class="lp hu">--output</strong> jsonpath="<strong class="lp hu">$JP</strong>"</span></pre><p id="a39a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">在该实现中，这显示了:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="45e7" class="kf kg ht lp b fi np nq l nr ns">demo-dgraph-alpha-0      10.240.0.74<br/>demo-dgraph-alpha-1      10.240.0.30<br/>demo-dgraph-alpha-2      10.240.0.49<br/>demo-dgraph-zero-0       10.240.0.24<br/>demo-dgraph-zero-1       10.240.0.38<br/>demo-dgraph-zero-2       10.240.0.81</span></pre><h1 id="9623" class="mk kg ht bd kh ml mm mn kl mo mp mq kp iz mr ja ks jc ms jd kv jf mt jg ky mu bi translated">pydgraph客户端</h1><p id="b604" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">在前一篇博客中，我记录了构建和发布一个<code class="du lm ln lo lp b">pygraph-client</code>映像，然后使用该映像部署一个容器的步骤。</p><h2 id="b209" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">获取构建和部署脚本</h2><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es od"><img src="../Images/be56b526ec687ae01dc30b8bdd02ccd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ClU8oud__fCPYC8lnMD7BA.png"/></div></div></figure><p id="c7bb" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">下面是一个脚本，您可以使用它来下载gists，并通过这些步骤填充所需的文件。</p><figure class="lr ls lt lu fd hk"><div class="bz dy l di"><div class="nt nu l"/></div></figure><p id="22b7" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><strong class="jk hu">注</strong>:这些脚本和进一步的细节在上一篇文章中有所涉及(参见<a class="ae ke" href="https://joachim8675309.medium.com/aks-with-azure-container-registry-b7ff8a45a8a" rel="noopener"><strong class="jk hu">【AKS with Azure Container Registry</strong></a><strong class="jk hu">)</strong>。</p><h2 id="d0f9" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">构建、推送和部署pydgraph客户端</h2><p id="7454" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">现在所有需要的源文件都可用了，构建映像:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="b64c" class="kf kg ht lp b fi np nq l nr ns"><strong class="lp hu">source</strong> env.sh<br/><strong class="lp hu">az</strong> acr login <strong class="lp hu">--name</strong> ${AZ_ACR_NAME}<br/><strong class="lp hu">pushd</strong> ~/azure_calico/examples/pydgraph</span><span id="b4a8" class="kf kg ht lp b fi ob nq l nr ns"><strong class="lp hu">make</strong> build &amp;&amp; <strong class="lp hu">make</strong> push<strong class="lp hu"><br/>helmfile</strong> apply</span><span id="3fdd" class="kf kg ht lp b fi ob nq l nr ns"><strong class="lp hu">popd</strong></span></pre><p id="c886" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">运行<code class="du lm ln lo lp b">kubectl get all -n pydgraph-client</code>之后，应该会产生如下结果:</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es oe"><img src="../Images/6a205549e06905c27ed73090dabd6d16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vJOUH5YA1HTncgDhOGzJPA.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">pydgraph-client deployment</figcaption></figure><h2 id="49b6" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">登录pydgraph-client容器</h2><p id="c375" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">对于接下来的三个测试，您将需要登录到容器中。这可以通过以下方法实现。</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="ce72" class="kf kg ht lp b fi np nq l nr ns"><strong class="lp hu">PYDGRAPH_POD</strong>=$(<strong class="lp hu">kubectl</strong> get pods \<br/>  <strong class="lp hu">--namespace</strong> pydgraph-client \<br/>  <strong class="lp hu">--output</strong> name<br/>)</span><span id="1f1e" class="kf kg ht lp b fi ob nq l nr ns"><strong class="lp hu">kubectl</strong> exec <strong class="lp hu">-ti --namespace</strong> pydgraph-client <strong class="lp hu">${PYDGRAPH_POD}</strong> -- <strong class="lp hu">bash</strong></span></pre><h1 id="3815" class="mk kg ht bd kh ml mm mn kl mo mp mq kp iz mr ja ks jc ms jd kv jf mt jg ky mu bi translated">测试0(基线):没有网络策略</h1><p id="4dee" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">在对网络策略进行任何测试之前，进行一次基本检查以验证一切正常。</p><p id="a27d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">在这个健全性检查和继续测试中，将测试<a class="ae ke" href="https://developer.mozilla.org/en-US/docs/Web/HTTP" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> HTTP </strong> </a>(端口<code class="du lm ln lo lp b">8080</code>)和<a class="ae ke" href="https://grpc.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> gRPC </strong> </a>(端口<code class="du lm ln lo lp b">9080</code>)。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es of"><img src="../Images/4ccff66f77b081b621f2aa11d1e73918.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tAvRdgnyDz_0L_A8oo_nWw.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">No Network Policy</figcaption></figure><h2 id="f061" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">HTTP检查(无网络策略)</h2><p id="1d02" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">登录到<code class="du lm ln lo lp b">pydgraph-client</code>窗格并运行以下命令:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="1e83" class="kf kg ht lp b fi np nq l nr ns">curl <strong class="lp hu">${DGRAPH_ALPHA_SERVER}</strong>:8080/health | jq</span></pre><p id="5226" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">预期结果应该是<a class="ae ke" href="https://dgraph.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">图</strong> </a>阿尔法节点之一的健康状态:</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es og"><img src="../Images/dc1dcfd7d8811925a05566bd32b1bbdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qoXmz1O5mq89EfAY15Ehvw.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">/health (HTTP)</figcaption></figure><h2 id="d225" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">gRPC检查(无网络策略)</h2><p id="c181" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">登录<code class="du lm ln lo lp b">pydgraph-client</code> pod并运行该命令:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="a778" class="kf kg ht lp b fi np nq l nr ns"><strong class="lp hu">grpcurl -plaintext -proto</strong> api.proto \<br/>  <strong class="lp hu">${DGRAPH_ALPHA_SERVER}</strong>:9080 \<br/>  api.Dgraph/CheckVersion</span></pre><p id="6857" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">预期结果将是<strong class="jk hu"> </strong>为<a class="ae ke" href="https://dgraph.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Dgraph </strong> </a>服务器版本。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es og"><img src="../Images/df6abdd85ab66a89b2d520941c20d816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMNwgF0BWgjOY-ZtgsOSUA.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">api.Dgraph/CheckVersion (gRPC)</figcaption></figure><h1 id="01c3" class="mk kg ht bd kh ml mm mn kl mo mp mq kp iz mr ja ks jc ms jd kv jf mt jg ky mu bi translated">测试1:应用网络策略</h1><p id="3181" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">在本测试中，您将添加一个拒绝所有流量的网络策略，除非这些数据包来自正确标签的名称空间。此测试的验收标准客户端将无法连接到Dgraph服务。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es of"><img src="../Images/9f9859a6904950b45b3f03fe4815687d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HQIvmiepUygtatu77FXwLw.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">Network Policy added</figcaption></figure><h2 id="8777" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">添加网络策略</h2><p id="5824" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">该策略将拒绝所有到Dgraph Alpha pods的流量，除了来自同一名称空间内的流量或来自标签为<code class="du lm ln lo lp b">app=dgraph-client</code>和<code class="du lm ln lo lp b">env=test</code>的名称空间中的pod的流量。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es oh"><img src="../Images/cf8ad5ba196330df87233d3a7abf20fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vY-Kgedm9DgC997YMVeIAw.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx"><strong class="bd kh">Dgraph Network Policy (made with </strong><a class="ae ke" href="https://editor.cilium.io/" rel="noopener ugc nofollow" target="_blank">https://editor.cilium.io/</a><strong class="bd kh">)</strong></figcaption></figure><p id="eccf" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">抄写以下内容，并说为<code class="du lm ln lo lp b">examples/dgraph/network_policy.yaml</code>:</p><figure class="lr ls lt lu fd hk"><div class="bz dy l di"><div class="nt nu l"/></div></figure><p id="cbba" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">准备就绪后，将其应用于:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="0336" class="kf kg ht lp b fi np nq l nr ns"><strong class="lp hu">kubectl --filename</strong> ./examples/dgraph/network_policy.yaml apply</span></pre><h2 id="731e" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">HTTP检查(应用网络策略)</h2><p id="27f6" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">登录到<code class="du lm ln lo lp b">pydgraph-client</code> pod，并运行以下命令:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="c455" class="kf kg ht lp b fi np nq l nr ns">curl <strong class="lp hu">${DGRAPH_ALPHA_SERVER}</strong>:8080/health</span></pre><p id="f6dc" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">预期结果在这种情况下，经过很长时间的等待(大约5分钟)，结果将是超时:</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es og"><img src="../Images/4be4b54b2763a038126a17d5d3124e8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YcRTC-xS0VCt1tmrvBuz7Q.png"/></div></div></figure><h2 id="60ef" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">gRPC检查(应用网络策略)</h2><p id="4ead" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">登录到<code class="du lm ln lo lp b">pydgraph-client</code>窗格并运行以下命令:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="21c3" class="kf kg ht lp b fi np nq l nr ns"><strong class="lp hu">grpcurl -plaintext -proto</strong> api.proto \<br/>  <strong class="lp hu">${DGRAPH_ALPHA_SERVER}</strong>:9080 \<br/>  api.Dgraph/CheckVersion</span></pre><p id="0cb3" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">大约10秒后<a class="ae ke" href="https://grpc.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> gRPC </strong> </a>的预期结果将是:</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es og"><img src="../Images/fa525df9e82b917f5eb65871aab33a4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nu4Gmuwy_LvJTfZz4hcKFQ.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">api.Dgraph/CheckVersion (gRPC)</figcaption></figure><h1 id="ca6f" class="mk kg ht bd kh ml mm mn kl mo mp mq kp iz mr ja ks jc ms jd kv jf mt jg ky mu bi translated">测试2:允许流量进入服务</h1><p id="c3d4" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">既然我们已经演示了连接性与访问是隔离的，我们可以向名称空间添加适当的标签，以便允许流量。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es of"><img src="../Images/f47d13c52b8b34d1c9cc463a151dd0c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mVYmEYqbmQwpwu2Yzzb6-w.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">Label app=dgraph-client added</figcaption></figure><h2 id="383c" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">允许客户访问数据图</h2><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="07ac" class="kf kg ht lp b fi np nq l nr ns"><strong class="lp hu">kubectl</strong> label namespaces pydgraph-client env=test app=dgraph-client</span></pre><p id="4693" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">执行此命令后，将添加新标签:</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es oi"><img src="../Images/37d43f9010967d5cea2af8c4b78526e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YRVmbyCzBJCevKEPi1ACsQ.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx"><strong class="bd kh">View of namespace labels (Lens tool</strong> <a class="ae ke" href="https://k8slens.dev/" rel="noopener ugc nofollow" target="_blank">https://k8slens.dev/</a><strong class="bd kh">)</strong></figcaption></figure><h2 id="d1f0" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">HTTP检查(应用了名称空间标签)</h2><p id="a5f0" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">登录到<code class="du lm ln lo lp b">pydgraph-client</code>窗格，并运行以下命令:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="65cd" class="kf kg ht lp b fi np nq l nr ns">curl <strong class="lp hu">${DGRAPH_ALPHA_SERVER}</strong>:8080/health | jq</span></pre><p id="0d41" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">对此的预期结果是，关于健康的JSON数据来自其中一个<a class="ae ke" href="https://dgraph.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">d graph</strong></a>Alpha pod。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es og"><img src="../Images/dc1dcfd7d8811925a05566bd32b1bbdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qoXmz1O5mq89EfAY15Ehvw.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">/health (HTTP)</figcaption></figure><h2 id="6156" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">gRPC检查(应用了名称空间标签)</h2><p id="3747" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">登录到<code class="du lm ln lo lp b">pydgraph-client</code>窗格并运行以下命令:</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="7f4b" class="kf kg ht lp b fi np nq l nr ns"><strong class="lp hu">grpcurl -plaintext -proto</strong> api.proto \<br/>  <strong class="lp hu">${DGRAPH_ALPHA_SERVER}</strong>:9080 \<br/>  api.Dgraph/CheckVersion</span></pre><p id="af9f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">对此的预期结果是JSON详细说明了<a class="ae ke" href="https://dgraph.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Dgraph </strong> </a>服务器版本。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es og"><img src="../Images/df6abdd85ab66a89b2d520941c20d816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMNwgF0BWgjOY-ZtgsOSUA.png"/></div></div><figcaption class="nw nx et er es ny nz bd b be z dx">api.Dgraph/CheckVersion (gRPC)</figcaption></figure><h1 id="050a" class="mk kg ht bd kh ml mm mn kl mo mp mq kp iz mr ja ks jc ms jd kv jf mt jg ky mu bi translated">清除</h1><p id="2aae" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">这将删除<a class="ae ke" href="https://azure.microsoft.com/services/kubernetes-service/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> AKS </strong> </a>集群以及<a class="ae ke" href="https://azure.microsoft.com/services/kubernetes-service/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> AKS </strong> </a>中的任何调配资源，包括通过<a class="ae ke" href="https://dgraph.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Dgraph </strong> </a>部署创建的外部卷。</p><pre class="lr ls lt lu fd nl lp nm nn aw no bi"><span id="5c49" class="kf kg ht lp b fi np nq l nr ns"><strong class="lp hu">az</strong> aks delete \<br/>  <strong class="lp hu">--resource-group</strong> <strong class="lp hu">$AZ_RESOURCE_GROUP</strong> \<br/>  <strong class="lp hu">--name</strong> <strong class="lp hu">$AZ_CLUSTER_NAME</strong></span></pre><h1 id="295b" class="mk kg ht bd kh ml mm mn kl mo mp mq kp iz mr ja ks jc ms jd kv jf mt jg ky mu bi translated">资源</h1><p id="0f66" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">这些是我在研究这篇文章时在网上找到的一些资源。</p><h2 id="a249" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">博客源代码</h2><ul class=""><li id="1ee2" class="lv lw ht jk b jl la jo lb jr oj jv ok jz ol kd ma mb mc md bi translated"><strong class="jk hu">拥有Azure CNI和Calico网络策略的AKS</strong>:<a class="ae ke" href="https://github.com/darkn3rd/blog_tutorials/tree/master/kubernetes/aks/series_2_network_mgmnt/part_2_calico" rel="noopener ugc nofollow" target="_blank">https://github . com/darkn 3 rd/blog _ tutorials/tree/master/kubernetes/AKS/series _ 2 _ Network _ MGM nt/part _ 2 _ Calico</a></li></ul><h2 id="c98e" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">网络策略工具</h2><ul class=""><li id="a435" class="lv lw ht jk b jl la jo lb jr oj jv ok jz ol kd ma mb mc md bi translated"><strong class="jk hu">在线图形网政策编辑</strong>:<a class="ae ke" href="https://editor.cilium.io/" rel="noopener ugc nofollow" target="_blank">https://editor.cilium.io/</a></li></ul><h2 id="5543" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">网络策略文章</h2><ul class=""><li id="8d2f" class="lv lw ht jk b jl la jo lb jr oj jv ok jz ol kd ma mb mc md bi translated"><strong class="jk hu">Kubernetes Ingress网络政策指南</strong>:<a class="ae ke" href="https://www.openshift.com/blog/guide-to-kubernetes-ingress-network-policies" rel="noopener ugc nofollow" target="_blank">https://www . open shift . com/blog/Guide-to-Kubernetes-Ingress-Network-Policies</a></li><li id="ef9f" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated"><strong class="jk hu">保护Kubernetes集群网络</strong>:<a class="ae ke" href="https://ahmet.im/blog/kubernetes-network-policy/" rel="noopener ugc nofollow" target="_blank">https://ahmet.im/blog/kubernetes-network-policy/</a></li><li id="774b" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated"><strong class="jk hu">Kubernetes网络政策入门</strong>:<a class="ae ke" href="https://docs.projectcalico.org/security/kubernetes-network-policy" rel="noopener ugc nofollow" target="_blank">https://docs . project calico . org/security/Kubernetes-network-policy</a></li></ul><h2 id="165a" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">录像</h2><ul class=""><li id="4eac" class="lv lw ht jk b jl la jo lb jr oj jv ok jz ol kd ma mb mc md bi translated"><strong class="jk hu"> Kubernetes在Azure上联网【https://youtu.be/JyLtg_SJ1lo</strong>:<a class="ae ke" href="https://youtu.be/JyLtg_SJ1lo" rel="noopener ugc nofollow" target="_blank"/></li></ul><h2 id="d7ec" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">证明文件</h2><ul class=""><li id="b950" class="lv lw ht jk b jl la jo lb jr oj jv ok jz ol kd ma mb mc md bi translated"><strong class="jk hu">网络政策</strong>:<a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/concepts/services-networking/Network-Policies/</a></li><li id="6d9b" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated"><strong class="jk hu">网络插件</strong>:<a class="ae ke" href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/concepts/extend-kubernetes/compute-storage-net/Network-Plugins/</a></li><li id="96cd" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated"><strong class="jk hu">集装箱网络接口</strong>:<a class="ae ke" href="https://github.com/containernetworking/cni" rel="noopener ugc nofollow" target="_blank">https://github.com/containernetworking/cni</a></li></ul><h2 id="b72d" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">支持网络策略的网络插件</h2><ul class=""><li id="2621" class="lv lw ht jk b jl la jo lb jr oj jv ok jz ol kd ma mb mc md bi translated"><strong class="jk hu">印花布</strong>:<a class="ae ke" href="https://www.tigera.io/project-calico/" rel="noopener ugc nofollow" target="_blank">https://www.tigera.io/project-calico/</a></li><li id="6986" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated"><strong class="jk hu">蔚蓝的CNI</strong>:<a class="ae ke" href="https://github.com/Azure/azure-container-networking" rel="noopener ugc nofollow" target="_blank">https://github.com/Azure/azure-container-networking</a></li><li id="10c6" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated"><strong class="jk hu">纤毛【https://cilium.io/】:<a class="ae ke" href="https://cilium.io/" rel="noopener ugc nofollow" target="_blank"/></strong></li><li id="db6b" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated"><strong class="jk hu">织网</strong>:<a class="ae ke" href="https://www.weave.works/docs/net/latest/overview/" rel="noopener ugc nofollow" target="_blank">https://www.weave.works/docs/net/latest/overview/</a></li><li id="9e73" class="lv lw ht jk b jl me jo mf jr mg jv mh jz mi kd ma mb mc md bi translated"><strong class="jk hu">胃窦</strong>:<a class="ae ke" href="https://antrea.io/" rel="noopener ugc nofollow" target="_blank">https://antrea.io/</a></li></ul><h1 id="ee2f" class="mk kg ht bd kh ml mm mn kl mo mp mq kp iz mr ja ks jc ms jd kv jf mt jg ky mu bi translated">结论</h1><p id="65be" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">安全性是基础设施中至关重要且必要的一部分，随着富容器编排平台的引入，安全性并没有消失，因为在平台层(<a class="ae ke" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Kubernetes </strong> </a>)以及基础设施层(<a class="ae ke" href="https://azure.microsoft.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Azure </strong> </a>)仍然需要安全性。</p><p id="6217" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">在本教程中，安全性对于后端分布式图形数据库<a class="ae ke" href="https://dgraph.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Dgraph </strong> </a>来说很重要。只有管理<a class="ae ke" href="https://dgraph.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Dgraph </strong> </a>操作方面的指定客户端和自动化，如<a class="ae ke" href="https://dgraph.io/docs/enterprise-features/binary-backups/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">备份</strong> </a>和<a class="ae ke" href="https://dgraph.io/docs/deploy/fast-data-loading/live-loader/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">实时加载</strong> </a>，才应被允许访问，而其他所有内容都被拒绝访问。</p><h2 id="c7fd" class="kf kg ht bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">超越网络策略</h2><p id="50b9" class="pw-post-body-paragraph ji jj ht jk b jl la iu jn jo lb ix jq jr lc jt ju jv ld jx jy jz le kb kc kd hb bi translated">除了网络策略限制对<a class="ae ke" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">Kubernetes</strong></a>pod的访问，pod之间的流量应该是安全的，这被称为<a class="ae ke" href="https://www.ncsc.gov.uk/collection/cloud-security/implementing-the-cloud-security-principles/data-in-transit-protection" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">传输中的加密</strong> </a>。</p><p id="03a5" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">本文是探索面向<a class="ae ke" href="https://buoyant.io/what-is-a-service-mesh" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">服务网格</strong> </a>的流量安全的重要一步，它可以自动配置<a class="ae ke" href="https://learn.akamai.com/en-us/webhelp/iot/internet-of-things-over-the-air-user-guide/GUID-21EC6B74-28C8-4CE1-980E-D5EE57AD9653.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">相互TLS </strong> </a>用于短暂的临时pod。</p><p id="89f3" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">感谢您阅读我的文章。我希望这对你的<a class="ae ke" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Kubernetes </strong> </a>旅程有用，祝你成功。</p></div></div>    
</body>
</html>