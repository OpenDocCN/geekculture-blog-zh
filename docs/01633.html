<html>
<head>
<title>Safeguarding Node JS Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保护节点JS应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/safeguarding-node-js-applications-3af4a7850e0d?source=collection_archive---------10-----------------------#2021-04-18">https://medium.com/geekculture/safeguarding-node-js-applications-3af4a7850e0d?source=collection_archive---------10-----------------------#2021-04-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c64d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个故事讲述了如何保护node js应用程序免受Node Js应用程序最常见的安全威胁。这些是由OWASP <a class="ae jd" href="https://speakerdeck.com/ckarande/top-overlooked-security-threats-to-node-dot-js-web-applications" rel="noopener ugc nofollow" target="_blank"> <em class="je">文章</em> </a>确定的最常见的安全漏洞。</p><p id="fd01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">许多这些问题可以通过使用头盔中间件<a class="ae jd" href="https://www.npmjs.com/package/helmet" rel="noopener ugc nofollow" target="_blank"> <em class="je">库</em> </a>来解决。</p><p id="33d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://www.npmjs.com/package/helmet" rel="noopener ugc nofollow" target="_blank">头盔</a>通过适当设置HTTP头，可以帮助保护你的应用免受一些众所周知的web漏洞的攻击。</p><p id="f15c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">头盔实际上只是一个较小的中间件函数的集合，这些函数设置与安全相关的HTTP响应头:</p><ul class=""><li id="41ee" class="jf jg hi ih b ii ij im in iq jh iu ji iy jj jc jk jl jm jn bi translated"><a class="ae jd" href="https://github.com/helmetjs/csp" rel="noopener ugc nofollow" target="_blank"> csp </a>设置<code class="du jo jp jq jr b">Content-Security-Policy</code>头，帮助防止跨站脚本攻击和其他跨站注入。</li><li id="5b4e" class="jf jg hi ih b ii js im jt iq ju iu jv iy jw jc jk jl jm jn bi translated"><a class="ae jd" href="https://github.com/helmetjs/hide-powered-by" rel="noopener ugc nofollow" target="_blank"> hidePoweredBy </a>移除<code class="du jo jp jq jr b">X-Powered-By</code>割台。</li><li id="2d08" class="jf jg hi ih b ii js im jt iq ju iu jv iy jw jc jk jl jm jn bi translated"><a class="ae jd" href="https://github.com/helmetjs/hsts" rel="noopener ugc nofollow" target="_blank"> hsts </a>设置<code class="du jo jp jq jr b">Strict-Transport-Security</code>头，强制执行到服务器的安全(HTTP over SSL/TLS)连接。</li><li id="0495" class="jf jg hi ih b ii js im jt iq ju iu jv iy jw jc jk jl jm jn bi translated"><a class="ae jd" href="https://github.com/helmetjs/ienoopen" rel="noopener ugc nofollow" target="_blank"> ieNoOpen </a>为IE8+设置<code class="du jo jp jq jr b">X-Download-Options</code>。</li><li id="fe81" class="jf jg hi ih b ii js im jt iq ju iu jv iy jw jc jk jl jm jn bi translated"><a class="ae jd" href="https://github.com/helmetjs/nocache" rel="noopener ugc nofollow" target="_blank"> noCache </a>设置<code class="du jo jp jq jr b">Cache-Control</code>和Pragma头来禁用客户端缓存。</li><li id="1d90" class="jf jg hi ih b ii js im jt iq ju iu jv iy jw jc jk jl jm jn bi translated"><a class="ae jd" href="https://github.com/helmetjs/dont-sniff-mimetype" rel="noopener ugc nofollow" target="_blank"> noSniff </a>设置<code class="du jo jp jq jr b">X-Content-Type-Options</code>来阻止浏览器从声明的内容类型中嗅探响应。</li><li id="c2c1" class="jf jg hi ih b ii js im jt iq ju iu jv iy jw jc jk jl jm jn bi translated"><a class="ae jd" href="https://github.com/helmetjs/frameguard" rel="noopener ugc nofollow" target="_blank">护框</a>设置<code class="du jo jp jq jr b">X-Frame-Options</code>割台为<a class="ae jd" href="https://www.owasp.org/index.php/Clickjacking" rel="noopener ugc nofollow" target="_blank">点动</a>提供保护。</li><li id="f06d" class="jf jg hi ih b ii js im jt iq ju iu jv iy jw jc jk jl jm jn bi translated"><a class="ae jd" href="https://github.com/helmetjs/x-xss-protection" rel="noopener ugc nofollow" target="_blank"> xssFilter </a>设置<code class="du jo jp jq jr b">X-XSS-Protection</code>以禁用web浏览器中有问题的跨站点脚本(XSS)过滤器。</li></ul><p id="0801" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们创建一个示例应用程序</p><pre class="jx jy jz ka fd kb jr kc kd aw ke bi"><span id="395d" class="kf kg hi jr b fi kh ki l kj kk"><strong class="jr hj">$ mkdir helmet-test<br/>$ cd helmet-test<br/>$ npm init -y<br/>$ npm install express --save</strong></span></pre><p id="00fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建文件index.js</p><pre class="jx jy jz ka fd kb jr kc kd aw ke bi"><span id="5572" class="kf kg hi jr b fi kh ki l kj kk"><strong class="jr hj">const express = require('express')</strong><br/><br/>const app = express()<br/><br/>app.get('/', (request, response) =&gt; {<br/>  return response.json({<br/>    response: 'I am Alive ....'<br/>  })<br/>})<br/><br/>app.listen(3000)</span></pre><p id="72e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们用(— include)为GET API执行CURL命令</p><figure class="jx jy jz ka fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kl"><img src="../Images/15650616fee68624e8e48626f5e8dee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6lJ1GuX5nQw4pBmwi18_dA.png"/></div></div></figure><p id="8ffa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">引起我注意的一件事是x-powered-by响应头。我不认为知道它是一个快速应用程序会给客户端增加任何价值。相反，如果攻击者发现我们使用的是旧版本的Express，他们会试图利用任何已知的漏洞。这个头会被头盔摘下来。</p><p id="19c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使服务器更安全的一些头文件是:</p><ul class=""><li id="ee4a" class="jf jg hi ih b ii ij im in iq jh iu ji iy jj jc jk jl jm jn bi translated">内容-安全-策略。</li><li id="ca6f" class="jf jg hi ih b ii js im jt iq ju iu jv iy jw jc jk jl jm jn bi translated">严格的运输安全。</li><li id="bed3" class="jf jg hi ih b ii js im jt iq ju iu jv iy jw jc jk jl jm jn bi translated">期待-CT。</li><li id="3ec1" class="jf jg hi ih b ii js im jt iq ju iu jv iy jw jc jk jl jm jn bi translated">推荐人-策略。</li><li id="8051" class="jf jg hi ih b ii js im jt iq ju iu jv iy jw jc jk jl jm jn bi translated">x内容类型选项。</li></ul><p id="0b51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有一个流行的<a class="ae jd" href="https://securityheaders.com/" rel="noopener ugc nofollow" target="_blank"> <em class="je">网站</em> </a>会检查网址并给出安全评级。我正在使用ngrok将本地http端点隧道传输到https，并在安全评级网站中进行检查。</p><figure class="jx jy jz ka fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kt"><img src="../Images/fbd6e37b87ee9036c7f6eab3cd5df852.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FEbX3huTeMaVmDdno2wQKQ.png"/></div></div></figure><p id="3bef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="je">捕获https端点并验证为API。下面是报告，评级不是那么令人鼓舞。</em> </strong></p><figure class="jx jy jz ka fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es ku"><img src="../Images/53ced1635b6af8ff0350c94cd928dfe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ulmxCV_D0q8-Tlmg4ulROA.png"/></div></div></figure><p id="8b0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们在应用程序中包含头盔，并开始使用它。</p><pre class="jx jy jz ka fd kb jr kc kd aw ke bi"><span id="4d88" class="kf kg hi jr b fi kh ki l kj kk"><strong class="jr hj">$ npm install helmet --save</strong></span></pre><p id="ebe9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将index.js更改如下。</p><pre class="jx jy jz ka fd kb jr kc kd aw ke bi"><span id="6882" class="kf kg hi jr b fi kh ki l kj kk">const express = require('express')<br/><strong class="jr hj">const helmet = require('helmet')</strong></span><span id="9556" class="kf kg hi jr b fi kv ki l kj kk">const app = express()<br/><strong class="jr hj">app.use(helmet())</strong></span><span id="fb36" class="kf kg hi jr b fi kv ki l kj kk">app.get('/', (request, response) =&gt; {<br/>  return response.json({<br/>    response: 'I am Alive ....'<br/>  })<br/>})</span><span id="0a86" class="kf kg hi jr b fi kv ki l kj kk">app.listen(3000)</span></pre><p id="20c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们再次运行使用CURL调用GET API的练习。</p><figure class="jx jy jz ka fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kw"><img src="../Images/6791cbcc42fa50130a79480fec40749c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e_kHtJx1B_8dIK3ha0IUkQ.png"/></div></div></figure><p id="1c4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，头盔已经从响应头中删除了x-powered-by。除此之外，它还增加了一些默认值。</p><p id="8c4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">拆下X-Powered-By割台</strong></p><p id="34eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">攻击者可以使用X-Powered-By标头(在Node / Express应用程序中默认设置为“Express ”)来识别站点的基础结构，因此应该隐藏它。</p><h2 id="1372" class="kf kg hi bd kx ky kz la lb lc ld le lf iq lg lh li iu lj lk ll iy lm ln lo lp bi translated">内容安全策略:</h2><p id="b9d1" class="pw-post-body-paragraph if ig hi ih b ii lq ik il im lr io ip iq ls is it iu lt iw ix iy lu ja jb jc hb bi translated"><em class="je">Content-Security-Policy</em>是现代浏览器用来增强文档(或网页)安全性的HTTP响应头的名称。Content-Security-Policy头允许您限制资源(如JavaScript、CSS或几乎任何浏览器加载的内容)的方式。</p><p id="fc81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">CSP最初是为了减少跨站点脚本(XSS)攻击的攻击面而设计的，该规范的后续版本还可以防范其他形式的攻击，如点击劫持。</p><h2 id="760b" class="kf kg hi bd kx ky kz la lb lc ld le lf iq lg lh li iu lj lk ll iy lm ln lo lp bi translated">期望证书透明</h2><p id="1a83" class="pw-post-body-paragraph if ig hi ih b ii lq ik il im lr io ip iq ls is it iu lt iw ix iy lu ja jb jc hb bi translated"><strong class="ih hj"> HTTP Expect-CT </strong>报头是一个响应类型的报头，它可以防止站点使用错误颁发的证书，并确保它们不会被忽略，它还允许站点决定报告或执行证书透明性要求。</p><p id="c4b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">浏览器忽略HTTP上的Expect-CT头。标头仅对HTTPS连接有影响。因此，这是由浏览器进行的显式检查，根据公共日志，该网站的给定证书是有效的。头盔增加了expect-ct: max-age=0，意味着浏览器应该期望证书有效。</p><h1 id="cbc7" class="lv kg hi bd kx lw lx ly lb lz ma mb lf mc md me li mf mg mh ll mi mj mk lo ml bi translated">推荐人-策略</h1><p id="5a02" class="pw-post-body-paragraph if ig hi ih b ii lq ik il im lr io ip iq ls is it iu lt iw ix iy lu ja jb jc hb bi translated">简单地说，Referrer-Policy定义了应该从请求的Referrer中提取什么数据。默认情况下，Helmet会将此设置为无数据，这意味着URL的任何部分——无论是源还是查询字符串——都不能在您的网站上使用。Web.dev有一篇关于<a class="ae jd" href="https://web.dev/referrer-best-practices" rel="noopener ugc nofollow" target="_blank">推荐人最佳实践</a>的精彩文章，带有易于理解的图形解释。头盔增加了referrer-policy: no-referrer，这是相当限制性的。</p><h2 id="ea88" class="kf kg hi bd kx ky kz la lb lc ld le lf iq lg lh li iu lj lk ll iy lm ln lo lp bi translated">严格的运输安全</h2><p id="d31a" class="pw-post-body-paragraph if ig hi ih b ii lq ik il im lr io ip iq ls is it iu lt iw ix iy lu ja jb jc hb bi translated"><strong class="ih hj"> HTTP </strong>严格传输安全响应头(通常缩写为<a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Glossary/HSTS" rel="noopener ugc nofollow" target="_blank"> HSTS </a>)让网站告诉浏览器只能使用HTTPS访问，而不能使用HTTP。</p><p id="6ff3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它有max-age和includeSubdomain指令。Max-age告诉浏览器应该记住的时间(以秒为单位),即只能使用HTTPS访问网站。includeSubdomain指令是可选的，表示此规则也适用于站点的子域。头盔增加了以下内容:</p><p id="2156" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jo jp jq jr b"><em class="je">1</em>strict-transport-security: max-age=15552000; includeSubDomains</code></p><p id="b324" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以它说，该网站需要通过HTTPS访问180天，其子域名。</p><p id="6a9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除此之外，默认情况下，头盔还会创建其他标题。</p><p id="bfd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们再次与网站进行安全检查。</p><figure class="jx jy jz ka fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es mm"><img src="../Images/36cecbc56a201ac3194a4f95fe683ea8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LeoQQkTfzT8w8aLaDi4CeQ.png"/></div></div></figure></div></div>    
</body>
</html>