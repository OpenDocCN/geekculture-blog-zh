<html>
<head>
<title>Building a Simple Quiz App Using a Rest API, React, and Redux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Rest API、React和Redux构建一个简单的测验应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/building-a-simple-quiz-app-using-a-rest-api-react-and-redux-5c8a85a9447f?source=collection_archive---------0-----------------------#2021-05-02">https://medium.com/geekculture/building-a-simple-quiz-app-using-a-rest-api-react-and-redux-5c8a85a9447f?source=collection_archive---------0-----------------------#2021-05-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="34a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章描述了如何构建一个简单的单人游戏测试平台。该应用发布于Netlify 的<a class="ae jd" href="https://pedantic-joliot-d97b7d.netlify.app/" rel="noopener ugc nofollow" target="_blank">，完成的源代码可以在Github </a>的<a class="ae jd" href="https://github.com/emily-wheatcroft/quiz-app" rel="noopener ugc nofollow" target="_blank">这里看到。</a></p><p id="6df5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们将要经历的5个步骤:</p><ol class=""><li id="a387" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated"><a class="ae jd" href="https://www.emilywheatcroft.com/13-04-21-quiz-app/#settings" rel="noopener ugc nofollow" target="_blank">设置组件</a></li><li id="eef5" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><a class="ae jd" href="https://www.emilywheatcroft.com/13-04-21-quiz-app/#setting-up-a-simple-redux-store" rel="noopener ugc nofollow" target="_blank">建立一个简单的redux商店</a></li><li id="bb3e" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><a class="ae jd" href="https://www.emilywheatcroft.com/13-04-21-quiz-app/#making-the-questions-request" rel="noopener ugc nofollow" target="_blank">提出问题要求</a></li><li id="adb5" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><a class="ae jd" href="https://www.emilywheatcroft.com/13-04-21-quiz-app/#adding-a-question-component" rel="noopener ugc nofollow" target="_blank">添加问题组件</a></li><li id="6b68" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><a class="ae jd" href="https://www.emilywheatcroft.com/13-04-21-quiz-app/#the-final-page" rel="noopener ugc nofollow" target="_blank">最后一页</a></li></ol><p id="49ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你会注意到我没有在文章中包括样式文件，但是你可以在这里看到应用css文件<a class="ae jd" href="https://www.emilywheatcroft.com/13-04-21-quiz-app/#https://github.com/emily-wheatcroft/quiz-app/blob/master/src/App.css" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="76b5" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">入门指南</h1><p id="8317" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">我做的第一件事是为这些问题找到一个好的API资源。在谷歌搜索了一下之后，我发现<a class="ae jd" href="https://opentdb.com/" rel="noopener ugc nofollow" target="_blank">开放琐事数据库</a>，里面有数千个问题，并且是经过审核的。如果你看一下<a class="ae jd" href="https://opentdb.com/api_config.php" rel="noopener ugc nofollow" target="_blank"> API配置</a>，你可以看到创建一个测验平台需要的所有参数:问题数量、类别、难度、类型&amp;编码选项。</p><p id="4993" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<a class="ae jd" href="https://reactjs.org/docs/create-a-new-react-app.html" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>，我使用默认选项进行设置，选择最初不添加redux(这是我后来重新评估的事情)。首先在您的终端中运行以下命令:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="ca02" class="le jt hi la b fi lf lg l lh li">npx create-react-app quiz-app<br/>cd quiz-app<br/>yarn start</span></pre><h1 id="4623" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">设置</h1><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lj"><img src="../Images/a78fbcff462f15cb269880f1f52e6358.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VFXVi3_k9xoTySoY_MHnzQ.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">A settings page for the user to customise the question request</figcaption></figure><p id="6866" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从位于<code class="du lv lw lx la b">src/Components/Settings.js</code>的设置页面开始，这是用户将看到的第一个组件。</p><p id="1525" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用一个<a class="ae jd" href="https://reactjs.org/docs/components-and-props.html" rel="noopener ugc nofollow" target="_blank">功能组件</a>，所以第一步是概述这个:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="3967" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后将设置组件导入App.js</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="b0d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们想使用JSX创建界面的结构。我们从<a class="ae jd" href="https://opentdb.com/api_config.php" rel="noopener ugc nofollow" target="_blank"> API配置</a>中知道，我们希望输入控制问题类别、问题难度、问题类型和问题数量。</p><p id="06f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以从这个端点检索问题类别:<a class="ae jd" href="https://opentdb.com/api_category.php" rel="noopener ugc nofollow" target="_blank">https://opentdb.com/api_category.php</a>。我们将发出这个请求，并使用React <a class="ae jd" href="https://reactjs.org/docs/hooks-state.html" rel="noopener ugc nofollow" target="_blank">状态挂钩</a>和<a class="ae jd" href="https://reactjs.org/docs/hooks-effect.html" rel="noopener ugc nofollow" target="_blank">效果挂钩</a>保存组件中的类别，如下所示:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="ad2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们从react导入<code class="du lv lw lx la b">useEffect</code>和<code class="du lv lw lx la b">useState</code>，然后我们可以为选项声明一个初始为空值的状态变量。这是我们使用<code class="du lv lw lx la b">setOptions</code>存储来自API响应的数据的地方。</p><p id="e6b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在一个<code class="du lv lw lx la b">useEffect</code>钩子中，我们声明api url，使用fetch发出请求，然后在<code class="du lv lw lx la b">setOptions</code>中将必要的json作为有效载荷传递。</p><p id="30f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">问题类别现在在状态中作为选项可用，所以让我们使它们可选！</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="44ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们为<code class="du lv lw lx la b">questionCategory</code>声明一个状态变量，初始值为空字符串。我们将使用<code class="du lv lw lx la b">setQuestionCategory</code>来更新这个值。</p><p id="5b32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们希望提供从所有类别中检索问题的选项，我们将该选项硬编码。对于其余的选项，我们映射选项的数组，确保为每个选项分配一个反应键。我们使用<code class="du lv lw lx la b">name</code>作为选项显示，同时使用<code class="du lv lw lx la b">id</code>作为选项值，因为这是API期望的值。</p><p id="2da2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们添加一个名为<code class="du lv lw lx la b">handleCategoryChange</code>的onChange事件，每当用户选择一个选项时，它使用<code class="du lv lw lx la b">setQuestionCategory</code>来更新状态中的<code class="du lv lw lx la b">questionCategory</code>。</p><p id="3d42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们将选择元素的值绑定到<code class="du lv lw lx la b">questionCategory</code>。</p><p id="d44a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以添加一个简单的加载状态:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="bd91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其余的问题选项必须硬编码，因为它们在API端点上不可用。我们可以使用相同的<code class="du lv lw lx la b">useEffect</code>和<code class="du lv lw lx la b">useState</code>模式，让<code class="du lv lw lx la b">src/Components/Settings.js</code>看起来像这样:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="f376" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经拥有了API调用问题所需的所有信息。</p><p id="ae93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这时我意识到，将这些信息保存在redux store中是最容易的。在组件之间传递选项和问题是可能的，但我更喜欢将应用程序数据保存在一个集中的存储中，因为它允许更大的灵活性和可扩展性。</p><h1 id="73eb" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">设置一个简单的redux存储</h1><p id="8867" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">由于这是一个小应用程序，我们不需要担心复杂的存储结构reducers的单个文件应该足够了。</p><p id="5559" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要运行下面的代码将<a class="ae jd" href="https://redux.js.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> redux </strong> </a>和<a class="ae jd" href="https://react-redux.js.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> react-redux </strong> </a>添加到我们的应用程序中:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="d1ae" class="le jt hi la b fi lf lg l lh li">yarn add redux react-redux</span></pre><p id="0a72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并更新<code class="du lv lw lx la b">App.js</code>这样:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="1558" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要创建<code class="du lv lw lx la b">src/Reducer.js</code>，并开始将选项状态从<code class="du lv lw lx la b">src/Components/Settings.js</code>转移到redux状态。</p><p id="2ab6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如下图所示，我们可以将初始状态声明为一个变量。在这个变量的options键下，我们可以存储当前保存在<code class="du lv lw lx la b">Settings</code>组件中的值。</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="d067" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还需要一种方法来更新这些值。因为这是一个相对简单的redux设置，所以我们可以在reducer中使用一个开关函数来消费将从我们的组件发送的动作:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="336c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可能会注意到，在更新状态对象时，我们使用了<a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax" rel="noopener ugc nofollow" target="_blank">扩展操作符(…) </a>。通过这样做，我们创建了状态对象的一个副本，然后我们将把我们的新值添加到其中，这意味着我们没有直接改变状态对象。<a class="ae jd" href="https://redux.js.org/recipes/using-object-spread-operator" rel="noopener ugc nofollow" target="_blank">这是与商店</a>合作的最佳实践。</p><p id="3be1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以返回到<code class="du lv lw lx la b">Settings</code>组件，用redux动作替换状态和效果挂钩。我们需要从react-redux导入<code class="du lv lw lx la b">useSelector</code>和<code class="du lv lw lx la b">useDispatch</code>。<code class="du lv lw lx la b">useSelector</code>允许我们访问状态，同时我们可以使用<code class="du lv lw lx la b">useDispatch</code>来更新它。</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="c739" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你会注意到，我们没有改变任何JSX在这里，这是伟大的！这是因为我们已经在函数中巧妙地处理了所有的更改事件，我们可以简单地更改钩子函数来分派动作，将动作类型和值作为有效载荷传递。</p><p id="f142" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以将<code class="du lv lw lx la b">handleCategoryChange</code>中的变化作为一个具体的例子来看。原来是这样的:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="d8a6" class="le jt hi la b fi lf lg l lh li">const handleCategoryChange = event =&gt; {<br/>  setQuestionCategory(event.target.value)<br/>}</span></pre><p id="682b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="8fd7" class="le jt hi la b fi lf lg l lh li">const handleCategoryChange = event =&gt; {<br/>  dispatch({<br/>    type: 'CHANGE_CATEGORY',<br/>    value: event.target.value<br/>  })<br/>}</span></pre><p id="534e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在定义有效载荷对象中的动作类型。我们这样做是因为动作现在由<code class="du lv lw lx la b">Reducer.js</code>中的开关函数解释:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="02aa" class="le jt hi la b fi lf lg l lh li">// src/Components/Reducer.js<br/>...<br/>case "CHANGE_CATEGORY":<br/>      return {<br/>        ...state,<br/>        options: {<br/>          ...state.options,<br/>          question_category: action.value<br/>        }<br/>      }<br/>...</span></pre><p id="a709" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以<code class="du lv lw lx la b">Reducer</code>意识到在这种情况下，我们想要更新处于redux状态的<code class="du lv lw lx la b">question_category</code>。有效负载中的<code class="du lv lw lx la b">value</code>就是我们希望<code class="du lv lw lx la b">question_category</code>在商店中更新的值。</p><p id="daf3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可能还会注意到<code class="du lv lw lx la b">useDispatch()</code>是这样分配给一个变量的:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="11b2" class="le jt hi la b fi lf lg l lh li">const dispatch = useDispatch()</span></pre><p id="8ad9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这样我们就可以将它作为依赖项传递给<code class="du lv lw lx la b">useEffect()</code>。我们仍然在一个钩子中获取问题类别，并且需要在更新加载状态时从钩子中调度一个动作。</p><h1 id="e123" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">提出问题请求</h1><p id="5ceb" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">既然问题选项在redux存储中可供所有组件访问，我们就可以对测验问题发出API请求，并将它们保存在存储中。</p><p id="919c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将创建一个名为<code class="du lv lw lx la b">FetchButton</code>的组件来完成这项工作。</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="0bad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，您可以看到使用<code class="du lv lw lx la b">useSelector</code>从商店收集的相关信息。然后，当按钮被点击时，我们在<code class="du lv lw lx la b">handleQuery</code>中处理这个信息。我们根据是否选择了某个选项来动态构建API url参数——如果用户选择了“all ”,那么我们不会将它作为参数添加。</p><p id="4ae3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在同一个函数中，我们使用<code class="du lv lw lx la b">fetch</code>发出API请求。</p><p id="9232" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以处理响应并将其设置为如下状态:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="5bcf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在这里添加了一个新动作<code class="du lv lw lx la b">SET_QUESTION</code>，所以我们也想更新<code class="du lv lw lx la b">Reducer.js</code>中的开关功能:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><h1 id="2221" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">添加问题组件</h1><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lj"><img src="../Images/75381fd752ea93e2c9044bb2e00eb7b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zVBKKdIvF7fo28MI4IqEwg.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">The Question component will display the question, options and the user score.</figcaption></figure><p id="76a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经将问题保存在状态中，我们可以创建一个组件来显示问题并让用户选择他们的答案。因为我们需要保存用户当前所在问题的索引，以及用户的当前分数，所以我们可以将它们添加到redux存储中，初始值为<code class="du lv lw lx la b">0</code>。此外，我们可以在<code class="du lv lw lx la b">Reducer</code> switch语句中为更新这些值的操作添加实例:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="ac6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以在<code class="du lv lw lx la b">src/Components/Question.js</code>将这些添加到我们的空组件中，就像这样:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="07f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了从redux存储中检索分数、问题和问题索引之外，还有当前问题和正确答案的变量。useDispatch也已经导入并定义，可以使用了。</p><p id="dd00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">问题的形状如下:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="1f1b" class="le jt hi la b fi lf lg l lh li">{<br/>  "category": "Entertainment: Video Games",<br/>  "type": "boolean",<br/>  "difficulty": "easy",<br/>  "question": "Peter Molyneux was the founder of Bullfrog Productions.",<br/>  "correct_answer": "True",<br/>  "incorrect_answers": [<br/>    "False"<br/>  ]<br/>}</span></pre><p id="20dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正确答案与错误答案的数组分开返回。因此，我编写了一个简单的<code class="du lv lw lx la b">useEffect</code>函数，将正确和不正确的选项一起返回，正确答案放在数组中的随机位置。然后，答案选项被保存为状态<code class="du lv lw lx la b">options</code>:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="13bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在为<code class="du lv lw lx la b">Question</code>组件添加JSX之前，要考虑的最后一件事是，我们想要一个“未回答”和“已回答”的状态。在用户选择答案之前，我们需要显示的主要信息是问题和答案选项。当用户做出选择时，我们应该显示他们是否选择了正确的答案，如果没有，显示他们正确的答案是什么。因为我们将在同一个组件中完成所有这些工作，所以没有必要将这些信息发送到redux store，所以我们可以使用钩子来控制这个状态:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="f4bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">目前，该组件将显示第一个问题和答案选项，但单击选项不会更新任何内容。为了解决这个问题，我们向选项的<code class="du lv lw lx la b">onClick</code>处理程序添加了功能。点击时，我们需要:</p><ul class=""><li id="de3d" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc ma jk jl jm bi translated">将<code class="du lv lw lx la b">answerSelected</code>设置为<code class="du lv lw lx la b">true</code></li><li id="40be" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc ma jk jl jm bi translated">根据选择的内容，将<code class="du lv lw lx la b">answerCorrect</code>设置为<code class="du lv lw lx la b">true</code>或<code class="du lv lw lx la b">false</code></li><li id="88c0" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc ma jk jl jm bi translated">如果答案正确，更新<code class="du lv lw lx la b">score</code></li><li id="28b0" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc ma jk jl jm bi translated">如果不是最后一个问题，通过更新他们的<code class="du lv lw lx la b">index</code>进入下一个问题</li></ul><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="653d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参数为2500毫秒的<code class="du lv lw lx la b">setTimeout</code>功能意味着我们显示用户是否得到了正确答案，并在进入下一个问题之前显示正确答案一秒钟。</p><p id="4962" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要解码从API发送的文本。由于没有本地的Javascript函数，所以我在这里实现了这个解决方案——它并不漂亮，但是完成了工作:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="9ac9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们可以在用户做出选择后向选项添加一个动态类。我使用了if语句，以便:</p><ul class=""><li id="6b5d" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc ma jk jl jm bi translated">如果尚未选择答案，则没有列表项具有动态类名</li><li id="6ebc" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc ma jk jl jm bi translated">当选择了一个选项时，正确答案将具有类别<code class="du lv lw lx la b">correct</code></li><li id="1937" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc ma jk jl jm bi translated">当选择了一个选项时，用户点击的列表项将具有类别<code class="du lv lw lx la b">selected</code></li></ul><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="fa92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<code class="du lv lw lx la b">App.css</code>中，我们可以为这些类添加一些样式。如果列表项有类别<code class="du lv lw lx la b">correct</code>，那么它的背景颜色应该是绿色。如果一个列表项有类别<code class="du lv lw lx la b">selected</code>并且没有类别<code class="du lv lw lx la b">correct</code>，那么它应该有红色背景。因此，如果用户选择了正确的项目，它将是绿色的。如果他们选择了一个不正确的项目，该项目将显示为红色，正确答案将以绿色突出显示:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="c17b" class="le jt hi la b fi lf lg l lh li">...</span><span id="a1d3" class="le jt hi la b fi mb lg l lh li">li:hover {<br/>  background-color: <!-- -->#772139<!-- -->;<br/>  color: white;<br/>}</span><span id="cc20" class="le jt hi la b fi mb lg l lh li">li.correct {<br/>  background-color: rgb(53, 212, 53);<br/>}</span><span id="ca83" class="le jt hi la b fi mb lg l lh li">li.selected:not(correct) {<br/>  background-color: rgb(206, 58, 58);<br/>}</span><span id="760a" class="le jt hi la b fi mb lg l lh li">...</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mc"><img src="../Images/d70e8b1fd3c82a7f36778ed9df393681.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QH1Jy64NmP7-ONZ9miISrQ.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">We can use dynamic classes to show the correct answer. Here the user has selected the correct option</figcaption></figure><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es md"><img src="../Images/61cf0e2dbaaf5d3b2deca35799ed00cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sK_9pHgGar6n_NxZvkVGKQ.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">Here they have chosen the incorrect option</figcaption></figure><p id="602d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是完成的<code class="du lv lw lx la b">Question</code>组件:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><h1 id="1750" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">最后一页</h1><p id="9fd7" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">我们在最后冲刺阶段！<code class="du lv lw lx la b">FinalScreen</code>是我们将为测验应用程序制作的最后一个组件。</p><p id="c036" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">目前，一旦用户回答了最后一个问题，就无处可去了——他们被卡在一个页面上，告诉他们这个答案是正确的还是不正确的。</p><p id="39ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们有多种方法来完成这一轮的问题，但我决定给用户3个选项:</p><ul class=""><li id="231e" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc ma jk jl jm bi translated">再次尝试相同的问题</li><li id="57a9" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc ma jk jl jm bi translated">使用相同的设置获取新问题</li><li id="0971" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc ma jk jl jm bi translated">返回到设置页面</li></ul><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lj"><img src="../Images/b1f0b635ddff6a4099bfcb3232fd303e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h_fFe4_ix5QDOw6z-UBlkw.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">The final page should show the final score, and give the user options for what to do next.</figcaption></figure><p id="bcdb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果用户选择重试相同的问题，我们只需将问题索引和分数设置回0，它们将返回到第一个问题:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="01c6" class="le jt hi la b fi lf lg l lh li">// src/Components/FinalScreen.js<br/>...</span><span id="0620" class="le jt hi la b fi mb lg l lh li">const dispatch = useDispatch()</span><span id="5226" class="le jt hi la b fi mb lg l lh li">  const replay = () =&gt; {<br/>    dispatch({<br/>      type: 'SET_INDEX',<br/>      index: 0<br/>    })</span><span id="120d" class="le jt hi la b fi mb lg l lh li">    dispatch({<br/>      type: 'SET_SCORE',<br/>      score: 0<br/>    })<br/>  }</span><span id="3c47" class="le jt hi la b fi mb lg l lh li">...</span></pre><p id="8cf5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果用户选择获取新的问题，我们需要重置索引、评分并对问题进行另一次API调用。为此，我们可以重用已经在<code class="du lv lw lx la b">Settings</code>中导入的<code class="du lv lw lx la b">FetchButton</code>组件。因为我们的设置存储在redux存储中，所以我们只需要在这里做几件事情:</p><ul class=""><li id="232f" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc ma jk jl jm bi translated">将按钮文本作为道具提供给<code class="du lv lw lx la b">FetchButton</code></li><li id="a8d1" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc ma jk jl jm bi translated">如果<code class="du lv lw lx la b">questionIndex</code>大于0，重置<code class="du lv lw lx la b">FetchButton</code>中<code class="du lv lw lx la b">handleQuery</code>函数的问题索引和分数。这是因为如果用户选择请求更多的问题，我们希望转到第一个问题并重置分数</li></ul><p id="7cd3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，由于如果redux存储中没有问题，那么<code class="du lv lw lx la b">Settings</code>组件将显示在<code class="du lv lw lx la b">App.js</code>中——如果用户选择返回设置，我们只需清空存储中的问题数组，并将<code class="du lv lw lx la b">score</code>重置为<code class="du lv lw lx la b">0</code>:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="3100" class="le jt hi la b fi lf lg l lh li">// src/Components/FinalScreen.js<br/>...</span><span id="1c2a" class="le jt hi la b fi mb lg l lh li">const settings = () =&gt; {<br/>    dispatch({<br/>      type: 'SET_QUESTIONS',<br/>      questions: []<br/>    })</span><span id="0eaa" class="le jt hi la b fi mb lg l lh li">    dispatch({<br/>      type: 'SET_SCORE',<br/>      score: 0<br/>    })<br/>  }</span><span id="00d1" class="le jt hi la b fi mb lg l lh li">...</span></pre><p id="e78b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是完整的<code class="du lv lw lx la b">FinalScreen</code>组件:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="ly lz l"/></div></figure><h1 id="c489" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">感谢您的阅读</h1><p id="331a" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">这就是我们想要的——一个小型的、适合特定用途的测验应用程序。</p><p id="3942" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个应用程序肯定有扩展的空间。有几件事我想在以后补充，比如:</p><ul class=""><li id="9d4e" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc ma jk jl jm bi translated">使用API的会话令牌，此外还有一个平台，如<a class="ae jd" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> firebase </a>来存储用户的设置、问题和得分历史</li><li id="47d4" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc ma jk jl jm bi translated">创建多人游戏选项</li></ul><p id="962e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Medium上关注我以获取更多内容！</p></div></div>    
</body>
</html>