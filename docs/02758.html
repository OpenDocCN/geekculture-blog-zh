<html>
<head>
<title>Helm In Kubernetes — Part 2: How to create a simple Helm Chart</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes中的掌舵——第2部分:如何创建简单的掌舵图</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/helm-in-kubernetes-part-2-how-to-create-a-simple-helm-chart-af899fc2741d?source=collection_archive---------17-----------------------#2021-05-25">https://medium.com/geekculture/helm-in-kubernetes-part-2-how-to-create-a-simple-helm-chart-af899fc2741d?source=collection_archive---------17-----------------------#2021-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/39d59184389589086c7559b6a8626ae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QWZXYRl8YxyioxYxYgJU1w.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@loik_marras?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Loik Marras</a> on <a class="ae iu" href="https://unsplash.com/s/photos/helm?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a00b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经了解了Helm可以为我们做什么，让我们从现有的Kubernetes YAML文件创建一个简单的Helm图表。在这篇文章的结尾，你会知道如何:</p><ul class=""><li id="e131" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">写一个简单的舵图</li><li id="eec9" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">将值插入舵模板</li><li id="795d" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">安装、升级和回滚Helm版本</li></ul><p id="53f0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您愿意，可以随意下载回购协议和代码。你可以在这里找到回购<a class="ae iu" href="https://github.com/yoongti/devops" rel="noopener ugc nofollow" target="_blank">。我们将要体验的应用程序是<code class="du kh ki kj kk b">01-first-app</code>。</a></p><p id="6e2f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您需要一些东西来开始:</p><ul class=""><li id="a746" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><a class="ae iu" href="https://minikube.sigs.k8s.io/docs/start/" rel="noopener ugc nofollow" target="_blank"> Minikube </a> —让你在本地运行Kubernetes的工具</li><li id="41ae" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><a class="ae iu" href="https://k8slens.dev/" rel="noopener ugc nofollow" target="_blank">镜头</a> -Kubernetes IDE</li><li id="4f5e" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">当然，还有<a class="ae iu" href="https://helm.sh/docs/intro/install/" rel="noopener ugc nofollow" target="_blank">掌舵</a></li></ul><p id="2943" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">确保通过运行以下命令启动Minikube:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="5a44" class="kt ku hi kk b fi kv kw l kx ky">minikube start</span></pre><h1 id="f520" class="kz ku hi bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用Kubectl部署应用程序到Minikube</h1><p id="9d28" class="pw-post-body-paragraph iv iw hi ix b iy lw ja jb jc lx je jf jg ly ji jj jk lz jm jn jo ma jq jr js hb bi translated">在我们开始创建一个掌舵图之前，我们首先看看我们通常如何使用Kubectl来部署一个Kubernetes应用程序。</p><p id="9297" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du kh ki kj kk b">first-app</code>是一个简单的节点app。该应用程序被打包成一个名为<code class="du kh ki kj kk b">leeyoongti/first-app</code>的图像，我已经准备好并推送到Docker Hub。</p><p id="99de" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是<code class="du kh ki kj kk b">first-app</code>的<code class="du kh ki kj kk b">app.js</code>代码。</p><figure class="kl km kn ko fd ij"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="bcf2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">注:</strong> <code class="du kh ki kj kk b">/v1</code>路径在<code class="du kh ki kj kk b">leeyoongti/first-app</code>的<code class="du kh ki kj kk b">1.0.0</code>版本上可用，<code class="du kh ki kj kk b">/v2</code>仅在<code class="du kh ki kj kk b">2.0.0</code>以上版本上可用，<code class="du kh ki kj kk b">/v3</code>仅在<code class="du kh ki kj kk b">3.0.0</code>以上版本上可用。</p><p id="9fe3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下图显示了我们希望部署到Minikube集群的内容。具有1个副本的<code class="du kh ki kj kk b">leeyoongti/first-app</code>的部署。</p><figure class="kl km kn ko fd ij er es paragraph-image"><div class="er es md"><img src="../Images/cebfde4919fc67def2f227e68f8b72e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*VfsdJFr0S5k8TJODROKIFA.png"/></div></figure><p id="863d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">再来看<code class="du kh ki kj kk b">/01-first-app/yml/deployment.yml</code>。</p><figure class="kl km kn ko fd ij"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="70e0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">几个要点:</p><ul class=""><li id="de61" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">部署名称是<code class="du kh ki kj kk b">first-app</code>(第4行)。</li><li id="6b1d" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">容器的名字也是<code class="du kh ki kj kk b">first-app</code>(第19行)。</li><li id="b261" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">容器的端口(应用程序运行的端口)是80(第21行)。</li></ul><p id="77ff" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以通过运行以下命令，使用YAML文件创建部署:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="b01a" class="kt ku hi kk b fi kv kw l kx ky">kubectl apply -f apps/01-first-app/yml/deployment.yml</span></pre><p id="21f9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果部署成功，您应该会看到以下消息</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="fc64" class="kt ku hi kk b fi kv kw l kx ky">deployment.apps/first-app created</span></pre><p id="2c05" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">转到镜头，检查pod是否正常运行。</p><figure class="kl km kn ko fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/36db92ac4528ef09b112707a3fc80c57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YG2a3RlBAk3mUCHwiyI3ZQ.png"/></div></div></figure><p id="c50c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">单击80/TCP将打开您的浏览器。</p><figure class="kl km kn ko fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/f63e58ff9fd1117340732bba36c73bc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ZqPeyEuJ-pao1NV3o5JMQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">app running on Chrome</figcaption></figure><h1 id="1e21" class="kz ku hi bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用舵图部署应用程序</h1><p id="4c82" class="pw-post-body-paragraph iv iw hi ix b iy lw ja jb jc lx je jf jg ly ji jj jk lz jm jn jo ma jq jr js hb bi translated">该应用程序工作正常，现在让我们看看我们如何使用Helm Chart部署应用程序。</p><p id="55c7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，让我们通过运行以下命令来清理我们之前进行的部署:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="2389" class="kt ku hi kk b fi kv kw l kx ky">kubectl delete deployment first-app</span></pre><p id="3da2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您应该会看到以下消息:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="cb40" class="kt ku hi kk b fi kv kw l kx ky">deployment.apps "first-app" deleted</span></pre><p id="e022" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以返回Lens，再次确认删除的状态。可能需要一些时间来终止pod。</p><p id="bd0f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">转到您想要创建舵图的目录并运行:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="39fe" class="kt ku hi kk b fi kv kw l kx ky">helm create first-app</span></pre><p id="bb67" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您将看到一个名为<code class="du kh ki kj kk b">first-app</code>的目录被创建。</p><figure class="kl km kn ko fd ij er es paragraph-image"><div class="er es mf"><img src="../Images/b393f23ddeb8cea6e5c135a52d7814a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*3ElPlCoTmLhSYTlVtQQcVA.png"/></div></figure><p id="c23f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们一次看一个。</p><ul class=""><li id="aa13" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated"><code class="du kh ki kj kk b">charts</code>是存储图表依赖关系的地方。</li><li id="9142" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><code class="du kh ki kj kk b">templates</code>是存储部署、服务、配置图等模板的地方。</li><li id="e06c" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><code class="du kh ki kj kk b">.helmignore</code>基本上和<code class="du kh ki kj kk b">.gitignore</code>一样，包含打包舵图时忽略的模式。</li><li id="b04e" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><code class="du kh ki kj kk b">Chart.yaml</code>定义关于您的图表的信息</li><li id="ab56" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><code class="du kh ki kj kk b">values.yaml</code>定义图表模板将使用的值。</li></ul><p id="0a30" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，删除<code class="du kh ki kj kk b">templates</code>目录下的所有内容，从<code class="du kh ki kj kk b">first-app</code>中复制<code class="du kh ki kj kk b">deployment.yaml</code>并粘贴到<code class="du kh ki kj kk b">templates</code>目录下，就像这样。</p><figure class="kl km kn ko fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/81899b1770d8a2ccaae5a2f735a64325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H7Y_63PALEELl3kXf-Aj2g.png"/></div></div></figure><p id="42eb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，运行以下命令来部署应用程序，假设我们在<code class="du kh ki kj kk b">devops</code>目录中:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="d604" class="kt ku hi kk b fi kv kw l kx ky">// helm install [NAME] [CHART]<br/>helm install first-app handon/first-app</span></pre><ul class=""><li id="5d5a" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">第一个参数是我们想要的舵图表部署的名称</li><li id="a003" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">第二个参数是我们想要部署的图表。</li></ul><p id="a5ec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您会看到下面的消息被打印出来</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="5290" class="kt ku hi kk b fi kv kw l kx ky">NAME: first-app<br/>LAST DEPLOYED: Sun May 23 23:53:56 2021<br/>NAMESPACE: default<br/>STATUS: deployed<br/>REVISION: 1<br/>TEST SUITE: None</span></pre><p id="3740" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以运行以下命令来列出Helm发布的所有内容。</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="7f9d" class="kt ku hi kk b fi kv kw l kx ky">helm list</span></pre><figure class="kl km kn ko fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/51da1288fb8dfb53415970c655808ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OJYaYkYa--7vx41jac6WAw.png"/></div></div></figure><p id="d4a2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以返回Lens以检查部署是否成功。</p><figure class="kl km kn ko fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/5a3b17790e17b5aa7546afad82f0994d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yBT3eR3nGLpCBxtg5ewPZg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Same thing, but deployed using Helm Chart</figcaption></figure><p id="0a72" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您已经学习了如何创建一个简单的Helm图表，并使用Helm install进行部署。干得好！</p><p id="9d6d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在转到<code class="du kh ki kj kk b">/v1</code>路径(您的应用程序可能运行在本地主机的不同端口上)，您应该会看到</p><figure class="kl km kn ko fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/c79b091e66091e673e398bdf14054600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*icoNPIa1wudQO2MXsqciZQ.png"/></div></div></figure><p id="144b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在转到<code class="du kh ki kj kk b">/v2</code></p><figure class="kl km kn ko fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/24873f3b79c8ef133eea006fe3b3c727.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ULHmzecWyF3HEMifwA6e2w.png"/></div></div></figure><p id="bbcd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它将显示一个错误，这是因为<code class="du kh ki kj kk b">leeyoongti/first-app:1.0.0</code>没有这个GET响应，我们需要升级到<code class="du kh ki kj kk b">2.0.0</code>才能工作。现在<code class="du kh ki kj kk b">templates/deployment.yaml</code>上的一切都是硬编码的，让我们通过向它注入值来改变这一点。所以每当我们想要改变一些东西，比如这个例子中的标签，我们只需要更新<code class="du kh ki kj kk b">values.yaml</code>。</p><p id="32aa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，将图表中的<code class="du kh ki kj kk b">templates/deployment.yaml</code>更改如下:</p><figure class="kl km kn ko fd ij"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="a252" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，将图表中<code class="du kh ki kj kk b">values.yaml</code>的内容更改为:</p><figure class="kl km kn ko fd ij"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="a559" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当我们想给模板注入值时，我们需要定义占位符，让Helm知道我们想把这些值放在哪里。在Helm中，占位符是这样的:<code class="du kh ki kj kk b">{{ .Values. }}</code>。</p><p id="0c1d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在尝试运行以下命令，查看Helm将根据我们提供的模板和值生成的文件。</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="b638" class="kt ku hi kk b fi kv kw l kx ky">helm template first-app</span></pre><p id="ee85" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你会看到</p><figure class="kl km kn ko fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/9d96c5ac3e34772d252f8366c3e8ccdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*31YsiFmVeGL0Qf_GJ3Az8g.png"/></div></div></figure><p id="7255" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du kh ki kj kk b">helm template</code>是一个强大的命令，允许您在对模板/值不确定时查看生成的输出。</p><p id="ac2a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们已经部署了<code class="du kh ki kj kk b">first-app:1.0.0</code>，让我们来升级一下。去<code class="du kh ki kj kk b">values.yaml</code>把<code class="du kh ki kj kk b">tag</code>换成<code class="du kh ki kj kk b">2.0.0</code>，像这样</p><figure class="kl km kn ko fd ij"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="c2eb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">那就跑</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="7248" class="kt ku hi kk b fi kv kw l kx ky">helm upgrade first-app first-app</span></pre><p id="fe3a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您应该会看到以下消息</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="6515" class="kt ku hi kk b fi kv kw l kx ky">Release "first-app" has been upgraded. Happy Helming!<br/>NAME: first-app<br/>LAST DEPLOYED: Tue May 25 20:44:53 2021<br/>NAMESPACE: default<br/>STATUS: deployed<br/>REVISION: 2<br/>TEST SUITE: None</span></pre><p id="1951" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">好了，让我们回到Lens，点击80/TCP(和之前一样)通过浏览器访问你的pod。尝试访问<code class="du kh ki kj kk b">/v2</code>路径，您应该会看到以下内容。</p><p id="545d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">注意</strong>:升级部署将导致创建新的pod，因此您现有的pod将不复存在。这就是为什么你将需要通过镜头访问新的吊舱。</p><figure class="kl km kn ko fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/dd002d480ad09c334aba75a4cc8e8228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zeU2sDz4N4yUALHQJaL60w.png"/></div></div></figure><p id="7727" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您也可以通过查看Lens上的pod来验证您是否已成功升级到<code class="du kh ki kj kk b">2.0.0</code>。</p><figure class="kl km kn ko fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/5e0f8e6a05214609d839a5de8bed62c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SQ-TLHlZFqxQqIcS1WCecQ.png"/></div></div></figure><p id="b2bf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">太好了！如果你想升级到<code class="du kh ki kj kk b">3.0.0</code>，你只需更新你的<code class="du kh ki kj kk b">values.yaml</code>并再次运行<code class="du kh ki kj kk b">helm upgrade first-app first-app</code>即可。</p><p id="3b40" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你想回滚到<code class="du kh ki kj kk b">1.0.0</code>怎么办？很简单。运行以下命令:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="f63a" class="kt ku hi kk b fi kv kw l kx ky">// <!-- -->helm rollback &lt;RELEASE&gt; [REVISION] [flags]<br/>helm rollback first-app</span></pre><p id="8244" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您不提供<code class="du kh ki kj kk b">REVISION</code>，它将回滚到先前的版本。现在您应该看到:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="d890" class="kt ku hi kk b fi kv kw l kx ky">Rollback was a success! Happy Helming!</span></pre><p id="c253" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">检查镜头，你应该看到它回滚到以前的版本！</p><p id="25d6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以通过运行以下命令来检查您对<code class="du kh ki kj kk b">first-app</code>的所有发布:</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="ec76" class="kt ku hi kk b fi kv kw l kx ky">helm history first-app</span></pre><figure class="kl km kn ko fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/fa3e13db51b07bf1c925c1ab1aee7e10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gDEjDnXB6SOicrgukJ980w.png"/></div></div></figure><p id="1080" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">注意:</strong>图表和应用程序版本看起来相同的原因是因为这些值是在<code class="du kh ki kj kk b">Chart.yml</code>中定义的，我们没有更新它们。(我在升级到<code class="du kh ki kj kk b">2.0.0</code>时更新了应用版本，因此它显示的是<code class="du kh ki kj kk b">1.0.0</code>而不是<code class="du kh ki kj kk b">1.16.0</code>。</p><h1 id="a11f" class="kz ku hi bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><p id="4e65" class="pw-post-body-paragraph iv iw hi ix b iy lw ja jb jc lx je jf jg ly ji jj jk lz jm jn jo ma jq jr js hb bi translated">我们已经看到了如何为部署编写一个简单的舵图。我们学习了如何将值注入模板，这样我们就不必硬编码所有的值。最后，我们还研究了安装、升级和回滚Helm版本。</p><div class="mm mn ez fb mo mp"><a href="https://leeyoongti.medium.com/helm-in-kubernetes-part-1-introduction-81c810c8f486" rel="noopener follow" target="_blank"><div class="mq ab dw"><div class="mr ab ms cl cj mt"><h2 class="bd hj fi z dy mu ea eb mv ed ef hh bi translated">库伯内特斯头盔第1部分:简介</h2><div class="mw l"><h3 class="bd b fi z dy mu ea eb mv ed ef dx translated">如果你使用Kubernetes已经有一段时间了，你可能听说过Helm。但赫尔姆究竟是什么？什么……</h3></div><div class="mx l"><p class="bd b fp z dy mu ea eb mv ed ef dx translated">leeyoongti.medium.com</p></div></div><div class="my l"><div class="mz l na nb nc my nd io mp"/></div></div></a></div><div class="mm mn ez fb mo mp"><a href="https://leeyoongti.medium.com/helm-in-kubernetes-part-3-hand-on-with-flow-control-and-pipelines-68a984a7e851" rel="noopener follow" target="_blank"><div class="mq ab dw"><div class="mr ab ms cl cj mt"><h2 class="bd hj fi z dy mu ea eb mv ed ef hh bi translated">Kubernetes中的头盔第3部分:流动控制和管道</h2><div class="mx l"><p class="bd b fp z dy mu ea eb mv ed ef dx translated">leeyoongti.medium.com</p></div></div><div class="my l"><div class="ne l na nb nc my nd io mp"/></div></div></a></div><div class="mm mn ez fb mo mp"><a href="https://leeyoongti.medium.com/helm-in-kubernetes-part-4-publish-helm-chart-to-artifact-hub-using-github-pages-ab7f55904faa" rel="noopener follow" target="_blank"><div class="mq ab dw"><div class="mr ab ms cl cj mt"><h2 class="bd hj fi z dy mu ea eb mv ed ef hh bi translated">Kubernetes中的头盔:第4部分——使用Github页面将头盔图发布到工件中心</h2><div class="mx l"><p class="bd b fp z dy mu ea eb mv ed ef dx translated">leeyoongti.medium.com</p></div></div><div class="my l"><div class="nf l na nb nc my nd io mp"/></div></div></a></div><p id="e1e5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ng">感谢阅读！如果你喜欢这篇文章，留下一个赞，这样其他人也可以看到。</em></p></div></div>    
</body>
</html>