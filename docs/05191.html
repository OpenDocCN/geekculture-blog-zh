<html>
<head>
<title>How to use Nodejs backend for your Next.js project (or both).</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为您的Next.js项目(或两者)使用Nodejs后端。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-use-nodejs-backend-for-your-next-js-project-or-both-b36d9dc9ab0a?source=collection_archive---------1-----------------------#2021-07-14">https://medium.com/geekculture/how-to-use-nodejs-backend-for-your-next-js-project-or-both-b36d9dc9ab0a?source=collection_archive---------1-----------------------#2021-07-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/135432df75906250da5a74fa6cb04fad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7IFWIqKtcdK7KOoMAopLqQ.png"/></div></div></figure><p id="e894" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我找不到任何理由不在我的react项目中使用Next.js，我想我不必解释它的好处，这就是我喜欢Next.js胜过其他框架的原因。</p><ol class=""><li id="3259" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">写得很好的文档。</li><li id="d327" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">很棒的开发经验。</li><li id="4892" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">文件系统路由。</li><li id="1b2f" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">从一开始就做好生产准备。</li></ol><p id="043f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是为了处理后端，Next.js会在部署时自动将“页面/api”路由转换成独立的函数。这种基础设施被称为功能即服务。虽然这避免了维护单独服务器的复杂性，但有时我们可能需要Nodejs来处理后端。</p><p id="7305" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我的例子中，首先我尝试了Next.js内置服务器来处理我的后端，这涉及到许多MongoDB交互。它运行良好，但经常遇到问题，我很难找到它的文档。所以由于时间限制，我选择放弃Next.js后端的想法，而使用Nodejs。所以在我的研究中，我发现了很多使用Next.js的自定义后端的方法，我认为如果你想快速设置项目，这是最好的选择。</p><p id="1525" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这种情况下，我们唯一需要关心的文件是next.config.js。我们使用的方法是next.js重写。重写可以充当前端和后端之间的代理。要使用重写，只需打开next.config.js并添加重写功能。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="0543" class="kl km hi kh b fi kn ko l kp kq">module.exports = {<br/>  async rewrites() {<br/>    return [<br/>      {<br/>        source: &lt;api endpoint in used in the front end&gt;,<br/>        destination: &lt;nodejs handler endpoint&gt;,<br/>      },<br/>    ]<br/>  },<br/>}</span></pre><p id="fad6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，当使用Next.js内置服务器时，概念很简单，我们将所有后端处理程序放在pages/api/目录中。当使用rewrites时，请求首先命中next.config.js文件，该文件首先在api/目录中查找所请求的端点，如果找到，则请求被路由到该端点。如果源目的地不在api/目录内，那么请求被路由到目的地端点，该端点可以是独立的后端服务器或Next.js内置服务器中的不同端点。因为rewrites函数返回重写对象的数组，所以我们可以定义尽可能多的重写。</p><p id="d4a3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">优势</strong></p><ol class=""><li id="f0c2" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">由于重写充当URL代理，我们可以直接从服务器设置cookies，无需进一步配置。</li><li id="7163" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">同时使用不同后端架构的灵活性。</li><li id="da1e" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">更好的前端和后端隔离，易于维护。</li><li id="b62d" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">更好地分配服务器资源。</li><li id="89ba" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">我们可以忘掉CORS。</li></ol><p id="7c89" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">劣势</strong></p><ol class=""><li id="5315" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">对于具有大量API端点的大型应用程序，next.config.js文件会变得很长，需要手动重写所有端点。</li><li id="d69e" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">如果外部服务器需要更多的时间来发送回响应，连接将被关闭，并将抛出一个内部服务器错误。我认为我们需要为这种情况配置等待时间或避免沉重的负载。</li></ol><p id="c98b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我还没有发现使用这种方法的其他缺点。关于重写的更多细节可以在Next.js文档中找到。如果有人觉得我遗漏了什么，请留下评论，并分享你的想法。</p></div></div>    
</body>
</html>