<html>
<head>
<title>Cloud Recording for React Native Video Chat Using Agora</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Agora的React本地视频聊天的云记录</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/cloud-recording-for-react-native-video-chat-using-agora-d7669201e50f?source=collection_archive---------17-----------------------#2021-04-20">https://medium.com/geekculture/cloud-recording-for-react-native-video-chat-using-agora-d7669201e50f?source=collection_archive---------17-----------------------#2021-04-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e810017e822182a985c788b1b5339bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QapvEhnFCEDVxcyOp6sd9Q.png"/></div></div></figure><p id="b16b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Agora Cloud Recording使开发人员可以轻松地记录和存储他们的实时互动应用程序中的视频。我们将了解如何向React原生视频聊天应用程序添加云录制。本教程结束时，您将能够从您的应用程序中录制视频通话，并将其保存到亚马逊S3存储桶中，供以后访问。</p><h1 id="f159" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">先决条件</h1><ul class=""><li id="4dc6" class="km kn hi is b it ko ix kp jb kq jf kr jj ks jn kt ku kv kw bi translated">一个<a class="ae kx" href="https://sso.agora.io/en/signup?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=cloud-recording-for-react-native-video-chat-using-agora" rel="noopener ugc nofollow" target="_blank"> Agora开发者账户</a></li><li id="ddf3" class="km kn hi is b it ky ix kz jb la jf lb jj lc jn kt ku kv kw bi translated">AWS帐户</li><li id="6ae5" class="km kn hi is b it ky ix kz jb la jf lb jj lc jn kt ku kv kw bi translated">Heroku帐户或其他服务来部署后端</li></ul><h1 id="51cb" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">体系结构</h1><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es ld"><img src="../Images/0408a2f50a94d2033f970fce7e64dc99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*IsvXnonK08dplBmKPcG7mQ.png"/></div></figure><p id="c99d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将部署一个Golang服务器，使用REST API处理来自React本地应用程序的请求。Golang服务器将在内部调用Agora云记录服务，该服务将结果存储在亚马逊S3桶中。</p><p id="316d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您之前没有部署过后端服务或使用过Golang，请不要担心。我们将一起完成整个过程。</p><h1 id="47a1" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">集市设置</h1><ol class=""><li id="5980" class="km kn hi is b it ko ix kp jb kq jf kr jj ks jn li ku kv kw bi translated"><strong class="is hj">创建项目</strong>:一旦你有了Agora账号，点击控制台中的<a class="ae kx" href="https://console.agora.io/projects" rel="noopener ugc nofollow" target="_blank">项目管理标签</a>。单击创建按钮。输入项目的名称。创建项目时选择安全模式。</li><li id="6ded" class="km kn hi is b it ky ix kz jb la jf lb jj lc jn li ku kv kw bi translated"><strong class="is hj">启用云记录</strong>:点击查看使用情况按钮，选择启用云记录的选项。</li><li id="eb0c" class="km kn hi is b it ky ix kz jb la jf lb jj lc jn li ku kv kw bi translated"><strong class="is hj">获取app凭证</strong>:将同一页面的App ID和App证书复制到一个文本文件中。我们以后会用到这些。</li><li id="4417" class="km kn hi is b it ky ix kz jb la jf lb jj lc jn li ku kv kw bi translated"><strong class="is hj">获取客户凭证</strong>:访问<a class="ae kx" href="https://console.agora.io/restfulApi" rel="noopener ugc nofollow" target="_blank"> RESTful API页面</a>，点击Add Secret按钮。将客户ID和客户机密复制到文本文件中。</li></ol><h1 id="cb61" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">AWS设置</h1><p id="706f" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">一旦你创建了一个AWS帐户，我们需要创建一个亚马逊S3桶来存储我们的视频记录和一个IAM用户来访问我们的桶。如果您已经有了这个设置，请随意跳过这一部分。</p><ol class=""><li id="81c6" class="km kn hi is b it iu ix iy jb lm jf ln jj lo jn li ku kv kw bi translated">转到您的<a class="ae kx" href="https://console.aws.amazon.com/iam/home#/users" rel="noopener ugc nofollow" target="_blank"> AWS IAM控制台</a>并创建一个用户。添加带有编程访问的<code class="du lp lq lr ls b">AmazonS3FullAccess</code>策略。</li><li id="188a" class="km kn hi is b it ky ix kz jb la jf lb jj lc jn li ku kv kw bi translated">将AWS访问密钥和秘密密钥复制到文本文件中。</li><li id="5e78" class="km kn hi is b it ky ix kz jb la jf lb jj lc jn li ku kv kw bi translated">创建一个亚马逊<a class="ae kx" href="https://s3.console.aws.amazon.com/s3/home" rel="noopener ugc nofollow" target="_blank"> S3桶</a>，并将桶名复制到文本文件中。要查找您的地区号(针对您的AWS地区)，请转到<a class="ae kx" href="https://docs.agora.io/en/cloud-recording/cloud_recording_api_rest?platform=RESTful#a-namestorageconfigacloud-storage-configuration" rel="noopener ugc nofollow" target="_blank">表</a>，然后点击亚马逊S3选项卡。例如，如果您正在使用<code class="du lp lq lr ls b">US_EAST_1</code>区域，那么您的存储桶编号是0。</li></ol><h1 id="106e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">部署我们的后端</h1><p id="212f" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">在部署我们的后端之前，我们需要以下变量。(是时候使用我们的文本文件了。)我们将使用<a class="ae kx" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>一键式部署，让我们的后端启动和运行变得超级简单。您也可以使用任何其他服务:</p><pre class="le lf lg lh fd lt ls lu lv aw lw bi"><span id="4365" class="lx jp hi ls b fi ly lz l ma mb">APP_ID=<br/>APP_CERTIFICATE=<br/>RECORDING_VENDOR=<br/>RECORDING_REGION=<br/>BUCKET_NAME=<br/>BUCKET_ACCESS_KEY=<br/>BUCKET_ACCESS_SECRET=<br/>CUSTOMER_ID=<br/>CUSTOMER_CERTIFICATE=</span></pre><blockquote class="mc md me"><p id="2316" class="iq ir mf is b it iu iv iw ix iy iz ja mg jc jd je mh jg jh ji mi jk jl jm jn hb bi translated"><em class="hi">注意:</em>对于AWS，RECORDING_VENDOR=1。请访问此<a class="ae kx" href="https://docs.agora.io/en/cloud-recording/cloud_recording_api_rest?platform=RESTful#a-namestorageconfigacloud-storage-configuration" rel="noopener ugc nofollow" target="_blank">链接</a>了解更多信息。</p></blockquote><ol class=""><li id="aabb" class="km kn hi is b it iu ix iy jb lm jf ln jj lo jn li ku kv kw bi translated">如果您还没有在<a class="ae kx" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>上创建帐户，请创建一个。</li><li id="f991" class="km kn hi is b it ky ix kz jb la jf lb jj lc jn li ku kv kw bi translated">点击<a class="ae kx" href="https://dashboard.heroku.com/new?template=https://github.com/AgoraIO-Community/Cloud-Recording-Golang/tree/main" rel="noopener ugc nofollow" target="_blank">此链接</a>使用Heroku一键式部署。</li><li id="0386" class="km kn hi is b it ky ix kz jb la jf lb jj lc jn li ku kv kw bi translated">输入您的变量，然后单击页面底部的部署应用程序按钮。</li><li id="c8c6" class="km kn hi is b it ky ix kz jb la jf lb jj lc jn li ku kv kw bi translated">等几分钟。部署完成后，将您的后端URL保存在文本文件中，我们将在应用程序中使用该文件。</li></ol><h1 id="f1e7" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">构建我们的应用</h1><p id="afb9" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">我们将使用这个<a class="ae kx" href="https://www.agora.io/en/blog/how-to-build-a-react-native-video-calling-app-using-agora/" rel="noopener ugc nofollow" target="_blank">博客</a>中的<a class="ae kx" href="https://github.com/EkaanshArora/Agora-RN-Quickstart" rel="noopener ugc nofollow" target="_blank">示例应用</a>。如果你是Agora平台的新手，我建议你阅读博客，了解如何构建视频聊天应用。我们将以此为基础，讨论如何在其中添加云录制。</p><p id="f3c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果只是想要最后的app，可以去这个<a class="ae kx" href="https://github.com/EkaanshArora/Agora-RN-Recording/blob/main/App.tsx" rel="noopener ugc nofollow" target="_blank">回购</a>。</p><h2 id="9a03" class="lx jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated">获取样板文件</h2><p id="7730" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">确保您已经满足了创建和构建React本机应用程序的先决条件。Git克隆或者从<a class="ae kx" href="https://github.com/EkaanshArora/Agora-RN-Quickstart" rel="noopener ugc nofollow" target="_blank">主分支</a>下载ZIP文件。在项目目录中，执行npm install。如果你正在为iOS构建，也执行cd ios &amp; &amp; pod install。</p><h2 id="8f20" class="lx jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated">添加凭据</h2><p id="7d42" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">打开<code class="du lp lq lr ls b">App.tsx</code>并输入你的后端URL、Agora应用ID和我们应用状态的频道名称(你现在可以忽略打字错误)。频道名称可以是任何字母数字字符串(例如:<code class="du lp lq lr ls b">'test'</code>):</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="mw mx l"/></div></figure><p id="d9ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们还将添加三个新的状态变量，用于记录<code class="du lp lq lr ls b">rid</code>、<code class="du lp lq lr ls b">sid</code>和<code class="du lp lq lr ls b">recUid</code>。</p><h2 id="f557" class="lx jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated">加入我们的频道</h2><p id="313c" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">让我们编辑join channel方法，以使用来自后端的令牌:</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="mw mx l"/></div></figure><p id="39e6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们使用Fetch API从服务器获取令牌，然后使用它加入通道。</p><h2 id="d2e2" class="lx jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated">开始录音</h2><p id="8aca" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">我们将创建一个函数来开始记录:</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="mw mx l"/></div></figure><p id="4605" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将再次使用Fetch API向后端的<code class="du lp lq lr ls b">/api/start/call </code>路由发送POST请求。我们将在请求正文中发送频道名称。一旦我们得到响应，我们将用响应中的<code class="du lp lq lr ls b">rid</code>、<code class="du lp lq lr ls b">sid</code>和<code class="du lp lq lr ls b">recUid</code>更新我们的状态。</p><h2 id="e317" class="lx jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated">停止录制</h2><p id="26cd" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">为了停止记录，我们向后端的<code class="du lp lq lr ls b">/api/stop/call</code>路径发送一个<code class="du lp lq lr ls b">POST</code>请求，请求体中有<code class="du lp lq lr ls b">channel</code>、<code class="du lp lq lr ls b">rid</code>、<code class="du lp lq lr ls b">sid</code>和<code class="du lp lq lr ls b">recUid</code>:</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="mw mx l"/></div></figure><h2 id="1822" class="lx jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated">获取状态</h2><p id="c714" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">让我们创建一个函数来检查记录的状态，并将其记录到控制台:</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="mw mx l"/></div></figure><h2 id="50a9" class="lx jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated">添加按钮</h2><p id="4a51" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">让我们添加一些按钮来执行我们的录制功能:</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="mw mx l"/></div></figure><p id="c7d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您可以执行<code class="du lp lq lr ls b">npm run android</code>或<code class="du lp lq lr ls b">npm run ios</code>在您的设备上启动应用程序，一旦您单击开始录制按钮，几秒钟后您应该可以在您的S3桶中看到您的视频片段。</p><h1 id="b1bd" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="bd78" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">就这样，现在你有了一个使用Agora云录制来存储视频的应用程序。你可以在这里找到如何合并产生的视频片段<a class="ae kx" href="https://docs.agora.io/en/cloud-recording/cloud_recording_merge_files?platform=RESTful" rel="noopener ugc nofollow" target="_blank">。你可以在这里</a>找到更多关于云录制<a class="ae kx" href="https://docs.agora.io/en/cloud-recording/landing-page?platform=RESTful" rel="noopener ugc nofollow" target="_blank">的信息。</a></p></div></div>    
</body>
</html>