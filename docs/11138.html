<html>
<head>
<title>Amazon MQ with Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带Java的Amazon MQ</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/amazon-mq-with-java-9004cdd066a6?source=collection_archive---------8-----------------------#2022-03-06">https://medium.com/geekculture/amazon-mq-with-java-9004cdd066a6?source=collection_archive---------8-----------------------#2022-03-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="eb4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将带您完成创建Amazon MQ的步骤，并将这个队列与我的java客户机连接起来。Amazon MQ所做的是，将消息从一个服务传递到另一个服务。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/ced8db8e4259353d58da3883932b76ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g33T1jgdiK9cOtPu"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@onetdev?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">József Koller</a> on <a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="7e0b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">我的要求</h1><p id="f6cc" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">我的要求很简单。我们有几个基于微服务的应用程序，部署在Kubernetes集群中。这些应用程序需要相互通信。假设我有两个微服务，其中一个用于通知发送服务(服务A)。要向相关的合作伙伴发送通知，服务A应该联系第二个服务(服务B ),从数据库中获取相关的合作伙伴详细信息。因此，服务A只发送通知，而合作伙伴细节的获取由服务b完成。</p><p id="ccc6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有一个问题是，当服务A总是调用服务B从DB获取合作伙伴时，它会产生更高的延迟，并且服务B上的负载会非常高。解决方案是添加一个缓存层，在第一次获取合作伙伴之后，服务A在其中保存合作伙伴的详细信息。这产生了另一个问题，当一个已经获取的伙伴从服务B端被更新时，服务A不知道这个变化，并且可能产生一些错误的通知发送。</p><p id="41b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了解决这个问题，下一个建议是建立一个队列，一旦服务B的合作伙伴发生变化，服务B可以发布一个事件，然后服务A可以订阅该队列，当出现新事件时，它可以使与该合作伙伴相关的缓存失效。</p><p id="14d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望你清楚我要从这个实现中解决的问题。</p><p id="de75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kx"> PS:本文不赘述缓存实现。</em></p><h1 id="0116" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">创建一个亚马逊MQ</h1><ol class=""><li id="61c1" class="ky kz hi ih b ii ks im kt iq la iu lb iy lc jc ld le lf lg bi translated">登录AWS控制台，搜索Amazon MQ。</li><li id="d115" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">点击“创建经纪人”按钮。-&gt;选择Apache ActiveMQ -&gt;单击下一步</li><li id="7585" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">选择主动/备用代理作为部署模式，并选择持久性优化作为存储类型-&gt;单击下一步</li><li id="a6a0" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">为您的代理提供一个名称，然后选择简单身份验证和授权作为访问方法。(提供合适的用户名和密码)</li><li id="8dcf" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">从附加设置中，为队列选择相关的VPC和子网，或新建。对于安全组，您也可以创建一个新的SG，或者使用现有的SG。</li><li id="33f0" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">将公共可访问性设置为“是”</li></ol><p id="4813" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建代理需要一些时间，然后我们可以检查创建的代理。</p><h1 id="dbc3" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">将Amazon MQ连接到Java程序</h1><h2 id="c72f" class="lm jv hi bd jw ln lo lp ka lq lr ls ke iq lt lu ki iu lv lw km iy lx ly kq lz bi translated">出版者</h2><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ma mb l"/></div></figure><h2 id="6e8e" class="lm jv hi bd jw ln lo lp ka lq lr ls ke iq lt lu ki iu lv lw km iy lx ly kq lz bi translated">订户</h2><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ma mb l"/></div></figure><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="6a05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">发布者和订阅者的Maven依赖关系。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="b1a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保从Amazon MQ控制台复制正确的URL。你可以在连接下找到它。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mc"><img src="../Images/c961861f34eb5e59ef2bb0f3f7f59bea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v91DS4Rn5vBGPFz76jIbkw.png"/></div></div></figure><p id="b05c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要访问ActiveMQ web控制台，您可以使用本页中给出的两个URL之一。当您进入web控制台时，您可以找到每个主题的消息计数。</p><p id="098a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望本文能指导您将Java应用程序与Amazon MQ连接起来。下一集见。😀</p></div></div>    
</body>
</html>