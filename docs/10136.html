<html>
<head>
<title>Hide and replace sticky element on scrolling in a React way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以反应方式隐藏和替换滚动时的粘性元素</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/hide-and-replace-sticky-element-on-scrolling-in-a-react-way-8bc3f04e2a81?source=collection_archive---------4-----------------------#2022-01-15">https://medium.com/geekculture/hide-and-replace-sticky-element-on-scrolling-in-a-react-way-8bc3f04e2a81?source=collection_archive---------4-----------------------#2022-01-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="92cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">—棘手但有趣🍡</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/7df4838b17d6ce041fdacb1d7c8ab18a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*wM_DNe8V0KtyEcdzExTNjQ.jpeg"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">最终，我们都将抵达终点 —We will all reach the end</figcaption></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="14f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我工作的一个项目中，我面临一个非常有趣的任务，在一个移动页面的底部有一个粘性按钮，要求是获得如下效果:✨</p><p id="8537" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当用户将手机上的页面滚动到某个<strong class="ih hj">位置</strong>时，这个按钮应该不会再粘在底部，换句话说，<strong class="ih hj">会从这个位置</strong>开始跟随滚动。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="c287" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这看起来有些棘手，但经过一番分析，我发现通过以下步骤应该是可以实现的，例子如下:</p><p id="c1ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">☘️首先，给这个粘性按钮一个可见性状态和Id，这样我们就可以定位它了</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es jw"><img src="../Images/346edf0f5ef345ae7416b103c54b68f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PgEx2ITLh3n7hb_a9fex7A.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">visibility state for the sticky button</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kb"><img src="../Images/d99774189fdbd05fb1062db094d4ed8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ldn7XZ_SuCFvoLcDz0VZ5g.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">give the button an id</figcaption></figure><p id="264c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">☘️其次，使用可视状态有条件地呈现这个粘性按钮，类似于:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kc"><img src="../Images/ad8048ac05bb7ff6b24132f29352f33a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rSLCAOsuDlmghQM-91bSMg.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">conditional render sticky button</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kd"><img src="../Images/c59be5448e6a74504e6ff7d4c07157d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4sMy8G0TgLjgYxryLHpMDw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">conditional render <strong class="bd ke">scrolling </strong>button</figcaption></figure><p id="a203" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">☘️下一步，立即跟踪用户滚动<strong class="ih hj">的位置</strong>，我们可以添加一个<strong class="ih hj">事件监听器</strong>，它应该在组件挂载时添加，在组件卸载时删除，我们给它起个名字"<strong class="ih hj">listentoscroll</strong>"<strong class="ih hj"/>。</p><p id="f3be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">🌸<em class="kf">在React功能组件中，该步骤可以使用</em><strong class="ih hj"><em class="kf">use effect</em></strong>来实现</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kg"><img src="../Images/2087ee0fcaf8ff013cd67d3401d9c4b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ft8JvZzcGz156ZrlVyAlpQ.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">event listener to track the instant position</figcaption></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="3b06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">☘️最后一步也是最有趣的一步，我们将实现这个<strong class="ih hj"> listenToScroll </strong>函数:</p><p id="18a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要两个值👇</p><ul class=""><li id="0232" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">该粘性按钮的隐藏位置(例如<strong class="ih hj">高度到隐藏</strong></li><li id="1908" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">用户滚动的即时位置(例如<strong class="ih hj"> windowScrollHeight </strong></li></ul><p id="f792" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要创建一个函数来获取<strong class="ih hj"> heightToHide </strong>(我们将其命名为"<strong class="ih hj"> getOffset </strong>")，并将其与<strong class="ih hj"> windowScrollHeight </strong>进行比较:</p><ul class=""><li id="43fa" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">如果windowscrollheight&lt; heightToHide, then the sticky button will always be displayed at bottom ⏹</li><li id="575f" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">if windowScrollHeight &gt;heighttohide，那么底部的粘性按钮应该会消失，但在这一点上显示为跟随滚动⬆️的<strong class="ih hj"> <em class="kf">无粘性</em> </strong>按钮</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kv"><img src="../Images/de153f20eff7b6792e6c0fb438b10d13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cACbsXMjYbQWA93Oahqg5Q.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">get the information about the size of the element and its position</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kw"><img src="../Images/d5b990fdf22432628ad1d2efa88a242b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ycVGPwzWzLpo3Cnb-el3Q.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">compare the two values</figcaption></figure><p id="0a28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">👉上面的<strong class="ih hj"> getOffset() </strong>函数是使用<a class="ae kx" href="https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">getBoundingClientRect</strong></a>方法来获取元素的大小及其位置的信息(在我们的例子中是id为<strong class="ih hj">stickyButtonPlaceholder</strong>的<strong class="ih hj"> &lt; div &gt; </strong>)，该信息包含<strong class="ih hj">左、上、右、下、x、y、宽度、高度</strong>属性。</p><p id="00b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">👓我们用<em class="kf"> import { getOffset } from "导入这个函数。/getOffset" </em>并使用div <strong class="ih hj"> id </strong>执行它，以获得<strong class="ih hj">隐藏</strong>的位置—在我们的示例中是<strong class="ih hj"> heightToHide </strong>。</p><p id="9aa7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">👓使用<a class="ae kx" href="https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollTop" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">scroll top</strong></a><strong class="ih hj"/>方法，我们可以<strong class="ih hj"> </strong>获得元素内容垂直滚动的像素数——在我们的例子中是<strong class="ih hj"> windowScrollHeight </strong>。</p><p id="142e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">👉我们<strong class="ih hj">比较</strong>这两个值并且<strong class="ih hj">更新</strong>粘性按钮的可见性状态，然后有条件的渲染它！</p><p id="2a2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">🍄结果:向上滚动到这个特定的<strong class="ih hj"> &lt;格&gt; </strong>，底部的粘性按钮消失，从这个位置开始跟随滚动，作为替换按钮。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es et"><img src="../Images/bf80c3282ad382f050f814d594cf05ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0E4EFZ3RvevFRCNH5L4QQw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">sticky button at bottom</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es ky"><img src="../Images/4c1e7f61066af50d5d23a63d0fb25b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bDbMn2OygihrHtaC7bedCQ.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">button will follow user scrolling and no more sticky at bottom</figcaption></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="1053" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">非常感谢你耐心阅读我的文章，希望你喜欢。👐</p><p id="ec4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你对我的其他文章感兴趣:</p><div class="kz la ez fb lb lc"><a rel="noopener follow" target="_blank" href="/geekculture/react-email-validation-with-dialog-overlay-472ee564d585"><div class="ld ab dw"><div class="le ab lf cl cj lg"><h2 class="bd hj fi z dy lh ea eb li ed ef hh bi translated">用对话框覆盖反应电子邮件验证</h2><div class="lj l"><h3 class="bd b fi z dy lh ea eb li ed ef dx translated">—电子邮件验证有时令人头疼，🧊</h3></div><div class="lk l"><p class="bd b fp z dy lh ea eb li ed ef dx translated">medium.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq jj lc"/></div></div></a></div><div class="kz la ez fb lb lc"><a rel="noopener follow" target="_blank" href="/geekculture/prevent-line-breaks-with-css-68a9f066db60"><div class="ld ab dw"><div class="le ab lf cl cj lg"><h2 class="bd hj fi z dy lh ea eb li ed ef hh bi translated">用CSS防止换行</h2><div class="lj l"><h3 class="bd b fi z dy lh ea eb li ed ef dx translated">—reactcomponent🧚中的css技巧</h3></div><div class="lk l"><p class="bd b fp z dy lh ea eb li ed ef dx translated">medium.com</p></div></div><div class="ll l"><div class="lr l ln lo lp ll lq jj lc"/></div></div></a></div><div class="kz la ez fb lb lc"><a rel="noopener follow" target="_blank" href="/geekculture/css-trick-add-colour-and-linear-gradient-to-a-background-image-2dd0fe6125a8"><div class="ld ab dw"><div class="le ab lf cl cj lg"><h2 class="bd hj fi z dy lh ea eb li ed ef hh bi translated">Css技巧:给背景图片添加颜色和线性渐变</h2><div class="lj l"><h3 class="bd b fi z dy lh ea eb li ed ef dx translated">—一个可以节省您时间的css技巧🦋</h3></div><div class="lk l"><p class="bd b fp z dy lh ea eb li ed ef dx translated">medium.com</p></div></div><div class="ll l"><div class="ls l ln lo lp ll lq jj lc"/></div></div></a></div><div class="kz la ez fb lb lc"><a href="https://javascript.plainenglish.io/find-the-nearest-location-in-a-react-way-9ed51a999807" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab dw"><div class="le ab lf cl cj lg"><h2 class="bd hj fi z dy lh ea eb li ed ef hh bi translated">以反应的方式找到最近的位置</h2><div class="lj l"><h3 class="bd b fi z dy lh ea eb li ed ef dx translated">—️地理定位API</h3></div><div class="lk l"><p class="bd b fp z dy lh ea eb li ed ef dx translated">javascript.plainenglish.io</p></div></div><div class="ll l"><div class="lt l ln lo lp ll lq jj lc"/></div></div></a></div><div class="kz la ez fb lb lc"><a href="https://javascript.plainenglish.io/learn-by-doing-use-gatsby-to-create-your-first-site-af7bfb7a8a6f" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab dw"><div class="le ab lf cl cj lg"><h2 class="bd hj fi z dy lh ea eb li ed ef hh bi translated">边做边学——使用Gatsby创建您的第一个网站</h2><div class="lj l"><h3 class="bd b fi z dy lh ea eb li ed ef dx translated">一步一步来，是的。</h3></div><div class="lk l"><p class="bd b fp z dy lh ea eb li ed ef dx translated">javascript.plainenglish.io</p></div></div><div class="ll l"><div class="lu l ln lo lp ll lq jj lc"/></div></div></a></div><div class="kz la ez fb lb lc"><a href="https://javascript.plainenglish.io/sourcing-json-data-with-gatsby-source-filesystem-and-graphql-6fc7cef2a49e" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab dw"><div class="le ab lf cl cj lg"><h2 class="bd hj fi z dy lh ea eb li ed ef hh bi translated">用gatsby-source-filesystem和GraphQL获取JSON数据</h2><div class="lj l"><h3 class="bd b fi z dy lh ea eb li ed ef dx translated">学习盖茨比第二步</h3></div><div class="lk l"><p class="bd b fp z dy lh ea eb li ed ef dx translated">javascript.plainenglish.io</p></div></div><div class="ll l"><div class="lv l ln lo lp ll lq jj lc"/></div></div></a></div></div></div>    
</body>
</html>