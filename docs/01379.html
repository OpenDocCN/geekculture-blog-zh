<html>
<head>
<title>How to Set Up Appium Desired Capabilities From a JSON File</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从JSON文件设置Appium所需的功能</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-set-up-appium-desired-capabilities-from-a-json-file-91b3e0bb16dc?source=collection_archive---------4-----------------------#2021-04-08">https://medium.com/geekculture/how-to-set-up-appium-desired-capabilities-from-a-json-file-91b3e0bb16dc?source=collection_archive---------4-----------------------#2021-04-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/cc0694a1e0f48d8a261f71448c2f55d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u5GECOQO4YI1tTPovYMRqg.png"/></div></div></figure><p id="763e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">做事情有很多方法。这同样适用于我们如何为appium驱动程序设置我们想要的功能。最简单的方式就像上图。我们创建一个DesiredCapabilities对象，并使用<strong class="is hj"> <em class="jo"> setCapability() </em> </strong>方法为appium驱动程序设置我们想要的功能。或者，如果您有多组所需的功能，您可以将它们放在一个方法中，并将它们合并到一个类中。无论我们如何去做，我们最终的目标都是建立我们想要的能力。每种方法都可行，但我只想分享我和其他人是如何做到的。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jp"><img src="../Images/4408c3caabfa71e62b720032f911e914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*njym7kKPvPpm1aVReTZktA.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx">Desired Capabilities</figcaption></figure><p id="3f1a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上图是我们的JSON文件的样子。它是JSON对象的数组。每个对象都有两个键，<strong class="is hj"> <em class="jo">名称</em> </strong>和<strong class="is hj"> <em class="jo">大写</em> </strong>。<strong class="is hj"> <em class="jo"> name </em> </strong>的值将用于标识要使用的所需功能，而<strong class="is hj"> <em class="jo"> caps </em> </strong>的值将是另一个JSON对象，包含我们所需功能的实际键/值对。</p><p id="2637" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是我们从JSON文件中读取和设置所需功能的步骤。</p><ol class=""><li id="b84a" class="jy jz hi is b it iu ix iy jb ka jf kb jj kc jn kd ke kf kg bi translated">读取并解析我们的JSON文件。</li><li id="fd4a" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">根据<strong class="is hj"> <em class="jo">名称</em> </strong>得到<em class="jo">大写</em> 的值。</li><li id="5417" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">将<strong class="is hj"><em class="jo">caps</em></strong>JSON object转换为string，然后将其映射到HashMap。</li><li id="0696" class="jy jz hi is b it kh ix ki jb kj jf kk jj kl jn kd ke kf kg bi translated">我们使用HashMap创建DesiredCapabilities对象。</li></ol><p id="04b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是实现上述步骤的代码。我有意移除了异常处理，只是在方法签名中抛出一个异常来简化方法。如果您决定处理这些异常，您的方法可能看起来有所不同。</p><p id="f510" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">读取并解析JSON文件</strong></p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es km"><img src="../Images/bcb0823c4fae3ebbc3cb99612b509038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tsSBbwuKBP9jXiyP1T1_2A.png"/></div></div></figure><p id="b0df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了解析我们的JSON，我们将使用com.googlecode.json-simple提供的JSONParser类。关于如何将它添加到您的项目中，只需查看他们的<a class="ae kn" href="https://mvnrepository.com/artifact/com.googlecode.json-simple/json-simple" rel="noopener ugc nofollow" target="_blank"> maven资源库</a>。<strong class="is hj"> JSONParser </strong>的<strong class="is hj"> parse() </strong>方法可以接受一个类型为<strong class="is hj"> Reader </strong>的对象。根据我们的面向对象概念，我们知道<strong class="is hj"> FileReader </strong>是一个<strong class="is hj"> Reader </strong>，所以我们可以将<strong class="is hj"> FileReader </strong>的一个实例传递给<strong class="is hj"> parse() </strong>方法。<strong class="is hj"> FileReader </strong>将负责读取我们的JSON文件，我们只需要确保将正确的路径传递到文件的位置。<strong class="is hj"> parse() </strong>方法将进行解析，并将解析后的值作为<strong class="is hj">对象</strong>返回。因为我们知道文件的内容是一个数组，所以我们需要将那个<strong class="is hj">对象</strong>转换成一个<strong class="is hj"> JSONArray </strong>以便我们能够访问它的方法，我们将使用它来处理我们的数据。出于异常处理的目的，请注意<strong class="is hj"> FileReader </strong>可能会抛出<strong class="is hj"> FileNotFoundException </strong>，<strong class="is hj"> parse() </strong>方法可能会抛出<strong class="is hj"> IOException </strong>或<strong class="is hj"> ParseException </strong>。</p><p id="8f40" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">根据<em class="jo">名称</em> </strong>获取<em class="jo"> caps </em>的值</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/5e2f51e3f3f3d0bf18a2daec990a30a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0H5lr-oUIs2aYd8SH5dCNQ.png"/></div></div></figure><p id="87bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是<strong class="is hj">的getCapability() </strong>方法。我们传递想要使用的功能的名称和JSON文件的位置。直截了当的方法。我们使用了上面讨论的<strong class="is hj"> parseJSON() </strong>方法。我们知道该文件包含一个对象数组，所以我们需要做的就是迭代每个对象，并查看其名称是否与我们想要使用的功能名称相匹配。如果匹配，我们得到<strong class="is hj"> caps </strong>的值，并将其作为<strong class="is hj"> JSONObject </strong>返回。需要注意的一点是，如果JSON不是一个对象数组，比如说数组的数组。对JSONObject的强制转换将会产生ClassCastException。所以要确保你的JSON格式正确，就像图片<em class="jo">期望的功能</em>一样。</p><p id="7006" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">将<em class="jo"> caps </em> JSONObject转换为string并映射到HashMap </strong></p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/13b4608977c1972b0ac09d9a61403595.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QpsKtFgV2GvctyItdxgX3A.png"/></div></div></figure><p id="21e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将JSONObject映射到HashMap非常容易，这要感谢com.fasterxml.jackson.core的Jackson Databind中提供的ObjectMapper。首先，我们创建一个ObjectMapper实例。然后我们使用<strong class="is hj"> readValue() </strong>方法将JSONObject映射到HashMap。如果我们看看ObjectMapper类，<strong class="is hj"> readValue() </strong>是一个严重重载的方法，但我们将使用<strong class="is hj"> readValue(字符串内容，类&lt; T &gt; valueType)。content </strong>是我们想要映射到HashMap的JSON值。<strong class="is hj"> getCapability() </strong>返回一个<strong class="is hj"> JSONObject </strong>，因此为了满足<strong class="is hj"> readValue() </strong>的要求，我们将其转换为一个字符串。注意<strong class="is hj"> getCapability() </strong>可能会返回一个空值，如果发生这种情况，当调用<strong class="is hj"> toString() </strong>时，您会得到一个<strong class="is hj"> NullPointerException </strong>，由您来处理这个异常。valueType 是你要将JSONObject转换成的类。您可以创建自己的类来建模您的JSON，但是在这种情况下HashMap也可以。然后我们返回包含我们功能的散列表。注意<strong class="is hj"> readValue() </strong>可能会抛出<strong class="is hj">jsonparseeexception</strong>或者<strong class="is hj"> JsonMappingException </strong>甚至在一些意外情况下可能会抛出<strong class="is hj"> IOException </strong>。</p><p id="3f1c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">使用HashMap创建DesiredCapabilities对象</strong></p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/3fc274bd92d0811b9d9af95d63caea38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yZ7WcnoVYZDAou--pFoxjw.png"/></div></div></figure><p id="3c17" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是我们的公共接口，用于从JSON文件中获取我们想要使用的功能。我们传递我们想要使用的功能的名称和JSON文件的内容根位置。在第一行中，我们只是构造了文件的路径。幸运的是，我们可以使用HashMap构造DesiredCapabilities对象。因此，在最后一行中，我们通过将caps传递给其构造函数，创建并返回了一个新的DesiredCapabilities对象。</p><p id="80af" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在您可以使用这个<strong class="is hj">getdesiredpabilities()</strong>方法来创建您的appium驱动程序。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/becc996f6f5fb9ed96adc6f56773e727.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6cP4ljqzGy39X0w0a6QPIQ.png"/></div></div></figure><p id="d189" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">或者如果你读过我的<a class="ae kn" rel="noopener" href="/geekculture/how-to-start-appium-server-programmatically-in-java-2ae2265cde10">如何用Java </a>编程启动Appium服务器，你可以用这两个来实例化你的appium驱动。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/fb856ce2c9f9a180e50b93226b252c97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UbiAlS6o-62WKNcS7R06YQ.png"/></div></div></figure><p id="268d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是我们的能力阅读器类的完整代码。</p><pre class="jq jr js jt fd kt ku kv kw aw kx bi"><span id="4ae8" class="ky kz hi ku b fi la lb l lc ld">import com.fasterxml.jackson.databind.ObjectMapper;<br/>import org.json.simple.JSONArray;<br/>import org.json.simple.JSONObject;<br/>import org.json.simple.parser.JSONParser;<br/>import org.openqa.selenium.remote.DesiredCapabilities;<br/>import java.io.FileReader;<br/>import java.util.HashMap;<br/><br/>public class CapabilitiesReaderSimple {<br/><br/>    private static JSONArray parseJSON(String jsonLocation) throws Exception {<br/>        JSONParser jsonParser = new JSONParser();<br/>        return (JSONArray) jsonParser.parse(new FileReader(jsonLocation));<br/>    }<br/><br/>    private static JSONObject getCapability(String capabilityName, String jsonLocation) throws Exception {<br/>        JSONArray capabilitiesArray = <em class="jo">parseJSON</em>(jsonLocation);<br/>        for (Object jsonObj : capabilitiesArray) {<br/>            JSONObject capability = (JSONObject) jsonObj;<br/>            if (capability.get("name").toString().equalsIgnoreCase(capabilityName)) {<br/>                return (JSONObject) capability.get("caps");<br/>            }<br/>        }<br/>        return null;<br/>    }<br/><br/>    private static HashMap&lt;String, Object&gt; convertCapsToHashMap(String capabilityName, String jsonLocation) throws Exception {<br/>        ObjectMapper objectMapper = new ObjectMapper();<br/>        return objectMapper.readValue(<em class="jo">getCapability</em>(capabilityName, jsonLocation).toString(), HashMap.class);<br/>    }<br/><br/>    public static DesiredCapabilities getDesiredCapabilities(String capabilityName, String capsContentRootLocation) throws Exception {<br/>        String jsonLocation = System.<em class="jo">getProperty</em>("user.dir") + "/" + capsContentRootLocation;<br/>        HashMap&lt;String, Object&gt;  caps = <em class="jo">convertCapsToHashMap</em>(capabilityName, jsonLocation);<br/>        return new DesiredCapabilities(caps);<br/>    }<br/>}</span></pre><p id="70ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我喜欢这样做的原因是，对我来说，选择我的测试将在哪个设备上运行更容易，尤其是当我在进行并行测试执行时。</p><p id="8269" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以你有它。对于如何设置您想要的功能，您已经有了另一个想法。还是那句话，做事有很多种方式，你的方式可能更好。</p><p id="3581" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你是移动测试自动化的新手，想要探索appium，但是还没有设置好你的机器，查看这个<a class="ae kn" rel="noopener" href="/swlh/how-to-set-up-appium-for-test-automation-1d2a4fab1f6a">如何为测试自动化设置app ium</a>。</p><p id="7e42" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi">🍻 🍻 🍻</p></div></div>    
</body>
</html>