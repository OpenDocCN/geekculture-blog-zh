<html>
<head>
<title>Rotate IP Address and User-agent to Scrape Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">轮换IP地址和用户代理来收集数据</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/rotate-ip-address-and-user-agent-to-scrape-data-a010216c8d0c?source=collection_archive---------0-----------------------#2022-02-20">https://medium.com/geekculture/rotate-ip-address-and-user-agent-to-scrape-data-a010216c8d0c?source=collection_archive---------0-----------------------#2022-02-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="aa25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您运行网络爬虫时，如果它在短时间内从相同的IP和设备向目标站点发送了太多的请求，目标站点可能会出现reCAPTCHA，甚至阻塞您的IP地址以阻止您抓取数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/e0dfeadd63ffd2ef4de1b367a1470188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N3tvlzYzJAsGe7U5"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@jjying?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">JJ Ying</a> on <a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a27b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将向您展示在您的网络爬虫中应用的两种不同方法，以避免使用Python时出现此类问题。<br/> 1。轮换你的IP地址<br/> 2。轮换用户代理</p><h2 id="d1a7" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">旋转IP地址</h2><p id="0ea2" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">您可以为每个请求提供一个代理。如果你一直使用一个特定的IP地址，网站可能会检测到它并阻止它。要解决这个问题，您可以轮换您的IP，并为每个请求发送一个不同的IP地址。虽然这将使您的程序有点慢，但可以帮助您避免来自目标网站的阻塞。你可以使用tor浏览器，并据此设置tor代理。但是这里我们将使用一个叫做<strong class="ih hj"> torpy </strong>的python tor客户端，它不需要你在你的系统中下载tor浏览器。该库的GitHub链接如下:</p><div class="ku kv ez fb kw kx"><a href="https://github.com/torpyorg/torpy" rel="noopener  ugc nofollow" target="_blank"><div class="ky ab dw"><div class="kz ab la cl cj lb"><h2 class="bd hj fi z dy lc ea eb ld ed ef hh bi translated">GitHub - torpyorg/torpy:纯python Tor客户端实现</h2><div class="le l"><h3 class="bd b fi z dy lc ea eb ld ed ef dx translated">Tor协议的纯python Tor客户端实现。Torpy可以用来与clearnet主机或…</h3></div><div class="lf l"><p class="bd b fp z dy lc ea eb ld ed ef dx translated">github.com</p></div></div><div class="lg l"><div class="lh l li lj lk lg ll jn kx"/></div></div></a></div><p id="b8d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用以下命令安装该库:</p><pre class="je jf jg jh fd lm ln lo lp aw lq bi"><span id="eb3a" class="ju jv hi ln b fi lr ls l lt lu">pip install torpy</span></pre><p id="838d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设我们想向以下站点发送请求:</p><pre class="je jf jg jh fd lm ln lo lp aw lq bi"><span id="587d" class="ju jv hi ln b fi lr ls l lt lu">urls = [ "https://www.google.com", "https://www.facebook.com", "https://www.youtube.com", "https://www.amazon.com", "https://www.reddit.com", "https://www.instagram.com", "https://www.linkedin.com", "https://www.wikipedia.org", "https://www.twitter.com"]</span></pre><p id="8154" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，我们要写一个函数，用每个URL请求启动一个新的会话。然后遍历所有的URL，并用一个新的会话传递每个URL。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lv lw l"/></div><figcaption class="jp jq et er es jr js bd b be z dx">code snippet 1</figcaption></figure><p id="eec1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以从这个站点【https://httpbin.org/ip<br/>检查我们的IP地址，因此，在第11行，我们打印会话的IP地址。如果我们执行上面的程序，我们将获得每个请求的IP地址。在我的例子中，输出如下所示:</p><pre class="je jf jg jh fd lm ln lo lp aw lq bi"><span id="6a69" class="ju jv hi ln b fi lr ls l lt lu">{'origin': '107.189.7.175'}<br/>{'origin': '185.220.101.162'}<br/>{'origin': '185.220.101.79'}<br/>{'origin': '103.236.201.88'}<br/>{'origin': '185.220.100.242'}<br/>{'origin': '209.141.53.20'}<br/>{'origin': '198.98.62.79'}<br/>{'origin': '184.105.220.24'}<br/>{'origin': '193.218.118.167'}</span></pre><p id="01e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如你所看到的，每个请求的IP地址是不同的。</p><h2 id="8def" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">轮换用户代理</h2><p id="93ee" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">如果没有有效的浏览器信息，大多数网站会阻止请求。因此，我们通常在每个请求中以用户代理的形式传递bowser信息，如下所示:</p><pre class="je jf jg jh fd lm ln lo lp aw lq bi"><span id="ea45" class="ju jv hi ln b fi lr ls l lt lu">import requests</span><span id="dcba" class="ju jv hi ln b fi lx ls l lt lu">USER_AGENT = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_2) AppleWebKit/600.4.10 (KHTML, like Gecko) Version/8.0.4 Safari/600.4.10"</span><span id="99bd" class="ju jv hi ln b fi lx ls l lt lu">HEADERS = {"User-Agent": USER_AGENT}</span><span id="a198" class="ju jv hi ln b fi lx ls l lt lu">html_content = requests.get(url, headers=HEADERS, timeout=40).text</span></pre><p id="5e81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用户代理通常包含应用程序类型、操作系统信息、软件版本等信息。</p><p id="8e67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您保持用户代理信息不变时，就像上面的代码片段一样，目标站点可以检测到所有的请求(您的程序正在发送的请求)都来自同一个设备。我们可以通过为每个请求发送一个有效的用户代理和不同的代理来伪造该信息。你可以从这个<a class="ae jt" href="https://developers.whatismybrowser.com/useragents/explore/" rel="noopener ugc nofollow" target="_blank">网站</a>找到很多有效的用户代理信息。</p><p id="de7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其思想是制作一个有效用户代理的列表，然后针对每个请求随机选择一个用户代理。因此，让我们列出有效的用户代理:</p><pre class="je jf jg jh fd lm ln lo lp aw lq bi"><span id="8a17" class="ju jv hi ln b fi lr ls l lt lu">import random</span><span id="16dd" class="ju jv hi ln b fi lx ls l lt lu">AGENT_LIST = [</span><span id="5847" class="ju jv hi ln b fi lx ls l lt lu">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/44.0.2403.157 Safari/537.36",</span><span id="03c9" class="ju jv hi ln b fi lx ls l lt lu">"Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:24.0) Gecko/20100101 Firefox/24.0",</span><span id="b46c" class="ju jv hi ln b fi lx ls l lt lu">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/91.0.4472.114 Safari/537.36",</span><span id="b163" class="ju jv hi ln b fi lx ls l lt lu">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Safari/605.1.15",</span><span id="e762" class="ju jv hi ln b fi lx ls l lt lu">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:77.0) Gecko/20100101 Firefox/77.0"<br/>]</span><span id="2b25" class="ju jv hi ln b fi lx ls l lt lu">USER_AGENT = random.choice(AGENT_LIST)</span></pre><p id="942b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们在代码片段1中随机化我们的用户代理，其中我们旋转了IP地址。因此，下面的程序会根据每个请求更改您的IP地址和用户代理。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lv lw l"/></div></figure><p id="b833" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一个简单的尝试方法是在每个请求前添加<code class="du ly lz ma ln b">time.sleep()</code>以避免reCAPTCHA问题，如下所示:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lv lw l"/></div></figure><p id="7838" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，在第7行，我们添加了一个<code class="du ly lz ma ln b">time.sleep()</code>方法，它选择1到3之间的一个随机数。</p><p id="497b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">记住，以上所有方法都会让你的网页抓取比平时慢。但是这些有助于避免被目标站点阻止，并绕过reCAPTCHA问题。</p></div><div class="ab cl mb mc gp md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="hb hc hd he hf"><p id="c726" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作者:萨德曼·卡比尔·苏米克</p><div class="ku kv ez fb kw kx"><a href="https://www.linkedin.com/in/sksoumik/" rel="noopener  ugc nofollow" target="_blank"><div class="ky ab dw"><div class="kz ab la cl cj lb"><h2 class="bd hj fi z dy lc ea eb ld ed ef hh bi translated">Sadman Kabir Soumik -人工智能工程师- Venturas Ltd | LinkedIn</h2><div class="le l"><h3 class="bd b fi z dy lc ea eb ld ed ef dx translated">查看Sadman Kabir Soumik在全球最大的职业社区LinkedIn上的个人资料。萨德曼·卡比尔有两份工作…</h3></div><div class="lf l"><p class="bd b fp z dy lc ea eb ld ed ef dx translated">www.linkedin.com</p></div></div><div class="lg l"><div class="mi l li lj lk lg ll jn kx"/></div></div></a></div></div></div>    
</body>
</html>