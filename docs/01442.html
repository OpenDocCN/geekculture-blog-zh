<html>
<head>
<title>How I Made My First Snap</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是如何拍摄第一张快照的</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-i-made-my-first-snap-470d22eb621a?source=collection_archive---------7-----------------------#2021-04-10">https://medium.com/geekculture/how-i-made-my-first-snap-470d22eb621a?source=collection_archive---------7-----------------------#2021-04-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="27c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">快照是一种打包软件的方式，因此很容易在Linux上安装。我想，作为Canonical倡导团队的新成员，我最好开始拍照。我通过使用<a class="ae jd" href="https://snapcraft.io/docs" rel="noopener ugc nofollow" target="_blank"> snapcraft文档</a>，以及艾伦·波普(popey) 的几篇<a class="ae jd" href="https://popey.com/blog/2020/12/snap-along-with-me/" rel="noopener ugc nofollow" target="_blank">博客</a> <a class="ae jd" href="https://popey.com/blog/2021/02/lets-go-snapping/" rel="noopener ugc nofollow" target="_blank">帖子</a>学会了如何做到这一点。如果你通读了标题为<a class="ae jd" href="https://popey.com/blog/2021/02/lets-go-snapping/" rel="noopener ugc nofollow" target="_blank">“我们去抢购”</a>的那篇，我就是他提到的新同事。这些都是学习如何创建快照的更简洁的方法。这篇文章就是我的全部故事，包括我做了什么，怎么做的，为什么做。希望这能引起一些人的兴趣，尤其是第一次。我推荐的其他资源是一个<a class="ae jd" href="https://snapcraft.io/blog/building-a-rust-snap-by-example" rel="noopener ugc nofollow" target="_blank"> Rust应用示例</a>和一个<a class="ae jd" href="https://snapcraft.io/blog/building-a-c-snap-by-example" rel="noopener ugc nofollow" target="_blank">更高级的C示例</a> …</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/257724fa851d4fe800006d127bd38315.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MwewhQVyIenFiqjEixAGEg.png"/></div></div></figure><h1 id="46a9" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">何必呢？</h1><p id="68f7" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">在我进入“如何”之前，我想讨论一下为什么。我个人这样做有两个原因。首先，因为我想学习如何去做。我是一个新的Ubuntu拥护者，需要对快照的工作原理和如何快照有更深的理解。在业余时间，作为工作的一部分，我喜欢学习一系列新技能，这似乎是一个不错的起点。其次因为有人告诉我。出于同样的原因。</p><p id="6ad2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们简单地谈谈为什么你可能想把你的应用程序打包成一个快照。如果你不关心<em class="kt">为什么</em>，那就直接跳过。Linux发行版的变化几乎和应用程序开发的速度一样快。无论你运行的是最新的Fedora版本还是多年前的Ubuntu版本，你都应该能够将你最喜欢的应用程序放在手边，并且应该能够在发布日试用最新最棒的软件。同样，你的用户对Linux发行版的选择不应该成为你想让多少人拥有你的软件的障碍。软件打包和分发可能是复杂和令人厌倦的。</p><p id="cf03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是快照地址的最大问题。快照可以很容易地安装在任何使用systemd的Linux发行版上——大多数都是这样——开发者可以将打包快照与他们自己的CI/CD管道集成在一起。您可以将<a class="ae jd" href="https://snapcraft.io/docs/supported-extensions" rel="noopener ugc nofollow" target="_blank"> snapcraft扩展</a>用于特定种类的中间件，并且知道snaps 支持编写您的应用程序的大多数语言<a class="ae jd" href="https://snapcraft.io/docs/supported-plugins" rel="noopener ugc nofollow" target="_blank">。一旦一个应用程序被“捕获”,它就可以在几分钟之内在几乎所有的Linux发行版上使用，并有一种内置的方式来保持它们的最新、维护和向用户推广。</a></p><p id="21cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">无论您是想拍摄自己的应用程序，还是想为现有的应用程序生态系统做出贡献，在某些情况下，拍摄应用程序都是值得的…</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ku"><img src="../Images/ae5e9d94cffdf159967b7a8f1545f6f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kewz0xLvwocuc8INzphzmA.jpeg"/></div></div><figcaption class="kv kw et er es kx ky bd b be z dx">Photo by <a class="ae jd" href="https://unsplash.com/@emilymorter?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Emily Morter</a> on <a class="ae jd" href="https://unsplash.com/s/photos/why?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="42df" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">从哪里开始？</h1><p id="5820" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">我在软件开发方面的经验非常有限，所以我没有从抓取自己的应用程序开始。相反，我去找了一个我喜欢的、还没有被抓拍的应用程序，并抓拍了它。我开始在<a class="ae jd" href="https://github.com/trending" rel="noopener ugc nofollow" target="_blank"> GitHub趋势</a>上搜索。这是一个很好的应用程序和项目列表，显然是活跃的，所以可能需要贡献，但你真的可以选择任何东西。当然，如果应用程序是你自己的，或者你是一个狂热的用户，这确实有帮助，这样你可能会付出更多。</p><h2 id="7fd2" class="kz jr hi bd js la lb lc jw ld le lf ka iq lg lh ke iu li lj ki iy lk ll km lm bi translated">什么是有意义的快照？</h2><p id="2113" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">关于snaps最常见的误解之一是Canonical试图取代其他打包软件的方式，即使体验更差。这根本不是真的。在很多情况下，将软件打包毫无意义。Snaps不是debs的替代品，也不是docker containers的竞争对手，尽管使用了集装箱技术。它们被设计用来解决在别处无法解决的不同问题。这些<a class="ae jd" href="https://snapcraft.io/blog/8-ways-snaps-are-different" rel="noopener ugc nofollow" target="_blank">解决方案和差异</a>、<a class="ae jd" href="https://snapcraft.io/blog/a-technical-comparison-between-snaps-and-debs" rel="noopener ugc nofollow" target="_blank">在其他地方</a>有记录，但这里有一些避免抓拍不需要抓拍的东西的提示:</p><p id="63bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.查看Ubuntu档案库——如果一个Linux应用程序相对来说不太出名或者不太受欢迎，但是你对它感兴趣，你应该拍一张快照。如果它已经作为一个deb存在于Ubuntu的档案中，并且有很多用户并且很开心，就没有必要去抓拍它。</p><blockquote class="ln lo lp"><p id="2699" class="if ig kt ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">补充说明:如果你使用的是Ubuntu，你可以在没有安装的情况下，通过在CLI中运行它来检查这个应用是否已经在存档中。如果它在存档中，系统会提示您将其安装为apt包。</p></blockquote><p id="7fc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.库(libs)不容易抓取。快照是打包应用程序的一种方式，除非有特殊情况，否则不应该用来打包库。</p><p id="8d24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.现代语言——我的第一个快照是用Rust编写的应用程序。还有许多其他用其他语言编写的<a class="ae jd" href="https://snapcraft.io/docs/creating-a-snap" rel="noopener ugc nofollow" target="_blank">应用程序快照的例子</a>。现代语言没有同样的包装包袱或先入之见，因为开发人员不太关心包装。这意味着，如果你用现代语言拍摄一个应用程序，你更有可能在另一端得到一个有鉴赏力的开发者。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lt"><img src="../Images/dc3ee7ee7f5f2f5ee55223f3c16c71a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iOAS9JplKg74raAg2tI9Kg.png"/></div></div></figure><p id="c305" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，当我开始寻找的时候，我花了一段时间才找到我喜欢的东西。考虑到我缺乏经验，我理解。还不到三分钟。<a class="ae jd" href="https://snapcraft.io/docs/snapcraft-checklist" rel="noopener ugc nofollow" target="_blank">符合标准</a>。所以我转而搜索流行的Linux命令行工具。(我寻找命令行工具，因为他们说它们比GUI应用程序更容易抓取。)逛了一圈之后，我找到了“谷歌”，一个可以让你从命令行搜索谷歌的工具。我在<a class="ae jd" href="https://github.com/jarun/googler" rel="noopener ugc nofollow" target="_blank">上游GitHub repo </a>中找到了deb和rpm包，但是没有snap。一个好的开始。</p><p id="5269" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我陷进去之前，作为最后一次检查，我搜索了“谷歌快照”(有点像meta huh)，看看上游是否有任何反对快照的东西。他们没有。但是我确实发现已经是弹指一挥间了-_-只是没有逆流而上。所以我把这个项目添加到了一个文档中，提醒我也许值得联系他们，告诉他们将来的快照，然后我继续寻找。</p><p id="6ff9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于一些不同的应用程序，这种情况发生了几次。要么快照已经存在，要么在一些情况下，上游对快照不太友好，所以我没有打扰。快照在这一点上已经相当成熟了，所以有很多东西已经被快照了也就不足为奇了。或者他们有自己的诽谤者。但这也不是阻止开发者从快照中获益的好理由。最终，我找到了<a class="ae jd" href="https://github.com/atanunq/viu" rel="noopener ugc nofollow" target="_blank"> viu。一个图像和GIF查看应用</a>。喔。</p><h2 id="c31f" class="kz jr hi bd js la lb lc jw ld le lf ka iq lg lh ke iu li lj ki iy lk ll km lm bi translated">能建成吗？</h2><p id="b867" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">在我太兴奋之前，我做了一些快速检查，看看它是否真的可以很容易地建造。假设你已经满足了我们之前谈到的所有标准，你几乎可以肯定地说这是轻而易举的事情。但鉴于我的理解水平，我快速浏览了一下snapcraft文档，以确保我没有陷入一个极其复杂的问题。这些文件充满了其他术语和更深入的技术“东西”，但很容易看出，与viu回购并列，这些复杂的东西与我无关。</p><h1 id="d7df" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">入门指南</h1><p id="f263" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">首先，我在GitHub存储库中为我想要捕捉的应用程序准备了一切。然后，我将这个存储库克隆到我的计算机上，并创建了一个分支。这是标准的GitHub工作流程，但是如果你以前没有做过，不用担心，<a class="ae jd" href="https://docs.github.com/en/github/getting-started-with-github/fork-a-repo" rel="noopener ugc nofollow" target="_blank"> GitHub也有很棒的文档</a>。我这样做是为了在本地制作应用程序的快照，进行测试和整理，然后，当准备就绪时，我可以向上游项目提交一个pull请求。当然，如果你正在抓取你自己的应用程序，你可以做任何你想做的事情。</p><h2 id="8642" class="kz jr hi bd js la lb lc jw ld le lf ka iq lg lh ke iu li lj ki iy lk ll km lm bi translated">Snapcraft YAML</h2><p id="b74f" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">克隆和分支之后，我打开了一个终端，将<a class="ae jd" href="https://snapcraft.io/code" rel="noopener ugc nofollow" target="_blank"> VSCode (visual studio code)与</a>和<code class="du lu lv lw lx b">cd</code>嵌入到新的本地版本的repo中，以创建一个新的目录:</p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="d2d2" class="kz jr hi lx b fi mc md l me mf">$ mkdir viu-snap</span></pre><p id="f67d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">他们说，好的做法是将目录命名为“应用程序名称快照”，这样很容易找到，当您最终创建了一堆又一堆的快照时，(我知道您会)您会习惯这种语法。</p><p id="bf36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我进入文件夹并运行snapcraft init，在snap/snapcraft.yaml中创建一个模板:</p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="2749" class="kz jr hi lx b fi mc md l me mf">$ cd viu-snap</span><span id="e2bd" class="kz jr hi lx b fi mg md l me mf">$ snapcraft init</span></pre><p id="add3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您进入新的snapcraft.yaml文件，您会看到它看起来像这样:</p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="a7af" class="kz jr hi lx b fi mc md l me mf">name: my-snap-name # you probably want to ‘snapcraft register &lt;name&gt;’<br/>base: core18 # the base snap is the execution environment for this snap<br/>version: ‘0.1’ # just for humans, typically ‘1.2+git’ or ‘1.3.2’<br/>summary: Single-line elevator pitch for your amazing snap # 79 char long summary<br/>description: |<br/> This is my-snap’s description. You have a paragraph or two to tell the<br/> most important story about your snap. Keep it under 100 words though,<br/> we live in tweetspace and your description wants to look good in the snap<br/> store.</span><span id="21e0" class="kz jr hi lx b fi mg md l me mf">grade: devel # must be ‘stable’ to release into candidate/stable channels<br/>confinement: devmode # use ‘strict’ once you have the right plugs and slots</span><span id="0834" class="kz jr hi lx b fi mg md l me mf">parts:<br/> my-part:<br/> # See ‘snapcraft plugins’<br/> plugin: nil</span></pre><p id="7028" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些都是模板，你可以把它们编辑成快照。如果你在寻找比我在这里给出的更多的细节，在snapcraft文档和各种博客文章中有更多关于文件不同部分的信息。让我们从元数据(顶部的东西)开始。</p><h2 id="2e59" class="kz jr hi bd js la lb lc jw ld le lf ka iq lg lh ke iu li lj ki iy lk ll km lm bi translated">[计]元数据</h2><p id="5436" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">如果您正在捕捉一个不属于您的应用程序，最好用您找到该应用程序的地方的数据替换元数据，在我的例子中，是上游git repo。<code class="du lu lv lw lx b">name</code>是您的快照的发布名称，因此如果应用程序是您的，最好确保它是描述性的，如果不是，请更正。通常情况下，您希望它超过三个字符。我遇到了<code class="du lu lv lw lx b">viu</code>的问题，你稍后会看到。</p><h2 id="8580" class="kz jr hi bd js la lb lc jw ld le lf ka iq lg lh ke iu li lj ki iy lk ll km lm bi translated">选择一个基地</h2><p id="dc8a" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">默认的<code class="du lu lv lw lx b">base</code>是<code class="du lu lv lw lx b">core18.</code>，这意味着当我们构建快照时，它是在Ubuntu 18.04 LTS虚拟机内完成的。当用户安装snap时，他们需要自动为他们安装的<code class="du lu lv lw lx b">core18</code> snap。对于<code class="du lu lv lw lx b">viu</code>,我使用了<code class="du lu lv lw lx b">core20</code>的基础，所以它是在Ubuntu 20.04 LTS虚拟机中构建的。我没有考虑太多。如果它引起问题，你可以随时改变到另一个基地。</p><p id="a0d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我添加了<code class="du lu lv lw lx b">adopt-info</code>来指定版本应该来自于<code class="du lu lv lw lx b">viu</code>部分(我们一会儿会谈到部分)，所以我用<code class="du lu lv lw lx b">adopt-info</code>替换了<code class="du lu lv lw lx b">version</code>。摘要和描述都是从上游git repo复制的。此时我的YAML是这样的:</p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="88d7" class="kz jr hi lx b fi mc md l me mf">name: viu # you probably want to ‘snapcraft register &lt;name&gt;’<br/>base: core20 # the base snap is the execution environment for this snap<br/>adopt-info: viu<br/>summary: Simple terminal image viewer # 79 char long summary<br/>description: |<br/> A small command-line application to view images from the terminal written<br/> in Rust. It is basically the front-end of viuer. It uses either iTerm or<br/> Kitty graphics protocol, if supported. If not, lower half blocks (▄ or<br/> \u2584) are displayed instead.</span></pre><h2 id="8767" class="kz jr hi bd js la lb lc jw ld le lf ka iq lg lh ke iu li lj ki iy lk ll km lm bi translated">禁闭和建筑</h2><p id="737b" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">YAML中的下一行是<code class="du lu lv lw lx b">grade</code>，这不会影响快照本身的稳定性，也不会在发布后产生太多影响，所以你可以向自己和用户发出信号，无论你的快照在什么渠道，它是否稳定。我只是把它设置为稳定并继续运行。</p><p id="0abb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望严格限制这一点，所以我在snapcraft.yaml中设置了next。当后来出现问题时，我出于调试目的更改了这一点，但结果证明限制不是问题所在。这里有两个选项，一个是<code class="du lu lv lw lx b">strict</code>限制，您可以指定<code class="du lu lv lw lx b">plugs</code>，另一个是经典限制，被快照的应用程序的行为与主机上的任何其他应用程序几乎一样。</p><p id="4125" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们可以添加我们想要构建的体系结构，这是我在描述之后添加的新部分:</p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="27ab" class="kz jr hi lx b fi mc md l me mf">grade: stable # must be ‘stable’ to release into candidate/stable channels<br/>confinement: strict # use ‘strict’ once you have the right plugs and slots<br/> <br/>architectures:<br/> — build-on: amd64<br/> — build-on: arm64<br/> — build-on: armhf<br/> — build-on: ppc64el</span></pre><h2 id="cb89" class="kz jr hi bd js la lb lc jw ld le lf ka iq lg lh ke iu li lj ki iy lk ll km lm bi translated">零件</h2><p id="070c" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">他们说快照的T3是最重要的部分。这是我们定义如何构建我们放入snap中的软件的地方。<code class="du lu lv lw lx b">viu</code>是一个Rust应用程序，是snapcraft中的一个<a class="ae jd" href="https://snapcraft.io/about/publish" rel="noopener ugc nofollow" target="_blank">支持的语言，</a>所以我指定了那个<a class="ae jd" href="https://snapcraft.io/docs/snapcraft-plugins" rel="noopener ugc nofollow" target="_blank">插件</a>。</p><p id="6ebc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我需要告诉snapcraft源代码的位置，也就是我之前分叉的原始GitHub repo。我认为最好指定一个而不是你的本地版本，即使是为了测试，以防你在本地版本中搞砸了什么。最后，我需要列出构建应用程序所需的库和依赖项。</p><p id="6510" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lu lv lw lx b">viu</code>只有一部分，即<code class="du lu lv lw lx b">viu</code>项目本身，但是我仍然需要指定一个版本。当快照构建时，它们需要一个版本号来应用于文件，因此名称变成:snapname_version_arch.snap。这是留给我的:</p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="e7ad" class="kz jr hi lx b fi mc md l me mf">parts:<br/> viu:<br/> plugin: rust<br/> source: <a class="ae jd" href="https://github.com/atanunq/viu.git" rel="noopener ugc nofollow" target="_blank">https://github.com/atanunq/viu.git</a><br/> override-pull: |<br/> snapcraftctl pull<br/> snapcraftctl set-version “$(git describe — tags)”</span></pre><p id="1f3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里的脚本使用<code class="du lu lv lw lx b">snapcraftctl pull</code>来告诉snapcraft从源中提取，然后我使用<code class="du lu lv lw lx b">snapcraftctl set-version</code>来回调前面的<code class="du lu lv lw lx b">adopt-info</code>，并将其设置为<code class="du lu lv lw lx b">"$(git describe — tags)”</code>，这将采用源中指定的版本。我也通读了几遍才明白这一点。我本可以在元数据中添加一个“<code class="du lu lv lw lx b">versions:something</code>”行，但是这样看起来更好。</p><p id="5b63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不受限制的快照或受<code class="du lu lv lw lx b">classic</code>限制的快照只会在我的主机系统上搜索这些依赖项，或者从互联网上下载它们。因为我将我的快照定义为严格受限的，所以它不能这样做，所以我需要列出它需要的所有包，以便snapcraft知道具体要捆绑到快照中的内容。</p><p id="2a3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在YAML，我们将它们指定为<code class="du lu lv lw lx b">build-paclages:</code>和<code class="du lu lv lw lx b">stage-packages:</code>。这是整个过程中最困难的部分。我不得不进入项目回购，四处看看是否有什么特别的事情发生，并找到他们使用的软件包。有些开发人员在他们的README.md文件中列出了所有这些内容，有些则没有。<code class="du lu lv lw lx b">viu</code>没有。</p><h2 id="a139" class="kz jr hi bd js la lb lc jw ld le lf ka iq lg lh ke iu li lj ki iy lk ll km lm bi translated">挖掘包裹</h2><p id="520b" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">当我在网上搜寻我需要的软件包时，我寻求了很多帮助。有人告诉我，在开发应用程序时，开发人员会对文件系统中的依赖项、包和路径做出很多选择。除非您自己开发了应用程序，否则您显然不会参与这些决策。所以我不得不决定花时间更深入地理解这个应用程序，或者只是解决这个难题。假设README.md中没有列出所有内容，下面是我积累的找到正确软件包的技巧:</p><ul class=""><li id="2687" class="mh mi hi ih b ii ij im in iq mj iu mk iy ml jc mm mn mo mp bi translated">检查它是否是一个deb —如果应用程序在归档中，并且出于我们之前讨论的原因之一，您希望制作一个快照，那么您就有了一个良好的开端。调查deb，看看它拉进了什么包，调查它们是否在Ubuntu中(它们可能有不同的名字)。</li><li id="30c2" class="mh mi hi ih b ii mq im mr iq ms iu mt iy mu jc mm mn mo mp bi translated">检查AUR(Arch User Repository)——如果您想要快照的应用程序在Arch Linux中，那么您可能已经有了您需要的所有信息。在谷歌中搜索<code class="du lu lv lw lx b">arch &lt;app name&gt;</code>,如果它在arch中，它将在搜索的顶部，进入那里，转到RHS上的源文件，单击PKGBUILD(如果有的话),你将能够推断出依赖项和要作为stage包包含的内容。</li><li id="fb87" class="mh mi hi ih b ii mq im mr iq ms iu mt iy mu jc mm mn mo mp bi translated">检查travis.yml —如果应用程序的CI流程使用travis，则它有一个travis.yml文件，该文件是一个YAML文件，包含使用的编程语言、构建和测试环境以及构建所需的包/依赖项。</li></ul><p id="1079" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些文件包含的内容可能多于或少于您需要的内容，但这是一个很好的起点。在<code class="du lu lv lw lx b">viu</code>的例子中，我使用了<code class="du lu lv lw lx b">travis.yml</code>文件，它指定了我需要的所有构建包。</p><p id="63ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于舞台包，我再次戳在回购。Imagemagick列在安装说明中，所以我把它放了进去。然后我检查了AUR，它显示了<code class="du lu lv lw lx b">imagemagick</code>和另一个依赖项<code class="du lu lv lw lx b">libxslt</code>，所以我也把它放在了<code class="du lu lv lw lx b">stage-packages</code>中。</p><blockquote class="ln lo lp"><p id="3f10" class="if ig kt ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">注意:我不知道每个构建或阶段包实际上做了什么，我可以猜测，但是除非我遇到了我不需要知道的问题。我希望当我做更多这些的时候，我会拿起它。我要说的是，如果你不知道软件包的所有细微差别，不要担心。当然，如果你正在抓拍你自己的应用程序，你可能已经知道，你做得很好。</p></blockquote><p id="0abe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们只剩下这个了。呜:</p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="605b" class="kz jr hi lx b fi mc md l me mf"><br/>parts:<br/> viu:<br/> plugin: rust<br/> source: <a class="ae jd" href="https://github.com/atanunq/viu.git" rel="noopener ugc nofollow" target="_blank">https://github.com/atanunq/viu.git</a><br/> override-pull: |<br/> snapcraftctl pull<br/> snapcraftctl set-version “$(git describe — tags)”<br/> build-packages:<br/> — build-essential<br/> — libcanberra-dev<br/> stage-packages:<br/> — imagemagick<br/> — libxslt<br/></span></pre><p id="d27b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一点上，这可能是不正确的，我可能选择了错误的包或错过了一些，但我会在下一步中找到答案。如果我们错过了什么，那么搜索继续，但如果我有<em class="kt">一些</em>的东西纠正，它会更容易找到什么丢失了。</p><h2 id="1b2e" class="kz jr hi bd js la lb lc jw ld le lf ka iq lg lh ke iu li lj ki iy lk ll km lm bi translated">应用和界面</h2><p id="068a" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">此时，快照已经具备了完成构建所需的一切，因此您可以尝试这样做，但可能行不通。我将snapcraft指向了二进制文件和正确的包，但是因为我将它制作成了一个严格受限的(<code class="du lu lv lw lx b">strict</code>)快照，所以它无法访问外部世界。这样就没有人能进入并干扰应用程序。我允许快照通过一个<code class="du lu lv lw lx b">apps</code>节与外界对话，在这里我们向主机公开快照的特定“部分”。</p><p id="470c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我指定了应用程序，然后指定了二进制文件在应用程序中的位置，并给了它工作所需的所有接口。YAML中的接口称为插头，它们被设计为“插入”到您的snap中，以安全地与外界交互。当然，更多信息可以在snapcraft文档中找到<a class="ae jd" href="https://snapcraft.io/docs/supported-interfaces" rel="noopener ugc nofollow" target="_blank">。一旦我这样做了几次，我会想象有几个比其他人用得更多，我就能够在不需要文档的情况下很好地猜测应用程序需要什么。最后，我们只剩下这个:</a></p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="fba5" class="kz jr hi lx b fi mc md l me mf"><br/>name: viu # you probably want to ‘snapcraft register &lt;name&gt;’<br/>base: core20 # the base snap is the execution environment for this snap<br/>adopt-info: viu<br/>summary: Simple terminal image viewer # 79 char long summary<br/>description: |<br/> A small command-line application to view images from the terminal written<br/> in Rust. It is basically the front-end of viuer. It uses either iTerm or<br/> Kitty graphics protocol, if supported. If not, lower half blocks (▄ or<br/> \u2584) are displayed instead.<br/> <br/>grade: stable # must be ‘stable’ to release into candidate/stable channels<br/>confinement: strict # use ‘strict’ once you have the right plugs and slots<br/> <br/>architectures:<br/> — build-on: amd64<br/> — build-on: arm64<br/> — build-on: armhf<br/> — build-on: ppc64el<br/> <br/>apps:<br/> viu:<br/> command: bin/viu<br/> plugs:<br/> — network<br/> — home<br/> — removable-media<br/> — alsa<br/> — pulseaudio<br/> <br/>parts:<br/> viu:<br/> plugin: rust<br/> source: <a class="ae jd" href="https://github.com/atanunq/viu.git" rel="noopener ugc nofollow" target="_blank">https://github.com/atanunq/viu.git</a><br/> override-pull: |<br/> snapcraftctl pull<br/> snapcraftctl set-version “$(git describe — tags)”<br/> build-packages:<br/> — build-essential<br/> — libcanberra-dev<br/> stage-packages:<br/> — imagemagick<br/> — — libxslt</span></pre><p id="6538" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">多有趣啊。现在，不要太兴奋，有点兴奋，但不要太多，如果你到了这一步，你可能会或可能不会完成。但你可能会。这可能行得通，剩下的就容易了。深呼吸。</p><h1 id="7ac5" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">构建和测试</h1><p id="e47c" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">要进行构建和测试，请确保您在正确的目录中—“/application-name-snap”，否则事情无法正常工作，您会感到困惑，并且在意识到自己的错误之前不得不向忙碌的人询问愚蠢的问题。到达后，运行:</p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="5543" class="kz jr hi lx b fi mc md l me mf">snapcraft — debug — shell-after</span></pre><ul class=""><li id="6787" class="mh mi hi ih b ii ij im in iq mj iu mk iy ml jc mm mn mo mp bi translated"><code class="du lu lv lw lx b">— debug</code>意味着如果构建失败,<code class="du lu lv lw lx b">snapcraft</code>将把我留在正在构建的虚拟机的外壳中。这样，如果它失败了，我可以四处打探，做一些调试。这也意味着，如果我想尝试重新构建快照，我可以再次运行<code class="du lu lv lw lx b">snapcraft</code>，而无需额外的选项来节省(大量)时间，因为它不需要重新启动和关闭。<br/>注意:您正在处理的文件夹被映射到Multipass VM，因此，如果您发现问题，可以继续在VM外部编辑YAML，然后重新运行<code class="du lu lv lw lx b">snapcraft</code>以获取任何保存的更改。</li><li id="8e3d" class="mh mi hi ih b ii mq im mr iq ms iu mt iy mu jc mm mn mo mp bi translated"><code class="du lu lv lw lx b">— shell-after</code>做同样的事情，除了它在完成构建后把我留在壳里，如果它成功的话，以防我想四处闲逛。</li></ul><p id="cff7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，Snapcraft使用Multipass来启动要在其中构建快照的虚拟机。还有其他选项，比如还支持<code class="du lu lv lw lx b">LXD</code>。到目前为止，我只使用了Multipass，因为它已经存在并且很容易，但是如果您对这些东西更熟悉或者想尝试其他东西，就可以了。值得注意的是，使用Multipass，虚拟机在关闭前会停留一段时间，但它不会死亡，这引起了我的困惑。可以运行<code class="du lu lv lw lx b">multipass list</code>来检查。LXD没有同样的问题，因为它上下旋转得更快。只有当你清理snapcraft时，它才会被扔掉。</p><p id="3554" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果构建成功，snapcraft会输出类似这样的内容，但更多的是废话:</p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="9673" class="kz jr hi lx b fi mc md l me mf">Launching a VM.<br/>Launched: snapcraft-viu-image-viewer<br/>… <br/>Preparing to …<br/>Unpacking … <br/>Setting up … <br/>Reading package lists… Done<br/>Building dependency tree <br/>Suggested packages:<br/>Recommended packages:<br/>The following NEW packages will be installed:<br/>Pulling viu<br/>Building viu<br/>Rust is installed now. Great!<br/>Staging viu <br/>+ snapcraftctl stage<br/>Priming viu <br/>+ snapcraftctl prime<br/>Snapping | <br/>Snapped viu-image-viewer_v1.3.0–12-g4160c8b_amd64.snap<br/>snapcraft-viu-image-viewer #</span></pre><p id="1bf6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以看到我仍然在shell中，因为我不想做任何乱翻，所以我运行CTRL+D并退出。因为如果我再次运行<code class="du lu lv lw lx b">snapcraft--debug — shell-after</code>，虚拟机不会马上消失，运行时间也不会太长。</p><p id="e909" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您尝试这样做而不成功，这意味着有问题。咄。希望您得到一条有用的错误消息，或者在YAML文件中有一个明显的错误。如果问题不明显，在本文末尾将你的YAML语法与我的语法进行比较，然后打开那份<a class="ae jd" href="http://snapcraft.io/docs" rel="noopener ugc nofollow" target="_blank">好的旧文档</a>。如果你仍然找不到答案，不要惊慌，snapcraft论坛总是充满了可以提供帮助的人们。</p><h1 id="6514" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">安装和测试</h1><p id="82fe" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">构建成功完成后，我们会在工作目录中看到一个如下所示的文件:</p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="85be" class="kz jr hi lx b fi mc md l me mf">viu_v1.3.10-gOdba818_amd64.snap</span></pre><p id="0dee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是快照，准备就绪，迫不及待地要走。为了测试它，我首先需要在本地安装它:</p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="436b" class="kz jr hi lx b fi mc md l me mf">snap install viu_v1.3.10-gOdba818_amd64.snap — dangerous</span></pre><ul class=""><li id="884d" class="mh mi hi ih b ii ij im in iq mj iu mk iy ml jc mm mn mo mp bi translated"><code class="du lu lv lw lx b">— dangerous</code>表明此snap尚未通过典型的Snap Store审查，但我同意安装它，因为它是我构建的。</li></ul><p id="06b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个命令可以从任何地方运行。如果出于某种原因，我没有严格限制我的快照，也许我正在调试或者它不适合严格限制，我可以添加<code class="du lu lv lw lx b">— classic</code>标志。这表明我正在安装的是一个不受限制的应用程序，它可以自由支配系统上的其他任何东西。(通过运行<code class="du lu lv lw lx b">snap install — help</code>，您可以找到许多其他标志)。</p><p id="49fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦安装，我可以测试它。对于<code class="du lu lv lw lx b">viu</code>，有一个警告。我需要安装Kitty或ITerm模拟器才能正常工作。但这里有一个它在Kitty终端中工作的例子:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mv"><img src="../Images/bdef2265188d4ae9730a45bbd11cc886.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tLhJPHWVKt9Seon1CqSieQ.png"/></div></div></figure><p id="1e1b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果应用程序不是您的，您应该在这方面进行一些尽职调查。好好测试一下，戳戳它，踢踢轮胎，穿着作战靴在上面跳上跳下。只要确保它做了所有它应该做的事情。如果你遇到了错误，花些时间找出它们并纠正YAML。因为一旦这样做了，并且你确信这个东西有效，你就可以注册并发布它了！</p><h1 id="28d0" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">快照注册和发布</h1><p id="83ae" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">在发布之前，我们需要向商店注册快照名称。这是一个过程，以确保没有重复，所以如果有版权等问题很容易修复。注册一个我跑的名字:</p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="8cf9" class="kz jr hi lx b fi mc md l me mf">snapcraft register viu</span></pre><p id="25f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我为<code class="du lu lv lw lx b">viu</code>运行这个程序时，它抛出了一个问题。快照存储已保留或至少不允许三个字母命名的快照。这是为了鼓励应用程序更具描述性，同时也是为了避免其他快照相关命令中的冲突。如果上游想要<code class="du lu lv lw lx b">viu</code>快照名称，我们可以创建一个案例并创建<code class="du lu lv lw lx b">viu</code>三个字母的别名，但是因为我不是上游，所以我简单地创建了快照名称<code class="du lu lv lw lx b">viu-image-viewer</code>。不理想，但如果我是上游或应用程序开发人员，这是没有必要的。耸肩。</p><p id="620a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦没有问题并且注册了名称，我就将快照上传到商店。推荐的方法是首先在工作目录中运行超级漂亮的<code class="du lu lv lw lx b">remote-build</code>特性。如果这是你第一次这样做，你必须登录或在launchpad上创建一个帐户，所有的建设发生。我以前为其他东西做过一个这样的，所以我就搬到建筑上了。</p><p id="d7d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这可能需要一些时间，尤其是如果有一个que:</p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="0a47" class="kz jr hi lx b fi mc md l me mf">$ snapcraft remote-build<br/>All data sent to remote builders will be publicly available. Are you sure you want to continue? [y/N]: y<br/>snapcraft remote-build is experimental and is subject to change — use with caution.<br/>Building snap package for amd64, arm64, armhf, ppc64el, and s390x. This may take some time to finish.<br/>Build status as of 2021–02–03 11:52:34.926743: <br/> arch=amd64 state=Uploading build <br/> arch=arm64 state=Currently building <br/> arch=armhf state=Currently building<br/> arch=s390x state=Currently building<br/> arch=ppc64el state=Currently building</span></pre><p id="8e16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lu lv lw lx b">remote-build</code>按照屏幕上显示的那样做，过了一会儿，(这取决于系统的繁忙程度)我得到了一个快照列表。您可以通过进入launchpad帐户并进行检查来检查que或生成的快照。</p><p id="d3d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，我去了这个网址:<a class="ae jd" href="https://launchpad.net/~rhys-davies/+snaps" rel="noopener ugc nofollow" target="_blank">https://launchpad.net/~rhys-davies/+snaps</a>，可以看到一些东西在工作。远程构建之所以伟大，是因为它在云中进行构建，并且只向您提供二进制文件。这样我就不用让我的机器慢下来自己做所有的构建工作了。然后你会得到一个快照列表:</p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="f0aa" class="kz jr hi lx b fi mc md l me mf">viu-image-viewer_v1.3.0–10-g0dba818_amd64.snap<br/>viu-image-viewer_v1.3.0–10-g0dba818_arm64.snap<br/>viu-image-viewer_v1.3.0–10-g0dba818_armhf.snap<br/>viu-image-viewer_v1.3.0–12-g4160c8b_s390x.snap<br/>viu-image-viewer_v1.3.0–12-g4160c8b_ppc64el.snap</span></pre><p id="cf72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些可以通过艾伦在他的博客文章中分享的这个小循环<a class="ae jd" href="https://popey.com/blog/2021/02/lets-go-snapping/" rel="noopener ugc nofollow" target="_blank">上传:</a></p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="f2b5" class="kz jr hi lx b fi mc md l me mf">$ for f in viu_v1.1.0_*.snap; do snapcraft upload $f — release=candidate; done</span></pre><p id="4fed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个for循环，它查看目录中以<code class="du lu lv lw lx b">viu_v1.1.0_</code>开始、以<code class="du lu lv lw lx b">.snap</code>结束的每个文件，对其运行<code class="du lu lv lw lx b">snapcraft upload</code>，并将其放入“候选”释放通道。<a class="ae jd" href="https://snapcraft.io/blog/time-to-branch-out" rel="noopener ugc nofollow" target="_blank">发布渠道是发布快照的不同地方。</a>想法是将通用快照放在稳定通道中，用户测试放在边缘通道中，专用测试放在候选通道中。最后一行指定<code class="du lu lv lw lx b">snapcraft</code>正在使用<code class="du lu lv lw lx b">review-tools</code>命令在快照上传之前对其进行一些检查。这是我安装的一个单独的快照:</p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="9155" class="kz jr hi lx b fi mc md l me mf">snap install review-tools</span></pre><p id="1e32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">无论如何，当我上传快照时，快照商店会运行这些检查，但如果商店发现问题，需要一些时间来让我知道，我必须再次经历这个过程。只要安装了这个，就可以更容易地在东西上传之前发现问题。</p><p id="85c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设没有问题，每个快照都会上传到候选通道。由于remote builder特性为我之前指定的每个架构提供了一个快照，因此我可以测试该应用程序在我感兴趣的任何其他平台或发行版上的工作情况。问问你的朋友，在论坛上四处问问，也许可以问问上游？一旦你对此感到满意，你就可以把snap推广到稳定频道，让全世界都看到。</p><h1 id="28b2" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">Snap商店</h1><p id="a1cc" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">在使你的快照稳定之前，你应该做一些尽职调查来正确地测试这个东西，这里也有一些推荐的整理笔记。</p><p id="bc6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.将所有东西链接到GitHub repo，并将其连接到构建过程。这样，每次在GitHub中更新应用程序时，都会构建一个新版本，并将其推送到商店中的边缘渠道。为此，我登录到<a class="ae jd" href="https://snapcraft.io/blog/tour-of-the-snap-developer-account-in-the-snap-store" rel="noopener ugc nofollow" target="_blank">我的snapcraft开发者账户</a>，选择<code class="du lu lv lw lx b">viu</code>快照，进入“构建”选项卡，点击绿色大按钮:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mw"><img src="../Images/a2b953a633b112e8b767dbbaeb6679f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hr9-V6qyeFDUscpH3c67UA.png"/></div></div></figure><p id="3375" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从这里，我能够选择我之前分叉的repo，并将其链接到snapcraft构建系统。有了这个设置，我就可以在我的开发者账户中查看和推广这些推送了。现在，我可以随时点击“触发新版本”按钮，强制执行新版本。第一次这样做时，看起来像这样:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mx"><img src="../Images/10df1a86cd8d3bae40dce73e038799ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DeW6LipZ9u7G_2p-GEP-ew.png"/></div></div></figure><p id="f169" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.花点时间给你的快照<a class="ae jd" href="https://snapcraft.io/blog/make-your-snap-store-page-pop" rel="noopener ugc nofollow" target="_blank">一个漂亮的登陆页面</a>。你可以在你的开发者账户中通过“列表”和“公开”标签来完成。这里有一些<a class="ae jd" href="https://snapcraft.io/nextcloud" rel="noopener ugc nofollow" target="_blank">快照</a>与<a class="ae jd" href="https://snapcraft.io/beekeeper-studio" rel="noopener ugc nofollow" target="_blank">好的</a>登陆页面的<a class="ae jd" href="https://snapcraft.io/spotify" rel="noopener ugc nofollow" target="_blank">示例</a>，这就是你的目标。如果你有时间的话。完全不是强制的。好看的快照也更有可能出现在snapcraft.io的首页。出现在快照商店<a class="ae jd" href="https://twitter.com/popey/status/1368552999187079168" rel="noopener ugc nofollow" target="_blank">的快照会显著增加用户数量</a>。</p><p id="8d79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以填写所有基本信息，添加一些快照工作的图像和视频，或者将应用程序链接到你的GitHub或社交账户，供用户查看。你可以在这里做很多事情，让你的快照更成功，更有可能吸引更多用户。但是还有另外一篇关于这个的文章，所以我不会在这里详述。</p><h1 id="c95d" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结束了</h1><p id="253f" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">就是这样。该吃蛋糕了。如果您自己的应用程序也遵循了这个过程，那么恭喜您，用户现在可以用一个命令在几乎任何Linux发行版上安装和运行您的应用程序。如果你做了我做过的事情，并抓取了别人的应用程序，那么我们还有最后一件事要做。提出问题并向上游项目提出拉动请求，让他们知道。希望他们会很高兴，甚至可能接管应用程序的维护，并将其应用到他们的工作流程中。当然，他们根本没有义务这么做。</p><p id="13ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在这里讨论的所有内容让人感觉很多，我知道这是一篇很长的文章，但希望你能看到它基本上是直截了当的。最难的部分是调试，但是如果你对应用程序有很好的理解，或者有足够的时间在论坛上寻找帮助，即使是调试也很容易。见鬼，如果我能做到，相信我，你也能。开心抓拍。</p><p id="9f39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kt">* *仅供参考，里斯已经把他所有的作品都搬到了自己的网站</em><a class="ae jd" href="http://musing-press.com" rel="noopener ugc nofollow" target="_blank"><em class="kt">【musing-press.com】</em></a><em class="kt">，如果你喜欢这篇文章，也许可以去那边看看？** </em></p><pre class="jf jg jh ji fd ly lx lz ma aw mb bi"><span id="4445" class="kz jr hi lx b fi mc md l me mf">Here’s the final YAML:<br/><br/>name: viu-image-viewer # you probably want to ‘snapcraft register &lt;name&gt;’<br/>base: core20 # the base snap is the execution environment for this snap<br/>adopt-info: viu<br/>summary: Simple terminal image viewer # 79 char long summary<br/>description: |<br/> A small command-line application to view images from the terminal written<br/> in Rust. It is basically the front-end of viuer. It uses either iTerm or<br/> Kitty graphics protocol, if supported. If not, lower half blocks (▄ or <br/> \u2584) are displayed instead.</span><span id="4006" class="kz jr hi lx b fi mg md l me mf">grade: stable # must be ‘stable’ to release into candidate/stable channels<br/>confinement: strict # use ‘strict’ once you have the right plugs and slots</span><span id="8ff6" class="kz jr hi lx b fi mg md l me mf">architectures:<br/> — build-on: amd64 <br/> — build-on: arm64 <br/> — build-on: armhf<br/> — build-on: ppc64el</span><span id="a118" class="kz jr hi lx b fi mg md l me mf">apps:<br/> viu:<br/> command: bin/viu<br/> plugs:<br/> — network<br/> — home<br/> — removable-media<br/> — alsa<br/> — pulseaudio</span><span id="55e1" class="kz jr hi lx b fi mg md l me mf">parts:<br/> viu:<br/> plugin: rust <br/> source: <a class="ae jd" href="https://github.com/atanunq/viu.git" rel="noopener ugc nofollow" target="_blank">https://github.com/atanunq/viu.git</a><br/> override-pull: |<br/> snapcraftctl pull<br/> snapcraftctl set-version “$(git describe — tags)”<br/> build-packages:<br/> — build-essential<br/> — libcanberra-dev<br/> stage-packages:<br/> — imagemagick</span></pre></div></div>    
</body>
</html>