<html>
<head>
<title>Advanced Filtering and Data Manipulation in Pandas — loc, iloc, apply, and lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pandas中的高级过滤和数据操作— loc、iloc、apply和lambda</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/advanced-filtering-and-data-manipulation-in-pandas-loc-iloc-apply-and-lambda-95990df0ad?source=collection_archive---------2-----------------------#2021-12-05">https://medium.com/geekculture/advanced-filtering-and-data-manipulation-in-pandas-loc-iloc-apply-and-lambda-95990df0ad?source=collection_archive---------2-----------------------#2021-12-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="5de5" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">关于在pandas中使用loc、iloc、apply和lambda进行高级过滤和数据操作的指南。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/c93316cafb753eab434003c9904c8ad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YPM6-9I0ePPu2djJJHu5Ng.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://pixabay.com/users/skitterphoto-324082/" rel="noopener ugc nofollow" target="_blank">Skitterphoto</a> from <a class="ae jn" href="https://pixabay.com/" rel="noopener ugc nofollow" target="_blank">pixabay</a></figcaption></figure><p id="c83e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们之前探讨了如何与熊猫进行基本的数据争论。有时候基本功能就是不够用，这就是为什么<em class="kk"> loc </em>、<em class="kk"> iloc </em>、apply方法和lambda函数可以派上用场。</p><div class="kl km ez fb kn ko"><a href="https://python.plainenglish.io/basic-data-explorand-manipulation-in-pandas-4b35d976acab" rel="noopener  ugc nofollow" target="_blank"><div class="kp ab dw"><div class="kq ab kr cl cj ks"><h2 class="bd hj fi z dy kt ea eb ku ed ef hh bi translated">熊猫的基础数据探索和操作</h2><div class="kv l"><h3 class="bd b fi z dy kt ea eb ku ed ef dx translated">熊猫的基本数据操作技术列表。</h3></div><div class="kw l"><p class="bd b fp z dy kt ea eb ku ed ef dx translated">python .平原英语. io</p></div></div><div class="kx l"><div class="ky l kz la lb kx lc jh ko"/></div></div></a></div><p id="012b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">跟随我们的流失数据之旅——谁不想深入了解辞职员工故事的肮脏小细节——假设一些对你漂亮的总结的基础数据感兴趣的人现在想稍微调整数据，以便它更多地反映他们想象的数据应该是什么样子。</p><div class="kl km ez fb kn ko"><a href="https://python.plainenglish.io/pandas-rapid-reporting-quick-exploration-crosstab-b6511400c48e" rel="noopener  ugc nofollow" target="_blank"><div class="kp ab dw"><div class="kq ab kr cl cj ks"><h2 class="bd hj fi z dy kt ea eb ku ed ef hh bi translated">熊猫快速报告:快速探索，交叉表</h2><div class="kv l"><h3 class="bd b fi z dy kt ea eb ku ed ef dx translated">使用熊猫进行快速探索、低调报道和分析的指南。</h3></div><div class="kw l"><p class="bd b fp z dy kt ea eb ku ed ef dx translated">python .平原英语. io</p></div></div><div class="kx l"><div class="ld l kz la lb kx lc jh ko"/></div></div></a></div><p id="dac1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对于本文，我将使用来自Kaggle 的<a class="ae jn" href="https://www.kaggle.com/pavansubhasht/ibm-hr-analytics-attrition-dataset?select=WA_Fn-UseC_-HR-Employee-Attrition.csv" rel="noopener ugc nofollow" target="_blank"> IBM HR Analytics员工流失&amp;性能数据集。</a></p><p id="d76f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这里我们有原始的IBM流失数据，列出了唯一的部门名称。我们的首要任务是将“研发”值重命名为“R&amp;D ”,以保持简洁明了。让我们使用<em class="kk"> loc </em>来快速解决这个问题</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es le"><img src="../Images/1b308d28e5cb256f3222a1529c63e6e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GhDNo0PEvW3wiPVh"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><h2 id="dc45" class="lf lg hi bd lh li lj lk ll lm ln lo lp jx lq lr ls kb lt lu lv kf lw lx ly lz bi translated"><strong class="ak"> DataFrame.loc </strong></h2><p id="482c" class="pw-post-body-paragraph jo jp hi jq b jr ma ij jt ju mb im jw jx mc jz ka kb md kd ke kf me kh ki kj hb bi translated">您可以使用标签或布尔数组，使用<em class="kk"> loc </em>方法来访问数据帧中的特定行和列。一个简单的例子是使用<em class="kk"> loc </em>方法选择第二行(标签1)以及“年龄”、“流失”和“部门”列:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mf"><img src="../Images/4fad2b47c4b0e5f3d282e7ac6465ad7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/0*XJ_-YqVrOOzCISFB"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="ffa3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如您所见，第一个参数是我们想要获取的索引标签，第二个参数是我们感兴趣的列/列列表。当然，您可以选择多行，或者是标签列表，甚至是范围:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mg"><img src="../Images/1e94006ead1583249a6e9103b7dfdcbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/0*HvbaVf1lxltIW0KL"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mh"><img src="../Images/f6f2bc0f55827f15851b8923c15288d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/0*xDmNHRXN7ygiPdTP"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="512b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">请注意，当选择1:5切片时，第5个索引(第6行)也包括在内，这与Python中通常的切片不同，Python中的切片上限是唯一的。</p><p id="5c88" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">当您意识到可以使用布尔数组(实际上是一个只有真/假值的列表)来过滤行时，有趣的部分就开始了。这允许您在返回布尔值的第一个参数中编写逻辑语句—将对所有行评估该语句，返回产生True的行:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/0bbc853b12520d8de38de33b8b41c0f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tw3B8TneCFq4Tqma"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="13ef" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">再做一点调整，我们可以将“研发”重命名为“R&amp;D”:我们可以使用<em class="kk"> loc </em>为我们正在过滤的特定行/列字段赋值:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mj"><img src="../Images/b7b730b11c8239c141c0dec540e3bad1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cAQ5wwr7sGc5x37M"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="10cb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以用这种方法一次修改多个列，只需提供我们想要使用的列和值的列表:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mk"><img src="../Images/0c6af1ae789fbcb1ffebf62651750e91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TpBN3yd4_0VlxSDF"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><blockquote class="ml mm mn"><p id="6989" class="jo jp kk jq b jr js ij jt ju jv im jw mo jy jz ka mp kc kd ke mq kg kh ki kj hb bi translated">如果你想让我保持咖啡因创造更多这样的内容，请考虑支持我，只要一杯咖啡。</p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><a href="https://buymeacoffee.com/zoltanguba2"><div class="er es mr"><img src="../Images/42de2d890e13d488021d94ea1a1b9877.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*SMZM9K5hha91xzFtSBS88Q.png"/></div></a></figure><h2 id="c694" class="lf lg hi bd lh li lj lk ll lm ln lo lp jx lq lr ls kb lt lu lv kf lw lx ly lz bi translated">数据帧<strong class="ak">。iloc </strong></h2><p id="bedb" class="pw-post-body-paragraph jo jp hi jq b jr ma ij jt ju mb im jw jx mc jz ka kb md kd ke kf me kh ki kj hb bi translated"><em class="kk"> iloc </em>背后的思想与<em class="kk"> loc </em>相同，唯一的区别是——正如名字中的<em class="kk">‘I’</em>所暗示的——它在提供位置选择时完全基于整数。第一个参数是行，第二个是要选择的列。在第一行和第三列的交叉点上归零看起来像这样:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ms"><img src="../Images/bb43804dfa315bb30ddbad82527bded3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/0*VHnQZxsx2AM2psbO"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="8a73" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们也可以使用整数和切片器列表进行选择:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mt"><img src="../Images/3c8fa955ae676ac557bcf7834080de27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m3CbjRopQAXJ_g4m"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="da82" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">也可以应用更复杂的逻辑——假设您希望只返回列名长度为偶数的列。不过，不要问为什么。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/3590d10cf6539db8b5f926744164aa8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LKdclVhs_BxHbo_6"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="c23f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">请注意，如果您想返回所有行，只需在第一个参数中写“:”。这适用于第二个(列)输入，但是，如果您根本不提供它，它还是会选择所有的列。</p><h2 id="78e8" class="lf lg hi bd lh li lj lk ll lm ln lo lp jx lq lr ls kb lt lu lv kf lw lx ly lz bi translated"><strong class="ak">对系列应用功能</strong></h2><p id="7b4f" class="pw-post-body-paragraph jo jp hi jq b jr ma ij jt ju mb im jw jx mc jz ka kb md kd ke kf me kh ki kj hb bi translated">假设我们希望通过创建一个新的列来对EducationalField维度进行扩展，对其中的值进行分类——让它变得简单，比如说“工程师”或“不是工程师”:任何拥有“技术学位”的人都可以获得“工程师”(我知道我知道，但请给我一些线索，这只是一个示例)。</p><p id="3d25" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以使用apply方法对列的每个值调用一个函数，并将该函数的返回值赋给一个新列:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mv"><img src="../Images/e5fe97ebfcadba5bcc1357f8751f3336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*15mO-z9LIuKFknQb"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="2816" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我已经定义了is_engineer函数，当“技术学位”是输入时返回“工程师”,在任何其他情况下返回“不是工程师”——如果您愿意，字典允许您在将来扩展分类，如果一个键不在集合中，dictionary.get()允许您提供字典的默认返回值。请注意，您不能将()放在作为apply参数提供的函数名之后——在执行该行时，您不是在调用函数，apply会调用，因此只给出名称就足够了。</p><p id="1186" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">剩下的语法应该已经很熟悉了:我已经定义了一个新的Series，通过赋值左边的一个表达式来定义它，这样就给我们的DataFrame添加了一个新列。</p><h2 id="3b69" class="lf lg hi bd lh li lj lk ll lm ln lo lp jx lq lr ls kb lt lu lv kf lw lx ly lz bi translated"><strong class="ak">λ函数</strong></h2><p id="49fd" class="pw-post-body-paragraph jo jp hi jq b jr ma ij jt ju mb im jw jx mc jz ka kb md kd ke kf me kh ki kj hb bi translated">Python中的Lambda表达式是匿名函数，通常是表达逻辑的小段代码，需要一定的复杂性，但不需要太多来定义实际的函数以供进一步使用。RealPython有一篇关于这个主题的<a class="ae jn" href="https://realpython.com/python-lambda/" rel="noopener ugc nofollow" target="_blank">很酷的文章</a>,如果你想了解更多关于lambdas的信息，除了我的蹩脚的一行程序来完成手头的任务，我建议你花20分钟来读它，这是值得的。</p><p id="da66" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们以前面的例子为例，使用一个lambda函数来解决这个问题:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es le"><img src="../Images/0b220baabbc64c4de53ca23f836a316a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QyQvsWv5E3tPy-0R"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="2310" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，我们可以无休止地争论哪种方法更好，在这种简单的情况下，这取决于你的品味和风格。然而，更复杂的逻辑需要正确定义函数名:lambdas有局限性，如果你做复杂的事情，可读性很快就会成为一个问题。</p></div><div class="ab cl mw mx gp my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="hb hc hd he hf"><p id="8fb9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">上述方法可以为您提供广泛的选择，以进一步处理不仅仅需要基本操作的数据集——用例实际上是无穷无尽的，您只需要了解这些方法，以便在需要时可以自然使用它们。强烈推荐<a class="ae jn" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.loc.html" rel="noopener ugc nofollow" target="_blank"> loc </a>和<a class="ae jn" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.iloc.html" rel="noopener ugc nofollow" target="_blank"> iloc </a>的文档，不要错过熟悉它们的机会。</p><p id="25d6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这个题目到此为止。感谢您的阅读。</p></div></div>    
</body>
</html>