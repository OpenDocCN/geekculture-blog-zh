<html>
<head>
<title>Simulating Refraction in Three.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Three.js中模拟折射</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/simulating-refraction-in-three-js-9e367753bf6d?source=collection_archive---------2-----------------------#2021-12-06">https://medium.com/geekculture/simulating-refraction-in-three-js-9e367753bf6d?source=collection_archive---------2-----------------------#2021-12-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/783eff6ac7afbba2b73cc6935a4df78b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gGd4Vcqc0WzG2Mthjo-69g.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Four magic orbs of refractive powers!</figcaption></figure><p id="30ba" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上次，<a class="ae js" rel="noopener" href="/geekculture/using-three-js-to-create-a-crystal-clear-wine-glass-e2e2d1f64c6">我在Blender里做了一个简单的酒杯，用Three.js </a>渲染。主要展示了<code class="du jt ju jv jw b">MeshPhysicalMaterial</code>的<code class="du jt ju jv jw b">transmission</code>属性。这次我将向你展示如何模拟<code class="du jt ju jv jw b">MeshPhysicalMaterial</code>的折射效果。</p><h1 id="37bc" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">Three.js中折射的工作原理</h1><p id="aa55" class="pw-post-body-paragraph iu iv hi iw b ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn kz jp jq jr hb bi translated">其实比你想象的简单多了。</p><p id="9957" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">在Three.js中模拟折射所需要的</strong>就是设置这三个属性:</p><pre class="la lb lc ld fd le jw lf lg aw lh bi"><span id="0a11" class="li jy hi jw b fi lj lk l ll lm">const material1 = new THREE.MeshPhysicalMaterial({<br/>    roughness: 0,<br/>    transmission: 1,<br/>    thickness: 2<br/>});</span></pre><p id="a83d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，将<code class="du jt ju jv jw b">transmission</code>设置为1使其具有透射性。然后，将<code class="du jt ju jv jw b">roughness</code>设置为0或一个非常低的值，这样材料表面就足够光滑，我们可以清楚地看到它。最后的魔法:给你的素材一个<code class="du jt ju jv jw b">thickness</code>，让它有放大镜的效果。厚度越大，材料的放大特性越高。</p><p id="1f63" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">尝试下面的我的codesandbox嵌入并调整设置，看看它如何影响结果:</p><figure class="la lb lc ld fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="b100" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">不过有一点需要注意。虽然效果看起来足够真实，但这实际上不是真实生活中折射的工作方式！</p><p id="238d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在现实生活的场景中，如果折射的景物或物体离玻璃球体足够远，你实际上应该会看到一个颠倒的折射。但是在Three.js中，这种上下颠倒的效果是无法通过在PBR材质中设置<code class="du jt ju jv jw b">thickness</code>来实现的。</p><figure class="la lb lc ld fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/c8e31f55544d22c2da83d0aaf6c79f18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/0*udy4Oqc_H-VzltpD.jpg"/></div><figcaption class="iq ir et er es is it bd b be z dx">real-life orb refraction</figcaption></figure><h1 id="1bcb" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">使用normalMap和clearcoatNormalMap的迭代</h1><p id="42ab" class="pw-post-body-paragraph iu iv hi iw b ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn kz jp jq jr hb bi translated">我还做了另外一个例子，有4个不同的玻璃球体来展示其他贴图属性如何以不同的有趣方式影响最终的折射结果。</p><figure class="la lb lc ld fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="4e90" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，我在所有这些球体的<code class="du jt ju jv jw b">envMap</code>上加载了一个等矩形纹理，这样它们就有了更真实的反射。</p><p id="a42a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于第一个(左上)球体，它有最基本的设置。</p><p id="4a1f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于第二个(右上)球体，我将<code class="du jt ju jv jw b">clearcoat</code>设置为max，并设置了一个<code class="du jt ju jv jw b">clearcoatNormalMap</code>，这基本上是一个由划痕线组成的法线贴图。你应该能够在球体反射的最亮区域发现一些划痕。透明涂层模拟在表面上应用另一层反射涂层的效果。现实生活中的例子有车漆、磨光的地板和潮湿的表面。我还把它做得更粗糙更厚，以便更清晰地对比第一个球体。</p><pre class="la lb lc ld fd le jw lf lg aw lh bi"><span id="395a" class="li jy hi jw b fi lj lk l ll lm">const material2 = new THREE.MeshPhysicalMaterial({<br/>    envMap: hdrEquirect,<br/>    roughness: 0.15,<br/>    clearcoat: 1,<br/>    clearcoatNormalMap: clearcoatNormal,<br/>    transmission: 1,<br/>    thickness: 4<br/>});</span></pre><p id="593e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于第三个球(左下角),我为属性<code class="du jt ju jv jw b">normalMap</code>应用了一个高尔夫球法线贴图，结果得到了这个漂亮的玻璃高尔夫球。我们在材质上应用法线贴图来指示Three.js根据法线贴图提供的法线值计算每个像素上的反射/折射。结果是，反射/折射看起来好像材质表面不平坦且凹凸不平，但实际上材质表面仍然根据几何体进行了平滑渲染。</p><p id="bcf7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了使高尔夫球图案上的折射更加明显，我必须增加一点粗糙度。</p><pre class="la lb lc ld fd le jw lf lg aw lh bi"><span id="e79d" class="li jy hi jw b fi lj lk l ll lm">const material3 = new THREE.MeshPhysicalMaterial({<br/>    envMap: hdrEquirect,<br/>    normalMap: golfNormal,<br/>    roughness: 0.15,<br/>    transmission: 1,<br/>    thickness: 2<br/>});</span></pre><figure class="la lb lc ld fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/d800e5f364a041dae5332d92a63e29f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qEu6p-B2Xe8mwMb3-Ccr2Q.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">the normal map jpg file of a golf ball</figcaption></figure><p id="603c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于最后一个球，我使用了有划痕的<code class="du jt ju jv jw b">clearcoatNormalMap</code>和不同的<code class="du jt ju jv jw b">normalMap</code>来对比高尔夫球。</p><pre class="la lb lc ld fd le jw lf lg aw lh bi"><span id="2d3b" class="li jy hi jw b fi lj lk l ll lm">const material4 = new THREE.MeshPhysicalMaterial({<br/>    envMap: hdrEquirect,<br/>    normalMap: roughNormal,<br/>    clearcoat: 1,<br/>    clearcoatNormalMap: clearcoatNormal,<br/>    roughness: 0.15,<br/>    transmission: 1,<br/>    thickness: 2<br/>});</span></pre><figure class="la lb lc ld fd ij er es paragraph-image"><div class="er es lr"><img src="../Images/8440e4bfa20108a4a7947438f218dd96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*Y5QozwZThKriLQG1KQEZkg.jpeg"/></div><figcaption class="iq ir et er es is it bd b be z dx">the normal map jpg file of a rugged surface</figcaption></figure></div><div class="ab cl ls lt gp lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hb hc hd he hf"><p id="0ff7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">本教程到此结束！请随意分叉我的codesandbox项目并四处乱搞。</p><p id="0a9e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">大声喊出<a class="ae js" href="https://tympanus.net/codrops/2021/10/27/creating-the-effect-of-transparent-glass-and-plastic-in-three-js/" rel="noopener ugc nofollow" target="_blank">https://tym pus . net/codrops/2021/10/27/creating-the-effect of-transparent-glass and-plastic-in-three-js/</a>这是一个很好的教程，也是我这次演示的灵感。</p></div></div>    
</body>
</html>