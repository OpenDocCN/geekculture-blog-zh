<html>
<head>
<title>How to Run and Test AWS Lambda Function Using Docker in Your Laptop</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在笔记本电脑上使用Docker运行和测试AWS Lambda函数</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-write-and-test-aws-lambda-function-using-docker-in-your-laptop-f937d7d06e2a?source=collection_archive---------6-----------------------#2022-08-08">https://medium.com/geekculture/how-to-write-and-test-aws-lambda-function-using-docker-in-your-laptop-f937d7d06e2a?source=collection_archive---------6-----------------------#2022-08-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8b7d00e7f0cf8b4b6bec7b6c9c529e40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RSUJr0bwThtRx1bFrpI2OQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Image Source (<a class="ae iu" href="https://unbiased-coder.com/detect-aws-env-python-nodejs/" rel="noopener ugc nofollow" target="_blank">https://unbiased-coder.com/detect-aws-env-python-nodejs/</a>)</figcaption></figure><p id="d014" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">AWS Lambda是一种无服务器计算服务，它允许开发人员在无需管理服务器的情况下构建和运行应用程序，由Amazon Web Service提供。</p><p id="d24a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有几种方法可以编写和测试AWS Lambda。我们可以直接在AWS Lambda控制台中编写代码，也可以在笔记本电脑中编写代码，构建它，然后将构建包上传到AWS Lambda控制台并在那里进行测试。这两种方式都要求我们拥有AWS帐户和对AWS Lambda控制台的访问权限，这可能非常不方便且昂贵，尤其是对于拥有许多工程师的组织来说。因此，使用Docker容器在本地运行和测试代码可以帮助消除访问AWS Lambda控制台的需要，从而减少成本和开发时间。</p><p id="3940" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Lambda支持多种编程语言，在本文中我们将以Java为例。</p><p id="1b48" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">步骤1)安装Maven </strong></p><p id="3465" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一些ide通常有Maven作为插件，我使用Visual Studio代码(VSC)和Maven插件。关于如何安装Maven的更多信息，你可以访问VSC团队提供的<a class="ae iu" href="https://code.visualstudio.com/docs/java/java-build" rel="noopener ugc nofollow" target="_blank">链接。</a></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jt"><img src="../Images/240212ca6010428a559cf03e45af92d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*P9Zn0SYR4M6hwgZMiSLdSw.png"/></div></figure><p id="1bb9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">步骤2)创建项目文件夹并生成Maven代码模板</strong></p><p id="75f7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了创建项目文件夹，我们在终端中运行这个命令</p><blockquote class="jy jz ka"><p id="f9ff" class="iv iw kb ix b iy iz ja jb jc jd je jf kc jh ji jj kd jl jm jn ke jp jq jr js hb bi translated"><code class="du kf kg kh ki b"><strong class="ix hj">mkdir hello-lambda</strong></code></p></blockquote><p id="c8ae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要生成一个Maven项目，在VSC打开<code class="du kf kg kh ki b">Command Palette</code>并搜索<code class="du kf kg kh ki b">Create Java Project</code>命令。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kj"><img src="../Images/bf78ecdf753c0f3e5b4a2560aadaad45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*qtDNNU_cQpSmpsArb5xYhQ.png"/></div></figure><p id="f842" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在此之后，让我们保持其他一切默认。</p><p id="9d97" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">完成步骤2后，项目文件夹应该是这样的。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kk"><img src="../Images/4612ade8086cfc0b5b30e8d220734def.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*179yE4Tb-FIFKB6DXA15Mw.png"/></div></figure><p id="fbef" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">步骤3)添加AWS依赖项和打包插件</strong></p><p id="8010" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">AWS SDK允许我们编写lambda函数可以读取的lambda处理程序代码。打包插件帮助我们将代码打包成一个可以在Docker容器中运行的构建文件。</p><p id="9205" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了向我们的项目添加AWS依赖项，我们转到<code class="du kf kg kh ki b">pom.xml</code>文件，并在<code class="du kf kg kh ki b">dependencies</code>标签下添加这些依赖项。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="2630" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要添加插件打包，在<code class="du kf kg kh ki b">pom.xml</code>文件中并在<code class="du kf kg kh ki b">plugins</code>标签下添加这些插件。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="3cbd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">步骤4)添加示例λ代码</strong></p><p id="daf5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<code class="du kf kg kh ki b">App.java</code>的同一个目录下添加一个<code class="du kf kg kh ki b">Input.java</code>文件。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kn"><img src="../Images/6c6868f7017555613cc1dbf2013e5e44.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*Euwr6LhJGJF4fqRuNyXNFg.png"/></div></figure><p id="865a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个文件作为lambda函数的输入对象。然后，将下面的代码添加到<code class="du kf kg kh ki b">Input.java</code>中。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="fa01" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<code class="du kf kg kh ki b">App.java</code>文件夹中，我们可以添加简单的Java代码，比如</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="3ce4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个lambda代码用<code class="du kf kg kh ki b">Hello &lt;input payload string&gt;</code>接收输入对象和响应。</p><p id="f60e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">步骤5)构建并打包我们的代码</strong></p><p id="51d4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们的终端中，跳转到<code class="du kf kg kh ki b">demo</code>文件夹并运行</p><blockquote class="jy jz ka"><p id="b92e" class="iv iw kb ix b iy iz ja jb jc jd je jf kc jh ji jj kd jl jm jn ke jp jq jr js hb bi translated"><code class="du kf kg kh ki b"><strong class="ix hj">mvn compile dependency:copy-dependencies -DincludeScope=runtime</strong></code></p></blockquote><p id="561a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该命令生成一个<code class="du kf kg kh ki b">target</code>文件夹，里面有<code class="du kf kg kh ki b">classes</code>和<code class="du kf kg kh ki b">dependency</code>文件夹。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es ko"><img src="../Images/9652accf1c26df7e12f2750adbf53c28.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/1*m9nYorOoFDFARliVcnXCwg.png"/></div></figure><p id="e293" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在Docker容器中运行并测试我们的代码</p><p id="70ee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<code class="du kf kg kh ki b">demo</code>文件夹中，添加一个<code class="du kf kg kh ki b">Dockerfile</code></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es kp"><img src="../Images/f33e461703da765698c1b2ff7eead361.png" data-original-src="https://miro.medium.com/v2/resize:fit:558/format:webp/1*GxCCTT2xTMuDDEB2CLBvCg.png"/></div></figure><p id="ac57" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后把下面的内容复制到我们的Dockerfile。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="f347" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">基本上，这个Dockerfile所做的就是使用来自AWS for Java 11的lambda运行时映像。然后，它将我们之前在<code class="du kf kg kh ki b">target</code>文件夹中生成的<code class="du kf kg kh ki b">classes</code>和<code class="du kf kg kh ki b">dependency</code>复制到Docker容器的lambda工作目录中。最后，它指定了我们的Java代码在哪里供<code class="du kf kg kh ki b">command handler</code>运行。</p><p id="716d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经准备好在Docker容器中构建和运行我们的代码了。运行这两个命令。(确保您安装了docker，并且Docker正在后台运行)</p><blockquote class="jy jz ka"><p id="7923" class="iv iw kb ix b iy iz ja jb jc jd je jf kc jh ji jj kd jl jm jn ke jp jq jr js hb bi translated"><code class="du kf kg kh ki b"><strong class="ix hj">docker build -t lambdacode .</strong></code></p><p id="15e7" class="iv iw kb ix b iy iz ja jb jc jd je jf kc jh ji jj kd jl jm jn ke jp jq jr js hb bi translated"><code class="du kf kg kh ki b"><strong class="ix hj">docker run -p 9000:8080 lambdacode</strong></code></p></blockquote><p id="27ee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦运行，我们的终端输出应该看起来类似</p><pre class="ju jv jw jx fd kq ki kr ks aw kt bi"><span id="8b7b" class="ku kv hi ki b fi kw kx l ky kz">08 Aug 2022 02:54:36,830 [INFO] (rapid) exec '/var/runtime/bootstrap' (cwd=/var/task, handler=)</span></pre><p id="23cb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将无法键入新命令，因为Docker容器正在当前终端中运行我们的lambda代码。</p><p id="6c91" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，创建第二个终端并运行以下命令</p><blockquote class="jy jz ka"><p id="e2bd" class="iv iw kb ix b iy iz ja jb jc jd je jf kc jh ji jj kd jl jm jn ke jp jq jr js hb bi translated"><code class="du kf kg kh ki b"><strong class="ix hj">curl -XPOST “http://localhost:9000/2015-03-31/functions/function/invocations" -d ‘{“payload”:”Lambda”}’</strong></code></p></blockquote><p id="d63f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个命令为我们的lambda函数提供了有效载荷输入字符串<code class="du kf kg kh ki b">Lambda</code>，我们将看到结果<code class="du kf kg kh ki b">Hello Lambda</code>。我们可以用任何东西代替<code class="du kf kg kh ki b">"Lambda"</code>进行测试。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es la"><img src="../Images/75f9e44518b96e11810c1b6d07e35dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*BAdxjxsd2G2tB1TglZUdwg.png"/></div></figure><p id="d8c7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们已经使用Docker运行了lambda函数，没有将它上传到AWS控制台。恭喜你。</p></div></div>    
</body>
</html>