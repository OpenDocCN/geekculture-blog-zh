<html>
<head>
<title>Tasker and Fitbit Integration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Tasker和Fitbit集成</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/tasker-and-fitbit-integration-4fc51d6eb186?source=collection_archive---------19-----------------------#2021-06-17">https://medium.com/geekculture/tasker-and-fitbit-integration-4fc51d6eb186?source=collection_archive---------19-----------------------#2021-06-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a52a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将解释我如何使用Tasker在Fitbit上自动化一些操作。特别是，我的目标是创建一个任务，在特定条件下启用和禁用我的Fitbit的一些警报。</p><h2 id="73d0" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">要求</h2><ul class=""><li id="617b" class="jy jz hi ih b ii ka im kb iq kc iu kd iy ke jc kf kg kh ki bi translated">Tasker 5.12.22</li><li id="d741" class="jy jz hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">Fitbit</li><li id="12eb" class="jy jz hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">了解Fitbit API的一些基本开发技巧</li></ul><p id="7223" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有的信息都可以在Fitbit提供的官方<a class="ae ko" href="https://dev.fitbit.com/build/reference/web-api/" rel="noopener ugc nofollow" target="_blank"> Web API </a>站点上找到。</p><h1 id="b59c" class="kp je hi bd jf kq kr ks jj kt ku kv jn kw kx ky jq kz la lb jt lc ld le jw lf bi translated">第一步。配置新的Fitbit应用程序</h1><p id="02b9" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">首先要做的是使用<a class="ae ko" href="https://dev.fitbit.com/apps" rel="noopener ugc nofollow" target="_blank">我的应用</a>门户创建一个新的应用。</p><p id="746f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">登录后，我们只需点击<strong class="ih hj">注册一个新的app </strong>。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lj"><img src="../Images/da6dcdf46a4af3d7e1f6db549d32790a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rdYTPYN-ouNAuAiaqDJpnQ.png"/></div></div></figure><p id="47b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并对其进行如下配置。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div class="er es lv"><img src="../Images/542bdc37b0d40cc0cbe416eec9a23271.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*Hq6T4zov47FjCmcw-0OwIg.png"/></div></figure><p id="8ed4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意<strong class="ih hj">重定向URL </strong>很重要，因为它将用于获取访问令牌和<strong class="ih hj">默认访问类型</strong>，需要<em class="lw">读取&amp;写入</em>选项来更改Fitbit设置或数据。</p><p id="c0de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<strong class="ih hj">保存</strong>按钮，确认新应用的创建。在接下来的页面中，您需要复制ClientId。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lx"><img src="../Images/a458857a5fab4228f55033d41ad03efb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*n2UhiQN-pS7XeN4r3usjgA.png"/></div></div></figure><h1 id="00d0" class="kp je hi bd jf kq kr ks jj kt ku kv jn kw kx ky jq kz la lb jt lc ld le jw lf bi translated">第二步。了解授权流程</h1><p id="0b4c" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">在<a class="ae ko" href="https://dev.fitbit.com/build/reference/web-api/oauth2/#authorization-page" rel="noopener ugc nofollow" target="_blank">授权页面</a>中，你可以看到你的应用应该如何请求用户授权访问他们的数据。</p><p id="2316" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的场景中，我们将使用<em class="lw">隐式授权流</em>来直接接收令牌。授权页面的URL是</p><blockquote class="ly lz ma"><p id="0c1b" class="if ig lw ih b ii ij ik il im in io ip mb ir is it mc iv iw ix md iz ja jb jc hb bi translated">https://www.fitbit.com/oauth2/authorize?response _ type = token &amp; client _ id =[您的客户端标识]&amp; scope = settings &amp; expires _ in = 31536000</p></blockquote><p id="b94d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">URL部分包括:</p><ul class=""><li id="bfc5" class="jy jz hi ih b ii ij im in iq me iu mf iy mg jc kf kg kh ki bi translated"><strong class="ih hj">https://www.fitbit.com/oauth2/authorize</strong>:Fitbit授权页面。</li><li id="5a35" class="jy jz hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated"><strong class="ih hj"> response_type=token </strong>:接收令牌。</li><li id="eb5e" class="jy jz hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated"><strong class="ih hj">Client _ id =[your-Client-ID]</strong>:在这里，您必须插入在创建应用程序后收到的客户ID。</li><li id="c1fd" class="jy jz hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated"><strong class="ih hj"> scope=settings </strong>:指定我们想从Tasker中访问哪种数据。你可以在这里阅读更多<a class="ae ko" href="https://dev.fitbit.com/build/reference/web-api/oauth2/#scope" rel="noopener ugc nofollow" target="_blank"/>。</li><li id="7069" class="jy jz hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated"><strong class="ih hj"> expires_in=31536000 </strong>:令牌的有效期。31536000是以秒为单位的一年。</li></ul><p id="401c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您在设置您的客户端id后尝试该链接，您将被重定向到您在第一步中配置的<strong class="ih hj">重定向URI </strong>，并附加一些信息:</p><blockquote class="ly lz ma"><p id="179a" class="if ig lw ih b ii ij ik il im in io ip mb ir is it mc iv iw ix md iz ja jb jc hb bi translated"><a class="ae ko" href="https://tasker.joaoapps.com/#access_token=eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyM0I4WjgiLCJzdWIiOiI2NFM5QjQiLCJpc3MiOiJGaXRiaXQiLCJ0eXAiOiJhY2Nlc3NfdG9rZW4iLCJzY29wZXMiOiJ3c2V0IiwiZXhwIjoxNjU1MzYwNTY3LCJpYXQiOjE2MjM4MjQ1Njd9.g6xRfVlupQczjCsbipg7SLNgyIyq3U9EKvb8b_QYKj4&amp;user_id=64S9B4&amp;scope=settings&amp;token_type=Bearer&amp;expires_in=31536000" rel="noopener ugc nofollow" target="_blank">https://tasker . jooaapps . com/# access _ token =[very-long-token]&amp;user _ id =[user-id]&amp;scope = settings&amp;token _ type = Bearer&amp;expires _ in = 31536000</a></p></blockquote><p id="6fac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将在任务中使用<strong class="ih hj">访问令牌</strong>参数。</p><h1 id="7c73" class="kp je hi bd jf kq kr ks jj kt ku kv jn kw kx ky jq kz la lb jt lc ld le jw lf bi translated">第三步。熟悉API</h1><p id="d9f9" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">现在我们差不多准备好写任务了。我们首先需要理解我们将需要什么API调用以及如何调用它们。</p><p id="8842" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在<a class="ae ko" href="https://dev.fitbit.com/build/reference/web-api/explore/" rel="noopener ugc nofollow" target="_blank"> Swagger </a>页面找到它们。</p><p id="82ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于我们的场景，我们将使用Auth部分下的<a class="ae ko" href="https://dev.fitbit.com/build/reference/web-api/explore/#/Auth/introspect" rel="noopener ugc nofollow" target="_blank">内省调用</a>来检查令牌的有效性，并使用<a class="ae ko" href="https://dev.fitbit.com/build/reference/web-api/explore/#/Devices" rel="noopener ugc nofollow" target="_blank"> Devices </a>部分下的调用来获取和更新警报。</p><h2 id="5589" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">试试邮差</h2><p id="1a1a" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">我已经创建了一个Postman项目来测试我需要的所有调用。你可以用<a class="ae ko" href="https://gist.github.com/pirasalbe/c90de06bb8dad339b85982746258a7e0" rel="noopener ugc nofollow" target="_blank">这个文件</a>导入它们。</p><p id="d4d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在测试它们之前，请确保在集合授权设置中配置您在上一步中收到的令牌。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mh"><img src="../Images/61bf7f6e0ca9c846e23d6fc91ddb0707.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SaZxDRko7fNtxDk0gifdnw.png"/></div></div></figure><h1 id="e9b7" class="kp je hi bd jf kq kr ks jj kt ku kv jn kw kx ky jq kz la lb jt lc ld le jw lf bi translated">第四步。塔斯克</h1><p id="e39d" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">我们终于可以开始用Tasker写一些任务了。为了调用Fitbit API，我们可以使用<strong class="ih hj"> HTTP请求</strong>动作。</p><p id="4c88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我做过的事情的清单。</p><h2 id="ef86" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">检查并更新Fitbit令牌</h2><p id="5486" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">我创建了一个配置文件，每天检查我的令牌的有效性。如果无效，它会向我发送一个通知，通知中有两个按钮，一个是再次授权应用程序，另一个是提交收到的新令牌。</p><p id="e80e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ko" href="https://streamable.com/pjocw1" rel="noopener ugc nofollow" target="_blank">在这里</a>你可以看到一个简短的演示。当我点击第一个按钮时，它要求我用我的Fitbit帐户登录并授权应用程序。我以前做过这个，所以我没有再做就被重定向了。</p><h2 id="7c7e" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">选择要切换的警报</h2><p id="09a1" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">然后，我创建了一个任务，该任务执行调用以获取所有警报，并询问我想要自动管理哪个警报。这些警告被保存在一个数组变量中以备将来使用。</p><p id="fab6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ko" href="https://streamable.com/1z4m0r" rel="noopener ugc nofollow" target="_blank">在这里</a>你可以看到一个简短的演示。</p><h2 id="4e16" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">更新选定的警报</h2><p id="2937" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">最后，我创建了一个任务来更新所有先前选择的警报，以便基于一个名为<em class="lw"> %Mode </em>的变量来启用/禁用它们。</p><p id="8c57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了更新警报，我不得不使用<strong class="ih hj">变量搜索替换</strong>动作手动编码身体(可能不是最好的方法)。我硬编码了<em class="lw">工作日</em>和<em class="lw">循环</em>参数，因为我所有的闹钟都以相同的方式配置。</p></div><div class="ab cl mi mj gp mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="hb hc hd he hf"><p id="1ca7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">阅读<a class="ae ko" href="https://pirasalbe.medium.com/tasker-and-fitbit-integration-tasks-overview-4d752c027a77?sk=0908951bc5aa826f404014508412a7b9" rel="noopener">这个故事</a>中对这些任务的详细解释。</p><h1 id="c069" class="kp je hi bd jf kq kr ks jj kt ku kv jn kw kx ky jq kz la lb jt lc ld le jw lf bi translated">第五步。导入项目</h1><p id="ca39" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">您可以使用下面的<a class="ae ko" href="https://taskernet.com/shares/?user=AS35m8nzU8Z2OxB1WGqHbYHDLajdlq0DG%2B8k8f7L2XfQM3eHbHEAthA2xNvalA2%2FZaJvRZj2roE7ow%3D%3D&amp;id=Project%3AFitbit" rel="noopener ugc nofollow" target="_blank">链接</a>导入我创建的概要文件和任务。</p></div></div>    
</body>
</html>