<html>
<head>
<title>Capacity Planning — Kubernetes Cluster Deployment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">容量规划— Kubernetes集群部署</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/capacity-planning-kubernetes-cluster-deployment-4192c007efda?source=collection_archive---------5-----------------------#2022-04-02">https://medium.com/geekculture/capacity-planning-kubernetes-cluster-deployment-4192c007efda?source=collection_archive---------5-----------------------#2022-04-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7fca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如今，大多数组织倾向于数字化，并试图采用开源集装箱化平台来满足他们在数字化方面的需求。当我们考虑集装箱化平台的当前选项时，我们有:</p><p id="4d3f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd"> Kubernetes、Openshift、Hashicorp Nomad、Docker Swarm、Rancher、Mesos、Google Container Engine (GKE)、Google Cloud Run、AWS Elastic Kubernetes Service(EKS)、Amazon EC2 Container Service (ECS)、AWS Fargate、Azure AKS Service、Azure Managed Openshift Service、Azure Container Instances、Digital Ocean Kubernetes Service、Red Hat OpenShift Online、Linode Kubernetes Engine </em> </strong></p><p id="0004" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请参考此处的<a class="ae je" href="https://devopscube.com/docker-container-clustering-tools/" rel="noopener ugc nofollow" target="_blank">链接</a>,以获得更深入的细节对比。在本文中，我的目的是提供更多关于kubernetes集群容量规划和部署Kubernetes集群时需要考虑的事项。因为当我们开始部署集群时，最好不要只部署一个集群，这样做的目的是确保部署是稳定的，并且能够在未来的使用情形中处理更多的负载和部署。</p><p id="463d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 1。了解Kubernetes架构和主要组件交互</strong></p><p id="a1e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之前，只要更好地理解架构和每个组件如何相互作用。然后，只有在部署中出现任何问题时，我们才能让它正常工作，或者可以轻松找到根本原因。通常，下图说明了对架构和流程的高级理解。这种理解通常足以开始部署。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/2066facb8298d3f7006bb35111df14e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C42WLAnq7t920cSHIv6HqA.png"/></div></div></figure><p id="a804" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。选择部署脚本和主要注意事项</strong></p><p id="169d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在正式选择部署脚本时，基于kubernetes.io有两种选项可用，</p><ul class=""><li id="ac77" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated"><a class="ae je" href="https://kubernetes.io/docs/setup/production-environment/tools/kubespray/" rel="noopener ugc nofollow" target="_blank"> Kubespray </a></li><li id="a6ae" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><a class="ae je" href="https://kubernetes.io/docs/setup/production-environment/tools/kops/" rel="noopener ugc nofollow" target="_blank"> kops </a></li><li id="66bf" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated"><a class="ae je" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/" rel="noopener ugc nofollow" target="_blank"> kubeadm </a></li></ul><p id="da0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我看来，最好使用kubeadm，并按照kubernetes文档提供的步骤，根据您的需要准备ansible脚本。然后，您将可以完全控制部署，并了解我们实际部署的是什么。准备脚本时，请确保您正在处理以下场景。</p><ul class=""><li id="cf2c" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">脚本应该支持多个服务器选项，如在安装时更改每个组件中的节点数。</li><li id="bc1f" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">卸载/重置群集的脚本。</li><li id="4189" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">脚本应该更新证书，因为默认情况下，kubeadm只生成1年的证书，所以您的脚本应该在您重新运行它时更新它。</li><li id="447c" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">脚本应该能够在集群中添加和删除额外的工作节点。</li><li id="b6ad" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">确保docker相关数据目录指向您的/application目录，该目录是用大量磁盘空间创建的。否则，默认情况下docker数据目录将指向/var，将来您可能会遇到磁盘空间问题，或者您需要增加/var目录。</li></ul><p id="ab7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。选择部署模式</strong></p><p id="2a8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kubernetes为高可用性集群部署提供了两种选择。</p><ul class=""><li id="b6ab" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">具有堆叠的控制平面节点，其中etcd节点与控制平面节点位于同一位置</li><li id="e761" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">具有外部etcd节点，其中etcd运行在与控制平面分离的节点上</li></ul><p id="c296" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这可以根据实际需要来选择。如果采用高可用性要求的环境，并且需要在主要kubernetes组件的每个级别都有HA，则可以采用外部etcd选项。这种拓扑结构将控制平面和etcd成员分离。因此，它提供了一种高可用性设置，其中丢失控制平面实例或etcd成员的影响较小，并且不会像堆叠高可用性拓扑那样影响集群冗余。</p><p id="06f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 4。分析需求并规划集群硬件需求</strong></p><p id="3b4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们处于实施阶段的开始时，很难决定将多少微服务部署到kubernetes集群，并且在为基础架构供应提供硬件规格时，这始终是一个障碍或难点。下面是我想出的一个模板，用来在项目的起点避免这种阻碍。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es kf"><img src="../Images/ed5a2e58ea420d47a6a769e9cad39106.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A7LVjFID1p12cvouhPYu_g.png"/></div></div></figure><p id="faeb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基于此，填充您将要部署的服务，最初从支持用例所需的公共服务开始。然后添加一行与用例相关的服务，并提及估计的服务数量，考虑未来的供应。这将是对未来可以开发的微服务的粗略估计。</p><p id="4f15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后根据总内存和cpu限制来决定每个工作机所需的RAM和CPU。因为对于控制平面和ETCD节点，我们可以使用已定义的值，但是工作者节点将根据您将要开发的用例的数量而改变。因此，我们需要为未来做好准备。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es kg"><img src="../Images/3275dfe31d351fd49e1a4da90585ae75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*raAbss7XJvphwlpNqJqCmA.png"/></div></div></figure><p id="68b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，在一个典型的高可用性系统中，确保保持[x] = 3。</p><p id="6b63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当谈到工作节点时，它取决于我们前面的分析。这里要注意的一点是，最好将负载分配给多个工作人员，而不是纵向扩展。建议横向扩展，这样，即使一台服务器出现故障，其他服务器也可以管理和调度pod。工作节点硬件规范的典型模板如下所示:</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es kg"><img src="../Images/adf6816fb60768168c02c0ac88d72673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YGf-QGJNzHNJ5h6aHGkZCQ.png"/></div></div></figure><p id="b2ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，请确保[X]大于3，因为我们过去一直遵循奇数，您可以使用3，5，7个工作节点，这取决于您之前获得的统计数据。</p><p id="277f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 5。监控集群</strong></p><p id="28f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，也有多种选择。</p><ul class=""><li id="e083" class="jr js hi ih b ii ij im in iq jt iu ju iy jv jc jw jx jy jz bi translated">Kubernetes本身有一个仪表板，您可以使用它来监控集群。</li><li id="a489" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">这是一个命令行工具</li><li id="74d1" class="jr js hi ih b ii ka im kb iq kc iu kd iy ke jc jw jx jy jz bi translated">还有一个叫做https://k8slens.dev/的开源工具，这也是管理kubernetes集群的一个有用工具。</li></ul><p id="6972" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考文献</strong></p><p id="22a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[1]<a class="ae je" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/ha-topology/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/setup/production-environment/tools/kube ADM/ha-topology/</a></p><p id="f8cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae je" href="https://devopscube.com/docker-container-clustering-tools/" rel="noopener ugc nofollow" target="_blank">https://devopscube.com/docker-container-clustering-tools/</a></p><p id="933d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae je" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank">https://kubernetes.io/</a></p></div></div>    
</body>
</html>