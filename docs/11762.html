<html>
<head>
<title>Scrape Google Play Search Apps in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python抓取Google Play搜索应用</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/scrape-google-play-search-apps-in-python-6fe2ebe0382c?source=collection_archive---------2-----------------------#2022-04-08">https://medium.com/geekculture/scrape-google-play-search-apps-in-python-6fe2ebe0382c?source=collection_archive---------2-----------------------#2022-04-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/d30bdc069e25c3ed6b2066be95bffc95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s2h5RrjxiGd0I9KpaJsD3Q.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="4f84" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">关于用Python抓取谷歌Play商店应用程序搜索结果的分步教程。</h2></div><ul class=""><li id="0f15" class="ji jj ht jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><a class="ae ka" href="#1bfb" rel="noopener ugc nofollow">会刮什么</a></li><li id="0558" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><a class="ae ka" href="#74d2" rel="noopener ugc nofollow">完整代码</a></li><li id="8c36" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><a class="ae ka" href="#042f" rel="noopener ugc nofollow">准备</a></li><li id="4007" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><a class="ae ka" href="#aa3a" rel="noopener ugc nofollow">代码解释</a></li><li id="744c" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><a class="ae ka" href="#85c2" rel="noopener ugc nofollow">使用Google Play应用商店API </a></li><li id="28e6" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><a class="ae ka" href="#d98a" rel="noopener ugc nofollow">链接</a></li></ul><h1 id="1bfb" class="kg kh ht bd ki kj kk kl km kn ko kp kq iz kr ja ks jc kt jd ku jf kv jg kw kx bi translated">会刮什么</h1><figure class="kz la lb lc fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/60f944609af96131f8ccc0f9c2aa6898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sKxgSoqNUTXgoZFh.png"/></div></div></figure><p id="92df" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">📌注意:Google Play对登录和未登录用户给出不同的结果。</p><h1 id="74d2" class="kg kh ht bd ki kj kk kl km kn ko kp kq iz kr ja ks jc kt jd ku jf kv jg kw kx bi translated">完整代码</h1><p id="262b" class="pw-post-body-paragraph ld le ht jk b jl lq iu lf jn lr ix lg jp ls li lj jr lt ll lm jt lu lo lp jv hb bi translated">如果你不需要解释，看看在线IDE 中的<a class="ae ka" href="https://replit.com/@chukhraiartur/blog-google-play-apps#main.py" rel="noopener ugc nofollow" target="_blank">完整代码示例。</a></p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="f489" class="ma kh ht lw b fi mb mc l md me">import time, json<br/>from selenium import webdriver<br/>from selenium.webdriver.chrome.service import Service<br/>from webdriver_manager.chrome import ChromeDriverManager<br/>from selenium.webdriver.common.by import By<br/>from selenium.webdriver.support.wait import WebDriverWait<br/>from selenium.webdriver.support import expected_conditions as EC<br/>from parsel import Selector<br/></span><span id="21e1" class="ma kh ht lw b fi mf mc l md me">google_play_apps = {<br/>    'Top charts': {<br/>        'Top free': [],<br/>        'Top grossing': [],<br/>        'Top paid': []<br/>    },<br/>}<br/>def scroll_page(url):<br/>    service = Service(ChromeDriverManager().install())<br/>    options = webdriver.ChromeOptions()<br/>    options.add_argument("--headless")<br/>    options.add_argument("--lang=en")<br/>    options.add_argument("user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36")<br/>    options.add_argument("--no-sandbox")<br/>    driver = webdriver.Chrome(service=service, options=options)<br/>    driver.get(url)<br/>    while True:<br/>        try:<br/>            driver.execute_script("document.querySelector('.snByac').click();")<br/>            WebDriverWait(driver, 10000).until(EC.visibility_of_element_located((By.TAG_NAME, 'body')))<br/>            break<br/>        except:<br/>            driver.execute_script("window.scrollTo(0, document.body.scrollHeight);")<br/>            WebDriverWait(driver, 10000).until(EC.visibility_of_element_located((By.TAG_NAME, 'body')))<br/>    scrape_top_charts(driver=driver, chart='Top free', button_selector='#ct\|apps_topselling_free .ypTNYd')<br/>    scrape_top_charts(driver=driver, chart='Top grossing', button_selector='#ct\|apps_topgrossing .ypTNYd')<br/>    scrape_top_charts(driver=driver, chart='Top paid', button_selector='#ct\|apps_topselling_paid .ypTNYd')<br/>    <br/>    selector = Selector(driver.page_source)<br/>    driver.quit()<br/>    return selector<br/>	<br/>def scrape_top_charts(driver, chart, button_selector):<br/>    button = driver.find_element(By.CSS_SELECTOR, button_selector)<br/>    driver.execute_script("arguments[0].click();", button)<br/>    time.sleep(2)<br/>    selector = Selector(driver.page_source)<br/>    for result in selector.css('.itIJzb'):<br/>        title = result.css('.OnEJge::text').get()<br/>        link = 'https://play.google.com' + result.css('::attr(href)').get()<br/>        category = result.css('.ubGTjb .sT93pb.w2kbF:not(.K4Wkre)::text').get()<br/>        rating = float(result.css('.CKzsaf .w2kbF::text').get())<br/>        thumbnail = result.css('.stzEZd::attr(srcset)').get().replace(' 2x', '')<br/>        google_play_apps['Top charts'][chart].append({<br/>            'title': title,<br/>            'link': link,<br/>            'category': category,<br/>            'rating': rating,<br/>            'thumbnail': thumbnail,<br/>        })<br/>def scrape_all_sections(selector):	<br/>    for section in selector.css('section'):<br/>        section_title = section.css('.kcen6d span::text').get()<br/>        google_play_apps[section_title] = []<br/>        for app in section.css('.UVEnyf'):<br/>            title = app.css('.Epkrse::text').get()<br/>            link = 'https://play.google.com' + app.css('.Si6A0c::attr(href)').get()<br/>            rating = app.css('.LrNMN::text').get()<br/>            rating = float(rating) if rating else rating<br/>            thumbnail = app.css('.Q8CSx::attr(srcset)').get().replace(' 2x', '')<br/>            google_play_apps[section_title].append({<br/>                'title': title,<br/>                'link': link,<br/>                'rating': rating,<br/>                'thumbnail': thumbnail,<br/>            })<br/>    <br/>    print(json.dumps(google_play_apps, indent=2, ensure_ascii=False))<br/>	<br/>def scrape_google_play_apps():<br/>    params = {<br/>        'device': 'phone',  <br/>        'hl': 'en_GB',		# language <br/>        'gl': 'US',			# country of the search<br/>    }<br/>    URL = f"https://play.google.com/store/apps?device={params['device']}&amp;hl={params['hl']}&amp;gl={params['gl']}"<br/>    result = scroll_page(URL)<br/>    scrape_all_sections(result)<br/>if __name__ == "__main__":<br/>    scrape_google_play_apps()</span></pre><h1 id="042f" class="kg kh ht bd ki kj kk kl km kn ko kp kq iz kr ja ks jc kt jd ku jf kv jg kw kx bi translated">准备</h1><p id="7a1e" class="pw-post-body-paragraph ld le ht jk b jl lq iu lf jn lr ix lg jp ls li lj jr lt ll lm jt lu lo lp jv hb bi translated"><strong class="jk hu">安装库</strong>:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="3c9b" class="ma kh ht lw b fi mb mc l md me">pip install parsel selenium webdriver webdriver_manager</span></pre><p id="14f4" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated"><strong class="jk hu">降低被阻挡的几率</strong></p><p id="9356" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">确保使用<a class="ae ka" href="https://docs.python-requests.org/en/master/user/quickstart/#custom-headers" rel="noopener ugc nofollow" target="_blank">请求头</a> <code class="du mg mh mi lw b"><a class="ae ka" href="https://developer.mozilla.org/en-US/docs/Glossary/User_agent" rel="noopener ugc nofollow" target="_blank">user-agent</a></code>作为“真正的”用户访问。因为默认的<code class="du mg mh mi lw b">requests</code> <code class="du mg mh mi lw b">user-agent</code>是<code class="du mg mh mi lw b"><a class="ae ka" href="https://github.com/psf/requests/blob/589c4547338b592b1fb77c65663d8aa6fbb7e38b/requests/utils.py#L808-L814" rel="noopener ugc nofollow" target="_blank">python-requests</a></code>，网站知道这很可能是一个发送请求的脚本。<a class="ae ka" href="https://www.whatismybrowser.com/detect/what-is-my-user-agent/" rel="noopener ugc nofollow" target="_blank">查查你的</a> <code class="du mg mh mi lw b"><a class="ae ka" href="https://www.whatismybrowser.com/detect/what-is-my-user-agent/" rel="noopener ugc nofollow" target="_blank">user-agent</a></code>。</p><p id="b4cf" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">有一个<a class="ae ka" href="https://serpapi.com/blog/how-to-reduce-chance-of-being-blocked-while-web/" rel="noopener ugc nofollow" target="_blank">如何在抓取博客帖子</a>时减少被屏蔽的机会，可以让你熟悉基本的和更高级的方法。</p><h1 id="aa3a" class="kg kh ht bd ki kj kk kl km kn ko kp kq iz kr ja ks jc kt jd ku jf kv jg kw kx bi translated">代码解释</h1><p id="719a" class="pw-post-body-paragraph ld le ht jk b jl lq iu lf jn lr ix lg jp ls li lj jr lt ll lm jt lu lo lp jv hb bi translated">导入库:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="e0b7" class="ma kh ht lw b fi mb mc l md me">import time, json<br/>from selenium import webdriver<br/>from selenium.webdriver.chrome.service import Service<br/>from webdriver_manager.chrome import ChromeDriverManager<br/>from selenium.webdriver.common.by import By<br/>from selenium.webdriver.support.wait import WebDriverWait<br/>from selenium.webdriver.support import expected_conditions as EC<br/>from parsel import Selector</span></pre><ul class=""><li id="78e1" class="ji jj ht jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><code class="du mg mh mi lw b"><a class="ae ka" href="https://docs.python.org/3/library/time.html" rel="noopener ugc nofollow" target="_blank">time</a></code>在Python中处理时间。</li><li id="9e45" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><code class="du mg mh mi lw b"><a class="ae ka" href="https://docs.python.org/3/library/json.html" rel="noopener ugc nofollow" target="_blank">json</a></code>将提取的数据转换成JSON对象。</li><li id="4d8c" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated">使用Selenium服务器在本地或远程机器上像用户一样本地驱动浏览器。</li><li id="1e2a" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><code class="du mg mh mi lw b"><a class="ae ka" href="https://www.selenium.dev/selenium/docs/api/py/webdriver_chrome/selenium.webdriver.chrome.service.html" rel="noopener ugc nofollow" target="_blank">Service</a></code>管理ChromeDriver的启动和停止。<code class="du mg mh mi lw b"><a class="ae ka" href="https://www.selenium.dev/selenium/docs/api/py/webdriver/selenium.webdriver.common.by.html" rel="noopener ugc nofollow" target="_blank">By</a></code>对支持的定位器策略集(由。ID，由。TAG_NAME，By。XPATH等)。</li><li id="99c0" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><code class="du mg mh mi lw b"><a class="ae ka" href="https://www.selenium.dev/selenium/docs/api/py/webdriver_support/selenium.webdriver.support.wait.html#selenium.webdriver.support.wait.WebDriverWait" rel="noopener ugc nofollow" target="_blank">WebDriverWait</a></code>只在需要的时候等待。</li><li id="dbff" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><code class="du mg mh mi lw b"><a class="ae ka" href="https://www.selenium.dev/selenium/docs/api/py/webdriver_support/selenium.webdriver.support.wait.html#selenium.webdriver.support.wait.WebDriverWait" rel="noopener ugc nofollow" target="_blank">expected_conditions</a></code>包含一组与WebDriverWait一起使用的预定义条件。</li><li id="5e41" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><code class="du mg mh mi lw b"><a class="ae ka" href="https://parsel.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">Selector</a></code>完全支持<a class="ae ka" href="https://en.wikipedia.org/wiki/XPath" rel="noopener ugc nofollow" target="_blank"> XPath </a>和CSS选择器的XML/HTML解析器。</li></ul><p id="02c5" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">定义字典结构:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="1d50" class="ma kh ht lw b fi mb mc l md me">google_play_apps = {<br/>    'Top charts': {<br/>        'Top free': [],<br/>        'Top grossing': [],<br/>        'Top paid': []<br/>    },<br/>}</span></pre><h1 id="de11" class="kg kh ht bd ki kj kk kl km kn ko kp kq iz kr ja ks jc kt jd ku jf kv jg kw kx bi translated">顶级代码环境</h1><p id="b99b" class="pw-post-body-paragraph ld le ht jk b jl lq iu lf jn lr ix lg jp ls li lj jr lt ll lm jt lu lo lp jv hb bi translated">在函数开始时，定义了用于生成<code class="du mg mh mi lw b">URL</code>的参数。如果您想向URL传递其他参数，可以使用<code class="du mg mh mi lw b">params</code>字典。这些参数会影响输出结果:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="97ff" class="ma kh ht lw b fi mb mc l md me">params = {<br/>    'device': 'phone',  <br/>    'hl': 'en_GB',		# language <br/>    'gl': 'US',			# country of the search<br/>}</span></pre><p id="96f0" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">接下来，URL被传递给<code class="du mg mh mi lw b">scroll_page(URL)</code>函数来滚动页面并获取所有数据。该函数返回的结果被传递给<code class="du mg mh mi lw b">scrape_all_categories(result)</code>函数以提取必要的数据。这些功能的解释将在下面相应的标题中。</p><p id="153f" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">这段代码使用了普遍接受的使用<code class="du mg mh mi lw b"><a class="ae ka" href="https://docs.python.org/3/library/__main__.html#" rel="noopener ugc nofollow" target="_blank">__name__ == "__main__"</a></code>构造的规则:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="bda5" class="ma kh ht lw b fi mb mc l md me">def scrape_google_play_apps():<br/>    params = {<br/>        'device': 'phone',  <br/>        'hl': 'en_GB',		# language <br/>        'gl': 'US',			# country of the search<br/>    }<br/>    URL = f"https://play.google.com/store/apps?device={params['device']}&amp;hl={params['hl']}&amp;gl={params['gl']}"<br/>    result = scroll_page(URL)<br/>    scrape_all_sections(result)<br/>if __name__ == "__main__":<br/>    scrape_google_play_apps()</span></pre><p id="6561" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">只有当用户运行了该文件时，才会执行该检查。如果用户将此文件导入另一个文件，则检查将不起作用。</p><p id="17b2" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">可以看视频<a class="ae ka" href="https://www.youtube.com/watch?v=sugvnHA7ElY&amp;t=1s" rel="noopener ugc nofollow" target="_blank"> Python教程:if<strong class="jk hu">name</strong>= = '<strong class="jk hu">main</strong>'</a>了解更多详情。</p><h1 id="526e" class="kg kh ht bd ki kj kk kl km kn ko kp kq iz kr ja ks jc kt jd ku jf kv jg kw kx bi translated">滚动页面</h1><p id="b4ae" class="pw-post-body-paragraph ld le ht jk b jl lq iu lf jn lr ix lg jp ls li lj jr lt ll lm jt lu lo lp jv hb bi translated">该函数获取URL并返回完整的HTML结构。</p><p id="130e" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">首先，让我们了解一下分页在Google Play Apps页面上是如何工作的。数据不会立即加载。如果用户需要更多的数据，他们只需简单地滚动页面并下载一个小数据包。</p><p id="501f" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">相应地，要获得所有数据，您需要滚动到页面的末尾。但我们将面临的问题是，在最后一次滚动时，会出现<em class="mj">显示更多</em>按钮。点击它，你会得到最后一条数据。页面滚动演示如下所示:</p><figure class="kz la lb lc fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mk"><img src="../Images/3967ba4952d1f096ae0d5728beeac787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-0309K50IbcKtrJ1.gif"/></div></div></figure><p id="7585" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">在这种情况下，使用<code class="du mg mh mi lw b"><a class="ae ka" href="https://www.selenium.dev/documentation/webdriver/" rel="noopener ugc nofollow" target="_blank">selenium</a></code> <a class="ae ka" href="https://www.selenium.dev/documentation/webdriver/" rel="noopener ugc nofollow" target="_blank">库</a>，它允许您在浏览器中模拟用户动作。要让<code class="du mg mh mi lw b">selenium</code>工作，需要使用<code class="du mg mh mi lw b"><a class="ae ka" href="https://chromedriver.chromium.org/downloads" rel="noopener ugc nofollow" target="_blank">ChromeDriver</a></code>，可以手动下载，也可以使用代码下载。</p><p id="9434" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">在我们的例子中，使用第二种方法。要控制<code class="du mg mh mi lw b">ChromeDriver</code>的启动和停止，你需要使用<code class="du mg mh mi lw b"><a class="ae ka" href="https://www.selenium.dev/selenium/docs/api/py/webdriver_chrome/selenium.webdriver.chrome.service.html" rel="noopener ugc nofollow" target="_blank">Service</a></code>，它会在引擎盖下安装浏览器二进制文件:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="6f54" class="ma kh ht lw b fi mb mc l md me">service = Service(ChromeDriverManager().install())</span></pre><p id="eece" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">您还应该添加<code class="du mg mh mi lw b">options</code>才能正常工作:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="1e63" class="ma kh ht lw b fi mb mc l md me">options = webdriver.ChromeOptions()<br/>options.add_argument('--headless')<br/>options.add_argument('--lang=en')<br/>options.add_argument('user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36')<br/>options.add_argument('--no-sandbox')</span></pre><ul class=""><li id="532e" class="ji jj ht jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><code class="du mg mh mi lw b">--headless</code>以无头模式运行Chrome。</li><li id="b164" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><code class="du mg mh mi lw b">--lang=en</code>将浏览器语言设置为英语。</li><li id="dfef" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><code class="du mg mh mi lw b">user-agent</code>作为来自浏览器的“真实”用户请求，将其传递给<a class="ae ka" href="https://docs.python-requests.org/en/master/user/quickstart/#custom-headers" rel="noopener ugc nofollow" target="_blank">请求头</a>。<a class="ae ka" href="https://www.whatismybrowser.com/detect/what-is-my-user-agent" rel="noopener ugc nofollow" target="_blank">检查你的</a>是什么<code class="du mg mh mi lw b"><a class="ae ka" href="https://www.whatismybrowser.com/detect/what-is-my-user-agent" rel="noopener ugc nofollow" target="_blank">user-agent</a></code>。</li><li id="48b1" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><code class="du mg mh mi lw b">--no-sandbox</code>让chromedriver在不同机器上正常工作。</li></ul><p id="671b" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">现在我们可以启动<code class="du mg mh mi lw b"><a class="ae ka" href="https://www.selenium.dev/documentation/webdriver/" rel="noopener ugc nofollow" target="_blank">webdriver</a></code>并将url传递给<code class="du mg mh mi lw b"><a class="ae ka" href="https://selenium-python.readthedocs.io/api.html#selenium.webdriver.remote.webdriver.WebDriver.get" rel="noopener ugc nofollow" target="_blank">get()</a></code> <a class="ae ka" href="https://selenium-python.readthedocs.io/api.html#selenium.webdriver.remote.webdriver.WebDriver.get" rel="noopener ugc nofollow" target="_blank">方法</a>。</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="0d26" class="ma kh ht lw b fi mb mc l md me">driver = webdriver.Chrome(service=service, options=options)<br/>driver.get(url)</span></pre><p id="ac39" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">页面滚动算法是如何工作的？在循环的每次迭代中，程序都会寻找按钮选择器。</p><p id="585b" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">如果按钮存在，那么程序就点击它并加载数据，然后循环结束。否则，页面向下滚动并加载数据。</p><p id="80a4" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">滚动页面和点击按钮是通过将JavaScript代码粘贴到<code class="du mg mh mi lw b"><a class="ae ka" href="https://selenium-python.readthedocs.io/api.html#selenium.webdriver.remote.webdriver.WebDriver.execute_script" rel="noopener ugc nofollow" target="_blank">execute_script()</a></code>方法中完成的。</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="51f1" class="ma kh ht lw b fi mb mc l md me">while True:<br/>    try:<br/>        driver.execute_script("document.querySelector('.snByac').click();")<br/>        WebDriverWait(driver, 10000).until(EC.visibility_of_element_located((By.TAG_NAME, 'body')))<br/>        break<br/>    except:<br/>        driver.execute_script("window.scrollTo(0, document.body.scrollHeight);")<br/>        WebDriverWait(driver, 10000).until(EC.visibility_of_element_located((By.TAG_NAME, 'body')))</span></pre><p id="d56c" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">有时很难计算加载一个页面需要多长时间，这完全取决于互联网的速度、计算机的能力和其他因素。</p><p id="ba89" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">下面描述的方法比使用以秒为单位的延迟好得多，因为等待正好发生在页面完全加载的时刻:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="c9ea" class="ma kh ht lw b fi mb mc l md me">WebDriverWait(driver, 10000).until(EC.visibility_of_element_located((By.TAG_NAME, 'body')))</span></pre><p id="dcfa" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">📌注意:在这种情况下，我们给10秒的时间来加载页面，如果它加载得更早，等待就会结束。</p><p id="572b" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">加载完所有数据后，您需要将它们传递给<code class="du mg mh mi lw b">scrape_top_charts</code>函数。该功能将在下面的相关章节中描述。在我们停止驱动程序之前提取数据是很重要的。</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="2cdd" class="ma kh ht lw b fi mb mc l md me">scrape_top_charts(driver=driver, chart='Top free', button_selector='#ct\|apps_topselling_free .ypTNYd')<br/>scrape_top_charts(driver=driver, chart='Top grossing', button_selector='#ct\|apps_topgrossing .ypTNYd')<br/>scrape_top_charts(driver=driver, chart='Top paid', button_selector='#ct\|apps_topselling_paid .ypTNYd')</span></pre><p id="7350" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">现在我们需要使用来自<code class="du mg mh mi lw b"><a class="ae ka" href="https://parsel.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">Parsel</a></code>的包来处理HTML，在这个包中，我们通过<code class="du mg mh mi lw b">HTML</code>结构来传递滚动页面后收到的所有数据。这是在下一个函数中成功检索数据所必需的。所有操作完成后，停止驱动程序:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="08fd" class="ma kh ht lw b fi mb mc l md me">selector = Selector(driver.page_source)<br/>driver.quit()</span></pre><p id="e722" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">该函数如下所示:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="dd8e" class="ma kh ht lw b fi mb mc l md me">def scroll_page(url):<br/>    service = Service(ChromeDriverManager().install())<br/>    options = webdriver.ChromeOptions()<br/>    options.add_argument("--headless")<br/>    options.add_argument("--lang=en")<br/>    options.add_argument("user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36")<br/>    options.add_argument("--no-sandbox")<br/>    driver = webdriver.Chrome(service=service, options=options)<br/>    driver.get(url)<br/>    while True:<br/>        try:<br/>            driver.execute_script("document.querySelector('.snByac').click();")<br/>            WebDriverWait(driver, 10000).until(EC.visibility_of_element_located((By.TAG_NAME, 'body')))<br/>            break<br/>        except:<br/>            driver.execute_script("window.scrollTo(0, document.body.scrollHeight);")<br/>            WebDriverWait(driver, 10000).until(EC.visibility_of_element_located((By.TAG_NAME, 'body')))<br/>    scrape_top_charts(driver=driver, chart='Top free', button_selector='#ct\|apps_topselling_free .ypTNYd')<br/>    scrape_top_charts(driver=driver, chart='Top grossing', button_selector='#ct\|apps_topgrossing .ypTNYd')<br/>    scrape_top_charts(driver=driver, chart='Top paid', button_selector='#ct\|apps_topselling_paid .ypTNYd')<br/>    <br/>    selector = Selector(driver.page_source)<br/>    driver.quit()<br/>    return selector</span></pre><h1 id="fc5a" class="kg kh ht bd ki kj kk kl km kn ko kp kq iz kr ja ks jc kt jd ku jf kv jg kw kx bi translated">勉强名列前茅</h1><p id="9a37" class="pw-post-body-paragraph ld le ht jk b jl lq iu lf jn lr ix lg jp ls li lj jr lt ll lm jt lu lo lp jv hb bi translated">该函数有3个参数:</p><ul class=""><li id="7ebb" class="ji jj ht jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><code class="du mg mh mi lw b">driver</code> -完整的HTML结构。</li><li id="578b" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><code class="du mg mh mi lw b">chart</code> -从中检索数据的图表。</li><li id="2174" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><code class="du mg mh mi lw b">button_selector</code> -按钮的选择器转到相应的图表。</li></ul><p id="b5e7" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">在GIF上，我展示了排行榜是如何工作的:</p><figure class="kz la lb lc fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mk"><img src="../Images/169837a52dbbce881543072b8a5d1361.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FvvUbQ2TEFYy7CEO.gif"/></div></div></figure><p id="58e9" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">通过按下相应的按钮来加载相应的数据。点击按钮并创建对象以检索数据的过程与我们之前在<code class="du mg mh mi lw b">scroll_page</code>函数中所做的相同:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="b185" class="ma kh ht lw b fi mb mc l md me">button = driver.find_element(By.CSS_SELECTOR, button_selector)<br/>driver.execute_script("arguments[0].click();", button)<br/>time.sleep(2)<br/>selector = Selector(driver.page_source)</span></pre><p id="f642" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">要提取必要的数据，您需要找到它们所在的选择器。在我们的例子中，这是包含所有应用程序的<code class="du mg mh mi lw b">.itIJzb</code>选择器。您需要在循环中迭代每个应用程序:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="a978" class="ma kh ht lw b fi mb mc l md me">for result in selector.css('.itIJzb'):<br/>    # data extraction will be here</span></pre><p id="ee36" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">对于每个app，提取<code class="du mg mh mi lw b">title</code>、<code class="du mg mh mi lw b">link</code>、<code class="du mg mh mi lw b">category</code>、<code class="du mg mh mi lw b">rating</code>、<code class="du mg mh mi lw b">thumbnail</code>等数据。您需要找到匹配的选择器并获取文本或属性值。</p><p id="de01" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">我想额外指出的是，<code class="du mg mh mi lw b">thumbnail</code>是从<code class="du mg mh mi lw b">srcset</code>属性中检索出来的，它的质量更好:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="c158" class="ma kh ht lw b fi mb mc l md me">title = result.css('.OnEJge::text').get()<br/>link = 'https://play.google.com' + result.css('::attr(href)').get()<br/>category = result.css('.ubGTjb .sT93pb.w2kbF:not(.K4Wkre)::text').get()<br/>rating = float(result.css('.CKzsaf .w2kbF::text').get())<br/>thumbnail = result.css('.stzEZd::attr(srcset)').get().replace(' 2x', '')</span></pre><p id="70b1" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">提取数据后，通过键将它们添加到<code class="du mg mh mi lw b">google_play_apps</code>字典中。关键是<code class="du mg mh mi lw b">сhart</code>参数的值:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="40c9" class="ma kh ht lw b fi mb mc l md me">google_play_apps['Top charts'][chart].append({<br/>    'title': title,<br/>    'link': link,<br/>    'category': category,<br/>    'rating': rating,<br/>    'thumbnail': thumbnail,<br/>})</span></pre><p id="f950" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">抓取排行榜的完整函数如下所示:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="03da" class="ma kh ht lw b fi mb mc l md me">def scrape_top_charts(driver, chart, button_selector):<br/>    button = driver.find_element(By.CSS_SELECTOR, button_selector)<br/>    driver.execute_script("arguments[0].click();", button)<br/>    time.sleep(2)<br/>    selector = Selector(driver.page_source)<br/>    for result in selector.css('.itIJzb'):<br/>        title = result.css('.OnEJge::text').get()<br/>        link = 'https://play.google.com' + result.css('::attr(href)').get()<br/>        category = result.css('.ubGTjb .sT93pb.w2kbF:not(.K4Wkre)::text').get()<br/>        rating = float(result.css('.CKzsaf .w2kbF::text').get())<br/>        thumbnail = result.css('.stzEZd::attr(srcset)').get().replace(' 2x', '')<br/>        google_play_apps['Top charts'][chart].append({<br/>            'title': title,<br/>            'link': link,<br/>            'category': category,<br/>            'rating': rating,<br/>            'thumbnail': thumbnail,<br/>        })</span></pre><ul class=""><li id="042c" class="ji jj ht jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><code class="du mg mh mi lw b"><a class="ae ka" href="https://parsel.readthedocs.io/en/latest/usage.html#using-selectors" rel="noopener ugc nofollow" target="_blank">css()</a></code>通过传递的选择器来访问元素。</li><li id="5688" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><code class="du mg mh mi lw b"><a class="ae ka" href="https://github.com/scrapy/parsel/blob/90397dcd0b2c1cbb91e44f65c50f9e11628ba028/parsel/csstranslator.py#L48-L51" rel="noopener ugc nofollow" target="_blank">::text</a></code> <a class="ae ka" href="https://github.com/scrapy/parsel/blob/90397dcd0b2c1cbb91e44f65c50f9e11628ba028/parsel/csstranslator.py#L48-L51" rel="noopener ugc nofollow" target="_blank">或</a> <code class="du mg mh mi lw b"><a class="ae ka" href="https://github.com/scrapy/parsel/blob/90397dcd0b2c1cbb91e44f65c50f9e11628ba028/parsel/csstranslator.py#L48-L51" rel="noopener ugc nofollow" target="_blank">::attr(&lt;attribute&gt;)</a></code>从节点中提取文本或属性数据。</li><li id="476f" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><code class="du mg mh mi lw b"><a class="ae ka" href="https://parsel.readthedocs.io/en/latest/usage.html#usage" rel="noopener ugc nofollow" target="_blank">get()</a></code>实际提取文本数据。</li><li id="c74b" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><code class="du mg mh mi lw b"><a class="ae ka" href="https://docs.python.org/3/library/functions.html#float" rel="noopener ugc nofollow" target="_blank">float()</a></code>从字符串值生成浮点数。</li><li id="1387" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><code class="du mg mh mi lw b"><a class="ae ka" href="https://docs.python.org/3/library/stdtypes.html#str.replace" rel="noopener ugc nofollow" target="_blank">replace()</a></code>用没有额外元素的新子字符串替换所有出现的旧子字符串。</li></ul><p id="f6ba" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">在<code class="du mg mh mi lw b">scroll_page</code>函数中，我们调用此函数3次，以从<em class="mj">最高免费</em>、<em class="mj">最高票房</em>和<em class="mj">最高付费</em>部分中检索数据。</p><h1 id="1ba8" class="kg kh ht bd ki kj kk kl km kn ko kp kq iz kr ja ks jc kt jd ku jf kv jg kw kx bi translated">刮去所有部分</h1><p id="eeec" class="pw-post-body-paragraph ld le ht jk b jl lq iu lf jn lr ix lg jp ls li lj jr lt ll lm jt lu lo lp jv hb bi translated">该函数采用完整的HTML结构，并以JSON格式打印所有结果。</p><p id="661d" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">要从所有部分检索数据，您需要找到该部分的<code class="du mg mh mi lw b">section</code>选择器。您需要迭代循环中的每个部分:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="a1ac" class="ma kh ht lw b fi mb mc l md me">for section in selector.css('section'):<br/>    # data extraction will be here</span></pre><p id="a862" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">有必要提取<code class="du mg mh mi lw b">section_title</code>并使其成为<code class="du mg mh mi lw b">google_play_apps</code>字典中的一个键，稍后将添加每个应用程序的提取数据列表:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="9430" class="ma kh ht lw b fi mb mc l md me">section_title = section.css('.kcen6d span::text').get()<br/>google_play_apps[section_title] = []</span></pre><p id="d824" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">每个部分都有一定数量的应用程序，它们也需要使用<code class="du mg mh mi lw b">.UVEnyf</code>选择器在另一个循环中迭代:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="bcb5" class="ma kh ht lw b fi mb mc l md me">for app in section.css('.UVEnyf'):<br/>    # data extraction will be here</span></pre><p id="9bf2" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">对于分段应用程序，没有<code class="du mg mh mi lw b">categories</code>这样的参数。其他选择器也检索数据。</p><p id="0cd6" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">还有就是<code class="du mg mh mi lw b">rating</code>提取略有不同。事实是，对于一些游戏，评级是不显示的。在这种情况下，使用一个<a class="ae ka" href="https://docs.python.org/3/reference/expressions.html#conditional-expressions" rel="noopener ugc nofollow" target="_blank">三元表达式</a>，它提取数据的数值，如果有的话:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="0c73" class="ma kh ht lw b fi mb mc l md me">title = app.css('.Epkrse::text').get()<br/>link = 'https://play.google.com' + app.css('.Si6A0c::attr(href)').get()<br/>rating = app.css('.LrNMN::text').get()<br/>rating = float(rating) if rating else rating<br/>thumbnail = app.css('.Q8CSx::attr(srcset)').get().replace(' 2x', '')</span></pre><p id="7331" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">抓取所有类别的完整函数如下所示:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="5772" class="ma kh ht lw b fi mb mc l md me">def scrape_all_sections(selector):	<br/>    for section in selector.css('section'):<br/>        section_title = section.css('.kcen6d span::text').get()<br/>        google_play_apps[section_title] = []<br/>        for app in section.css('.UVEnyf'):<br/>            title = app.css('.Epkrse::text').get()<br/>            link = 'https://play.google.com' + app.css('.Si6A0c::attr(href)').get()<br/>            rating = app.css('.LrNMN::text').get()<br/>            rating = float(rating) if rating else rating<br/>            thumbnail = app.css('.Q8CSx::attr(srcset)').get().replace(' 2x', '')<br/>            google_play_apps[section_title].append({<br/>                'title': title,<br/>                'link': link,<br/>                'rating': rating,<br/>                'thumbnail': thumbnail,<br/>            })<br/>    <br/>    print(json.dumps(google_play_apps, indent=2, ensure_ascii=False))</span></pre><p id="30dd" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">输出:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="a9d4" class="ma kh ht lw b fi mb mc l md me">{<br/>  "Top charts": {<br/>    "Top free": [<br/>      {<br/>        "title": "Disney+",<br/>        "link": "https://play.google.com/store/apps/details?id=com.disney.disneyplus",<br/>        "category": "Entertainment",<br/>        "rating": 4.5,<br/>        "thumbnail": "https://play-lh.googleusercontent.com/xoGGYH2LgLibLDBoxMg-ZE16b-RNfITw_OgXBWRAPin2FZY4FGB9QKBYApR-0rSCkQ=s128-rw"<br/>      },<br/>      ... other apps<br/>    ],<br/>    "Top grossing": [<br/>      {<br/>        "title": "Google One",<br/>        "link": "https://play.google.com/store/apps/details?id=com.google.android.apps.subscriptions.red",<br/>        "category": "Productivity",<br/>        "rating": 4.3,<br/>        "thumbnail": "https://play-lh.googleusercontent.com/DGAleS46qOedNzJGsB3e29QLpL6Qi6EwIDze95nBvxMAMGEmbE6KOW__2haEkHVDs4Y=s128-rw"<br/>      },<br/>      ... other apps<br/>    ],<br/>    "Top paid": [<br/>      {<br/>        "title": "Muscle Trigger Point Anatomy",<br/>        "link": "https://play.google.com/store/apps/details?id=com.real.bodywork.muscle.trigger.points",<br/>        "category": "Medical",<br/>        "rating": 4.6,<br/>        "thumbnail": "https://play-lh.googleusercontent.com/dX8bDLm4Aq0vF131uvjJO83EghJ9fIPIEfgLdcXwUXF7iZnpxkR53uy94H9FHocJRQ=s128-rw"<br/>      },<br/>      ... other apps<br/>    ]<br/>  },<br/>  "Popular apps": [<br/>    {<br/>      "title": "WhatsApp Messenger",<br/>      "link": "https://play.google.com/store/apps/details?id=com.whatsapp",<br/>      "rating": 4.3,<br/>      "thumbnail": "https://play-lh.googleusercontent.com/bYtqbOcTYOlgc6gqZ2rwb8lptHuwlNE75zYJu6Bn076-hTmvd96HH-6v7S0YUAAJXoJN=s512-rw"<br/>    },<br/>    ... other apps<br/>  ],<br/>  ... other sections<br/>  "Book a getaway": [<br/>    {<br/>      "title": "Hotels.com: Book Hotels &amp; More",<br/>      "link": "https://play.google.com/store/apps/details?id=com.hcom.android",<br/>      "rating": 4.4,<br/>      "thumbnail": "https://play-lh.googleusercontent.com/onuxspmiR0fJZRWXZCToyBPht5yZE55drqWqoWWDj9YwJvKpg2AY4lt1LdymRYkRlh0=s512-rw"<br/>    },<br/>    ... other apps<br/>  ]<br/>}</span></pre><h1 id="85c2" class="kg kh ht bd ki kj kk kl km kn ko kp kq iz kr ja ks jc kt jd ku jf kv jg kw kx bi translated">从SerpApi使用Google Play应用商店API</h1><p id="6071" class="pw-post-body-paragraph ld le ht jk b jl lq iu lf jn lr ix lg jp ls li lj jr lt ll lm jt lu lo lp jv hb bi translated">这一部分将展示DIY解决方案和我们的解决方案之间的比较。</p><p id="1874" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">主要区别在于这是一种更快的方法。<a class="ae ka" href="https://serpapi.com/google-play-apps" rel="noopener ugc nofollow" target="_blank"> Google Play应用商店API </a>将绕过搜索引擎的拦截，你不必从头开始创建解析器并维护它。</p><p id="ae62" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">首先，我们需要安装<code class="du mg mh mi lw b"><a class="ae ka" href="https://pypi.org/project/google-search-results/" rel="noopener ugc nofollow" target="_blank">google-search-results</a></code>:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="80a9" class="ma kh ht lw b fi mb mc l md me">pip install google-search-results</span></pre><p id="2909" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">导入工作所需的库:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="9d40" class="ma kh ht lw b fi mb mc l md me">from serpapi import GoogleSearch<br/>import os, json</span></pre><p id="6f99" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">接下来，我们编写一个搜索查询和发出请求所需的参数:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="3b9f" class="ma kh ht lw b fi mb mc l md me">params = {<br/>    # https://docs.python.org/3/library/os.html#os.getenv<br/>    'api_key': os.getenv('API_KEY'),    # your serpapi api<br/>    'engine': 'google_play',			# SerpApi search engine<br/>    'store': 'apps'						# Google Play Apps<br/>}</span></pre><p id="e1aa" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">然后我们创建一个<code class="du mg mh mi lw b">search</code>对象，从SerpApi后端获取数据。在<code class="du mg mh mi lw b">result_dict</code>字典中，我们从JSON获得数据:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="75cf" class="ma kh ht lw b fi mb mc l md me">search = GoogleSearch(params)<br/>result_dict = search.get_dict()</span></pre><p id="b16f" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">数据检索非常简单，我们只需打开<code class="du mg mh mi lw b">'organic_results'</code>键:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="fa2c" class="ma kh ht lw b fi mb mc l md me">google_play_apps = result_dict['organic_results']</span></pre><p id="6551" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">要集成的示例代码:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="3a15" class="ma kh ht lw b fi mb mc l md me">from serpapi import GoogleSearch<br/>import os, json<br/>params = {<br/>    # https://docs.python.org/3/library/os.html#os.getenv<br/>    'api_key': os.getenv('API_KEY'),    # your serpapi api<br/>    'engine': 'google_play',			# SerpApi search engine<br/>    'store': 'apps'						# Google Play Apps<br/>}<br/>search = GoogleSearch(params)           # where data extraction happens on the SerpApi backend<br/>result_dict = search.get_dict()         # JSON -&gt; Python dict<br/>google_play_apps = result_dict['organic_results']<br/>print(json.dumps(google_play_apps, indent=2, ensure_ascii=False))</span></pre><p id="bdb9" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">输出:</p><pre class="kz la lb lc fd lv lw lx ly aw lz bi"><span id="d903" class="ma kh ht lw b fi mb mc l md me">[<br/>  {<br/>    "title": "Popular apps",<br/>    "items": [<br/>      {<br/>        "title": "WhatsApp Messenger",<br/>        "link": "https://play.google.com/store/apps/details?id=com.whatsapp",<br/>        "product_id": "com.whatsapp",<br/>        "serpapi_link": "https://serpapi.com/search.json?engine=google_play_product&amp;gl=us&amp;hl=en&amp;product_id=com.whatsapp&amp;store=apps",<br/>        "rating": 4.3,<br/>        "thumbnail": "https://play-lh.googleusercontent.com/bYtqbOcTYOlgc6gqZ2rwb8lptHuwlNE75zYJu6Bn076-hTmvd96HH-6v7S0YUAAJXoJN=s256"<br/>      },<br/>      ... other items<br/>      {<br/>        "title": "Zoom - One Platform to Connect",<br/>        "link": "https://play.google.com/store/apps/details?id=us.zoom.videomeetings",<br/>        "product_id": "us.zoom.videomeetings",<br/>        "serpapi_link": "https://serpapi.com/search.json?engine=google_play_product&amp;gl=us&amp;hl=en&amp;product_id=us.zoom.videomeetings&amp;store=apps",<br/>        "rating": 4.3,<br/>        "thumbnail": "https://play-lh.googleusercontent.com/yZsmiNjmji3ZoOuLthoVvptLB9cZ0vCmitcky4OUXNcEFV3IEQkrBD2uu5kuWRF5_ERA=s256"<br/>      }<br/>    ]<br/>  },<br/>  ... other sections<br/>  {<br/>    "title": "Communication",<br/>    "items": [<br/>      {<br/>        "title": "Google Voice",<br/>        "link": "https://play.google.com/store/apps/details?id=com.google.android.apps.googlevoice",<br/>        "product_id": "com.google.android.apps.googlevoice",<br/>        "serpapi_link": "https://serpapi.com/search.json?engine=google_play_product&amp;gl=us&amp;hl=en&amp;product_id=com.google.android.apps.googlevoice&amp;store=apps",<br/>        "rating": 4.4,<br/>        "thumbnail": "https://play-lh.googleusercontent.com/Gf8ufuFbtfXO5Y6JuZjnG0iIpZh21zNTqZ5aiAXO8mA38mvXzY-1s27FWbGlp51paQ=s256"<br/>      },<br/>      ... other items<br/>      {<br/>        "title": "Email - Fast &amp; Secure Mail",<br/>        "link": "https://play.google.com/store/apps/details?id=com.easilydo.mail",<br/>        "product_id": "com.easilydo.mail",<br/>        "serpapi_link": "https://serpapi.com/search.json?engine=google_play_product&amp;gl=us&amp;hl=en&amp;product_id=com.easilydo.mail&amp;store=apps",<br/>        "rating": 4.6,<br/>        "thumbnail": "https://play-lh.googleusercontent.com/WvlTOWc59NcVtCfnxMjNZIG2mRHrjMNadTU7dnN2oA3UwT6tz70KodnLOwiimwc49Obx=s256"<br/>      }<br/>    ]<br/>  }<br/>]</span></pre><h1 id="d98a" class="kg kh ht bd ki kj kk kl km kn ko kp kq iz kr ja ks jc kt jd ku jf kv jg kw kx bi translated">链接</h1><ul class=""><li id="5ccf" class="ji jj ht jk b jl lq jn lr jp ml jr mm jt mn jv jw jx jy jz bi translated"><a class="ae ka" href="https://replit.com/@chukhraiartur/blog-google-play-apps#main.py" rel="noopener ugc nofollow" target="_blank">在线IDE中的代码</a></li><li id="d896" class="ji jj ht jk b jl kb jn kc jp kd jr ke jt kf jv jw jx jy jz bi translated"><a class="ae ka" href="https://serpapi.com/google-play-apps" rel="noopener ugc nofollow" target="_blank"> Google Play应用商店API </a></li></ul><p id="1250" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">加入我们的推特<a class="ae ka" href="https://twitter.com/serp_api" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae ka" href="https://www.youtube.com/channel/UCUgIHlYBOD3yA3yDIRhg_mg" rel="noopener ugc nofollow" target="_blank"> YouTube </a></p><p id="9c72" class="pw-post-body-paragraph ld le ht jk b jl jm iu lf jn jo ix lg jp lh li lj jr lk ll lm jt ln lo lp jv hb bi translated">添加一个<a class="ae ka" href="https://github.com/serpapi/public-roadmap/issues" rel="noopener ugc nofollow" target="_blank">特征请求</a>💫还是一只<a class="ae ka" href="https://github.com/serpapi/public-roadmap/issues" rel="noopener ugc nofollow" target="_blank">虫</a>🐞</p></div></div>    
</body>
</html>