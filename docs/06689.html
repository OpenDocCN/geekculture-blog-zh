<html>
<head>
<title>Instagram-clone Backend Part-1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">insta gram-克隆后端第1部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/instagram-clone-backend-part-1-d2de321f1ddd?source=collection_archive---------6-----------------------#2021-08-26">https://medium.com/geekculture/instagram-clone-backend-part-1-d2de321f1ddd?source=collection_archive---------6-----------------------#2021-08-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/43c5a62d2c4d1844a0a1db7303e352b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GjFC4JTXVkBRPeOMSEv3Nw.png"/></div></div></figure><p id="303f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们使用express、socket.io和MongoDB构建一个Instagram克隆</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="7989" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jv">特征</em> </strong></p><ul class=""><li id="9ec7" class="jw jx hi is b it iu ix iy jb jy jf jz jj ka jn kb kc kd ke bi translated">证明</li><li id="9ec2" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">邮政</li><li id="100f" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">喜欢帖子</li><li id="2842" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">私聊</li><li id="77b1" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">实时通知</li></ul><h1 id="f3aa" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak"> <em class="li">快速链接</em> </strong></h1><div class="lj lk ez fb ll lm"><a href="https://github.com/charanpy/instagram-clone-API" rel="noopener  ugc nofollow" target="_blank"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hj fi z dy lr ea eb ls ed ef hh bi translated">GitHub-char anpy/insta gram-clone-API:insta gram克隆后端API</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">Instagram克隆后端API。在GitHub上创建一个帐户，为charanpy/instagram-clone-API开发做贡献。</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">github.com</p></div></div><div class="lv l"><div class="lw l lx ly lz lv ma io lm"/></div></div></a></div><div class="lj lk ez fb ll lm"><a href="https://github.com/charanpy/Instagram-react" rel="noopener  ugc nofollow" target="_blank"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hj fi z dy lr ea eb ls ed ef hh bi translated">GitHub-char anpy/insta gram-React:insta gram-clone React</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">insta gram-克隆反应。在GitHub上创建一个帐户，为charanpy/Instagram-react开发做出贡献。</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">github.com</p></div></div><div class="lv l"><div class="mb l lx ly lz lv ma io lm"/></div></div></a></div><div class="lj lk ez fb ll lm"><a href="https://github.com/charanpy/ReactNative-InstagramClone" rel="noopener  ugc nofollow" target="_blank"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hj fi z dy lr ea eb ls ed ef hh bi translated">GitHub-char anpy/React Native-InstagramClone:InstagramClone-React-Native(Expo)</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">insta gram-clone-React-Native(Expo)。为char anpy/reactinative-InstagramClone的发展作出贡献，创造一个…</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">github.com</p></div></div><div class="lv l"><div class="mc l lx ly lz lv ma io lm"/></div></div></a></div><p id="22c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这一部分，我们将</p><ol class=""><li id="340b" class="jw jx hi is b it iu ix iy jb jy jf jz jj ka jn md kc kd ke bi translated">创建项目</li><li id="f23c" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn md kc kd ke bi translated">使用Node.js和express.js设置服务器</li><li id="9594" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn md kc kd ke bi translated">创建模式</li><li id="edbf" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn md kc kd ke bi translated">证明</li></ol><h1 id="448c" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak"> <em class="li">创建项目:</em> </strong></h1><pre class="me mf mg mh fd mi mj mk ml aw mm bi"><span id="751a" class="mn kl hi mj b fi mo mp l mq mr">mkdir instagram-clone<br/>cd instagram-clone</span><span id="f544" class="mn kl hi mj b fi ms mp l mq mr">npm init -y<br/>npm install mongoose bcryptjs jsonwebtoken express cors dotenv socket.io validator express-validator</span></pre><h1 id="bf0a" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">文件夹结构</strong></h1><p id="f06c" class="pw-post-body-paragraph iq ir hi is b it mt iv iw ix mu iz ja jb mv jd je jf mw jh ji jj mx jl jm jn hb bi translated">创建app.js和server.js文件<em class="jv">(文件)</em></p><p id="5dba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建实用程序、控制器、模型和路线文件夹<em class="jv">(文件夹)</em></p><figure class="me mf mg mh fd ij er es paragraph-image"><div class="er es my"><img src="../Images/0e66dab86e76d8bd24dda76c1c6f758a.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*lt9QSvor6P41Z1selukTXA.png"/></div></figure><p id="62ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在app.js</p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mz na l"/></div></figure><p id="8bab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在server.js</p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mz na l"/></div></figure><p id="7cba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在。使用MongoDB atlas复制并粘贴您的MongoDB Uri</p><h1 id="3580" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak"> <em class="li">定义模式</em> </strong></h1><p id="d2a2" class="pw-post-body-paragraph iq ir hi is b it mt iv iw ix mu iz ja jb mv jd je jf mw jh ji jj mx jl jm jn hb bi translated">对于此克隆，我们将为以下各项创建模式</p><ul class=""><li id="a2ba" class="jw jx hi is b it iu ix iy jb jy jf jz jj ka jn kb kc kd ke bi translated">用户</li><li id="7a60" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">轮廓</li><li id="7ee7" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">邮政</li><li id="814d" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">组</li><li id="f47e" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">信息</li></ul><p id="0338" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> User.js </strong></p><p id="4d1e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在模型文件夹内创建User.js</p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mz na l"/></div></figure><p id="79af" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，我们已经用必需的验证器定义了用户模式中的数据结构。</p><p id="0409" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">前置和后置是使用的中间件。</p><p id="e2a4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">前置中间件在挂钩方法之前执行。在保存之前，我们使用bcryptjs加密普通密码</p><p id="9ac2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在挂钩方法之后<em class="jv">执行post中间件。创建用户后，我们将为新创建的用户创建一个配置文件。</em></p><p id="e030" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jv"> Profile.js </em> </strong></p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mz na l"/></div></figure><p id="a442" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jv"> Post.js </em> </strong></p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mz na l"/></div></figure><p id="7022" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，我们从标题中提取hashtags，并将它们存储为数组。</p><p id="d122" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">T35】group . jsT37】</strong></p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mz na l"/></div></figure><p id="6b57" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建用于私人(一对一)和公共对话的群组。</p><p id="8d20" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每当通过填充概要文件中的用户字段从该模式中检索数据时，pre中间件中的Find hook就会运行。</p><p id="7261" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jv"> Message.js </em> </strong></p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mz na l"/></div></figure><h1 id="d86a" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">认证</strong></h1><p id="6c6b" class="pw-post-body-paragraph iq ir hi is b it mt iv iw ix mu iz ja jb mv jd je jf mw jh ji jj mx jl jm jn hb bi translated">为用户验证创建控制器和路由文件</p><p id="1e39" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jv"> userRoute.js </em> </strong></p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mz na l"/></div></figure><p id="fea4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，我们为登录、注册(/signup)和显示当前已验证的用户(/me)创建了一个路由</p><p id="2f49" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">express-validator是一个中间件，用于净化和验证用户输入。</p><p id="546a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们定义一下我们的<strong class="is hj"> <em class="jv">控制器</em> </strong></p><p id="03b0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用JSON web token实现身份验证。</p><p id="08b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们为jwt创建一些有用的函数</p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mz na l"/></div></figure><p id="22c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，我们创建了用于生成和验证jwt的函数。</p><p id="11dc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">JWT由三部分组成</p><ul class=""><li id="a7d6" class="jw jx hi is b it iu ix iy jb jy jf jz jj ka jn kb kc kd ke bi translated">标头—关于令牌的元数据(例如:签名算法)</li><li id="2ef8" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">有效负载—我们编码的数据(例如:用户id、用户名、角色等)</li><li id="c343" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">签名—使用报头、有效负载和密码创建</li></ul><p id="8c65" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jv"> protect是一个为每一个被保护的路由访问</em> </strong>运行的中间件</p><p id="5ce0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在protect中，我们检查标头中的标记，如果没有标记，我们将抛出一个错误。如果令牌存在，我们检查令牌是否有效。</p><figure class="me mf mg mh fd ij er es paragraph-image"><div class="er es nb"><img src="../Images/d8e7a4c61877a29b6ded3eef10795e09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*3jQ5df7syW_W86JOaxD-3A.png"/></div></figure><figure class="me mf mg mh fd ij er es paragraph-image"><div class="er es nc"><img src="../Images/ccd59f5e64eafde828ad986c80596322.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*R4t0SjbKBqUkJK4xZnRbeg.png"/></div><figcaption class="nd ne et er es nf ng bd b be z dx">signing algorithm</figcaption></figure><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mz na l"/></div></figure><p id="b4fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在app.js中包含用户路由器</p><p id="3b41" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">app.use('/api/v1/users '，userRoute)</p><p id="52fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">先来说说<strong class="is hj"> <em class="jv"> DB设计</em> </strong></p><p id="562e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为什么我们需要在概要模式 中存储<strong class="is hj"> <em class="jv">附加用户信息？</em></strong></p><p id="9a3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这取决于我们存储在数据库中的数据量。如果我们需要存储额外的3个字段，那么我们可以直接将它们存储在用户模式中。但是，如果我们需要存储更多的字段，为概要文件创建一个单独的模式是一个更好的主意。</p><p id="c242" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过为概要文件创建一个单独的模式，我们<strong class="is hj"> <em class="jv">将授权与用户信息</em> </strong>分开。个人资料经常需要更新，所以我们让用户知道，我们不会对任何用户的授权字段进行更改，如电子邮件和密码。这种方法的缺点是我们需要为每个用户创建一个额外的<strong class="is hj"> <em class="jv">文档</em> </strong>，并且我们需要维护用户和概要文件 之间的<strong class="is hj"> <em class="jv">关系</em></strong></p><p id="5087" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jv">如同图式对于帖子</em> </strong></p><p id="a292" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的Post模式中，我们将likes存储为数组。但这不是实现类似系统的好方法。假设，如果我们需要像DB一样添加或删除需要处理数组中的所有项。</p><p id="4ad1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一个可能的解决方案是创建一个新的like模式，用两个关系将like连接到用户id，并将Like连接到帖子id</p><p id="2a72" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为评论/消息扩展like模式</p><p id="7444" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这种情况下，我们可以为注释创建一个单独的模式，或者我们可以扩展like模式以支持如下注释:</p><figure class="me mf mg mh fd ij er es paragraph-image"><div class="er es nh"><img src="../Images/f05dd1d07c77ed7f4338a0f58c2ff9fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*HVcfiPptE_zuTS-6XKXaJw.png"/></div></figure><p id="97bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，我们建立了模式和认证。让我们继续下一部分</p></div></div>    
</body>
</html>