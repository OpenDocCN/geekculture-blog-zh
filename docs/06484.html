<html>
<head>
<title>Predicting a death because of heart failure using Decision Tree Classifier</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用决策树分类器预测心力衰竭死亡</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/predicting-a-death-because-of-heart-failure-using-decision-tree-classifier-2e56caf6fc1a?source=collection_archive---------11-----------------------#2021-08-21">https://medium.com/geekculture/predicting-a-death-because-of-heart-failure-using-decision-tree-classifier-2e56caf6fc1a?source=collection_archive---------11-----------------------#2021-08-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d3c10cb0e50191d9dbfc3d1b093606a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e2BEJl2RszUpty2vjqWx_w.png"/></div></div></figure><h1 id="90ec" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">目标</h1><p id="e369" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">以预测在人心力衰竭的情况下可能的死亡事件。这是使用决策树分类器进行学习的尝试，可以帮助初学者提高他/她对处理这种机器学习算法的理解。</p><h1 id="2fb1" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">数据来源</h1><p id="aeb6" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我们将使用在<a class="ae km" href="https://www.kaggle.com/andrewmvd/heart-failure-clinical-data" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上可用的公共数据集。我们将使用jovian开发的<a class="ae km" href="https://github.com/JovianML/opendatasets" rel="noopener ugc nofollow" target="_blank"> opendatasets库</a>来下载数据集</p><h1 id="3813" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">要执行的主要步骤</h1><ul class=""><li id="95a7" class="kn ko hi jq b jr js jv jw jz kp kd kq kh kr kl ks kt ku kv bi translated">下载数据</li><li id="9128" class="kn ko hi jq b jr kw jv kx jz ky kd kz kh la kl ks kt ku kv bi translated">设置库</li><li id="a046" class="kn ko hi jq b jr kw jv kx jz ky kd kz kh la kl ks kt ku kv bi translated">执行基本分析</li><li id="0907" class="kn ko hi jq b jr kw jv kx jz ky kd kz kh la kl ks kt ku kv bi translated">分离训练和测试装置</li><li id="16c3" class="kn ko hi jq b jr kw jv kx jz ky kd kz kh la kl ks kt ku kv bi translated">火车模型</li><li id="1285" class="kn ko hi jq b jr kw jv kx jz ky kd kz kh la kl ks kt ku kv bi translated">预测</li><li id="c7ae" class="kn ko hi jq b jr kw jv kx jz ky kd kz kh la kl ks kt ku kv bi translated">作为API发布和公开</li></ul></div><div class="ab cl lb lc gp ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="hb hc hd he hf"><h1 id="1632" class="iq ir hi bd is it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn bi translated">下载数据集并设置所有库</h1><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="5c5a" class="lw ir hi ls b fi lx ly l lz ma">import opendatasets as od<br/>import os</span><span id="2638" class="lw ir hi ls b fi mb ly l lz ma">dataset_url = '<a class="ae km" href="https://www.kaggle.com/andrewmvd/heart-failure-clinical-data'" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/andrewmvd/heart-failure-clinical-data'</a><br/>od.download(dataset_url)</span><span id="0a49" class="lw ir hi ls b fi mb ly l lz ma">data_dir = os.listdir()[1]<br/>filename = os.listdir("./heart-failure-clinical-data")[0]<br/>file_path = "./" + data_dir + "/" + filename</span></pre><p id="f515" class="pw-post-body-paragraph jo jp hi jq b jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh mg kj kk kl hb bi translated">设置库并将数据加载到pandas数据框架中</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="bcbe" class="lw ir hi ls b fi lx ly l lz ma">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns</span><span id="a323" class="lw ir hi ls b fi mb ly l lz ma">%matplotlib inline <br/>sns.set_theme(style = "darkgrid")<br/>sns.set_context("paper")<br/>plt.figure(figsize=(8,6))</span><span id="1794" class="lw ir hi ls b fi mb ly l lz ma">#pd.set_option('display.max_rows', 500)<br/>pd.set_option('display.max_columns', 500)<br/>pd.set_option('display.width', 1000)</span><span id="53c9" class="lw ir hi ls b fi mb ly l lz ma">raw_heart_df = pd.read_csv(file_path)</span></pre><p id="8a53" class="pw-post-body-paragraph jo jp hi jq b jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh mg kj kk kl hb bi translated">下面是从我的google colab笔记本上截取的样本结果</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/f14022563dd05221cc499d3f6b7407ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SxdN9RodskwfTjpzsSUbKA.png"/></div></div><figcaption class="mi mj et er es mk ml bd b be z dx">Outcome of raw dataframe created out of the dataset</figcaption></figure><h1 id="9694" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">为理解数据而执行的基本可视化</h1><div class="ln lo lp lq fd ab cb"><figure class="mm ij mn mo mp mq mr paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/53111d516a7c886186a20213faca0c61.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*xET9NonyiabqtxYaN94aKA.png"/></div></figure><figure class="mm ij ms mo mp mq mr paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/9172e6ec0437826dd998c47faac9f2a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:556/format:webp/1*TlwVGzhMx_sGwpQjC1skpA.png"/></div></figure><figure class="mm ij mt mo mp mq mr paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/5360d7ca9d9dabe026dc7a4710377852.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*cX5fkhB_ogZrDz4rCJet3Q.png"/></div></figure></div><div class="ab cb"><figure class="mm ij mu mo mp mq mr paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/4f7445b60b095ccc4e0e9dfe826040e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*iQjlLU_nML_Ix5IpCAakRQ.png"/></div></figure><figure class="mm ij mu mo mp mq mr paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/ede26a3804aef0a49cfcfde856be7878.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*AVroOEo_yQq4dVYLEMMt4Q.png"/></div></figure><figure class="mm ij mv mo mp mq mr paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/a8f530fe80092dbff097422cffc9696a.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*SR_8843KGXCmZEN_8bQrZQ.png"/></div></figure></div><div class="ab cb"><figure class="mm ij mw mo mp mq mr paragraph-image"><img src="../Images/9aca8be5cdeeda2707772f588f5641f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*4n2Fcz_stgRglF4MjSC-Tw.png"/></figure><figure class="mm ij mx mo mp mq mr paragraph-image"><img src="../Images/d22f640488c81e3a5db7c44b08c5a814.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*joWFULU_dr4F5LaydtAdUg.png"/><figcaption class="mi mj et er es mk ml bd b be z dx my di mz na">Various visualizations performed to understand relationship and patterns in the data</figcaption></figure></div><h1 id="9daa" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">让我们确定所有特征之间的相关性</h1><p id="1a9c" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">让我们确定每个特征之间的关联，然后绘制一个热图</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="4cf2" class="lw ir hi ls b fi lx ly l lz ma">plt.figure(figsize = (15,8))<br/>sns.heatmap(raw_heart_df.corr(), annot=True)</span></pre><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nb"><img src="../Images/33b01e992b4af485602599783f8b3610.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p1nLjZMhdmubwiJkG507IQ.png"/></div></div><figcaption class="mi mj et er es mk ml bd b be z dx">heatmap of correlation</figcaption></figure><h1 id="d3fb" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">为培训准备数据</h1><ul class=""><li id="cfba" class="kn ko hi jq b jr js jv jw jz kp kd kq kh kr kl ks kt ku kv bi translated">在训练、验证和测试数据集中拆分数据</li><li id="f0f4" class="kn ko hi jq b jr kw jv kx jz ky kd kz kh la kl ks kt ku kv bi translated">分离特征和目标标签</li></ul><p id="1978" class="pw-post-body-paragraph jo jp hi jq b jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh mg kj kk kl hb bi translated">我们的目标标签是DEATH_EVENT，特征是数据集中可用的所有其他参数。请注意，基于适当的分析和专家建议，我们可以删除领域专家认为对心力衰竭没有影响的某些列，但由于我们没有任何列，我们将继续用所有可用的特征训练我们的模型。</p><h1 id="e817" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">用哪个型号？</h1><p id="f853" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">这是一个分类问题，我们需要检测患者是否会死亡(1)或不会死亡(0)。分类问题有多种算法-</p><ul class=""><li id="541b" class="kn ko hi jq b jr mc jv md jz nc kd nd kh ne kl ks kt ku kv bi translated">逻辑回归</li><li id="b803" class="kn ko hi jq b jr kw jv kx jz ky kd kz kh la kl ks kt ku kv bi translated">KNN算法</li><li id="e53a" class="kn ko hi jq b jr kw jv kx jz ky kd kz kh la kl ks kt ku kv bi translated">决策树</li><li id="a056" class="kn ko hi jq b jr kw jv kx jz ky kd kz kh la kl ks kt ku kv bi translated">随机森林</li></ul><p id="499a" class="pw-post-body-paragraph jo jp hi jq b jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh mg kj kk kl hb bi translated">我们将首先使用决策树来训练模型，看看它在准确性方面如何工作。</p><h1 id="53be" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">准备数据</h1><p id="d042" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">准备数据可以有多种活动，如-</p><ul class=""><li id="38ed" class="kn ko hi jq b jr mc jv md jz nc kd nd kh ne kl ks kt ku kv bi translated">通过替换均值、众数等清除缺失值。或者通过移除行</li><li id="5b7d" class="kn ko hi jq b jr kw jv kx jz ky kd kz kh la kl ks kt ku kv bi translated">分离特征和标签</li><li id="9519" class="kn ko hi jq b jr kw jv kx jz ky kd kz kh la kl ks kt ku kv bi translated">如果不同列中的数值相差很大，可能会影响误差计算，请执行缩放</li><li id="fc93" class="kn ko hi jq b jr kw jv kx jz ky kd kz kh la kl ks kt ku kv bi translated">分离训练、测试和验证数据</li></ul><p id="5a72" class="pw-post-body-paragraph jo jp hi jq b jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh mg kj kk kl hb bi translated">我们有一个非常小的数据集，没有缺失数据，因此我们不需要对缺失值执行任何操作。我们将执行上述所有其他活动</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="f47e" class="lw ir hi ls b fi lx ly l lz ma"># X -&gt; Dataset with features, y = target column or label</span><span id="1eea" class="lw ir hi ls b fi mb ly l lz ma">X = raw_heart_df.drop('DEATH_EVENT', axis = 1)<br/>y = raw_heart_df['DEATH_EVENT']<br/>print("Shape of X - ", X.shape)<br/>print("Shape of y - ", y.shape)<br/>print("Type of X - ", type(X))<br/>print("Type of y - ", type(y))</span></pre><h1 id="6a61" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">拆分训练集和测试集中的数据</h1><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="c666" class="lw ir hi ls b fi lx ly l lz ma">from sklearn.model_selection import train_test_split</span><span id="c31f" class="lw ir hi ls b fi mb ly l lz ma">X_train, X_test, y_train, y_test = train_test_split(X, y, random_state = 42, test_size = 0.2)</span><span id="ee2b" class="lw ir hi ls b fi mb ly l lz ma">print("Type of X_train - ", type(X_train))<br/>print("Type of X_test - ", type(X_test))<br/>print("Type of y_train - ", type(y_train))<br/>print("Type of y_test - ", type(y_test))<br/>print("Shape of X_train - ", X_train.shape)<br/>print("Shape of X_test - ", X_test.shape)<br/>print("Shape of y_train - ", y_train.shape)<br/>print("Shape of y_test - ", y_test.shape)</span></pre><h1 id="6709" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">训练模型</h1><p id="5c81" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">让我们训练模型并进行预测—</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="c9d5" class="lw ir hi ls b fi lx ly l lz ma">from sklearn.tree import DecisionTreeClassifier<br/>housing_model = DecisionTreeClassifier(max_depth = 2)<br/>housing_model.fit(X_train, y_train)<br/>predicted_values = housing_model.predict(X_train)<br/>print("Shape of Predicted values - ", predicted_values.shape)<br/>print("Shape of true values - ", y_train.shape)</span></pre><p id="82e9" class="pw-post-body-paragraph jo jp hi jq b jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh mg kj kk kl hb bi translated">对训练数据本身进行预测</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="d7b4" class="lw ir hi ls b fi lx ly l lz ma">predicted_values = housing_model.predict(X_test)<br/>print("Shape of Predicted values - ", predicted_values.shape)<br/>print("Shape of true values - ", y_test.shape)</span></pre><h1 id="10ea" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">获取准确度分数</h1><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="23b3" class="lw ir hi ls b fi lx ly l lz ma">from sklearn.metrics import accuracy_score<br/>accuracy_score(y_test, predicted_values)</span></pre><h1 id="3e38" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">改进模型</h1><p id="8b5b" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">有多种方法可以改进这个模型，其中一些是—</p><ul class=""><li id="9779" class="kn ko hi jq b jr mc jv md jz nc kd nd kh ne kl ks kt ku kv bi translated">通过移除它们来分离一些特征。对目标没有实际影响的某些特征必须被移除，因为它们对模型来说只是垃圾，会降低模型的准确性</li><li id="02c9" class="kn ko hi jq b jr kw jv kx jz ky kd kz kh la kl ks kt ku kv bi translated">模型中有吸烟者和不吸烟者，男性和女性。分离这些列并为它们建立两个模型可以提高我们的准确性。</li><li id="8a13" class="kn ko hi jq b jr kw jv kx jz ky kd kz kh la kl ks kt ku kv bi translated">尝试另一种算法，如KNN或随机森林，以检查是否达到更好的精度</li></ul><h1 id="743c" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">带有说明的端到端工作笔记本</h1><p id="6a24" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">请注意，以上说明只是高级说明。如果你想要一本包含代码和结果的完整笔记本，请从这个<a class="ae km" href="https://github.com/AMMLRepos/heart-failure-detection/blob/main/heart_failure_prediction.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub URL </a>下载</p></div></div>    
</body>
</html>