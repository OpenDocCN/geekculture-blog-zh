<html>
<head>
<title>Automate Your Excel File Generation with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python自动生成Excel文件</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/automate-your-excel-file-generation-with-python-42552dabd654?source=collection_archive---------13-----------------------#2021-05-25">https://medium.com/geekculture/automate-your-excel-file-generation-with-python-42552dabd654?source=collection_archive---------13-----------------------#2021-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f74f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有了它，生活轻松多了！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/7be1887bd3d77d75f2602ff6823a850c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NulqPt3hw3aFPHpf5_Jbxw.png"/></div></div></figure><p id="1c6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为重复的文档创建一个模板可以节省你很多时间。但是，你能想象当你有模板和里面的数据可以自动完成吗？</p><blockquote class="jp"><p id="3fa4" class="jq jr hi bd js jt ju jv jw jx jy jc dx translated">让我们用Python自动生成excel文件吧！</p></blockquote><p id="9024" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">例如，在本文中，我将创建一个类似于这样的示例分级系统表</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ke"><img src="../Images/5584d06c7ba15a7cc7366f3b0afc4755.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*iAwWMxn7Ad2GbpE2HpnflA.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx">Sample grading worksheet</figcaption></figure><p id="6ed3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一步——安装你需要的库</strong></p><p id="e6f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我用<a class="ae kj" href="https://xlsxwriter.readthedocs.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">xlsxwriter</strong></a><strong class="ih hj"/>来帮我完成这个过程，安装完成后别忘了把它导入到Python代码中</p><pre class="je jf jg jh fd kk kl km kn aw ko bi"><span id="5a86" class="kp kq hi kl b fi kr ks l kt ku">pip install xlsxwriter</span></pre><p id="f101" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤2 —创建工作簿</strong></p><p id="9bdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">工作簿本身将包含一个或多个工作表(我们将工作的地方)。我们创建一个名为<strong class="ih hj"> grading.xlsx. </strong>的文件，该过程将生成一个包含一个工作表的空工作簿</p><pre class="je jf jg jh fd kk kl km kn aw ko bi"><span id="b225" class="kp kq hi kl b fi kr ks l kt ku">import xlsxwriter</span><span id="1bba" class="kp kq hi kl b fi kv ks l kt ku">workbook = xlsxwriter.Workbook('grading.xlsx')</span></pre><p id="4bec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤3 —创建工作表</strong></p><p id="e796" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将创建一个工作表来处理上面的模板</p><pre class="je jf jg jh fd kk kl km kn aw ko bi"><span id="da05" class="kp kq hi kl b fi kr ks l kt ku">worksheet = workbook.add_worksheet('Assignment 1')</span></pre><p id="8dbd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤4 —创建模板</strong></p><p id="f5d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">定义行和列(零索引)</p><pre class="je jf jg jh fd kk kl km kn aw ko bi"><span id="ef73" class="kp kq hi kl b fi kr ks l kt ku">row = 0<br/>col = 0</span></pre><p id="404c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这意味着我们有一个指针<strong class="ih hj">指向工作表的单元格A1 </strong>，这将帮助我们完成模板制作过程。</p><p id="06f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">模板中的列名比其他列名宽。我们需要调整它，使列变得更大</p><pre class="je jf jg jh fd kk kl km kn aw ko bi"><span id="2d16" class="kp kq hi kl b fi kr ks l kt ku">worksheet.set_column('B:B', 15)</span></pre><p id="8be3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在工作表中写东西之前，我创建了一些函数来帮助我格式化将要写的文本</p><pre class="je jf jg jh fd kk kl km kn aw ko bi"><span id="9ff5" class="kp kq hi kl b fi kr ks l kt ku">def default_format(workbook):<br/>    default = workbook.add_format({<br/>        'font_name':REGULAR_FONT,<br/>        'font_size':REGULAR_SIZE,<br/>        'valign':'top',<br/>    })<br/>    return default</span><span id="8f43" class="kp kq hi kl b fi kv ks l kt ku">def text_box_wrap_format(workbook):<br/>    text_box_wrap = workbook.add_format({<br/>        'font_name':REGULAR_FONT,<br/>        'font_size':REGULAR_SIZE,<br/>        'align':'justify',<br/>        'valign':'vcenter',<br/>        'border':True,<br/>        'text_wrap':True<br/>    })<br/>    return text_box_wrap</span><span id="b6f9" class="kp kq hi kl b fi kv ks l kt ku">def text_box_center_wrap_format(workbook):<br/>    text_box_center_wrap = workbook.add_format({<br/>        'font_name':REGULAR_FONT,<br/>        'font_size':REGULAR_SIZE,<br/>        'align':'center',<br/>        'valign':'vcenter',<br/>        'border':True,<br/>        'text_wrap':True<br/>    })<br/>    return text_box_center_wrap</span></pre><p id="2c34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建模板的标题。对于前两列，这很简单。我们需要xlsxwriter.worksheet中的merge_range函数。</p><pre class="je jf jg jh fd kk kl km kn aw ko bi"><span id="580b" class="kp kq hi kl b fi kr ks l kt ku">worksheet.merge_range(row, col, row+3, col, "No.", text_box_center_wrap_format(workbook))<br/>worksheet.merge_range(row, col+1, row+3, col+1, "Name", text_box_center_wrap_format(workbook))</span></pre><p id="babd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于分级指标一栏，就比较棘手了。我们需要一些python操作</p><pre class="je jf jg jh fd kk kl km kn aw ko bi"><span id="85bd" class="kp kq hi kl b fi kr ks l kt ku">indicators = [<br/>    ['Correctness', 40],<br/>    ['Doccumentation', 40],<br/>    ['Demo', 20]<br/>]<br/>tmp_col = col+2+len(indicators)-1<br/>worksheet.merge_range(<br/>    row, col+2, row, tmp_col, "Grading Indicators", <br/>    text_box_center_wrap_format(workbook)<br/>)<br/>for idx, indicator in enumerate(indicators):<br/>    worksheet.write(row+1, col+2+idx, idx+1, text_box_center_wrap_format(workbook))<br/>    worksheet.write(row+2, col+2+idx, indicator[1], text_box_center_wrap_format(workbook))</span></pre><p id="1a00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于最后一个专栏</p><pre class="je jf jg jh fd kk kl km kn aw ko bi"><span id="bf54" class="kp kq hi kl b fi kr ks l kt ku">worksheet.merge_range(row, tmp_col+1, row+2, tmp_col+1, "Total", text_box_center_wrap_format(workbook))</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/e5eb80fec6544ede06f6a0f9f571eaa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*dd1Ght-OfCXhZ05B_6Eiaw.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx">The current worksheet looks like</figcaption></figure><p id="c86f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新行，使其指向<strong class="ih hj">单元格A4 </strong></p><pre class="je jf jg jh fd kk kl km kn aw ko bi"><span id="4292" class="kp kq hi kl b fi kr ks l kt ku">row += 3</span></pre><p id="5112" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们需要填写表格。我需要导入下面的东西来转换行，列到单元格符号</p><pre class="je jf jg jh fd kk kl km kn aw ko bi"><span id="ba88" class="kp kq hi kl b fi kr ks l kt ku">from xlsxwriter.utility import xl_rowcol_to_cell</span></pre><p id="23b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我加了一本关于这个标记的字典</p><pre class="je jf jg jh fd kk kl km kn aw ko bi"><span id="a43f" class="kp kq hi kl b fi kr ks l kt ku">students_grade = {<br/>    "Nanda" : [40, 40, 20],<br/>    "Ryaas" : [28, 32, 15],<br/>    "Absar" : [38, 32, 5]<br/>}</span></pre><p id="67b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在单元格中写下分数</p><pre class="je jf jg jh fd kk kl km kn aw ko bi"><span id="2151" class="kp kq hi kl b fi kr ks l kt ku">for idx, (name, grades) in enumerate(sorted(students_grade.items())):<br/>    worksheet.write(row, col, idx+1, text_box_center_wrap_format(workbook))<br/>    worksheet.write(row, col+1, name, text_box_center_wrap_format(workbook))<br/>    st_cell_grade = xl_rowcol_to_cell(row, col+2)<br/>    tmp_col = col+2<br/>    for grade in grades:<br/>        worksheet.write(row, tmp_col, grade, text_box_center_wrap_format(workbook))<br/>        tmp_col += 1<br/>    end_cell_grade = xl_rowcol_to_cell(row, tmp_col-1)<br/>    worksheet.write(<br/>        row, tmp_col, "=SUM({}:{})".format(st_cell_grade, end_cell_grade),<br/>        text_box_center_wrap_format(workbook)<br/>    )<br/>    row += 1</span></pre><p id="d5dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，它看起来像这样</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kx"><img src="../Images/06a0aebf9f08ee93d1659b0a0d8fa4d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*iO3NxufO71Bv4p_Pmv-0vg.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx">yay! looks nice</figcaption></figure><p id="0e83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了最终确定它，我们需要编写指标解释</p><pre class="je jf jg jh fd kk kl km kn aw ko bi"><span id="25ac" class="kp kq hi kl b fi kr ks l kt ku">row += 1<br/>worksheet.write(row, col, "Indicators:", default_format(workbook))<br/>row += 1<br/>for idx, indicator in enumerate(indicators):<br/>    placeholder = "{}:{}".format(idx+1, indicator[0])<br/>    worksheet.write(row, col, placeholder, default_format(workbook))<br/>    row += 1</span></pre><p id="8238" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们需要关闭工作簿</p><pre class="je jf jg jh fd kk kl km kn aw ko bi"><span id="3c7a" class="kp kq hi kl b fi kr ks l kt ku">workbook.close()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ky"><img src="../Images/1c9fb948bfabbf93d94c5b03a7ddedce.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*6BWXtFUBDody3lf_wcpc1g.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx">Final result</figcaption></figure><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kz la l"/></div></figure><blockquote class="jp"><p id="be73" class="jq jr hi bd js jt lb lc ld le lf jc dx translated">我们完了！</p></blockquote></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><h1 id="eec3" class="ln kq hi bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">我如何在PPL中实现它？</h1><p id="c203" class="pw-post-body-paragraph if ig hi ih b ii mk ik il im ml io ip iq mm is it iu mn iw ix iy mo ja jb jc hb bi translated">在我的软件工程项目中，我要求完成为思思当生成excel文件的任务。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mp"><img src="../Images/3f90588c540f255cfb4e24a3bda01691.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*jgmRc7wAEAzdV33Bh8sOdw.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx">Sample template that I need to implement</figcaption></figure><h2 id="551c" class="kp kq hi bd lo mq mr ms ls mt mu mv lw iq mw mx ma iu my mz me iy na nb mi nc bi translated">过程中的问题</h2><ol class=""><li id="d632" class="nd ne hi ih b ii mk im ml iq nf iu ng iy nh jc ni nj nk nl bi translated">需求会随着时间而变化。但是它处理好了，因为我们在开发阶段使用了敏捷方法</li><li id="2c04" class="nd ne hi ih b ii nm im nn iq no iu np iy nq jc ni nj nk nl bi translated">该任务包括在模板中插入讲师的签名。这很难，因为您需要调整签名图像的大小并更改其属性，以便它能够适合给定的单元格。我花了一整天才找到能解决这个问题的东西</li></ol><h2 id="1f9d" class="kp kq hi bd lo mq mr ms ls mt mu mv lw iq mw mx ma iu my mz me iy na nb mi nc bi translated">我从中学到的东西</h2><ol class=""><li id="d5f6" class="nd ne hi ih b ii mk im ml iq nf iu ng iy nh jc ni nj nk nl bi translated">用excel创建模板，而不是硬编码模板中的所有内容。有必要为另一个模板创建一个可以多次使用的函数。它可以帮助您节省开发时间，并尝试更改或调试某些东西<br/>例如，我用它来创建格式(在上面的示例中给出)并在表单中签名</li><li id="aad8" class="nd ne hi ih b ii nm im nn iq no iu np iy nq jc ni nj nk nl bi translated">分离文件让我在执行任务时更加专注。例如，我创建了<strong class="ih hj"> berkas_helper.py </strong>来管理所有关于单元格格式的内容，创建了<strong class="ih hj"> genereate_berkas.py </strong>来管理模板生成的主要逻辑</li><li id="6a7b" class="nd ne hi ih b ii nm im nn iq no iu np iy nq jc ni nj nk nl bi translated">这很有帮助，因为我们完成模板所需的数据放在数据库中。所以，自动化可以用这些代码来完成。它可能会减少填充模板的人工参与。</li></ol></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><h1 id="44b7" class="ln kq hi bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">结论</h1><p id="9ffd" class="pw-post-body-paragraph if ig hi ih b ii mk ik il im ml io ip iq mm is it iu mn iw ix iy mo ja jb jc hb bi translated">自动生成excel文件很有帮助，所以这个过程可以有效地完成。</p><h1 id="c8cc" class="ln kq hi bd lo lp nr lr ls lt ns lv lw lx nt lz ma mb nu md me mf nv mh mi mj bi translated">参考</h1><ol class=""><li id="cc3e" class="nd ne hi ih b ii mk im ml iq nf iu ng iy nh jc ni nj nk nl bi translated"><a class="ae kj" href="https://xlsxwriter.readthedocs.io/" rel="noopener ugc nofollow" target="_blank">https://xlsxwriter.readthedocs.io/</a></li></ol></div></div>    
</body>
</html>