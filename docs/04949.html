<html>
<head>
<title>Add Voice Commands to Android Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向Android应用程序添加语音命令</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/add-voice-commands-to-android-apps-80157c0d5bcc?source=collection_archive---------20-----------------------#2021-07-06">https://medium.com/geekculture/add-voice-commands-to-android-apps-80157c0d5bcc?source=collection_archive---------20-----------------------#2021-07-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/199049191396241f120dda80a821aea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BdacgOffShXWDdqK.jpg"/></div></div></figure><blockquote class="iq ir is"><p id="5cb6" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">“好吧，谷歌，带我回家。”</p><p id="e32d" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="hi">“嘿Siri，放点音乐吧。”</em></p></blockquote><p id="2d1d" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">如果你以前在移动设备上使用过语音命令，你会尝试类似的东西；手机捆绑的语音助手一天比一天好，可以帮你做很多事情。但是一旦你进入了一个应用程序，它们能帮助你吗？他们能帮助你在每个应用的UI设计的迷宫中导航吗？一旦你打开应用程序，他们能帮助你使用语音完成任务吗？</p><blockquote class="iq ir is"><p id="2bb7" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="hi">等一下。app里面<em class="hi">的语音</em>是什么意思？</em></p></blockquote><p id="0d65" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">是的——你有没有想过是否可以在应用程序中添加语音命令？想象一下，只要对着应用说话就能完成任务，而不是像我们在科幻电影中看到的那样，试图通过触摸在用户界面上蠕动。</p><p id="f3b6" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">今天，我们将通过一款Android应用来实现这一目标。</p><p id="5238" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">不，我不会要求你花费大量的时间和金钱来建立一些基于深度学习的自动语音识别系统作为先决条件。相反，我们将利用Android中免费提供的<em class="iv"> SpeechRecognizer </em>类来完成这个项目。</p><p id="fa72" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">不过，如果你对构建自己的ASR感兴趣，可以参考我们关于构建自己的转录器的<a class="ae jv" href="https://www.slanglabs.in/blog/how-to-build-python-transcriber-using-mozilla-deepspeech" rel="noopener ugc nofollow" target="_blank">博客。‍</a></p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="726a" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">为了这个实验，我们将创建一个新的Android Studio项目。</p><p id="40fd" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">要让我们的应用程序响应语音命令，需要遵循五个步骤，</p><ol class=""><li id="e74b" class="kd ke hi iw b ix iy jb jc js kf jt kg ju kh jr ki kj kk kl bi translated">设置音频权限。</li><li id="9c77" class="kd ke hi iw b ix km jb kn js ko jt kp ju kq jr ki kj kk kl bi translated">创建将作为麦克风触发器的UI元素。</li><li id="706b" class="kd ke hi iw b ix km jb kn js ko jt kp ju kq jr ki kj kk kl bi translated">初始化并设置<em class="iv"> SpeechRecognizer </em>实例。</li><li id="0b64" class="kd ke hi iw b ix km jb kn js ko jt kp ju kq jr ki kj kk kl bi translated">创建一个受支持的话语列表，作为我们应用程序中语音命令的域。</li><li id="e1d0" class="kd ke hi iw b ix km jb kn js ko jt kp ju kq jr ki kj kk kl bi translated">根据用户发出的语音命令执行应用程序中的操作。</li></ol><h1 id="6987" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">设置音频权限</h1><p id="8913" class="pw-post-body-paragraph it iu hi iw b ix lp iz ja jb lq jd je js lr jh ji jt ls jl jm ju lt jp jq jr hb bi translated">我们将需要通过在我们的应用程序的AndroidManifest.xml文件中添加以下行来声明音频权限要求。</p><figure class="lu lv lw lx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="cfca" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">让我们把麦克风触发器放在MainActivity.java上。在我们的应用程序开始监听用户输入之前，我们需要运行权限检查，如果ASR权限没有被授予，请请求用户允许访问麦克风。</p><p id="bb71" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated"><strong class="iw hj">注意:</strong>您可以选择在应用启动时或运行时，当用户试图通过点击指定的UI元素与您的应用对话时，请求音频许可。这里我们会询问应用程序启动时的音频权限。</p><figure class="lu lv lw lx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="18ae" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">为了知道用户是批准还是拒绝我们的权限请求，我们需要在MainActivity中覆盖<em class="iv">onRequestPermissionsResult()</em>函数。</p><figure class="lu lv lw lx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><h1 id="3af0" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">为麦克风触发器添加UI元素</h1><p id="628f" class="pw-post-body-paragraph it iu hi iw b ix lp iz ja jb lq jd je js lr jh ji jt ls jl jm ju lt jp jq jr hb bi translated">下一步是添加一个麦克风按钮，也就是触发器。每当用户点击触发器，我们将开始一个新的音频会话。在这个实验中，让我们将麦克风的图像作为触发图标。我们将图像资源添加到项目中，然后将<em class="iv"> ImageView </em>添加到<em class="iv"> activity_main.xml </em>。我们还将添加一个<em class="iv">文本视图</em>来显示用户说话时检测到的话语。</p><figure class="lu lv lw lx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="c1f9" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">我们还将在触发图标上添加一个点击监听器来启动和停止音频会话。</p><figure class="lu lv lw lx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><h1 id="a35e" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">设置SpeechRecognizer实例</h1><p id="ede9" class="pw-post-body-paragraph it iu hi iw b ix lp iz ja jb lq jd je js lr jh ji jt ls jl jm ju lt jp jq jr hb bi translated">现在开始激动人心的事情。使用SpeechRecognizer实例，我们将能够监听用户的命令并在我们的应用程序中执行操作。</p><p id="e859" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">向MainActivity添加一个名为<em class="iv"> mSpeechRecognizer </em>的SpeechRecognizer的全局实例，并添加一个函数来初始化它。</p><p id="6cef" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">我们还将添加一个<em class="iv">识别监听器</em>到<em class="iv"> mSpeechRecognizer，</em>，这将使我们能够在音频会话的每个阶段得到通知。我们感兴趣的两个回调是<em class="iv"> onPartialResults() </em>和<em class="iv"> onResults() </em>。我们将在稍后填补这些回调。您可以忽略其他的回调，我们在这个实验中不需要它们。</p><figure class="lu lv lw lx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="c407" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">在开始音频会话之前，我们还需要定义一个音频识别意图，该意图将被传递给<em class="iv"> mSpeechRecognizer </em>。</p><figure class="lu lv lw lx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="4d8f" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated"><em class="iv"> EXTRA_LANGUAGE_MODEL </em>是<em class="iv">ACTION _ RECOGNIZE _ SPEECH</em>必需的附加物。我们还将<em class="iv"> EXTRA_PARTIAL_RESULTS </em>设置为true，以便在用户通过<em class="iv"> onPartialResults() </em>回调开始说话时得到部分语音结果的通知。</p><p id="5617" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">EXTRA_LANGUAGE是可选的，它为语音识别设置区域设置。此外，还有一些其他可选的附加功能，您可以在这里查看<a class="ae jv" href="https://developer.android.com/reference/android/speech/RecognizerIntent#ACTION_RECOGNIZE_SPEECH" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="134d" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">现在让我们在触发器图标的点击处理程序中处理音频会话。</p><figure class="lu lv lw lx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="8328" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">一旦音频会话开始，用户开始讲话，我们将在回调中得到部分和完整结果的通知。让我们来定义这些回调。</p><figure class="lu lv lw lx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><h1 id="e6b6" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">创建应用支持的操作列表</h1><p id="9b56" class="pw-post-body-paragraph it iu hi iw b ix lp iz ja jb lq jd je js lr jh ji jt ls jl jm ju lt jp jq jr hb bi translated">让我们定义应用程序可以执行的几个动作，并在一个数组中添加所有这些动作的语句。当然，这取决于应用程序；例如，一个电子商务应用程序会有一套不同于消息应用程序的操作。</p><p id="96b6" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">我们将根据这个实验的一个电子商务应用程序来定义操作。我们的用户命令语句看起来会像这样。</p><figure class="lu lv lw lx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><h1 id="1c1a" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">根据用户语音命令执行操作</h1><p id="4873" class="pw-post-body-paragraph it iu hi iw b ix lp iz ja jb lq jd je js lr jh ji jt ls jl jm ju lt jp jq jr hb bi translated">现在，我们已经有了支持的命令列表和应用程序中端到端的工作语音识别功能，让我们定义负责执行用户命令的<em class="iv"> handleCommand() </em>函数。</p><p id="36c5" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">根据我们从用户那里收到的命令，我们将触发不同的应用程序动作。出于本实验的目的，我们将只更新MainActivity上的UI，通知用户操作成功。如果我们在静态命令列表中找不到用户话语，我们会告诉他们不支持他们请求的操作。</p><figure class="lu lv lw lx fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="35d2" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">就是这样！我们的示例应用程序现在是一个支持语音的应用程序，它将使用户能够基于语音命令执行操作。</p><p id="59e0" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">希望这能对你有所帮助，如果你决定尝试语音，请在下面的评论中告诉我们。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="a6c0" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">虽然上述步骤有助于您编写自己的应用程序内语音命令，但它们仍然限制了您可以使用它做的事情的数量和它提供的灵活性。例如，如果用户发出的命令稍有不同，它就不会工作。这也没有优化为在需要时与用户对话以收集任何附加信息。设备上的语音识别是一种通用的ASR。它针对更广泛的识别进行了优化，如果你想提高对你的应用程序重要的单词的准确性，这是不可能的。此外，用户界面和UX仍然需要建立一个额外的默认文本框在功能上非常有限。</p><p id="6184" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">这就是我们在Slang建立的一个名为<a class="ae jv" href="https://www.slanglabs.in" rel="noopener ugc nofollow" target="_blank"> Slang CONVA </a>的平台将帮助你添加复杂的应用内语音助手，而无需显式处理所有音频方面并解析命令以理解其背后的意图。其全栈预建的语音助手为各种域提供开箱即用的支持，包括处理多种语言。</p><p id="530b" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">查看我们的<a class="ae jv" href="https://www.slanglabs.in/blog/complexities-in-building-a-custom-in-app-voice-assistants" rel="noopener ugc nofollow" target="_blank">关于构建定制应用内语音助手</a>的博客，了解更多细节。</p></div></div>    
</body>
</html>