<html>
<head>
<title>First Steps With .NET Core Testing Using NUnit and NSubstitute (Second and Last Part)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第一步是。使用NUnit和NSubstitute的NET Core测试(第二部分和最后一部分)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/net-core-testing-using-nunit-and-nsubstitute-a-clean-hexagonal-approach-second-and-last-part-1dc2aafc1ad7?source=collection_archive---------2-----------------------#2020-11-25">https://medium.com/geekculture/net-core-testing-using-nunit-and-nsubstitute-a-clean-hexagonal-approach-second-and-last-part-1dc2aafc1ad7?source=collection_archive---------2-----------------------#2020-11-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/883b5f79e71163a1dc36e3c42d0a64b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*h0y2mRz3JYtXC6_V"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo credit: <a class="ae iu" href="https://unsplash.com/@_louisreed" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/@_louisreed</a></figcaption></figure><p id="2c8b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这篇文章是这篇文章的延续，在这篇文章中，我创建了具有域层和基础设施(在这个例子中是存储库)层接口的解决方案。</p><p id="95c4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的下一步是通过运行以下命令来创建我们的测试项目。我们正在创建一个NUnit测试项目，并将其包含在解决方案中。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="9566" class="kc kd hi jy b fi ke kf l kg kh">dotnet new nunit --framework netstandard2.1 --name Transactions.Tests</span><span id="1ffc" class="kc kd hi jy b fi ki kf l kg kh">dotnet sln Transactions.sln add Transactions.Domain/</span></pre><p id="6a34" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们用下面的命令安装NSubstitute。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="18b1" class="kc kd hi jy b fi ke kf l kg kh">dotnet add package NSubstitute</span></pre><p id="1818" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如在上一篇文章中看到的，我们没有存储库层的实现(只有接口)，所以我们将使用NSubstitute来模拟它。</p><p id="79b2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">到目前为止，我们的IAccountTransactionRepository接口只有一个方法，即Insert方法。因为我们要测试我们的AccountTransactionsService类行为，所以要模拟这个方法的返回。</p><p id="8d92" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我创建了一个名为TransactionServiceTest的测试类，用一个Setup方法来测试我们的服务类的方法，当我们运行test命令时，它将会运行。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kj"><img src="../Images/1b6c9d2369fe4b49a2ccca12892651d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4SDRe_qjDymNgTvs9WwE2A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">The Setup method</figcaption></figure><p id="2cc5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个方法中，存储库接口将被注入一个模拟替代。除此之外，Insert方法被一个模拟值所取代。这允许我们测试服务行为，而无需真正实现存储库类。</p><p id="6a4f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意，我使用了一个参数。任何<t>方法作为参数。这表明当通过为AccountTransaction参数传递任何值来调用Insert方法时，将使用指定的返回。也有可能为测试不同的行为创造不同的回报。</t></p><p id="15db" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，测试方法。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kk"><img src="../Images/49114a9a76437d1914e5654c302f9c2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*5VZ8ixTzlxYE4mJ9W39tyg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">The test method with assertions</figcaption></figure><p id="f3ba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个测试方法调用SaveCreditTransaction方法并做出断言，验证正确(或不正确)的返回值。</p><p id="f859" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们运行<code class="du kl km kn jy b">dotnet test</code>看看会发生什么。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kk"><img src="../Images/2d434a0e066cb8c574f6672c4e5e31e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*LuWQm2xirvHie7mDdvj7Zw.png"/></div></figure><p id="9cac" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">嗯，果然奏效了！</p><p id="b04c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里的寓意是:我们所有实现业务规则的组件都可以被测试，而基础设施层的行为是完全模拟的。</p><p id="c3e5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">仅此而已。感谢阅读。</p><p id="ca5b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">希望对你有用。</p></div></div>    
</body>
</html>