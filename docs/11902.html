<html>
<head>
<title>Xcode 13.3 supports SPM binary dependency in private GitHub release</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Xcode 13.3支持私有GitHub版本中的SPM二进制依赖</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/xcode-13-3-supports-spm-binary-dependency-in-private-github-release-8d60a47d5e45?source=collection_archive---------2-----------------------#2022-04-15">https://medium.com/geekculture/xcode-13-3-supports-spm-binary-dependency-in-private-github-release-8d60a47d5e45?source=collection_archive---------2-----------------------#2022-04-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8aef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博文中，我将分享一个在<a class="ae jd" href="https://developer.apple.com/documentation/Xcode-Release-Notes/xcode-13_3-release-notes" rel="noopener ugc nofollow" target="_blank"> Xcode 13.3发行说明</a>中没有提到的新功能的细节。当开发专有的、封闭源代码的库时，需要将代码作为二进制文件提供以保护其知识产权的开发人员会对这个特性感兴趣。</p><p id="20aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要以二进制形式作为Swift包分发代码，请创建一个包含二进制文件的XCFramework包。然后，使这个包在本地或服务器上可用。下面是一个分发存储在服务器上的二进制框架的<code class="du je jf jg jh b">Package.swift</code>清单示例:</p><pre class="ji jj jk jl fd jm jh jn jo aw jp bi"><span id="6db3" class="jq jr hi jh b fi js jt l ju jv">// swift-tools-version:5.3<br/>import PackageDescription</span><span id="1cb3" class="jq jr hi jh b fi jw jt l ju jv">let package = Package(<br/>    name: "MyLibrary",<br/>    platforms: [<br/>        .macOS(.v10_14), .iOS(.v13), .tvOS(.v13)<br/>    ],<br/>    products: [<br/>        .library(<br/>            name: "MyLibrary",<br/>            targets: ["SomeRemoteBinaryPackage"])<br/>    ],<br/>    dependencies: [],<br/>    targets: [<br/>        .binaryTarget(<br/>            name: "SomeRemoteBinaryPackage",<br/>            url: "<a class="ae jd" href="https://url/to/some/remote/xcframework.zip" rel="noopener ugc nofollow" target="_blank">https://url/to/some/remote/xcframework.zip</a>",<br/>            checksum: "The checksum of the ZIP archive that contains the XCFramework."<br/>        )<br/>    ]<br/>)</span></pre><p id="3e1b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">xcframework.zip文件需要在服务器上公开访问。但是，如果您需要将公共访问限制为经过身份验证的用户，该怎么办呢？</p><p id="0fdd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du je jf jg jh b">.netrc</code>文件格式通常用于HTTP请求的自动认证。</p><pre class="ji jj jk jl fd jm jh jn jo aw jp bi"><span id="d19f" class="jq jr hi jh b fi js jt l ju jv">machine &lt;example.com&gt; login &lt;my-user-name&gt; password &lt;my-password&gt;</span></pre><p id="9a83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它通常驻留在用户的主目录中(<code class="du je jf jg jh b">~/.netrc</code>)。通过阅读<a class="ae jd" href="https://www.gnu.org/software/inetutils/manual/html_node/The-_002enetrc-file.html" rel="noopener ugc nofollow" target="_blank"> gnu文档</a>了解更多关于netrc的信息。</p><p id="72c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我以前的同事<a class="ae jd" href="https://twitter.com/StadelmanStan" rel="noopener ugc nofollow" target="_blank"> Stan Stadelman </a>将<code class="du je jf jg jh b">netrc</code>引入SPM，以支持面向非git二进制依赖主机的基本身份验证。</p><div class="jx jy ez fb jz ka"><a href="https://github.com/apple/swift-package-manager/pull/2833" rel="noopener  ugc nofollow" target="_blank"><div class="kb ab dw"><div class="kc ab kd cl cj ke"><h2 class="bd hj fi z dy kf ea eb kg ed ef hh bi translated">通过sstadelman Pull请求#2833添加对Netrc下载程序的支持…</h2><div class="kh l"><h3 class="bd b fi z dy kf ea eb kg ed ef dx translated">实现了对netrc文件的处理。匹配二进制工件主机的连接设置，并返回基本…</h3></div><div class="ki l"><p class="bd b fp z dy kf ea eb kg ed ef dx translated">github.com</p></div></div><div class="kj l"><div class="kk l kl km kn kj ko kp ka"/></div></div></a></div><p id="a838" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用户无需选择使用netrc，因为在Swift Package Manager 中默认情况下<a class="ae jd" href="https://github.com/apple/swift-package-manager/blob/5a94f3c4625158c4dd8da6c92b6800ce2cc0e1e7/Sources/Commands/Options.swift#L144" rel="noopener ugc nofollow" target="_blank">选项是打开的。</a></p><pre class="ji jj jk jl fd jm jh jn jo aw jp bi"><span id="bf90" class="jq jr hi jh b fi js jt l ju jv">    /// Whether to load .netrc files for authenticating with remote servers<br/>    /// when downloading binary artifacts or communicating with a registry.<br/>    <a class="ae jd" href="http://twitter.com/Flag" rel="noopener ugc nofollow" target="_blank">@Flag</a>(inversion: .prefixedEnableDisable,<br/>          exclusivity: .exclusive,<br/>          help: "Load credentials from a .netrc file")<br/>    var netrc: Bool = true</span></pre><p id="84da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SPM将自动检测<code class="du je jf jg jh b">.netrc</code>文件并应用所需的<code class="du je jf jg jh b">Authentication</code>标题。此外，通过选项<code class="du je jf jg jh b">netrc-file &lt;netrc-file&gt;</code>，您可以指定不同的位置。</p><p id="e9d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Xcode 12.5提供了这项功能。然而，社区指出这并不<a class="ae jd" href="https://forums.swift.org/t/spm-binary-dependency-in-private-github-release/52514/3" rel="noopener ugc nofollow" target="_blank">对一个私有的GitHub版本</a>有效。</p><p id="a337" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，您不能使用浏览器下载URL，因为HTTP请求会导致302重定向。您必须<a class="ae jd" href="https://forums.swift.org/t/spm-support-basic-auth-for-non-git-binary-dependency-hosts/37878/35" rel="noopener ugc nofollow" target="_blank">查找资产名称</a>，然后使用资产url。</p><ul class=""><li id="3221" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">不正确的网址:<code class="du je jf jg jh b"><a class="ae jd" href="https://github.com/:owner/:repo/releases/download/:tag/some.xcframework.zip" rel="noopener ugc nofollow" target="_blank">https://github.com/:owner/:repo/releases/download/:tag/some.xcframework.zip</a></code></li><li id="840d" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">正确的网址:<code class="du je jf jg jh b"><a class="ae jd" href="https://api.github.com/repos/:owner/:repo/releases/assets/\(assetId).zip" rel="noopener ugc nofollow" target="_blank">https://api.github.com/repos/:owner/:repo/releases/assets/\(assetId).zip</a></code></li></ul><p id="f9a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但更重要的是，还有一个SPM没有意识到的问题。</p><pre class="ji jj jk jl fd jm jh jn jo aw jp bi"><span id="2e03" class="jq jr hi jh b fi js jt l ju jv">// netrc support is NOT enough to make this work for a private repo asset<br/>.binaryTarget(<br/>    name: privateName,<br/>    url: "<a class="ae jd" href="https://api.github.com/repos/:owner/:repo/releases/assets/\(assetId).zip" rel="noopener ugc nofollow" target="_blank">https://api.github.com/repos/:owner/:repo/releases/assets/\(assetId).zip</a>",<br/>    checksum: checksum<br/>)</span></pre><p id="be03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://docs.github.com/en/rest/reference/releases#get-a-release-asset" rel="noopener ugc nofollow" target="_blank"> Github API </a>声明下载资产的二进制内容需要对<code class="du je jf jg jh b">application/octet-stream</code>的请求的<code class="du je jf jg jh b">Accept</code>头。否则，将返回API JSON响应。</p><p id="5f6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，<a class="ae jd" rel="noopener" href="/@jimmyarts"> Jimmy Arts </a>在SPM中引入了以下更改，以自动设置割台:</p><div class="jx jy ez fb jz ka"><a href="https://github.com/apple/swift-package-manager/pull/3795" rel="noopener  ugc nofollow" target="_blank"><div class="kb ab dw"><div class="kc ab kd cl cj ke"><h2 class="bd hj fi z dy kf ea eb kg ed ef hh bi translated">将接受标题添加到jimmya Pull Request # 3795 apple/swift-package-manager的下载请求中</h2><div class="kh l"><h3 class="bd b fi z dy kf ea eb kg ed ef dx translated">向二进制下载请求添加Accept:application/octet-stream头，以允许使用Github API。动机:我想要…</h3></div><div class="ki l"><p class="bd b fp z dy kf ea eb kg ed ef dx translated">github.com</p></div></div><div class="kj l"><div class="le l kl km kn kj ko kp ka"/></div></div></a></div><p id="6974" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Xcode 13.3包含了这一变化。因此，使用Xcode 13.3和一个带有GitHub个人访问令牌的<code class="du je jf jg jh b">.netrc</code>文件将最终允许您从私有GitHub存储库中下载二进制资产。😊🎉</p><p id="6bf6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如:在我的GitHub用户<code class="du je jf jg jh b">MarcoEidinger</code>下有一个存储库<code class="du je jf jg jh b">MyPrivateRepo</code>，我用资产<code class="du je jf jg jh b">MyBinaryModuleName.xcframework.zip</code>创建了发布版<code class="du je jf jg jh b">1.0.0</code>。因此<code class="du je jf jg jh b">Package.swift</code>应该是这样的</p><pre class="ji jj jk jl fd jm jh jn jo aw jp bi"><span id="b70f" class="jq jr hi jh b fi js jt l ju jv">.binaryTarget(<br/>    name: "MyBinaryModuleName",<br/>    url: "<a class="ae jd" href="https://api.github.com/repos/MarcoEidinger/MyPrivateRepo/releases/assets/58858051.zip" rel="noopener ugc nofollow" target="_blank">https://api.github.com/repos/MarcoEidinger/MyPrivateRepo/releases/assets/58858051.zip</a>",<br/>    checksum: "c533f08210ac21def782d48c2ff1e1a538b05b051e128aa88ffcd44051ddc2b3"<br/>),</span></pre><p id="fbe4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的<code class="du je jf jg jh b">~/.netrc</code>文件应该是这样的</p><pre class="ji jj jk jl fd jm jh jn jo aw jp bi"><span id="0d6b" class="jq jr hi jh b fi js jt l ju jv">machine api.github.com login MarcoEidinger password ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span></pre><p id="3bc8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Netrc是一个很棒的解决方案，可以在Mac上运行，也可以在Linux上运行。如果你只在Mac上工作，那么你可以利用苹果的钥匙串作为替代。您可以创建一个包含以下内容的互联网密码，而不是在<code class="du je jf jg jh b">~/.netrc</code>文件中创建一个条目</p><ul class=""><li id="eb8d" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated"><code class="du je jf jg jh b">Keychain Item Name</code>:api.github.com</li><li id="548d" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated"><code class="du je jf jg jh b">Account Name</code> : GitHub用户名</li><li id="8fd9" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated"><code class="du je jf jg jh b">Password</code>:个人访问令牌</li></ul><figure class="ji jj jk jl fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lf"><img src="../Images/f46f256d810666fe3db83079e5ef15a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LyY65Ha20NTC7d9i"/></div></div></figure><figure class="ji jj jk jl fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lm"><img src="../Images/3da123fe1bb39fd341033b9973627427.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EVBh5n-kkD6hY4_R"/></div></div></figure><p id="5339" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦您授予权限，Xcode (SPM)将从钥匙串中读取。这样的对话可能在包解析期间出现。</p><figure class="ji jj jk jl fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es ln"><img src="../Images/36815254a78aa524f939359c9e72642b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DHjuhPRQMwniT9u2"/></div></div></figure><p id="4752" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">附注:整个历史可以在Swift论坛的以下线索中找到:</p><div class="jx jy ez fb jz ka"><a href="https://forums.swift.org/t/spm-support-basic-auth-for-non-git-binary-dependency-hosts/37878" rel="noopener  ugc nofollow" target="_blank"><div class="kb ab dw"><div class="kc ab kd cl cj ke"><h2 class="bd hj fi z dy kf ea eb kg ed ef hh bi translated">SPM支持非git二进制依赖主机的基本身份验证</h2><div class="kh l"><h3 class="bd b fi z dy kf ea eb kg ed ef dx translated">我的公司在Nexus存储库中提供对iOS SDK二进制依赖项的有限公共访问。开发者是…</h3></div><div class="ki l"><p class="bd b fp z dy kf ea eb kg ed ef dx translated">forums.swift.org</p></div></div><div class="kj l"><div class="lo l kl km kn kj ko kp ka"/></div></div></a></div></div><div class="ab cl lp lq gp lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hb hc hd he hf"><p id="5c35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lw">原载于</em><a class="ae jd" href="https://blog.eidinger.info/xcode-133-supports-spm-binary-dependency-in-private-github-release" rel="noopener ugc nofollow" target="_blank"><em class="lw">https://blog . eidinger . info</em></a><em class="lw">。</em></p></div></div>    
</body>
</html>