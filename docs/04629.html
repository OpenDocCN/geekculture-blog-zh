<html>
<head>
<title>TiDE: Developing a Distributed Database in a Breeze</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TiDE:轻松开发分布式数据库</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/tide-developing-a-distributed-database-in-a-breeze-25498e89b568?source=collection_archive---------39-----------------------#2021-06-30">https://medium.com/geekculture/tide-developing-a-distributed-database-in-a-breeze-25498e89b568?source=collection_archive---------39-----------------------#2021-06-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9437a1da5940b970ddc991b4ddbb3369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sOmETSGWAIJ9GLXm.jpg"/></div></div></figure><p id="28be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">作者:PingCAP的软件工程师</p><ul class=""><li id="dc56" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated"><a class="ae jx" href="https://github.com/baurine" rel="noopener ugc nofollow" target="_blank">黄</a></li><li id="c442" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated"><a class="ae jx" href="https://github.com/dragonly" rel="noopener ugc nofollow" target="_blank">李亿龙</a>，</li><li id="61c0" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated"><a class="ae jx" href="https://github.com/aylei" rel="noopener ugc nofollow" target="_blank">吴艾蕾</a></li></ul><p id="a27e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Transcreator: <a class="ae jx" href="https://github.com/ran-huang" rel="noopener ugc nofollow" target="_blank">黄然</a>；编辑:汤姆·万德</p><p id="3cf2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为TiDB的代码库做贡献并不容易，尤其是对新手来说。作为一个分布式数据库，TiDB有多个组件和众多工具，用包括Go和Rust在内的多种语言编写。开始使用如此复杂的系统需要相当大的努力。</p><p id="47d1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，为了欢迎TiDB的新成员，让他们更容易为我们的社区做出贡献，我们开发了一个TiDB集成开发环境:<a class="ae jx" href="https://github.com/tidb-incubator/tide" rel="noopener ugc nofollow" target="_blank"> TiDE </a>。TiDE是在TiDB Hackathon 2020 期间创建的，是一个Visual Studio代码扩展，使开发TiDB变得轻而易举。有了这个扩展，开发一个分布式系统就像开发一个本地系统一样简单。</p><p id="152f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我将向您展示TiDE的核心特性，以及它如何为TiDB开发人员简化标准工作流程。让我们开始吧。</p><h1 id="b55f" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">开发TiDB有多难？</h1><p id="b29b" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">作为一个复杂的分布式SQL数据库系统，<a class="ae jx" href="https://github.com/pingcap/tidb" rel="noopener ugc nofollow" target="_blank"> TiDB </a>有三个核心组件(TiDB，TiKV，和布局驱动，PD)和许多生态系统工具。TiDB和<a class="ae jx" href="https://github.com/tikv/pd" rel="noopener ugc nofollow" target="_blank"> PD </a>用Go编写，而<a class="ae jx" href="https://github.com/tikv/tikv" rel="noopener ugc nofollow" target="_blank"> TiKV </a>用Rust编写。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b92121cf7f6a1423ac946ca7afa715e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wKKoaUJYMggWmSnw.jpg"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx"><em class="lo">TiDB architecture in a glance</em></figcaption></figure><p id="2e8a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">想象一下，你想亲自动手编译TiDB。你需要经历几个痛苦的步骤:</p><ol class=""><li id="e555" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn lp ju jv jw bi translated">下载这三个组件的代码。如果您还没有这样做，请安装Go和Rust工具链，并根据每个组件的文档编译二进制文件。</li><li id="0679" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn lp ju jv jw bi translated">要轻松运行编译后的组件，需要安装TiDB的包管理器<a class="ae jx" href="https://docs.pingcap.com/tidb/stable/tiup-overview" rel="noopener ugc nofollow" target="_blank"> TiUP </a>。然后，您将学习编写一个基本的配置文件并启动TiDB集群。</li><li id="e31f" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn lp ju jv jw bi translated">在集群启动并运行之后，您需要阅读每个组件的日志，并通过在日志中搜索关键字来了解它们的详细信息。然而，TiDB是一个多进程(和多节点)系统，所以您需要登录到不同的物理机器来查看日志。你必须知道如何使用<code class="du lq lr ls lt b">less</code>和<code class="du lq lr ls lt b">grep</code>命令。</li><li id="a9f7" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn lp ju jv jw bi translated">当您有了一个想法并想尝试TiDB时，您需要编写代码，编译它，将二进制文件复制到本地或远程TiUP目录，重新启动集群，并重复步骤3。</li></ol><p id="2b4b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如您所看到的，开发TiDB的传统工作流程是一个冗长而乏味的过程，大部分精力都浪费在重复的、令人不快的操作上。</p><h1 id="36d2" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">什么是潮汐，我们为什么需要它？</h1><p id="45f3" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">孔子(中国哲学家和政治家)说:“巧匠必须磨刀霍霍。”那适用于TiDB开发者(你！)也是。要减少繁琐的工作，提高效率，自动化是必须的。TiDE，一个VS代码扩展，自动化你在VS代码中的TiDB编码体验。</p><p id="abcc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您启用TiDE时，它会在VS代码中为TiDB创建一个专用的工作区，提供简化TiDB开发的功能。</p><h2 id="d76e" class="lu ke hi bd kf lv lw lx kj ly lz ma kn jb mb mc kr jf md me kv jj mf mg kz mh bi translated">简化的TiDB集群部署</h2><p id="d24b" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">TiDE的基本特性之一是iDE。无论您想在本地测试集群还是生产集群上进行开发，TiDE都可以通过几次点击来启动您需要的环境。</p><p id="8643" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">本地测试集群</strong></p><p id="415b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以前，要开始，您需要运行<code class="du lq lr ls lt b">tiup playground</code>来启动一个测试集群。现在，您只需创建一个工作区来添加您的代码目录，剩下的工作将由TiDE来完成。</p><p id="b420" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要修复一个bug或添加一个新特性，您不再需要自己编译代码和更新二进制文件，因为TiDE将帮助您完成这个过程并重新启动集群。您所要做的就是编写代码，这与在任何IDE中开发程序是一样的体验。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/0a0874b045659aec40af9f95a2191ad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZPI7ykjlK6xhNgmX.jpg"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx"><em class="lo">Deploy a testing cluster in TiDE</em></figcaption></figure><p id="5c16" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">生产集群</strong></p><p id="e835" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在生产环境中，TiDB通过<code class="du lq lr ls lt b">tiup cluster</code>部署到多个物理机或虚拟机。以前，您需要通过<code class="du lq lr ls lt b">scp</code>命令将二进制文件传输到远程机器，并重启相应的进程。</p><p id="6b51" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">毫无疑问，TiDE简化了您的工作流程。开发人员完成他们的代码后，TiDE编译代码，通过TiUP生成的SSH密钥对将二进制文件分发到远程机器，并重新启动所有进程。开发分布式系统就像开发本地系统一样简单。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/c1d95ab919c73c133bfed0eecd1e3e81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aIWp2zzxOgO2Jk3n.jpg"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx"><em class="lo">Patch the remote binary in TiDE</em></figcaption></figure><h2 id="9efa" class="lu ke hi bd kf lv lw lx kj ly lz ma kn jb mb mc kr jf md me kv jj mf mg kz mh bi translated">Kubernetes集成(alpha)</h2><p id="9c46" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">TiDB是一个云原生数据库，根据定义，你应该能够在Kubernetes 开发和部署。开发人员使用<code class="du lq lr ls lt b">kubectl</code>来管理Kubernetes中的资源，但这很不方便。</p><p id="5944" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在为TiDE添加了一个特性，可以像使用TiUP一样方便地在Kubernetes中开发和调试TiDB集群。这仍处于alpha阶段，欢迎任何贡献；但是首先，您可以在Kubernetes中查看您的TiDB集群。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/5baa2d561ce4f0dfaf6dd78d8b25a702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*S8GWGYozVIA9y4is.jpg"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx"><em class="lo">View TiDB clusters in Kubernetes</em></figcaption></figure><h2 id="ff33" class="lu ke hi bd kf lv lw lx kj ly lz ma kn jb mb mc kr jf md me kv jj mf mg kz mh bi translated">统一日志访问</h2><p id="57e3" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">因为TiDB有很多组件，如果要查询系统状态，往往要检查多个日志。对于开发新手来说，找到日志地址并搜索或分析日志可能是一个巨大的负担。</p><p id="fe79" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">TiDE提供了统一的日志访问解决方案。通过点击你需要的组件和进程，你可以立即看到VS代码中的所有日志。还可以使用VS Code内置的搜索功能搜索所有日志，包括正则表达式匹配。切换到另一个流程？只需再点击几下。这个解决方案如此简单直观，以至于搜索日志不再令人苦恼。</p><p id="0579" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下是在拆分编辑器中查看不同日志的示例:</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b769a095eb461cad0110c48b8086dda2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*U13DU2Ad_bIUrCH7.jpg"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx"><em class="lo">Analyzing TiDB logs in VS Code</em></figcaption></figure><h2 id="59f6" class="lu ke hi bd kf lv lw lx kj ly lz ma kn jb mb mc kr jf md me kv jj mf mg kz mh bi translated">调试模式(alpha)</h2><p id="1a99" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">当一个新手接触TiDB的代码库时，他们通常会从阅读源代码开始。但是当有复杂的条件和多个goroutines-thread sync时，理解代码就困难多了。变量的数量激增到人脑无法处理的程度。</p><p id="ce60" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是调试模式发挥作用的地方。通过在代码中设置断点，运行调试器，我们可以清楚地看到当前线程每个堆栈上的变量值，就像《黑客帝国》中的时间冻结场景。</p><p id="fbbf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在TiDE的调试模式下，当程序处理一个客户端请求时，你可以调试每个组件，不管是TiDB、TiKV还是PD，用Go还是Rust编写。TiDE甚至支持跨组件调试。例如，如果当前断点是在TiDB向TiKV发送RPC请求之前设置的，调试器可以跳转到TiKV中的下一个断点。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/01dce444f55afbc1aa49e5cb0dfc3aa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*THtlg_Cw1rC_dgda.gif"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx"><em class="lo">Running the debug mode in TiDE</em></figcaption></figure><h1 id="5d56" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">虚拟机集成</h1><p id="2192" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">在实际部署中，不是每个人都能负担得起部署TiDB的多台物理机。有时我们需要在虚拟机上部署TiDB。</p><p id="5b49" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<a class="ae jx" href="https://www.vagrantup.com/" rel="noopener ugc nofollow" target="_blank">流浪者</a>的帮助下，TiDE集成了在虚拟机上部署TiDB集群的通用流程。您只需要为每个组件设置副本的数量，TiDE将管理虚拟机。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/04962b4d4ccfb53f270f0389726fba9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*u8s9uLFIdEnQq9VR.jpg"/></div></div></figure><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/a2721f7a2367a687e90938e7b2fa613e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*osNUXuD3aXof0Oqp.jpg"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx"><em class="lo">Deploy a cluster to virtual machines</em></figcaption></figure><h1 id="1c99" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">试试退潮！</h1><p id="922e" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">分布式系统和数据库都是计算机科学的前沿领域。参与相关的开源项目，虽然充满了障碍，但从长远来看，可以带来巨大的好处。希望TiDE能让你的TiDB之旅更加愉快。</p><p id="aea0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过构建专用IDE TiDE，我们希望改善TiDB开发体验，让数据库爱好者更容易成为TiDB贡献者。通过让更多的程序员加入我们的社区，我们希望建立一个更好的分布式数据库。</p><p id="6a62" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我只介绍了TiDE的核心特性；还有很多要了解的。如果你有兴趣尝试TiDE，你可以跟随这个<a class="ae jx" href="https://github.com/tidb-incubator/tide/blob/master/doc/guide.md" rel="noopener ugc nofollow" target="_blank">逐步指南</a>，或者<a class="ae jx" href="https://slack.tidb.io/invite?team=tidb-community&amp;channel=tide&amp;ref=pingcap-blog" rel="noopener ugc nofollow" target="_blank">加入我们的Slack频道</a>进行讨论。此外，由于TiDE本身是一个开源项目，因此非常感谢任何贡献。您可以查看<a class="ae jx" href="https://github.com/tidb-incubator/tide#todo" rel="noopener ugc nofollow" target="_blank">我们的路线图</a>并选择一个功能。让我们一起磨刀吧！</p></div><div class="ab cl mo mp gp mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hb hc hd he hf"><p id="ed5b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mv">原载于2021年5月13日</em><a class="ae jx" href="https://pingcap.com/blog/tide-developing-a-distributed-database-in-a-breeze#how-hard-was-it-to-develop-tidb" rel="noopener ugc nofollow" target="_blank"><em class="mv">www.pingcap.com</em></a><em class="mv"/></p></div></div>    
</body>
</html>