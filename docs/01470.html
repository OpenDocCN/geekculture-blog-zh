<html>
<head>
<title>How to Add Jasmine Testing Framework Into Your NodeJS Project and Why Unit Tests Are Important</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Jasmine测试框架添加到您的NodeJS项目中，以及为什么单元测试很重要</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-add-jasmine-testing-framework-into-your-nodejs-project-and-why-unit-tests-are-important-c4ab26cfbf22?source=collection_archive---------14-----------------------#2021-04-11">https://medium.com/geekculture/how-to-add-jasmine-testing-framework-into-your-nodejs-project-and-why-unit-tests-are-important-c4ab26cfbf22?source=collection_archive---------14-----------------------#2021-04-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/23f4082c67a29f2926b4518812df35ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tMxaAII8r3SfBbf8.jpg"/></div></div></figure><h1 id="2c41" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">茉莉是什么？</h1><blockquote class="jo jp jq"><p id="bd30" class="jr js jt ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">"<a class="ae kq" href="https://jasmine.github.io/index.html" rel="noopener ugc nofollow" target="_blank"> Jasmine </a>是一个用于测试JavaScript代码的行为驱动开发框架。它不依赖于任何其他JavaScript框架。它不需要DOM。它有一个清晰、明显的语法，这样你就可以很容易地编写测试。”</p><p id="66c4" class="jr js jt ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">— <a class="ae kq" href="https://jasmine.github.io/index.html" rel="noopener ugc nofollow" target="_blank">茉莉网站</a></p></blockquote><p id="cf15" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">Jasmine是一个结合了TDD(测试驱动开发)和DDD(领域驱动设计)的框架，这意味着它有能力帮助开发人员在开发之初基于规范创建单元测试，并包含测试面向对象抽象的工具，如自定义匹配器和间谍，它还包含对其他类型的范例有用的功能，如异常测试。</p></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/c590294f35d2ed2a16a5bee06322cfa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*J0QXrUJGTVYeDfa5.jpg"/></div></div></figure><h1 id="791b" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">为什么我应该在我的项目中添加单元测试？</h1><p id="92a2" class="pw-post-body-paragraph jr js hi ju b jv lg jx jy jz lh kb kc kr li kf kg ks lj kj kk kt lk kn ko kp hb bi translated">单元测试允许验证项目中的每一段代码，它们很重要，因为它们保证了一段代码的行为按预期运行，我们项目中的单元测试越多，我们就越确定我们的项目作为一个整体按预期运行。然而，只有有意识地进行单元测试才能保证这一点，测试每段代码的不同行为，对每段代码至少有一个肯定和否定的案例，并覆盖所有的条件分支，使我们的测试在整个项目中保持一致。</p><p id="6d02" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">单元测试应该越早越好，这使得团队更愿意约束自己，而不是在项目的中间或结束时痛苦地添加它们，因为所有的代码都已经创建好了。</p><p id="df9f" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">添加单元测试也给了我们减少修复错误和重构工作量的优势，使项目更短，更容易维护，有助于交付高质量的产品。</p><p id="b355" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">就我个人而言，我认为单元测试是一种道德义务。作为一名软件工程师，你正在尽最大努力向用户交付高质量的产品，确保它的所有方面都按计划工作，与其他工程学科的测试过程进行类比(你会乘坐未经测试的飞机旅行吗？).</p><blockquote class="ll"><p id="5ce3" class="lm ln hi bd lo lp lq lr ls lt lu kp dx translated">“没有测试作为安全网，你要么在每个版本中引入大量的回归错误，要么害怕重构。”</p><p id="c3fb" class="lm ln hi bd lo lp lq lr ls lt lu kp dx translated">— <a class="ae kq" href="https://softwareengineering.stackexchange.com/questions/319846/agile-without-unit-tests/319848#319848" rel="noopener ugc nofollow" target="_blank">克里斯托夫·j·麦克莱伦</a></p></blockquote></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><figure class="lc ld le lf fd ij er es paragraph-image"><div class="er es lv"><img src="../Images/8e1f6f960e5439ee050556d3487380ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/0*SUTPXGGbooYw0v4K.png"/></div></figure><h1 id="2343" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">如何在你的项目中加入Jasmine？</h1><p id="4089" class="pw-post-body-paragraph jr js hi ju b jv lg jx jy jz lh kb kc kr li kf kg ks lj kj kk kt lk kn ko kp hb bi translated">要安装Jasmine，您可以使用以下命令:</p><pre class="lc ld le lf fd lw lx ly lz aw ma bi"><span id="48f9" class="mb ir hi lx b fi mc md l me mf"># <em class="jt">Using yarn</em><br/><strong class="lx hj">yarn</strong> add jasmine --dev</span><span id="54a5" class="mb ir hi lx b fi mg md l me mf"># <em class="jt">Using npm</em><br/><strong class="lx hj">npm</strong> install --save-dev jasmine</span></pre><p id="4ca3" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">我还建议全局安装Jasmine，以防您需要直接运行测试，为此您可以运行以下命令:</p><pre class="lc ld le lf fd lw lx ly lz aw ma bi"><span id="856a" class="mb ir hi lx b fi mc md l me mf"># <em class="jt">Using yarn</em><br/><strong class="lx hj">yarn</strong> global add jasmine</span><span id="cf99" class="mb ir hi lx b fi mg md l me mf"># <em class="jt">Using npm</em><br/><strong class="lx hj">npm</strong> install -g jasmine</span></pre><h2 id="27dc" class="mb ir hi bd is mh mi mj iw mk ml mm ja kr mn mo je ks mp mq ji kt mr ms jm mt bi translated">如何在package.json文件内部创建测试命令？</h2><p id="fd9e" class="pw-post-body-paragraph jr js hi ju b jv lg jx jy jz lh kb kc kr li kf kg ks lj kj kk kt lk kn ko kp hb bi translated">我建议以如下方式在package.json文件中创建“test”命令:</p><pre class="lc ld le lf fd lw lx ly lz aw ma bi"><span id="d5b0" class="mb ir hi lx b fi mc md l me mf">{<br/>...<br/><em class="jt">  "</em>scripts<em class="jt">"</em>: {<br/>    <em class="jt">"</em>test<em class="jt">"</em>: "jasmine --config=jasmine.json"<br/>  },<br/>...<br/>}</span></pre><p id="0b19" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">正如您在上面的代码中看到的，我们引用了一个jasmine.json文件，这意味着我们需要在项目的根目录下创建一个文件。</p><h2 id="f196" class="mb ir hi bd is mh mi mj iw mk ml mm ja kr mn mo je ks mp mq ji kt mr ms jm mt bi translated">如何创建jasmine.json文件？</h2><p id="e9ae" class="pw-post-body-paragraph jr js hi ju b jv lg jx jy jz lh kb kc kr li kf kg ks lj kj kk kt lk kn ko kp hb bi translated">jasmine.json文件有一些直接影响测试套件运行方式的属性。</p><pre class="lc ld le lf fd lw lx ly lz aw ma bi"><span id="ecb9" class="mb ir hi lx b fi mc md l me mf">{<br/>  "spec_dir": ".",<br/>  "spec_files": [<br/>    "**/*[sS]pec.js",<br/>    "!node_modules/**/*"<br/>  ],<br/>  "helpers": [<br/>    "helpers/**/*.js"<br/>  ],<br/>  "stopSpecOnExpectationFailure": false,<br/>  "random": true<br/>}</span></pre><p id="5df2" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">“spec_dir”属性指定了Jasmine将要找到单元测试的目录，在本例中我们将使用“.”选择所有项目目录。</p><p id="e4f9" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">“spec_files”属性包含一个正则表达式列表，它将帮助Jasmine查找项目中的spec文件(包含单元测试的文件)，第一个表达式查找任何带有“. spec.js”或“Spec.js”后缀的文件，如果我们想更改这个后缀，我们可以在这里进行。下一个表达式将从测试命令中删除“node_modules”目录，单元测试通常包含在这些库中。</p><p id="7030" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">您可以在这里找到关于其余这些属性<a class="ae kq" href="https://jasmine.github.io/setup/nodejs.html" rel="noopener ugc nofollow" target="_blank">的更多信息。</a></p><h2 id="5767" class="mb ir hi bd is mh mi mj iw mk ml mm ja kr mn mo je ks mp mq ji kt mr ms jm mt bi translated">如何添加一个Jasmine单元测试？</h2><p id="64c3" class="pw-post-body-paragraph jr js hi ju b jv lg jx jy jz lh kb kc kr li kf kg ks lj kj kk kt lk kn ko kp hb bi translated">要创建Jasmine单元测试，您可以遵循下一个例子，其中创建了一个名为“genetic.spec.js”的规范文件。</p><pre class="lc ld le lf fd lw lx ly lz aw ma bi"><span id="d6f7" class="mb ir hi lx b fi mc md l me mf"><strong class="lx hj"><em class="jt">const</em></strong> { generateIndividual } = <strong class="lx hj">require</strong>('./genetic');</span><span id="7cec" class="mb ir hi lx b fi mg md l me mf"><strong class="lx hj">describe</strong>('Genetic module', function() {<br/>  <strong class="lx hj">it</strong>('generateIndividuals function is wrong', <strong class="lx hj">function</strong>() {<br/>    <strong class="lx hj">const</strong> size = 8;<br/>    <strong class="lx hj">const</strong> individual = generateIndividual(size);<br/>    <strong class="lx hj">expect</strong>(individual.length).<strong class="lx hj">toBe</strong>(size);<br/>  });<br/>})</span></pre><p id="0fa0" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">前面的例子是一个基本的单元测试，它验证在执行“generateIndividual”函数时是否生成了一个包含8个元素的列表。</p><p id="cc05" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">一旦创建了这个实现，我们就可以将函数添加到“genetic.js”文件中(这是在测试的顶部导入的文件)。</p><pre class="lc ld le lf fd lw lx ly lz aw ma bi"><span id="14f9" class="mb ir hi lx b fi mc md l me mf"><strong class="lx hj">function</strong> calculateRandom(start, limit) {<br/>  return Math.floor((Math.random() * (limit + 1)) + start);<br/>}</span><span id="eecd" class="mb ir hi lx b fi mg md l me mf"><strong class="lx hj">function</strong> generateIndividual(length) {<br/>  return Array.from({ length: length }, () =&gt; {<br/>    return calculateRandom(0, 1)<br/>  });<br/>}</span><span id="d733" class="mb ir hi lx b fi mg md l me mf"><strong class="lx hj"><em class="jt">module</em></strong><em class="jt">.</em><strong class="lx hj"><em class="jt">exports</em></strong>.generateIndividual = generateIndividual;</span></pre><p id="b211" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">一旦我们完成了测试并实现了代码，我们就可以运行测试套件了。</p><h2 id="8544" class="mb ir hi bd is mh mi mj iw mk ml mm ja kr mn mo je ks mp mq ji kt mr ms jm mt bi translated">测试服怎么跑？</h2><p id="f8dc" class="pw-post-body-paragraph jr js hi ju b jv lg jx jy jz lh kb kc kr li kf kg ks lj kj kk kt lk kn ko kp hb bi translated">要运行测试套件，我们可以运行以下命令:</p><pre class="lc ld le lf fd lw lx ly lz aw ma bi"><span id="5300" class="mb ir hi lx b fi mc md l me mf"># <em class="jt">Using yarn</em><br/><strong class="lx hj">yarn</strong> test</span><span id="d9be" class="mb ir hi lx b fi mg md l me mf"># <em class="jt">Using npm</em><br/><strong class="lx hj">npm</strong> run test</span></pre><p id="d5e8" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">这会给我们一个类似这样的结果:</p><pre class="lc ld le lf fd lw lx ly lz aw ma bi"><span id="3fb1" class="mb ir hi lx b fi mc md l me mf">$ jasmine --config=jasmine.json<br/>Randomized with seed 31415<br/>Started<br/>.</span><span id="b3a0" class="mb ir hi lx b fi mg md l me mf">1 spec, 0 failures<br/>Finished in 0.011 seconds<br/>Randomized with seed 31415 (jasmine --random=true --seed=36989)<br/>✨  Done in 1.27s.</span></pre><p id="4979" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">我们可以添加另一个测试来确保“generateIndividuals”函数在没有参数的情况下正常工作。</p><pre class="lc ld le lf fd lw lx ly lz aw ma bi"><span id="a5f5" class="mb ir hi lx b fi mc md l me mf"><strong class="lx hj">const</strong> { generateIndividual } = <strong class="lx hj">require</strong>('./genetic');</span><span id="e90c" class="mb ir hi lx b fi mg md l me mf"><strong class="lx hj">describe</strong>('Genetic module', function() {<br/>  <strong class="lx hj">it</strong>('generateIndividuals function is wrong', <strong class="lx hj">function</strong>() {<br/>    <strong class="lx hj">const</strong> size = 8;<br/>    <strong class="lx hj">const</strong> individual = generateIndividual(size);<br/>    <strong class="lx hj">expect</strong>(individual.length).<strong class="lx hj">toBe</strong>(size);<br/>  });</span><span id="6ba3" class="mb ir hi lx b fi mg md l me mf">it('generateIndividuals function is wrong without params', <strong class="lx hj">function</strong>() {<br/>    <strong class="lx hj">const</strong> individual = generateIndividual();<br/>    <strong class="lx hj">expect</strong>(individual.length).<strong class="lx hj">toBe</strong>(0);<br/>  });<br/>})</span></pre><p id="dcfa" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">如果我们再次运行测试，控制台应该会给出类似如下的结果:</p><pre class="lc ld le lf fd lw lx ly lz aw ma bi"><span id="2c2a" class="mb ir hi lx b fi mc md l me mf">Randomized with seed 62831<br/>Started<br/>..</span><span id="1e96" class="mb ir hi lx b fi mg md l me mf">2 specs, 0 failures<br/>Finished in 0.015 seconds<br/>Randomized with seed 62831 (jasmine --random=true --seed=33968)<br/>✨  Done in 0.51s.</span></pre><p id="f7cc" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">现在您有了一个包含单元测试的项目，这是您构建和交付高质量产品的第一步。</p></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h1 id="f4bc" class="iq ir hi bd is it mu iv iw ix mv iz ja jb mw jd je jf mx jh ji jj my jl jm jn bi translated">结论</h1><p id="758b" class="pw-post-body-paragraph jr js hi ju b jv lg jx jy jz lh kb kc kr li kf kg ks lj kj kk kt lk kn ko kp hb bi translated">单元测试值得你花时间，它们提高了你产品的质量，帮助你成为一个更好更全面的工程师，建议你在你所有的项目中使用它们，这绝对是一个好的实践。有些情况下，在某些项目中，您的经理可能会以“节省时间”为借口告诉您不要将单元测试包括在项目中，因为您有两个选择，花时间修复在影响客户和公司信任的生产后变得昂贵的bug，或者花时间构建您可以在本地运行和验证的测试，无论哪种方式，迟早有人会发现那个讨厌的bug，并且最好是您而不是您的用户。</p><blockquote class="jo jp jq"><p id="f48f" class="jr js jt ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">“[……]作为一名软件开发人员，自动化您的重复测试可以极大地改变您的生活。自动化这些测试，你不再需要盲目地遵循点击协议来检查你的软件是否仍然正常工作。自动化你的测试，你可以毫不费力地改变你的代码库。如果你曾经尝试过在没有合适的测试套件的情况下进行大规模重构，我打赌你知道这是多么可怕的经历。如果你一路上不小心弄坏了东西，你怎么知道呢？[…]"</p><p id="eb54" class="jr js jt ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">— <a class="ae kq" href="https://martinfowler.com/articles/practical-test-pyramid.html#TheImportanceOftestAutomation" rel="noopener ugc nofollow" target="_blank">火腿之声</a></p></blockquote><p id="10c0" class="pw-post-body-paragraph jr js hi ju b jv jw jx jy jz ka kb kc kr ke kf kg ks ki kj kk kt km kn ko kp hb bi translated">我希望你喜欢这篇文章，直到下次。</p></div></div>    
</body>
</html>