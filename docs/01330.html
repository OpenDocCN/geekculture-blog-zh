<html>
<head>
<title>Integrating WSO2 APIM, API Microgateway with WSO2 Identity Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将WSO2 APIM、API微网关与WSO2身份服务器集成</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/integrating-wso2-apim-api-microgateway-with-wso2-identity-server-2eb3c91caafc?source=collection_archive---------13-----------------------#2021-04-06">https://medium.com/geekculture/integrating-wso2-apim-api-microgateway-with-wso2-identity-server-2eb3c91caafc?source=collection_archive---------13-----------------------#2021-04-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="73c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在典型的设置中，我们将WSO2 API管理器和WSO2 Identity Server集成为一个密钥管理器，因为附加组件WSO2已经引入了API Microgateway，它可以与WSO2 API管理器集成并用作网关。其中API的管理将由WSO2 API管理器来处理。</p><p id="b08d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我们将看到如何将所有这些集成在一起，并在分布式设置中使用它。</p><p id="92d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">内容</strong></p><ul class=""><li id="6efe" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">先决条件</li><li id="b211" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">设置架构</li><li id="fa30" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">建立发展环境</li></ul><p id="659c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jr">(设置OpenJDK，设置Microgateway工具包，设置API控制器，设置MySQL，设置Microgateway运行时(可选)，设置WSO2发行版，设置Docker ) </em></p><ul class=""><li id="e088" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">为WSO2设置配置数据库</li><li id="7589" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">将WSO2 APIM配置为与WSO2集成是</li><li id="73d2" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">验证WSO2 APIM和IS之间的设置</li><li id="e506" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">设置WSO2 API微网关</li><li id="47eb" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">从WSO2 API管理器导入要管理的API</li><li id="0840" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">结论</li></ul><p id="d4bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">先决条件</strong></p><ol class=""><li id="31ef" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc js jj jk jl bi translated">WSO2 APIM 3.2.0</li><li id="95dc" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc js jj jk jl bi translated">WSO2为5.11.0</li><li id="d52d" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc js jj jk jl bi translated">OpenJDK 11</li><li id="e798" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc js jj jk jl bi translated">微网关工具包3.2.0</li><li id="07b4" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc js jj jk jl bi translated">微网关3.2.0运行时</li><li id="6097" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc js jj jk jl bi translated">MySQL 5.7.33</li><li id="6180" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc js jj jk jl bi translated">API控制器— apictl 3.2.1</li></ol><p id="5f6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">设置架构</strong></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/e838f0d20c1b9e0b2e58cc3054fd8df6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ewzC3l9MHzenNKrYVK80ng.png"/></div></div></figure><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><h2 id="4fd3" class="kh ki hi bd kj kk kl km kn ko kp kq kr iq ks kt ku iu kv kw kx iy ky kz la lb bi translated">建立发展环境</h2><p id="4378" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated"><strong class="ih hj">设置OpenJDK </strong></p><p id="50e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以<a class="ae lh" href="https://jdk.java.net/archive/" rel="noopener ugc nofollow" target="_blank">下载包</a>并解压到位置，然后设置环境变量如下:</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="8130" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">设置微网关工具包</strong></p><p id="b9e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lh" href="https://wso2.com/api-management/api-microgateway/" rel="noopener ugc nofollow" target="_blank">下载</a>并解压到一个位置，设置环境变量如下:</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="c674" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">设置API控制器</strong></p><p id="ae65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lh" href="https://apim.docs.wso2.com/en/latest/learn/api-controller/getting-started-with-wso2-api-controller/" rel="noopener ugc nofollow" target="_blank">下载</a>并解压到一个位置，设置环境变量如下:</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="e756" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">设置MySQL </strong></p><p id="b8e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这次演示中，我使用的是MySQL下面的版本，根据您的需要，您可以选择一个版本，并使用标准的MySQL安装过程进行安装。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="cb77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">设置微网关运行时</strong></p><p id="5328" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们只打算部署到虚拟机中，则需要进行此设置。在这里，我将演示如何使用Docker进行部署，这种设置是不需要的。有关这方面的更多信息，可以在Microgateway运行时发行版的README.md中找到。</p><p id="e330" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">设置WSO2分布</strong></p><p id="ae81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下载并解压缩WSO2 APIM和WSO2 IS发行版，并将其解压缩到一个位置。</p><p id="ec5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">设置对接器</strong></p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><h2 id="0ed6" class="kh ki hi bd kj kk kl km kn ko kp kq kr iq ks kt ku iu kv kw kx iy ky kz la lb bi translated">为WSO2设置配置数据库</h2><p id="08c9" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">主要是apim_db、shared_db和identity_db涉及分布式设置，其他数据库将用作默认h2数据库。</p><p id="592a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下示例脚本可用于创建数据库设置。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><h2 id="ebf0" class="kh ki hi bd kj kk kl km kn ko kp kq kr iq ks kt ku iu kv kw kx iy ky kz la lb bi translated">将WSO2 APIM配置为与WSO2集成是</h2><p id="b471" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated"><strong class="ih hj"> WSO2正在配置更新</strong></p><p id="e580" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的本地设置中，我将在同一台机器上运行WSO2 APIM和，因此设置WSO2的端口偏移量为。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="9173" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置主机名</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="764b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在/etc/hosts中创建一个映射，将主机名与本地IP进行映射</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="f2f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新数据库以指向MySQL实例，这里如果我们不使用多租户，apim_db不需要在这里共享。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="9c26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从<a class="ae lh" href="https://apim.docs.wso2.com/en/3.2.0/assets/attachments/administer/wso2is-km-connector-1.0.16.zip" rel="noopener ugc nofollow" target="_blank">这里</a>下载WSO2 APIM的WSO2 IS连接器。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="0e6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将以下流量管理器配置添加到<is_home>/repository/conf/deployment . toml</is_home></p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="3141" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">配置事件侦听器。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><h2 id="7fe2" class="kh ki hi bd kj kk kl km kn ko kp kq kr iq ks kt ku iu kv kw kx iy ky kz la lb bi translated">WSO2 APIM配置更新</h2><p id="d402" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">更新主机名。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="ab1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新数据库配置，这里我们需要指定。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="fd93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在deployment.toml中将IS配置为Keymanager。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="9f49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们更新mysql数据库时，我们需要将mysql连接器添加到<apim_home> /repository/components/lib中。</apim_home></p><h2 id="78ba" class="kh ki hi bd kj kk kl km kn ko kp kq kr iq ks kt ku iu kv kw kx iy ky kz la lb bi translated">验证WSO2 APIM和IS之间的设置</h2><p id="860a" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated"><strong class="ih hj">启动WSO2是</strong></p><p id="ab01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lh" href="https://gist.github.com/ajanthanblog/4cfeb791d4036f55013490c1a0daa444" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/ajanthanblog/4c feb 791d 4036 f 55013490 C1 A0 DAA 444</a></p><p id="d084" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">启动WSO2 API管理器</strong></p><p id="e183" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lh" href="https://gist.github.com/ajanthanblog/f9b8d6e51003005d24edc5da8a0e7a55" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/ajanthanblog/F9 b8 d6e 51003005d 24 ed C5 da 8 a 0 e 7 a 55</a></p><p id="21a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">进入<a class="ae lh" href="https://wso2apimserver:9443/admin/settings/key-managers" rel="noopener ugc nofollow" target="_blank">https://WSO 2 API server:9443/admin/settings/key-managers</a>查看类型是否为:WSO2-IS。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es li"><img src="../Images/0c348f857cd30fa23e1a906c032a0f65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hmOJ89k2IxbzRNzF"/></div></div></figure><p id="88a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在WSO2 IS中创建一个用户，看看是否可以在WSO2 API管理器控制台中查看该用户。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lj"><img src="../Images/a844ca17b5f8b6a1936ac75b7bc96af9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AawGFQpsDrEyPxr9"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lk"><img src="../Images/0f597b308e55fb82bbc83b2b3e663aca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XGBOSX374Iv1V2FJ"/></div></div></figure><p id="590e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保WSO2 API管理器成功听取了以下主题。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><h2 id="86e4" class="kh ki hi bd kj kk kl km kn ko kp kq kr iq ks kt ku iu kv kw kx iy ky kz la lb bi translated">设置WSO2 API微网关</h2><p id="7810" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">开始之前，请确保您已经完成了Microgateway工具包的设置，如果没有，请参考“设置Microgateway工具包”一节。</p><ol class=""><li id="3b92" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc js jj jk jl bi translated">更新<toolkit_home>/resources/conf/micro-GW . conf文件，这是为了更改默认配置，对于我们的用例，我们需要通过WSO2 API管理器指向keymanager，以及我们可以在这里编辑并在deployment-config.toml中指定的其他配置，以便这些配置将被添加到映像中。</toolkit_home></li></ol><p id="4eaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是用于“micro-gw.conf”文件中设置的示例配置。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="51b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.准备API定义文件。这里我使用了两个API，一个是客户端凭证授权类型的安全API，具有特定的作用域，另一个是非安全API。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="c8c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.执行下面的命令来初始化和创建项目。在执行之前，我们可以传递两个文件</p><p id="6e10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">API定义文件——我们之前创建的</p><p id="0833" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">部署配置文件——这个文件我们需要更新如下。</p><p id="2bca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们使用Docker构建时，更新下面的部分，以便我们复制我们的自定义配置。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="b042" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">sl-ajanthan @ slajanthan-Latitude-3580:~/integration $ micro-GW init testapimgw-a API-definition/API-definition-sample . YAML-d deployment-config/deployment-config . YAML</p><p id="d5b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.导出WSO2 API管理器公共证书</p><p id="656a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">keytool-export-alias WSO 2 carbon-file WSO 2 carbon . CRT-keystore<api-m_home>/repository/resources/security/WSO 2 carbon . jks</api-m_home></p><p id="ad7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.将证书导入wso2am-micro-GW-toolkit-Linux-3 . 2 . 0/lib/platform/bre/security/ballerina truststore . p12</p><p id="e5db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">keytool-import-trustcacerts-alias WSO 2 PIM local-file WSO 2 carbon . CRT-keystore<toolkit_home>/lib/platform/bre/security/ballerina truststore . p12</toolkit_home></p><p id="684f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.导出WSO2 API的公共证书，并将其导入下面的信任存储。</p><p id="2316" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">keytool-export-alias WSO 2 carbon-file WSO 2 carbon-alias . CRT-keystore<api-m_home>/repository/resources/security/WSO 2 carbon . jks</api-m_home></p><p id="1c08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">keytool-import-trustscacerts-alias gateway _ certificate _ alias-file WSO 2 carbon-alias . CRT-keystore<toolkit_home>/lib/platform/bre/security/ballerina truststore . p12</toolkit_home></p><p id="60c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.执行build命令来构建映像。</p><p id="3774" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">sl-ajanthan @ slajanthan-Latitude-3580:~/integration $ micro-GW build testapimgw—docker—docker-image testapigw:v1—docker-base-image wso2/WSO 2 micro-GW:3 . 2 . 0</p><p id="9a99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.打开集装箱。</p><p id="708e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">docker run-d-p 10400:9095-p 10401:9090 testa pigw:v1</p><p id="b9f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们需要从外部文件加载配置，而不需要再次构建镜像，可以使用下面的命令:</p><p id="77b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">docker run-p 10400:9095-p 10401:9090-v<host_path_to_micro-gw.conf_dir>:/home/ballerina/conf testa pigw:v1</host_path_to_micro-gw.conf_dir></p><p id="95b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9.验证微网关</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="bf27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，通过调用非安全端点，我们可以检查请求是否通过微网关处理。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ll"><img src="../Images/a827c5eb1c3fa9aa3bbfded80feb6777.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2OkWPlaWvgxYO5En"/></div></div></figure><p id="afe1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是当您尝试使用安全端点时:</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lm"><img src="../Images/b62fc878b9a34175707f2c4c5d1c210e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aGdJpi57qpxg9opF"/></div></div></figure><p id="6aca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">10.为了调用安全端点，我们需要将API定义导入到WSO2 APIM，并从那里管理它。为了简化这个过程，WSO2引入了API控制器。</p><h2 id="9dc5" class="kh ki hi bd kj kk kl km kn ko kp kq kr iq ks kt ku iu kv kw kx iy ky kz la lb bi translated">从WSO2 API管理器导入要管理的API</h2><ol class=""><li id="d946" class="jd je hi ih b ii lc im ld iq ln iu lo iy lp jc js jj jk jl bi translated">希望已经完成了“设置API控制器”</li><li id="7b03" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc js jj jk jl bi translated">完成(1)后，执行下面的命令来设置环境变量。</li></ol><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="12ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.检查您是否可以登录系统。</p><p id="4714" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lh" href="https://gist.github.com/ajanthanblog/ee71ba987f544f81c7f0804f1c767d47" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/ajanthanblog/ee 71 ba 987 f 544 f 81 c 7 f 0804 f1 c 767d 47</a></p><p id="f389" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.初始化要为导入创建的项目。</p><p id="58cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lh" href="https://gist.github.com/ajanthanblog/b63979460bf9161b25c71b7731c5f63c" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/ajanthanblog/b 63979460 BF 9161 b 25 c 71 b 7731 C5 f 63 c</a></p><p id="afba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.转到新创建的项目“testapiimport”并更新<home>/testapi import/Meta-information/API . YAML</home></p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="kf kg l"/></div></figure><p id="1d9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.导入API</p><p id="a3da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">apictl导入-api -f测试api导入-e开发-k</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lq"><img src="../Images/919fe516599f8b6f99876014fc5c360c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/0*O_WGQ8aYycWfoLey"/></div></figure><p id="fcd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.创建应用程序并订阅API</p><p id="348f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.生成不记名令牌。</p><p id="9bd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9.使用不记名令牌调用安全端点。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lr"><img src="../Images/3dcacba3b91491657b16cd48e12a6a3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GZi5IrqOpQVAtQG5"/></div></div></figure><p id="3a36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">10.检查Microgateway的日志，看API调用是否通过。</p><h2 id="c31c" class="kh ki hi bd kj kk kl km kn ko kp kq kr iq ks kt ku iu kv kw kx iy ky kz la lb bi translated">结论</h2><p id="b4ac" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">这篇文章解释了一个基本的设置，我们可以用WSO2 APIM，WSO2是和WSO2微积分器。利用这种理解，我们可以扩展架构以满足高可用性，并且在API定义上，我们可以使用openAPI规范添加其他OAuth2.0授权类型以供进一步使用。</p></div></div>    
</body>
</html>