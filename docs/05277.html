<html>
<head>
<title>Classical Time Series Forecast in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的经典时间序列预测</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/time-series-forecast-in-python-5c4c61e1c2c2?source=collection_archive---------0-----------------------#2021-07-17">https://medium.com/geekculture/time-series-forecast-in-python-5c4c61e1c2c2?source=collection_archive---------0-----------------------#2021-07-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="42f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用经典时间序列分析方法的示例(SARIMA)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/35ede31bac08c103f4047ff4d0855761.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GLbQmKG8HdWmZlhF"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@des0519?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">泽涵 白</a> on <a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="62f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博客中，我解释了如何用python来做一个简单的单变量时间序列预测。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="2ef5" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">介绍</h1><p id="26d1" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">时间序列通常被定义为一个或多个变量在连续时间段内的一系列值。例如，连续几年的销售量、一个城市几个月的平均温度等。如果该序列只涉及一个变量，则称为单变量时间序列。如果该序列列出了多个变量在不同时间点的值，则称为多元时间序列。在这个博客的例子中，我们将处理一个单变量时间序列。</p><p id="e762" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">连续的时间点称为时间步长。例如，每个时间步长可以是1到12个月或1到31天或一系列年份等。</p><p id="2a12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在时间序列中，变量的值随时间步长上下波动，其组成如下。</p><p id="eeec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">趋势</strong> -趋势是数据值在一段时间内一致的长期向上或向下的运动。例如，增加季度销售额或利润。</p><p id="8970" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">季节性因素- </strong>一个日历年内趋势的反复向上或向下变动，如季节、季度、月份等。最受欢迎的例子之一是排灯节、圣诞节等节日期间的小玩意销售高峰。</p><p id="f404" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">周期性成分- </strong>围绕趋势线波动，重复之间的持续时间超过一年。与季节性因素不同，周期性波动的周期不是恒定的。例如，由于经济衰退、失业等原因导致的业务指标波动。</p><p id="2911" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">噪声或不规则成分</strong> -服从平均值为零且方差恒定的正态分布的随机不相关变化(也称为白噪声)。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="7ee5" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">时间序列预测</h1><p id="7374" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated"><em class="ju">时间序列预测是根据一个变量过去的值来预测其未来的值。例如，预测股票价格值、产品收入、未来一周或一个月城市的平均温度等。</em></p><p id="cadc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回归问题和时间序列预测的区别在于——在回归中，我们考虑不同的独立特征并预测一个从属目标变量的值。例如，根据房屋面积、房间数量、停车位等预测房价。但在时间序列的情况下，我们通常没有其他独立的特征，相反，我们只有我们想要预测的同一变量的过去值。</p><p id="70f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，时间序列预测采用不同于线性回归问题的统计/分析方法。</p><p id="b3c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在深度学习神经网络，特别是递归神经网络流行之前，有许多经典的分析方法/算法用于时间序列预测- <strong class="ih hj"> AR，MA，ARMA，ARIMA，SARIMA等。</strong>由于其有效性以及在大量数据不可用的情况下(这些数据对于训练rnn至关重要),它们甚至在今天仍在使用。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="30fd" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">了解时间序列概念的基础</h1><p id="6619" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">作为初学者，我第一次发现理解时间序列分析的基础很难或者很无聊，尽管有大量的资源可供参考。但是如果我们坚持并花费足够的时间，我们也可以理解其中的概念和数学(尽管我们可以根据自己的胃口和耐心来选择数学部分)。经过一番搜索，我发现这个特别的Y <a class="ae jt" href="https://www.youtube.com/watch?v=ZoJ2OctrFLA&amp;list=PLvcbYUQ5t0UHOLnBzl46_Q6QKtFgfMGc3" rel="noopener ugc nofollow" target="_blank"> ouTube系列</a>对理解时间序列分析概念和算法非常有帮助。为了欣赏这个博客中解释的例子和概念，我建议你先看视频系列，如果你是时间序列分析的初学者。</p><p id="b7cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，现在让我们进入这篇博客的主要部分——使用python的单变量时间序列分析…</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="dee8" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">使用python进行单变量时间序列分析的分步示例</h1><h2 id="fe00" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated"><strong class="ak">数据集</strong></h2><p id="ceeb" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated"><a class="ae jt" href="https://trends.google.com/trends/?geo=IN" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Google Trends </strong> </a>是谷歌旗下的一个网站，该网站分析了各种地区和语言的谷歌搜索中热门搜索查询的受欢迎程度。该网站使用图表来比较不同查询的搜索量。对于给定的搜索词，这些数字表示在所选地区和时间内相对于图表最高点的搜索兴趣。值100是该术语的最高流行度，而值50意味着该术语的流行度减半。</p><p id="d5cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以下载一段时间内在谷歌中搜索的任何特定术语的“搜索得分”的时间序列数据，作为一个csv文件。</p><p id="52f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这个例子<strong class="ih hj">，我下载并使用了术语“Python”(在编程语言的上下文中)的搜索分数的时间序列，历时五年</strong>，并尝试基于数据构建一个时间序列预测ML模型。</p><h2 id="7dc5" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated">密码</h2><p id="627c" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">这个练习的完整笔记本代码可以从我的<a class="ae jt" href="https://github.com/raja-surya/Time-Series" rel="noopener ugc nofollow" target="_blank"> github链接</a>下载。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="539b" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">让我们开始分析</h1><h2 id="2629" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated"><strong class="ak"> 1。导入基本Python库并从csv文件加载数据</strong></h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/d490bef3bdaece0fdb9df29c8338a246.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O1VsdYiPFiwdh1H7krq91A.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lu"><img src="../Images/a6ef479ceca5ee79a760e68bc31de2f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*f89a7l-sKlyec6MOqHJ-JA.png"/></div></figure><p id="d137" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如上所述，该数据包含从2016年7月10日至2021年7月4日(5年，即261周)期间，全球范围内“工作与教育”类别中术语“Python”的每周“搜索得分”。</p><h2 id="25a5" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated"><strong class="ak"> 2。探索性数据分析</strong></h2><p id="8f5b" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">我们做了一些基本的清理，将week列转换为Pandas datetime类型，然后分别提取年、月和日(请参考笔记本中的这些步骤)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/e56d3f55969f0999cb04199c0c699733.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*RiMwumaC426MkVDlcVeE_g.png"/></div></figure><p id="10c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将做一些基本的探索性分析。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/5d03dd9a0852f980601e460c10ea6249.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q0qicsB-qXcmsbqac9uj-Q.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Month Wise Trend</figcaption></figure><p id="9bed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有月份的平均搜索分数几乎保持不变。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lx"><img src="../Images/422051d2b8deae575ace115b62f7f7f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*NMJuWzhOYryDLYF5wsAYUg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx">Year Wise Trend</figcaption></figure><p id="509a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2016-2020年搜索得分有明显上升趋势。2021年看起来和2020年差不多。<br/>然后我们将绘制时间序列，看看它看起来如何。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/5debcb1be2abda4fb77ebb590e5575f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aBbwl4iQUQEIETj1byIIig.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Weekly Time Series Data For Five Years</figcaption></figure><p id="b8dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从2016年到2020年有一个<strong class="ih hj">明显的上升趋势，然后剧情稳定下来。</strong></p><h2 id="dab1" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated"><strong class="ak"> 3。建模</strong></h2><p id="3e40" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">由于每周时间序列看起来有点混乱，我们可以将其聚合并转换为每月序列。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lz"><img src="../Images/4ee8d0450f51f04631741ce5739f7bd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*Kjs1-TYr8db3N612kPdolQ.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ma"><img src="../Images/ab4a694a202818bb63f178ef55627e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M6wfIf6_TgCe2_ucqzmOoQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Monthly Time Series Data For Five Years</figcaption></figure><p id="c16b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">我们在时间序列中看到一些季节性模式和一个上升趋势，直到2019年底</strong>之后趋于平缓。</p><p id="9586" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为简单起见，我们将选取2017年1月1日至2020年1月1日的有限数据进行进一步分析和建模。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mb"><img src="../Images/a7d2ed76264321e915091ce892f176c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pu6ktnQK5NR5Xu00I-1-9g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Limited Time Series Plot</figcaption></figure><h2 id="6a87" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated"><strong class="ak">平稳性</strong></h2><p id="d7e6" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">因为我们看到时间序列有上升趋势，所以它不是静止的。</p><p id="034c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">满足以下三个条件的时间序列是平稳的。</strong></p><p id="7c61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.一段时间内序列的平均值是常数<br/> 2。时间序列的方差是常数。<br/> 3。没有季节性。</p><p id="f5ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经典的时间序列建模技术，如AR(自回归)、MA(移动平均)、ARMA (AR + MA)等。，如果时间序列没有平稳性就行不通。</p><p id="4509" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们必须通过以下方法来检验级数的平稳性</p><p id="a03c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.如上所述目视检查地块。<br/> 2。先进的测试方法，如我们下面要做的Dickey Fuller测试。</p><h2 id="2a8d" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated"><strong class="ak"> 3.1测向测试</strong></h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mc"><img src="../Images/08a8ef65173c64766d56fd67398f2151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hl3MMzvkoFHviBmXBVpRLQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">DF Test Results</figcaption></figure><p id="a4b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们从statsmodels库中导入adfuller并进行如上所示的平稳性测试。<br/> p值为0.91，显著高于预期值(&lt; 0.05)。根据DF检验，零假设是给定的时间序列不是平稳的。<strong class="ih hj">高p值支持零假设</strong>。这证明了我们的时间序列不是平稳的。</p><h2 id="5b6e" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated"><strong class="ak"> 3.2一阶差分</strong></h2><p id="b6f6" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">我们必须先去除趋势，使时间序列平稳。我们可以通过<strong class="ih hj">差分技术</strong>来做到这一点。这种技术采用每个时间步长的值与其对应的前一个时间步长的值之间的差值。例如，一阶差分是减去每个时间步长(t)的值和时间步长(t-1)的值。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/fcc1609d86002c8d1e60a8dd409869b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rb0MOlKP856iOS5lWge2NQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">First Difference</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es me"><img src="../Images/bbde6aa7fd9e26b6513e0594c0b51377.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ohXpZ4ugzSPPEtglxDpyw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Plot of the First Difference</figcaption></figure><p id="f41a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个差分序列看起来具有恒定的均值和方差，以零为中心(尽管方差不是完全恒定的)。让我们对这些数据进行DF测试。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mf"><img src="../Images/2ac9ccd230423a0253285df0a6340a28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*RaMTRGxid7Ooc7UPSafTBg.png"/></div></figure><p id="f1e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在p值非常低，表明差分时间序列是平稳的。</p><p id="dc3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还可以分别分解趋势、季节性、残差(噪声)分量，并使用statsmodels api提供的seasonal_decompose()方法进行可视化。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mg"><img src="../Images/50a64d8fa2aef690fe6cee77d9de9d27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E3ncd2Iy-Z5xeRxd0KchuQ.png"/></div></div></figure><p id="3c69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在原始时间序列中看到了上升趋势和明显的季节性(重复模式)。残差看起来正态分布在零附近，这很好。</p><h2 id="dfae" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated"><strong class="ak">时间序列建模的萨里玛算法</strong></h2><p id="fff2" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">由于我们在原始时间序列<br/> <strong class="ih hj">中看到了季节性和趋势，我们将使用SARIMA算法，它代表季节性ARIMA(季节性自动回归综合移动平均)</strong></p><p id="9405" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">S-AR-I-MA是ARIMA的变体(它依次是AR和MA的组合，中间有一个“I”，代表“集成”)。</p><p id="4227" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它有两组参数——非季节性的(P，D，Q)和季节性的(P，D，Q，m)。</p><p id="0187" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以把萨里玛训练成</p><p id="11d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 1。季节性</strong></p><p id="1759" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该算法通过我们输入的一些参数(P，D，Q，m)来考虑时间序列的季节性。</p><p id="d913" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。AR-自回归</strong></p><p id="2a29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种预测方法假设任何时间步长t的值都可以计算为涉及一个或多个先前时间步长中相同序列的值的回归(这被称为Auto即它自己的先前值)。这些时间步长的数量称为AR滞后(用参数p表示)。</p><p id="b4e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。I- Integrated <br/> </strong> <br/>差分是为了消除趋势和实现平稳性。差分的顺序由参数d给出。在我们的例子中，d=1，因为我们做第一次差分。</p><p id="3f2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 4。MA-移动平均<br/> </strong> <br/>这种预测方法假设任何时间步长t的值都可以计算为一个回归值，其中包含以前时间步长的误差(在预测中)。这些时间步长的数量称为MA滞后(用q参数表示)。</p><p id="31e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参数(P，D，Q)是P，Q和D的季节性对应物。<br/>‘m’是季节性重复的时间步长数(例如，如果一个时间步长为一个月，则为12个月，季节性模式重复持续一年)。p是季节性AR滞后，Q是季节性MA滞后，D是季节性差序。</p><p id="67bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从我们之前看到的时间序列和季节性图中，我们可以观察到m = 12(一年)。</p><h2 id="8b6c" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated"><strong class="ak"> 3.3 ACF和PACF分析</strong></h2><p id="95b3" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">为了确定p和q，我们需要分别绘制PACF(部分自相关函数)和ACF(自相关函数),这是我们接下来要做的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mh"><img src="../Images/e6e224ccb57e54b0f041e1c39ce4d2ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MFEZfkfEfxdo-p5yDwKAKA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">ACF Plot</figcaption></figure><p id="abe7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图中的每个棒对应于从0开始的滞后(其最大相关性为1，因为它是时间步长值与其自身的相关性)。</p><p id="ada8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从ACF来看，滞后1 (t-1)和2 (t-2)对于MA (q参数)来说是显著的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mi"><img src="../Images/c2975c9f67f4516618fc5f54851eb420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*DHBxE-QTMdg_A8waomK_4Q.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx">PACF Plot</figcaption></figure><p id="f16d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图中的每个棒对应于从0开始的滞后(其最大相关性为1，因为它是时间步长值与其自身的相关性)。</p><p id="ea9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从PACF看来，滞后1 (t-1)和2 (t-2)对AR (p参数)是显著的。下一个滞后10太远，但表明季节性模式。</p><p id="3a4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们进一步使用高级算法之前，让我们建立一个基线模型(基于霍尔特温特斯算法)</p><h2 id="e012" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated"><strong class="ak"> 3.4基线模型—霍尔特温特斯算法</strong></h2><p id="283e" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">霍尔特温特斯方法背后的想法是，除了水平和趋势之外，对季节成分应用指数平滑。<br/>我们首先将时间序列分割成基于日期的训练和测试数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mj"><img src="../Images/d66d36ff9bb00742c797acaac8dfadd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-1K81KKFOwXV3DJ9NVq_kw.png"/></div></figure><p id="fcc9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们有最近6个月的数据作为预测的测试数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mk"><img src="../Images/dc5de53ba774061b836aa797b7ad1fd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ujFZy9hGNSYXqX5voRALHA.png"/></div></div></figure><p id="6e71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如上所示，我们使用statsmodels的指数平滑()来创建Holt Winters模型，然后将其用于预测。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ma"><img src="../Images/bce2beef47369294ded360d63004ad94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1rDBIhhyHZepumcgPjYrDw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Holt Winters Model Forecast</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ml"><img src="../Images/fd5289f208f55c150f5e1c376470d4a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YTl56FZ_RaqMOKeZtUx3Jg.png"/></div></div></figure><p id="6950" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到Holt Winters模型在一定程度上捕捉到了预测中测试数据的形状。MAPE(平均绝对百分比误差)被视为11%。</p><h2 id="9c57" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated"><strong class="ak"> 3.5找到萨里玛的最佳参数——P，Q和P，Q </strong></h2><p id="eddc" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">我们将使用自动ARIMA方法来自动调整/找到最佳的P，Q和P，Q</p><p id="3bb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们设d=1(第一差)，D也为1。</p><p id="c399" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ju">作为一般规则，设置模型参数，使D永远不会超过1。并且总差值‘D+D’从不超过2。如果你的模型有季节性成分，尽量只保留SAR或SMA项。礼貌- </em> <a class="ae jt" href="https://www.machinelearningplus.com/time-series/arima-model-time-series-forecasting-python/" rel="noopener ugc nofollow" target="_blank"> <em class="ju">本文</em> </a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mm"><img src="../Images/1b765d8059180564304a0c7b4b2d3c3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*buIPfMT0jnb8pIB0fOIRDA.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mn"><img src="../Images/1f2d5fd6da24f77285c2f34e3109682e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KjPEMSfX6ZN_A-tIuHx_4g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Auto ARIMA Results</figcaption></figure><p id="d295" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如在上面的输出中观察到的，自动ARIMA选择的最佳模型是</p><p id="bccf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最佳模型:ARIMA(2，1，0)(0，1，0)[12]</p><p id="af44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">p=2，d=1，q=0 <br/> P=0，D=1，q=0，m=12</p><h2 id="d8f9" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated">3.6 SARIMA模型培训和预测</h2><p id="da68" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">让我们使用自动ARIMA选择的这些参数值来拟合SARIMA模型，并绘制预测和残差(预测中的误差)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mo"><img src="../Images/0fe54c24965e73882a923f7f30261f22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-AuQ2h8tC_GtmviILvKIRQ.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mp"><img src="../Images/cb2b799bffd0577ed3198fa8d6ca1bd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5VUZzr6RIAa2EXnlDHn-6w.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mq"><img src="../Images/a0d5b6aa8e8b62542d136920457e09b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wXyoBCSN1O3oQZ4Xs0THqw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Residuals Plot</figcaption></figure><p id="cb67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">理想情况下，残差的平均值应该是0，但是我们看到它是4.5，这还不错..</p><p id="54ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们将看到SARIMA模型所做的预测。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="ab fe cl mr"><img src="../Images/ad913a6137789558881548ef75c89307.png" data-original-src="https://miro.medium.com/v2/format:webp/1*JIJdui7GCm7L31kDm1ntyA.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/12905c654ecf3810872129cb41565e09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ENoUHYmao4JjS0YjSr4NRg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">SARIMA Model Forecast</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mt"><img src="../Images/9bd7df8c84bd4e597b0c92376c37211f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tEaWUpM9e8zqtc5PvXU3Cg.png"/></div></div></figure><h2 id="7154" class="lf kd hi bd ke lg lh li ki lj lk ll km iq lm ln kq iu lo lp ku iy lq lr ky ls bi translated">预测看起来不错，相当接近原始时间序列的形状！</h2><p id="94aa" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">我们得到了接近6%的MAPE，这比给出11%的基线模型好得多。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="4d8e" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">结论</h1><p id="628b" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">我们看到了如何使用名为SARIMA的经典时间序列预测方法来建模和预测时间序列。在我的下一篇博客中，我将计划采用另一个时间序列示例，并解释深度学习(RNN / LSTM)如何用于预测，而不必担心趋势、季节性因素等复杂性。我们必须用时间序列预测的经典方法。</p></div></div>    
</body>
</html>