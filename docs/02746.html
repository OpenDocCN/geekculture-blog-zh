<html>
<head>
<title>Adding Google Mobile Ads (Admob) to your SwiftUI app in iOS 14.5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS 14.5中将谷歌移动广告(Admob)添加到您的SwiftUI应用中</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/adding-google-mobile-ads-admob-to-your-swiftui-app-in-ios-14-5-5073a2b99cf9?source=collection_archive---------5-----------------------#2021-05-25">https://medium.com/geekculture/adding-google-mobile-ads-admob-to-your-swiftui-app-in-ios-14-5-5073a2b99cf9?source=collection_archive---------5-----------------------#2021-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="eea2" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">将Google Mobile Ads SDK的v8添加到SwiftUI应用程序并为iOS 14.5做准备的指南。</h2></div><h1 id="62d4" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">介绍</h1><p id="7f04" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">随着越来越多的应用程序使用SwiftUI构建，我想提供一种简单的方法将Admob集成到您的应用程序中。在本指南中，你将确切地了解一切是如何工作的。如果你想直接将代码拖放到你的应用程序中，那也是可行的！(<a class="ae kl" href="https://github.com/patrickhaertel/SwiftUIMobileAds" rel="noopener ugc nofollow" target="_blank">https://github.com/patrickhaertel/SwiftUIMobileAds</a></p><p id="f1c1" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">我曾计划将它作为Cocoapod发布，这样集成起来会更容易，但是我遇到了一些问题。如果这些问题得到解决，请查看前面提到的GitHub链接以获得安装说明。</p><p id="c2d8" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">看看这个，看看它与SwiftUI的集成有多好:</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es kr"><img src="../Images/d74fdab9fc631219c6c712ee80703178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*owJpkqpXu6_xYPPcrBRXXQ.gif"/></div></figure></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><h1 id="7909" class="ix iy hi bd iz ja lg jc jd je lh jg jh io li ip jj ir lj is jl iu lk iv jn jo bi translated">我们开始吧</h1><h2 id="eeda" class="ll iy hi bd iz lm ln lo jd lp lq lr jh jy ls lt jj kc lu lv jl kg lw lx jn ly bi translated">设置Google移动广告SDK</h2><p id="b0c8" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">为Admob准备您的应用程序并不是一个小步骤，但我会带您完成它。请务必在这里参考谷歌的官方文档<a class="ae kl" href="https://developers.google.com/admob/ios/quick-start" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="815a" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">在您的Admob仪表板中创建新应用程序。请保存您的应用标识符，因为您稍后会用到它。</p><p id="c7af" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">使用Cocoapods导入SDK</p><pre class="ks kt ku kv fd lz ma mb mc aw md bi"><span id="2373" class="ll iy hi ma b fi me mf l mg mh">pod 'Google-Mobile-Ads-SDK'</span></pre><p id="4041" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">在这里按指定<a class="ae kl" href="https://developers.google.com/admob/ios/quick-start" rel="noopener ugc nofollow" target="_blank">更新你的info.plist文件。你需要提供<strong class="jr hj">skadnetworkkitems</strong>，这样即使你的用户在iOS 14.5中没有选择应用追踪，你仍然可以向他们显示相关广告。除了那些键，你还需要设置你的<strong class="jr hj"> App传输安全</strong>设置，如下所示。</a></p><pre class="ks kt ku kv fd lz ma mb mc aw md bi"><span id="3cee" class="ll iy hi ma b fi me mf l mg mh">&lt;key&gt;NSAppTransportSecurity&lt;/key&gt; <br/>&lt;dict&gt;     <br/>    &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;<br/>    &lt;true/&gt;<br/>    &lt;key&gt;NSAllowsArbitraryLoadsForMedia&lt;/key&gt;<br/>    &lt;true/&gt;<br/>    &lt;key&gt;NSAllowsArbitraryLoadsInWebContent&lt;/key&gt;<br/>    &lt;true/&gt;<br/>&lt;/dict&gt;</span></pre><p id="2aa3" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">这样一来，我们终于可以开始编码了。你需要做的第一件事是初始化谷歌移动广告SDK。因为我们正在为SwiftUI构建，所以我将使用SwiftUI生命周期。如果您喜欢应用程序代理，您可以在<strong class="jr hj">ApplicationDidFinishLaunchWithOptions</strong>中完成此操作。</p><figure class="ks kt ku kv fd kw"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="5c4f" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">厉害！SDK现在已经初始化。我们剩下的就是制作视图。</p><h2 id="1b4b" class="ll iy hi bd iz lm ln lo jd lp lq lr jh jy ls lt jj kc lu lv jl kg lw lx jn ly bi translated">横幅广告(自适应)</h2><p id="07ed" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我们可以从为BannerAd创建一个<strong class="jr hj"> UIViewController </strong>开始。</p><figure class="ks kt ku kv fd kw"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="d454" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">要在SwiftUI中使用您新创建的<strong class="jr hj"> UIViewController </strong>，您需要创建一个<strong class="jr hj">uiviewcontrollerpresentable</strong>。</p><figure class="ks kt ku kv fd kw"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="7c25" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">现在，您的横幅广告是一个SwiftUI视图，但我们仍需要进行一些设置，以便您可以将其添加到您的应用程序中。让我们创建一个名为<strong class="jr hj"> SwiftUIBannerAd </strong>的新SwiftUI视图。此视图将管理您的广告的位置和框架。</p><figure class="ks kt ku kv fd kw"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="5b09" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">就是这样！您可以将您的广告添加到您的应用程序中。我建议你把它放在a <strong class="jr hj"> ZStack </strong>的最高级别。(参考开头的例子)</p><p id="f8a2" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">测试您的广告时，请确保将<strong class="jr hj"> adUnitId </strong>设置为横幅测试广告单元Id:</p><pre class="ks kt ku kv fd lz ma mb mc aw md bi"><span id="fb6c" class="ll iy hi ma b fi me mf l mg mh">ca-app-pub-3940256099942544/2934735716</span></pre><p id="9327" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">你可能已经注意到我使用<strong class="jr hj">通知中心</strong>和<strong class="jr hj"> UIApplication </strong>来获取安全区域和方向。虽然你可以使用<strong class="jr hj"> GeometryReader </strong>来做到这一点，但我不建议将其用于生产应用。在测试我自己的SwiftUI应用程序<a class="ae kl" href="http://www.widgetubeapp.com" rel="noopener ugc nofollow" target="_blank"> WidgeTube </a>时，我发现<strong class="jr hj"> GeometryReader </strong>对于生产来说根本不可靠。太多时候，它是SwiftUI的属性图崩溃的根源。虽然有些人已经找到了避免这种情况的方法，但是通过试验视图堆栈的顺序，我决定最好完全避免使用<strong class="jr hj"> GeometryReader </strong>。</p><h2 id="f23d" class="ll iy hi bd iz lm ln lo jd lp lq lr jh jy ls lt jj kc lu lv jl kg lw lx jn ly bi translated">间隙广告</h2><p id="54b2" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">首先，我们需要创建一个<strong class="jr hj">interstilladobject</strong>。这个对象将处理你的应用程序中的插播广告的加载。</p><figure class="ks kt ku kv fd kw"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="139d" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">我们现在将使用这个对象来创建一个<strong class="jr hj">interstilladview</strong>。这个视图将会是一个UIViewControllerRepresentable以及一个GADFullScreenContentDelegate。</p><figure class="ks kt ku kv fd kw"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="1205" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">稍后，我们将创建全屏修改器来呈现这个视图。现在，我们将留下我们所拥有的，并创建奖励广告(如果你没有创建奖励广告，跳到全屏修改器)。</p><p id="1eaa" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">测试时，使用间隙测试ad单元id:</p><pre class="ks kt ku kv fd lz ma mb mc aw md bi"><span id="7126" class="ll iy hi ma b fi me mf l mg mh">ca-app-pub-3940256099942544/4411468910</span></pre><h2 id="cac2" class="ll iy hi bd iz lm ln lo jd lp lq lr jh jy ls lt jj kc lu lv jl kg lw lx jn ly bi translated">奖励广告</h2><p id="fad2" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">制作有回报的广告几乎和插播广告一样。唯一的区别是，对于奖励广告，我们需要创建一个函数，当奖励被授予时，该函数将运行。</p><p id="8a58" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">就像插播广告一样，我们需要创建一个<strong class="jr hj">rewarded object</strong>来处理广告的加载。</p><figure class="ks kt ku kv fd kw"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="affc" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">现在，我们将使用这个对象来创建<strong class="jr hj"> RewardedAdView </strong>。</p><figure class="ks kt ku kv fd kw"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="8d1f" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">现在我们有了自己的视图，我们需要一种简单的方法在应用程序中展示它们。为此，我们将创建一个类似于<strong class="jr hj">的自定义修改器。sheet() </strong>修改器。</p><p id="cbf4" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">测试时，使用奖励的测试广告单元id:</p><pre class="ks kt ku kv fd lz ma mb mc aw md bi"><span id="58a4" class="ll iy hi ma b fi me mf l mg mh">ca-app-pub-3940256099942544/1712485313</span></pre><h2 id="726b" class="ll iy hi bd iz lm ln lo jd lp lq lr jh jy ls lt jj kc lu lv jl kg lw lx jn ly bi translated">全屏修改器</h2><p id="c689" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">让我们从创建将由修改器创建的视图开始。</p><figure class="ks kt ku kv fd kw"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="5494" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">现在，我们需要做的最后一件事是添加修饰符本身。</p><figure class="ks kt ku kv fd kw"><div class="bz dy l di"><div class="mi mj l"/></div></figure><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es mk"><img src="../Images/c0bf091cd240abc42e117cc52efa40de.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/format:webp/0*_tZ-1kIP1TR1lFum.png"/></div></figure><p id="94eb" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">恭喜，就是这样！现在，您可以轻松地将Admob/Google移动广告集成到您的SwiftUI应用程序中，如下所示。</p><figure class="ks kt ku kv fd kw"><div class="bz dy l di"><div class="mi mj l"/></div></figure></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><h1 id="d6b0" class="ix iy hi bd iz ja lg jc jd je lh jg jh io li ip jj ir lj is jl iu lk iv jn jo bi translated">信用</h1><p id="e470" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">灵感来自迈克尔·巴尼的这篇文章。</p><p id="5bc6" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">我在创建我的应用程序<a class="ae kl" href="http://www.widgetubeapp.com" rel="noopener ugc nofollow" target="_blank"> WidgeTube </a>时学会了如何做这件事。</p></div></div>    
</body>
</html>