<html>
<head>
<title>Are you a Beginner in Trading? Build your First Trading strategy with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你是交易的初学者吗？用Python建立你的第一个交易策略</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/are-you-a-beginner-in-trading-build-your-first-trading-strategy-with-python-95fef3b313ab?source=collection_archive---------2-----------------------#2022-03-30">https://medium.com/geekculture/are-you-a-beginner-in-trading-build-your-first-trading-strategy-with-python-95fef3b313ab?source=collection_archive---------2-----------------------#2022-03-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ffcfba6d5c3a6c4ab249cdf28edb8c32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4S2S2LeSaRKm0yJYojwuvw.jpeg"/></div></div></figure><p id="17bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你是交易界的新手，你肯定想知道什么时候你方便购买，或者，当你进入市场时，你应该注意什么指标？ <br/>使用Python和Plotly，您可以建立自己的第一个交互式交易策略，这样分析您的行为就不是一场噩梦了！</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h2 id="6392" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jb kg kh ki jf kj kk kl jj km kn ko kp bi translated">导入Python库</h2><p id="5dfe" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">首先，我们将导入熊猫库和<a class="ae kv" href="https://plotly.com/python/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>库进行可视化。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="dc06" class="jv jw hi lb b fi lf lg l lh li"><strong class="lb hj">#1 Import pandas</strong><br/>import pandas as pd<br/>import numpy as np<br/>from pandas_datareader import data as pdr<br/>import datetime as dt<br/>from datetime import date, timedelta</span><span id="5fb7" class="jv jw hi lb b fi lj lg l lh li"><strong class="lb hj">#2 For Plotly</strong><br/>import matplotlib.pyplot as plt<br/>import plotly.graph_objects as go<br/>import plotly.express as px<br/>import plotly.io as pio<br/>pio.templates</span><span id="a80d" class="jv jw hi lb b fi lj lg l lh li">import yfinance as yf</span></pre><p id="596c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，我们将需要通过<strong class="is hj"> yfinance </strong>连接到雅虎金融API，该API实时提供关于加密和其他金融工具的广泛数据。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h2 id="61fc" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jb kg kh ki jf kj kk kl jj km kn ko kp bi translated">加载财务数据</h2><p id="3500" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">为了获得我们感兴趣的股票的数据，我们将要求输入交易股票代码，并将它保存在变量<strong class="is hj"> <em class="lk">股票</em> </strong>(您可以在这里查阅一些符号<a class="ae kv" href="https://finance.yahoo.com/lookup/" rel="noopener ugc nofollow" target="_blank">)。然后，我们将需要以<strong class="is hj"> <em class="lk"> datatime </em> </strong>格式(“年-月-日”)指定要分析的日期范围，以最终在dataframe中收集数据。</a></p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="b278" class="jv jw hi lb b fi lf lg l lh li">yf.pdr_override()</span><span id="5e77" class="jv jw hi lb b fi lj lg l lh li"><strong class="lb hj">#1 Asking for stock symbol</strong><br/>stock = input ("Enter a stock ticker symbol: ")<br/>print(stock)</span><span id="e13a" class="jv jw hi lb b fi lj lg l lh li"><strong class="lb hj">#2 Set date</strong><br/>start = dt.datetime(2021,1,1)<br/>now=dt.datetime.now()<br/>df = pdr.get_data_yahoo(stock, start, now)</span><span id="93d7" class="jv jw hi lb b fi lj lg l lh li">df.round(2)</span></pre><p id="c112" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">获得的输出包含股票价格变量和每天的交易量。在本例中，我们将使用符号“TQQQ”的数据，从2021年1月1日到当前日期。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/9e00a4b624c87a3471ee7e08cbc96106.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A6-mbSrfF1PKrBEPoLfifA.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx">Output of price variables for “TQQQ” stock</figcaption></figure></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h2 id="48a2" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jb kg kh ki jf kj kk kl jj km kn ko kp bi translated">定义策略:交易均线</h2><p id="9f1c" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">为了识别历史模式，我们将使用简单移动平均线(SME)来计算股票在连续“x”天的平均价格。根据<a class="ae kv" href="https://capital.com/the-moving-average-what-is-it-and-how-to-use-it" rel="noopener ugc nofollow" target="_blank">资本投资平台</a>，短期趋势常用10天(“SMA 10”)，长期常用80天(“SMA 80”)，我们将使用这些周期。该策略被称为<strong class="is hj">交叉策略</strong>，其一般原则是:</p><ol class=""><li id="ff22" class="lq lr hi is b it iu ix iy jb ls jf lt jj lu jn lv lw lx ly bi translated">如果价格在SMA线以上:趋势看涨，即方便买入值。</li><li id="ba75" class="lq lr hi is b it lz ix ma jb mb jf mc jj md jn lv lw lx ly bi translated">如果价格在SMA线以下:趋势看跌，方便卖出价值。</li></ol><p id="5823" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以，我们使用<strong class="is hj"> <em class="lk"> rolling() </em> </strong>函数来计算调整后的SMA收盘价“Adj. Close”，其中<strong class="is hj"> <em class="lk">窗口</em> </strong>的大小是天数的范围平均值。让我们看看代码！</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="08e3" class="jv jw hi lb b fi lf lg l lh li">df = pd.DataFrame()</span><span id="4aeb" class="jv jw hi lb b fi lj lg l lh li">sma10 ='sma10'<br/>sma80 ='sma80'<br/>df[sma10]= df.iloc[:,4].rolling(window=10).mean()<br/>df[sma80]= df.iloc[:,4].rolling(window=80).mean()</span><span id="f62a" class="jv jw hi lb b fi lj lg l lh li">df.round(2)</span></pre><p id="9a97" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为SMA计算的是从当前时段开始计数的先前值的平均值，所以我们的数据集的第一行包含空值“Nan ”,因为没有值可用于计算平均值。</p><p id="542d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">带有历史价格的烛台图</strong> <br/>我们将使用烛台图来显示信息，它由两个元素组成:<em class="lk">灯芯</em>和<em class="lk">实体</em>。</p><ul class=""><li id="c556" class="lq lr hi is b it iu ix iy jb ls jf lt jj lu jn me lw lx ly bi translated">灯芯:它们是显示变量“高”和“低”的极值点，是一段时间内谈判的最高价和最低价</li><li id="2cae" class="lq lr hi is b it lz ix ma jb mb jf mc jj md jn me lw lx ly bi translated">真正的主体:是蜡烛的宽部分，主体的上下角显示股票的开盘价“开”和收盘价“闭”。如果当天的收盘价低于开盘价，蜡烛将显示为红色，因为结果是不利的。</li></ul><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es mf"><img src="../Images/cdeea27802b5638fc9e1e0fafda66c1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*_OI2E70IG29ufqQvuK7lPg.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx">Candlestick structure. Adapted from: <a class="ae kv" href="https://www.warriortrading.com/how-to-read-candlestick-charts/" rel="noopener ugc nofollow" target="_blank">Warrior Trading</a></figcaption></figure><p id="9453" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们使用属性<strong class="is hj"> <em class="lk"> go .烛台</em> </strong>将数据添加到图形中，并使用go.Scatter将SMA线添加到图形中。要定制设计，您可以在此处添加plotty在其文档<a class="ae kv" href="https://plotly.com/python/" rel="noopener ugc nofollow" target="_blank">中提供的更多属性，或者您可以使用一个</a><a class="ae kv" href="https://plotly.com/python/templates/" rel="noopener ugc nofollow" target="_blank">plotty模板</a>。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="d425" class="jv jw hi lb b fi lf lg l lh li"><strong class="lb hj">#1 Adding data to Candlestick</strong><br/>fig = go.Figure(data=[go.Candlestick(x=df.index, name = 'Price',<br/>                open=df['Open'], high=df['High'], <br/>                low=df['Low'], close=df['Close']),<br/>      go.Scatter(x=data1.index, y=data1.sma10, name='SMA 10'),<br/>      go.Scatter(x=data1.index, y=data1.sma80,name='SMA 80')])</span><span id="21ad" class="jv jw hi lb b fi lj lg l lh li"><strong class="lb hj">#2 Add template and custom layout</strong><br/>for template in ["plotly_dark"]:<br/>    <br/>   fig.layout.font.family = 'Balto'<br/>   fig.update_layout(template=template, <br/>        title="Historical Price and SME of '"+str(stock)+"' index")<br/>    <br/>    <br/>   <strong class="lb hj">#Legend format<br/>   </strong>fig.update_layout(legend=dict(bgcolor="#2b2929",borderwidth=0.5))<br/>    <br/>   <strong class="lb hj">#Axis format</strong><br/>   fig.update_xaxes(tickangle = -90, tickformat = '%b %e',)<br/>   fig.update_yaxes(title_standoff = 8, tickfont=dict(size=8))<br/>    <br/>   <strong class="lb hj">#Candles style</strong><br/>   fig.update_traces(<br/>       increasing_line_color="#2df726", <br/>       selector=dict(type='candlestick'))</span><span id="74a1" class="jv jw hi lb b fi lj lg l lh li">   fig.update_traces(<br/>       decreasing_line_color="#ff4038",<br/>       selector=dict(type='candlestick'))</span><span id="30c5" class="jv jw hi lb b fi lj lg l lh li">fig.show()</span></pre><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/cf2b4ec3c0921fabf964c705b46d8902.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DmqYnmNJnE_C71Zo2u8ZKQ.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx">Candlestick chart for “TQQQ” stock</figcaption></figure></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h2 id="abf3" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jb kg kh ki jf kj kk kl jj km kn ko kp bi translated">创建买卖指标</h2><p id="6844" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">为了显示买入或卖出指标，我们创建了一个函数，其中包含空列<strong class="is hj"> <em class="lk"> mustBuy </em> </strong>和<strong class="is hj"> <em class="lk"> mustSell </em> </strong>，用于存储收盘价“Adj close”。<br/>变量<strong class="is hj"> <em class="lk"> flag </em> </strong>会检测两条趋势线之间的交叉，如果表示“SMA 80”穿过了“SMA 10”，那么就方便卖出，“Adj close”的值会添加到<strong class="is hj"> <em class="lk"> mustBuy </em> </strong>列，否则为空值“np.nan”。同样的事情发生在如果形态表明股票应该卖出，不方便买卖的话，要增加的价值就为null。</p><p id="3c7f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们将新变量保存在新的数据帧<strong class="is hj"> <em class="lk"> data1 </em> </strong>中。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="08e5" class="jv jw hi lb b fi lf lg l lh li"><strong class="lb hj">#1 Create function</strong></span><span id="12d3" class="jv jw hi lb b fi lj lg l lh li">def buy_sell(data1):<br/>    mustBuy = []<br/>    mustSell = []<br/>    flag = -1 #when crosed both</span><span id="45ba" class="jv jw hi lb b fi lj lg l lh li">for i in range(len(data1)):<br/>        close=df["Adj Close"][i]</span><span id="d827" class="jv jw hi lb b fi lj lg l lh li"><strong class="lb hj">    #If short-term line crosses long-term line</strong><br/>    if data1[sma10][i] &gt; data1[sma80][i]:<br/>            if flag != 1:<br/>                pc=close<br/>                mustBuy.append(pc)<br/>                mustSell.append(np.nan)<br/>                flag = 1<br/>            else:<br/>                pc=close<br/>                mustBuy.append(np.nan)<br/>                mustSell.append(np.nan)</span><span id="d7ae" class="jv jw hi lb b fi lj lg l lh li"><strong class="lb hj">    #If long-term line crosses short-term line</strong>    <br/>    elif data1[sma10][i] &lt; data1[sma80][i]: <br/>            if flag != 0:<br/>                ps=close<br/>                mustBuy.append(np.nan)<br/>                mustSell.append(ps)<br/>                flag=0<br/>            else:<br/>                ps=close<br/>                mustBuy.append(np.nan)<br/>                mustSell.append(np.nan)<br/>        else:<br/>            mustBuy.append(np.nan)<br/>            mustSell.append(np.nan)<br/>        <br/>return (mustBuy, mustSell, close)</span><span id="c0de" class="jv jw hi lb b fi lj lg l lh li"><strong class="lb hj">#2 Store buy and sell decition</strong><br/>buy_sell = buy_sell(data1)<br/>data1['Buy_Price'] = buy_sell[0]<br/>data1['Sell_Price'] = buy_sell[1]</span></pre><p id="1090" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了可视化，我们这次将使用折线图，在数据中我们将包括变量<strong class="is hj"> <em class="lk"> mustBuy </em> </strong>和<strong class="is hj"> <em class="lk"> mustSell </em> </strong>来显示买入或卖出标志，作为收盘价线的标记。让我们看看代码！</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="cddb" class="jv jw hi lb b fi lf lg l lh li">fig2 = go.Figure()</span><span id="837c" class="jv jw hi lb b fi lj lg l lh li"><strong class="lb hj"># 1 Add trace of Adj Close</strong><br/>fig2.add_trace(go.Scatter(x=data1.index,             <br/>                          y=data1["Adj Close"]))</span><span id="b093" class="jv jw hi lb b fi lj lg l lh li"><strong class="lb hj"># 2 Add SMA traces</strong><br/>fig2.add_trace(go.Scatter(x=data1.index, y=data1[sma10], <br/>                          name='SMA 10'))<br/>fig2.add_trace(go.Scatter(x=data1.index, y=data1[sma80], <br/>                          name = 'SMA 80'))</span><span id="53f2" class="jv jw hi lb b fi lj lg l lh li"><strong class="lb hj"># 3 Create markers for BUY OR SELL<br/></strong>fig2.add_trace(go.Scatter(x=data1.index, y=data1["Buy_Price"],       <br/>                          name='Buy',  mode = 'markers',<br/>                          marker =dict(symbol='triangle-up'),<br/>                          hovertemplate=('BUY on %{x}'))</span><span id="3608" class="jv jw hi lb b fi lj lg l lh li">fig2.add_trace(go.Scatter(x=data1.index, y=data1["Sell_Price"],    <br/>                          name='Sell', mode = 'markers',<br/>                          marker =dict(symbol='triangle-down'),<br/>                          hovertemplate=('SELL on %{x}'))</span><span id="a604" class="jv jw hi lb b fi lj lg l lh li"><strong class="lb hj"># 4 Custom layout and template</strong><br/>for template in ["plotly_dark"]:<br/>    <br/>    fig2.update_layout(template=template, <br/>         title="Trading Strategy for '"+str(stock)+"' index")<br/></span><span id="5801" class="jv jw hi lb b fi lj lg l lh li">fig2.show()</span></pre><p id="82af" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想改变三角形标记，你可以通过编辑<strong class="is hj"><em class="lk">marker = dict(symbol)</em></strong>属性和可用的符号<a class="ae kv" href="https://plotly.com/python/marker-style/" rel="noopener ugc nofollow" target="_blank">这里</a>，你也可以用<strong class="is hj"><em class="lk">hover template</em></strong><em class="lk">改变标志的弹出文本。</em> <br/>看看最终结果吧！</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/b20df21fda36ab1ea241b25286e29be8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8vk9MHmwlqvprdCxj7Xz7g.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx">Trading strategy with BUY and SELL flags</figcaption></figure></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h2 id="251d" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jb kg kh ki jf kj kk kl jj km kn ko kp bi translated">解释</h2><p id="eae9" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">我们可以看到，图表回答了这个问题:<strong class="is hj">我应该什么时候进场？我应该什么时候买入或卖出？</strong></p><p id="4a0c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过放大图表，我们将能够注意到短期(SMA 10)和长期(SMA80)形态的交叉，以及当收盘价高于交叉时，旗帜如何显示<strong class="is hj"> <em class="lk">买入</em> </strong>，当收盘价低于交叉时，<strong class="is hj"> <em class="lk">卖出</em> </strong>。</p><div class="kw kx ky kz fd ab cb"><figure class="mi ij mj mk ml mm mn paragraph-image"><img src="../Images/17c9aa98678030a3d7981089f1f49827.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*PtISSfGVzs_Ovex0MS5guA.png"/></figure><figure class="mi ij mo mk ml mm mn paragraph-image"><img src="../Images/1c382b50262d4dfa3c2558dfad6e083a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*qeXefSyV2oNUyzLUxjCNfw.png"/><figcaption class="lm ln et er es lo lp bd b be z dx mp di mq mr">Enlarged Strategy Chart: the flags are the red and green triangles</figcaption></figure></div><p id="6c32" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以，我们已经建立了我们的第一个交易策略。希望有帮助！</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="66dd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lk">您可以在</em> <a class="ae kv" href="https://github.com/Lu-Emperatriz/Trading-Strategy-with-Python/blob/main/Trading-Strategy-Notebook.ipynb" rel="noopener ugc nofollow" target="_blank"> <em class="lk">我的Github </em> </a> <em class="lk">中找到完整的代码，如果您想联系我，您可以通过</em> <a class="ae kv" href="https://www.linkedin.com/in/lucero-sovero/" rel="noopener ugc nofollow" target="_blank"> <em class="lk">我的Linkedin个人资料</em> </a> <em class="lk">联系我。</em></p><div class="ms mt ez fb mu mv"><a href="https://lu-emperatriz.github.io/" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab dw"><div class="mx ab my cl cj mz"><h2 class="bd hj fi z dy na ea eb nb ed ef hh bi translated">Lucero Sovero |数据分析师|网站</h2><div class="nc l"><h3 class="bd b fi z dy na ea eb nb ed ef dx translated">卢塞罗是数据的分析者，是企业问题的解决方案的分析者</h3></div><div class="nd l"><p class="bd b fp z dy na ea eb nb ed ef dx translated">lu-emperatriz.github.io</p></div></div></div></a></div></div></div>    
</body>
</html>