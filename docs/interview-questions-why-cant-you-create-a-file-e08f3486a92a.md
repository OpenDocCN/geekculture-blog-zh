# 面试问题:为什么不能建档？

> 原文：<https://medium.com/geekculture/interview-questions-why-cant-you-create-a-file-e08f3486a92a?source=collection_archive---------0----------------------->

![](img/04385e5487bbb629e40833b60cfd6f1b.png)

# 介绍

最近和我的朋友聊天时，他告诉我一个他在面试中被问到的简单问题。该公司是一个知名的家庭品牌，薪酬也是他在业内听到的最好的薪酬之一。但是这个问题并不常见。问题很简单，“我试图在 Linux 上创建一个文件，但是我做不到。发生这种情况的可能原因是什么？

这个问题很独特，但这种*类型的问题*一点也不独特。诸如此类的开放式问题意在考察应聘者的思维过程和技能。我真的很喜欢这个问题，因为它与候选人的具体经历或使用的技术无关。

比如“*如何在 NodeJS* 中做 XYZ”，或者“*如何配置 NGINX* ”之类的问题，在我看来都不是什么大问题。当然，他们可以告诉面试官某人是否了解 NodeJS 或 NGINX，但是你真的想雇佣特别了解 NodeJS 或 NGINX 的人吗？如果您决定在 Django 中构建一个新的服务，或者将来在 Golang 中使用一些 web 框架，该怎么办？如果公司决定转向不同的代理，比如 Envoy，该怎么办？

类似于"*的问题我试图在 Linux 上创建一个文件，但是我不能。能发生这种情况的可能原因是什么？”*是很好的问题，因为它允许候选人在更广泛的领域展示他的技能和经验*。*一个 DevOps/SRE 的家伙可能会开始专门考虑 Linux，考虑服务器、权限、进程或 inodes。具有云经验的后端人员可能会开始考虑与云基础架构相关的原因，如 EBS 卷中的错误配置、EFS 卷中的错误配置问题等。全栈开发人员可能会认为 API 正在以编程方式编写文件，并认为代码给出了错误消息，等等。这些都不是错误的答案，但它们显示了受访者的经验和知识。

在这个系列中，我想提出类似这样的开放式问题，并深入讨论我的答案，回顾相关的技术以及它们是如何结合在一起的。这些问题可能有一百万个答案，所以请在评论中告诉我你认为可能的答案。

# 这个问题

我想在这篇文章中讨论的问题是，

我试图在 Linux 上创建一个文件，但是我做不到。发生这种情况的可能原因是什么？

在你阅读我的答案之前，试着想一想，看看你能想到什么可能的解决方案。为了便于阅读，我还将我的答案从最容易到最难排序，并且有一些链接可以更好地理解每个答案中的主题。

# 可能的答案

## 没有剩余的磁盘空间

这可能是最简单的答案之一。显然，要创建一个文件，您的辅助存储器中应该有足够的磁盘空间来创建它。您可以将简单的固态硬盘视为本地服务器，或者将存储视为云环境中的云资源(如 EBS 卷)。

接下来的问题可能是你如何知道还有多少存储空间。有很多方法可以解决这个问题。我的方法是检查您已经拥有的任何指标/仪表板。许多 AWS 服务为您提供磁盘使用指标，或者您也可以在 CloudWatch 上创建自己的指标。可能有一些配置要求，例如，安装代理，但除此之外，过程应该非常简单。

你也可以查看其他第三方解决方案，比如 Nagios。[关于监控有很多要说的](https://www.youtube.com/watch?v=CAQ_a2-9UOI&t=342s)，这篇文章并不是真的要说这个，但是要知道有很多方法可以监控你的磁盘使用情况，设置警报，以及配置所有这些。

最后，一个简单的`df -h /`也是一个有效的答案，虽然通常在较小的应用程序或概念证明中使用。

## 权限问题

另一个可能导致您无法创建文件的简单问题是权限问题。可能是进程或用户没有在该目录下创建文件的权限。

一个可能的反问题是如何检查用户或进程是否有正确的权限。这很大程度上取决于您如何配置您的服务器。运行一个简单的`ls -l`应该会告诉你任何文件/目录的权限。

## 高 CPU/内存消耗

您执行的每个命令通常都会在自己的进程中执行。每个进程都必然有一些资源，并利用某种程度的 CPU 和内存。

在最简单的层面上，任何正在运行的进程都会存储一堆关于它自己的元数据信息，比如打开的文件描述符、它的 PID、它的状态等等。操作系统还会尝试运行该进程，在我们的示例中，该进程可能会打开一个文件，写入该文件并关闭它。这需要少量的 RAM 和 CPU。没有这一点，该进程就不可能正常工作。

因此，如果您的服务器 RAM 已满和/或正在运行的进程使用了 100%的 CPU，您就不太可能创建新文件。事实上，试图创建新文件的进程也可能会冻结。例如，如果您试图通过在 SSH shell 中运行`touch newfile`来创建一个新文件，如果 CPU 和内存消耗足够高，您就不太可能通过 SSH 进入服务器。

## 分区问题

分区问题也会导致您无法创建新文件。也许您已经将您的 EBS 卷配置为具有多个分区，或者也许您决定增加您的 EBS 卷的大小，但是还没有更新 OS 文件系统，或者卷的一些其他错误配置。

一般来说，分区本身就是一个很大的话题，所以对它的修改可能会导致您无法在卷中创建新文件的情况。

## 使用网络文件系统时的网络问题

您可能正在使用基于 NFS 或 SMB 等协议的网络文件系统。其工作方式是，从技术上讲，您的文件存储在另一台服务器上，但另一台服务器可以使用网络协议读写这些文件。

一个流行的例子是 AWS 的 EFS(弹性文件系统)。该服务允许您创建一个网络文件系统，然后将其作为一个卷挂载到 EC2 实例中。如果你想了解更多，T2 官方文件做了很好的解释 EFS 是什么。[这个在 EC2 上挂载和 EFS 文件系统的演练](https://docs.aws.amazon.com/efs/latest/ug/wt1-test.html)也是一个很好的资源。

由于您的文件系统现在依赖于网络，可能导致服务器之间断开连接的问题(例如，防火墙、安全组、NACL、子网问题)也可能导致文件写入或读取问题。

## 信息节点耗尽

信息节点存储关于系统中文件或目录的元数据。该元数据存储诸如文件位置、文件大小、文件链接数量等信息。所有常规文件都有一个 inode。

您的操作系统对每个文件系统上可以创建的 inodes 数量有限制。运行`df -i`向您展示可以创建的最大索引节点数量、当前使用的索引节点数量和空闲的索引节点数量。

例如，对于我的个人笔记本电脑，我得到了根文件系统的如下输出

```
Filesystem       Inodes   IUsed    IFree IUse% Mounted on
/dev/nvme0n1p2 31227904 2439357 28788547    8% /
```

不用说，创建 31，227，904 个文件并不常见，但是可能会出现索引节点耗尽的情况，[例如](https://stackoverflow.com/questions/52628094/docker-inode-exhaustion-when-pulling-image-from-docker-hub)。此外，如果您的 inodes 耗尽，错误消息通常会指示您的磁盘已满，即使它可能还有很多剩余空间。

需要注意的另一个有趣的地方是，一些文件系统，如 [ZFS，对于可以在 fs](https://serverfault.com/a/505742) 中分配的 inodes 数量没有限制。

## PID 耗尽

在 bash 上运行命令通常包括两个步骤

1.  `fork`创建新的重复流程
2.  `exec`用您想要运行的流程替换新流程

Bash 会在没有您任何干预的情况下完成这项工作，但是您应该知道，您执行的每个命令都会创建一个新的进程。

如果您正在使用类似于`touch`或`nano`的东西创建一个文件，那么 bash 很可能会为您创建一个进程，在进程中运行该命令，并在命令完成后终止该进程。因为每个新进程都需要一个 PID，所以生成这个创建文件的进程也需要一个 PID。

PID 耗尽理论上是可能的，文件`/proc/sys/kernel/pid_max`定义了可能的 PID 的最大数量。例如，在我的笔记本电脑中，这个值是 4，194，304。正如这个[的回答](https://unix.stackexchange.com/a/304076)所解释的，没有对 PID 递增的要求，唯一的要求是当前运行的进程的 PID 应该是唯一的。因此，为了用尽可能的 PID，您需要 400 多万个进程同时运行，这似乎不是一个常见的场景。

还有其他相关的限制需要考虑，例如，在任何时间点可以打开的文件描述符的数量限制(如果您想进一步了解文件描述符，我写了一篇关于文件描述符的文章)。根据服务器配置和您使用的特定 Linux 发行版，还可能有其他形式的限制。如果你想了解更多，这是一个很好的资源。

尽管这看起来不太可能发生，但它仍然是一个有效的答案，并展示了你跳出框框思考的技巧。

## 断电

另一个简单的原因可能是用于管理文件系统的服务中断。例如，EBS 中的中断会导致您在使用 EBS 卷时无法创建文件。

# 结论

如果你喜欢这篇文章，一定要看看我最近写的一篇类似的文章，关于另一个非常流行的面试问题— [面试问题:如何提高数据库的性能](/geekculture/interview-questions-how-to-improve-the-performance-of-your-database-21b42aba352e)

感谢您花时间阅读本文。如果你有任何反馈，请在评论中告诉我。