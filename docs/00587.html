<html>
<head>
<title>How Create a Drawing Classifier With Tensorflow.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Tensorflow.js创建绘图分类器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-create-a-drawing-classifier-with-tensorflow-js-1258ed78afe?source=collection_archive---------5-----------------------#2021-03-06">https://medium.com/geekculture/how-create-a-drawing-classifier-with-tensorflow-js-1258ed78afe?source=collection_archive---------5-----------------------#2021-03-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ff1659af5b70399e1ec43d6a13a3c3d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JvwDbL5Ul2kB3GtdpcqSTw.jpeg"/></div></div></figure><p id="fac1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你玩过<a class="ae jo" href="https://quickdraw.withgoogle.com/" rel="noopener ugc nofollow" target="_blank">快速抽奖</a>吗？如果没有，这是谷歌创造的一个游戏，它要求玩家画出一个物体的图像，然后它使用神经网络的人工智能来猜测这幅画代表什么。</p><p id="d20c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">谷歌还提供了整个<a class="ae jo" href="https://github.com/googlecreativelab/quickdraw-dataset" rel="noopener ugc nofollow" target="_blank">数据集</a>，该数据集由345个类别的5000多万幅图画组成。游戏玩家的图画丰富了数据集。</p><p id="df34" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我的目标是看看是否有可能完全用Javascript创建一个更小但效果很好的类似的东西。</p><h1 id="eef5" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">现场演示和代码</strong></h1><p id="a6d6" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">这里有一个活生生的<a class="ae jo" href="https://doddle-classifier.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">例子</a>，<a class="ae jo" href="https://github.com/ricio91/doddle-classifier-model" rel="noopener ugc nofollow" target="_blank">为型号</a>的代码，<a class="ae jo" href="https://github.com/ricio91/doddle-classifier-app" rel="noopener ugc nofollow" target="_blank">为app </a>的代码。</p><p id="f176" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在实例中，该模型已经被训练(2个时期)超过100个类别，其中每个类别包括20.000个图像。模型的准确率为87%。</p><h1 id="6214" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">示例</strong></h1><div class="ks kt ku kv fd ab cb"><figure class="kw ij kx ky kz la lb paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/4b605b4373b2cba768b7a340aa7c4bd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*rhj9ycVQsldXZRqsDL0Uxw.jpeg"/></div></figure><figure class="kw ij lc ky kz la lb paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/6c6a7d1168e023ae000746e9efa1b55c.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*jlxiORv1SQVj-Ngx2Tly4A.jpeg"/></div></figure><figure class="kw ij ld ky kz la lb paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/ccd01709712c3861ba24648cfb256e5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*r6BuAYcNMfSCIxC8e1L5LA.jpeg"/></div></figure></div><div class="ab cb"><figure class="kw ij le ky kz la lb paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/444c549b651a8e20499c44d962a100ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*--_Mpsjnf9gP7G57Tlr8UQ.jpeg"/></div></figure><figure class="kw ij le ky kz la lb paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/1c795af9663ec8a1152d3ed320d754bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*9J3dWBfiesTwbeITHl1jpQ.jpeg"/></div></figure><figure class="kw ij lf ky kz la lb paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/f73c1acdc22c02fe83fa7b05d58ef784.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*_OhsThdiJavr-Hvg2aJSJw.jpeg"/></div></figure></div><h1 id="bfc7" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">下载数据</strong></h1><p id="4102" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">数据以不同的格式提供:</p><ul class=""><li id="34ea" class="lg lh hi is b it iu ix iy jb li jf lj jj lk jn ll lm ln lo bi translated">简化的绘图文件(。ndjson)</li><li id="377c" class="lg lh hi is b it lp ix lq jb lr jf ls jj lt jn ll lm ln lo bi translated">二进制文件(。bin)</li><li id="9a37" class="lg lh hi is b it lp ix lq jb lr jf ls jj lt jn ll lm ln lo bi translated">Numpy位图(。npy)</li></ul><p id="fdb4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为图像的渲染(28x28 <strong class="is hj">灰度</strong>位图)我选择使用。npy格式，即使这种格式通常在Python中使用。</p><h1 id="1320" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">如何理解和显示</strong>的<strong class="ak">数据</strong></h1><p id="b97a" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">让我们看看如何理解数据以及如何表示数据，在浏览器上显示10幅图像。</p><p id="3344" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我将图像作为二进制数据加载，并删除了前80个字节，因为它们是头。</p><p id="dcb6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后为了在画布中显示图像，我创建了一个包含像素值数组的<code class="du lu lv lw lx b">ImageData</code>对象。每个像素由四个单字节值(RGBA)组成。正如我上面说的，图像是灰度的，所以R，G和b使用相同的值。</p><p id="93a2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在接下来的段落中，将有可能看到Tensorflow.js提供API来执行这种操作。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="ba0d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">终于有了结果。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/cb8196cec2d2574c8c526c8961862ad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*tDaQSwcTvGVujq0WD1VPMg.png"/></div></figure><h1 id="5e6a" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak"> CNN型号</strong></h1><p id="d46b" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">该项目的下一步是创建一个卷积神经网络。关于CNN如何工作的更多细节，请看这篇文章。</p><p id="ea88" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在构建模型之前，让我们看看如何加载数据。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="8adf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators#generator_functions" rel="noopener ugc nofollow" target="_blank">生成功能</a> <code class="du lu lv lw lx b">*dataGenerator</code>允许准备接下来要处理的图像。这个函数是上面代码中最重要的部分。</p><p id="0719" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我为每个类别设置了一个图片限制(每个类别20.000张图片)，以简化流程。</p><p id="99bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">80%的数据被指定用于训练模型，剩余的20%用于验证。</p><p id="3ef1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每个图像都经过了<strong class="is hj">归一化</strong>，即每个像素都被转换为0到1之间的值。</p><p id="064d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之后，将创建一个包含标准化值(xs)的对象和一个表示图像标签的数组(ys)。</p><p id="5737" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我定义了模型架构。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="0343" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lu lv lw lx b">train</code>函数使用生成函数加载数据，然后数据被混洗并分组为一批，每批200个元素。</p><p id="1425" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">流量准备好了，大家一起放吧！</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="7afb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请耐心等待，一旦模型完成并保存，就可以在应用程序中使用了。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/f99c37bfc8c9fde57f3ca0b859e17141.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LF0WU44NCfSocca4pBTPwA.png"/></div></div><figcaption class="mc md et er es me mf bd b be z dx">Example of a training on 20 classes</figcaption></figure><h1 id="8270" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">应用</strong></h1><p id="5557" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">现在的目标是画一些东西，让模型猜它画的是什么。</p><p id="31cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个应用程序中，我使用了Angular，当然同样的逻辑也可以在其他框架/普通JS上实现。</p><p id="d04f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们开始导入模型并创建预测绘图的方法。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="a923" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lu lv lw lx b">model.predict</code>返回包含每个类别概率的数组，所以我选择了较高的值。</p><p id="5bde" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在是时候在画布中绘制并从中检索数据了。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="b108" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我已经为桌面和移动画布添加了事件监听器，这样我就可以获得鼠标坐标来显示绘图路径。</p><p id="aaa0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第二步是将画布中的图像转换成与模型被训练时相同的格式。</p><p id="725a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，我将图像加载为imagedata(只有一个通道)，然后使用<a class="ae jo" href="https://js.tensorflow.org/api/latest/#image.resizeBilinear" rel="noopener ugc nofollow" target="_blank"> tf.image.resizeBilinear </a>将其调整为28x28。</p><p id="a318" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，我已经标准化的图像，但请注意，该模型是训练为黑色背景和白色中风的图像，而不是在这里是相反的。</p><p id="8d48" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我可以做出预测，并在浏览器上显示出来。</p><p id="c51f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">还有…就这些了:)</p></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><p id="7f80" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您觉得这篇文章有用，👏非常感谢您的评论。</p></div></div>    
</body>
</html>