<html>
<head>
<title>K6 — Custom Slack Integration: Metrics are the Magic of Tests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">K6——定制松弛集成:度量是测试的魔力</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/k6-custom-slack-integration-metrics-are-the-magic-of-tests-527aaf613595?source=collection_archive---------2-----------------------#2021-07-18">https://medium.com/geekculture/k6-custom-slack-integration-metrics-are-the-magic-of-tests-527aaf613595?source=collection_archive---------2-----------------------#2021-07-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/22c5fba33073898d9a0a824573ec098d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0r1HPDLHb0DiKqki-vRy2Q.png"/></div></div></figure><p id="f0f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi jo translated">在我之前的文章中，我谈到了如何用k6工具轻松地加载测试。你可以在这里找到<a class="ae jx" rel="noopener" href="/nerd-for-tech/building-more-stable-banking-as-a-service-with-k6-57ba952eab02">。本文将讨论如何将我们的k6测试结果发送给slack。</a></p><p id="276c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这些类型的测试中，度量对我们来说是神奇的。因为我们可以用度量来理解一切。这些指标需要随时可用。这有很多方法，你可以用k6提供给我们的不同方法来实现。您可以获得JSON形式的输出，也可以使用基于时间的数据库追溯查看输出。但是slack对我们开发人员来说变得特别重要，我们可以在slack上设置警报机制，我们可以根据需要设置slack-bot或通知系统。在本文中，我们将为这些系统添加一个新的。</p><h1 id="b31b" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">基本脚本的示例</h1><p id="d791" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">这篇文章展示了我们如何将k6结果中的指标作为slack上的消息发送出去。首先，我们再在k6上写一个简单的测试。</p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/e4298a398c16bd453eb5603bf7b8dd3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kpgG9wWSpiR9frgX3A_QAg.png"/></div></div></figure><p id="1796" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如您所见，我们用一个非常简单的脚本完成了测试。现在，当您以这种方式运行k6时，它会通过终端向我们提供一个输出。但是我们希望通过这个输出只获得某些数据。为此，k6为我们提供了一个出色的功能。它允许我们使用handleSummary()函数以JS对象的形式获取测试结果。</p><h1 id="20a5" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated"><strong class="ak">handle summary()函数的魔力</strong></h1><p id="c48d" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">让我们用一个例子来验证一下。在下面的示例脚本中，数据参数自动为我们提供函数的输出，您可以按照自己想要的方式使用它。例如，由于这个函数，您可以同时获得JSON或XML输出。</p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/fa35ade28e4677d3e9776dd14b8c7651.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uSGPDXqpnpWuktQtMEo8Yg.png"/></div></div></figure><p id="aeb7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如我上面提到的，我们通常可以以JS对象的形式获得结果。您可以在下面的输出中看到这样的例子。</p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/1bdff2eb947ad0f7687abcd853eff0c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jueeD7C6KBH07M8NQs4Bdw.png"/></div></div></figure><p id="d3e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们理解这个输出，并确定我们想要使用的值。在本文中，我们将从这个对象中提取最大吞吐量、HTTP故障、平均响应时间和VUs值作为示例。我们已经定义了我们希望从数据对象中获得的指标，如下所示。</p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/522734ef9ccd57286cdd00682ab31939.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aOIbaI0ZTycR_C9p4vPxnw.png"/></div></div></figure><h1 id="5e2f" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">自定义松弛集成</h1><p id="e903" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">现在让我们来看看这项工作最精彩的部分，创建并发送一条带有slack的自定义消息。这里我们将受益于Slack API和Slack Block Kit Builder。首先，我们通过Slack Block Kit Builder以一种简单的方式创建一个消息模板。然后我们复制这个模板，并把它赋给一个名为payload的变量。因为这个变量将是我们通过Slack API发送的有效负载。</p><blockquote class="lg"><p id="08b1" class="lh li hi bd lj lk ll lm ln lo lp jn dx translated">在这里，您可以找到<a class="ae jx" href="https://api.slack.com/start" rel="noopener ugc nofollow" target="_blank">松弛API </a>和<a class="ae jx" href="https://api.slack.com/block-kit" rel="noopener ugc nofollow" target="_blank">松弛块套件生成器</a>的用法。</p></blockquote><figure class="lq lr ls lt lu ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/db6c9cc5e8dcd1fb680e8e81cb3ebdf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P7bKdMnOBsXeCZEr7WRcjQ.png"/></div></div></figure><p id="0795" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">定义完成后，我们创建一个简单的函数并发送一个Slack API请求。在此之前，创建一个bot，并且必须在授权HTTP头中将您的bot令牌作为不记名令牌进行传输。您可以在slack文档中找到更详细的过程。</p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/cbbb1dcdddffe48d62233b015e9dda5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aiZSFNpoeyyIGHuorz1MYA.png"/></div></div></figure><p id="b7ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如您在下面的函数中所看到的，我们首先根据自己的度量标准，更改我们将在定义的有效负载中发送的消息。</p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/5fc4ab02fa168dfc24f32d31a5e79d60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9OOo8qs--SnEghC7yYseBw.png"/></div></div></figure><p id="96c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们发送slack API请求。现在，我们从handleSummary()调用这个slack函数，并得到我们的slack消息。</p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/fa68c5094cae550ebe15dfd669cd3d52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1WAmshn43YUnDjvcOv8sUg.png"/></div></div></figure><p id="2f85" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看看结果……</p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/c292d98699a8705e3d50da304a77fe82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7P6RJfBzKqjoh6mMoigkZQ.png"/></div></div></figure><p id="d2e9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您可以将想要的结果作为一条松弛消息发送。🥳</p></div></div>    
</body>
</html>