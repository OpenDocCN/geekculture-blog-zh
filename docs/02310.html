<html>
<head>
<title>Make a Banner Ad In UITableView Cell(Swift 5)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在UITableView单元格中制作横幅广告(Swift 5)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/make-a-banner-ad-in-uitableview-cell-swift-5-4a3dfee57610?source=collection_archive---------14-----------------------#2021-05-10">https://medium.com/geekculture/make-a-banner-ad-in-uitableview-cell-swift-5-4a3dfee57610?source=collection_archive---------14-----------------------#2021-05-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9a52be1a3b59278d40ae55149d788eb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5Rcna5BqSSGfvJMr"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@jwwhitt" rel="noopener ugc nofollow" target="_blank">Jordan Whitt</a> on <a class="ae iu" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">Splash</a></figcaption></figure><p id="506a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在应用程序中看到横幅广告是非常常见的，尤其是在商业应用程序中。所以我觉得这是我练习的好题目。我们先来看看演示:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jt"><img src="../Images/a7eb91f884467c54f1d11da06355a109.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/1*YRSO68D_ecUbYbi5e4geuA.gif"/></div></figure><p id="7727" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">制作banner有两种方式，第一种是UICollectionView，第二种是UIScrollView + UIPageView。而在这篇文章中，我将向你展示如何通过UIScrollView + UIPageView制作横幅广告。</p><h1 id="8f5e" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">我从这次实践中学到的是:</h1><ul class=""><li id="1c36" class="kw kx hi ix b iy ky jc kz jg la jk lb jo lc js ld le lf lg bi translated">更熟悉UIScrollView和UIPageControl</li><li id="3378" class="kw kx hi ix b iy lh jc li jg lj jk lk jo ll js ld le lf lg bi translated">如何同步页面和点</li><li id="d176" class="kw kx hi ix b iy lh jc li jg lj jk lk jo ll js ld le lf lg bi translated">滚动UITableView不会影响横幅</li></ul></div><div class="ab cl lm ln gp lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="hb hc hd he hf"><h1 id="768f" class="jy jz hi bd ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr lx kt ku kv bi translated">我们开始吧！</h1><p id="9145" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg ly ji jj jk lz jm jn jo ma jq jr js hb bi translated">首先，我们需要在横幅广告中显示几张图片，所以只需将它们放在Assets.xcassets文件中。我把图片命名为0到9，因为添加到UIScrollView会更方便，我后面会解释。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/26b5fbc173478bcf63b63f93c17046a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w6fAi-SQe2Hl8fc9068l2g.png"/></div></div></figure><p id="2bcd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，让我们在代码中创建一个UITableView。我注册2个单元格的原因是因为第一个是横幅广告，另一个是你想在屏幕上显示的任何东西。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/4b246d215173457fd950dbf9f948aab1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CGvZtV81jWXzNe-9Mw4fnA.png"/></div></div></figure><p id="fee2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">好，那我们就把我们的主要角色(UIScrollView &amp; UIPageView)放在单元格里吧。但在此之前，我们需要为要注册的UITableView声明一个标识符。然后，我们需要创建一个数组来存储要放入UIScrollView的图像。</p><p id="29cb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因为我们使用for-in循环将图像追加到数组中，所以最好同时设置帧，因为每个图像的x坐标应该是屏幕宽度乘以数组中的索引。这就是为什么我把这些图片命名为从0到9，这正是我们想要的。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/5fc08b8df953b44f41d05e3f3847806f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mfs3UUU5tC3e5a64Nvy8_Q.png"/></div></div></figure><p id="a78e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后只需为UIScrollView &amp; UIPageControl设置细节即可。对于设置UIScrollView的内容大小，应该是屏幕宽度乘以图片数(第31行)，并且记得将图片添加到UIScrollView中。(第35行)</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/3069dd824981bfffcc70325e11bd0dc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ff5j-3Eb9eLJ8nhMJublQ.png"/></div></div></figure><p id="35dc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们可以转到ViewController来设置最终部分。首先，我创建一个枚举来区分我们想要控制哪个部分。我还需要一个与我们在视图中设置的数组相同的数组，因为我们将需要它来设置我们的TableViewController函数。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/0e715654dad4b5d0469e17f868813791.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qwDpbEypGmcraXzcDvigBQ.png"/></div></div></figure><p id="ce73" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们将UITableView委托和dataSource设置为self，并实现这些函数。如果我们使用Enum来分隔各个部分，而不是数字，我们的代码会更清晰，可读性更好。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/14db7633247593e83cf02dc180cabd86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9paBwcEjvMNgK9nuuVJ1dA.png"/></div></div></figure><p id="09d5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在cellForRowAt函数中，记住将我们刚刚声明的数组设置为等于我们在UITableViewCell中设置的数组。并将UIScrollView的委托设置为等于self。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/33a22fc5fc5a00d65c3219cdc9b5c3da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Dyhbu6oWAsijBa_KvcP3Q.png"/></div></div></figure><p id="a65b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，如果你运行应用程序，你会看到你的UIScrollView和UIPageControl出现在你的单元格中，但高度不是我们想要的。因此，我们需要为每个部分设置高度。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/8b8ad4d9b076e0761dfae0d1367c95fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D37ioPVyjTehqW5NRWGogQ.png"/></div></div></figure><p id="1694" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你的应用现在应该是这样的:</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jt"><img src="../Images/4ba47d012d4d99758749f8138d9dbfc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/1*ZMBzCxnLMoMq_SO5qve-ug.gif"/></div></figure><p id="547f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">好吧，我们需要做几件事。当我滑动UIScrollView视图时，我希望圆点移动到正确的位置。当我单击这个点时，我希望它向前移动，UIScrollView将转到正确的页面。</p><p id="096e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了达到这个目的，我们需要再设置两个变量。xOffset是UIScrollView的x坐标，currentPage是UIPageView的点。并且一旦当前页面改变，xOffset也将改变。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/0a104c681b8160277b5801fcdf8d70c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GhLJ07YyMvjmSsL0zY2k3Q.png"/></div></div></figure><p id="e87b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们还需要2个函数来知道用户是向左滑动还是向右滑动。如果用户向左滑动，那么圆点应该向前移动。所以用户每次触发这个函数，currentPage都会加1。一旦它大于bannerViews中的最后一个索引，它将变为0。对于swipeRight来说，这个概念是相同的，但它是相反的。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/82433b042ebfc758df5855daa5424a23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*moMUea_ju2M-RP5jiZ_OzA.png"/></div></div></figure><p id="61d9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后只需转到cellForRow，将UIPageControl的currentPage和UIScrollView的xOffset设置为等于我们刚刚声明的currentPage和xOffset。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/16fbbbc2e168f1b439185cd165265081.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eiLfxNzNjf_c24lmkLGZRw.png"/></div></div></figure><p id="d909" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，为了检测用户是向左还是向右滑动，我们需要使用scrollViewDidEndDecelerating函数。translatedPoint.x基本上是正数或者负数。当用户向左滑动时，translatedPoint.x将为负，如果用户向右滑动，它将为正。所以只要把正确的功能放在正确的地方。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/17f0f06185f32acea71a996d2e374437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2QQf4ux-BVjdsqZGJtwsCQ.png"/></div></div></figure><p id="24fb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，当你滑动你的UIScrollView视图时，圆点应该能够移动到正确的位置。你可能会感到困惑，因为当你点击UIPageControl时没有任何反应，那是因为我们还没有这样做。所以，让我们为我们的UIPageControl添加一个函数。</p><p id="93cf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">实际上这很简单，当我单击UIPageControl的点时，我希望它前进，所以只需将swipeLeft()放在pageControlDidTap()中。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/1d0b9f950168d7c88e8629601171428d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cn7LApWolwPmDDEsRp4YAw.png"/></div></div></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/86d7f3175d1c21d696b91c96059ace07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IhdKaKXhIgXHCDeJEuHxSQ.png"/></div></div></figure><p id="bbfc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在一切都应该没问题了。所以是时候设置定时器让它自动滚动了！</p><p id="07fd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，让我们创建一个计时器，它将每3秒触发一次。因为我希望它向前移动，所以计时器的功能将被swipedLeft()。请记住将setTimer()放入ViewDidLoad中，并且不要忘记在swipedLeft()前面添加@objc，否则我们无法构建和运行该应用程序。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/9cdf8c4d2c12ec2c3f0312778ce25fe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wPYjQYSwVMezKDGpHqL7Jg.png"/></div></div></figure><p id="f7ae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，你的app应该就像下面的gif。我们可以改进的地方很少:</p><ul class=""><li id="2c27" class="kw kx hi ix b iy iz jc jd jg mq jk mr jo ms js ld le lf lg bi translated">添加动画</li><li id="8e56" class="kw kx hi ix b iy lh jc li jg lj jk lk jo ll js ld le lf lg bi translated">当我们触摸UIScrollView或UIPageControl时停止计时器</li></ul><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jt"><img src="../Images/86c5c11046c43b2599b131fc2747459d.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/1*DsjyeOWqFOKwxquhtBkeXg.gif"/></div></figure><p id="3c22" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以调用invalidate()来停止计时器，所以只要把这个函数放在任何我们想要停止它的地方。在这种情况下，当我单击UIPageControl并拖动UIScrollView时，我将调用该函数。</p><p id="9fc7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦用户停止拖动，不要忘记重启计时器(第124行)。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/cf8c1b8e064e219a84c7549ba5326105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HppjPa1eo5H-N9RS1oNQSQ.png"/></div></div></figure><p id="31d0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">好，那么让我们在代码中添加动画。当UIScrollView的x坐标改变时，我们希望它有动画效果。所以只要把我们设置UIScrollView的x偏移量等于self.xOffset的代码放在UIView的animate函数中。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/c45038fb96f6a0b3c9a4d2e73f92c05c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZKsP24YFng1UNr5Q1_9Urg.png"/></div></div></figure><p id="e6bc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，你可能认为一切都很好，但你会发现当你滚动UITableview时，你的横幅广告会受到影响。这是因为UITableView和UIScrollView共享同一个ScrollView。那么如何解决这个问题呢？</p><p id="3641" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">只需确定scrollView是否为UITableView即可。如果是，那就什么都不要做。代码如下所示。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/447a8d86d18597a39cd2b743931bd3ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jBOSNGdOy5abItnPR3BtXA.png"/></div></div></figure><p id="5317" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是我这个项目的Github:</p><pre class="ju jv jw jx fd mw mx my mz aw na bi"><span id="7d3d" class="nb jz hi mx b fi nc nd l ne nf"><a class="ae iu" href="https://github.com/Sheng-Ping-Wang/AdBannerDemo/tree/main" rel="noopener ugc nofollow" target="_blank">https://github.com/Sheng-Ping-Wang/AdBannerDemo/tree/main</a></span></pre></div><div class="ab cl lm ln gp lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="hb hc hd he hf"><p id="187f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">希望这篇文章对想深入了解UIScrollView &amp; UIPageControl的人有所帮助。如有任何意见，请留言。谢谢！</p></div></div>    
</body>
</html>