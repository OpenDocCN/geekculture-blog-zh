<html>
<head>
<title>Apache Airflow 2.0 Postgresql Complete Installation With WSL Explained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apache Airflow 2.0 Postgresql完整安装及WSL说明</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/apache-airflow-2-0-complete-installation-with-wsl-explained-71a65d509aba?source=collection_archive---------3-----------------------#2021-06-08">https://medium.com/geekculture/apache-airflow-2-0-complete-installation-with-wsl-explained-71a65d509aba?source=collection_archive---------3-----------------------#2021-06-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/def098689942b2aa5fd1d86c6d1bb5b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ID_7z9t2ol78SrNxAqmqA.png"/></div></div></figure><p id="2eaf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi jo translated"><span class="l jp jq jr bm js jt ju jv jw di"> A </span> pache Airflow是一个开源的ETL工具，它帮助<strong class="is hj">从源中提取</strong>数据，然后<strong class="is hj">根据我们的需要转换</strong>，最后<strong class="is hj">将</strong>数据加载到目标数据库中。</p><p id="ed51" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jx">这是ETL的另一个优点(提取、转换和加载)</em></p><p id="c469" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以根据我们的需求在气流中安排我们的ETL过程。</p><p id="05fb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Apache airflow是纯面向python的。</p><p id="3ab0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在airflow上的安装可能会很棘手，因为它涉及到需要设置的不同服务，例如对于并行处理，我们需要PostgreSQL或MySQL而不是SQLite，即airflow处理元数据的默认数据库，这也是我们将讨论的内容。</p><p id="9fcd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我建议，如果有人对docker有基本的了解，最好使用docker，而不是直接安装。</p><blockquote class="jy jz ka"><p id="dcd1" class="iq ir jx is b it iu iv iw ix iy iz ja kb jc jd je kc jg jh ji kd jk jl jm jn hb bi translated"><a class="ae ke" href="https://kundansinghynr.medium.com/apache-airflow-2-0-complete-installation-with-docker-explained-f07aa1049f1e" rel="noopener">用docker </a>安装Airflow 2.0</p></blockquote><p id="1eca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们有两种方法来安装气流。第一个是Docker，第二个是WSL(Linus的窗口子系统)。在这里，我们将安装气流与WSL如下。</p><p id="be3d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">安装WSL </strong></p><p id="583e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们需要知道什么是WSL，WSL代表Linux的Windows子系统。它允许我们在Windows内部使用Linux子系统。</p><p id="88bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装WSL很简单，你可以去微软的官方网站，一步一步地在Windows中安装WSL。</p><div class="kf kg ez fb kh ki"><a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab dw"><div class="kk ab kl cl cj km"><h2 class="bd hj fi z dy kn ea eb ko ed ef hh bi translated">在Windows 10上安装WSL</h2><div class="kp l"><h3 class="bd b fi z dy kn ea eb ko ed ef dx translated">安装Windows Subsystem for Linux (WSL)有两个选项:简化安装(预览版)…</h3></div><div class="kq l"><p class="bd b fp z dy kn ea eb ko ed ef dx translated">docs.microsoft.com</p></div></div><div class="kr l"><div class="ks l kt ku kv kr kw io ki"/></div></div></a></div><p id="028d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">1.)以管理员身份通过windows power shell启用该功能。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="1a7e" class="lg lh hi lc b fi li lj l lk ll">dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart</span></pre><p id="d9b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.)重启你的系统。</p><p id="a0eb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.)去app store安装你喜欢的ubuntu。</p><p id="314f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，在ubuntu中设置好用户名和密码后，你将会看到一个终端。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/959d14fc408c38f617339aeb4b9201b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AZvYOIm4J3DSwA3VDYhkAg.png"/></div></div></figure><p id="89f2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你能在你的ubuntu上看到这个，你就可以安装apache airflow了。</p><p id="1ff5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一步更新你的ubuntu系统。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="9451" class="lg lh hi lc b fi li lj l lk ll">sudo apt update &amp;&amp; sudo apt upgrade</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/95d3be12d6c2b7d05dba63b33764f7b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5bu4tZfjZnKBh8q3zWuTCQ.png"/></div></div></figure><p id="4763" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，更新python3，安装pip。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="84b6" class="lg lh hi lc b fi li lj l lk ll">sudo apt upgrade python3<br/>sudo apt install python3-pip</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/32abb9d15e8ff5140d4835f660283585.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zV9GPleaygxV1KXN2cdOxQ.png"/></div></div></figure><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/ab47a3fd915a368171d422e91f017759.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OJJplanT0J2bajwEHggkdA.png"/></div></div></figure><p id="138c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装PostgreSQL不是必需的，但是如果我们要执行几乎每个ETL管道都需要的并行处理，我会推荐。</p><p id="5fd2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">启动PostgreSQL服务。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="a1c7" class="lg lh hi lc b fi li lj l lk ll">sudo apt-get install postgresql postgresql-contrib</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/f5968ee47e416c351a94c4a5be9446c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KJa0-8iPesoGHtSmnWXd6A.png"/></div></div></figure><p id="8042" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">启动PostgreSQL服务。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/29c22289ee5a2a37e0cdeddd3df40cb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MVRlOnl_V7XQiAH1f98MBQ.png"/></div></div></figure><p id="ed52" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建一个用户和一个airflow将要使用的数据库。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="1e3b" class="lg lh hi lc b fi li lj l lk ll">sudo -u postgres psql</span><span id="abc4" class="lg lh hi lc b fi ls lj l lk ll">postgres=# CREATE USER airflow PASSWORD 'airflow';</span><span id="27ef" class="lg lh hi lc b fi ls lj l lk ll">CREATE ROLE</span><span id="2699" class="lg lh hi lc b fi ls lj l lk ll">postgres=# CREATE DATABASE airflow;</span><span id="d7e3" class="lg lh hi lc b fi ls lj l lk ll">CREATE DATABASE</span><span id="418a" class="lg lh hi lc b fi ls lj l lk ll">postgres=# GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO airflow;</span><span id="91c8" class="lg lh hi lc b fi ls lj l lk ll">GRANT</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/4506097f5726f2f61a3239c58c22a78e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ndpuMcAt1akmFUAZE6vsTw.png"/></div></div></figure><p id="14db" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装以下软件包，这是使用PostgreSQL进行airflow connect的先决条件。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="9a42" class="lg lh hi lc b fi li lj l lk ll">sudo apt install libpq-dev</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/308e2526c9fe4f82ba2d4ed265ad4459.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tCrovzH1rt7ep5Af151B9g.png"/></div></div></figure><p id="d547" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下命令是安装airflow、PostgreSQL、psycopg2(用python连接PostgreSQL)和设置PostgreSQL的路径。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="943b" class="lg lh hi lc b fi li lj l lk ll">pip install apache-airflow['postgresql']</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/1ef83769ad22efebfd8d32e016853ada.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xd-s1YkbIjJwFdG5THgU3g.png"/></div></div></figure><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="d8e0" class="lg lh hi lc b fi li lj l lk ll">pip install psycopg2</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/4fbb27847396df444db9d24b5746ca29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uDDj6lvrCgXsj2l-K09qlA.png"/></div></div></figure><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="3f3a" class="lg lh hi lc b fi li lj l lk ll">export PATH=$PATH:/home/your_user/.local/bin/</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/3b543008442b655a66f26b78df8ea188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YSSMktihxpiK0Rijj9jcEQ.png"/></div></div></figure><p id="241d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们需要更改一些气流配置，以将气流与PostgreSQL连接起来，PostgreSQL是可以在气流文件夹中找到的配置文件。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="2f7c" class="lg lh hi lc b fi li lj l lk ll">vim airflow.cfg</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/16f94714189e21b81ee86be0cbceef10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*in1UaAA_5gUNcgXSNkKhhQ.png"/></div></div></figure><p id="e749" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jx">注意如果您在用户目录中找不到airflow文件夹，请键入airflow scheduler，它将创建该目录，然后按ctrl+c取消。</em></p><p id="91c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后做以下修改。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="9429" class="lg lh hi lc b fi li lj l lk ll">executor = LocalExecutor</span><span id="a274" class="lg lh hi lc b fi ls lj l lk ll">sql_alchemy_conn = postgresql+psycopg2://airflow:airflow@localhost/airflow</span></pre><p id="9d76" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，我们将顺序执行器改为负责并行执行的本地执行器。</p><p id="8b27" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">apache airflow元数据的默认数据库SQL LIT不能处理并行执行，因此我们将SQL alchemy连接改为PostgreSQL。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/26b3e687488ef84a32bc491052811e5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WaEmiWtJPI12AB9IxmnIMw.png"/></div></div></figure><p id="73c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在第一次初始化你的元数据库。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="f160" class="lg lh hi lc b fi li lj l lk ll">airflow db init</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ma"><img src="../Images/9f278bcdea6c007b02504f22abf530d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D-eGfbyiCLnEqW0zIJExNg.png"/></div></div></figure><p id="46f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你看到一个长进程在你的系统中运行，没有问题，只需要查找最后一行初始化完成。</p><p id="5644" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建登录到airflow web服务器或airflow UI的用户。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="d83b" class="lg lh hi lc b fi li lj l lk ll">airflow users create -r Admin -u admin -e admin@example.com -f admin -l user -p test</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/e95156050922e83eabe83c7fb601896d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cRZ3YPK5xrtWuiOiPhSsoA.png"/></div></div></figure><p id="ee60" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">启动airflow服务器</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="847c" class="lg lh hi lc b fi li lj l lk ll">airflow webserver</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/713b58f3f60bcfcc37e704667afcbfb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5QK3QTmJtMW7FIIGapjuKA.png"/></div></div></figure><p id="cb38" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">启动气流调度程序</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="e106" class="lg lh hi lc b fi li lj l lk ll">airflow scheduler</span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/c5e69a638400adf8f318f66b609da163.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vpje8ArOyTNuHgya3IPkYA.png"/></div></div></figure><p id="05b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在端口8080上检查您的本地主机，输入您创建的凭证，您就可以开始了。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/1eb0e8d149896c92b98f85b609399406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CH01LBDtWWQ9ImCqnEttcw.png"/></div></div></figure><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/09bd1e9bc98c31f0685c724802fa4635.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jf41-MK6hv1CBuRgFRpjRA.png"/></div></div></figure><p id="45b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">恭喜您，现在您已经成功地将气流安装到您的系统中。如你所知，现在安装Apache airflow并不容易，这就是为什么我们有docker，其中的一切都已经设置好了。如果你想知道如何安装气流与docker <a class="ae ke" href="https://kundansinghynr.medium.com/apache-airflow-2-0-complete-installation-with-docker-explained-f07aa1049f1e" rel="noopener">点击这里</a>。</p><p id="bb62" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一些重要的参考资料，你可以看看。</p><div class="kf kg ez fb kh ki"><a href="http://airflow.apache.org/docs/" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab dw"><div class="kk ab kl cl cj km"><h2 class="bd hj fi z dy kn ea eb ko ed ef hh bi translated">证明文件</h2><div class="kp l"><h3 class="bd b fi z dy kn ea eb ko ed ef dx translated">Apache Airflow Core，它包括web服务器、调度程序、CLI和最小气流所需的其他组件…</h3></div><div class="kq l"><p class="bd b fp z dy kn ea eb ko ed ef dx translated">airflow.apache.org</p></div></div><div class="kr l"><div class="mf l kt ku kv kr kw io ki"/></div></div></a></div><div class="kf kg ez fb kh ki"><a href="https://docs.docker.com/get-started/" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab dw"><div class="kk ab kl cl cj km"><h2 class="bd hj fi z dy kn ea eb ko ed ef hh bi translated">方向和设置</h2><div class="kp l"><h3 class="bd b fi z dy kn ea eb ko ed ef dx translated">欢迎光临！我们很高兴你想学习Docker。本页包含如何获得…的逐步说明</h3></div><div class="kq l"><p class="bd b fp z dy kn ea eb ko ed ef dx translated">docs.docker.com</p></div></div><div class="kr l"><div class="mg l kt ku kv kr kw io ki"/></div></div></a></div></div></div>    
</body>
</html>