<html>
<head>
<title>How to Use Microsoft Video Indexer with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中使用Microsoft视频索引器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-use-microsoft-video-indexer-with-python-2e93baffe0a0?source=collection_archive---------9-----------------------#2021-05-15">https://medium.com/geekculture/how-to-use-microsoft-video-indexer-with-python-2e93baffe0a0?source=collection_archive---------9-----------------------#2021-05-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f414e202a9cf674af1fc0fedd8ebd7f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GA6LIPVXHMCK-x5lPsITXg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@bernardhermant?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Bernard Hermant</a> on <a class="ae iu" href="https://unsplash.com/collections/5034618/colorful-connect?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7dd7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">曾经不得不分析大量的视频吗？像很多人一样，你不可能看完2000年。如果这是一个听起来很熟悉的问题，那么<a class="ae iu" href="https://vi.microsoft.com/en-us" rel="noopener ugc nofollow" target="_blank">视频索引器</a>就是你的朋友。</p><p id="ef4c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是一个微软API，可以分析视频中的音频和图像，输出非常丰富的数据。我发现它也非常强大，但需要相当多的时间来建立一个强大的管道，以便您可以大规模使用API，这就是这篇文章背后的基本原理。</p><p id="550d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你只想上传一个视频，那么在视频索引网站上手动上传会容易得多。但是如果你想定期分析大量的视频，那么希望这篇文章适合你。</p><h2 id="55d8" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">视频索引器设置</h2><p id="072d" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">不幸的是，即使只是建立一个账户，有时也会感觉像是在迷宫中找到自己的路。首先，前往<a class="ae iu" href="https://api-portal.videoindexer.ai" rel="noopener ugc nofollow" target="_blank"> API门户</a>点击开始，然后创建一个帐户。</p><p id="34be" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">完成后，选择products选项卡。如果你找不到它，那么你可以直接导航到这个<a class="ae iu" href="https://api-portal.videoindexer.ai/products" rel="noopener ugc nofollow" target="_blank">网址</a>，点击授权，然后订阅(如果你还没有的话)。请务必保存好您的订阅密钥，您稍后会需要这些密钥！</p><p id="8245" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在去另一个<a class="ae iu" href="https://www.videoindexer.ai" rel="noopener ugc nofollow" target="_blank">不同的视频索引站点</a>——我不知道为什么有两个——点击最左边的设置。从本页复制您的帐户ID。</p><p id="754e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦完成，您就可以前往<a class="ae iu" href="https://api-portal.videoindexer.ai/api-details#api=Operations&amp;operations=Get-Account-Access-Token" rel="noopener ugc nofollow" target="_blank">他们的交互式API门户</a>并获得认证API调用所需的访问令牌。如果你想以编程的方式对他做什么，就向下面的URL发出一个GET请求:</p><blockquote class="kt ku kv"><p id="91c2" class="iv iw kw ix b iy iz ja jb jc jd je jf kx jh ji jj ky jl jm jn kz jp jq jr js hb bi translated"><a class="ae iu" href="https://api.videoindexer.ai/Auth/trial/Accounts/your-account-id-goes-here/AccessToken?allowEdit=true" rel="noopener ugc nofollow" target="_blank">https://API . video indexer . ai/Auth/trial/Accounts/your-account-id-goes-here/access token？allowEdit=true </a></p></blockquote><p id="244a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是，要使GET请求工作，您需要在请求头中包含您的订阅密钥，如下所示:</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es la"><img src="../Images/f28ce77f567f82b727b243089fffb23a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EBinnZGaFmXVZ9KyMm6Grg.png"/></div></div></figure><p id="5911" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">唷，希望你还在我身边。它很快就会少一些管理，多一些python...</p><h2 id="3268" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">与Azure的集成</h2><p id="6a54" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">你要解决的下一个问题是如何向API发送视频。你可以在POST请求中用类似于上面的一些URL的语法发送它，但是这不是最好的主意。</p><p id="3559" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这背后的原因是，如果你这样发送，你很可能会丢失数据。视频通常是相当大的文件，因此这可能会产生一些性能问题；此外，它仅限于2GB，这也可能产生一些其他问题。微软实际上有一篇关于如何大规模使用视频索引器的很好的文章<a class="ae iu" href="https://azure.microsoft.com/en-gb/blog/six-things-to-consider-when-using-video-indexer-at-scale/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="4614" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所有这些的解决方案是使用Azure存储帐户。这确实要花钱，但非常便宜——我上次检查时大约是每001美元，而且是按使用量付费的。</p><p id="7fc1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我不打算像刚刚用Video Indexer那样设置Azure存储帐户，因为这是一个简单得多的过程。这里有一篇关于如何做的很好的文章<a class="ae iu" href="https://docs.microsoft.com/en-us/samples/azure-samples/azure-sdk-for-python-storage-blob-upload-download/upload-download-blobs-python/" rel="noopener ugc nofollow" target="_blank"/>——你需要的只是这篇文章中提到的连接字符串，然后你就可以开始上传视频了。</p><h2 id="5e64" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">如何用Python把视频上传到Azure</h2><p id="954d" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">一旦你得到了最重要的连接字符串，这里有一些代码可以用来上传你的视频。</p><figure class="lb lc ld le fd ij"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="133a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你想使用上面脚本中的类来上传一个视频文件并获取URL，那么这就是你要做的！</p><p id="761a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为此，你需要在Azure中为你的视频创建一个容器。我认为在Azure中手动这样做很简单，然后将容器名称传递到脚本中——你可以只将其称为视频，并将其用于所有视频。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/4bb420f3d9d55e3d04e5ec0852e61403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4PFkr-WqBEubmu7z3SRzhg.png"/></div></div></figure><h2 id="7e57" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">发送视频进行分析</h2><p id="7ff6" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">一旦你完成了所有这些，你现在——终于——可以上传你的视频了。</p><p id="bdb1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这一点并不太难——您只需要以正确的格式将数据发送给API。这里有一些我写的代码，你可以用它来达到这个目的；微软API设计得非常好，有一些非常有用的错误代码，你可以捕捉到，以确保你的上传顺利进行。</p><p id="29a4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意，我没有包括一个回调网址，但这是你可以做的事情；也就是说，如果您希望在视频处理完成后收到来自Microsoft API的POST请求，您可以指定接收该请求的URL。如果你热衷于此，在这里阅读更多<a class="ae iu" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-http-webhook-trigger?tabs=python#webhooks" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="3ed8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">总之，这是代码。这与上面的结构相似；我已经创建了一个VideoIndexer类，并在稍后的脚本中实例化了它——这次是在第145行的入口点之后——以便向API发送或接收视频。</p><figure class="lb lc ld le fd ij"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="2a88" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您还可以使用它来检索结果——相关的内容在第156行及以下。当您的视频处理完成时，您会收到一个通知，通知会发送到您注册时使用的电子邮件地址，因此，在您使用这部分代码调用API之前，最好等待它们到达。</p><h2 id="a4fb" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">包裹</h2><p id="39b5" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">就是这样！希望这能帮助你导航一个非常有用和强大的微软API，它(至少对我来说)需要很多耐心的摆弄才能启动和运行。但是一旦你做了最初的前期投资，我肯定你会得到大量的回报。</p></div></div>    
</body>
</html>