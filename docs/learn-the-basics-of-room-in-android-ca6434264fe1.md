# 了解什么是房间，以及如何使用它

> 原文：<https://medium.com/geekculture/learn-the-basics-of-room-in-android-ca6434264fe1?source=collection_archive---------24----------------------->

了解如何使用 Room 在本地数据库中保存数据。

![](img/b65d1bdd69b50eb9e9db977e09c1d874.png)

在这个故事中，你将学习 Android 中的基本空间。请注意，在这个故事中，我假设你有一些 Android 开发和 Kotlin 知识，这意味着我不会在这里解释简单的语言。

## 注意

在这个故事中，我们不会真的构建一个示例应用程序。我将只展示一些片段和它们的解释。

如果你想使用 Room 和其他先进的概念来构建一个示例 Android 应用程序，你将不得不等待。我打算写一篇关于它的报道。

## 通告

我只是稍微更新了一下故事图片的设计，它现在有了一点暗但是更强烈的颜色，现在是故事主题的图片。

很想得到一些关于故事图像的反馈！

开始吧！

# 什么是房间？

Room 是 Android 架构组件的一部分，它在 SQLite 上提供了一个抽象层，允许更健壮的数据库访问，同时仍然提供 SQLite 的全部功能。

基本上就是 SQLite 的改进版，特别是针对 Android 的改进。

这是 Android 官方文档对 Room 的描述:

> Room persistence 库在 SQLite 上提供了一个抽象层，允许流畅的数据库访问，同时充分利用 SQLite 的强大功能。特别是，Room 提供了以下好处:
> 
> SQL 查询的编译时验证。
> 
> -最大限度减少重复和容易出错的样板代码的便捷注释。
> 
> -简化的数据库迁移路径。
> 
> 出于这些考虑，我们强烈建议您使用 Room，而不是直接使用 SQLite APIs。

# 房间依赖关系及其工作原理

好了，现在我们知道了什么是房间，让我们看看如何将它添加到我们的项目中，以及它是如何工作的。

## 房间依赖关系

第一个`implementation`和`annotationProcessor`是要求能够使用房间。可选的依赖项并不总是必需的，只有当您确实需要这些特性时，才应该添加它们。

## 房间如何工作

房间的三个主要组成部分是:

*   **实体:**表示房间数据库中的一个表格。它应该标注有`@Entity`。
*   **DAO** :包含访问数据库的方法的接口。上面标注了`@Dao`。
*   **数据库:**代表数据库。它是一个连接 SQLite 数据库的对象，所有的操作都是通过它执行的。上面注有`@Database`。

请注意，房间不是 ORM 相反，它是一个完整的库，允许我们更容易地创建和操作 SQLite 数据库。

通过使用注释，我们可以定义我们的数据库、表和操作。Room 会自动将这些注释翻译成 SQLite 指令和查询，以在数据库引擎中执行相应的操作。

这是房间建筑的样子:

![](img/35ab775f62cf871382d6c15f8017b612.png)

Room architecture

# 房间实施

现在让我们来看看如何在我们的应用程序中实现 Room。

注意，这些例子相当简单，实际上你可以做的比我在这个故事中向你展示的要多得多。因此，请务必稍后查看 Room 文档，以了解更多关于 Room 以及如何实现它的信息。

## 实体

让我们创建一个`Phone`实体，看看我们如何在房间中创建实体。`Phone`的每个实例代表应用程序数据库中`phone`表中的一行。

很简单，对吧？

默认情况下，Room 将使用字段名作为列名。但是如果你想给你的列起一个不同的名字，你可以使用`@ColumnInfo`。

我不认为我必须解释什么`@PrimaryKey`，因为如果你有一点点数据库知识，你可能会知道。

现在让我们继续讨论道斯。

## 道斯

下面的代码定义了一个名为`PhoneDao`的 DAO。`PhoneDao`提供了应用程序的其余部分用来与`phone`表中的数据进行交互的方法。

需要注意的几件事:

*   所有的刀都要用`@Dao`标注。
*   用`@Insert`、`@Update`或`@Delete`标注的函数必须接收所需类的一个实例作为参数，它分别代表我们想要插入、更新或删除的对象。
*   在插入或更新操作的情况下，我们可以使用属性`onConflict`来指示当执行操作发生冲突时该做什么。可供使用的策略有`REPLACE`*`ABORT``FAIL``IGNORE`和`ROLLBACK`。*
*   *如果我们想从一个或多个实体获得特定的信息，我们可以用`@Query`注释一个函数，并提供一个 SQL 脚本作为参数。*

*现在让我们看看我们实际上是如何创建数据库的。*

## *数据库ˌ资料库*

*同样，这里需要注意一些事情:*

*   *这是一个必须扩展`RoomDatabase`的抽象类。*
*   *它必须用`@Database`进行注释，并接收一个实体列表，其中包含组成数据库的所有类，所有这些类都必须用`@Entity`进行注释。我们还必须提供一个数据库版本。*
*   *我们必须为包含在`@Database`注释中的每个实体声明一个抽象函数。这个函数必须返回相应的 DAO，它是一个用`@Dao`标注的类。*

# *使用房间*

*困难的部分已经完成了。剩下要做的就是在我们的应用程序中的任何地方使用空间。*

*这就是创建房间数据库实例的方法。很简单，对吧？*

*我们实际上是如何使用它的呢？嗯，这也很简单。*

*仅此而已。现在，您已经实现了一个功能齐全的房间数据库，并准备进行扩展！*

*很酷，不是吗？*

# *最后的想法*

*你刚刚学会了如何给你的应用增加空间，以及如何实际使用它。*

*希望这个故事对你有帮助。我很想知道你是否喜欢 Room，以及你是否打算在未来的项目中使用它。*

# *仅此而已。感谢您阅读这个故事！*

*如果你喜欢这个故事，一定要为它鼓掌！你想问我什么都可以。*

*在 Twitter 上关注我:*

*[](https://twitter.com/Re_allyedge) [## re _ ally 边缘

twitter.com](https://twitter.com/Re_allyedge) 

在 Patreon 上支持我:

[](https://www.patreon.com/allyedge) [## 阿里木阿尔斯兰卡亚是创造编程故事和教程。帕特里翁

### 今天就成为阿里木阿尔斯兰卡亚的赞助人:在世界上最大的…

www.patreon.com](https://www.patreon.com/allyedge)*