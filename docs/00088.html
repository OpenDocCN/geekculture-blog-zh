<html>
<head>
<title>Mongodb: Set-up sharded cluster for windows with just a double click.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Mongodb:只需双击即可为windows设置分片集群。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/set-up-mongodb-sharded-cluster-for-windows-with-just-a-double-click-6eedbb7b79e?source=collection_archive---------0-----------------------#2020-04-26">https://medium.com/geekculture/set-up-mongodb-sharded-cluster-for-windows-with-just-a-double-click-6eedbb7b79e?source=collection_archive---------0-----------------------#2020-04-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/f3b0dc2e9caaa0e3efc8279b1d0c74ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YDJfsMbP3-HLM-vmYBXZsg.png"/></div></div></figure><h2 id="5850" class="hr hs ht bd b fp hu hv hw hx hy hz dx ia translated" aria-label="kicker paragraph">MongoDB集群</h2><div class=""/><div class=""><h2 id="3270" class="pw-subtitle-paragraph iz ic ht bd b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq dx translated">双击MongoDB为windows设置分片集群。</h2></div><blockquote class="jr js jt"><p id="ea3d" class="ju jv jw jx b jy jz jd ka kb kc jg kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">请在最后找到<a class="ae kr" href="https://github.com/arun2pratap/mongodbClusterForWindowsOneClick" rel="noopener ugc nofollow" target="_blank"> Github </a>库来配置文件和脚本来设置环境。</p><p id="7936" class="ju jv jw jx b jy jz jd ka kb kc jg kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">mongodb 3.6+版，必要时链接到MongoDB文档以便进一步阅读。</p></blockquote><h2 id="81ad" class="ks kt ht bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo hz bi translated"><a class="ae kr" href="https://docs.mongodb.com/manual/sharding/" rel="noopener ugc nofollow" target="_blank">分片集群简介。</a></h2><p id="2f12" class="pw-post-body-paragraph ju jv ht jx b jy lp jd ka kb lq jg kd ld lr kg kh lh ls kk kl ll lt ko kp kq hb bi translated"><a class="ae kr" href="https://docs.mongodb.com/manual/reference/glossary/#term-sharding" rel="noopener ugc nofollow" target="_blank">分片</a>是一种跨多台机器分发数据的方法。MongoDB使用分片来支持具有非常大的数据集和高吞吐量操作的部署。</p><p id="9129" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">具有大型数据集或高吞吐量应用程序的数据库系统可能会挑战单个服务器的容量。例如，<strong class="jx id">高查询率</strong>会耗尽服务器的<strong class="jx id"> CPU容量</strong>。大于<strong class="jx id">系统RAM </strong>的工作集大小会给磁盘驱动器的<strong class="jx id"> I/O容量</strong>带来压力。</p><p id="2d94" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">MongoDB <a class="ae kr" href="https://docs.mongodb.com/manual/reference/glossary/#term-sharded-cluster" rel="noopener ugc nofollow" target="_blank">分片集群</a>由以下组件组成:</p><ul class=""><li id="9e0d" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated"><a class="ae kr" href="https://docs.mongodb.com/manual/core/sharded-cluster-shards/" rel="noopener ugc nofollow" target="_blank">分片</a>:每个分片包含一个分片数据的子集。每个碎片可以被部署为一个副本集。</li><li id="3c1d" class="lu lv ht jx b jy md kb me ld mf lh mg ll mh kq lz ma mb mc bi translated"><a class="ae kr" href="https://docs.mongodb.com/manual/core/sharded-cluster-query-router/" rel="noopener ugc nofollow" target="_blank">mongos</a>:<code class="du mi mj mk ml b">mongos</code>充当查询路由器，提供客户端应用程序和分片集群之间的接口。</li><li id="458a" class="lu lv ht jx b jy md kb me ld mf lh mg ll mh kq lz ma mb mc bi translated"><a class="ae kr" href="https://docs.mongodb.com/manual/core/sharded-cluster-config-servers/" rel="noopener ugc nofollow" target="_blank">配置服务器</a>:配置服务器存储集群的元数据和配置设置。从MongoDB 3.4开始，配置服务器必须作为副本集部署(CSRS)。</li></ul><h2 id="ac6e" class="ks kt ht bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo hz bi translated">使用具有<a class="ae kr" href="https://docs.mongodb.com/manual/core/replica-set-architecture-three-members/" rel="noopener ugc nofollow" target="_blank"> 3成员副本集</a>主要-次要-次要(P-S-S)的2个分片在windows中设置分片集群环境。</h2><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mm"><img src="../Images/c2619dc907f7c26e7abeb5073d741319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MXXI9PzlT4mjcKkBxRt6IA.png"/></div></div></figure><p id="c2ff" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">我们将设置如图所示的集群环境。(单个路由器的本地设置)</p><h2 id="de4a" class="ks kt ht bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo hz bi translated">对于设置，我们将生成9个mongod实例和1个mongos(路由器)实例。</h2><ul class=""><li id="6886" class="lu lv ht jx b jy lp kb lq ld mr lh ms ll mt kq lz ma mb mc bi translated">首先，我们需要设置配置服务器副本集。</li><li id="c2a6" class="lu lv ht jx b jy md kb me ld mf lh mg ll mh kq lz ma mb mc bi translated">碎片01副本集。</li><li id="54f6" class="lu lv ht jx b jy md kb me ld mf lh mg ll mh kq lz ma mb mc bi translated">碎片02副本集。</li><li id="602a" class="lu lv ht jx b jy md kb me ld mf lh mg ll mh kq lz ma mb mc bi translated">配置指向配置服务器的路由器(mongos)。</li><li id="8472" class="lu lv ht jx b jy md kb me ld mf lh mg ll mh kq lz ma mb mc bi translated">通过路由器向集群添加分片01和分片02。</li></ul><p id="264b" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">对于每个实例将创建一个“db”(数据库文件)和“log”(日志文件)文件夹。</p><h2 id="477c" class="ks kt ht bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo hz bi translated">让我们开始吧……..</h2><h2 id="7246" class="ks kt ht bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo hz bi translated">正在设置配置3成员副本集。</h2><ul class=""><li id="d563" class="lu lv ht jx b jy lp kb lq ld mr lh ms ll mt kq lz ma mb mc bi translated">为3实例“数据库”、“日志”文件夹创建文件夹结构</li></ul><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="088b" class="ks kt ht ml b fi my mz l na nb">md csrs\csrs1\db csrs\csrs1\log csrs\csrs2\db csrs\csrs2\log csrs\csrs3\db csrs\csrs3\log</span></pre><ul class=""><li id="0466" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated"><code class="du mi mj mk ml b">csrs1.conf</code>配置服务器之一的文件。我们需要分配<code class="du mi mj mk ml b">clusterRole: configsvr </code>将其标记为公共<code class="du mi mj mk ml b"><strong class="jx id">replSetName: csrs</strong></code> <strong class="jx id"> </strong>下的配置服务器，使它们成为同一个副本集“csrs”的成员。</li></ul><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="f1a9" class="ks kt ht ml b fi my mz l na nb"><strong class="ml id">sharding:<br/>  clusterRole: configsvr</strong><br/><strong class="ml id">replication:<br/>  replSetName: csrs</strong><br/>net:<br/>  bindIpAll: true<br/>  port: 26001<br/>systemLog:<br/>  destination: file<br/>  path: csrs/csrs1/log/csrs1.log<br/>  logAppend: true<br/>storage:<br/>  dbPath: csrs/csrs1/db/</span></pre><ul class=""><li id="508c" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated">对于配置副本集的其余2个成员，我们将执行相同的操作，如果我们在同一台主机上运行，只需更改端口；如果在不同的主机上运行，则可以保持端口不变。</li></ul><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="129c" class="ks kt ht ml b fi my mz l na nb">sharding:<br/>  clusterRole: configsvr<br/>replication:<br/>  replSetName: csrs<br/>net:<br/>  bindIpAll: true<br/>  port: 26002<br/>systemLog:<br/>  destination: file<br/>  path: csrs/csrs2/log/csrs2.log<br/>  logAppend: true<br/>storage:<br/>  dbPath: csrs/csrs2/db/</span></pre><p id="13f7" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">将配置保存到文件:<code class="du mi mj mk ml b">csrs2.conf</code></p><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="4c15" class="ks kt ht ml b fi my mz l na nb">sharding:<br/>  clusterRole: configsvr<br/>replication:<br/>  replSetName: csrs<br/>net:<br/>  bindIpAll: true<br/>  port: 26003<br/>systemLog:<br/>  destination: file<br/>  path: csrs/csrs3/log/csrs3.log<br/>  logAppend: true<br/>storage:<br/>  dbPath: csrs/csrs3/db/</span></pre><p id="4688" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">将配置保存到文件:<code class="du mi mj mk ml b">csrs3.conf</code></p><ul class=""><li id="d8a3" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated">现在我们可以启动配置服务器了。在端口[26001，26002，26003]上运行</li></ul><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="6192" class="ks kt ht ml b fi my mz l na nb">echo starting Config replicaSet member's<br/> start mongod -f csrs1.conf<br/> start mongod -f csrs2.conf<br/> start mongod -f csrs3.conf</span></pre><ul class=""><li id="8790" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated">将它们配置为同一副本集的一部分。</li></ul><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="1313" class="ks kt ht ml b fi my mz l na nb">// start one of the server client of the replica set.<br/> mongo --port 26001<br/> rs.initiate() <br/>// this will start showing it as primary.<br/>// add 2 other config server to the replicaset.<br/> rs.add("didnasiina6:26002") <br/>// if ip doesn't work use machineName<br/> rs.add("didnasiina6:26003")<br/>// check all replica set added.<br/> rs.conf() // this will print the info of the configured server.<br/>{<br/>        "_id" : "csrs",<br/>        "version" : 3,<br/>        "configsvr" : true,<br/>        "protocolVersion" : NumberLong(1),<br/>        "writeConcernMajorityJournalDefault" : true,<br/>        "members" : [<br/>                {<br/>                        "_id" : 0,<br/>                        "host" : "didnasiina6:26001",<br/>                        "arbiterOnly" : false,<br/>                        "buildIndexes" : true,<br/>                        "hidden" : false,<br/>                        "priority" : 1,<br/>                        "tags" : {</span><span id="d24e" class="ks kt ht ml b fi nc mz l na nb">},<br/>                        "slaveDelay" : NumberLong(0),<br/>                        "votes" : 1<br/>                },<br/>                {<br/>                        "_id" : 1,<br/>                        "host" : "didnasiina6:26002",<br/>                        "arbiterOnly" : false,<br/>                        "buildIndexes" : true,<br/>                        "hidden" : false,<br/>                        "priority" : 1,<br/>                        "tags" : {</span><span id="12f3" class="ks kt ht ml b fi nc mz l na nb">},<br/>                        "slaveDelay" : NumberLong(0),<br/>                        "votes" : 1<br/>                },<br/>                {<br/>                        "_id" : 2,<br/>                        "host" : "didnasiina6:26003",<br/>                        "arbiterOnly" : false,<br/>                        "buildIndexes" : true,<br/>                        "hidden" : false,<br/>                        "priority" : 1,<br/>                        "tags" : {</span><span id="5c83" class="ks kt ht ml b fi nc mz l na nb">},<br/>                        "slaveDelay" : NumberLong(0),<br/>                        "votes" : 1<br/>                }<br/>        ],<br/>        "settings" : {<br/>                "chainingAllowed" : true,<br/>                "heartbeatIntervalMillis" : 2000,<br/>                "heartbeatTimeoutSecs" : 10,<br/>                "electionTimeoutMillis" : 10000,<br/>                "catchUpTimeoutMillis" : -1,<br/>                "catchUpTakeoverDelayMillis" : 30000,<br/>                "getLastErrorModes" : {</span><span id="521f" class="ks kt ht ml b fi nc mz l na nb">},<br/>                "getLastErrorDefaults" : {<br/>                        "w" : 1,<br/>                        "wtimeout" : 0<br/>                },<br/>                "replicaSetId" : ObjectId("5e09cfcc596228f43c03c4c2")<br/>        }<br/>}</span></pre><p id="9a72" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">现在，我们已经设置并运行了配置服务器副本。</p><h2 id="cf82" class="ks kt ht bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo hz bi translated">正在设置Shard-01，3成员副本集。</h2><ul class=""><li id="cd81" class="lu lv ht jx b jy lp kb lq ld mr lh ms ll mt kq lz ma mb mc bi translated">为3实例“数据库”、“日志”文件夹创建文件夹结构</li></ul><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="c3a2" class="ks kt ht ml b fi my mz l na nb">md sh01\sh011\db sh01\sh011\log sh01\sh012\db sh01\sh012\log sh01\sh013\db sh01\sh013\log<br/>echo Created mongoDb folder structure for Shard 01 Server Instances</span></pre><ul class=""><li id="73a8" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated">设置shard replicaset与我们已经对config replica set所做的完全相同。我只需要告诉你这个有一个<code class="du mi mj mk ml b">clusterRole: shardsvr</code>并且我们取了一个不同的<code class="du mi mj mk ml b">replSetName: sh01 </code>，这个不同的<code class="du mi mj mk ml b">replSetName: sh01 </code>将在相同碎片副本集的所有三个成员中通用。</li></ul><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="d43f" class="ks kt ht ml b fi my mz l na nb"><strong class="ml id">sharding:<br/>  clusterRole: shardsvr<br/>replication:<br/>  replSetName: sh01</strong><br/>net:<br/>  bindIpAll: true<br/>  port: 27011<br/>systemLog:<br/>  destination: file<br/>  path: sh01/sh011/log/sh011.log<br/>  logAppend: true<br/>storage:<br/>  dbPath: sh01/sh011/db/</span></pre><p id="e2d8" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">将配置保存到文件:<code class="du mi mj mk ml b">sh011.conf</code></p><p id="e2c8" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">将对其他2人组<code class="du mi mj mk ml b">sh012.conf</code>和<code class="du mi mj mk ml b">sh013.conf</code>进行同样的操作</p><ul class=""><li id="9082" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated">现在我们可以启动碎片服务器了。在端口[27011，27012，27013]上运行</li></ul><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="7fa9" class="ks kt ht ml b fi my mz l na nb">echo starting Shard 01 Replica Set member's.<br/> start mongod -f sh011.conf<br/> start mongod -f sh012.conf<br/> start mongod -f sh013.conf</span></pre><ul class=""><li id="fda8" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated">将它们配置为同一副本集的一部分。</li></ul><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="fb45" class="ks kt ht ml b fi my mz l na nb">// start one of the server client of the replica set.<br/>mongo --port 27011</span><span id="fbcb" class="ks kt ht ml b fi nc mz l na nb">rs.initiate()<br/>// add 2 other config server to the replicaset.<br/>rs.add("didnasiina6:27012")<br/>rs.add("didnasiina6:27013")<br/>rs.status() // this will print the info of the configured server.</span><span id="4ab6" class="ks kt ht ml b fi nc mz l na nb">// ... not printing the output. already did for config replSet.</span></pre><p id="6c79" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">现在我们已经建立并运行了Shard 01副本。</p><h2 id="53c6" class="ks kt ht bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo hz bi translated">正在设置Shard-02，3成员副本集。</h2><p id="5860" class="pw-post-body-paragraph ju jv ht jx b jy lp jd ka kb lq jg kd ld lr kg kh lh ls kk kl ll lt ko kp kq hb bi translated">和碎片01的设定一模一样。如果找到并替换<code class="du mi mj mk ml b">sh01</code>到<code class="du mi mj mk ml b">sh02</code>:)并为所有配置和文件夹结构分配新端口，我们就必须这么做。</p><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="19e2" class="ks kt ht ml b fi my mz l na nb">md sh02\sh021\db sh02\sh021\log sh02\sh022\db sh02\sh022\log sh02\sh023\db sh02\sh023\log<br/>echo Created mongoDb folder structure for Shard 02 Server Instances</span></pre><ul class=""><li id="2448" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated">服务器配置文件<code class="du mi mj mk ml b">sh021.conf</code>、<code class="du mi mj mk ml b">sh022.conf</code>和<code class="du mi mj mk ml b">sh023.conf</code></li></ul><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="7a3b" class="ks kt ht ml b fi my mz l na nb">sharding:<br/>  clusterRole: shardsvr<br/>replication:<br/>  replSetName: <strong class="ml id">sh02</strong><br/>net:<br/>  bindIpAll: true<br/>  port: <strong class="ml id">27021</strong><br/>systemLog:<br/>  destination: file<br/>  path: <strong class="ml id">sh02/sh021/log/sh021.log</strong><br/>  logAppend: true<br/>storage:<br/>  dbPath: <strong class="ml id">sh02/sh021/db/</strong></span></pre><ul class=""><li id="a5d5" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated">现在我们可以启动碎片服务器了。在端口[27021，27022，27023]上运行</li></ul><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="f58c" class="ks kt ht ml b fi my mz l na nb">echo starting Shard 02 Replica Set member's.<br/> start mongod -f sh021.conf<br/> start mongod -f sh022.conf<br/> start mongod -f sh023.conf</span></pre><ul class=""><li id="d4e9" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated">将它们配置为同一副本集的一部分。</li></ul><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="e22e" class="ks kt ht ml b fi my mz l na nb">// start one of the server client of the replica set.<br/>mongo --port 27021</span><span id="fd43" class="ks kt ht ml b fi nc mz l na nb">rs.initiate()<br/>// add 2 other config server to the replicaset.<br/>rs.add("didnasiina6:27022")<br/>rs.add("didnasiina6:27023")<br/>rs.status() // check for status, look for Primary/Secondary members.<br/>rs.conf() // see the configuration of replSet.</span></pre><p id="94a9" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">现在我们已经建立并运行了Shard 02副本。</p><h2 id="c067" class="ks kt ht bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo hz bi translated"><a class="ae kr" href="https://docs.mongodb.com/manual/core/sharded-cluster-query-router/" rel="noopener ugc nofollow" target="_blank">配置路由器。</a></h2><ul class=""><li id="3e7f" class="lu lv ht jx b jy lp kb lq ld mr lh ms ll mt kq lz ma mb mc bi translated">启动mongo路由器(<a class="ae kr" href="https://docs.mongodb.com/manual/core/sharded-cluster-query-router/" rel="noopener ugc nofollow" target="_blank"> mongos </a>)。</li></ul><p id="c32f" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">由于mongo路由器不是一个数据库实例，没有自己的数据库，只需要创建“日志”文件夹。</p><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="bcb4" class="ks kt ht ml b fi my mz l na nb">md router\log</span></pre><ul class=""><li id="b848" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated">路由器配置文件<code class="du mi mj mk ml b">mongos.conf</code>我们需要路由器指向<code class="du mi mj mk ml b"><strong class="jx id">configDB: csrs/didnasiina6:26001,didnasiina6:26002,didnasiina6:26003</strong></code> <strong class="jx id"> </strong> no storage部分，因为它没有自己的db，使用配置服务器将查询路由到shard。</li></ul><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="7903" class="ks kt ht ml b fi my mz l na nb"><strong class="ml id">sharding:<br/>  configDB: csrs/didnasiina6:26001,didnasiina6:26002,didnasiina6:26003</strong><br/>net:<br/>  bindIpAll: true<br/>  port: 26000<br/>systemLog:<br/>  destination: file<br/>  path: log/mongos.log<br/>  logAppend: true</span></pre><ul class=""><li id="0b28" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated">将shard添加到monos(路由器)。</li></ul><pre class="mn mo mp mq fd mu ml mv mw aw mx bi"><span id="6a6a" class="ks kt ht ml b fi my mz l na nb">// connect to mongos client <br/>   mongo --port 26000<br/>   sh.addShard("sh01/didnasiina6:27011")<br/>   sh.addShard("sh02/didnasiina6:27021")<br/>// check the status<br/>sh.status()<br/>--- Sharding Status ---<br/>  sharding version: {<br/>        "_id" : 1,<br/>        "minCompatibleVersion" : 5,<br/>        "currentVersion" : 6,<br/>        "clusterId" : ObjectId("5e09cfcf596228f43c03c4d1")<br/>  }<br/> <strong class="ml id"> shards:<br/>        {  "_id" : "sh01",  "host" : "sh01/didnasiina6:27011,didnasiina6:27012",  "state" : 1 }<br/>        {  "_id" : "sh02",  "host" : "sh02/didnasiina6:27021,didnasiina6:27022,didnasiina6:27023",  "state" : 1 }</strong><br/>  active mongoses:<br/>        "4.0.10" : 1<br/>  autosplit:<br/>        Currently enabled: yes<br/>  balancer:<br/>        Currently enabled:  yes<br/>        Currently running:  no<br/>        Failed balancer rounds in last 5 attempts:  5<br/>        Last reported error:  Could not find host matching read preference { mode: "primary" } for set sh01<br/>        Time of Reported error:  Tue Apr 21 2020 11:50:36 GMT+0530 (India Standard Time)<br/>        Migration Results for the last 24 hours:<br/>                No recent migrations<br/>  databases:<br/>        {  "_id" : "config",  "primary" : "config",  "partitioned" : true }<br/>                config.system.sessions<br/>                        shard key: { "_id" : 1 }<br/>                        unique: false<br/>                        balancing: true<br/>                        chunks:<br/>                                sh01    1<br/>                        { "_id" : { "$minKey" : 1 } } --&gt;&gt; { "_id" : { "$maxKey" : 1 } } on : sh01 Timestamp(1, 0)<br/>        {  "_id" : "mars",  "primary" : "sh01",  "partitioned" : false,  "version" : {  "uuid" : UUID("039312c7-e98d-4099-b69a-1fc57de1d9e4"),  "lastMod" : 1 } }<br/></span></pre><p id="3c91" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">全部完成..Mongodb分片集群环境已经启动并运行。</p><p id="0f88" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">一些有用的命令。</p><ul class=""><li id="5a2f" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated"><a class="ae kr" href="https://docs.mongodb.com/manual/reference/method/rs.status/" rel="noopener ugc nofollow" target="_blank"> rs.status </a> () // <a class="ae kr" href="https://docs.mongodb.com/manual/reference/method/js-replication/" rel="noopener ugc nofollow" target="_blank">副本成员</a>命令</li><li id="5084" class="lu lv ht jx b jy md kb me ld mf lh mg ll mh kq lz ma mb mc bi translated"><a class="ae kr" href="https://docs.mongodb.com/manual/reference/method/rs.conf/" rel="noopener ugc nofollow" target="_blank"> rs.config </a> () // <a class="ae kr" href="https://docs.mongodb.com/manual/reference/method/js-replication/" rel="noopener ugc nofollow" target="_blank">副本成员</a>命令</li><li id="f814" class="lu lv ht jx b jy md kb me ld mf lh mg ll mh kq lz ma mb mc bi translated"><a class="ae kr" href="https://docs.mongodb.com/manual/reference/method/sh.status/" rel="noopener ugc nofollow" target="_blank">sh . status</a>()//<a class="ae kr" href="https://docs.mongodb.com/manual/reference/method/js-sharding/" rel="noopener ugc nofollow" target="_blank">mongos分片</a>命令。</li></ul><h1 id="03fb" class="nd kt ht bd ku ne nf ng ky nh ni nj lc ji nk jj lg jl nl jm lk jo nm jp lo nn bi translated">Github存储库到配置文件和脚本来设置环境。</h1><p id="70ef" class="pw-post-body-paragraph ju jv ht jx b jy lp jd ka kb lq jg kd ld lr kg kh lh ls kk kl ll lt ko kp kq hb bi translated">请按照README.md进行快速轻松的设置，只需双击即可:)</p><p id="3937" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated"><a class="ae kr" href="https://github.com/arun2pratap/mongodbClusterForWindowsOneClick" rel="noopener ugc nofollow" target="_blank">Github</a>:<a class="ae kr" href="https://github.com/arun2pratap/mongodbClusterForWindowsOneClick" rel="noopener ugc nofollow" target="_blank">https://Github . com/arun 2 pratap/mongodbClusterForWindowsOneClick</a></p><blockquote class="jr js jt"><p id="f23b" class="ju jv jw jx b jy jz jd ka kb kc jg kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">这个例子如果用于本地盒，将无缝地用于分布式设置。只是你必须使文件夹结构创建配置文件，并在该主机上启动服务器，配置时需要指向该主机。</p></blockquote></div><div class="ab cl no np gp nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="hb hc hd he hf"><p id="54c9" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">尽量保持简单，请添加评论/评论任何你认为可以改进的地方。快乐编码:)</p><p id="b0c0" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">希望这是有帮助的，谢谢</p></div></div>    
</body>
</html>