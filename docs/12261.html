<html>
<head>
<title>Amazing preview images with Next.js and LQIP Modern</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Next.js和LQIP Modern预览惊人的图像</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/amazing-preview-images-with-next-js-and-lqip-modern-d846ab69cda8?source=collection_archive---------8-----------------------#2022-05-04">https://medium.com/geekculture/amazing-preview-images-with-next-js-and-lqip-modern-d846ab69cda8?source=collection_archive---------8-----------------------#2022-05-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/5f5d4551e3b614a962974afc12f1ef16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gW8Xh6tzJN7X9ZdVLiSeVQ.png"/></div></div></figure><div class=""/><p id="35f7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">加载图像需要很长时间，并且可能会对UX产生破坏性影响。今天我们将学习用一个名为<code class="du jo jp jq jr b"><a class="ae js" href="https://www.npmjs.com/package/lqip-modern" rel="noopener ugc nofollow" target="_blank">lqip-modern</a></code>的库来创建预览图像。</p><h1 id="2802" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">什么是LQIP？</h1><p id="6e51" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated"><strong class="is hu"> LQIP </strong>简单的代表<strong class="is hu">L</strong>ow<strong class="is hu">Q</strong>quality<strong class="is hu">I</strong>mage<strong class="is hu">P</strong>lace holders。它们具有极小的文件大小，并且在实际图像仍在加载时充当实际图像的占位符。这些极小的文件大小是通过模糊图像、将其调整为较小的大小或降低JPEGs的质量来获得的。</p><h1 id="9799" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">和睦相处</h1><p id="6b03" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">所有现代浏览器都支持WebP。此外，只有在使用macOS 11 (Big Sur)或更高版本的情况下，macOS上的Safari才支持WebP。<a class="ae js" href="https://caniuse.com/?search=webp" rel="noopener ugc nofollow" target="_blank">来源</a></p><p id="b1c9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果目标是100%兼容，我们也可以使用JPEG LQIPs(它们几乎是WebP图像大小的2-3倍)。</p><p id="d6a5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们看看如何在Next.js中使用<code class="du jo jp jq jr b">lqip-modern</code></p><h1 id="b492" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">通过Next.js使用LQIP Modern</h1><p id="6327" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">Next.js有一个内置的<a class="ae js" href="https://nextjs.org/docs/api-reference/next/image" rel="noopener ugc nofollow" target="_blank"> next/image </a>组件，可以在不使用外部库的情况下为本地文件提供预览图像，但不能为远程图像提供预览图像。</p><p id="b387" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们的方法也有一个限制，即预览图像是在构建时创建的。这意味着，如果外部图像改变，那么预览图像将不会改变。</p><p id="d912" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是，如果从CMS获取图像，这种方法将特别有用。如果图像曾经被更新，则可以触发构建，这将创建新的预览图像。更好的方法是使用<a class="ae js" href="https://nextjs.org/docs/basic-features/data-fetching/incremental-static-regeneration#on-demand-revalidation-beta" rel="noopener ugc nofollow" target="_blank">按需增量静态再生</a>或常规增量静态再生，但是，这超出了本文的范围。你可以阅读<a class="ae js" href="https://blog.anishde.dev/making-a-blog-with-directus-mdx-and-nextjs-on-demand-isr" rel="noopener ugc nofollow" target="_blank">我的关于用Directus </a>实现按需增量静态再生的博文，了解更多信息。</p><p id="9d95" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本例中，我们将了解如何为Unsplash中的图像创建预览图像。在本教程中，我将使用<a class="ae js" href="https://images.unsplash.com/photo-1642083139428-9ee5fa423c46" rel="noopener ugc nofollow" target="_blank">这个威塞尔马克杯和一些电脑外围设备的惊人图片</a>。但是，你可以选择任何你喜欢的图片。</p><p id="819e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，让我们创建一个新的Next.js应用程序</p><pre class="kw kx ky kz fd la jr lb lc aw ld bi"><span id="a52c" class="le ju ht jr b fi lf lg l lh li">npx create-next-app next-lqip-demo<br/># OR<br/>yarn create next-app next-lqip-demo</span></pre><p id="8f16" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建完成后，在您喜欢的代码编辑器中打开项目。</p><p id="33e4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，打开<code class="du jo jp jq jr b">pages/index.js</code>文件，用下面的代码替换它</p><figure class="kw kx ky kz fd hk"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="8dc7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另外，用下面的代码替换<code class="du jo jp jq jr b">next.config.js</code>中的代码</p><figure class="kw kx ky kz fd hk"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="fd9a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们使用<code class="du jo jp jq jr b">next/image</code>组件来显示我们来自Unsplash的图像。由于图像来自远程URL，我们还必须在<code class="du jo jp jq jr b">next.config.js</code>中添加域。</p><p id="113d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在运行<code class="du jo jp jq jr b">npm run dev</code>或<code class="du jo jp jq jr b">yarn dev</code>启动开发服务器，然后访问<a class="ae js" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> localhost:3000 </a>。你将会看到带有图片的页面标题-</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ll"><img src="../Images/5e17f86216bab73ff5a5eb5fdde26b17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aIiQzZ0FVfyiV4Ae"/></div></div></figure><p id="2761" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您第一次访问该页面时，您可能已经注意到图像加载只花了一秒钟的时间。根据您的互联网连接，速度可能快也可能慢。如果你有一个快速的互联网连接，打开开发工具，并转到网络标签。在这里你可以调节你的网络连接来模拟一个缓慢的加载时间-</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div class="er es lm"><img src="../Images/bc12eeca5b6a5a45f18049c14ca9577f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/0*i6VUrpuvSBnMLVVa"/></div></figure><h1 id="6dda" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用LQIP优化我们的远程映像</h1><p id="1184" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">首先，让我们安装<code class="du jo jp jq jr b">lqip-modern</code>，和<code class="du jo jp jq jr b"><a class="ae js" href="https://www.npmjs.com/package/sharp" rel="noopener ugc nofollow" target="_blank">sharp</a></code>。夏普是一个很棒的软件包，有助于图像转换，被<code class="du jo jp jq jr b">lqip-modern</code>使用</p><pre class="kw kx ky kz fd la jr lb lc aw ld bi"><span id="7ab7" class="le ju ht jr b fi lf lg l lh li">npm install --save lqip-modern sharp<br/># OR<br/>yarn add lqip-modern sharp</span></pre><p id="da1e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，用以下代码替换<code class="du jo jp jq jr b">pages/index.js</code>中的代码</p><figure class="kw kx ky kz fd hk"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="1e05" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<code class="du jo jp jq jr b">getStaticProps</code>中，我们首先获取图像并将其转换到<a class="ae js" href="https://nodejs.org/api/buffer.html#buffer" rel="noopener ugc nofollow" target="_blank">缓冲区</a>。然后我们给<code class="du jo jp jq jr b">lqip-modern</code>我们的缓冲区，它返回给我们一个名为<code class="du jo jp jq jr b">previewImage</code>的对象，它包含一个缓冲区和一些元数据。在元数据中，有一个名为<code class="du jo jp jq jr b">dataURIBase64</code>的字段，它是我们预览图像的base64 URL。我们通过props将它传递给客户端应用程序。</p><p id="3f12" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在客户端，我们向我们的<code class="du jo jp jq jr b">Image</code>组件添加了一个新的<code class="du jo jp jq jr b">placeholder="blur"</code>参数，它将显示一个模糊占位符。因为这是一个远程图像，我们需要传入<code class="du jo jp jq jr b">blurDataURL</code>参数。我们传入了之前从元数据中获得的预览图像的base64 URL。</p><p id="3b35" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，如果您重新加载页面，当图像正在加载时，您应该会看到预览图像。</p><p id="c570" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于那些好奇的人来说，这是<code class="du jo jp jq jr b">lqip-modern</code>给我们创造的形象-</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div class="er es ln"><img src="../Images/669df70865deffd4d992c9ddde5d6082.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/0*r7f9TDHIV4Qzztyi"/></div></figure><p id="124c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它很小，只有11 x16(<code class="du jo jp jq jr b">next/image</code>组件使其填充原始图像的宽度和高度)并且只有78个字节！</p><h1 id="ee70" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用JPEG而不是WebP</h1><p id="1076" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">如果你想支持所有的浏览器，你可以在制作预览图像的时候添加<code class="du jo jp jq jr b">outputFormat</code>选项来得到一个JPEG的预览图像，就像这样-</p><figure class="kw kx ky kz fd hk"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="2c1a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">JPEG图像与我们的WebP图像尺寸相同，但大小明显更大，为303字节</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div class="er es lo"><img src="../Images/a08e9e749e3a38b2bd3e057ba9fa6ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/0*5kPczexblZh2TIXK"/></div></figure><p id="fd70" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，这些文件大小会因您使用的图像而异。在某些情况下，JPEG和WebP之间的文件大小差异可以达到两倍。</p><h1 id="8de5" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="38da" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">好吧，就这样！让我们回顾一下我们在本教程中所做的-</p><ul class=""><li id="68c3" class="lp lq ht is b it iu ix iy jb lr jf ls jj lt jn lu lv lw lx bi translated">了解LQIP图像</li><li id="fa12" class="lp lq ht is b it ly ix lz jb ma jf mb jj mc jn lu lv lw lx bi translated">创建了一个Next.js应用程序并添加了一个来自Unsplash的图像</li><li id="9b81" class="lp lq ht is b it ly ix lz jb ma jf mb jj mc jn lu lv lw lx bi translated">使用<code class="du jo jp jq jr b">lqip-modern</code>创建预览图像</li><li id="5460" class="lp lq ht is b it ly ix lz jb ma jf mb jj mc jn lu lv lw lx bi translated">查看了我们如何获得JPEG预览图像</li></ul><p id="1175" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">希望你喜欢这个教程！如果你觉得有用，请分享:)</p><h1 id="8ce2" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">重要链接</h1><ul class=""><li id="7c68" class="lp lq ht is b it kr ix ks jb md jf me jj mf jn lu lv lw lx bi translated"><a class="ae js" href="https://www.npmjs.com/package/lqip-modern" rel="noopener ugc nofollow" target="_blank"> LQIP Modern </a></li><li id="d8ae" class="lp lq ht is b it ly ix lz jb ma jf mb jj mc jn lu lv lw lx bi translated"><a class="ae js" href="https://github.com/AnishDe12020/next-lqip-demo" rel="noopener ugc nofollow" target="_blank">代码为</a>的GitHub库</li><li id="b8ed" class="lp lq ht is b it ly ix lz jb ma jf mb jj mc jn lu lv lw lx bi translated"><a class="ae js" href="https://next-lqip-demo.vercel.app/" rel="noopener ugc nofollow" target="_blank">部署示例</a></li></ul></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><p id="e80c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mn">原发布于</em><a class="ae js" href="https://blog.anishde.dev/amazing-preview-images-with-nextjs-and-lqip-modern" rel="noopener ugc nofollow" target="_blank"><em class="mn">https://blog . anishde . dev</em></a><em class="mn">。</em></p></div></div>    
</body>
</html>