<html>
<head>
<title>Subscription Payment Using Stripe iOS(SwiftUI) SDK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Stripe iOS(SwiftUI) SDK进行订购支付</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/subscription-payment-using-stripe-ios-swiftui-sdk-409a9fdc1a0?source=collection_archive---------2-----------------------#2021-10-26">https://medium.com/geekculture/subscription-payment-using-stripe-ios-swiftui-sdk-409a9fdc1a0?source=collection_archive---------2-----------------------#2021-10-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/53df220d3f2ff62ee3779f1bc406eb89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BP1KpIe-PX3bKvKeRTdsVA.jpeg"/></div></div></figure><div class=""/><p id="6712" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Stripe拥有令人惊叹的文档，涵盖了他们产品的所有用例，包括示例代码和逐步指南。但我有一个用例，我需要使用新的Stripe SwiftUI SDK进行订阅支付，我很难找到一些文档或样本来实现这一点。最后，我们有一个解决方案，这个博客致力于该解决方案的实施。</p><p id="ad67" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Stripe支付集成需要一些后端和前端移动工作，所以让我们先从第一件事开始，项目设置和pod安装。</p><h2 id="48b8" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">1.1 Podfile(添加依赖项)</h2><pre class="kj kk kl km fd kn ko kp kq aw kr bi"><span id="eb2d" class="jo jp ht ko b fi ks kt l ku kv">pod 'Stripe'<br/>pod 'Alamofire', '~&gt; 5.4'</span></pre><p id="1141" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将这些添加到您的Podfile、Stripe SDK和Alamofire中。对于API调用，下一步是在AppDelegate文件中添加发布密钥。</p><h2 id="84ac" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">1.2 AppDelegate(为SDK提供发布密钥)</h2><figure class="kj kk kl km fd hk"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="0347" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以从Stripe开发人员控制台获得您的测试发布密钥。</p><h2 id="b435" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">1.3内容视图(让我们做一些快速的UI工作)</h2><figure class="kj kk kl km fd hk"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="bb1a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，我们创建了一个示例UI，只是为了演示，但你们可以将其集成到现有的SwiftUI视图中。</p><h2 id="ba26" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">1.4订阅视图模型(条带配置的视图模型)</h2><figure class="kj kk kl km fd hk"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="7b6b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，我们在应用程序开始时调用托管在<a class="ae ky" href="https://glitch.com/" rel="noopener ugc nofollow" target="_blank"> Glitch </a>上的测试后端API，以获取启动stripe预构建UI所需的密钥和支付意图。这就是我们配置SDK并启动它所需要的全部内容。现在按照下面的后端部分，这是关键的一步，以使订阅付款在原生用户界面。</p><h2 id="5fde" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">1.5后端代码(创建订阅支付意向的重要部分)</h2><figure class="kj kk kl km fd hk"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="da80" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，我们创建一个支付行为为<code class="du kz la lb ko b">default_incomplete</code>的订阅支付意图。另外，请记住添加一个有效的价格id，您可以从开发人员控制台的products选项卡中获取该id进行测试，但是在实际的用例中，您将调用stripe API来动态获取价格id。</p><p id="c115" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，问题是我们在服务器端代码中为普通的一次性付款而不是订阅付款创建付款意向，如下所示。因此，请注意，如果您想进行基于订阅的支付，则需要创建一个订阅支付意向，而不是常规的意向。</p><p id="f41a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">一次性付款</strong></p><pre class="kj kk kl km fd kn ko kp kq aw kr bi"><span id="7029" class="jo jp ht ko b fi ks kt l ku kv">//use this code for one time payment<br/>const paymentIntent = await stripe.paymentIntents.create({<br/>    amount: 1099,<br/>    currency: 'eur',<br/>    customer: customer.id,<br/>    payment_method_types: ['bancontact', 'card', 'ideal', 'sepa_debit', 'sofort'],<br/>  });</span></pre><p id="e1ee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">认购付款</strong></p><pre class="kj kk kl km fd kn ko kp kq aw kr bi"><span id="47cb" class="jo jp ht ko b fi ks kt l ku kv">//use this code for subscription payment<br/>const subscription = await stripe.subscriptions.create({<br/>  customer: customer.id,<br/>  items: [{ price: "price_2JfB2RKdI6ztUgqfnckNNSg3" }],<br/>  payment_behavior: "default_incomplete",<br/>  expand: ["latest_invoice.payment_intent"],<br/>});</span></pre><p id="3721" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们终于有了一个在SwiftUI原生SDK中接受订阅付款的运行应用程序。我希望这对那些寻找这个用例样本的人有所帮助。如果需要运行代码，请找到所附的示例项目。</p><figure class="kj kk kl km fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lc"><img src="../Images/5cc9e45313719ee8ad9623ead65cb1fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-EJZoTrifg-qgF_ne8__pQ.png"/></div></div></figure><h2 id="f148" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">Github项目iOS示例</h2><div class="hh hi ez fb hj ld"><a href="https://github.com/worstkiller/ios_stripe_subscription_swiftui" rel="noopener  ugc nofollow" target="_blank"><div class="le ab dw"><div class="lf ab lg cl cj lh"><h2 class="bd hu fi z dy li ea eb lj ed ef hs bi translated">GitHub-worst killer/ios _ stripe _ subscription _ swift ui:这个iOS示例是针对…</h2><div class="lk l"><h3 class="bd b fi z dy li ea eb lj ed ef dx translated">此iOS示例用于基于订阅的支付的条带集成- GitHub …</h3></div><div class="ll l"><p class="bd b fp z dy li ea eb lj ed ef dx translated">github.com</p></div></div><div class="lm l"><div class="ln l lo lp lq lm lr hp ld"/></div></div></a></div><h2 id="d044" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">Glitch服务器端项目示例</h2><p id="89d0" class="pw-post-body-paragraph iq ir ht is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated"><a class="ae ky" href="https://glitch.com/edit/#!/lowly-evening-plant" rel="noopener ugc nofollow" target="_blank">https://glitch.com/edit/#!/lowly-evening-plant</a></p><p id="9dbe" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于新的Glitch项目，点击<a class="ae ky" href="https://glitch.com/edit/#!/remix/stripe-mobile-payment-sheet" rel="noopener ugc nofollow" target="_blank">此处</a>，</p><blockquote class="lx ly lz"><p id="a101" class="iq ir ma is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated">注意:为了正常工作，请替换与您的条带帐户相关联的发布密钥和秘密密钥。</p></blockquote><h2 id="734d" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">参考资料:</h2><ul class=""><li id="9e33" class="me mf ht is b it ls ix lt jb mg jf mh jj mi jn mj mk ml mm bi translated">【https://stripe.com/docs/payments/accept-a-payment? T2】平台=ios </li><li id="f827" class="me mf ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm bi translated">【https://github.com/stripe/stripe-ios/issues/1868 T4】</li></ul><p id="03d1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">特别感谢<a class="ae ky" href="https://github.com/summer-mute" rel="noopener ugc nofollow" target="_blank"> @Jack murphy </a>在这个问题上的帮助。</p></div></div>    
</body>
</html>