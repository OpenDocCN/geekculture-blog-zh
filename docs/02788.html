<html>
<head>
<title>Simple Modular Classes for some common AudioKit v5 Controls</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一些常见AudioKit v5控件的简单模块化类</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/simple-modular-classes-for-some-common-audiokit-v5-controls-fa5f264d376f?source=collection_archive---------47-----------------------#2021-05-25">https://medium.com/geekculture/simple-modular-classes-for-some-common-audiokit-v5-controls-fa5f264d376f?source=collection_archive---------47-----------------------#2021-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/aa5e950c49c8b45a7e26cbbc7b8e6787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4EEACsxJRAZ1z0Yj6fjqng.jpeg"/></div></div></figure><p id="9932" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">AudioKit是为iOS和一些相关环境开发音频应用程序的一个非常优秀的包。它足够全面，有时令人不知所措。有时将它分解成模块化的类会有所帮助，然后您可以在您的视图模型或任何您可能用于Swift或SwiftUI的架构中使用这些类。我不会在这里描述安装AudioKit，因为在其他地方已经讨论过了。</p><p id="79ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里有一些我制作的简单的类，用于使用振荡器，回放样本和识别音高。出于您自己的目的，您可能希望进一步参数化它们。</p><p id="38b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我还使用以#@nnn开头的字符串进行诊断，并使用#！错误消息的nnn。您可以使用其他一些约定。</p><p id="4e9d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是一个振荡器类:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="63c2" class="jx jy hi jt b fi jz ka l kb kc">import UIKit<br/>import AudioKit</span><span id="2524" class="jx jy hi jt b fi kd ka l kb kc">class Osc: NSObject {<br/>    let engine = AudioKit.AudioEngine()<br/>    let osc = AudioKit.PWMOscillator()<br/>    <br/>    <br/>    override init() {<br/>        super.init()<br/>        engine.output = osc<br/>    }<br/>    <br/>    func tune(_ freq: Float){<br/>        osc.frequency = freq<br/>        start() // adding this was necessary when using PWMOscillator but not with Oscillator<br/>    }<br/>    <br/>    func start(){<br/>        osc.start()<br/>        <br/>        do{<br/>        try engine.start()<br/>        } catch let err {<br/>            print("#@25 engine did not start \(err.localizedDescription)")<br/>        }<br/>    }<br/>     <br/>    func stop(){<br/>        osc.stop()<br/>        engine.stop()<br/>    }<br/>}</span></pre><p id="b12d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">示例播放器类别:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="e316" class="jx jy hi jt b fi jz ka l kb kc">import AudioKit</span><span id="c528" class="jx jy hi jt b fi kd ka l kb kc">class SamplePlayer: NSObject {<br/>    let engine = AudioEngine()<br/>    let player = AudioPlayer()<br/>    <br/>    var soundName = "Synth"<br/>    var isPlaying = false<br/>    var isRunning = false<br/>    <br/>    func setSoundName(_ s: String){<br/>        soundName = s<br/>    }<br/>    <br/>    func start(){<br/>        if !isPlaying{<br/>            let reverb = Reverb(player)<br/>            reverb.dryWetMix = 0.25<br/>            engine.output = reverb<br/>            do {<br/>                if (!isRunning)<br/>                {<br/>                    try engine.start()<br/>                }<br/>                isRunning = true<br/>                player.start()<br/>                let audioFile = Bundle.main.url(forResource: soundName, withExtension: "mp3")<br/>                if let file = audioFile {<br/>                    do {<br/>                        try player.load(url: file)<br/>                    } catch let err {<br/>                        print("#!23 player problem err: \(err.localizedDescription)")<br/>                    }<br/>                    player.volume = 10.0<br/>                    // add some reverb here and balance the volume vs. other apps without clipping noticeably<br/>                    player.play()//not sure if it will loop<br/>                    isPlaying = true<br/>                } else {<br/>                    print("#!18 problem with audioFile")<br/>                }<br/>                <br/>            } catch let err {<br/>                print("#!35 problem with engine err:\(err.localizedDescription)")<br/>            }<br/>        } else {<br/>            print("#41 was already playing")<br/>        }<br/>        <br/>    }<br/>    <br/>    func stop(){<br/>        player.stop()<br/>        isPlaying = false<br/>        //engine.stop()<br/>    }<br/>    <br/>}</span></pre><p id="8dcd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">音高检测类别:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="b014" class="jx jy hi jt b fi jz ka l kb kc">import UIKit<br/>import AudioKit</span><span id="5581" class="jx jy hi jt b fi kd ka l kb kc">struct PitcherData {<br/>    var pitch: Float = 0.0<br/>    var amplitude: Float = 0.0<br/>    var serial: Int = 0<br/>    <br/>}</span><span id="4246" class="jx jy hi jt b fi kd ka l kb kc">protocol PitcherProtocol {<br/>    var pitcherData: PitcherData { get }<br/>    <br/>}</span><span id="6922" class="jx jy hi jt b fi kd ka l kb kc">class Pitcher: NSObject, ObservableObject {<br/>    <a class="ae ke" href="http://twitter.com/Published" rel="noopener ugc nofollow" target="_blank">@Published</a> var pitcherData: PitcherData = PitcherData() // initialize<br/>    var engine = AudioEngine()<br/>    var silence: Fader // see below<br/>    var mic: AudioEngine.InputNode<br/>    <br/>    var engineRunning = false<br/>    var trackerRunning = false<br/>    <br/>    var tracker: PitchTap!<br/>    var serial = 0<br/>    <br/>    func update(_ pitch: AUValue, _ amp: AUValue) {<br/>        serial += 1<br/>        pitcherData = PitcherData(pitch: pitch, amplitude: amp, serial: serial)<br/>        <br/>    }</span><span id="8899" class="jx jy hi jt b fi kd ka l kb kc">override init(){<br/>        guard let input = engine.input else {<br/>            fatalError()<br/>        }<br/>        mic = input<br/>        silence = Fader(mic, gain: 0)<br/>        <br/>        super.init()<br/>        tracker = PitchTap(mic) { [weak self] pitch, amp in<br/>            if let self = self{<br/>                if self.trackerRunning {<br/>                    DispatchQueue.main.async {<br/>                       self.update(pitch[0], amp[0])<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }</span><span id="b36c" class="jx jy hi jt b fi kd ka l kb kc">func start(){<br/>        do {<br/>            if !engineRunning {<br/>                engine.output = silence<br/>                try engine.start()<br/>            }<br/>            engineRunning = true<br/>            if !trackerRunning {<br/>                tracker.start()<br/>                trackerRunning = true<br/>            }<br/>        } catch let ex {<br/>            print("#@83 \(Date().toDateAndTimeStringWithMilliSeconds()) ex: \(ex.localizedDescription)")<br/>        }<br/>    }<br/>    <br/>    func stop(){<br/>        trackerRunning = false<br/>    }<br/>}</span></pre><p id="9e71" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后在主代码中实例化它们来使用它们。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="7090" class="jx jy hi jt b fi jz ka l kb kc"><strong class="jt hj">let</strong> osc = Osc()</span></pre><p id="f075" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我在这里使用Combine with SwiftUI，特别是与音高检测器“Pitcher”一起使用。当我不使用Combine时，我也使用delegate。</p></div></div>    
</body>
</html>