<html>
<head>
<title>Bypass &amp; Scraping Websites That Has CSS Class Names Change Frequently</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">绕过和抓取CSS类名经常改变的网站</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/bypass-scraping-websites-that-has-css-class-names-change-frequently-d4877ecd6d8f?source=collection_archive---------1-----------------------#2021-02-22">https://medium.com/geekculture/bypass-scraping-websites-that-has-css-class-names-change-frequently-d4877ecd6d8f?source=collection_archive---------1-----------------------#2021-02-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b41d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在现代，很多网站都是用ReactJS，Vuejs，Angular等等语言写的。这使得在HTML标记中拥有随机的类名和id成为可能。</p><p id="35c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是防止网站被刮的策略之一。所以如果你在你的scrapper上静态地定义CSS类名，它们只会在短时间内起作用，因为这种网站经常改变它的CSS类名。</p><p id="d433" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看看<a class="ae jd" href="https://id.carousell.com/categories/photography-6" rel="noopener ugc nofollow" target="_blank">https://id.carousell.com/categories/photography-6</a><br/>这是实施这种预防策略的网站之一。c<a class="ae jd" href="https://id.carousell.com/categories/photography-6" rel="noopener ugc nofollow" target="_blank">arousell.com</a>将它们的类名随机化，使得很难找出语义丰富的CSS选择器。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/96b121b5998d1cef96d0d7563d844a62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BqqiP6Rw69wUtHpccomlQw.png"/></div></div></figure><p id="ab7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只需获取CSS类名<strong class="ih hj"> D_aM </strong>和<strong class="ih hj"> M_gA </strong>就可以轻松获得详细帖子的链接。但是，如果网站页面的动态CSS类名每天或每小时都在变化，该怎么办呢？我们不会浪费时间频繁地维护我们的scraper代码吗？</p><p id="4e78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看<a class="ae jd" href="https://id.carousell.com/categories/photography-6" rel="noopener ugc nofollow" target="_blank">carousell.com</a>是否经常改变它的CSS类名。这张截图是在第一张截图的第二天拍的。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jq"><img src="../Images/8c6050ba4c01358efae84f6b640c2b0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ilClOkoVTFj5PaG9lRA26A.png"/></div></div></figure><p id="e17f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您所看到的，它们将主类名从<strong class="ih hj"> D_I </strong>更改为<strong class="ih hj"> D_C </strong>。详细帖子的URL的CSS类名已从<strong class="ih hj"> D_aM </strong>和<strong class="ih hj"> M_gA </strong>更改为<strong class="ih hj"> D_be </strong> <strong class="ih hj"> M_eu </strong></p><p id="9a68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们试着打破这个挑战！</p><h1 id="1f95" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">1.识别具有唯一值的标签</h1><p id="e87f" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">如果我们仔细观察，我们会发现有一个“<strong class="ih hj"> &lt;”主标记“</strong>，我们可以用它作为我们的键来获取其中的所有数据。如果他们用div代替main，我们的工作可能会更有挑战性。</p><h1 id="f21d" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">2.使用Scrapy shell测试和探索各种可能性</h1><p id="15d8" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">在制作script.py之前，我们需要测试我们的假设是否正确。为了快速工作，我们不在文件中写代码，而是使用Scrapy解释器/shell，所以我们可以很容易地调试代码。</p><p id="3807" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在你的终端上按照这个命令打开Scrapy shell。</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="4f88" class="kz js hi kv b fi la lb l lc ld">scrapy shell "<a class="ae jd" href="https://id.carousell.com/categories/photography-6" rel="noopener ugc nofollow" target="_blank">https://id.carousell.com/categories/photography-6</a>"</span></pre><p id="6ea8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并添加以下代码</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="630e" class="kz js hi kv b fi la lb l lc ld">response.css('main[class^="D_"] ::attr(class)').getall()</span></pre><p id="0044" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将看到如下输出:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es le"><img src="../Images/4f4de34c93aa69eb1b4a9240837b3772.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sw3ixGK6yYnCsFwhoSpF4g.png"/></div></div></figure><p id="e6f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码将开始获取<main tag="" html="" that="" has="" a="" class="" name="" begins="" with=""> D_ 中的所有类名</main></p><p id="49dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，从那里，我们可以检查哪个列表类索引有我们正在寻找的信息。可以用index [number]一个一个查，也可以用inspect elements看网站。</p><p id="88d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们知道我们想要获得这篇文章的详细URL，当时它位于类名<strong class="ih hj"> D_aM </strong>和<strong class="ih hj"> M_gA </strong>处。<strong class="ih hj"> </strong>和<strong class="ih hj"> D_aM </strong>和<strong class="ih hj"> M_gA </strong>都在索引[12]上</p><p id="4c8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以我们可以这样做。</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="329f" class="kz js hi kv b fi la lb l lc ld">class_css = response.css('main[class^="D_"] ::attr(class)').getall()[12]<br/>response.css('a[class^="%s"] ::attr(href)'% class_css).get()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lf"><img src="../Images/c60a8264aa036f4db861eb8c7b9d2086.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gXRzzLAiAcFXVT19q-J9Vg.png"/></div></div></figure><p id="c320" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你好。我们可以得到详细的网址！</p><p id="66c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们用已经更改的CSS类名再测试一次。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lg"><img src="../Images/0496a331415203ef3564dc65f57a88b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uGxWcNO8xSuBc68MHmBbuA.png"/></div></div></figure><p id="78ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">成功了！这是完整的代码</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="4e6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我们所知，从一个拥有CSS类和属性的网站获取我们需要的信息是很简单的，这些CSS类和属性是在服务器端动态生成的，并且每次都是唯一的。</p><p id="9462" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然我知道这在其他案子上并不总是有效。但你可能想考虑阅读这些伟大的文章<a class="ae jd" href="https://dev.to/scrapehunt/two-quick-hacks-for-web-scraping-pages-with-dynamic-css-class-names-j0b" rel="noopener ugc nofollow" target="_blank">https://dev . to/scrape hunt/two-quick-hacks-for-web-scraping-pages-with-dynamic-CSS-class-names-j0b</a><a class="ae jd" href="https://www.pluralsight.com/guides/advanced-web-scraping-tactics-python-playbook" rel="noopener ugc nofollow" target="_blank">https://www . plural sight . com/guides/advanced-web-scraping-tactics-python-playbook</a>。</p><p id="ba8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这有所帮助！</p></div></div>    
</body>
</html>