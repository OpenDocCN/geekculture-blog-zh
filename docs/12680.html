<html>
<head>
<title>Using the Agora Web UIKit with Next.js — Build a Video Chat App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用带有Next.js的Agora Web UIKit构建一个视频聊天应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/using-the-agora-web-uikit-with-next-js-build-a-video-chat-app-97a3bfc1d125?source=collection_archive---------9-----------------------#2022-05-26">https://medium.com/geekculture/using-the-agora-web-uikit-with-next-js-build-a-video-chat-app-97a3bfc1d125?source=collection_archive---------9-----------------------#2022-05-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/818d779bc7bbc20a60caef82759b8214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gZrOFlhVisr205CEHJR55w.png"/></div></div></figure><p id="b18a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我在之前的博客<a class="ae jo" href="https://www.agora.io/en/blog/agora-web-uikit-add-video-calling-or-live-streaming-to-your-website-in-minutes/" rel="noopener ugc nofollow" target="_blank">中写过关于使用</a><a class="ae jo" href="https://github.com/AgoraIO-Community/Web-React-UIKit/" rel="noopener ugc nofollow" target="_blank"> Agora Web UIKit </a>为你的网站添加直播或视频通话功能。在这篇博文中，我将描述如何在你的<a class="ae jo" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a> web应用中使用Agora Web UIKit。</p><p id="e6fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当使用服务器端渲染(SSR)或静态站点生成(SSG)时，我们将使用<a class="ae jo" href="https://nextjs.org/docs/advanced-features/dynamic-import" rel="noopener ugc nofollow" target="_blank">动态导入</a>来导入带有Next.js的Agora SDK(不会遇到<code class="du jp jq jr js b">“window is not defined”</code>错误)。</p><h1 id="bb19" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">让我们以React为例</h1><p id="be8e" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">当我尝试从我的Next.js应用程序中的<a class="ae jo" href="https://github.com/AgoraIO-Community/Web-React-UIKit/" rel="noopener ugc nofollow" target="_blank"> Agora Web UIKit repo </a>导入使用<code class="du jp jq jr js b">create-next-app</code>创建的<a class="ae jo" href="https://github.com/AgoraIO-Community/Web-React-UIKit/blob/main/example/src/App.tsx" rel="noopener ugc nofollow" target="_blank"> React示例组件</a>时，如下所示:</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="7f31" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我得到了<code class="du jp jq jr js b">“window is not defined”</code>错误:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/164a4abf358c46413e26e808398aef6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iat5U_c_aZeAfOFsBcZvlQ.png"/></div></div></figure><p id="bd95" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们查看调用堆栈，我们可以看到错误是由Agora SDK抛出的。</p><h1 id="9b35" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">为什么我会看到这个错误？</h1><p id="2c89" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">Next.js使用SSR和SSG——当Agora库被导入时(直接或通过Agora Web UIKit ),它访问浏览器上可用的<a class="ae jo" href="https://developer.mozilla.org/en-US/docs/Web/API/Window" rel="noopener ugc nofollow" target="_blank">窗口</a>对象。Next.js要么在服务器上预先呈现web页面(SSG)，要么为每个请求呈现web页面(SSR)。这将导致一个错误，因为在服务器上无法访问窗口对象。因此出现了<code class="du jp jq jr js b">“window is not defined”</code>错误。</p><h1 id="08ef" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">解决方法是什么？</h1><p id="df6e" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">修复非常简单:我们希望只有当页面在浏览器中呈现时才导入Agora Web UIKit。您可以使用对窗口对象的条件检查来破解解决方案，但是Next.js提供了一个更干净的解决方案— <a class="ae jo" href="https://nextjs.org/docs/advanced-features/dynamic-import#with-no-ssr" rel="noopener ugc nofollow" target="_blank">没有SSR的动态导入</a>。</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="897b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我现在可以通过使用<code class="du jp jq jr js b">dynamic()</code>函数调用来替换我的视频通话导入。第一个参数接受一个函数，该函数只从我们的文件中导入组件。第二个参数接受一个对象，其中我们将<code class="du jp jq jr js b">ssr</code>标记为false，因为我们不想在服务器端包含这个模块。</p><p id="5bb6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦我们在<code class="du jp jq jr js b">Videocall</code>组件中更新了Agora应用ID，我们就可以让这个例子工作了。而现在我们的Next.js web app有视频通话了！</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ld"><img src="../Images/cd2790484ddc892560745baeed48b553.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lNt9mwhH62y5fK_2TIveDQ.jpeg"/></div></div></figure><h1 id="c0ce" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="c8f7" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">你可以在这里查看例子Next.js Web UIKit项目<a class="ae jo" href="https://github.com/AgoraIO-Community/Web-React-UIKit/tree/nextjs/example-nextjs" rel="noopener ugc nofollow" target="_blank"/>。如果你想更深入地了解，你可以阅读这篇博文来深入了解这个例子。您还可以查看Web UIKit <a class="ae jo" href="https://github.com/AgoraIO-Community/Web-React-UIKit" rel="noopener ugc nofollow" target="_blank"> GitHub Repo </a>以及<a class="ae jo" href="https://agoraio-community.github.io/Web-React-UIKit/" rel="noopener ugc nofollow" target="_blank"> API参考</a>。</p><p id="0bb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们有适用于<a class="ae jo" href="https://github.com/AgoraIO-Community/Android-UIKit" rel="noopener ugc nofollow" target="_blank"> Android </a>、<a class="ae jo" href="https://github.com/AgoraIO-Community/iOS-UIKit" rel="noopener ugc nofollow" target="_blank"> iOS </a>、<a class="ae jo" href="https://github.com/AgoraIO-Community/ReactNative-UIKit" rel="noopener ugc nofollow" target="_blank"> React Native </a>和<a class="ae jo" href="https://github.com/AgoraIO-Community/Flutter-UIKit" rel="noopener ugc nofollow" target="_blank"> Flutter </a>的UIKits。你也可以去看看。如果您在使用Agora Web UIKit时有任何问题，我邀请您加入<a class="ae jo" href="https://agora.io/en/join-slack" rel="noopener ugc nofollow" target="_blank"> Agora开发者Slack社区</a>。你可以在<code class="du jp jq jr js b">#web-help-me channel</code>里提出你的问题。</p></div></div>    
</body>
</html>