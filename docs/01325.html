<html>
<head>
<title>Logout With NodeJs, Express, and MongoDB (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用NodeJs、Express和MongoDB注销(第2部分)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/logout-with-nodejs-express-and-mongodb-9b73e8b01137?source=collection_archive---------8-----------------------#2021-04-06">https://medium.com/geekculture/logout-with-nodejs-express-and-mongodb-9b73e8b01137?source=collection_archive---------8-----------------------#2021-04-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/b75f643ca12b0fb94d4dbf26457ab104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*-WxxENsJQCBvbjhq7lUdmA.png"/></div></figure><p id="27a8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在以前的文章中，我写了如何用NodeJs、Express和MongoDB创建注册和登录应用程序。链接在这里，如果你想要文章，可以在这里阅读<a class="ae jk" href="https://serapbaysal.medium.com/signup-login-application-with-nodejs-express-and-mongodb-658498e580cf" rel="noopener">。</a></p><p id="9b20" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在本文中，我将用我的旧代码创建一个注销应用程序。开始吧！</p><p id="4998" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，我们希望保护应用程序中的一些操作，如到达配置文件。为此，我们将创建一个名为auth.js的中间件并编写一个名为protect的函数。</p><p id="0e98" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这个文件中，首先我们需要jsonwebtoken、ErrorResponse和用户模型。随着<em class="jl"> exports.protect = async (req，res，next) = &gt; {} </em>，我们将开始。</p><p id="6da6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们转到Postman，创建一个GET请求并添加一个参数。对于这个，在关键部分，我们将写授权，在价值部分，我们将写Baerer和空格符。这个令牌是我们登录用户的令牌，如果你看过我的其他文章，你就知道了。</p><p id="81b0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在VSCode中，我们将转到protect函数并创建一个名为token的变量。在if语句控件中，我们的头和头以' Bearer '开头。如果这两个是真的，我们将在头中用</p><p id="656c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jl">token = req . headers . authorization . split(')[1]；</em></p><p id="f40f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">。拜尔字后的这个控制空格。如果语句不为真，我们将执行else if并从cookie中设置令牌。</p><p id="a8e7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jl"> token = req.cookies.token </em></p><p id="6d6c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jl">我们将使用</em>确保令牌存在</p><p id="4ac5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jl">如果(！令牌){ </em></p><p id="2efa" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jl">返回next(new ErrorResponse('未授权访问此路由'，401)；</em></p><p id="75da" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jl"> } </em></p><p id="c3d3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">之后，我们将验证令牌</p><p id="614b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jl">const decoded = jwt . verify((token，process . env . jwt _ SECRET)；</em></p><p id="ffeb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">和</p><p id="7f76" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jl">req . user = await user . find byid(decoded . id)；</em></p><p id="7269" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">。然后捕捉错误。所有保护功能看起来都是这样的:</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es jm"><img src="../Images/b6db1b6cb9f83d96ca69f635c2eb1d5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*IYKYjbiKlqmU26bw3Oml4Q.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx">middleware/auth.js</figcaption></figure><p id="f202" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我们可以回到controllers/auth.js文件，为注销和配置文件添加这些代码:</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es jm"><img src="../Images/ef997fa29f24e3e9f29a275c34f2ba47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*_s9xAFdcuKZ4PSewQ4Az9A.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx">controllers/auth.js</figcaption></figure><p id="be4d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果我们转到Postman并使用Baerer访问旧请求，我们可以看到最后登录用户的配置文件:</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es jm"><img src="../Images/1c2217522294ac5e23eb2df8f6d47f24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*fuP6_rM9d5VL24jCAwuuEA.png"/></div></figure><p id="0a15" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果我们要创建一个GET请求并编写<a class="ae jk" href="http://localhosy:500/logout" rel="noopener ugc nofollow" target="_blank">http://localhosy:500/logout</a>，用Baerer和token添加授权，请看这个:</p><figure class="jn jo jp jq fd ij er es paragraph-image"><div class="er es jm"><img src="../Images/b5f1a9f3adc24cf56412964586311dbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*564vgBXH0fAdMhwZ4E1hdg.png"/></div></figure><p id="1df8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我试着在这之后得到一个侧写，但是它不工作，所以我们将做它的权利。</p><p id="e16f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这篇文章已经完成，但我会继续更新用户的观点，所以我们会在下一篇文章中看到你！感谢阅读！</p></div></div>    
</body>
</html>