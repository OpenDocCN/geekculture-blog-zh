<html>
<head>
<title>Flutter-Text Recognition with Firebase ML Vision</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Firebase ML视觉的文本识别</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/flutter-text-recognition-with-firebase-ml-vision-80f887a0711a?source=collection_archive---------7-----------------------#2021-05-04">https://medium.com/geekculture/flutter-text-recognition-with-firebase-ml-vision-80f887a0711a?source=collection_archive---------7-----------------------#2021-05-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/178a50d4a25f36758dec912cf5ce38c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bZIENB78A4zio963RaA47Q.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="86f2" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">这个项目是一个演示应用程序，可以从相机拍摄的图片中提取文本。我正在制作一个小的模拟应用程序，以草稿的形式展示给客户，这时我遇到了一些麻烦，主要是文档的一些问题。所以我决定把它写下来，这样我就不会忘记它，并且帮助其他将要使用这个插件的人。</h2></div><p id="9fd5" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">首先要做的事情(除了创建一个新项目)是添加firebase-ml-vision插件，你可以在<a class="ae ke" href="https://pub.dev/packages/firebase_ml_vision" rel="noopener ugc nofollow" target="_blank">这里</a>找到它。在自述文件和安装部分告诉我们:“<strong class="jk hu">您还必须为每个平台项目</strong>配置Firebase”。因此，如果您只将这个插件添加到pubspec.yaml，您将会得到以下错误消息:</p><blockquote class="kf kg kh"><p id="cb62" class="ji jj ki jk b jl jm iu jn jo jp ix jq kj js jt ju kk jw jx jy kl ka kb kc kd hb bi translated">*出错原因:评估项目时出现问题:“firebase_ml_vision”。</p><p id="90a2" class="ji jj ki jk b jl jm iu jn jo jp ix jq kj js jt ju kk jw jx jy kl ka kb kc kd hb bi translated">&gt;找不到firebase_core FlutterFire插件，您是否已将其作为依赖项添加到您的pubspec中？</p><p id="567f" class="ji jj ki jk b jl jm iu jn jo jp ix jq kj js jt ju kk jw jx jy kl ka kb kc kd hb bi translated">哪里出错:配置项目时出现问题:firebase_ml_vision。</p><p id="aa5e" class="ji jj ki jk b jl jm iu jn jo jp ix jq kj js jt ju kk jw jx jy kl ka kb kc kd hb bi translated">&gt;未指定compileSdkVersion。请将其添加到build.gradle</p></blockquote><p id="f8ca" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">所以，当你意识到一些显而易见的事情时，你也需要添加firebase_core插件。一旦你添加了firebase-core插件，第二个错误信息就会消失。所以我们的pubspec.yaml是这样的:(图像拾取器就是用相机拍一张图像):</p><figure class="kn ko kp kq fd hk er es paragraph-image"><div class="er es km"><img src="../Images/33e22c2dd120d8c24471f14ff77f143a.png" data-original-src="https://miro.medium.com/v2/resize:fit:610/format:webp/1*_ak7qmCJs6AracaOys5knQ.png"/></div></figure><p id="15f8" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><strong class="jk hu">为了安装firebase core你需要遵循一些步骤，你可以在其他帖子中找到它们</strong> <a class="ae ke" rel="noopener" href="/swlh/flutter-push-notifications-with-cloud-messaging-2559fbaf06f6#167c"> <strong class="jk hu">这里</strong> </a>。</p><p id="2dac" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">最后，你仍然需要根据<a class="ae ke" href="https://firebase.google.com/docs/ml-kit/android/recognize-text#before-you-begin" rel="noopener ugc nofollow" target="_blank">中的说明在这里</a>进行配置(对于Android)。</p><p id="acaf" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">在app/build.gradle中添加ML Vision依赖项:</p><figure class="kn ko kp kq fd hk er es paragraph-image"><div class="er es kr"><img src="../Images/7acc14a30274c81eeb9d618821fe0e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*QY0bjGNaFQIRoOHHcEDZdA.png"/></div></figure><p id="2424" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">可选但推荐的是，将您的应用配置为在从Play Store安装应用后自动将ML模型下载到设备:</p><figure class="kn ko kp kq fd hk er es paragraph-image"><div class="er es ks"><img src="../Images/7094a38f0552d02d9d98a13b98377203.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*4LXSjR82gmZJSLN8zRRYEg.png"/></div></figure><p id="29d3" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">现在，为了使用文本识别，我们将在“pages”文件夹下的一个新文件中创建一个简单的应用程序，文件名为“pick_page.dart ”,在那里我们将创建一个名为“PickReceipt”的新StatefulWidget。该Widget将有一个图像拾取器，以便进行拾取(AppBar上的相机图标按钮)并获取图片的文本。“PickReceipt”小部件将看起来像这样:</p><figure class="kn ko kp kq fd hk er es paragraph-image"><div class="er es kt"><img src="../Images/1a15ea3250f80deb0d45a32c25001269.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*YE-kqRux27EsPTlqW6lf4w.jpeg"/></div></figure><p id="aac5" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">首先你必须初始化firebase来使用它:</p><figure class="kn ko kp kq fd hk"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="4142" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">对于应用程序，我们将使用一个具有一列的容器，该列包含树小部件、显示相机拍摄的图片的图像小部件和两个按钮，一个用于从图片中获取文本，另一个用于清除图片。</p><p id="8f58" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">“拍照”方法仅使用图像拾取器用相机拍照。“showPic”方法使用Image小部件显示相机拍摄的照片，或者如果没有照片，则显示资产图像。</p><figure class="kn ko kp kq fd hk"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="ede5" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">现在在按钮中，我们得到了“clearImage ”,它的唯一功能是清除相机拍摄的图像，还有“recognizeText”方法，它处理图像文本识别。</p><p id="e89d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">接下来你需要遵循插件文档中的步骤，你可以在<a class="ae ke" href="https://pub.dev/packages/firebase_ml_vision#using-an-ml-vision-detector" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><blockquote class="kf kg kh"><p id="6d0d" class="ji jj ki jk b jl jm iu jn jo jp ix jq kj js jt ju kk jw jx jy kl ka kb kc kd hb bi translated">1.首先要做的是创建检测器的一个实例:</p></blockquote><pre class="kn ko kp kq fd kw kx ky kz aw la bi"><span id="4ae2" class="lb lc ht kx b fi ld le l lf lg">final TextRecognizer _cloudRecognizer = FirebaseVision.instance.cloudTextRecognizer();</span></pre><blockquote class="kf kg kh"><p id="ada2" class="ji jj ki jk b jl jm iu jn jo jp ix jq kj js jt ju kk jw jx jy kl ka kb kc kd hb bi translated">2.然后，我们必须从我们的相机图像创建一个FirebaseVisionImage对象:</p></blockquote><pre class="kn ko kp kq fd kw kx ky kz aw la bi"><span id="6ff8" class="lb lc ht kx b fi ld le l lf lg">final FirebaseVisionImage visionImage =FirebaseVisionImage.fromFile(_image);</span></pre><blockquote class="kf kg kh"><p id="e98c" class="ji jj ki jk b jl jm iu jn jo jp ix jq kj js jt ju kk jw jx jy kl ka kb kc kd hb bi translated">3.我们需要用visionImage调用“processImage()”:</p></blockquote><pre class="kn ko kp kq fd kw kx ky kz aw la bi"><span id="cafc" class="lb lc ht kx b fi ld le l lf lg">results = await _cloudRecognizer.processImage(visionImage);</span></pre><blockquote class="kf kg kh"><p id="0606" class="ji jj ki jk b jl jm iu jn jo jp ix jq kj js jt ju kk jw jx jy kl ka kb kc kd hb bi translated">4.最后一步我们需要提取数据，我们读取每个块，然后在对话框中显示图像中的文本(“showText”方法)。为了提取数据，我们使用“results”对象并获取它的text属性，最终首先读取块中的数据，然后读取行中的数据，最后读取每个行元素中的数据，因此最终的方法如下所示:</p></blockquote><figure class="kn ko kp kq fd hk"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="1048" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">最后，使用close()方法释放资源很重要:</p><pre class="kn ko kp kq fd kw kx ky kz aw la bi"><span id="a272" class="lb lc ht kx b fi ld le l lf lg">@override<br/>void dispose() {</span><span id="81a8" class="lb lc ht kx b fi lh le l lf lg">_cloudRecognizer.close();</span><span id="4601" class="lb lc ht kx b fi lh le l lf lg">super.dispose();</span><span id="6c8f" class="lb lc ht kx b fi lh le l lf lg">}</span></pre><p id="5735" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">你还需要确保在项目中启用云视觉API，为了做到这一点，你需要去谷歌开发者<a class="ae ke" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">控制台</a>并为你正在使用的项目启用API。如果未启用，您将收到如下消息:</p><figure class="kn ko kp kq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es li"><img src="../Images/0bab9fb6ae347561022ed39c5cd9c03a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oi5QHKAStFiKFnX_j3-DKw.jpeg"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx">Error message Cloud Vision API not enabled</figcaption></figure><p id="302d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">还要确保启用计费，否则您会收到以下错误消息:</p><figure class="kn ko kp kq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ln"><img src="../Images/a584ff30d73af1f7d1565aa7aff0fd06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZ4fdLBoR8xck7mLKbH_Qw.jpeg"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx">Error message Billing not enabled</figcaption></figure><p id="c18b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">这是最后的结果:</p><figure class="kn ko kp kq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lo"><img src="../Images/bc8504f0ad2495e6a6e821c71a495b0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TIR88fTnNI-f9bZsIi73Yw.jpeg"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx">Flutter Text Recognition Demo APP</figcaption></figure><div class="hh hi ez fb hj lp"><a href="https://imgur.com/a/6RNEnz9" rel="noopener  ugc nofollow" target="_blank"><div class="lq ab dw"><div class="lr ab ls cl cj lt"><h2 class="bd hu fi z dy lu ea eb lv ed ef hs bi translated">颤振文本识别演示应用程序</h2><div class="lw l"><h3 class="bd b fi z dy lu ea eb lv ed ef dx translated">有1个视图的帖子。颤振文本识别演示应用程序</h3></div><div class="lx l"><p class="bd b fp z dy lu ea eb lv ed ef dx translated">imgur.com</p></div></div><div class="ly l"><div class="lz l ma mb mc ly md hp lp"/></div></div></a></div><p id="7b80" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">这就是我们如何使用firebase_ml_vision插件从图像中提取文本。app用的是flutter 2.0.5。请记住，使用这个插件时，事情可能会发生变化，所以请务必参考官方文档。</p></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><p id="1bc2" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">一如既往的项目代码在这里是可用的:【https://github.com/menagit/textrecognition】<strong class="jk hu"/></p><p id="a62c" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><strong class="jk hu">资源:</strong></p><ul class=""><li id="5a46" class="ml mm ht jk b jl jm jo jp jr mn jv mo jz mp kd mq mr ms mt bi translated">Firebase_ml_vision插件:<a class="ae ke" href="https://pub.dev/packages/firebase_ml_vision#using-an-ml-vision-detector" rel="noopener ugc nofollow" target="_blank">https://pub . dev/packages/firebase _ ml _ vision # using-an-ml-vision-detector</a></li><li id="747a" class="ml mm ht jk b jl mu jo mv jr mw jv mx jz my kd mq mr ms mt bi translated">Firebase核心配置示例:<a class="ae ke" rel="noopener" href="/swlh/flutter-push-notifications-with-cloud-messaging-2559fbaf06f6#167c">https://medium . com/swlh/flutter-push-notifications-with-cloud-messaging-2559 fbaf 06 f 6 # 167 c</a></li><li id="f19f" class="ml mm ht jk b jl mu jo mv jr mw jv mx jz my kd mq mr ms mt bi translated">Firebase核心插件:<a class="ae ke" href="https://pub.dev/packages/firebase_core" rel="noopener ugc nofollow" target="_blank">https://pub.dev/packages/firebase_core</a></li><li id="14b5" class="ml mm ht jk b jl mu jo mv jr mw jv mx jz my kd mq mr ms mt bi translated">谷歌云开发者控制台:<a class="ae ke" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com</a></li></ul></div></div>    
</body>
</html>