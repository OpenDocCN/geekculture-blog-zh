<html>
<head>
<title>Creating Docker image(conda+Jupyter notebook) for Social Scientists</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为社会科学家创建Docker图像(conda+Jupyter笔记本)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/creating-docker-image-conda-jupyter-notebook-for-social-scientists-8c8b8b259a9a?source=collection_archive---------3-----------------------#2022-07-15">https://medium.com/geekculture/creating-docker-image-conda-jupyter-notebook-for-social-scientists-8c8b8b259a9a?source=collection_archive---------3-----------------------#2022-07-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f710" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以在互联网上找到许多代码，可以作为我们研究的很好的参考。然而，代码并不总是在我的电脑上工作。由于环境的变化，例如不同的版本和操作系统，这变得更加复杂。<br/>对于像我这样的社会科学家来说，这是<strong class="ih hj">而不是</strong>一个小问题，因为编码对我们来说已经是一个重大挑战。</p><p id="c56d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd"> Docker </em> </strong>可以协助我们。它使我们能够使用整个参考代码环境，并且我们可以在同一个作者环境中运行代码。</p><h1 id="7921" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">什么是Docker</h1><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es kc"><img src="../Images/b690941aff593d396d8096b4f3dded20.png" data-original-src="https://miro.medium.com/v2/resize:fit:542/format:webp/0*ICaZk3i2zmBVSel7.png"/></div></figure><p id="ce2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Docker的标志提供了Docker是什么的信息。一只鲸鱼正在运输集装箱。<br/>我们可以把代码、库、必要的资源放在一个容器里，鲸鱼会把容器运到我们的计算机环境里，这些环境和编码作者的并不一样。</p><h1 id="b0d4" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">集装箱的三个因素</h1><p id="ddf9" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">我们需要<strong class="ih hj">三个</strong>因素:<strong class="ih hj"> dockerfile </strong>、<strong class="ih hj"> image </strong>和<strong class="ih hj"> container </strong>。</p><ul class=""><li id="17f7" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated"><strong class="ih hj"> dockerfile </strong>:包含图像的设置脚本</li><li id="8dd0" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated"><strong class="ih hj">图片</strong>:包含所有设置+ dockerfile。(此图像不可更改。)</li><li id="6cda" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated"><strong class="ih hj">容器</strong>:允许在容器内使用图像。我们可以改变容器，这使我们能够为我们的目的操纵原始代码。</li></ul><h1 id="43d9" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">创建dockerfile文件</h1><p id="339c" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">创建<code class="du ld le lf lg b">dockerfile</code></p><pre class="kd ke kf kg fd lh lg li lj aw lk bi"><span id="e5e7" class="ll jf hi lg b fi lm ln l lo lp">FROM ubuntu:latest<br/>RUN apt-get update &amp;&amp; \<br/>    apt-get install -y python3.9 \<br/>    python3-pip<br/>            <br/>RUN pip3 install JPype1 jupyter pandas numpy seaborn scipy matplotlib pyNetLogo SALib <br/>    <br/>RUN useradd -ms /bin/bash jupyter<br/>USER jupyter<br/>WORKDIR home/jupyter <br/>EXPOSE 8888                                           <br/>ENTRYPOINT ["jupyter", "notebook","--allow-root","--ip=0.0.0.0","--port=8888","--no-browser"]</span></pre><p id="1888" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个dockerfile文件就是一个例子。<code class="du ld le lf lg b">FROM</code>用于加载基本映像，<code class="du ld le lf lg b">RUN</code>用于安装或运行命令。这个dockerfile的框架创建了一个Docker <strong class="ih hj">映像</strong>。然后，<strong class="ih hj">容器</strong>可以用于我们的目的。</p><p id="ad2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你搜索创建Docker镜像，你会发现还有额外的starnage文件，比如<strong class="ih hj"> requirements.txt </strong>或者<strong class="ih hj"> yml文件</strong>。此外，还提供了复杂的格式和词汇表。即使你能为这些文件收集到好的例子，一个微小的差异或遗漏也会让你陷入无休止的错误信息中。</p><p id="e1db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不会说我喜欢读<strong class="ih hj">计算机参考文献</strong>。在许多情况下，简单地解释参考文献并不足以帮助我。我需要其他参考资料或解释来完全理解这些参考资料。我只想使用对我有用的计算机工具，而不是学习一些新的令人兴奋的方法。</p><p id="07d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我将<strong class="ih hj">不会创建任何不寻常的文件</strong>。相反，我试着为那些想使用计算机工具而不是像我一样研究它们的社会科学家们直接创造<code class="du ld le lf lg b">Image</code>和<code class="du ld le lf lg b">Container</code><strong class="ih hj"/>。</p><h1 id="71e2" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">从Docker hub中拉出<code class="du ld le lf lg b">miniconda Image</code>并创建一个<code class="du ld le lf lg b">Container</code></h1><p id="a340" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated"><strong class="ih hj"> conda </strong>是创建符合我们需求的Python环境的良好起点。</p><pre class="kd ke kf kg fd lh lg li lj aw lk bi"><span id="c27f" class="ll jf hi lg b fi lm ln l lo lp">docker search miniconda3</span></pre><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es lq"><img src="../Images/a4a1c7d0f5fc5237316670b3d3155781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*m5u_X4X6dE7OY0HC.png"/></div></div></figure><p id="e21a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将使用来自<strong class="ih hj"> Docker hub </strong>的第一个miniconda3图像。</p><pre class="kd ke kf kg fd lh lg li lj aw lk bi"><span id="aa37" class="ll jf hi lg b fi lm ln l lo lp">docker run -i -t --rm --name condaenv -p  8888:8888 continuumio/miniconda3 /bin/bash</span></pre><p id="9e78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ld le lf lg b">docker run</code>命令用于运行<strong class="ih hj">图像</strong>。但是，如果我没有我选择的图像，这个命令会提取它并创建一个<strong class="ih hj">容器</strong>。</p><ul class=""><li id="d614" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated"><strong class="ih hj"> -i -t </strong>:允许容器交互</li><li id="1977" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated"><strong class="ih hj"> — rm </strong>:工作完成后移除集装箱。</li><li id="5483" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated"><strong class="ih hj"> —名称condaenv </strong>:创建容器名称，<em class="jd"> condaenv。</em></li><li id="7246" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated"><strong class="ih hj"> -p 8888:8888 </strong>:连接端口8888用于<strong class="ih hj"> Jupyter笔记本</strong></li><li id="ab45" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated"><strong class="ih hj"> /bin/bash </strong>:运行<em class="jd"> bash </em>在<strong class="ih hj">端子</strong>输入更多命令</li></ul><pre class="kd ke kf kg fd lh lg li lj aw lk bi"><span id="6eaa" class="ll jf hi lg b fi lm ln l lo lp">docker images<br/>docker ps -a</span></pre><p id="7cea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> docker images </strong>显示你拥有的图像，而<strong class="ih hj"> docker ps -a </strong>提供关于你的容器的信息。你可以在<strong class="ih hj"> Docker桌面</strong>中查看它们。</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es lv"><img src="../Images/504353a2570d62a8bc46e218c28c961c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VU15Hv_v2Cjmrn3W.png"/></div></div></figure><h1 id="4eab" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用<code class="du ld le lf lg b">conda</code>创建Python环境</h1><pre class="kd ke kf kg fd lh lg li lj aw lk bi"><span id="4786" class="ll jf hi lg b fi lm ln l lo lp">conda update conda<br/>conda install python=3.9.6</span></pre><p id="7cbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先来更新一下康达，<strong class="ih hj">康达更新康达</strong>。如果需要特定版本的Python(比如3.9.6)，安装那个版本，<strong class="ih hj">conda install Python = 3 . 9 . 6</strong>。</p><pre class="kd ke kf kg fd lh lg li lj aw lk bi"><span id="7b48" class="ll jf hi lg b fi lm ln l lo lp">conda install -c conda-forge jpype1<br/>conda install jupyter pandas numpy  <br/>pip install SALib seaborn</span></pre><p id="6380" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用<strong class="ih hj"> conda install </strong>和<strong class="ih hj"> pip install </strong>安装软件包。</p><h1 id="241e" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><code class="du ld le lf lg b">Jupyter notebook</code>在码头集装箱中</h1><p id="5e28" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">这是最具挑战性的部分。在Docker中可以很容易地找到很多关于如何使用Jupyter notebook的帖子。有些很难理解，而有些则不再起作用。</p><p id="8fb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我相信，这种方法对像我这样的社会科学家来说是最直接和最有效的。</p><pre class="kd ke kf kg fd lh lg li lj aw lk bi"><span id="977e" class="ll jf hi lg b fi lm ln l lo lp"># In the Windows PowerShell or VS code<br/>ipconfig</span></pre><p id="3a75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你需要你的电脑的IPV4地址。<br/>ipconfig显示很多地址。您需要连接到互联网的IPV4地址。因为我用的是笔记本电脑，所以需要<em class="jd">无线局域网适配器Wi-Fi </em>地址(比如111.000.1.000)。</p><pre class="kd ke kf kg fd lh lg li lj aw lk bi"><span id="7df1" class="ll jf hi lg b fi lm ln l lo lp">mkdir -p /opt/notebooks <br/>jupyter notebook --notebook-dir=/opt/notebooks --ip='*' --port=8888  --no-browser --allow-root</span></pre><p id="a506" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> mkdir </strong>为Jupyter笔记本<br/>创建目录<strong class="ih hj"> jupyter笔记本</strong>有很多选项。<strong class="ih hj">—notebook-dir =/opt/notebooks</strong>表示Jupyter笔记本将在新目录下运行。其他选项只有一个目的:它们允许Docker的Jupyter notebook连接到网络浏览器并在其中运行。</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es lw"><img src="../Images/cbdab78ae67da57a28e4ffaeb6045dc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jpP7XTZKqaK8C3HI.png"/></div></div></figure><p id="39e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不要使用URL。复制一个<strong class="ih hj">令牌</strong>就可以了。<br/>将<strong class="ih hj"> IPV4地址:8888 </strong>(例如111.000.1.000:8888)输入您的网络浏览器。然后Jupyter请求<strong class="ih hj">令牌</strong>。输入复制的令牌。</p><h1 id="84c4" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">更新Docker映像并创建存储库</h1><p id="1d46" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">首先，在<a class="ae lx" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker hub </a>中创建您的存储库。</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es ly"><img src="../Images/7f75dc35d1229dac929fde325e0f61de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*K_6vcRBWTtypu3Kg.png"/></div></div></figure><p id="1458" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的库名是<strong class="ih hj">young joon 5/condajupyter</strong>。当我把我的新形象推送到Docker hub时，它应该被命名为<strong class="ih hj">young joon 5/condajupyter</strong>。</p><pre class="kd ke kf kg fd lh lg li lj aw lk bi"><span id="f8ab" class="ll jf hi lg b fi lm ln l lo lp"># In the PowerShell or VS code<br/>docker ps -a<br/>docker commit {Container ID} {new Image name(repository name)}<br/>#ex# docker commit 40b8d16b7dba youngjoon5/condajupyter</span></pre><p id="7c24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要<em class="jd">容器ID </em>用容器更新<strong class="ih hj">图像</strong>(使用<strong class="ih hj"> docker ps -a </strong>)。<strong class="ih hj"> docker commit </strong>使用容器和拉出的图像生成一个<em class="jd">新图像</em>。新的映像名称应该是与存储库名称相同的<strong class="ih hj">名称，以便将新的映像推送到Docker hub。</strong></p><pre class="kd ke kf kg fd lh lg li lj aw lk bi"><span id="92ef" class="ll jf hi lg b fi lm ln l lo lp">docker login<br/>docker push youngjoon5/condajupyter</span></pre><p id="a11e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">登录Docker ( <strong class="ih hj"> docker登录</strong>)后，从<strong class="ih hj"> Docker hub </strong>复制推送命令，粘贴到你的终端。</p><h1 id="a1a5" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用新图像</h1><pre class="kd ke kf kg fd lh lg li lj aw lk bi"><span id="3c7d" class="ll jf hi lg b fi lm ln l lo lp"># Pull the new Image and Create a Container<br/>docker run -i -t --rm --name condaenv -p  8888:8888 youngjoon5/condajupyter /bin/bash</span><span id="d88e" class="ll jf hi lg b fi lz ln l lo lp"># Run Jupyter notebook<br/>jupyter notebook --notebook-dir=/opt/notebooks --ip='*' --port=8888  --no-browser --allow-root</span></pre><p id="736d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最初发布在<a class="ae lx" href="https://youngjoon5.github.io/" rel="noopener ugc nofollow" target="_blank">我的网站</a></p></div></div>    
</body>
</html>