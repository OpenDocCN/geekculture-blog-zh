<html>
<head>
<title>La La Land of Building Our Own React Custom Hook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">啦啦土地建设我们自己的反应定制钩</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/la-la-land-of-building-my-own-react-custom-hook-75f0a0fe53f9?source=collection_archive---------29-----------------------#2021-08-30">https://medium.com/geekculture/la-la-land-of-building-my-own-react-custom-hook-75f0a0fe53f9?source=collection_archive---------29-----------------------#2021-08-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ca25b69a0a3266cb9908ab4b13969a18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*33NBIvyqc6wLnGLigaRZ6A.jpeg"/></div></div></figure><h1 id="cad2" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">简介:</h1><p id="4df8" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">自从React 16.8增加了钩子之后，很多开发者爱上了React。他们开始用钩子来制作他们的应用程序，钩子赋予他们超越基于类的组件(如sugar语法)的能力，从包装器地狱中逃脱，没有任何重复地重用有状态逻辑，从难以理解、测试或维护的复杂组件中逃脱。</p><p id="c467" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果你不知道React钩子，你可以看看下面的文章:</p><div class="kr ks ez fb kt ku"><a rel="noopener follow" target="_blank" href="/swlh/react-hooks-from-scratch-a-z-bf8f7b404f7f"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">从头开始反应钩子A-Z</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">挂钩简介:</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">medium.com</p></div></div><div class="ld l"><div class="le l lf lg lh ld li io ku"/></div></div></a></div><div class="kr ks ez fb kt ku"><a rel="noopener follow" target="_blank" href="/swlh/react-redux-hooks-5e5dbb52d057"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">React Redux中钩子API的魔力</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">简介:</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">medium.com</p></div></div><div class="ld l"><div class="lj l lf lg lh ld li io ku"/></div></div></a></div><p id="c7be" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在本文中，我们将讨论三个要点:</p><p id="c273" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">1-什么是自定义挂钩？</p><p id="5537" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">2-如何建立和使用一个定制的钩子？</p><p id="fa24" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">3-自定义挂钩的实际示例。</p><blockquote class="lk ll lm"><p id="fe69" class="jo jp ln jq b jr km jt ju jv kn jx jy lo ko kb kc lp kp kf kg lq kq kj kk kl hb bi translated"><strong class="jq hj"> <em class="hi">请跟随我</em> </strong> <em class="hi">过媒</em> <strong class="jq hj"> <em class="hi">，获取下一篇新文章的通知。</em> </strong> <em class="hi">我也活跃在Twitter上</em><a class="ae lr" href="https://twitter.com/IbraKirill" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj"><em class="hi">@ IbraKirill</em></strong></a><em class="hi">。</em></p></blockquote><h1 id="a7e8" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是自定义挂钩？</h1><p id="2fe6" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">传统上，在React中，我们有两种流行的方式在组件之间共享有状态逻辑:<a class="ae lr" href="https://reactjs.org/docs/render-props.html" rel="noopener ugc nofollow" target="_blank">渲染道具</a>和<a class="ae lr" href="https://reactjs.org/docs/higher-order-components.html" rel="noopener ugc nofollow" target="_blank">更高级的组件</a>。由于React 16.8增加了钩子，我们可以构建自己的钩子，这种方式可以让你将组件逻辑提取到可重用的函数中。</p><p id="95ff" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">让我们假设我们有两个组件，<code class="du ls lt lu lv b">personProfile</code>和<code class="du ls lt lu lv b">FriendListItem, </code>在这两个组件中，我们需要通过id来检查特定人的状态，如果一个人在线或不在线，那么我将在这两个组件中的useEffect中编写的内容与chatAPI通信，使用相同的逻辑，在这种情况下，我们希望在一个地方有重复的逻辑自定义钩子。</p><p id="b3ce" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">作为一名React开发人员，学习创建定制挂钩来解决问题或在自己的React项目中添加缺失特性的过程非常重要。</p><p id="d41d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">自定义钩子是一个JavaScript函数，它的名字以“use”开头，可以调用其他钩子。</p><h1 id="16eb" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">如何构建和使用自定义挂钩:</h1><p id="af9f" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">自定义钩子是一个以单词“use”开头的函数，可能会调用其他钩子。“useWhatever”命名约定主要是为了让linter在使用这些钩子时发现错误。如果没有它，我们就无法判断某个函数内部是否包含对钩子的调用，在这种情况下，函数的使用违背了钩子的规则。</p><p id="f450" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">例如，下面的useFriendStatus是我们的第一个自定义钩子(下面的例子来自官方文档):</p><figure class="lw lx ly lz fd ij"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="fa80" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">记住组件和钩子都是函数，所以我们在这里并没有创造任何新概念。我们只是将代码重构为另一个函数，使其可重用。</p><p id="d8c5" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这里面没有什么新东西——逻辑从两个组件<code class="du ls lt lu lv b">personProfile</code>和<code class="du ls lt lu lv b">FriendListItem </code>转移到一个共享的可重用钩子，确保只在自定义钩子的顶层无条件调用其他钩子，并遵循所有React钩子规则:只在顶层调用钩子，应该遵循顺序，并且只从React函数调用钩子&amp;自定义钩子。</p><p id="b07b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">与React组件不同，自定义挂钩不需要有特定的签名。我们可以决定它接受什么作为参数，以及它应该返回什么(如果有的话)。换句话说，它就像一个普通的函数。它的名字应该总是以<code class="du ls lt lu lv b">use</code>开头，这样你一眼就能看出挂钩  <strong class="jq hj">的<a class="ae lr" href="https://reactjs.org/docs/hooks-rules.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">规则适用于它。</strong></a></strong></p><p id="b8ca" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在我们已经将这个逻辑提取到一个地方一个<code class="du ls lt lu lv b">useFriendStatus</code>钩子，我们可以<em class="ln">在其他两个组件中使用它:</em></p><figure class="lw lx ly lz fd ij"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="78e4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">它以完全相同的方式工作。如果您仔细观察，您会注意到我们没有对行为进行任何更改。我们所做的就是将两个函数之间的一些公共代码提取到一个单独的函数中。</p><p id="0d11" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">定制钩子是钩子设计的自然结果，而不是React特性。</strong></p><blockquote class="lk ll lm"><p id="4893" class="jo jp ln jq b jr km jt ju jv kn jx jy lo ko kb kc lp kp kf kg lq kq kj kk kl hb bi translated"><em class="hi">如果你想一头扎进</em><strong class="jq hj"><em class="hi"/></strong><a class="ae lr" href="https://click.linksynergy.com/link?id=GGg4no0HUcA&amp;offerid=1060092.1411694&amp;type=2&amp;murl=https%3A%2F%2Fwww.udemy.com%2Fcourse%2Fthe-complete-react-fullstack-course%2F" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj"><em class="hi">React 18</em></strong><em class="hi"/></a><em class="hi">用实际例子，我奉劝你用下面的</em> <a class="ae lr" href="https://click.linksynergy.com/link?id=GGg4no0HUcA&amp;offerid=1060092.1411694&amp;type=2&amp;murl=https%3A%2F%2Fwww.udemy.com%2Fcourse%2Fthe-complete-react-fullstack-course%2F" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj"> <em class="hi">课程</em> </strong> </a> <em class="hi">。</em></p></blockquote><h2 id="6844" class="mc ir hi bd is md me mf iw mg mh mi ja jz mj mk je kd ml mm ji kh mn mo jm mp bi translated">两个重要注意事项:</h2><p id="d207" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">使用相同钩子的两个组件共享状态吗？不会，自定义钩子是一种重用<em class="ln">有状态逻辑</em>的机制(比如设置订阅，记住当前值)，但是每次使用自定义钩子，里面的所有状态和效果都是完全隔离的。</p><p id="a9e3" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">自定义钩子如何获得隔离状态？</strong>每一个<em class="ln">调用</em>到一个挂钩就得到一个隔离状态。因为我们直接调用useFriendStatus，所以从React的角度来看，我们的组件只调用useState和useEffect。而且就像我们<a class="ae lr" href="https://reactjs.org/docs/hooks-state.html#tip-using-multiple-state-variables" rel="noopener ugc nofollow" target="_blank">前面学过</a><a class="ae lr" href="https://reactjs.org/docs/hooks-effect.html#tip-use-multiple-effects-to-separate-concerns" rel="noopener ugc nofollow" target="_blank"/>一样，我们可以在一个组件中多次调用useState和useEffect，它们会完全独立。</p><h2 id="65a5" class="mc ir hi bd is md me mf iw mg mh mi ja jz mj mk je kd ml mm ji kh mn mo jm mp bi translated"><strong class="ak">钩子之间传递信息:</strong></h2><p id="dab7" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">钩子是函数，我们可以在它们之间传递信息。为了说明这个概念，我们将从官方文件中举例说明以下例子来解释:</p><p id="c3b4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这是一个聊天消息收件人选择器，显示当前选定的朋友是否在线:</p><figure class="lw lx ly lz fd ij"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="61ae" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们将当前选择的朋友ID保存在recipientID状态变量中，如果用户在<select>选择器中选择了不同的朋友，就更新它。</select></p><p id="4f51" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果您注意到我们在以下钩子之间传递信息:</p><p id="90f0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">useState挂钩调用为我们提供了recipientID状态变量的最新值，我们可以将它作为参数传递给我们的自定义useFriendStatus挂钩:</p><pre class="lw lx ly lz fd mq lv mr ms aw mt bi"><span id="3bff" class="mc ir hi lv b fi mu mv l mw mx">const [recipientID, setRecipientID] = useState(1);</span><span id="f8c3" class="mc ir hi lv b fi my mv l mw mx">const isRecipientOnline = useFriendStatus(recipientID);</span></pre><p id="ec63" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这让我们知道当前选择的<em class="ln">朋友是否在线。如果我们选择一个不同的朋友并更新recipientID状态变量，我们的useFriendStatus钩子将取消订阅之前选择的朋友，并订阅新选择的朋友的状态。</em></p><p id="8b00" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我建议欧洲大学<a class="ae lr" href="https://click.linksynergy.com/fs-bin/click?id=GGg4no0HUcA&amp;offerid=871625.130&amp;subid=0&amp;type=4" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">在线学位</strong> </a>课程的读者，其中许多是免费的<a class="ae lr" href="https://click.linksynergy.com/fs-bin/click?id=GGg4no0HUcA&amp;offerid=871625.130&amp;subid=0&amp;type=4" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">。</strong> </a></p><h1 id="f75f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">构建定制钩子的实际例子:</h1><h2 id="e478" class="mc ir hi bd is md me mf iw mg mh mi ja jz mj mk je kd ml mm ji kh mn mo jm mp bi translated">使用Fetch:</h2><p id="8c1d" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">获取数据是许多前端开发人员在构建任何react应用程序时经常做的事情，我们获取应用程序中许多组件的数据。</p><p id="77d1" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">无论您选择何种方式获取数据，无论是使用<a class="ae lr" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> Axios </a>，还是<a class="ae lr" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" rel="noopener ugc nofollow" target="_blank"> Fetch API </a>，或者其他任何方式，您总是在React组件中一遍又一遍地编写相同的代码。</p><p id="ed5e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们将构建一个包含重复代码的自定义钩子，当我们需要在应用程序中获取数据时，我们可以调用它。</p><p id="6e16" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><code class="du ls lt lu lv b">useFetch</code>钩子将有参数，我们需要查询的URL&amp;获取数据，以及一个表示我们希望应用于请求的选项的对象，这里我们将使用获取API方式来发出请求，因此一旦承诺被解析，我们就通过解析响应体来检索数据。为此，我们使用<code class="du ls lt lu lv b">json()</code>方法，我们还应该捕捉并处理网络错误，以防我们的请求出现问题&amp;还向我们的用户指示异步请求的状态，例如在呈现结果之前显示一个加载指示器(一个加载微调器),同时请求正在运行，以便我们的用户知道我们正在获取数据。</p><p id="b061" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们的<code class="du ls lt lu lv b">useFetch</code>钩子将返回一个对象，该对象包含从URL获取的数据或者错误，如果发生了任何错误的话&amp;异步请求的状态。</p><pre class="lw lx ly lz fd mq lv mr ms aw mt bi"><span id="83c0" class="mc ir hi lv b fi mu mv l mw mx">return { loading error, data };</span></pre><figure class="lw lx ly lz fd ij"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="4afe" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">在我们的组件中使用use fetch:</strong></p><figure class="lw lx ly lz fd ij"><div class="bz dy l di"><div class="ma mb l"/></div></figure><blockquote class="lk ll lm"><p id="78c7" class="jo jp ln jq b jr km jt ju jv kn jx jy lo ko kb kc lp kp kf kg lq kq kj kk kl hb bi translated">如果你喜欢看文章，想支持我当作家，你可以<a class="ae lr" href="http://buymeacoffee.com/kirillibrahim" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">请我喝咖啡！</strong> </a></p><p id="8c13" class="jo jp ln jq b jr km jt ju jv kn jx jy lo ko kb kc lp kp kf kg lq kq kj kk kl hb bi translated">如果你想深入研究<a class="ae lr" href="https://click.linksynergy.com/link?id=GGg4no0HUcA&amp;offerid=507388.2690172&amp;type=2&amp;murl=https%3A%2F%2Fwww.udemy.com%2Fcourse%2Fthe-complete-guide-to-advanced-react-patterns%2F" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">高级React组件模式</strong> </a> &amp;理解为什么设计模式很重要&amp;通过模仿真实世界的例子来学习。我用下面的<a class="ae lr" href="https://click.linksynergy.com/link?id=GGg4no0HUcA&amp;offerid=507388.2690172&amp;type=2&amp;murl=https%3A%2F%2Fwww.udemy.com%2Fcourse%2Fthe-complete-guide-to-advanced-react-patterns%2F" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">课程来劝你。</strong> </a></p><p id="57f7" class="jo jp ln jq b jr km jt ju jv kn jx jy lo ko kb kc lp kp kf kg lq kq kj kk kl hb bi translated">如果你想深入JavaScript中的<a class="ae lr" href="https://click.linksynergy.com/link?id=GGg4no0HUcA&amp;offerid=507388.2251868&amp;type=2&amp;murl=https%3A%2F%2Fwww.udemy.com%2Fcourse%2Fdesign-patterns-javascript%2F" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">设计模式</strong> </a> &amp;探索JavaScript中设计模式的现代实现。我建议你用下面的<a class="ae lr" href="https://click.linksynergy.com/link?id=GGg4no0HUcA&amp;offerid=507388.2251868&amp;type=2&amp;murl=https%3A%2F%2Fwww.udemy.com%2Fcourse%2Fdesign-patterns-javascript%2F" rel="noopener ugc nofollow" target="_blank">T22课程。T24】</a></p></blockquote></div></div>    
</body>
</html>