<html>
<head>
<title>Rails magic: has_secure_password</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Rails魔术:has_secure_password</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/rails-magic-has-secure-password-a9bf0167642d?source=collection_archive---------13-----------------------#2021-11-22">https://medium.com/geekculture/rails-magic-has-secure-password-a9bf0167642d?source=collection_archive---------13-----------------------#2021-11-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/aedeecf38fb62ce232fcb8d1c95c955b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZuW81dUkQNCX-bId"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7c85" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们都知道以纯文本形式存储密码是一种极其危险的做法(如果你敢，只要谷歌一下就能找到数量惊人的例子)。幸运的是，Rails为我们提供了<em class="jt"> has_secure_password </em>方法，这使得在您为项目编写的认证中散列和加盐密码变得非常容易。尽管Rails使这个过程比我们自己编码要容易得多，但我仍然很难理解实现的所有部分和步骤(可能是因为对于像我这样的视觉初学者来说，它可能相当抽象)。以下是我所学内容的简要概述——我希望这对其他学习者有所帮助！如果有任何帮助您理解Rails身份验证的其他学习点，请随意发表评论。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="e96d" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated">gem 'bcrypt '</h2><p id="72f6" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated">首先，为了在您的项目中使用<em class="jt"> has_secure_password </em>宏，您需要将gem<em class="jt">‘bcrypt’</em>添加到您的gem文件中。它不需要在任何特定的部分，所以不需要担心。记住这样做后再次运行<em class="jt">捆绑包安装</em>！</p><p id="022b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我的项目中，看起来是这样的:</p><figure class="lc ld le lf fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/c33a57f7ad6335a16d86899a7ffc5392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*QqAHplsc8PsEF7wSSUCWmQ.png"/></div></figure><h2 id="04b0" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated">散列_安全_密码</h2><p id="44a2" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated">您将把这个方法与您的其他活动记录关联合并到您的模型文件中。既然Rails是为了让我们的生活变得更简单，你只需添加<em class="jt"> has_secure_password </em>，就像这样:</p><figure class="lc ld le lf fd ij er es paragraph-image"><div class="er es lg"><img src="../Images/bf40ef9911d646e9755eb1974e373351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*1OBxfGLFPa8D-4SPtCdsRg.png"/></div></figure><p id="87d0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在包含身份验证和用户注册/登录功能的应用程序中，假设您有一个users表(或一些类似的语言来表示进行注册的组)似乎是安全的。我通常选择一个用户类，就像我上面做的那样。无论您决定在项目中如何描述这个组，您都需要确保将您的<em class="jt"> has_secure_password </em>放在这个模型中，因为他们拥有密码。</p><h2 id="e00a" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated">:密码摘要</h2><p id="5441" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated">为了让这个方便的活动记录方法工作，您还需要在同一个数据库表中有一个<em class="jt"> password_digest </em>列。在我的例子中，这又是users表。下面是它在我的迁移文件中的样子:</p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/a0bd047bec39fc61c5754b877f81aa64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qIfwp1AvBMv-KhqBncFKSA.png"/></div></div></figure><p id="b7bc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">好吧！现在我们可以使用与<em class="jt"> has_secure_password </em>宏相关的Rails魔法了。事实上，我们现在可以访问两个新的实例方法— <em class="jt"> password </em>和<em class="jt"> password_confirmation </em>。要理解这些，只要回想一下任何注册体验，你必须输入两次密码才能注册成为网站用户。你输入两次密码，然后相信程序会比较它们，确保它们是相同的。但是，正如我们所知，将这两个密码以纯文本的形式存储在我们的users表中是不负责任的，所以我们在模式中没有相应的列——我们在<em class="jt"> password_digest </em>中只有经过摘要、散列和加盐的版本。</p><p id="1d20" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">回想一下我们的真实体验，如果我们希望用户在注册过程中输入两次密码，我们知道需要将这两个字段分别编码到我们的注册表单中。在这个特殊的项目中，我们用React.js编写了前端，我决定声明一个保存表单数据的状态，如下所示:</p><figure class="lc ld le lf fd ij er es paragraph-image"><div class="er es li"><img src="../Images/7f20024f8cc37d0cdcb96f0b7d6f9b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*ig1G5O1U5W1GRF9K1GWDlw.png"/></div></figure><p id="526a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我确保上面的键与users表中的列名完全相同(当然除了password_digest)，这样我就可以用fetch POST方法将整个formData对象发送到后端。我还确保使用与表单中输入元素的名称完全相同的键，如下所示:</p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/21a81c8bade467977394125f172e9361.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x5B2i8a4kluJg2pM8JRK_A.png"/></div></div></figure><p id="6d53" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这使得编写一个<em class="jt"> handleChange </em>函数来在我的表单接收输入时更新我的formData状态变得非常容易，而且这也使得获取POST变得非常简单，因为我可以将整个formData对象发送到后端。这看起来是这样的:</p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/5ebe08738457513f4cd9293a87946599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v-AbONSQZoDkBPmvBRouIQ.png"/></div></div></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="09ea" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">无论您决定在注册组件中处理用户输入，这里最重要的事情是:</p><ol class=""><li id="fa44" class="ll lm hi ix b iy iz jc jd jg ln jk lo jo lp js lq lr ls lt bi translated">使用前端的<em class="jt">密码</em>和<em class="jt">密码确认</em>，</li><li id="d39d" class="ll lm hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated">将它们都发送到后端(即使在您的表中没有对应的列！),</li><li id="f71a" class="ll lm hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated">并且只在后端使用<em class="jt">密码摘要</em>。</li></ol><p id="8b7c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于我们通常非常小心地确保我们的前端提交具有匹配我们的后端列的键，我很难让自己记住在两端使用这些不同的密码术语，所以我希望这个简化的解释能帮助我们记住这些约定。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="8e63" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要了解更多信息，请查看Rails文档，如下所示:</p><p id="56f4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://api.rubyonrails.org/classes/ActiveModel/SecurePassword/ClassMethods.html" rel="noopener ugc nofollow" target="_blank">https://API . ruby on rails . org/classes/active model/secure password/class methods . html</a></p><p id="9950" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢您的阅读！</p></div></div>    
</body>
</html>