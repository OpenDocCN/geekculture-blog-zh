<html>
<head>
<title>Converting Dictionary to Generic List<t> With Custom Attribute</t></title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将字典转换为具有自定义属性的通用列表<t/></h1>
<blockquote>原文：<a href="https://medium.com/geekculture/converting-dictionary-to-generic-list-t-with-custom-attribute-1bea1c2f3a1d?source=collection_archive---------2-----------------------#2022-11-27">https://medium.com/geekculture/converting-dictionary-to-generic-list-t-with-custom-attribute-1bea1c2f3a1d?source=collection_archive---------2-----------------------#2022-11-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6f531292dac9b7d78e6a5d7dd93debf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QUvuQusL1_7-YBqMfIVbmA.jpeg"/></div></div></figure><p id="8bdb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您在字典中有一些字符串键和对象值，并且想要转换为“T2列表”模型，并且需要对一些属性进行一些特定的操作，那么这篇文章就是为您准备的。</p><p id="9f1f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我们将采用两种不同的方法。其中之一是带有映射配置文件的字典扩展类，另一个是字典扩展类的更好的性能。</p><p id="5bbf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Model/SentMail.cs: </strong>这是我们转换后的字典列表&lt; T &gt;型号。我们将把字典键值数据转换成“<em class="jo"> List &lt; SenMail &gt; </em>”。“<em class="jo">邮件类型</em>”是int枚举字段。我们将编写一个定制的“<em class="jo">【JSON data】</em>”属性，并用这个属性对Recipient属性进行签名。我们将在文章的后面讨论这个问题。</p><p id="a51b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不是:"<em class="jo"> Konu </em>"在土耳其语中是特别定义的。意思是主体。稍后我们将使用config，用“subject”关键字映射它。</p><pre class="jp jq jr js fd jt ju jv bn jw jx bi"><span id="3e47" class="jy jz hi ju b be ka kb l kc kd">namespace BlogDictionaryToList.Model<br/>{<br/>    public  class SentMail<br/>    {<br/>        public string Email { get; set; }<br/>        public string MailId { get; set; }<br/>        public int MailType { get; set; }<br/>        public string FolderName { get; set; }<br/>        public string From { get; set; }<br/>        public string Konu { get; set; }<br/>        public string SenderName { get; set; }        <br/>        public DateTime PostTime { get; set; }<br/>    <br/>        [JsonData]<br/>        public string Recipient { get; set; }<br/>    }<br/>}</span></pre><p id="38a0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">custom attribute/JSON data . cs:</strong>这是我们的自定义属性。它仅用于标记类的属性。此属性是复杂类型的字典值。当我们看到这个标志时，我们会把它转换成字符串。</p><pre class="jp jq jr js fd jt ju jv bn jw jx bi"><span id="a74c" class="jy jz hi ju b be ka kb l kc kd">namespace BlogDictionaryToList.CustomAttribute<br/>{<br/>    [AttributeUsage(AttributeTargets.All)]<br/>    public class JsonData : Attribute<br/>    {<br/>        public JsonData()<br/>        {<br/>        }<br/>    }<br/>}</span></pre><p id="54dc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">static converter/to JSON():</strong>这个扩展用于将对象转换为字符串。</p><pre class="jp jq jr js fd jt ju jv bn jw jx bi"><span id="eb65" class="jy jz hi ju b be ka kb l kc kd"> public static string ToJson(this object value)<br/>        {<br/>            return JsonConvert.SerializeObject(value);<br/>        }</span></pre><p id="4e1d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Enums/MailType.cs: </strong>这是SentMail的整数邮件类型属性。</p><pre class="jp jq jr js fd jt ju jv bn jw jx bi"><span id="2de4" class="jy jz hi ju b be ka kb l kc kd">namespace BlogDictionaryToList.Enums<br/>{<br/>    public enum MailType<br/>    {<br/>        Inbox = 1,<br/>        JunkEmail = 2,<br/>        Drafts = 3,<br/>        SentItems = 4,<br/>        DeletedItems = 5,<br/>        Others = 6    <br/>    }<br/>}</span></pre><p id="f3df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Model/Email.cs: </strong>这是我们复杂类型的字典值的“收件人”关键字。我们将把这个类列表转换成一个字符串，用于映射“<em class="jo"> SentMail </em>”类的Recipient属性。</p><pre class="jp jq jr js fd jt ju jv bn jw jx bi"><span id="2de2" class="jy jz hi ju b be ka kb l kc kd">namespace BlogDictionaryToList.Model<br/>{<br/>    public class Email<br/>    {<br/>        public string EmailContent { get; set; }<br/>        [JsonConverter(typeof(StringEnumConverter))]<br/>        public SenderType SenderType { get; set; }<br/>    }<br/>}</span></pre><p id="cdc0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Enum/SenderType.cs: </strong>这是Email类的属性SenderType。它是一个整数枚举。</p><pre class="jp jq jr js fd jt ju jv bn jw jx bi"><span id="df8a" class="jy jz hi ju b be ka kb l kc kd">namespace BlogDictionaryToList.Enums<br/>{<br/>    public enum SenderType<br/>    {<br/>        To = 1,<br/>        Cc = 2,<br/>        Bcc = 3<br/>    }<br/>}</span></pre><p id="76c9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Program.cs(1): </strong>首先，让我们按键和值将一万个“SentMail”模型填入字典。“<em class="jo">收件人</em>”是“邮件”的列表。我们将它设置为字典中的“收件人”字段。“uniqueKey”是忽略键。我们不会将它保存到数据库。我们使用它，不允许重复的行。("<em class="jo">如果(dictList。Any(dic = &gt; dic["uniqueKey"]。ToString() == uniqueKey)) </em>")</p><pre class="jp jq jr js fd jt ju jv bn jw jx bi"><span id="40f3" class="jy jz hi ju b be ka kb l kc kd">using BlogDictionaryToList.Enums;<br/>using BlogDictionaryToList.Model;<br/><br/>List&lt;Dictionary&lt;string, object&gt;&gt; dictList = new List&lt;Dictionary&lt;string, object&gt;&gt;();<br/>List&lt;Email&gt; Recipients = new List&lt;Email&gt;();<br/>Recipients.Add(new Email() { EmailContent = "Test Email", SenderType = SenderType.To });<br/>Recipients.Add(new Email() { EmailContent = "Test Email 2", SenderType = SenderType.Cc });<br/><br/>for (var i = 0; i &lt; 10000; i++)<br/>{<br/>    Dictionary&lt;string, object&gt; dict = new Dictionary&lt;string, object&gt;(); <br/>    <br/>    var uniqueKey = $"bora@borakasmer.com{i}" + "|" + 2 + "|" + 653 + i;<br/>    dict.Add("uniqueKey", uniqueKey);   <br/>    dict.Add("Email", $"bora.kasmer@keepnetlabs.com{i}");  <br/>    dict.Add("MailId", 653 + i);<br/>    dict.Add("MailType", MailType.SentItems);<br/>    dict.Add("FolderName", $"Bora's Folder{i}");<br/>    dict.Add("From", $"Bora{i}");<br/>    dict.Add("Subject", $"Test Converter{i}");<br/>    dict.Add("SenderName", $"Bora{i}");    <br/>    dict.Add("PostTime", DateTime.Now);<br/>    dict.Add("Recipient", Recipients);<br/>    <br/>    //Check for eliminate the same row.<br/>    if (dictList.Any(dic =&gt; dic["uniqueKey"].ToString() == uniqueKey))<br/>    {<br/>        var dic = dictList.First(dic =&gt; dic["uniqueKey"].ToString() == uniqueKey);<br/>        dictList.Remove(dic);<br/>    }<br/>    dictList.Add(dict);<br/>}</span></pre><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ke"><img src="../Images/4a25708128d38a2cab30c0e2c26a1153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nQZArjkgaXPfGurAgN2DwQ.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">One item in the dictionary after filled by 10000 SentMail items.</figcaption></figure><p id="ca9d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> DictionaryToList &lt; T &gt;扩展(版本1): </strong>第一种方法，编写一个静态扩展类。接下来，我们将向该类添加新功能。</p><p id="432a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 1-) </strong>我们将启动一个计时器，用于计算总时间。我们将创建一个通用列表&lt; T &gt;，我们将填充并返回它。我们将循环字典列表中的每一个字典。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kj"><img src="../Images/69835d19a7e653eaf01a72c86f1d9e73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pv6FwaNCFWKOema7VKUhgA.png"/></div></div></figure><p id="3292" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 2-) </strong>我们将通过使用反射创建一个通用的<strong class="is hj">、</strong>类。<strong class="is hj"> </strong>我们将循环字典中的每一个条目。“唯一键”是忽略键。我们只能将其用于自定义操作。例如，它可以用于检查相同的记录是否存在。数据库中没有与“唯一键”匹配的列。每个键都是该类属性的名称。我们将通过使用反射获得带有字符串键的"<em class="jo"> PropertyInfo" </em>。我们将获得“<em class="jo">型</em>的财产。并且检查它是否为空。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/d55608508f3423dc88d0009280419125.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jnpfEZ1Oo_DnnhrF2bcZbw.png"/></div></div></figure><p id="0a8c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 3-) </strong>正如我们在本文开头谈到的<strong class="is hj"/><em class="jo">【JSON data】SentMail</em>的收件人属性是字符串类型。但是在散列中，我们将Recipient设置为复杂类型，所以我们必须将这个字段转换为JSON字符串。我们将检查“<em class="jo"> JsonData </em>”自定义属性。如果任何属性有这个属性，我们将把它转换成一个带有自定义“<em class="jo"> ToJson() </em>”扩展名的字符串。稍后我们将提高这部分的性能。最后，我们将使用哈希值设置该属性。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/8d724c2906a31f52fbc50dfab0e88a0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MrwHb2NeLon6y8DXl0PILg.png"/></div></div></figure><p id="ddf4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 4-) </strong>最后，我们将SendMail模型添加到列表中，写出总的经过时间并返回列表。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es km"><img src="../Images/b4bd7c4cb519df6fcf83c8a9375d9570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mtudAGD4oUfvTWvDHI5jGA.png"/></div></div></figure><pre class="jp jq jr js fd jt ju jv bn jw jx bi"><span id="3a93" class="jy jz hi ju b be ka kb l kc kd"> public static class StaticConverter<br/>    {<br/>        public static List&lt;T&gt; DictionaryToList&lt;T&gt;(this IEnumerable&lt;Dictionary&lt;string, object&gt;&gt; dictionary, <br/>            Dictionary&lt;string, string&gt; ColumnMatchTable)<br/>        {<br/>            System.Diagnostics.Stopwatch watch = System.Diagnostics.Stopwatch.StartNew();<br/>            List&lt;T&gt; list = new List&lt;T&gt;();<br/>            foreach (Dictionary&lt;string, object&gt; dict in dictionary)<br/>            {<br/>                T model = Activator.CreateInstance&lt;T&gt;();<br/><br/>                foreach (KeyValuePair&lt;string, object&gt; dic in dict)<br/>                {<br/>                    //uniqueKey is Ignore Property<br/>                    if (dic.Key != "uniqueKey") //Unique Dictionary Key<br/>                    {<br/>                        PropertyInfo propertyInfo = model.GetType().GetProperty(dic.Key);<br/>                        <br/>                        Type t = propertyInfo.PropertyType;<br/>                        t = Nullable.GetUnderlyingType(t) ?? t;<br/>                        object safeValue;<br/><br/>                        if (Attribute.IsDefined(propertyInfo, typeof(JsonData)))<br/>                            safeValue = (dic.Value == null || dic.Value == System.DBNull.Value) ? null : dic.Value.ToJson();<br/>                        else<br/>                            safeValue = (dic.Value == null || dic.Value == System.DBNull.Value) ? null : Convert.ChangeType(dic.Value, t);<br/><br/>                        propertyInfo.SetValue(model, safeValue, null);<br/>                    }<br/>                }<br/>                list.Add(model);<br/>            }<br/>            Console.WriteLine("Total Time:" + watch.Elapsed);<br/>            return list;<br/>        }<br/>    }</span></pre><p id="ae33" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Extensions/ToJson(): </strong>用于将对象(类)转换成字符串。</p><pre class="jp jq jr js fd jt ju jv bn jw jx bi"><span id="6969" class="jy jz hi ju b be ka kb l kc kd">public static string ToJson(this object value)<br/>        {<br/>            return JsonConvert.SerializeObject(value);<br/>        }</span></pre><blockquote class="kn"><p id="1af4" class="ko kp hi bd kq kr ks kt ku kv kw jn dx translated">"积极的态度加上努力等于表现."</p><p id="f8c7" class="ko kp hi bd kq kr kx ky kz la lb jn dx translated">—汤米·特伯维尔</p></blockquote><h1 id="264d" class="lc jz hi bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在字典和类之间映射不同的字段名称</h1><p id="3524" class="pw-post-body-paragraph iq ir hi is b it lz iv iw ix ma iz ja jb mb jd je jf mc jh ji jj md jl jm jn hb bi translated">我们将把字典“Subject”键与SentMail类的“Konu”属性相匹配。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/f4b7e22e61c98043674404457ee1d99e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4MhNbzCU1kSO_SpLsjSZRA.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Mapped Dictionary[“Subject”] with SentMail.Konu</figcaption></figure><p id="f4d8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">static converter/CheckedMapedKey():</strong>我们将用这个方法映射<strong class="is hj"> </strong>字典字符串键值和模型属性名。我们将发送字典配置值，并用这个方法找到字符串键参数的匹配。</p><pre class="jp jq jr js fd jt ju jv bn jw jx bi"><span id="2029" class="jy jz hi ju b be ka kb l kc kd">       public static string CheckedMapedKey(string key, Dictionary&lt;string, string&gt; ColumnMatchTable)<br/>        {<br/>            if (ColumnMatchTable.Count &gt; 0)<br/>            {<br/>                if (ColumnMatchTable.TryGetValue(key, out string value))<br/>                {<br/>                    return value;<br/>                }<br/>            }<br/>            return key;<br/>        }</span></pre><p id="8391" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">字典列表&lt; T &gt;扩展(版本2): </strong></p><p id="1da1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将在这个扩展中添加“Dictionary ColumnMatchTable”参数。并映射不同的字符串字典键和类属性名。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/f837828212d1428061ec6a2daa1aaace.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XpgPkFYVIeHBAR5hrXy8dA.png"/></div></div></figure><pre class="jp jq jr js fd jt ju jv bn jw jx bi"><span id="5dbd" class="jy jz hi ju b be ka kb l kc kd">public static List&lt;T&gt; DictionaryToList&lt;T&gt;(this IEnumerable&lt;Dictionary&lt;string, object&gt;&gt; dictionary, Dictionary&lt;string, string&gt; ColumnMatchTable)<br/>        {<br/>            System.Diagnostics.Stopwatch watch = System.Diagnostics.Stopwatch.StartNew();<br/>            List&lt;T&gt; list = new List&lt;T&gt;();<br/>            foreach (Dictionary&lt;string, object&gt; dict in dictionary)<br/>            {<br/>                T model = Activator.CreateInstance&lt;T&gt;();<br/><br/>                foreach (KeyValuePair&lt;string, object&gt; dic in dict)<br/>                {<br/>                    //PropertyInfo propertyInfo = model.GetType().GetProperty(dic.Key);<br/>                    PropertyInfo propertyInfo = model.GetType().GetProperty(CheckedMapedKey(dic.Key, ColumnMatchTable));<br/><br/>                    Type t = propertyInfo.PropertyType;<br/>                    t = Nullable.GetUnderlyingType(t) ?? t;<br/>                    object safeValue;<br/><br/>                    if (Attribute.IsDefined(propertyInfo, typeof(JsonData)))<br/>                        safeValue = (dic.Value == null || dic.Value == System.DBNull.Value) ? null : dic.Value.ToJson();<br/>                    else<br/>                        safeValue = (dic.Value == null || dic.Value == System.DBNull.Value) ? null : Convert.ChangeType(dic.Value, t);<br/><br/>                    propertyInfo.SetValue(model, safeValue, null);<br/>                }<br/>                list.Add(model);<br/>            }<br/>            Console.WriteLine("Total Time:" + watch.Elapsed);<br/>            return list;<br/>        }</span></pre><p id="7798" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">映射配置字典示例:</em> </strong>我们会用这种方法匹配不同的列名。</p><pre class="jp jq jr js fd jt ju jv bn jw jx bi"><span id="cb35" class="jy jz hi ju b be ka kb l kc kd"> var columnMatchTable = new Dictionary&lt;string, string&gt;() {<br/>                                    {"Subject", "Konu" }<br/>                                };</span></pre><blockquote class="kn"><p id="1078" class="ko kp hi bd kq kr ks kt ku kv kw jn dx translated"><strong class="ak">“细节成就完美，完美不是细节。”</strong></p><p id="4c34" class="ko kp hi bd kq kr kx ky kz la lb jn dx translated">― <strong class="ak">达芬奇</strong></p></blockquote><h1 id="803d" class="lc jz hi bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">提高性能:</h1><p id="cf9f" class="pw-post-body-paragraph iq ir hi is b it lz iv iw ix ma iz ja jb mb jd je jf mc jh ji jj md jl jm jn hb bi translated"><strong class="is hj"> 1-) </strong>对于字典中的每一个条目，我们不必检查每个属性的属性。只检查第一项的属性就足够了。<strong class="is hj"> <em class="jo">属性。【IsDefined()“反射法消耗大量资源。这就是为什么我们应该离得越远越好。所以我们会添加“<strong class="is hj"><em class="jo"/></strong>”静态方法。它用于检查属性的属性。如果它找到一个属性，它将把它添加到“<strong class="is hj"><em class="jo">AttributeDictionaryList</em></strong>”中，并附上它的属性名和属性名。</em></strong></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/d8677c5ae75bbe746d5d60947641c889.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J_Y4VFwhqDDpwj74DZw62g.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">It is used for checking attribute of properties.</figcaption></figure><p id="1bb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 2-) </strong> List &lt; T &gt;是我们的返回模型，“<strong class="is hj"><em class="jo">AttributeDictionaryList”</em></strong>是一个列表，用来存储带有模型属性的属性。所以当我们将字典转换为列表的第一项时，我们会找到属性的属性，并将它们存储在AttributeDictionaryList<strong class="is hj"><em class="jo">中。</em> </strong>对于接下来的型号，我们将从这个列表中获取它们的属性。所以我们会提高性能。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/3cb670073de1e676dd03f17c1a00970c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fHq73YYvazVb_-1tCAsgCQ.png"/></div></div></figure><p id="e73a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 3-) </strong>我们将改变“属性。IsDefined()"和自定义的" CheckAttribute()"方法，在第一个方法之后，我们可以从字典中获取属性的属性。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/1b8d98317ccb9af52da4f04234d0bed4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uQnC_z2s1oyRqAC4zgL02g.png"/></div></div></figure><p id="302c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是使用反射(<em class="jo">属性之间的性能测试。IsDefined() </em>)并只使用一个项目(<em class="jo"> CheckAttribute() </em>)。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/38be5e6364cc29ad5b0e77820d69daf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aECf-O9s62BH-UZylZ_eCg.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx"><strong class="bd ld">Performance Test</strong></figcaption></figure><blockquote class="kn"><p id="7b14" class="ko kp hi bd kq kr ks kt ku kv kw jn dx translated">“专注和简单是我的座右铭之一。简单可能比复杂更难……”</p><p id="8ff3" class="ko kp hi bd kq kr kx ky kz la lb jn dx translated">—史蒂夫·乔布斯</p></blockquote><p id="e40b" class="pw-post-body-paragraph iq ir hi is b it mk iv iw ix ml iz ja jb mm jd je jf mn jh ji jj mo jl jm jn hb bi translated"><strong class="is hj">字典列表&lt; T &gt;扩展(最终版本)</strong></p><pre class="jp jq jr js fd jt ju jv bn jw jx bi"><span id="74d0" class="jy jz hi ju b be ka kb l kc kd">        /// &lt;summary&gt;<br/>        /// Convert Dictionary To List&lt;T&gt;<br/>        /// &lt;/summary&gt;<br/>        /// &lt;typeparam name="T"&gt;&lt;/typeparam&gt;<br/>        /// &lt;param name="dictionary"&gt;&lt;/param&gt;<br/>        /// &lt;param name="ColumnMatchTable"&gt; var columnMatchTable = new Dictionary&lt;string, string&gt;() { {"Subject", "Konu" } }; &lt;/param&gt;<br/>        /// &lt;returns&gt;&lt;/returns&gt;<br/>        public static List&lt;T&gt; DictionaryToList&lt;T&gt;(this IEnumerable&lt;Dictionary&lt;string, object&gt;&gt; dictionary, <br/>            Dictionary&lt;string, string&gt; ColumnMatchTable)<br/>        {<br/>            System.Diagnostics.Stopwatch watch = System.Diagnostics.Stopwatch.StartNew();<br/>            List&lt;T&gt; list = new List&lt;T&gt;();<br/>            Dictionary&lt;string, bool&gt; AttributeDictionaryList = new Dictionary&lt;string, bool&gt;(); //NEW<br/>            foreach (Dictionary&lt;string, object&gt; dict in dictionary)<br/>            {<br/>                T model = Activator.CreateInstance&lt;T&gt;();<br/><br/>                string modelName = model.GetType().ToString();//NEW<br/><br/>                foreach (KeyValuePair&lt;string, object&gt; dic in dict)<br/>                {<br/>                    //uniqueKey is Ignore Property<br/>                    if (dic.Key != "uniqueKey") //Unique Dictionary Key<br/>                    {<br/>                        //PropertyInfo propertyInfo = model.GetType().GetProperty(dic.Key);<br/>                        PropertyInfo propertyInfo = model.GetType().GetProperty(CheckedMapedKey(dic.Key, ColumnMatchTable));<br/><br/>                        Type t = propertyInfo.PropertyType;<br/>                        t = Nullable.GetUnderlyingType(t) ?? t;<br/>                        object safeValue;<br/><br/>                        //Performance Improvement<br/>                        //if (Attribute.IsDefined(propertyInfo, typeof(JsonData)))                        <br/>                        if (CheckAttribute(modelName, propertyInfo, typeof(JsonData), AttributeDictionaryList))//NEW<br/>                            safeValue = (dic.Value == null || dic.Value == System.DBNull.Value) ? null : dic.Value.ToJson();<br/>                        else<br/>                            safeValue = (dic.Value == null || dic.Value == System.DBNull.Value) ? null : Convert.ChangeType(dic.Value, t);<br/><br/>                        propertyInfo.SetValue(model, safeValue, null);<br/>                    }<br/>                }<br/>                list.Add(model);<br/>            }<br/>            Console.WriteLine("Total Time:" + watch.Elapsed);<br/>            return list;<br/>        }<br/><br/>        public static bool CheckAttribute(string modelName, PropertyInfo pi, Type type, Dictionary&lt;string, bool&gt; AttributeDictionaryList) //NEW<br/>        {<br/>            if (AttributeDictionaryList.ContainsKey(modelName + "." + pi.Name + "." + type.Name))<br/>                return AttributeDictionaryList[modelName + "." + pi.Name + "." + type.Name];<br/>            else<br/>            {<br/>                var result = Attribute.IsDefined(pi, type);<br/>                AttributeDictionaryList.Add(modelName + "." + pi.Name + "." + type.Name, result);<br/>                return result;<br/>            }<br/>        }</span></pre><p id="025a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Program.cs(Final): </strong>使用<strong class="is hj"><em class="jo">DictionaryToList()</em></strong>扩展名。</p><p id="15de" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">1-)“dict list”是我们的测试词典列表。我们将把它转换成一个列表。列表<email>是我们复杂的接收者的属性测试值。</email></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/e4f43cc0a78f16a96895c36936573f91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eT1twZlNtsBUqYWz2tqU3g.png"/></div></div></figure><p id="e0c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2-)我们将向字典列表添加10000行。“uniqueKey”是我们忽略的键。对于每个字典来说，它都是唯一的字符串名称。DB上没有此键的映射属性。我们将使用它来保持字典中的唯一性。如果我们发现任何具有相同关键字的记录，我们将删除它并用最新的字典更新它。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/91a958f37e2a18f525b1fd8880e64035.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9eyjhEzchK5mgblc1Y0raw.png"/></div></div></figure><p id="6766" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3-)"<strong class="is hj"><em class="jo">columnMatchTable</em></strong>"是我们匹配的配置列表，像AutoMapper一样。我们将对5 * 10000 = 50000条记录运行5次DictionaryToList()扩展。并监控结果。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/73f45ae3437a886bf6102249e78bf865.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xirH1PvomsAhN_6M91QtGw.png"/></div></div></figure><pre class="jp jq jr js fd jt ju jv bn jw jx bi"><span id="8a79" class="jy jz hi ju b be ka kb l kc kd">using BlogDictionaryToList;<br/>using BlogDictionaryToList.Enums;<br/>using BlogDictionaryToList.Model;<br/><br/>List&lt;Dictionary&lt;string, object&gt;&gt; dictList = new List&lt;Dictionary&lt;string, object&gt;&gt;();<br/>List&lt;Email&gt; Recipients = new List&lt;Email&gt;();<br/>Recipients.Add(new Email() { EmailContent = "Test Email", SenderType = SenderType.To });<br/>Recipients.Add(new Email() { EmailContent = "Test Email 2", SenderType = SenderType.Cc });<br/><br/>for (var i = 0; i &lt; 10000; i++)<br/>{<br/>    Dictionary&lt;string, object&gt; dict = new Dictionary&lt;string, object&gt;();<br/>    var uniqueKey = $"bora@borakasmer.com{i}" + "|" + 2 + "|" + 653 + i;<br/>    dict.Add("uniqueKey", uniqueKey);<br/>    dict.Add("Email", $"bora.kasmer@keepnetlabs.com{i}");  <br/>    dict.Add("MailId", 653 + i);<br/>    dict.Add("MailType", MailType.SentItems);<br/>    dict.Add("FolderName", $"Bora's Folder{i}");<br/>    dict.Add("From", $"Bora{i}");<br/>    dict.Add("Subject", $"Test Converter{i}");<br/>    dict.Add("SenderName", $"Bora{i}");    <br/>    dict.Add("PostTime", DateTime.Now);<br/>    dict.Add("Recipient", Recipients);<br/>    if (dictList.Any(dic =&gt; dic["uniqueKey"].ToString() == uniqueKey))<br/>    {<br/>        var dic = dictList.First(dic =&gt; dic["uniqueKey"].ToString() == uniqueKey);<br/>        dictList.Remove(dic);<br/>    }<br/>    dictList.Add(dict);<br/>}<br/><br/>var columnMatchTable = new Dictionary&lt;string, string&gt;() {<br/>                                    {"Subject", "Konu" }<br/>                                };<br/>for (var s = 0; s &lt; 5; s++)<br/>{<br/>    var list = dictList.DictionaryToList&lt;SentMail&gt;(columnMatchTable);    <br/>}</span></pre><blockquote class="kn"><p id="8361" class="ko kp hi bd kq kr ks kt ku kv kw jn dx translated">"大自然喜欢简单。"</p><p id="b9a1" class="ko kp hi bd kq kr kx ky kz la lb jn dx translated">艾萨克·牛顿。</p></blockquote><figure class="mt mu mv mw mx ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ms"><img src="../Images/050f5fbf17280f6a0adca0e81e30777c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2_1qPwSfR51npGyZ_YeMAQ.gif"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Test Dictionary to List Performance</figcaption></figure><p id="0d47" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">结论:</strong></p><p id="88d1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我们试图将字典转换为列表，而不是逐个匹配列。在这样做的时候，我们使用了泛型和反射类。我知道反射是一个性能杀手，但是如果你有100个列表并且可读性对你很重要，你可以毫不犹豫地使用这个扩展。我试图通过将属性存储在限定了作用域的字典中来提升代码。但是如果对你来说还不够，你可以在启动时把所有的“class.table.column.attributes”保留在一个全局静态字典列表中。而且也许你可以超载"<strong class="is hj"> <em class="jo"> dictList。</em></strong>”DictionaryToList(ColumnMatchTable，bool hasAttribute=true)。如果您的类的属性没有属性，您可以将“hasAttribute”字段设置为false，并且不检查“ToJson()”或任何属性操作。</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="my mz l"/></div><figcaption class="kf kg et er es kh ki bd b be z dx">Goodbye</figcaption></figure><p id="1e97" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一篇文章再见。</p><p id="d260" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">“如果你读到目前为止，首先感谢你的耐心和支持。欢迎大家来我的博客</em><a class="ae na" href="http://www.borakasmer.com/" rel="noopener ugc nofollow" target="_blank"><em class="jo"/><strong class="is hj"><em class="jo"/></strong></a><strong class="is hj"><em class="jo"/></strong><em class="jo">了解更多！”</em></p><p id="7afc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">Github:</strong><a class="ae na" href="https://github.com/borakasmer/DictionaryToList" rel="noopener ugc nofollow" target="_blank"><strong class="is hj"><em class="jo">https://github.com/borakasmer/DictionaryToList</em></strong></a></p></div></div>    
</body>
</html>