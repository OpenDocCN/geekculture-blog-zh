<html>
<head>
<title>Email Verification With NodeJs (Part 3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NodeJs电子邮件验证(第3部分)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/email-verification-with-nodejs-part-3-e004787391e3?source=collection_archive---------13-----------------------#2021-04-09">https://medium.com/geekculture/email-verification-with-nodejs-part-3-e004787391e3?source=collection_archive---------13-----------------------#2021-04-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3e0473bb756b5bffad17af9b74429369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BnqXqBrB8TkTmw8q.jpg"/></div></div></figure><p id="aed3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我写了如何在注册应用程序中验证电子邮件。为此，我使用了我的旧代码，邮递员，当然还有MongoDB指南针。如果你想了解如何编写旧代码，可以访问以下链接:</p><p id="f807" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一部分:<a class="ae jo" href="https://serapbaysal.medium.com/signup-login-application-with-nodejs-express-and-mongodb-658498e580cf" rel="noopener">https://serapbaysal . medium . com/sign up-log in-application-with-nodejs-express-and-MongoDB-658498 e 580 cf</a></p><p id="5535" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第二部分:<a class="ae jo" href="https://serapbaysal.medium.com/logout-with-nodejs-express-and-mongodb-9b73e8b01137" rel="noopener">https://serapbaysal . medium . com/logout-with-nodejs-express-and-MongoDB-9b 73 E8 b 01137</a></p><p id="bfa9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，如果你准备好了，我们可以开始了！</p><p id="1864" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们需要mailgun。我们去mailgun网站并添加一个帐户。注册申请是免费的，所以你可以免费使用。之后，我们将在终端中编写npm install mailgun-js并安装包。我们将转到controllers/auth.js文件，将mailgun-js作为mailgun导入并删除其中的register方法，我们将重新编写它。</p><p id="79b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们就去https://app.mailgun.com/app/dashboard<a class="ae jo" href="https://app.mailgun.com/app/dashboard" rel="noopener ugc nofollow" target="_blank">和</a>发送/概述，复制链接没有？，将其粘贴到域变量中。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jp"><img src="../Images/6736d0b630940fbc4fcef6f7fe706ebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v7ghH3DoV7vrtpUzkGIJXA.png"/></div></div></figure><p id="e025" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后我们将创建另一个变量:</p><p id="216c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">const mg = mailgun({ API key:process . env . mailgun _ API key，DOMAIN:DOMAIN })；</em></p><p id="f0dd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要MAILGUN_APIKEY，所以我们将去。env文件并创建MAILGUN_APIKEY变量。为此，在mailgun站点中，我们将单击API part并选择Node.Js。我们将复制API密钥并将其粘贴到MAILGUN_APIKEY中。所以我们准备编码！</p><p id="0a17" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在注册方法中，我们将编写{名称，电子邮件，密码} = req.body</p><p id="6242" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后创建一个token_activate，等于<em class="ju"> jwt.sign({name，email，password}，process.env.JWT_ACC_ACTIVATE，{ expi resin:' 20m ' })；</em></p><p id="0a5d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这方面，我们还没有JWT_ACC_ACTIVATE，所以在。env文件，我们将创建这个变量并使它等于任何单词。</p><p id="255e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后复制</p><p id="43e6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">常量数据= { </em></p><p id="22b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">来自:‘激动的用户&lt;me@samples.mailgun.org&gt;’，</em></p><p id="b151" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">致:'bar@example.com，你@你的域名’，</em></p><p id="627f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">主题:“你好”，</em></p><p id="bf79" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">正文:“测试一些神枪手！”</em></p><p id="0740" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">}；</em></p><p id="7881" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> mg.messages()。发送(数据，函数(错误，正文){ </em></p><p id="e56a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> console.log(正文)；</em></p><p id="6506" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">})；</em></p><p id="2b6a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在此，发件人部分将是您将使用的电子邮件地址。收件人将发送不带“”的电子邮件。我们将删除文本部分，并写入:</p><p id="38e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> html:` </em></p><p id="0a7c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> &lt; h2 &gt;请点击给定链接激活您的账户&lt; /h2 &gt; </em></p><p id="38e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">&lt;p&gt;$ { process . env . client _ URL }/authentic ation/activate/$ { activate _ token }&lt;/p&gt;</em></p><p id="3a04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> ` </em></p><p id="7003" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在此，我们还没有CLIENT_URL，所以在。env我们会写<a class="ae jo" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000 </a>。</p><p id="23ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> mg.messages()。发送(数据，函数(错误，正文){ </em></p><p id="20a2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">如果(错误){ </em></p><p id="2b3c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> return res.json({ </em></p><p id="819d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">信息:错误信息</em></p><p id="6d82" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> }) </em></p><p id="f29a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> } </em></p><p id="60b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> return res.json({message:'邮件已发送' }) </em></p><p id="cf95" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> } </em></p><p id="3088" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">至此，我们完成了注册方法。因此，如果我们向Postman发送一个注册请求(POST<a class="ae jo" href="http://localhost:5000/signup" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/sign up</a>，在我们的电子邮件中将会看到一封电子邮件。</p><p id="492a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我们来验证一下邮件。为此，我们将编写一个名为activateAccount的函数。在这里，我们将编写以下代码:</p><p id="d131" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">const { token } = req . body；</em></p><p id="885c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">如果(令牌){ </em></p><p id="e295" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> jwt.verify(token，process.env.JWT_ACC_ACTIVATE，exports.function = async (err，decodedtoken) = &gt; { </em></p><p id="45ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> if(err) { </em></p><p id="e32b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">返回res.status(400)。JSON({错误:“链接不正确”}) </em></p><p id="7bb5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> } </em></p><p id="7dc8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> const {姓名，邮箱，密码} = decodedtoken</em></p><p id="8a38" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">const user = await user . create({</em></p><p id="c34a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">名称，</em></p><p id="6591" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">邮件，</em></p><p id="0b39" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">密码</em></p><p id="500a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> }) </em></p><p id="12e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju">const id = user . getid()；</em></p><p id="ac54" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> sendTokenResponse(用户，200，res，id)；</em></p><p id="9d2f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> }) </em></p><p id="5096" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ju"> } </em></p><p id="8849" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这段代码中，首先我们将创建令牌，并控制它是否存在。如果存在，我们将使用token，process.env.JWT_ACC_ACTIVATE，exports.function = async (err，decodedtoken)进行验证</p><p id="1763" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之后，我们将创建一个解码令牌，创建一个用户并发送令牌。然后在routes/auth.js文件中，添加以下代码。</p><p id="e8d9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">router . post('/电子邮件激活'，激活帐户)</p><p id="09a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就是这样！我们完成了代码部分。</p><p id="e3af" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们去邮差那里注册一个账户。然后，我们将回到邮件地址，并在激活word后复制，这是令牌。在Postman中，我们将使用<a class="ae jo" href="http://localhost:5000/email-activate" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/email-activate</a>创建一个Post请求，在正文部分，我们将发送名为token的JSON数据，并粘贴我们复制的token。然后发送数据。</p><p id="56e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你看MongoDB指南针，注册后，你会看到什么，因为电子邮件不验证。验证后，你会看到数据库中的用户。</p><p id="482b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇文章写完了，希望你对验证邮件有所了解。感谢阅读。</p></div></div>    
</body>
</html>