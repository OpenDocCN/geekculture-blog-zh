<html>
<head>
<title>Set Up a Highly Available WordPress Site Using Elastic Beanstalk + RDS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Elastic Beanstalk + RDS建立一个高度可用的WordPress站点</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/set-up-a-highly-available-wordpress-site-using-elastic-beanstalk-rds-58ddba04d293?source=collection_archive---------15-----------------------#2021-05-25">https://medium.com/geekculture/set-up-a-highly-available-wordpress-site-using-elastic-beanstalk-rds-58ddba04d293?source=collection_archive---------15-----------------------#2021-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/917e9a2c5696d5ab7a2c78626255d91c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h4TLlisFk7XvtREAsS7C7Q.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Photo by <a class="ae hv" href="https://unsplash.com/@cgower?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Christopher Gower</a> on <a class="ae hv" href="https://unsplash.com/s/photos/web?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/></div><div class="ab cl iv iw gp ix" role="separator"><span class="iy bw bk iz ja jb"/><span class="iy bw bk iz ja jb"/><span class="iy bw bk iz ja"/></div><div class="hb hc hd he hf"><p id="419a" class="pw-post-body-paragraph jc jd hy je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">当你意识到如何在AWS上设置WordPress就像在迷宫中导航时，你可能会发现自己在这里。它需要将AWS文档页面和数百个堆栈溢出建议拼凑在一起。为了给你和我未来的自己节省一些时间，下面的说明将帮助你在AWS上建立一个高可用性的WordPress站点。</p><p id="f7dd" class="pw-post-body-paragraph jc jd hy je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">我使用这个设置来托管一个虚拟活动网站，它需要一个基于WordPress为150，000+并发用户构建的登录的、不可缓存的体验。(我们估计，在为期两天的会议结束时，超过140个国家的1，000，000人参与了此次活动。🎉)</p><p id="5801" class="pw-post-body-paragraph jc jd hy je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">在负载测试期间，我发现数据库是主要的瓶颈。在事件开始之前，我将数据库大小增加到r6.large16x(有点过分，但为了安全起见)，并将m5.large实例的最小数量增加到60。使用这些网站大小作为基础，结合EBS自动缩放，当我们的用户开始同时注册、登录和参与网站时，网站保持运行。</p><p id="c7bc" class="pw-post-body-paragraph jc jd hy je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">所以，如果你想知道是否有可能在WordPress上运行一个高流量、关键任务的网站…它是！下面的步骤概括了如何实现这一点。</p><h1 id="6bdb" class="ka kb hy bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated"><strong class="ak">设置弹性豆茎</strong></h1><ol class=""><li id="b6c0" class="ky kz hy je b jf la jj lb jn lc jr ld jv le jz lf lg lh li bi translated">使用此链接启动一个EBS应用:<a class="ae hv" href="https://console.aws.amazon.com/elasticbeanstalk/home#/newApplication?environmentType=LoadBalanced" rel="noopener ugc nofollow" target="_blank">https://console . AWS . Amazon . com/elastic beanstalk/home #/new application？环境类型=负载平衡</a></li><li id="3330" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">为以下字段输入您想要的任何值:<br/> -应用程序名称<br/> -环境名称<br/> -域(可选择留空)</li><li id="a8a4" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">对于<strong class="je hz">平台</strong>，选择PHP。对于<strong class="je hz">平台分支</strong>，在撰写本文时，<em class="lo">运行在64位亚马逊Linux 2 </em>上的PHP 8.0是推荐和支持的选项。将<strong class="je hz">平台版本</strong>保留为推荐版本。</li><li id="43c4" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">对于<strong class="je hz">应用代码</strong>，选择<em class="lo">样本应用</em>。</li><li id="6ffa" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">选择<strong class="je hz">查看并启动</strong>。</li><li id="6c73" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">查看其余可用的EBS选项。</li><li id="d3ee" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">选择<strong class="je hz">创建app </strong>。</li><li id="c2df" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">一旦创建了环境，点击<strong class="je hz">配置</strong>并编辑<strong class="je hz">容量</strong>设置以匹配以下内容。<br/> -增加<strong class="je hz">实例类型</strong>(我一般选择t3.large或者m5.large)。该设置可以随时更新。<br/> -编辑<strong class="je hz">缩放触发器</strong>部分以匹配以下内容:<strong class="je hz"> <br/>度量:</strong>CPU利用率<br/> <strong class="je hz">统计:</strong>平均值<br/> <strong class="je hz">单位:</strong>百分比<br/> <strong class="je hz">周期:</strong> 1分钟<br/> <strong class="je hz">违反持续时间:</strong> 1分钟<br/> <strong class="je hz">上限:</strong>10%<br/><strong class="je hz">向上缩放增量:<br/></strong></li><li id="42ca" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">编辑<strong class="je hz">软件</strong>设置并将<strong class="je hz">内存限制</strong>设置为<em class="lo"> 2G </em>。</li><li id="ba95" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">编辑<strong class="je hz">滚动更新和部署</strong>设置。至少将<strong class="je hz">部署策略</strong>更改为<em class="lo">滚动</em>(我喜欢将批量设置为“固定— 2”)，并将<strong class="je hz">滚动更新类型</strong>更改为基于健康的<em class="lo">滚动。</em></li></ol><h1 id="5c77" class="ka kb hy bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">设置RDS</h1><ol class=""><li id="9cc9" class="ky kz hy je b jf la jj lb jn lc jr ld jv le jz lf lg lh li bi translated">使用此链接启动数据库:<a class="ae hv" href="https://console.aws.amazon.com/rds/home#launch-dbinstance:gdb=false;s3-import=false" rel="noopener ugc nofollow" target="_blank">https://console . AWS . Amazon . com/rds/home # launch-db instance:gdb = false；s3-import=false </a></li><li id="bacd" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">对于<strong class="je hz">引擎类型</strong>，选择<em class="lo">亚马逊极光(版本:兼容MySQL的亚马逊极光)</em>。</li><li id="343d" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">在<strong class="je hz">数据库集群标识符</strong>设置中输入数据库的名称。</li><li id="07ad" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">编辑<strong class="je hz">主用户名</strong>和<strong class="je hz">主密码</strong>并记下这些设置，因为您稍后会用到它们。</li><li id="26ac" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">将<strong class="je hz"> DB实例类</strong>设置编辑为可以处理您的工作负载的大小(我通常从r6 large开始，并使用负载测试来确定适合高容量时间的大小)。</li><li id="3d08" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">在<strong class="je hz">多AZ部署</strong>下，选择<em class="lo">在不同的AZ中创建Aurora副本或阅读器节点(推荐用于扩展可用性)</em>。</li><li id="93e0" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">展开<strong class="je hz">附加配置</strong>，设置<strong class="je hz">初始数据库名称</strong>。</li><li id="d8a0" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">选择<strong class="je hz">创建数据库</strong>。</li></ol><h1 id="d034" class="ka kb hy bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">设置WordPress</h1><p id="bda7" class="pw-post-body-paragraph jc jd hy je b jf la jh ji jj lb jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hb bi translated">1.下载并解压WordPress的最新版本</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="7997" class="mb kb hy lx b fi mc md l me mf">~$ <strong class="lx hz">curl </strong><a class="ae hv" href="https://wordpress.org/wordpress-4.9.5.tar.gz" rel="noopener ugc nofollow" target="_blank"><strong class="lx hz">https://wordpress.org/wordpress-4.9.5.tar.gz</strong></a><strong class="lx hz"> -o wordpress.tar.gz</strong><br/>~$ <strong class="lx hz">tar -xvf wordpress.tar.gz</strong><br/>~$ <strong class="lx hz">mv wordpress wordpress-beanstalk<br/></strong>~$ <strong class="lx hz">cd wordpress-beanstalk</strong></span></pre><p id="f7cb" class="pw-post-body-paragraph jc jd hy je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">2.创建一个特定于WordPress的nginx配置文件</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="e043" class="mb kb hy lx b fi mc md l me mf">(from the root wordpress-beanstalk directory)<br/>~$ <strong class="lx hz">nano .platform/nginx/conf.d/elasticbeanstalk/nginx.conf</strong></span><span id="9c03" class="mb kb hy lx b fi mg md l me mf"><strong class="lx hz">Paste in the following content:</strong></span><span id="59c1" class="mb kb hy lx b fi mg md l me mf">location = /favicon.ico {<br/>  log_not_found off;<br/>  access_log off;<br/>}</span><span id="ca0e" class="mb kb hy lx b fi mg md l me mf">location = /robots.txt {<br/>  allow all;<br/>  log_not_found off;<br/>  access_log off;<br/>}</span><span id="594d" class="mb kb hy lx b fi mg md l me mf">location / {<br/>  index index.php index.html index.htm;<br/>  try_files $uri $uri/ /index.php?$args;<br/>}</span><span id="b336" class="mb kb hy lx b fi mg md l me mf">location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {<br/>  expires max;<br/>  log_not_found off;<br/>}</span></pre><p id="4a11" class="pw-post-body-paragraph jc jd hy je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">3.建立你的wp-config.php档案</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="5302" class="mb kb hy lx b fi mc md l me mf">(from the root wordpress-beanstalk directory)<br/>~$ <strong class="lx hz">nano wp-config.php</strong></span><span id="3beb" class="mb kb hy lx b fi mg md l me mf"><strong class="lx hz">Paste in the following content:</strong></span><span id="b9f9" class="mb kb hy lx b fi mg md l me mf">&lt;?php<br/>define('DB_NAME', $_SERVER['RDS_DB_NAME']);<br/>define('DB_USER', $_SERVER['RDS_USERNAME']);<br/>define('DB_PASSWORD', $_SERVER['RDS_PASSWORD']);<br/>define('DB_HOST', $_SERVER['RDS_HOSTNAME'] . ':' . $_SERVER['RDS_PORT']);<br/>define('DB_CHARSET', 'utf8');<br/>define('DB_COLLATE', '');<br/>define('AUTH_KEY',         $_SERVER['AUTH_KEY']);<br/>define('SECURE_AUTH_KEY',  $_SERVER['SECURE_AUTH_KEY']);<br/>define('LOGGED_IN_KEY',    $_SERVER['LOGGED_IN_KEY']);<br/>define('NONCE_KEY',        $_SERVER['NONCE_KEY']);<br/>define('AUTH_SALT',        $_SERVER['AUTH_SALT']);<br/>define('SECURE_AUTH_SALT', $_SERVER['SECURE_AUTH_SALT']);<br/>define('LOGGED_IN_SALT',   $_SERVER['LOGGED_IN_SALT']);<br/>define('NONCE_SALT',       $_SERVER['NONCE_SALT']);<br/>$table_prefix  = 'wp_';<br/>define('WP_DEBUG', false);<br/>if ( !defined('ABSPATH') )<br/>  define('ABSPATH', dirname(__FILE__) . '/');<br/>require_once(ABSPATH . 'wp-settings.php');</span></pre><p id="a3f2" class="pw-post-body-paragraph jc jd hy je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">4.将以下内容添加到您的。gitignore文件</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="9d55" class="mb kb hy lx b fi mc md l me mf"># Elastic Beanstalk Files<br/>.elasticbeanstalk/*<br/>!.elasticbeanstalk/*.cfg.yml<br/>!.elasticbeanstalk/config.yml<br/>!.elasticbeanstalk/*.global.yml</span></pre><h1 id="57f5" class="ka kb hy bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">将RDS数据库连接到EBS</h1><ol class=""><li id="9e83" class="ky kz hy je b jf la jj lb jn lc jr ld jv le jz lf lg lh li bi translated">在这里找到您之前创建的EBS环境<a class="ae hv" href="https://console.aws.amazon.com/elasticbeanstalk" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/elasticbeanstalk</a>(确保您在正确的区域)。</li><li id="2b63" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">在左侧栏中，选择<strong class="je hz">配置</strong>，然后在<strong class="je hz">软件</strong>类别中选择<strong class="je hz">编辑</strong>。</li><li id="8683" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">在<strong class="je hz">环境属性</strong>部分定义以下变量:<br/> <em class="lo">要找到所需的值，请导航到您之前创建的RDS集群(</em><a class="ae hv" href="https://console.aws.amazon.com/rds/home" rel="noopener ugc nofollow" target="_blank"><em class="lo">https://console.aws.amazon.com/rds/home</em></a><em class="lo">-&gt;选择</em> <strong class="je hz"> <em class="lo"> DB实例</em> </strong> <em class="lo"> - &gt;选择比您创建的读取器和编写器高一级的集群)</em></li></ol><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="35db" class="mb kb hy lx b fi mc md l me mf">RDS_HOSTNAME - On the <strong class="lx hz">Connectivity &amp; security</strong> tab, copy the "Writer" <strong class="lx hz">Endpoint</strong></span><span id="decd" class="mb kb hy lx b fi mg md l me mf">RDS_PORT - On the <strong class="lx hz">Connectivity &amp; security</strong> tab, copy the "Writer" <strong class="lx hz">Port</strong></span><span id="bfb8" class="mb kb hy lx b fi mg md l me mf">RDS_DB_NAME - On the <strong class="lx hz">Configuration</strong> tab, copy the <strong class="lx hz">DB Name</strong></span><span id="9ff3" class="mb kb hy lx b fi mg md l me mf">RDS_USERNAME - On the <strong class="lx hz">Configuration</strong> tab, copy the <strong class="lx hz">Master username</strong></span><span id="cd4f" class="mb kb hy lx b fi mg md l me mf">RDS_PASSWORD - Cannot be copied from the RDS Console. You made a note of this password when launching the database.</span><span id="80d6" class="mb kb hy lx b fi mg md l me mf">For the Salt Keys, I usually use a website like <a class="ae hv" href="https://api.wordpress.org/secret-key/1.1/salt/" rel="noopener ugc nofollow" target="_blank">https://api.wordpress.org/secret-key/1.1/salt/</a> to generate the following:</span><span id="7a2f" class="mb kb hy lx b fi mg md l me mf">AUTH_KEY<br/>SECURE_AUTH_KEY<br/>LOGGED_IN_KEY<br/>NONCE_KEY<br/>AUTH_SALT<br/>SECURE_AUTH_SALT<br/>LOGGED_IN_SALT<br/>NONCE_SALT</span></pre><h1 id="60fa" class="ka kb hy bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">在EBS上启动你的WordPress知识库</h1><p id="07cc" class="pw-post-body-paragraph jc jd hy je b jf la jh ji jj lb jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hb bi translated">你成功了！你终于准备好发布你的WordPress网站了！</p><p id="f080" class="pw-post-body-paragraph jc jd hy je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated"><em class="lo">先决条件— </em> <a class="ae hv" href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli3-install.html" rel="noopener ugc nofollow" target="_blank">如果您还没有安装EB CLI </a>。</p><ol class=""><li id="dcbb" class="ky kz hy je b jf jg jj jk jn mh jr mi jv mj jz lf lg lh li bi translated">从您在上面步骤中设置的本地存储库中，在终端中运行<strong class="je hz"> eb init </strong>。</li><li id="023e" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">在第一步“选择默认区域”中，选择您的EBS环境所在的区域。</li><li id="e2d2" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">在“选择要使用的应用程序”步骤中，选择您在上述步骤中创建的应用程序。</li><li id="aa8c" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">在“是否希望继续代码提交？”步骤，按回车键表示不</li><li id="00b8" class="ky kz hy je b jf lj jj lk jn ll jr lm jv ln jz lf lg lh li bi translated">运行<strong class="je hz"> eb部署</strong>。</li></ol><p id="0eae" class="pw-post-body-paragraph jc jd hy je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">就是这样！你做到了！</p></div></div>    
</body>
</html>