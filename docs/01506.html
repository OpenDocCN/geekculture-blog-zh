<html>
<head>
<title>Creating a Step Sequencer with Tone.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Tone.js创建步长音序器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/creating-a-step-sequencer-with-tone-js-32ea3002aaf5?source=collection_archive---------3-----------------------#2021-04-13">https://medium.com/geekculture/creating-a-step-sequencer-with-tone-js-32ea3002aaf5?source=collection_archive---------3-----------------------#2021-04-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a15d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步长音序器是一种电子装置，它将一个小节分成预定的子小节或“步长”。每一步都可以用来触发特定的声音和/或音符。正如Monica Dinculescu的精彩文章中所解释的，由于Javascript是单线程语言，因此很难在Javascript中实现一致且定时的事件。为了克服这一点，我使用了一个名为<a class="ae jd" href="https://tonejs.github.io/" rel="noopener ugc nofollow" target="_blank"> Tone.js </a>的免费网络音频框架作为我项目的基础。</p><p id="3ffd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当试图以编程方式生成音乐时，Tone大大简化了许多事情。虽然文档可能有点混乱，但我发现自己花了几个小时在页面之间点击，试图理解如何将所有部分组合在一起。我希望通过这篇文章(部分地)解决这个问题，并在将来帮助任何使用Tone的人。这并不是对Tone.js的全面解释，而是对我如何制作音序器的一个演示。</p><p id="f6d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">仅供参考:这篇文章假设读者对音乐理论有所了解</em></p><p id="87cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">我们的步进序列器设计流程如下:</strong></p><ol class=""><li id="a3e6" class="jf jg hi ih b ii ij im in iq jh iu ji iy jj jc jk jl jm jn bi translated"><a class="ae jd" href="#a437" rel="noopener ugc nofollow">制造发声所需的合成器。</a></li><li id="59d6" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc jk jl jm jn bi translated"><a class="ae jd" href="#dab6" rel="noopener ugc nofollow">在一个父数组中创建一个由多个子数组组成的网格。这将起到类似乐谱的作用，并告诉合成器何时播放一个音调。</a></li><li id="fdeb" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc jk jl jm jn bi translated"><a class="ae jd" href="#d7bc" rel="noopener ugc nofollow">编写一个循环函数，它将读取网格符号并相应地触发合成器。</a></li><li id="e37b" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc jk jl jm jn bi translated"><a class="ae jd" href="#a23e" rel="noopener ugc nofollow">在DOM中创建元素来可视化地表示一切，能够与网格交互来打开和关闭注释。</a></li></ol><h1 id="a437" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">设置合成器</h1><p id="3956" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">Tone.js提供的最简单直接的工具是<a class="ae jd" href="https://tonejs.github.io/examples/simpleSynth" rel="noopener ugc nofollow" target="_blank"> Synth </a>。合成器是单声道的，这意味着它一次只能演奏一个音符。为了克服这个问题，我们将为每个可用的音符创建一个Synth，并将它们存储在一个数组中。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="lb lc l"/></div></figure></div><div class="ab cl ld le gp lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hb hc hd he hf"><p id="fc00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">切向快速脏声初级读本:</em></p><p id="fc06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">任何乐器(模拟或数字)的音色(或单个音调质量)都由生成声音的<a class="ae jd" href="https://en.wikipedia.org/wiki/Waveform" rel="noopener ugc nofollow" target="_blank"> <em class="je">波形</em> </a>和<a class="ae jd" href="https://en.wikipedia.org/wiki/Envelope_(music)" rel="noopener ugc nofollow" target="_blank"> <em class="je">包络</em> </a> <em class="je"> </em>决定。波形指的是声波在<a class="ae jd" href="https://en.wikipedia.org/wiki/Oscilloscope" rel="noopener ugc nofollow" target="_blank">示波器</a>上的样子，而<a class="ae jd" href="https://en.wikipedia.org/wiki/Envelope_(music)" rel="noopener ugc nofollow" target="_blank">包络</a>指的是声音如何随时间变化。这种改变可以是音量、音高，甚至是声音本身的音色！</p><p id="2355" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Tone.js的合成器由一个通过<a class="ae jd" href="https://tonejs.github.io/docs/14.7.77/AmplitudeEnvelope.html" rel="noopener ugc nofollow" target="_blank">振幅发展</a>的<a class="ae jd" href="https://tonejs.github.io/docs/14.7.77/OmniOscillator" rel="noopener ugc nofollow" target="_blank">全振荡器</a>组成。如果你想了解更多，音调开发人员提供了许多例子，允许你玩不同的<a class="ae jd" href="https://tonejs.github.io/examples/oscillator" rel="noopener ugc nofollow" target="_blank">振荡器</a>和修补<a class="ae jd" href="https://tonejs.github.io/examples/simpleSynth" rel="noopener ugc nofollow" target="_blank">合成器</a>的包络设置。我绝不是声学专家，但音调库似乎提供了足够的灵活性来生成各种各样的乐器声音，这些声音可以很容易地合并到这个项目或任何其他项目中。</p><p id="d39a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果这些行话让你感到困惑和头疼，完全不用担心！Tone的标准Synth为我们的需求提供了足够多的功能，所以请随意忽略/跳过前面的两段，继续学习教程。</p></div><div class="ab cl ld le gp lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hb hc hd he hf"><h1 id="dab6" class="jt ju hi bd jv jw lk jy jz ka ll kc kd ke lm kg kh ki ln kk kl km lo ko kp kq bi translated">制作网格</h1><p id="2653" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">既然已经创建了synths，我们需要创建一个结构，作为一种符号。我决定使用嵌套数组，每个子数组对应于序列器上的一行，因此对应于一个合成器。</p><p id="21c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个子数组包含多个对象，这些对象具有一个<code class="du lp lq lr ls b">note</code>属性和一个<code class="du lp lq lr ls b">isActive</code>布尔值，用于存储用户是否选择了要播放的音符。</p><p id="406a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我发现将子数组视为垂直堆叠在父数组中很有帮助，纵轴对应于音高，横轴对应于时间。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es lt"><img src="../Images/b12c9ea57a804b8364fcf1bc24a4526c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*37G_Cs_lj-4pjvaD57EP0A.jpeg"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx">visualization of the grid data structure</figcaption></figure><p id="d8f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以及相应的代码:</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="lb lc l"/></div></figure><p id="4fb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我用F小调五声音阶作为我的音序器，因为这是一个初学者友好的音阶，所有的音符在一起演奏时听起来都很好。请随意更改这里的参数。正如您将在本教程的后面看到的，我们的DOM元素是使用网格作为参考以编程方式生成的，因此使用更多或更少的音符，或者更改您希望音序器表示的小节数都是非常快速和简单的！</p><h1 id="d7bc" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">创建我们的循环函数</h1><p id="94e3" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">好了，我们已经设置好了基本的网格，也设置好了合成器，但是我们如何将两者结合起来制作音乐呢？</p><p id="2721" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Tone.js的核心部分是<a class="ae jd" href="https://tonejs.github.io/docs/14.7.77/Transport" rel="noopener ugc nofollow" target="_blank">传输</a>，它允许你可靠地安排事件以及播放和暂停音频。我们将为我们的序列器使用<code class="du lp lq lr ls b">scheduleRepeat</code> <a class="ae jd" href="https://tonejs.github.io/docs/14.7.77/Transport#scheduleRepeat" rel="noopener ugc nofollow" target="_blank">方法</a>。<code class="du lp lq lr ls b">scheduleRepeat</code>以回调函数为道具，以及执行回调的时间间隔或细分。然后，每当传输正在播放时，它将重复执行回调。</p><p id="3894" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接通我们的回调函数<code class="du lp lq lr ls b">repeat()</code>。回调检查外部计数器，以了解它当前所处的步骤。然后，它遍历网格，检查当前步骤是否有任何音符被激活，如果有，就用正确的合成器安排一个事件，让音符发出声音。为了完成任务，计数器递增，这样我们可以在下次执行回调函数时在正确的位置引用网格。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="lb lc l"/></div></figure><h1 id="a23e" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">在大教堂里建造东西</h1><p id="23b7" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">既然我们已经为序列器编写了必要的逻辑，我们需要构建用户将与之交互的可视化组件。我们的序列器将存在于一个使用网格布局的父div中。按钮将以编程方式生成，并被传递给<code class="du lp lq lr ls b">onClick</code>函数，这些函数将改变我们的<code class="du lp lq lr ls b">grid</code>中相应的注释。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="lb lc l"/></div></figure><p id="2a4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的事件侦听器接收<code class="du lp lq lr ls b">rowIndex</code>和<code class="du lp lq lr ls b">noteIndex</code>，这样我们就可以在网格中找到相应的note对象并检查其状态。它还接收事件对象，以便我们可以更改按钮的样式。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="lb lc l"/></div></figure><h1 id="daef" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">最后的润色:制作播放按钮</h1><p id="f9ee" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">剩下的就是配置一个播放/暂停传输的按钮。在制作任何音乐之前，你必须调用<code class="du lp lq lr ls b">Tone.start()</code>，所以我在按钮的逻辑中添加了一个条件位，以便在用户第一次按下play时设置好一切。否则，您只需使用一个布尔值作为标志变量来切换传输的开始和停止。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="lb lc l"/></div></figure><h1 id="1599" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">看这个音序器</h1><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es me"><img src="../Images/e0aed505ecea49acf6378fcd59518290.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aaeh_BmpdF-RSZe_YlP5Gw.jpeg"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx">Photo by <a class="ae jd" href="https://unsplash.com/@rexcuando?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Eric Nopanen</a> on <a class="ae jd" href="https://unsplash.com/s/photos/music?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8b7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有一个JS提琴，所有部件组合成一个基本的步音序器。我希望这个演练对你有所帮助，并祝你在未来的编程(和音乐)工作中一切顺利！</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="mf lc l"/></div></figure></div><div class="ab cl ld le gp lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hb hc hd he hf"><p id="8493" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">参考资料、来源和进一步阅读:</em></p><pre class="kw kx ky kz fd mg ls mh mi aw mj bi"><span id="89fb" class="mk ju hi ls b fi ml mm l mn mo"><a class="ae jd" href="https://tonejs.github.io/" rel="noopener ugc nofollow" target="_blank">Documentation</a> for Tone.js</span><span id="173d" class="mk ju hi ls b fi mp mm l mn mo">Wikipedia page on <a class="ae jd" href="https://en.wikipedia.org/wiki/Synthesizer" rel="noopener ugc nofollow" target="_blank">Synthesizers</a></span><span id="b117" class="mk ju hi ls b fi mp mm l mn mo">"<a class="ae jd" href="https://youtube.com/playlist?list=PLTujTdKucISz9rx7gGqei3fAGrtA97uY0" rel="noopener ugc nofollow" target="_blank">Tone.js &amp; Codepen</a>" YouTube series made by Jake Albaugh</span><span id="93a5" class="mk ju hi ls b fi mp mm l mn mo">"<a class="ae jd" href="https://react.christmas/2020/15" rel="noopener ugc nofollow" target="_blank">Making sounds with React and Tone.js</a>" by Nicolai Fredriksen</span><span id="d954" class="mk ju hi ls b fi mp mm l mn mo">"<a class="ae jd" rel="noopener" href="/dev-red/tutorial-lets-make-music-with-javascript-and-tone-js-f6ac39d95b8c">Let’s Make Music with JavaScript and Tone.js</a>" by Jim Bennet</span></pre></div></div>    
</body>
</html>