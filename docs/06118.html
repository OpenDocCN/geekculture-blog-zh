<html>
<head>
<title>Serverless Applications with AWS Lambda, API Gateway, and DynamoDB deployed with Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Lambda、API Gateway和DynamoDB部署的无服务器应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/serverless-applications-with-aws-lambda-api-gateway-and-dynamodb-deployed-with-terraform-d7d38c9cf519?source=collection_archive---------7-----------------------#2021-08-06">https://medium.com/geekculture/serverless-applications-with-aws-lambda-api-gateway-and-dynamodb-deployed-with-terraform-d7d38c9cf519?source=collection_archive---------7-----------------------#2021-08-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7f1c12ad03cb12438f7f6e6255ca4fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0XwkEA8A4aBMuy1D.png"/></div></div></figure><p id="3add" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个场景中，我们将创建一个无服务器应用程序。我们将使用云服务，如AWS API Gateway、Lambda和DynamoDB，使用Terraform部署它们。</p><p id="a3ec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">lambda函数将对DynamoDB表具有读写权限。</p><p id="f9d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">无服务器计算是一种云计算模式，其中云提供商自动管理计算资源的供应和分配。这与用户负责直接管理虚拟服务器的传统云计算形成对比。</p><p id="b9d1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">需要几样东西:</p><ul class=""><li id="6c7d" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">一个AWS帐户，在IAM中设置一个用户，并将所有密钥等输入AWS CLI。</li><li id="1a8e" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><a class="ae kc" href="https://www.terraform.io/downloads.html" rel="noopener ugc nofollow" target="_blank">地形</a>安装完毕</li></ul><p id="ed66" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们从创建Lambda函数开始。我把这个文件命名为<strong class="is hj"> lambdademo.js </strong></p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="855b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">关于我们使用的表达方式的一点解释。<strong class="is hj"> await </strong>可以放在任何基于async(异步函数)<strong class="is hj"> promise </strong>的函数前面，以暂停该行代码，直到<strong class="is hj"> promise </strong>实现，然后返回结果值。当调用任何返回<strong class="is hj">承诺</strong>的函数时，可以使用<strong class="is hj"> await </strong>，包括web API函数。</p><p id="9883" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们用了Node。js，一个建立在Chrome的JavaScript运行时之上的平台，用于轻松构建快速和可扩展的网络应用。节点。js使用了一个<strong class="is hj">事件</strong> - <strong class="is hj">驱动</strong>、<strong class="is hj">非</strong> - <strong class="is hj">阻塞</strong>的I/O模型，这使得它变得轻量和高效。</p><p id="cb01" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们需要压缩文件，创建<strong class="is hj"> lambdademo.js </strong></p><p id="e4a4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个压缩文件将被上传到一个S3桶。</p><pre class="kd ke kf kg fd kj kk kl km aw kn bi"><span id="3511" class="ko kp hi kk b fi kq kr l ks kt">$ zip lambdademo.zip lambdademo.js</span></pre><p id="2a97" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们将创建一个文件<strong class="is hj"> assume_role_policy.json，</strong>，在这里我们将授权lambda代表我们访问其他AWS服务。该文件将包含以下JSON对象。</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="c1a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们将创建一个文件<strong class="is hj"> policy.json </strong>，在这里我们将定义lambda函数可以执行哪些操作以及在哪个资源上执行。它允许我们的lambda函数在名为<strong class="is hj"> myDB </strong>的DynamoDB表上执行上面定义的操作。</p><p id="5c45" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们创建我们的<strong class="is hj"> main.tf </strong>文件。这设置了我们的提供者、区域、DynamoDB表等，并展示了我们所有的资源。</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="81e1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们试驾一下吧。<code class="du ku kv kw kk b">terraform init</code></p><p id="95ea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后<code class="du ku kv kw kk b">terraform plan</code></p><p id="cf2a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行<code class="du ku kv kw kk b">terraform apply </code>命令后，CLI中将出现一个URL，如下所示</p><pre class="kd ke kf kg fd kj kk kl km aw kn bi"><span id="a793" class="ko kp hi kk b fi kq kr l ks kt"><a class="ae kc" href="https://brqhu55tr8.execute-api.us-east-1.amazonaws.com/Prod" rel="noopener ugc nofollow" target="_blank">https://brqhu55tr8.execute-api.us-east-1.amazonaws.com/Prod</a></span></pre><p id="6f57" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们尝试几个命令来测试我们的应用程序，比如写入DynamoDB表。我们将使用curl命令来连接。</p><pre class="kd ke kf kg fd kj kk kl km aw kn bi"><span id="9c2d" class="ko kp hi kk b fi kq kr l ks kt">$ curl -X POST -d '{"operation":"write","id":"1","name":"ram"}' https://brqhu55tr8.execute-api.us-east-1.amazonaws.com/Prod/myresource</span></pre><p id="0646" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">哪个应该返回<code class="du ku kv kw kk b">{"message": "Item entered successfully"}</code></p><p id="d30b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过运行以下命令执行读取操作:</p><pre class="kd ke kf kg fd kj kk kl km aw kn bi"><span id="dbff" class="ko kp hi kk b fi kq kr l ks kt">curl -X POST -d '{"operation":"read","id":"1"}' <a class="ae kc" href="https://brqhu55tr8.execute-api.us-east-1.amazonaws.com/Prod/myresource" rel="noopener ugc nofollow" target="_blank">https://brqhu55tr8.execute-api.us-east-1.amazonaws.com/Prod/myresource</a></span></pre><p id="9444" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后它应该返回<code class="du ku kv kw kk b">{"message":"{"Item":{"id":"1","name":"ram"}"}</code></p><p id="5a33" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">恭喜你！我们已经创建并部署了一个无服务器应用程序，它可以使用一个Lambda函数在DynamoDB上执行读写操作，该函数是通过API gateway调用来调用的。</p><p id="4af0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢您的阅读！</p></div></div>    
</body>
</html>