<html>
<head>
<title>Deploy API on Kubernetes for Free</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">免费在Kubernetes上部署API</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/deploy-api-on-kubernetes-for-free-ffe6889aad9d?source=collection_archive---------17-----------------------#2021-05-06">https://medium.com/geekculture/deploy-api-on-kubernetes-for-free-ffe6889aad9d?source=collection_archive---------17-----------------------#2021-05-06</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><div class=""><h2 id="846b" class="pw-subtitle-paragraph ig hi hj bd b ih ii ij ik il im in io ip iq ir is it iu iv iw ix dy translated">在Kubernetes集群上创建节点后端的5分钟指南</h2></div><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et iy"><img src="../Images/28382e0c74c697855bf906a4f13080ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XXRl7UYqqnMPt-SAswh1hg.jpeg"/></div></div><figcaption class="jk jl eu es et jm jn bd b be z dy">Photo by <a class="ae jo" href="https://unsplash.com/@karim_manjra?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Karim MANJRA</a> on <a class="ae jo" href="https://unsplash.com/s/photos/signs-free?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6bed" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">Kubernetes获得了极大的欢迎，并成为事实上的容器编排工具，因为它提供了负载平衡、自动伸缩、自动重新部署、健康检查，最重要的是，它与供应商无关。</p><p id="7090" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">它使微服务商店能够运行零停机应用程序，并成为开发人员的一项关键技能。尽管如此，Kubernetes的学习曲线是陡峭的，这不仅是因为庞大的生态系统和复杂的架构，也是因为提供基础设施的高额资金成本。Minikube 有助于模拟Kubernetes在本地机器上的工作方式。如果您想在一个真正的多节点集群上进行试验，这是最好的开发方式，但并不理想。<a class="ae jo" href="https://kubesail.com/" rel="noopener ugc nofollow" target="_blank"> Kubesail </a>是另一个在自有硬件上配置Kubernetes集群的优秀工具。它非常适合拥有现有裸机或Raspberry Pi等物联网设备的开发人员。</p><p id="a49f" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">假设您想在零成本的真实集群上进行实验和学习。是啊！它是免费的。这个教程绝对适合你。</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="kl km l"/></div></figure><p id="d52c" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">你在开玩笑吗？让我们通过与我一起参加一个简短但令人兴奋的研讨会来寻找答案。</p><p id="ce6b" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">长话短说。我们将在3分钟内创建一个托管在Kubernetes集群上的可访问互联网的端点。</p></div><div class="ab cl kn ko gq kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hc hd he hf hg"><h1 id="2637" class="ku kv hj bd kw kx ky kz la lb lc ld le ip lf iq lg is lh it li iv lj iw lk ll bi translated">目录</h1><p id="3731" class="pw-post-body-paragraph jp jq hj jr b js lm ik ju jv ln in jx jy lo ka kb kc lp ke kf kg lq ki kj kk hc bi translated">第1节:创建一个API服务器</p><p id="fa74" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">第2部分:Kubernetes配置</p><p id="a915" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">第3节:部署到Kubernetes集群</p><p id="0362" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">第4部分:扩展pod</p></div><div class="ab cl kn ko gq kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hc hd he hf hg"><h1 id="077a" class="ku kv hj bd kw kx ky kz la lb lc ld le ip lf iq lg is lh it li iv lj iw lk ll bi translated">第1节:创建一个API服务器</h1><p id="4b25" class="pw-post-body-paragraph jp jq hj jr b js lm ik ju jv ln in jx jy lo ka kb kc lp ke kf kg lq ki kj kk hc bi translated">本节将创建一个简单的节点应用程序，dockerise it，并将Docker映像上传到<a class="ae jo" href="https://cloud.okteto.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jr hk"> Okteto </strong> </a>注册表，这就是我们今天所依赖的PAAS魔术。</p><h2 id="4f12" class="lr kv hj bd kw ls lt lu la lv lw lx le jy ly lz lg kc ma mb li kg mc md lk me bi translated">启动项目</h2><p id="b504" class="pw-post-body-paragraph jp jq hj jr b js lm ik ju jv ln in jx jy lo ka kb kc lp ke kf kg lq ki kj kk hc bi translated">在Github上创建一个存储库，并将其保存到您的本地机器上。</p><p id="097b" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">启动项目以生成<code class="dv mf mg mh mi b">package.json</code>。</p><pre class="iz ja jb jc fe mj mi mk ml aw mm bi"><span id="2947" class="lr kv hj mi b fj mn mo l mp mq">yarn init -y</span></pre><p id="aa98" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated"><code class="dv mf mg mh mi b">express</code>是这个项目中唯一的依赖。让我们安装它。</p><pre class="iz ja jb jc fe mj mi mk ml aw mm bi"><span id="5207" class="lr kv hj mi b fj mn mo l mp mq">yarn add express</span></pre><p id="80c7" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">该应用程序的重点是以CSV格式公开技能数据作为GET端点。所以我们将跳过生产需求，比如错误处理、安全性和节流。</p><h2 id="6d8b" class="lr kv hj bd kw ls lt lu la lv lw lx le jy ly lz lg kc ma mb li kg mc md lk me bi translated">1)创建节点应用程序</h2><p id="5e75" class="pw-post-body-paragraph jp jq hj jr b js lm ik ju jv ln in jx jy lo ka kb kc lp ke kf kg lq ki kj kk hc bi translated">创建一个简单的节点应用程序，在端口<code class="dv mf mg mh mi b">3001</code>上公开一个端点<code class="dv mf mg mh mi b">/skills</code>。如果前端应用程序使用API响应，我们通过添加三个Access-Control-Allow*头来允许CORS，以使浏览器满意。</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="mr km l"/></div></figure><p id="f900" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">端点读取文件<code class="dv mf mg mh mi b">skills.csv</code>，并将内容写入HTTP响应。</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="mr km l"/></div></figure><p id="6db9" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">使用<code class="dv mf mg mh mi b">node app.js</code>在本地运行，并在<code class="dv mf mg mh mi b">http://localhost:3001/skills</code>上查看结果。</p><h2 id="f113" class="lr kv hj bd kw ls lt lu la lv lw lx le jy ly lz lg kc ma mb li kg mc md lk me bi translated">2)docker ice应用程序</h2><p id="bb4b" class="pw-post-body-paragraph jp jq hj jr b js lm ik ju jv ln in jx jy lo ka kb kc lp ke kf kg lq ki kj kk hc bi translated">创建一个<code class="dv mf mg mh mi b">Dockerfile</code>并在容器上暴露端口<code class="dv mf mg mh mi b">3001</code>。</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="mr km l"/></div></figure><p id="fcd8" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">接下来，我们要建立一个图像。<strong class="jr hk">注意图像名称必须以</strong> <code class="dv mf mg mh mi b"><strong class="jr hk">okteto.dev/</strong></code> <strong class="jr hk">开头，然后是项目名称</strong>，因为<code class="dv mf mg mh mi b">Okteto</code>会将图像上传到它自己的Docker图像库。酷！我们甚至不需要自己上传到Docker注册表。</p><pre class="iz ja jb jc fe mj mi mk ml aw mm bi"><span id="0dee" class="lr kv hj mi b fj mn mo l mp mq">docker build -t okteto.dev/tutorial-node-api-k8s .</span></pre><p id="dd8c" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">运行容器，并使其在本地机器的端口8001上可访问。</p><pre class="iz ja jb jc fe mj mi mk ml aw mm bi"><span id="6121" class="lr kv hj mi b fj mn mo l mp mq">docker run -d -p 8001:3001 okteto.dev/tutorial-node-api-k8s</span></pre><p id="07d4" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">API驻留在<code class="dv mf mg mh mi b"><a class="ae jo" href="http://localhost:8001/skills." rel="noopener ugc nofollow" target="_blank">http://localhost:8001/skills</a></code> <a class="ae jo" href="http://localhost:8001/skills." rel="noopener ugc nofollow" target="_blank">上。</a>🔥</p><p id="e330" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated"><a class="ae jo" href="https://github.com/ng-the-engineer/tutorial-node-api-k8s/tree/step_01" rel="noopener ugc nofollow" target="_blank">第一节源代码</a>👈</p></div><div class="ab cl kn ko gq kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hc hd he hf hg"><h1 id="fcc1" class="ku kv hj bd kw kx ky kz la lb lc ld le ip lf iq lg is lh it li iv lj iw lk ll bi translated">第2部分:Kubernetes配置</h1><p id="44b4" class="pw-post-body-paragraph jp jq hj jr b js lm ik ju jv ln in jx jy lo ka kb kc lp ke kf kg lq ki kj kk hc bi translated">将容器引入集群涉及两种配置。一个<code class="dv mf mg mh mi b">k8s/deployment.yaml</code>决定了如何创建一个<code class="dv mf mg mh mi b">pod</code>。在我们的例子中，我们告诉Kubernetes容器图像在<code class="dv mf mg mh mi b">okteto.dev/tutorial-node-api-k8s</code>的位置和<code class="dv mf mg mh mi b">replicas</code>计数。</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="mr km l"/></div></figure><p id="5404" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">A <code class="dv mf mg mh mi b">k8s/service.yaml</code>定义了pod通信的方式。<strong class="jr hk">我们需要注意第7行的</strong> <code class="dv mf mg mh mi b"><strong class="jr hk">annotations</strong></code> <strong class="jr hk">中的一个Okteto特定属性</strong> <code class="dv mf mg mh mi b"><strong class="jr hk">dev.okteto.com/auto-ingress</strong></code> <strong class="jr hk">被配置为</strong> <code class="dv mf mg mh mi b"><strong class="jr hk">true</strong></code>，所以<code class="dv mf mg mh mi b">ingress</code>会自动公开一个服务端点。💪</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="mr km l"/></div></figure><p id="3023" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">够简单吗？</p><p id="3959" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">像许多CI/CD工具一样，Okteto需要一个管道来详细描述发布应用程序的步骤。我们将在项目根中创建一个<code class="dv mf mg mh mi b">okteto-pipeline.yaml</code>来构建映像并执行<code class="dv mf mg mh mi b">kubectl apply</code>命令。</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="mr km l"/></div></figure><p id="f699" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">现在我们已经有了最低限度的配置。让我们用<code class="dv mf mg mh mi b">git commit</code>和<code class="dv mf mg mh mi b">git push</code>来远程Github仓库。</p><p id="4215" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated"><a class="ae jo" href="https://github.com/ng-the-engineer/tutorial-node-api-k8s/tree/step_02" rel="noopener ugc nofollow" target="_blank">第二节源代码</a>👈</p><h1 id="17f5" class="ku kv hj bd kw kx ms kz la lb mt ld le ip mu iq lg is mv it li iv mw iw lk ll bi translated">第3节:部署到Kubernetes集群</h1><p id="ff87" class="pw-post-body-paragraph jp jq hj jr b js lm ik ju jv ln in jx jy lo ka kb kc lp ke kf kg lq ki kj kk hc bi translated">用你的Github帐户注册<a class="ae jo" href="https://okteto.com/" rel="noopener ugc nofollow" target="_blank"> Okteto </a>。</p><p id="3ebd" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">Okteto将使用您的Github帐户名创建默认名称空间。</p><p id="42dd" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">导航至左上角菜单上的<code class="dv mf mg mh mi b">Deploy</code>。</p><figure class="iz ja jb jc fe jd es et paragraph-image"><div class="es et mx"><img src="../Images/0bef5281c999dd15a4b42837b80a99a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*vV5wRzpjLXoURuZ-NBRWfw.png"/></div></figure><p id="881d" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">指定项目和分支的URL。点击<code class="dv mf mg mh mi b">Deploy</code>按钮。</p><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et my"><img src="../Images/c57d6bc6e31afede94a9529bbb0fe2ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yIux-Bwif-__EkmzTbANcg.png"/></div></div></figure><p id="6747" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">Okteto正在部署pod和服务，它将在一分钟内创建一个服务端点。</p><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et mz"><img src="../Images/4354208e93f5c266e168a63be3bfbf3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1nUFtq-O2nYvgyZOOyI_Mw.png"/></div></div></figure><p id="d9a1" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">让我们前往<a class="ae jo" href="https://tutorial-node-api-k8s-ng-the-engineer.cloud.okteto.net/skills" rel="noopener ugc nofollow" target="_blank">https://tutorial-node-API-k8s-ng-the-engineer . cloud . ok teto . net/skills</a>。👈</p><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et na"><img src="../Images/80c2e29d0337e5d482600a44d1fc2de9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4nR8JdnouYgg3Qqd9LPgQg.png"/></div></div></figure><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="nb km l"/></div></figure></div><div class="ab cl kn ko gq kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hc hd he hf hg"><h1 id="38c2" class="ku kv hj bd kw kx ky kz la lb lc ld le ip lf iq lg is lh it li iv lj iw lk ll bi translated">第4部分:扩展pod</h1><p id="5467" class="pw-post-body-paragraph jp jq hj jr b js lm ik ju jv ln in jx jy lo ka kb kc lp ke kf kg lq ki kj kk hc bi translated">为了体验一下CI/CD，把<code class="dv mf mg mh mi b">replicas</code>更新到2。提交并推动变革。</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="mr km l"/></div></figure><p id="e6a4" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">点击Okteto仪表盘上的<code class="dv mf mg mh mi b">redeploy</code>。它将在一分钟内创建一个新的pod。</p><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et nc"><img src="../Images/de225382367a5024139aece29c68711b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UrD7y4ArYfWRNfrLVyawyw.png"/></div></div></figure><p id="7ffd" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">两个舱已经启动并运行了！</p><p id="44dd" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">查看<a class="ae jo" href="https://github.com/ng-the-engineer/tutorial-node-api-k8s" rel="noopener ugc nofollow" target="_blank">完整的源代码</a>👈</p></div><div class="ab cl kn ko gq kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hc hd he hf hg"><p id="459c" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">恭喜你！🙌您已经在Kubernetes上部署了一个简单的后端，并且在5分钟内没有刷信用卡。</p><p id="3457" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">让我们回顾一下我们在研讨会中学到的东西。</p><ol class=""><li id="f201" class="nd ne hj jr b js jt jv jw jy nf kc ng kg nh kk ni nj nk nl bi translated">构建了一个节点后端。</li><li id="6d5c" class="nd ne hj jr b js nm jv nn jy no kc np kg nq kk ni nj nk nl bi translated">对接节点应用程序。</li><li id="27d4" class="nd ne hj jr b js nm jv nn jy no kc np kg nq kk ni nj nk nl bi translated">定义Kubernetes配置。</li><li id="dbc4" class="nd ne hj jr b js nm jv nn jy no kc np kg nq kk ni nj nk nl bi translated">使用<a class="ae jo" href="https://okteto.com/" rel="noopener ugc nofollow" target="_blank"> Okteto </a>管道在Kubernetes集群上推出应用。</li><li id="c90c" class="nd ne hj jr b js nm jv nn jy no kc np kg nq kk ni nj nk nl bi translated">纵向扩展集群。</li></ol></div><div class="ab cl kn ko gq kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hc hd he hf hg"><p id="9032" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">感谢您阅读❤️！</p><p id="3190" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">请给我鼓掌👏如果你喜欢这个想法，请分享。</p><p id="9159" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">如果您有任何想法，请随时在hi@valubees.co.uk与我们交流。</p><p id="1214" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">声明:本文与Okteto无关。</p></div></div>    
</body>
</html>