<html>
<head>
<title>Notifications in Android — PART 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android中的通知—第2部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/notifications-in-android-part-2-d37102e7e29a?source=collection_archive---------6-----------------------#2021-05-30">https://medium.com/geekculture/notifications-in-android-part-2-d37102e7e29a?source=collection_archive---------6-----------------------#2021-05-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="498c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通知对于引起用户注意很重要。在本文的第一部分，我们讨论了通知，为什么我们需要它们，如何创建通知，如何触发它们，以及它们在设备上的外观。</p><p id="0d0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以从这里访问第1部分:</p><div class="jd je ez fb jf jg"><a rel="noopener follow" target="_blank" href="/geekculture/notifications-in-android-6b2d195d35b1"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hj fi z dy jl ea eb jm ed ef hh bi translated">Android中的通知</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">通知是我们在应用程序外部向用户显示的显示消息。它有助于提醒基于时间的事情或…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">medium.com</p></div></div><div class="jp l"><div class="jq l jr js jt jp ju jv jg"/></div></div></a></div><p id="098d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将了解:</p><ul class=""><li id="9068" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated">分组通知</li><li id="1eb2" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">有时限的通知</li><li id="9779" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">通知中按钮的用户操作</li><li id="a0c9" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">添加直接回复操作</li><li id="688c" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">在应用程序中检索用户输入数据</li></ul><h1 id="e990" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">分组通知</h1><p id="9b34" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">我们用一个例子来理解这个。在你的WhatsApp里，有一天你被加入了一个新的家庭群。现在，当你的所有家庭成员都在分享他们正在做的事情、家庭聚会或双关语的照片时。你的手机被成百上千的通知轰炸，这很烦人。</p><p id="7c83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了在Android 7中救你一命，我们更新了<strong class="ih hj">分组通知</strong>。其中我们可以将冗余通知组合成一个通知，当您展开它时，可以看到每个通知。</p><figure class="lo lp lq lr fd ls er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es ln"><img src="../Images/785cf887969009a450cea7b71018095e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vkvUIeZ5z7oK1BGP.png"/></div></div></figure><h1 id="adee" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">创建一组通知</strong></h1><ul class=""><li id="c5d1" class="jw jx hi ih b ii li im lj iq ly iu lz iy ma jc kb kc kd ke bi translated"><code class="du mb mc md me b">setGroup<br/></code>要创建一个通知组，为该组创建一个唯一的键，然后只需为该组中的每个通知调用<code class="du mb mc md me b">setGroup</code>。</li></ul><pre class="lo lp lq lr fd mf me mg mh aw mi bi"><span id="70fd" class="mj kl hi me b fi mk ml l mm mn">NotificationCompat.Builder builder = new NotificationCompat.Builder(context, CHANNEL_ID)<br/>        .setNumber(notificationId)<br/>        .setSmallIcon(smallIcon)<br/>        .setContentTitle(title)<br/>        .setContentIntent(contentIntent)<br/>        .setContentText(msg)<br/>        .setGroup("group");</span></pre><ul class=""><li id="a72a" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated"><code class="du mb mc md me b">setSortKey()<br/></code>默认情况下，通知按照发布的时间排序，但是您可以通过调用<code class="du mb mc md me b">setSortKey().</code>来更改顺序</li><li id="3625" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated"><code class="du mb mc md me b">setGroupAlertBehavior()<br/></code>该方法设置通知的群组提醒行为。如果此通知组的警报应由不同的通知处理，请使用此方法将通知静音。当然，这适用于组通知的情况，否则，每一个通知都会发送一个警告来引起用户的注意。<br/>报警行为有3种类型:<br/> 1。GROUP_ALERT_ALL <br/> 2。GROUP_ALERT_SUMMARY <br/> 3组_警报_儿童</li></ul><figure class="lo lp lq lr fd ls er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mo"><img src="../Images/dace89aeb24177dc559707361831c0c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*asTwcK8UL2XmEYXljt9TfQ.png"/></div></div></figure><ul class=""><li id="fbca" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated"><code class="du mb mc md me b">setGroupSummary</code> <br/>如前所述，群组通知出现在android 7中。为了支持旧版本，我们需要创建一个额外的通知作为摘要。</li></ul><p id="ebb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查下面的完整代码:</p><figure class="lo lp lq lr fd ls"><div class="bz dy l di"><div class="mp mq l"/></div></figure><h1 id="aa1f" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">有时限的通知</h1><p id="0b49" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">在某些情况下，当你的应用程序在后台时，你的应用程序可能需要用户立即关注，就像打电话或报警一样。为了提供这种行为，我们需要做一些设置。</p><p id="e34d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们以HealthifyMe App中的视频通话服务为例。当教练想和用户通话时，我们会发送视频通话通知</p><figure class="lo lp lq lr fd ls er es paragraph-image"><div class="er es mr"><img src="../Images/fead942baf8f89cf4f6f5d93f3dcdae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*g4L7zycfNGjviqHy6tZwJQ.png"/></div></figure><p id="b285" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一步:创建通知渠道</strong></p><figure class="lo lp lq lr fd ls"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="46dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将通知重要性设置为<strong class="ih hj">高。</strong>而且锁屏可见性也是公开的，所以不管你的应用是在后台还是你的设备被锁定，用户都会优先收到这个通知。</p><p id="7d82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第二步:启动铃声并检查振动<br/> </strong>现在在视频通话情况下我们想要手机的铃声和振动，这是根据您的需要可选的。</p><figure class="lo lp lq lr fd ls"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="0de5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这也是可选的，有时你不想让你的通知全屏显示。在我们的例子中，我们正在进行视频通话，所以我们希望全屏显示。</p><figure class="lo lp lq lr fd ls"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="4976" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第四步:向用户显示通知<br/> </strong>当向用户显示通知时，他们可以选择确认或取消应用程序的警告或提醒。例如，用户可以选择是接受还是拒绝来电。</p><p id="f044" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您的通知是一个正在进行的通知，例如一个来电，将通知与一个<a class="ae ms" href="https://developer.android.com/guide/components/services#Foreground" rel="noopener ugc nofollow" target="_blank">前台服务</a>相关联。以下代码片段显示了如何显示与前台服务关联的通知:</p><pre class="lo lp lq lr fd mf me mg mh aw mi bi"><span id="a35f" class="mj kl hi me b fi mk ml l mm mn">startForeground(<em class="mt">NOTIFICATION_ID_INCOMING_CALL</em>, notification)</span></pre><h1 id="3acb" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">通知中按钮的用户操作</h1><p id="6f7c" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">让我们举同样的例子，在全屏通知中，我们有两个按钮，一个接受呼叫，另一个拒绝呼叫。</p><p id="86f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤1: </strong>创建拒绝呼叫事件的待定意向。您正在发送动作为<code class="du mb mc md me b">ACTION_DECLINE_CALL</code>的广播。</p><pre class="lo lp lq lr fd mf me mg mh aw mi bi"><span id="743e" class="mj kl hi me b fi mk ml l mm mn">val declineCall = Intent().<em class="mt">apply </em><strong class="me hj">{<br/>    </strong><em class="mt">action </em>= ACTION_DECLINE_CALL<br/><strong class="me hj">}<br/></strong>val declineCallIntent: PendingIntent =<br/>    PendingIntent.getBroadcast(this, 0, declineCall, PendingIntent.<em class="mt">FLAG_UPDATE_CURRENT</em>)</span></pre><p id="3601" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤2:为接受呼叫创建待定意向</strong></p><pre class="lo lp lq lr fd mf me mg mh aw mi bi"><span id="fa87" class="mj kl hi me b fi mk ml l mm mn">val acceptCall = Intent().<em class="mt">apply </em><strong class="me hj">{<br/>    </strong><em class="mt">action </em>= ACTION_ACCEPT_CALL<br/><strong class="me hj">}<br/></strong>val acceptCallIntent: PendingIntent =<br/>    PendingIntent.getBroadcast(this, 0, acceptCall, PendingIntent.<em class="mt">FLAG_UPDATE_CURRENT</em>)</span></pre><p id="5bf4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤3: </strong>使用<code class="du mb mc md me b">addAction()</code>创建通知时，将这些添加为操作</p><figure class="lo lp lq lr fd ls"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="462c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤4: </strong>处理广播接收器<br/>我们在这里使用广播，所以事情将在后台运行，主线程上没有任何东西受到干扰。</p><p id="eda1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有关构建一个<code class="du mb mc md me b"><a class="ae ms" href="https://developer.android.com/reference/android/content/BroadcastReceiver" rel="noopener ugc nofollow" target="_blank">BroadcastReceiver</a></code>来运行后台工作的更多信息，请参见<a class="ae ms" href="https://developer.android.com/guide/components/broadcasts" rel="noopener ugc nofollow" target="_blank">广播指南</a>。</p><figure class="lo lp lq lr fd ls"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="69b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">停止您运行以显示通知的前台服务。</p><h1 id="2b72" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">添加直接回复操作</h1><div class="lo lp lq lr fd ab cb"><figure class="mu ls mv mw mx my mz paragraph-image"><img src="../Images/fbdda61468c3536045c856afe2830769.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*mh-Ze3LeW2FHlf6SdIZh1Q.jpeg"/></figure><figure class="mu ls na mw mx my mz paragraph-image"><img src="../Images/4592455776b60fc6d25249e61a5f0b04.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*tzzkdZjvih2UlmLh1-wPAg.jpeg"/></figure></div><p id="20fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">添加回复按钮</strong></p><p id="4fd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤1: </strong>创建远程构建器的实例。</p><pre class="lo lp lq lr fd mf me mg mh aw mi bi"><span id="ece9" class="mj kl hi me b fi mk ml l mm mn">private RemoteInput getReplyRemoteInput(Context context) {<br/>    <em class="mt">// Key for the string that's delivered in the action's intent.<br/>    </em>String replyLabel = context.getResources().getString(R.string.<em class="mt">type_message</em>);<br/>    return new RemoteInput.Builder(<em class="mt">KEY_TEXT_REPLY</em>)<br/>            .setLabel(replyLabel)<br/>            .build();<br/>}</span></pre><p id="8d72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第2步:</strong>创建一个待定意向回复按钮。</p><pre class="lo lp lq lr fd mf me mg mh aw mi bi"><span id="33fe" class="mj kl hi me b fi mk ml l mm mn">private PendingIntent getReplyPendingIntent(Context context, Group group) {<br/>    Intent intent = new Intent(context, FirebaseSyncService.class);<br/>    intent.putExtra(FirebaseSyncService.<em class="mt">ARG_GROUP</em>, group);<br/>    return PendingIntent.<em class="mt">getService</em>(context,<br/>            FirebaseSyncService.<em class="mt">REQUEST_CODE_NOTIFICATION_DIRECT_REPLY</em>,<br/>            intent, PendingIntent.<em class="mt">FLAG_UPDATE_CURRENT</em>);<br/>}</span></pre><p id="9d0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第三步:</strong>使用<code class="du mb mc md me b">addRemoteInput()</code>将<code class="du mb mc md me b">RemoteInput</code>对象附加到一个动作上。</p><pre class="lo lp lq lr fd mf me mg mh aw mi bi"><span id="7803" class="mj kl hi me b fi mk ml l mm mn">private NotificationCompat.Action getReplyAction(Context context, Group group) {<br/>    <em class="mt">// Create the reply action and add the remote input.<br/>    </em>return new NotificationCompat.Action.Builder(R.drawable.<em class="mt">ic_send_white</em>,<br/>            context.getString(R.string.<em class="mt">reply_label</em>), getReplyPendingIntent(context, group))<br/>            .addRemoteInput(getReplyRemoteInput(context))<br/>            .build();<br/>}</span></pre><p id="5435" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤4: </strong>将此操作应用于通知</p><figure class="lo lp lq lr fd ls"><div class="bz dy l di"><div class="mp mq l"/></div></figure><h1 id="7d7e" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">从回复中检索用户信息</strong></h1><p id="6fd1" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated"><strong class="ih hj">第一步</strong>:调用<code class="du mb mc md me b">RemoteInput.getResultsFromIntent()</code></p><pre class="lo lp lq lr fd mf me mg mh aw mi bi"><span id="f9ba" class="mj kl hi me b fi mk ml l mm mn">private CharSequence getMessageText(Intent intent) {<br/>    if (intent == null)<br/>        return null;<br/><br/>    Bundle remoteInput = RemoteInput.<em class="mt">getResultsFromIntent</em>(intent);<br/>    if (remoteInput != null) {<br/>        return remoteInput.getCharSequence(<em class="mt">KEY_TEXT_REPLY</em>);<br/>    }<br/>    return null;<br/>}</span></pre><p id="4339" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤2 </strong>:处理完文本后，您必须通过使用相同的ID和标签(如果使用的话)调用<code class="du mb mc md me b">NotificationManagerCompat.notify()</code>来更新通知。这对于隐藏直接回复用户界面并向用户确认他们的回复已被正确接收和处理是必要的。</p><pre class="lo lp lq lr fd mf me mg mh aw mi bi"><span id="dd2f" class="mj kl hi me b fi mk ml l mm mn">// Build a new notification, which informs the user that the system<br/>// handled their interaction with the previous notification.<br/>val repliedNotification = Notification.Builder(context, CHANNEL_ID)<br/>        .setSmallIcon(R.drawable.ic_message)<br/>        .setContentText(getString(R.string.replied))<br/>        .build()<br/><br/>// Issue the new notification.<br/>NotificationManagerCompat.from(this).apply {<br/>    notificationManager.notify(notificationId, repliedNotification)<br/>}</span></pre><h1 id="b752" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">结论</h1><p id="880a" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">通知是把双刃剑。它们可以促进参与，但也可能导致用户烦恼。因此，正确理解对你的整体体验很重要。让我知道你对我们什么时候应该和不应该使用它们，以及它们如何改善用户体验的想法。</p><h1 id="033c" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">资源</h1><p id="bca5" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated"><a class="ae ms" href="https://developer.android.com/guide/topics/ui/notifiers/notifications" rel="noopener ugc nofollow" target="_blank">https://developer . Android . com/guide/topics/ui/notifiers/notifications</a></p></div><div class="ab cl nb nc gp nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="hb hc hd he hf"><p id="521b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您有任何反馈，请在<em class="mt">karishma.agr1996@gmail.com给我回信。非常感谢你的鼓掌帮助其他人找到这篇文章😃。</em></p><figure class="lo lp lq lr fd ls er es paragraph-image"><div class="er es ni"><img src="../Images/abf4bb52db56763ae33a36b38056f36f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*Rxa1m0jKn5-8lNKu.gif"/></div></figure></div></div>    
</body>
</html>