<html>
<head>
<title>10 Lessons Learned from Building Engine Yard’s Container Platform on Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kubernetes上建造Engine Yard集装箱平台的10个经验教训</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/10-lessons-learned-from-uilding-engine-yards-container-platform-on-kubernetes-e60cd8cc4440?source=collection_archive---------15-----------------------#2021-05-02">https://medium.com/geekculture/10-lessons-learned-from-uilding-engine-yards-container-platform-on-kubernetes-e60cd8cc4440?source=collection_archive---------15-----------------------#2021-05-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="09d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kubernetes上的容器是在云中部署、管理和扩展应用程序的现代方式。在Engine Yard，我们一直在开发一些产品，让开发人员可以轻松地在云中部署应用程序，而无需开发云专业知识——换句话说，我们一直在帮助开发人员专注于他们的应用程序；而不是围绕部署、管理和扩展的管道。2021年初，我们在Engine Yard上发布了容器支持(称为Engine Yard Kontainers，简称EYK)。我们花了一年多的时间来设计和构建这个产品。很乐意分享我们在这个过程中学到的经验。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/8acd93507df878813c2e1baa3c99bff0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*APqs2h0Ta6qvCDFXpvr-0Q@2x.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Kubernetes lessons learned while building Engine Yard’s container platform</figcaption></figure><p id="fe5d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Kubernetes就是要走的路:</strong></p><blockquote class="jt ju jv"><p id="88e4" class="if ig jw ih b ii ij ik il im in io ip jx ir is it jy iv iw ix jz iz ja jb jc hb bi translated">Kubernetes(也称为K8s)是现代应用程序部署中最棒的东西，尤其是在云上。这是毫无疑问的。</p></blockquote><p id="0bcd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">部署Kubernetes的一些好处包括提高工程生产率、更快地交付应用程序和可扩展的基础设施。以前每年部署1-2个版本的团队可以使用Kubernetes每月部署多次！想想“敏捷性”和更快的上市时间。</p><p id="8167" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">库伯内特很复杂:</strong></p><p id="40ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好的。那是保守的说法。Kubernetes非常复杂。这里有一个视觉类比，来说明在期望和现实中的感觉。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b81226d476c721cecd5bdaef1bcc47eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jZ4CiMi7Qn3Cb9I4.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/f9bf66812b96e287cfb0e27e36e8922a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uifTy3XhsOMw1Q0q.png"/></div></div></figure><ul class=""><li id="28c8" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc kf kg kh ki bi translated">开箱即用的Kubernetes对任何人来说都是远远不够的。指标、日志、服务发现、分布式跟踪、配置和自动扩展都是您的团队需要关注的事情。</li><li id="293b" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">对于您的团队来说，Kubernetes有一个陡峭的学习曲线。</li><li id="b8cd" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">在Kubernetes建立关系网很难。</li><li id="dfac" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">操作和调优Kubernetes集群占用了您的团队大量开发时间。</li></ul><p id="4035" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">鉴于Kubernetes的巨大优势和所涉及的复杂性，选择托管的Kubernetes服务几乎总是有益的。请记住——并非所有的托管Kubernetes服务都是平等的——我们稍后会谈到这一点。尽管如此，不管你选择Kubernetes服务，我们在下面学到的这些经验都是有用的。</p><p id="bd31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是10课的清单:</p><ol class=""><li id="4a99" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc ko kg kh ki bi translated">了解Kubernetes的最新发布</li><li id="d00d" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">设置资源限制</li><li id="a5e7" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">注意吊舱开始时间</li><li id="f5f2" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">仅有AWS负载平衡器是不够的</li><li id="f1fc" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">设置自己的日志记录</li><li id="f8b9" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">设置您自己的监控</li><li id="12bd" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">正确地调整大小和比例</li><li id="85e8" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">并非所有受管理的库伯内特人都是平等的</li><li id="a920" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">设置工作流以轻松部署和管理应用程序</li><li id="3923" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">集装箱化没有你想象的那么难</li></ol><h2 id="65da" class="kp kq hi bd kr ks kt ku kv kw kx ky kz iq la lb lc iu ld le lf iy lg lh li lj bi translated">#1了解Kubernetes的最新发布</h2><p id="11e7" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">Kubernetes发展迅速，发布迅速。确保你有一个计划来跟上Kubernetes的发布。这将非常耗时，可能会偶尔停机，但请做好升级Kubernetes集群的准备。</p><p id="2174" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只要您不更改应用程序的容器映像，Kubernetes版本本身可能不会对您的应用程序进行大的更改，但是当您升级Kubernetes时，集群配置和应用程序管理可能需要更改。</p><p id="3067" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于Engine Yard，我们做了以下几件事:</p><ul class=""><li id="c379" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc kf kg kh ki bi translated">针对集群升级和更新进行规划，无需更改应用程序代码，应用程序停机时间最短</li><li id="5ad5" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">创建了一个测试计划，每次集群升级或更新时我们都会执行该计划，以确保我们解决了集群管理的所有问题</li><li id="eef9" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">设计产品以运行多个版本的Kubernetes集群。我们不想运行多个版本，因为工作量很大，但我们知道我们最终会遇到这样的情况，我们将被迫离开某个特定版本而不进行升级，因为该版本可能会破坏几个客户的应用程序。</li></ul><h2 id="90ec" class="kp kq hi bd kr ks kt ku kv kw kx ky kz iq la lb lc iu ld le lf iy lg lh li lj bi translated">#2设置资源限制</h2><p id="c04e" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">Kubernetes旨在应用程序之间共享资源。资源限制定义了应用程序之间如何共享资源。Kubernetes不提供现成的默认资源限制。这意味着，除非您明确定义限制，否则您的容器可能会消耗无限的CPU和内存。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/85b2eed720a486b0ffa9e5ba37b78e13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vvP7fMdy8DoaLscLNL_UKg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Kubernetes Resource Limits</figcaption></figure><p id="dc41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些限制有助于K8s进行正确的协调— (a) K8s调度程序为pod选择正确的节点(b)限制最大资源分配以避免嘈杂的邻居问题(c)基于资源限制和可用节点容量定义pod抢占行为。</p><p id="2f4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是对四个资源参数的简要描述:</p><ol class=""><li id="43e1" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc ko kg kh ki bi translated">cpu requested请求的最小cpu。K8s保留此CPU，即使pod没有使用所有请求的CPU，也不能被其他pod使用。</li><li id="225b" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">cpu . limit——如果一个pod达到为它设置的CPU限制，Kubernetes将对它进行节流，防止它超过限制，但它不会被终止</li><li id="19d7" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">memory requested请求的最小内存。K8s保留此内存，即使pod没有使用所有请求的CPU，也不能被其他pod使用。</li><li id="ab57" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">memory.limit —如果pod超过其内存限制，它将被终止</li></ol><p id="c902" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有其他一些高级概念，比如ResourceQuota，可以帮助您在名称空间级别设置资源限制，但是一定要至少设置上面列出的这四个参数。</p><p id="83af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于Engine Yard，以下是我们设置资源限制的方式:</p><ol class=""><li id="8651" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc ko kg kh ki bi translated">我们将这些限制简化为一个称为优化容器单元(OCU)的指标，它等于1GB的RAM和相应的CPU。开发者只需要决定焦点的数量(垂直缩放)和容器的数量(水平缩放)。</li><li id="0cdd" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">我们根据OCU自动设置和调整Kubernetes资源限制</li><li id="c4a8" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">我们开发了一个预测性扩展系统，该系统考虑了资源限制(通过焦点)和使用模式——稍后将详细介绍</li></ol><h2 id="a7d6" class="kp kq hi bd kr ks kt ku kv kw kx ky kz iq la lb lc iu ld le lf iy lg lh li lj bi translated">#3注意pod开始时间</h2><p id="09c5" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">无论您的应用程序是标准应用程序、无服务器应用程序还是遵循微服务架构的应用程序，您都需要注意pod启动时间。托管K8s平台承诺pod可用性约为2秒，但在启动和运行您的应用程序容器时，这与现实相去甚远——总时间(包括pod可用性、提取docker映像、启动应用程序等。)可能需要几分钟的时间才能让您的应用程序可用。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lq"><img src="../Images/64581c18c96a53a2e6517798e9a75c46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/0*TIWqSiZ6vGKiB0dy.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx">Steps involved in pod booting — <a class="ae lr" rel="noopener" href="/google-cloud/profiling-gke-startup-time-9052d81e0052">courtesy Colt McAnlis</a></figcaption></figure><p id="0c9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最好的办法是测试您的应用程序的启动时间，并调整K8s配置、docker映像大小和节点可用性等基础设施。</p><p id="7e6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">带发动机场:</p><ol class=""><li id="a361" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc ko kg kh ki bi translated">我们提供了标准的“应用程序堆栈”,这些堆栈针对特定的运行时环境进行了调整，例如“Ruby v6堆栈”。这使我们能够调整这些应用程序堆栈，以实现更快的启动时间和卓越的性能。</li><li id="3854" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">节点可用性是影响pod启动时间的最大因素。我们构建了一个预测性的扩展算法，可以提前扩展底层节点。</li></ol><h2 id="3f84" class="kp kq hi bd kr ks kt ku kv kw kx ky kz iq la lb lc iu ld le lf iy lg lh li lj bi translated">#4 AWS负载平衡器本身是不够的</h2><p id="eb81" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">Engine Yard运行在亚马逊网络服务(AWS)上。对于我们的每个EYK私有集群，都有一个底层的AWS EKS集群和一个相应的弹性负载平衡器(ELB)。我们从经验中了解到，由于ELB附带的配置选项有限，仅有AWS ELB是不够的。一个关键的限制是它不能处理多个vhosts。</p><p id="6388" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了ELB，你可以使用HAProxy或者NGINX来解决这个问题。您也可以只使用HAProxy或NGINX(没有ELB ),但您必须在DNS级别上处理动态AWS IP地址。</p><p id="0234" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">带发动机场:</p><ul class=""><li id="b5c7" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc kf kg kh ki bi translated">除了弹性Kubernetes服务(EKS)集群中的标准ELB之外，我们还配置了一个基于NGINX的负载平衡器。</li><li id="ca93" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">我们通常更喜欢使用AWS托管服务，因为这些服务需要更少的配置就可以更好地扩展，但在这种情况下，ELB的限制迫使我们使用非托管组件(NGINX)。</li><li id="c026" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">当您将NGINX设置为第二个负载均衡器时，不要忘记配置NGINX的自动扩展功能——如果不这样做，NGINX将成为您扩展应用程序流量的瓶颈。</li></ul><h2 id="8728" class="kp kq hi bd kr ks kt ku kv kw kx ky kz iq la lb lc iu ld le lf iy lg lh li lj bi translated">#5设置自己的日志记录</h2><p id="d62a" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">当您在Kubernetes上部署应用程序时，这些应用程序运行在一个分布式和容器化的环境中。实现日志聚合对于理解应用程序行为至关重要。Kubernetes没有提供现成的集中式日志解决方案，但是它提供了实现这种功能所需的所有基本资源。</p><p id="b9b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于发动机场，我们使用EFK进行伐木:</p><ul class=""><li id="ffc8" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc kf kg kh ki bi translated">我们使用Fluent Bit进行分布式日志收集</li><li id="71c9" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">Fluent Bit将数据聚合到Elasticsearch中</li><li id="22b0" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">Kibana帮助你分析聚集到Elasticsearch中的日志</li></ul><h2 id="96f7" class="kp kq hi bd kr ks kt ku kv kw kx ky kz iq la lb lc iu ld le lf iy lg lh li lj bi translated">#6设置您自己的监控</h2><p id="69bb" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">监控您的应用程序和集群非常重要。Kubernetes没有开箱即用的内置监控功能。</p><p id="80f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于发动机场，我们使用:</p><ul class=""><li id="be18" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc kf kg kh ki bi translated">度量和警报的普罗米修斯</li><li id="0078" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">Grafana用于度量可视化</li></ul><h2 id="2fc3" class="kp kq hi bd kr ks kt ku kv kw kx ky kz iq la lb lc iu ld le lf iy lg lh li lj bi translated">#7调整大小和比例</h2><p id="debd" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">有两种——可能有三种——扩展K8s集群的方式。</p><ol class=""><li id="68fc" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc ko kg kh ki bi translated">聚类自动缩放</li><li id="0845" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">垂直大小调整和缩放:(a)单元大小调整(b)垂直单元自动缩放</li><li id="da63" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">水平Pod自动缩放</li></ol><p id="eae3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些有点棘手，但理解并正确配置它们很重要。</p><p id="5c88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">集群自动缩放器</strong>自动增加或减少集群中的节点数量。在Kubernetes中，节点是一个工作机。如果计划执行pods，Kubernetes Autoscaler可以增加集群中的节点数量，以避免资源短缺。它还会释放空闲节点，以保持集群处于最佳大小。</p><p id="b8f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">向上扩展是一项时间敏感的操作。扩展您的单元和集群所需的平均时间可能是4到12分钟。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/a879bc5aab10ff2a54e41772f3d0b779.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kqiUGgkazUKqBc48.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Scaling in Kubernetes: Pod Sizing, Vertical Pod Autoscaling and Horizontal Autoscaling</figcaption></figure><p id="b00a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> pod规模估算</strong>是在部署时定义您的Pod所需的资源量(cpu和内存)(如果每个容器中有1个Pod，则等于容器的大小)的过程。</p><p id="a1de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我们在资源限制中所讨论的，您将使用(1)最小cpu (2)最大cpu (3)最小内存(4)最大内存来定义pod大小。</p><p id="976a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最重要的是确保您的pod不会小于最低工作负载所需的容量。如果太小，您将不能服务任何流量，因为您的应用程序可能会出现内存不足的错误。如果它太大，您将浪费资源—您最好启用水平扩展。</p><p id="1052" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正确的pod大小大约是[最小+ 20%]。然后，您可以对pod大小应用水平缩放。</p><p id="8600" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">垂直pod自动缩放(VPA) </strong>允许您根据负载动态调整Pod的大小。然而，这并不是K8s中自然或常见的扩展方式，因为限制很少。</p><ul class=""><li id="0322" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc kf kg kh ki bi translated">VPA破坏一个pod并重新创建它来垂直自动缩放它。由于VPA的中断，这违背了扩大规模的目的</li><li id="7e19" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">您不能将它与水平窗格自动缩放一起使用，通常情况下，水平窗格自动缩放更有益</li></ul><p id="e87e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">水平机架自动缩放(HPA) </strong>允许您根据负载以预定义的机架尺寸缩放机架数量。HPA是在K8s中扩展应用程序的自然方式。成功的HPA需要考虑两个重要因素:</p><ol class=""><li id="aea6" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc ko kg kh ki bi translated">调整pod的大小—如果pod太小，pod可能会出现故障，当这种情况发生时，无论水平扩展多少都没有关系。</li><li id="d2d4" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc ko kg kh ki bi translated">选择正确的扩展指标— (a)平均CPU利用率和(b)平均内存利用率是最常见的指标，但是您也可以使用自定义指标</li></ol><p id="0f16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于发动机场，我们使用:</p><ul class=""><li id="0f51" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc kf kg kh ki bi translated">Engine Yard为其客户管理集群自动扩展，我们使用定制的<em class="jw">预测集群扩展</em>来最大限度地减少扩展您的pod所需的时间。</li><li id="c37f" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">每个应用程序以1GB内存的增量配置其pod大小(我们称这些优化的容器单元为OCU ),这允许细粒度的控制，同时使调整pod变得更简单。</li><li id="35f2" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">我们不鼓励垂直Pod自动缩放</li><li id="fd6e" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">我们完全支持并为我们的客户管理水平Pod自动扩展，包括(a)基于cpu、内存的扩展和(b)基于自定义指标的扩展</li></ul><h2 id="1344" class="kp kq hi bd kr ks kt ku kv kw kx ky kz iq la lb lc iu ld le lf iy lg lh li lj bi translated">#8并非所有受管理的Kubernetes都是平等的</h2><p id="1e68" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">市场上有几种声称是“托管Kubernetes”服务的产品。您真正需要了解的是其中每一项提供的托管服务的级别。换句话说，服务为您管理的内容和您自己需要管理的内容。</p><p id="6476" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，AWS Elastic Kubernetes Service(EKS)和Google Kubernetes Engine (GKE)将自己定位为托管Kubernetes服务，但是如果没有内部DevOps专业知识，您就无法管理这些K8s集群。</p><p id="e79c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">带发动机场:</p><ul class=""><li id="8597" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc kf kg kh ki bi translated">我们将EYK产品设计为NoOps平台即服务(PaaS ),让我们的客户可以专注于他们的应用程序，而不需要内部的DevOps专业知识。我们的客户只需要使用<em class="jw"> git push </em>将他们的代码部署到EYK，平台会处理剩下的事情。</li><li id="cf91" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">我们还提供卓越的支持(Engine Yard一直都是这样做的),让客户永远不必担心“运营”</li></ul><h2 id="5eee" class="kp kq hi bd kr ks kt ku kv kw kx ky kz iq la lb lc iu ld le lf iy lg lh li lj bi translated">#9设置工作流以轻松部署和管理应用程序</h2><p id="ab4d" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">如果您不能轻松、持续地将应用程序部署到集群，那么集群还有什么价值？描述应用程序、配置服务、配置入口、设置配置映射等。为每个应用程序进行设置可能会非常困难。确保有一个工作流流程/系统来管理部署在K8s集群上的应用程序的生命周期。</p><p id="7917" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">带发动机场:</p><ul class=""><li id="e188" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc kf kg kh ki bi translated">我们向Kubernetes集群添加了一个开发人员友好的层。这一层使得通过git push从源代码部署应用程序、配置应用程序、创建和回滚版本、管理域名和SSL证书、提供路由以及与团队共享应用程序变得容易。</li><li id="524b" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">开发人员可以通过基于web的UI和CLI访问他们的集群和应用程序。</li></ul><h2 id="03c2" class="kp kq hi bd kr ks kt ku kv kw kx ky kz iq la lb lc iu ld le lf iy lg lh li lj bi translated">集装箱化没有你想象的那么难</h2><p id="4a16" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">为了在Kubernetes上运行您的应用程序，您确实需要将它容器化，从头开始容器化是很困难的。好消息是，您不一定需要从头开始集装箱化。您可以从预构建的容器映像开始，并对其进行定制。从Docker Hub、GitHub Container Registry等公共容器注册中心开始，寻找合适的映像开始。</p><p id="37fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">带发动机场:</p><ul class=""><li id="8800" class="ka kb hi ih b ii ij im in iq kc iu kd iy ke jc kf kg kh ki bi translated">我们创建“应用程序堆栈”,这是预构建的容器映像，适合最常见的应用程序模式。</li><li id="082b" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">根据您的存储库中的代码，Engine Yard通常能够为您的应用推荐合适的应用堆栈。</li><li id="2f58" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">构建“应用程序堆栈”的另一个好处是，我们可以调整这些堆栈，以获得更快的启动时间、更好的性能和更大的可扩展性。</li><li id="d368" class="ka kb hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">容器化，特别是当你的团队不具备DevOps专业知识时，尽管有所有的指导，仍然会很困难。这就是我们的支持团队在流程中帮助客户的原因。</li></ul><p id="e89e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有一件事！当您设置Kubernetes和组件时，最好使用Terraform脚本和Helm charts来完成，这样您就可以在任何需要的时候重现集群(通过再次运行这些脚本)。</p><p id="b8c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">享受Kubernetes和容器的所有好处！</p></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><p id="22ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jw">最初发表于</em><a class="ae lr" href="https://blog.engineyard.com/10-lessons-learned-from-building-engine-yards-container-platform-on-kubernetes" rel="noopener ugc nofollow" target="_blank"><em class="jw">【https://blog.engineyard.com】</em></a><em class="jw">。</em></p></div></div>    
</body>
</html>