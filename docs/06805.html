<html>
<head>
<title>Next Word Prediction Using LSTMs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用LSTMs的下一个单词预测</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/next-word-prediction-using-lstms-98a1edec8594?source=collection_archive---------9-----------------------#2021-08-30">https://medium.com/geekculture/next-word-prediction-using-lstms-98a1edec8594?source=collection_archive---------9-----------------------#2021-08-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2f38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用LSTM和注意机制的基于分类的方法的详细实现</p><p id="d8a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是主文<a class="ae jd" rel="noopener" href="/@prerana1298/next-word-prediction-using-swiftkey-data-f121f59bc7d">使用Swiftkey数据</a>预测下一个单词的续篇。我将在接下来的章节中详细讨论LSTM模型的文本特征和架构。</p><h1 id="0816" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">功能开发</h1><h2 id="e6c4" class="kc jf hi bd jg kd ke kf jk kg kh ki jo iq kj kk js iu kl km jw iy kn ko ka kp bi translated"><strong class="ak">创建文本序列</strong></h2><p id="4d14" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">我已经从清理过的语料库的记号中创建了不同长度的序列，并保持了记号的顺序。</p><p id="da98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">代码示例</strong></p><figure class="kv kw kx ky fd kz"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="1329" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我创建了长度为2、4和7的序列。</p><h2 id="7025" class="kc jf hi bd jg kd ke kf jk kg kh ki jo iq kj kk js iu kl km jw iy kn ko ka kp bi translated"><strong class="ak">编码序列并分裂成x和y </strong></h2><p id="2147" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">我已经使用Keras Tokenizer对序列中的单词进行了编码，并对序列进行了拆分，使得序列中只有最后一个单词在y中，其余的在x中。</p><p id="84a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，长度为2的序列的第一个字在x中，最后一个字在y中。类似地，长度为4的序列的前3个字在x中，最后一个字在y中。</p><p id="28c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">代码示例</strong></p><p id="0e46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是编码和分割数据的函数</p><figure class="kv kw kx ky fd kz"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="e9d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述函数还返回编码数据的词汇表和每个编码单词的索引。</p><p id="4794" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">这里的想法是y中的每个单词充当一个类，我的目标是根据x中的单词序列来预测该类。</strong></p><h1 id="ca19" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">堆叠LSTM模型</h1><p id="09f1" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">它是通过在LSTM层上叠加双向LSTM层而开发的模型。以下是LSTM模型的架构。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es lc"><img src="../Images/70f1cffa99c591facd24d8da02864ebe.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*oObx08-FMvVtibSRBmM34A.png"/></div><figcaption class="lf lg et er es lh li bd b be z dx">Model Architecture</figcaption></figure><p id="05f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经开发了3个这样的模型，分别对应于长度为2、4和7的序列。在每种情况下，除了单元1和单元2单元的数量<strong class="ih hj">之外，一切都保持不变。其思想是保留x中单词的序列信息，以预测y中的下一个单词类。</strong>输出层有一个softmax激活，所以我得到了输出类的概率分布。</p><p id="2ee1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">代码示例</strong></p><figure class="kv kw kx ky fd kz"><div class="bz dy l di"><div class="la lb l"/></div></figure><h2 id="fcb0" class="kc jf hi bd jg kd ke kf jk kg kh ki jo iq kj kk js iu kl km jw iy kn ko ka kp bi translated">训练结果</h2><p id="84ad" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">对于长度为2的序列:</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es lj"><img src="../Images/9b02c53c7f480927e0f9ca953e208465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SWLSx3Hmr98Epm-823NbkQ.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx">Model Performance for sequence of length 2</figcaption></figure><p id="7e9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于长度为4的序列:</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es lj"><img src="../Images/ced05d27f958876e6aa00f9aa490089f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2RJ9uN6sk5VKqGLse-MQuA.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx">Model Performance for sequence of length 4</figcaption></figure><p id="7bd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于长度为7的序列:</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es lj"><img src="../Images/07ba9d41eb2fb75c9454a0d8129751ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ts6ZG69A_JNYKZBTtQAj9Q.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx">Model Performance for sequence of length 7</figcaption></figure><p id="d830" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Github链接:</strong><a class="ae jd" href="https://github.com/kurchi1205/Next-word-Pediction-using-Swiftkey-Data/blob/main/LSTM%20Model.ipynb" rel="noopener ugc nofollow" target="_blank">https://Github . com/kur chi 1205/Next-word-Prediction-using-swift key-Data/blob/main/LSTM % 20 model . ipynb</a></p><h2 id="4494" class="kc jf hi bd jg kd ke kf jk kg kh ki jo iq kj kk js iu kl km jw iy kn ko ka kp bi translated">试验结果</h2><ul class=""><li id="b29a" class="lo lp hi ih b ii kq im kr iq lq iu lr iy ls jc lt lu lv lw bi translated">序列2-损失:9.2959</li><li id="6096" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">序列4-损失:27.3950</li><li id="18e7" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">序列7-损失:22.7704</li></ul><h2 id="2e5b" class="kc jf hi bd jg kd ke kf jk kg kh ki jo iq kj kk js iu kl km jw iy kn ko ka kp bi translated"><strong class="ak">下一个单词预测</strong></h2><p id="c88a" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated"><strong class="ih hj">关键想法:</strong></p><ol class=""><li id="2253" class="lo lp hi ih b ii ij im in iq mc iu md iy me jc mf lu lv lw bi translated">单词序列<code class="du mg mh mi mj b">(history)</code>作为输入，其下一个单词必须被预测。</li><li id="3c5f" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc mf lu lv lw bi translated">如果<code class="du mg mh mi mj b">history</code>的长度= 1，那么我们将其传递给序列长度为2对应的模型，预测概率最高的类。</li><li id="a193" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc mf lu lv lw bi translated">如果<code class="du mg mh mi mj b">history</code> &lt;的长度为4，那么我们将其传递给序列长度为4对应的模型，预测概率最高的类。</li><li id="f419" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc mf lu lv lw bi translated">如果<code class="du mg mh mi mj b">history</code> &lt;的长度为7，那么我们将其传递给序列长度为7对应的模型，预测概率最高的类。</li><li id="167e" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc mf lu lv lw bi translated">如果<code class="du mg mh mi mj b">history</code>的长度≥ 7，那么我取<code class="du mg mh mi mj b">history = history[-6:]</code>，重复步骤4。</li></ol><p id="87c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">一些预测:</strong></p><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es mk"><img src="../Images/2ec37dfe03eebaa87ad0704c28f2a88f.png" data-original-src="https://miro.medium.com/v2/resize:fit:422/format:webp/1*SCanOopDZ30rsg868fNJGg.png"/></div><figcaption class="lf lg et er es lh li bd b be z dx">Some next word predictions</figcaption></figure><p id="fcc9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总的来说，模型预测相当不错，但由于损失太高，还有改进的余地。</p><h1 id="2b49" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">关注堆叠LSTM模型</h1><p id="70e5" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">这个模型与上一个非常相似，除了我在双向LSTM的输出中添加了一个<strong class="ih hj">注意层</strong>。</p><p id="ee7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">为什么我们需要关注层？</strong></p><p id="5d7d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有些时候，当我们预测一个序列的下一个单词时，该序列的所有单词对该单词的预测的贡献并不相等。</p><p id="e5dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如:考虑句子<strong class="ih hj"> <em class="ml">`我去看医生，因为我病得很重`</em> </strong>假设这里，我要预测单词<strong class="ih hj"> <em class="ml">有病</em> </strong>。为此，单词<strong class="ih hj"> <em class="ml">变</em> </strong>、<strong class="ih hj"> <em class="ml">见</em> </strong>、<strong class="ih hj"> <em class="ml">医生</em> </strong>将具有更大的权重，因为它们对下一个单词生病的概率贡献更大。 </p><p id="7697" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，为了给序列中的每个单词提供权重，我们需要一个注意力层。</p><h2 id="96f7" class="kc jf hi bd jg kd ke kf jk kg kh ki jo iq kj kk js iu kl km jw iy kn ko ka kp bi translated">模型的架构</h2><p id="d9a6" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">下面是模型的架构流程图:</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es mm"><img src="../Images/837175c8c52a2e757d536bdb753a9944.png" data-original-src="https://miro.medium.com/v2/resize:fit:466/format:webp/1*P6ME0pP9kT1axUtDPzZq_w.png"/></div><figcaption class="lf lg et er es lh li bd b be z dx">Flowchart of the Architecture</figcaption></figure><p id="eb03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在来看看注意力层的架构。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es mn"><img src="../Images/459ec47a48c7cdd8a2c5642cdd9a2814.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*kybqcH9i_H_CVl5fsPlqLQ.png"/></div><figcaption class="lf lg et er es lh li bd b be z dx">Architecture for the attention layer</figcaption></figure><h2 id="e333" class="kc jf hi bd jg kd ke kf jk kg kh ki jo iq kj kk js iu kl km jw iy kn ko ka kp bi translated">编码样本</h2><p id="e7f8" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated"><strong class="ih hj">对于关注层:</strong></p><figure class="kv kw kx ky fd kz"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="af00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">整体型号:</strong></p><figure class="kv kw kx ky fd kz"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="df93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Github链接:</strong><a class="ae jd" href="https://github.com/kurchi1205/Next-word-Pediction-using-Swiftkey-Data/blob/main/LSTM%20Model%20with%20Attention.ipynb" rel="noopener ugc nofollow" target="_blank">https://Github . com/kur chi 1205/Next-word-Prediction-using-swift key-Data/blob/main/LSTM % 20 model % 20 with % 20 attention . ipynb</a></p><h2 id="46d1" class="kc jf hi bd jg kd ke kf jk kg kh ki jo iq kj kk js iu kl km jw iy kn ko ka kp bi translated">训练结果</h2><p id="54d6" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">对于长度为2的序列:</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es lj"><img src="../Images/8b947e2117490ffea6f6daf347ac0ea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bxfkA0EkNnnDO0wD5JVOjA.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx">Loss and Accuracy for sequence of length 2</figcaption></figure><p id="f63b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于长度为4的序列:</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es lj"><img src="../Images/6ac574b1e63bd9e07647624944e11e01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e42JVTr6xi8LI_9QotxzIA.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx">Loss and Accuracy for sequence of length 4</figcaption></figure><p id="d602" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于长度为7的序列:</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es lj"><img src="../Images/56dd74b861832faf253ea4675a454644.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0fESFdIasWwb17JSsO3fQw.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx">Loss and Accuracy for sequence of length 7</figcaption></figure><h2 id="a2e2" class="kc jf hi bd jg kd ke kf jk kg kh ki jo iq kj kk js iu kl km jw iy kn ko ka kp bi translated">试验结果</h2><ul class=""><li id="8c9e" class="lo lp hi ih b ii kq im kr iq lq iu lr iy ls jc lt lu lv lw bi translated">序列2-损失:7.09</li><li id="ced5" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">序列4-损失:8.84</li><li id="7407" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">序列7-损失:9.24</li></ul><h2 id="dd10" class="kc jf hi bd jg kd ke kf jk kg kh ki jo iq kj kk js iu kl km jw iy kn ko ka kp bi translated">下一个单词预测</h2><p id="3b3f" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated"><strong class="ih hj">关键思想:</strong>与上面讨论的堆叠模型相同。</p><p id="6d0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">一些预测:</strong></p><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es mo"><img src="../Images/f191ad3538d16161d787380f35cf936f.png" data-original-src="https://miro.medium.com/v2/resize:fit:416/format:webp/1*_1c14MzU6Cp5JzKCnJgn9w.png"/></div><figcaption class="lf lg et er es lh li bd b be z dx">Predictions using LSTM with attention mechanism</figcaption></figure><p id="28ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此注意机制显著改善了损失。</p><p id="79f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，我尝试了一些其他基于变压器的模型，看看结果是否有所不同。请参考主要文章。</p></div></div>    
</body>
</html>