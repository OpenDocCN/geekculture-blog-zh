<html>
<head>
<title>ARKit 911 — Image Tracking in Swift Playgrounds</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ARKit 911—Swift游乐场中的图像跟踪</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/arkit-911-image-tracking-in-swift-playgrounds-702bc93f9fd1?source=collection_archive---------4-----------------------#2022-01-07">https://medium.com/geekculture/arkit-911-image-tracking-in-swift-playgrounds-702bc93f9fd1?source=collection_archive---------4-----------------------#2022-01-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a2521edff35d126fe80447eac6042531.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p7ACfEknBEVItYJSlGOX2w.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">In compositing apps like NUKE, 1-point tracker allows you to record a XY-position of image, 2-point tracker — XY-position and Z-rotation, 3-point tracker — XY-position, Z-rotation and scale, and 4-point tracker — corner pinning. Most AR frameworks use these transform cases along with Machine Learning algorithms.</figcaption></figure><h1 id="fe85" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">这个故事的目的</h1><p id="ab61" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">出于某种无法解释的原因，Swift Playgrounds不允许我们使用其名称为<strong class="ju hj"> <em class="kq"> Resources </em> </strong>的文件夹，即使print命令很高兴地通知我们:“一切正常，所搜索的图像在<strong class="ju hj"> <em class="kq"> Resources </em> </strong>文件夹中”。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/e4d3b869d16f9d0166e33b1419916c35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wDZ1uSAW98ni2ERDMd06_A.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Screenshot of Swift Playgrounds 4.0 for iPad</figcaption></figure><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="72d1" class="lb iv hi kx b fi lc ld l le lf"><strong class="kx hj">print</strong>( Bundle.main.path(forResource: "Photo", ofType: "png")! )</span></pre><p id="49f6" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">打印结果如下所示:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="4e2c" class="lb iv hi kx b fi lc ld l le lf">/var/mobile/Containers/Data/PluginKitPlugin/<br/>A0E15417-9B30-45D7-AB2D-9B8C03EE97FA/Library/<br/>Application Support/Main Module Resources Bundles/<br/>8EE548B0-9675-438F-9571-242D17EA12F5.bundle/<br/>Contents/Resources/Photo.png</span></pre><p id="c526" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">因此，在我的故事中，我想告诉你一个小技巧来解决这个问题。若要进一步移动，请将所有参考图像加载到资源文件夹中。</p><h1 id="92e7" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated"><strong class="ak"> Xcode方法</strong></h1><p id="14a1" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">许多开发人员习惯于使用<strong class="ju hj"><em class="kq">reference images(in group named:bundle:)</em></strong>类型的方法来加载Xcode项目的资产目录中指定的<strong class="ju hj"> <em class="kq"> Resources </em> </strong>组中的所有参考图像:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="9345" class="lb iv hi kx b fi lc ld l le lf"><strong class="kx hj">class func</strong> referenceImages(inGroupNamed name: <!-- -->String<!-- -->,<br/>                          bundle: <!-- -->Bundle<!-- -->?) -&gt; <!-- -->Set<!-- -->&lt;<!-- -->ARReferenceImage<!-- -->&gt;?</span></pre><p id="ffb8" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">它返回可选的<strong class="ju hj"> <em class="kq">集合&lt;ARReferenceImage&gt;</em></strong>，可以包含多达一百个唯一的参考图像。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/b2cdfbe382043af425ab03eb1d440451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PIinzF8CyaHQ6GzaKnGjDw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx"><strong class="bd iw">Resources</strong> folder in Assets.xcassets</figcaption></figure><p id="9490" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">这里我使用了<strong class="ju hj"><em class="kq">ARImageTrackingConfiguration</em></strong>:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="893f" class="lb iv hi kx b fi lc ld l le lf"><strong class="kx hj">func</strong> imageTrackingConfig() {</span><span id="16e1" class="lb iv hi kx b fi lm ld l le lf"><strong class="kx hj">    guard let</strong> resources = ARReferenceImage.referenceImages(<br/>                                          inGroupNamed: "Resources",<br/>                                                bundle: <strong class="kx hj">nil</strong>)<br/>    <strong class="kx hj">else</strong> { <strong class="kx hj">return</strong> }</span><span id="96aa" class="lb iv hi kx b fi lm ld l le lf"><strong class="kx hj">    let</strong> config = ARImageTrackingConfiguration()<br/>    config.trackingImages = resources</span><span id="a4dc" class="lb iv hi kx b fi lm ld l le lf">    <strong class="kx hj">self</strong>.sceneView.session.run(config)<br/>}</span></pre><p id="56d7" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">但是，如果你试图在Swift Playgrounds中使用这种方法，你将会失败，因为<strong class="ju hj"><em class="kq">in group named</em></strong>argument要求你写一个resources文件夹的名称，但是你不能。</p><h1 id="495a" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">快速游乐场方法</h1><p id="6196" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">而是要用<strong class="ju hj"><em class="kq">ARReferenceImage</em></strong>类初始化器调用<strong class="ju hj"><em class="kq">init(_:orientation:physical width:)</em></strong>。它从核心图形图像对象创建新的参考图像，其中<strong class="ju hj"><em class="kq">physical width</em></strong>参数是以米为单位的真实宽度。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="75d2" class="lb iv hi kx b fi lc ld l le lf"><strong class="kx hj">public init</strong>(<strong class="kx hj">_</strong> image: <!-- -->CGImage<!-- -->,  <br/>        orientation: <!-- -->CGImagePropertyOrientation<!-- -->,<br/>      physicalWidth: <!-- -->CGFloat<!-- -->)</span></pre><p id="3be8" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">将我的方法粘贴到您的<strong class="ju hj"><em class="kq">view controller</em></strong>类中:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="08d1" class="lb iv hi kx b fi lc ld l le lf"><strong class="kx hj">fileprivate func</strong> <!-- -->imageTrackingConfig()<!-- --> {<br/>    <br/>    <strong class="kx hj">let</strong> imageFromWeb = <strong class="kx hj">#imageLiteral</strong>(resourceName: "<em class="kq">Photo.png</em>")<br/>    <br/>    <strong class="kx hj">let</strong> image = ARReferenceImage(imageFromWeb.cgImage!, <br/>                                           orientation: .up, <br/>                                         physicalWidth: 0.5)<br/>    <br/>    <strong class="kx hj">self</strong>.trackingImages.insert(image)<br/>    <br/>    <strong class="kx hj">let</strong> config = ARImageTrackingConfiguration()<br/>    config.trackingImages = trackingImages<br/>    <strong class="kx hj">self</strong>.sceneView.session.run(config)<br/>}</span></pre><p id="3418" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">剩下的代码看起来很熟悉，不是吗？</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="464f" class="lb iv hi kx b fi lc ld l le lf"><strong class="kx hj">import</strong> ARKit<br/><strong class="kx hj">import </strong>SceneKit<strong class="kx hj"><br/>import</strong> PlaygroundSupport</span><span id="e205" class="lb iv hi kx b fi lm ld l le lf"><strong class="kx hj">class</strong> ViewController: UIViewController {<br/>    <br/>    <strong class="kx hj">let</strong> sceneView = ARSCNView(frame: .zero)<br/>    <strong class="kx hj">var</strong> trackingImages = Set&lt;ARReferenceImage&gt;()<br/>    <br/>    <strong class="kx hj">override func</strong> viewDidLoad() {<br/>        <strong class="kx hj">super</strong>.viewDidLoad()</span><span id="81bb" class="lb iv hi kx b fi lm ld l le lf">        <strong class="kx hj">self</strong>.view = <strong class="kx hj">self</strong>.sceneView<br/>        <br/>        sceneView.delegate = <strong class="kx hj">self</strong><br/>        sceneView.scene = SCNScene()<br/>        sceneView.autoenablesDefaultLighting = <strong class="kx hj">true</strong><br/>        <br/>        <strong class="kx hj">self</strong>.imageTrackingConfig()<br/>    }<br/>}</span><span id="9c01" class="lb iv hi kx b fi lm ld l le lf">PlaygroundPage.current.needsIndefiniteExecution = <strong class="kx hj">true</strong><br/>PlaygroundPage.current.liveView = ViewController()</span></pre><p id="b8c0" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">最后是扩展:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="f881" class="lb iv hi kx b fi lc ld l le lf"><strong class="kx hj">extension</strong> ViewController: ARSCNViewDelegate {<br/>    <br/>    <strong class="kx hj">func</strong> renderer(_ renderer: SCNSceneRenderer,<br/>                 didAdd node: SCNNode,<br/>                  for anchor: ARAnchor) {<br/>        <br/>        <strong class="kx hj">if let _</strong> = anchor <strong class="kx hj">as</strong>? ARImageAnchor {<br/>            <br/>            <strong class="kx hj">let</strong> geo = SCNTorus(ringRadius: 0.1, pipeRadius: 0.05))<br/>            <strong class="kx hj">let</strong> donut = SCNNode(geometry: geo)</span><span id="7d1e" class="lb iv hi kx b fi lm ld l le lf">            donut.geometry?.firstMaterial?.lightingModel = .phong</span><span id="52d9" class="lb iv hi kx b fi lm ld l le lf">            donut.geometry?.firstMaterial?.diffuse.contents =<br/>                                       UIImage(named: "<em class="kq">Photo 1.png</em>")<br/>            node.addChildNode(donut)<br/>        }<br/>    }<br/>}</span></pre><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/5c0c7fb4fa4c64dcac72045f547d43cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y1qfI235R3gbljPQj0cYMg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">“Photo 1.png” is donut’s texture</figcaption></figure><p id="05d0" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">这个肯定管用。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/b36d6827a769ea8c0aa8ff67fe2f2094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iztgi6xzqDdQAROnVeg-0w.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Donut model tethered with ARImageAnchor</figcaption></figure><p id="02d0" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">最后，给那些想在RealityKit中实现图像跟踪的人一些建议。代码看起来与第一种情况稍有不同，但主要区别是使用了<strong class="ju hj"> <em class="kq">会话(_:didAdd:</em></strong>实例方法。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="54d7" class="lb iv hi kx b fi lc ld l le lf"><strong class="kx hj">import</strong> ARKit<br/><strong class="kx hj">import</strong> RealityKit<br/><strong class="kx hj">import</strong> PlaygroundSupport</span><span id="31af" class="lb iv hi kx b fi lm ld l le lf"><strong class="kx hj">class</strong> ViewController: UIViewController {<br/>    <br/>    <strong class="kx hj">let</strong> arView = ARView(frame: .zero)<br/>    <strong class="kx hj">var</strong> trackingImages = Set&lt;ARReferenceImage&gt;()<br/>    <br/>    <strong class="kx hj">override func</strong> viewDidLoad() {<br/>        <strong class="kx hj">super</strong>.viewDidLoad()</span><span id="44b7" class="lb iv hi kx b fi lm ld l le lf">        <strong class="kx hj">self</strong>.view = <strong class="kx hj">self</strong>.arView<br/>        <strong class="kx hj">self</strong>.arView.cameraMode = .ar<br/>        <br/>        <strong class="kx hj">self</strong>.arView.session.delegate = <strong class="kx hj">self</strong><br/>        <br/>        <strong class="kx hj">self</strong>.imageTrackingConfig()<br/>    }<br/>}</span></pre><p id="734c" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">你可以看到<strong class="ju hj"> <em class="kq"> AnchorEntity </em> </strong>类有一个<strong class="ju hj"><em class="kq">init(anchor:ARAnchor)</em></strong>方便的初始化器，帮助我们获得想要的结果。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="09c3" class="lb iv hi kx b fi lc ld l le lf"><strong class="kx hj">extension</strong> ViewController: ARSessionDelegate {<br/>    <br/>    <strong class="kx hj">func</strong> session(<strong class="kx hj">_</strong> session: ARSession, didAdd anchors: [ARAnchor]) {<br/>        <br/>        <strong class="kx hj">if let</strong> imageAnchors = anchors <strong class="kx hj">as</strong>? [ARImageAnchor] {</span><span id="f43b" class="lb iv hi kx b fi lm ld l le lf">            <strong class="kx hj">for</strong> imageAnchor <strong class="kx hj">in</strong> imageAnchors {</span><span id="2ae5" class="lb iv hi kx b fi lm ld l le lf">                <strong class="kx hj">let</strong> entity = ModelEntity(mesh: .generateBox(<br/>                                                        size: 0.1))</span><span id="6bee" class="lb iv hi kx b fi lm ld l le lf">                <strong class="kx hj">let</strong> anchor = AnchorEntity(anchor: imageAnchor)</span><span id="65aa" class="lb iv hi kx b fi lm ld l le lf">                anchor.addChild(entity)</span><span id="bc0d" class="lb iv hi kx b fi lm ld l le lf">                <strong class="kx hj">self</strong>.arView.scene.anchors.append(anchor)<br/>            }<br/>        }<br/>    }<br/>}</span></pre><p id="7dfa" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">对于使用SwiftUI的用户，需要实现<a class="ae lo" href="https://developer.apple.com/documentation/swiftui/uiviewcontrollerrepresentable/makecoordinator()-32trb" rel="noopener ugc nofollow" target="_blank"><strong class="ju hj"><em class="kq"/></strong></a>。SwiftUI协调员旨在充当UIKit视图控制器的代表。你可以在这里  看到怎么做<a class="ae lo" href="https://stackoverflow.com/questions/60582392/swiftui-passing-data-from-swiftuiview-to-scenekit/60590065#60590065" rel="noopener ugc nofollow" target="_blank"> <strong class="ju hj"> <em class="kq">。</em></strong></a></p><h1 id="6a53" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">捐赠给作者</h1><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/c0650a189c6fb3281d999d5e2342f8a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*79QZO5t3vV-z7yeDjw2dvQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Click on the picture to make the QR code bigger</figcaption></figure><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="afcd" class="lb iv hi kx b fi lc ld l le lf">addr1q9w70n62nu8p7f9ukfn66gzumm9d9uxwppkx7gk7vd7gy0ehfavj97gkncwm8t8l8l8x9e4adzmw2djh4y5gd9rmtewqr99zr3</span></pre><p id="5da7" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">目前就这些。</p><p id="89fa" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">如果这篇文章对你有用，请按下<strong class="ju hj"> <em class="kq">拍</em> </strong>按钮，按住<strong class="ju hj"><em class="kq"/></strong>即可。在Medium上，每个帖子最多可以拍50次<strong class="ju hj"><em class="kq">。</em></strong></p><p id="b272" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">你可以在我在<a class="ae lo" href="https://stackoverflow.com/users/6599590/andy-fedoroff" rel="noopener ugc nofollow" target="_blank"> StackOverflow </a>上的帖子中找到更多关于ARKit、RealityKit和SceneKit的信息。</p><p id="43ee" class="pw-post-body-paragraph js jt hi ju b jv lg jx jy jz lh kb kc kd li kf kg kh lj kj kk kl lk kn ko kp hb bi translated">后会有期！</p></div></div>    
</body>
</html>