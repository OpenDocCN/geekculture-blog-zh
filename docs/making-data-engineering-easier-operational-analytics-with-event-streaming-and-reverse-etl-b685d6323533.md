# 让数据工程更简单:使用事件流和反向 ETL 的运营分析

> 原文：<https://medium.com/geekculture/making-data-engineering-easier-operational-analytics-with-event-streaming-and-reverse-etl-b685d6323533?source=collection_archive---------8----------------------->

![](img/8930983ab13577b1824450fd1d7e135d.png)

过去几年在某种程度上是数据技术的一场革命，像云数据仓库这样的工具已经成熟，从软件工程中借鉴的原则正在迅速转变为以数据为中心的 SaaS。

关于这些工具能让你做什么，有大量的信息，这是正确的。在许多方面，现代数据堆栈实现了孤立的 SaaS 工具永远无法实现的承诺。例如，在数据仓库/数据湖中，从数据仓库中获取数据以构建完整的、单一来源的真实客户资料实际上是可能的。

工具也出现了，一旦公司用数据创造了某种价值，它就帮助公司“将数据投入工作”(最常见的是在数据仓库中，如雪花、谷歌大查询、亚马逊红移等)。).这被称为*运营分析*。实际上，运营分析只是一个营销术语，用来描述在您的仓库和下游业务工具(营销团队、销售团队、客户成功团队等)之间同步数据的反向 ETL 工作流。用来经营公司。

将所有这些工具结合起来，可以实现以前不可能实现的有用用例。完整的客户资料示例是描述这种架构的一个很好的例子。

在仓库中构建概要文件需要从整个堆栈中的数据源进行数据集成。运行 ETL/ELT 管道和收集行为数据可以让您在数据仓库中获得完整的用户特征。下一个合乎逻辑的步骤是一些人所说的最后一英里，将全套特征(或相关子集)发送到不同团队用来运行业务的操作系统。

这可能是营销自动化工具，如 Marketo 或 Braze，销售工具，如 Salesforce 或 Hubspot CRM，客户支持工具，如 Zendesk，商业智能工具，如 Tableau 或 Looker，你懂的。

通过从数据仓库向所有这些工具交付丰富的数据，数据团队有效地赋予业务团队超能力，在他们每天使用的工具中为他们配备全面的客户信息，以做一些事情，如优先拓展、建立更好的电子邮件列表、优化营销活动、打造更好的客户体验等。

# 反向 ETL 使数据工程更容易

因为如此多的注意力被放在业务用户的用例上，就像上面的用例，所以很容易忽略所有这些现代工具(尤其是反向 ETL 工具)的最大好处之一:它们使数据工程变得更容易。

即使在现代数据堆栈出现之前，在 Salesforce 这样的运营系统中建立完整的客户档案在技术上是可能的，但这是一项痛苦而昂贵的努力，将 SaaS 工具远远推至其预期用途之外。它还需要多个全职角色(通常是顾问)来维护连接器和定制的脆弱的弗兰肯斯坦。对大多数公司来说，果汁不值得压榨。

令人欣慰的是，现代数据堆栈使数据工程变得更加容易，使数据团队能够专注于更有价值的问题，而不是仅仅为了移动数据而构建和维护低级别的数据基础架构。

在这篇文章的下一部分，我将概述我们在 RudderStack 面临的真实世界的数据挑战，以及我们如何使用自己的客户数据管道，包括我们的[反向 ETL](https://www.rudderstack.com/product/reverse-etl) 解决方案和 warehouse 来解决它。

# 一个经典的数据挑战:向广告平台转化更多内容

对数据团队来说，检测来自广告平台的像素和转换是更令人沮丧的任务之一，尤其是当你试图实现比最基本的用例更复杂的东西时。具有讽刺意味的是，这些更复杂的用例实际上释放了数字广告的最大价值，因为它们为算法提供了更好的优化数据。

一个最常见的用例是向 Google Ads 这样的平台发送某种注册或潜在客户转换。对于 RudderStack，这些转换要么是网站上的表单填写，要么是我们应用程序中的帐户创建。令人欣慰的是，我们不必使用类似谷歌标签管理器的东西来处理所有的直接工具，因为 RudderStack 可以轻松地将现有的[事件流](http://rudderstack.com/product/event-stream/)识别和跟踪呼叫(如“用户注册”)映射到谷歌广告中的转换。

将所有注册作为转换发送是有帮助的，但我们的付费团队想更进一步:指定哪些转换代表合格的注册(即 MQLs)。这表面上听起来很简单，但实际上是一个棘手的数据工程问题，因为我们的 MQL 定义既是行为的(用户是否执行了某些行为)，也是公司地理/人口统计的(公司规模、行业、职位等)。).为了增加挑战的趣味性，我们通过 [Clearbit API](https://dashboard.clearbit.com/docs) 调用、*和*来丰富公司地理/人口统计数据。用户 MQL 旗帜的最终“运营之家”是 Salesforce。

考虑建立一个定制的解决方案，仅仅是为了让这些丰富的转化成为谷歌广告。呀。

好消息是，谷歌提供了一个数据点，打开了一条将所有这些联系在一起的途径。我们就不赘述了，但它被称为“ [gclid](https://support.google.com/google-ads/answer/9744275) ”，代表“Google click ID”。该值表示特定广告上唯一用户的唯一点击。它被附加到用户点击时被定向到的 URL 的末尾。

使用 gclid 和我们堆栈中的一些聪明的工作流，我们不仅能够将 MQL 转换发送到谷歌广告，还能够驱动关于我们付费广告性能的更详细的报告。

我们将在接下来的指南中逐步介绍细节，但这里是基本的工作流程:

# 首先，从页面调用的 URL 属性中获取 gclid 值，并将其添加到仓库中的用户配置文件表中

在潜在客户记录上捕获 gclid 的一种普遍方法是在表单或注册流程上创建一个隐藏字段，从 URL 中获取值，并填充隐藏字段，以便在提交时，用户记录具有一个 gclid 值(在某种定制字段中)。这种方法的主要问题是，许多用户不会在他们登陆的页面上填写表单(他们浏览网站以获取更多信息)，这意味着 UTM 参数会在后续的页面浏览量中丢失。

缓解这个问题充满了危险，许多数据工程师试图在数据层(通常在 Google Tag Manager 中)持久化 gclid 值，这样当用户浏览网站时，它会一直伴随着用户。这不仅很脆弱，而且当你不得不为其他广告平台建立类似的工作流程时，这将是一个巨大的痛苦。可以说，无论从哪个角度来看，这都是一个巨大的数据工程难题。

RudderStack、dbt 和仓库使这变得容易得多。我们已经跟踪了每个唯一用户的匿名页面视图，这些页面调用将 URL 作为属性包含在事件有效负载中。当用户最终转换时，我们在仓库中有相关的跟踪和识别调用，因此我们可以将所有以前的匿名页面视图绑定到现在已知的用户。

我们已经运行了一个 dbt 模型来生成丰富的用户配置文件，其中包括通过一个 [RudderStack ETL](https://www.rudderstack.com/product/etl) (提取、转换、加载)作业从 Salesforce 获取的 MQL 标志。几行简单的 SQL 允许我们获取与 MQLs 相关的任何以前的页面视图，包括带有 glcid 值的 URL 属性。

尽管如此简单，我们已经将 gclid 值添加到了 MQL 用户配置文件中，而没有尝试持久保存值、使用 Google Tag Manager 进行直接检测或构建大量自定义管道的麻烦。

# 其次，通过反向 ETL 将 gclid 值发送到 Salesforce，并通过直接集成将 MQLs 同步到 Google Ads

此时，大部分运营分析工作已经完成。我们只需要通过让丰富的 MQL 转化回到谷歌广告来完成这个循环。

有几种方法可以做到这一点:您可以将丰富的转换直接发送到 Google Ads，但我们选择使用 Salesforce 和 Google Ads 之间的直接集成，这样我们的数据工程团队就不必维护额外的管道。

因此，剩下要做的唯一一件事就是将 gclid 值导入 Salesforce。令人惊讶的是，我们正在运行的反向 ETL 作业已经解决了这一问题，向 Salesforce 中的销售线索记录添加了其他丰富的数据点(如销售线索得分)。Revenue ops 创建了一个定制字段，我们在 RudderStack 反向 ETL 作业中映射了这个字段，数据流就完成了。

# 更重要的问题

我们的团队在几个小时内连接、测试并部署了这个解决方案。我在过去为实现类似的数据流而争论的过程中留下了伤疤，所以看到我们如此轻松地实现这一点是非常令人难以置信的。

不过，最好的一点是，它给了我们的数据团队时间，让我们能够继续处理更大、更重要的问题，即与我们的分析团队合作，构建更好的广告表现报告。