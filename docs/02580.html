<html>
<head>
<title>Redis Session Data Store Implementation for WSO2 Identity Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">WSO2身份服务器的Redis会话数据存储实现</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/redis-session-data-store-implementation-for-wso2-identity-server-6ced4aaef768?source=collection_archive---------20-----------------------#2021-05-20">https://medium.com/geekculture/redis-session-data-store-implementation-for-wso2-identity-server-6ced4aaef768?source=collection_archive---------20-----------------------#2021-05-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="0790" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">WSO2身份服务器</h2><div class=""/><div class=""><h2 id="7646" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">在<a class="jg jh ge" href="https://medium.com/u/4571d92b14fa?source=post_page-----6ced4aaef768--------------------------------" rel="noopener" target="_blank"> WSO2，Inc </a>的7个月实习项目</h2></div><p id="66c7" class="pw-post-body-paragraph ji jj hi jk b jl jm is jn jo jp iv jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi ke translated"><span class="l kf kg kh bm ki kj kk kl km di">大家好</span>，今天我们要谈谈我在<a class="jg jh ge" href="https://medium.com/u/4571d92b14fa?source=post_page-----6ced4aaef768--------------------------------" rel="noopener" target="_blank"> WSO2，Inc </a>的实习项目。我们会看到实习从开始到结束，以及时间线里发生了什么。我们一个一个来看。</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es kn"><img src="../Images/e6cbd84a132f65a61789093ab3f6fff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*meR9bhFiMKQDUFrW"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx">Photo by <a class="ae ld" href="https://unsplash.com/@homajob?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Scott Graham</a> on <a class="ae ld" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="8d77" class="le lf hi bd lg lh li lj lk ll lm ln lo jr lp lq lr jv ls lt lu jz lv lw lx ho bi translated">项目选择流程</h2><p id="133c" class="pw-post-body-paragraph ji jj hi jk b jl ly is jn jo lz iv jq jr ma jt ju jv mb jx jy jz mc kb kc kd hb bi translated">在我们被选中参加实习后，<a class="jg jh ge" href="https://medium.com/u/4571d92b14fa?source=post_page-----6ced4aaef768--------------------------------" rel="noopener" target="_blank"> WSO2，Inc </a>的不同团队成员进行了项目演示。按照我的要求，我把我最想要的五个项目交给了评选小组。我被分配到<a class="ae ld" href="https://github.com/wso2-incubator/identity-session-data-store-redis" rel="noopener ugc nofollow" target="_blank">用户会话数据持久化项目</a>。有一个包括我的导师在内的小型项目团队。</p><h2 id="464f" class="le lf hi bd lg lh li lj lk ll lm ln lo jr lp lq lr jv ls lt lu jz lv lw lx ho bi translated">项目介绍</h2><blockquote class="md me mf"><p id="835d" class="ji jj mg jk b jl jm is jn jo jp iv jq mh js jt ju mi jw jx jy mj ka kb kc kd hb bi translated">像会话这样的数据记录具有有限的生命周期，往往会呈指数级增长，并且需要高效地访问，因为它是身份认证流程中不可或缺的一部分，需要可靠的存储。目前，WSO2 Identity Server会话数据存储实现由关系数据库系统提供支持。但是对于大规模部署，最好使用高性能数据存储来归档预期吞吐量。</p></blockquote><p id="282d" class="pw-post-body-paragraph ji jj hi jk b jl jm is jn jo jp iv jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">这是给我的项目说明。描述的解释如下。</p><blockquote class="md me mf"><p id="64ad" class="ji jj mg jk b jl jm is jn jo jp iv jq mh js jt ju mi jw jx jy mj ka kb kc kd hb bi translated">我需要评估不同的数据库相关解决方案，并选择最适合的解决方案来满足WSO2 Identity Server的会话数据存储实现及其功能的要求。</p></blockquote><h2 id="dfd7" class="le lf hi bd lg lh li lj lk ll lm ln lo jr lp lq lr jv ls lt lu jz lv lw lx ho bi translated">技术研究</h2><p id="7e46" class="pw-post-body-paragraph ji jj hi jk b jl ly is jn jo lz iv jq jr ma jt ju jv mb jx jy jz mc kb kc kd hb bi translated">会话存储必须具有高性能、足够的可扩展性、高<a class="ae ld" href="https://blog.usejournal.com/availability-with-redis-66611f5a5e2b?source=your_stories_page-------------------------------------&amp;gi=6f55084b3906" rel="noopener ugc nofollow" target="_blank">可用性、</a>更重要的是，解决方案中还需要有<a class="ae ld" href="https://sthenusan.medium.com/data-persistence-with-redis-52b7d7cdfc53" rel="noopener">持久性</a>特性。我花了很多时间进行技术研究，并选择了一些解决方案，如Redis、Infinispan和Memcached。</p><figure class="ko kp kq kr fd ks"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="0549" class="pw-post-body-paragraph ji jj hi jk b jl jm is jn jo jp iv jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">经过项目组的大量讨论，我们最终决定使用Redis，因为我们拒绝了Memcached，因为它不具备<a class="ae ld" href="https://sthenusan.medium.com/data-persistence-with-redis-52b7d7cdfc53" rel="noopener">数据持久性</a>特性，并且由于Redis的可用性特性，我们更喜欢Redis而不是Infinispan。</p><h2 id="cdf5" class="le lf hi bd lg lh li lj lk ll lm ln lo jr lp lq lr jv ls lt lu jz lv lw lx ho bi translated">雷迪斯</h2><p id="af13" class="pw-post-body-paragraph ji jj hi jk b jl ly is jn jo lz iv jq jr ma jt ju jv mb jx jy jz mc kb kc kd hb bi translated">Redis代表远程词典服务器。它是内存中的键值数据存储。Redis支持应用程序的高吞吐量、可伸缩性和可用性。Redis因其高性能主要用于实时应用。将Redis用于WSO2 Identity Server中的会话存储使得会话存储具有高可用性、高可伸缩性、高性能和持久性。你可以在这里阅读更多关于T2的信息。</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es mm"><img src="../Images/761772f831bd7ef7bcdcd33fb4bf8f66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i1d88Q8NNrRv6kjf7Ssw4g.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx">Image Source: <a class="ae ld" href="https://en.wikipedia.org/wiki/Redis" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Redis</a></figcaption></figure><h2 id="4b92" class="le lf hi bd lg lh li lj lk ll lm ln lo jr lp lq lr jv ls lt lu jz lv lw lx ho bi translated">概念验证</h2><p id="f0d4" class="pw-post-body-paragraph ji jj hi jk b jl ly is jn jo lz iv jq jr ma jt ju jv mb jx jy jz mc kb kc kd hb bi translated">在我们选择Redis作为最合适的技术后，我们转向了POC。有效的概念证明可以证明提议项目的目标是可行的，并且将会成功。POC的价值在于它可以帮助软件工程师识别过程中可能会影响成功的差距。</p><p id="3f63" class="pw-post-body-paragraph ji jj hi jk b jl jm is jn jo jp iv jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我只实现了数据持久化SessionData方法和getSessionContextData方法，以在POC级别检查Redis的插入和检索功能。我也被迫在POC级别做出一些重要的决定。有一个大问题是如何在Redis服务器中存储对象和相关的元数据？。经过与项目团队成员的长时间讨论，我们决定将对象存储为序列化数组，将元数据存储为Redis中可用的hashmaps。你可以在这里找到更多关于对象序列化<a class="ae ld" href="https://medium.datadriveninvestor.com/redis-as-object-storage-e6a084b46f8b" rel="noopener ugc nofollow" target="_blank">的信息。我们选择Redis散列表来存储会话元数据。因为Hashmaps的Redis实现保存了大量数据，而不是简单地将其存储为键值对。</a></p><p id="d1f3" class="pw-post-body-paragraph ji jj hi jk b jl jm is jn jo jp iv jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">概念验证成功后，我进入了设计阶段。</p><h2 id="4c71" class="le lf hi bd lg lh li lj lk ll lm ln lo jr lp lq lr jv ls lt lu jz lv lw lx ho bi translated">会话存储重新设计</h2><p id="a808" class="pw-post-body-paragraph ji jj hi jk b jl ly is jn jo lz iv jq jr ma jt ju jv mb jx jy jz mc kb kc kd hb bi translated">项目团队希望将会话存储实现为可插拔组件，因此我创建了一个名为SessionDataStore的抽象父类，并创建了一个名为redissiondatastore的子类，它实现了会话存储。新的设计也能够在将来集成新的SessionStore实现。</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es mn"><img src="../Images/a0ab843b45a449bb4179608d488f43bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8BR6KzU5eV0bCszd"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx">Class Structure of Session Data Store for WSO2 Identity Server</figcaption></figure><h2 id="931a" class="le lf hi bd lg lh li lj lk ll lm ln lo jr lp lq lr jv ls lt lu jz lv lw lx ho bi translated">系统迁移设计</h2><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es mo"><img src="../Images/127eb9efe54d0787209d6821231c2769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sKDbwnyuQmQhkk5t"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx">Basic System Design</figcaption></figure><p id="ccd1" class="pw-post-body-paragraph ji jj hi jk b jl jm is jn jo jp iv jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">上面的设计图显示，数据的插入和删除发生在Redis端，通过<strong class="jk hs"> </strong> Redis <strong class="jk hs"> Set </strong>和<strong class="jk hs"> Get </strong>方法实现。但是数据删除以两种方式发生。这些是Redis和Redis expires特性的删除方法。让我们假设一个场景，</p><blockquote class="md me mf"><p id="0fd8" class="ji jj mg jk b jl jm is jn jo jp iv jq mh js jt ju mi jw jx jy mj ka kb kc kd hb bi translated">一个用户登录到一个系统，所以一个会话数据被创建，他/她在系统中做一些事情。然后关闭系统而不注销。这意味着会话已创建但未删除。</p></blockquote><p id="2889" class="pw-post-body-paragraph ji jj hi jk b jl jm is jn jo jp iv jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">当这种情况定期发生时，数据存储中将存储大量不需要的会话数据。数据库的大小随着时间的推移而增长。所以我们需要从数据库中删除这些条目。这里我使用了Redis Expire特性。所有数据记录在创建时都与到期时间相关联。当一个特定数据被更新时，到期时间也被更新。当用户退出系统时，数据还是会被删除。但是过期的未删除数据将通过此功能自动删除。</p><h2 id="e4fb" class="le lf hi bd lg lh li lj lk ll lm ln lo jr lp lq lr jv ls lt lu jz lv lw lx ho bi translated">履行</h2><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es mp"><img src="../Images/b44e314dfacef8354e3aa201eb93da8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BTmqlB1QV-cFxvmZ"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx">Photo by <a class="ae ld" href="https://unsplash.com/@brett_jordan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Brett Jordan</a> on <a class="ae ld" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="694c" class="pw-post-body-paragraph ji jj hi jk b jl jm is jn jo jp iv jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">因为我们创建了会话数据存储作为高级抽象，所以我只需要为Redis的整个流实现RedisSessionDataStore类。通过新的设计，每个新的会话数据存储实现都可以简单地插入到Identity Server中。Redis会话数据存储的基本框架能够从抽象父类中获取。实现是从框架开始的。</p><p id="a8b3" class="pw-post-body-paragraph ji jj hi jk b jl jm is jn jo jp iv jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">Redis会话数据存储是作为Identity Server的孵化器而构建的。我创建了一个单独的会话数据存储，也没有Redis实现。这将有助于那些不想要基于Redis的数据存储，而想用Infinispan等其他会话数据存储的用户。因此，用户可以简单地使用Redis included实现Redis功能，也可以使用Redis less实现，然后将Redis作为孵化器添加到附加功能中。</p><p id="4f35" class="pw-post-body-paragraph ji jj hi jk b jl jm is jn jo jp iv jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我已经给了以下项目中所有可交付成果的网址。你可以从那里下载。</p><ol class=""><li id="14b6" class="mq mr hi jk b jl jm jo jp jr ms jv mt jz mu kd mv mw mx my bi translated">此处给出的项目描述是GitHub中的一个问题。</li><li id="5693" class="mq mr hi jk b jl mz jo na jr nb jv nc jz nd kd mv mw mx my bi translated">Redis的会话数据存储实现在这里是<a class="ae ld" href="https://github.com/wso2/carbon-identity-framework/pull/3476" rel="noopener ugc nofollow" target="_blank"/>。</li><li id="d8c6" class="mq mr hi jk b jl mz jo na jr nb jv nc jz nd kd mv mw mx my bi translated">没有Redis的Session DataStore实现在这里是<a class="ae ld" href="https://github.com/wso2/carbon-identity-framework/pull/3482" rel="noopener ugc nofollow" target="_blank"/>。</li><li id="c701" class="mq mr hi jk b jl mz jo na jr nb jv nc jz nd kd mv mw mx my bi translated">Redis孵化器实现在这里给出<a class="ae ld" href="https://github.com/wso2-incubator/identity-session-data-store-redis/pull/1" rel="noopener ugc nofollow" target="_blank">。</a></li></ol><p id="2c53" class="pw-post-body-paragraph ji jj hi jk b jl jm is jn jo jp iv jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">带有WSO2身份服务器的Redis会话数据存储孵化器的配置在孵化器存储库的readme文件中给出<a class="ae ld" href="https://github.com/wso2-incubator/identity-session-data-store-redis/blob/main/README.md" rel="noopener ugc nofollow" target="_blank">此处</a>。</p></div><div class="ab cl ne nf gp ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="hb hc hd he hf"><p id="1a06" class="pw-post-body-paragraph ji jj hi jk b jl jm is jn jo jp iv jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我相信你已经理解了今天讨论的主题。如果您有任何问题或任何澄清，不要犹豫，通过回复部分与我联系。感谢您花费宝贵的时间阅读这篇文章。</p><p id="c0fd" class="pw-post-body-paragraph ji jj hi jk b jl jm is jn jo jp iv jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">干杯…</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es nl"><img src="../Images/f53ce0e732d9f2228b5a7df2c72e7023.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mdYMA8bjyLY9FJVf"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx">Photo by <a class="ae ld" href="https://unsplash.com/@the_socialmotion?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Nicholas Bartos</a> on <a class="ae ld" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div></div>    
</body>
</html>