<html>
<head>
<title>CDK Pipeline for C++ Lambda Deployment + API Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">C++ Lambda部署的CDK管道+ API网关</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/cdk-pipeline-for-c-lambda-deployment-api-gateway-418cb81a054c?source=collection_archive---------10-----------------------#2021-04-23">https://medium.com/geekculture/cdk-pipeline-for-c-lambda-deployment-api-gateway-418cb81a054c?source=collection_archive---------10-----------------------#2021-04-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c8d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">本文参考AWS CDK文档</em> <a class="ae je" href="https://docs.aws.amazon.com/cdk/latest/guide/home.html" rel="noopener ugc nofollow" target="_blank"> <em class="jd">此处</em> </a> <em class="jd">而建。请随意参考AWS CDK官方文档的网站。而对于C++在lambda上引用的</em> <a class="ae je" href="https://aws.amazon.com/blogs/compute/introducing-the-c-lambda-runtime/" rel="noopener ugc nofollow" target="_blank"> <em class="jd">这里的</em> </a> <em class="jd">。</em></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/b65485ee0427a28ddf922956be141537.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WmGIMtsWiZ1BEYa21sHBYg.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx">Source: <a class="ae je" href="https://docs.aws.amazon.com/cdk/latest/guide/home.html" rel="noopener ugc nofollow" target="_blank">https://docs.aws.amazon.com/cdk/latest/guide/home.html</a></figcaption></figure><p id="0b2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本实验中，我们将重点关注两个核心理念。一个是自定义运行时C++到lambda的部署过程，另一个是我们如何在这个想法的基础上构建CI/CD管道，以及如何通过AWS CDK来实现。</p><ul class=""><li id="7671" class="jv jw hi ih b ii ij im in iq jx iu jy iy jz jc ka kb kc kd bi translated"><strong class="ih hj">第1部分:</strong> C++ Lambda</li><li id="b97c" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated"><strong class="ih hj">第2部分:</strong> AWS CDK管道</li></ul><p id="b1a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，如果你像我一样回到2019年，在我科技职业生涯的早期，还在大学时第一次学习云，当CDK在2019年7月发布时，你没有注意到。不要误解我的意思，炒作是存在的，从文章到我自己的经理都强烈建议我学习它。然而，在尝试学习云基础知识的过程中，我错过了机会，直到几周前。</p><p id="cb6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你只能从这个实验室得到一样东西，请记住这些话，<strong class="ih hj">去学习AWS CDK。</strong>CDK是一个如此强大的工具，它建立在cloudformation之上，只需几个命令就能轻松部署完整的管道基础设施。毫不夸张地说，基础设施就是代码，使它成为一个如此强大的工具，我可以预见自己在不久的将来会使用它。</p></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><h1 id="b426" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">Lambda上的C++</h1><p id="4ee9" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">因为lambda是我的最终目标，所以我选择使用本机AWS IDE服务Cloud9，作为手动部署到lambda的主要开发环境。其原因包括:</p><ul class=""><li id="8f2e" class="jv jw hi ih b ii ij im in iq jx iu jy iy jz jc ka kb kc kd bi translated">自动生成AWS凭据，以便您的IDE可以本机使用全套AWS资源。</li><li id="b408" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">如果你打破了IDE，你可以简单地旋转一个全新的。</li><li id="48c9" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">一致性，遵循此实验应该是一致的，因为Cloud9的默认映像将带有我在运行实验时使用的相同系统配置。</li></ul><h2 id="f722" class="lt kr hi bd ks lu lv lw kw lx ly lz la iq ma mb le iu mc md li iy me mf lm mg bi translated">设置您的Cloud9 IDE</h2><p id="15a6" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">登录你的AWS账户，导航到cloud9服务。</p><p id="1280" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从服务&gt;<strong class="ih hj">创建环境</strong>并给你的IDE命名。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es mh"><img src="../Images/df2ed9843b080a010dc26ee150083c56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o8qlNpYpNJ3_3tUzN_u1VA.png"/></div></div></figure><p id="3d1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在“配置设置”页面上，唯一需要更改的是确保将实例类型设置为<strong class="ih hj"> t3.medium. </strong>这将有助于平衡计算负载，因为微处理器可能会冻结。</p><p id="23d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后单击<strong class="ih hj">下一步</strong> &gt; <strong class="ih hj">创建环境</strong>，然后您应该会被重定向到您新创建的IDE。</p><p id="6b7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">添加内存</strong></p><p id="3374" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们要做的最后一件事是向我们的cloud9添加内存，这样它就不会耗尽空间，我们可以通过创建一个resize.sh文件来实现这一点。</p><pre class="jg jh ji jj fd mi mj mk ml aw mm bi"><span id="89cc" class="lt kr hi mj b fi mn mo l mp mq">cd ~/environment<br/>touch resize.sh</span></pre><p id="79ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将在您的cloud9中创建一个resize.sh文件，然后您可以将下面的代码复制到该文件中，该文件来自<a class="ae je" href="https://docs.aws.amazon.com/cloud9/latest/user-guide/move-environment.html" rel="noopener ugc nofollow" target="_blank">这里的</a>。</p><pre class="jg jh ji jj fd mi mj mk ml aw mm bi"><span id="73c1" class="lt kr hi mj b fi mn mo l mp mq">#!/bin/bash</span><span id="eded" class="lt kr hi mj b fi mr mo l mp mq"># Specify the desired volume size in GiB as a command line argument. If not specified, default to 20 GiB.<br/>SIZE=${1:-20}</span><span id="089e" class="lt kr hi mj b fi mr mo l mp mq"># Get the ID of the environment host Amazon EC2 instance.<br/>INSTANCEID=$(curl <a class="ae je" href="http://169.254.169.254/latest/meta-data/instance-id)" rel="noopener ugc nofollow" target="_blank">http://169.254.169.254/latest/meta-data/instance-id)</a></span><span id="c199" class="lt kr hi mj b fi mr mo l mp mq"># Get the ID of the Amazon EBS volume associated with the instance.<br/>VOLUMEID=$(aws ec2 describe-instances \<br/>  --instance-id $INSTANCEID \<br/>  --query "Reservations[0].Instances[0].BlockDeviceMappings[0].Ebs.VolumeId" \<br/>  --output text)</span><span id="f641" class="lt kr hi mj b fi mr mo l mp mq"># Resize the EBS volume.<br/>aws ec2 modify-volume --volume-id $VOLUMEID --size $SIZE</span><span id="bf66" class="lt kr hi mj b fi mr mo l mp mq"># Wait for the resize to finish.<br/>while [ \<br/>  "$(aws ec2 describe-volumes-modifications \<br/>    --volume-id $VOLUMEID \<br/>    --filters Name=modification-state,Values="optimizing","completed" \<br/>    --query "length(VolumesModifications)"\<br/>    --output text)" != "1" ]; do<br/>sleep 1<br/>done</span><span id="3a53" class="lt kr hi mj b fi mr mo l mp mq">#Check if we're on an NVMe filesystem<br/>if [ $(readlink -f /dev/xvda) = "/dev/xvda" ]<br/>then<br/>  # Rewrite the partition table so that the partition takes up all the space that it can.<br/>  sudo growpart /dev/xvda 1<br/>  # Expand the size of the file system.<br/>  # Check if we are on AL2<br/>  STR=$(cat /etc/os-release)<br/>  SUB="VERSION_ID=\"2\""<br/>  if [[ "$STR" == *"$SUB"* ]]<br/>  then<br/>    sudo xfs_growfs -d /<br/>  else<br/>    sudo resize2fs /dev/xvda1<br/>  fi</span><span id="7e09" class="lt kr hi mj b fi mr mo l mp mq">else<br/>  # Rewrite the partition table so that the partition takes up all the space that it can.<br/>  sudo growpart /dev/nvme0n1 1<br/>  # Expand the size of the file system.<br/>  # Check if we're on AL2<br/>  STR=$(cat /etc/os-release)<br/>  SUB="VERSION_ID=\"2\""<br/>  if [[ "$STR" == *"$SUB"* ]]<br/>  then<br/>    sudo xfs_growfs -d /<br/>  else<br/>    sudo resize2fs /dev/nvme0n1p1<br/>  fi<br/>fi</span></pre><p id="0def" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该文件将通过cli为您自动调整大小。要运行它，请运行以下命令。</p><pre class="jg jh ji jj fd mi mj mk ml aw mm bi"><span id="3b99" class="lt kr hi mj b fi mn mo l mp mq">bash resize.sh 20</span></pre><h2 id="32e4" class="lt kr hi bd ks lu lv lw kw lx ly lz la iq ma mb le iu mc md li iy me mf lm mg bi translated">安装依赖项</h2><p id="b221" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">为了部署到lambda，我们必须将代码打包成lambda可以理解的zip文件。为此，我们需要以下两个库:</p><ul class=""><li id="6051" class="jv jw hi ih b ii ij im in iq jx iu jy iy jz jc ka kb kc kd bi translated">aws-sdk-cpp</li><li id="554a" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated">aws-lambda-cpp</li></ul><p id="15c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，让我们用以下命令在您的终端中安装cmake3和必要的包</p><pre class="jg jh ji jj fd mi mj mk ml aw mm bi"><span id="f069" class="lt kr hi mj b fi mn mo l mp mq">sudo yum install libcurl-devel cmake3 -y</span></pre><p id="fdce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们将安装AWS C++ SDK。</p><pre class="jg jh ji jj fd mi mj mk ml aw mm bi"><span id="bfce" class="lt kr hi mj b fi mn mo l mp mq">cd ~/environment<br/>git clone --recurse-submodules <a class="ae je" href="https://github.com/aws/aws-sdk-cpp" rel="noopener ugc nofollow" target="_blank">https://github.com/aws/aws-sdk-cpp</a><br/>cd aws-sdk-cpp<br/>mkdir build<br/>cd build<br/>cmake3 .. -DBUILD_ONLY=s3 -DBUILD_SHARED_LIBS=OFF -DENABLE_UNITY_BUILD=ON -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=~/environment/out<br/>make &amp;&amp; make install</span></pre><p id="febb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将只构建我们计划在部署到lambda时使用的S3库。</p><p id="3d6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来我们需要下载c++运行时并编译它</p><pre class="jg jh ji jj fd mi mj mk ml aw mm bi"><span id="d235" class="lt kr hi mj b fi mn mo l mp mq">cd ~/environment<br/>git clone <a class="ae je" href="https://github.com/awslabs/aws-lambda-cpp.git" rel="noopener ugc nofollow" target="_blank">https://github.com/awslabs/aws-lambda-cpp.git</a><br/>cd aws-lambda-cpp<br/>mkdir build<br/>cd build<br/>cmake3 .. -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF -DCMAKE_INSTALL_PREFIX=~/environment/out<br/>make &amp;&amp; make install</span></pre><p id="821a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将编译必要的静态库，并将它们存储在~/environment/out文件夹中。</p><p id="e33f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太棒了，你现在应该有了构建lambda所需的所有依赖项。</p><h2 id="348b" class="lt kr hi bd ks lu lv lw kw lx ly lz la iq ma mb le iu mc md li iy me mf lm mg bi translated">部署Lambda(手动)</h2><p id="bbee" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">在这一节中，我将向您展示如何将一个测试函数手动部署到lambda。</p><p id="80b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先克隆示例项目。</p><pre class="jg jh ji jj fd mi mj mk ml aw mm bi"><span id="23e7" class="lt kr hi mj b fi mn mo l mp mq">cd ~/environment<br/>git clone <a class="ae je" href="https://github.com/oconpa/s3-cpp-read.git" rel="noopener ugc nofollow" target="_blank">https://github.com/oconpa/s3-cpp-read.git</a><br/>cd s3-cpp-read</span></pre><p id="cb4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你进入这个文件夹，我们可以用下面的命令来构建这个包。</p><pre class="jg jh ji jj fd mi mj mk ml aw mm bi"><span id="024a" class="lt kr hi mj b fi mn mo l mp mq">mkdir build &amp;&amp; cd build<br/>cmake3 .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_PREFIX_PATH=~/environment/s3-cpp-read/out<br/>make<br/>make aws-lambda-package-s3Read</span></pre><p id="43b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果一切顺利，您现在应该看到在<strong class="ih hj"> s3-cpp-read/build </strong>中生成的压缩文件，这就是您将上传到lambda的内容。随意参考<a class="ae je" href="https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-package.html" rel="noopener ugc nofollow" target="_blank">这个</a>手动做，否则下面的CDK部分将做所有和更多。</p><h1 id="63bb" class="kq kr hi bd ks kt ms kv kw kx mt kz la lb mu ld le lf mv lh li lj mw ll lm ln bi translated">CDK管道(CI/CD)</h1><p id="5ec6" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">所以你有你的lambda工作，现在准备把它放到一个管道中。为此，我们将使用自动气象站CDK。通过对终端的几个命令，您的管道应该已经启动并运行了。</p><p id="c43a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从你的cloud9中，由于cdk是预装的，你需要提取cdk管道代码。</p><pre class="jg jh ji jj fd mi mj mk ml aw mm bi"><span id="b82a" class="lt kr hi mj b fi mn mo l mp mq">cd ~/environment<br/>git clone <a class="ae je" href="https://github.com/oconpa/cdk-pipeline-cpp-lambda.git" rel="noopener ugc nofollow" target="_blank">https://github.com/oconpa/cdk-pipeline-cpp-lambda.git</a><br/>cd <a class="ae je" href="https://github.com/oconpa/cdk-pipeline-cpp-lambda.git" rel="noopener ugc nofollow" target="_blank">cdk-pipeline-cpp-lambda</a></span></pre><p id="bb5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从这里开始，您应该能够运行以下命令，并让您的整个基础设施在云中运行。</p><blockquote class="mx my mz"><p id="5bfd" class="if ig jd ih b ii ij ik il im in io ip na ir is it nb iv iw ix nc iz ja jb jc hb bi translated">如果您在运行下面的cdk bootstrap命令时收到有关缺少模块的任何错误，请再次运行npm install，因为第一次可能没有安装该模块。</p></blockquote><pre class="jg jh ji jj fd mi mj mk ml aw mm bi"><span id="59e5" class="lt kr hi mj b fi mn mo l mp mq">npm install<br/>cdk bootstrap<br/>cdk deploy</span></pre><p id="8801" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的命令将下载相关的依赖项，引导你的cdk帐户，将你的代码合成到cloudformation模板中，并将其部署到云中。</p><p id="a648" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你看一下lib/pipeline-stack.ts文件，你会看到一切是如何相互联系的。</p><pre class="jg jh ji jj fd mi mj mk ml aw mm bi"><span id="6b01" class="lt kr hi mj b fi mn mo l mp mq">import * as cdk from '@aws-cdk/core';<br/>import * as codecommit from '@aws-cdk/aws-codecommit';<br/>import * as codebuild from '@aws-cdk/aws-codebuild';<br/>import * as codepipeline from '@aws-cdk/aws-codepipeline';<br/>import * as codepipeline_actions from '@aws-cdk/aws-codepipeline-actions';<br/>import * as s3 from '@aws-cdk/aws-s3';<br/>import * as lambda from '@aws-cdk/aws-lambda';<br/>import * as apigw from '@aws-cdk/aws-apigateway';<br/>import * as iam from '@aws-cdk/aws-iam';</span><span id="7d43" class="lt kr hi mj b fi mr mo l mp mq">export class PipelineStack extends cdk.Stack {<br/>   constructor(scope: cdk.Construct, id: string, props?: cdk.StackProps) {<br/>   super(scope, id, props);<br/>   const bucket = new s3.Bucket(this, 'C++ Bucket');<br/>   <br/>   const func = new lambda.Function(this, 'MyFunction', {<br/>     runtime: lambda.Runtime.PROVIDED,<br/>     handler: 's3Read',<br/>     code: lambda.Code.fromAsset('./lambda/s3Read.zip'),<br/>     environment: {<br/>       'Bucket': bucket.bucketName<br/>     }<br/>   });<br/>   <br/>   bucket.grantReadWrite(func);</span><span id="5e23" class="lt kr hi mj b fi mr mo l mp mq">   new apigw.LambdaRestApi(this, 'Endpoint', {<br/>     handler: func<br/>   });</span><span id="f5c8" class="lt kr hi mj b fi mr mo l mp mq">   const repository = new codecommit.Repository(this, 'CppOnLambdaRepo', {<br/>     repositoryName: "CppOnLambdaRepo",<br/>     description: 'Where you will store your CDK for C++ Lambda'<br/>   });<br/>   <br/>   const project = new codebuild.PipelineProject(this, 'CppOnLambda', {<br/>       projectName: 'CppOnLambda',<br/>       cache: codebuild.Cache.bucket(new s3.Bucket(this, 'Bucket')),<br/>       environment: {<br/>         buildImage: codebuild.LinuxBuildImage.AMAZON_LINUX_2_3<br/>       },<br/>       buildSpec: codebuild.BuildSpec.fromObject({<br/>       version: '0.2',<br/>       phases: {<br/>       install: {<br/>         commands: [<br/>           'echo Entered the install phase...',<br/>           'yum install -y cmake3',<br/>           'cmake3 --version'<br/>         ]<br/>       },<br/>       build: {<br/>         commands: [<br/>           'echo Entered the build phase...',<br/>           'mkdir build &amp;&amp; cd build',<br/>           'cmake3 .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_PREFIX_PATH=out',<br/>           'make',<br/>           'make aws-lambda-package-s3Read'<br/>         ]<br/>       },<br/>       post_build: {<br/>         commands: [<br/>           'echo Publishing code at `date`',<br/>           'aws lambda update-function-code --function-name ' + func.functionName + ' --zip-file fileb://s3Read.zip'<br/>         ]<br/>       }<br/>     }<br/>   })<br/>})</span><span id="294e" class="lt kr hi mj b fi mr mo l mp mq">project.addToRolePolicy(new iam.PolicyStatement({<br/>   resources: [func.functionArn],<br/>   actions: ['lambda:UpdateFunctionCode']<br/>   }));</span><span id="50aa" class="lt kr hi mj b fi mr mo l mp mq">const sourceOutput = new codepipeline.Artifact();<br/>const sourceAction = new codepipeline_actions.CodeCommitSourceAction({<br/>   actionName: 'CodeCommit',<br/>   repository,<br/>   output: sourceOutput,<br/>});</span><span id="9462" class="lt kr hi mj b fi mr mo l mp mq">const buildAction = new codepipeline_actions.CodeBuildAction({<br/>   actionName: 'CodeBuild',<br/>   project,<br/>   input: sourceOutput<br/>});</span><span id="1f23" class="lt kr hi mj b fi mr mo l mp mq">new codepipeline.Pipeline(this, 'MyPipeline', {<br/>   stages: [<br/>     {<br/>       stageName: 'Source',<br/>       actions: [sourceAction],<br/>     },<br/>     {<br/>       stageName: 'Build',<br/>       actions: [buildAction],<br/>     }<br/>   ],<br/>});</span><span id="bc98" class="lt kr hi mj b fi mr mo l mp mq">}</span><span id="86dc" class="lt kr hi mj b fi mr mo l mp mq">}</span></pre><p id="b5be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要查看部署是否成功，请导航到您的AWS帐户以查看以下服务:</p><ul class=""><li id="0d16" class="jv jw hi ih b ii ij im in iq jx iu jy iy jz jc ka kb kc kd bi translated">CodeCommit :你应该看到一个新的cpp repo，它在创建时应该是空的，但是这是你上传代码的地方。如果您将我们在上面克隆的repo S3-CPP-read上传到repo中，这将触发部署。</li><li id="ddb5" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated"><strong class="ih hj"> CodePipeline </strong>:在CodePipeline中，您应该会看到一个链接到刚刚创建的repo的新管道。它首先会失败，因为回购中还没有代码，但一旦你上传，它就会构建并部署到lambda。</li><li id="4608" class="jv jw hi ih b ii ke im kf iq kg iu kh iy ki jc ka kb kc kd bi translated"><strong class="ih hj"> Lambda </strong>:运行您的c++定制运行时的代码将会存在，为了说明它的工作原理，请导航到函数&gt;测试页面，并使用以下参数进行调用:</li></ul><pre class="jg jh ji jj fd mi mj mk ml aw mm bi"><span id="2087" class="lt kr hi mj b fi mn mo l mp mq">{<br/>   "s3bucket": "Name of a bucket in your account",<br/>   "s3key": "Name of a text file or image in that bucket"<br/>}</span></pre><p id="2aad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果用它来调用，应该会收到文件内容。</p><ul class=""><li id="a1ba" class="jv jw hi ih b ii ij im in iq jx iu jy iy jz jc ka kb kc kd bi translated"><strong class="ih hj"> API网关</strong>:最后但并非最不重要的是，一个API也将被创建链接到lambda函数。</li></ul><p id="b86c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该文件设置为运行该ci/cd管道所需的所有基础设施。CDK是一个非常强大的工具，当它涉及到更多的DevOps方面的事情。真正欣赏它的唯一方法是在你自己的项目中使用它，所以一旦你完成并看了这个项目，我会鼓励你把你学到的东西应用到你的个人项目中。</p></div></div>    
</body>
</html>