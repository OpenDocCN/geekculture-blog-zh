<html>
<head>
<title>Creating a Choropleth Map of State Unemployment Rates With Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Plotly创建州失业率的Choropleth图</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/create-a-choropleth-map-of-state-unemployment-rates-with-plotly-1354050e0cfd?source=collection_archive---------5-----------------------#2021-03-11">https://medium.com/geekculture/create-a-choropleth-map-of-state-unemployment-rates-with-plotly-1354050e0cfd?source=collection_archive---------5-----------------------#2021-03-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ff4513eac6d68c5f1c2793a5d7da4fee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vxhw9bMizuxoWXRU"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@mgshannon?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Michael Shannon</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1182" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">随着美国经济开始从新冠肺炎疫情的严重程度中复苏，各州开始取消对商业活动的限制，重要的是要了解每个州正在经历不同的劳动力市场状况，对于面临较高失业率的地区来说，复苏之路将更加艰难。美国劳工统计局是这一主题数据的具体来源，它定期在网站上公布各州的<a class="ae iu" href="https://www.bls.gov/web/laus/laumstrk.htm" rel="noopener ugc nofollow" target="_blank">失业率。使用Python中的Plotly，可以获取这些数据来创建choropleth地图，突出显示全国劳动力市场状况的差异。</a></p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="a077" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为方便起见，本指南将介绍Jupyter笔记本的制作，它:</p><ol class=""><li id="6900" class="ka kb hi ix b iy iz jc jd jg kc jk kd jo ke js kf kg kh ki bi translated">抓取劳动统计局页面上的可用数据，并将其转换为熊猫数据框架。</li><li id="5dc6" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">操纵熊猫数据帧，使其在绘图时达到理想的choropleth可视化。</li><li id="eebd" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">使用Plotly创建choropleth地图。</li></ol><p id="2c3a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本指南也以这样一种方式划分，你可以从每一部分中得到你想要的，并将其应用于你自己的方法和期望的结果。</p><p id="38d2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Python中必须安装的必要包有:</p><ul class=""><li id="04b3" class="ka kb hi ix b iy iz jc jd jg kc jk kd jo ke js ko kg kh ki bi translated">熊猫</li><li id="459f" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js ko kg kh ki bi translated">要求</li><li id="0127" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js ko kg kh ki bi translated">美丽的声音</li><li id="99f5" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js ko kg kh ki bi translated">Plotly</li></ul></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="b6b9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，您需要导入上面提到的包。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="d2c9" class="ky kz hi ku b fi la lb l lc ld">import pandas as pd<br/>import requests<br/>from bs4 import BeautifulSoup<br/>import plotly.express as px</span></pre><p id="3dce" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从这里开始，接下来的两步是分配URL和创建GET请求。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="256b" class="ky kz hi ku b fi la lb l lc ld">url = '<a class="ae iu" href="https://www.bls.gov/web/laus/laumstrk.htm'" rel="noopener ugc nofollow" target="_blank">https://www.bls.gov/web/laus/laumstrk.htm'</a><br/>req = requests.get(url)</span></pre><p id="2a4c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">之后，解析内容并选择将要使用的表。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="111d" class="ky kz hi ku b fi la lb l lc ld">soup = BeautifulSoup(req.content, 'lxml')<br/>table = soup.find_all('table')</span></pre><p id="97b2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">转换到下面的Pandas数据框架可以处理大部分需要的东西，但是要确保你的数据是干净的，并且格式正确。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="4934" class="ky kz hi ku b fi la lb l lc ld">df = pd.read_html(str(table))[0]</span></pre><p id="f911" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过使用<code class="du le lf lg ku b">display()</code>检查到目前为止加载了什么显示最后两行包含不必要的数据。</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/b35c078aa7ee2df70aad7920506d108a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LtngHzxE3DrNptttfSNI9g.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Inspecting your DataFrame in Jupyter Notebook is both easy and helpful</figcaption></figure><p id="03b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用<code class="du le lf lg ku b">.drop()</code>按索引位置删除最后两行，按名称删除“Rank”列将删除不需要的元素。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="50e2" class="ky kz hi ku b fi la lb l lc ld">df = df.drop([df.index[51], df.index[52]])<br/>df = df.drop('Rank', 1)</span></pre><p id="2bb6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设劳工统计局页面的原始结构没有改变，包含失业率值的列将始终位于相同的位置，因此可以通过使用<code class="du le lf lg ku b">.rename()</code>并标识列位置而不是名称来重命名该列，以反映最新(或当前)的失业率。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="07d2" class="ky kz hi ku b fi la lb l lc ld">df = df.rename(columns={df.columns[1]:'Current Unemployment Rate'})</span></pre><p id="d411" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因为这个列中包含的值是数字，所以确保它们被转换成<code class="du le lf lg ku b">float</code>是很重要的，这样以后Plotly就不会将这些值解释为对象。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="197f" class="ky kz hi ku b fi la lb l lc ld">df['Current Unemployment Rate'] = df['Current Unemployment Rate'].astype(str).astype(float)</span></pre><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/d3a3c193194c83a20188335ac00cd85f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p74vlfGk9SBo_Heg6xAX1Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">The steps outlined above reflect the bulk of the DataFrame manipulation that will be needed</figcaption></figure><p id="67fa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Plotly使用缩写的两个字母的邮政编码来表示州的位置，因此有必要创建一个包含州的全名到缩写的转换的字典。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="df46" class="ky kz hi ku b fi la lb l lc ld">code = {'Alabama': 'AL',<br/>        'Alaska': 'AK',<br/>        'Arizona': 'AZ',<br/>        'Arkansas': 'AR',<br/>        'California': 'CA',<br/>        'Colorado': 'CO',<br/>        'Connecticut': 'CT',<br/>        'Delaware': 'DE',<br/>        'District of Columbia': 'DC',<br/>        'Florida': 'FL',<br/>        'Georgia': 'GA',<br/>        'Hawaii': 'HI',<br/>        'Idaho': 'ID',<br/>        'Illinois': 'IL',<br/>        'Indiana': 'IN',<br/>        'Iowa': 'IA',<br/>        'Kansas': 'KS',<br/>        'Kentucky': 'KY',<br/>        'Louisiana': 'LA',<br/>        'Maine': 'ME',<br/>        'Maryland': 'MD',<br/>        'Massachusetts': 'MA',<br/>        'Michigan': 'MI',<br/>        'Minnesota': 'MN',<br/>        'Mississippi': 'MS',<br/>        'Missouri': 'MO',<br/>        'Montana': 'MT',<br/>        'Nebraska': 'NE',<br/>        'Nevada': 'NV',<br/>        'New Hampshire': 'NH',<br/>        'New Jersey': 'NJ',<br/>        'New Mexico': 'NM',<br/>        'New York': 'NY',<br/>        'North Carolina': 'NC',<br/>        'North Dakota': 'ND',<br/>        'Ohio': 'OH',<br/>        'Oklahoma': 'OK',<br/>        'Oregon': 'OR',<br/>        'Pennsylvania': 'PA',<br/>        'Rhode Island': 'RI',<br/>        'South Carolina': 'SC',<br/>        'South Dakota': 'SD',<br/>        'Tennessee': 'TN',<br/>        'Texas': 'TX',<br/>        'Utah': 'UT',<br/>        'Vermont': 'VT',<br/>        'Virginia': 'VA',<br/>        'Washington': 'WA',<br/>        'West Virginia': 'WV',<br/>        'Wisconsin': 'WI',<br/>        'Wyoming': 'WY'}</span></pre><p id="54b1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，通过使用<code class="du le lf lg ku b">.map()</code>创建一个新的对应列，包含每个州的所有缩写代码，可以将该字典应用于“州”列。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="5304" class="ky kz hi ku b fi la lb l lc ld">df['Code'] = df['State'].map(code)</span></pre><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/e9cb7113bbbcf61ca85edda797c954bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j2rw_RtEeR3vmmAXTR3nBQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Finally ready for Plotly</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="6842" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用Plotly创建choropleth地图是通过使用<code class="du le lf lg ku b">px.choropleth()</code>和指定可视化参数来完成的。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="d2f6" class="ky kz hi ku b fi la lb l lc ld">fig = px.choropleth(df,<br/>                    locations='Code',<br/>                    color='Current Unemployment Rate',<br/>                    color_continuous_scale='spectral_r',<br/>                    hover_name='State',<br/>                    locationmode='USA-states',<br/>                    labels={'Current Unemployment Rate':'Unemployment Rate %'},<br/>                    scope='usa')</span></pre><p id="d6e9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，<code class="du le lf lg ku b">df</code>确定了我们打算使用的数据帧。使用<code class="du le lf lg ku b">locations</code>指定包含Plotly使用的两个字母的州缩写的“Code”列。在地图上，通过使用<code class="du le lf lg ku b">color</code>和<code class="du le lf lg ku b">color_continuous_scale</code>来区分这些值，以说明各州之间的差异。请注意，<code class="du le lf lg ku b">spectral_r</code>色标只是<code class="du le lf lg ku b">spectral</code>颠倒了，因为用红色而不是蓝色来说明高失业率更直观。在这种情况下，<code class="du le lf lg ku b">locationmode</code>用于将几何图形标识为<code class="du le lf lg ku b">USA-states</code>。最后，<code class="du le lf lg ku b">scope</code>缩小地图范围，以便在呈现地图时消除美国以外的任何元素。</p><p id="96ce" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">准备就绪后，使用<code class="du le lf lg ku b">.show()</code>显示交互式地图。</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/e10650a9629c877a6f3b844e218cb273.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S1P8HqsMrCCgIIq-knp_BQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">The basic foundation of the choropleth map should now be visible</figcaption></figure><p id="75cb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您想添加更多的视觉信息，您可以使用<code class="du le lf lg ku b">.add_scattergeo()</code>为每个状态添加文本标签，如下所示。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="4db1" class="ky kz hi ku b fi la lb l lc ld">fig.add_scattergeo(<br/>    locations=df['Code'],<br/>    locationmode='USA-states',<br/>    text=df['Code'],<br/>    mode='text')</span></pre><p id="daa0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您也可以使用<code class="du le lf lg ku b">.update_layout()</code>为地图添加标题，并使文本居中，因为默认情况下，Plotly会将标题文本放在左上角。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="09ef" class="ky kz hi ku b fi la lb l lc ld">fig.update_layout(<br/>    title={'text':'Current Unemployment Rate by State',<br/>           'xanchor':'center',<br/>           'yanchor':'top',<br/>           'x':0.5})</span></pre><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/8b7a37936b4455e44d2adacb5d079efc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5-NXBbB_WjywgUEAN_JaOA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Even a small amount of additional visual information can go a long way</figcaption></figure><p id="19d5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，通过选择PNG渲染器，您可以在<code class="du le lf lg ku b">.show()</code>中使用静态渲染器来创建图像，而不是交互式地图。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="3f9f" class="ky kz hi ku b fi la lb l lc ld">fig.show(renderer='png', height=700, width=1400)</span></pre><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/e41b4cfffc86179053ee4217d6381abc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QMmyeq8LWjjDnUWzH7WHOw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">A static PNG allows for greater flexibility in terms of sharing your map than the default Plotly renderer</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="0732" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">希望这份指南能为任何对劳动力市场指标或数据可视化感兴趣的人提供一个很好的起点和灵感来源。使用Plotly创建这些类型的地图的好处在于，它提供了自定义最终输出的每个方面的自由。您可以创建定制的色标、标签、注释、标题，以及几乎所有其他粒度级别的东西，这是使用其他工具很难做到的。Plotly还提供了将其他Python包(如BeautifulSoup和Pandas)无缝、快速地结合起来的便利，这意味着不需要同时处理多个应用程序。所以，继续策划吧！</p></div></div>    
</body>
</html>