<html>
<head>
<title>R-Squared, Adjusted R-Squared and the Degree of Freedom</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R平方、调整的R平方和自由度</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/r-squared-adjusted-r-squared-and-the-degree-of-freedom-80e7203a7e27?source=collection_archive---------10-----------------------#2021-08-25">https://medium.com/geekculture/r-squared-adjusted-r-squared-and-the-degree-of-freedom-80e7203a7e27?source=collection_archive---------10-----------------------#2021-08-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="0383" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated"><strong class="ak">用于确定回归模型中拟合优度的度量</strong></h2></div><h2 id="5bcd" class="ix iy hi bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated"><strong class="ak"> R平方(R ) </strong></h2><p id="c494" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ji ke kf kg jm kh ki kj jq kk kl km kn hb bi translated">当我们执行回归时，模型对回归的拟合程度取决于我们预处理数据的程度以及我们用于拟合回归模型的算法。现在需要某种度量标准来确定拟合度有多好。<br/> R平方(也用<strong class="jx hj"> R </strong>表示)就是这些指标之一。让我们来理解一下<strong class="jx hj"> R </strong>的概念。</p><p id="e0cc" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">让我们举一个例子，我们有前5天的温度记录，以摄氏度为单位，分别是:32、24、26、30和28。根据过去5天的给定值，我们可以预测第6天的温度的一个最简单的方法是取这些温度的平均值，即28摄氏度。</p><p id="360d" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">虽然平均预测的方法在最初看起来可行，但是随着将来温度的实际新值，这种预测方法可能不可行，这取决于新值的大小。我们可能不得不再次重新计算新的平均值，并按照相同的过程进行预测。</p><p id="090f" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">现在，让我们绘制一个简单数据集的图表，该数据集具有单个自变量'<strong class="jx hj"> x </strong>'和因变量'<strong class="jx hj"> y </strong>'。计算Y平均值，Y平均值线(<strong class="jx hj">由Y条</strong>指示)也绘制在下图中。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es kt"><img src="../Images/e8a63dacc8f76172097e02bd29025ac0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*XRlvMV7QAIaNi8BVceagMQ.jpeg"/></div></figure><p id="61fd" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">正如我们从上图中观察到的，y的实际值和y的平均值之间存在偏差。这叫做<em class="lb">平均偏差</em>。<br/>现在，在下面更新的图表中，红线表示每个数据点的平均偏差。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lc"><img src="../Images/c31e4736e3162723654ed4be4aa71b0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*Lv5jwehlOmNRKnXLdzJt2Q.jpeg"/></div></div></figure><p id="c85a" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">注意<em class="lb"/><em class="lb">的平均偏差总和将为零</em>。因此，为了避免这种使平均值之和为零的影响，我们对每个平均偏差取平方，然后求和。</p><blockquote class="lh li lj"><p id="4725" class="jv jw lb jx b jy ko ij ka kb kp im kd lk kq kf kg ll kr ki kj lm ks kl km kn hb bi translated">这个均方差的平方和称为<strong class="jx hj"> TSS(总平方和)。</strong></p></blockquote><p id="181b" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">现在让我们为给定数据拟合一条回归线(L ),如下所示:</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es ln"><img src="../Images/a8c571cc6ef54a83cc779e1190daebaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*xp3zlwv-jKYl530STVxEbg.jpeg"/></div></figure><p id="f81d" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">如果我们仔细观察上面的图表，我们会注意到预测值(回归线‘L’上的y值)比y平均线上的值更接近实际值。<br/>回归线上的平均值和预测值之间的距离表示模型解释了多少。</p><p id="1578" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated"><em class="lb">为了简单和更好地解释，让我们考虑仅参考一个数据点，假设我们在参考这一个数据点来解释概念时正在考虑其余的数据点。</em></p><p id="7c63" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">现在，如果我们对回归线上的预测值和Y均值之间的所有距离进行平方和，那么这个和就称为<strong class="jx hj"> ESS(解释平方和)</strong>。<br/>预测值和实际值之间的距离被称为残差(误差)，如果我们取每个残差的平方并求和，那么这被称为<strong class="jx hj"> RSS(残差平方和)</strong>。</p><p id="ff2e" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">下图显示了TSS、RSS和ESS。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es lo"><img src="../Images/7919c4e97c32bc79b5cbe055a63387c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*hWPSYefPAL3WbV4Mjg78Iw.jpeg"/></div></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es lp"><img src="../Images/7b7b170d154a06af0a050e2cf6ffae5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/format:webp/1*hkVjQ-tcT5WKh3ers_74wA.png"/></div><figcaption class="lq lr et er es ls lt bd b be z dx">Total Sum of Squares</figcaption></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es lu"><img src="../Images/bdcffbaf991154c614564e2cf284c883.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*7tt1CW1DXGvEtAmFTo6hFA.png"/></div><figcaption class="lq lr et er es ls lt bd b be z dx">Explained Sum of Squares</figcaption></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es lu"><img src="../Images/b8fd0e0c951a3440222850444fc8fcae.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*sAyv-T_x674MDUC2WUwgjQ.png"/></div><figcaption class="lq lr et er es ls lt bd b be z dx">Residual Sum of Squares</figcaption></figure><p id="e67d" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">拟合优度由<strong class="jx hj"> R表示。</strong>它解释了开发的模型解释了给定数据变化的哪一部分。换句话说，它表示环境服务系统占服务系统的百分比或比例。</p><p id="de4c" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">于是，<strong class="jx hj"><em class="lb">R</em></strong><em class="lb">= ESS/TSS<br/></em>=&gt;<em class="lb"/><strong class="jx hj"><em class="lb">R</em></strong><em class="lb">=(TSS-RSS)/TSS<br/>=&gt;</em><strong class="jx hj"><em class="lb">R</em></strong><em class="lb">= 1-(RSS/TSS)</em></p><p id="0153" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">从上图我们还观察到，ess值越大，拟合优度越好，ESS值越小，拟合优度越小。我们推断，如果ESS最大，即当ESS等于TSS时，那么<strong class="jx hj"> R </strong>将为1。<br/>在最坏的情况下，ESS将为0，因此<strong class="jx hj"> R </strong>将为0。因此，R值越高，模型的拟合度越好。</p><blockquote class="lh li lj"><p id="8708" class="jv jw lb jx b jy ko ij ka kb kp im kd lk kq kf kg ll kr ki kj lm ks kl km kn hb bi translated"><strong class="jx hj">因此0≤ R ≤ 1 </strong></p><p id="0d40" class="jv jw lb jx b jy ko ij ka kb kp im kd lk kq kf kg ll kr ki kj lm ks kl km kn hb bi translated">请注意，在模型不遵循数据趋势的罕见情况下(通常具有负斜率且RSS &gt; TSS ), R也有可能为负，但这种模型无论如何都是无用的。</p></blockquote><h1 id="fbe9" class="lv iy hi bd iz lw lx ly jd lz ma mb jh io mc ip jl ir md is jp iu me iv jt mf bi translated"><strong class="ak">调整后的R平方(调整后的R ) </strong></h1><p id="5df2" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ji ke kf kg jm kh ki kj jq kk kl km kn hb bi translated">在跳入调整后R的概念之前，让我们先了解一下什么是<em class="lb">自由度</em>。</p><p id="1856" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated"><strong class="jx hj">自由度<br/> </strong>根据上下文有不同的确定自由度的方法。让我们理解下面给定方程的自由度:</p><p id="b1ae" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated"><em class="lb"> x1 + x2 + x3 = 500 </em></p><p id="b5a9" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">在上式中，我们可以自由选择x1的任意值，所以让我们选择x1 = 100的任意值。同样，我们可以自由选择x2的任何值，让我们选择x2 = 350。<br/>但是当我们来到第三个变量时，我们没有选择x3的任何值的自由，因为我们需要选择x3的值，使得先前选择的x1和x2的值以及x3的值应该满足等式。<br/>这意味着我们必须选择x3的值为50，因为该值将满足等式x1+x2+x3 = 500。<br/>因此，在方程的3个变量中，我们可以自由地为2个(即3 - 1个)变量选择任何值。类似地，对于更大数量的变量，比如一个方程中有n个变量，我们可以自由选择n-1个变量的任意值。这个值n-1被称为<em class="lb">自由度</em>。</p><blockquote class="lh li lj"><p id="1c1c" class="jv jw lb jx b jy ko ij ka kb kp im kd lk kq kf kg ll kr ki kj lm ks kl km kn hb bi translated">自由度= n-1</p></blockquote><p id="556f" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated"><strong class="jx hj">现在让我们从回归的角度来理解自由度。</strong></p><p id="5ec4" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">给定一个具有“n”个观察值或样本的数据集，如下所示:</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es mg"><img src="../Images/93f513c077704a4951cfada83c41ebba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*C60hhyxovtD5Mu-TAS5fnA.png"/></div></figure><p id="5b2a" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">上述数据集可由以下线性方程表示:</p><blockquote class="lh li lj"><p id="2077" class="jv jw lb jx b jy ko ij ka kb kp im kd lk kq kf kg ll kr ki kj lm ks kl km kn hb bi translated">Y = β0 + β1*X1 + β2*X2 + β3*X3</p></blockquote><p id="770b" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">其中“β0”是截距，β1、β2和β3是我们需要确定和估计的斜率。</p><p id="a130" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">所以设观测次数为‘n’，斜率系数的个数为‘k’，截距的个数总是‘1’(也就是β0)。</p><p id="0162" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">因此，在这种情况下，自由度为:</p><p id="b1ec" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated"><strong class="jx hj"> <em class="lb">观察次数-待定系数数-截距数。</em>T12】</strong></p><p id="028a" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">这意味着:</p><blockquote class="lh li lj"><p id="e00b" class="jv jw lb jx b jy ko ij ka kb kp im kd lk kq kf kg ll kr ki kj lm ks kl km kn hb bi translated">线性回归的自由度= <strong class="jx hj"> n - k - 1 </strong></p></blockquote><p id="90d8" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">因此，对于上述具有3个特征的数据集，自由度(df)将为:</p><p id="1445" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated"><em class="lb"> df = n - 3 - 1 = n - 4 </em></p><p id="faf1" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">我们还推断，对于要执行的回归，观察值的数量应该总是大于参数(或变量)的数量，否则回归将不能正确执行，并将导致错误。</p><blockquote class="lh li lj"><p id="0766" class="jv jw lb jx b jy ko ij ka kb kp im kd lk kq kf kg ll kr ki kj lm ks kl km kn hb bi translated"><strong class="jx hj">观察数量(n) &gt;参数数量(k+1) </strong></p></blockquote><p id="ba6d" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">因此，在上述情况下，由于参数数量为4 (3个斜率系数和1个截距)，因此最小观测值至少应为5，以便回归工作。</p><p id="9aaa" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">正如我们之前看到的，R提供了模型拟合程度的度量，那么<strong class="jx hj">为什么需要调整R </strong>？</p><p id="2718" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">为了回答上面的问题，让我们理解使用R时所面临的问题。<br/>让我们在之前的等式中添加一个新变量'<strong class="jx hj"> X4 </strong>'。因此，新等式现在变成了:</p><blockquote class="lh li lj"><p id="6c19" class="jv jw lb jx b jy ko ij ka kb kp im kd lk kq kf kg ll kr ki kj lm ks kl km kn hb bi translated">y =β0+β1 * X1+β2 * X2+β3 * X3+<strong class="jx hj">β4 * X4</strong></p></blockquote><p id="a86b" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">我们可以清楚地看到，新的自由度(df1)将减少，如下所示:</p><p id="268b" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated"><em class="lb">df1 = n-k-1 = n-4-1 =</em><strong class="jx hj">T29】n-5</strong></p><p id="382b" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">如果自由度降低，那么模型的解释力也会降低，但是随着变量数量的增加，R值往往会增加或保持不变，这给我们一个概念，即模型的解释力在增加或保持不变，这实际上可能并不总是正确的。</p><p id="4743" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">另一方面，如果新变量非常相关，那么模型的解释力将会增加。因此，根据新增加变量的相关程度，模型的拟合优度或解释力会相应增加。</p><p id="c825" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">因此，可能存在不同的情况，其中新添加的变量与业务领域高度相关，并且模型的解释能力的增加增加到很好的程度，同时自由度有所减少，尽管净效果是总体上模型解释能力有所增加。<br/>也可能出现相反的情况，即新增加的变量不显著相关，因此模型的解释能力没有太大增加，因此净效应是自由度的减少占主导地位。</p><p id="cc4a" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">如果我们在这种情况下使用R作为度量标准，那么它将永远不会减少，即使自由度随着模型解释能力的减少而减少。所以在这种情况下，R不会给出正确的结果。</p><blockquote class="lh li lj"><p id="925b" class="jv jw lb jx b jy ko ij ka kb kp im kd lk kq kf kg ll kr ki kj lm ks kl km kn hb bi translated"><strong class="jx hj">调整后的R前来救援</strong></p></blockquote><p id="e1fc" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">在这种情况下，调整后的R将是更合适的指标，在这种情况下，我们需要在添加新变量时捕捉模型拟合优度的整体净效果，这取决于该变量与同时发生的自由度减少的相关程度。</p><p id="8e75" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">现在让我们来确定调整后的R。首先让我们回忆一下下面的公式:</p><p id="11f5" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated"><em class="lb">ESS+RSS = TSS<br/>ESS/TSS+RSS/TSS = 1<br/>R = 1-RSS/TSS</em></p><blockquote class="lh li lj"><p id="c0f5" class="jv jw lb jx b jy ko ij ka kb kp im kd lk kq kf kg ll kr ki kj lm ks kl km kn hb bi translated"><strong class="jx hj">通过调整RSS和TSS及其相应的自由度来调整R</strong></p></blockquote><p id="5ec8" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">由于RSS与回归线相关，而TSS与“Y”的平均值相关，因此我们将使用回归的自由度(n - k - 1)对RSS进行调整，同时使用其方程的自由度(n - 1)对TSS进行调整。</p><p id="342e" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated">调整后的R公式写为:</p><p id="4214" class="pw-post-body-paragraph jv jw hi jx b jy ko ij ka kb kp im kd ji kq kf kg jm kr ki kj jq ks kl km kn hb bi translated"><em class="lb">调整后的R = 1-[RSS/(n-k-1)]/[TSS/(n-1)]<br/>=&gt;调整后的R = 1-[(n-1)/(n-k-1)]-RSS/TSS<br/>由于RSS/TSS = 1- R所以公式也可以写成:</em></p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es mh"><img src="../Images/189162ac7ce95477f8139de1e92653c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*niwpwvnSwiWK0fUAf3kvyQ.png"/></div></figure><blockquote class="lh li lj"><p id="d823" class="jv jw lb jx b jy ko ij ka kb kp im kd lk kq kf kg ll kr ki kj lm ks kl km kn hb bi translated">调整后的R将随着新变量的增加而增加或减少，这取决于新变量的增加对模型解释能力的总体影响，在某些情况下，R可能无法表明这一点，因此我们得出结论，在回归过程中增加或删除新变量的情况下，调整后的R是一个更可靠的指标。</p></blockquote></div></div>    
</body>
</html>