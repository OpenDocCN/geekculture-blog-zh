<html>
<head>
<title>Do You know Relational Database Can also Deal with JSON Data??</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你知道关系数据库也可以处理JSON数据吗？？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/do-you-know-relational-database-can-also-deal-with-json-data-7503a342a73f?source=collection_archive---------10-----------------------#2022-06-13">https://medium.com/geekculture/do-you-know-relational-database-can-also-deal-with-json-data-7503a342a73f?source=collection_archive---------10-----------------------#2022-06-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="64c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">JSON (JavaScript Object Notation)自其JavaScript起源以来已经走过了漫长的道路，现在已经成为简单而深刻的结构化数据的事实上的机器对机器数据交换标准。JSON数据的叶节点只是数字、文本、布尔值或空值形式的标量，而树结构由键值映射(也称为“对象”)和数组组成。</p><p id="8ebd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">JSON是一种基于文本的格式，需要解析才有用，而且它缺乏一种符合模式的内置机制。大多数编程语言，包括web浏览器中的JavaScript，都可以解析JSON，它被广泛用于REST和GraphQL APIs。</p><p id="f1ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一方面，JSON文档是一个平面的二维树，没有到其他文档的链接。如果这种结构没有得到加强，大量的数据很快就会成为负担，而访问数据库的编程人员(或人员)可以管理这些数据。</p><p id="7e26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">相反，非常严格的行列关系数据库表可以通过引用变成高维数据。它实际上是一棵所有叶子的树，因为列中的数据通常是完全标量的。关系数据库的刚性允许智能索引、存储、确保数据和引用结构完整性的约束、唯一性保证以及防止数据丢失。</p><p id="256f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">PostgreSQL中的JSON支持 <br/> JSON支持在9.2版本中被添加到PostgreSQL中，并且已经得到了相当大的扩展。</p><p id="4a9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">JSON数据在PostgreSQL中可以以两种方式存储:JSON和JSONB，以便为这些数据类型开发高效的查询技术。</p><p id="38fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据类型JSON和JSONB接受几乎相同的一组值作为输入。最重要的实际区别是效率。JSON数据类型存储输入文本的精确副本，处理函数必须在每次执行时重新解析该副本；然而，<strong class="ih hj"> </strong> JSONB数据是以分解的二进制格式存储的，由于额外的转换开销，这种格式的输入速度稍慢，但处理速度明显更快，因为不需要重新解析。JSONB也支持索引，这是一大优势。</p><p id="ef40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">JSONB类型将维护标记之间语义上无关紧要的空白，以及JSON对象中键的顺序，因为它存储输入文本的精确副本。同样，如果同一个键在JSON对象的值中出现了几次，那么所有的键/值对都会被保留。(处理例程将最近的值视为活动值。)JSONB则相反，不保存重复的对象键，不保留空白，不保留对象键的顺序。如果在输入中提供了重复的键，则只保存最后一个值。在本文中，我们将详细讨论JSON类型。</p><p id="b302" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从一个带有JSON类型列的表开始，并使用JSON以字符串形式插入一些数据:</p><ol class=""><li id="c679" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><strong class="ih hj">创建表:</strong> emp_json包含两个字段，<code class="du jm jn jo jp b">id</code>是主键，<code class="du jm jn jo jp b">details</code>是json类型。</li></ol><pre class="jq jr js jt fd ju jp jv jw aw jx bi"><span id="f0b3" class="jy jz hi jp b fi ka kb l kc kd">create table emp_json( id serial primary key,<br/>                       details json not null);</span></pre><figure class="jq jr js jt fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ke"><img src="../Images/20824b39422c21d3e44b0eb9403241b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nrj2ZP8-G-hc2pHRRMWhNg.png"/></div></div></figure><p id="2989" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。将数据插入表格:</strong></p><p id="200c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在将数据插入JSON列之前，必须确认数据是有效的JSON格式。下面的INSERT语句在emp_json表中创建新行。</p><pre class="jq jr js jt fd ju jp jv jw aw jx bi"><span id="7094" class="jy jz hi jp b fi ka kb l kc kd">insert into emp_json(details) values('{"name":"BLAKE", "job":"analyst", "pay_details":{"sal":50000, "comm":500}}');</span><span id="5c48" class="jy jz hi jp b fi km kb l kc kd">--insert multiple records<br/>insert into emp_json(details) values<br/>('{"name":"ROYCE", "job":"clerk", "pay_details":{"sal":5000, "comm":200}}'), <br/>('{"name":"RACHEL", "job":"manager", "pay_details":{"sal":6000, "comm":600}}'),<br/>('{"name":"GRAM", "job":"clerk", "pay_details":{"sal":5500, "comm":500}}'),<br/>('{"name":"ADAM", "job":"analyst", "pay_details":{"sal":55000, "comm":500}}');</span></pre><p id="936c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。JSON数据提取:</strong></p><p id="72f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用SELECT语句查询JSON数据，这与搜索其他本地数据类型是一样的:</p><pre class="jq jr js jt fd ju jp jv jw aw jx bi"><span id="4142" class="jy jz hi jp b fi ka kb l kc kd">select * from emp_json;</span></pre><figure class="jq jr js jt fd kf er es paragraph-image"><div class="er es kn"><img src="../Images/1d3a94ee8755e3866a5c42e2a14961d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*vX6QyWj5xPQpG2-OGX2Skg.png"/></div></figure><p id="a3b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">PostgreSQL生成JSON格式的结果集。</p><p id="f3cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">PostgreSQL有两个查询JSON数据的本地操作符:<code class="du jm jn jo jp b"> -&gt;</code>和<code class="du jm jn jo jp b">-&gt;&gt;</code>。</p><p id="775f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">操作符<code class="du jm jn jo jp b"> -&gt;</code>返回JSON对象字段的键。<br/>操作符<code class="du jm jn jo jp b">-&gt;&gt;</code>返回JSON对象字段的文本。<br/>要从emp_json获取json格式的所有名称，请在以下查询中使用运算符- &gt;:</p><pre class="jq jr js jt fd ju jp jv jw aw jx bi"><span id="b045" class="jy jz hi jp b fi ka kb l kc kd">select details-&gt;'name' as Name from emp_json;</span></pre><figure class="jq jr js jt fd kf er es paragraph-image"><div class="er es ko"><img src="../Images/4ae4f155415fdec7293b279da7a5bf64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*VyDWVgrHyonkeA4l0hJ6YA.png"/></div></figure><p id="b5dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的查询使用操作符<code class="du jm jn jo jp b">-&gt;&gt;</code>以文本形式获取所有姓名:</p><pre class="jq jr js jt fd ju jp jv jw aw jx bi"><span id="a09f" class="jy jz hi jp b fi ka kb l kc kd">select details-&gt;&gt;'name' as Name from emp_json;</span></pre><figure class="jq jr js jt fd kf er es paragraph-image"><div class="er es kp"><img src="../Images/39bb9d7bfb354608afa0a5e76b62d886.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*rwQoIZtY7frHUn8YsISO7A.png"/></div></figure><p id="3d73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为-&gt;操作符返回一个JSON对象，所以您可以将它与-&gt; &gt;操作符结合使用来获取特定的节点。例如，以下语句返回id和他们的薪水:</p><pre class="jq jr js jt fd ju jp jv jw aw jx bi"><span id="9f91" class="jy jz hi jp b fi ka kb l kc kd">select id, details-&gt;’pay_details’-&gt;&gt;’sal’ as Salary from emp_json;</span></pre><figure class="jq jr js jt fd kf er es paragraph-image"><div class="er es kq"><img src="../Images/c9d0555f6dae3a7861ed70e358c9c0c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*QiXhWHg0NDAZZiGMEaXfoA.png"/></div></figure><p id="31f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 4。如何在WHERE子句中使用JSON操作符:</strong></p><p id="fe6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了过滤返回的行，我们可以在WHERE子句中使用JSON操作符。例如，我们可以使用下面的查询来检索job analyst值大于5000的所有id:<br/>值得注意的是，在与5000比较之前，我们使用了类型转换将qty字段更改为整数类型，因为<code class="du jm jn jo jp b">-&gt;&gt;</code>返回文本字段。</p><pre class="jq jr js jt fd ju jp jv jw aw jx bi"><span id="2afd" class="jy jz hi jp b fi ka kb l kc kd">select id, details-&gt;'job' as job, <br/>details-&gt;'pay_details'-&gt;&gt;'sal' as salary <br/>from emp_json where <br/>details-&gt;&gt;'job' = 'analyst' <br/>or<br/>cast(details-&gt;'pay_details'-&gt;&gt;'sal' as integer) &gt;5000;</span></pre><figure class="jq jr js jt fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kr"><img src="../Images/f260e1a80d8a0abe3c9e60841c0a84bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i-34Ml5oFOsTgNevKGJA7g.png"/></div></div></figure><p id="316f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 5。JSON数据上的聚合函数:</strong></p><pre class="jq jr js jt fd ju jp jv jw aw jx bi"><span id="39a7" class="jy jz hi jp b fi ka kb l kc kd">select <br/>max(cast(details-&gt;'pay_details'-&gt;&gt;'sal' as integer)),  min(cast(details-&gt;'pay_details'-&gt;&gt;'sal' as integer))<br/>from emp_json;</span></pre><figure class="jq jr js jt fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ks"><img src="../Images/1b18fa239b712221c6b62328bad5fb04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fI-VfcwxhxFuFgpOOrdp3g.png"/></div></div></figure><p id="7047" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6。Postgres内置JSON函数:</p><p id="97c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 6.1 json_typeof(): </strong></p><p id="3db3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该方法返回一个字符串，表示最外层JSON值的类型。数字、布尔值、空值、对象、数组和字符串都是可能的。</p><p id="bbec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下查询返回详细信息的数据类型:</p><pre class="jq jr js jt fd ju jp jv jw aw jx bi"><span id="2e2e" class="jy jz hi jp b fi ka kb l kc kd">select json_typeof(details ) from emp_json;</span></pre><figure class="jq jr js jt fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kt"><img src="../Images/0cec6f1a80f0f2d9ea4f98216ef5d3db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*31Du2I3x9weXjI2Wl6nAmQ.png"/></div></div></figure><p id="fad9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下查询返回“sal”字段的数据类型。</p><pre class="jq jr js jt fd ju jp jv jw aw jx bi"><span id="9d06" class="jy jz hi jp b fi ka kb l kc kd">select json_typeof(details-&gt;'pay_details'-&gt;'sal' ) from emp_json;</span></pre><figure class="jq jr js jt fd kf er es paragraph-image"><div class="er es ku"><img src="../Images/5a48f6c3b558e8706f80327fca0a0fbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*mGs8TdXUP0ERb2-WhW2Crw.png"/></div></figure><p id="a70d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 6.2 json_object_keys() </strong></p><p id="7a56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">json_object_keys()函数从最外层的json对象中返回一组键。以下查询检索details对象的所有键。</p><pre class="jq jr js jt fd ju jp jv jw aw jx bi"><span id="ce6a" class="jy jz hi jp b fi ka kb l kc kd">select id, json_object_keys(details) from emp_json where id = 6;</span></pre><figure class="jq jr js jt fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kv"><img src="../Images/eaded477bda86668958fceb391c04df2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M8pNVZsALB4h2t05ze_y9g.png"/></div></div></figure><p id="203d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 6.3 json_each() </strong></p><p id="ca74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以使用json_each()函数将最外层的JSON对象扩展成一组键值对。考虑以下语句:</p><pre class="jq jr js jt fd ju jp jv jw aw jx bi"><span id="1ab0" class="jy jz hi jp b fi ka kb l kc kd">select id, json_each(details) from emp_json where id = 6;</span></pre><figure class="jq jr js jt fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kw"><img src="../Images/0f81cae26845a96da1de0c117546eb3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UCWMxGOtnxOrs5iW_TrwHA.png"/></div></div></figure><p id="f670" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果想深入挖掘，还有更多<a class="ae kx" href="https://www.postgresql.org/docs/current/static/functions-json.html" rel="noopener ugc nofollow" target="_blank"> PostgreSQL JSON函数</a>。</p><p id="bf36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本教程中，我们学习了如何使用PostgreSQL的JSON数据类型，以及如何使用一些最重要的JSON操作符来更有效地处理JSON数据。</p><p id="f72a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望你喜欢阅读这篇文章并从中有所收获。谢谢你花时间阅读它。如果你喜欢这篇文章，请给它一个大拇指，并订阅我的中等饲料。</p><p id="4cf5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请留意其他文章。</p></div></div>    
</body>
</html>