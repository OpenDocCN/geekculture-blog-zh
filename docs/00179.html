<html>
<head>
<title>Google’s OAuth2 Authorization with Chrome Extensions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌对Chrome扩展的OAuth2授权</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/googles-oauth2-authorization-with-chrome-extensions-2d50578fc64f?source=collection_archive---------0-----------------------#2020-09-17">https://medium.com/geekculture/googles-oauth2-authorization-with-chrome-extensions-2d50578fc64f?source=collection_archive---------0-----------------------#2020-09-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3914" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用谷歌的OAuth2获取用户数据。我们将处理用户的联系人数据。</p><h1 id="e652" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">本教程使用了一个锅炉板谷歌浏览器扩展设置。</h1><p id="6afe" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated"><strong class="ih hj">如果你想知道如何进行设置，<br/>点击这里查看我的文章:</strong></p><div class="kg kh ez fb ki kj"><a rel="noopener follow" target="_blank" href="/@an_object_is_a/how-does-a-chrome-extension-work-web-development-6e85bd2bccc1"><div class="kk ab dw"><div class="kl ab km cl cj kn"><h2 class="bd hj fi z dy ko ea eb kp ed ef hh bi translated">Chrome扩展是如何工作的？(网络开发)</h2><div class="kq l"><h3 class="bd b fi z dy ko ea eb kp ed ef dx translated">Chrome扩展有5个部分:</h3></div><div class="kr l"><p class="bd b fp z dy ko ea eb kp ed ef dx translated">medium.com</p></div></div><div class="ks l"><div class="kt l ku kv kw ks kx ky kj"/></div></div></a></div></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><h2 id="1119" class="lg je hi bd jf lh li lj jj lk ll lm jn iq ln lo jr iu lp lq jv iy lr ls jz lt bi translated">在我们接触一行代码之前，我们需要设置我们的开发工作区，以便我们有能力做两件主要的事情:</h2><p id="bfe7" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">1.赋予我们特定的Chrome扩展使用Google的API和服务的能力。<br/> 2。获得与Google的OAuth2端点交互的能力。<br/> 3。获得与Google API交互的能力。</p></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><h1 id="4370" class="jd je hi bd jf jg lu ji jj jk lv jm jn jo lw jq jr js lx ju jv jw ly jy jz ka bi translated">我们开始吧。</h1><p id="a750" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">首先，我们需要在<strong class="ih hj">谷歌商店</strong>注册我们的Chrome扩展。有两种方法可以做到这一点，我们或者正式上传我们的Chrome扩展到谷歌Chrome商店，或者用谷歌Chrome浏览器注册我们的扩展。既然我们不想上传一个开发扩展到公共商店，<strong class="ih hj"> <em class="lz">我们就选择后一种方法</em> </strong>。</p><p id="ae84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在您的<strong class="ih hj"> Chrome浏览器</strong>中导航到地址“<strong class="ih hj"> chrome://extensions </strong>”。点击"<strong class="ih hj"> Pack Extension </strong>"并选择你的Chrome扩展的位置。这将在你的Chrome扩展位置上面的目录中生成两个文件，一个'<strong class="ih hj"> crx </strong>'和'<strong class="ih hj">PEM</strong>'；我们关心的是'<strong class="ih hj"> crx </strong>'文件。<br/>将'<strong class="ih hj"> crx </strong>'文件拖放到“<strong class="ih hj"> chrome://extensions </strong>”页面中。您应该会得到一个提示，要求您添加扩展，单击“<strong class="ih hj">是</strong>”。</p><figure class="mb mc md me fd mf er es paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="er es ma"><img src="../Images/00c9c582dd5b97ba9d9694991cb94ce0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ti4zOFCKL5SvDfZI.png"/></div></div></figure><p id="f634" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，<strong class="ih hj">导航到你的Chrome扩展所在的位置</strong>。<br/>对于MacOS和Linux用户来说，情况会有所不同，但是对于Windows用户来说，</p><p id="fab4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> C:\Users\ &lt;您的用户名&gt;\ AppData \ Local \ Google \ Chrome \ User Data \ Default \ Extensions</strong>。</p><p id="bc03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们正在寻找与您的Chrome扩展id同名的文件夹。这个id可以在你的“<strong class="ih hj"> chrome://extensions </strong>”页面找到。查找“<strong class="ih hj"> ID </strong>”属性。<br/>进入与你的Chrome扩展同名的文件夹，进入verion number文件夹，打开“<strong class="ih hj"> manifest.json </strong>文件。复制“<strong class="ih hj">键</strong>属性。</p><p id="dccc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="lz">这是我们独有的Chrome扩展键</em>T3。复制并粘贴到你正在开发的Chrome扩展的“<strong class="ih hj"> manifest.json </strong>”中。(您为“<strong class="ih hj">包扩展</strong>步骤选择的文件夹)</strong></p><pre class="mb mc md me fd ml mm mn mo aw mp bi"><span id="8203" class="lg je hi mm b fi mq mr l ms mt">/* manifest.json */</span><span id="ada3" class="lg je hi mm b fi mu mr l ms mt">{<br/>    "name": "Oauth2 test",<br/>    "description": "",<br/>    "version": "0.1.0",<br/>    "manifest_version": 2,<br/>    "key": "&lt;key here&gt;",<br/>    "icons": {<br/>        "16": "./obj-16x16.png",<br/>        "32": "./obj-32x32.png",<br/>        "48": "./obj-48x48.png",<br/>        "128": "./obj-128x128.png"<br/>    },<br/>    "background": {<br/>        "scripts": [<br/>            "./background.js"<br/>        ]<br/>    },<br/>    "options_page": "./options.html",<br/>    "browser_action": {<br/>        "default_popup": "popup.html"<br/>    },<br/>    "permissions": [<br/>        "identity",<br/>        "identity.email"<br/>    ]<br/>}</span></pre><p id="aa3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong> <br/>我们需要“<strong class="ih hj"> identity </strong>”和“<strong class="ih hj"> identity.email </strong>”权限。</p><p id="d181" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">最后</strong>，从浏览器中移除您的Chrome扩展(点击“<strong class="ih hj">移除</strong>”)，并通过点击“<strong class="ih hj">加载解包</strong>”安装开发扩展，并为您的开发扩展选择文件夹。</p><p id="8580" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">这个开发扩展现在有了使用谷歌API和服务的能力。</strong></p></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><p id="6d52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要为Google的OAuth2端点获得<strong class="ih hj"> <em class="lz">授权</em> </strong>，我们需要导航到<strong class="ih hj"> Google开发者控制台</strong>并请求一个OAuth2客户端ID。</p><p id="918e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导航到“<a class="ae mv" href="https://console.developers.google.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">https://console.developers.google.com/</strong></a>”如果你还没有，创建一个项目。</p><p id="04d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们必须做两件事…</p><p id="6040" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击左侧的“<strong class="ih hj"> OAuth同意屏幕</strong>”链接。选择<strong class="ih hj">外部</strong>和<strong class="ih hj">创建</strong>。只需填写“<strong class="ih hj">应用名称</strong>字段和“<strong class="ih hj">保存</strong>”。<br/>“<strong class="ih hj">OAuth同意</strong>”屏幕告诉用户，当他们选择使用他们的Google帐户登录时，我们希望访问他们的Google数据。</p><p id="8f10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，点击左侧的<strong class="ih hj">凭证</strong>链接。<br/>点击屏幕上方的<strong class="ih hj">创建凭证</strong>，选择<br/><strong class="ih hj">OAuth客户端ID </strong>。<br/>将<strong class="ih hj">应用类型</strong>设置为<strong class="ih hj"> Chrome app </strong>。<br/>在“<strong class="ih hj">名称</strong>”字段中填入您想要的任何内容，然后在底部填入<br/>“<strong class="ih hj">应用Id </strong>”。“<strong class="ih hj">应用Id </strong>”是你的Chrome扩展的Id；可以找到@ <strong class="ih hj"> chrome://extensions </strong>。<br/>点击<strong class="ih hj">创建</strong>。</p><p id="e054" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们需要一个API键，这样我们就可以使用People API访问用户的Google联系人数据。<br/>前往左侧栏上的<strong class="ih hj">图书馆</strong>。搜索“<strong class="ih hj">谷歌人API </strong>，点击“<strong class="ih hj">启用</strong>”。<br/>转到左侧栏上的<strong class="ih hj">凭证</strong>。<br/>在主页面中点击“API&amp;服务中的<strong class="ih hj">凭证”。<br/>点击页面顶部的<strong class="ih hj">创建凭证</strong>，选择<strong class="ih hj"> API key </strong>。</strong></p><p id="f176" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">这个开发扩展现在能够与Google的OAuth2端点和People API交互。</strong></p></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><h2 id="61b9" class="lg je hi bd jf lh li lj jj lk ll lm jn iq ln lo jr iu lp lq jv iy lr ls jz lt bi translated">我们去分机吧。</h2><p id="f64b" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">我们将在'<strong class="ih hj">popup.html</strong>'中使用一个简单的按钮及其脚本来测试我们的Chrome扩展。</p><figure class="mb mc md me fd mf er es paragraph-image"><div class="er es mw"><img src="../Images/fa668de2e11c0accc990dc871a76bc3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*x4j5IbnY2BTu3IEu14mCgQ.png"/></div><figcaption class="mx my et er es mz na bd b be z dx">popup.html</figcaption></figure><pre class="mb mc md me fd ml mm mn mo aw mp bi"><span id="abc8" class="lg je hi mm b fi mq mr l ms mt">/* popup-script.js */</span><span id="5d58" class="lg je hi mm b fi mu mr l ms mt">document.querySelector('button')<br/>  .addEventListener('click', function () {<br/>    chrome.runtime.sendMessage({ message: '' });<br/>  });</span></pre><p id="e014" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将在'<strong class="ih hj"> background.js </strong>'脚本中的消息接收器中创建一个'<strong class="ih hj"> if conditional </strong>'树。这将处理5个请求:</p><p id="45e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.获取访问令牌。<br/> 2。获取登录用户的配置文件信息。<br/> 3。从用户的Google联系人页面获取用户的联系人。<br/> 4。在用户的Google联系人页面中创建一个联系人。<br/> 5。在用户的Google联系人页面中删除联系人。</p><p id="123a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们需要向我们的'<strong class="ih hj"> manifest.json </strong>'添加一些属性。</p><pre class="mb mc md me fd ml mm mn mo aw mp bi"><span id="d8ad" class="lg je hi mm b fi mq mr l ms mt">/* manifest.json */</span><span id="c9dd" class="lg je hi mm b fi mu mr l ms mt">{<br/>    "name": "Oauth2 test",<br/>    "description": "",<br/>    "version": "0.1.0",<br/>    "manifest_version": 2,<br/>    "key": "&lt;key here&gt;",<br/>    "oauth2": {<br/>        "client_id": "&lt;client id here&gt;",<br/>        "scopes": [<br/>            "profile email",<br/>            "<a class="ae mv" href="https://www.googleapis.com/auth/contacts" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/contacts</a>"<br/>        ]<br/>    },<br/>...</span></pre><p id="f991" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong> <br/>添加一个"<strong class="ih hj"> oauth2 </strong>"属性，带有:<br/> " <strong class="ih hj"> client_id </strong>"从Google开发者控制台<br/> " <strong class="ih hj"> scopes </strong>"带有"<strong class="ih hj">个人资料电子邮件</strong>"和"<a class="ae mv" href="https://www.googleapis.com/auth/contacts" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/contacts</a>"</p><pre class="mb mc md me fd ml mm mn mo aw mp bi"><span id="e9c2" class="lg je hi mm b fi mq mr l ms mt">/* background.js */</span><span id="6139" class="lg je hi mm b fi mu mr l ms mt">const API_KEY = '';<br/>let user_signed_in = false;</span><span id="a15d" class="lg je hi mm b fi mu mr l ms mt">chrome.identity.onSignInChanged.addListener(function (account_id, signedIn) {<br/>    if (signedIn) {<br/>        user_signed_in = true;<br/>    } else {<br/>        user_signed_in = false;<br/>    }<br/>});</span><span id="4820" class="lg je hi mm b fi mu mr l ms mt">chrome.runtime.onMessage<br/>  .addListener((request, sender, sendResponse) =&gt; {<br/><br/>  });</span></pre><p id="fd41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong> <br/>我们已经添加了一个常量变量来保存来自Google开发者控制台的API密钥。</p><p id="e992" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个扩展最重要的部分是"<strong class="ih hj">chrome . identity . getauthtoken()</strong>"方法。<br/>它允许我们获得一个“<strong class="ih hj">访问令牌</strong>，我们可以用它来获得用户数据的入口。</p><pre class="mb mc md me fd ml mm mn mo aw mp bi"><span id="013c" class="lg je hi mm b fi mq mr l ms mt">/* background.js */</span><span id="b6bf" class="lg je hi mm b fi mu mr l ms mt">if (request.message === 'get_auth_token') {<br/>  chrome.identity<br/>    .getAuthToken({ interactive: true }, function (token) {<br/>      console.log(token);<br/>    });<br/>}</span></pre><p id="89b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用户登录后，我们可以使用“<strong class="ih hj">chrome . identity . getprofileuserinfo()</strong>”方法获取他们的个人资料信息。</p><pre class="mb mc md me fd ml mm mn mo aw mp bi"><span id="5df7" class="lg je hi mm b fi mq mr l ms mt">/* background.js */</span><span id="5208" class="lg je hi mm b fi mu mr l ms mt">} else if (request.message === 'get_profile') {<br/>  chrome.identity<br/>    .getProfileUserInfo({ accountStatus: 'ANY' }, function <br/>    (user_info) {<br/>      console.log(user_info);<br/>    });<br/>}</span></pre><h2 id="4a81" class="lg je hi bd jf lh li lj jj lk ll lm jn iq ln lo jr iu lp lq jv iy lr ls jz lt bi translated">这个项目的实质就是这个:</h2><p id="2866" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">当我们想要与用户的数据交互时，这意味着要通过Google的一个API，我们需要在fetch请求的头<br/>中传递一个访问令牌。<br/>所以我们需要先调用'<strong class="ih hj"> getAuthToken() </strong>'方法，然后用Token把它传入fetch调用。</p><figure class="mb mc md me fd mf"><div class="bz dy l di"><div class="nb nc l"/></div></figure></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><p id="6a70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在这里 得到源文件<a class="ae mv" href="https://github.com/an-object-is-a/chrome-ext-google-oauth" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">。</strong></a></p><p id="f3d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想要更深入的指导，可以看看我在YouTube上的完整视频教程，<strong class="ih hj">一个物体是一个</strong>。</p><p id="9760" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一定要在<a class="ae mv" href="https://www.instagram.com/an_object_is_a/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Instagram </strong> </a>和<a class="ae mv" href="https://twitter.com/anobjectisa1" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Twitter </strong> </a>上关注我们，及时了解我们最新的<strong class="ih hj"> Web开发教程</strong>。</p><p id="f2d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Google OAuth2和Chrome扩展——访问用户的Google数据</strong></p><figure class="mb mc md me fd mf"><div class="bz dy l di"><div class="nd nc l"/></div></figure></div></div>    
</body>
</html>