<html>
<head>
<title>Create a Machine Learning Web App with Streamlit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Streamlit创建机器学习Web应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/create-a-machine-learning-web-app-with-streamlit-f28c75f9f40f?source=collection_archive---------15-----------------------#2021-03-28">https://medium.com/geekculture/create-a-machine-learning-web-app-with-streamlit-f28c75f9f40f?source=collection_archive---------15-----------------------#2021-03-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f9aa3dfcb20fd9c916beb2d6d9bf88ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wV1QiIq7mmBaYYH9FuhBUw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@fumirin" rel="noopener ugc nofollow" target="_blank">Fumiaki Hayashi</a></figcaption></figure><p id="d5dd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Streamlit是一个开源的Python框架，它可以帮助机器学习和数据科学团队创建开箱即用的专业数据应用程序，而无需任何前端web开发知识。</p><p id="4999" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">想象一下这样一种情况，您的团队已经训练了一个机器学习模型，现在想要为客户或另一个最终用户提供一个与您的模型交互的应用程序:对新输入进行推理，并可视化输出预测。这是我们将在本文中看到的Streamlit的一个用例。</p><p id="bdbc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个例子中，我已经训练了一个神经网络，通过使用四个特征(萼片长度、萼片宽度、花瓣长度和花瓣宽度)来对不同物种(Setosa、Versicolor和Virginica)之间的鸢尾花进行分类。我们开发的应用程序将加载模型，允许用户输入新的特征值，运行模型，查看类别预测概率，并在<a class="ae iu" href="https://en.wikipedia.org/wiki/Principal_component_analysis" rel="noopener ugc nofollow" target="_blank"> PCA </a>图上可视化输入，以将输入与我们的<a class="ae iu" href="https://archive.ics.uci.edu/ml/datasets/iris" rel="noopener ugc nofollow" target="_blank">虹膜数据集</a>中的其他数据点进行比较。</p><p id="5eab" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们开始之前，让我们看看这个应用程序是什么样子的。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jt"><img src="../Images/49a59f97ae41162f610ca60430cf342e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YMTK6EeCnAvi5hKApLieZA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Iris Flower Classification App</figcaption></figure><p id="0620" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您将需要的Python库包括:<a class="ae iu" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>、<a class="ae iu" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank"> NumPy </a>、<a class="ae iu" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Pandas </a>、<a class="ae iu" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> Scikit-learn </a>、<a class="ae iu" href="https://plotly.com/python/plotly-express/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>和<a class="ae iu" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> TensorFlow </a>(或<a class="ae iu" href="https://keras.io/" rel="noopener ugc nofollow" target="_blank"> Keras </a>)。</p><p id="640a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们从导入这些库并加载<a class="ae iu" href="https://archive.ics.uci.edu/ml/datasets/iris" rel="noopener ugc nofollow" target="_blank">虹膜数据集</a>开始:</p><p id="9634" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建一个检索虹膜数据集的函数。使用<a class="ae iu" href="https://docs.streamlit.io/en/stable/api.html#streamlit.cache" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj"> @st.cache </strong> </a>装饰器确保该函数只执行一次。如果再次调用该函数，它将返回相同的数据帧。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="dcc7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当用户使用侧边栏指定输入特征值时，我希望以在训练模型之前缩放特征值的相同方式来缩放这些特征值。重新创建训练期间使用的<a class="ae iu" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html" rel="noopener ugc nofollow" target="_blank">标准缩放器</a>对象。</p><p id="ced4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意:如果我没有在这个应用程序中包括PCA图(这需要加载Iris数据集)，我会将训练期间每个特征的均值和方差保存到JSON文件中，并使用该JSON文件中的数据来缩放用户输入，而不是重新创建StandardScaler对象。这意味着应用程序将不再需要加载Iris数据集，这将减少初始加载时间。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="1823" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">用<a class="ae iu" href="https://www.tensorflow.org/api_docs/python/tf/keras/models/load_model" rel="noopener ugc nofollow" target="_blank">keras . models . load _ model()</a>加载你的模型</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="ad55" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们可以开始布局我们的应用程序。从应用程序的标题和描述开始。</p><p id="d69f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用<a class="ae iu" href="https://docs.streamlit.io/en/stable/api.html#streamlit.title" rel="noopener ugc nofollow" target="_blank"> st.title() </a>以标题格式显示文本。使用<a class="ae iu" href="https://docs.streamlit.io/en/stable/api.html#streamlit.markdown" rel="noopener ugc nofollow" target="_blank"> st.markdown() </a>定义带有markdown的描述。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="c3cc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在定义侧边栏的滑块组件，允许用户定制输入特征值。给侧边栏一个带有<a class="ae iu" href="https://docs.streamlit.io/en/stable/api.html#add-widgets-to-sidebar" rel="noopener ugc nofollow" target="_blank"> st.sidebar.header() </a>的标题(<h1>标签)。使用<a class="ae iu" href="https://en.wikipedia.org/wiki/Principal_component_analysis" rel="noopener ugc nofollow" target="_blank"> st.sidebar.slider() </a>为每个特性定义一个滑块。使用<strong class="ix hj">标签</strong>参数给每个滑块一个标签。使用<strong class="ix hj"> min_value </strong>和<strong class="ix hj"> max_value </strong>参数指定滑块可以采用的最小和最大值，这将取决于我们的数据集。用<strong class="ix hj">值</strong>参数将每个滑块的起始值设置为其代表的特征的平均特征值。使用<strong class="ix hj">步长</strong>参数指定用户拖动滑块时滑块值变化的间隔。</h1></p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="8090" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们希望获取这些输入，对它们进行缩放，并在我们的模型中运行它们。将输出保存为带有列种类和置信度的数据帧。我们的置信栏将总计为1以模拟类别概率，因为我们模型中的最后一个激活层使用了<a class="ae iu" href="https://en.wikipedia.org/wiki/Softmax_function" rel="noopener ugc nofollow" target="_blank"> softmax函数</a>。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="be66" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们有了绘制预测图所需的数据。让我们创建这个图，并将其放置在应用程序主部分的一个列中。我想把主要部分分成两栏。第一列将绘制模型预测图。第二列将有PCA图。用<a class="ae iu" href="https://docs.streamlit.io/en/stable/api.html#streamlit.beta_columns" rel="noopener ugc nofollow" target="_blank"> st.beta_columns() </a>创建这个两列结构。创建模型预测图，并将其放在第一列中。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="0885" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用<a class="ae iu" href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html" rel="noopener ugc nofollow" target="_blank"> scikit-learn的PCA </a>类对整个虹膜数据集运行两个分量的PCA。创建PCA结果图，按类别进行颜色编码。将用户输入添加到PCA图，并在第二列显示PCA图。我们只需要运行PCA一次，但是我们需要转换用户输入，并在每次用户输入改变时更新PCA图。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="d6eb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将您的代码保存为Python文件(如<strong class="ix hj"> iris_app.py </strong>)并在共享目录中建模。从这个目录，打开终端，用<strong class="ix hj"> streamlit run iris_app.py </strong>启动应用。确保您的应用程序运行正常，并已准备好进行部署。</p><p id="1cc2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您还可以将应用程序代码的URL传递给<strong class="ix hj"> streamlit run </strong>命令。比如命令<strong class="ix hj">Streamlit run</strong><a class="ae iu" href="https://github.com/DanOKeefe/Streamlit_Iris_Classifier/blob/main/iris_app.py" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj">https://github . com/dano kefe/Streamlit _ Iris _ Classifier/blob/main/Iris _ app . py</strong></a><strong class="ix hj"/>就会运行这个app。</p><p id="a9fc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要<a class="ae iu" href="https://docs.streamlit.io/en/stable/deploy_streamlit_app.html" rel="noopener ugc nofollow" target="_blank">部署您的Streamlit应用</a>，您可以使用Streamlit共享。首先，在他们的<a class="ae iu" href="https://streamlit.io/sharing" rel="noopener ugc nofollow" target="_blank">网站</a>上创建一个账户。上传你的代码到一个公共的GitHub库。在您的存储库中包含一个requirements.txt文件，告诉Streamlit下载哪些Python库来运行您的应用程序。在我们的例子中，我们的requirements.txt文件将如下所示。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="39aa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">登录您的Streamlit共享帐户，然后转到您的主页。点击“新建应用程序”按钮，填写信息，包括GitHub存储库的URL、存储应用程序的存储库分支以及包含应用程序代码的Python文件的路径。单击部署。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ka"><img src="../Images/57ce4b2d3bb05ec7923778c52631a53e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3pRwCzYkqImhZsdgLYpKtA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Deploying a new Streamlit app with Streamlit sharing</figcaption></figure><p id="4a64" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您的应用现在将显示在您位于<a class="ae iu" href="https://share.streamlit.io/" rel="noopener ugc nofollow" target="_blank">https://share.streamlit.io/</a>的Streamlit分享主页上。你可以点击你的应用程序，在一个新的标签中打开它。现在，您可以通过向其他用户提供URL来共享您的应用程序！</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kb"><img src="../Images/9b014780cd427cde2510392c6362fef7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o7KhUWx9PyO8SXjQiHXB3Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx"><a class="ae iu" href="https://share.streamlit.io/" rel="noopener ugc nofollow" target="_blank">https://share.streamlit.io/</a></figcaption></figure><p id="1e83" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以在此处查看本演示<a class="ae iu" href="https://share.streamlit.io/danokeefe/streamlit_iris_classifier/main/iris_app.py" rel="noopener ugc nofollow" target="_blank">中开发的应用程序。</a></p></div></div>    
</body>
</html>