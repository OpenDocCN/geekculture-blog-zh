<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/geekculture/display-azure-cosmos-db-items-in-an-adaptive-card-using-node-js-861a6fd1c1de?source=collection_archive---------20-----------------------#2021-05-08">https://medium.com/geekculture/display-azure-cosmos-db-items-in-an-adaptive-card-using-node-js-861a6fd1c1de?source=collection_archive---------20-----------------------#2021-05-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/05fe11331d98b784f4924d84d5283173.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x6TodsB6DBwQ-LOA7sArUg.png"/></div></div></figure></div><div class="ab cl hr hs gp ht" role="separator"><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw"/></div><div class="hb hc hd he hf"><p id="c5df" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">问候和问候。这是我第一次尝试写技术博客。</p><p id="4d2e" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">Cosmos DB很好玩。适配卡很好玩。我喜欢有趣的东西，所以我认为让我的机器人在适配卡中显示来自Cosmos DB的项目会很有趣。</p></div><div class="ab cl hr hs gp ht" role="separator"><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw"/></div><div class="hb hc hd he hf"><p id="8172" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">在你的节点里。JS项目，安装以下npm包:</p><blockquote class="ix iy iz"><p id="e097" class="hy hz ja ib b ic id ie if ig ih ii ij jb il im in jc ip iq ir jd it iu iv iw hb bi translated">npm安装@azure/cosmos <br/> npm安装自适应-表达式<br/> npm安装自适应卡-模板</p></blockquote></div><div class="ab cl hr hs gp ht" role="separator"><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw"/></div><div class="hb hc hd he hf"><h1 id="2460" class="je jf ia bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak">步骤1——设置Cosmos DB客户端</strong></h1><figure class="kd ke kf kg fd hk er es paragraph-image"><div class="er es kc"><img src="../Images/fc99424092878c72d75c775e390af8ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*s9EVjdmpgVumJlKu-ILRPw.png"/></div><figcaption class="kh ki et er es kj kk bd b be z dx">Setting up the Cosmos DB Client</figcaption></figure><p id="fe07" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">如上所述，建立到Cosmos DB客户机的连接。在我的例子中，我将键、端点和数据库信息存储在<strong class="ib kl"> </strong> ENV文件中。</p></div><div class="ab cl hr hs gp ht" role="separator"><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw"/></div><div class="hb hc hd he hf"><h1 id="f776" class="je jf ia bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak">步骤2——连接到Cosmos DB客户端</strong></h1><figure class="kd ke kf kg fd hk er es paragraph-image"><div class="er es km"><img src="../Images/e1a0c07c89a5267c74daca09ab401457.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*Snvj1yR0SEW9GY8LltpMdA.png"/></div><figcaption class="kh ki et er es kj kk bd b be z dx">Connecting to the Cosmos DB Client</figcaption></figure><p id="7076" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">在这一步中，我们将连接到Cosmos DB容器。</p><p id="5219" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">在本例中，容器名为“staging-list”，这是我们将要查询的容器。</p></div><div class="ab cl hr hs gp ht" role="separator"><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw"/></div><div class="hb hc hd he hf"><h1 id="cc14" class="je jf ia bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">步骤3 —查询Cosmos数据库</h1><figure class="kd ke kf kg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kn"><img src="../Images/5b1a96e4649d3633e7ea6786a4d51813.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CvRhrqfpuQCFlV1tleKYMA.png"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx">Querying the Cosmos DB using Node.JS</figcaption></figure><p id="5820" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">在这一步，我们将使用<em class="ja"> var res = [] </em>设置一个空数组。这是因为我们有一个容器来存储查询的输出。稍后我们将使用<em class="ja"> res </em>数组来帮助生成适配卡。</p><p id="5f86" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">我们还将使用<em class="ja">var user query = user . toupper case()</em>设置我们的查询。在本例中，<em class="ja">用户</em>与我设置的一个变量相关，该变量用于检索用户的电子邮件地址。这将是我在查询中使用的值。然后我添加了<em class="ja">。toUpperCase() </em>确保大小写完全匹配，因为存储在容器中的项目将是大写的。</p><p id="59c2" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">在这个例子中，我们正在做一个基本的查询，该查询将获取所有请求者等于用户电子邮件地址的项目，然后外推这些结果，并将它们放入我前面提到的资源T21数组中。</p></div><div class="ab cl hr hs gp ht" role="separator"><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw"/></div><div class="hb hc hd he hf"><h1 id="1441" class="je jf ia bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">步骤4 —构建适配卡</h1><figure class="kd ke kf kg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ko"><img src="../Images/68174f02e131fbd3061b0ede9cba898e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZhZZS_qK2U-xaztE14wh7A.png"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx">Partial JSON schema for Adaptive Card</figcaption></figure><p id="e930" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">在这一步中，我们将构建带有数据绑定的适配卡。这样我们可以将<em class="ja"> res </em>数组中的数据映射到适配卡。但是首先，我们需要设置adaptivecards-templating包，我们已经使用<em class="ja">var AC data = require(" adaptive cards-templating ")</em>完成了这个包。</p><p id="81fe" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">在部分示例中，有两个关键事项需要注意；在列集合中，我们设置了允许自适应卡动态渲染的数组。然后我们使用<em class="ja"> ${name} </em>调用<em class="ja">文本</em>句柄中的变量名。这些变量需要与<em class="ja"> res </em>数组中的变量相匹配(如 <strong class="ib kl"> <em class="ja">步骤3 </em> </strong> ) <strong class="ib kl"> </strong>所示的<em class="ja">，这样我们的数据就知道去哪里了。</em></p><p id="9b3b" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">在Stack Overflow 上有一篇<a class="ae kp" href="https://stackoverflow.com/questions/61230518/how-to-map-json-array-with-adaptive-card-row-using-designer-to-create-template" rel="noopener ugc nofollow" target="_blank">很棒的文章，它对用适配卡映射JSON数组进行了更深入的探讨，这帮助我整理了这篇博文！</a></p></div><div class="ab cl hr hs gp ht" role="separator"><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw"/></div><div class="hb hc hd he hf"><h1 id="08b5" class="je jf ia bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">步骤5 —将数据绑定到适配卡</h1><figure class="kd ke kf kg fd hk er es paragraph-image"><div class="er es kq"><img src="../Images/343367d52331286ca8ab2c5e28965a05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*jccupDCdcfjgB6e4fgTYlA.png"/></div><figcaption class="kh ki et er es kj kk bd b be z dx">Binding the Data to the Adaptive Card</figcaption></figure><p id="bb59" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">在这一步，我们将把来自<em class="ja"> res </em>数组的数据绑定到我们的自适应卡模板。</p><p id="a889" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">在本例中，我们使用<em class="ja">模板有效载荷s </em> chema ( <em class="ja">见</em> <strong class="ib kl"> <em class="ja">步骤4 </em> </strong>)设置我们的自适应卡模板。然后我们将数据绑定到<em class="ja"> requestCard </em>模板，特别是调用<em class="ja"> reqRows(如</em> <strong class="ib kl"> <em class="ja">步骤4 </em> </strong> <em class="ja">)，</em>，这样我们的自适应卡就知道它是一个动态结构，而<em class="ja"> res </em>是数组输出。</p></div><div class="ab cl hr hs gp ht" role="separator"><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw"/></div><div class="hb hc hd he hf"><h1 id="e17c" class="je jf ia bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">步骤6 —渲染适配卡</h1><figure class="kd ke kf kg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kr"><img src="../Images/853374e0758ec6fdb5bcdf2a5e52187c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4tAEFYm0PZeVU3wNtDsElw.png"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx">Rendering the Adaptive Card</figcaption></figure><p id="9f90" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">在最后一步中，我们将显示带有数据的适配卡。</p><p id="23d9" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">在示例中，我们使用<em class="ja"> CardFactory </em>库并引用<em class="ja"> requestCard </em>数组(如 <strong class="ib kl"> <em class="ja">步骤5 </em> </strong>中所示的<em class="ja">)来渲染和显示自适应卡，作为bot中<em class="ja">步骤</em>过程的一部分。</em></p></div><div class="ab cl hr hs gp ht" role="separator"><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw hx"/><span class="hu bw bk hv hw"/></div><div class="hb hc hd he hf"><h1 id="bc80" class="je jf ia bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">最后的结局</h1><figure class="kd ke kf kg fd hk er es paragraph-image"><div class="er es ks"><img src="../Images/63f77bc4af0bdd1fcb09a5f31b3bfa74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*30xTyG97UiSL1TUx-94Imw.gif"/></div><figcaption class="kh ki et er es kj kk bd b be z dx">Bot Emulator showing the Adaptive Card with data</figcaption></figure><p id="097d" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">它就在这里——这是它的全部荣耀！！！</p><p id="9a06" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">可能有一百万种不同的方法可以做得更好(如果有，请告诉我！)但我希望它有所用处。</p><p id="57ee" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">保重，</p><p id="3ac8" class="pw-post-body-paragraph hy hz ia ib b ic id ie if ig ih ii ij ik il im in io ip iq ir is it iu iv iw hb bi translated">史蒂夫(男子名)</p></div></div>    
</body>
</html>