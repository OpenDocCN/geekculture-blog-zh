<html>
<head>
<title>Automagically Typed GraphQL Queries and Results With Apollo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Apollo自动输入GraphQL查询和结果</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/automagically-typed-graphql-queries-and-results-with-apollo-3731bad989aa?source=collection_archive---------11-----------------------#2021-05-04">https://medium.com/geekculture/automagically-typed-graphql-queries-and-results-with-apollo-3731bad989aa?source=collection_archive---------11-----------------------#2021-05-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/30ef97ac1463fa17bfb6d87608993df7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0-AUdqL5n3CrXACpTlUj9w.png"/></div></div></figure><p id="f264" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">喜欢将GraphQL查询写成字符串并得到非类型化的结果吗？我也没有。这个问题有时被称为“双重声明问题”，你可以在这里<a class="ae jo" href="https://babel-blade.netlify.app/docs/declarationdeclaration.html" rel="noopener ugc nofollow" target="_blank">和这里</a>和<a class="ae jo" href="https://github.com/acro5piano/typed-graphqlify/tree/d89f5b950a77862ab3f7d965134a07d4e75e03a6#motivation" rel="noopener ugc nofollow" target="_blank">这里</a>读到更多关于它的细节，但是你已经明白了。难道就不能采用GraphQL模式，编写类型化查询，得到类型化结果吗？如何开箱即用，而不必显式命名类型？</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="a14d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">TLDR；你可以用一个方法完成所有这些事情！在<a class="ae jo" href="https://github.com/thisismydesign/nestjs-starter" rel="noopener ugc nofollow" target="_blank">的nestjs-starter repo </a>中，我使用带有端到端类型的GraphQL来<a class="ae jo" href="https://csaba-apagyi.medium.com/nestjs-react-next-js-in-one-mvc-repo-for-rapid-prototyping-faed42a194ca" rel="noopener">连接nestjs和Next.js </a>。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es jw"><img src="../Images/1d29e4e20c0ec7592c380c558c865c0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/1*pcpG_tDhRlK9seRtK-Y-vA.gif"/></div></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="244b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有大量的尝试来解决这个问题，最值得注意的是:</p><ul class=""><li id="e7a3" class="kb kc hi is b it iu ix iy jb kd jf ke jj kf jn kg kh ki kj bi translated">apollo的codegen ( <a class="ae jo" rel="noopener" href="/open-graphql/automatically-generate-typescript-definitions-for-graphql-queries-with-apollo-codegen-e73eae72b561"> 1 </a>，<a class="ae jo" href="https://moonhighway.com/typescript-and-apollo" rel="noopener ugc nofollow" target="_blank"> 2 </a>，<a class="ae jo" href="https://www.leighhalliday.com/generating-types-apollo" rel="noopener ugc nofollow" target="_blank">3</a>)——这是对结果进行类型化的部分解决方案，仍然需要您显式地分配类型</li><li id="8647" class="kb kc hi is b it kk ix kl jb km jf kn jj ko jn kg kh ki kj bi translated">一个实验性的<a class="ae jo" href="https://github.com/babel-blade/babel-blade" rel="noopener ugc nofollow" target="_blank">巴别塔插件</a>(!)-当然感觉有点过头了</li><li id="2c41" class="kb kc hi is b it kk ix kl jb km jf kn jj ko jn kg kh ki kj bi translated">解决这一部分或那一部分的几个库:<a class="ae jo" href="https://github.com/khaosdoctor/gotql" rel="noopener ugc nofollow" target="_blank"> gotql </a>，<a class="ae jo" href="https://github.com/acro5piano/typed-graphqlify" rel="noopener ugc nofollow" target="_blank"> typed-graphqlify </a>，<a class="ae jo" href="https://github.com/helios1138/graphql-typed-client" rel="noopener ugc nofollow" target="_blank"> graphql-typed-client </a></li><li id="1ffa" class="kb kc hi is b it kk ix kl jb km jf kn jj ko jn kg kh ki kj bi translated">gqless ，一个基于不同范例的客户端，它需要代码和概念的改变(但是如果你能接受的话，看起来真的很酷)</li><li id="74cf" class="kb kc hi is b it kk ix kl jb km jf kn jj ko jn kg kh ki kj bi translated">阿波罗客户端的一些想法(<a class="ae jo" href="https://github.com/apollographql/apollo-feature-requests/issues/275" rel="noopener ugc nofollow" target="_blank"> 1 </a>、<a class="ae jo" href="https://github.com/apollographql/apollo-feature-requests/issues/114" rel="noopener ugc nofollow" target="_blank"> 2 </a>)</li><li id="c802" class="kb kc hi is b it kk ix kl jb km jf kn jj ko jn kg kh ki kj bi translated">(我怀疑<a class="ae jo" href="https://www.graphql-tools.com/docs/generate-schema" rel="noopener ugc nofollow" target="_blank">可执行模式</a>的实现可以以某种方式重用，但似乎没有人这么做？)</li></ul><p id="9df1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以上所有都是部分解决方案，或者不是你可以直接在apollo中使用的东西。</p><p id="4e7c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">graphql-zeus 来救援了！</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="3593" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kp">最后更新时间:2022.03 ( </em> <code class="du kq kr ks kt b"><em class="kp">graphql-zeus 4.0.4</em></code> <em class="kp"> ) </em></p><h1 id="db97" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">第一步，安装</h1><figure class="jx jy jz ka fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><h1 id="ab82" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">步骤2，生成类型</h1><figure class="jx jy jz ka fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="634a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以选择提交生成的文件或忽略它，并将生成的文件包含在您的构建脚本中。</p><h1 id="c0ac" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">步骤3，键入客户端</h1><p id="d15c" class="pw-post-body-paragraph iq ir hi is b it lu iv iw ix lv iz ja jb lw jd je jf lx jh ji jj ly jl jm jn hb bi translated"><code class="du kq kr ks kt b">— apollo</code>标志生成一个名为<code class="du kq kr ks kt b">useTypedQuery</code>的阿波罗<code class="du kq kr ks kt b">useQuery</code>的类型化版本，您可以立即使用。它接受类型化查询并返回类型化结果。</p><figure class="jx jy jz ka fd ij er es paragraph-image"><div class="er es jw"><img src="../Images/1d29e4e20c0ec7592c380c558c865c0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/1*pcpG_tDhRlK9seRtK-Y-vA.gif"/></div></figure><p id="957c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有时候不能用钩子(比如在<a class="ae jo" href="https://stackoverflow.com/a/71636434/2771889" rel="noopener ugc nofollow" target="_blank"> Next.js SSR </a>)。对于这些情况，您可以定义一个类似于<code class="du kq kr ks kt b">useTypedQuery</code>的<code class="du kq kr ks kt b">typedQuery</code></p><figure class="jx jy jz ka fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="ab11" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以在<a class="ae jo" href="https://github.com/thisismydesign/nestjs-starter" rel="noopener ugc nofollow" target="_blank">nestjs-starter repo</a>中看到这种做法，例如在<a class="ae jo" href="https://github.com/thisismydesign/nestjs-starter/blob/20f29ff421b6ab5e39f30930b9071e455b0705e6/src/client/pages/orders.tsx" rel="noopener ugc nofollow" target="_blank">订单页面</a>中。</p><p id="508a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">repo展示了一个用于快速原型制作的示例NestJS MVC架构。它<a class="ae jo" href="https://csaba-apagyi.medium.com/nestjs-react-next-js-in-one-mvc-repo-for-rapid-prototyping-faed42a194ca" rel="noopener">原生服务Next.js </a>作为前端，与GraphQL连接，以及一些附加功能，如通过Passport和Cognito进行身份验证。</p></div></div>    
</body>
</html>