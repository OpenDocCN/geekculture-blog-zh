<html>
<head>
<title>Redis Cluster on Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes上的Redis集群</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/redis-cluster-on-kubernetes-c9839f1c14b6?source=collection_archive---------0-----------------------#2021-11-24">https://medium.com/geekculture/redis-cluster-on-kubernetes-c9839f1c14b6?source=collection_archive---------0-----------------------#2021-11-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/549e04faa5f8d09361dba9bf7ed91fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hf8YnPS05P6FAKbibWKohA.png"/></div></div></figure><div class=""/><p id="8e2a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我的前一篇博文中设置了我的Kubernetes集群之后，我决定在其上部署一个Redis集群。做起来出奇的简单。</p><p id="565f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们需要创建一个包含以下内容的<code class="du jp jq jr js b">ConfigMap</code>:</p><figure class="jt ju jv jw fd hk"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="f12b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该配置将运行Redis集群，并使用AOF打开持久性(更多信息，请参见<a class="ae jo" href="https://redis.io/topics/persistence" rel="noopener ugc nofollow" target="_blank"> Redis持久性</a>)。</p><p id="173a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将上述内容放在名为<code class="du jp jq jr js b">redis-config-map.yaml</code>的文件中，并在集群上创建它:</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="648e" class="kd ke ht js b fi kf kg l kh ki">$ kubectl create -f redis-config-map.yaml</span></pre><p id="3a24" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了在Kubernetes上运行Redis集群，我们将使用一个<a class="ae jo" href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/" rel="noopener ugc nofollow" target="_blank"> StatefulSet </a>。使用以下内容创建一个名为<code class="du jp jq jr js b">redis-sts.yaml</code>的文件:</p><figure class="jt ju jv jw fd hk"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="32ec" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里将会发生的是，在集群的6个节点上，我们将运行一个Redis实例。这些实例都将使用单独的集群块存储设备来存储它们的AOF。</p><p id="0bf6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">继续创建有状态集合，如下所示:</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="3b19" class="kd ke ht js b fi kf kg l kh ki">$ kubectl create -f redis-sts.yaml</span></pre><p id="0c08" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在创建了有状态集，让我们定义我们需要的服务。创建一个名为<code class="du jp jq jr js b">Redis-service.yaml</code>的文件，其中包含以下内容:</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="b3eb" class="kd ke ht js b fi kf kg l kh ki">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: redis-cluster<br/>  namespace: redis<br/>spec:<br/>  type: ClusterIP<br/>  ports:<br/>  - port: 6379<br/>    targetPort: 6379<br/>    name: client<br/>  - port: 16379<br/>    targetPort: 16379<br/>    name: gossip<br/>  selector:<br/>    app: redis-cluster</span></pre><p id="318c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建服务:</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="165c" class="kd ke ht js b fi kf kg l kh ki">$ kubectl create -f redis-service.yaml</span></pre><p id="927e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建服务后，我们现在可以激活Redis集群:</p><figure class="jt ju jv jw fd hk"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="1489" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意，要收集每个Redis实例的<code class="du jp jq jr js b">ClusterIP</code>，您必须安装<code class="du jp jq jr js b">jq </code>(参见此处的<a class="ae jo" href="https://stedolan.github.io/jq/" rel="noopener ugc nofollow" target="_blank"/>)。</p><p id="118e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">恭喜你！现在，您已经在Kubernetes安装上启动并运行了一个Redis集群。</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="7eae" class="kd ke ht js b fi kf kg l kh ki">selector:</span><span id="6ed8" class="kd ke ht js b fi kj kg l kh ki">app: redis-cluster</span></pre></div></div>    
</body>
</html>