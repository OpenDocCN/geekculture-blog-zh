<html>
<head>
<title>Implement CRUD Functionality in Your ASP.NET Core App in 10 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在10分钟内实现ASP.NET核心应用的CRUD功能</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/super-easy-crud-for-asp-net-core-apps-with-easydata-library-6dd97e4ea38a?source=collection_archive---------5-----------------------#2021-05-19">https://medium.com/geekculture/super-easy-crud-for-asp-net-core-apps-with-easydata-library-6dd97e4ea38a?source=collection_archive---------5-----------------------#2021-05-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/870cef9d66f720fce03b2be0f86a8368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dv_A_aZwHHmtahUd.jpg"/></div></div></figure><h1 id="901f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">问题</h1><p id="c1c1" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">大多数业务应用程序的首要任务之一是为应用程序使用的主要实体实现CRUD(创建、读取、更新、删除)操作。</p><p id="b681" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">作为解决任务的一部分，每个开发人员都面临以下问题:</p><ul class=""><li id="8c41" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">CRUD页面和表单的创建是非常枯燥和耗时的。相信我，我去过那里很多次。</li><li id="5794" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">如果您手动完成，可能会非常慢并且容易出错(丢失字段、忘记验证器等)。</li><li id="ffaa" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">当然，你可以使用Visual Studio提供的脚手架工具。然而，这也不是一个快速的过程，因为您需要为每个模型类运行这个工具。结果，你得到很多。cs和。cshtml文件，如果默认行为或外观不符合您的需要，您必须手动编辑这些文件。在模型类发生变化的情况下，您需要手动更新那些生成的控制器和页面，或者为每个受影响的模型类从头开始重新生成代码和表单。</li><li id="3706" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">此外，即使是内置的脚手架也没有提供一些重要的，通常是必不可少的功能，如分页或搜索。</li></ul><h1 id="72b3" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">解决方案:EasyData库</h1><p id="eb63" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">为了解决这些问题中的大部分(如果不是全部的话)，我们创建了<a class="ae lf" href="https://github.com/KorzhCom/EasyData" rel="noopener ugc nofollow" target="_blank"> EasyData库</a>。EasyData的主要优点是它采用了声明式方法。整个过程可以分为两个主要步骤:</p><ol class=""><li id="d1f1" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl lg kx ky kz bi translated">您“描述”您想要处理的数据(实体和属性)以及您的应用程序应该如何处理这些数据(类型、约束、实体之间的关系等)。</li><li id="054c" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl lg kx ky kz bi translated">基于这些信息，EasyData库为CRUD操作建立了一个API端点，并建立了一个普通的基于JavaScript的UI，允许用户通过API执行这些操作。</li></ol><p id="6f18" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这里最奇妙的是，当使用Entity Framework Core时，第一步(“描述”数据)所需要的只是您的DbContext。只需将它“输入”到库中，EasyData就会自动提取创建API端点和CRUD UI所需的所有信息。</p><h1 id="f6ce" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">快速演示</h1><p id="0a0f" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">这里有一小段介绍视频，展示了EasyData的工作原理:</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/fb5ddb36e78ec15e9e89550c52e17702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8ewJmiceQhq0usM2.gif"/></div></div></figure><h1 id="953a" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">入门指南</h1><p id="5333" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">首先，为了测试EasyData，您可以打开并运行这个存储库中可用的<a class="ae lf" href="https://github.com/korzh/EasyData/tree/master/samples" rel="noopener ugc nofollow" target="_blank">示例项目</a>中的一个。</p><p id="78ef" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">将EasyData安装到您的项目需要以下三个简单的步骤:</p><h2 id="1707" class="lm ir hi bd is ln lo lp iw lq lr ls ja jz lt lu je kd lv lw ji kh lx ly jm lz bi translated">1.安装EasyData NuGet包</h2><ul class=""><li id="cfb4" class="kr ks hi jq b jr js jv jw jz ma kd mb kh mc kl kw kx ky kz bi translated">EasyData。AspNetCore</li><li id="7aa5" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">EasyData。实体框架工作核心关系</li></ul><h2 id="42bc" class="lm ir hi bd is ln lo lp iw lq lr ls ja jz lt lu je kd lv lw ji kh lx ly jm lz bi translated">2.在<code class="du md me mf mg b">Startup.Configure</code>中添加EasyData中间件</h2><figure class="li lj lk ll fd ij"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="3141" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在中间件选项中，我们还指定了将用作元数据来源的DbContext对象的类型。</p><h2 id="d8b0" class="lm ir hi bd is ln lo lp iw lq lr ls ja jz lt lu je kd lv lw ji kh lx ly jm lz bi translated">3.为所有CRUD操作设置一个总括页面</h2><p id="b5b5" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如果你使用Razor页面，添加一个新页面(例如<code class="du md me mf mg b">EasyData.chstml</code>)。如果是MVC，你需要一个控制器和一个视图。该页面将“捕捉”所有以某个前缀开头的URL(默认为<code class="du md me mf mg b">/easydata</code>，但这是可配置的)。因此，我们在路由定义中使用了一个特殊的总括参数(<code class="du md me mf mg b">"/easydata/{**entity}"</code>)。</p><p id="d97d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们还添加了EasyData样式和脚本文件(<code class="du md me mf mg b">easydata.min.js</code>)，它呈现数据管理UI并处理客户端的所有CRUD操作。</p><figure class="li lj lk ll fd ij"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="7d59" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">就是这样。现在你可以运行你的网络应用，打开<code class="du md me mf mg b">/easydata</code>网址，享受CRUD功能。</p><p id="fd95" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">结果将是这样的:</p><h2 id="2236" class="lm ir hi bd is ln lo lp iw lq lr ls ja jz lt lu je kd lv lw ji kh lx ly jm lz bi translated">一个实体的列表视图屏幕:</h2><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/6019673d3c15708e7885c99a1f84c741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Lavl59WCUFIzxJYG.jpg"/></div></div></figure><h2 id="c641" class="lm ir hi bd is ln lo lp iw lq lr ls ja jz lt lu je kd lv lw ji kh lx ly jm lz bi translated">“编辑记录”对话框:</h2><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/e00665990372d81dd7db25ca9b9189ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*o3Kg-qr-0VUmNRF2.jpg"/></div></div></figure><h2 id="06bc" class="lm ir hi bd is ln lo lp iw lq lr ls ja jz lt lu je kd lv lw ji kh lx ly jm lz bi translated">“查找”对话框(从“编辑记录”打开):</h2><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/2e5aa85ced71242c36f28da4d6f834ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*10anacycJHb_DMGX.jpg"/></div></div></figure><h1 id="5eda" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">它是如何工作的</h1><p id="2110" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">让我们简单回顾一下所有这些魔法是如何工作的。正如我们之前提到的，EasyData主要负责三件事:</p><ul class=""><li id="1a0a" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">它收集数据库元数据。</li><li id="b213" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">它为主要的CRUD操作建立了一个API。</li><li id="17a8" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">它呈现UI(同样基于元数据)并处理该UI中的所有用户交互。</li></ul><p id="4e05" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">让我们详细探索所有这些部分。</p><h2 id="6612" class="lm ir hi bd is ln lo lp iw lq lr ls ja jz lt lu je kd lv lw ji kh lx ly jm lz bi translated">[计]元数据</h2><p id="ae79" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">元数据是关于您的数据的数据:什么实体(表)存储在您的数据库中，它们是如何连接的，它们具有什么属性(字段)，属性的类型是什么，以及我们可以存储在这些属性中的值的约束是什么。</p><p id="67da" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">EasyData收集元数据(以这样或那样的方式)并将其存储在<code class="du md me mf mg b">MetaData</code>类的实例中。该对象包含实体(表)列表、每个实体的属性(字段)、实体之间的连接以及在API中以及在UI呈现和处理期间使用的一些附加信息。</p><p id="0691" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">为了填充元数据对象，我们指定了一个元数据加载器。在上面的例子中，我们是通过UseDbContext调用来实现的。因此，元数据是从DbConext对象中加载的。目前(在1.2版中)这是唯一可用的元数据加载器。在未来的版本中，可以直接从DbConnection对象加载元数据，或者使用其他方法。</p><h2 id="889d" class="lm ir hi bd is ln lo lp iw lq lr ls ja jz lt lu je kd lv lw ji kh lx ly jm lz bi translated">EasyData中间件</h2><p id="8b75" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">EasyData中间件负责为客户端发起的所有CRUD(而不仅仅是)操作建立REST API。</p><p id="2340" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">要将中间件添加到您的管道中，请使用<code class="du md me mf mg b">UseEndpoints</code>配置委托中的<code class="du md me mf mg b">MapEasyData</code>扩展函数:</p><figure class="li lj lk ll fd ij"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="6a2d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">此呼叫应在<code class="du md me mf mg b">MapMvc</code>或<code class="du md me mf mg b">MapRazorPages</code>之前进行。默认情况下，EasyData中间件被分配给<code class="du md me mf mg b">/api/easydata endpoint</code>，但是您可以通过参数中传递的配置函数(action)来更改它。</p><p id="3f60" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">为了对<code class="du md me mf mg b">MapEasyData</code>进行配置，唯一需要做的事情是告诉它在哪里获取元数据。目前，只有一种选择:从DbContext获取元数据。所以，这就是为什么我们在上面的例子中添加了<code class="du md me mf mg b">UseDbContext&lt;AppDbContext&gt;()</code> call。除了获取元数据，<code class="du md me mf mg b">UseDbContext</code>还为我们的中间件提供了执行CRUD操作的所有手段(通过DbContext对象)。</p><h2 id="5fc4" class="lm ir hi bd is ln lo lp iw lq lr ls ja jz lt lu je kd lv lw ji kh lx ly jm lz bi translated">EasyData用户界面根页面</h2><p id="fcd0" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">EasyData设置过程的第三部分是呈现CRUD用户界面的页面。它必须是一个所谓的“包罗万象”的剃刀页面或MVC视图。默认情况下，必须为任何以<code class="du md me mf mg b">/easydata/</code>前缀开头的路径打开该页面。(因此，所有像<code class="du md me mf mg b">/easydata/student</code>或<code class="du md me mf mg b">/easydata/invoice</code>这样的路径都必须由这个页面处理。)</p><p id="3056" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">注意:<code class="du md me mf mg b">/easydata</code>是默认前缀。您可以使用另一个名称，但是在这种情况下，有必要在我们的<code class="du md me mf mg b">RootDispatcherView</code>对象的选项中指定它。</p><p id="b444" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们的总括页面可以包含您选择的任何HTML元素。然而，为了确保CRUD UI的可视化和正常操作，它必须包括以下4个元素:</p><ul class=""><li id="0c91" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><code class="du md me mf mg b">&lt;link&gt;</code>引用EasyData CSS文件的元素(<code class="du md me mf mg b">easydata.min.cs</code>)</li><li id="1251" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">容器(空的<code class="du md me mf mg b">div</code>元素)，我们的界面将在其中显示。默认情况下，它必须具有ID <code class="du md me mf mg b">EasyDataContainer</code>，但这也可以通过选项进行配置。</li><li id="b28b" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><code class="du md me mf mg b">&lt;script&gt;</code>引用了<code class="du md me mf mg b">easydata.min.js</code>的元素。</li><li id="3f44" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">以及一个在页面加载时创建并启动<code class="du md me mf mg b">EasyDataViewDispatcher</code>对象的小脚本。</li></ul><p id="f6d1" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">你可以在上面的入门部分看到一个最简单的“总括”页面的例子。</p><h1 id="8dd5" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">包扎</h1><p id="2deb" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">目前，EasyData可以与。NET Core 3.1和。净5。显然，所有ASP.NET核心和实体框架核心版本都可以与。NET(核心)的支持。不过增加对之前版本的支持不会有问题。网芯甚至。NET Framework 4.x .如果有人需要，请<a class="ae lf" href="https://github.com/KorzhCom/EasyData/issues" rel="noopener ugc nofollow" target="_blank">在EasyData的GitHub资源库提交问题</a>。</p><p id="354d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">当我们已经了解我们将需要哪些数据，但不想在这些数据的最简单操作上花费大量时间时，EasyData是一个很好的工具，可以用来快速构建新项目的原型或创建POC(概念验证)。但是，我们希望最终能够在生产环境中全面使用该解决方案。</p><p id="543b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">因此，我们期待着听到您的任何意见或建议。当然，别忘了给GitHub上的EasyData资源库加个星，尤其是如果这个库对你有帮助，节省了一些时间的话。</p><p id="32d5" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">因此，我们期待着听到您的任何意见或建议。当然，别忘了给GitHub 上的<a class="ae lf" href="https://github.com/KorzhCom/EasyData" rel="noopener ugc nofollow" target="_blank"> EasyData资源库加一颗星，尤其是如果这个库对你有所帮助，节省了一些时间的话。</a></p></div><div class="ab cl mm mn gp mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hb hc hd he hf"><p id="bdcc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><em class="mt">最初发表于</em><a class="ae lf" href="https://korzh.com/blog/crud-asp-net-core-with-easydata" rel="noopener ugc nofollow" target="_blank">T5【https://korzh.com】</a><em class="mt">。</em></p></div></div>    
</body>
</html>