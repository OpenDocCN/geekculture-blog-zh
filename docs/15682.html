<html>
<head>
<title>Building a Simple Document Scanner in Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android中构建一个简单的文档扫描仪</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/building-a-simple-document-scanner-in-android-1b4b11b3e407?source=collection_archive---------6-----------------------#2022-11-14">https://medium.com/geekculture/building-a-simple-document-scanner-in-android-1b4b11b3e407?source=collection_archive---------6-----------------------#2022-11-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="0d88" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph"><a class="ae ge" rel="noopener" href="/@equipintelligence/list/android-development-8b0114100205">安卓开发</a></h2><div class=""/><div class=""><h2 id="2da4" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">在发展中学习</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/d4e87e0705ec1e2f1f15a78b198abd84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*toW3MkjZP-O7hhFT"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Photo by <a class="ae jw" href="https://unsplash.com/@cytonn_photography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Cytonn Photography</a> on <a class="ae jw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7073" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">我有一段时间全神贯注于机器学习，训练模型，清理和处理数据并部署它们。我认为有一个新项目可以提高我在Android中的开发技能，这将是一件很棒的事情。由于我已经在OpenCV上尝试了一段时间，我决定在Android上做一个文档扫描仪，因为我知道有很多库可以做得更好。这里是我的项目和用于构建应用程序的技术栈的概述。</p><h1 id="8c33" class="kt ku hi bd kv kw kx ky kz la lb lc ld ix le iy lf ja lg jb lh jd li je lj lk bi translated">内容</h1><ol class=""><li id="50bc" class="ll lm hi jz b ka ln kd lo kg lp kk lq ko lr ks ls lt lu lv bi translated">应用概述</li><li id="de70" class="ll lm hi jz b ka lw kd lx kg ly kk lz ko ma ks ls lt lu lv bi translated">用OpenCV Python开发文档抽取算法</li><li id="b28c" class="ll lm hi jz b ka lw kd lx kg ly kk lz ko ma ks ls lt lu lv bi translated">用Python中的FastAPI开发文档抽取服务器</li><li id="a1b8" class="ll lm hi jz b ka lw kd lx kg ly kk lz ko ma ks ls lt lu lv bi translated">创建用于文档提取和Docker图像的Streamlit web应用程序</li><li id="422a" class="ll lm hi jz b ka lw kd lx kg ly kk lz ko ma ks ls lt lu lv bi translated">用OpenCV Android(on-device solution)在Kotlin中实现文档提取算法</li><li id="f0c5" class="ll lm hi jz b ka lw kd lx kg ly kk lz ko ma ks ls lt lu lv bi translated">从Android应用程序调用API(基于API的解决方案)</li><li id="b428" class="ll lm hi jz b ka lw kd lx kg ly kk lz ko ma ks ls lt lu lv bi translated">实现GitHub动作来构建这两个应用的版本</li></ol><p id="182c" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><h1 id="5bed" class="kt ku hi bd kv kw kx ky kz la lb lc ld ix le iy lf ja lg jb lh jd li je lj lk bi translated">1.应用概述</h1><p id="99be" class="pw-post-body-paragraph jx jy hi jz b ka ln is kc kd lo iv kf kg mb ki kj kk mc km kn ko md kq kr ks hb bi translated">因此，我们将开发一个应用程序，它可以提取一个文档(或裁剪一个文档)，给用户一张图片。为了从图像中提取文档，我们将使用OpenCV中实现的图像处理管道或算法。</p><p id="b61a" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">图像处理将使用OpenCV的Android SDK在设备上进行，此外，我们将有一个服务器运行，应用程序将向其发布图像并获取图像中文档的坐标。因此，对于图像文档提取，我们有两种选择—基于设备和基于API的解决方案</p><h1 id="1f36" class="kt ku hi bd kv kw kx ky kz la lb lc ld ix le iy lf ja lg jb lh jd li je lj lk bi translated">2.开发文档提取算法— Python</h1><p id="d683" class="pw-post-body-paragraph jx jy hi jz b ka ln is kc kd lo iv kf kg mb ki kj kk mc km kn ko md kq kr ks hb bi translated">OpenCV是一个用C++编写的跨平台图像处理库。我们将使用操纵图像的各种参数来提取所需信息的技术，而不是使用笨重(在内存和大小方面)的花哨的ML算法。</p><div class="me mf ez fb mg mh"><a href="https://docs.opencv.org/4.x/d6/d00/tutorial_py_root.html" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab dw"><div class="mj ab mk cl cj ml"><h2 class="bd hs fi z dy mm ea eb mn ed ef hr bi translated">OpenCV: OpenCV-Python教程</h2><div class="mo l"><h3 class="bd b fi z dy mm ea eb mn ed ef dx translated">编辑描述</h3></div><div class="mp l"><p class="bd b fp z dy mm ea eb mn ed ef dx translated">docs.opencv.org</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv jq mh"/></div></div></a></div><p id="4542" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">我们将开发的算法将用于服务器(基于API的解决方案)以及Android应用程序(设备上的解决方案)。据我所知，在Python中使用OpenCV是最简单的，所以我们将用Python开发我们算法的原型。</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mw mx l"/></div><figcaption class="js jt et er es ju jv bd b be z dx">Snippet 1: The document extraction algorithm written in Python using OpenCV. See <a class="ae jw" href="https://github.com/shubham0204/Simple_Document_Scanner_Android/blob/api/document.py" rel="noopener ugc nofollow" target="_blank">document.py</a> in the <a class="ae jw" href="https://github.com/shubham0204/Simple_Document_Scanner_Android/tree/api" rel="noopener ugc nofollow" target="_blank">api</a> branch of the repo.</figcaption></figure><p id="1582" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">这里的算法是用一系列固定的步骤来处理图像，以提取文档的边界。<code class="du my mz na nb b">get_binarized_img</code>方法返回一个灰度+高对比度(ed)图像，给文档一个典型的类似“扫描仪”的效果。</p><h1 id="649e" class="kt ku hi bd kv kw kx ky kz la lb lc ld ix le iy lf ja lg jb lh jd li je lj lk bi translated">3.用Python中的FastAPI开发文档抽取服务器</h1><p id="9539" class="pw-post-body-paragraph jx jy hi jz b ka ln is kc kd lo iv kf kg mb ki kj kk mc km kn ko md kq kr ks hb bi translated">对于我们的应用程序需要的基于API的解决方案，我们需要一个服务器，应用程序可以用图像调用它，以返回提取的文档的坐标。为了开发这样一个服务器，我们使用了<a class="ae jw" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank"> FastAPI </a>，这是一个用Python编写的框架，可以用来开发API。</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mw mx l"/></div><figcaption class="js jt et er es ju jv bd b be z dx">Snippet 2: Creating an API to extract document and return the coordinates to the app. See <a class="ae jw" href="https://github.com/shubham0204/Simple_Document_Scanner_Android/blob/api/main.py" rel="noopener ugc nofollow" target="_blank">main.py</a> in the <a class="ae jw" href="https://github.com/shubham0204/Simple_Document_Scanner_Android/tree/api" rel="noopener ugc nofollow" target="_blank">api</a> branch of the repo.</figcaption></figure><p id="efe7" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">在给定(张贴的)图像中，包含文档的框的坐标采用x，y，宽度(w)和高度(h)的格式。我们可以在<code class="du my mz na nb b">localhost:8000</code>试试邮递员托管的API</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es nc"><img src="../Images/c8d809064a5cd431fdaa2dcb207fc701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k7RkmhOl-JZX3ITe9kD2qA.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Fig 1. The left window shows the image that was POSTed to the server. The response, as shown above, contains the coordinates in the form (x , y , w , h)</figcaption></figure><p id="b369" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">您可以使用<a class="ae jw" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank"> ngrok </a>临时部署或隧道服务器所在的端口。</p><h1 id="bba1" class="kt ku hi bd kv kw kx ky kz la lb lc ld ix le iy lf ja lg jb lh jd li je lj lk bi translated">4.创建用于文档提取和Docker图像的Streamlit web应用程序</h1><p id="8bbe" class="pw-post-body-paragraph jx jy hi jz b ka ln is kc kd lo iv kf kg mb ki kj kk mc km kn ko md kq kr ks hb bi translated">为了用Python测试我们自己的文档提取算法，我们用Streamlit创建了一个简单的基于web的GUI，它调用了<code class="du my mz na nb b">get_rect</code>方法。以这种方式返回的边界框的坐标。</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mw mx l"/></div><figcaption class="js jt et er es ju jv bd b be z dx">Snippet 3: Streamlit app for testing the document extraction algorithm. See <a class="ae jw" href="https://github.com/shubham0204/Simple_Document_Scanner_Android/blob/api/app.py" rel="noopener ugc nofollow" target="_blank">app.py</a> in the <a class="ae jw" href="https://github.com/shubham0204/Simple_Document_Scanner_Android/tree/api" rel="noopener ugc nofollow" target="_blank">api</a> branch of the repo.</figcaption></figure><p id="18c6" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">用<code class="du my mz na nb b">streamlit run app.py</code>运行应用程序，一个漂亮而简单的网络应用程序在<code class="du my mz na nb b">localhost</code>上打开，</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="nd mx l"/></div><figcaption class="js jt et er es ju jv bd b be z dx">Fig 2. Demo video of the Streamlit web app. Video by the Author</figcaption></figure><p id="1d86" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">我们得出结论，我们的API和web应用程序已经准备好了，所以我们可以将所有这些打包到Docker映像中。</p><p id="2017" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><docker_image_code/></p><h1 id="9a7e" class="kt ku hi bd kv kw kx ky kz la lb lc ld ix le iy lf ja lg jb lh jd li je lj lk bi translated">5.用OpenCV Android(on-device solution)在Kotlin中实现文档提取算法</h1><p id="08ab" class="pw-post-body-paragraph jx jy hi jz b ka ln is kc kd lo iv kf kg mb ki kj kk mc km kn ko md kq kr ks hb bi translated">我们现在从Python转到Kotlin代码。我们用Python和OpenCV开发的图像处理管道将被镜像，就像在Kotlin中使用<a class="ae jw" href="https://opencv.org/android/" rel="noopener ugc nofollow" target="_blank"> OpenCV的Android SDK </a>一样。</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mw mx l"/></div><figcaption class="js jt et er es ju jv bd b be z dx">Snippet 4: The document extraction algorithm written in Kotlin with OpenCV Android SDK. See <a class="ae jw" href="https://github.com/shubham0204/Simple_Document_Scanner_Android/blob/on_device_scanning_app/app/src/main/java/com/ml/shubham0204/simpledocumentscanner/opencv/CoreAlgorithm.kt" rel="noopener ugc nofollow" target="_blank">CoreAlgorithm.kt</a> in the <a class="ae jw" href="https://github.com/shubham0204/Simple_Document_Scanner_Android/tree/on_device_scanning_app" rel="noopener ugc nofollow" target="_blank">on_device_scanning_app</a> branch</figcaption></figure><h1 id="f23a" class="kt ku hi bd kv kw kx ky kz la lb lc ld ix le iy lf ja lg jb lh jd li je lj lk bi translated">6.从Android应用程序调用API(基于API的解决方案)</h1><p id="b59c" class="pw-post-body-paragraph jx jy hi jz b ka ln is kc kd lo iv kf kg mb ki kj kk mc km kn ko md kq kr ks hb bi translated">由于我们已经用Python开发了API，我们将用<a class="ae jw" href="https://square.github.io/okhttp/" rel="noopener ugc nofollow" target="_blank"> OkHttp </a>从Android客户端发送请求。我们确实有像<a class="ae jw" rel="noopener" href="/google-developer-experts/how-to-use-ktor-client-on-android-dcdeddc066b9"> Ktor </a>、<a class="ae jw" href="https://google.github.io/volley/" rel="noopener ugc nofollow" target="_blank">凌空</a>和<a class="ae jw" href="https://square.github.io/retrofit/" rel="noopener ugc nofollow" target="_blank">改型</a>这样的选项，用于从服务器发送和接收数据。</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mw mx l"/></div><figcaption class="js jt et er es ju jv bd b be z dx">Snippet 5: Sending requests to the server (built with FastAPI in Python). See <a class="ae jw" href="https://github.com/shubham0204/Simple_Document_Scanner_Android/blob/main/app/src/main/java/com/ml/shubham0204/simpledocumentscanner/api/DocumentScanner.kt" rel="noopener ugc nofollow" target="_blank">DocScanner.kt</a> in <a class="ae jw" href="https://github.com/shubham0204/Simple_Document_Scanner_Android/tree/main" rel="noopener ugc nofollow" target="_blank">main</a> branch of the repo.</figcaption></figure><p id="308f" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">虽然不可能分享这两个应用的全部代码，但我已经包括了代码库中重要和有趣的部分。用<code class="du my mz na nb b">TextureView</code>在屏幕上画一个框并从用户那里选择文件仍然需要很多代码。这是最终应用的演示，</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es ne"><img src="../Images/b0c4a330588f015f176b2ee4bee9df9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/1*Cmx3irBl8JUXqClLqm8EgA.gif"/></div><figcaption class="js jt et er es ju jv bd b be z dx">Fig 3. A demo for Simple Document Scanner. Image by the Author</figcaption></figure><h1 id="cc7c" class="kt ku hi bd kv kw kx ky kz la lb lc ld ix le iy lf ja lg jb lh jd li je lj lk bi translated">7.实现GitHub动作来构建这两个应用的版本</h1><p id="c863" class="pw-post-body-paragraph jx jy hi jz b ka ln is kc kd lo iv kf kg mb ki kj kk mc km kn ko md kq kr ks hb bi translated">一旦我们开发了应用程序，我们希望用GitHub Actions为这两个解决方案构建apk。我们的工作流程将执行以下步骤，用Gradle构建一个APK，并在GitHub存储库上创建一个发布。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es nf"><img src="../Images/02ede62a9940c365724d39d2031027b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*Haw61mJYnSPg1zbZWcYTGQ.png"/></div><figcaption class="js jt et er es ju jv bd b be z dx">Fig 4. Steps involved in <a class="ae jw" href="https://github.com/shubham0204/Simple_Document_Scanner_Android/blob/main/.github/workflows/build_apk.yml" rel="noopener ugc nofollow" target="_blank">build_apk</a> workflow.</figcaption></figure><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mw mx l"/></div><figcaption class="js jt et er es ju jv bd b be z dx">Snippet 6: The workflow for the <a class="ae jw" href="https://github.com/shubham0204/Simple_Document_Scanner_Android/blob/main/.github/workflows/build_apk.yml" rel="noopener ugc nofollow" target="_blank">build_apk</a> action.</figcaption></figure><h1 id="6af5" class="kt ku hi bd kv kw kx ky kz la lb lc ld ix le iy lf ja lg jb lh jd li je lj lk bi translated">这就把我们带到了终点</h1><p id="911f" class="pw-post-body-paragraph jx jy hi jz b ka ln is kc kd lo iv kf kg mb ki kj kk mc km kn ko md kq kr ks hb bi translated">通过开发应用程序来学习新的技术和框架是我所经历的编程中最棒的部分。这对其他初学者来说也是一个很好的学习项目。确保你启动了<a class="ae jw" href="https://github.com/shubham0204/Simple_Document_Scanner_Android" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>并分享开源之爱！</p><p id="5a3a" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">欢迎在GitHub repo上或这里的评论中分享你的建议和问题。祝你有美好的一天！</p></div></div>    
</body>
</html>