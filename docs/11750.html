<html>
<head>
<title>Exploring the Text Generation with GPT-NeoX</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用GPT-NeoX探索文本生成</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/exploring-the-text-generation-with-gpt-neox-de4092935948?source=collection_archive---------10-----------------------#2022-04-07">https://medium.com/geekculture/exploring-the-text-generation-with-gpt-neox-de4092935948?source=collection_archive---------10-----------------------#2022-04-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/430c07a3900aac257f7aae1ea7d12522.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LKrTdSsLesWhL_eD.jpg"/></div></div></figure><p id="f6a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在寻求开源GPT-3像175B参数模型的过程中，<a class="ae jo" href="https://www.eleuther.ai/" rel="noopener ugc nofollow" target="_blank">eleutherai</a>一直在做仪器工作，发布了一个又一个模型。最近从他们的魔法盒子里出来的是<a class="ae jo" href="https://github.com/EleutherAI/gpt-neox" rel="noopener ugc nofollow" target="_blank">GPT-尼奥克斯</a>！</p><h1 id="227f" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">什么是GPT-奈奥斯？</h1><p id="eff9" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">GPT-NeoX或GPT-NeoX-20B模型是一种自回归语言模型。这是一个与CoreWeave合作在Pile数据集上训练的200亿参数模型。</p><p id="6a2c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">据称，它是最大的公开可用的预训练通用自回归语言模型。</p><h1 id="0763" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">我们可以使用它构建什么类型的应用程序？</h1><p id="0841" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">借助GPT-NeoX模型，我们可以构建文本摘要、释义、代码生成、内容编写、文本自动更正、文本自动完成、聊天机器人和文本生成等应用程序。</p><h1 id="b923" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">模型可以使用吗？</h1><p id="64c7" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">是的，这种型号可以使用。GPT-NeoX的Github页面上提供了模型权重链接。Github资源库链接在参考资料中共享。</p><h1 id="6712" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">用GPT NeoX生成文本</h1><p id="51a7" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">要从GPT-NeoX生成文本，我们需要执行一系列步骤。但在此之前，我们需要一个可以加载GPT-尼欧克斯模型的实例。</p><p id="e55f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">根据GPT-NeoX模型Github知识库，我们将需要至少2个GPU，我们将需要超过45GB的GPU内存。此外，还需要30–40GB的系统RAM(内存)。</p><p id="364f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以使用GPT NeoX生成三种类型的文本。</p><ul class=""><li id="be6d" class="ks kt hi is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated"><strong class="is hj">无条件文本生成:</strong>在使用GPT-NeoX的无条件文本生成中，我们只是从模型中生成文本，而不向模型提供任何输入。</li><li id="2f93" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated"><strong class="is hj">条件文本生成:</strong>与无条件文本生成相反，条件文本生成需要文本的开始。在向模型提供一个起始句子之后，模型将预测下一个标记，以此类推。</li><li id="0d89" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated"><strong class="is hj">交互式文本生成:</strong>交互式文本生成允许通过命令行界面在用户和语言模型之间进行多轮交互。</li></ul><h1 id="a112" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">在GCP虚拟机实例上设置GPT-NeoX的步骤</h1><p id="c545" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">要在GCP/AWS上设置GPT-NeoX，我们需要一个具有45GB GPU RAM和40GB CPU RAM的实例。在AWS上，我们将需要<strong class="is hj"> g4dn.12xlarge </strong>或类似的实例。</p><p id="2d7a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤1: </strong>安装必要的ubuntu依赖项:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="010e" class="lp jq hi ll b fi lq lr l ls lt">sudo apt update<br/>sudo apt install python3-pip python3-dev build-essential libssl-dev libffi-dev<br/>sudo python3-setuptools<br/>sudo apt install virtualenv<br/>sudo apt install git<br/>sudo apt install wget<br/>sudo apt install vim</span></pre><p id="00ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤2: </strong>设置Github资源库:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="030f" class="lp jq hi ll b fi lq lr l ls lt">git clone <a class="ae jo" href="https://github.com/EleutherAI/gpt-neox.git" rel="noopener ugc nofollow" target="_blank">https://github.com/EleutherAI/gpt-neox.git</a><br/>cd gpt-neox/<br/>virtualenv env_gpt_neox --python=python3<br/>source env_gpt_neox/bin/activate<br/>pip install torch==1.8.2+cu111 torchvision==0.9.2+cu111 torchaudio==0.8.2 -f <a class="ae jo" href="https://download.pytorch.org/whl/lts/1.8/torch_lts.html" rel="noopener ugc nofollow" target="_blank">https://download.pytorch.org/whl/lts/1.8/torch_lts.html</a><br/>pip install -r requirements/requirements.txt<br/>python /root/gpt-neox/megatron/fused_kernels/setup.py install</span></pre><p id="21d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在执行第2步时，我们在安装mpi4py时遇到了一个错误，并通过以下方法解决了该错误:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="d019" class="lp jq hi ll b fi lq lr l ls lt">pip install pip --upgrade<br/>sudo apt install libopenmpi-dev<br/>pip install -r requirements/requirements.txt</span></pre><p id="4ee5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您遇到YAML错误，请运行以下命令:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="b5e4" class="lp jq hi ll b fi lq lr l ls lt">pip install -U PyYAML</span></pre><p id="c7fb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤3: </strong>下载模型并更改配置:</p><p id="626c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下命令将下载39GB的数据。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="92b0" class="lp jq hi ll b fi lq lr l ls lt">wget --cut-dirs=5 -nH -r --no-parent --reject "index.html*" <a class="ae jo" href="https://mystic.the-eye.eu/public/AI/models/GPT-NeoX-20B/slim_weights/" rel="noopener ugc nofollow" target="_blank">https://mystic.the-eye.eu/public/AI/models/GPT-NeoX-20B/slim_weights/</a> -P 20B_checkpoints</span></pre><p id="90d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将管道并行大小设置为GPU数量的一半。/configs/20B.yml "文件。假设您有4个GPU，那么您的管道并行大小将是2。</p><p id="cb34" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用命令打开配置文件:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="0644" class="lp jq hi ll b fi lq lr l ls lt">vim ./configs/20B.yml</span></pre><p id="c1e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并将文件中的“管道平行尺寸:4”更改为“管道平行尺寸:2”。</p><p id="0a6b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第四步:</strong>用GPT-NeoX生成文本:</p><p id="15de" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要无条件生成文本，请运行以下命令:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="603a" class="lp jq hi ll b fi lq lr l ls lt">python ./deepy.py generate.py ./configs/20B.yml</span></pre><p id="cf90" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于条件文本生成:</p><p id="ad32" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建一个prompt.txt文件，将您的输入放在文件中，用“\n”分隔，然后运行下面的命令。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="4e30" class="lp jq hi ll b fi lq lr l ls lt">python ./deepy.py generate.py ./configs/20B.yml -i prompt.txt -o sample_outputs.txt</span></pre><p id="d622" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出将在“sample_outputs.txt”文件中生成。</p><h1 id="5770" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">样本文本-由GPT-NeoX生成</h1><p id="9736" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">对于无条件文本生成，下面是一些示例输出:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="3581" class="lp jq hi ll b fi lq lr l ls lt">1. Response: {<br/>    "context": "",<br/>    "text": "A systematic review and meta-analysis of the efficacy of endoscopic balloon dilation for anastomotic strictures after esophagectomy.\nEndoscopic balloon dilation (EBD) is widely used to treat anastomotic strictures after esophagectomy; however, there is no consensus on its efficacy. This systematic review and meta-analysis was performed to assess the efficacy of EBD for anastomotic strictures after esophagectomy. A literature search was performed on PubMed, Embase, and the Cochrane Library to identify eligible studies",<br/>    "length": 102,<br/>    "finished": false,<br/>    "message": null,<br/>    "duration_seconds": 9.70399785041809<br/>}</span><span id="5db1" class="lp jq hi ll b fi lu lr l ls lt">2. Response: {<br/>    "context": "",<br/>    "text": "Aquaman (2018)\n\nAquaman is the DC Comics hero who can command the seas. He is a powerful swimmer and can communicate with sea life.\n\nAquaman has been the king of Atlantis since the day he was born. He is the only child of the King of Atlantis, Tom Curry, and Queen Atlanna. Aquaman\u2019s parents were killed in a mysterious accident when he was a young boy, and Aquaman was raised by his step-mother",<br/>    "length": 102,<br/>    "finished": false,<br/>    "message": null,<br/>    "duration_seconds": 9.708730936050415<br/>}</span></pre><p id="b01c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">条件文本生成的示例输出:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="d679" class="lp jq hi ll b fi lq lr l ls lt">Response:<br/>{<br/>    "context": "Electric cars will",<br/>    "text": " not be able to compete with conventional vehicles without a government-backed $15,000 rebate.\n\nIn fact, he said the government would need to spend hundreds of billions of dollars to encourage people to switch from their gas guzzlers to electric cars.\n\n\"I can't see it happening. It's not economic. What are we doing with the $15,000 rebate? It's not economic. It's not going to happen.\"\n\nMr Joyce said the lack of infrastructure and battery technology meant electric vehicles were not viable for consumers at this stage.\n\nHe said the Government should instead focus on developing more efficient engines, encouraging people to switch to smaller cars and investing in public transport.\n\n\"We need to get out of this mindset that we're going to have to have electric vehicles to reduce emissions,\" he said....",<br/>    "length": 694,<br/>    "finished": true,<br/>    "message": null,<br/>    "duration_seconds": 69.99025082588196<br/>}</span><span id="f054" class="lp jq hi ll b fi lu lr l ls lt">Note: "We truncated the text response as we just providing the sample to show the response format."</span></pre><h1 id="a24f" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">模型生成令牌所用的时间</h1><p id="0044" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我们还记下了模型加载后生成令牌的时间，以检查GPT-NeoX模型的速度性能。</p><p id="b22e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">具有以下配置的Google云平台虚拟机实例用于生成令牌:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="c6c7" class="lp jq hi ll b fi lq lr l ls lt">Instance name: n1-standard-16<br/>16 vCPUs<br/>60GB RAM<br/>4 Nvidia Tesla T4 GPUs<br/>Ubuntu 20.04</span></pre><p id="2dc1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">生成令牌所用的时间:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="b062" class="lp jq hi ll b fi lq lr l ls lt">For 100 tokens it takes around 8-12 seconds<br/>For 200 tokens it takes around 20-25 seconds<br/>For 512 tokens it takes around 45-55 seconds<br/>For 1024 tokens it takes around 100-110 seconds</span></pre><p id="15f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">希望你喜欢我们在GPT-奈奥斯上的实验。我们正在进一步努力对GPT-NeoX进行微调，并改善该模型的性能/推理时间。</p><h1 id="f8da" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">参考资料:</h1><p id="38b9" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">【http://eaidata.bmk.sh/data/GPT_NeoX_20B.pdf T2】链接GPT-NeoX论文:<a class="ae jo" href="http://eaidata.bmk.sh/data/GPT_NeoX_20B.pdf" rel="noopener ugc nofollow" target="_blank"/></p><p id="f423" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">链接https://github.com/EleutherAI/gpt-neox</strong>GPT-NeoX Github回购: <a class="ae jo" href="https://github.com/EleutherAI/gpt-neox" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"/></a></p></div><div class="ab cl lv lw gp lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hb hc hd he hf"><p id="25bf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mc">原载于2022年4月7日</em> <a class="ae jo" href="https://www.pragnakalp.com/exploring-the-text-generation-with-gpt-neox" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> <em class="mc">与GPT一起探索文字生成——NeoX</em></strong></a><em class="mc">。</em></p></div></div>    
</body>
</html>