<html>
<head>
<title>The Story of a Backend — The Database Decisions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">后端的故事—数据库决策</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/the-story-of-a-backend-the-database-decisions-39f197f65d4?source=collection_archive---------31-----------------------#2021-08-29">https://medium.com/geekculture/the-story-of-a-backend-the-database-decisions-39f197f65d4?source=collection_archive---------31-----------------------#2021-08-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b08dec2a57c0c730ceda3580e54643ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PStD3x7vvG__QymD"/></div></div></figure><p id="d48f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">大家好，欢迎来到这个奇妙后端之旅的第二章。</p><p id="a953" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个故事中，我将尝试介绍后端的创建，并链接一些有用的链接，看看如何托管它，并向世界展示你的惊人工作。这将是更多的编程概念博客，如果你想知道如何开始建立一个后端，请阅读第一部分<a class="ae jo" href="https://cenzio-rey.medium.com/the-story-of-a-backend-the-beginning-e51a31ea83d5#0af8-ef580103d645" rel="noopener">这里</a>。</p><p id="baed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了这篇文章，我将假设创建一个博客应用程序的后端。</p><p id="ce09" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，对于我们的应用程序，假设我们希望应用程序允许用户匿名发帖(这种调整是为了方便我以简洁的方式涵盖尽可能多的概念)。让我们列出应用程序中我们想要的功能</p><p id="7c3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">我们想从后端得到什么:</strong></p><p id="b791" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">→它应该能够接收帖子并将其存储在数据库中(我们将使用sql数据库，只是为了给出一个堆栈的概念，而不是普遍显示的堆栈)。</p><p id="e248" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">→它应该允许用户自己注册(因为我刚刚意识到这是每个web应用程序都要做的最基本的事情，最好演示一下如何处理密码等)。</p><p id="9c20" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">→它应该能够从数据库中获取帖子，并将其发送到前端(使用REST API调用。我们在这里会抛出很多JSON)。</p><p id="83bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">→应该能够让用户登录(我们还将从我们这边发送一个令牌，这样用户就可以通过身份验证，而不必反复登录。就像在现实生活中一样😀).</p><p id="5b0c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如承诺的那样，我将向您展示一个非常模块化的后端，同时考虑到开发人员的便利性。让我们来看一下目录结构:</p><p id="7b53" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了实现模块化，我们为数据库、路由和配置创建了一个目录。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es jp"><img src="../Images/8ded94e54e7c0bed0de586f69cd8b25e.png" data-original-src="https://miro.medium.com/v2/resize:fit:336/format:webp/1*4lmKvJG3VIbaYHmuutve3w.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">a sample directory structure</figcaption></figure><p id="a319" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在你可以看到后端的每个方面是如何被分离在不同的文件和文件夹中，这使得代码非常容易维护和修改。</p><p id="7684" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们一步一步地检查文件和文件夹，看看什么是什么的目的。(附“*”。使用“ts”是因为这是我用来创建我的一个项目的typescript代码，typescript基本上是更类型安全的javascript。请不要惊慌，您也可以在javascript中做同样的事情，事实上，相同的基本概念可以在任何其他语言中使用)</p><p id="8630" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">数据库讨论:</strong></p><p id="4b22" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好了，这就是我们想要从后端得到的四个非常基本的任务。让我们来讨论一下我们将用来存储信息的表。截至目前，我们只需要两张桌子。为什么？因为我们要做的只是存储用户和帖子。现在，因为我们有一个用户表，我们可以知道是谁发的帖子，但我仍然希望帖子是匿名的，所以我不要求电子邮件，只需要一个时髦的用户名就足够了(理想情况下应该是唯一的，有非常简单的方法来实现这一点，所以对于我们的应用程序，我假设所有的用户名都是唯一的。基础在这一点上更重要)。</p><p id="3c08" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，下面将是两个表模式(记住我们将后端链接到一些基于SQL的数据库，它们有一个固定的模式)。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es jy"><img src="../Images/0beca68ebc64cee9813f0253d21bd20c.png" data-original-src="https://miro.medium.com/v2/resize:fit:332/format:webp/1*7tFvepajM0qRngqET2NhuA.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">sample table for blogs</figcaption></figure><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es jz"><img src="../Images/263df7b656a8dd7d82ec5f5ed32be4c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:262/format:webp/1*2lJhepRQK6xlEJmcEoGWbg.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">sample table for users</figcaption></figure><p id="14c0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">考虑上面两个我们将使用的非常基本的表。为了安全起见，我们将使用哈希来存储密码的哈希，并检查用户密码的哈希，而不是将密码存储为纯文本。</p><p id="5ca4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“models”文件夹包含关于表的模式的信息，例如，对于用户表，model文件夹将包含一个文件users.js或users.ts(如果您愿意，您可以将该文件称为ironman <.js or="" .ts="">,但命名为users对我来说更有意义，但只要对您有意义，您可以随意使用它)。以下是users.ts文件将包含的后端内容示例:</.js></p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es ka"><img src="../Images/0f8dd853275d56232b3a90a2866251b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:358/format:webp/1*jk9M2J7SEcmBVuRYH3dsfw.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">users.ts</figcaption></figure><p id="a499" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我希望这有意义。文件导出一个名为user的界面，你将在一分钟左右明白它做什么(试图制造悬念！).</p><p id="502c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">类似地，我们将在blogs模型中创建另一个文件条目(我将它命名为blogs.ts，但是也可以随意命名它，只要对您有意义就行)。现在，在这一点上，我可以把我所做的另一个代码片段，但为了加强悬念，我会让你去做(提示:参考模式，以确定所有的东西都需要在其中)。如有任何疑问，请随时联系我，我将尽最大努力澄清疑问。</p><p id="97ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们只处理两个表，所以我们只在目录中保存这两个模型。</p><p id="0ecc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们有了模型，让我们开始真正的交易，开始构建数据库dir。数据库目录包含一个索引文件(类似于入口点)、database.ts文件(数据库设置的基本活动，如初始化数据库、确保指定的表存在并更新所有元数据)、utils.ts(连接到数据库并查询数据库任务由该文件的代码处理)和包含用于执行CRUD(C创建、R读取、U更新、D删除)的函数的表目录。只是想给你介绍一下这个名词也是)手术台上的。</p><p id="2571" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，对于我们的博客应用程序，下面分别是index、database、utils.ts文件的内容:</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es kb"><img src="../Images/aac9f630da75026da4218c428afa17e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*-y1qBvSojh_MI6D0v_kJAA.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">database.ts content</figcaption></figure><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kc"><img src="../Images/12e9fba527792511d4fbd9183d627845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iKkpmWkHXeretZld-N5wvw.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx">utils.ts contents</figcaption></figure><p id="fbec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如前所述，我们将连接凭证存储在一个单独的cnfig文件中。这样做的总体目的是为了能够灵活地连接到不同的数据库，如果出于某种原因您想要切换的话。我说过，模块化++。</p><p id="3356" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将在以后的文章中详细讨论数据库。希望那封信也能很快寄到😬。</p><p id="f937" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">仅供参考/DIY，配置文件如下所示…..</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es kd"><img src="../Images/0c89a04d73c4966ed28841c6eaf16a74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*Qm0idi5PPYQ3i1yze-IpBA.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">as of now, this is your config file</figcaption></figure><p id="a77f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好了，现在我们来谈谈做桌子的事。ts调用表的ensureTable方法来确保数据库中存在表。</p><p id="7cf5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">示例表格文件如下所示:</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es ke"><img src="../Images/6ca12b7f840dd1dd6e3dd10cd588098f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*pUMQ71i-2ButQf1mDOKtDw.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">an example of tables</figcaption></figure><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es kf"><img src="../Images/ad0cf9b9bd7d347254a446a76d2ce6c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:316/format:webp/1*hZWqSU-8TyGdQgnIxQgx2Q.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">this is where the tables go</figcaption></figure><p id="783d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">index.ts就是所有东西被扔向外界的地方(我指的是初始化方法)。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es kg"><img src="../Images/528224bd5262bb03c146b32a895c3511.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*A9SbNtGazaINb8lkTTK44w.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">index.ts</figcaption></figure><p id="057a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">附注:忽略那些歪歪扭扭的行，代码片段是在需要时编写的，不能随意展示任何已部署的代码，只是示例🙂。</p><p id="7d05" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这可能又是一篇太长的文章，我真的不想在一篇文章中写太多..所以，下一篇文章再见，我将讨论🤔..让我们看看……一旦这个帖子完成，链接将会在这里，不会更远，在这里。</p><p id="0392" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">链接到一个有趣的链接到<a class="ae jo" href="https://www.youtube.com/watch?v=rRoy6I4gKWU&amp;t=4s" rel="noopener ugc nofollow" target="_blank"> SQL和NOSQL数据库讨论</a>。</p><p id="d103" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">直到后来！！..✌</p><p id="f110" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://cenzio-rey.medium.com/the-story-of-a-backend-paving-the-paths-7d22d2a6022c" rel="noopener">点击这里看下一章……</a></p></div></div>    
</body>
</html>