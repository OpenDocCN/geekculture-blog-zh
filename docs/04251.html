<html>
<head>
<title>Take your test automation to next level with Selenium 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Selenium 4将您的测试自动化提升到一个新的水平</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/take-your-test-automation-to-next-level-with-selenium-4-c9835611b3de?source=collection_archive---------18-----------------------#2021-06-23">https://medium.com/geekculture/take-your-test-automation-to-next-level-with-selenium-4-c9835611b3de?source=collection_archive---------18-----------------------#2021-06-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/0b44e91175771f62febb6ff14f184d30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r3dYp9OeVkwcB9k31nbiEg.png"/></div></div></figure><div class=""/><p id="1b0b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你们中的许多人可能听说过最近关于发布新的Selenium 4的消息(在撰写本文时是测试版)。这里有一个很棒的链接，解释了Selenium 4的一些关键特性，下面是候选列表。</p><ul class=""><li id="501d" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">相对定位器</li><li id="4748" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">窗口和标签管理</li><li id="a07a" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">Chrome DevTools协议</li><li id="5cec" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">可观察性</li><li id="39b6" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">增强型例外</li></ul><p id="3ed5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">作为一个测试自动化爱好者，我很想了解新的特性，并且非常想尝试一下。我不得不说，新的特性确实很出色，并将测试自动化带到了一个新的高度。尤其是对Chrome DevTools的支持是一个游戏改变者！</p><p id="9fc0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇博文中，我将特别关注你可以用Chrome DevTools做什么，以及这将如何极大地帮助测试社区。</p><h1 id="4514" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">背景和使用案例</h1><p id="56c0" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">如果你一直在测试自动化领域，我相信会有很多场合，我们会说:“这个特定的场景”是不可能自动化的，或者它太复杂了，不值得自动化。尽管我们喜欢自动化任何事情，但考虑到项目的时间和资源有限，这并不总是可能的。我们倾向于务实，并基于我们自动化工作的投资回报(ROI)来决定自动化测试用例。</p><p id="675b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">其中一个领域就是测试UI上的错误场景。如今，大多数网站都是基于单页面应用模式构建的，使用ReactJS和Angular JS这样的框架。问题是，单页应用程序有许多彼此异步的组件，这些组件的外观变得不可预测。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es lg"><img src="../Images/439960386f45021eb0e3717127be9bfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/1*Tn4ZiqTZKMFaNiWQWnCATQ.gif"/></div><figcaption class="ll lm et er es ln lo bd b be z dx">Sample react loading skeleton</figcaption></figure><p id="8d5b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">非常重要的是，我们必须确保用户体验不会受到影响，即使在API、GraphQL调用和网络问题的幕后出现任何延迟或错误，也能得到妥善处理。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es lp"><img src="../Images/41c2b6742025d4ce1fa11f62562daf92.png" data-original-src="https://miro.medium.com/v2/resize:fit:200/1*bGfLSTOHn4dCnNWcHrgkGg.gif"/></div><figcaption class="ll lm et er es ln lo bd b be z dx">Sample spinner component</figcaption></figure><p id="d0cc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有许多加载器组件，如微调器、加载骨架和其他动画，可以优雅地处理延迟和错误。我们如何确保它们在不同的情况和条件下都能正确一致地工作？</p><p id="c853" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是，我们从来没有费心去自动化这样的场景，因为模拟这些场景并在UI级别创建断言是非常复杂的，因为没有一个测试自动化工具能够轻松地自动化它们。因此，我们最终手动测试它，并希望它不会打破！</p><h1 id="6a4a" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">Selenium 4和DevTools助您一臂之力</h1><p id="a638" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">现在，随着Selenium 4的发布，以及对Chrome DevTools的支持，创建和自动化复杂的测试条件和断言变得非常容易。在我们看例子之前，让我们先了解一些基本原理。</p><h2 id="08da" class="lq ke ht bd kf lr ls lt kj lu lv lw kn jb lx ly kr jf lz ma kv jj mb mc kz md bi translated">Chrome开发工具</h2><p id="fd2a" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">Selenium 4引入了一个新的API，允许从自动化测试中直接访问Chrome DevTools。这是通过Chrome DevTools协议(CDP)完成的，它本质上是一组工具，使您能够访问和控制基于Chromium的浏览器。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es me"><img src="../Images/3d131807e6ed78c9fc1edb18730120f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tMfS_jNOPhPFxofxfkYo-w.png"/></div></div><figcaption class="ll lm et er es ln lo bd b be z dx">Chrome developer tools</figcaption></figure><p id="6cb5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是不可思议的，因为它让你可以访问强大的Chrome开发者(右击并点击Chrome浏览器上的inspect)功能，如控制台日志、网络、性能等。</p><p id="dd1c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看一些测试代码，看看我是如何设法模拟上面讨论的真实用例，并使用DevTools为我的一个客户的一个项目进行自动化的。</p><h2 id="a792" class="lq ke ht bd kf lr ls lt kj lu lv lw kn jb lx ly kr jf lz ma kv jj mb mc kz md bi translated">用例1:设置网络速度来模拟延迟</h2><p id="d148" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">特定的测试用例将在不同的网络条件下执行，如蜂窝2G、3G和快速WIFI等。我们的期望是，当互联网访问很差时，页面显示微调器和加载框架，而当页面加载很快时，不显示。</p><p id="4773" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个练习中，我将使用一个<a class="ae jo" href="https://demo.opencart.com/" rel="noopener ugc nofollow" target="_blank">演示电子商务网站</a>。我打算将网速设置为慢3G，并希望在页面仍在加载时检查加载骨架是否显示。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mf"><img src="../Images/5397c4e850a8edc04af6d762fa51ecf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tkwSZtY9tOxnWmLvMGqlEw.gif"/></div></div></figure><p id="d85f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如您从下面的java代码示例中看到的，我们可以选择使用DevTools，它为我们提供了选择不同网络连接类型的选项，如2G、3G、4G、WIFI等。</p><pre class="lh li lj lk fd mg mh mi mj aw mk bi"><span id="92c3" class="lq ke ht mh b fi ml mm l mn mo">@Test<br/>public void networkTest() throws Exception {<br/>   ChromeDriver driver = new ChromeDriver();<br/><br/>    DevTools devTools = driver.getDevTools();<br/>    devTools.createSession();<br/>    devTools.send(Network.<em class="mp">enable</em>(Optional.<em class="mp">empty</em>(), Optional.<em class="mp">empty</em>(), Optional.<em class="mp">empty</em>()));<br/><br/>    //Set the desired network speed<br/>    devTools.send(Network.<em class="mp">emulateNetworkConditions</em>(<br/>            false,<br/>            100,<br/>            2000,<br/>            50000,<br/>            Optional.<em class="mp">of</em>(ConnectionType.<em class="mp">CELLULAR3G</em>)<br/>    ));<br/><br/>    //Launch the site and see the test running at the speed as per the setting above<br/>    driver.get(BASE_URL);</span><span id="21be" class="lq ke ht mh b fi mq mm l mn mo">//The assertion check for the loading skeleton to be displayed at this speed</span><span id="b475" class="lq ke ht mh b fi mq mm l mn mo">    Assert.<em class="mp">assertTrue</em>( driver.findElement(By.<em class="mp">cssSelector</em>("skeleton")).isDisplayed(), "Loading skeleton is present");<br/>}</span></pre><h2 id="0bfe" class="lq ke ht bd kf lr ls lt kj lu lv lw kn jb lx ly kr jf lz ma kv jj mb mc kz md bi translated">用例2:阻塞模拟错误条件的请求</h2><p id="7476" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">在这个用例中，我们将模拟网站上的错误情况，并确保页面按照预期正确处理错误。Chrome DevTools为我们提供了一个优秀的工具，叫做“阻塞请求”。您可以选择阻止特定的URL或整个域。当您启动带有URL块的网站时，该网站的行为将与特定后端服务出现问题时的响应完全相同。</p><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mr"><img src="../Images/d4664852a3db81eb3132743e23020429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*SgTttkBfP4JfekdpxH0dKg.gif"/></div></div><figcaption class="ll lm et er es ln lo bd b be z dx">Blocking request manually via Chrome devtools</figcaption></figure><p id="6503" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如何通过Selenium 4 devTools功能实现同样功能的Java示例</p><pre class="lh li lj lk fd mg mh mi mj aw mk bi"><span id="d1a2" class="lq ke ht mh b fi ml mm l mn mo">@Test<br/>public void blockingTest() throws Exception {<br/>    ChromeDriver driver = new ChromeDriver();<br/><br/>    DevTools devTools = driver.getDevTools();<br/>    devTools.createSession();<br/>    devTools.send(Network.<em class="mp">enable</em>(Optional.<em class="mp">empty</em>(), Optional.<em class="mp">empty</em>(), Optional.<em class="mp">empty</em>()));<br/>    String urlToBlock= BASE_URL+"/products/category=25";<br/>    devTools.send(Network.<em class="mp">setBlockedURLs</em>(ImmutableList.<em class="mp">of</em>(urlToBlock)));<br/>    driver.get(BASE_URL);<br/>    Assert.<em class="mp">assertEquals</em>( driver.findElement(By.<em class="mp">cssSelector</em>(".error")).getText(), "Something went wrong, try again");<br/>}</span></pre><h2 id="ae75" class="lq ke ht bd kf lr ls lt kj lu lv lw kn jb lx ly kr jf lz ma kv jj mb mc kz md bi translated">需要注意的主要发现:</h2><p id="d1f1" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">我们已经在一个实时项目中使用了新的Selenium4特性。虽然功能很棒，但我们也意识到了一些局限性。如果您还没有开始将以下几点整合到您的项目中，那么它们可能会对您有所帮助。</p><ol class=""><li id="b34b" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ms jv jw jx bi translated">Chrome devTools只能在Chrome浏览器上运行。因此，你需要确保你专门为这些测试初始化Chromedriver。大多数测试人员将拥有一个全面的测试框架，在这个框架中，您可以隐藏整个驱动程序设置，并可以使用抽象方法来访问通用WebDriver，以便在测试中直接使用。但是通用WebDriver或RemoteWebDriver不会给你getDevTools()方法的选项！</li></ol><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es mt"><img src="../Images/ebfbc8f466f12548215bba37bede2810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*q-PyrmTHWlDPHtfOjX9lVQ.png"/></div></figure><p id="a097" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.你还不能在Browserstack或CrossBrowserTesting工具这样的云测试平台上使用Chrome devtools测试。这是因为RemoteWebDriver上还不支持Selenium4 CDP功能。不幸的是，在提供这种支持之前，我们只能在本地Chrome浏览器上运行测试。</p><p id="7a74" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.您可能需要更新您的Selenium4和devTools库，以使其适用于最新版本的Chrome。在我的例子中，我最初使用的是一个特定的alpha版本，但是几周后测试开始失败。这是因为旧的alpha版本与新的Chrome更新不兼容。所以我不得不将selenium升级到最新版本。</p><p id="a1e0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我希望你喜欢这篇文章，并祝你在项目中使用Selenium4好运！</p></div></div>    
</body>
</html>