<html>
<head>
<title>Backend — Full App for tracking currencies with Vuejs3 (Composition Api, Store without Vuex) + Nodejs (Typescript, Express, Axios)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">后端—使用Vuejs3(组合Api，不带Vuex的Store)+Nodejs(Typescript，Express，Axios)跟踪货币的完整应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/full-app-for-tracking-currencies-with-vuejs3-composition-api-store-without-vuex-nodejs-f352e0f848f7?source=collection_archive---------13-----------------------#2021-04-25">https://medium.com/geekculture/full-app-for-tracking-currencies-with-vuejs3-composition-api-store-without-vuex-nodejs-f352e0f848f7?source=collection_archive---------13-----------------------#2021-04-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d23f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们创建API来为我们的前端应用程序提供所有数据。</p><p id="412e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">摘要</p><ul class=""><li id="f6a2" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><a class="ae jm" rel="noopener" href="/geekculture/full-app-for-tracking-currencies-with-vuejs3-composition-api-store-without-vuex-nodejs-90ce5e868ec2"> 1 -简介</a></li><li id="329a" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated"><strong class="ih hj"> 2 -后端* </strong></li><li id="404f" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated"><a class="ae jm" rel="noopener" href="/geekculture/full-app-for-tracking-currencies-with-vuejs3-nodejs-typescript-frontend-150d8dbfabd1"> 3-前端</a></li></ul><p id="fa33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了构建它，我们将使用NodeJs和Typescript、Express Js、Axios js以及其他一些包。</p><p id="785b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基本上，我们的API将获取货币层API，然后将其格式化，以便更容易在我们的Vuejs应用程序中显示。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es js"><img src="../Images/fed7a0463baf85b14103cd7dbacd1c9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nb1aRy8uLBbWtF9eWy5lzg.png"/></div></div></figure><h1 id="3f71" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">我们开始吧！</h1><p id="89dd" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">首先，我建议你使用VS代码作为你的IDE来构建这个项目，尽管如此，你也可以使用你最喜欢的IDE。</p><blockquote class="lh li lj"><p id="0b82" class="if ig lk ih b ii ij ik il im in io ip ll ir is it lm iv iw ix ln iz ja jb jc hb bi translated">你可以点击<a class="ae jm" href="https://code.visualstudio.com/download" rel="noopener ugc nofollow" target="_blank">这里</a>下载vs代码</p></blockquote><h1 id="b9ea" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">创建项目</h1><blockquote class="lh li lj"><p id="5755" class="if ig lk ih b ii ij ik il im in io ip ll ir is it lm iv iw ix ln iz ja jb jc hb bi translated">你必须在你的计算机上正确地安装一个节点，不是吗？因此，点击<a class="ae jm" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">此处</a>下载并安装它。</p></blockquote><p id="6da0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1 -在你的电脑上创建一个名为“currency_layer”的文件夹，这是我们项目的根路径。</p><p id="f26a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在在我们的根路径中创建另一个名为“后端”的文件夹，在“后端”文件夹中创建如下结构的文件夹。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lo"><img src="../Images/5ce745d3761b0cb742c060a10e7a0fda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Um7hNq0FsS9Xp3yUoQslQ.png"/></div></div></figure><pre class="jt ju jv jw fd lp lq lr ls aw lt bi"><span id="d338" class="lu kf hi lq b fi lv lw l lx ly">currency_layer/backend/src<br/>                       -&gt; Controller<br/>                       -&gt; Plugins<br/>                       -&gt; Routes</span></pre><p id="072b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在后端文件夹中打开一个终端，运行下面的命令创建我们的package.json。</p><p id="9e17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lz ma mb lq b">npm init -y</code></p><blockquote class="lh li lj"><p id="204c" class="if ig lk ih b ii ij ik il im in io ip ll ir is it lm iv iw ix ln iz ja jb jc hb bi translated">-y或-yes用于跳转所有问题并使用默认值。我们将很快更新这个文件。</p><p id="c589" class="if ig lk ih b ii ij ik il im in io ip ll ir is it lm iv iw ix ln iz ja jb jc hb bi translated">可以按<strong class="ih hj"> ctrl + shift + ' </strong>打开VS代码上的一个终端</p></blockquote><h2 id="e0e9" class="lu kf hi bd kg mc md me kk mf mg mh ko iq mi mj ks iu mk ml kw iy mm mn la mo bi translated">安装依赖项</h2><p id="122e" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">让我们添加编码所需的所有依赖项。</p><p id="dd4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在同一个终端上运行以下命令:</p><p id="d98a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要安装所有生产依赖项</p><p id="0de6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lz ma mb lq b">npm i express cors axios dotenv concurrently</code></p><pre class="jt ju jv jw fd lp lq lr ls aw lt bi"><span id="fa5d" class="lu kf hi lq b fi lv lw l lx ly">npm i = npm install</span><span id="bf7f" class="lu kf hi lq b fi mp lw l lx ly">express is one the most popular web frameworks for NodeJs.</span><span id="28f2" class="lu kf hi lq b fi mp lw l lx ly">cors is a Nodejs package to use as a Express middleware that help us to configure which origins are allowed to load the backend resources. Have you seen the error “Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at 'some host'. This can be fixed by moving the resource to the same domain or enabling CORS."? the cors package is used get rid of it. More info here: <a class="ae jm" href="https://github.com/expressjs/cors#readme" rel="noopener ugc nofollow" target="_blank">cors docs</a>, <a class="ae jm" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank">Cross-Origin Resource Sharing-MDN</a></span><span id="6ee8" class="lu kf hi lq b fi mp lw l lx ly">axios is a promise based HTTP client for the browser and node.js. More info <a class="ae jm" href="https://github.com/axios/axios/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">here</a>.</span><span id="6fef" class="lu kf hi lq b fi mp lw l lx ly">dotenv is a awesome package to deal with importing environment files. More info <a class="ae jm" href="https://github.com/motdotla/dotenv#readme" rel="noopener ugc nofollow" target="_blank">here</a>.</span><span id="c7e0" class="lu kf hi lq b fi mp lw l lx ly">concurrently package give us the power of run multiple commands concurrently, in our case we are going to start up our backend and frontend using this tool. More info <a class="ae jm" href="https://github.com/kimmobrunfeldt/concurrently#readme" rel="noopener ugc nofollow" target="_blank">here</a>.</span></pre><p id="c753" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装开发依赖项</p><p id="64c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lz ma mb lq b">npm i -save-dev @types/cors @types/express ts-node-dev typescript</code></p><pre class="jt ju jv jw fd lp lq lr ls aw lt bi"><span id="c315" class="lu kf hi lq b fi lv lw l lx ly">npm i -save-dev or -D is used to define the dependency as development dependency. It means, in production environment these dependencies won't used.</span><span id="2d34" class="lu kf hi lq b fi mp lw l lx ly">To use the types of our packages in typescript we need to import their respective types, because this we need to import: <!-- --> @types/cors @types/express.</span><span id="434c" class="lu kf hi lq b fi mp lw l lx ly">ts-node-dev is a package to help us during the develpoment process using typescript, adding it any change in our code will restart our app <!-- -->automatically.</span></pre><p id="6176" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Typescript需要一些配置才能正常工作，进入后端文件夹，从src文件夹创建tsconfig.json文件并放置这些配置。</p><pre class="jt ju jv jw fd lp lq lr ls aw lt bi"><span id="9c93" class="lu kf hi lq b fi lv lw l lx ly">*tsconfig.json</span><span id="45b4" class="lu kf hi lq b fi mp lw l lx ly">{<br/>  "compilerOptions": {<br/>    "target": "es6", <br/>    "module": "commonjs",<br/>    "declaration": true,<br/>    "outDir": "dist", <br/>    "strict": true, <br/>    "allowSyntheticDefaultImports": true, <br/>    "esModuleInterop": true, <br/>    "skipLibCheck": true, <br/>    "forceConsistentCasingInFileNames": true, <br/>  },<br/>  "include": ["./src/**/*"],<br/>  "exclude": ["./dist"]<br/>}</span></pre><blockquote class="lh li lj"><p id="a21c" class="if ig lk ih b ii ij ik il im in io ip ll ir is it lm iv iw ix ln iz ja jb jc hb bi translated">要了解tsconfig.json中这些参数的更多信息，您可以阅读:<a class="ae jm" href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html" rel="noopener ugc nofollow" target="_blank">https://www . typescriptlang . org/docs/handbook/ts config-JSON . html</a></p></blockquote><p id="7129" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不错，一切都做好了，开始编码。</p><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="mq mr l"/></div></figure><h1 id="3ce3" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">编码</h1><p id="19cc" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">你还记得我在上一个教程中写的货币层访问键吗？是时候用了。</p><blockquote class="lh li lj"><p id="8af4" class="if ig lk ih b ii ij ik il im in io ip ll ir is it lm iv iw ix ln iz ja jb jc hb bi translated">如果你没有阅读本教程的前一部分，你可以在这里阅读</p></blockquote><p id="4ccc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用一个. env文件来存储我们的敏感数据，如access_key、服务端口和货币层端点。</p><p id="f2e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建新的。env文件放入根文件夹，并将数据如下所示:</p><pre class="jt ju jv jw fd lp lq lr ls aw lt bi"><span id="216d" class="lu kf hi lq b fi lv lw l lx ly">PORT=4000<br/>BASE_API=http://apilayer.net/api/<br/>ACCESS_KEY=YOUR_ACESS_KEY</span></pre><h2 id="d22d" class="lu kf hi bd kg mc md me kk mf mg mh ko iq mi mj ks iu mk ml kw iy mm mn la mo bi translated">使用Axios的好方法</h2><p id="4c34" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">让我们开始创建我们的Axios插件，这种方式使我们的请求将更加容易和聪明。</p><p id="e694" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在Plugins文件夹中，创建ApiCurrencyLayer.ts文件，如下所示。</p><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="mq mr l"/></div><figcaption class="ms mt et er es mu mv bd b be z dx">0</figcaption></figure><p id="c6c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这样，我们只需要导入这个文件并调用currencyApi.get("relative_path ")，尽管如此，使用axios拦截器，我们可以在所有请求中注入access_key。</p><h2 id="7bfa" class="lu kf hi bd kg mc md me kk mf mg mh ko iq mi mj ks iu mk ml kw iy mm mn la mo bi translated">控制器</h2><p id="91df" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">现在，让我们创建控制器，从货币层api请求数据；</p><p id="0388" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Controllers文件夹中创建一个名为Currency.ts的新文件，我们的Currency类将有两个方法，get Currency和getCountryList。</p><p id="0a41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您检查从货币层api返回的数据，您会看到如下内容:</p><pre class="jt ju jv jw fd lp lq lr ls aw lt bi"><span id="1ac7" class="lu kf hi lq b fi lv lw l lx ly">{<br/>  "success":true,<br/>  "terms":"https:\/\/currencylayer.com\/terms",<br/>  "privacy":"https:\/\/currencylayer.com\/privacy",<br/>  "timestamp":1618711984,<br/>  "source":"USD",<br/>  "quotes":{<br/>    "USDEUR":0.834589,<br/>    "USDGBP":0.722883,<br/>    "USDCAD":1.25065,<br/>    "USDPLN":3.790775<br/>  }<br/>}</span></pre><p id="59b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“quotes”属性包含对我们很重要的数据，但是我不喜欢它返回的键和值模式。因此，在我们的代码中，我们将把它转换成这种模式:</p><pre class="jt ju jv jw fd lp lq lr ls aw lt bi"><span id="0129" class="lu kf hi lq b fi lv lw l lx ly">[<br/>{"code":"USDAED","value":3.673204},         {"code":"USDAFN","value":77.524944},{"code":"USDALL","value":102.75456},{"code":"USDAMD","value":521.492745}<br/>...<br/>]</span></pre><p id="41e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Currency.ts中，将此代码放在下面:</p><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="mq mr l"/></div></figure><h2 id="4f73" class="lu kf hi bd kg mc md me kk mf mg mh ko iq mi mj ks iu mk ml kw iy mm mn la mo bi translated">路线</h2><p id="09e9" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">是时候创建指向控制器的路线了。</p><p id="010d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Routes文件夹中创建一个新文件Routes.ts，并将以下代码放入:</p><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="mq mr l"/></div></figure><h2 id="6cea" class="lu kf hi bd kg mc md me kk mf mg mh ko iq mi mj ks iu mk ml kw iy mm mn la mo bi translated">最后是我们的应用和服务器</h2><p id="df4e" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">进入根文件夹src，创建一个名为App.ts的新文件，这将是我们的主App文件。</p><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="mq mr l"/></div></figure><p id="e05c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，使用下面的代码在src文件夹中创建另一个名为Server.js的新文件:</p><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="mq mr l"/></div></figure><h2 id="b1c6" class="lu kf hi bd kg mc md me kk mf mg mh ko iq mi mj ks iu mk ml kw iy mm mn la mo bi translated">Npm脚本</h2><p id="d06a" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">要运行我们的项目，让我们配置package.json来运行我们的项目。</p><p id="21f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将在开发过程中使用ts-node-dev来帮助我们，这样我们就不需要编译我们的typescript代码来更新我们的应用程序，并且一些代码甚至一些依赖关系的所有更改都会自动重新加载我们的应用程序。很不错，你不觉得吗？</p><p id="d1f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将这些脚本添加到package.json中</p><pre class="jt ju jv jw fd lp lq lr ls aw lt bi"><span id="fd47" class="lu kf hi lq b fi lv lw l lx ly">"scripts": {<br/>    "build": "tsc",<br/>    "dev": "ts-node-dev --respawn --transpile-only --ignore-watch node_modules --no-notify src/server.ts"<br/>  },</span></pre><h2 id="2a4a" class="lu kf hi bd kg mc md me kk mf mg mh ko iq mi mj ks iu mk ml kw iy mm mn la mo bi translated">运转</h2><p id="b668" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">进入项目运行的终端:</p><p id="f222" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lz ma mb lq b">npm run dev</code></p><p id="1d75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该会看到“Express server侦听端口4000”:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lo"><img src="../Images/457e12bad7fa60e9379af5851ba7e6e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JGcr_485BugjxXRjcAwcjw.png"/></div></div></figure><p id="0dc8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以在http://localhost:4000/API/currences上请求它来获取货币，或者使用<a class="ae jm" href="http://localhost:4000/api/countries" rel="noopener ugc nofollow" target="_blank">http://localhost:4000/API/countries</a>来列出所有国家。</p><p id="e8c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们在下一个教程中构建我们的前端应用程序。</p><p id="a147" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jm" href="https://vinibr.medium.com/full-app-for-tracking-currencies-with-vuejs3-composition-api-store-without-vuex-nodejs-90ce5e868ec2" rel="noopener">上一篇介绍</a> — <a class="ae jm" href="https://vinibr.medium.com/full-app-for-tracking-currencies-with-vuejs3-nodejs-typescript-frontend-150d8dbfabd1" rel="noopener">下一篇前端</a></p></div></div>    
</body>
</html>