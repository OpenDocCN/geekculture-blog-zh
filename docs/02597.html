<html>
<head>
<title>Create Realtime Console Chat App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建实时控制台聊天应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/create-realtime-console-chat-app-b5b481bcbd2?source=collection_archive---------9-----------------------#2021-05-21">https://medium.com/geekculture/create-realtime-console-chat-app-b5b481bcbd2?source=collection_archive---------9-----------------------#2021-05-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5e5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本帖中，我们将创建并看看在控制台中创建自己的实时聊天应用程序有多简单。这个聊天应用程序由两部分组成，一部分是服务器，另一部分是客户端。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/5d9982845fedff404e0211610814590a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*J2b2C4wsix9hl-13.png"/></div></div></figure><h2 id="cfa1" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">本教程我们需要的是</h2><ul class=""><li id="ebe0" class="kk kl hi ih b ii km im kn iq ko iu kp iy kq jc kr ks kt ku bi translated">NPM和节点已安装</li><li id="bffb" class="kk kl hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated"><code class="du la lb lc ld b">socket.io</code>和<code class="du la lb lc ld b">socket.io-client</code>模块</li></ul><h2 id="1061" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">设置我们的项目</h2><p id="dc3d" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">我将在同一个项目上创建我的服务器和客户端，如果你想将你的服务器代码部署到你的主机提供商，你需要创建一个单独的项目。首先，我创建了一个名为<code class="du la lb lc ld b">chat-cli</code>的目录，并用<code class="du la lb lc ld b">npm init -y</code>初始化了npm项目。</p><p id="e9cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我安装了需要的模块，如<code class="du la lb lc ld b">socket.io</code>和带<code class="du la lb lc ld b">npm install socket.io socket.io-client</code>的<code class="du la lb lc ld b">socket.io-client</code>。我在我们的项目中创建了两个文件<code class="du la lb lc ld b">index.js</code>(包含客户端代码)和<code class="du la lb lc ld b">server.js</code>(包含服务器代码)。现在让我们深入了解更多细节。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lh"><img src="../Images/6124e9ccfdac648ced5974e88f4c26ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4m42yTzs0dpWuecP.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es li"><img src="../Images/515d2e5da732f38801e97189ee1552d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/0*8LTf-DLaKb5Ftgv3.png"/></div></figure><h2 id="a147" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">创建Socket.io服务器</h2><p id="107c" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">我们需要一个socket.io服务器来处理所有事件，并将它们发送给我们的客户端。所以，让我们来创造它。</p><p id="125d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开你的<code class="du la lb lc ld b">server.js</code>文件，让我们写一些代码。</p><pre class="je jf jg jh fd lj ld lk ll aw lm bi"><span id="0beb" class="jp jq hi ld b fi ln lo l lp lq">// Created a socket.io server<br/>const io = require("socket.io")();<br/>// This should be a free port on our server.<br/>const PORT = process.env.PORT || 3000;</span><span id="f25c" class="jp jq hi ld b fi lr lo l lp lq">// Created a empty user object, This will store names of our users.<br/>const users = {};</span><span id="f37c" class="jp jq hi ld b fi lr lo l lp lq">// Listening for a connection event (This event fires when a client is connected to your server)<br/>io.on("connection", (socket) =&gt; {<br/>	console.log("New Connection: " + socket.id);<br/>	// If user emitted a `new user` event, This callback will be called with his name.<br/>    socket.on('new user', (name) =&gt; {<br/>        // Storing his name<br/>        users[socket.id] = name;<br/>        // Emitting an event to all users except that user.<br/>        socket.broadcast.emit("message", `${name} joined the chat.`)<br/>    });<br/>    // Listening for a `message` event.<br/>    socket.on('message', (text) =&gt; {<br/>        // Emitting an event to all users except that user.<br/>        socket.broadcast.emit("message", `${users[socket.id]}&gt; ${text}`);<br/>    });<br/>});</span><span id="e80d" class="jp jq hi ld b fi lr lo l lp lq">// Starting up server on PORT<br/>io.listen(PORT);</span></pre><p id="34c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们的服务器代码完成了。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/afaed12f21d03b058ea009443e0f7993.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*04izU5mt50j3jIN7.png"/></div></div></figure><h2 id="323d" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">正在为服务器创建客户端</h2><p id="f155" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">我们需要创建一个客户端，并让它连接到我们的服务器。</p><p id="408e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开<code class="du la lb lc ld b">index.js</code>文件，让我们写一些代码。</p><pre class="je jf jg jh fd lj ld lk ll aw lm bi"><span id="1f93" class="jp jq hi ld b fi ln lo l lp lq">// IMPORTING `socket.io-client` module<br/>const io = require('socket.io-client');<br/>// Creating client at the server, you need to pass url of your server where you hosted it.<br/>const socket = io("http://localhost:3000");<br/>// IMPORTING readline module to read from console.<br/>const readline = require('readline');</span><span id="a7de" class="jp jq hi ld b fi lr lo l lp lq">// Creating an interface to get input from our console.<br/>const rl = readline.createInterface({<br/>  input: process.stdin,<br/>});</span><span id="2713" class="jp jq hi ld b fi lr lo l lp lq">// Getting users name.<br/>console.log("What is your name?");<br/>rl.question("What is your name?", (text) =&gt; {<br/>    // Sending users name to server<br/>    socket.emit('new user', text.trim());<br/>    console.log("You joined the chat");<br/>    process.stdout.write("&gt; ");<br/>});</span><span id="d192" class="jp jq hi ld b fi lr lo l lp lq">// Listening for event `message` from our server (This will fire when server sends `message` event)<br/>socket.on("message", (text) =&gt; {<br/>    // Erasing Last line<br/>    process.stdout.write("\r\x1b[K")<br/>    console.log(text);<br/>    process.stdout.write("&gt; ");<br/>});<br/>// Prompting user to enter message.<br/>rl.prompt();</span><span id="a503" class="jp jq hi ld b fi lr lo l lp lq">// Fires when we input text from user.<br/>rl.on('line', (text) =&gt; {<br/>    // Sending message to our server.<br/>    socket.emit('message', text.trim());<br/>    process.stdout.write("&gt; ");<br/>    rl.prompt();<br/>});</span></pre><p id="d924" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的客户端代码现在已经完成。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/ac6178e59aaabfe57a167b6f1fe9f569.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kH1M6fC6a0s15B8_.png"/></div></div></figure><h2 id="0a47" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">怎么跑</h2><p id="67b6" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">首先，打开项目目录中的三个终端或cmd，通过键入<code class="du la lb lc ld b">node server.js</code>启动服务器。</p><p id="edb9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，通过在两个终端或cmd上键入<code class="du la lb lc ld b">node index.js</code>来运行您想要与之聊天的两个客户端。</p><p id="5206" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你做对了一切，你就可以聊天了。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lu"><img src="../Images/753b3023db0d88c9c145ee8af3f084c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/0*yenGiLOfZWc4fB3o.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/2e183b4d727b5e54a348186eff9920ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/0*Ml6E746RmG6qOVLq.png"/></div></figure><p id="e17f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lw" href="https://github.com/Programmer101N/chat-cli-nodejs" rel="noopener ugc nofollow" target="_blank">链接到这个项目，</a>可以克隆和派生这个项目。</p><h2 id="597d" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated"><a class="ae lw" href="https://programmer101n.com" rel="noopener ugc nofollow" target="_blank">访问我的网站</a>，我也在那里张贴这些东西。</h2><h2 id="902b" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">在我的社交网站上关注我。</h2></div></div>    
</body>
</html>