<html>
<head>
<title>NestJS + React (Next.js) in One MVC Repo for Rapid Prototyping</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个MVC Repo中的NestJS + React (Next.js ),用于快速原型开发</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/nestjs-react-next-js-in-one-mvc-repo-for-rapid-prototyping-faed42a194ca?source=collection_archive---------2-----------------------#2021-05-03">https://medium.com/geekculture/nestjs-react-next-js-in-one-mvc-repo-for-rapid-prototyping-faed42a194ca?source=collection_archive---------2-----------------------#2021-05-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3e52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">NestJS正在解决后端架构的问题。再加上在前端普遍选择React，你会发现全栈JS现在处于一个非常好的位置。我们能否将这些结合到一个易于使用的MVC架构中，以实现快速原型开发？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/cd1b73dc407bc38ed54b63b9804420e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*GGy6YD5EJoWIzT22YWNp1Q.png"/></div></figure><p id="0254" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">TLDR；是啊！在<a class="ae jl" href="https://github.com/thisismydesign/nestjs-starter" rel="noopener ugc nofollow" target="_blank">nestjs-starter repo</a>中，我在Typescript中将NestJS和Next.js结合在一起，用GraphQL连接(当然是端到端类型！)，在单个MVC repo(不是多个项目的monorepo)中，增加了一些功能，比如通过Passport和Cognito进行身份验证。</p><p id="11cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文涵盖了NestJS + Next.js集成。</p></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><p id="3ac8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为什么是单一的MVC回购？轻量级基础设施！1次回购，1次部署，无需同步。服务于API的同一后端也可以服务于前端。当然，后端和前端代码和配置需要在回购中很好地分离，并且在未来需要时可以分离到自己的回购中。Typescript和ESLint对此提供了很大的支持。</p><p id="c4ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为什么是Next.js？这是领先的React框架。比使用create-react-app更容易配置。CSR、SSR和静态页面的选项。SSR尤其适合在同一台主机上使用Nest API。(也有整合Nest与<a class="ae jl" href="https://auth0.com/blog/modern-full-stack-development-with-nestjs-react-typescript-and-mongodb-part-2/#Building-the-Frontend-with-React-and-TypeScript" rel="noopener ugc nofollow" target="_blank"/>和<a class="ae jl" rel="noopener" href="/swlh/serve-a-create-react-app-application-on-with-nest-js-for-better-seo-and-social-sharing-7093a71d3fc3"> plain React </a>的资源。)</p><p id="e640" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前端优先还是后端优先？可以选择托管Nest via Next或者Next via Nest(我知道，这些名字...).如果您有一个Nest部署，那么您可以将它用作下一个<a class="ae jl" href="https://nextjs.org/docs/advanced-features/custom-server" rel="noopener ugc nofollow" target="_blank">定制服务器</a>。请注意，虽然“定制服务器将删除重要的性能优化，如无服务器功能和自动静态优化。”另一方面，如果您有下一个部署，您可以使用<a class="ae jl" href="https://vercel.com/docs/serverless-functions/introduction" rel="noopener ugc nofollow" target="_blank">无服务器函数</a>和<a class="ae jl" href="https://nextjs.org/docs/api-routes/dynamic-api-routes" rel="noopener ugc nofollow" target="_blank">动态API路由</a>来运行Nest。这可能会限制Nest应用程序的可伸缩性、托管选项和整体结构。所以在这个例子中，我决定托管一个Nest应用程序，并通过它提供Next。(<a class="ae jl" href="https://github.com/Skn0tt/nextjs-nestjs-integration-example" rel="noopener ugc nofollow" target="_blank">这里有一个反过来的尝试</a>。)</p><p id="86f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">说了这么多，只剩下实现了。</p></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><p id="babe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">快速搜索会让我们进入<a class="ae jl" href="https://github.com/kyle-mccarthy/nest-next" rel="noopener ugc nofollow" target="_blank"> nest-next </a>，但是如果你在这里结束，你可能会像我一样遇到问题(<a class="ae jl" href="https://github.com/kyle-mccarthy/nest-next/issues/75" rel="noopener ugc nofollow" target="_blank"> 1 </a>，<a class="ae jl" href="https://github.com/kyle-mccarthy/nest-next/issues/76" rel="noopener ugc nofollow" target="_blank"> 2 </a>)或者发现它没有很好地解决后端和前端的分离:强制<code class="du jt ju jv jw b">pages</code>文件夹位置<a class="ae jl" href="https://github.com/kyle-mccarthy/nest-next/tree/1356c625399e5a1b47f0259b5f11b00f31e45680#viewspages-folder" rel="noopener ugc nofollow" target="_blank">在结构</a>的顶部，或者他们的<a class="ae jl" href="https://github.com/kyle-mccarthy/nest-next/tree/1356c625399e5a1b47f0259b5f11b00f31e45680#tsconfigjson" rel="noopener ugc nofollow" target="_blank">自定义</a> <code class="du jt ju jv jw b"><a class="ae jl" href="https://github.com/kyle-mccarthy/nest-next/tree/1356c625399e5a1b47f0259b5f11b00f31e45680#tsconfigjson" rel="noopener ugc nofollow" target="_blank">tsconfig</a></code> <a class="ae jl" href="https://github.com/kyle-mccarthy/nest-next/tree/1356c625399e5a1b47f0259b5f11b00f31e45680#tsconfigjson" rel="noopener ugc nofollow" target="_blank">设置</a>。你会发现，你可以通过指定你喜欢的任何文件夹来解决分离问题，并且为下一个应用服务的代码足够简单，你不必将其隐藏在复杂而固执己见的库中。</p><p id="43f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其他尝试包括:</p><ul class=""><li id="bb02" class="jx jy hi ih b ii ij im in iq jz iu ka iy kb jc kc kd ke kf bi translated">1、<a class="ae jl" rel="noopener" href="/real-dev-engineering/next-nest-working-together-199bd45c1bcc">本条</a>以缺码为例</li><li id="b48a" class="jx jy hi ih b ii kg im kh iq ki iu kj iy kk jc kc kd ke kf bi translated">2、<a class="ae jl" href="https://javascript.plainenglish.io/render-next-js-with-nestjs-did-i-just-made-next-js-better-aa294d8d2c67" rel="noopener ugc nofollow" target="_blank">这个有希望的方案</a>，最终被<a class="ae jl" href="https://github.com/nestjs/graphql/issues/1485" rel="noopener ugc nofollow" target="_blank">改写</a> <code class="du jt ju jv jw b"><a class="ae jl" href="https://github.com/nestjs/graphql/issues/1485" rel="noopener ugc nofollow" target="_blank">/graphql</a></code> <a class="ae jl" href="https://github.com/nestjs/graphql/issues/1485" rel="noopener ugc nofollow" target="_blank">路线</a></li><li id="e6b8" class="jx jy hi ih b ii kg im kh iq ki iu kj iy kk jc kc kd ke kf bi translated">3、<a class="ae jl" href="https://www.youtube.com/watch?v=vHLY2-ZCOiI" rel="noopener ugc nofollow" target="_blank">本视频</a>与<a class="ae jl" href="https://github.com/kelvin-mai/nest-next-example" rel="noopener ugc nofollow" target="_blank">相关的回购</a>解释了一个旧版本的<code class="du jt ju jv jw b">nest-next</code></li><li id="cec7" class="jx jy hi ih b ii kg im kh iq ki iu kj iy kk jc kc kd ke kf bi translated">4，<a class="ae jl" href="https://dev.to/saltyshiomix/an-introduction-of-the-integration-library-with-nestjs-and-next-js-29f1" rel="noopener ugc nofollow" target="_blank">这个鲜为人知但很棒的解决方案</a>和<a class="ae jl" href="https://github.com/saltyshiomix/nestpress/blob/master/packages/next/README.md" rel="noopener ugc nofollow" target="_blank">相关库</a>，再次将一些相当简单的东西隐藏到一个固执己见的库中</li></ul><p id="93d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我下面的解决方案结合了2和4。我使用一个完全由我控制的15行服务，而不是一个库。</p></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><p id="9ed1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回购:<a class="ae jl" href="https://github.com/thisismydesign/nestjs-starter" rel="noopener ugc nofollow" target="_blank">https://github.com/thisismydesign/nestjs-starter</a></p><p id="4739" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">相关PR:<a class="ae jl" href="https://github.com/thisismydesign/nestjs-starter/pull/2/files" rel="noopener ugc nofollow" target="_blank">https://github . com/thisismydesign/nestjs-starter/pull/2/files</a></p><h1 id="e7dc" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">第一步，安装</h1><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lj lk l"/></div></figure><h1 id="7de8" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">第二步，查看模块</h1><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="f621" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您在视图服务中看到的，我们显式地创建了一个Next.js服务器。您可以提供自定义配置和目录。我选择了<code class="du jt ju jv jw b">src/client</code>和<code class="du jt ju jv jw b">src/server</code>文件夹。你的下一页将会在<code class="du jt ju jv jw b">src/client/pages.</code></p><p id="0682" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您还会注意到控制器中的两个特定路径，<code class="du jt ju jv jw b">@Get('home')</code>用于单个页面，<code class="du jt ju jv jw b">@Get('_next*')</code>用于资产。无论主模块中的导入顺序如何，当前定义的一个全包路由<a class="ae jl" href="https://github.com/nestjs/graphql/issues/1485" rel="noopener ugc nofollow" target="_blank">会覆盖</a> <code class="du jt ju jv jw b"><a class="ae jl" href="https://github.com/nestjs/graphql/issues/1485" rel="noopener ugc nofollow" target="_blank">/graphql</a></code> <a class="ae jl" href="https://github.com/nestjs/graphql/issues/1485" rel="noopener ugc nofollow" target="_blank">端点</a>。如果你使用它，你需要显式地定义页面。页面的处理程序将是相同的。</p><p id="5a99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您也可以使用安全措施，例如管理来自Nest的认证。</p><h1 id="814c" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">第3步，下一页🎉</h1><p id="469e" class="pw-post-body-paragraph if ig hi ih b ii ll ik il im lm io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">在<code class="du jt ju jv jw b">src/client/pages/home.tsx</code></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="73ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您还可以使用SSR和Next的<code class="du jt ju jv jw b">getServerSideProps</code>来查询您的API。</p><h1 id="36e2" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">步骤4，文件夹结构</h1><p id="8896" class="pw-post-body-paragraph if ig hi ih b ii ll ik il im lm io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">将服务器代码移动到<code class="du jt ju jv jw b">src/server</code>并添加进一步的配置以使文件夹结构工作:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lj lk l"/></div></figure><h1 id="e590" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">步骤5，集成测试(可选)</h1><p id="591d" class="pw-post-body-paragraph if ig hi ih b ii ll ik il im lm io ip iq ln is it iu lo iw ix iy lp ja jb jc hb bi translated">如果你在你的应用模块上运行<a class="ae jl" href="https://docs.nestjs.com/fundamentals/testing#end-to-end-testing" rel="noopener ugc nofollow" target="_blank">集成测试</a>，在那里导入<code class="du jt ju jv jw b">ViewModule</code>会使测试失败。我创建了一个顶层<code class="du jt ju jv jw b">ServerModule</code>结合<code class="du jt ju jv jw b">AppModule</code>视图<code class="du jt ju jv jw b">ViewModule</code>作为入口模块:<a class="ae jl" href="https://github.com/thisismydesign/nestjs-starter/pull/2/commits/aff04b4a537afb6d3bb4f3a4d6af6e7d867e8a84" rel="noopener ugc nofollow" target="_blank">https://github . com/thisismydesign/nestjs-starter/pull/2/commits/aff 04 b4a 537 AFB 6 D3 bb 4 F3 d 6 af 6 e 7d 867 E8 a 84</a></p></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><p id="967a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，您有了一个部署就绪的应用程序，可以快速构建后端和前端。你会发现更多关于页面、后端数据查询和回购中其他特性的例子:<a class="ae jl" href="https://github.com/thisismydesign/nestjs-starter" rel="noopener ugc nofollow" target="_blank">https://github.com/thisismydesign/nestjs-starter</a></p></div></div>    
</body>
</html>