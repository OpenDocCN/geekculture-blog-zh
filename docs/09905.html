<html>
<head>
<title>JWT Authentication process in API Gateway on Microservice Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微服务架构上API网关中的JWT认证过程</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-jwt-is-implemented-in-api-gateway-on-microservice-architecture-5dce8f5b89aa?source=collection_archive---------0-----------------------#2022-01-04">https://medium.com/geekculture/how-jwt-is-implemented-in-api-gateway-on-microservice-architecture-5dce8f5b89aa?source=collection_archive---------0-----------------------#2022-01-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="73b2" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">微服务| JWT</h2><div class=""/><figure class="ev ex ip iq ir is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es io"><img src="../Images/351ab66f42b8e9852e1226bb74c53df5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s8dJQ7iB3hFxnIv2gAVDZQ.jpeg"/></div></div><figcaption class="iz ja et er es jb jc bd b be z dx">Photo by <a class="ae jd" href="https://unsplash.com/@dylan_nolte?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">dylan nolte</a> on <a class="ae jd" href="https://unsplash.com/collections/2003981/microservices?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="842e" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">在微服务架构中，一个应用被分成多个微服务。例如，amazon应用程序可以分为订单、目录、用户信息、评级、评论、类别、购物车和其他不同的微服务。</p><p id="d69b" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">还有。大多数情况下，这些服务位于安全墙之后，用户使用安全逻辑进行身份验证。这是什么意思？</p><p id="ec90" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">假设我们需要将某个产品添加到购物车中，但是如果不经过登录(身份验证)过程，我们就无法做到这一点。每当我们希望调用微服务来处理客户端请求时，都需要在每个服务中实现这个安全逻辑。但是，每次调用微服务时，让每个微服务承担验证用户的开销是低效的。</p><p id="74d7" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">为了解决这个问题，使用基于令牌的认证将客户端请求认证到API网关。</p><p id="a28b" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">我们将逐步讨论基于令牌的身份验证过程。为了更好地理解，请使用下图。尽管步骤7没有在该图像中示出。</p><figure class="kd ke kf kg fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es kc"><img src="../Images/12c394c93ed309789e34c13bdab95c1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EmSulWumywk8w1dol4rpLA.jpeg"/></div></div><figcaption class="iz ja et er es jb jc bd b be z dx">JWT Implementation in Microservices, Graphics by <a class="ae jd" rel="noopener" href="/@spsarkar-appxive">SPSarkar</a></figcaption></figure><ol class=""><li id="4db5" class="kh ki hi jg b jh ji jl jm jp kj jt kk jx kl kb km kn ko kp bi translated">用户将其凭证提交给<strong class="jg hs">身份服务器/授权服务器</strong>以获得参考访问令牌。</li><li id="7afd" class="kh ki hi jg b jh kq jl kr jp ks jt kt jx ku kb km kn ko kp bi translated">身份服务器/授权服务器验证用户凭证。对于合法用户，服务器存储令牌的内容并生成一个<strong class="jg hs">参考访问令牌</strong>，服务器将该令牌发送给客户端。这个令牌是随机加密的。</li><li id="d5fa" class="kh ki hi jg b jh kq jl kr jp ks jt kt jx ku kb km kn ko kp bi translated">客户端接收访问令牌，并将<strong class="jg hs">请求+参考访问令牌</strong>发送给API网关。</li><li id="2658" class="kh ki hi jg b jh kq jl kr jp ks jt kt jx ku kb km kn ko kp bi translated"><strong class="jg hs"> API网关</strong>从客户端接收令牌，并再次将接收到的访问令牌发送给身份服务器/授权服务器。</li><li id="367c" class="kh ki hi jg b jh kq jl kr jp ks jt kt jx ku kb km kn ko kp bi translated"><strong class="jg hs">身份服务器/授权服务器</strong>验证访问令牌，并向API网关返回<strong class="jg hs"> JSON Web令牌(JWT) </strong>。现在这个<strong class="jg hs"> JWT包含用户和许可信息。</strong></li></ol><blockquote class="kv kw kx"><p id="2ac0" class="je jf ky jg b jh ji jj jk jl jm jn jo kz jq jr js la ju jv jw lb jy jz ka kb hb bi translated">JSON Web Token (JWT)是一个开放标准(<a class="ae jd" href="https://tools.ietf.org/html/rfc7519" rel="noopener ugc nofollow" target="_blank"> RFC 7519 </a>)，它定义了一种紧凑且独立的方式，以JSON对象的形式在各方之间安全地传输信息。—<a class="ae jd" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank">https://jwt.io/</a></p></blockquote><p id="5509" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">6.<strong class="jg hs"> API网关</strong>将客户端请求发送给相应的微服务，微服务可以与JWT 一起处理<strong class="jg hs">客户端请求。</strong></p><p id="fa0d" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">7.现在，微服务通过使用JWT的内容来检查身份验证和授权。JWT有三个部分，用一个点(.)即报头、有效载荷和签名。</p><pre class="kd ke kf kg fd lc ld le lf aw lg bi"><span id="8657" class="lh li hi ld b fi lj lk l ll lm">eyJhbGciOiJIUzI1NiJ9.eyJuYW1lIjoiSm9lIENvZGVyIn0.5dlp7GmziL2QS06sZgK4mtaqv0_xX4oFUuTDh1zHK4U #JWT (header.payload.signature)</span><span id="c662" class="lh li hi ld b fi ln lk l ll lm"># ------------------------</span><span id="6df9" class="lh li hi ld b fi ln lk l ll lm"><em class="ky"># header (hashing algorithm and type of token)</em><br/><em class="ky"># payload (authorization information and expiry of token)</em><br/><em class="ky"># signature (refers to the header &amp; payload, which is digitally signed with the server's key)</em></span></pre><p id="74b9" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">现在微服务提取<strong class="jg hs">头</strong>和<strong class="jg hs">有效载荷</strong>，<strong class="jg hs">计算这两个Base64-URL编码的JSON的hash </strong>。现在微服务用服务器的密钥解密密码<strong class="jg hs">签名</strong>部分，签名实际上是报头和有效载荷的散列。现在，微服务检查两个哈希值是否相等，如果两个哈希值相同，则服务将断定客户端是经过身份验证的客户端。</p><h2 id="a26a" class="lh li hi bd lo lp lq lr ls lt lu lv lw jp lx ly lz jt ma mb mc jx md me mf ho bi translated">微服务中基于令牌的认证有什么优势？</h2><p id="de3c" class="pw-post-body-paragraph je jf hi jg b jh mg jj jk jl mh jn jo jp mi jr js jt mj jv jw jx mk jz ka kb hb bi translated">主要优势是减少每次调用微服务时验证用户的开销。因为<strong class="jg hs"> JWT在其有效载荷中包含用户身份信息。微服务使用JWT来执行身份验证和授权，从而避免执行额外的操作，如数据库查询来检查用户身份验证。</strong></p><p id="3760" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">这个帖子对你有帮助吗？不要忘记为这个帖子鼓掌，给我们一些灵感！</p></div><div class="ab cl ml mm gp mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="hb hc hd he hf"><h1 id="d700" class="ms li hi bd lo mt mu mv ls mw mx my lw mz na nb lz nc nd ne mc nf ng nh mf ni bi translated">你对全栈开发感兴趣吗？</h1><p id="7255" class="pw-post-body-paragraph je jf hi jg b jh mg jj jk jl mh jn jo jp mi jr js jt mj jv jw jx mk jz ka kb hb bi translated"><em class="ky">我写的是关于fullstack Web开发REST API、微服务、LinkedIn中的架构、Medium的循序渐进的编码教程。</em> <a class="ae jd" href="https://www.linkedin.com/in/spsarkar-appxive/" rel="noopener ugc nofollow" target="_blank"> <em class="ky">这里是我的Linkedin简介</em> </a> <em class="ky">。</em></p></div></div>    
</body>
</html>