<html>
<head>
<title>A Complete Guide to Building and Deploying Your Own Website with React, Flask and Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React、Flask和Heroku构建和部署自己的网站的完整指南</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/a-complete-guide-to-building-and-deploying-your-own-website-with-react-flask-and-heroku-bc002dd94787?source=collection_archive---------7-----------------------#2021-10-25">https://medium.com/geekculture/a-complete-guide-to-building-and-deploying-your-own-website-with-react-flask-and-heroku-bc002dd94787?source=collection_archive---------7-----------------------#2021-10-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/add6a4b41c9bad4834d1376a685d7fd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZLRx8Sq7KRIqOkRE"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@cgower?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Christopher Gower</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c9f0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">把你的作品展示给别人看是一件神奇的事情。有一种深深的自豪感，伴随着你可以让任何事情发生的感觉——相信你可以打造下一个伟大的服务、产品、想法或公司并不是太疯狂。</p><p id="8e9e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是也很容易觉得自己没有知识或工具来实现这一点。如果有人把最基本的神圣知识公之于众，你就可以去比赛了！当我第一次学习如何构建web应用程序时，我就有这种感觉。在网上资源和教程的前几周，我找到了很多很棒的资源，但没有一个是整合的。我找不到任何能给我空间让我按照自己的方向使用教程产品的东西。我发现了很多错误，并且没完没了地查阅旧的StackOverflow线程。</p><p id="3f1e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">更不用说我想构建一个有点不寻常的东西——一个反应瓶应用程序。这个超级强大的web开发圣杯将有一个React JS前端(客户机)和Flask Python后端(服务器)。想象一下，最强大的JavaScript工具与最强大的Python工具(在我看来)一起为您服务。可能性是无限的！</p><p id="9e03" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本演练将整合我花了几十个小时搜索如何构建部署在Heroku上的React-Flask应用程序。在演练结束时，您应该有类似于<a class="ae iu" href="http://client.bomb.fyi" rel="noopener ugc nofollow" target="_blank"> this </a>的东西(不要介意域名，这只是我放在身边的一个备用的)。希望你能利用这篇教程轻松地启动你的下一个伟大的想法！</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="5607" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">入门指南</h1><p id="884a" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated"><a class="ae iu" href="https://flask.palletsprojects.com/en/2.0.x/" rel="noopener ugc nofollow" target="_blank"> Flask </a>是一个构建网络应用的微框架。Flask有着广泛的应用，但是今天我们将集中使用它来构建我们网站的服务器端。<a class="ae iu" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>是一款构建动态用户界面的工具。这将为我们网站的发展打开一个巨大的可能性领域。如果你已经熟悉HTML，它非常容易掌握，如果不熟悉，也有很好的特定用例文档。我们将使用React来增强我们网站的客户端。我们的React客户端将使用<a class="ae iu" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch" rel="noopener ugc nofollow" target="_blank"> Fetch API </a>向我们的Flask服务器发出请求。所以让我们开始建设吧！</p><p id="b4c2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所有的<a class="ae iu" href="https://github.com/Baloguna16/demo-client" rel="noopener ugc nofollow" target="_blank">前端</a>和<a class="ae iu" href="https://github.com/Baloguna16/demo-server" rel="noopener ugc nofollow" target="_blank">后端</a>的代码都将在Github上提供，并在本教程的末尾链接。我们将在本教程的剩余部分解释这些存储库是如何构建的。</p><h1 id="ff19" class="ka kb hi bd kc kd ld kf kg kh le kj kk kl lf kn ko kp lg kr ks kt lh kv kw kx bi translated">构建砂箱侧</h1><p id="1f4c" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">我们从烧瓶那一边开始。我创建了一个文件夹来存放后端代码。我进入这个文件夹，用终端命令<code class="du li lj lk ll b">virtualenv env</code>在文件夹里创建了一个虚拟环境。这将存储驱动后端的python包。你可以在<strong class="ix hj"> requirements.txt </strong>中找到需求列表。</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/7194a0fc6c7ff213d27d694bf0ca4d27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eRQzJ34GiHZTvYUgyFg_HQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Entering the folder and creating an env folder</figcaption></figure><p id="0305" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Flask配置了一组环境变量。这通常保存在一个名为<strong class="ix hj">的文件中。env </strong>。您还可以使用该文件将其他变量注入到您的应用程序中。这对于存储API密钥并保持它们的秘密非常有用。您不想上传您的<strong class="ix hj">。env </strong>，环境文件夹，或者其他一些缓存文件到Github。这些文件要么包含敏感信息，要么对试图运行你的应用的其他人来说是垃圾文件。我们可以用<strong class="ix hj">。gitignore </strong>阻止这些文件公开。</p><p id="57de" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我们将在工厂设计模式中构建应用程序的结构。你可以在这里阅读更多关于这个设计模式的信息<a class="ae iu" href="https://flask.palletsprojects.com/en/2.0.x/patterns/appfactories/" rel="noopener ugc nofollow" target="_blank">。我们将使用</a><a class="ae iu" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank"> CORS </a>来限制谁可以向我们的服务器发出请求。烧瓶-CORS是完成这项任务的绝佳资源。CORS对于构建安全的web应用非常重要。它防止恶意参与者调用您的API。这一点很重要，原因比我们在本演练中所能涵盖的还要多。</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="iq ir et er es is it bd b be z dx">These CORS settings are essential. CORS_ALLOW_ORIGIN must be set to the domain of your client side while CORS_SUPPORTS_CREDENTIALS must be true to accept cookies from the client. More on the importance of cookies to follow.</figcaption></figure><p id="eab2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将在<strong class="ix hj"> utils/config.py </strong>中为我们的应用和CORS配置设置。此外，对于我们的受保护路由，我们将请求一个特殊的会话令牌，当客户端请求<em class="lt"> /get/unprotected </em>时提供。受保护的路由将由名为<strong class="ix hj"> auth_required </strong>的装饰器包装。这个装饰器在传入的请求头中寻找会话令牌。它的灵感来自于Flask API文档提供的一个类似的装饰器，绝对值得一看！</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Auth_required is a decorator which looks for the ‘sessionToken’ in the request header sent by the client. This is how most apps handle user authentication after login and between requests.</figcaption></figure><p id="1b04" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">否则，我们可以在<strong class="ix hj"> routes/main.py </strong>中看到简单应用程序的代码。</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="iq ir et er es is it bd b be z dx">We will have three routes that are powered by our server: unprotected, protected, and post.</figcaption></figure><p id="c943" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们几乎完成了我们的Flask服务器！在根文件夹中，我们将创建一个名为<strong class="ix hj"> application.py </strong>的文件，该文件将从在<strong class="ix hj"> __init__中创建的工厂中生成我们的应用程序。py </strong>。我们还将创建一个<strong class="ix hj"> Procfile </strong>。Heroku需要这些来托管我们的服务器。现在说说客户端。</p><h1 id="9dd9" class="ka kb hi bd kc kd ld kf kg kh le kj kk kl lf kn ko kp lg kr ks kt lh kv kw kx bi translated">构建反应侧</h1><p id="51c3" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">react团队和脸书制作的<a class="ae iu" href="https://create-react-app.dev/" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj">create-React-app</strong></a>包使得构建前端变得简单。我们可以用它来快速启动客户端，然后在必要的地方进行裁剪和添加。我用<code class="du li lj lk ll b">npx create-react-app demo-client </code>做了这个，其中<strong class="ix hj">演示客户端</strong>是文件夹的名称。</p><p id="4efb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从包中删除一些不必要的文件后，我们将有一个准系统React应用程序。我们将使用一些简单的样式，包含在<strong class="ix hj"> index.css、</strong>中，并且我们将使用<code class="du li lj lk ll b">yarn add bootstrap</code>安装bootstrap以使构建更快。我们还需要<a class="ae iu" href="https://reactrouter.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj">react-router-DOM</strong></a>来处理我们的多个页面，还需要<a class="ae iu" href="https://github.com/js-cookie/js-cookie" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj"> js-cookie </strong> </a>来处理cookie设置。</p><p id="4c4e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的每个页面都将被表示为组件，在App.js中相遇。您会注意到一个组件用于未受保护的页面，一个用于受保护的页面，一个用于从客户端发布数据，还有一个登录页面。这些组件构建在<a class="ae iu" href="https://www.freecodecamp.org/news/functional-components-vs-class-components-in-react/" rel="noopener ugc nofollow" target="_blank">功能模式</a>中，有关每个组件中发生的事情的更多信息，请参考React JS文档。</p><p id="2135" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">目前，我们只是对观察数据如何在客户机和服务器之间发送感兴趣。这对于受保护的页面尤其重要，因为它需要在请求头中发送凭证。</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="iq ir et er es is it bd b be z dx">The session token is received from the server and set using js-cookie. When you build you app, you’ll need to use HTTPS and set a ‘secure: true’. <a class="ae iu" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite" rel="noopener ugc nofollow" target="_blank">This seems to be a feature of cookies</a> where ‘secure’ cannot be false while ‘samesite’ is ‘none’. Samesite must be ‘none’ for this application structure to work. You can add HTTPS to your Heroku apps by upgrading from the free tier to the hobby tier. I have not done this for the example in this article.</figcaption></figure><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="iq ir et er es is it bd b be z dx">The cookie previously set is pulled from the browser and sent with the request to the server. This only works because the server and client have the same domain: ‘.bomb.fyi’ and both have HTTPS, or SSL certificates.</figcaption></figure><p id="2ea6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们几乎完成了我们的反应方面！让我们创建一个<strong class="ix hj">。env </strong>文件，这样我们就可以在应用加载时注入服务器的地址。React要求应用程序中引用的环境变量以“REACT_APP_*”开头。要在应用程序中访问该变量，我们使用如上所示的“process.env.REACT_APP_*”。现在让我们部署！</p><h1 id="6cfc" class="ka kb hi bd kc kd ld kf kg kh le kj kk kl lf kn ko kp lg kr ks kt lh kv kw kx bi translated">转移到Heroku</h1><p id="9637" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">有大量的<a class="ae iu" href="https://devcenter.heroku.com/articles/git" rel="noopener ugc nofollow" target="_blank">现有资源</a>涵盖了如何在Heroku上部署。我假设你已经有了一个Heroku的账户，已经配置好了，并且知道如何推送到Heroku。</p><p id="e1a7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的项目需要知道的关键事情是，我们将部署<strong class="ix hj">两个</strong> Heroku应用程序:<strong class="ix hj">一个用于我们的React端</strong>和<strong class="ix hj">一个用于我们的Flask端</strong>。一旦您部署了这些存储库，我们将进入它们的每个设置，并在<em class="lt"> Config Vars </em>选项卡下更新它们的环境变量。你还需要<a class="ae iu" href="https://successengineer.medium.com/how-to-setup-heroku-with-godaddy-d8e936d10849" rel="noopener">给每个Heroku应用程序他们自己的自定义域</a>来让cookies工作。</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/c419fa9c01e9724c8710b3b17039bc9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kdPKOalGQl6uDGjLsU90WA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Environment variables for the React side, hosted at <a class="ae iu" href="http://www.bomb.fyi." rel="noopener ugc nofollow" target="_blank">http://client.bomb.fyi.</a> This is just for demo. Your app will use HTTPS which will allow credential cookies to be sent between the client and server.</figcaption></figure><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/4ef0d7889fb7f10b96f3bf8ccc3645cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QanFbDnEvUNRPhlzr2w6jA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Environment variables for the Flask side, hosted at <a class="ae iu" href="http://server.bomb.fyi." rel="noopener ugc nofollow" target="_blank">http://server.bomb.fyi.</a> Again, this is just for demo. Your app will use HTTPS while will allow credential cookies to be sent between the client and server.</figcaption></figure><p id="6e89" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们快完成了。对于我们的React应用程序，我们还需要使用一个名为'<a class="ae iu" href="https://buildpack-registry.s3.amazonaws.com/buildpacks/mars/create-react-app.tgz" rel="noopener ugc nofollow" target="_blank">https://build pack-registry . S3 . amazonaws . com/build packs/mars/create-React-app . tgz</a>'的特殊构建。你可以在Heroku中React应用的设置中的<em class="lt"> Buildpacks </em>标签下搜索这个。这个构建包使得在Heroku上部署<strong class="ix hj"> create-react-app </strong>的实例变得容易。</p><h1 id="1419" class="ka kb hi bd kc kd ld kf kg kh le kj kk kl lf kn ko kp lg kr ks kt lh kv kw kx bi translated">包扎</h1><p id="c21d" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">如果你做的一切都正确，你应该会得到一个像<a class="ae iu" href="http://client.bomb.fyi" rel="noopener ugc nofollow" target="_blank">这个</a>一样的网络应用！因为我的客户机和服务器没有SSL证书，所以不会设置凭证cookies，受保护的页面会拒绝您。我这样做是为了节省这个演示应用程序的成本:)，但你的项目应该为HTTPS设置SSL！</p><p id="9403" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您的客户端似乎没有与您的服务器通信，您很可能有一个cookie问题。如果你使用的是Chrome，你可以通过查看“应用程序”下的开发者工具来查看浏览器中是否设置了cookie。这种React-Flask应用程序结构要求客户机和服务器驻留在同一个定制域中，使用不同的子域和SSL证书。在React应用程序中，cookie应该设置为<em class="lt"> samesite=none </em>和<em class="lt"> secure=true </em>。如果你打开你的开发者工具，你没有看到“sessionToken”作为你的cookie之一，那么你可以确定你的浏览器拒绝了React试图设置的cookie。Cookie权限很难，但它们是为了防止恶意行为者攻击你的应用。</p><p id="ea0c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">希望你发现这篇教程很有帮助，祝你下一个伟大的项目好运！</p></div></div>    
</body>
</html>