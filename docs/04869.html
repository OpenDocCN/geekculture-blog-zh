<html>
<head>
<title>Phoenix LiveView - Building Web Apps Without JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Phoenix LiveView -不用JavaScript构建Web应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/phoenix-liveview-building-web-apps-without-javascript-ce7bd01f2ed5?source=collection_archive---------20-----------------------#2021-07-05">https://medium.com/geekculture/phoenix-liveview-building-web-apps-without-javascript-ce7bd01f2ed5?source=collection_archive---------20-----------------------#2021-07-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1ea9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">毕竟构建web应用不需要JS。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/0c3c050e6a512b55abfe2be7127a9d1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y1ug0iT1VGiGRrG0lJDRxA.png"/></div></div></figure><p id="2dde" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个故事中，您将了解什么是凤凰城实时景观，以及它是如何工作的。然后，我们将使用LiveView构建一个小型柜台应用程序。</p><p id="ecc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我假设您已经安装了Phoenix、Elixir/Erlang和Node.js。如果没有，那么一定要安装它们。</p><p id="7ed1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开始吧！</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="0db8" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">什么是凤凰LiveView？</h1><p id="1451" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">LiveView是Phoenix web框架中最激动人心的特性之一。</p><p id="2589" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一种不需要编写JavaScript就能产生流畅、实时、快速和可扩展的web界面的新方法。</p><h2 id="80c8" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">没有JavaScript</h2><p id="1dc5" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">是的，你没听错。没有JavaScript。使用LiveView构建web应用程序不需要任何JavaScript。尽管如此，你仍然需要它来制作动画。</p><blockquote class="ln lo lp"><p id="3d9c" class="if ig lq ih b ii ij ik il im in io ip lr ir is it ls iv iw ix lt iz ja jb jc hb bi translated">LiveView编程模型是声明性的:不是说“一旦事件X发生，就在页面上改变Y”，LiveView中的事件是可能导致其状态改变的常规消息。一旦状态改变，LiveView将重新呈现其HTML模板的相关部分，并将其推送到浏览器，浏览器以最高效的方式进行自我更新。</p><p id="61e9" class="if ig lq ih b ii ij ik il im in io ip lr ir is it ls iv iw ix lt iz ja jb jc hb bi translated"><em class="hi"> -凤凰文档</em></p></blockquote><p id="1480" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">凤凰是这样解释LiveView的。</p><p id="1e8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基本上，我们不需要使用像<code class="du lu lv lw lx b">onClick()</code>这样的东西来做一些事情，我们可以让消息在它们的值/状态改变时做一些事情。</p><p id="7c2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有Phoenix说“<em class="lq"> LiveView会重新渲染其HTML模板</em>的 <strong class="ih hj"> <em class="lq">相关部分</em> </strong> <em class="lq">”。这意味着，LiveView不会更新整个页面，而只会更新页面的相关部分(如关注人数)。</em></p><p id="5507" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这使得LiveView非常高效快速。</p><h2 id="b941" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">它是如何工作的</h2><p id="5f26" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">LiveView首先作为常规HTTP请求的一部分静态呈现，除了帮助搜索和索引引擎之外，它还为“第一次有意义的绘制”提供了快速时间。</p><p id="84e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，使用WebSockets在客户机和服务器之间建立持久连接。</p><p id="94ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，使应用程序更快，因为与无状态请求相比，要做的工作更少，要发送的数据更少，而无状态请求必须对每个请求进行身份验证、解码、加载和编码。</p><p id="9495" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一方面，与无状态请求相比，LiveView使用更多的服务器内存。</p><h2 id="a2b2" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">迷茫？</h2><p id="80eb" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">如果你很困惑，不要着急。下面的视频解释了LiveView的工作原理。即使你什么都懂，我还是建议你看视频。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ly lz l"/></div></figure><h2 id="c2ef" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">我的想法</h2><p id="d189" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">我个人很喜欢LiveView。编码既简单又有趣。我不认为在JS生态系统中有任何替代品可以提供相同的性能和开发速度。</p><p id="58f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不管怎样，理论到此为止。我们写点代码吧！</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="c30d" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">一个简单的计数器应用</h1><p id="3bc3" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">让我们构建一个简单的计数器应用程序。我们将从搭建我们的项目开始。</p><h2 id="9850" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">创建新的Phoenix LiveView项目</h2><p id="421c" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">要创建新的LiveView应用程序，只需运行以下命令。</p><pre class="je jf jg jh fd ma lx mb mc aw md bi"><span id="a610" class="kz jx hi lx b fi me mf l mg mh">mix phx.new counter --live --no-ecto</span></pre><p id="f8ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个命令基本上是创建一个新的Phoenix项目，添加LiveView并删除Ecto。</p><p id="d2df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们为什么要移除埃克托？嗯，对于一个简单的计数器应用程序，我们真的不需要DB交互。因此，我们只需添加<code class="du lu lv lw lx b">--no-ecto</code>标志，不必配置任何东西，并减少我们的应用程序的大小。</p><p id="c7d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，添加<code class="du lu lv lw lx b">--live</code>标志为我们增加了一些配置，但我不会在这里解释它。如果你想了解更多关于LiveView配置的信息，你可以查看文档。</p><div class="mi mj ez fb mk ml"><a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveView.html" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hj fi z dy mq ea eb mr ed ef hh bi translated">凤凰城。live view-Phoenix live view v 0 . 15 . 7</h2><div class="ms l"><h3 class="bd b fi z dy mq ea eb mr ed ef dx translated">LiveView通过服务器渲染的HTML提供丰富的实时用户体验。LiveView编程模型是…</h3></div><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">hexdocs.pm</p></div></div></div></a></div><h2 id="2c2e" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">LiveView</h2><p id="31d2" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">你会看到在<code class="du lu lv lw lx b">lib/liveview_web</code>目录下有一个<code class="du lu lv lw lx b">live</code>文件夹。里面有两个文件。一个模板和一个<code class="du lu lv lw lx b">page_live.ex</code>文件。您可以删除模板文件，因为我们通常在<code class="du lu lv lw lx b">*_live.ex</code>文件中呈现模板。当然，您可以随时从模板文件进行渲染。</p><h2 id="4201" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">路由器</h2><p id="7fa4" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">如果你看看路由器文件，你会看到有一个为我们添加的实时路由。</p><pre class="je jf jg jh fd ma lx mb mc aw md bi"><span id="4be8" class="kz jx hi lx b fi me mf l mg mh">live "/", PageLive, :index</span></pre><p id="e8a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这基本上指定了该路线服务于实况视图。</p><h1 id="49f4" class="jw jx hi bd jy jz mu kb kc kd mv kf kg kh mw kj kk kl mx kn ko kp my kr ks kt bi translated">构建我们的应用</h1><p id="5630" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">我们回顾了通过运行<code class="du lu lv lw lx b">mix phx.new counter --live --no-ecto</code>命令创建的文件。现在让我们开始编写我们的应用程序。</p><p id="69f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到<code class="du lu lv lw lx b">lib/liveview_web/live/page_live.ex</code>文件，将其更改为下面的代码。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mz lz l"/></div></figure><p id="6daf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们一行一行地检查代码。</p><h2 id="2637" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">mount/3</h2><p id="6bc1" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated"><code class="du lu lv lw lx b">mount/3</code>回调连接渲染视图所需的socket assign。我们正在创建值为0的<code class="du lu lv lw lx b">:count</code>。并返回套接字。</p><h2 id="6d19" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">render/1</h2><p id="03d6" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated"><code class="du lu lv lw lx b">render/1</code>回调接收<code class="du lu lv lw lx b">socket.assigns</code>并负责返回呈现的内容。</p><p id="bd4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看到我们在那里的表现了吗？这就是我们如何从LiveView中的套接字获取值。</p><p id="fc35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另外，你可以看到我们的按钮上有<code class="du lu lv lw lx b">phx-click</code>绑定。这就是我们点击发送事件的方式。第一个按钮发送一个<code class="du lu lv lw lx b">increase</code>事件，第二个发送一个<code class="du lu lv lw lx b">decrease</code>事件。</p><h2 id="5d39" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">handle_event/3</h2><p id="4782" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">我们在<code class="du lu lv lw lx b">handle_event/3</code>回调中接收事件。并更新我们的套接字分配。每当套接字的赋值发生变化时，就会自动调用<code class="du lu lv lw lx b">render/1</code>，并将更新发送到客户端。</p><p id="a255" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们得到的事件是<code class="du lu lv lw lx b">increase</code>，第一个<code class="du lu lv lw lx b">handle_event</code>将被执行，计数将增加。</p><p id="8ef7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，如果我们得到的事件是<code class="du lu lv lw lx b">decrease</code>，第二个<code class="du lu lv lw lx b">handle_event</code>将被执行，计数将减少。</p><h1 id="8d3e" class="jw jx hi bd jy jz mu kb kc kd mv kf kg kh mw kj kk kl mx kn ko kp my kr ks kt bi translated">运行我们的应用</h1><pre class="je jf jg jh fd ma lx mb mc aw md bi"><span id="4be2" class="kz jx hi lx b fi me mf l mg mh">mix phx.server</span></pre><p id="04ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个命令将启动服务器，如果一切正常，你将能够在<code class="du lu lv lw lx b">http://localhost:4000</code>看到你的应用程序。</p><p id="7723" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你现在访问<code class="du lu lv lw lx b"><a class="ae na" href="http://localhost:4000" rel="noopener ugc nofollow" target="_blank">http://localhost:4000</a></code>，你会看到你的计数器应用程序，增加或减少按钮点击计数。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es nb"><img src="../Images/81a35db41bddabaef3f0b5107ff0cddd.png" data-original-src="https://miro.medium.com/v2/resize:fit:352/format:webp/1*xZz9ancoGGj69Dv_dBoALw.png"/></div><figcaption class="nc nd et er es ne nf bd b be z dx">Our Simple Counter App</figcaption></figure><p id="2c0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那很容易，不是吗？</p><h2 id="fb30" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">它是如何工作的？</h2><p id="4f44" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">如果你去<code class="du lu lv lw lx b">DevTools -&gt; Network -&gt; WS</code>，你会看到每次你点击一个按钮，数据就会通过网络套接字发送并即时更新。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ng"><img src="../Images/c8954b5d08a3ca2da02c7322602a68d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NKbj93bDaA1fEhf9P6dekA.png"/></div></div><figcaption class="nc nd et er es ne nf bd b be z dx">Our Websocket Log</figcaption></figure><p id="17b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很酷吧？我们完全不用JavaScript就完成了所有这些工作！</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="c3a6" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">最后的想法</h1><p id="8334" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">您刚刚学习了LiveView的基础知识，不用JavaScript就构建了一个简单的计数器应用程序！我希望这个故事对你有所帮助。下一个故事再见！</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="bc12" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">仅此而已。感谢您阅读这个故事！</h1><p id="f388" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">如果你喜欢这个故事，一定要为它鼓掌！你想问我什么都可以。</p><p id="9efb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Twitter上关注我:</p><div class="mi mj ez fb mk ml"><a href="https://twitter.com/Re_allyedge" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hj fi z dy mq ea eb mr ed ef hh bi translated">re _ ally边缘</h2><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">twitter.com</p></div></div><div class="nh l"><div class="ni l nj nk nl nh nm jn ml"/></div></div></a></div><p id="6b05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Patreon上支持我:</p><div class="mi mj ez fb mk ml"><a href="https://www.patreon.com/allyedge" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hj fi z dy mq ea eb mr ed ef hh bi translated">阿里木阿尔斯兰卡亚是创造编程故事和教程。帕特里翁</h2><div class="ms l"><h3 class="bd b fi z dy mq ea eb mr ed ef dx translated">今天就成为阿里木阿尔斯兰卡亚的赞助人:在世界上最大的…</h3></div><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">www.patreon.com</p></div></div><div class="nh l"><div class="nn l nj nk nl nh nm jn ml"/></div></div></a></div></div></div>    
</body>
</html>