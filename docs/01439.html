<html>
<head>
<title>A Step-By-Step Guide to Creating a Twitter Clone With React and Supabase — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React和Supabase创建Twitter克隆的分步指南——第2部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/a-step-by-step-guide-to-creating-a-twitter-clone-with-react-and-supabase-part-2-43fd11558fc1?source=collection_archive---------4-----------------------#2021-04-10">https://medium.com/geekculture/a-step-by-step-guide-to-creating-a-twitter-clone-with-react-and-supabase-part-2-43fd11558fc1?source=collection_archive---------4-----------------------#2021-04-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3b2ecc1784056d3c027f56c2c6b6c8c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*p1wN81Q9VSM0hn_A.png"/></div></div></figure><p id="21ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个系列中，我用React和<a class="ae jo" href="https://supabase.io/" rel="noopener ugc nofollow" target="_blank"> Supabase </a>创建了一个Twitter克隆。到本系列结束时，我们将部署一个全功能的应用程序，让用户:</p><ol class=""><li id="2675" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">在推特上发布他们的想法，</li><li id="0ae8" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">上传头像并更改其个人资料，</li><li id="70cf" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">当有新的推文时被通知，并且；</li><li id="42f6" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">当有人喜欢他们的推文时得到通知。</li></ol><p id="fc68" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<a class="ae jo" rel="noopener" href="/geekculture/a-step-by-step-guide-to-creating-a-twitter-clone-with-react-and-supabase-part-1-d6865ade095a">第1部分</a>中，我们有:</p><ul class=""><li id="bc2f" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn kd jv jw jx bi translated">创建了一个新的Supabase项目，查看了仪表盘上的东西，</li><li id="560e" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated">使用Supabase的<code class="du ke kf kg kh b">User Management Starter</code>模板快速制作<code class="du ke kf kg kh b">profiles</code>表格，在表格中启用<a class="ae jo" href="https://www.postgresql.org/docs/current/ddl-rowsecurity.html" rel="noopener ugc nofollow" target="_blank">行级安全</a>并设置用户上传头像的存储访问策略；</li><li id="949d" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated">使用<code class="du ke kf kg kh b">create-react-app</code>启动了一个新的typescript React项目，并安装了<code class="du ke kf kg kh b">material-ui</code>作为UI库。</li></ul><p id="efe1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们还不会使用<code class="du ke kf kg kh b">profiles</code>表。这是因为你首先需要用户已经注册，为他们建立一个配置文件！对我们来说幸运的是，Supabase带有身份验证。在您的控制面板中，您可以通过转到“Authentication”选项卡来查看您当前的用户。</p><figure class="kj kk kl km fd ij er es paragraph-image"><div class="er es ki"><img src="../Images/cbd87487fd1fe2d57c3a6403cf64abdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*0VuBDEhrGpfDfIHTWQSwIQ.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx">I have my test users, but you shouldn’t see any users 😅</figcaption></figure><p id="4c57" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可能记得我们在<a class="ae jo" rel="noopener" href="/geekculture/a-step-by-step-guide-to-creating-a-twitter-clone-with-react-and-supabase-part-1-d6865ade095a">第1部分</a>中创建<code class="du ke kf kg kh b">profiles</code>表时引用过这个表。当我们创建了<code class="du ke kf kg kh b">profiles</code>表后，我们将主键<code class="du ke kf kg kh b">id</code>设置为外键，引用<code class="du ke kf kg kh b">auth.users</code>表。我已经包含了下面的片段:</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div><figcaption class="kn ko et er es kp kq bd b be z dx">Remember this SQL?</figcaption></figure><p id="8494" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，在第2部分中，我们将设置一个基本的用户认证流程，以便应用程序可以让用户注册、登录和注销。为实现这一目标，我们将建立:</p><ul class=""><li id="b084" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn kd jv jw jx bi translated">客户端路由有<code class="du ke kf kg kh b"><a class="ae jo" href="reactrouter.com" rel="noopener ugc nofollow" target="_blank">react-router-dom</a></code> <a class="ae jo" href="reactrouter.com" rel="noopener ugc nofollow" target="_blank"> </a>、</li><li id="4431" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated">用<code class="du ke kf kg kh b"><a class="ae jo" href="https://react-hook-form.com/" rel="noopener ugc nofollow" target="_blank">react-hook-form</a></code>进行客户端验证，最后；</li><li id="4064" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated">用<a class="ae jo" href="https://github.com/supabase/supabase-js" rel="noopener ugc nofollow" target="_blank">方便的官方客户端</a> <code class="du ke kf kg kh b"><a class="ae jo" href="https://github.com/supabase/supabase-js" rel="noopener ugc nofollow" target="_blank">@supabase/supabase-js</a></code>调用Supabase的认证API。</li></ul><p id="e370" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们开始吧！奔跑</p><h1 id="ed8f" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">用react-router设置客户端路由</h1><p id="2c11" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated"><a class="ae jo" href="https://reactrouter.com/" rel="noopener ugc nofollow" target="_blank"> react-router-dom </a>是在react中设置客户端路由的首选库。使用以下命令将其添加到项目中:</p><pre class="kj kk kl km fd lw kh lx ly aw lz bi"><span id="7835" class="ma ku hi kh b fi mb mc l md me">yarn add react-router-dom<!-- --> </span></pre><p id="8f61" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并在打字时加上</p><pre class="kj kk kl km fd lw kh lx ly aw lz bi"><span id="d71e" class="ma ku hi kh b fi mb mc l md me">yarn add --dev @types/react-router-dom</span></pre><p id="2cb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">转到react项目中的<code class="du ke kf kg kh b">App.tsx</code>,用下面的代码替换它。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="9631" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上述代码列出了4条路线:</p><ul class=""><li id="53f1" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn kd jv jw jx bi translated"><code class="du ke kf kg kh b">/signup</code>用户可以在那里注册、</li><li id="93d5" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated"><code class="du ke kf kg kh b">/signin</code>用户可以在哪里签到、</li><li id="a95d" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated"><code class="du ke kf kg kh b">/signout</code>哪里——你猜对了！-用户可以注销，以及；</li><li id="0eea" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated">最后<code class="du ke kf kg kh b">/</code>这是网站的根。</li></ul><p id="31ec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如您所见，这些路线除了显示它们的名称之外什么也不做。我们现在就实施它们。</p><h1 id="7f1d" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">实现基本注册页面</h1><p id="5e4c" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">一个基本的注册表单只需要三个字段:</p><ol class=""><li id="8e2c" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">电子邮件，</li><li id="4717" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">密码，以及；</li><li id="16df" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">确认密码(确保密码匹配！)</li></ol><p id="3d6f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<code class="du ke kf kg kh b">src</code>文件夹中创建一个名为<code class="du ke kf kg kh b">pages</code>的文件夹。创建一个名为<code class="du ke kf kg kh b">signupPage.tsx</code>的新文件，然后粘贴下面的代码片段。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="bdb9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">转到<code class="du ke kf kg kh b">App.tsx</code>并将该组件添加到<code class="du ke kf kg kh b">/signup</code>路线</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="d3b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在当你<code class="du ke kf kg kh b">yarn start</code>转到<code class="du ke kf kg kh b">/signup</code>时，你应该会看到这个。如果你点击“登录”按钮，你只会得到一个提示说“已注册”！</p><figure class="kj kk kl km fd ij er es paragraph-image"><div class="er es mf"><img src="../Images/eadcb55b64530a0af6c369ec0d19d302.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*82QPz_ETgh6tZtx2t4EXkQ.png"/></div></figure><p id="5dc5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">美丽的😍。但形式还有很长的路要走。</p><ol class=""><li id="afce" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">它不做任何客户端验证，所以我们的用户可以提交他们想要的任何东西；</li><li id="c6ff" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">显然，它实际上并没有调用我们的Supabase后端。</li></ol><p id="0bf9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们使用<code class="du ke kf kg kh b">react-hook-form</code>库来实现一些客户端验证。</p><h1 id="a590" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">使用<code class="du ke kf kg kh b">react-hook-form</code>进行客户端验证</h1><p id="3a6c" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">在我们让用户将表单发送到我们的Supabase后端之前，我们希望检查:</p><ol class=""><li id="2f44" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">用户给我们的电子邮件是有效的电子邮件，</li><li id="a07f" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">密码至少有8个字符，并且；</li><li id="c667" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><code class="du ke kf kg kh b">password</code>字段和<code class="du ke kf kg kh b">confirm password</code>字段中的密码应该匹配。</li></ol><p id="0616" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将在<code class="du ke kf kg kh b">react-hook-form</code>的帮助下实现这个逻辑，所以让我们安装react-hook-form。</p><pre class="kj kk kl km fd lw kh lx ly aw lz bi"><span id="70d7" class="ma ku hi kh b fi mb mc l md me">yarn add react-hook-form</span></pre><p id="a6af" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将下面的代码片段复制到<code class="du ke kf kg kh b">signupPage.tsx</code>中，替换现有代码。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="18ee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">再次运行该项目。尝试在没有匹配密码的情况下提交。“确认密码”应变成红色，并显示一条错误消息，并且不会调用<code class="du ke kf kg kh b">alert()</code>。</p><figure class="kj kk kl km fd ij er es paragraph-image"><div class="er es mg"><img src="../Images/9f33636375300b6c9664905e8994d38e.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*cZFfBpWljKD7f-8bMZdv2A.png"/></div></figure><p id="b111" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可能已经注意到了，我已经用数字标注了代码，让我们一个接一个地检查编号的部分。</p><h2 id="5101" class="ma ku hi bd kv mh mi mj kz mk ml mm ld jb mn mo lh jf mp mq ll jj mr ms lp mt bi translated">(1)添加useForm()并取我们需要的</h2><p id="40e2" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">我们使用来自<code class="du ke kf kg kh b">react-hook-form</code>的<code class="du ke kf kg kh b">useForm()</code>钩子来获取函数，我们将使用这些函数将表单连接到库。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><ul class=""><li id="ac34" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn kd jv jw jx bi translated"><code class="du ke kf kg kh b">register</code>用于注册<code class="du ke kf kg kh b">input</code>元素来跟踪它们，使用<code class="du ke kf kg kh b">input</code>元素的<code class="du ke kf kg kh b">name</code>道具。我将在第(3)点更详细地解释这一点。</li><li id="702b" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated"><code class="du ke kf kg kh b">handleSubmit</code>用于包装我们的<code class="du ke kf kg kh b">onSubmit</code>回调——如果有任何验证错误，它将停止调用包装的函数(在我们的例子中是<code class="du ke kf kg kh b">onSubmit</code>回调)。</li><li id="446b" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated"><code class="du ke kf kg kh b">watch</code>用于跟踪一个注册元素。在上面的代码片段中，我们给密码字段命名为<code class="du ke kf kg kh b">"password"</code>，并使用<code class="du ke kf kg kh b">watch("password")</code>来观察字段的值。更多解释见下文第(2)点。</li><li id="9ca4" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated"><code class="du ke kf kg kh b">errors</code>是一个对象，当验证的结果有- <em class="mu">你猜对了</em> -错误时，它将被填充。如果一个名为<code class="du ke kf kg kh b">"password"</code>的字段无效，那么error对象将会有一个名为<code class="du ke kf kg kh b">error.password</code>的属性，带有<code class="du ke kf kg kh b">message</code>和其他有用的属性。更多详情，请点击此处阅读API文档。</li></ul><h2 id="fb9b" class="ma ku hi bd kv mh mi mj kz mk ml mm ld jb mn mo lh jf mp mq ll jj mr ms lp mt bi translated">(2)使用<code class="du ke kf kg kh b">watch()</code>跟踪密码字段中的值</h2><p id="f3ac" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">正如我上面解释的，我们使用<code class="du ke kf kg kh b">watch("[inputName]")</code>来访问被监视输入的当前值。我们稍后将使用它来确保在用户提交表单之前密码是匹配的。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><h2 id="25a7" class="ma ku hi bd kv mh mi mj kz mk ml mm ld jb mn mo lh jf mp mq ll jj mr ms lp mt bi translated">(3)我们注册输入元素，将<code class="du ke kf kg kh b">register()</code>传递给输入的ref属性。</h2><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="eb4d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您必须给输入一个名称，并通过将<code class="du ke kf kg kh b">register()</code>传递给<code class="du ke kf kg kh b">ref</code>属性来注册组件。通常，如果你有一个简单的输入，你可以将<code class="du ke kf kg kh b">register()</code>传递给<code class="du ke kf kg kh b">ref</code> prop，如下所示:</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="31fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，<code class="du ke kf kg kh b">&lt;TextField /&gt;</code>组件没有<code class="du ke kf kg kh b">ref</code>属性。幸运的是，Material UI公开了<code class="du ke kf kg kh b">inputRef</code>，它将道具传递给了<code class="du ke kf kg kh b">&lt;input /&gt;</code>元素的ref。如果你选择的UI库没有像Material UI那样公开<code class="du ke kf kg kh b">input</code>的<code class="du ke kf kg kh b">ref</code>，<a class="ae jo" href="https://react-hook-form.com/get-started#IntegratingwithUIlibraries" rel="noopener ugc nofollow" target="_blank">在官方文档</a>中也有其他方法。</p><h2 id="fe14" class="ma ku hi bd kv mh mi mj kz mk ml mm ld jb mn mo lh jf mp mq ll jj mr ms lp mt bi translated">(4)声明该字段需要什么验证。</h2><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="eb88" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以将带有验证规则的对象传递给<code class="du ke kf kg kh b">register()</code>函数。在上面的片段中:</p><ul class=""><li id="6adc" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn kd jv jw jx bi translated"><code class="du ke kf kg kh b">required: "You must provide an email"</code>表示该字段为必填项，不填时的错误信息(后文给出为<code class="du ke kf kg kh b">errors.email.message</code>)</li><li id="0a2c" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated"><code class="du ke kf kg kh b">pattern: emailRegex</code>表示该字段的值必须匹配电子邮件正则表达式(在文件顶部定义)。</li></ul><p id="9322" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当然，还有其他验证规则，你可以在官方文档中找到它们。</p><p id="2c43" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">除了预设的验证规则，我们还可以传入一个回调函数来使用定制的验证逻辑。在代码中，当我注册“确认密码”输入字段时，我使用了一个回调来检查密码是否匹配。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><h2 id="5bad" class="ma ku hi bd kv mh mi mj kz mk ml mm ld jb mn mo lh jf mp mq ll jj mr ms lp mt bi translated">(5)通过<code class="du ke kf kg kh b">errors</code>对象向用户显示验证错误</h2><p id="1747" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">我们已经设置了验证，并将组件连接到<code class="du ke kf kg kh b">react-hook-form</code>，但是当用户给了我们无效的输入时，我们不会告诉用户他们做错了什么。我们可以通过利用从<code class="du ke kf kg kh b">useForm()</code>获得的<code class="du ke kf kg kh b">errors</code>对象来实现这一点。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="2c4a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ke kf kg kh b">errors</code>当没有任何错误时，对象将是一个空对象，但是当<code class="du ke kf kg kh b">react-hook-form</code>检测到无效输入时，它将向<code class="du ke kf kg kh b">errors</code>添加一个带有违规输入的对象<code class="du ke kf kg kh b">name</code>。例如，如果给了<code class="du ke kf kg kh b">&lt;input name="email" ref={register({ required: true })}/&gt;</code>一个无效的输入，那么<code class="du ke kf kg kh b">errors</code>对象将拥有一个带有<code class="du ke kf kg kh b">FieldError</code>对象的email属性。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div><figcaption class="kn ko et er es kp kq bd b be z dx">usually, we just care about the ‘message’ field</figcaption></figure><p id="11bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在代码中，我们用它来通过材质UI显示错误。当你传递一个真值给Material-UI的<code class="du ke kf kg kh b">TextField</code>组件的<code class="du ke kf kg kh b">error</code>属性时，它会变成红色并显示我们的错误信息，这个错误信息被传递给<code class="du ke kf kg kh b">helperText</code>属性。</p><p id="8c06" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当没有错误时，错误对象将是<code class="du ke kf kg kh b">null</code>，所以我使用<a class="ae jo" href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-7.html" rel="noopener ugc nofollow" target="_blank">可选链接</a>来检查<code class="du ke kf kg kh b">undefined</code>。</p><p id="7f54" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们已经有了一些客户端验证，让我们将注册页面连接到Supabase！</p><h1 id="0c37" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">将注册页面连接到Supabase</h1><p id="6009" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">要将我们的应用程序连接到Supabase，我们需要:</p><ol class=""><li id="a944" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">安装Supabase JavaScript客户端。</li><li id="80df" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">通过提供我们的Supabase应用程序的URL和API密钥来初始化客户端。</li></ol><p id="133e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们首先安装客户端。</p><pre class="kj kk kl km fd lw kh lx ly aw lz bi"><span id="32c1" class="ma ku hi kh b fi mb mc l md me">yarn add @supabase/supabase-js</span></pre><p id="9c69" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<code class="du ke kf kg kh b">src</code>文件夹中添加一个名为<code class="du ke kf kg kh b">/api</code>的文件夹，然后添加一个名为<code class="du ke kf kg kh b">supabaseClient.ts</code>的文件。在文件中，复制以下代码片段。</p><pre class="kj kk kl km fd lw kh lx ly aw lz bi"><span id="6df2" class="ma ku hi kh b fi mb mc l md me">import { createClient } from '@supabase/supabase-js'</span><span id="cc5e" class="ma ku hi kh b fi mv mc l md me">const supabaseUrl = 'https://URL_TO_YOUR_APP.supabase.co'<br/>const supabaseKey = 'Your supabase key'</span><span id="71f0" class="ma ku hi kh b fi mv mc l md me">export const supabaseClient = createClient(supabaseUrl, supabaseKey)</span></pre><p id="80db" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如您所见，我们需要获得您的应用程序的URL和API密钥。你可以在Supabase中打开你的项目，然后点击设置(cog图标)，进入API。</p><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mw"><img src="../Images/c22287436443e5210c6bc86660aa728a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TY5lZ7ofo4MSJbR-YCfe_g.png"/></div></div></figure><p id="1981" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制URL并用它替换<code class="du ke kf kg kh b">supabaseUrl</code>的值。对API键做同样的操作。这是一个公钥，所以硬编码也可以(只要确保您已经打开了行级安全性！).</p><p id="8ff5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">转到您的<code class="du ke kf kg kh b">signUpPage.tsx</code>文件，导入<code class="du ke kf kg kh b">supabaseClient</code>并将<code class="du ke kf kg kh b">onSubmit</code>函数更改如下:</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="c946" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，重启你的app，进入<code class="du ke kf kg kh b">/signup</code>路线，尝试报名。你应该得到一个提示，说你已经注册成功了！转到Supabase中的认证部分。您应该会在用户列表中看到您的电子邮件。</p><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/a31be59b5ec40f992a5544f0f612b5d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WmbIRvL5AyTz748z4kx4pg.png"/></div></div></figure><p id="8415" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">进入你的邮箱，你应该也能看到确认邮件！</p><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/81c08de223349621788a00ff070bb222.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y_qR3PdwfVY7UHEssoSzDQ.png"/></div></div></figure><p id="a396" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们已经有了基本的注册流程。让我们来设置登录和注销流程。在<code class="du ke kf kg kh b">pages</code>文件夹中创建两个文件<code class="du ke kf kg kh b">signInPage.tsx</code>和<code class="du ke kf kg kh b">signOutPage.tsx</code>。将下面的代码粘贴到<code class="du ke kf kg kh b">signInPage.tsx</code>中。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="149b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并将下面的代码粘贴到<code class="du ke kf kg kh b">signOutPage.tsx</code>。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="521d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后将新页面添加到<code class="du ke kf kg kh b">App.tsx</code>中的路线。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="7ce5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此时点击登录按钮没有任何作用！嗯，你可能会<em class="mu">登录，但之后我们不会做任何事情。</em></p><figure class="kj kk kl km fd ij er es paragraph-image"><div class="er es mz"><img src="../Images/7e7f4c8bdfecfe2e3319ba652b72e2fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:462/format:webp/1*fKqIJ6uUrelGMRofRNakQQ.png"/></div></figure><p id="0585" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们知道登录成功了，让我们在用户成功登录后将他们重定向到主页<code class="du ke kf kg kh b">/</code>。在主页上，如果用户登录，我们会在主页上显示他们的电子邮件。</p><p id="6054" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，对<code class="du ke kf kg kh b">SignInPage.tsx</code>进行如下修改</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="289b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后把这几行加到<code class="du ke kf kg kh b">App.tsx</code>里。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="c769" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ke kf kg kh b">supabaseClient.auth.session()</code>获取当前会话(从本地存储器中),如果有的话。您可以通过检查控制台中的本地存储选项来查看这一点。</p><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es na"><img src="../Images/ad984456752e67c9446d8d040c2752c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DMb00nBoLnRe7EdJfysWtw.png"/></div></div></figure><p id="f6ec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mu">注:我并不认为</em> <a class="ae jo" href="https://auth0.com/docs/tokens/token-storage#browser-local-storage-scenarios" rel="noopener ugc nofollow" target="_blank"> <em class="mu">在本地存储中保护令牌(尤其是刷新令牌)是最安全的做法</em> </a> <em class="mu">，但在这篇博文中我们就不赘述了。我可能会做更多的研究，以后再写🔬</em></p><p id="d668" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，当您登录时，您将被重定向到主页，并会看到我们刚刚添加的消息。</p><figure class="kj kk kl km fd ij er es paragraph-image"><div class="er es nb"><img src="../Images/2ef0ba45c252d25482bb05d0aaa77f4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/1*9xEVpRSNF4aDlikw8vIEtg.gif"/></div></figure><p id="be4c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们有一个非常基本的认证流程，但它仍然缺少许多功能和修饰。别担心，我们将在下一部分讨论它们。在第3部分中，我们将:</p><ul class=""><li id="f9d5" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn kd jv jw jx bi translated">prettier✨把事情稍微弄了一下，</li><li id="2baa" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated">添加一个带链接的导航栏，当用户登录或退出时刷新。</li><li id="4f55" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated">创建一些用户必须登录才能访问的安全路由(或重定向到<code class="du ke kf kg kh b">/signup</code>路由)。</li></ul><p id="26c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过实施上述内容，我们将会学到:</p><ul class=""><li id="c51d" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn kd jv jw jx bi translated">如何在组件中使用和注入React上下文，以及</li><li id="b007" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated">当我们确保路线安全时，如何使用高阶组件来保持干燥。</li></ul><p id="4fbc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢您通读这篇长长的教程🙏在推特上关注我，这样你就不会错过第三部分了。如果你有任何问题，请通过评论这篇文章或通过Twitter告诉我。第3部分再见！</p></div></div>    
</body>
</html>