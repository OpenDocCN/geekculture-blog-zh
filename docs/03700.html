<html>
<head>
<title>Ranking MMA fighters using the Elo rating system</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Elo评分系统对MMA拳手进行排名</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/ranking-mma-fighters-using-the-elo-rating-system-2704adbf0c94?source=collection_archive---------17-----------------------#2021-06-14">https://medium.com/geekculture/ranking-mma-fighters-using-the-elo-rating-system-2704adbf0c94?source=collection_archive---------17-----------------------#2021-06-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c906" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用python实现。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/9f6776487fa5cbf1a921348a47071824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RvPoQzVKOtkLp7tcKUQmoQ.jpeg"/></div></div></figure><h1 id="8a3d" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">介绍</h1><p id="565b" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">在任何运动中给竞争者排名都是艰难的，综合格斗(MMA)也不例外。在你可以在网上浏览的每个MMA论坛中，你都会看到一系列关于goa . t .的讨论，你也会在任何贴出的列表中发现很少的一致意见。那么，有没有可能想出一个多人都能认同的排名方法呢？让我们试一试。</p><p id="064c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">体育运动有多种排名方法，但今天我们将探索<strong class="ih hj"> Elo评级系统，</strong>其他的留给以后的帖子。Elo是一个评级系统，用于计算零和游戏(即一些人胜利意味着另一些人失败的游戏)中玩家的相对技能，使其适合格斗运动排名，即使它是在非常不同的背景下构思的。</p><p id="0072" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该系统本身实际上是在20世纪60年代作为国际象棋评级系统而创建的。而不是一般的体育运动。尽管如此，它的使用已经扩展到许多体育运动，如足球、篮球、美式足球、棒球和许多其他运动(FiveThirtyEight已经普及了它在NFL和足球世界杯预测中的使用。有关更多信息，请参见[1])。</p><h1 id="869c" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">该理论</h1><p id="5927" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">让我们简单地探讨一下这个系统是如何工作的，以及在应用它之前我们可以从结果中期待什么。我还会稍微改变一下术语，使其与MMA更直接相关。</p><p id="789e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Elo的基本公式给出了一场比赛的预期结果，它是参赛选手等级差异的函数。例如，给定两个战士<em class="ks"> i </em>和<em class="ks">j</em>，他们之间战斗的预期结果可以计算为:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kt"><img src="../Images/ef244898a74458eda376a7b859582107.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/0*4tEghpjlAZWdtI3r"/></div></figure><p id="b237" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个公式与逻辑函数有着密切的联系，不同之处在于，我们不是以欧拉数为基数，而是以10为基数，但它仍然为胜利概率提供了一个平滑的sigmoid函数。让我们检查一下。</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="c5c3" class="kz jq hi kv b fi la lb l lc ld">import numpy as np<br/>import matplotlib.pyplot as plt<br/>import matplotlib.ticker as mtick<br/>import seaborn as sns<br/>rating_range = np.arange(500, 2500, 50)<br/>probs = [prob_i_beats_j(ri, rj) for ri in ratings for rj in ratings]<br/>rating_diff = [ri - rj for ri in ratings for rj in ratings]<br/>fig, ax = plt.subplots(figsize=(8, 6), dpi=100)<br/>sns.scatterplot(rating_dff, probs, ax=ax, s=1)<br/>ax.yaxis.set_major_formatter(mtick.PercentFormatter())<br/>ax.set_xlabel("Rating Difference between $i$ and $j$")<br/>ax.set_ylabel("Pr(i beats j)")</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es le"><img src="../Images/63a88e0ffd3e461bbfbd95bf3113045a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*nSiNr2bF3KvRtevTTQnGTA.png"/></div><figcaption class="lf lg et er es lh li bd b be z dx">Probability of victory vs. rating difference</figcaption></figure><p id="43c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并且基于以下公式更新战斗结果之后的战士等级:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lj"><img src="../Images/8bb7641edbc4c5584c1dfcacc37ecc7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/0*hraJhF9VWEvX-pP4"/></div></figure><p id="c432" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中<em class="ks"> r </em>是<em class="ks"> 1 </em>如果斗士<em class="ks"> i </em>赢了<em class="ks"> 0 </em>如果输了。括号中的值作为预测的匹配概率之间的误差度量。而<em class="ks"> K </em>是一个比例因子，用于校准评级变化的速度。这个方程也与统计学习中使用的梯度下降公式有密切的相似之处。Steven Morse的这篇博文[2]对Elo作为一个统计学习模型有很好的描述。</p><p id="43d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个原始的实现有一系列的限制，在Elo Wikipedia页面[3]和我之前提到的其他链接中有很好的解释。我们将在实现中解决的两个问题是胜利的边际和自相关。</p><ul class=""><li id="7653" class="lk ll hi ih b ii ij im in iq lm iu ln iy lo jc lp lq lr ls bi translated">胜利的差额:Elo不考虑一个战士如何赢得一场战斗。判决(一致或分歧)将按照与完成相同的方式计算。我们想要排名更高的战士，我们将引入一个胜利系数<em class="ks"> M(r) </em>来说明这一点。我们的实现将为一致决策给出3分，为分裂决策给出1分，为完成决策给出5分，但是可以使用更详细的评分函数来提高评级。</li><li id="d533" class="lk ll hi ih b ii lt im lu iq lv iu lw iy lx jc lp lq lr ls bi translated"><strong class="ih hj">自相关</strong>:因为最受欢迎的人赢的次数更多，也更有可能结束一场比赛，他们的评分调整可能会变得过度膨胀，尤其是在存在胜率因素的情况下。我们实现了一个自相关因子<em class="ks"> A(x) </em>非常类似于FiveThirtyEight NFL Elo算法实现的一个自相关因子，以对此进行调整。</li></ul><p id="4747" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">考虑到这两种调整，我们的Elo调整公式如下:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ly"><img src="../Images/d5936c44094dec57ea0cae813cb17dec.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/0*Q3f4thhLmvZP2tGs"/></div></figure><p id="9edc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中<em class="ks"> z </em>是战斗的胜利方法。从算法上来说，我们对于<em class="ks"> M(z) </em>的函数有如下实现:</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="7c5c" class="kz jq hi kv b fi la lb l lc ld">def get_win_method_weight(x: str) -&gt; float:<br/>    if "Decision" in x:<br/>        if "Split" in x:<br/>            return 1.<br/>        else:<br/>            return 3.<br/>    elif "KO" in x:<br/>        return 5.<br/>    elif "Submission" in x:<br/>        return 5.<br/>    else:<br/>        return 0.</span></pre><p id="0a41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lz"><img src="../Images/72a1f552a768726c8bc85028bbd0ba94.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/0*adobIvsdNliqvoO4"/></div></figure><h1 id="2063" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">将Elo应用于MMA</h1><p id="5890" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">为了创建我们的排名，我们将使用从网上抓取的MMA比赛数据集，并实现我们在python中描述的方法。该数据集由353.952场比赛组成，包含关于获胜者、失败者、获胜方法以及其他一些属性的信息。它看起来像下面的熊猫数据帧:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ma"><img src="../Images/1d4cc867c3f61fc707fd1d0e3b6908df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_72wX_OmdeoHnpb2CoqGXA.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx">Fight dataset sample.</figcaption></figure><p id="e608" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将创建一个类来存储和更新每个战士的等级。它基于以下python库:<a class="ae mb" href="https://github.com/ddm7018/Elo" rel="noopener ugc nofollow" target="_blank"> Elo算法在Python中的实现(github.com)</a></p><p id="8b5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个拳手都将从1500分开始，相同范围内的数值通常用于国际象棋和其他运动中，公式中使用的系数也考虑了这一等级。该类存储拳手的等级，并根据比赛结果实现更新。</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="0f3f" class="kz jq hi kv b fi la lb l lc ld">class Elo:<br/>    def __init__(self, k: int):<br/>        self.rating_dict = {}<br/>        self.k = k</span><span id="2066" class="kz jq hi kv b fi mc lb l lc ld">def __getitem__(self, player: str) -&gt; float:<br/>        return self.rating_dict[player]</span><span id="127c" class="kz jq hi kv b fi mc lb l lc ld">def __setitem__(self, player: str, data: float) -&gt; None:<br/>        self.rating_dict[player] = data</span><span id="a173" class="kz jq hi kv b fi mc lb l lc ld">def get_margin_factor(self, score: float) -&gt; float:<br/>        return np.log2(score + 1)</span><span id="2a38" class="kz jq hi kv b fi mc lb l lc ld">def get_inflation_factor(self, r_win: float, r_lose: float) -&gt; float:<br/>        return 1 / (1 - ((r_lose - r_win) / 2200))</span><span id="b2fa" class="kz jq hi kv b fi mc lb l lc ld">def add_player(self, name: str, rating: float = 1500.):<br/>        self.rating_dict[name] = rating</span><span id="ab9a" class="kz jq hi kv b fi mc lb l lc ld">def update_ratings(self, winner: str, loser: str, score: float) -&gt; None:<br/>        <br/>        expected_result = self.get_expect_result(<br/>            self.rating_dict[winner], self.rating_dict[loser]<br/>        )<br/>        margin_factor = self.get_margin_factor(score)<br/>        inflation_factor = self.get_inflation_factor(<br/>            self.rating_dict[winner], self.rating_dict[loser]<br/>        )</span><span id="cd43" class="kz jq hi kv b fi mc lb l lc ld">self.rating_dict[winner] = self.rating_dict[winner] + self.k * margin_factor * inflation_factor * (1 - expected_result)<br/>        self.rating_dict[loser] = self.rating_dict[loser] + self.k * margin_factor * inflation_factor * (-1 + expected_result)</span><span id="71ee" class="kz jq hi kv b fi mc lb l lc ld">def get_expect_result(self, p1: float, p2: float) -&gt; float:<br/>        exp = (p2 - p1) / 400.0<br/>        return 1 / ((10.0 ** (exp)) + 1)</span></pre><p id="08ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们将使用以下函数创建我们的Elo计分器并将其应用于格斗数据集:</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="c3b8" class="kz jq hi kv b fi la lb l lc ld">def calc_elo_rank(df: pd.DataFrame) -&gt; pd.DataFrame:<br/>    elo_scorer = Elo(k = 20)<br/>    fighter_set = set(df['winner_slog'].unique().tolist() + df['loser_slog'].unique().tolist())<br/>    for fighter in fighter_set:<br/>        elo_scorer.add_player(fighter)</span><span id="7b05" class="kz jq hi kv b fi mc lb l lc ld">elo_f1 = np.zeros((len(df,)))<br/>    elo_f2 = np.zeros((len(df,)))</span><span id="5c8c" class="kz jq hi kv b fi mc lb l lc ld">for rowidx, fs_row in tqdm(enumerate(df.itertuples())):<br/>        <br/>        fighter = fs_row.winner_slog<br/>        opponent = fs_row.loser_slog<br/>        score = fs_row.win_method_score</span><span id="43d4" class="kz jq hi kv b fi mc lb l lc ld">elo_f1[rowidx] = elo_scorer[fighter]<br/>        elo_f2[rowidx] = elo_scorer[opponent]</span><span id="59f6" class="kz jq hi kv b fi mc lb l lc ld">elo_scorer.update_ratings(fighter, opponent, score)</span><span id="8342" class="kz jq hi kv b fi mc lb l lc ld">df.loc[:, 'elo_f1'] = elo_f1<br/>    df.loc[:, 'elo_f2'] = elo_f2<br/>    <br/>    return df</span></pre><h1 id="7ec0" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结果</h1><p id="14b1" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">在将该算法应用于整个数据集之后，我们在每个结果之后得到每个战斗机的Elo评级。对于排名，我们将根据每位拳手的最高Elo评分，即他们职业生涯的巅峰来评估他们。</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="e738" class="kz jq hi kv b fi la lb l lc ld">max_ranking = (pd.concat([<br/>        fight_df[['winner', 'winner_slog', 'weightclass', 'elo_f1']]<br/>        .rename(<br/>            dict(winner='fighter', winner_slog='fighter_slog', elo_f1='elo'),<br/>            axis=1),<br/>        fight_df[['loser', 'loser_slog', 'weightclass', 'elo_f2']]<br/>        .rename(<br/>            dict(loser='fighter', loser_slog='fighter_slog', elo_f2='elo'),<br/>            axis=1)<br/>    ])<br/>    .groupby(<br/>        ['fighter', 'fighter_slog', 'weightclass'],<br/>        as_index=False)['elo']<br/>    .max()<br/>)</span></pre><p id="7196" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">执行此聚合后，我们可以创建多个等级。</p><h2 id="a021" class="kz jq hi bd jr md me mf jv mg mh mi jz iq mj mk kd iu ml mm kh iy mn mo kl mp bi translated">部门排名</h2><p id="b713" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">首先，让我们看看每个部门谁是最好的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mq"><img src="../Images/09d3e0845303dec7ed5c664e08bb16f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/1*IfGYwzzKv_d6atleWwjXRQ.png"/></div></figure><p id="ab8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果是非常有趣的，许多UFC战士被认为是他们那个时代最好的，是他们部门的G.O.A.T。这份清单的一个局限性是，体重等级是从战斗人员档案中获得的，它们反映了战斗人员在获得数据时所处的体重等级，这对于在不同类别之间跳跃的战斗人员来说是一个问题。这造成了一些错误，比如狄米崔斯·约翰逊被列为最轻量级，尽管在终极格斗锦标赛中是轻量级。</p><p id="e154" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可悲的是，我们的数据集也没有关于性别的信息，男性和女性的评级混在一起，所以我们现在不会有女性排名的全貌。但是即使有这样的限制，这个模型看起来工作得很好。</p><p id="dd21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一些有趣的结果也出现了，如帕特里西奥·弗莱雷在轻量级和托尼·弗格森在轻量级。弗格森是分区的大明星，但他通常不被认为是最伟大的轻量级选手；卡比·努尔马戈梅多夫和BJ·佩恩是这份名单中比较常见的名字。</p><h2 id="4ccf" class="kz jq hi bd jr md me mf jv mg mh mi jz iq mj mk kd iu ml mm kh iy mn mo kl mp bi translated"><strong class="ak">查找G.O.A.T. </strong></h2><p id="61a5" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">如果我们试图找到MMA的山羊，Elo告诉我们什么？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mr"><img src="../Images/cc24775e1757e36c3067be59b9669f7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*ZJmThmXg3HTM5-IHrXOzdQ.png"/></div></figure><p id="49b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很有意思；最常见的名字如安德森·席尔瓦、乔恩·琼斯、费多尔和普惠制都在名单上。安德森占据榜首，可能是因为他在顶级比赛中的高完成率，而GSP(许多人眼中的山羊)在名单上有点靠后，因为他作为冠军的大多数胜利都是决策。名单中一些有趣的名字包括特拉维斯·富尔顿和马迈德·哈利多夫，他们不是主要MMA组织的成员，但却有着令人印象深刻的记录。</p><h1 id="f9b9" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">最后的想法</h1><p id="6652" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">Elo提供了一种简单但可靠的方法来对战士进行排名。虽然并不完美(由于方法和数据的限制)，但我们可以在Elo实现产生的列表中看到许多最受欢迎的名字。你对结果和实施有什么看法？你感到惊讶吗？你会做些不同的事情吗？请在评论中告诉我们。</p><h1 id="fedc" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">参考</h1><p id="f823" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">[1]<a class="ae mb" href="https://fivethirtyeight.com/features/introducing-nfl-elo-ratings/" rel="noopener ugc nofollow" target="_blank">https://fivethirtyeight . com/features/introducing-NFL-elo-ratings/</a></p><p id="6dad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[2]https://stmorse.github.io/journal/Elo.html<a class="ae mb" href="https://stmorse.github.io/journal/Elo.html" rel="noopener ugc nofollow" target="_blank"/></p><p id="8588" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[3]<a class="ae mb" href="https://en.wikipedia.org/wiki/Elo_rating_system" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Elo_rating_system</a></p></div></div>    
</body>
</html>