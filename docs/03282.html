<html>
<head>
<title>Use S3 bucket with API Gateway Proxy integration to return binary files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用S3桶与API网关代理集成来返回二进制文件</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/use-s3-bucket-with-api-gateway-proxy-integration-to-return-binary-files-29740ea75d62?source=collection_archive---------0-----------------------#2021-06-05">https://medium.com/geekculture/use-s3-bucket-with-api-gateway-proxy-integration-to-return-binary-files-29740ea75d62?source=collection_archive---------0-----------------------#2021-06-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="adce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看如何使用带有API网关的S3桶来创建一个REST API，它将基于传递的URI路径返回所有类型的二进制文件。</p><p id="a67b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以通过API网关控制台在Rest API中添加对二进制文件的支持，也可以使用YAML文件。</p><p id="388f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在最后附上了经过测试的YAML代码参考，如果你想通过SAM CLI脚本开发它，可以作为参考。</p><p id="bfe8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是在这里，我们将研究如何通过AWS控制台实现它。</p><p id="828a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">登录AWS控制台，转到API网关服务，并单击create new Rest API。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/9adaa859d58de2b11e212ea083e76c20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*es6AUQUVromyXsNjpgI12A.png"/></div></div></figure><p id="e216" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建API后，根据您的需求创建资源路径，然后设置代理资源，如下所示</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jp"><img src="../Images/2c3e2fe0b6786f6e7b83c64c1f7b32c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-fSO1BBhy3dV9iVwZSE55w.png"/></div></div></figure><p id="3e3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在代理上创建Get方法，并选择服务作为AWS服务。在AWS服务中选择简单存储设备(S3)。HTTP方法作为Get。在路径覆盖中，我们可以添加一个基本S3存储桶基本路径，其中包含我们的文件夹/文件，后跟{proxy}资源，这将确保如果我们尝试访问给定基本路径的文件夹中的文件，它将能够动态访问它。我们将通过这个例子来更好地理解。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jq"><img src="../Images/004fc97f884d9537948e7d51402f3515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W6dQ6-pNKZGpQXWMdQTveA.png"/></div></div></figure><p id="7f1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建S3桶，你可以在你的文件夹中存储不同的文件，如json，jpeg等。我用bucket my-test-bucket-rohan/s3test创建了基本路径，它有两个文件夹属性和static。在属性内部，我们有test.json文件，在静态内部，我们有sample.jpeg文件。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jr"><img src="../Images/0d80e208e8f764f210ad7e3b94a9f99d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HzL31pA_7qcja4yYywjbPg.png"/></div></div></figure><p id="8d46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到API的方法请求，并在请求路径中添加“Proxy ”,因为我们将使用代理资源路径。此外，在HTTP请求头中添加“Content-type ”,它将用于匹配所请求文件的内容类型。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es js"><img src="../Images/3a314f708a82719dc8c22120ae2bf573.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XXuE5mVF9CzU8UwN5tP-hg.png"/></div></div></figure><p id="0878" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到集成请求并映射请求路径和HTTP请求头，如下所示</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jt"><img src="../Images/1f27a7223455dcfc2048f2c64438861a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CTnY5B8KbT4yQdNvFIRysQ.png"/></div></div></figure><p id="786a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到方法响应，并在响应头中添加“Content-Type ”,如下所示</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ju"><img src="../Images/82e60279169f7c16739c33ccd1ca4fc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JC1J7TvjlZLxMT43e0BscA.png"/></div></div></figure><p id="17e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到Integration response，映射“Content-Type”头值，该值将告诉浏览器根据通过代理访问的文件的内容类型显示响应中的文件。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jv"><img src="../Images/f2f78d735a88438d2225c2bc96fcc639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4UMb0sNO-vWnmNBJ2qFUUA.png"/></div></div></figure><p id="2024" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，最后一步是在API中添加二进制媒体类型，如下所示，这将确保支持基于通过API使用的文件的所有内容类型。一些内容类型，如JSON、图像格式等。将在浏览器中呈现，而其他像doc、CSV等。会自动下载。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jw"><img src="../Images/9c0e1f5a849ca383bfcdcda2c47de03f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tajxVwPaoPov86xOYRbWFQ.png"/></div></div></figure><p id="a8ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们最终可以部署API，并使用S3桶文件路径测试它。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jx"><img src="../Images/d7cfa0afffd01311d8e3295e79bee698.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tJA7ibnAnRkEc6K6kCDvoQ.png"/></div></div></figure><p id="01f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">复制基本API路径，并将{proxy+}替换为我们在路径覆盖中给出的基本S3存储桶路径之后的S3文件位置。我们之前创建了bucket并存储了两个不同的文件，让我们尝试调用这些文件并观察行为</p><p id="649f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例1: static/sample.jpeg</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jy"><img src="../Images/4dc7ddce013ee5c522c026b1bdedb213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gNOXjiwigJd9iSv1yTkOrw.png"/></div></div></figure><p id="d5b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例2: properties/test.json</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jz"><img src="../Images/9c2dacf3ba4ec28e584e78e29dcdaa8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GmWm5JRdrKuWiFjq2nkfBw.png"/></div></div></figure><p id="002e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，正如您所见，我们可以在AWS中创建一个REST API，通过S3获取不同的文件数据，这将非常有帮助。我们还可以使用AWS提供的不同服务来认证API。</p><p id="930c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要通过YAML进行配置并通过SAM CLI脚本进行部署，请参考代码:<a class="ae ka" href="https://github.com/Rohan009/aws_s3_api_binary_files" rel="noopener ugc nofollow" target="_blank">https://github.com/Rohan009/aws_s3_api_binary_files</a></p></div></div>    
</body>
</html>