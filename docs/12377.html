<html>
<head>
<title>Custom Directives in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度中的自定义指令</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/custom-directives-in-angular-251080ef2b85?source=collection_archive---------2-----------------------#2022-05-10">https://medium.com/geekculture/custom-directives-in-angular-251080ef2b85?source=collection_archive---------2-----------------------#2022-05-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3403" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">用Angular编写自定义指令</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/c2119bcb47fbc25b5c775a9b59d0dfe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iJXWIUpnZfSMltda.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Angular custom directives</figcaption></figure><p id="2e8e" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在我们继续用Angular编写自定义指令之前，您必须对内置指令有一个基本的了解。查看这篇关于内置指令的文章。</p><p id="42ae" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">一旦你完成了内置指令，现在让我们试着理解两个术语:<strong class="jp hj"> HostListener </strong>和<strong class="jp hj"> HostBinding </strong>，它们将在创建我们自己的属性指令时使用。</p><p id="d92f" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj">主机监听器</strong></p><p id="381f" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在Angular中，<strong class="jp hj"> @HostListener() </strong>函数decorator允许你在directive类中处理host元素的事件。</p><p id="f150" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">让我们考虑以下需求:当您单击一个主机元素时，您希望显示一个警告窗口。为此，您需要处理在directive类中的host元素上引发的事件。在Angular中，可以使用<strong class="jp hj"> @HostListener() </strong>来实现。</p><p id="524a" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj">主机绑定</strong></p><p id="2bd9" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在Angular中，<strong class="jp hj"> @HostBinding() </strong>函数decorator允许您从指令类中设置主机元素的属性。</p><p id="b8a8" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">假设您想要更改样式属性，如高度、宽度、颜色、边距、边框等。或指令类中宿主元素的任何其他内部属性。这里，您需要使用@HostBinding() decorator函数来访问主机元素上的这些属性，并在指令类中为其赋值。</p><p id="7893" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">@HostBinding() decorator接受一个参数，即我们希望在指令中赋值的主机元素属性的名称。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h2 id="da65" class="kr ks hi bd kt ku kv kw kx ky kz la lb jw lc ld le ka lf lg lh ke li lj lk ll bi translated"><strong class="ak">自定义属性指令</strong></h2><p id="3f1a" class="pw-post-body-paragraph jn jo hi jp b jq lm ij js jt ln im jv jw lo jy jz ka lp kc kd ke lq kg kh ki hb bi translated">要创建自定义属性指令，您需要添加一个带有指令装饰器的类，它可以从@angular/core导入，并为它提供一个选择器，以便在整个应用程序中唯一地使用该指令。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lr"><img src="../Images/205a2d6a996324f06ce3cbad002d8e75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SInmeU8wQleSNf7zCMFg2w.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">The Directive which handles toggling of a dropdown</figcaption></figure><p id="93c8" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">正如你在上面的代码中看到的，我把我的指令放在一个单独的共享文件夹中(但是你可以把它放在你的应用程序中的任何地方),并把它命名为dropdown.directive.ts</p><p id="92b3" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">此外，我使用了一个属性选择器作为[app-dropdown],因为我将把它作为一个属性添加到我的下拉按钮中。</p><p id="9fa6" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">HostBinding将我们的指令[app-dropdown]与open class属性绑定，其中该属性将根据提供给isOpen的值动态变化。</p><p id="394f" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">当用户单击放置指令的元素时，HostListener将侦听(click)事件并调用toggleDropdown()方法。在我们的代码中，我们只是将open class属性切换为true和false，从而打开和关闭我们的下拉列表。</p><p id="2f7f" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><em class="ls">现在，为了在我们的应用程序中使用它</em> <em class="ls">，我们需要让Angular知道我们已经添加了一个自定义指令。我们在包含组件和指令声明的声明数组内的app.module.ts中声明类DropdownDirective。</em></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lt"><img src="../Images/f91158a15cd58d714bc8dd891a8b5375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FsEGnvaIecAjBldaQkkQNg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">code showing placing of custom directive</figcaption></figure><p id="cc65" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果您运行您的应用程序并单击下拉按钮，它将打开和关闭下拉菜单。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h2 id="ba72" class="kr ks hi bd kt ku kv kw kx ky kz la lb jw lc ld le ka lf lg lh ke li lj lk ll bi translated"><strong class="ak">自定义结构指令</strong></h2><p id="79df" class="pw-post-body-paragraph jn jo hi jp b jq lm ij js jt ln im jv jw lo jy jz ka lp kc kd ke lq kg kh ki hb bi translated">结构指令负责HTML布局。我们可以动态地在DOM布局中添加和删除元素。使用该指令的HTML元素称为该指令的宿主元素。指令只对宿主元素及其后代有效。为了在DOM布局中添加和删除主机元素，我们可以在结构指令中使用<code class="du lu lv lw lx b">TemplateRef</code>和<code class="du lu lv lw lx b">ViewContainerRef</code>类。</p><p id="6b79" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">让我们试着用一个例子来理解它:</p><p id="6a28" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们将创建一个按钮，为我们切换隐藏和显示标题。现在我们可以直接在。ts类，然后使用内置的ngIf结构指令来处理这个问题。但是让我们看看如何通过编写我们自己的结构指令来实现它。</p><p id="37df" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">首先，在中创建属性。ts类，并编写按钮的(click)事件的逻辑。请参考下面的代码快照:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ly"><img src="../Images/befc136d184dcced30e5b5eaefef6baa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x-K258Zjh_8JQ6b9McVqaA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">AppComponent code</figcaption></figure><p id="dc66" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们将用于隐藏或显示数据的showContent属性。我们将绑定按钮的(click)事件，用于在模板HTML中进行切换。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lz"><img src="../Images/7d3b4453637891613785f26fbe1e8ec9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y0tDmi9GzNUczKIfMQi9cQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">AppComponent template HTML code</figcaption></figure><p id="32af" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们可以在*或ng-template中使用结构指令。在我的例子中，我将使用ng-template(如上面代码中突出显示的)。</p><p id="7ff3" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我的开始和结束<ng-template>标签都有一个div容器，其中放置了标题，我们想用按钮-&gt; Toggle来切换以查看/隐藏内容。</ng-template></p><p id="f108" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在你被下面的逻辑弄糊涂之前</p><pre class="iy iz ja jb fd ma lx mb mc aw md bi"><span id="9f56" class="kr ks hi lx b fi me mf l mg mh">&lt;ng-template [appContent]="showContent"&gt;</span></pre><p id="8f36" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">被放置在ng-template标签中，让我们首先跳到我们的自定义结构指令，然后回来，希望事情会被清除。</p><p id="8998" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我创建了一个名为ContentDirective的自定义指令。正如在上面的自定义属性指令中所看到的，我们同样将指令decorator放在ContentDirective的类上，并为它提供一个唯一的选择器。</p><p id="459a" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在创建一个用<code class="du lu lv lw lx b">@Input()</code>装饰的setter方法。</p><p id="2b60" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj"> <em class="ls">注意:</em> </strong> <em class="ls">我们需要注意的是方法名应该和指令名相同。</em></p><p id="6bcc" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">该方法将condition作为一个参数，我们可以在其上放置IF逻辑并相应地呈现内容。请参考下面的代码截图。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/afafe538e3d299672cb1fe56581f09f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XORcGJ2xZyVFA7cqbrObnQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">ContentDirective code</figcaption></figure><p id="f821" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">要改变DOM布局，我们应该在结构指令中使用<code class="du lu lv lw lx b">TemplateRef</code>和<code class="du lu lv lw lx b">ViewContainerRef</code>。<br/> <strong class="jp hj"> TemplateRef </strong>:表示一个嵌入式模板，可以用来实例化嵌入式视图。<br/> <strong class="jp hj"> ViewContainerRef </strong>:表示一个容器，可以附加一个或多个视图。</p><p id="87af" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">要在我们的指令中使用上面的类，首先，我们需要实例化它们。在构造函数中使用依赖注入来实例化这些类，如下所示。</p><pre class="iy iz ja jb fd ma lx mb mc aw md bi"><span id="02c8" class="kr ks hi lx b fi me mf l mg mh">constructor( private templateRef: TemplateRef&lt;any&gt;,<br/>             private viewContainer: ViewContainerRef) { }</span></pre><p id="55e3" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">要在DOM布局中添加一个主机元素，我们需要调用<code class="du lu lv lw lx b">createEmbeddedView()</code>的一个方法<code class="du lu lv lw lx b">ViewContainerRef</code>。找到代码行。</p><pre class="iy iz ja jb fd ma lx mb mc aw md bi"><span id="96e0" class="kr ks hi lx b fi me mf l mg mh">this.viewContainer.createEmbeddedView(this.templateRef);</span></pre><p id="2039" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果我们想清除视图容器，调用下面给出的<code class="du lu lv lw lx b">ViewContainerRef</code>的<code class="du lu lv lw lx b">clear()</code>方法。</p><pre class="iy iz ja jb fd ma lx mb mc aw md bi"><span id="af45" class="kr ks hi lx b fi me mf l mg mh">this.viewContainer.clear();</span></pre><p id="1d33" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">为了让Angular知道我们的自定义指令，我们必须在声明中声明它以及AppModule文件中的组件(如下面的代码所示)。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mj"><img src="../Images/b68fe5b1e9140818926b563aeca5314d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FjGdhYABZDkVutcei-YB0g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Directive declared in AppModule file</figcaption></figure><p id="f6a0" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">让我们回到<ng-template>标签，我们在标签中放置了一些逻辑:</ng-template></p><pre class="iy iz ja jb fd ma lx mb mc aw md bi"><span id="680c" class="kr ks hi lx b fi me mf l mg mh">&lt;ng-template [appContent]="showContent"&gt;</span></pre><p id="3525" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这里[appContent]是我们的自定义指令选择器，<strong class="jp hj"> showContent </strong>是到达方法参数-条件中的指令的被传递的属性。</p><p id="ac8f" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">一旦你完成了所有这些，使用ng serve运行应用程序，切换按钮，你可以看到你的模板的隐藏/显示。</p></div></div>    
</body>
</html>