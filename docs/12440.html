<html>
<head>
<title>Setup OpenCV-DNN module with CUDA backend support (For Windows)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CUDA后端支持设置OpenCV-DNN模块(适用于Windows)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/setup-opencv-dnn-module-with-cuda-backend-support-for-windows-7f1856691da3?source=collection_archive---------2-----------------------#2022-05-13">https://medium.com/geekculture/setup-opencv-dnn-module-with-cuda-backend-support-for-windows-7f1856691da3?source=collection_archive---------2-----------------------#2022-05-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/46de4b4a323f80123cd9681be2b974a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c3Ze4If3NgMNx0x0Wa1Qnw.png"/></div></div></figure><h1 id="783d" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">在本教程中，我们将使用CUDA后端支持从源代码构建OpenCV(OpenCV-DNN-CUDA模块)。</h1><p id="1e57" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated"><strong class="jq hj">重要:</strong>OpenCV-DNN-CUDA模块只支持推理。因此，虽然你会从中获得更快的推断，但是训练将与我们在没有CUDA后端支持的情况下设置的OpenCV相同。</p><h1 id="ea8d" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">步伐</h1><p id="5ff6" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">1.安装CUDA &amp; cuDNN。</p><p id="252f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">2.安装CMake GUI。</p><p id="fda2" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">3.安装Anaconda个人版。</p><p id="afd5" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">4.安装带有“C++桌面开发”模块的Visual Studio。</p><p id="8e4a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">5.在Anaconda中创建一个虚拟环境</p><p id="651b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">6.为你的NVidia GPU从源代码构建OpenCV。</p></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h1 id="14d0" class="iq ir hi bd is it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn bi translated">我在YouTube上的视频！</h1><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="lh li l"/></div></figure></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h2 id="037f" class="lj ir hi bd is lk ll lm iw ln lo lp ja jz lq lr je kd ls lt ji kh lu lv jm lw bi translated">步骤1)安装CUDA和cuDNN</h2><p id="3c9e" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">为您的系统下载最新版本的CUDA及其相应的cuDNN档案。去https://developer.nvidia.com/cuda-downloads<a class="ae lx" href="https://developer.nvidia.com/cuda-downloads" rel="noopener ugc nofollow" target="_blank">下载最新的CUDA工具包。你也可以从</a><a class="ae lx" href="https://developer.nvidia.com/cuda-toolkit-archive" rel="noopener ugc nofollow" target="_blank">以前的CUDA版本档案库</a>下载以前的版本，或者在上面给出的cuda-downloads链接的参考资料部分下载。你可以从https://developer.nvidia.com/cudnn<a class="ae lx" href="https://developer.nvidia.com/cudnn" rel="noopener ugc nofollow" target="_blank">下载cuDNN的最新版本。你也可以从https://developer.nvidia.com/rdp/cudnn-archive</a><a class="ae lx" href="https://developer.nvidia.com/rdp/cudnn-archive" rel="noopener ugc nofollow" target="_blank">的cudnn档案馆下载以前的版本。</a></p><p id="48d0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">通过运行CUDA exe文件安装CUDA，然后将cuDNN文件夹及其内容解压并复制到我们安装CUDA的位置。通常，这是在C:\ Program Files \ NVIDIA GPU Computing Toolkit \ CUDA \ v11 . x中。系统还会自动将此路径添加到环境变量中，作为CUDA_PATH。我们需要为CMake GUI的Path变量添加一些路径来查找cuDNN。点击阅读完整的<a class="ae lx" href="https://techzizou.com/?p=424" rel="noopener ugc nofollow" target="_blank"> CUDA &amp; cuDNN安装。</a></p><p id="8fd6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">注意:</strong>正如上面CUDA &amp; cuDNN设置博客中提到的，您必须为<strong class="jq hj"> Path </strong>系统变量添加与您为<strong class="jq hj"> CUDNN </strong>系统变量添加的路径相同的路径。添加这些路径后，重新启动系统。这只是为了确保我们将要使用的CMake GUI软件能够在我们的系统上找到cuDNN。</p></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h2 id="8429" class="lj ir hi bd is lk ll lm iw ln lo lp ja jz lq lr je kd ls lt ji kh lu lv jm lw bi translated">步骤2)安装CMake GUI</h2><p id="b5b4" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">接下来，我们需要为Windows安装CMake GUI。(给出链接)<a class="ae lx" href="https://cmake.org/download/" rel="noopener ugc nofollow" target="_blank">https://cmake.org/download/</a></p><p id="d40c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">为您的系统选择安装程序。我用的是Windows (64位)。下载安装程序，运行并安装它。另外，<strong class="jq hj">在安装过程中将其添加到您的路径中。</strong></p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/acbd34c3ff61a53ff490b9d2518124eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Wsb4JOkSCn7QidKQ.png"/></div></div></figure><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/a579e6a03632f4ced93b6146864b32db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2BBKXlgIin0TIXpb.png"/></div></div></figure></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h2 id="28c8" class="lj ir hi bd is lk ll lm iw ln lo lp ja jz lq lr je kd ls lt ji kh lu lv jm lw bi translated">步骤3)安装Anaconda Windows个人版</h2><ul class=""><li id="3099" class="lz ma hi jq b jr js jv jw jz mb kd mc kh md kl me mf mg mh bi translated">从<a class="ae lx" href="https://www.anaconda.com/products/individual" rel="noopener ugc nofollow" target="_blank">这里</a>下载并运行Anaconda安装程序。</li><li id="09c0" class="lz ma hi jq b jr mi jv mj jz mk kd ml kh mm kl me mf mg mh bi translated">安装Anaconda时选择“<em class="mn">只是我</em>”选项，以避免任何管理权限问题。</li><li id="624f" class="lz ma hi jq b jr mi jv mj jz mk kd ml kh mm kl me mf mg mh bi translated">选择将Anaconda python作为默认选项的选项，并选择将Anaconda python包含在PATH变量中的其他选项。这确保了Anaconda python首先在系统中被发现。您总是可以通过转到您的环境变量并将您想要作为默认设置的python移动到Anaconda python之上来改变这一点。</li></ul><p id="77bf" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi">.</p></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h2 id="4711" class="lj ir hi bd is lk ll lm iw ln lo lp ja jz lq lr je kd ls lt ji kh lu lv jm lw bi translated">步骤4)安装MSVC(微软Visual Studio)</h2><p id="f401" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">去MSVC:<a class="ae lx" href="https://visualstudio.microsoft.com/thank-you-downloading-visual-studio/?sku=Community" rel="noopener ugc nofollow" target="_blank">https://visual studio . Microsoft . com/thank-you-downloading-visual-studio/？sku =社区</a>。这将为您下载MSVC社区版安装程序exe文件。运行它。选择如下所示的“<em class="mn">使用C++ </em>进行桌面开发”包，然后点击安装。如果您已经有另一个版本的visual studio，如visual studio professional或enterprise，请确保安装了上述模块。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/463513233a91d5a0301581518c65ac31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*O_-hlSEYwq9vWEAz.png"/></div></div></figure></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h2 id="0c07" class="lj ir hi bd is lk ll lm iw ln lo lp ja jz lq lr je kd ls lt ji kh lu lv jm lw bi translated">步骤5)在Anaconda中创建一个虚拟环境</h2><p id="574c" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated"><strong class="jq hj">注意:我在为虚拟环境构建OpenCV时执行了这一步。如果您想构建您的基础环境，您可以跳过这一步，转到步骤6。</strong></p><p id="558c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">●首先，打开Anaconda提示符并运行以下命令来创建一个新的Anaconda环境。</p><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="470f" class="lj ir hi mp b fi mt mu l mv mw"><strong class="mp hj">conda create -n env_NAME</strong> <strong class="mp hj">python=3.9</strong></span></pre><p id="0596" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">(其中<strong class="jq hj"> env_NAME </strong>是您想要创建的环境的名称。我正在设置python=3.9)</p><ul class=""><li id="3c0c" class="lz ma hi jq b jr km jv kn jz mx kd my kh mz kl me mf mg mh bi translated">要激活环境，请使用以下命令:</li></ul><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="42ef" class="lj ir hi mp b fi mt mu l mv mw"><strong class="mp hj">conda activate env_NAME</strong></span></pre><ul class=""><li id="ddb6" class="lz ma hi jq b jr km jv kn jz mx kd my kh mz kl me mf mg mh bi translated">为此环境安装NumPy</li></ul><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="85d0" class="lj ir hi mp b fi mt mu l mv mw"><strong class="mp hj">pip install numpy</strong><br/>#OR<br/><strong class="mp hj">pip install --upgrade numpy</strong></span></pre></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h1 id="e9fa" class="iq ir hi bd is it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn bi translated">第6步)最后，使用CUDA后端支持为您的特定NVidia GPU从源代码构建OpenCV。</h1><p id="4586" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">这是设置OpenCV-DNN-CUDA模块的主要步骤，即在CUDA后端支持下从源代码构建OpenCV。这给了我们对象检测模型更快的推断。我们将在这里安装一些库。</p><p id="3096" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">重要提示:</strong>在我们开始之前，如果您正在为您的基础环境创建它，请确保使用<em class="mn"> pip install numpy </em>安装NumPy。否则，如果您在虚拟环境中这样做，我们已经在步骤5中安装了numpy。</p><p id="3b88" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) a) </strong>首先下载<strong class="jq hj"> OpenCV </strong>和<strong class="jq hj"> opencv_contrib </strong>。</p><p id="9170" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">从官方OpenCV发布页面或GitHub页面下载最新的OpenCV源文件。<strong class="jq hj">接下来</strong>，<strong class="jq hj">下载opencv_contrib的确切版本，作为你下载的opencv源文件</strong>。使用以下链接下载这两个文件。(目前最新的OpenCV版本是4.5.5)</p><p id="d753" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">https://opencv.org/releases/</p><p id="6e1a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">https://github.com/opencv/opencv_contrib</p><p id="0e37" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">注意:</strong>对两个opencv &amp; opencv_contrib使用相同的版本。要选择特定版本，点击左上方的主下拉菜单，点击<strong class="jq hj">标签、</strong>并选择版本。</p><p id="e9e5" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) b) </strong>在c盘新建一个文件夹，名为<strong class="jq hj"> <em class="mn"> opencv </em> </strong>。将上一步中的文件夹解压并复制到<strong class="jq hj"> <em class="mn"> C:\opencv </em> </strong>文件夹中。</p><p id="4ce0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) c) </strong>在<strong class="jq hj"> <em class="mn"> C:\opencv </em> </strong>内创建另一个名为<strong class="jq hj"> <em class="mn"> build </em> </strong>的文件夹</p><p id="d32e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">注意:</strong>在运行CMake之前，您需要在您的系统上安装并配置CUDA、cuDNN。参考<a class="ae lx" href="https://techzizou.com/?p=424" rel="noopener ugc nofollow" target="_blank">这篇博客</a>学习如何在Windows上安装和设置CUDA和CUDNN。</p><p id="7c65" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) d) </strong>打开<strong class="jq hj"> CMake GUI </strong>。选择源文件为<strong class="jq hj"><em class="mn">C:\ opencv \ opencv-4 . 5 . 5</em></strong>，选择编译二进制文件的目的文件为<strong class="jq hj"> <em class="mn"> C:\opencv\build。</em>T49】</strong></p><p id="0679" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) e) </strong>勾选<strong class="jq hj">分组</strong>条目框，点击<strong class="jq hj">配置</strong>。将此项目的生成器<strong class="jq hj">设置为您的Visual Studio版本。我有2017所以我会设置<strong class="jq hj"> Visual Studio 15 2017 </strong>。最后，选择“<strong class="jq hj">发电机可选平台</strong>为<strong class="jq hj"> x64。</strong></strong></p><p id="eaba" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) f) </strong>第一次配置完成后，通过在搜索框中键入并勾选相应的框来选择以下模块。</p><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="dfd2" class="lj ir hi mp b fi mt mu l mv mw"><strong class="mp hj">WITH_CUDA</strong></span><span id="6586" class="lj ir hi mp b fi na mu l mv mw"><strong class="mp hj">OPENCV_DNN_CUDA</strong></span><span id="d34a" class="lj ir hi mp b fi na mu l mv mw"><strong class="mp hj">ENABLE_FAST_MATH</strong></span><span id="c412" class="lj ir hi mp b fi na mu l mv mw"><strong class="mp hj">BUILD_opencv_world</strong></span><span id="413a" class="lj ir hi mp b fi na mu l mv mw"><strong class="mp hj">BUILD_opencv_dnn</strong></span><span id="85f7" class="lj ir hi mp b fi na mu l mv mw"><strong class="mp hj">BUILD_opencv_python3</strong></span></pre><p id="a938" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">(默认情况下，通常会选择其中一些，但请仔细检查它们，因为它们很重要)</p><p id="586b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) g) </strong>接下来键入以下内容，并将路径设置为我们在步骤6)b)中提取的<strong class="jq hj"><em class="mn">opencv _ contrib</em></strong>文件夹内的<strong class="jq hj"> <em class="mn"> modules </em> </strong>文件夹。</p><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="24b0" class="lj ir hi mp b fi mt mu l mv mw"><strong class="mp hj">OPENCV_EXTRA_MODULES_PATH</strong></span></pre><p id="e9bc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">给出路径→<strong class="jq hj"><em class="mn">C:\ opencv \ opencv _ contrib-4 . 5 . 5 \ modules</em></strong></p><p id="9088" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) h) </strong>接下来，只有在为我们在第5步中创建的虚拟环境构建OpenCV时，才执行这一步。如果没有，您可以跳到步骤6) i)。我这样做是因为我正在我的虚拟环境中安装OpenCV。</p><p id="e450" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在搜索框中输入<strong class="jq hj"> PYTHON3 </strong>。如果您已经将anaconda设置为默认python，您将看到以下所有python3路径条目指向基本anaconda环境中的库，否则，如果这是您的默认python，您将看到windows python基本环境库。</p><p id="1e6a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们需要将它们设置为指向相同类型的虚拟环境库。(<strong class="jq hj">注意</strong>:这是我们在第5步中在Anaconda提示符下创建的虚拟环境<em class="mn"> env_NAME </em>。同样，这里我的Anaconda位置是<em class="mn"> C:\anaconda3 </em>。你的可能不同，例如:in<em class="mn">C:\ Program Data \ anaconda 3</em>等。)</p><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="b1db" class="lj ir hi mp b fi mt mu l mv mw"><strong class="mp hj">PYTHON3_EXECUTABLE</strong></span></pre><p id="3108" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">更改C:\anaconda3\python.exe →</p><p id="4dbc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">到C:\ anaconda3 \ envs \ env _ NAME \ python . exe</p><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="6bdc" class="lj ir hi mp b fi mt mu l mv mw"><strong class="mp hj">PYTHON3_INCLUDE_DIR</strong></span></pre><p id="fee2" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">更改C:\anaconda3\include →</p><p id="e1b8" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">到C:\ anaconda3 \ envs \ env _ NAME \ include</p><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="c21e" class="lj ir hi mp b fi mt mu l mv mw"><strong class="mp hj">PYTHON3_LIBRARY</strong></span></pre><p id="ae5e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">更改C:\ anaconda3 \ libs \ python 39 . lib→</p><p id="ea70" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">到C:\ anaconda 3 \ envs \ env _ NAME \ libs \ python 39 . lib</p><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="200e" class="lj ir hi mp b fi mt mu l mv mw"><strong class="mp hj">PYTHON3_NUMPY_INCLUDE_DIRS</strong></span></pre><p id="6246" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">更改C:/anaconda 3/Lib/site-packages/numpy/core/include→</p><p id="bddc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">到C:/anaconda 3/envs/env _ NAME/Lib/site-packages/numpy/core/include</p><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="1edc" class="lj ir hi mp b fi mt mu l mv mw"><strong class="mp hj">PYTHON3_PACKAGES_PATH</strong></span></pre><p id="daa2" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">更改C:/anaconda 3/Lib/site-packages→</p><p id="27f7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">到C:/anaconda 3/envs/env _ NAME/Lib/site-packages</p><p id="5dfc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) i) </strong>再次点击<strong class="jq hj">配置</strong>。</p><p id="4ef7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) j) </strong>一旦第二个配置完成，你会在输出中看到你的CUDA和cuDNN。现在，通过在搜索框中键入并勾选复选框来选择以下内容。</p><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="6313" class="lj ir hi mp b fi mt mu l mv mw"><strong class="mp hj">CUDA_FAST_MATH</strong></span></pre><p id="ed4d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) k) </strong>接下来，将你的GPU的计算能力设置为CUDA_ARCH_BIN。(你可以点击这个链接查看你的GPU的cc→<a class="ae lx" href="https://developer.nvidia.com/cuda-gpus" rel="noopener ugc nofollow" target="_blank">https://developer.nvidia.com/cuda-gpus</a>。转到此链接并选择您的GPU部分。例如:我有一个GeForce GPU，因此我将选择“支持CUDA的GeForce和TITAN产品”部分。这将显示所有GPU及其计算能力的下拉列表。我的是6.1)</p><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="6c28" class="lj ir hi mp b fi mt mu l mv mw"><strong class="mp hj">CUDA_ARCH_BIN 6.1</strong></span></pre><p id="b42e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) l) </strong>查找CMAKE_CONFIGURATION_TYPES。删除调试选项，只设置发布选项。</p><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="c15e" class="lj ir hi mp b fi mt mu l mv mw"><strong class="mp hj">CMAKE_CONFIGURATION_TYPES       Release</strong></span></pre><p id="2024" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) m) </strong>最后一次配置。</p><p id="83b3" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) n) </strong>第三个也是最后一个配置完成后，验证所有输出，最后点击<strong class="jq hj">生成。</strong>这个<strong class="jq hj"> </strong>用这些设置生成项目，我们可以用它来构建我们的OpenCV。</p><p id="31bf" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) o) </strong>接下来，一旦生成完成。在<strong class="jq hj"> C:\opencv </strong>目录中打开命令提示符，并运行以下命令。</p><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="26b9" class="lj ir hi mp b fi mt mu l mv mw"><strong class="mp hj">"C:\Program Files\CMake\bin\cmake.exe" --build "C:\opencv\build" --target INSTALL --config Release</strong></span></pre><p id="052c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这将使用CUDA后端构建OpenCV-DNN模块。这个过程可能需要一个小时左右。</p><p id="f71f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">● <strong class="jq hj"> 6) p) </strong>最后，在您的环境变量中设置以下路径，并重新启动您的系统。</p><p id="6f9d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在系统变量中设置一个新变量<strong class="jq hj"> OpenCV_DIR </strong>指向下面三个。→</p><ul class=""><li id="6e8e" class="lz ma hi jq b jr km jv kn jz mx kd my kh mz kl me mf mg mh bi translated">‣c:\ opencv \ build \ install \ x64 \ vc15 \ bin</li><li id="d43f" class="lz ma hi jq b jr mi jv mj jz mk kd ml kh mm kl me mf mg mh bi translated">‣c:\ opencv \ build \ install \ x64 \ vc15 \ lib</li><li id="7a49" class="lz ma hi jq b jr mi jv mj jz mk kd ml kh mm kl me mf mg mh bi translated">‣ C:\opencv\build</li></ul><p id="1eff" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">另外，将以下路径添加到系统变量中的<strong class="jq hj">路径</strong>变量中。→</p><ul class=""><li id="1a12" class="lz ma hi jq b jr km jv kn jz mx kd my kh mz kl me mf mg mh bi translated">‣c:\ opencv \ build \ install \ x64 \ vc15 \ bin</li></ul><p id="c19d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">添加路径后，重新启动系统。</p><p id="4c8b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">就是这样！我们已经在CUDA后端支持下成功构建了OpenCV-DNN模块。</p></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><p id="b324" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">检查cv2是否安装正确。在Anaconda提示符下运行以下命令:</p><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="a519" class="lj ir hi mp b fi mt mu l mv mw">conda activate opencv_dnn_cuda<br/>python</span><span id="aa2b" class="lj ir hi mp b fi na mu l mv mw">Python 3.9.7 (main, Apr  4 2022, 05:22:27) [MSC v.1916 64 bit (AMD64)] :: Anaconda, Inc. on win32<br/>Type "help", "copyright", "credits" or "license" for more information.<br/>&gt;&gt;&gt; import cv2<br/>&gt;&gt;&gt; cv2.__version__<br/>'4.5.5'<br/>&gt;&gt;&gt;</span></pre></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h1 id="6f5d" class="iq ir hi bd is it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn bi translated">使用下面的test_DNN_CV.py脚本检查OpenCV是否正确安装了CUDA后端支持。</h1><pre class="ld le lf lg fd mo mp mq mr aw ms bi"><span id="c23a" class="lj ir hi mp b fi mt mu l mv mw">import numpy as np<br/>import cv2 as cv<br/>import time</span><span id="6f1e" class="lj ir hi mp b fi na mu l mv mw">npTmp = np.random.random((1024, 1024)).astype(np.float32)</span><span id="b9b8" class="lj ir hi mp b fi na mu l mv mw">npMat1 = np.stack([npTmp,npTmp],axis=2)<br/>npMat2 = npMat1</span><span id="81d9" class="lj ir hi mp b fi na mu l mv mw">cuMat1 = cv.cuda_GpuMat()<br/>cuMat2 = cv.cuda_GpuMat()<br/>cuMat1.upload(npMat1)<br/>cuMat2.upload(npMat2)</span><span id="c62c" class="lj ir hi mp b fi na mu l mv mw">start_time = time.time()<br/>cv.cuda.gemm(cuMat1, cuMat2,1,None,0,None,1)</span><span id="a307" class="lj ir hi mp b fi na mu l mv mw">print("CUDA using GPU --- %s seconds ---" % (time.time() - start_time))</span><span id="48b8" class="lj ir hi mp b fi na mu l mv mw">start_time = time.time()<br/>cv.gemm(npMat1,npMat2,1,None,0,None,1)</span><span id="ea64" class="lj ir hi mp b fi na mu l mv mw">print("CPU --- %s seconds ---" % (time.time() - start_time))</span></pre><h2 id="e22e" class="lj ir hi bd is lk ll lm iw ln lo lp ja jz lq lr je kd ls lt ji kh lu lv jm lw bi translated">下载下面的脚本来测试OpenCV-DNN。</h2><p id="c3d7" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated"><a class="ae lx" href="https://techzizou.com/setup-opencv-dnn-cuda-module-for-windows/#test_dnn_cv" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">下载测试_DNN_CV.py </strong> </a></p></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h1 id="8c70" class="iq ir hi bd is it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn bi translated">下一个教程:</h1><h2 id="8af4" class="lj ir hi bd is lk ll lm iw ln lo lp ja jz lq lr je kd ls lt ji kh lu lv jm lw bi translated">在Windows上使用OpenCV-DNN模块运行YOLOv4推理</h2><div class="nb nc ez fb nd ne"><a rel="noopener follow" target="_blank" href="/geekculture/yolov4-inference-using-opencv-dnn-cuda-on-windows-e7ca995bcacd"><div class="nf ab dw"><div class="ng ab nh cl cj ni"><h2 class="bd hj fi z dy nj ea eb nk ed ef hh bi translated">Windows环境下基于OpenCV-DNN-CUDA的YOLOv4推理</h2><div class="nl l"><h3 class="bd b fi z dy nj ea eb nk ed ef dx translated">在Windows上使用OpenCV-DNN-CUDA模块运行YOLOv4推理。</h3></div><div class="nm l"><p class="bd b fp z dy nj ea eb nk ed ef dx translated">medium.com</p></div></div><div class="nn l"><div class="no l np nq nr nn ns io ne"/></div></div></a></div></div><div class="ab cl kr ks gp kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="hb hc hd he hf"><h2 id="2d94" class="lj ir hi bd is lk ll lm iw ln lo lp ja jz lq lr je kd ls lt ji kh lu lv jm lw bi translated">别忘了留下👏</h2><h2 id="c756" class="lj ir hi bd is lk ll lm iw ln lo lp ja jz lq lr je kd ls lt ji kh lu lv jm lw bi translated">祝您愉快！！！✌</h2><h1 id="363d" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">♕·特奇佐·♕</h1></div></div>    
</body>
</html>