<html>
<head>
<title>PostgreSQL, Rails, and macOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PostgreSQL、Rails和macOS</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/postgresql-rails-and-macos-16248ddcc8ba?source=collection_archive---------7-----------------------#2021-06-14">https://medium.com/geekculture/postgresql-rails-and-macos-16248ddcc8ba?source=collection_archive---------7-----------------------#2021-06-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="f5f2" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">命令行安装教程</h2><div class=""/><div class=""><h2 id="b2b7" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">如何在Rails项目中安装和部署本地Postgres服务器</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/804967fcc41d241d166e246515b10151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hcKZe4hkZyfRbDcQlEgogw.jpeg"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Photo by <a class="ae jw" href="https://unsplash.com/@jankolar?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Jan Antonin Kolar</a> on <a class="ae jw" href="https://unsplash.com/s/photos/database?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a72b" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">Rails安装的默认数据库框架是<code class="du kt ku kv kw b">sqlite3</code>。顾名思义，它是一个轻量级的基于SQL的数据库系统，开箱即用。不幸的是，Heroku不支持这个框架，它需要你的代码利用Postgres来运行。我认为建立一个本地Postgres服务器来熟悉这个框架是个好主意。</p><h1 id="57ae" class="kx ky hi bd kz la lb lc ld le lf lg lh ix li iy lj ja lk jb ll jd lm je ln lo bi translated">Postgres安装和设置</h1><p id="4071" class="pw-post-body-paragraph jx jy hi jz b ka lp is kc kd lq iv kf kg lr ki kj kk ls km kn ko lt kq kr ks hb bi translated">安装和管理Postgres有多种选择。Postgres.app 是一个GUI，它还会为您下载并初始化一个Postgres服务器。<a class="ae jw" href="https://www.pgadmin.org/" rel="noopener ugc nofollow" target="_blank"> PgAdmin </a>自动自带<a class="ae jw" href="https://www.postgresql.org/download/" rel="noopener ugc nofollow" target="_blank">Postgres网站</a>提供的安装程序。连接到现有的服务器，提供另一个GUI。</p><p id="9b1a" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">我选择了命令行安装，因为我想尝试一下，了解如何在没有图形用户界面帮助的情况下与一个基本的Postgres服务器进行交互。</p><h2 id="b017" class="lu ky hi bd kz lv lw lx ld ly lz ma lh kg mb mc lj kk md me ll ko mf mg ln ho bi translated"><strong class="ak"> 1。使用</strong> <a class="ae jw" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">自制软件</strong> </a>安装Postgres</h2><pre class="jh ji jj jk fd mh kw mi mj aw mk bi"><span id="dfcc" class="lu ky hi kw b fi ml mm l mn mo">brew install postgresql</span></pre><p id="4652" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">使用Rails和<code class="du kt ku kv kw b">sqlite3</code>，数据库是单独的文件，由ActiveRecord直接生成和管理。Postgres将数据库托管在一个可以打开和关闭的本地服务器上。 你需要自己管理服务器，在连接到Rails之前设置用户和数据库。</p><p id="c7d6" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">家酿启动服务器，并在安装时自动创建一个名为<code class="du kt ku kv kw b">postgres</code>的默认数据库。您可以通过键入<code class="du kt ku kv kw b">brew services list</code>来检查您的服务器状态，这将返回以下输出:</p><pre class="jh ji jj jk fd mh kw mi mj aw mk bi"><span id="125e" class="lu ky hi kw b fi ml mm l mn mo">Name       Status  User          Plist<br/>postgresql started YOUR_USERNAME /Users/YOUR_USERNAME/Library/Launch<br/>Agents/homebrew.mxcl.postgresql.plist<br/>unbound    stopped</span></pre><p id="adf6" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">家酿将初始化一个用户，并给它当前在macOS上登录的任何帐户的用户名<em class="mp">(替换上面例子中的</em><code class="du kt ku kv kw b"><em class="mp">YOUR_USERNAME</em></code><em class="mp">)</em>。</p><p id="5499" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">要启动和停止服务器:</p><pre class="jh ji jj jk fd mh kw mi mj aw mk bi"><span id="bca4" class="lu ky hi kw b fi ml mm l mn mo">brew services start postgresql</span><span id="ae9e" class="lu ky hi kw b fi mq mm l mn mo">brew services stop postgresql</span><span id="d6ba" class="lu ky hi kw b fi mq mm l mn mo"># You can check the status of your server at any time:</span><span id="13a5" class="lu ky hi kw b fi mq mm l mn mo">brew services list</span></pre><h2 id="ad76" class="lu ky hi bd kz lv lw lx ld ly lz ma lh kg mb mc lj kk md me ll ko mf mg ln ho bi translated"><strong class="ak"> 2。利用</strong>和<code class="du kt ku kv kw b"><strong class="ak">psql</strong></code></h2><p id="ceb9" class="pw-post-body-paragraph jx jy hi jz b ka lp is kc kd lq iv kf kg lr ki kj kk ls km kn ko lt kq kr ks hb bi translated">Postgres的自制安装预打包了<code class="du kt ku kv kw b">psql</code>，这是一个用于本地Postgres服务器的命令行界面。要进入<code class="du kt ku kv kw b">psql</code>环境:</p><pre class="jh ji jj jk fd mh kw mi mj aw mk bi"><span id="59fc" class="lu ky hi kw b fi ml mm l mn mo">psql postgres</span></pre><p id="49c0" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><em class="mp">边注:调用</em> <code class="du kt ku kv kw b"><em class="mp">psql</em></code> <em class="mp">时可以使用任何有效数据库的名称。</em> <code class="du kt ku kv kw b"><em class="mp">postgres</em></code> <em class="mp">是家酿初始化的默认数据库，所以我们将用它来启动。</em></p><p id="7b16" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">一些方便的命令可以帮助您随时了解正在发生的事情:</p><pre class="jh ji jj jk fd mh kw mi mj aw mk bi"><span id="0549" class="lu ky hi kw b fi ml mm l mn mo">postgres=# /* Inside of psql environment */</span><span id="8f9a" class="lu ky hi kw b fi mq mm l mn mo">-- list available SQL commands<br/>\help</span><span id="7744" class="lu ky hi kw b fi mq mm l mn mo">-- list backslash commands<br/>\?</span><span id="34ba" class="lu ky hi kw b fi mq mm l mn mo">-- Display current user<br/>SELECT user;</span><span id="d64a" class="lu ky hi kw b fi mq mm l mn mo">-- Display current database<br/>SELECT current_database();</span><span id="e213" class="lu ky hi kw b fi mq mm l mn mo">-- Lists existing databases<br/>\l</span><span id="e218" class="lu ky hi kw b fi mq mm l mn mo">-- Lists users and permissions<br/>\du</span></pre><h2 id="b783" class="lu ky hi bd kz lv lw lx ld ly lz ma lh kg mb mc lj kk md me ll ko mf mg ln ho bi translated">3.创建数据库</h2><pre class="jh ji jj jk fd mh kw mi mj aw mk bi"><span id="e737" class="lu ky hi kw b fi ml mm l mn mo">CREATE DATABASE your_database_name;</span></pre><p id="4b60" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">创建的数据库的所有者将是会话的当前用户。如果愿意，您可以指定不同的所有者，但前提是当前用户拥有必需的权限。</p><pre class="jh ji jj jk fd mh kw mi mj aw mk bi"><span id="01e0" class="lu ky hi kw b fi ml mm l mn mo">-- Create a database and assign its owner<br/>CREATE DATABASE your_database WITH OWNER = different_user;</span></pre><p id="2488" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">确保为您的项目创建两个数据库。一个用于测试环境，一个用于开发。</p><pre class="jh ji jj jk fd mh kw mi mj aw mk bi"><span id="10a1" class="lu ky hi kw b fi ml mm l mn mo">CREATE DATABASE your_database_name_test;</span></pre><h2 id="6626" class="lu ky hi bd kz lv lw lx ld ly lz ma lh kg mb mc lj kk md me ll ko mf mg ln ho bi translated">4.创建用户</h2><pre class="jh ji jj jk fd mh kw mi mj aw mk bi"><span id="0de4" class="lu ky hi kw b fi ml mm l mn mo">-- WITH PASSWORD clause is optional<br/>CREATE USER new_user WITH PASSWORD 'password_goes_here';</span></pre><p id="bd8f" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">如果您愿意，可以让您的新用户成为您创建的新数据库的所有者。</p><pre class="jh ji jj jk fd mh kw mi mj aw mk bi"><span id="b668" class="lu ky hi kw b fi ml mm l mn mo">ALTER DATABASE your_database OWNER = new_user;</span></pre><p id="167b" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">成功！您的Postgres服务器现在应该可以用于您的Rails项目了。</p><h1 id="1dfc" class="kx ky hi bd kz la lb lc ld le lf lg lh ix li iy lj ja lk jb ll jd lm je ln lo bi translated">为Postgres配置Rails</h1><p id="09d3" class="pw-post-body-paragraph jx jy hi jz b ka lp is kc kd lq iv kf kg lr ki kj kk ls km kn ko lt kq kr ks hb bi translated">如果从头开始创建一个新的rails应用程序，只需使用<code class="du kt ku kv kw b">--database</code>标志声明Postgres。这应该能让你大部分时间到达那里。</p><pre class="jh ji jj jk fd mh kw mi mj aw mk bi"><span id="7798" class="lu ky hi kw b fi ml mm l mn mo">rails new myapp --database=postgres</span></pre><h2 id="3fb5" class="lu ky hi bd kz lv lw lx ld ly lz ma lh kg mb mc lj kk md me ll ko mf mg ln ho bi translated">1.红宝石</h2><p id="a6eb" class="pw-post-body-paragraph jx jy hi jz b ka lp is kc kd lq iv kf kg lr ki kj kk ls km kn ko lt kq kr ks hb bi translated">仔细检查以确保你的Gemfile有<code class="du kt ku kv kw b">pg</code>宝石。添加<code class="du kt ku kv kw b">dotenv-rails</code>来帮助处理数据库凭证。</p><pre class="jh ji jj jk fd mh kw mi mj aw mk bi"><span id="3b18" class="lu ky hi kw b fi ml mm l mn mo"># /Gemfile</span><span id="00ca" class="lu ky hi kw b fi mq mm l mn mo">gem 'pg'<br/>gem 'dotenv-rails'</span></pre><p id="fba5" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">继续之前，请务必运行<code class="du kt ku kv kw b">bundle install</code>。</p><h2 id="e38f" class="lu ky hi bd kz lv lw lx ld ly lz ma lh kg mb mc lj kk md me ll ko mf mg ln ho bi translated">2.环境变量</h2><p id="d8f7" class="pw-post-body-paragraph jx jy hi jz b ka lp is kc kd lq iv kf kg lr ki kj kk ls km kn ko lt kq kr ks hb bi translated">使用<code class="du kt ku kv kw b">touch .env</code>创建一个环境文件，一定要在<code class="du kt ku kv kw b">.gitignore</code>中列出，防止被推送到GitHub。然后列出以下信息:</p><pre class="jh ji jj jk fd mh kw mi mj aw mk bi"><span id="831f" class="lu ky hi kw b fi ml mm l mn mo"># ./env</span><span id="4bc2" class="lu ky hi kw b fi mq mm l mn mo">POSTGRES_USER='new_user'</span><span id="a019" class="lu ky hi kw b fi mq mm l mn mo"># If you declared a password when creating the database:<br/>POSTGRES_PASSWORD='password'</span><span id="d4b1" class="lu ky hi kw b fi mq mm l mn mo">POSTGRES_HOST='localhost'</span><span id="b787" class="lu ky hi kw b fi mq mm l mn mo">POSTGRES_DB='your_database_name'</span><span id="4428" class="lu ky hi kw b fi mq mm l mn mo">POSTGRES_TEST_DB='your_database_name_test'</span></pre><h2 id="e64b" class="lu ky hi bd kz lv lw lx ld ly lz ma lh kg mb mc lj kk md me ll ko mf mg ln ho bi translated">3.更新database.yml</h2><p id="e5d1" class="pw-post-body-paragraph jx jy hi jz b ka lp is kc kd lq iv kf kg lr ki kj kk ls km kn ko lt kq kr ks hb bi translated">现在转到<code class="du kt ku kv kw b">config/database.yml</code>并插入您声明的环境变量。</p><pre class="jh ji jj jk fd mh kw mi mj aw mk bi"><span id="1204" class="lu ky hi kw b fi ml mm l mn mo"># config/database.yml</span><span id="8c75" class="lu ky hi kw b fi mq mm l mn mo">default: &amp;default<br/> adapter: postgresql<br/>  encoding: unicode<br/>  username: &lt;%= ENV['POSTGRES_USER'] %&gt;<br/>  password: &lt;%= ENV['POSTGRES_PASSWORD'] %&gt;<br/>  pool: 5<br/>  timeout: 5000<br/>  host: &lt;%= ENV['POSTGRES_HOST'] %&gt;</span><span id="eb37" class="lu ky hi kw b fi mq mm l mn mo">development:<br/>  &lt;&lt;: *default<br/>  database: &lt;%= ENV['POSTGRES_DB'] %&gt;</span><span id="2d25" class="lu ky hi kw b fi mq mm l mn mo">test:<br/>  &lt;&lt;: *default<br/>  database: &lt;%= ENV['POSTGRES_TEST_DB'] %&gt;</span><span id="56e9" class="lu ky hi kw b fi mq mm l mn mo">production:<br/>  &lt;&lt;: *default<br/>  database: &lt;%= ENV['POSTGRES_DB'] %&gt;</span></pre><p id="2020" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">完成最后一步后，您应该准备好像平常一样生成迁移了。<em class="mp">感谢阅读，编码快乐！</em></p></div></div>    
</body>
</html>