<html>
<head>
<title>Getting started with Azure functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure函数入门</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/getting-started-with-azure-functions-19e96257ec0f?source=collection_archive---------9-----------------------#2022-02-26">https://medium.com/geekculture/getting-started-with-azure-functions-19e96257ec0f?source=collection_archive---------9-----------------------#2022-02-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="28da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于企业来说，云的采用越来越普遍。通常，这些企业的工作负载需要偶尔执行代码作为较大数据流的一部分，那么他们对Azure有什么选择呢？输入Azure函数。</p><p id="3cea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博文中，我将介绍Azure函数和无服务器计算，以及如何开发你的第一个函数。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/917e9a2c5696d5ab7a2c78626255d91c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h4TLlisFk7XvtREAsS7C7Q.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@cgower?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Christopher Gower</a> on <a class="ae jt" href="https://unsplash.com/s/photos/coding-python?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="e6be" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">Azure函数和无服务器计算简介</h1><p id="bb85" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">Azure Functions是Azure中提供的一种无服务器计算服务，它运行代码来响应预定的事件或触发器。</p><p id="a92c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在无服务器计算中，用户只需创建或上传代码，然后定义将执行代码的触发器或事件。这种触发可能来自各种来源，包括计时甚至其他云服务，如数据库。</p><p id="f5bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦触发发生，在任何计算资源被释放之前，代码被加载并随后在执行环境中运行。仍然涉及到服务器，但是用户不再需要提供任何计算实例，这使得开发人员的工作更加轻松。</p><h1 id="a186" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">函数的高级剖析</h1><p id="0aa3" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">从高层次来看，有几个概念需要你去理解…</p><ul class=""><li id="a779" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">触发器——如前所述，触发器是函数运行所需的条件。触发器可能有多种来源，但重要的是要注意每个函数只有一个触发器。</li><li id="84cc" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">绑定——绑定可以被视为一个功能所需的到其他服务的连接。这种绑定可以是输入绑定，也可以是输出绑定。</li></ul><p id="26da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你理解了这两个概念，你就可以开始开发你自己的功能了。</p><h1 id="f43e" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">功能的分解</h1><p id="c4a7" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在这一节中，我们将深入探讨在Azure上开发无服务器功能的一些关键文件和最佳实践。</p><h2 id="447e" class="ll jv hi bd jw lm ln lo ka lp lq lr ke iq ls lt ki iu lu lv km iy lw lx kq ly bi translated">功能开发的要求/建议</h2><p id="16a3" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">由于它提供的工具和扩展范围，我们将使用Visual Studio代码来创建和开发我们的函数——您将需要安装Azure Functions扩展和您选择的编程语言。</p><p id="70cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这个例子，我将使用Python，如果你也这样做，请注意你需要安装Python 3.6–3.8，因为这些是Azure函数支持的版本。</p><h2 id="a7f1" class="ll jv hi bd jw lm ln lo ka lp lq lr ke iq ls lt ki iu lu lv km iy lw lx kq ly bi translated">创建函数</h2><p id="51b0" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在VS代码中，我们希望从打开命令面板开始，搜索<code class="du lz ma mb mc b">Azure Functions: Create function</code>命令——这将允许我们定义函数的设置:</p><ul class=""><li id="1730" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">为您的函数项目选择一种<em class="md">语言:从列表中选择Python。</em></li><li id="442e" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">选择一个<em class="md"> Python别名来创建一个虚拟环境</em>:选择你的Python解释器的位置。</li><li id="be1e" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">为您的函数选择一个<em class="md">模板:</em>在本例中，我们将使用“定时器触发器”模板。</li><li id="9e2e" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">提供一个名为的<em class="md">函数——我们将其命名为TimerTrigger1</em></li></ul><p id="1675" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你完成了设置，你会看到一些文件在目录中被创建。让我们把它们分解一下，看看它们的用途。</p><h2 id="d5f5" class="ll jv hi bd jw lm ln lo ka lp lq lr ke iq ls lt ki iu lu lv km iy lw lx kq ly bi translated">function.json —定义触发器和绑定</h2><p id="9345" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">我们要研究的第一个文件是function.json文件。该文件用于定义函数的触发器以及绑定——与其他Azure服务的连接。目前看起来应该有点像这样:</p><pre class="je jf jg jh fd me mc mf mg aw mh bi"><span id="9d21" class="ll jv hi mc b fi mi mj l mk ml">{</span><span id="aac4" class="ll jv hi mc b fi mm mj l mk ml">    "scriptFile": "__init__.py",</span><span id="de68" class="ll jv hi mc b fi mm mj l mk ml">    "bindings": [</span><span id="c3ff" class="ll jv hi mc b fi mm mj l mk ml">      {</span><span id="351c" class="ll jv hi mc b fi mm mj l mk ml">        "name": "mytimer",</span><span id="51f7" class="ll jv hi mc b fi mm mj l mk ml">        "type": "timerTrigger",</span><span id="ab08" class="ll jv hi mc b fi mm mj l mk ml">        "direction": "in",</span><span id="44fa" class="ll jv hi mc b fi mm mj l mk ml">        "schedule": "0 */5 * * * *"</span><span id="8ba3" class="ll jv hi mc b fi mm mj l mk ml">      }</span><span id="16ab" class="ll jv hi mc b fi mm mj l mk ml">    ]</span><span id="060f" class="ll jv hi mc b fi mm mj l mk ml">}</span></pre><p id="187e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是你说这一切意味着什么呢？让我们一行一行地分解它！</p><ul class=""><li id="7597" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">“scriptFile”属性定义了包含函数被触发时要执行的代码的脚本。</li><li id="b519" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">“bindings”属性允许我们以数组的形式定义函数的触发器和绑定。我们可以看到，触发器已经基于我们之前的选择进行了定义。触发器的“方向”是in，因为它是我们函数的输入。定时器的“schedule”属性是使用ncrontab语法定义的——参见这里的<a class="ae jt" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-timer?tabs=csharp#ncrontab-expressions" rel="noopener ugc nofollow" target="_blank"/>。</li></ul><p id="26a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加更多绑定时，文件可能如下所示…</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mn"><img src="../Images/46490843d7f86ee6182d6803747c95dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rMLK3LaSepiJ58EvkLbrQw.png"/></div></div></figure><p id="5394" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个例子取自一个正在进行的项目，但是它很好地突出了额外绑定的定义。</p><p id="d910" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我定义了4个绑定，它们都是到唯一blob存储的连接。</p><p id="ab70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有些将它们的“方向”属性设置为“输出”,因为它们充当输出——这就是__init__的输出。py脚本将被存储！</p><p id="9b75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于绑定的更多信息，请查看<a class="ae jt" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings?tabs=csharp" rel="noopener ugc nofollow" target="_blank"> MS Docs页面</a>！</p><h2 id="abef" class="ll jv hi bd jw lm ln lo ka lp lq lr ke iq ls lt ki iu lu lv km iy lw lx kq ly bi translated">__init__。py —函数要执行的代码</h2><p id="07a6" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">现在让我们来看一下保存代码的文件，这些代码将在我们的函数被触发时执行。目前它应该是这样的:</p><pre class="je jf jg jh fd me mc mf mg aw mh bi"><span id="6ff6" class="ll jv hi mc b fi mi mj l mk ml">import datetime</span><span id="9633" class="ll jv hi mc b fi mm mj l mk ml">import logging</span><span id="947c" class="ll jv hi mc b fi mm mj l mk ml">import azure.functions as func</span><span id="6f73" class="ll jv hi mc b fi mm mj l mk ml">def main(mytimer: func.TimerRequest) -&gt; None:</span><span id="a443" class="ll jv hi mc b fi mm mj l mk ml">    utc_timestamp = datetime.datetime.utcnow().replace(</span><span id="4bfd" class="ll jv hi mc b fi mm mj l mk ml">      tzinfo=datetime.timezone.utc).isoformat()</span><span id="1bed" class="ll jv hi mc b fi mm mj l mk ml">    if mytimer.past_due:</span><span id="2dab" class="ll jv hi mc b fi mm mj l mk ml">        logging.info('The timer is past due!')</span><span id="d635" class="ll jv hi mc b fi mm mj l mk ml">    logging.info('Python timer trigger function ran at %s',   utc_timestamp</span></pre><p id="9652" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该脚本目前所做的就是导入几个包，定义一个main方法，然后根据计时器记录一些信息——这实际上充当了开发人员的样板模板。</p><p id="f0a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想带任何额外的第三方包，如numpy，熊猫等。，您可以将它们添加到顶层目录中的requirements.txt文件中！</p><h2 id="8fc4" class="ll jv hi bd jw lm ln lo ka lp lq lr ke iq ls lt ki iu lu lv km iy lw lx kq ly bi translated">部署您的功能</h2><p id="5a01" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">现在我们已经探索了样板示例，让我们看看如何将一个功能部署到Azure！由于我们使用VS代码作为我们的IDE，这个过程通过Azure扩展得到了很好的简化:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mo"><img src="../Images/e65b0e101bba1bd284259706743fcf87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*gttu0xg_AND_Z539IgF0RQ.png"/></div></figure><p id="f1b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导航到侧边栏上的Azure扩展，你将能够在<code class="du lz ma mb mc b">FUNCTIONS</code>部分旁边看到一个<code class="du lz ma mb mc b">Deploy to Function App</code>选项——这就是我们将要开始的地方！</p><p id="bc7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将以与我们创建函数本身时相同的方式调出一系列设置</p><ul class=""><li id="10ab" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">选择一个<em class="md">订阅</em>:选择自己的订阅。</li><li id="08e1" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">在Azure中选择<em class="md">功能app</em>:如果你没有功能App，选择在Azure中创建新的功能App。</li><li id="ec98" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">为您的功能应用程序输入一个<em class="md">唯一名称:输入应用程序的名称。</em></li><li id="17e6" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">选择一个<em class="md">运行时栈</em>:选择您在本地机器上使用的Python版本。</li><li id="7e45" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">为新资源选择一个<em class="md">位置:选择一个离你最近的区域以获得最佳性能。</em></li></ul><p id="7b5d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此后，部署将在后台继续。如需更多帮助，请查看此处的文档<a class="ae jt" href="https://docs.microsoft.com/en-us/azure/azure-functions/create-first-function-vs-code-python" rel="noopener ugc nofollow" target="_blank"/>！</p><h2 id="df51" class="ll jv hi bd jw lm ln lo ka lp lq lr ke iq ls lt ki iu lu lv km iy lw lx kq ly bi translated">结论</h2><p id="bfac" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">这就是你对Azure函数的一个简短的停留之旅！我们已经查看了关键概念和核心文件，它们应该有助于加速您进入函数和无服务器计算的旅程。</p><p id="b1dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">~伊森</p></div></div>    
</body>
</html>