<html>
<head>
<title>Securing WebServices with TIBCO BusinessWorks 6.x</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TIBCO BusinessWorks 6.x保护web服务</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/securing-webservices-with-tibco-businessworks-6-x-7232a892b992?source=collection_archive---------17-----------------------#2022-11-08">https://medium.com/geekculture/securing-webservices-with-tibco-businessworks-6-x-7232a892b992?source=collection_archive---------17-----------------------#2022-11-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="5737" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">或者我们入侵TIBCO Business Works for WS-Security 1.2的方式</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/ac43558987386a03f951501b93a05cfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CDC2v2kieeUVRsXpJl2JuA.jpeg"/></div></div></figure><h2 id="3861" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">介绍</h2><p id="d5d0" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">在这个故事中，我想谈谈我的团队在TIBCO Business Works 6.x流程中配置WS-Security时遇到的麻烦。</p><p id="1fbf" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">我的团队无法仅使用标准机制来调用安全的Web服务。当我们意识到TIBCO Business Works 6.x只支持WS-Security 1.0，而外部服务实现了WS-Security 1.2时，顿悟就来了</p><h2 id="615a" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">什么是WS-Security？</h2><p id="e8ee" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">WS-Security是允许SOAP Web服务之间安全通信的协议。它是为了实现完整性和保密性而创建的。</p><p id="c25e" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">它不同于基本身份验证，因为它将身份验证信息放在SOAP消息中，也不放在HTTP头中。</p><p id="8186" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">WS-Security在SOAP头中添加了一个XML元素，称为<em class="lf">安全块</em>，它可以携带签名。您可以在安全模块中找到两个模块:</p><ul class=""><li id="3b39" class="lg lh hi kj b kk la kn lb ju li jy lj kc lk kz ll lm ln lo bi translated"><em class="lf"> UsernameToken </em>:携带用户名和密码信息；</li><li id="3a5a" class="lg lh hi kj b kk lp kn lq ju lr jy ls kc lt kz ll lm ln lo bi translated"><em class="lf">二进制安全令牌</em>:带来安全证书。</li></ul><p id="fd6c" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">同时，WS-Security只允许加密消息的一部分，除了传输层加密。</p><p id="a1d0" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">WS-Security 1.0编码于2004年。它将<strong class="kj hj"> UsernameToken </strong>定义如下:</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="ee45" class="jj jk hi lv b fi lz ma l mb mc">&lt;wsse:Security&gt;<br/>  &lt;wsse:UsernameToken&gt;<br/>     &lt;wsse:Username/&gt;<br/>  &lt;/wsse:UsernameToken&gt;<br/>&lt;/wsse:Security&gt;</span></pre><p id="dda9" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">完成了两次更新:一次是1.1版本，在2006年，另一次是在2007年到1.2版本。最后一个为UsernameToken添加了几个可选属性:<strong class="kj hj"> Nonce </strong>和<strong class="kj hj"> Created </strong>。</p><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="cdc8" class="jj jk hi lv b fi lz ma l mb mc">&lt;wsse:Security&gt;<br/>   &lt;wsse:UsernameToken&gt;<br/>      &lt;wsse:Username/&gt;<br/>      &lt;wsse:Password/&gt;<br/>      &lt;wsse:Nonce/&gt;<br/>      &lt;wsse:Created/&gt;<br/>   &lt;/wsse:UsernameToken&gt;<br/>&lt;/wsse:Security&gt;</span></pre><p id="d8f1" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">第一个是用于加密密码的随机密钥，而第二个是代表消息创建时间的日期。</p><h2 id="68e3" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">您可以用TIBCO Business Works 6做什么</h2><p id="c171" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">TIBCO Business Works 6.x使用WS-Security 1.0安全化您的web服务。</p><p id="5b72" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">文档很简单:为您的服务创建一个SOAP绑定，然后添加一个<strong class="kj hj">策略</strong>:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es md"><img src="../Images/ef5b129fa13598f1bf21565a26d9efc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*PyW1stgniqWgHBDSHj30jQ.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx">add policy to service binding</figcaption></figure><p id="a743" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">如果没有，则创建一个新策略，并选择<strong class="kj hj">使用文件系统XML进行用户名令牌验证</strong>或<strong class="kj hj">使用工作区XML进行用户名令牌验证</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/17eba155b9cc7d0687381c09342a9d4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vv5Efrs8JHJLLObkeedBlQ.png"/></div></div><figcaption class="me mf et er es mg mh bd b be z dx">New Policy panel</figcaption></figure><p id="0002" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">我更喜欢<em class="lf">文件系统</em>选项:通过这种方式，你可以应用任何需要的密码轮换策略，而无需重新编译和部署你的应用。</p><p id="dc94" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">完成按钮创建一个引用包外部XML凭证文件的<em class="lf"> WSSProvider </em>资源。</p><p id="c119" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">用于创建XML凭证文件的模式不允许插入<em class="lf">随机数</em>和<em class="lf">创建的</em>时间戳。</p><p id="02a2" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">事实上，它实现了1.0/1.1 WSS安全性。我们没有找到现成的方法来编码1.2 UsernameToken。</p><h2 id="76ba" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">我们的解决方案</h2><p id="ca52" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">当我们观察基本组件时，我们尝试了许多方法来实现我们的目标。我们当然不能贬低其他服务安全令牌。</p><p id="c8ec" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">最后，我们选择在引用的PortType中的HTTP上下文集合上进行操作。SetContext调色板允许您在HTTP请求的头中定义和赋值自定义值。当调用使用登录令牌的云平台时，使用相同的机制。</p><p id="6e38" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">在下面，我将使用点来简化程序。</p><ol class=""><li id="eb05" class="lg lh hi kj b kk la kn lb ju li jy lj kc lk kz mj lm ln lo bi translated">向端口类型引用添加安全上下文</li></ol><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mk"><img src="../Images/b760ba917f7cc05fbe323165955514ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jGXGkNW259056s-bkhMZvQ.png"/></div></div></figure><p id="d8eb" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">2.在绑定面板中，在SoapReferenceBinding的上下文映射部分，将新定义的安全上下文映射到SOAP消息的头中</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ml"><img src="../Images/29786a3a13352aa4f73202e0b6bcab0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7u1We1s4QjunR1wMM1xUxg.png"/></div></div></figure><p id="4306" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">3.在流程路径中添加SetContext活动，以动态设置值。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mm"><img src="../Images/598ae90bf30ca34e7ce909d109585606.png" data-original-src="https://miro.medium.com/v2/resize:fit:542/format:webp/1*03KoeTzspDcpkz7DGDTHAg.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx">SetContext activity</figcaption></figure><p id="adef" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">那都是乡亲们！</p><h2 id="063c" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">问候</h2><p id="080e" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">我谈到的解决方案来自洛伦佐·尼吉多和T2·帕里得·奥基比安科为找到合适的解决方案所做的艰苦工作。当第一个错误出现时，我参与了解决方案的上半部分。</p><p id="3502" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">我要感谢这两位，因为他们授权我分享他们的经验。干得好，伙计们！</p><h2 id="d4a8" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">放弃</h2><p id="fd9e" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">本文中的所有观点和提出的解决方案都是个人的，不以任何方式代表TIBCO软件。</p><h2 id="c7f0" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">参考</h2><ul class=""><li id="c072" class="lg lh hi kj b kk kl kn ko ju mp jy mq kc mr kz ll lm ln lo bi translated"><em class="lf"> WS Security 1.0规范</em>:<a class="ae ms" href="https://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf" rel="noopener ugc nofollow" target="_blank">https://docs . oasis-open . org/WSS/2004/01/oasis-200401-WSS-soap-message-Security-1.0 . pdf</a></li><li id="5cbb" class="lg lh hi kj b kk lp kn lq ju lr jy ls kc lt kz ll lm ln lo bi translated"><em class="lf"> WS Security 1.1规范</em>:<a class="ae ms" href="https://www.oasis-open.org/committees/download.php/16790/wss-v1.1-spec-os-SOAPMessageSecurity.pdf" rel="noopener ugc nofollow" target="_blank">https://www . oasis-open . org/committees/download . PHP/16790/WSS-v 1.1-Spec-OS-soapmessagesecurity . pdf</a></li><li id="e2cd" class="lg lh hi kj b kk lp kn lq ju lr jy ls kc lt kz ll lm ln lo bi translated"><em class="lf">WS Security 1.2 Spec</em>:<a class="ae ms" href="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/ws-securitypolicy-1.2-spec-os.pdf" rel="noopener ugc nofollow" target="_blank">http://docs . oasis-open . org/WS-sx/WS-Security policy/200702/WS-Security policy-1.2-Spec-OS . pdf</a></li><li id="c98c" class="lg lh hi kj b kk lp kn lq ju lr jy ls kc lt kz ll lm ln lo bi translated"><em class="lf">TIBCO Docs</em>:<a class="ae ms" href="https://docs.tibco.com/pub/activematrix_businessworks/6.8.1/doc/html/Default.htm#binding-palette/wss-authentication.htm?Highlight=WS-Security" rel="noopener ugc nofollow" target="_blank">https://Docs . TIBCO . com/pub/active matrix _ business works/6 . 8 . 1/doc/html/default . htm # binding-palette/WSS-authentic ation . htm？Highlight=WS-Security </a></li></ul></div></div>    
</body>
</html>