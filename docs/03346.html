<html>
<head>
<title>Space Shooter Challenge: Secondary Fire Pt 3 — Missile Functionality</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">太空射手挑战:二次射击pt3-导弹功能</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/space-shooter-challenge-secondary-fire-pt-3-missile-functionality-b9b4008761aa?source=collection_archive---------30-----------------------#2021-06-06">https://medium.com/geekculture/space-shooter-challenge-secondary-fire-pt-3-missile-functionality-b9b4008761aa?source=collection_archive---------30-----------------------#2021-06-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/30b6adf882a3a589c1d2741fe001a45b.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*6HS7kemaz3FccWKM3bgqEQ.gif"/></div></figure><p id="f251" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们从昨天开始，开始定义一些<strong class="io hj">旋转条件，</strong>，然后实现可视化功能。</p><p id="1873" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，我需要移除<strong class="io hj">导弹的<strong class="io hj">母体</strong>。</strong>否则，当<strong class="io hj">玩家移动时，</strong>导弹<strong class="io hj">仍然相对跟随，同时向前移动。为此，在<strong class="io hj"> Fire方法</strong>中，我简单地将<strong class="io hj"> transform.parent </strong>设置为<strong class="io hj"> null。</strong></strong></p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jk"><img src="../Images/dfa9911e88d1f30c22b86a412c0ec06e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O7_ojtOcB-5ViD7RIrJFTQ.png"/></div></div></figure><p id="61a5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在旋转之前，导弹首先需要找到一个<strong class="io hj">目标。我只想在导弹发射后搜索目标，所以在锁定并转向敌人之前，偶尔会有一些标准动作。因此，这个新的<strong class="io hj">私有方法</strong>将在<strong class="io hj">更新方法的<strong class="io hj"> if语句</strong>中被调用。</strong></strong></p><p id="8c2e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了创建<strong class="io hj"> PickTarget方法，</strong>我首先要找到带有<strong class="io hj">敌人标签、</strong>的游戏对象，然后将它们存储到一个<strong class="io hj">游戏对象数组中。然后我可以使用一个<strong class="io hj"> foreach循环</strong>来遍历<strong class="io hj">数组。</strong></strong></p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jk"><img src="../Images/fa4d0ef668411495003407a57d099fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SAfN5HLSwQxNjcBlgab6yw.png"/></div></div></figure><p id="c9b9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后我想从这个<strong class="io hj">阵列</strong>中选择一个随机目标，但是我也只希望在屏幕<strong class="io hj">上半部分</strong>的<strong class="io hj">敌人</strong>被提出来考虑，因为这将创建一个稍微更真实的前方射击行为，并且我们也不太关心<strong class="io hj">玩家后面的敌人。</strong></p><p id="0dd2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在创建了<strong class="io hj">数组</strong>之后，我又创建了一个<strong class="io hj">新的</strong> <strong class="io hj">列表</strong>的<strong class="io hj">游戏对象</strong>，如果在<strong class="io hj"> Y轴上<strong class="io hj"> transform.position </strong>大于0，我可以将它添加到<strong class="io hj"> foreach循环</strong>中。</strong></p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jk"><img src="../Images/5e7abd283c353f7c51867abb7f44a109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9M07cCk8_IN7H_ZVWaNvhA.png"/></div></div></figure><p id="1dc4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这之后，我可以创建一个<strong class="io hj">游戏对象变量</strong>来存储<strong class="io hj">目标敌人</strong>，我将在多个方法中使用这个变量，所以我在代码的顶部创建了这个变量，并且最初将它赋给了<strong class="io hj"> null。</strong></p><p id="d366" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在<strong class="io hj"> PickTarget方法</strong>中，我可以将<strong class="io hj">目标敌人变量</strong>分配给<strong class="io hj"> _targets列表的<strong class="io hj">随机索引</strong>。</strong></p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jk"><img src="../Images/9009e3a39ad84bf61f1a05d5fcf62437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ugkWEgOnQNk_dRAenw2uxQ.png"/></div></div></figure><p id="3684" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">问题是，如果没有敌人满足这些条件，控制台会返回错误，为了解决这个问题，我创建了一个<strong class="io hj"> bool </strong>来检查是否发现了目标。然后在<strong class="io hj"> UpdateMethod </strong>中，只要<strong class="io hj"> Target Found </strong>为<strong class="io hj"> false，就可以调用<strong class="io hj"> PickTarget方法</strong>。</strong></p><p id="20f0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当我们试图分配时，如果<strong class="io hj">列表</strong>为空，目标敌人也会返回错误。因此，我只想在<strong class="io hj">列表计数</strong>大于0时进行分配。</p><p id="f025" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了停止<strong class="io hj"> PickTarget方法</strong>再次运行，一旦<strong class="io hj">目标敌人</strong>被分配，需要将<strong class="io hj">目标发现布尔</strong>设置为真。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jk"><img src="../Images/d1ebafdfda561fea583cf85b4593a533.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AWG8ZkoM_3deLRGqPGTM8A.png"/></div></div></figure><p id="376f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在一个<strong class="io hj"> else if语句</strong>可以用来检查<strong class="io hj"> _targetFound是否为真</strong>。在这里我可以调用一个<strong class="io hj">旋转方法</strong>，来处理对<strong class="io hj">目标的跟踪。</strong></p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jk"><img src="../Images/0441a0d1eed6d2e88855ad84601fb7d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PKWSUoKMZEdRruScz0kNxA.png"/></div></div></figure><p id="1c48" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在<strong class="io hj">旋转方法中，</strong>我首先需要设置<strong class="io hj">目标方向，</strong>这将是一个<strong class="io hj">矢量3，</strong>并由<strong class="io hj">目标敌人位置</strong>减去<strong class="io hj">导弹位置组成。</strong></p><p id="bb6a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后我可以使用<strong class="io hj"> LookRotation将这个<strong class="io hj">矢量3变量</strong>转换成一个<strong class="io hj">四元数变量</strong>。</strong>这允许我在这种情况下比较Z = 0的前向方向和<strong class="io hj">目标方向</strong>，然后返回一个变量，我可以使用比<strong class="io hj">矢量更深入的变量。</strong></p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jk"><img src="../Images/693e7477c5203d0f5cebe4e264648c1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z05UEH-0QS23m-CW32d2-Q.png"/></div></div></figure><p id="f14f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后我可以将<strong class="io hj"> transform.rotation </strong>设置为<strong class="io hj"> _targetRotation。</strong></p><p id="ac02" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这一切都很好，但看起来有点不稳定，相反，我可以利用<strong class="io hj">四元数函数，在这种情况下</strong>，<strong class="io hj">球面线性插值</strong>，以特定的速度旋转。</p><p id="d6e7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我首先想创建一个<strong class="io hj">旋转速度浮动变量</strong>，它是我的<strong class="io hj">速度变量</strong>乘以<strong class="io hj">时间增量时间</strong></p><p id="3bfb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，我可以将<strong class="io hj"> transform.rotation </strong>设置为一个<strong class="io hj">四元数。在<strong class="io hj">当前旋转</strong>和<strong class="io hj">目标旋转</strong>之间旋转</strong>，以<strong class="io hj">变速的<strong class="io hj">速度</strong>移动。</strong></p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jk"><img src="../Images/595227811161ab9113a34ac6746edb8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qpkMoGGgls_gJzxW0DYiPw.png"/></div></div></figure><p id="7317" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我基本上有了“热寻的”导弹功能。当然，为了让碰撞像上面gif中那样发生，我必须分配一个刚体2D和一个碰撞器2D，我还必须进入<strong class="io hj">敌人脚本</strong>并把<strong class="io hj">导弹标签</strong>附加到destroy方法上。所有漂亮的冲洗和重复的东西在这一点上。但是我有一些额外的功能要实现。</p><p id="e23a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，如果<strong class="io hj">敌人</strong>在屏幕下方，它会重新出现在顶部，这会改变导弹的方向，看起来很奇怪。同样，如果我发射两枚导弹，它们锁定了同一个敌人，第一枚将摧毁它，但第二枚将寻找一个不再存在的敌人。</p><p id="71cf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了解决这个问题，我想让<strong class="io hj">导弹</strong>沿着它当前的方向直线前进，直到它找到新的目标。我可以简单地将<strong class="io hj">目标发现布尔</strong>设置为<strong class="io hj">假。</strong>棘手的是在哪里。</p><p id="4723" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了更容易导航，我创建了一个<strong class="io hj"> TargetLost方法</strong>，将<strong class="io hj"> bool </strong>设置为<strong class="io hj"> false，</strong>然后在需要的地方，我调用这个方法。</p><p id="7aff" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，在<strong class="io hj">移动方法</strong>中我可以使用额外的<strong class="io hj"> if语句</strong>来设置边界，如果位置超过这些，调用<strong class="io hj"> TargetLost方法。</strong></p><p id="1cc4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">另外，在<strong class="io hj">旋转方法</strong>中，我可以检查<strong class="io hj">目标敌人</strong>是否为<strong class="io hj">空，</strong>如果是，调用<strong class="io hj"> TargetLost，</strong>否则，进行旋转。</p><p id="fc09" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我还增加了一个5秒后的<strong class="io hj">破坏调用</strong>，以防导弹最终消失在屏幕外的某个地方，我仍然需要用这个方法做一些进一步的测试，并可能会改变它。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jk"><img src="../Images/0cfd1c337b32de542f6a52c96f3b452b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*olArhFWSa4GadAIA14bCXw.png"/></div></div></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="7706" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">至于视觉效果，我首先要设置一个<strong class="io hj">默认动画状态</strong>，由一个<strong class="io hj">空动画</strong>组成。这样，当导弹仍然连接到<strong class="io hj">播放器</strong>时，<strong class="io hj">旋转动画</strong>将不会播放，然后我在<strong class="io hj">两种状态</strong>之间创建了一个<strong class="io hj">过渡</strong>，它需要一个名为<strong class="io hj"> MissileActive的<strong class="io hj">触发器</strong></strong></p><p id="5056" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在<strong class="io hj">脚本中，</strong>我需要使用<strong class="io hj"> GetComponent </strong>将<strong class="io hj"> Animator组件</strong>赋值给一个<strong class="io hj">变量，</strong>然后在<strong class="io hj">移动方法</strong>的调用下，我可以<strong class="io hj"> SetTrigger </strong>，允许<strong class="io hj">动画</strong>在导弹开始向前移动时开始。</p><p id="159f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对于推进器，我可以创建一个<strong class="io hj">游戏对象变量</strong>，并在<strong class="io hj">检查器中分配它。</strong>在预设中，我可以让它保持非活动状态，所以当导弹<strong class="io hj">被实例化时，</strong>推进器看不到。然后除了<strong class="io hj">动画触发器之外，</strong>我可以简单地将<strong class="io hj">游戏对象</strong>设置为活动。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jk"><img src="../Images/c7277b4c7f6a588e54a9be56e16219e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vUgXmzPzgSBOAoyEnVq_SQ.png"/></div></div></figure><p id="5a41" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我在视觉上将闲置的导弹连接到<strong class="io hj">玩家船</strong>上，然后当发射时，它开始旋转并有推进器。</p></div></div>    
</body>
</html>