<html>
<head>
<title>Creating a Discord Dialogue with a Bot in Discord.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Discord.js中创建与机器人的不和谐对话</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/creating-a-discord-dialogue-with-a-bot-in-discord-js-bcfaa4b21c06?source=collection_archive---------5-----------------------#2022-05-18">https://medium.com/geekculture/creating-a-discord-dialogue-with-a-bot-in-discord-js-bcfaa4b21c06?source=collection_archive---------5-----------------------#2022-05-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="bec9" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如何用Discord.js创建响应式渠道和DM对话</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/90b08e15c63434aadf353e7ba92247b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wEa5vdICAEcd6hs-.jpg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Image from <a class="ae jn" href="https://pixabay.com/photos/feedback-report-back-business-people-3653368/" rel="noopener ugc nofollow" target="_blank">Pixabay</a></figcaption></figure><h1 id="0365" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">概观</h1><h2 id="b1ce" class="kg jp hi bd jq kh ki kj ju kk kl km jy kn ko kp ka kq kr ks kc kt ku kv ke kw bi translated">介绍</h2><p id="44d0" class="pw-post-body-paragraph kx ky hi kz b la lb ij lc ld le im lf kn lg lh li kq lj lk ll kt lm ln lo lp hb bi translated">最近，我在做一个项目，使用Discord.js创建一个Discord对话。然而，尽管发送消息相当简单，但对我来说，拥有一个bot消息并作出响应稍微有点困难，相当于Python中的<code class="du lq lr ls lt b">await</code>。</p><h2 id="3b48" class="kg jp hi bd jq kh ki kj ju kk kl km jy kn ko kp ka kq kr ks kc kt ku kv ke kw bi translated">目标</h2><p id="6e3c" class="pw-post-body-paragraph kx ky hi kz b la lb ij lc ld le im lf kn lg lh li kq lj lk ll kt lm ln lo lp hb bi translated">这个博客的目标是:</p><ul class=""><li id="dd01" class="lu lv hi kz b la lw ld lx kn ly kq lz kt ma lp mb mc md me bi translated">在DMs中创建机器人对话</li><li id="1226" class="lu lv hi kz b la mf ld mg kn mh kq mi kt mj lp mb mc md me bi translated">在频道中创建机器人对话</li></ul><h2 id="63d1" class="kg jp hi bd jq kh ki kj ju kk kl km jy kn ko kp ka kq kr ks kc kt ku kv ke kw bi translated">工具</h2><p id="f1f1" class="pw-post-body-paragraph kx ky hi kz b la lb ij lc ld le im lf kn lg lh li kq lj lk ll kt lm ln lo lp hb bi translated">要执行此操作，您需要:</p><ul class=""><li id="9d5d" class="lu lv hi kz b la lw ld lx kn ly kq lz kt ma lp mb mc md me bi translated"><a class="ae jn" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>和<a class="ae jn" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> NPM </a></li><li id="9371" class="lu lv hi kz b la mf ld mg kn mh kq mi kt mj lp mb mc md me bi translated"><a class="ae jn" href="https://discord.com/" rel="noopener ugc nofollow" target="_blank">不和谐账户</a></li><li id="f299" class="lu lv hi kz b la mf ld mg kn mh kq mi kt mj lp mb mc md me bi translated"><a class="ae jn" href="https://discord.js.org/" rel="noopener ugc nofollow" target="_blank"> Discord.js </a> (v13.6.0)</li></ul><h1 id="6ef0" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">第一步:创建一个不和谐机器人</h1><p id="eaa5" class="pw-post-body-paragraph kx ky hi kz b la lb ij lc ld le im lf kn lg lh li kq lj lk ll kt lm ln lo lp hb bi translated">首先，通过<a class="ae jn" href="https://discord.com/developers/applications" rel="noopener ugc nofollow" target="_blank">开发者门户</a>创建一个Discord bot。创建一个新的应用程序，创建一个bot，然后复制并粘贴要在代码中使用的令牌。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mk"><img src="../Images/b4c8df6aee5b46caad2ef0544a572045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SKJ-TvfdAKa521d4g-iBKA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Create an Application, create a bot, then copy the token</figcaption></figure><p id="4a54" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">接下来，在<code class="du lq lr ls lt b">Bot</code>选项卡中，让机器人访问意图选项。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mo"><img src="../Images/f880de1dda67237bdbcffce5cc760b0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9WWKDCgbQzG1S6y10tPu5g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Give the bot access to intent</figcaption></figure><p id="0f2f" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">有了令牌，你现在应该准备好为你的不和谐机器人编程了。</p><h1 id="b266" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">第二步:用正确的设置创建客户机</h1><p id="3b27" class="pw-post-body-paragraph kx ky hi kz b la lb ij lc ld le im lf kn lg lh li kq lj lk ll kt lm ln lo lp hb bi translated">首先，创建一个项目来构建Discord bot。</p><pre class="iy iz ja jb fd mp lt mq mr aw ms bi"><span id="fd12" class="kg jp hi lt b fi mt mu l mv mw">mkdir discord_dialogue<br/>cd discord_dialogue</span><span id="9c97" class="kg jp hi lt b fi mx mu l mv mw">npm init<br/>npm install discord.js</span><span id="5785" class="kg jp hi lt b fi mx mu l mv mw">touch index.js</span></pre><p id="a404" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">首先，导入discord.js。</p><pre class="iy iz ja jb fd mp lt mq mr aw ms bi"><span id="eebf" class="kg jp hi lt b fi mt mu l mv mw">const { Client, Intents } = require("discord.js");</span></pre><p id="e001" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">接下来，创建客户端。</p><pre class="iy iz ja jb fd mp lt mq mr aw ms bi"><span id="0f33" class="kg jp hi lt b fi mt mu l mv mw">const client = new Client({<br/>   intents: ['GUILD_PRESENCES', 'GUILD_MEMBERS', Intents.FLAGS.GUILDS, Intents.FLAGS.GUILD_MESSAGES, Intents.FLAGS.DIRECT_MESSAGES],<br/>   partials: ['CHANNEL', 'MESSAGE', 'REACTION']<br/>});</span></pre><p id="41bf" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">在就绪状态下创建客户端。</p><pre class="iy iz ja jb fd mp lt mq mr aw ms bi"><span id="cfe7" class="kg jp hi lt b fi mt mu l mv mw">client.on("ready", () =&gt; {<br/>   console.log("Bot is ready.");<br/>});</span></pre><p id="2ebb" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">接下来，创建客户端<code class="du lq lr ls lt b">onMessage</code>。这是大部分代码所在的地方。目前，如果作者是机器人，它将返回。</p><pre class="iy iz ja jb fd mp lt mq mr aw ms bi"><span id="3f2e" class="kg jp hi lt b fi mt mu l mv mw">client.on("messageCreate", async (message) =&gt; {</span><span id="8419" class="kg jp hi lt b fi mx mu l mv mw">   if (message.author.bot) return;</span><span id="0aaa" class="kg jp hi lt b fi mx mu l mv mw">})</span></pre><p id="e9ab" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">最后，在文档的结尾，使用您拥有的令牌登录客户端。</p><pre class="iy iz ja jb fd mp lt mq mr aw ms bi"><span id="4835" class="kg jp hi lt b fi mt mu l mv mw">client.login("TOKEN");</span></pre><blockquote class="my mz na"><p id="0325" class="kx ky nb kz b la lw ij lc ld lx im lf nc ml lh li nd mm lk ll ne mn ln lo lp hb bi translated">注意:所有代码都必须在这行代码之上，客户端代码才能运行。</p></blockquote><h1 id="9bd0" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">第三步:创建一个触发词并发送消息</h1><blockquote class="my mz na"><p id="c971" class="kx ky nb kz b la lw ij lc ld lx im lf nc ml lh li nd mm lk ll ne mn ln lo lp hb bi translated">注意:从这里开始，所有的代码，除非另有说明，都在“messageCreate”事件中。</p></blockquote><p id="af08" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">为了开始对话，我们将指定一个触发词。如果消息是这个触发字，对话代码将开始。在我的例子中，我将使用<code class="du lq lr ls lt b">start dialogue</code>作为触发词。</p><pre class="iy iz ja jb fd mp lt mq mr aw ms bi"><span id="a481" class="kg jp hi lt b fi mt mu l mv mw">if (message.content === 'start dialogue') {}</span></pre><blockquote class="my mz na"><p id="21eb" class="kx ky nb kz b la lw ij lc ld lx im lf nc ml lh li nd mm lk ll ne mn ln lo lp hb bi translated">注意:从这里开始，所有的代码，除非另有说明，都将出现在上面的if语句中。</p></blockquote><p id="cdd9" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">接下来，让我们发送一条消息，比如问候用户。</p><pre class="iy iz ja jb fd mp lt mq mr aw ms bi"><span id="ab5c" class="kg jp hi lt b fi mt mu l mv mw">if (message.content === 'start dialogue') {</span><span id="6fbb" class="kg jp hi lt b fi mx mu l mv mw">   message.author.send("Hi! What's your name?");</span><span id="a0a0" class="kg jp hi lt b fi mx mu l mv mw">}</span></pre><h1 id="b605" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">第四步:收集回复</h1><p id="37ac" class="pw-post-body-paragraph kx ky hi kz b la lb ij lc ld le im lf kn lg lh li kq lj lk ll kt lm ln lo lp hb bi translated">接下来，从前面的消息中，我们将添加一个<code class="du lq lr ls lt b">.then</code>声明。</p><pre class="iy iz ja jb fd mp lt mq mr aw ms bi"><span id="2dfd" class="kg jp hi lt b fi mt mu l mv mw">if (message.content === 'start dialogue') {</span><span id="2e20" class="kg jp hi lt b fi mx mu l mv mw">   message.author<br/>      .send("Hi! What's your name?")<br/>      .then((start) =&gt; {</span><span id="68b1" class="kg jp hi lt b fi mx mu l mv mw">         // Response code goes here.</span><span id="9736" class="kg jp hi lt b fi mx mu l mv mw">      })</span><span id="ad7c" class="kg jp hi lt b fi mx mu l mv mw">}</span></pre><p id="10a3" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">为了等待响应，我们将使用<code class="du lq lr ls lt b">.awaitMessages</code>命令。这将替换注释。</p><pre class="iy iz ja jb fd mp lt mq mr aw ms bi"><span id="dec4" class="kg jp hi lt b fi mt mu l mv mw">message.channel<br/>   .awaitMessages({ true , max: 1, time: 50000, errors: ['time'] })<br/>   .then((name) =&gt; {</span><span id="1294" class="kg jp hi lt b fi mx mu l mv mw">      message.author.send(`Pleased to meet you, ${name}!`);</span><span id="f38a" class="kg jp hi lt b fi mx mu l mv mw">   })<br/>   .catch((err) =&gt; message.author.send("There's been an error or you've timed out! Try again with `start dialogue`!"));</span></pre><p id="0ab0" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">我们来分析一下。<code class="du lq lr ls lt b">.awaitMessages</code>接受一个有三个参数的对象。第一个是简单返回<code class="du lq lr ls lt b">true</code>的过滤器。如果消息有某些约束，可以用返回true或false的函数替换第一个参数。接下来，<code class="du lq lr ls lt b">max</code>是它将等待的最大消息数。最后，<code class="du lq lr ls lt b">time</code>是函数等待消息的时间，<code class="du lq lr ls lt b">errors</code>是函数可能抛出的问题——在本例中是超时错误。</p><p id="065f" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">接下来，<code class="du lq lr ls lt b">.then</code>函数接受消息的一个参数，为简单起见，称为<code class="du lq lr ls lt b">name</code>。作为响应，当前有一个响应，通过用户的名字来调用用户。这可以修改为您需要完成的任何任务。</p><p id="4ae2" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">最后，<code class="du lq lr ls lt b">.catch</code>函数处理任何错误。如果有错误，机器人会通知用户有错误，并建议他们重新启动。</p><h1 id="6bb9" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">第五步:更长的对话和渠道对话</h1><p id="1771" class="pw-post-body-paragraph kx ky hi kz b la lb ij lc ld le im lf kn lg lh li kq lj lk ll kt lm ln lo lp hb bi translated">为了继续，在上面的<code class="du lq lr ls lt b">.then</code>函数中添加<code class="du lq lr ls lt b">.awaitMessages</code>函数。</p><pre class="iy iz ja jb fd mp lt mq mr aw ms bi"><span id="4783" class="kg jp hi lt b fi mt mu l mv mw">message.channel<br/>   .awaitMessages({ true , max: 1, time: 50000, errors: ['time'] })<br/>   .then((name) =&gt; {</span><span id="047d" class="kg jp hi lt b fi mx mu l mv mw">      message.author.send(`Pleased to meet you, ${name}! What is your favourite colour?`).then((start) =&gt; {</span><span id="7402" class="kg jp hi lt b fi mx mu l mv mw">         message.channel<br/>            .awaitMessages({ true , max: 1, time: 50000, errors: ['time'] })<br/>            .then((colour) =&gt; {</span><span id="a94b" class="kg jp hi lt b fi mx mu l mv mw">               message.author.send(`I love ${colour} too, ${name}!`);</span><span id="53c4" class="kg jp hi lt b fi mx mu l mv mw">            })<br/>            .catch((err) =&gt; message.author.send("There's been an error or you've timed out! Try again with `start dialogue`!"));</span><span id="17b1" class="kg jp hi lt b fi mx mu l mv mw">      })</span><span id="f64b" class="kg jp hi lt b fi mx mu l mv mw">   })<br/>   .catch((err) =&gt; message.author.send("There's been an error or you've timed out! Try again with `start dialogue`!"));</span></pre><p id="4a60" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">在对话的剩余部分继续添加<code class="du lq lr ls lt b">.then</code>语句。</p><p id="d0b1" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">接下来，要将这些对话更改为在频道而非DM中出现，请用<code class="du lq lr ls lt b">message.channel</code>替换所有<code class="du lq lr ls lt b">message.author</code>功能。</p><pre class="iy iz ja jb fd mp lt mq mr aw ms bi"><span id="96de" class="kg jp hi lt b fi mt mu l mv mw">message.channel.send("Hi! What's your name?");</span></pre><p id="3bcd" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated"><code class="du lq lr ls lt b">message.author</code>发送DM，而<code class="du lq lr ls lt b">message.channel</code>在对话发起的通道中发送消息。接下来，由于多个人可以同时参与对话，您将需要添加一个过滤器来替换<code class="du lq lr ls lt b">.awaitMessages</code>函数中的第一个<code class="du lq lr ls lt b">true</code>。</p><pre class="iy iz ja jb fd mp lt mq mr aw ms bi"><span id="b254" class="kg jp hi lt b fi mt mu l mv mw">let filter = (msg) =&gt; message.author.id === msg.author.id;</span></pre><p id="d05c" class="pw-post-body-paragraph kx ky hi kz b la lw ij lc ld lx im lf kn ml lh li kq mm lk ll kt mn ln lo lp hb bi translated">这样，您就应该拥有了创建不和谐(DM或渠道)对话所需的所有代码！</p><h1 id="3705" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">第六步:结论</h1><p id="e79f" class="pw-post-body-paragraph kx ky hi kz b la lb ij lc ld le im lf kn lg lh li kq lj lk ll kt lm ln lo lp hb bi translated">恭喜你完成这篇博客！如果你也在寻找一个不和谐的对话，希望这有所帮助！欢迎提出任何问题、意见或建议！</p></div></div>    
</body>
</html>