<html>
<head>
<title>Ready, Set, Action (Cable)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">准备，设置，行动(电缆)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/ready-set-action-cable-2411a30d2409?source=collection_archive---------11-----------------------#2021-06-12">https://medium.com/geekculture/ready-set-action-cable-2411a30d2409?source=collection_archive---------11-----------------------#2021-06-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="f499" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">一个帖子详细介绍了我如何用最简单的方式解释我的反应前端使用铁路的行动电缆。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/626ac5b8b4ff038349417a475faaf73a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wYSj4hdey7RdqzrE"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@trommelkopf?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Steve Harvey</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4e3b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对于我在Flat Iron的最终项目，我需要实时渲染，而不是典型的Post/Get HTTP协议。实时渲染的一个例子是为有线电视公司提供技术支持的聊天窗口。您和技术支持都可以实时看到消息。聊天窗口实际上使用了一种叫做web sockets的替代协议。我需要我的数据对于同一URL上的最终用户是相同的，即使是在不同的计算机上。</p><blockquote class="kk kl km"><p id="2473" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><a class="ae jn" href="https://en.wikipedia.org/wiki/WebSocket#:~:text=WebSocket%20is%20a%20computer%20communications,being%20standardized%20by%20the%20W3C." rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj"> WebSocket </strong>是一种计算机通信协议，在单一TCP连接上提供全双工通信通道</a>。</p></blockquote><p id="3fee" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如下例所示。左侧的窗口提交了一个新房间，它会自动出现在另一个浏览器中(右侧)。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kr"><img src="../Images/e927518c7bb63271b2f32f3a7c9aa89d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3LUH3k7wCByw1ogmxfRlhA.gif"/></div></div></figure><p id="5eb8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这就是Action Cable的神奇之处。它工作起来很美，但我经历了相当多的麻烦和挣扎才走到这一步。因此，本文将介绍如何在前端和后端设置action cable以发挥作用。我将尽可能用最简单的方式来做这件事，这样你就可以创建你自己的功能动作电缆，而不需要我在阅读了无数文章后花费所有的时间来调试和尝试让它工作。我确实读过一些文章，并发现这些文章很有帮助:<a class="ae jn" href="https://dev.to/christiankastner/react-and-actioncable-1gbh" rel="noopener ugc nofollow" target="_blank">https://dev.to/christiankastner/react-and-actioncable-1gbh</a>&amp;<a class="ae jn" rel="noopener" href="/@dakota.lillie/using-action-cable-with-react-c37df065f296">https://medium . com/@ Dakota . lillie/using-action-cable-with-react-c37df 065 f 296</a></p><p id="2d9b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">此外，应该提到的是，这项技术可能有更好的替代集成，但这是对我有用的。</strong></p></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><h1 id="99ac" class="kz la hi bd lb lc ld le lf lg lh li lj io lk ip ll ir lm is ln iu lo iv lp lq bi translated">让我们开始派对吧。</h1><p id="520d" class="pw-post-body-paragraph jo jp hi jq b jr lr ij jt ju ls im jw jx lt jz ka kb lu kd ke kf lv kh ki kj hb bi translated">首先，您需要做的是在终端中建立一个项目文件夹，键入:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="46e2" class="mb la hi lx b fi mc md l me mf">mkDir projectName<br/>cd projectName</span></pre><p id="24da" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后设置您的Rails API:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="412f" class="mb la hi lx b fi mc md l me mf">Rails new your_api_name --api -T</span></pre><p id="9212" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这将创建Rails API。<code class="du mg mh mi lx b">--api</code>标志将创建一个API，而不是一个成熟的Rails应用程序。<code class="du mg mh mi lx b">-T</code>是跳过rails测试框架的标志。</p><p id="2b62" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">之后，在终端<code class="du mg mh mi lx b">cd</code>进入Rails文件夹。为了让我们的后端接受来自前端的请求，我们需要在Gemfile中取消对<code class="du mg mh mi lx b">gem 'rack-cors'</code>和<code class="du mg mh mi lx b">gem ‘redis'</code>的注释。Action Cable利用Redis。用命令<code class="du mg mh mi lx b">bundle</code>运行bundle install，然后在文本编辑器中打开config/initializer/cors.rb，取消对Rails.application.config…的注释。块，并将<code class="du mg mh mi lx b">orgins</code>和<code class="du mg mh mi lx b">resource</code>设置为<code class="du mg mh mi lx b">'*'</code>这将设置Cors(跨来源资源共享)接受任何来源。</p><blockquote class="kk kl km"><p id="334c" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated"><strong class="jq hj">请注意，此配置仅用于开发目的，请研究如何为生产设置Cors。</strong></p></blockquote><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="c14d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">接下来，我们需要开发我们的资源:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="a9bd" class="mb la hi lx b fi mc md l me mf">rails g resources Room name</span></pre><p id="6248" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在本文中，我将通过一个简单的房间列表来展示ActionCable的强大功能。你可以随意地让你的模型复杂到你需要的程度。</p><p id="bc28" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这将产生:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="7b99" class="mb la hi lx b fi mc md l me mf"><strong class="lx hj">invoke</strong>  active_record</span><span id="bb32" class="mb la hi lx b fi ml md l me mf"><strong class="lx hj">create</strong>    db/migrate/20210610053516_create_rooms.rb</span><span id="50e0" class="mb la hi lx b fi ml md l me mf"><strong class="lx hj">create</strong>    app/models/room.rb</span><span id="bde1" class="mb la hi lx b fi ml md l me mf"><strong class="lx hj">invoke</strong>  controller</span><span id="f26d" class="mb la hi lx b fi ml md l me mf"><strong class="lx hj">create</strong>    app/controllers/rooms_controller.rb</span><span id="de84" class="mb la hi lx b fi ml md l me mf"><strong class="lx hj">invoke</strong>  resource_route</span><span id="1d3d" class="mb la hi lx b fi ml md l me mf"><strong class="lx hj">route</strong>    resources :rooms</span></pre><p id="1119" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在打开config/routes.rb文件，将其修改为如下所示:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="3b3d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我已经为我的房间模型限制了我的路线，但是如果需要的话，可以随意添加或删除。对于我们的目的来说，唯一需要的是<code class="du mg mh mi lx b">:index</code>、<code class="du mg mh mi lx b">:show</code>和<code class="du mg mh mi lx b">:create</code>另外，请注意实例化WebSockets连接所需的所有routes文件都是上面第5行中的那一行。如前所述，ActionCable是全双工连接，因此不需要设置post或get路由。</p><p id="57ee" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果你以前使用过Rails作为后端，所有这些应该都很熟悉。然而，这正是我们开始踏上新旅程的地方。</p><h2 id="11cf" class="mb la hi bd lb mm mn mo lf mp mq mr lj jx ms mt ll kb mu mv ln kf mw mx lp my bi translated">介绍渠道</h2><p id="c47f" class="pw-post-body-paragraph jo jp hi jq b jr lr ij jt ju ls im jw jx lt jz ka kb lu kd ke kf lv kh ki kj hb bi translated">当您自动生成rails应用程序时，它实际上会创建一个名为<code class="du mg mh mi lx b">app/channels</code>的文件夹😵我没有意识到这一点。通道可以被认为是WebSockets的控制器文件夹。虽然我已经看到了在通道中构建所有WebSocket功能的设计模式，但我们将依赖我所知道的控制器。</p><p id="ae2f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">确保您仍然在Rails API的根文件夹中:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="c68a" class="mb la hi lx b fi mc md l me mf">rails g channel rooms</span></pre><p id="b1c3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这将在<strong class="jq hj">app/channels/rooms _ channel . Rb</strong>中创建一个新文件</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="7a18" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这个文件是做什么的？通过安装<code class="du mg mh mi lx b">ActionCable.server</code>打开网络插座的通信电缆。实际的连接需要通过订阅频道来启动。订阅将在前端处理。但是我们确实需要修改这个文件。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="5068" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们需要做的就是把<code class="du mg mh mi lx b">stream_from "rooms_channel"</code>加到<code class="du mg mh mi lx b">Rooms_Controller.rb</code>上</p><p id="4096" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这里值得一提的是，您实际上可以设置通道来处理参数，例如房间id。类似于在控制器中使用参数来表示<code class="du mg mh mi lx b">:show</code></p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="6c21" class="mb la hi lx b fi mc md l me mf"># app/channels/some_channel.rb<br/>...channel file<br/>stream_from "room_channel_#{params[:room_id]}"</span></pre><h2 id="7dd9" class="mb la hi bd lb mm mn mo lf mp mq mr lj jx ms mt ll kb mu mv ln kf mw mx lp my bi translated">接下来修改控制器文件</h2><p id="fc46" class="pw-post-body-paragraph jo jp hi jq b jr lr ij jt ju ls im jw jx lt jz ka kb lu kd ke kf lv kh ki kj hb bi translated">当我们运行<code class="du mg mh mi lx b">rails g resources Room name</code>时，它生成了一堆相关文件，所以我们的控制器已经存在<code class="du mg mh mi lx b">app/controllers/rooms_controller.rb</code></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="4272" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们需要为<strong class="jq hj">索引、创建和显示添加控制器动作。</strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="5362" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这个控制器的大部分相对简单，除了<code class="du mg mh mi lx b">ActionCable.server.broadcast 'rooms_channel', room</code>最重要的是<code class="du mg mh mi lx b">'rooms_channel'</code>匹配你在通道文件中输入的内容。</p><p id="245a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="kn">这一行说的是，“嘿，ActionCable向</em> <code class="du mg mh mi lx b"><em class="kn">rooms_channel</em></code> <em class="kn">的所有订户广播了我在</em> <code class="du mg mh mi lx b"><em class="kn">room</em></code>的数据”</p><p id="3d90" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这就是后端所需的内容。除了创建我们的数据库。在终端类型中:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="c062" class="mb la hi lx b fi mc md l me mf">rails db:migrate</span></pre><p id="5bb6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后通过启动API服务器来验证一切</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="98e2" class="mb la hi lx b fi mc md l me mf">rails s</span></pre><p id="4ddc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后打开<a class="ae jn" href="http://localhost:3000/rooms" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/rooms</a>确认其功能正常。此时它应该只显示一个空数组。</p><h1 id="0371" class="kz la hi bd lb lc mz le lf lg na li lj io nb ip ll ir nc is ln iu nd iv lp lq bi translated">反应和行动电缆</h1><p id="e500" class="pw-post-body-paragraph jo jp hi jq b jr lr ij jt ju ls im jw jx lt jz ka kb lu kd ke kf lv kh ki kj hb bi translated">现在是时候把前端放在一起连接并显示我们的WebSocket内容了。如果您的终端窗口仍在Rails文件夹中，请退出它，进入项目文件夹的根目录。</p><p id="06e2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后输入终端。</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="3feb" class="mb la hi lx b fi mc md l me mf">npx create-react-app my-app-name</span></pre><p id="0e49" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这将创建一个新的React应用程序。接下来，我们需要为React安装ActionCable插件。如果你看看其他文章，他们会推荐各种插件，像<code class="du mg mh mi lx b">react-actioncable-provider /@rails/actioncable</code>或<code class="du mg mh mi lx b">actioncable</code>都可以从npm获得。对我有效的是<code class="du mg mh mi lx b">actioncable</code>。所以这将是我们将要安装的。</p><p id="a051" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">确保您仍然在react应用程序目录中，并在终端中键入内容</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="a158" class="mb la hi lx b fi mc md l me mf">npm install -S actioncable</span></pre><p id="73ec" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这将安装与后端通信所需的插件。<code class="du mg mh mi lx b">-S</code>标志将其保存为项目的依赖项。接下来，让我们通过在终端类型中创建一个文件夹和一个index.js来设置一些全局常量，在确认您仍然在React应用程序的根目录中之后。</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="12da" class="mb la hi lx b fi mc md l me mf">cd /src</span><span id="b757" class="mb la hi lx b fi ml md l me mf">mkdir constants<br/>touch constants/index.js</span></pre><p id="1795" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在打开您刚刚创建的文件，并添加:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="ec4f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对于我们正在构建的简单示例来说，这可能有些矫枉过正，但这是我喜欢的工作方式。这是一个很好的模式，可以避免到处修改常量。</p><p id="b6b9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在确保您仍在终端中的<code class="du mg mh mi lx b">/src</code>中，并键入</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="c64f" class="mb la hi lx b fi mc md l me mf">mkdir services<br/>touch services/Cable.js</span></pre><p id="793e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是我们将WebSockets连接到后端的地方。现在在文本编辑器中打开Cable.js并添加:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="d5a8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这就创建了一个订阅频道所必需的消费者——稍后将详细介绍这个文件。</p><p id="7ebc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">接下来，让我们设置我们的<code class="du mg mh mi lx b">App.js</code>文件，在一个文本编辑器中打开它，修改如下。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="7c81" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">此外，您需要安装<code class="du mg mh mi lx b">react-router-dom</code>以使URL路由正常工作</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="b8a1" class="mb la hi lx b fi mc md l me mf">npm install -S react-router-dom</span></pre><p id="7dca" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我在这里所做的就是创建两个URL路径来加载房间的索引或单个房间。接下来，添加一点CSS <code class="du mg mh mi lx b">App.css</code>，这样房间名称的显示会稍微漂亮一些。😃</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="56fc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">好了，现在是时候构建那些在<code class="du mg mh mi lx b">App.js</code>中引用的组件了。希望你的终端还在<code class="du mg mh mi lx b">src/</code>文件夹中。如果是，请键入:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="0781" class="mb la hi lx b fi mc md l me mf">mkdir components<br/>mkdir components/rooms<br/>cd components/rooms<br/>touch NewRoomForm.js<br/>touch Room.js<br/>touch RoomsList.js<br/>touch ShowRoom.js</span></pre><p id="02ab" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我发誓我们越来越接近了。我们需要构建一些组件，我们就要完成了。</p><p id="fc4d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">首先是<code class="du mg mh mi lx b">NewRoomForm.js</code>，这将是您提交新房间的方式。因为这只是您的标准React表单，所以继续将它复制并粘贴到文件中。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="392d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><code class="du mg mh mi lx b">Room.js</code>是房间对象的显示组件。所以这很简单。直接把这段代码复制粘贴进去。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="863a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">接下来是<code class="du mg mh mi lx b">ShowRoom.js</code>，虽然不是完全必要，但我希望能够点击显示各个房间。只需复制并粘贴这段代码。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="c7b0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后是<code class="du mg mh mi lx b">RoomList.js</code>很长！以及所有神奇的事情发生的地方，所以浏览源代码，你会找到相关的注释。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="3b79" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">好了，让我们深入了解一下这里发生了什么，这样你会有更好的理解。第8行<code class="du mg mh mi lx b">import cable from '../../services/Cable’</code>正在导入创建消费者的函数。</p><p id="e781" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">流程如下:<strong class="jq hj"> ActionCable →消费者→订阅</strong></p><p id="44e7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后由创建订阅的<code class="du mg mh mi lx b">roomsChannel()</code>调用<code class="du mg mh mi lx b">cable</code></p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="bf13" class="mb la hi lx b fi mc md l me mf">roomsChannel = () =&gt; {<br/>    cable.subscriptions.create({<br/>    channel: `RoomsChannel`,<br/>    }...</span></pre><p id="a839" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">该函数的其余部分包含与订阅相关的事件的回调函数。由于这只是一个开发阶段，我让<code class="du mg mh mi lx b">console.log()</code>来跟踪事件。唯一重要的回调是<code class="du mg mh mi lx b">received: data =&gt; {}</code>这是WebSockets的精髓，也是所有这些最终如何在所有用户的浏览器上更新DOM。虽然我承认这可能不是最精简的代码结构，但是在接收到数据时进行额外的<code class="du mg mh mi lx b">Fetch()</code>调用是最有意义的。尤其是当您试图避免将重复的项目添加到DOM时，您不必担心这个特定的用户是否是提交新房间的人。</p><h2 id="2692" class="mb la hi bd lb mm mn mo lf mp mq mr lj jx ms mt ll kb mu mv ln kf mw mx lp my bi translated">所以流程是这样的。</h2><blockquote class="kk kl km"><p id="2e9d" class="jo jp kn jq b jr js ij jt ju jv im jw ko jy jz ka kp kc kd ke kq kg kh ki kj hb bi translated">用户提交一个新房间→ <code class="du mg mh mi lx b">POST Fetch()</code> →然后服务器将该数据广播给所有用户→该事件触发<code class="du mg mh mi lx b">loadRooms()</code>，所有用户作为用户连接到该URL。</p></blockquote><h1 id="fe0d" class="kz la hi bd lb lc mz le lf lg na li lj io nb ip ll ir nc is ln iu nd iv lp lq bi translated">现在让我们来看看它的作用</h1><p id="468c" class="pw-post-body-paragraph jo jp hi jq b jr lr ij jt ju ls im jw jx lt jz ka kb lu kd ke kf lv kh ki kj hb bi translated">您需要首先启动rails服务器，因此它使用默认端口3000。然后，在终端中，导航到Rails API并输入命令。</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="9a5f" class="mb la hi lx b fi mc md l me mf">rails s </span></pre><p id="eb3c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">接下来，在终端中打开一个新的选项卡或窗口，导航到React前端，然后输入命令。</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="2cca" class="mb la hi lx b fi mc md l me mf">npm start</span></pre><p id="d543" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">它会因为你不能使用端口3000而对你大喊大叫，但是你可以说可以使用另一个端口。如果输入正确，您应该会看到我们的超级基本应用程序。继续添加一个房间。现在打开另一个选项卡，导航到同一个URL。在“新建”选项卡上，添加另一个房间。导航或查看另一个打开的选项卡</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ne"><img src="../Images/550e14dc14b19053befa5bcfff3ca74b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*hzRM0bbVuf9cfYXAE_9gwg.gif"/></div></div></figure><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="060b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这比我预期的时间要长得多。如果你坚持到底，你已经收获了看到行动电缆的魔力的回报。不客气！我感觉到了在我的项目中实现它的困难。我需要展示我是如何做到的，希望其他人不会像我一样落入同样的陷阱。快乐编码。</p></div></div>    
</body>
</html>