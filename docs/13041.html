<html>
<head>
<title>Building an Inflation Tracking Dashboard with Plotly Dash</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Plotly Dash构建通货膨胀跟踪仪表板</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/building-an-inflation-tracking-dashboard-with-plotly-dash-93edf01e1fcf?source=collection_archive---------4-----------------------#2022-06-15">https://medium.com/geekculture/building-an-inflation-tracking-dashboard-with-plotly-dash-93edf01e1fcf?source=collection_archive---------4-----------------------#2022-06-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8dc8427d27a8749fba900cffb9961e70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QCIL57ECXC7CSnWzuNqeTg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Credit: Kenny Eliason</figcaption></figure><p id="a973" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">随着美国通货膨胀率达到几十年来的最高水平，许多长期跟踪价格的措施正受到经济观察家和政策制定者的密切关注。即使是普通人也可以从了解最新数据显示的环境是改善还是恶化中受益，这样他们就可以相应地规划和预算他们的财务。然而，跟踪不同的通胀指标可能会很困难，如果能够建立一个单一的仪表板来在一个地方跟踪所有指标，将会更加方便。</p><p id="2b44" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">谢天谢地，这一切都可以通过使用<a class="ae js" href="https://plotly.com/dash/" rel="noopener ugc nofollow" target="_blank"> Plotly Dash </a>和一点点<a class="ae js" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Python </a>来完成。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="c50b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">第一步是确保安装了必要的Python库。虽然根据特定的目标，这些库中的一些不是绝对必要的，但是它们对于快速建立仪表板的基础是有用的，可以在以后进行改进或调整。Dash还对应用程序的最终样式和布局提供了大量的控制。</p><p id="f491" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在继续之前，应安装这些Python库:</p><ul class=""><li id="6e0f" class="kb kc hi iw b ix iy jb jc jf kd jj ke jn kf jr kg kh ki kj bi translated"><a class="ae js" href="https://pypi.org/project/dash/" rel="noopener ugc nofollow" target="_blank">破折号</a></li><li id="3a18" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated"><a class="ae js" href="https://pypi.org/project/dash-bootstrap-components/" rel="noopener ugc nofollow" target="_blank">仪表板自举组件</a></li><li id="68dd" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated"><a class="ae js" href="https://pypi.org/project/beautifulsoup4/" rel="noopener ugc nofollow" target="_blank">美丽组图</a></li><li id="c827" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated"><a class="ae js" href="https://pypi.org/project/pandas/" rel="noopener ugc nofollow" target="_blank">熊猫</a></li><li id="c0ab" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated"><a class="ae js" href="https://pypi.org/project/pandas-datareader/" rel="noopener ugc nofollow" target="_blank">熊猫Datareader </a></li><li id="d16e" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated"><a class="ae js" href="https://pypi.org/project/plotly/" rel="noopener ugc nofollow" target="_blank">阴谋地</a></li><li id="921d" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated"><a class="ae js" href="https://pypi.org/project/lxml/" rel="noopener ugc nofollow" target="_blank"> lxml </a></li><li id="d5db" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated"><a class="ae js" href="https://pypi.org/project/requests/" rel="noopener ugc nofollow" target="_blank">请求</a></li></ul><p id="2fb8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这些都可以通过运行命令提示符并使用<code class="du kp kq kr ks b">pip</code>来安装，如下例所示。</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="6c75" class="lb lc hi ks b fi ld le l lf lg">pip install dash</span></pre><p id="c2f7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一旦所有的东西都安装好了，就该获取这个项目所需的数据了。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="fd28" class="lb lc hi bd lh li lj lk ll lm ln lo lp jf lq lr ls jj lt lu lv jn lw lx ly lz bi translated">商品价格</h2><p id="a50d" class="pw-post-body-paragraph iu iv hi iw b ix ma iz ja jb mb jd je jf mc jh ji jj md jl jm jn me jp jq jr hb bi translated">第一步是为整个项目编写所有必要的导入语句。下面列出了创建这个Dash应用程序所需的一切:</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="297f" class="lb lc hi ks b fi ld le l lf lg">import pandas as pd<br/>import pandas_datareader as pdr<br/>import plotly.express as px<br/>import datetime<br/>from datetime import date<br/>import dash<br/>from dash import dcc, html<br/>from dash.dependencies import Output, Input<br/>import dash_bootstrap_components as dbc<br/>from bs4 import BeautifulSoup<br/>from urllib.request import Request, urlopen</span></pre><p id="0b47" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">从这里开始，是时候寻找和构建不同的元素，这些元素将组合起来组成仪表板。</p><p id="0d9d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">需要定义开始和结束日期，因为所获取的大部分数据都是历史数据，可以追溯到比所需时间更早的时间。此仪表板的主要目的是跟踪新冠肺炎疫情之前、期间和之后的相同通货膨胀指标。为此，开始日期将被定义为2019年3月，结束日期将是现在，因为经济仍处于大流行后阶段。</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="4052" class="lb lc hi ks b fi ld le l lf lg">start = datetime.datetime(2019, 3, 1)<br/>end = date.today()</span></pre><p id="24dd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当使用Pandas Datareader从Yahoo Finance等来源收集数据时，定义日期范围很有帮助。</p><p id="c647" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">仪表板的第一个组件是一个带有商品选择下拉菜单的折线图，它跟踪大多数主要商品的收盘价。跟踪商品价格的意义在于<a class="ae js" href="https://www.econport.org/content/handbook/supply/changeSupply.html" rel="noopener ugc nofollow" target="_blank">投入价格</a>对成品价格的贡献。在现实世界中，很少有商品价格大范围上涨而成品价格不会随之上涨的情况。</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="0675" class="lb lc hi ks b fi ld le l lf lg">com = pdr.DataReader(['GC=F', 'SI=F', 'PL=F', 'HG=F', 'PA=F',<br/>                      'CL=F', 'HO=F', 'NG=F', 'RB=F', 'ZC=F',  <br/>                      'SB=F', 'ZO=F', 'ZS=F', 'LE=F', 'HE=F',  <br/>                      'CC=F', 'KC=F', 'CT=F', 'LBS=F'],<br/>                     'yahoo', start, end)['Adj Close']</span></pre><p id="4605" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用Pandas Datareader，可以使用每种商品的适当符号从雅虎财经收集商品的调整后收盘价。在最后定义<code class="du kp kq kr ks b">'Adj Close'</code>将确保只收集调整后的收盘价，不收集其他。</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="92b4" class="lb lc hi ks b fi ld le l lf lg">com = com.rename(columns={'GC=F': 'Gold',<br/>                          'SI=F': 'Silver',<br/>                          'PL=F': 'Platinum',<br/>                          'HG=F': 'Copper',<br/>                          'PA=F': 'Palladium',<br/>                          'CL=F': 'Crude Oil',<br/>                          'HO=F': 'Heating Oil',<br/>                          'NG=F': 'Natural Gas',<br/>                          'RB=F': 'Gasoline Futures',<br/>                          'ZC=F': 'Corn',<br/>                          'SB=F': 'Sugar',<br/>                          'ZO=F': 'Oat',<br/>                          'ZS=F': 'Soybean',<br/>                          'LE=F': 'Live Cattle',<br/>                          'HE=F': 'Lean Hogs',<br/>                          'CC=F': 'Cocoa',<br/>                          'KC=F': 'Coffee',<br/>                          'CT=F': 'Cotton',<br/>                          'LBS=F': 'Lumber'})</span><span id="7678" class="lb lc hi ks b fi mf le l lf lg">com = com.stack().reset_index()<br/>com = com.rename(columns={com.columns[2]: 'Closing Price'})</span></pre><p id="6c8f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的代码将包含价格数据的每一列重命名为更加用户友好的格式。它还使用<code class="du kp kq kr ks b">.stack()</code>将数据框架从多指数重新整形，并通过<code class="du kp kq kr ks b">.rename()</code>重命名收盘价列，以使数据框架适合Plotly。这种可视化将在以后建立，因为它需要<a class="ae js" href="https://dash.plotly.com/basic-callbacks" rel="noopener ugc nofollow" target="_blank">破折号回调</a>才能完全发挥作用。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/c136ad4f6626707820c814c48ab23b36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cQnG5pilA2Y9cwYFeCyUQQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Initial shape of Dataframe from Yahoo Finance via Pandas Datareader</figcaption></figure><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es mh"><img src="../Images/eaa40fc45287bbe26a7f1b068b33c75b.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/1*JG7zhgriD8sGchERgla7PQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">After applying .stack() and resetting the index</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="d608" class="lb lc hi bd lh li lj lk ll lm ln lo lp jf lq lr ls jj lt lu lv jn lw lx ly lz bi translated">汽油零售价格</h2><p id="603b" class="pw-post-body-paragraph iu iv hi iw b ix ma iz ja jb mb jd je jf mc jh ji jj md jl jm jn me jp jq jr hb bi translated">汽油价格在塑造消费者情绪方面发挥着重要作用，因为每次人们外出驾车时都可以看到它们。出于多种原因，包括当前俄罗斯入侵乌克兰，天然气价格远高于前几年。</p><p id="8100" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">美国汽车协会(AAA)跟踪汽油零售价格，并在其网站上发布每日全国平均价格和各州平均价格。通过网络搜索他们的州平均油价表，我们可以将油价的choropleth图整合到仪表板中。</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="d2e3" class="lb lc hi ks b fi ld le l lf lg">url = '<a class="ae js" href="https://gasprices.aaa.com/state-gas-price-averages/'" rel="noopener ugc nofollow" target="_blank">https://gasprices.aaa.com/state-gas-price-averages/'</a><br/>req = Request(url, headers={'User-Agent': 'Mozilla/5.0'})</span><span id="fad8" class="lb lc hi ks b fi mf le l lf lg">page = urlopen(req).read()<br/>soup = BeautifulSoup(page, 'lxml')<br/>table = soup.find_all('table')</span><span id="fcd0" class="lb lc hi ks b fi mf le l lf lg">gas = pd.read_html(str(table))[0]</span></pre><p id="f787" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的代码片段将AAA的州天然气价格平均值表解析并加载为Dataframe。请注意，为了使请求不出错，必须设置<code class="du kp kq kr ks b">'User-Agent'</code>。在这种情况下，<code class="du kp kq kr ks b">'Mozilla/5.0'</code>工作正常，数据<em class="ka">几乎</em>准备好进行可视化。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/ab89cf5862e13e5f30985035c8125012.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kenNSP_ufvWPzTbnUHNgeA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Table on AAA website</figcaption></figure><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es mj"><img src="../Images/d13e3dd940543cab41a9dd818b8b63d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*b2x_02mHhOomYR8InqCmog.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Dataframe after being web scraped</figcaption></figure><p id="ddfe" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了让Plotly正确识别这些数据，我们仍然需要删除每个价格前面的美元符号，创建一个对应的列，其中包含每个州名的缩写，并将价格列转换为<code class="du kp kq kr ks b">float</code>数据类型。</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="03ca" class="lb lc hi ks b fi ld le l lf lg">def remove_dollar(sign):<br/>    sign = sign.str.replace('$', '', regex=True)<br/>    return sign</span></pre><p id="6cc0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的函数将替换字符串中的任何美元符号。但是，在继续之前，需要使用<code class="du kp kq kr ks b">.apply()</code>将其应用于整个数据帧。</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="0ef3" class="lb lc hi ks b fi ld le l lf lg">gas = gas.apply(remove_dollar)</span></pre><p id="25c9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来创建一个列，用每个州的两个字母缩写，因为这是Plotly识别位置的方式。在这种情况下，只需要一个<a class="ae js" href="https://realpython.com/python-dicts/" rel="noopener ugc nofollow" target="_blank">字典</a>，其中包含每个州的名称和缩写。</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="b5cf" class="lb lc hi ks b fi ld le l lf lg">abbv = {'Alabama': 'AL',<br/>        'Alaska': 'AK',<br/>        'Arizona': 'AZ',<br/>        'Arkansas': 'AR',<br/>        'California': 'CA',<br/>        'Colorado': 'CO',<br/>        'Connecticut': 'CT',<br/>        'Delaware': 'DE',<br/>        'District of Columbia': 'DC',<br/>        'Florida': 'FL',<br/>        'Georgia': 'GA',<br/>        'Hawaii': 'HI',<br/>        'Idaho': 'ID',<br/>        'Illinois': 'IL',<br/>        'Indiana': 'IN',<br/>        'Iowa': 'IA',<br/>        'Kansas': 'KS',<br/>        'Kentucky': 'KY',<br/>        'Louisiana': 'LA',<br/>        'Maine': 'ME',<br/>        'Maryland': 'MD',<br/>        'Massachusetts': 'MA',<br/>        'Michigan': 'MI',<br/>        'Minnesota': 'MN',<br/>        'Mississippi': 'MS',<br/>        'Missouri': 'MO',<br/>        'Montana': 'MT',<br/>        'Nebraska': 'NE',<br/>        'Nevada': 'NV',<br/>        'New Hampshire': 'NH',<br/>        'New Jersey': 'NJ',<br/>        'New Mexico': 'NM',<br/>        'New York': 'NY',<br/>        'North Carolina': 'NC',<br/>        'North Dakota': 'ND',<br/>        'Ohio': 'OH',<br/>        'Oklahoma': 'OK',<br/>        'Oregon': 'OR',<br/>        'Pennsylvania': 'PA',<br/>        'Rhode Island': 'RI',<br/>        'South Carolina': 'SC',<br/>        'South Dakota': 'SD',<br/>        'Tennessee': 'TN',<br/>        'Texas': 'TX',<br/>        'Utah': 'UT',<br/>        'Vermont': 'VT',<br/>        'Virginia': 'VA',<br/>        'Washington': 'WA',<br/>        'West Virginia': 'WV',<br/>        'Wisconsin': 'WI',<br/>        'Wyoming': 'WY'}</span></pre><p id="b18e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用<code class="du kp kq kr ks b">.map()</code>创建一个新列，每个州都有相应的缩写。</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="9aa0" class="lb lc hi ks b fi ld le l lf lg">gas['Abbreviation'] = gas.State.map(abbv)</span></pre><p id="acb7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">完成所有这些后，最后一步将是确保每个价格列只包含<code class="du kp kq kr ks b">float</code>数据，并且价格四舍五入到小数点后一位。</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="b425" class="lb lc hi ks b fi ld le l lf lg">gas[['Regular', 'Mid-Grade', 'Premium', 'Diesel']] = gas[['Regular', 'Mid-Grade', 'Premium', 'Diesel']].astype(float).round(2)</span></pre><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es mk"><img src="../Images/cf3a03cec1c03443a75aa151a9a20536.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*uacJ9sB5c1ikNonQjKMu1w.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">The final result</figcaption></figure><p id="27ce" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在可以定义和构建choropleth图了。</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="a92d" class="lb lc hi ks b fi ld le l lf lg">fig2 = px.choropleth(gas,<br/>                     locations='Abbreviation',<br/>                     color='Regular',<br/>                     color_continuous_scale='spectral_r',<br/>                     locationmode='USA-states',<br/>                     scope='usa',<br/>                     title='Price of Regular Unleaded Gasoline',<br/>                     height=1000)</span><span id="f9c1" class="lb lc hi ks b fi mf le l lf lg">fig2.add_scattergeo(locations=gas['Abbreviation'],<br/>                    locationmode='USA-states',<br/>                    text=gas['Abbreviation'],<br/>                    mode='text',<br/>                    hoverinfo='skip')</span><span id="ddac" class="lb lc hi ks b fi mf le l lf lg">fig2.update_layout(coloraxis_colorbar_title='Price $',<br/>                   title=dict(xanchor='center',<br/>                              yanchor='top',<br/>                              font_size=18,<br/>                              x=0.5,))</span></pre><p id="8d1e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这种可视化的构建可以总结为三个步骤。首先，使用<code class="du kp kq kr ks b">.choropleth()</code>识别正在使用的数据帧和地图的特征，如颜色、标题、范围和高度。其次，通过<code class="du kp kq kr ks b">.add_scattergeo()</code>添加州标签，在地图上洒上另一层视觉信息。第三，使用<code class="du kp kq kr ks b">.update_layout()</code>更新地图本身和颜色栏的标题，使价格更加美观。</p><p id="d053" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">地图本身可以在下图中看到，但还有更多可以添加到这个仪表板…</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/768da183dbdb995c8247b5593a1fbdcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D4T4ZU_RtIVPpWZmkcY3rg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Prices are typically highest in California</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="cde1" class="lb lc hi bd lh li lj lk ll lm ln lo lp jf lq lr ls jj lt lu lv jn lw lx ly lz bi translated">通货膨胀的主要宏观经济措施</h2><p id="386d" class="pw-post-body-paragraph iu iv hi iw b ix ma iz ja jb mb jd je jf mc jh ji jj md jl jm jn me jp jq jr hb bi translated">在进入Dash应用程序本身的布局和创建之前，必须开发仪表板的最后一部分，这是一个2×3的条形图和折线图配置，其中包含一些最受关注的宏观经济通胀指标，概述如下:</p><ul class=""><li id="8a29" class="kb kc hi iw b ix iy jb jc jf kd jj ke jn kf jr kg kh ki kj bi translated">消费者物价指数</li><li id="3e38" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated">生产价格指数</li><li id="62f4" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated">凯斯席勒房价指数</li><li id="c711" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated">个人消费支出</li><li id="61d7" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated">圣路易斯联邦储备银行的价格压力</li><li id="750d" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated">密歇根大学消费者通胀预期</li></ul><p id="bbe7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所有这些数据都可以通过Pandas Datareader使用圣路易斯美联储经济数据库(FRED)获得。就像股票和商品符号一样，弗雷德对每个指标都使用特定的代码。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/f5d2e01a395a0e5cb3310293369b3442.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RhGI3NdaDLnDAmQxNgqLrw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">The code is at the very end of the title in parenthesis</figcaption></figure><p id="3c96" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以上是上述相同衡量标准列表的六个唯一代码，顺序相同:</p><ul class=""><li id="d68c" class="kb kc hi iw b ix iy jb jc jf kd jj ke jn kf jr kg kh ki kj bi translated">CPIAUCSL</li><li id="7ee7" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated">PPIFIS</li><li id="6fe7" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated">CSUSHPINSA</li><li id="80cb" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated">PCE</li><li id="6ec5" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated">STLPPM</li><li id="d0bd" class="kb kc hi iw b ix kk jb kl jf km jj kn jn ko jr kg kh ki kj bi translated">密歇根州</li></ul><p id="9b4e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有了这些信息，我们就可以获得我们需要的数据，并在继续之前执行一些简单的数据操作。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="mn mo l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Gather, calculate, and rename</figcaption></figure><p id="e494" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">除了密歇根大学的通胀预期和圣路易斯联邦储备银行的价格压力，这些数据的其余部分通常是按月环比和同比衡量的。这就是为什么新列中应用了<code class="du kp kq kr ks b">.pct_change()</code>来计算这些指标的每月百分比变化。</p><p id="b6b1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">通过这些修改和列的重命名，现在可以定义可视化效果了。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="mn mo l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Building out each visualization</figcaption></figure><p id="536e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当使用<code class="du kp kq kr ks b">.bar()</code>生成条形图时，使用连续色标来可视化每个数据点的相对高点和低点是很有帮助的。</p><p id="e014" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有了<code class="du kp kq kr ks b">.line()</code>图，对于初学者来说，默认的Plotly设置已经足够了，所以不需要定制。</p><p id="b648" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">移除x和y轴标题消除了一些不必要的混乱，而不会使可视化更加难以理解。</p><p id="3f3b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下图展示了成为仪表板一部分后的最终设置。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/7b9496e0cb38b1442a45e3c4512a7384.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H4QZ9WHI7hYVvSfT4v1mCg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Having an array of different indicators all in one place makes things easier and faster</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="119a" class="lb lc hi bd lh li lj lk ll lm ln lo lp jf lq lr ls jj lt lu lv jn lw lx ly lz bi translated">Dash Bootstrap布局和主题</h2><p id="7c12" class="pw-post-body-paragraph iu iv hi iw b ix ma iz ja jb mb jd je jf mc jh ji jj md jl jm jn me jp jq jr hb bi translated">虽然Dash作为一个框架，使得基于数据的web应用程序的创建更加简单，但是通过添加Dash Bootstrap组件，这种简单性可以更进一步。Bootstrap是基于包装在容器<code class="du kp kq kr ks b">dbc.Container</code>中的行<code class="du kp kq kr ks b">dbc.Row</code>和列<code class="du kp kq kr ks b">dbc.Column</code>构建的，它们一起形成了<a class="ae js" href="https://getbootstrap.com/docs/4.0/layout/grid/" rel="noopener ugc nofollow" target="_blank">网格系统布局</a>。</p><p id="2c0c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这个布局中，我们可以放置图表、文本、图像和其他组件。</p><p id="63fe" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要开始这样做，我们必须启动应用程序并声明一个主题。这个例子使用了这里可用的主题之一<a class="ae js" href="https://www.bootstrapcdn.com/bootswatch/" rel="noopener ugc nofollow" target="_blank">但是主题可以来自任何地方。</a></p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="mn mo l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Using the theme FLATLY for this example</figcaption></figure><p id="e8ab" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du kp kq kr ks b">meta_tags</code>允许应用程序快速响应，以便它可以适应不同的屏幕尺寸，并兼容移动设备。</p><p id="9689" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用<code class="du kp kq kr ks b">app.layout</code>和<code class="du kp kq kr ks b">dbc.Container</code>是添加行和列之前的第一步。第一行只是一个带有仪表板标题的HTML标题。</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="028c" class="lb lc hi ks b fi ld le l lf lg">app.layout = dbc.Container([</span><span id="848d" class="lb lc hi ks b fi mf le l lf lg">dbc.Row(<br/>        dbc.Col(html.H1('Inflation Tracking Dashboard',<br/>                        className='text-center text-primary mb-4'),<br/>                width=15)<br/>            ),</span></pre><p id="420e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下一行有一个下拉列表和一个图表，分别使用<code class="du kp kq kr ks b">dbc.Dropdown</code>和<code class="du kp kq kr ks b">dbc.Graph</code>制作。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="mn mo l"/></div><figcaption class="iq ir et er es is it bd b be z dx">A commodity selection dropdown will load a price chart for each commodity</figcaption></figure><p id="dc85" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一旦启动并运行，下拉菜单将允许dashboard应用程序的用户从可用的商品中进行选择，并加载一个价格图表供他们选择。<code class="du kp kq kr ks b">id</code>和<code class="du kp kq kr ks b">figure</code>行是需要注意的重要部分，因为它们将在最后的回调中使用。</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="8cd0" class="lb lc hi ks b fi ld le l lf lg">dbc.Row(<br/>        dbc.Col([<br/>            dcc.Graph(id='gas_map', figure=fig2)<br/>                ]), justify='center'<br/>            ),</span><span id="0a9f" class="lb lc hi ks b fi mf le l lf lg">dbc.Row([<br/>        dbc.Col(<br/>            dcc.Graph(id='cpi_bar', figure=fig3)),<br/>        dbc.Col(<br/>            dcc.Graph(id='ppi_bar', figure=fig4)),<br/>        dbc.Col(<br/>            dcc.Graph(id='hpi_bar', figure=fig5))<br/>            ]),</span><span id="a93e" class="lb lc hi ks b fi mf le l lf lg">dbc.Row([<br/>            dbc.Col(<br/>                dcc.Graph(id='pce_bar', figure=fig6)),<br/>            dbc.Col(<br/>                dcc.Graph(id='ppm_line', figure=fig7)),<br/>            dbc.Col(<br/>                dcc.Graph(id='exp_line', figure=fig8))<br/>            ]),</span></pre><p id="d59f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来的三行是零售天然气价格和宏观经济指标的choropleth图。因为这些都不需要回调函数，所以没有什么需要做的了。</p><p id="2287" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">布局完成后，剩下的唯一任务是创建商品价格图表，并为Dash应用程序设置能够在本地运行的条件。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="b99b" class="lb lc hi bd lh li lj lk ll lm ln lo lp jf lq lr ls jj lt lu lv jn lw lx ly lz bi translated">回调和启动应用程序</h2><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="f6ab" class="lb lc hi ks b fi ld le l lf lg">@app.callback(Output('commodity-select', 'figure'),<br/>              Input('drpdwn', 'value'))</span><span id="38b5" class="lb lc hi ks b fi mf le l lf lg">def update_plot(commodity_selected):<br/>    com_select = com[com['Symbols'] == commodity_selected]<br/>    fig1 = px.line(com_select,<br/>                   y='Closing Price',<br/>                   x='Date',<br/>                   height=700)<br/>    fig1.update_xaxes(title=None)<br/>    return fig1</span></pre><p id="da8d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">回调函数使仪表板具有反应性，其中用户可以选择一个输入组件，并根据已更改的属性显示不同的输出。在上例中，<code class="du kp kq kr ks b">Output()</code>是根据下拉菜单中的<code class="du kp kq kr ks b">Input()</code>选择的商品生成的新价格图表。前面创建的数据框架，包括所有商品的收盘价，最终在这里使用。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/0e92b47233f09aae320280501d4f6278.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mXQiZ4SYEyfo53zgv1IVqg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">The dropdown and the price chart working together</figcaption></figure><p id="d760" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">万事俱备，只需增加两行代码就可以确保这个仪表板可以在本地运行，并在web浏览器中进行测试。</p><pre class="kt ku kv kw fd kx ks ky kz aw la bi"><span id="736a" class="lb lc hi ks b fi ld le l lf lg">if __name__ == '__main__':<br/>    app.run_server(debug=True, port=8080)</span></pre><p id="ccf8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在它可以运行了。如果所有东西都保存到一个<code class="du kp kq kr ks b">.py</code>文件中，并且该文件正在运行，那么应该会有一条命令行消息确认Dash正在运行。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/8f74891c1777172dd1f11187a744ef85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gvCib7j1D3Eu-Okop8_wcQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Dash is powered by <a class="ae js" href="https://flask.palletsprojects.com/en/2.1.x/" rel="noopener ugc nofollow" target="_blank">Flask</a></figcaption></figure><p id="c98f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">将该地址插入同一台机器上的任何web浏览器都会加载仪表板，如下图所示。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/1c9000300b1c59c099139ec88bfd059a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*huKPCRAUHumubO7tY0ncng.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Running in Debug mode</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="715f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">多年来，除了经济学家之外，很少有人跟踪通胀数据，这当然不会成为头条新闻，因为没有太多的过度通胀发生。当经济按预期运行时，没有什么会成为新闻。然而，在过去几年里发生了一系列事件，通货膨胀是每个人心中的话题。像这样的仪表板可以帮助显示通货膨胀是升温还是降温。将所有数据放在一个地方当然不会有坏处，Plotly Dash允许任何人这样做。</p><p id="1181" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">完整的代码可在<a class="ae js" href="https://github.com/styounessi/Inflation_Dashboard" rel="noopener ugc nofollow" target="_blank">这里</a>。←于2023年2月4日更新，以解决Pandas Datareader和Yahoo Finance数据的问题。还重构了大部分代码。</p></div></div>    
</body>
</html>