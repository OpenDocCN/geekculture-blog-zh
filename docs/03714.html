<html>
<head>
<title>OOP in R, Simulating a simple banking system.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模拟一个简单的银行系统。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/oop-in-r-simulating-a-simple-banking-system-18942ba146d3?source=collection_archive---------31-----------------------#2021-06-14">https://medium.com/geekculture/oop-in-r-simulating-a-simple-banking-system-18942ba146d3?source=collection_archive---------31-----------------------#2021-06-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/f03abd8f8de2334ddc8ee99ae0eb3b8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*b11dfdcddj8wwnJVpkHlzw.png"/></div></figure><h1 id="4e73" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">介绍</h1><p id="4b76" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">面向对象编程是用任何语言编写程序的最佳方式。但是为什么是OOP技术呢？事实上，我们的物质世界是由不同质量的物体组成的。OOP基于“对象”的概念，它可以包含数据或代码。</p><p id="e668" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">一个很好的例子可以是一个动物对象，它具有运动、声音、饮食、寿命等多种属性。我们也可以谈论一个“银行对象”，我将在这篇文章中考虑它，包括客户、账户等属性，以及账户创建、贷款偿还等方法。</p><h1 id="3715" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">为什么用r中的OOP。</h1><p id="7129" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">嗯，就我个人而言，我从简单的面向过程的编程开始了我的R之旅，然后我从函数式编程毕业。只有在接触了使用python以面向对象的方式构造我的脚本所带来的好处之后。r提供了不止一种编写面向对象程序的方法，如S3、S4、R6等。在这篇文章中，我将重点介绍如何使用由<a class="ae kn" href="https://r6.r-lib.org/articles/Introduction.html" rel="noopener ugc nofollow" target="_blank"> R6包</a>提供的R6类。这是因为它给出了Python使用的一个几乎相似的方法。如果你不擅长python，你没什么好担心的，你需要知道的只是如何写一个R函数和简单的运算。</p><p id="73fd" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">关于OOP的更多内容可以在找到<a class="ae kn" href="https://en.wikipedia.org/wiki/Object-oriented_programming" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="a28d" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">我们在这里要学习的一些关键概念是:</p><ol class=""><li id="0c77" class="ko kp hi jm b jn ki jr kj jv kq jz kr kd ks kh kt ku kv kw bi translated">类别定义</li><li id="b936" class="ko kp hi jm b jn kx jr ky jv kz jz la kd lb kh kt ku kv kw bi translated">类实例</li><li id="55b4" class="ko kp hi jm b jn kx jr ky jv kz jz la kd lb kh kt ku kv kw bi translated">方法:</li></ol><ul class=""><li id="9cc9" class="ko kp hi jm b jn ki jr kj jv kq jz kr kd ks kh lc ku kv kw bi translated">公共方法</li><li id="7865" class="ko kp hi jm b jn kx jr ky jv kz jz la kd lb kh lc ku kv kw bi translated">私有方法</li></ul><p id="4126" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">4.反省</p><h1 id="3ef4" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">假设的例子。</h1><p id="fc0e" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在这篇文章中，我将介绍一个简单的银行系统，它使我们能够:</p><p id="ad27" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">1.创建帐户</p><p id="8a74" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">2.存款</p><p id="1215" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">3.提款</p><p id="fd2f" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">4.申请并支付贷款。</p><p id="35e6" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">5.在控制台中模拟一个简单的USSD请求。</p><p id="bfe8" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">激动吗？我们继续吧。</p><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es ld"><img src="../Images/326e73b05678d361c4e1d17f77b8cc86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*fvAcx62caN3407BJpyKylA.gif"/></div></figure><h1 id="d609" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">必需的包。</h1><p id="5845" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">这个项目我们只需要两个包，即<a class="ae kn" href="https://www.tidyverse.org/" rel="noopener ugc nofollow" target="_blank"> tidyverse </a>和<a class="ae kn" href="https://r6.r-lib.org/articles/Introduction.html" rel="noopener ugc nofollow" target="_blank"> R6 </a>。</p><p id="d4b0" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">如果您当前的R安装中没有这些包，请安装它们。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="4d04" class="ln in hi lj b fi lo lp l lq lr"><strong class="lj hj">#install.packages("R6")</strong><br/><strong class="lj hj">#install.packages("tidyverse")</strong><br/><strong class="lj hj"># load the packages here</strong><br/>suppressWarnings(suppressPackageStartupMessages(library(R6)))<br/>suppressWarnings(suppressPackageStartupMessages(library(tidyverse)))</span></pre><h1 id="ec83" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">定义类别</h1><p id="c121" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">OOP的焦点是用于创建<strong class="jm hj">对象的<strong class="jm hj">类</strong>。</strong>类是对象的蓝图。它从字面上描述了一个物体将会是什么，但与物体本身是分离的。同一个类可用于创建多个对象。</p><p id="1481" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">R6类是使用关键字<code class="du ls lt lu lj b">R6Class</code>创建的。它包含名为<strong class="jm hj">方法</strong>的函数。这些方法指定用同一类创建的对象可以使用其指定数据执行的行为和操作。</p><p id="03e9" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">记下这门课最重要的两个论点很重要:</p><ol class=""><li id="157a" class="ko kp hi jm b jn ki jr kj jv kq jz kr kd ks kh kt ku kv kw bi translated"><code class="du ls lt lu lj b">classname</code>:定义类名。对于这个类来说，这并不是必需的，但是正如包文档中所描述的，它对于S3方法分派很有用。</li><li id="dcee" class="ko kp hi jm b jn kx jr ky jv kz jz la kd lb kh kt ku kv kw bi translated"><code class="du ls lt lu lj b">public</code>:公共成员列表，可以是函数(方法)，也可以是非函数(字段)。</li></ol><p id="18fb" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">下面是在R6创建一个类的简单方法。首先，让我们称我们的类为<em class="lv">CBS</em>——核心银行系统的简称。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="64aa" class="ln in hi lj b fi lo lp l lq lr">CBS &lt;- R6Class(classname = "CBS",<strong class="lj hj">public</strong> = <strong class="lj hj">list</strong>(<br/>  accs = tibble(<br/>"Full Name" = NA,<br/>"IDNo" = NA,<br/>'AccountNo' = NA,<br/>'AccountBalance' = NA,<br/>'LoanBalance' = NA),<br/>  bank_name = NA,<br/>  initialize = <strong class="lj hj">function</strong>(accs = NULL,bank_name) {<br/>    <strong class="lj hj">self</strong>$bank_name = bank_name<br/>    cat(paste(' --------- \n This is ',<strong class="lj hj">self</strong>$bank_name,'. \n --------- \n'))<br/>  }<br/>))</span></pre><p id="8fab" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">在上面的类中，我用方法<code class="du ls lt lu lj b">initialize()</code>定义了一个类<code class="du ls lt lu lj b">CBS</code>。对于来自python的人来说，你可以把这看作是<code class="du ls lt lu lj b">__init__</code>方法。当使用类名作为函数创建对象类的实例时，调用该函数。在这个方法中，<code class="du ls lt lu lj b">self$attribute</code>可以用来设置实例属性的初始值。</p><h1 id="f47a" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">类实例化。</h1><p id="07bc" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">实例是从包含真实数据和对象的类中构建的对象。为了实例化上述类的一个对象，我们使用如下所示的<code class="du ls lt lu lj b">$new()</code>方法。让我们称我们的银行为<strong class="jm hj"> ABCBank </strong>。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="86c9" class="ln in hi lj b fi lo lp l lq lr">ABCBank &lt;- CBS$new(bank_name = 'ABCBank')</span><span id="2e95" class="ln in hi lj b fi lw lp l lq lr"><strong class="lj hj">#</strong><em class="lv">#  --------- </em><br/><strong class="lj hj">#</strong><em class="lv">#  This is  ABCBank . </em><br/><strong class="lj hj">#</strong><em class="lv">#  ---------</em></span></pre><h1 id="b602" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">方法和类属性。</h1><p id="969b" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">类定义了其他方法来为它们添加功能。这些方法基本上都是函数。</p><p id="83a9" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">另一方面，类属性是通过在类体内分配变量来创建的，例如上面例子中的' bank_name '和' accs'。它们可以在类中访问。要访问这些属性，您将使用self$attribute参数，如上所述。</p><p id="94fa" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">为了构建我们的核心银行系统，我们需要一些方法来提供功能。此时，你将需要R函数的知识。</p><h1 id="bc20" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">TL；博士；医生</h1><h1 id="5b69" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">帐户创建方法。</h1><p id="bc53" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">为此，客户需要他/她的名、姓和身份证号。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="447e" class="ln in hi lj b fi lo lp l lq lr">create_account = <strong class="lj hj">function</strong>(FirstName=NULL,SecondName=NULL,IDNo=NULL) {<br/>    FirstName = readline(prompt = "Enter FirstName: ")<br/>    SecondName = readline(prompt = "Enter SecondName: ")<br/>    IDNo = readline(prompt = "Enter IDNo: ")<br/>    id_acc = <strong class="lj hj">private</strong>$account_setup(IDNo)<br/>    account_details = tibble("Full Name" = paste(FirstName,SecondName),"IDNo" = <strong class="lj hj">as</strong>.character(pluck(id_acc,'IDNo')),<br/>                             'AccountNo' = pluck(id_acc,'accno'),'AccountBalance' = 0,'LoanBalance' = 0)<br/>    <strong class="lj hj">self</strong>$accs = bind_rows(<strong class="lj hj">self</strong>$accs,account_details) %&gt;% filter(!is.na(IDNo))<br/>    cat(sprintf("Hi %s, welcome to %s.We look foward to doing business  with you!\nYour account number is %s",FirstName,account_details$AccountNo,self$bank_name))<br/>  }</span></pre><p id="c45f" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">上面的函数简单地创建了新创建的帐户的表格数据框，并将其添加到现有的帐户中。包含的其他属性如<code class="du ls lt lu lj b">private$</code>将在下面解释。</p><h1 id="1626" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">存款方法</h1><p id="e527" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">为了让我们的客户进行存款，我们将要求他们的贷款账户和金额按照下面的函数所示进行存款。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="65a4" class="ln in hi lj b fi lo lp l lq lr">make_deposit = <strong class="lj hj">function</strong>(acc=NULL,Amount=NULL){<br/>    acc = readline(prompt = "Enter acc ")<br/>    Amount = <strong class="lj hj">as</strong>.numeric(readline(prompt = "Enter Amount "))<br/>    <strong class="lj hj">private</strong>$check_acc(acc = acc,expr = {<br/>      <strong class="lj hj">self</strong>$accs = <strong class="lj hj">self</strong>$accs %&gt;% mutate(AccountBalance = ifelse(AccountNo == acc,AccountBalance+Amount,AccountBalance))<br/>      cat(glue("Dear Customer,your deposit of Ksh {Amount} was received successfully.Your current balance is Ksh {<br/>                   pull(filter(self$accs,AccountNo == acc),AccountBalance )}"))})<br/>  }</span></pre><p id="28dd" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">您可以注意到，在存款之后，有一条消息被发送到客户端。</p><h1 id="3917" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">撤回方法</h1><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="9720" class="ln in hi lj b fi lo lp l lq lr">make_withdrawal = <strong class="lj hj">function</strong>(acc=NULL,Amount=NULL){<br/>    acc = readline(prompt = "Enter acc ")<br/>    Amount =  <strong class="lj hj">as</strong>.numeric(readline(prompt = "Enter Amount "))<br/>    <strong class="lj hj">private</strong>$check_acc(acc = acc,expr = {<br/>      info = filter(<strong class="lj hj">self</strong>$accs,AccountNo == acc)<br/>      <strong class="lj hj">if</strong> ( (pull(info,AccountBalance) - 100) &gt; Amount ) {<br/>        <strong class="lj hj">self</strong>$accs &lt;- <strong class="lj hj">self</strong>$accs %&gt;% mutate(<br/>          AccountBalance = ifelse(AccountNo == acc,AccountBalance - Amount,AccountBalance)<br/>        )<br/>      }<strong class="lj hj">else</strong>{<br/>        message(paste(' ----------\n Dear ',pull(info,`Full Name`),',we are unable to process a your request due to low balance in your account.Please try a lower value'))<br/>      }<br/>    })<br/>    <br/>  }</span></pre><p id="0591" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">这里发生的事情的快速概述:为了取款成功，提供正确的帐户加上不会离开帐户少于Ksh 100的金额。</p><h1 id="771d" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">账户结余</h1><p id="8c33" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">为了检查帐户余额，我们只需要帐号，下面是一个简单的从所有帐户中筛选的方法。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="1765" class="ln in hi lj b fi lo lp l lq lr">check_balance = <strong class="lj hj">function</strong>(acc=NULL){<br/>    acc = readline(prompt = "Enter acc ")<br/>    <strong class="lj hj">private</strong>$check_acc(acc = acc,expr = {<br/>     balance =  <strong class="lj hj">self</strong>$accs %&gt;% filter(AccountNo == acc) %&gt;% pull(AccountBalance)<br/>     message(glue("--------------\n Dear Customer,your account balance is Ksh {balance}.\n--------------"))<br/>    })<br/>  }</span></pre><h1 id="de8d" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">贷款申请方法</h1><p id="0810" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">这种方法只是检查提供的帐号是否准确，检查客户是否有贷款，以避免多次贷款支出。</p><p id="ddce" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">注意，要访问客户端数据库，您需要包含所有客户端列表的<code class="du ls lt lu lj b">self$accs</code>。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="3541" class="ln in hi lj b fi lo lp l lq lr">request_loan = <strong class="lj hj">function</strong>(acc=NULL,Amount=NULL){<br/>    acc = readline(prompt = "Enter acc ")<br/>    Amount =  <strong class="lj hj">as</strong>.numeric(readline(prompt = "Enter Amount "))<br/>    <strong class="lj hj">private</strong>$check_acc(acc = acc,expr = {<br/>      info = filter(<strong class="lj hj">self</strong>$accs,AccountNo == acc)<br/>      <strong class="lj hj">if</strong> ( (pull(info,LoanBalance)) &lt;= 0 ) {<br/>        <strong class="lj hj">self</strong>$accs = <strong class="lj hj">self</strong>$accs %&gt;% mutate(LoanBalance = ifelse(AccountNo == acc,Amount,LoanBalance))<br/>        cat(glue("Dear Customer,your loan request of Ksh {Amount} was processed successfully.<br/>                 Your outstanding loan balance is Ksh {pull(filter(self$accs,AccountNo == acc),LoanBalance )}"))<br/>      }<strong class="lj hj">else</strong>{<br/>        message(glue("Dear Customer,your loan request of Ksh {Amount} was not successfull.<br/>                     Please clear your outstanding loan balance of Ksh {pull(filter(self$accs,AccountNo == acc),LoanBalance )}."))<br/>      }<br/>    })<br/>  }</span></pre><h1 id="911e" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">贷款偿还</h1><p id="6a53" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">同上，我们只需要要还款的账号和金额。如果金额大于余额，超出的金额将被添加到跨国账户余额中。</p><p id="6691" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">如果客户试图偿还现有的贷款，程序关闭，交易取消。</p><p id="e3f1" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">不错吧。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="097b" class="ln in hi lj b fi lo lp l lq lr">repay_loan = <strong class="lj hj">function</strong>(acc=NULL,Amount=NULL) {<br/>    acc = readline(prompt = "Enter acc ")<br/>    Amount =  <strong class="lj hj">as</strong>.numeric(readline(prompt = "Enter Amount "))<br/>    <strong class="lj hj">private</strong>$check_acc(acc = acc,expr = {<br/>      info = filter(<strong class="lj hj">self</strong>$accs,AccountNo == acc)<br/>      <strong class="lj hj">if</strong> ((pull(info,LoanBalance)) &gt; 0 ) {<br/>        <strong class="lj hj">self</strong>$accs = <strong class="lj hj">self</strong>$accs %&gt;% mutate(LoanBalance = ifelse(AccountNo == acc,LoanBalance-Amount,LoanBalance),<br/>                                         AccountBalance = ifelse((AccountNo == acc) &amp; (LoanBalance&lt;0),abs(LoanBalance)+AccountBalance,AccountBalance ),<br/>                                         LoanBalance = ifelse(LoanBalance &lt; 0 ,0,LoanBalance))<br/>        <strong class="lj hj">if</strong> ( (pull(info,LoanBalance)) &gt;= Amount ) {<br/>          <br/>          cat(glue("Dear Customer,your loan payment of Ksh {Amount} was processed successfully.Your outstanding loan balance is Ksh {<br/>                   pull(filter(self$accs,AccountNo == acc),LoanBalance )}"))<br/>        }<strong class="lj hj">else</strong>{<br/>          cat(glue("Dear Customer,your loan payment of Ksh {Amount} was processed successfully.Your loan is cleared,extra amount of Ksh {abs((pull(info,LoanBalance)) - Amount)} was deposited in your transactional account"))<br/>        }<br/>      }<strong class="lj hj">else</strong>{<br/>        message("Dear Customer,you do not have an existing loan.")<br/>      }<br/>    })<br/>  }</span></pre><h1 id="91cd" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">检查贷款余额</h1><p id="577f" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">工作原理与账户余额检查相同。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="b6e6" class="ln in hi lj b fi lo lp l lq lr">check_loan_balance = <strong class="lj hj">function</strong>(acc=NULL){<br/>    acc = readline(prompt = "Enter acc ")<br/>    <strong class="lj hj">private</strong>$check_acc(acc = acc,expr = {<br/>      balance =  <strong class="lj hj">self</strong>$accs %&gt;% filter(AccountNo == acc) %&gt;% pull(LoanBalance)<br/>      cat(glue("--------------\n Dear Customer,your loan account balance is Ksh {balance}.\n--------------"))<br/>    })<br/>  }</span></pre><h1 id="9ee9" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">在控制台方法中模拟USSD</h1><p id="f046" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">您希望通过对此类的一次调用来访问所有这些方法。我们将使用<code class="du ls lt lu lj b">self$method</code>参数访问类中的所有方法。</p><p id="8886" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">为了提高效率，刚注册的新客户会被直接带到菜单上。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="abbf" class="ln in hi lj b fi lo lp l lq lr">get_services = <strong class="lj hj">function</strong>(acc = NULL) {<br/>    <strong class="lj hj">if</strong> (is.<strong class="lj hj">null</strong>(acc)) {<br/>      cat('Welcome to ABC Banking Services!\nSelect\n1:Create new account\n2:Deposit\n3:Withdraw\n4:Request Loan\n5:Repay Loan\n6:My Account Balance\n7:My Loan Balance')<br/>      input &lt;- readline(prompt="Enter here: ") <br/>      <strong class="lj hj">switch</strong> (<strong class="lj hj">as</strong>.character(input),<br/>              "1" = <strong class="lj hj">self</strong>$create_account(),"2" = <strong class="lj hj">self</strong>$make_deposit(),"3" = <strong class="lj hj">self</strong>$make_withdrawal(),<br/>              "4" = <strong class="lj hj">self</strong>$request_loan(),"5" = <strong class="lj hj">self</strong>$repay_loan(),"6" = <strong class="lj hj">self</strong>$check_balance(),"7" = <strong class="lj hj">self</strong>$check_loan_balance()<br/>      )<br/>    }<strong class="lj hj">else</strong>{<br/>      cat(paste('-----------\nSelect\n1:Deposit\n2:Withdraw\n3:Request Loan\n4:Repay Loan\n5:My Account Balance\n6:My Loan Balance'))<br/>      input &lt;- readline(prompt="Enter here: ") <br/>      <strong class="lj hj">switch</strong> (<strong class="lj hj">as</strong>.character(input),<br/>              "1" = <strong class="lj hj">self</strong>$make_deposit(),"2" = <strong class="lj hj">self</strong>$make_withdrawal(),"3" = <strong class="lj hj">self</strong>$request_loan(),"4" = <strong class="lj hj">self</strong>$repay_loan(),<br/>              "5" = <strong class="lj hj">self</strong>$check_balance(),"6" = <strong class="lj hj">self</strong>$check_loan_balance()<br/>      )<br/>    }<br/>   <br/>  }</span></pre><h1 id="fa56" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">控制对方法的访问。</h1><p id="a9b6" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">R6类有两种控制访问的主要方法。这些是类参数的一部分，但不是</p><ol class=""><li id="42b5" class="ko kp hi jm b jn ki jr kj jv kq jz kr kd ks kh kt ku kv kw bi translated"><code class="du ls lt lu lj b">private</code>:可选的私有成员列表，可以是函数，也可以是非函数。为了访问这些方法，我们使用<code class="du ls lt lu lj b">private$method</code>或<code class="du ls lt lu lj b">private$attribute</code>参数。</li></ol><p id="ef17" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">在我们的模型中，我们可以看到我们调用了<code class="du ls lt lu lj b">private$check_acc</code>和<code class="du ls lt lu lj b">private$account_setup</code>方法。让我们解释一下他们在这里做什么。</p><h1 id="debf" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">私有方法:帐户_设置</h1><p id="8ecb" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">此函数生成新的帐号，并检查它是否与以前生成的任何帐号相似。如果这是真的，它会再次生成，直到生成一个唯一的。这确保了生成的帐号是唯一的。该功能还检查客户是否试图用同一个身份证号码注册两次。如果是，则提示客户端输入新密码。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="b37e" class="ln in hi lj b fi lo lp l lq lr">account_setup = <strong class="lj hj">function</strong>(IDNo) {<br/>    <strong class="lj hj">if</strong> (nrow(filter(<strong class="lj hj">self</strong>$accs,!is.na(IDNo)) &gt; 0 )) {<br/>      accno =  paste0("00",substr(paste0(sample(1:100, 12, replace=F),collapse = ""),1,9))<br/>      <strong class="lj hj">while</strong> (accno %in% <strong class="lj hj">self</strong>$accs$AccountNo) {<br/>        accno = <strong class="lj hj">as</strong>.character(rstudioapi::showPrompt(title = "IDNo",message = "Enter here"))<br/>      }<br/>    }<strong class="lj hj">else</strong>{<br/>      accno =  paste0("00",substr(paste0(sample(1:100, 12, replace=F),collapse = ""),1,9))<br/>    }<br/>    <em class="lv"># check if user exists</em><br/>    <strong class="lj hj">if</strong> (nrow(filter(<strong class="lj hj">self</strong>$accs,!is.na(IDNo)) &gt; 0 )) {<br/>      <strong class="lj hj">while</strong> (IDNo %in% <strong class="lj hj">self</strong>$accs$IDNo) {<br/>        IDNo = <strong class="lj hj">as</strong>.character(rstudioapi::showPrompt(title = "IDNo",message = "That ID already exists,Enter correct IDNo "))<br/>      }<br/>    }<strong class="lj hj">else</strong>{<br/>      IDNo = IDNo<br/>    }<br/>    out = <strong class="lj hj">list</strong>(<br/>      'IDNo' = IDNo,<br/>      'accno' = accno<br/>    )<br/>    <strong class="lj hj">return</strong>(out)<br/>  }</span></pre><h1 id="d502" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">私有方法:check_acc</h1><p id="5783" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">对于任何交易，我们都需要一个账号。因此，使用private方法中定义的一个函数来检查输入的帐户的有效性是很重要的，如图所示。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="8de4" class="ln in hi lj b fi lo lp l lq lr">check_acc = <strong class="lj hj">function</strong>(acc,expr={...}) {<br/>       <strong class="lj hj">if</strong> (acc %in% <strong class="lj hj">self</strong>$accs$AccountNo) {<br/>         expr<br/>       }<strong class="lj hj">else</strong>{<br/>         message("Account Supplied doesn't exist!")<br/>       }<br/>     }</span></pre><h1 id="6d1e" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">最终计划</h1><p id="636f" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">到目前为止，下面是这个类中所有方法和属性的组合。</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="lx ly l"/></div></figure><p id="cb26" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">我们再实例化一下。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="b832" class="ln in hi lj b fi lo lp l lq lr">ABCBank &lt;- CBS$new(bank_name = "ABC Bank")</span><span id="dc5e" class="ln in hi lj b fi lw lp l lq lr"><strong class="lj hj">#</strong><em class="lv">#  --------- </em><br/><strong class="lj hj">#</strong><em class="lv">#  This is  ABC Bank . </em><br/><strong class="lj hj">#</strong><em class="lv">#  ---------</em></span></pre><h1 id="c06c" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">反省</h1><p id="fbad" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">我们总是可以使用<code class="du ls lt lu lj b">class</code>函数检查我们的类，并使用<code class="du ls lt lu lj b">names</code>函数从实例化中获取一个类中包含的所有方法的列表，如下所示。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="e2e2" class="ln in hi lj b fi lo lp l lq lr"><strong class="lj hj">class</strong>(<strong class="lj hj">ABCBank</strong>)</span><span id="4ee2" class="ln in hi lj b fi lw lp l lq lr"><strong class="lj hj">## [1] "CBS" "R6"</strong></span></pre><p id="ed89" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">我们可以看到，它表明我们的实例来自CBS类，它继承自R6类。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="a08d" class="ln in hi lj b fi lo lp l lq lr">names(ABCBank)</span><span id="b817" class="ln in hi lj b fi lw lp l lq lr"><strong class="lj hj">##  [1] ".__enclos_env__"    "bank_name"          "accs"              </strong><br/><strong class="lj hj">##  [4] "clone"              "get_services"       "check_loan_balance"</strong><br/><strong class="lj hj">##  [7] "repay_loan"         "request_loan"       "check_balance"     </strong><br/><strong class="lj hj">## [10] "make_withdrawal"    "make_deposit"       "create_account"    </strong><br/><strong class="lj hj">## [13] "initialize"</strong></span></pre><p id="62a8" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">这里列出了上面讨论的所有方法。</p><p id="63ef" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">让我们看一个简单的系统例子。</p><p id="13bd" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">要交互地使用这个系统，运行上面的类，实例化然后调用<code class="du ls lt lu lj b">get_services</code>方法。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="39ff" class="ln in hi lj b fi lo lp l lq lr">ABCBank$get_services()</span><span id="e311" class="ln in hi lj b fi lw lp l lq lr"><strong class="lj hj">#</strong><em class="lv"># Welcome to ABC Banking Services!</em><br/><strong class="lj hj">#</strong><em class="lv"># Select</em><br/><strong class="lj hj">#</strong><em class="lv"># 1:Create new account</em><br/><strong class="lj hj">#</strong><em class="lv"># 2:Deposit</em><br/><strong class="lj hj">#</strong><em class="lv"># 3:Withdraw</em><br/><strong class="lj hj">#</strong><em class="lv"># 4:Request Loan</em><br/><strong class="lj hj">#</strong><em class="lv"># 5:Repay Loan</em><br/><strong class="lj hj">#</strong><em class="lv"># 6:My Account Balance</em><br/><strong class="lj hj">#</strong><em class="lv"># 7:My Loan Balance<br/>Enter here:</em></span></pre><h1 id="943d" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">最后。</h1><p id="df9c" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">需要注意的是，当在类中定义一个方法时，你<strong class="jm hj"> <em class="lv">没有使用</em> </strong> <code class="du ls lt lu lj b">&lt;-</code>操作符进行赋值，而是使用了标准的<code class="du ls lt lu lj b">=</code>符号。</p><p id="66b4" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">我将在下一篇博客中写R  中的类<strong class="jm hj"> <em class="lv">继承和其他OOP概念。您可以自由地复制这个脚本，并在R studio控制台上使用它。</em></strong></p><p id="bb34" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">自从在R中得到了OOP的要领，我的R编程质量真的提高了。你也可以试一试:)</p><p id="3ce4" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">如果你觉得这很有趣或者你发现了一个错误，请告诉我。</p><p id="66ee" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">你可以在这里找到一个干净的脚本<a class="ae kn" href="https://gist.github.com/GeorgeOduor/22a818b678777dc03d1e07210d7f6d94" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="28be" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated"><strong class="jm hj">最佳</strong></p></div></div>    
</body>
</html>