<html>
<head>
<title>Automating Emails with Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Go自动处理电子邮件</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/automating-emails-with-go-587a87b1f298?source=collection_archive---------12-----------------------#2021-09-10">https://medium.com/geekculture/automating-emails-with-go-587a87b1f298?source=collection_archive---------12-----------------------#2021-09-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="48e2" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如何使用Go标准库发送HTML邮件</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/d72d0e3eaefb4eba4b7f1707c00b037b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xTbM_unbOXGwOChP"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@hostreviews?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Stephen Phillips - Hostreviews.co.uk</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="07f0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我在7月份开始学习围棋，以支持我从高级QA工程师向软件工程师职位的过渡。在此期间，我通过大量的课程、书籍和文章来学习这门语言的来龙去脉。然而，学习语言不仅仅是简单的阅读和观看视频；真正精通需要<strong class="jq hj"> <em class="kk">做</em> </strong>。</p><p id="aa3c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">考虑到这一点，我开始寻找需要解决的项目，以锻炼我新发现的对围棋的热爱。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h1 id="10bc" class="ks kt hi bd ku kv kw kx ky kz la lb lc io ld ip le ir lf is lg iu lh iv li lj bi translated">梦幻足球和Go</h1><p id="de48" class="pw-post-body-paragraph jo jp hi jq b jr lk ij jt ju ll im jw jx lm jz ka kb ln kd ke kf lo kh ki kj hb bi translated">自2016年以来，我一直在玩梦幻足球，最初是一个单一的联赛，后来扩大到每年三个。今年，我迈出了下一步，担任Pendo第五季的专员。作为这种改变的一部分，我想通过给我的球员提供一些特别的东西来纪念我领导一个梦幻联盟的第一个赛季，这是一份涵盖我们联盟新闻和笔记的每周文摘。</p><p id="f52a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我最初的想法是每周给联盟中的每个球员发一封电子邮件。在制定阶段，我会写一封基本的文本电子邮件，然后通过输入从谷歌表单收集的电子邮件，手动将它逐个发送给每个团员。三个联盟有36名成员，这注定是乏味的。</p><p id="5062" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">那么，我该如何加快这个过程呢？</p><p id="c4eb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">答案？走吧。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h1 id="3591" class="ks kt hi bd ku kv kw kx ky kz la lb lc io ld ip le ir lf is lg iu lh iv li lj bi translated">导入CSV</h1><p id="7821" class="pw-post-body-paragraph jo jp hi jq b jr lk ij jt ju ll im jw jx lm jz ka kb ln kd ke kf lo kh ki kj hb bi translated">我要做的第一件事是从谷歌表单中导入数据，因为我肯定不会手动将36封电子邮件输入Gmail。最简单的方法是以CSV格式下载表单，然后导入。</p><p id="052a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们在本教程中使用这个CSV:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lp lq l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">players.csv</figcaption></figure><p id="68ce" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">谢天谢地，我在Udemy上学习托德·麦克劳德的<a class="ae jn" href="https://www.udemy.com/course/go-programming-language/" rel="noopener ugc nofollow" target="_blank">用谷歌的Go编程语言进行网络开发</a>课程时，已经学会了导入CSV文件。</p><p id="4872" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们需要做的第一件事是创建一个函数，它接受我们目录中CSV文件的文件名。然后使用标准的<code class="du lr ls lt lu b">os</code>包打开文件。然后，我们可以使用新打开的文件作为<code class="du lr ls lt lu b">csv</code>包的阅读器来生成一个新的CSV阅读器。</p><p id="22fd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦完成，我们使用<code class="du lr ls lt lu b">readAll</code>方法收集CSV文件的所有行，然后遍历。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="05fa" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">运行此命令将返回包含行数据的切片的切片。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lp lq l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Output from printing rows.</figcaption></figure><p id="dbca" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以通过思考我们的数据是如何构成的来清理这个问题。每个切片包含一个球员的名字和电子邮件。我们可以使用该信息创建一个结构，然后创建该结构的一个空片段。这允许我们在代码中使用点符号。</p><p id="6f2c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦我们遍历了我们的行，我们就可以将行数据添加到一个struct文本中，并将其追加到我们的空切片中。最后，我们从函数中返回切片。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lp lq l"/></div></figure><h1 id="595d" class="ks kt hi bd ku kv lv kx ky kz lw lb lc io lx ip le ir ly is lg iu lz iv li lj bi translated">发送电子邮件</h1><p id="55a8" class="pw-post-body-paragraph jo jp hi jq b jr lk ij jt ju ll im jw jx lm jz ka kb ln kd ke kf lo kh ki kj hb bi translated">现在我们有了数据，我们可以用它来发送电子邮件。为此，我们将使用<code class="du lr ls lt lu b">net/smtp</code>包。我按照基本教程进行了设置。</p><p id="f498" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们需要做的第一件事是创建一个发送电子邮件的函数，在函数中导入我们的CSV，然后遍历我们的数据。接下来，我们将为服务器构建一个结构，然后添加一个构建地址的方法。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="7ada" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们现在可以构建一个包含发件人、收件人、主题和正文的邮件头。我们将在发送电子邮件时使用它。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="f352" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">电子邮件必须以字节发送，所以我们将字符串转换成字节，然后返回。我们现在可以构建我们的授权并使用<code class="du lr ls lt lu b">net/smtp</code>包发送一封基本的电子邮件。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="60c4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">运行该程序将会发送一封电子邮件，如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ma"><img src="../Images/016485a32eb7d4baebac62f897678879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ylN6FmNEorjzZI68XwLsQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">I clearly need to check my email more often.</figcaption></figure><p id="c697" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这看起来不太好，是吗？</p><p id="c0be" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以通过发送HTML电子邮件来稍微修饰一下。为此，我们需要修改现有的代码，使其解析HTML模板，然后将模板作为电子邮件正文插入。HTML电子邮件允许我们使用公司徽标等图像，以及更吸引人的电子邮件样式。</p><h1 id="d79f" class="ks kt hi bd ku kv lv kx ky kz lw lb lc io lx ip le ir ly is lg iu lz iv li lj bi translated">设计和解析模板</h1><p id="496b" class="pw-post-body-paragraph jo jp hi jq b jr lk ij jt ju ll im jw jx lm jz ka kb ln kd ke kf lo kh ki kj hb bi translated">首先，我们需要设计一个HTML模板。虽然我已经很多年没有在前端工作了，但是我想我仍然理解基本的HTML。</p><p id="47e6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们将从添加<code class="du lr ls lt lu b">style</code>标签开始，这样我们可以使我们的电子邮件移动友好。我们最不想做的事情就是给一个无法在所有设备上阅读的用户发送电子邮件。理想情况下，我们希望我们的内容位于页面中间，占据大约33%的屏幕空间。这样，读者不必为了阅读邮件内容而扫描整个屏幕。然而在手机上，我们希望内容占据整个屏幕。</p><p id="44ac" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦样式完成，我们就可以开始向主体添加标题和内容了。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lp lq l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">A mobile-friendly email template.</figcaption></figure><p id="aa70" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">既然我们的模板已经构建好了，我们将继续构建一个函数来解析模板，并将结果作为电子邮件正文发送出去。为此，我们需要使用Go的标准库中的<code class="du lr ls lt lu b">html/template</code>包。</p><p id="65f2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以使用<code class="du lr ls lt lu b">ParseFiles</code>函数加载一个模板文件，然后使用<code class="du lr ls lt lu b">bytes</code>包生成一个新的缓冲区。缓冲区实现了<code class="du lr ls lt lu b">io.Writer</code>接口，允许它在模板<code class="du lr ls lt lu b">Execute</code>方法中使用。最后，我们将使用缓冲区的<code class="du lr ls lt lu b">String</code>方法来返回模板的字符串版本。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="fa09" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">将所有这些放在一起，您就可以发送如下所示的电子邮件:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mb"><img src="../Images/46e1367a5c5857ff2545f1424c9f5fa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SNIdAZeYypn9gcARjPxM2g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">The most recent edition of Pendo’s Fantasy Football Digest.</figcaption></figure></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h1 id="50b5" class="ks kt hi bd ku kv kw kx ky kz la lb lc io ld ip le ir lf is lg iu lh iv li lj bi translated">摘要</h1><p id="858b" class="pw-post-body-paragraph jo jp hi jq b jr lk ij jt ju ll im jw jx lm jz ka kb ln kd ke kf lo kh ki kj hb bi translated">使用Go强大的标准库可以轻松发送一批电子邮件。<code class="du lr ls lt lu b">encoding/csv</code>包允许我们读取CSV文件，而<code class="du lr ls lt lu b">net/smtp</code>包让我们能够发送基本的电子邮件。有了<code class="du lr ls lt lu b">html/template</code>，我们可以解析丰富的HTML模板电子邮件，以获得更加动态的邮件。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><p id="473b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> Jonathan Thompson </strong>是Pendo.io后端的一名助理软件工程师。他目前与妻子和一位名叫Winston的金发女郎居住在北卡罗来纳州罗利。你可以在<a class="ae jn" href="https://www.linkedin.com/in/jonathanmnthompson/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上与他联系，或者在<a class="ae jn" href="https://twitter.com/jacks_elsewhere" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae jn" href="http://github.com/ThompsonJonM" rel="noopener ugc nofollow" target="_blank"> Github </a>上关注他。</p></div></div>    
</body>
</html>