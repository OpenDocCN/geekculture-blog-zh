<html>
<head>
<title>Custom View Controllers Transitions in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift中的自定义视图控制器转换</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/custom-view-controllers-transitions-aa8c052f8049?source=collection_archive---------1-----------------------#2021-04-27">https://medium.com/geekculture/custom-view-controllers-transitions-aa8c052f8049?source=collection_archive---------1-----------------------#2021-04-27</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><div class=""><h2 id="ba49" class="pw-subtitle-paragraph ig hi hj bd b ih ii ij ik il im in io ip iq ir is it iu iv iw ix dy translated">通过创建您自己的过渡来提升您的应用程序UX</h2></div><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et iy"><img src="../Images/0c9fa03188d7a4c4b9e80d59c05ea72f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wc3MgXJ00mrdGO_-8vJXTw.jpeg"/></div></div><figcaption class="jk jl eu es et jm jn bd b be z dy">Photo by <a class="ae jo" href="https://unsplash.com/@euwars?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Farzad Nazifi</a> on <a class="ae jo" href="https://unsplash.com/s/photos/mobile-developer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ed2c" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">这可能是iOS开发中最被低估的主题之一，也是最难掌握的主题之一。当你在开发技能方面有了一些坚实的基础，你就会开始挖掘更高级的功能，比如动画。如果你经常使用Instagram、脸书、Airbnb、Spotify等最受欢迎的应用程序。，你大概开始用开发者的眼光看他们了。那就是质疑事物是如何工作的，他们使用什么类型的架构，动画和过渡是如何如此流畅，等等。</p><p id="479c" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">当你玩这类应用程序时，你肯定会注意到，当一个新的视图控制器出现时，它很少使用默认的<strong class="jr hk"> pushViewController </strong>动画。取而代之的是，他们用一些很酷的动画来定制过渡。当我们试图吸引用户使用应用程序时，这是一个非常重要的价值。</p><p id="604e" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">对于这篇文章，我准备了一个简单的应用程序，其中有几张AC/DC的专辑(为了简单起见，我只添加了两张)。当你点击一张专辑时，它会带你到一个新的视图，里面有该专辑的歌曲。</p><p id="ee1f" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">因此，我想向您展示我们如何在视图控制器之间进行这种自定义转换。</p><figure class="iz ja jb jc fe jd es et paragraph-image"><div class="es et kl"><img src="../Images/4ff62b66cd4dc3ed532902533d03da66.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/1*GHYwvjlZBCB9mm7091yPgg.gif"/></div></figure></div><div class="ab cl km kn gq ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="hc hd he hf hg"><p id="36c0" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">所以我们先从一些基本概念开始。每当我们推送一个新的视图控制器时，<strong class="jr hk"> UIKit </strong>会询问<strong class="jr hk"> UINavigationController的</strong>代表是否有一个自定义的转换来调用这个函数:</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="kt ku l"/></div></figure><p id="c8c4" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">如果委托没有实现或者返回值为零，那么我们将得到默认的视图控制器的推送和弹出行为。相反，如果我们返回一个<strong class="jr hk">UIViewControllerAnimatedTranistion</strong>对象，<strong class="jr hk"> UIKit </strong>将使用该对象制作动画。</p><p id="636f" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">如果你看一下<strong class="jr hk">UIViewControllerAnimatedTransition</strong>协议，你会发现我们只需要实现两个功能:</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="kt ku l"/></div></figure><p id="2cdb" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">在第一个例子中，我们返回转换的持续时间。</p><p id="e274" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">在第二个是魔术发生的时候=)。这里我们可以从视图控制器(初始视图控制器)访问<strong class="jr hk">，也可以从<strong class="jr hk">访问视图控制器</strong>(转换后的视图控制器)。</strong></p></div><div class="ab cl km kn gq ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="hc hd he hf hg"><p id="d1b0" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">我们需要做的第一件事是创建一个实现<strong class="jr hk">UIViewControllerAnimatedTransition</strong>协议的类。</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="kt ku l"/></div></figure><p id="7fd3" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">我们知道我们需要在animateTransition函数中制作过渡动画。首先，我们必须访问转换的上下文视图。您可以将上下文视图视为在动画仍在运行时将出现在“从视图”控制器的视图和“到视图”控制器的视图之间的视图。这个上下文视图只是一个空视图。它没有任何东西在里面，所以我们需要添加元素，我们想在我们的过渡动画。</p><p id="17b8" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">在我们的项目中，我们将制作以下视图的动画:</p><ol class=""><li id="af02" class="kv kw hj jr b js jt jv jw jy kx kc ky kg kz kk la lb lc ld bi translated">集合视图单元格的内容视图。</li><li id="ca80" class="kv kw hj jr b js le jv lf jy lg kc lh kg li kk la lb lc ld bi translated">专辑封面图片。</li></ol><p id="558d" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">如果你看演示，你会注意到，当我们点击一个相册，它的内容视图扩展并满足屏幕，同时封面图像移动到视图的顶部，同时它的形状从圆形变为方形。</p><p id="823e" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">当我们向containerView添加一些视图时，我们必须给它正确的框架，以匹配它在视图控制器视图中的确切位置。为此，我们可以使用<strong class="jr hk"> convert(_ rect: CGRect，from coordinate space:UICoordinateSpace)-&gt;CG rect</strong>函数。</p><p id="1fa0" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">最后但同样重要的是，我们需要复制我们想要制作动画的视图的所有属性，以便复制它们在原始视图中的相同布局。</p><p id="eca7" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">让我们结束这一切，开始编写我们的动画转换函数。</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="kt ku l"/></div></figure><ol class=""><li id="e374" class="kv kw hj jr b js jt jv jw jy kx kc ky kg kz kk la lb lc ld bi translated">获取初始视图控制器(引用为fromViewController)并将其转换为一个<strong class="jr hk"> AlbumsViewController </strong>类型。</li><li id="8cd2" class="kv kw hj jr b js le jv lf jy lg kc lh kg li kk la lb lc ld bi translated">获取最终的视图控制器(引用为toViewController)并将其转换为一个<strong class="jr hk">AlbumDetailViewController</strong>类型。</li><li id="e2ac" class="kv kw hj jr b js le jv lf jy lg kc lh kg li kk la lb lc ld bi translated">获取集合的当前单元格。在AlbumsViewController中，每当用户在相册之间滚动时，我们都会更新该属性。</li><li id="4091" class="kv kw hj jr b js le jv lf jy lg kc lh kg li kk la lb lc ld bi translated">从当前单元格获取相册封面图像。</li><li id="50f0" class="kv kw hj jr b js le jv lf jy lg kc lh kg li kk la lb lc ld bi translated">获取AlbumDetailViewController的标题视图。在这个标题视图中，我们放置了封面图像。因此，我们需要访问这个视图来获得图像的最终位置。</li><li id="9f11" class="kv kw hj jr b js le jv lf jy lg kc lh kg li kk la lb lc ld bi translated">我们得到了上下文容器视图。这是我们将用于过渡的视图</li><li id="d14d" class="kv kw hj jr b js le jv lf jy lg kc lh kg li kk la lb lc ld bi translated">我们需要添加最终视图(AlbumDetailViewController的视图)。当动画完成后，这就是将要留下的。如果我们不添加它，我们将得到一个黑屏结束。</li><li id="74b5" class="kv kw hj jr b js le jv lf jy lg kc lh kg li kk la lb lc ld bi translated">在整个转换完成之前，视图需要保持隐藏。</li></ol><p id="1985" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">现在我们已经准备好了容器视图，我们可以开始制作动画了。</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="kt ku l"/></div></figure><p id="dd00" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">对于我们想要进行的过渡，我们只需要改变动画块内的视图帧。此外，我们将相册图像视图层的圆角半径设置为零，因此我们在第一个屏幕中的圆形边框会在过渡中平滑地消失。</p><p id="ca8d" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">在完成块中，我们需要显示AlbumDetailController的视图，然后删除我们为动画添加的快照。最后，我们告诉上下文转换已经完成。</p></div><div class="ab cl km kn gq ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="hc hd he hf hg"><p id="8b60" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">现在我们已经准备好开始使用我们的定制转换了。但是首先，我们必须实现<strong class="jr hk"> navigationController的</strong>委托来告诉<strong class="jr hk"> UIKit </strong>现在它必须使用我们的<strong class="jr hk"> TransitionManager </strong>类来动画化转换，而不是默认行为。</p><p id="1448" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">我们有几个选择来做这件事。我们可以在<strong class="jr hk"> AlbumsViewController </strong>中实现委托，并返回<strong class="jr hk"> TransitionManager </strong>的一个实例。</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="kt ku l"/></div></figure><p id="6ec9" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">另一种选择是在TransitionManager内部实现委托，并在AlbumsViewController中将TransitionManager设置为navigationController的委托。</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="kt ku l"/></div></figure><p id="e8b9" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">有了这些，现在您就有了自己的定制过渡。我在这里展示了一个简单的过渡动画，但是您可以从一个视图控制器到另一个视图控制器制作任何您想要的动画。</p></div><div class="ab cl km kn gq ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="hc hd he hf hg"><p id="97e3" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">这在开始时可能会让人不知所措，但是一旦你完全理解了过渡的关键概念，你就只需要担心你想要执行的动画了。想象一下你想在转换中完成什么，然后认为大部分工作将在<strong class="jr hk"> func animateTransition(使用transition context:uiviewcontrolercontexttransitioning)</strong>函数中完成。</p><p id="f741" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">在这篇文章中，我介绍了push操作，pop操作非常相似，我们只需要对代码做一些小的调整。如果你对第二部分感兴趣，请告诉我。</p><p id="2b85" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">感谢阅读！我希望这对你有帮助。如果你愿意，你可以在这里查看完整的项目<a class="ae jo" href="https://github.com/blorenzo10/custom-transitions" rel="noopener ugc nofollow" target="_blank"/>。如果你有任何问题，给我留言，我很乐意帮忙。</p></div></div>    
</body>
</html>