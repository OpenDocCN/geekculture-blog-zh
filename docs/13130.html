<html>
<head>
<title>Confluent Platform: Kafka Security</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">融合平台:卡夫卡安全</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/confluent-platform-kafka-security-daec286f612d?source=collection_archive---------7-----------------------#2022-06-19">https://medium.com/geekculture/confluent-platform-kafka-security-daec286f612d?source=collection_archive---------7-----------------------#2022-06-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="5710" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">认证+授权+加密</h2><div class=""/><div class=""><h2 id="5d62" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">JAAS配置+ ACL +安全套接字层</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/aec44485fc7034cf703155ff4d2b298f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*xHgyW-DmG_4I5DR-xzwMRw.gif"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Confluent Platform: Kafka Security Architecture</figcaption></figure><h1 id="4285" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">范围</h1><p id="c328" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">写这篇文章是为了帮助初学者和中级到T3的T2了解Kafka安全架构。它涵盖了以下概念和实际实现。实现代码可以在<a class="ae ll" href="https://github.com/ganesh-nag/Confluent-Kafka-Security" rel="noopener ugc nofollow" target="_blank"> GitHub </a>看到。</p><p id="2c9b" class="pw-post-body-paragraph ko kp hi kq b kr lm is kt ku ln iv kw kx lo kz la lb lp ld le lf lq lh li lj hb bi translated">a.简单认证和安全层框架(SASL) <br/> b. <em class="lk"> SASL普通</em>带传输层安全(TLS)的机制 为了加密<br/> c .在Zookeeper节点<br/> d. <em class="lk"> JAAS </em>配置用<em class="lk"> KafkaServer </em>段设置<em class="lk"> SASL ACL </em>为Broker <br/> e. <em class="lk"> JAAS </em>配置用<em class="lk"> Client </em>段认证SASL与Zookeeper的连接<br/> f. <em class="lk"> JAAS </em>生产者和消费者与Broker <br/> g. Enable【启用</p><h1 id="b789" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">先决条件(尝试本练习)</h1><p id="7587" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">a.融合平台v7.1.1 <br/> b. Ubuntu v20.04(或)您选择的任何Linux发行版<br/> c. OpenSSL和Keytool <br/> d. Java v1.8(或)以上<br/> e. Spring Boot框架</p><h1 id="1429" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">Kafka是如何实现认证和授权的？</h1><h2 id="c984" class="lr jx hi bd jy ls lt lu kc lv lw lx kg kx ly lz ki lb ma mb kk lf mc md km ho bi translated">证明</h2><p id="327c" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">为了使Kafka Broker/Kafka Server与其他Kafka Broker节点、Zookeeper节点、生产者和消费者相互通信，使用JAAS登录模块和认证凭证来实现JAAS配置。<br/>在JAAS配置文件中，<em class="lk"> KafkaServer </em>部分、<em class="lk"> Client </em>部分和<em class="lk"> KafkaClient </em>部分分别表示用于针对Kafka经纪人、动物园管理员和生产者/消费者进行认证的凭证。</p><h2 id="5b20" class="lr jx hi bd jy ls lt lu kc lv lw lx kg kx ly lz ki lb ma mb kk lf mc md km ho bi translated">批准</h2><p id="df0b" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">生产者和消费者使用ACL(访问控制列表)进行授权。要实现授权，保护Zookeeper是当务之急。Kafka将所有ACL存储在Zookeeper中，只有<em class="lk">管理员</em>拥有创建/描述/修改/删除的完全权限。<br/> <strong class="kq hs"> <em class="lk"> kafka-acls </em> </strong>工具可用于允许访问主体对某个主题的创建/写入/删除/描述/读取等操作。<br/> Apache Kafka提供开箱即用、可插拔的<strong class="kq hs"> <em class="lk">授权器</em> </strong>实现，使用Zookeeper存储所有ACL。设置ACL是很重要的，否则当配置了授权者时，对资源的访问被限制为超级用户。访问控制列表(ACL)为您的企业集群数据提供了重要的授权控制。</p><h2 id="e957" class="lr jx hi bd jy ls lt lu kc lv lw lx kg kx ly lz ki lb ma mb kk lf mc md km ho bi translated">什么是授权人？</h2><p id="c530" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">授权器是Apache Kafka用来授权操作的服务器插件。授权者根据主体和被访问的资源控制是否授权操作。默认的Kafka授权器实现是<em class="lk">ACL authorizer</em><strong class="kq hs"><em class="lk">(Kafka . security . authorizer . ACL authorizer)</em></strong>，在Apache Kafka 2.4/Confluent Platform 5 . 4 . 0中引入。<br/> <em class="lk">授权人</em>应在Kafka Broker属性中启用。</p><p id="484b" class="pw-post-body-paragraph ko kp hi kq b kr lm is kt ku ln iv kw kx lo kz la lb lp ld le lf lq lh li lj hb bi translated"><em class="lk">下面的序列图显示了ACL是如何加载的。</em></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es me"><img src="../Images/b844bd47357cc8f77f29f2ecba82a6ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U3tBqTcW1BwOstcpjXhfOA.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Load Access Control List</figcaption></figure><h1 id="9b8a" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">为什么要加密，在Kafka中是如何启用的？</h1><p id="debe" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">让我们看一个用例；<br/> 如果生产者或消费者配置并使用SASL明文机制，那么认证凭证将以明文/无TLS的方式通过网络发送。这可能会导致明文密码通过网络传输。<br/>SASL/普通只能与TLS/SSL一起用作传输层，以确保在没有加密的情况下不会在网络上传输清晰的密码。</p><h2 id="05d7" class="lr jx hi bd jy ls lt lu kc lv lw lx kg kx ly lz ki lb ma mb kk lf mc md km ho bi translated">启用加密的步骤:使用SSL设置SASL</h2><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mf"><img src="../Images/5e653f122af72487ae9bfd8eadda825c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RGK_bqlxw34SFt7GMKjakg.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Creating SSL Keys and Certificates</figcaption></figure><h1 id="6b5d" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">创建JAAS配置:身份验证</h1><h2 id="3723" class="lr jx hi bd jy ls lt lu kc lv lw lx kg kx ly lz ki lb ma mb kk lf mc md km ho bi translated">Kafka代理/Kafka服务器</h2><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mg"><img src="../Images/7463e9807caae26f8df6719f3a7f6123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6RnnEi1OjcKE-wG6_g_k8w.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">JAAS configuration: Kafka broker</figcaption></figure><h2 id="bd7e" class="lr jx hi bd jy ls lt lu kc lv lw lx kg kx ly lz ki lb ma mb kk lf mc md km ho bi translated">动物园管理员</h2><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mh"><img src="../Images/68d110e8af8a71c36c65a7c149009104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*txJ9Cx9opI3gaaHql_yFiQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">JAAS configuration: Zookeeper</figcaption></figure><h2 id="4995" class="lr jx hi bd jy ls lt lu kc lv lw lx kg kx ly lz ki lb ma mb kk lf mc md km ho bi translated">生产者</h2><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mi"><img src="../Images/e9f7fac198ffb905c5af3d5ab2b84995.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jLEqX3QHA0BQtD_pAKnnYg.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">JAAS configuration: Producer</figcaption></figure><h2 id="f761" class="lr jx hi bd jy ls lt lu kc lv lw lx kg kx ly lz ki lb ma mb kk lf mc md km ho bi translated">消费者</h2><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mj"><img src="../Images/1a3e51f6ce62cd75279a6707fb137941.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5MdvwyiIScfx9a1__0cI-g.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">JAAS configuration: Consumer</figcaption></figure><h1 id="8574" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">创建ACL:授权</h1><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mk"><img src="../Images/10334520c9c028f328341b9e2c1c90f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y52fr76uW9w3F_NOmR1MMQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">ACL Definitions</figcaption></figure><h1 id="6142" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">让我们对应用程序进行端到端测试</h1><h2 id="c04d" class="lr jx hi bd jy ls lt lu kc lv lw lx kg kx ly lz ki lb ma mb kk lf mc md km ho bi translated">a.以下演示包括Kafka CLI和Spring boot应用程序</h2><h2 id="58c6" class="lr jx hi bd jy ls lt lu kc lv lw lx kg kx ly lz ki lb ma mb kk lf mc md km ho bi translated">启动动物园管理员</h2><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ml"><img src="../Images/80d3de9f9dd606f6ac1cd75b7429a5fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MXLmdBKPQrYvTgeO0Wf_oQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Zookeeper instance</figcaption></figure><h2 id="47b0" class="lr jx hi bd jy ls lt lu kc lv lw lx kg kx ly lz ki lb ma mb kk lf mc md km ho bi translated">启动Kafka代理</h2><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ml"><img src="../Images/1fee0ee30807d256ad2a25ca9b90d848.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t5UFHx64XXEdDL_5AofMOg.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Kafka Broker instance</figcaption></figure><h1 id="d5cd" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">Spring Boot应用</h1><h2 id="4fc2" class="lr jx hi bd jy ls lt lu kc lv lw lx kg kx ly lz ki lb ma mb kk lf mc md km ho bi translated">启动生成器应用程序</h2><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ml"><img src="../Images/439bdf1c50c9996dcc33988f89450a72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IFNG5YBud7XBrzUeknYkOw.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Producer Application: Spring Boot</figcaption></figure><h2 id="3343" class="lr jx hi bd jy ls lt lu kc lv lw lx kg kx ly lz ki lb ma mb kk lf mc md km ho bi translated">启动消费者应用程序</h2><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ml"><img src="../Images/b20e8c57bb1f0d0221be6bb2b609b514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j8DJ7cWE44T2Lso-w3T-7w.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Consumer Application: Spring Boot</figcaption></figure><h1 id="9fd7" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">卡夫卡CLI</h1><h2 id="c600" class="lr jx hi bd jy ls lt lu kc lv lw lx kg kx ly lz ki lb ma mb kk lf mc md km ho bi translated">控制台生产商</h2><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ml"><img src="../Images/138ec318270ad82003a8617de54a3a4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V_v88oJGE7I-jgfmVPzBfg.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">console producer</figcaption></figure><h2 id="68ff" class="lr jx hi bd jy ls lt lu kc lv lw lx kg kx ly lz ki lb ma mb kk lf mc md km ho bi translated">控制台消费者</h2><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ml"><img src="../Images/494103c41538a2eaa03659988e73169f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vr8dd-D_3p0z5hKBqKszYw.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">console consumer</figcaption></figure><h1 id="912a" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">结论</h1><p id="035c" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">总结本文，我们已经看到了如何使用SASL机制和TLS实现Kafka安全性。认证和授权分别通过JAAS配置和ACL实现。我们还创建了SSL密钥和证书，并在密钥库和信任库中启用它们。我们还实现了Kafka CLI和Java Spring boot应用程序，供生产者和消费者通过认证、授权和加密发送消息。</p><p id="585b" class="pw-post-body-paragraph ko kp hi kq b kr lm is kt ku ln iv kw kx lo kz la lb lp ld le lf lq lh li lj hb bi translated"><strong class="kq hs"> <em class="lk">发表于2022年6月19日</em> </strong></p></div><div class="ab cl mm mn gp mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hb hc hd he hf"><p id="d639" class="pw-post-body-paragraph ko kp hi kq b kr lm is kt ku ln iv kw kx lo kz la lb lp ld le lf lq lh li lj hb bi translated"><strong class="kq hs">其他媒体文章，<em class="lk">作者</em>加内什·纳加林加姆</strong></p><p id="111f" class="pw-post-body-paragraph ko kp hi kq b kr lm is kt ku ln iv kw kx lo kz la lb lp ld le lf lq lh li lj hb bi translated"><a class="ae ll" rel="noopener" href="/nerd-for-tech/asynchronous-websocket-messaging-middleware-and-microservices-1a50a8f14e4b"> <em class="lk">异步WebSocket消息中间件和微服务</em> </a></p><p id="78f7" class="pw-post-body-paragraph ko kp hi kq b kr lm is kt ku ln iv kw kx lo kz la lb lp ld le lf lq lh li lj hb bi translated"><a class="ae ll" rel="noopener" href="/geekculture/quest-syntax-tree-and-remedy-code-smell-using-japa-visitor-patterns-f023a89842cf">使用JAPA访问者模式探索语法树和补救代码气味</a></p><p id="ba35" class="pw-post-body-paragraph ko kp hi kq b kr lm is kt ku ln iv kw kx lo kz la lb lp ld le lf lq lh li lj hb bi translated"><a class="ae ll" rel="noopener" href="/geekculture/amalgamate-angular-with-spring-cloud-architecture-through-cors-7f13b5fdb98f"> <em class="lk">通过CORS </em> </a>将棱角与春云建筑融合</p><p id="39fe" class="pw-post-body-paragraph ko kp hi kq b kr lm is kt ku ln iv kw kx lo kz la lb lp ld le lf lq lh li lj hb bi translated"><a class="ae ll" rel="noopener" href="/geekculture/multi-broker-insights-into-apache-kafka-cluster-architecture-617b0abfc53e">多代理洞察Apache Kafka集群架构</a></p><p id="f02a" class="pw-post-body-paragraph ko kp hi kq b kr lm is kt ku ln iv kw kx lo kz la lb lp ld le lf lq lh li lj hb bi translated"><a class="ae ll" href="https://ganeshblog.medium.com/remote-queue-definition-ibm-mq-v9-2-c3ec4f568dab?source=user_profile---------5----------------------------" rel="noopener"> <em class="lk">远程队列定义:IBM MQ v9.2 </em> </a></p><p id="971e" class="pw-post-body-paragraph ko kp hi kq b kr lm is kt ku ln iv kw kx lo kz la lb lp ld le lf lq lh li lj hb bi translated"><a class="ae ll" href="https://ganeshblog.medium.com/kubernetes-pods-docker-containers-spin-vm-using-virtual-box-in-windows-10-home-d3be783ff087?source=user_profile---------0----------------------------" rel="noopener"><em class="lk">Kubernetes Pods&amp;Docker Containers:在Windows 10 Home中使用虚拟盒子旋转虚拟机</em> </a></p><p id="490f" class="pw-post-body-paragraph ko kp hi kq b kr lm is kt ku ln iv kw kx lo kz la lb lp ld le lf lq lh li lj hb bi translated"><a class="ae ll" href="https://ganeshblog.medium.com/federate-okta-idp-wso2-api-manager-as-gateway-to-spring-boot-microservices-integration-ba567567e81?source=user_profile---------1----------------------------" rel="noopener"> <em class="lk">联邦OKTA IdP + WSO2 API Manager作为Spring boot微服务集成的网关</em> </a></p><p id="24dd" class="pw-post-body-paragraph ko kp hi kq b kr lm is kt ku ln iv kw kx lo kz la lb lp ld le lf lq lh li lj hb bi translated"><a class="ae ll" href="https://ganeshblog.medium.com/integrate-ibm-business-process-manager-with-hybrid-mobilefirst-application-5aed20841bf3?source=user_profile---------2----------------------------" rel="noopener"> <em class="lk">集成IBM业务流程管理器和混合MobileFirst应用</em> </a></p><p id="66d4" class="pw-post-body-paragraph ko kp hi kq b kr lm is kt ku ln iv kw kx lo kz la lb lp ld le lf lq lh li lj hb bi translated"><a class="ae ll" href="https://ganeshblog.medium.com/kerberos-v5-sso-authentication-in-windows-10-home-using-apache-directory-studio-fb0151899185?source=user_profile---------3----------------------------" rel="noopener"><em class="lk">Kerberos V5:Windows 10 Home中使用Apache directory studio的SSO认证</em> </a></p><p id="75ce" class="pw-post-body-paragraph ko kp hi kq b kr lm is kt ku ln iv kw kx lo kz la lb lp ld le lf lq lh li lj hb bi translated"><a class="ae ll" href="https://ganeshblog.medium.com/integrate-service-providers-sps-with-okta-identity-provider-idp-ce64a4e262ae?source=user_profile---------4----------------------------" rel="noopener"> <em class="lk">整合服务提供商(SPs)与OKTA身份提供商(IdP) </em> </a></p><p id="b767" class="pw-post-body-paragraph ko kp hi kq b kr lm is kt ku ln iv kw kx lo kz la lb lp ld le lf lq lh li lj hb bi translated"><a class="ae ll" href="https://ganeshblog.medium.com/integrate-ibm-websphere-service-registry-and-repository-with-ibm-process-server-f97eeb0e2ea?source=user_profile---------6----------------------------" rel="noopener"> <em class="lk">将IBM WebSphere Service Registry and Repository与IBM Process Server </em> </a>集成</p></div></div>    
</body>
</html>