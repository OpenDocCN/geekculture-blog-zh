<html>
<head>
<title>Selenium Support</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">硒载体</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/selenium-support-19330843c63a?source=collection_archive---------13-----------------------#2021-04-18">https://medium.com/geekculture/selenium-support-19330843c63a?source=collection_archive---------13-----------------------#2021-04-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="10ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">硒伞项目的有用功能。</p><p id="8339" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经开始使用Selenium的相关产品，并且发现文档具有误导性，它并没有促进最佳实践。此外，许多组件存在多年都无法修复的内存/资源泄漏。因此，我创建了一个实用程序项目，将我对Selenium的“修复”封装起来，并推广最佳实践。</p><p id="5093" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将列出我的库的一些功能:</p><ul class=""><li id="3cae" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">创建/销毁<code class="du jm jn jo jp b">BmpDaemon</code>(又名browsermobproxy。服务器)。</li><li id="96b0" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">创建/销毁<code class="du jm jn jo jp b">BmpProxy </code>(又名browsermobproxy。客户端)。</li><li id="79b4" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">创建/销毁<code class="du jm jn jo jp b">SeleniumWebDriver </code>(例如<strong class="ih hj">selenium . web driver . chrome . web driver)。</strong> <em class="jv">(可以是任何支持的浏览器)。</em></li><li id="5848" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">截图。</li><li id="5219" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">准备浏览器的数据目录以供使用。</li><li id="4ffb" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">启用浏览器下载文件。</li><li id="f492" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">以har格式捕获网络。</li><li id="a196" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">正在等待页面加载。</li><li id="1885" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">同步点击(在按钮上)。</li><li id="d226" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">等待谷歌Chrome完成下载文件<em class="jv"> (Chrome专用)</em>。</li><li id="4a7a" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">等待显示。</li></ul></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="e0a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">源代码你可以在这里找到<a class="ae kd" href="https://github.com/alex-ber/AlexBerUtils/blob/master/alexber/utils/mains.py" rel="noopener ugc nofollow" target="_blank"/>。它是我的AlexBerUtils项目的一部分。</p><p id="791e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以从PyPi安装SeleniumSupport:</p><p id="ff2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jm jn jo jp b">python -m pip install -U selenium-support</code></p><p id="8d0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于如何安装的更多详细说明，请参见此处的<a class="ae kd" href="https://pypi.org/project/selenium-support/" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="d95c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">硒元素-4还在开发中，见<a class="ae kd" href="https://testguild.com/selenium-4/" rel="noopener ugc nofollow" target="_blank">硒元素4是什么？自动化浏览器测试的最新进展</a>，所以这个故事是关于Selenium 3的。</p><p id="f405" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开始使用Selenium的标准代码如下所示:</p><pre class="ke kf kg kh fd ki jp kj kk aw kl bi"><span id="22f4" class="km kn hi jp b fi ko kp l kq kr">path = ‘bin/browsermob-proxy’ #your path to browsermob-proxy<br/>server = Server(path)<br/>server.start()<br/>proxy = server.create_proxy()</span></pre><p id="ab6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kd" rel="noopener" href="/@jiurdqe/how-to-get-json-response-body-with-selenium-amd-browsermob-proxy-71f10335c66">https://medium . com/@ jiurdqe/how-to-get-JSON-response-body-with-selenium-amd-browser mob-proxy-71f 10335 c66</a></p><p id="9c35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><br/>另一个稍微有点变体:<strong class="ih hj"> settings.py: </strong></p><pre class="ke kf kg kh fd ki jp kj kk aw kl bi"><span id="3aab" class="km kn hi jp b fi ko kp l kq kr"><strong class="jp hj">class </strong>Config(object):<br/>    CHROME_PATH = <strong class="jp hj">'/Library/Application Support/Google/chromedriver76.0.3809.68'<br/>    </strong>BROWSERMOB_PATH = <strong class="jp hj">'/usr/local/bin/browsermob-proxy-2.1.4/bin/browsermob-proxy'<br/><br/><br/>class </strong>Docker(Config):<br/>    CHROME_PATH = <strong class="jp hj">'/usr/local/bin/chromedriver'</strong></span><span id="2c20" class="km kn hi jp b fi ks kp l kq kr">import Server from selenium<br/>import contextlib<br/>from settings import Config as config</span><span id="df8e" class="km kn hi jp b fi ks kp l kq kr">@contextlib.contextmanager <br/>def browser_and_proxy(): <br/>    server = Server(config.BROWSERMOB_PATH) <br/>    server.start() <br/>    proxy = server.create_proxy()<br/>    #...<br/>    <em class="jv"># Set up Chrome<br/>    </em>option = webdriver.ChromeOptions()<br/>    option.add_argument(<strong class="jp hj">'--proxy-server=%s' </strong>% proxy.proxy)</span><span id="5205" class="km kn hi jp b fi ks kp l kq kr">    prefs = {<strong class="jp hj">"profile.managed_default_content_settings.images"</strong>: 2}<br/>    option.add_experimental_option(<strong class="jp hj">"prefs"</strong>, prefs)<br/>    option.add_argument(<strong class="jp hj">'--headless'</strong>)<br/>    option.add_argument(<strong class="jp hj">'--no-sandbox'</strong>)<br/>    option.add_argument(<strong class="jp hj">'--disable-gpu'</strong>)<br/><br/>    capabilities = DesiredCapabilities.CHROME.copy()<br/>    capabilities[<strong class="jp hj">'acceptSslCerts'</strong>] = <strong class="jp hj">True<br/>    </strong>capabilities[<strong class="jp hj">'acceptInsecureCerts'</strong>] = <strong class="jp hj">True<br/><br/>    </strong>path = config.CHROME_PATH<br/>    browser = webdriver.Chrome(options=option,<br/>                           desired_capabilities=capabilities,<br/>                           executable_path=path)<br/><br/>    <strong class="jp hj">try</strong>:<br/>      <strong class="jp hj">yield </strong>browser, proxy<br/>    <strong class="jp hj">finally</strong>:<br/>      browser.quit()<br/>      server.stop()</span><span id="5ff3" class="km kn hi jp b fi ks kp l kq kr">#...</span><span id="f976" class="km kn hi jp b fi ks kp l kq kr"><strong class="jp hj">with </strong>browser_and_proxy() <strong class="jp hj">as </strong>(browser, proxy):<br/>        browser.get(<strong class="jp hj">'https://www.airbnb.com/s/Seattle--WA--United-States/homes'</strong>)<br/>#...</span></pre><p id="fbc6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基于<a class="ae kd" rel="noopener" href="/@sshevlyagin/browsermob-proxy-and-selenium-knowing-when-requests-finish-44d4b52851c8">https://medium . com/@ sshevlyagin/browser mob-proxy-and-selenium-known-when-requests-finish-44d 4b 52851 c8</a></p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><ol class=""><li id="a5b1" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc kt jj jk jl bi translated">首先，很明显上面的代码片段有严重的内存/资源泄漏——服务器和代理没有关闭。</li><li id="3e0e" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc kt jj jk jl bi translated">第二段代码也有(几处)漏洞。最明显的一个——如果<code class="du jm jn jo jp b">browser.quite()</code>引发异常，那么<code class="du jm jn jo jp b">server.stop()</code>将永远不会被调用，并将导致泄漏。另一个，<code class="du jm jn jo jp b">proxy</code>也应该通过调用<code class="du jm jn jo jp b">proxy.close()</code>关闭。</li><li id="54f0" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc kt jj jk jl bi translated"><code class="du jm jn jo jp b">server.stop()</code>法非同小可的泄密。下面我会详细描述。</li><li id="b8da" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc kt jj jk jl bi translated">非同小可的泄密有<code class="du jm jn jo jp b">browser.stop()</code>方法。下面我会详细描述。这种泄漏的性质与第3页中的相同</li></ol></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="633a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面一行中的<code class="du jm jn jo jp b">proxy</code>是什么类型？</p><pre class="ke kf kg kh fd ki jp kj kk aw kl bi"><span id="e8ad" class="km kn hi jp b fi ko kp l kq kr">proxy = server.create_proxy()</span></pre><p id="2585" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不看<code class="du jm jn jo jp b">create_proxy()</code>方法的实现，你永远不会猜到它实际上是……<code class="du jm jn jo jp b">Client</code>。(<code class="du jm jn jo jp b">browsermobproxy.Client</code>更确切的说)。</p><p id="222a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">引用自文档<a class="ae kd" href="https://github.com/lightbody/browsermob-proxy#getting-started-standalone" rel="noopener ugc nofollow" target="_blank">https://github . com/light body/browser mob-proxy # getting-started-standalone</a>:</p><blockquote class="ku kv kw"><p id="e8f4" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><em class="hi">如果您在Java应用程序或Selenium测试中运行BrowserMob代理，请从</em> <a class="ae kd" href="https://github.com/lightbody/browsermob-proxy#getting-started-embedded-mode" rel="noopener ugc nofollow" target="_blank"> <em class="hi">嵌入式模式</em> </a> <em class="hi">开始。如果您想从命令行作为独立代理运行BMP，请从</em> <a class="ae kd" href="https://github.com/lightbody/browsermob-proxy#getting-started-standalone" rel="noopener ugc nofollow" target="_blank"> <em class="hi">独立</em> </a> <em class="hi"> … </em>开始</p><p id="d760" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><em class="hi">要从命令行以独立模式运行，首先从</em> <a class="ae kd" href="https://github.com/lightbody/browsermob-proxy/releases" rel="noopener ugc nofollow" target="_blank"> <em class="hi">版本页面</em> </a> <em class="hi">或</em> <a class="ae kd" href="https://github.com/lightbody/browsermob-proxy#building-the-latest-from-source" rel="noopener ugc nofollow" target="_blank"> <em class="hi">下载最新版本，从源代码</em> </a> <em class="hi">构建最新版本。</em></p><p id="9542" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><em class="hi">启动REST API: </em></p><p id="f014" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><code class="du jm jn jo jp b"><em class="hi">./browsermob-proxy -port 8080</em></code></p><p id="c152" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><em class="hi">然后创建一个代理服务器实例:</em></p><p id="ac92" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><code class="du jm jn jo jp b"><em class="hi">curl -X POST </em><a class="ae kd" href="http://localhost:8080/proxy" rel="noopener ugc nofollow" target="_blank"><em class="hi">http://localhost:8080/proxy</em></a><em class="hi"><br/></em></code> <em class="hi"> </em> <code class="du jm jn jo jp b"><em class="hi">{"port":8081}</em></code></p><p id="7243" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><em class="hi">“port”是新创建的代理实例的端口，因此配置您的HTTP客户机或web浏览器，以便在返回的端口上使用代理。有关REST API中可用特性的更多信息，请参见</em><a class="ae kd" href="https://github.com/lightbody/browsermob-proxy#rest-api" rel="noopener ugc nofollow" target="_blank"><em class="hi">REST API文档</em> </a> <em class="hi">。</em></p></blockquote><p id="612a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们跟随链接。引自<a class="ae kd" href="https://github.com/lightbody/browsermob-proxy#rest-api" rel="noopener ugc nofollow" target="_blank">https://github.com/lightbody/browsermob-proxy#rest-api</a></p><blockquote class="ku kv kw"><p id="df73" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><strong class="ih hj"><em class="hi">2.1中新增:</em> </strong> <em class="hi"> LittleProxy是REST API的默认实现。您可以指定</em> <code class="du jm jn jo jp b"><em class="hi">--use-littleproxy false</em></code> <em class="hi">来禁用LittleProxy，以支持传统的基于Jetty 5的实现。</em></p><p id="8e76" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><em class="hi">首先在bin目录下运行</em> <code class="du jm jn jo jp b"><em class="hi">browsermob-proxy</em></code> <em class="hi">或</em> <code class="du jm jn jo jp b"><em class="hi">browsermob-proxy.bat</em></code> <em class="hi">来启动代理:</em></p><p id="4779" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><code class="du jm jn jo jp b"><em class="hi">$ sh browsermob-proxy -port 8080<br/>INFO 05/31 03:12:48 o.b.p.Main - Starting up...<br/>2011-05-30 20:12:49.517:INFO::jetty-7.3.0.v20110203<br/>2011-05-30 20:12:49.689:INFO::started o.e.j.s.ServletContextHandler{/,null}<br/>2011-05-30 20:12:49.820:INFO::Started SelectChannelConnector@0.0.0.0:8080</em></code></p><p id="6823" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><em class="hi">一旦启动，</em> <strong class="ih hj"> <em class="hi">在您创建新的代理</em> </strong> <em class="hi">之前，不会有实际的代理在运行。你可以通过发帖到/proxy: </em>来完成</p><p id="0e3e" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><code class="du jm jn jo jp b"><em class="hi">[~]$ curl -X POST http://localhost:8080/proxy<br/>{"port":8081}</em></code></p><p id="566f" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><em class="hi">或者指定您自己的端口:</em></p><p id="987e" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><code class="du jm jn jo jp b"><em class="hi">[~]$ curl -X POST -d 'port=8089' http://localhost:8080/proxy<br/>{"port":8089}</em></code></p><p id="ef8b" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><em class="hi">或者，如果在多宿主环境中运行BrowserMob代理，指定所需的绑定地址(默认为</em> <code class="du jm jn jo jp b"><em class="hi">0.0.0.0</em></code> <em class="hi"> ): </em></p><p id="e537" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><code class="du jm jn jo jp b"><em class="hi">[~]$ curl -X POST -d 'bindAddress=192.168.1.222' http://localhost:8080/proxy<br/>{"port":8086}</em></code></p><p id="8b89" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><em class="hi">一旦完成，新的代理将在返回的端口上可用。你所要做的就是将一个浏览器指向那个端口上的代理，然后你就可以浏览互联网了。</em></p></blockquote></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="3037" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">有点不为人知</h1><pre class="ke kf kg kh fd ki jp kj kk aw kl bi"><span id="8bd1" class="km kn hi jp b fi ko kp l kq kr">server.start()</span></pre><p id="bc33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个命令实际上执行了这个<em class="jv">命令</em> <br/> <code class="du jm jn jo jp b">browsermob-proxy -port 8080</code></p><p id="a3e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注:在Mac上其实是<code class="du jm jn jo jp b">sh browsermob-proxy -port 8080</code>。</p><p id="2cef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>在Windows上，如果您从非控制台进程中启动子进程，将出现一个控制台窗口(<code class="du jm jn jo jp b">conhost.exe</code>)。详情见<a class="ae kd" href="https://code.activestate.com/recipes/409002-launching-a-subprocess-without-a-console-window/" rel="noopener ugc nofollow" target="_blank">https://code . active state . com/recipes/409002-launching-a-subprocess-without-a-console-window/</a>和<a class="ae kd" href="https://docs.python.org/3/library/subprocess.html#subprocess.STARTUPINFO.dwFlags" rel="noopener ugc nofollow" target="_blank">https://docs . python . org/3/library/subprocess . html # subprocess。STARTUPINFO.dwFlags </a></p><p id="9640" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">还要注意:</strong>有效命令将在<code class="du jm jn jo jp b">conhost.exe</code>中<code class="du jm jn jo jp b">browsermob-proxy<strong class="ih hj">.bat</strong> -port 8080 </code>运行。</p><p id="b3e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将在下面回到这一点。因此，<code class="du jm jn jo jp b">server.start()</code>使用了<code class="du jm jn jo jp b">subprocess.Popen(self.<em class="jv">command...</em>)</code>，其中command是上面的变体之一。<strong class="ih hj"> <em class="jv">不会有实际代理</em> </strong>(你可能以为<code class="du jm jn jo jp b">browsermob-proxy </code>开始是“实际代理”，呵呵，其实没有)。这个命令启动<strong class="ih hj"> BMP <em class="jv">守护进程</em></strong>——这是一个独立的Java应用程序，作为操作系统的一部分。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="be1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如何启动<strong class="ih hj"> <em class="jv">实际代理</em> </strong>？<br/> <code class="du jm jn jo jp b">proxy = server.create_proxy()</code></p><p id="8fa6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中代理有类型，正如我上面所说的，<code class="du jm jn jo jp b">Client</code>(更准确地说是<code class="du jm jn jo jp b">browsermobproxy.Client</code>)。</p><p id="dc3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在创建代理时，调用下面的API:<br/><code class="du jm jn jo jp b">curl -X POST <a class="ae kd" href="http://localhost:8080/proxy" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/proxy</a></code></p><p id="589a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并且调用返回<em class="jv">端口号</em>，其中有<strong class="ih hj"> <em class="jv">专用的“实际”代理</em> </strong> <em class="jv">。</em></p><p id="1268" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jv">注:</em> </strong></p><ul class=""><li id="e153" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">最佳实践是为每个<strong class="ih hj">进程分配<strong class="ih hj"> <em class="jv">【实际】代理</em> </strong>。返回的<em class="jv">端口号</em>应该传递给浏览器。</strong></li><li id="780b" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">如果你需要在你的应用中打开多个浏览器，最好使用不同的<strong class="ih hj">进程</strong>而不是<strong class="ih hj">线程</strong>。</li></ul></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="ec9d" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">一般说明</h1><p id="e2ff" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">在下文中，我将使用以下<em class="jv">命名约定</em>:</p><ul class=""><li id="037d" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><em class="jv"> BMP守护进程— </em>指的是以<code class="du jm jn jo jp b">sh browsermob-proxy -port 8080</code> <em class="jv">命令的某种变体启动的Java程序。</em></li><li id="f3bd" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated"><em class="jv"> BMP代理</em> —参考<code class="du jm jn jo jp b">browsermobproxy.Client</code>类型，这是为实际使用而创建的<strong class="ih hj"> <em class="jv">【实际】代理</em> </strong>，每个Python进程一个。</li><li id="082f" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated"><em class="jv"> Web驱动</em>(我不喜欢<em class="jv">驱动</em>快捷方式；<em class="jv">驱动</em>在Selenium世界<em class="jv">之外有更广泛的含义)——</em>指“控制”浏览器的代码。这是硒的一部分。实际上，这是我正在使用的硒的主要部分。</li><li id="853a" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated"><em class="jv">许多函数以字典为参数</em>。您可以用硬编码的参数创建dict，您可以将参数作为命名变量(<em class="jv"> kwargs </em>)传递，或者您可以将参数放在某个配置文件中并解析它。如果你选择了后者，你基本上有以下选择:</li></ul><ol class=""><li id="6dfa" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc kt jj jk jl bi translated">选择你最喜欢的Yml解析器并解析成dict。比如ruyaml，pyyaml等。</li><li id="4ef3" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc kt jj jk jl bi translated">可以用<a class="ae kd" rel="noopener" href="/analytics-vidhya/my-ymlparsers-module-88221edf16a6">我的ymlparsers模块</a>。</li><li id="81db" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc kt jj jk jl bi translated">如果您想根据您正在工作的环境/概要文件(例如dev、prod)使用不同的值，您可以使用<a class="ae kd" rel="noopener" href="/analytics-vidhya/my-major-init-app-conf-module-1a5d9fb3998c"> my <em class="jv"> init_app_conf </em>模块</a>。</li></ol><p id="6c64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我个人选择的是<a class="ae kd" rel="noopener" href="/analytics-vidhya/my-major-init-app-conf-module-1a5d9fb3998c"> <em class="jv"> init_app_conf </em>模块</a>。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="baf2" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><em class="mc"> BMP守护进程</em></h1><p id="77fb" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">代码:</p><figure class="ke kf kg kh fd md"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="deb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中<em class="jv"> dd </em>可描述如下:</p><figure class="ke kf kg kh fd md"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="2df4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注:</strong>关于如何将yml文件转换成dict <em class="jv"> dd </em>见上面<em class="jv">“许多函数以字典为参数”</em>一节。</p><p id="0643" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">解释是:</p><p id="0088" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是负责启动BMP守护进程的上下文管理器。在从上下文管理器的代码块中退出时，BMP守护程序将被停止，参见<code class="du jm jn jo jp b">closeBmpDaemon().</code></p><p id="89d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">启动BMP守护程序基本上是通过以下代码完成的:</p><pre class="ke kf kg kh fd ki jp kj kk aw kl bi"><span id="2e98" class="km kn hi jp b fi ko kp l kq kr">server = Server(**daemon_init_d)<br/>server.start(**daemon_start_d)</span></pre><p id="1d03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中<em class="jv"> daemon_init_d </em>表示<em class="jv"> init </em>下面的部分</p><p id="8db8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">而<em class="jv"> daemon_start_d </em>代表<em class="jv"> start下面的部分。</em></p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="de50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注:</strong></p><ul class=""><li id="ea17" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">你可以在你的代码之外手动启动BMP守护进程<em class="jv"/>。或者，您可以将它包装为实际操作系统守护程序，在操作系统启动时进行startד。</li><li id="b246" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">如果你想以编程方式启动BMP守护进程<em class="jv"/>，例如，使用<code class="du jm jn jo jp b">BMPDaemon</code>实用程序，建议从主进程开始。</li><li id="a44e" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">如果您想以编程方式使用BMP守护程序，您不应该忘记关闭它。更多关于关闭下面。</li><li id="97ef" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">如果你真的愿意，你可以像函数调用一样使用<code class="du jm jn jo jp b">BMPDaemon</code>工具。在这种情况下，你应该使用<code class="du jm jn jo jp b">try-finally</code>块并显式调用<code class="du jm jn jo jp b">closeBmpDaemon()</code>函数。更多关于关闭下面。</li><li id="cb2a" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">如果您有多个应用程序使用BMP守护程序，您有两个基本选择:</li></ul><ol class=""><li id="461f" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc kt jj jk jl bi translated">在这些应用程序范围之外启动BMP守护程序(可能作为3应用程序或操作系统守护程序，或者只是手动启动，见上文)，在一些预定义的端口(默认为8080)中编写假设BMP守护程序已经启动并运行的应用程序代码。</li><li id="8483" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc kt jj jk jl bi translated">每个应用程序将在不同的端口上启动BMP守护程序。</li></ol><p id="90a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想<strong class="ih hj">强调</strong>，从技术上来说，所有应用程序只需要运行一个BMP守护程序就足够了(您将为每个应用程序创建BMP代理)。</p><p id="22ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就个人而言，我发现第二种选择更容易管理——即拥有多个BMP守护进程，每个应用程序一个。这确实是资源的浪费，但是应用程序的生命周期更容易管理，并且您没有一些外部依赖。但是，请注意，在这种情况下，至少在一个应用程序中，您应该显式地提供端口号<em class="jv">。它们最好彼此远离，因为BMP代理是作为下一个端口号创建的。</em></p><p id="43dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">举个明显的例子，在上面的代码中，BMP守护进程将在端口8090上启动。第一个BMP代理将位于端口8091，每个后续的BMP代理将使用下一个端口号。如果您知道，您将有多达9个进程，每个进程都将使用BMP代理，BMP代理将占用端口范围8091–8099。所以，如果你想再要一个BMP守护进程，不能是8091，最好是<em class="jv">至少8100(或者8090以下)。</em></p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="07b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jv"> daemon_init_d — </em>这个字典被传递给<code class="du jm jn jo jp b"><a class="ae kd" href="https://github.com/AutomatedTester/browsermob-proxy-py/blob/master/browsermobproxy/server.py#L59" rel="noopener ugc nofollow" target="_blank">__init__()</a></code>:</p><ul class=""><li id="7dcc" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><em class="jv">路径</em>的默认值为<code class="du jm jn jo jp b">browsermob-proxy</code>。(在Windows上是<code class="du jm jn jo jp b">browsermob-proxy.bat</code>)。如果该文件在OS环境变量中不可用，您应该为可执行文件提供显式文件，如上例所示。</li><li id="b321" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated"><code class="du jm jn jo jp b">options['port']</code>的默认值是8080。在上面引用的文档中，这是BMP守护程序运行时的默认端口。但是，通常这个端口被其他应用程序使用，所以您可能需要更改它。</li></ul><p id="11bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jv"> daemon_start_d — </em>这个字典被传递给<code class="du jm jn jo jp b"><a class="ae kd" href="https://github.com/AutomatedTester/browsermob-proxy-py/blob/master/browsermobproxy/server.py#L99" rel="noopener ugc nofollow" target="_blank">start()</a></code>:</p><ul class=""><li id="87f0" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><code class="du jm jn jo jp b">options['log_path']</code>的默认值为<code class="du jm jn jo jp b">os.getcwd()</code>。这代表目录(没有文件名！)BMP守护进程的日志将被写入其中。</li><li id="23dd" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated"><code class="du jm jn jo jp b">options['log_file']</code>的默认值为<code class="du jm jn jo jp b">server.log</code>。这代表文件名(只有文件名，没有目录路径！)的日志。</li><li id="06d1" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">还有一些未记录的值可以传递。请参见<a class="ae kd" href="https://github.com/AutomatedTester/browsermob-proxy-py/blob/master/browsermobproxy/server.py#L59" rel="noopener ugc nofollow" target="_blank">https://github . com/automated tester/browser mob-proxy-py/blob/master/browsermobproxy/server . py # L59</a></li></ul><p id="c874" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个上下文管理器也担心关闭BMP守护进程。见下面的<code class="du jm jn jo jp b">closeBmpDaemon()</code>。同样，如果你把它作为常规函数使用，这种情况不会发生。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="8363" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">关闭BMP守护程序</h1><p id="2400" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">如果你使用<code class="du jm jn jo jp b"><em class="jv">BMPDaemon</em></code>作为上下文管理器，它会担心关闭BMP守护进程。如果想自己做，可以调用<code class="du jm jn jo jp b">closeBmpDaemon() </code>函数。</p><p id="f6df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可能想知道为什么调用<code class="du jm jn jo jp b">bmp_daemon.stop()</code>是不够的，看起来这个方法是专门为此设计的。</p><p id="3433" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，有一个公开的问题<a class="ae kd" href="https://github.com/AutomatedTester/browsermob-proxy-py/issues/76" rel="noopener ugc nofollow" target="_blank"> Java进程没有在Mac </a>中被杀死。引用:</p><blockquote class="ku kv kw"><p id="5539" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><em class="hi"> Hi即使在做了</em> <code class="du jm jn jo jp b"><em class="hi">proxy_server.stop()</em></code> <em class="hi">和</em> <code class="du jm jn jo jp b"><em class="hi">proxy.close() </em></code> <em class="hi"> browsermob代理之后，还是离开了在Mac后台运行的java进程。</em></p></blockquote><p id="5124" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为过程组存在未合并的部分修复<a class="ae kd" href="https://github.com/AutomatedTester/browsermob-proxy-py/pull/71" rel="noopener ugc nofollow" target="_blank">运行和压井。</a></p><p id="da96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，你可以找到一些关于如何在Windows上关闭BMP Dameon的指南。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="3288" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">这是怎么回事？</h1><p id="023c" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">根本原因如下。当调用BMP守护进程的<code class="du jm jn jo jp b">start()</code>方法时，它使用<em class="jv">子进程。Popen </em>带有命令<code class="du jm jn jo jp b">sh browsermob-proxy -port 8080</code>的某种变体。如上所述，在Windows Python process start的cmd上的<em class="jv"/>一节中，执行启动Java进程的bat文件。</p><p id="b079" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你在<em class="jv"> bmp_daemon </em>上调用<code class="du jm jn jo jp b">stop()</code>函数时，它成功地杀死了<code class="du jm jn jo jp b">conhost.exe</code>进程。在Windows上(在Mac上按照<a class="ae kd" href="https://github.com/AutomatedTester/browsermob-proxy-py/issues/76" rel="noopener ugc nofollow" target="_blank"> #76 </a>)操作系统不会自动杀死宏进程(我不知道在Linux上发生了什么，但我怀疑它能起作用)，也就是说<code class="du jm jn jo jp b">stop()</code>函数杀死了<code class="du jm jn jo jp b">conhost.exe</code>进程，但在Windows(和Mac)上Java进程存活了下来。</p><p id="1497" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kd" href="https://github.com/AutomatedTester/browsermob-proxy-py/pull/71/commits/bf03dd027adc75f298008ee00dee941b295dcf7c" rel="noopener ugc nofollow" target="_blank">建议修复</a>简单来说如下:</p><pre class="ke kf kg kh fd ki jp kj kk aw kl bi"><span id="fb5d" class="km kn hi jp b fi ko kp l kq kr">self.log_file = open(os.path.join(log_path, log_file), 'w')</span><span id="de31" class="km kn hi jp b fi ks kp l kq kr">self.process = subprocess.Popen(self.command,                                                   <strong class="jp hj">preexec_fn=os.setsid, </strong>                                                  stdout=self.log_file,                                                   stderr=subprocess.STDOUT)</span><span id="d32b" class="km kn hi jp b fi ks kp l kq kr">group_pid = os.getpgid(self.process.pid)<br/>self.process.kill()                               self.process.wait()<br/>os.killpg(group_pid, signal.SIGINT)</span></pre><p id="decf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">据称，这一修复工作在Mac上。</p><p id="dc41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Windows上，此修复程序具有以下形式:</p><pre class="ke kf kg kh fd ki jp kj kk aw kl bi"><span id="8fb5" class="km kn hi jp b fi ko kp l kq kr">self.log_file = open(os.path.join(log_path, log_file), 'w')</span><span id="8f77" class="km kn hi jp b fi ks kp l kq kr">self.process = subprocess.Popen(self.command,                                                   <strong class="jp hj">creationflags=subprocess.CREATE_NEW_PROCESS_GROUP,  </strong>                                                 stdout=self.log_file,                                                   stderr=subprocess.STDOUT)</span><span id="bca0" class="km kn hi jp b fi ks kp l kq kr">group_pid = self.process.pid<br/>self.process.kill()                               self.process.wait()<br/>os.killpg(group_pid, signal.SIGINT)</span></pre><p id="ed89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这在Windows上不起作用。</p><p id="9c96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基本上，上面的代码试图做的是围绕<code class="du jm jn jo jp b">browsermob-proxy -port 8080</code>创建“进程组”，这样所有的子进程将被分组到一个实体中，这个实体可以使用OS系统调用来终止。</p><p id="725f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里<a class="ae kd" href="https://github.com/AutomatedTester/browsermob-proxy-py/issues/8#issuecomment-679150656" rel="noopener ugc nofollow" target="_blank">https://github . com/automated tester/browser mob-proxy-py/issues/8 # issue comment-679150656</a>是同一思路的另一种实现。我的解决方案是另一个实现。</p><p id="53bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不修改现有的代码，而是使用相同的包装功能。基本上，我在做以下事情:</p><ol class=""><li id="310c" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc kt jj jk jl bi translated">我使用<code class="du jm jn jo jp b">psutil</code>来获取作为执行<code class="du jm jn jo jp b">subprocess.Popen(self.command..)</code>的一部分而创建的所有子进程。在内部，每个这样的进程都有<em class="jv"> (PID </em>和它的<em class="jv">创建时间)。</em></li><li id="0d69" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc kt jj jk jl bi translated">我叫<code class="du jm jn jo jp b">bmp_daemon.stop()</code>。这很重要，因为它有下面的调用。该呼叫确保<code class="du jm jn jo jp b">self.log_file</code>将被正确关闭。</li><li id="4d1c" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc kt jj jk jl bi translated">现在，我从p.1开始迭代子进程。调用<br/> <code class="du jm jn jo jp b">import psutil<br/> from contextlib import suppress</code> <br/> <code class="du jm jn jo jp b">with suppress(psutil.NoSuchProcess):<br/> child.send_signal(signal.SIGTERM)<br/></code> <strong class="ih hj">注意:</strong>这个命令只能终止我们之前在p.1中缓存的进程。如果进程已经完成，我们将得到我们刚刚取消的<code class="du jm jn jo jp b">NoSuchProcess</code>(<code class="du jm jn jo jp b">send_signal()</code>有装饰者<code class="du jm jn jo jp b">@_assert_pid_not_reused </code>负责不终止新进程的重用id；在内部，它通过PID获取进程，并检查它是否具有相同的<em class="jv">创建时间</em>，如果不相同<code class="du jm jn jo jp b">NoSuchProcess </code>被引发)。</li></ol><p id="1fd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总之，我们正在获取在<code class="du jm jn jo jp b">bmp_daemon.start()</code>中打开的所有子进程(孙进程和所有祖先进程)id。我们调用<code class="du jm jn jo jp b">bmp_daemon.stop()</code>，然后杀死所有祖先的进程。</p><p id="c429" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果进程同时终止，我们忽略If。</p><p id="8a4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果流程id被重用，我们也不做任何事情。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="19c3" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">BrowserDataDir，BMPProxy，SeleniumWebDriver，截图</h1><p id="0e85" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">代码:</p><p id="787b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jv"> dd </em>描述如下:</p><figure class="ke kf kg kh fd md"><div class="bz dy l di"><div class="me mf l"/></div></figure><figure class="ke kf kg kh fd md"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="1785" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注:</strong>关于如何将yml文件转换成dict <em class="jv"> dd </em>参见上面<em class="jv">的“许多函数以字典为参数”</em>一节。</p><p id="b6e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">解释是:</p><p id="02f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jm jn jo jp b"><strong class="ih hj"><em class="jv">BrowserDataDir </em></strong></code> <em class="jv"> — </em>该上下文管理器可用于重用用户数据目录。它将文件<code class="du jm jn jo jp b">template </code>(在我们的例子中为<em class="jv">' path/to/chrome _ data _ dir . zip '</em>)解压到<code class="du jm jn jo jp b">work_dir</code>(在我们的例子中为'<em class="jv"> logs' </em>)。</p><p id="b86e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它返回包含从模板中提取的内容的目录(在我们的例子中是<code class="du jm jn jo jp b">browser_data_dir</code>)。</p><p id="c5a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在从上下文管理器内的代码块退出时，<code class="du jm jn jo jp b">work_dir </code>被移除。</p><p id="e69e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">稍后我们将使用<code class="du jm jn jo jp b">browser_data_dir</code>来填充作为kwargs传递给<code class="du jm jn jo jp b">SeleniumWebDriver</code>的<code class="du jm jn jo jp b">d[‘web_driver’][‘arguments’]</code>。</p><p id="ed86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>在配置yml中，我们有以下行<code class="du jm jn jo jp b">‘--user-data-dir={data_dir}’</code>。调用<code class="du jm jn jo jp b">_arg_format()</code>将有效地将<code class="du jm jn jo jp b">{data_dir}</code>替换为<code class="du jm jn jo jp b">browser_data_dir</code>。<br/>如果你不需要将<code class="du jm jn jo jp b">--user-data-dir</code>传递给Selenium Web驱动(比如<code class="du jm jn jo jp b">chromedriver.exe</code>)，那么<br/>你应该移除<code class="du jm jn jo jp b"><em class="jv">BrowserDataDir,</em></code> <em class="jv"> <br/> </em>移除行<code class="du jm jn jo jp b">‘--user-data-dir={data_dir}’<br/></code>，不要填充<code class="du jm jn jo jp b">d[‘web_driver’][‘arguments’]</code> (kwargs to <code class="du jm jn jo jp b">SeleniumWebDriver</code>)。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="1c9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jm jn jo jp b"><strong class="ih hj"><em class="jv">BMPPRoxy</em></strong></code> <em class="jv"> — </em>该上下文管理器设计用于在新端口上创建<code class="du jm jn jo jp b">BMP Proxy</code>。假设<code class="du jm jn jo jp b">BMPDaemon</code>已经启动。它不需要<code class="du jm jn jo jp b">BMPDaemon</code>对象，只需要它的一些参数。</p><p id="85ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，它假设<code class="du jm jn jo jp b">BMPDaemon</code>正在本地主机上运行。默认情况下，它还假设运行在端口8080上，您可能希望通过提供<code class="du jm jn jo jp b">d[‘browsermob’][‘daemon][‘init][‘options’][‘port’]</code>来覆盖该值。建议提供您已经提供给<code class="du jm jn jo jp b">BMPDaemon</code>的相同字典。</p><p id="cd5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您还记得上面的代码片段，它使用<code class="du jm jn jo jp b">BMPDaemon</code>上的<code class="du jm jn jo jp b">create_proxy()</code>方法来创建<code class="du jm jn jo jp b"><em class="jv">BMPPRoxy</em></code> <em class="jv"> </em>，并在内部重用一些参数。我的实现通过模仿<code class="du jm jn jo jp b">BMPDaemon </code>的行为绕过了<code class="du jm jn jo jp b">create_proxy()</code>方法的使用。</p><p id="fcf2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个上下文管理器返回BMP代理。</p><p id="a032" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在退出上下文管理器中的代码块时，它关闭了BMP代理。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="1415" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jm jn jo jp b"><strong class="ih hj">SeleniumWebDriver </strong></code> —该上下文管理器旨在创建Web驱动程序。它假设BMPDaemon已经启动。想用可以通过<code class="du jm jn jo jp b"><em class="jv">BMPPRoxy</em></code> <em class="jv"> </em>。它不需要BMPDaemon对象。它返回Web驱动程序。在退出上下文管理器内的代码块时，关闭Web驱动程序，详见<code class="du jm jn jo jp b">closeSeleniumWebDriver()</code>。</p><p id="2e68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一些<strong class="ih hj">基础架构</strong>描述:Selenium是框架。它的主要组件之一是Web驱动程序。对于每一个主流浏览器，比如Google Chrome，Mozilla Firefox，都有专门的Web驱动类型。这样，每种Web驱动程序类型都“知道”相应浏览器的内部结构。Web驱动程序的主要目的是提供与浏览器无关的API。在内部，每个Web驱动程序“知道”将这种浏览器不可知的API调用转换为特定的浏览器API调用。</p><p id="6c70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong> Web驱动由Python包装器和一些可执行文件组成(比如<code class="du jm jn jo jp b">chromedriver.exe</code>)。术语“网络驱动程序”(容易混淆)指的是两者。</p><p id="8ae1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">硒-3幸运的一些功能，例如，网络监控。有许多Selenium <em class="jv">扩展</em>来提供额外的功能。这个<em class="jv">扩展</em>中的一个就是<code class="du jm jn jo jp b"><em class="jv">BMPPRoxy</em></code>T12。它的主机&amp;端口可以作为Web驱动选项的参数传递；这样浏览器和互联网之间的所有网络通信都将通过<code class="du jm jn jo jp b"><em class="jv">BMPPRoxy</em></code> <em class="jv">。</em> <strong class="ih hj">注意:</strong> Selenum-4会内置这个功能。</p><p id="3952" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>如何创建适用于<em class="jv">任何</em>网络驱动的<strong class="ih hj">通用上下文管理器有些复杂。例如，谷歌Chrome和Mozilla Firefox有不同的选项类。我的实现灵感来自于<a class="ae kd" href="https://github.com/clemfromspace/scrapy-selenium/blob/develop/scrapy_selenium/middlewares.py" rel="noopener ugc nofollow" target="_blank"><em class="jv">https://github . com/clemfromspace/scrapy-selenium/blob/develop/scrapy _ selenium/middleware . py</em></a></strong></p><p id="49df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码示例中，我传递了<em class="jv">browsermoproxy</em>(它的主机&amp;端口将作为Web驱动程序选项的参数传递)，此外，我还传递了<em class="jv"> web_driver </em>。它包含以下条目:</p><p id="d4d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jv">'名称':'铬'</em></p><p id="abff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它用于确定特定的(浏览器的)Web驱动程序。在这种情况下它将是<em class="jv">' selenium . web driver .</em><strong class="ih hj"><em class="jv">chrome</em></strong><em class="jv">。webdriver。</em></p><p id="d02d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jv">' log _ file ':' path/to/logs/chrome driver . log '</em></p><p id="dc7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">来自Selenium的Web驱动组件的所有日志都将被重定向到这个<em class="jv"> log_file。</em></p><p id="1142" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>这在关闭Web驱动程序时会产生一些问题。它们在下面的<code class="du jm jn jo jp b">closeSeleniumWebDriver()</code>中处理。</p><p id="7f65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jv">“路径”:“资源/chrome driver . exe”</em></p><p id="383b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Web驱动程序的可执行文件的路径。Python包装器需要它来调用它。这是实际浏览器控件所在的位置。</p><p id="d0c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参数' =[' - headless '，'- window-size=1920，1080 '，'- ignore-certificate-errors '，'-disable-useAutomationExtension '，'-user-data-dir = logs/chrome _ DCM _ data _ dirvwg1 nmbv ']</p><p id="aacf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实验_选项'<em class="jv"> : </em>'排除开关':['启用-记录'，'启用-自动化']</p><p id="0967" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们一个一个来。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="a972" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">无头模式。</strong></p><p id="4b52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">无头浏览器是没有图形用户界面的浏览器。在无头模式下运行浏览器意味着它可以在不需要专用显示器或图形的情况下运行。它之所以被称为headless，是因为它运行时没有图形用户界面(GUI)。程序的GUI被称为头部。</p><p id="4bf1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大约在2017年之前，所有主流浏览器都不支持<strong class="ih hj">无头模式</strong>。所以，如果你想用Selenium运行<strong class="ih hj"> headless </strong>你应该使用<a class="ae kd" href="https://www.selenium.dev/documentation/en/getting_started_with_webdriver/browsers/#specialized-browsers" rel="noopener ugc nofollow" target="_blank">另一个浏览器</a>，比如<a class="ae kd" href="https://www.selenium.dev/documentation/en/webdriver/driver_requirements/#mock-browsers" rel="noopener ugc nofollow" target="_blank"> HtmlUnit或者PhantomJS </a>。</p><p id="9461" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kd" href="https://developers.google.com/web/updates/2017/04/headless-chrome" rel="noopener ugc nofollow" target="_blank">无头Chrome在Chrome 59 </a>中发货。另请参见此处的<a class="ae kd" href="https://www.debugbar.com/what-is-the-google-chrome-headless-mode/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="f3fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kd" href="https://hacks.mozilla.org/2017/12/using-headless-mode-in-firefox/#usage" rel="noopener ugc nofollow" target="_blank">在Firefox中使用无头模式</a>。参见<a class="ae kd" href="https://askinglot.com/open-detail/113464" rel="noopener ugc nofollow" target="_blank">这里的</a>。</p><p id="7828" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，大约从2017年开始，你可以在<strong class="ih hj">无头模式下使用你最喜欢的浏览器(它也存在于这里没有提到的另一个浏览器中)。</strong></p><p id="03d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我个人在<code class="du jm jn jo jp b">dev</code>用的是<strong class="ih hj">完整版浏览器</strong>，在<code class="du jm jn jo jp b">prod</code>用的是<strong class="ih hj">无头模式</strong>。我正在为我的配置文件使用不同的<em class="jv">概要文件</em>来实现这一点。有关这方面的更多信息，请参见<a class="ae kd" rel="noopener" href="/analytics-vidhya/my-major-init-app-conf-module-1a5d9fb3998c">我的专业初始化应用配置模块</a></p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="c642" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">窗口大小</strong></p><p id="adcf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kd" href="https://github.com/mozilla/geckodriver/issues/1354" rel="noopener ugc nofollow" target="_blank"> 1366x768 </a>是Mozilla Firefox中无头模式的默认分辨率。在无头模式下，谷歌Chrome浏览器启动于<a class="ae kd" href="https://itnext.io/how-to-run-a-headless-chrome-browser-in-selenium-webdriver-c5521bc12bf0" rel="noopener ugc nofollow" target="_blank"> 800x600 </a>。许多网站“看起来很丑”,在这样的分辨率下几乎不可用——比如，你不能点击按钮，所以你应该覆盖它的默认设置。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="a5b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">忽略证书错误</strong></p><p id="8c0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在开始<em class="jv"> https </em>通信之前，网站会向browser提供一个证书来标识自己。有些网站使用不被浏览器信任的<em class="jv">自签名证书</em>(也可能是因为其他原因，但这是最常见的原因)<em class="jv">、</em>，因此您会得到一个错误页面，显示消息“<a class="ae kd" href="https://stackoverflow.com/questions/24507078/how-to-deal-with-certificates-using-selenium" rel="noopener ugc nofollow" target="_blank">您的连接不安全”</a>。</p><p id="6790" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你使用的是Google Chrome，在argument的选项中传递<code class="du jm jn jo jp b">--ignore-certificate-errors</code>是解决这个问题最简单的方法。</p><p id="2256" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有关替代方案或其他浏览器的解决方案，请参见<a class="ae kd" href="http://allselenium.info/selfsigned-certificates-python-selenium/" rel="noopener ugc nofollow" target="_blank">http://all selenium . info/self signed-certificates-python-selenium/</a></p><p id="9588" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>目前不支持<em class="jv"> desired_capabilities </em>。参见<a class="ae kd" href="https://github.com/alex-ber/selenium-support/issues/1" rel="noopener ugc nofollow" target="_blank">https://github.com/alex-ber/selenium-support/issues/1</a></p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="1903" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">禁用-使用自动扩展</strong></p><p id="2712" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是谷歌浏览器特有的功能。</p><p id="88ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这应该和will连用</p><pre class="ke kf kg kh fd ki jp kj kk aw kl bi"><span id="b879" class="km kn hi jp b fi ko kp l kq kr">options = webdriver.ChromeOptions()<br/>options.add_experimental_option('excludeSwitches', ['enable-logging', 'enable-automation'])</span></pre><p id="ea41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kd" href="https://stackoverflow.com/questions/47392423/python-selenium-devtools-listening-on-ws-127-0-0-1" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/47392423/python-selenium-dev tools-listening-on-ws-127-0-0-1</a></p><p id="773f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kd" href="https://stackoverflow.com/questions/46423361/chrome-devmode-suddenly-turning-on-in-selenium" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/46423361/chrome-devmode-turn-on-in-selenium</a></p><p id="c51a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这3个选项将删除弹出的<code class="du jm jn jo jp b">DevTools</code>消息，并阻止进入谷歌Chromes的devmode。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="cfbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">用户数据目录</strong></p><p id="6492" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是谷歌浏览器特有的功能。有关Mozilla Firefox的替代方案，请参见<a class="ae kd" href="https://stackoverflow.com/a/55636113/1137529" rel="noopener ugc nofollow" target="_blank">https://stackoverflow.com/a/55636113/1137529</a>或<a class="ae kd" href="https://firefox-source-docs.mozilla.org/testing/geckodriver/CrashReports.html" rel="noopener ugc nofollow" target="_blank">https://Firefox-source-docs . Mozilla . org/testing/geckodriver/crash reports . html</a></p><p id="1146" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是完全可选的功能。最好和<code class="du jm jn jo jp b">BrowserDataDir</code>(见上)一起用。</p><p id="d919" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想让你的浏览器使用一些预定义的用户数据目录(Mozilla Firefox中的profile)。</p><p id="1e34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">比如在Windows上可以创建快捷方式:<em class="jv">" C:\ Program Files(x86)\ Google \ Chrome \ Application \ Chrome . exe "-user-data-dir = C:\ tmp \ Chrome _ profile。</em>点击上面的<em class="jv"> </em>创建所有内部文件夹，然后将<em class="jv">' C:\ tmp \ Chrome _ profile '</em>作为<code class="du jm jn jo jp b">--user-data-dir</code>传递给Google Chrome option的参数。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="5b27" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">关闭Selenium的Web驱动程序</h1><p id="96ac" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">如果你使用<code class="du jm jn jo jp b">SeleniumWebDriver</code>作为上下文管理器，它会担心关闭网络驱动。如果想自己做，可以调用<code class="du jm jn jo jp b">closeSeleniumWebDriver() </code>函数。</p><p id="921d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能想知道为什么打电话到<code class="du jm jn jo jp b">web_driver.quit()</code>还不够。<strong class="ih hj">注意</strong>(注意！):你不要把这个电话和<code class="du jm jn jo jp b">web_driver.close()</code>搞混了。最后一次调用只会关闭标签页，而不会关闭浏览器本身。</p><p id="e837" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您在阅读上面几行时有似曾相识的感觉，您可能会想起，在<code class="du jm jn jo jp b">closeBmpDaemon()</code>函数中也发生了类似的事情。</p><p id="988e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不会重复我自己，实现是非常接近的。</p><p id="6063" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">但是为什么</strong> <code class="du jm jn jo jp b"><strong class="ih hj">web_driver.quit()</strong></code> <strong class="ih hj">还不够呢？</strong></p><p id="86d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我注意到，有时，当异常出现时，但并不总是如此，谷歌Chrome浏览器和/或<code class="du jm jn jo jp b">chromedriver.exe</code>仍然驻留在内存中。</p><p id="37b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我添加了相同的逻辑来关闭在Web驱动程序初始化中打开的所有祖先进程时，这种情况再也不会发生了。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="bb0b" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><code class="du jm jn jo jp b">Screenshot</code></h1><p id="bdeb" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">它被设计用作上下文管理器。</p><p id="30f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果想要API进行简单的函数调用，请使用<code class="du jm jn jo jp b">save_screenshot()</code>。</p><p id="2c56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能想用这个上下文管理器来保护你的代码。要求您首先实例化<code class="du jm jn jo jp b">web_driver</code>。如果在上下文管理器内部的代码块中将引发异常，那么将采取一些额外的操作。</p><p id="832c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果<code class="du jm jn jo jp b">logger </code>不为None，将向其发出警告记录器消息。</p><p id="afdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们有一个带有<code class="du jm jn jo jp b">screen</code>的<code class="du jm jn jo jp b">WebDriverException</code>实例，它将被用来生成截图的png文件。</p><p id="a7f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果<code class="du jm jn jo jp b">screen</code>没有或者我们没有<code class="du jm jn jo jp b">WebDriverException</code>的实例，我们会主动截图。请注意，此尝试可能会失败。</p><p id="c229" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码片段中:</p><p id="2d25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jm jn jo jp b">web_driver</code>是必填字段。<code class="du jm jn jo jp b">Action</code>只是异常发生的指示。<code class="du jm jn jo jp b">screenshots_dir</code>是保存截图的目录。<code class="du jm jn jo jp b">logger</code>已通过，有<code class="du jm jn jo jp b">warning</code>消息发出。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="3034" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><code class="du jm jn jo jp b">Save screenshot</code></h1><p id="e8a5" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated"><code class="du jm jn jo jp b">save_screenshot()</code>是常规函数API。如果您想要一个上下文管理器，请使用<code class="du jm jn jo jp b">Screenshot</code>。</p><p id="7ec3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">也许，你有一些<code class="du jm jn jo jp b">try-finally</code>块，当你从<code class="du jm jn jo jp b">web_driver</code>捕捉到一个异常时，你想要得到截图，以便更好地理解哪里出错了。就我个人而言，我更喜欢使用<code class="du jm jn jo jp b">Screenshot</code>，但是在一些复杂的场景中，你可能想要更好的控制。</p><p id="71fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注:</strong>您可以将<em class="jv">DD[' browser _ download _ folder '</em><strong class="ih hj"><em class="jv">]</em></strong>定义如下</p><pre class="ke kf kg kh fd ki jp kj kk aw kl bi"><span id="50b2" class="km kn hi jp b fi ko kp l kq kr">dd['files']['browser_download_folder'] = str(Path(Path.home(), 'Downloads'))</span></pre></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="5df9" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">在Google Chrome中启用下载</h1><p id="c129" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated"><code class="du jm jn jo jp b">enable_chrome_download()</code>是谷歌Chrome特有的功能。</p><p id="90f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在谷歌浏览器中，无头模式下的下载是默认禁用的。这是一个“特征”，为了安全。如果您想启用下载，您可以使用此功能。详情请见<a class="ae kd" href="https://stackoverflow.com/questions/45631715/downloading-with-chrome-headless-and-selenium" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/45631715/downloading-with-chrome-headless-and-selenium</a>。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="1cbd" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">设定新HAR</h1><p id="7afa" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated"><code class="du jm jn jo jp b">set_new_har()</code>是带有<code class="du jm jn jo jp b">capture*</code>参数的<code class="du jm jn jo jp b">bmp_proxy.new_har()</code>的方便包装器。它用于获取网络传输。例如，如果你想得到响应体。详见<a class="ae kd" rel="noopener" href="/@jiurdqe/how-to-get-json-response-body-with-selenium-amd-browsermob-proxy-71f10335c66">https://medium . com/@ jiurdqe/how-to-get-JSON-response-body-with-selenium-amd-browser mob-proxy-71f 10335 c66</a>。</p><p id="640a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此呼叫相当于在页面检查器的“网络”选项卡上单击“开始录音”。</p><p id="0cfc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的示例代码中，我们调用了<code class="du jm jn jo jp b">set_new_har(bmp_proxy, har_name) </code>，其中<code class="du jm jn jo jp b">bmp_proxy</code>是上面创建的对象，<code class="du jm jn jo jp b">har_name</code>是str。该调用完成后，从浏览器到站点的所有网络通信都记录在<code class="du jm jn jo jp b">BMP Proxy</code>中。</p><p id="b882" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想要检索它，您可以使用以下模板:</p><figure class="ke kf kg kh fd md"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="a35a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注</strong>:</p><ol class=""><li id="954e" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc kt jj jk jl bi translated">在第4行中，我们等待(5毫秒)网络流量停止(超时70毫秒)。需要确保BMP代理已经记录了所有网络流量(到目前为止)。</li><li id="2c7e" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc kt jj jk jl bi translated">第9行中<code class="du jm jn jo jp b">reversed</code>的用法。引用的链接没有这个。如果您对同一个URL有多个调用，您应该查看最后的结果，因此您应该颠倒日志条目的顺序。</li></ol></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="379c" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">等待加载一些基本页面元素</h1><p id="0e33" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated"><code class="du jm jn jo jp b">wait_page_loaded()</code>是辅助函数，保证页面的一些基本元素，比如标题都被加载。</p><p id="6f47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用示例:</p><pre class="ke kf kg kh fd ki jp kj kk aw kl bi"><span id="6d31" class="km kn hi jp b fi ko kp l kq kr">from alexber.seleniumsupport import wait_page_loaded<br/>wait = WebDriverWait(web_driver, timeout=70, poll_frequency=1)<br/>wait_page_loaded(wait)</span></pre></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="ca79" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">点击<code class="du jm jn jo jp b">WebElement</code></h1><p id="2d83" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated"><code class="du jm jn jo jp b">click_sync()</code> -有时在<code class="du jm jn jo jp b">WebElement</code>上调用<code class="du jm jn jo jp b">click()</code>会引发一些奇怪的异常。最佳实践是使用<code class="du jm jn jo jp b">wait.until(EC.element_to_be_clickable((By.XPATH, <strong class="ih hj">‘</strong>xpath<strong class="ih hj">’</strong>)))</code>。这是对<code class="du jm jn jo jp b">WebElement.click()</code> <br/> ( <code class="du jm jn jo jp b">WebElement</code>通常是按钮)进行同步调用(通过使用JavaScript)的“肮脏”解决方案。详见<a class="ae kd" href="https://stackoverflow.com/a/58378714/1137529" rel="noopener ugc nofollow" target="_blank">https://stackoverflow.com/a/58378714/1137529</a>。</p><p id="254a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用示例:</p><pre class="ke kf kg kh fd ki jp kj kk aw kl bi"><span id="791f" class="km kn hi jp b fi ko kp l kq kr">from alexber.seleniumsupport import click_sync<br/>wait = WebDriverWait(web_driver, timeout=70, poll_frequency=1)</span><span id="db19" class="km kn hi jp b fi ks kp l kq kr">click_sync(web_driver,<br/>                 wait.until(EC.element_to_be_clickable(<br/>                    (By.XPATH, <strong class="jp hj">'</strong>xpath<strong class="jp hj">'</strong>))))</span></pre></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="869b" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">等待谷歌浏览器完成下载</h1><p id="36ec" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated"><code class="du jm jn jo jp b">wait_chrome_file_finished_downloades()</code>是谷歌Chrome特有的功能。<br/>它直接与文件系统一起工作。你应该事先知道<em class="jv">文件名</em>。它依赖于Google Chrome的以下内部机制:</p><ul class=""><li id="be4e" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">谷歌Chrome下载文件时，有扩展名<em class="jv">”。crdownload" </em>。当下载完成后，谷歌浏览器重命名文件删除这个扩展名。</li></ul><p id="1cf3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个功能<strong class="ih hj">不依赖</strong>谷歌Chrome的下载状态。这种设计选择有两个主要原因:</p><ul class=""><li id="7ac7" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">我们可以依靠谷歌浏览器下载页面的一些实现细节。他们往往会毫无征兆地改变，所以我选择不改变。参见<a class="ae kd" href="https://stackoverflow.com/questions/48263317/selenium-python-waiting-for-a-download-process-to-complete-using-chrome-web/48267887#48267887" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/48263317/selenium-python-waiting-a-download-process-to-complete-using-chrome-web/48267887 # 48267887</a></li><li id="6481" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">在Windows上，我们可以看到文件系统的错误状态。引用Python文档:</li></ul><blockquote class="ku kv kw"><p id="5a2d" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="hi">注意:</em> </strong> <em class="hi">在基于Unix的系统上，</em> <code class="du jm jn jo jp b"><a class="ae kd" href="https://docs.python.org/3/library/os.html#os.scandir" rel="noopener ugc nofollow" target="_blank"><em class="hi">scandir()</em></a></code> <em class="hi">使用系统的</em> <code class="du jm jn jo jp b"><a class="ae kd" href="http://pubs.opengroup.org/onlinepubs/009695399/functions/opendir.html" rel="noopener ugc nofollow" target="_blank"><em class="hi">opendir()</em></a></code> <em class="hi">和</em> <code class="du jm jn jo jp b"><a class="ae kd" href="http://pubs.opengroup.org/onlinepubs/009695399/functions/readdir_r.html" rel="noopener ugc nofollow" target="_blank"><em class="hi">readdir()</em></a></code> <em class="hi">函数。在Windows上，它使用Win32 </em> <code class="du jm jn jo jp b"><a class="ae kd" href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa364418(v=vs.85).aspx" rel="noopener ugc nofollow" target="_blank"><em class="hi">FindFirstFileW</em></a></code> <em class="hi">和</em> <code class="du jm jn jo jp b"><a class="ae kd" href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa364428(v=vs.85).aspx" rel="noopener ugc nofollow" target="_blank"><em class="hi">FindNextFileW</em></a><em class="hi"> </em></code> <em class="hi">函数。</em></p></blockquote><p id="d6c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kd" href="https://docs.python.org/3/library/os.html#os.scandir" rel="noopener ugc nofollow" target="_blank">https://docs.python.org/3/library/os.html#os.scandir</a></p><p id="ee52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">引用自<code class="du jm jn jo jp b"><a class="ae kd" href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa364418(v=vs.85).aspx" rel="noopener ugc nofollow" target="_blank"><em class="jv">FindFirstFileW</em></a></code>和<code class="du jm jn jo jp b"><a class="ae kd" href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa364428(v=vs.85).aspx" rel="noopener ugc nofollow" target="_blank">FindNextFileW</a><em class="jv">:</em></code></p><blockquote class="ku kv kw"><p id="d029" class="if ig jv ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated"><em class="hi">要将此操作作为事务处理操作执行，请使用</em><a class="ae kd" href="https://docs.microsoft.com/en-us/windows/desktop/api/winbase/nf-winbase-findfirstfiletransacteda" rel="noopener ugc nofollow" target="_blank"><em class="hi">FindFirstFileTransacted</em></a><em class="hi">函数。<br/> … <br/>如果存在绑定到文件枚举句柄的事务，则返回的文件受事务隔离规则的约束。<br/> … <br/> </em> <strong class="ih hj"> <em class="hi">注意:</em> </strong> <em class="hi">在极少数情况下或在负载较重的系统上，NTFS文件系统上的文件属性信息在调用此函数时可能不是最新的。为了确保获得当前NTFS文件系统的文件属性，调用</em><a class="ae kd" href="https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-getfileinformationbyhandle" rel="noopener ugc nofollow" target="_blank"><em class="hi">GetFileInformationByHandle</em></a><em class="hi">函数。</em></p></blockquote><p id="b25b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kd" href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa364418(v=vs.85).aspx" rel="noopener ugc nofollow" target="_blank">https://msdn . Microsoft . com/en-us/library/windows/desktop/aa 364418(v = vs . 85)。aspx </a></p><p id="e4fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kd" href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa364428(v=vs.85).aspx" rel="noopener ugc nofollow" target="_blank">https://msdn . Microsoft . com/en-us/library/windows/desktop/aa 364428(v = vs . 85)。aspx </a></p><p id="d4d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那些“罕见病例”并不罕见。我经常遇到它们:谷歌Chrome从另一个进程下载文件，它有<em class="jv">”。crdownload </em>扩展名。我正在用Python代码检查带有<em class="jv">的文件。crdownload" </em>扩展存在并得到结果，它没有找到，但它显然仍然下载。我认为需要一些时间才能看到对filesysem(更高级的文件属性)的更改。为了减轻这个问题，我增加了简单的睡眠重试机制。在我咨询文件系统之前，我会休眠一段时间，以确保对文件系统所做的任何更改对Python进程都是可见的。</p><p id="6dbc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注</strong>:如果文件非常大(超过200MB)，您可能需要增加重试次数。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="6c55" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">等待显示</h1><p id="ffa4" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">有时，我们想让Selenium Web驱动程序等到元素样式属性改变后再运行。这对于动态加载的材料很有用。例如，我们希望等待显示样式变为<em class="jv">【无】</em>(或变为<code class="du jm jn jo jp b"><em class="jv">“inline-block"</em></code> <em class="jv"> </em>或其他值)。参见<a class="ae kd" href="https://stackoverflow.com/questions/34915421/make-selenium-driver-wait-until-elements-style-attribute-has-changed" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/34915421/make-selenium-driver-wait-until-elements-style-attribute-has-changed</a></p><p id="e999" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用示例:</p><pre class="ke kf kg kh fd ki jp kj kk aw kl bi"><span id="cba9" class="km kn hi jp b fi ko kp l kq kr">from alexber.seleniumsupport import wait_for_display<br/>wait = WebDriverWait(web_driver, timeout=70, poll_frequency=1)</span><span id="cb2f" class="km kn hi jp b fi ks kp l kq kr">wait.until(wait_for_display((By.XPATH, <strong class="jp hj">'</strong>xpath<strong class="jp hj">'</strong>)))</span></pre></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="c2bd" class="la kn hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">如需进一步阅读:</h1><p id="4df9" class="pw-post-body-paragraph if ig hi ih b ii lx ik il im ly io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">定位元素<br/>T9】https://www . selenium . dev/documentation/en/getting _ started _ with _ web driver/locating _ elements/</p><p id="65fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Chrome driver—Chrome<br/><a class="ae kd" href="https://sites.google.com/a/chromium.org/chromedriver/" rel="noopener ugc nofollow" target="_blank">https://sites.google.com/a/chromium.org/chromedriver/</a>的WebDriver</p><p id="f2b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">浏览器操作<br/><a class="ae kd" href="https://www.selenium.dev/documentation/en/webdriver/browser_manipulation/#browser-navigation" rel="noopener ugc nofollow" target="_blank">https://www . selenium . dev/documentation/en/web driver/browser _ Manipulation/# browser-navigation</a></p><p id="ab23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">比赛条件按钮(等待)<br/><a class="ae kd" href="https://www.selenium.dev/documentation/en/webdriver/waits/" rel="noopener ugc nofollow" target="_blank">https://www.selenium.dev/documentation/en/webdriver/waits/</a></p><p id="3d79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从元素(Web元素)<br/> <a class="ae kd" href="https://www.selenium.dev/documentation/en/webdriver/web_element/" rel="noopener ugc nofollow" target="_blank">中查找元素https://www . selenium . dev/documentation/en/Web driver/Web _ Element/</a></p><p id="38a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用选择元素<br/><a class="ae kd" href="https://www.selenium.dev/documentation/en/support_packages/working_with_select_elements/" rel="noopener ugc nofollow" target="_blank">https://www . selenium . dev/documentation/en/support _ packages/working _ with _ select _ elements/</a></p><p id="fadc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">WebDriver API提供了为浏览器设置代理的能力，<br/>并且有许多代理将通过编程允许您操作<br/>发送到web服务器<br/> <a class="ae kd" href="https://www.selenium.dev/documentation/en/worst_practices/http_response_codes/" rel="noopener ugc nofollow" target="_blank">和从web服务器接收的请求的内容https://www . selenium . dev/documentation/en/worst _ practices/http _ response _ codes/</a></p><p id="96cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Selenium 4 Alpha现已上市2020年11月17日<br/>T32】https://testguild.com/selenium-4/</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="03c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用的是Chrome驱动XXX版本，请看Chrome驱动参数<br/><a class="ae kd" href="https://peter.sh/experiments/chromium-command-line-switches/" rel="noopener ugc nofollow" target="_blank">https://Peter . sh/experiments/chromium-command-line-switches/</a></p><p id="0b5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">问题696481:无头模式不保存文件下载<br/>https://bugs.chromium.org/p/chromium/issues/detail?<a class="ae kd" href="https://bugs.chromium.org/p/chromium/issues/detail?id=696481" rel="noopener ugc nofollow" target="_blank">id = 696481</a><br/><a class="ae kd" href="https://stackoverflow.com/questions/45631715/downloading-with-chrome-headless-and-selenium" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/45631715/downloading-with-chrome-headless-and-selenium</a></p><p id="aa26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">browsermob-proxy GitHub <br/>设置代理，提取SAML断言<br/><a class="ae kd" rel="noopener" href="/@arkadyt/setting-up-programmatic-aws-access-for-mfa-protected-federated-identities-3be22bcecf4b">https://medium . com/@ arkadyt/Setting-Up-programmable-AWS-access-for-MFA-protected-federated-identities-3be 22 bcecf 4b</a><br/><a class="ae kd" href="https://github.com/lightbody/browsermob-proxy" rel="noopener ugc nofollow" target="_blank">https://github.com/lightbody/browsermob-proxy</a>(可能是漏读！！！)<br/><a class="ae kd" rel="noopener" href="/@jiurdqe/how-to-get-json-response-body-with-selenium-amd-browsermob-proxy-71f10335c66">https://medium . com/@ jiurdqe/how-to-get-JSON-response-body-with-selenium-amd-browser mob-proxy-71f 10335 c66</a></p><p id="848c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Google Chrome/Mozilla Firefox推荐的扩展:</p><p id="b43f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">XPath助手</p><p id="4431" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查员</p></div></div>    
</body>
</html>