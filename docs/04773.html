<html>
<head>
<title>AWS Secrets Manager for Test Automation project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">测试自动化项目的AWS秘密管理器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/aws-secrets-manager-for-test-automation-project-2958331a8309?source=collection_archive---------12-----------------------#2021-07-03">https://medium.com/geekculture/aws-secrets-manager-for-test-automation-project-2958331a8309?source=collection_archive---------12-----------------------#2021-07-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9ede" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">存储密钥、令牌、密码等机密数据是测试自动化中具有挑战性的任务之一。尤其是在许多项目和大型团队使用秘密数据情况下。我们如何让它既安全又易于管理？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/4c24d6d6a295cb26b97739e73878bd80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LfgqnXmVgXoLbsx87nJfVg.jpeg"/></div></div></figure><p id="d850" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">要求:</strong></p><ul class=""><li id="569a" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">集中访问所有机密</li><li id="4b9b" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">易于设置和管理</li><li id="3dbc" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">为新用户/存储库/作业轻松共享所有机密数据</li></ul><p id="b0a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有几种变体，从开源库到SaaS解决方案，各有利弊。</p><p id="c7db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天我想展示一下<a class="ae kd" href="https://aws.amazon.com/secrets-manager/" rel="noopener ugc nofollow" target="_blank"> AWS秘密管理器</a>的设置。<br/>假设我们有许多测试环境，每个环境都有通过测试访问它的特殊密钥。在正常情况下，你需要和所有同事分享这个秘密文件。你还需要把它保存在詹金斯的秘密中，并添加到所有的工作中。我们如何避免每次新的秘密都这样？</p><p id="c5ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们将秘密数据添加到AWS中，看看如何在自动化项目中使用它。</p><p id="bdbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 1)进入:AWS密码管理- &gt;存储新密码- &gt;选择密码类型。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ke"><img src="../Images/6ba6c4329ef81d05973f9ab94ae895a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*51omfYrddQycCXACaxoG3A.png"/></div></div></figure><p id="79d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于当前示例，它将是具有“环境”:“键”结构的json文件。</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="bc92" class="kk kl hi kg b fi km kn l ko kp">{<br/>  "<a class="ae kd" href="https://stage-1.int" rel="noopener ugc nofollow" target="_blank">https://stage-1.int</a>": "key1",<br/>  "<a class="ae kd" href="https://stage-2.int" rel="noopener ugc nofollow" target="_blank">https://stage-2.int</a>": "key2",<br/>  "<a class="ae kd" href="https://stage-3.int" rel="noopener ugc nofollow" target="_blank">https://stage-3.int</a>": "key3"<br/>}</span></pre><p id="3f3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2)以纯文本形式添加密码。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kq"><img src="../Images/a0198a73e5f26742af7f6f2ce6c172df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YVZKyuVesplhIiBTGnRa0w.png"/></div></div></figure><p id="77fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3)添加名称和描述</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/b361c3001fbc49faf39e287f80535ad0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jj9OFJs3NtOPkllWYeC06A.png"/></div></div></figure><p id="19eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 4) </strong> <strong class="ih hj">将AWS SDK依赖项添加到您的项目中</strong></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="4259" class="kk kl hi kg b fi km kn l ko kp">&lt;dependency&gt;<br/>    &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;<br/>    &lt;artifactId&gt;aws-java-sdk&lt;/artifactId&gt;<br/>    &lt;version&gt;1.11.1000&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="dc6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 5) </strong> <strong class="ih hj">使用AWSSecretsManagerClient检索机密数据</strong></p><p id="d96f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要访问AWS API，您需要创建具有读取机密权限的用户组，并生成<strong class="ih hj"> <em class="ks">访问密钥&amp;保密密钥</em> </strong> <em class="ks">。</em></p><p id="e2b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的代码检索秘密数据，并通过Gson库将其序列化为Map <environment key="">。所以你可以通过环境url获得任何密钥。</environment></p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="b9a6" class="kk kl hi kg b fi km kn l ko kp">var credentials = new BasicAWSCredentials("accessKey", "secretKey");</span><span id="39f9" class="kk kl hi kg b fi kt kn l ko kp">AWSSecretsManager secretManager = AWSSecretsManagerClient.<em class="ks">builder</em>()<br/>    .withCredentials(new AWSStaticCredentialsProvider(credentials))<br/>    .withRegion("region")<br/>    .build();</span><span id="dba9" class="kk kl hi kg b fi kt kn l ko kp">var request = new GetSecretValueRequest().withSecretId("name");</span><span id="17be" class="kk kl hi kg b fi kt kn l ko kp">var data = secretManager.getSecretValue(request).getSecretString();<br/>Map&lt;String, String&gt; keys = new Gson().fromJson(data, Map.class);<br/>String stage1key = keys.get("https://stage-1.int");</span></pre><p id="5e60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这样你就不在乎和同事共享文件，把它们放到所有的作业里。只需将所有用户添加到权限组，所有需要的人将通过他们的访问密钥获得秘密。</p><h1 id="f423" class="ku kl hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated"><strong class="ak">关于使用AWS Secrets Manager的结论</strong></h1><ul class=""><li id="be8c" class="jp jq hi ih b ii lr im ls iq lt iu lu iy lv jc ju jv jw jx bi translated">在一个地方安全存储所有机密</li><li id="c244" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">轻松共享和访问管理</li><li id="e41c" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">不关心秘密存储基础架构</li></ul></div></div>    
</body>
</html>