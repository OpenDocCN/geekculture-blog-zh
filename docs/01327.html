<html>
<head>
<title>State Machine As Redux Middleware</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">作为Redux中间件的状态机</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/state-machine-as-redux-middleware-8dda979b7944?source=collection_archive---------10-----------------------#2021-04-06">https://medium.com/geekculture/state-machine-as-redux-middleware-8dda979b7944?source=collection_archive---------10-----------------------#2021-04-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6cd0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如今，Web应用程序变得越来越复杂，客户对创建复杂流程的需求不断增加，以改善他们的业务和客户的用户体验。</p><p id="0dd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当产品负责人设计一个流程时，他可能会从一个简单的图表开始，这个图表会有一个起点和终点，他会说明当从步骤A转到步骤b时什么条件适用。</p><p id="3b7d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当开发人员实现流程时，他需要考虑将正确的逻辑放在哪里以满足需求，当客户端单击按钮A时，他将从页面A重定向到页面B，或者从场景A重定向到场景B——这对于一个简单的流程来说是很好的，但今天不是这样。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/a65ae53cf1ab17f1371c699797d25cfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ueaeqUKn4yxAsZESKVVGnw.png"/></div></div></figure><p id="189f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天的流程很复杂，一个流程可以发展成许多流程，用户不知道也不关心流程是如何管理的，但对于开发人员来说这很重要，因为作为开发人员，我们需要知道如何以我们能够维护它的方式处理流程，例如，产品负责人请求更改流程中的步骤或更改现有流程的业务逻辑，速度有多快？或者我们能有多容易满足这样的要求？</p><p id="114f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，你将会看到在你的应用程序中管理你的流程的最佳方式，如何在产品所有者、客户和开发者之间创造和谐，并迫使他们使用同一种语言。</p><h2 id="9640" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">基础</h2><p id="758e" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">在介绍中，我们谈到了从步骤A到步骤B，事实上每一个流程都有起点和终点，这让你想起了什么？如果不是，我会提醒你，这听起来像在谈论国家机器。</p><blockquote class="kp kq kr"><p id="67b1" class="if ig ks ih b ii ij ik il im in io ip kt ir is it ku iv iw ix kv iz ja jb jc hb bi translated">一个<strong class="ih hj">有限状态机</strong> ( <strong class="ih hj"> FSM </strong>)或<strong class="ih hj">有限状态自动机</strong> ( <strong class="ih hj"> FSA </strong>，复数:<em class="hi">自动机</em>)，<strong class="ih hj">有限自动机</strong>，或简称为<strong class="ih hj">状态机</strong>，是计算的数学<a class="ae kw" href="https://en.wikipedia.org/wiki/Model_of_computation" rel="noopener ugc nofollow" target="_blank">模型。它是一个</a><a class="ae kw" href="https://en.wikipedia.org/wiki/Abstract_machine" rel="noopener ugc nofollow" target="_blank">抽象机器</a>，在任何给定的时间，它可以处于有限个<a class="ae kw" href="https://en.wikipedia.org/wiki/State_(computer_science)" rel="noopener ugc nofollow" target="_blank"> <em class="hi">状态</em> </a>中的一个状态。</p><p id="4af6" class="if ig ks ih b ii ij ik il im in io ip kt ir is it ku iv iw ix kv iz ja jb jc hb bi translated"><a class="ae kw" href="https://en.wikipedia.org/wiki/Finite-state_machine" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Finite-state_machine</a></p></blockquote><p id="d3f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当考虑一个我们可以用来处理UI上复杂流程的模型时，这是第一件事。</p><p id="3f07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们计划我们的Web应用程序时，我们需要为我们的最终用户考虑所有可能的场景，我们不想要一个死胡同，事实上，我们需要每一步都根据我们的业务逻辑将用户带到下一步。</p><p id="74e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的解决方案基于一个管理状态机的开源库，x state——你可以在这里阅读更多:<a class="ae kw" href="https://github.com/davidkpiano/xstate" rel="noopener ugc nofollow" target="_blank">https://github.com/davidkpiano/xstate</a></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kx ky l"/></div></figure><h2 id="bd75" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">我们有一个管理状态机的库，现在呢？</h2><p id="b956" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">由于我们正在使用现代技术来开发我们的web应用程序，我们需要通过增强它来创建这个库之间的集成层，并将其连接到我们的技术，在这篇文章中，我将谈论我们开发的将这个库连接到我们基于Redux的应用程序的开源，一般来说，这个状态机将在我们的Redux Store中管理，你认为呢？开始把事情联系起来？我们继续。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kx ky l"/></div></figure><h1 id="2bdd" class="kz jq hi bd jr la lb lc jv ld le lf jz lg lh li kc lj lk ll kf lm ln lo ki lp bi translated">Redux流量管理器</h1><p id="be47" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">我们的开源处理管理复杂(或简单)的流程，它将我们的流程、我们的步骤及其条件转换为状态机，通过这种方法，我们将能够知道每一步，下一步是什么，用户所在的业务场景是什么，以及流程是什么——这将使开发人员能够只关注业务逻辑，而不处理转换或显示或不显示什么，我应该在哪里为用户放置重定向，在哪里不放置重定向。</p><div class="lq lr ez fb ls lt"><a href="https://www.npmjs.com/package/redux-flow-manager" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab dw"><div class="lv ab lw cl cj lx"><h2 class="bd hj fi z dy ly ea eb lz ed ef hh bi translated">冗余流管理器</h2><div class="ma l"><h3 class="bd b fi z dy ly ea eb lz ed ef dx translated">流程管理器帮助您管理流程信息细节和步骤(例如显示流程中的下一步)，用于…</h3></div><div class="mb l"><p class="bd b fp z dy ly ea eb lz ed ef dx translated">www.npmjs.com</p></div></div><div class="mc l"><div class="md l me mf mg mc mh jn lt"/></div></div></a></div><p id="6ac6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你应该如何使用它？</p><p id="fb49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤1: </strong>向您的项目添加流管理器缩减器。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="0fad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤2: </strong>创建步骤配置文件——步骤配置定义每个子流程类型的步骤集合。</p><p id="8159" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤配置为每个流和子流定义用户需要在应用程序中完成的一组步骤。</p><p id="0e72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤对象属性:</p><ul class=""><li id="44f1" class="mi mj hi ih b ii ij im in iq mk iu ml iy mm jc mn mo mp mq bi translated"><code class="du mr ms mt mu b">key: flowType</code>(例如:<code class="du mr ms mt mu b">COP</code> ) -该键代表<code class="du mr ms mt mu b">flowType</code></li><li id="396b" class="mi mj hi ih b ii mv im mw iq mx iu my iy mz jc mn mo mp mq bi translated"><code class="du mr ms mt mu b">key: subFlowType</code>(例如:<code class="du mr ms mt mu b">planOnlyFlow</code>)——代表<code class="du mr ms mt mu b">subFlowType</code></li><li id="629d" class="mi mj hi ih b ii mv im mw iq mx iu my iy mz jc mn mo mp mq bi translated"><code class="du mr ms mt mu b">steps: array</code> -该<code class="du mr ms mt mu b">flowType</code>和<code class="du mr ms mt mu b">subFlowType</code>的一组步骤</li></ul><p id="2485" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对象中子流对象的顺序很重要，因为计算将按该顺序运行。例如:如果在<code class="du mr ms mt mu b">planOnlyFlow,changePlanFlow</code>之前定义<code class="du mr ms mt mu b">planOnlyFlow</code>，那么<code class="du mr ms mt mu b">planOnlyFlow</code>将总是在<code class="du mr ms mt mu b">planOnlyFlow,changePlanFlow</code>之前设置。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="98b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤3: </strong>创建流配置文件——流配置文件定义子流类型名称和使子流有效应满足的条件。</p><p id="06b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Flows Config是一个对象数组，每个对象定义了可能存在于整个应用程序中的子流。每个流对象都有条件数组，每个条件都用回调函数定义。回调可以检查任何与条件相关的东西，如果你检查的条件被满足，那么它将返回resolve，如果条件失败，那么它将返回reject。</p><p id="4446" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果一个子流的所有条件都通过，那么这个子流被添加到subFlowTypes数组中。</p><p id="ec6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">流动对象属性:</p><ul class=""><li id="5bfd" class="mi mj hi ih b ii ij im in iq mk iu ml iy mm jc mn mo mp mq bi translated"><code class="du mr ms mt mu b">flowName: string</code>-<strong class="ih hj">接头</strong>流量类型的唯一名称</li><li id="89c0" class="mi mj hi ih b ii mv im mw iq mx iu my iy mz jc mn mo mp mq bi translated"><code class="du mr ms mt mu b">runInFlowTypes: array&lt;string&gt;</code> -定义这组条件将运行的主要流类型列表</li><li id="f45e" class="mi mj hi ih b ii mv im mw iq mx iu my iy mz jc mn mo mp mq bi translated"><code class="du mr ms mt mu b">conditions: array&lt;condition&gt;</code> -条件对象数组</li><li id="6922" class="mi mj hi ih b ii mv im mw iq mx iu my iy mz jc mn mo mp mq bi translated"><code class="du mr ms mt mu b">conditionName: string</code> -条件的名称</li><li id="c7a1" class="mi mj hi ih b ii mv im mw iq mx iu my iy mz jc mn mo mp mq bi translated"><code class="du mr ms mt mu b">onCheck: function</code> -一个<code class="du mr ms mt mu b">promise</code>函数，当条件成功时返回<code class="du mr ms mt mu b">resolve</code>，如果条件失败则返回<code class="du mr ms mt mu b">reject</code></li><li id="870e" class="mi mj hi ih b ii mv im mw iq mx iu my iy mz jc mn mo mp mq bi translated"><code class="du mr ms mt mu b">mandatory: boolean</code> -可选属性。定义如果该条件失败，是否从数组中删除子流。默认情况下为true。</li></ul><p id="9000" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个条件函数得到以下道具:</p><ul class=""><li id="2f9a" class="mi mj hi ih b ii ij im in iq mk iu ml iy mm jc mn mo mp mq bi translated"><code class="du mr ms mt mu b">state</code> -商店中的当前状态。</li><li id="8fcd" class="mi mj hi ih b ii mv im mw iq mx iu my iy mz jc mn mo mp mq bi translated"><code class="du mr ms mt mu b">context</code> -状态机中的当前上下文。</li><li id="39d1" class="mi mj hi ih b ii mv im mw iq mx iu my iy mz jc mn mo mp mq bi translated"><code class="du mr ms mt mu b">event</code> -调用该条件状态机事件</li></ul><p id="fdfd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意</strong>流对象在数组中的顺序很重要。计算将按该顺序运行。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="f7fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤4: </strong>调用<code class="du mr ms mt mu b">CreateFlowManagerAPI</code>你的商店，减速器切片名称，流程配置和步骤配置。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="fb8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤5: </strong> <code class="du mr ms mt mu b">CreateFlowManagerAPI</code>返回流管理器的实例，其功能将帮助您管理应用程序中的流。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="ae84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你能想到下一步会是什么吗？欢迎在评论中回答。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es na"><img src="../Images/93e3f225c73f02d3b8d1722de905a8d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KfzXIlWeB2ibduC-"/></div></div><figcaption class="nb nc et er es nd ne bd b be z dx">Photo by <a class="ae kw" href="https://unsplash.com/@tata186?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Tatiana Rodriguez</a> on <a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="10a8" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">模拟状态机</h2><p id="1020" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">使用XState，您可以检查您的配置，模拟条件以查看流程是否完全按照您的计划定义。</p><p id="f03e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过调用流管理器实例的getMachineFlowConfig()，它将返回一个可以在XState visualizer中设置的XState配置，以查看由您的配置创建的状态机。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nf"><img src="../Images/c3c71df854b8ae5585fcc198d8da7a27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*w5MuXLFS2XAO4ngn.png"/></div></div></figure><p id="2bbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在这里自己试试:<a class="ae kw" href="https://xstate.js.org/viz/" rel="noopener ugc nofollow" target="_blank">https://xstate.js.org/viz/</a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ng"><img src="../Images/0fae595dacb23f8aba61d563e192cc86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LFeC-umq7jqb-qn7"/></div></div><figcaption class="nb nc et er es nd ne bd b be z dx">Photo by <a class="ae kw" href="https://unsplash.com/@myleon?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Leon</a> on <a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="2890" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">说着同样的语言</h2><p id="27e7" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">在产品所有者、开发人员和客户之间创建一种语言的想法是为了减少请求变更(客户)、计划变更(产品所有者)和实施变更(开发人员)的工作量。</p><p id="d754" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看我们应该如何定义一个具有演进流程的系统，我们如何定义步骤，以及我们如何定义条件。通过设计如下的系统，它将确保实现将只关注于业务逻辑。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nh"><img src="../Images/c7b47336f7c86c403c3b0694cad17271.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4DScpjg_8pZJ9aXN.png"/></div></div></figure><h2 id="2c9b" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">重新使用</h2><p id="625a" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">您可能已经注意到，流程之间共享步骤，这同样适用于条件，例如，isUserLoggedIn可以是一个将在多个地方使用的条件，因此一旦我们更改此条件，它将影响所有其他条件，同样，我们希望减少工作量，我们希望节省时间，这将使我们能够快速进入市场。</p><p id="ca6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想了解如何在您的项目中利用这一特性吗？随时联系。</p><h1 id="b377" class="kz jq hi bd jr la lb lc jv ld le lf jz lg lh li kc lj lk ll kf lm ln lo ki lp bi translated">包扎</h1><p id="000e" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">本文将向您介绍管理web应用程序复杂或简单流程的正确方法，从而为您的应用程序提供最佳架构。</p><h1 id="cac9" class="kz jq hi bd jr la lb lc jv ld le lf jz lg lh li kc lj lk ll kf lm ln lo ki lp bi translated">我是谁？</h1><p id="5f4c" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">我是阿提亚的<strong class="ih hj">，一名网页开发者，专注于设计和建筑。<strong class="ih hj">目前</strong>在Amdocs担任软件架构师。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ni"><img src="../Images/6fa1553fabcefca84da50e845f50c681.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*n8gasu-NOPGZ7uoL.jpeg"/></div></div></figure><h1 id="d52a" class="kz jq hi bd jr la lb lc jv ld le lf jz lg lh li kc lj lk ll kf lm ln lo ki lp bi translated">贡献的</h1><p id="4cb0" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">特别感谢我的同事<a class="ae kw" href="https://www.linkedin.com/in/refael-oknin-a43773143/" rel="noopener ugc nofollow" target="_blank"> Refael Oknin </a>，在过去的两年里，Refael和我一起开发开源库。</p><p id="21af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Redux Flow Manager特性是我们开发的harmony-boilerplate的一部分。</p><p id="039e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想了解更多关于和声的知识？阅读下面的<a class="ae kw" href="https://ofirattia.medium.com/master-your-next-web-application-3df95dde2976" rel="noopener">文章</a>。</p></div></div>    
</body>
</html>