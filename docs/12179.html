<html>
<head>
<title>SharedPreferences -&gt; EncryptedSharedPreferences -&gt; JetPack DataStore</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">shared preferences-&gt; encrypted shared preferences-&gt; JetPack数据存储</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/preferences-4d7119ffae3e?source=collection_archive---------7-----------------------#2022-04-30">https://medium.com/geekculture/preferences-4d7119ffae3e?source=collection_archive---------7-----------------------#2022-04-30</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><p id="8fe1" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">Android的shared preferences<strong class="ii hk">vs</strong>encrypted shared preferences<strong class="ii hk">vs</strong>JetPack DataStore之间的比较。</p><figure class="jf jg jh ji fe jj es et paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="es et je"><img src="../Images/32a4cfad909fe301299feef9e6a65335.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bA_9oIDNflehO6gWN7AzlA.png"/></div></div></figure><p id="b3c1" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">Android提供了许多存储应用程序数据的方法。其中一种方式叫做共享<strong class="ii hk">偏好</strong>。共享首选项允许您以键、值对的形式保存和检索数据。</p><p id="0133" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">SharedPreferences然后扩展到<strong class="ii hk">加密的共享首选项</strong>，它以相同的方式(键，值对)存储数据，但以加密的方式。密钥和值都是加密存储的。</p><p id="2abd" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi jq translated"><span class="l jr js jt bm ju jv jw jx jy di">在</span>很多情况下，开发者希望保存类型化的对象。<strong class="ii hk"> Jetpack DataStore </strong>是一个数据存储解决方案，允许您使用<a class="ae jz" href="https://developers.google.com/protocol-buffers" rel="noopener ugc nofollow" target="_blank">协议缓冲区</a>存储键值对或类型化对象。DataStore使用Kotlin协同例程和流来异步、一致和事务性地存储数据。</p><h1 id="b6ed" class="ka kb hj bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">如何获取实例</h1><figure class="jf jg jh ji fe jj es et paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="es et ky"><img src="../Images/7e7b00bde2f9c35204b41e258368d7b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gn2SX5WfZR2n2Z1oIdvgcw.png"/></div></div><figcaption class="kz la eu es et lb lc bd b be z dy">Initialize &amp; get</figcaption></figure><h1 id="c64a" class="ka kb hj bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">如何保存键值对</h1><figure class="jf jg jh ji fe jj es et paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="es et ld"><img src="../Images/a224fde16537888ac4a520f63e6cf19c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ozURjX2FNplpkKrf6i5iEA.png"/></div></div><figcaption class="kz la eu es et lb lc bd b be z dy">save key-value pair</figcaption></figure><p id="1c2e" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">因为Preferences DataStore不使用预定义的模式，所以您必须使用相应的键类型函数为需要存储在<code class="dv le lf lg lh b">DataStore&lt;Preferences&gt;</code>实例中的每个值定义一个键。</p><p id="7d36" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi jq translated">关于数据存储的一个要点是，您只能使用线程/协程(主要是IO调度程序)来执行操作。否则，它会给出以下编译时错误:<em class="li">“挂起函数‘edit’只能从协程或另一个挂起函数中调用”</em></p><h1 id="f2d3" class="ka kb hj bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">首选项数据存储和原型数据存储</h1><p id="71bf" class="pw-post-body-paragraph ig ih hj ii b ij lj il im in lk ip iq ir ll it iu iv lm ix iy iz ln jb jc jd hc bi translated">数据存储提供了两种不同的实现:首选项数据存储和原型数据存储。</p><ul class=""><li id="bede" class="lo lp hj ii b ij ik in io ir lq iv lr iz ls jd lt lu lv lw bi translated"><strong class="ii hk">首选项数据存储</strong>使用键存储和访问数据。这种实现不需要预定义的架构，也不提供类型安全。</li><li id="32a9" class="lo lp hj ii b ij lx in ly ir lz iv ma iz mb jd lt lu lv lw bi translated"><strong class="ii hk"> Proto DataStore </strong>将数据存储为自定义数据类型的实例。这个实现要求您使用<a class="ae jz" href="https://developers.google.com/protocol-buffers" rel="noopener ugc nofollow" target="_blank">协议缓冲区</a>来定义一个模式，但是它提供了类型安全。</li></ul><h1 id="9a90" class="ka kb hj bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">文件结构</h1><p id="9c0e" class="pw-post-body-paragraph ig ih hj ii b ij lj il im in lk ip iq ir ll it iu iv lm ix iy iz ln jb jc jd hc bi translated">现在，如果我们在explorer中查看首选项文件，我们可以清楚地看到共享首选项不是加密数据，而加密共享首选项是加密数据(密钥和值都是加密的)。</p><p id="2b96" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">如果我们检查数据存储区的首选项文件，则它不会被加密，并且没有提供使用加密数据存储区的方法。虽然，谷歌说<em class="li"/><a class="ae jz" href="https://developer.android.com/topic/libraries/architecture/datastore?gclid=CjwKCAjw9qiTBhBbEiwAp-GE0XWPX4HMP70MIfSEy5hWYfepcIqheYhIj2DqhrKZ-WWgqGyH72AyWxoCFdEQAvD_BwE&amp;gclsrc=aw.ds#:~:text=If%20you%27re%20currently%20using%20SharedPreferences%20to%20store%20data%2C%20consider%20migrating%20to%20DataStore%20instead." rel="noopener ugc nofollow" target="_blank"><em class="li">如果你目前正在使用</em> </a> <code class="dv le lf lg lh b"><a class="ae jz" href="https://developer.android.com/topic/libraries/architecture/datastore?gclid=CjwKCAjw9qiTBhBbEiwAp-GE0XWPX4HMP70MIfSEy5hWYfepcIqheYhIj2DqhrKZ-WWgqGyH72AyWxoCFdEQAvD_BwE&amp;gclsrc=aw.ds#:~:text=If%20you%27re%20currently%20using%20SharedPreferences%20to%20store%20data%2C%20consider%20migrating%20to%20DataStore%20instead." rel="noopener ugc nofollow" target="_blank"><em class="li">SharedPreferences</em></a></code> <a class="ae jz" href="https://developer.android.com/topic/libraries/architecture/datastore?gclid=CjwKCAjw9qiTBhBbEiwAp-GE0XWPX4HMP70MIfSEy5hWYfepcIqheYhIj2DqhrKZ-WWgqGyH72AyWxoCFdEQAvD_BwE&amp;gclsrc=aw.ds#:~:text=If%20you%27re%20currently%20using%20SharedPreferences%20to%20store%20data%2C%20consider%20migrating%20to%20DataStore%20instead." rel="noopener ugc nofollow" target="_blank"> <em class="li"> it来存储数据，请考虑迁移到数据存储。</em></a><em class="li"/>但是它们不提供安全的数据存储方式。</p><figure class="jf jg jh ji fe jj es et paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="es et mc"><img src="../Images/e0cea924a9615a396db29cf8e29e9022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6MWBEWfGdaCPRUZcXaKWEQ.png"/></div></div><figcaption class="kz la eu es et lb lc bd b be z dy">File Structure</figcaption></figure><h1 id="2d8e" class="ka kb hj bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">文件大小</h1><figure class="jf jg jh ji fe jj es et paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="es et md"><img src="../Images/c3aace9086d034ac6b37def34a74ca46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*YZ8il5kNHmCPgrfNvlHw9A.png"/></div></div><figcaption class="kz la eu es et lb lc bd b be z dy">File size</figcaption></figure><p id="d919" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">如果您检查文件大小，那么您可以清楚地看到JetPack数据存储文件在文件大小方面胜出。</p><h1 id="4b9e" class="ka kb hj bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">移民</h1><p id="0e0c" class="pw-post-body-paragraph ig ih hj ii b ij lj il im in lk ip iq ir ll it iu iv lm ix iy iz ln jb jc jd hc bi translated">在JetPack DataStore中迁移非常容易，只需一行代码，而在Encrypted Shared Preferences中，您必须遍历新文件的所有条目，并将它们从以前的文件中删除。</p><figure class="jf jg jh ji fe jj es et paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="es et ld"><img src="../Images/7210b26922df3ced26055861b41a931f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iN4Nom_UyvvnPONYL0rmLg.png"/></div></div><figcaption class="kz la eu es et lb lc bd b be z dy">Migration</figcaption></figure></div><div class="ab cl me mf gq mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hc hd he hf hg"><p id="7723" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">还有更多要讨论的，但对本文来说已经足够了。更多代码示例可以查看我的Github repo: <a class="ae jz" href="https://github.com/rrohaill/DataStorePreferences" rel="noopener ugc nofollow" target="_blank">链接</a></p><p id="7207" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">或者你可以简单地关注我:<a class="ae jz" href="https://twitter.com/rrohaill" rel="noopener ugc nofollow" target="_blank"> Twitter </a>，<a class="ae jz" href="https://www.linkedin.com/in/rrohaill/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>😊</p></div></div>    
</body>
</html>