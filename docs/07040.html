<html>
<head>
<title>Raspberry Pi: Python Libraries for I2C, SPI, UART</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Raspberry Pi:用于I2C、SPI、UART的Python库</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/raspberry-pi-python-libraries-for-i2c-spi-uart-3df092aeda42?source=collection_archive---------4-----------------------#2021-09-06">https://medium.com/geekculture/raspberry-pi-python-libraries-for-i2c-spi-uart-3df092aeda42?source=collection_archive---------4-----------------------#2021-09-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/119cc4ee882c3ddff54237438fc07a00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4R319u08M9hlbjc95yfYvA.jpeg"/></div></div></figure><p id="c03f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Raspberry Pi是最受业余爱好者欢迎的单板计算机之一。它的40个引脚支持I2C、SPI和UART协议。如果您阅读了本系列，您会对这些协议很熟悉。但是你怎么能把它们和你的树莓派一起使用呢？</p><p id="8968" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本文向您展示了如何使用Python处理这些协议。对于每个协议，我将列出库，并向您展示一个简单的示例，以便您可以轻松地开始。</p><p id="1582" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">本文原载于</em> <a class="ae jp" href="https://admantium.com/blog/micro09_raspberry_pi_i2c_spi_uart_python_libraries/" rel="noopener ugc nofollow" target="_blank"> <em class="jo">我的博客</em> </a>。</p><h1 id="329e" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">I2C</h1><p id="0688" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">使用I2C设备时，您有多种选择。无处不在的通用库luma提供了一个<a class="ae jp" href="https://luma-core.readthedocs.io/en/latest/interface.html" rel="noopener ugc nofollow" target="_blank">通用串行对象</a>，它支持I2C连接。用法很简单:导入库，定义IC2寄存器，然后开始发送和读取数据。下面是一个如何建立I2C连接的示例</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="4599" class="lc jr hi ky b fi ld le l lf lg">from  luma.core.interface.serial.i2c import i2c</span><span id="7370" class="lc jr hi ky b fi lh le l lf lg">i2c_connection = i2c(port=0, address=0x3c)</span><span id="3149" class="lc jr hi ky b fi lh le l lf lg">i2c_connection.data('Hello')</span></pre><p id="7738" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，该库旨在创建用于实例化具体屏幕的连接对象，因此如果您使用其他基于I2C的传感器，它可能不合适。</p><p id="06cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一个选项是Python <a class="ae jp" href="https://pypi.org/project/smbus2/" rel="noopener ugc nofollow" target="_blank"> smbus2库</a>。它支持i2C协议和几种低级读写访问方法。它访问其主机内置的smbus内核模块，从中可以获得一个I2C实例。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="fa87" class="lc jr hi ky b fi ld le l lf lg">from smbus2 import SMBus, i2c_msg</span><span id="d506" class="lc jr hi ky b fi lh le l lf lg">i2c = SMBus(1)</span><span id="b522" class="lc jr hi ky b fi lh le l lf lg">msg = i2c_msg.write(80, 'Hello'.encode())<br/>bus.i2c_rdwr(msg)</span></pre><h1 id="3b3b" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">精力</h1><p id="0dfb" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">连接SPI器件的第一步是确定将器件连接到哪条SPI总线。在Raspberry Pi上，<a class="ae jp" href="https://www.raspberrypi.org/documentation/computers/raspberry-pi.html#serial-peripheral-interface-spi" rel="noopener ugc nofollow" target="_blank">存在不同的SPI总线系统</a>: 3个SPI总线系统用于版本3之前的Raspberry Pi，7个SPI总线系统用于Raspberry Pi 4。记下具体的总线，因为它将映射到系统中需要用于配置的设备文件。</p><p id="39b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">SPI协议由一个主动维护的库<a class="ae jp" href="https://pypi.org/project/spidev/" rel="noopener ugc nofollow" target="_blank"> spidev </a>支持。它可以轻松连接任何相连的SPI器件，根据所需规格配置该连接(速度单位为HZ、时钟极性等)，然后读取和写入数据。假设您要在总线5上连接一个SPI器件，以下示例将连接该器件并向其写入数据。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="13b8" class="lc jr hi ky b fi ld le l lf lg">from spidev import SpiDev</span><span id="5636" class="lc jr hi ky b fi lh le l lf lg">spi = SpiDev()<br/>spi.open(5,1)</span><span id="362f" class="lc jr hi ky b fi lh le l lf lg">spi.max_speed_hz = 4000</span><span id="84d7" class="lc jr hi ky b fi lh le l lf lg">msg = [0x01, 0x02, 0x03]<br/>spi.xfer(msg)</span><span id="a3ad" class="lc jr hi ky b fi lh le l lf lg">answer = spi.readbytes(100)<br/>print(answer)</span><span id="bc0b" class="lc jr hi ky b fi lh le l lf lg">spi.close()</span></pre><p id="6d0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一个选项是<a class="ae jp" href="https://github.com/adafruit/Adafruit_Blinka" rel="noopener ugc nofollow" target="_blank"> Adafruit_Blinka库</a>，这是一个通用库，为运行MicroPython或CPython的设备封装了CircuitPython API。因为Raspberry Pi与CPython一起工作，所以您可以使用这个库及其许多函数。它提供了接口PI的SPI特定GPIO引脚的抽象，以及创建连接的SPI类。但是，您需要在<a class="ae jp" href="https://learn.adafruit.com/circuitpython-on-raspberrypi-linux/spi-sensors-devices" rel="noopener ugc nofollow" target="_blank">附加配置</a>之后安装这个库，然后使用SPI总线1。完成后，您就可以使用SPI器件了，如下所示:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="db97" class="lc jr hi ky b fi ld le l lf lg">import time<br/>import busio</span><span id="8f67" class="lc jr hi ky b fi lh le l lf lg">spi = busio.SPI(board.SCK_1, MOSI=board.MOSI_1, MISO=board.MISO_1)</span><span id="6ffb" class="lc jr hi ky b fi lh le l lf lg">spi.configure(baudrate=400000)</span><span id="e449" class="lc jr hi ky b fi lh le l lf lg">spi.write(b'\x01')<br/>spi.write(b'\x02')<br/>spi.write(b'\x03')</span><span id="b952" class="lc jr hi ky b fi lh le l lf lg">time.sleep(0.120)</span><span id="f509" class="lc jr hi ky b fi lh le l lf lg">answer = spi.read(f)<br/>print(answer)</span><span id="afd8" class="lc jr hi ky b fi lh le l lf lg">spi.deinit()</span></pre><h1 id="ec38" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">通用非同步收发传输器(Universal Asynchronous Receiver/Transmitter)</h1><p id="5be9" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">对于UART连接，有几种选择。Python库<a class="ae jp" href="https://pypi.org/project/pyserial/" rel="noopener ugc nofollow" target="_blank"> pyserial </a>为进行串行连接提供了一个简单的、可配置的对象。您可以配置设备文件、波特率和其他通信方面，如位大小、奇偶校验、超时等。它实现Pythons上下文管理器协议，因此在其程序块结束时自动关闭连接。这里有一个例子:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="e5ff" class="lc jr hi ky b fi ld le l lf lg">from serial import Serial<br/></span><span id="0da0" class="lc jr hi ky b fi lh le l lf lg">with Serial('/dev/ttyUSB0', 9600) as serial:<br/>  serial.send('Hello to Arduino')<br/>  answer = serial.readline()<br/>  print(answer)</span></pre><p id="8489" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第二个选项也是<a class="ae jp" href="https://github.com/adafruit/Adafruit_Blinka" rel="noopener ugc nofollow" target="_blank"> Adafruit_Blinka库</a>，特别是<a class="ae jp" href="https://circuitpython.readthedocs.io/projects/blinka/en/latest/api.html#busio.UART" rel="noopener ugc nofollow" target="_blank"> busio UART API </a>。与PySerial非常相似，您可以使用默认配置创建一个连接，然后开始向其中读写数据。但是，它不处理设备文件，而是直接处理pin。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="082a" class="lc jr hi ky b fi ld le l lf lg">from busio import UART</span><span id="9ac9" class="lc jr hi ky b fi lh le l lf lg">serial = UART(14,15,baudrate=9600)</span><span id="9d25" class="lc jr hi ky b fi lh le l lf lg">serial.write('Hello to Arduino')<br/>answer = serial.readline()<br/>print(answer)</span><span id="05dc" class="lc jr hi ky b fi lh le l lf lg">serial.deinit()</span></pre><h1 id="daba" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结论</h1><p id="a45c" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">在Raspberry Pi上，有几个使用I2C、SPI和UART协议的选项。本文不是这些库的完整列表。一方面，有非常具体的库，比如UART的<code class="du li lj lk ky b">pyserial</code>，或者I2C的<code class="du li lj lk ky b">spidev</code>。另一方面，像<code class="du li lj lk ky b">luma</code>和<code class="du li lj lk ky b">busio</code>这样的通用库支持两种或所有三种协议。考虑到这一点，我建议选择通用库，尤其是如果您打算连接到这些库已经支持的传感器。</p></div></div>    
</body>
</html>