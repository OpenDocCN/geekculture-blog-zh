<html>
<head>
<title>Tutorial: Creating an Indicator Light That Turns on When You’re in a Meeting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:创建开会时亮起的指示灯</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/tutorial-creating-an-indicator-light-that-turns-on-when-youre-in-a-meeting-bdc98bc4dc77?source=collection_archive---------11-----------------------#2021-03-15">https://medium.com/geekculture/tutorial-creating-an-indicator-light-that-turns-on-when-youre-in-a-meeting-bdc98bc4dc77?source=collection_archive---------11-----------------------#2021-03-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="27b6" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">一个Python脚本，一个Raspberry Pi，一个秘密的Google日历API。我的天啊。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/515444f2640fa268aa1151606578e3db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bU2Od7Nmmk1Do7clH8I9cA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">© <a class="ae jn" href="https://www.flickr.com/photos/33613762@N07/3642074604" rel="noopener ugc nofollow" target="_blank">Curtis Kennington</a> / <a class="ae jn" href="https://www.flickr.com/photos/33613762@N07/3642074604" rel="noopener ugc nofollow" target="_blank">Flickr</a> / <a class="ae jn" href="https://creativecommons.org/licenses/by/2.0/" rel="noopener ugc nofollow" target="_blank">CC BY-SA 2.0</a>, altered with calendar added.</figcaption></figure><h1 id="016b" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">介绍</h1><p id="7c0a" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在2020年Covid疫情期间的某个时候，我搬到佛罗里达州和家人住在一起。但是由于我仍然是远程工作，我一整天都有很多会议，有时甚至是在晚上！我爱我的家人，但是他们经常在我开会的时候不敲门就进我的房间。其他时候，当我和我的经理一对一谈话时，他们会决定用吸尘器打扫或者放大声的音乐。当我开始锁门时，我的家人很不高兴(会议结束后我会忘记开门，这也没什么帮助)。最终，我认为现代问题需要现代解决方案。</p><p id="e2f0" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">我买了一个<a class="ae jn" href="https://www.amazon.com/gp/product/B015XW8128/" rel="noopener ugc nofollow" target="_blank">泛光灯</a>、一个<a class="ae jn" href="https://www.amazon.com/gp/product/B07TXM4MT3/" rel="noopener ugc nofollow" target="_blank">智能插头</a>和一个树莓派，并编写了一个脚本来检查谷歌日历，看看我是否正在开会。根据我的日历，如果我很忙，它就会打开灯。如果我不在，它就会关灯。我把这盏五彩缤纷、美丽明亮的灯放在门外，现在我的家人知道灯亮着的时候不要打扰我。他们尊重这个“忙碌的灯塔”吗？这是另一个很好的问题…</p><h1 id="4103" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">这个教程是给谁看的？</h1><p id="c9e0" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">本教程非常适合你，如果你…</p><ul class=""><li id="b226" class="lh li hi ki b kj lc km ld kp lj kt lk kx ll lb lm ln lo lp bi translated">有孩子，父母，祖父母，兄弟姐妹，室友，女朋友，男朋友，配偶，宠物黑猩猩，或者任何其他和你一起生活/工作的人需要被告知你不被打扰</li><li id="6992" class="lh li hi ki b kj lr km ls kp lt kt lu kx lv lb lm ln lo lp bi translated">使用谷歌日历来跟踪你所有的会议(或者当你忙闲的时候)</li><li id="175a" class="lh li hi ki b kj lr km ls kp lt kt lu kx lv lb lm ln lo lp bi translated">熟悉python基础和面向对象编程</li><li id="c2ae" class="lh li hi ki b kj lr km ls kp lt kt lu kx lv lb lm ln lo lp bi translated">正在寻找一个很酷的项目来做树莓派</li></ul><p id="00e7" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated"><strong class="ki hj">此处描述了该指示灯旨在防止什么:</strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lw lx l"/></div></figure><h1 id="6c25" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">你需要什么</h1><ol class=""><li id="7010" class="lh li hi ki b kj kk km kn kp ly kt lz kx ma lb mb ln lo lp bi translated">一个可以连接到你的无线网络的<a class="ae jn" href="https://www.amazon.com/Raspberry-Model-2019-Quad-Bluetooth/dp/B07TC2BK1X/" rel="noopener ugc nofollow" target="_blank">树莓派</a>。我认识的这个帅呆了的男人<a class="ae jn" href="https://pbitutsky.medium.com/headless-raspberry-pi-setup-on-mac-54422b45217c?source=friends_link&amp;sk=6e609196509e9ae439eb4fbb6da9b117" rel="noopener">写了一个教程</a>教我如何建立一个。</li><li id="26cd" class="lh li hi ki b kj lr km ls kp lt kt lu kx lv lb mb ln lo lp bi translated">任何一种灯或者任何插在墙上就能发光的东西。我买的这个<a class="ae jn" href="https://www.amazon.com/gp/product/B015XW8128/" rel="noopener ugc nofollow" target="_blank">真的很酷的泛光灯</a>，会变色，还带遥控器！</li><li id="6c62" class="lh li hi ki b kj lr km ls kp lt kt lu kx lv lb mb ln lo lp bi translated">一个Kasa智能插头，像<a class="ae jn" href="https://www.amazon.com/gp/product/B07TXM4MT3/" rel="noopener ugc nofollow" target="_blank">这个</a>。品牌是Kasa (TP-link)非常重要，因为与大多数智能插头不同，这些插头不必使用亚马逊Echo或谷歌Home来控制。你可以使用Kasa的开放API通过网络发送请求来打开或关闭它。</li></ol><h1 id="9d39" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">它将如何工作</h1><p id="c645" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">为了避免使用官方的<a class="ae jn" href="https://developers.google.com/calendar" rel="noopener ugc nofollow" target="_blank">谷歌日历API </a>，我将带你了解如何公开你的日历(只在忙/闲时)，并找到一个秘密的网址。当任何人访问这个URL时，他们都会收到一个JSON数据转储，其中包含您的日历在给定时间段(比如当天)的所有事件。这将在本教程的第1部分中讨论。</p><p id="ce6f" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">第2部分将介绍如何编写Python脚本来检查这个秘密URL，获取JSON数据，确定您当前是忙还是闲，并发送打开或关闭智能插件的请求。</p><p id="2a02" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">然后在第3部分，我将介绍如何将脚本转移到您的Raspberry Pi，并设置一个cron作业，以便脚本每分钟都运行。</p><p id="3a5e" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">我用的是Python 3.7.3，但是任何Python版本3。*应该为这个项目工作。</p><h1 id="3126" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">第1部分:查找秘密URL端点</h1><p id="8541" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在这一节中，我将带您了解如何访问一个秘密的URL端点，它将以漂亮的JSON格式在您的日历中为您提供一个有组织的事件列表。声明:我在谷歌工作，但这个秘密的API不是内部信息。如果知道如何查看他们的网络活动，任何人都可以找到它。这个非官方API相对于官方Google Calendar API的优势在于，对于我们的目的来说，这个API使用起来要简单得多。有了这个秘密的URL，您将永远不必登录或与OAuth打交道。</p><p id="4016" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">我们开始吧。首先，公开你的日历。您需要转到日历的设置页面，然后选择“公开”您还应该选择“仅查看忙/闲信息(隐藏详细信息)”<a class="ae jn" href="https://support.google.com/calendar/answer/37083?hl=en#zippy=%2Cmark-your-calendar-as-public" rel="noopener ugc nofollow" target="_blank">这里有更深入的说明。</a></p><p id="5e14" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">将日历公开后，向下滚动到“整合日历”部分，找到“此日历的公开URL”。在匿名窗口中打开该URL(以确保您可以在未登录Google的情况下访问它)。它应该是这样的:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mc"><img src="../Images/7a05cf40684e7d09e872571a1142d906.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qm8lZrJHgomArQd64bh5Pg.png"/></div></div></figure><p id="0c41" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">现在打开Chrome的开发者工具(查看&gt;开发者&gt;开发者工具)。转到“网络”选项卡。此工具将显示此网页发出的所有网络请求。如果网页决定加载图像、提交表格或下载某种文件，网络请求的详细信息应在此列出。刷新页面以查看加载此页面时发生的网络请求。您应该会看到类似这样的内容:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es md"><img src="../Images/a7e39e830eedb8792a27ffaee410cb7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*73C-9ty_v8EGfZMwXewjBw.png"/></div></div></figure><p id="4eb3" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">查找以“事件？”开头的列表项(在上图中突出显示)。您可以双击它来打开页面。内容应该是一个JSON字典，包含这个日历的所有相关信息，包括事件列表。该URL应该类似于:</p><blockquote class="me mf mg"><p id="5d85" class="kg kh lq ki b kj lc ij kl km ld im ko mh le kr ks mi lf kv kw mj lg kz la lb hb bi translated">https://clients 6 . Google . com/calendar/v3/calendars/email @ Gmail . com/events？calendar id = email % 40 Gmail . com &amp; single events = true &amp; time zone = America % 2 Flos _ Angeles &amp; max attendees = 1 &amp; max results = 250 &amp; sanitiehtml = true &amp; time min = 2021-02-28t 00% 3a 00% 3a 00-08% 3a 00 &amp; time max = 2021-04-04t 00% 3a 00% 3a 00-08% 3a 00 &amp; key = aizasybnlyh 01 _ 9hc 5s 1j 8 vufmu 2</p></blockquote><p id="1c8b" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">拆分一下，这个url由域+路径:<br/><em class="lq">clients 6 . Google . com/calendar/v3/calendars/email @ Gmail . com/events</em><br/>组成，后面跟着很多参数，包括<em class="lq"> timeMin </em>和<em class="lq"> timeMax </em>，控制事件的时间范围。将这些日期时间更改为当天的开始和结束时间将会显示出您日历上今天的所有事件。</p><p id="13e1" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">通过正确设置这个URL中的参数，我们将在下一节中编写的Python脚本可以很容易地获得当天日历上所有事件的列表。</p><h1 id="9e77" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">第2部分:编写Python脚本</h1><p id="5583" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">这一部分将逐步指导您如何编写python脚本，该脚本将从Google日历中检索您的忙碌时间，在您的本地网络上找到Kasa智能插头，告诉它打开/关闭，以及更多内容，包括如何实现一些缓存，以便您不会每分钟都发送网络请求。如果你想跳过这一部分，只是马上看到代码，你可以<a class="ae jn" href="https://github.com/pbitutsky/busybeacon/blob/master/busybeacon.py" rel="noopener ugc nofollow" target="_blank">在Github这里</a>找到。</p><h2 id="7e5d" class="mk jp hi bd jq ml mm mn ju mo mp mq jy kp mr ms ka kt mt mu kc kx mv mw ke mx bi translated">从谷歌日历中获取繁忙时间</h2><p id="02e0" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">让我们从编写一个函数开始，这个函数获取你一天中忙碌的所有时间(开始和结束)。这个函数应该生成一个URL，当被请求时，它将返回今天00:00到明天00:00之间所有事件的JSON转储。然后它应该处理JSON数据并返回元组列表<code class="du my mz na nb b">(start time, end time)</code>。</p><p id="68ab" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">一个棘手的部分是确保URL被正确编码，这意味着<code class="du my mz na nb b">/</code>应该被转换成<code class="du my mz na nb b">%2F</code>，而<code class="du my mz na nb b">:</code>需要被转换成<code class="du my mz na nb b">%3A</code>。</p><p id="fc99" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">此外，如果您的日历中有全天事件，您是否希望灯全天亮着？我认为，任何持续一整天或更长时间的活动都不应该算作忙碌时间。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nc lx l"/></div></figure><h2 id="6bb2" class="mk jp hi bd jq ml mm mn ju mo mp mq jy kp mr ms ka kt mt mu kc kx mv mw ke mx bi translated">检查你现在是否忙</h2><p id="d9c0" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">该脚本将每分钟运行一次，并需要知道您目前是否忙碌。让我们写一个函数，如果你忙的话返回<code class="du my mz na nb b">true</code>，如果你闲的话返回<code class="du my mz na nb b">false</code>。一个好的软件工程师会努力使他/她的功能尽可能通用，以便在需要时可以重用。为了努力成为一名优秀的开发人员，我让这个函数检查我在任何给定的时间是否忙。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nc lx l"/></div></figure><p id="2ac3" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">这个函数以元组<code class="du my mz na nb b">(start time, end time)</code>的形式接受一个繁忙时间列表，并遍历所有这些繁忙时间，以查看<code class="du my mz na nb b">time_to_check</code>是否落在它们之间。</p><h2 id="9180" class="mk jp hi bd jq ml mm mn ju mo mp mq jy kp mr ms ka kt mt mu kc kx mv mw ke mx bi translated">连接到Kasa智能插头</h2><p id="739b" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在继续编写如何连接Kasa智能插头的代码之前，请确保它已准备就绪。一旦你使用Kasa应用程序设置好它，它就应该连接到你的wifi网络。</p><p id="7ee3" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">运行<code class="du my mz na nb b">pip install python-kasa</code>下载<em class="lq"> python-kasa </em>库。</p><p id="71a6" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">完成后，您应该能够运行命令<code class="du my mz na nb b">kasa</code>并看到关于您的设备的信息，包括其IP地址:</p><pre class="iy iz ja jb fd nd nb ne nf aw ng bi"><span id="4ad0" class="mk jp hi nb b fi nh ni l nj nk">$ kasa<br/>No host name given, trying discovery..<br/>Discovering devices on 255.255.255.255 for 3 seconds<br/>== Busybeacon - HS105(US) ==<br/> Host: 192.168.86.165<br/> Device state: OFF</span><span id="a6ab" class="mk jp hi nb b fi nl ni l nj nk">== Generic information ==<br/> Time:         2021-03-14 14:34:13<br/> Hardware:     4.0<br/> Software:     1.0.2 Build 200804 Rel.091847<br/> MAC (rssi):   60:32:B1:73:14:05 (-27)<br/> Location:     {'latitude': 0, 'longitude': 0}</span><span id="872c" class="mk jp hi nb b fi nl ni l nj nk">== Device specific information ==<br/> LED state: True<br/> On since: None</span></pre><p id="3a96" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">您也可以通过命令行打开和关闭它，如下所示:</p><pre class="iy iz ja jb fd nd nb ne nf aw ng bi"><span id="634b" class="mk jp hi nb b fi nh ni l nj nk">kasa --host [YOUR DEVICE IP] on</span><span id="b61d" class="mk jp hi nb b fi nl ni l nj nk">kasa --host [YOUR DEVICE IP] off</span></pre><p id="ce29" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">使用这个kasa库在python中完成这些相同的操作非常简单。</p><ul class=""><li id="0e14" class="lh li hi ki b kj lc km ld kp lj kt lk kx ll lb lm ln lo lp bi translated"><code class="du my mz na nb b">SmartPlug(&lt;ip address&gt;)</code>可以创建一个给定特定IP地址的智能插件对象。<code class="du my mz na nb b">SmartPlug</code>是<code class="du my mz na nb b">SmartDevice</code>的子类。<code class="du my mz na nb b">SmartDevice</code>对象的属性包括<code class="du my mz na nb b">host</code> (IP地址)和<code class="du my mz na nb b">name</code>(您设置设备时对设备的命名)。</li><li id="43f3" class="lh li hi ki b kj lr km ls kp lt kt lu kx lv lb lm ln lo lp bi translated"><code class="du my mz na nb b">discover()</code>列出网络上的设备</li><li id="db31" class="lh li hi ki b kj lr km ls kp lt kt lu kx lv lb lm ln lo lp bi translated"><code class="du my mz na nb b">smart_device.update()</code>获取智能设备的信息，包括其状态(是关闭还是打开)</li><li id="5854" class="lh li hi ki b kj lr km ls kp lt kt lu kx lv lb lm ln lo lp bi translated"><code class="du my mz na nb b">smart_device.turn_on()</code>打开设备，<code class="du my mz na nb b">smart_device.turn_off()</code>关闭设备。</li></ul><p id="590f" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">python-kasa库中的许多方法需要在异步上下文中运行，这是有意义的，因为您通常不希望代码在设备执行某些操作时停止。所以要运行这些方法，你需要使用<code class="du my mz na nb b">asyncio</code>库。用<code class="du my mz na nb b">pip install asyncio</code>安装。</p><p id="ff4c" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">您的智能插头的IP地址可能会偶尔改变，但不会经常改变，所以最好将其缓存起来。让我们编写一个函数，尝试连接到一个给定IP的智能设备，如果它不能连接，那么它将扫描网络，寻找一个给定名称的设备。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nc lx l"/></div></figure><p id="f829" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">这个函数将尽力返回一个<code class="du my mz na nb b">SmartDevice</code>对象。一旦我们有了对一个<code class="du my mz na nb b">SmartDevice</code>对象的引用，我们将需要一个函数来设置它的状态(打开和关闭):</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nc lx l"/></div></figure><h2 id="ccee" class="mk jp hi bd jq ml mm mn ju mo mp mq jy kp mr ms ka kt mt mu kc kx mv mw ke mx bi translated">将这一切结合在一起</h2><p id="6251" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">为了正常工作，python脚本需要执行以下操作:</p><ol class=""><li id="33cd" class="lh li hi ki b kj lc km ld kp lj kt lk kx ll lb mb ln lo lp bi translated">从谷歌日历中获取繁忙时间。</li><li id="7c23" class="lh li hi ki b kj lr km ls kp lt kt lu kx lv lb mb ln lo lp bi translated">扫描网络并找到智能插头。</li><li id="e7e2" class="lh li hi ki b kj lr km ls kp lt kt lu kx lv lb mb ln lo lp bi translated">看看你现在是否忙。</li><li id="ea79" class="lh li hi ki b kj lr km ls kp lt kt lu kx lv lb mb ln lo lp bi translated">相应地设置设备状态:忙时打开，闲时关闭。</li></ol><p id="25b4" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">一个需要考虑的边缘情况是:如果(可能是错误的)一个事件在深夜被放到你的日程表上，该怎么办？我买的泛光灯足够亮，可以叫醒我，所以我确保排除了白天/工作时间以外的事件。我肯定不会从早上9点到晚上10点工作，但那是我决定允许我的<em class="lq">忙碌信标</em>可能被打开的时间范围。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nc lx l"/></div></figure><h2 id="b714" class="mk jp hi bd jq ml mm mn ju mo mp mq jy kp mr ms ka kt mt mu kc kx mv mw ke mx bi translated">缓存</h2><p id="09e6" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">您可能不希望脚本每分钟都检查Google日历。没有人应该提前一分钟安排会议，对吗？你也不想每分钟都扫描你的网络来寻找你的智能插头。为了避免这种情况，您应该在本地文件中缓存繁忙时间和智能插件的IP。我决定我只想每5分钟刷新一次缓存(查看Google日历)。下面是新算法在缓存后的样子:</p><ol class=""><li id="5448" class="lh li hi ki b kj lc km ld kp lj kt lk kx ll lb mb ln lo lp bi translated">从缓存中获取繁忙时间和智能插件IP。(除非缓存不存在，或者今天没有更新，或者是时候刷新缓存了)</li><li id="3ef0" class="lh li hi ki b kj lr km ls kp lt kt lu kx lv lb mb ln lo lp bi translated">看看你现在是否忙。</li><li id="c836" class="lh li hi ki b kj lr km ls kp lt kt lu kx lv lb mb ln lo lp bi translated">相应地设置设备状态:忙时打开，闲时关闭。</li><li id="3328" class="lh li hi ki b kj lr km ls kp lt kt lu kx lv lb mb ln lo lp bi translated">将繁忙时间和智能插头IP写入缓存。</li></ol><p id="91ed" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">要对智能插头的繁忙时间和IP地址进行编码，可以使用一个叫做<code class="du my mz na nb b">pickle</code>的方便的python库。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nc lx l"/></div></figure><p id="b7ab" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">搞定了。剧本准备好了。你可以在这里看到完整的代码。在您更新了顶部的常量(包括日历URL模板)之后，您应该能够运行它了:<code class="du my mz na nb b">python3 busybeacon.py</code>。</p><h1 id="0972" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">第3部分:在您的Raspberry Pi上每分钟运行脚本</h1><p id="87e2" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在开始此部分之前，请确定您的Raspberry Pi已正确设置、打开并连接到您的wifi网络。您不需要将Pi连接到监视器，但是您需要通过SSH连接到监视器。如果你还没有设置树莓派，<a class="ae jn" href="https://pbitutsky.medium.com/headless-raspberry-pi-setup-on-mac-54422b45217c?source=friends_link&amp;sk=6e609196509e9ae439eb4fbb6da9b117" rel="noopener">这里有一个教程</a>教你如何设置。</p><p id="951b" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">好的，第一步是将python脚本复制到Raspberry Pi。你可以用<code class="du my mz na nb b">scp</code>命令来完成。这应该会将它复制到您在Pi:</p><pre class="iy iz ja jb fd nd nb ne nf aw ng bi"><span id="252c" class="mk jp hi nb b fi nh ni l nj nk">scp path/to/busybeacon.py pi@raspberrypi.lan:busybeacon.py</span></pre><p id="2bc2" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">通过<code class="du my mz na nb b">ssh</code>进入Raspberry Pi并运行脚本来确保它正常工作:</p><pre class="iy iz ja jb fd nd nb ne nf aw ng bi"><span id="fdd8" class="mk jp hi nb b fi nh ni l nj nk">python3 busybeacon.py</span></pre><p id="be2d" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">你可能需要使用pip/pip3安装像<em class="lq"> python-kasa </em>这样的依赖项。</p><p id="f755" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">现在让我们安排这个脚本每分钟运行一次。有一个很棒的工具叫做<em class="lq"> cron </em>，它可以让你安排任务在指定的时间间隔运行。这些任务及其时间表都写在cron表中。您可以使用以下命令编辑cron表:</p><pre class="iy iz ja jb fd nd nb ne nf aw ng bi"><span id="6de7" class="mk jp hi nb b fi nh ni l nj nk">crontab -e</span></pre><p id="fbfe" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">这将打开一个编辑器(通常是nano或vim ),让您编辑这个文件。将下面一行添加到文件中:</p><pre class="iy iz ja jb fd nd nb ne nf aw ng bi"><span id="cd46" class="mk jp hi nb b fi nh ni l nj nk">* * * * *  python3 busybeacon.py</span></pre><p id="84dd" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">五个星号表示该命令应该在(1)每分钟(2)每小时(3)每天(4)每月(5)每天运行。</p><p id="8905" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">你可以在这里找到更多关于用cron <a class="ae jn" href="https://www.raspberrypi.org/documentation/linux/usage/cron.md" rel="noopener ugc nofollow" target="_blank">调度任务的信息。</a></p></div><div class="ab cl nm nn gp no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="hb hc hd he hf"><p id="9745" class="pw-post-body-paragraph kg kh hi ki b kj lc ij kl km ld im ko kp le kr ks kt lf kv kw kx lg kz la lb hb bi translated">就是这样！现在你有了自己的<em class="lq">忙碌灯塔</em>！希望这能帮助你减少被打扰的频率，防止任何尴尬的情况。如果您对改进本教程有任何问题、意见或建议，请随时留下评论或联系我们。</p></div></div>    
</body>
</html>