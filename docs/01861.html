<html>
<head>
<title>How to Build Your Own Gem in Ruby</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Ruby中构建自己的Gem</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-build-your-own-gem-in-ruby-5ac71b308350?source=collection_archive---------24-----------------------#2021-04-26">https://medium.com/geekculture/how-to-build-your-own-gem-in-ruby-5ac71b308350?source=collection_archive---------24-----------------------#2021-04-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9a9f7b707fc146d4629d91ccfefb1907.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pozrRiWojXYlR2ef"/></div></div></figure><p id="dd39" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">顾名思义，Ruby编程语言的繁荣得益于<a class="ae jo" href="https://blog.engineyard.com/7-ruby-gems-to-keep-in-your-toolbox" rel="noopener ugc nofollow" target="_blank"> gems </a>的出现。和之前的插件一样，gems是用来执行特定任务的迷你代码，不会干扰或直接成为我们代码的一部分。gem所需的代码仍然是我们项目生态系统的一部分，但是我们最终会通过使用gem而不是自己编写代码来消除一些开销——并避免不必要的重复。</p><p id="6612" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那么为什么要创造一个宝石呢？当你有一段独立的代码，或者当开发人员意识到这段代码可能对其他人有帮助时，Gems就是一个有用的副产品。如果我们想在其他地方使用这些代码，或者想分享它们，那么就到了打造宝石的时候了。</p><p id="0edd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">gem很容易构建，而且创建它们所需的工具很可能已经安装在您的环境中。我们的第一步是安装<a class="ae jo" href="http://bundler.io/" rel="noopener ugc nofollow" target="_blank">捆扎机</a>。Rails是Bundler最广为人知的应用项目，但是我们也可以使用Bundler——不仅用于gem依赖管理——还用于编写我们自己的gem。</p><p id="91ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦捆扎机安装完毕，我们就可以开始制作宝石了。但是在实际编写任何东西或者创建一个沙盒来使用之前，我们需要做所有编程中最困难的事情之一:命名事物。我们的gem应该有一个描述它做什么的名字，容易记住，希望以前没有用过。要仔细检查潜在宝石的名称，请查看Rubygems.org的<a class="ae jo" href="https://rubygems.org/" rel="noopener ugc nofollow" target="_blank">搜索功能。此外，这种搜索还可能将我们带到一个具有我们最初想要创建的相同功能的gem，从而从长远来看节省了我们的额外工作。</a></p><p id="b4ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于这篇博文，我们要写一个名为heynow的宝石。这个宝石的功能将面向下班后使用我们的应用程序的人，向他们指出现在是什么时间。不是很有用，但是对于我们的例子来说非常好，因为创建起来非常简单明了。我们开始吧！</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="2f6a" class="jy jz hi ju b fi ka kb l kc kd">$ bundle gem heynow</span></pre><p id="925f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">系统将提示我们选择一个测试框架(、或无)。请选择一个首选的测试框架，如果它没有出现在这里，请选择无。出于我们的目的，我们将选择rpec。</p><p id="0a4e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们将有机会选择我们是否希望这个宝石在麻省理工学院的许可下发布，以及是否将行为准则归于您的宝石。我们推荐这两种方式，但是当然这些决定取决于你的团队。</p><p id="dfa6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦完成，就会创建一个名为“heynow”的目录供我们使用。该目录将如下所示:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="4c82" class="jy jz hi ju b fi ka kb l kc kd">projects pjhagerty$ cd heynow/<br/>heynow pjhagerty$ ls<br/>CODE_OF_CONDUCT.md LICENSE.txt Rakefile heynow.gemspec spec<br/>Gemfile README.md bin lib</span></pre><p id="3092" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们首先需要查看的是gemspec文件——hey now . gem spec。该文件保存了有关宝石的所有元数据。这包括从你的作者姓名到你想使用的许可证的一切。在这种情况下，我们将添加描述并保留自动生成的标准MIT许可证。我们的heynow.gemspec文件应该如下所示:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="f35b" class="jy jz hi ju b fi ka kb l kc kd">require_relative ‘lib/heynow/version’</span><span id="8e5a" class="jy jz hi ju b fi ke kb l kc kd">Gem::Specification.new do |spec|<br/>spec.name = “heynow”<br/>spec.version = Heynow::VERSION<br/>spec.authors = [“PJ Hagerty”]<br/>spec.email = [“pjhagerty@gmail.com”]</span><span id="3643" class="jy jz hi ju b fi ke kb l kc kd">spec.summary = %q{The function of this gem will be oriented to people who are using our app after hours, pointing out to them what time it is right now.}<br/>spec.description = %q{The function of this gem will be oriented to people who are using our app after hours, pointing out to them what time it is right now.}<br/>spec.homepage = “https://github.com/aspleenic/heynow”<br/>spec.license = “MIT”<br/>spec.required_ruby_version = Gem::Requirement.new(“&gt;= 2.3.0”)</span><span id="ca23" class="jy jz hi ju b fi ke kb l kc kd"># spec.metadata[“allowed_push_host”] = “https://github.com/aspleenic/heynow"</span><span id="0037" class="jy jz hi ju b fi ke kb l kc kd">spec.metadata[“homepage_uri”] = spec.homepage<br/>spec.metadata[“source_code_uri”] = spec.homepage<br/>spec.metadata[“changelog_uri”] = spec.homepage</span><span id="8009" class="jy jz hi ju b fi ke kb l kc kd"># Specify which files should be added to the gem when it is released.<br/># The `git ls-files -z` loads the files in the RubyGem that have been added into git.<br/>spec.files = Dir.chdir(File.expand_path(‘..’, __FILE__)) do<br/> `git ls-files -z`.split(“\x0”).reject { |f| f.match(%r{^(test|spec|features)/}) }<br/>end<br/>spec.bindir = “exe”<br/>spec.executables = spec.files.grep(%r{^exe/}) { |f| File.basename(f) }<br/>spec.require_paths = [“lib”]<br/>end</span></pre><p id="3a7a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果这里有几行代码你不能马上理解，不要担心。gemspec文件的大部分是自动构建的，因此我们可以专注于制作有用的gem。我们负责作者部分、电子邮件、描述、摘要和主页(只有当我们的gem变得如此受欢迎以至于需要时)，然后让生成的代码做剩下的事情。</p><p id="eb5c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦我们完成了排序，并且我们将代码提交给了我们选择的回购协议，我们就可以看看如何对我们的gem进行版本控制了。重要的是，我们要遵循我们在Ruby代码的其余部分所学到的语义版本控制技术。关于语义版本化的更多信息，<a class="ae jo" href="http://guides.rubygems.org/patterns/#semantic-versioning" rel="noopener ugc nofollow" target="_blank">请看这篇文章</a>。</p><p id="2d74" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">gem的版本控制保存在lib目录下的gem名称文件中，该文件位于一个名为version.rb的脚本中(在我们的例子中:lib/heynow/version.rb)。这是一个简单的模块，我们不需要更改它，因为我们正在开发gem的第一个版本:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="adcb" class="jy jz hi ju b fi ka kb l kc kd">module Heynow</span><span id="812f" class="jy jz hi ju b fi ke kb l kc kd"> VERSION = “0.1.1”</span><span id="afb7" class="jy jz hi ju b fi ke kb l kc kd">end</span></pre><p id="1eb9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">(一旦我们有了工作中的gem的未来迭代，我们就可以担心升级版本了。目前，我们可以使用0.0.1版本。)</p><p id="c3a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在是时候写代码来做我们希望我们的gem做的事情了。实际的可执行代码将写在lib/heynow.rb中，最初看起来是这样的:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="99a4" class="jy jz hi ju b fi ka kb l kc kd">require “heynow/version”</span><span id="3353" class="jy jz hi ju b fi ke kb l kc kd">module Heynow<br/> class Error &lt; StandardError; end<br/> # Your code goes here…<br/>end</span></pre><p id="b7b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有人好心地创造了一个空间，让我们知道把你的代码放在哪里，这是假设你知道如何编码。这篇文章不会涉及代码本身的编写或测试的重要性，但我们将继续下一步，创建一个gem，这意味着向全世界发布它。要看完整的heynow宝石，看一看<a class="ae jo" href="https://github.com/aspleenic/sleepr" rel="noopener ugc nofollow" target="_blank"> heynow回购</a>。</p><p id="97c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们已经为创业板建立了回购机制，因此它已经<a class="ae jo" href="https://github.com/aspleenic/heynow" rel="noopener ugc nofollow" target="_blank">公开上市</a>。但是我们需要把它放在别的地方，让人们知道我们正在把它献给世界:RubyGems.org。我们的第一步将是用他们方便的表格建立一个账户。一旦您有了帐户，我们就可以设置自己的凭据:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="0008" class="jy jz hi ju b fi ka kb l kc kd">heynow pjhagerty$ gem build heynow.gemspec<br/> Successfully built RubyGem<br/> Name: heynow<br/> Version: 0.1.1<br/> File: heynow-0.1.1.gem</span></pre><p id="9232" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，我们可以通过发出以下命令将我们的gem移动到RubyGems:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="5b7c" class="jy jz hi ju b fi ka kb l kc kd">heynow $ gem push heynow-0.1.2.gem<br/>Enter your RubyGems.org credentials.<br/>Don’t have an account yet? Create one at<br/>https://rubygems.org/sign_up<br/> Email: pj@gmail.com<br/>Password:</span><span id="bbb3" class="jy jz hi ju b fi ke kb l kc kd">Signed in.<br/>Pushing gem to <a class="ae jo" href="https://rubygems.org..." rel="noopener ugc nofollow" target="_blank">https://rubygems.org...</a><br/>Successfully registered gem: heynow (0.1.2)</span></pre><p id="f0ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有了这个命令，将会发生两件事:我们的git repo将被标记上版本号，我们的gem将可以通过它的<a class="ae jo" href="https://rubygems.org/gems/heynow" rel="noopener ugc nofollow" target="_blank"> RubyGems页面</a>访问。幸运的话，由于你的勤奋工作，人们很快就会将heynow放入他们的Gemfile，并为他们的最终用户捆绑更好的体验。</p><p id="36ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你对Engine Yard发布的或者过去参与的一些宝石感兴趣，看看我们的开源贡献或者深入我们的<a class="ae jo" href="https://github.com/search?utf8=%E2%9C%93&amp;q=Engine+Yard" rel="noopener ugc nofollow" target="_blank">公共github repos </a>。</p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="2df6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">【https://blog.engineyard.com】最初发表于<a class="ae jo" href="https://blog.engineyard.com/how-to-build-your-own-gem-in-ruby" rel="noopener ugc nofollow" target="_blank"><em class="km"/></a><em class="km">。</em></p></div></div>    
</body>
</html>