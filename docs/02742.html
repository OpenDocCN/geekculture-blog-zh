<html>
<head>
<title>How to conditionally render React UI based on user permissions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何基于用户权限有条件地呈现React UI</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-conditionally-render-react-ui-based-on-user-permissions-7b9a1c73ffe2?source=collection_archive---------1-----------------------#2021-05-25">https://medium.com/geekculture/how-to-conditionally-render-react-ui-based-on-user-permissions-7b9a1c73ffe2?source=collection_archive---------1-----------------------#2021-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/2802000c6d29688335b8b20145731538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uJ7uijA2eurqLs_XxXjO-w.jpeg"/></div></div></figure><div class=""/><p id="19f6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由于现代浏览器的强大功能，Web应用程序变得越来越复杂。随着越来越多的应用出现了对用户进行认证和细分的需求。</p><p id="4f16" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">事实上，不同的用户对应用程序有不同的权限，允许他们根据自己的配置文件/角色执行不同的操作。</p><p id="1a42" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我们将学习如何组织权限，以及如何根据当前用户的权限显示应用程序的一部分。</p><h1 id="ab03" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">TL；DR；</h1><p id="551b" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">如果你是那种演示代码类型的开发人员，你可以在这里找到最终代码:<a class="ae kr" href="https://github.com/francois-roget/permission-provider-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/francois-roget/permission-provider-demo</a></p><h1 id="20e5" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">这不是安全！</h1><p id="5cf5" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">首先，我想强调的是，这种机制并不是为了阻止对服务器的未授权请求。更多的是用户体验的提升。</p><p id="92f6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们必须记住，浏览器上运行的任何Javascript代码都是本地的，最终用户完全可以读取。使用这种技术隐藏按钮或屏幕不会阻止任何人查看代码并发现API端点或应用程序的内部逻辑。</p><p id="4a02" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在采取任何行动之前，应该在服务器端检查对API的所有调用是否得到用户的许可。</p><h1 id="5928" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">如何组织您的权限</h1><p id="390a" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">处理用户权限的更简单/诱人的方法是检查，例如，当前用户是否是“admin”。基于此，应用程序的不同部分将被允许或不被允许。</p><p id="d614" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这样做将很快阻止您，因为新的请求肯定会到达，以改变(非)管理员用户可以看到的内容，或者创建另一种类型的用户，该用户可以比简单用户做得更多，但比管理员少。</p><p id="e7dd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">处理权限的最佳方式是为应用程序中允许或限制的每个粒度操作创建一个权限。例如，您可以为以下各项定义单独的权限:</p><ul class=""><li id="30ad" class="ks kt ht is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated">查看元素列表(<em class="lb"> element.list </em></li><li id="d0f1" class="ks kt ht is b it lc ix ld jb le jf lf jj lg jn kx ky kz la bi translated">添加一个元素(<em class="lb"> element.add </em></li><li id="cca7" class="ks kt ht is b it lc ix ld jb le jf lf jj lg jn kx ky kz la bi translated">修改元素(<em class="lb"> element.edit </em>)</li><li id="3cfe" class="ks kt ht is b it lc ix ld jb le jf lf jj lg jn kx ky kz la bi translated">移除元素(<em class="lb"> element.delete </em>)</li></ul><p id="efca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">想法是将这些权限聚合到角色中，在角色中定义分配给该角色的用户可以做什么。例如，创建一个拥有所有权限的角色“admin”将是一个很好的起点。然后，您可以创建一个只有<em class="lb"> element.list </em>权限的角色“查看者”和一个有<em class="lb"> element.list </em>和<em class="lb"> element.add </em>权限的角色“贡献者”。</p><p id="a46a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lb">github链接中的代码示例采用了一种更简单的方法，直接向用户分配个人权限。在您的实际应用程序中，请考虑将他们按角色分组。</em></p><h1 id="fa04" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">简单的用例</h1><p id="4e2b" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">让我们想象一个简单的CRUD用例，其中登录的用户根据他们的角色有不同的可用操作:</p><ul class=""><li id="095c" class="ks kt ht is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated">查看者角色只能列出项目</li><li id="0b63" class="ks kt ht is b it lc ix ld jb le jf lf jj lg jn kx ky kz la bi translated">参与者角色可以列出项目并添加新项目</li><li id="5de9" class="ks kt ht is b it lc ix ld jb le jf lf jj lg jn kx ky kz la bi translated">管理员角色可以执行所有操作(列出项目、添加项目和删除项目)</li></ul><h1 id="12ba" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">最小可行产品</h1><p id="dca2" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">现在，让我们看看为了获得所需的特性，我们需要实现的最少代码。</p><p id="b0fb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们将使用React的上下文API。该api允许开发人员创建由两个元素组成的上下文:</p><ul class=""><li id="7d82" class="ks kt ht is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated">将保存数据的提供者</li><li id="575a" class="ks kt ht is b it lc ix ld jb le jf lf jj lg jn kx ky kz la bi translated">将使用提供者提供的数据的消费者</li></ul><figure class="li lj lk ll fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lh"><img src="../Images/8cdf781615637d48675b9a35a873cdb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M6mA2O_F7q4j0nmBAC3Gqg.png"/></div></div></figure><p id="9afa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这种情况下，在提供者和使用者之间传递的数据是一种允许使用者知道特定权限是否被授予当前用户的方法。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="3f15" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们应该实现PermissionProvider，它将保存检查用户权限的逻辑。这个PermissionProvider将接收用户的权限作为道具，并提供方法<em class="lb"> isAllowedTo </em>的实现。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="213c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要的最后一个组件是一个消费者，在我们的应用程序中，在我们需要有条件地呈现部分UI的每个地方使用。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="e613" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用这些组件，我们可以用PermissionProvider包围我们的应用程序，然后使用受限组件。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="6c36" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这允许只向具有正确权限的用户显示操作按钮。</p><h1 id="9ead" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">提高</h1><h2 id="9351" class="lo jp ht bd jq lp lq lr ju ls lt lu jy jb lv lw kc jf lx ly kg jj lz ma kk mb bi translated">后备渲染器</h2><p id="23c8" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">为了给开发人员和UI设计人员提供更大的灵活性，如果用户没有特定的权限，可以显示一个替代的UI就太好了。为此，将向限制组件添加一个回退属性。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="lm ln l"/></div></figure><h2 id="1867" class="lo jp ht bd jq lp lq lr ju ls lt lu jy jb lv lw kc jf lx ly kg jj lz ma kk mb bi translated">自定义挂钩</h2><p id="4c6c" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">创建自定义挂钩将允许在更复杂的情况下使用权限。当我们需要一个基于用户许可的定制逻辑(不仅仅是渲染)时，这是很有用的。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="8961" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个自定义挂钩现在可以用在受限组件中。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="lm ln l"/></div></figure><h1 id="c4ec" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">更进一步</h1><p id="ff2a" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">现在让我们考虑一个更复杂(真实世界)的用例，其中用户有很多权限，这些权限在登录时无法获取，或者权限只能通过域区域获取。</p><p id="1802" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这种情况下，权限获取和检查机制是异步的。供应商和消费者都必须考虑这种延迟。</p><figure class="li lj lk ll fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mc"><img src="../Images/c63c0d23dff3d122c004efd5433476d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*avFIh6LPBHbbrV9Q2p35ow.png"/></div></div></figure><p id="a61b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了使它异步，我们需要更新提供者以从isAllowedTo方法返回一个承诺。在异步权限获取的情况下，PermissionProvider现在接收“获取权限的异步方法”而不是“权限列表”。</p><p id="06c4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">同时，可以在PermissionProvider级别缓存请求的权限，以加快UI的速度。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="9f11" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">自定义挂钩得到更新</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="fe94" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，消费者应该等待承诺的完成。问题是“获取权限时应该显示什么？”。消费者可以不呈现任何内容，也可以将加载组件作为参数传递。</p><figure class="li lj lk ll fd hk"><div class="bz dy l di"><div class="lm ln l"/></div></figure><h1 id="44a9" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">就是这样，伙计们</h1><p id="93fb" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我真的希望这篇文章能帮助你设计更友好的用户界面。你可以在这里找到所有的代码:<a class="ae kr" href="https://github.com/francois-roget/permission-provider-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/francois-roget/permission-provider-demo</a>(看看不同阶段的标签)。</p></div></div>    
</body>
</html>