# 如何计算服务器每秒最大请求数

> 原文：<https://medium.com/geekculture/how-to-calculate-server-max-requests-per-second-38a39bb96a85?source=collection_archive---------1----------------------->

关于如何计算服务器每秒可以处理的最大请求的初学者指南。

![](img/65a65ca062f37dac202151e074456589.png)

A telephone booth can only handle one telephone call at a time.

创建新服务之前的一个重要部分叫做容量规划。在此过程中，我们计算服务需要多少资源才能处理预计的流量。

通俗地说，这个计划就像为一群人计划一次旅行，知道有多少人要去，可以帮助你决定旅行需要多少辆车。比方说，有 10 个人，每辆车最多可以坐 5 个人，这意味着这次旅行你至少需要 2 辆车。

服务器呢？假设您预计最多有 10000 个 RPS，您如何计算服务器的大小？为此，您需要了解*“汽车”*或服务器，它能处理多少请求？

在进行任何实际计算之前，我们有必要知道边界或服务器限制，因为服务器只有有限数量的资源，就像汽车一样。这些界限是什么？

# CPU 限制

电脑可以做计算。这个计算需要 CPU 工作。处理图像和将字符串转换为字节是需要计算的过程的例子。因此，限制因素是机器的 CPU 能力。 ***这里的限制是 CPU 的能力和内核数量。*** 基本上，更多的内核等于更多的工人。工人越多，意味着可以完成的任务越多，RPS 越高。

在 CPU 受限的系统中，我们可以使用以下公式计算 RP 的数量:

![](img/2b5830ee8005dbaba670cf236dd52bfb.png)

RPS for CPU bound system

例如，内核总数为 4 且任务持续时间为 10ms 的服务器可以处理 400 个 RPS，而任务持续时间为 100ms 的同一服务器只能处理 40 个 RPS。

# 受记忆限制

计算机需要信息或数据才能工作。它从数据库中获取数据，读取文件，或者通过调用另一台计算机从网络上获取数据。在等待数据时，CPU 大部分时间什么也不做。由于一台计算机可以有多个工作线程，因此当一个工作线程等待前一个进程完成时，其他工作线程仍然可以执行该任务。

从上一部分中，我们知道计算机受工作人员数量的限制，但是在对数据本身进行任何操作之前，计算机需要将数据存储在内存中。 ***这里的极限是 RAM* 。基本上，更多的内存意味着更多的工人。工人越多，意味着可以完成的任务越多，RPS 越高。**

在内存受限的系统中，我们可以使用以下公式计算 RP 的数量:

![](img/89af3d1b62012f703b0f759216b24d56.png)

RPS for memory-bound system

例如，总 RAM 为 16Gb、任务内存使用量为 40Mb、任务持续时间为 100 毫秒的服务器可以处理 4000 个 RPS，而任务持续时间为 50 毫秒(是之前的一半)的服务器可以处理 8000 个 RPS。

> 为了有更多的 RPS，服务器需要有更多的 RAM，更小的任务内存使用，和更快的任务持续时间。

# 输入输出绑定

一台计算机可以和另一台计算机对话。要与另一台计算机对话，计算机需要创建一个请求，而接收计算机需要接受该请求。在基于 UNIX 的计算机中，创建和接受请求都会创建一个文件描述符。一台计算机的文件描述符数量有限。 ***这里的限制是打开文件的限制*** 。打开文件限制有软限制和硬限制。

> **软限制**是那些实际影响过程的软限制；**硬限制**是**软限制**的最大**值。任何用户或过程都可以将**软限制**提高到**硬限制**的值。**

这些限制高度依赖于操作系统。默认情况下，软限制为 1024，硬限制为 4096。打开文件限制是一个常见的限制，即使服务器仍然有 CPU 和内存使用空间，也不会出现 RPS。打开文件限制越高，意味着可以接收和发出的请求越多，从而导致 RPS 越高。

另一种不同的 I/O 限制是网络带宽。请记住，当一台计算机与另一台计算机对话时，它基本上是从一台计算机向另一台计算机发送数据。当服务器是数据密集型的，接收或发送 Gb 大小的数据，但只有 Mb 大小的网络带宽时，它只有在 RPS 非常低时才正常。

# 计算系统负载

通常情况下，服务器遵循一个起伏模式，晚上负载降低，白天负载增加到某个点，停留一段时间，然后再次降低。为了计算系统负载，我们需要知道在一段持续的时间内，每秒钟到达的最大请求数。

比方说，我们预计 360 万个传入请求将在 1 小时内到达，这意味着服务器需要处理 1000 个 RPS，公式如下:

![](img/b41d1b213badbf2f0b9a013c25290fc6.png)

RPS is total requests divided by the duration to finish the task

假设一台服务器需要 10ms 来完成每个要求，而我们有一台 4 核服务器，这意味着我们的服务器只能处理 400 RPS。在这种情况下，我们需要至少 3 个使用公式的实例:

![](img/98526ff09220becb1499b6dcbdc025ed.png)

Number of cores is RPS times the duration to finish the task

现在我们知道我们至少需要 3 个实例，每个实例只处理 400 个 RPS，我们预计每个请求需要 3.6Gb 的内存，我们可以得出结论，我们需要一个 4Gb RAM 大小的服务器，使用公式:

![](img/7f0ba6a0cc577a49cd8a63bb2b751f25.png)

RAM size is RPS times task memory usages times the duration to finish the task

最后，如您所见，我们需要对请求总数、处理一个请求需要多长时间以及每个请求需要多少内存进行大量有根据的猜测。因此，这种计算应该仅用于容量规划。对于实际情况，最好还是做一些负载测试，以了解我们每台服务器的当前 RPS 限制，因为大多数时候一台服务器依赖于另一台服务器的性能，瓶颈本身可能不在您的服务内部，而是在底层服务上。

瞧，我们完成了。现在，你们应该对服务器 RPS 有了更好的理解，界限是什么，如何计算处理一定数量的请求所需的服务器。