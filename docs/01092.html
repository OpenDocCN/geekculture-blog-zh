<html>
<head>
<title>Project Guide for Hotels to Improve Customer Satisfaction Through Data Science Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">酒店使用Python通过数据科学提高客户满意度的项目指南</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/project-guide-for-hotels-to-improve-customer-satisfaction-through-data-science-using-python-9b992748e8a9?source=collection_archive---------5-----------------------#2021-03-27">https://medium.com/geekculture/project-guide-for-hotels-to-improve-customer-satisfaction-through-data-science-using-python-9b992748e8a9?source=collection_archive---------5-----------------------#2021-03-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="4c7d" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">数据科学如何推动旅游业？</p></blockquote><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jh"><img src="../Images/cb190c6ce765afa4d4ea116117433bdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uD6p31bQFyoBeTFkAssw-w.jpeg"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Image from unsplash.com</figcaption></figure><h1 id="7018" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">简介</strong></h1><p id="6987" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it kx ky iw ix kz la ja jb lb lc je jf jg hb bi translated">酒店无疑是旅游业中增长最快的行业之一。旅游业也是一个潜在的巨大就业机会，酒店是这一接待行业的主要组成部分。酒店业对国家的经济增长做出了积极的贡献。这种趋势预计将逐渐增长，并反过来促进或增加任何地方的旅游业的意义。</p><p id="8798" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">在这个项目中，我们将采取以下步骤来帮助酒店提高客人满意度:</p><ol class=""><li id="0f5b" class="ld le hi il b im in iq ir kx lf kz lg lb lh jg li lj lk ll bi translated">通过网页报废从“【Booking.com】T2”网站提取酒店评论。</li><li id="9fd6" class="ld le hi il b im lm iq ln kx lo kz lp lb lq jg li lj lk ll bi translated">探索性数据分析，从数据中获得有意义的见解。</li><li id="6836" class="ld le hi il b im lm iq ln kx lo kz lp lb lq jg li lj lk ll bi translated">情感分析，了解顾客对酒店的情感。</li><li id="040c" class="ld le hi il b im lm iq ln kx lo kz lp lb lq jg li lj lk ll bi translated">主题建模，以了解导致客户负面情绪的主要因素。</li></ol><h1 id="9d30" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">Web报废</h1><p id="a93d" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it kx ky iw ix kz la ja jb lb lc je jf jg hb bi translated">在这个项目中，我们将刮“酒店华美达卡拉维拉海滩度假村”位于印度果阿的评论，果阿是印度的顶级旅游目的地之一。这些评论摘自以下链接:</p><pre class="ji jj jk jl fd lr ls lt lu aw lv bi"><span id="6a39" class="lw jy hi ls b fi lx ly l lz ma"><a class="ae mb" href="https://www.booking.com/reviews/in/hotel/ramada-caravela-beach-resort.en-gb.html?page=1" rel="noopener ugc nofollow" target="_blank">https://www.booking.com/reviews/in/hotel/ramada-caravela-beach-resort.en-gb.html?page=1</a></span></pre><p id="d5c6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">如果你想收集其他酒店的评论，只需用booking.com网站上列出的酒店名称替换“ramada-caravela-beach-resort”即可。</p><p id="2cd8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">要开始web scrapping过程，请在转到上述链接后右键单击网页上的任意位置，然后选择“Inspect”选项，以找到与我们要从该网页中抓取的信息相关联的HTML标签，如下图所示。</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es mc"><img src="../Images/8cf2cee35a9f1dcae1f734a05e6b88ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GoYBP3QGXXEyxruWPL3dyQ.png"/></div></div></figure><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es md"><img src="../Images/7409008982409b91a4bd48813158e800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EiWXN-GsCORLSuMbZoKFCg.png"/></div></div></figure><p id="4545" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">在这个标签“ul.review_list”下，我们收集了如下所示的各种信息以及相应HTML标签的截图:</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es me"><img src="../Images/cc535023639d0024b7d05dc4838f9177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a8e8nYF9U10UQhUsNPYqng.png"/></div></div></figure><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es mf"><img src="../Images/6627d5dcca5e672bc41b7a7125f1074f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RgyQnmI5axI_IfriWMOTOA.png"/></div></div></figure><p id="81a4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">现在，既然我们已经得到了所有想要抓取的HTML标签，让我们开始编码吧！！</p><p id="4c27" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">首先，我们将导入这个项目所需的所有必要的库。</p><pre class="ji jj jk jl fd lr ls lt lu aw lv bi"><span id="d7b5" class="lw jy hi ls b fi lx ly l lz ma"># importing packages<br/>import numpy as np<br/>import pandas as pd</span><span id="bd3e" class="lw jy hi ls b fi mg ly l lz ma">import seaborn as sns<br/>import plotly.express as px<br/>import matplotlib.pyplot as plt<br/>%matplotlib inline<br/>import re</span><span id="9ea0" class="lw jy hi ls b fi mg ly l lz ma">from bs4 import BeautifulSoup as bs<br/>import requests</span><span id="cb74" class="lw jy hi ls b fi mg ly l lz ma">import string<br/>import nltk<br/>from nltk.stem import WordNetLemmatizer <br/>from nltk.corpus import stopwords,wordnet <br/>from wordcloud import WordCloud</span><span id="c351" class="lw jy hi ls b fi mg ly l lz ma">from textblob import TextBlob<br/>from sklearn.feature_extraction.text import CountVectorizer, TfidfVectorizer<br/>from sklearn.model_selection import GridSearchCV<br/>from sklearn.decomposition import LatentDirichletAllocation<br/>import pyLDAvis<br/>import pyLDAvis.sklearn<br/>pyLDAvis.enable_notebook()</span><span id="0c4f" class="lw jy hi ls b fi mg ly l lz ma">import warnings<br/>warnings.filterwarnings(“ignore”)</span></pre><p id="bb40" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">现在，创建了一个名为“scrape_reviews”的函数，它有两个参数:</p><ol class=""><li id="ebb7" class="ld le hi il b im in iq ir kx lf kz lg lb lh jg li lj lk ll bi translated">hotel_linkname =在booking.com的链接中提到任何你想搜索的酒店的名字</li><li id="4791" class="ld le hi il b im lm iq ln kx lo kz lp lb lq jg li lj lk ll bi translated">total_pages =提及您想要收集的评论页面总数。</li></ol><p id="c81f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">让我们了解一下“scrape_reviews”这个功能的概况:</p><ul class=""><li id="6470" class="ld le hi il b im in iq ir kx lf kz lg lb lh jg mh lj lk ll bi translated">提及评论网页的url。</li><li id="ddf8" class="ld le hi il b im lm iq ln kx lo kz lp lb lq jg mh lj lk ll bi translated">从服务器检索数据。</li><li id="f8db" class="ld le hi il b im lm iq ln kx lo kz lp lb lq jg mh lj lk ll bi translated">在这个项目中，我们将使用漂亮的汤库来抓取HTML页面。</li><li id="d729" class="ld le hi il b im lm iq ln kx lo kz lp lb lq jg mh lj lk ll bi translated">使用清除文本。strip()和。替换()方法</li><li id="28b1" class="ld le hi il b im lm iq ln kx lo kz lp lb lq jg mh lj lk ll bi translated">使用While循环来抓取所有页面。</li></ul><p id="b8fc" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">该函数将以数据帧的形式给出以下3个输出:</p><ul class=""><li id="ff3d" class="ld le hi il b im in iq ir kx lf kz lg lb lh jg mh lj lk ll bi translated"><strong class="il hj"> reviewer_info </strong>:包含评审者基本信息的数据帧</li><li id="9d31" class="ld le hi il b im lm iq ln kx lo kz lp lb lq jg mh lj lk ll bi translated">pos_reviews :一个包含所有正面评价的数据框架</li><li id="2408" class="ld le hi il b im lm iq ln kx lo kz lp lb lq jg mh lj lk ll bi translated"><strong class="il hj">负面评论</strong>:包含所有负面评论的数据框架</li></ul><pre class="ji jj jk jl fd lr ls lt lu aw lv bi"><span id="458b" class="lw jy hi ls b fi lx ly l lz ma">def scrape_reviews(hotel_linkname,total_pages):<br/> #Create empty lists to put in reviewers’ information as well as all of the positive &amp; negative reviews <br/> info = []<br/> positive = []<br/> negative = []<br/> <br/> #bookings.com reviews link<br/> url = ‘<a class="ae mb" href="https://www.booking.com/reviews/in/hotel/'+" rel="noopener ugc nofollow" target="_blank">https://www.booking.com/reviews/in/hotel/’+</a> hotel_linkname +’.html?page=' <br/> page_number = 1</span><span id="232a" class="lw jy hi ls b fi mg ly l lz ma">#Use a while loop to scrape all the pages <br/> while page_number &lt;= total_pages:</span><span id="8ab6" class="lw jy hi ls b fi mg ly l lz ma">page = requests.get(url + str(page_number)) #retrieve data from server<br/> soup = bs(page.text, “html.parser”) # initiate a beautifulsoup object using the html source and Python’s html.parser<br/> review_box = soup.find(‘ul’,{‘class’:’review_list’})</span><span id="33eb" class="lw jy hi ls b fi mg ly l lz ma">#ratings<br/> ratings = [i.text.strip() for i in review_box.find_all(‘span’,{‘class’:’review-score-badge’})]<br/> <br/> #reviewer_info<br/> reviewer_info = [i.text.strip() for i in review_box.find_all(‘span’,{‘itemprop’:’name’})]<br/> reviewer_name = reviewer_info[0::3]<br/> reviewer_country = reviewer_info[1::3]<br/> general_review = reviewer_info[2::3]</span><span id="91db" class="lw jy hi ls b fi mg ly l lz ma"># reviewer_review_times<br/> review_times = [i.text.strip() for i in review_box.find_all(‘div’,{‘class’:’review_item_user_review_count’})]</span><span id="8dd4" class="lw jy hi ls b fi mg ly l lz ma"># review_date<br/> review_date = [i.text.strip().strip(‘Reviewed: ‘) for i in review_box.find_all(‘p’,{‘class’:’review_item_date’})]</span><span id="e5f5" class="lw jy hi ls b fi mg ly l lz ma"># reviewer_tag<br/> reviewer_tag = [i.text.strip().replace(‘\n\n\n’,’’).replace(‘•’,’,’).lstrip(‘, ‘) for i <br/> in review_box.find_all(‘ul’,{‘class’:’review_item_info_tags’})]</span><span id="9f56" class="lw jy hi ls b fi mg ly l lz ma"># positive_review<br/> positive_review = [i.text.strip(‘눇’).strip() for i in review_box.find_all(‘p’,{‘class’:’review_pos’})]</span><span id="14b7" class="lw jy hi ls b fi mg ly l lz ma"># negative_review<br/> negative_review = [i.text.strip(‘눉’).strip() for i in review_box.find_all(‘p’,{‘class’:’review_neg’})]</span><span id="6456" class="lw jy hi ls b fi mg ly l lz ma"># append all reviewers’ info into one list<br/> for i in range(len(reviewer_name)):<br/> info.append([ratings[i],reviewer_name[i],reviewer_country[i],general_review[i], <br/> review_times[i],review_date[i],reviewer_tag[i]])</span><span id="b2c7" class="lw jy hi ls b fi mg ly l lz ma"># build positive review list<br/> for i in range(len(positive_review)):<br/> positive.append(positive_review[i])</span><span id="0ae1" class="lw jy hi ls b fi mg ly l lz ma"># build negative review list<br/> for i in range(len(negative_review)):<br/> negative.append(negative_review[i])</span><span id="2688" class="lw jy hi ls b fi mg ly l lz ma"># page change<br/> page_number +=1</span><span id="9da0" class="lw jy hi ls b fi mg ly l lz ma">#Reviewer_info df<br/> reviewer_info = pd.DataFrame(info,<br/> columns = [‘Rating’,’Name’,’Country’,’Overall_review’,’Review_times’,’Review_date’,’Review_tags’])<br/> reviewer_info[‘Rating’] = pd.to_numeric(reviewer_info[‘Rating’] )<br/> reviewer_info[‘Review_times’] = pd.to_numeric(reviewer_info[‘Review_times’].apply(lambda x:re.findall(“\d+”, x)[0]))<br/> reviewer_info[‘Review_date’] = pd.to_datetime(reviewer_info[‘Review_date’])<br/> <br/> #positive &amp; negative reviews dfs<br/> pos_reviews = pd.DataFrame(positive,columns = [‘positive_reviews’])<br/> neg_reviews = pd.DataFrame(negative,columns = [‘negative_reviews’])<br/> <br/> return reviewer_info, pos_reviews, neg_reviews</span></pre><p id="3abb" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">下面的函数“show_data”将打印数据帧的长度、总缺失值以及数据帧的前五行。</p><pre class="ji jj jk jl fd lr ls lt lu aw lv bi"><span id="186e" class="lw jy hi ls b fi lx ly l lz ma">def show_data(df):<br/> print(“The length of the dataframe is: {}”.format(len(df)))<br/> print(“Total NAs: {}”.format(reviewer_info.isnull().sum().sum()))<br/> return df.head()</span></pre><p id="6c0f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">现在创建函数后，我们将提到酒店的名称和我们想要抓取的总页数。但是，您可以根据自己的选择更改酒店名称，并提及相应的总评论页面。</p><pre class="ji jj jk jl fd lr ls lt lu aw lv bi"><span id="deca" class="lw jy hi ls b fi lx ly l lz ma">reviewer_info, pos_reviews, neg_reviews = scrape_reviews(‘ramada-caravela-beach-resort’,total_pages = 13)</span></pre><p id="5300" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">现在，通过使用“show_data”函数，我们将检查我们收集的数据输出</p><pre class="ji jj jk jl fd lr ls lt lu aw lv bi"><span id="5bb6" class="lw jy hi ls b fi lx ly l lz ma">show_data(reviewer_info) #reviewers’ basic information<br/>show_data(pos_reviews)   #Positive reviews<br/>show_data(neg_reviews)   #Negative reviews</span></pre><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es mi"><img src="../Images/7cc8a152b98514a091931989f90ba33a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7e56cHl2hqzWB_7K7JHECA.png"/></div></div></figure><h1 id="97cc" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">探索性数据分析(EDA) </strong></h1><ol class=""><li id="a3d6" class="ld le hi il b im kv iq kw kx mj kz mk lb ml jg li lj lk ll bi translated"><strong class="il hj">正反评论分布</strong></li></ol><pre class="ji jj jk jl fd lr ls lt lu aw lv bi"><span id="bc14" class="lw jy hi ls b fi lx ly l lz ma">fig = plt.figure()<br/>ax = fig.add_axes([0,0,1,1])<br/>values = [len(pos_reviews), len(neg_reviews)]</span><span id="7c99" class="lw jy hi ls b fi mg ly l lz ma">ax.pie(values, <br/> labels = [‘Number of Positive Reviews’, ‘Number of Negative Reviews’],<br/> colors=[‘gold’, ‘lightcoral’],<br/> shadow=True,<br/> startangle=90, <br/> autopct=’%1.2f%%’)<br/>ax.axis(‘equal’)<br/>plt.title(‘Positive Reviews Vs. Negative Reviews’);</span></pre><figure class="ji jj jk jl fd jm er es paragraph-image"><div class="er es mm"><img src="../Images/0f024549797d8e51bb9c59949bd83067.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*6S0jVFJj6Zfgd_dU2_facw.png"/></div><figcaption class="jt ju et er es jv jw bd b be z dx">Positive Reviews are higher than Negative Reviews by almost 10%</figcaption></figure><p id="af97" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated"><strong class="il hj"> 2。前10名评论者原籍国客户评分的小提琴图</strong></p><pre class="ji jj jk jl fd lr ls lt lu aw lv bi"><span id="2121" class="lw jy hi ls b fi lx ly l lz ma">top10_list = top10_df[‘Country’].tolist()<br/>top10 = reviewer_info[reviewer_info.Country.isin(top10_list)]</span><span id="4667" class="lw jy hi ls b fi mg ly l lz ma">fig, ax = plt.subplots()<br/>fig.set_size_inches(20, 5)<br/>ax = sns.violinplot(x = ‘Country’, <br/> y = ‘Rating’,<br/> data = top10, <br/> order = top10_list,<br/> linewidth = 2) <br/>plt.suptitle(‘Distribution of Ratings by Country’) <br/>plt.xticks(rotation=90);</span></pre><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es mn"><img src="../Images/58a7b870969ecad7a1b65d8b1e69eeef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c3InOgNbmBnRe93XRj3jfg.png"/></div></div></figure><p id="29b3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">上面的图是按照每个国家的审查次数的顺序显示的。它显示了评级与评论者原籍国的关系。从方框图元素中，我们看到澳大利亚、南非和卡塔尔评审员给出的中值评级略高于其他国家的评审员，而英国、美国和瑞典评审员给出的中值评级最低。分布的大多数形状(两端窄，中间宽)表明评论者给出的评级权重高度集中在中位数周围，约为8到9。然而，我们可能需要更多的数据来更好地了解这些分布。</p><p id="8b91" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated"><strong class="il hj"> 3。每种旅行类型的审核标签数量分布</strong></p><pre class="ji jj jk jl fd lr ls lt lu aw lv bi"><span id="72a0" class="lw jy hi ls b fi lx ly l lz ma">#Define tag list<br/>tag_list = [‘Business’,’Leisure’,’Group’,’Couple’,’Family’,’friends’,’Solo’]</span><span id="a013" class="lw jy hi ls b fi mg ly l lz ma">#Count for each review tag<br/>tag_counts = []<br/>for tag in tag_list:<br/> counts = reviewer_info[‘Review_tags’].str.count(tag).sum()<br/> tag_counts.append(counts)</span><span id="8fe6" class="lw jy hi ls b fi mg ly l lz ma">#Convert to a dataframe<br/>trip_type = pd.DataFrame({‘Trip Type’:tag_list,’Counts’:tag_counts}).sort_values(‘Counts’,ascending = False)</span><span id="c73e" class="lw jy hi ls b fi mg ly l lz ma">#Visualize the trip type counts from Review_tags<br/>fig = px.bar(trip_type, x=’Trip Type’, y=’Counts’, title=’Review Tags Counts for each Trip Type’)<br/>fig.show()</span></pre><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es mo"><img src="../Images/5d78bf167ccfb5b860432e192d4844a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zHtQgE71CZXvkOzVdztXMw.png"/></div></div></figure><p id="b282" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">从上面的图中，我们可以看到，大多数人来印度果阿是为了休闲，要么是一家人，要么是一对夫妇。</p><h1 id="c995" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">单词记号的词汇化</strong></h1><p id="a776" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it kx ky iw ix kz la ja jb lb lc je jf jg hb bi translated">现在，我们已经进行了词汇化，这是一个将单词转换成其基本形式的过程。例如，单词“book”、“books”、“booked”将被转换为单个单词“book”。</p><pre class="ji jj jk jl fd lr ls lt lu aw lv bi"><span id="8218" class="lw jy hi ls b fi lx ly l lz ma"># wordnet and treebank have different tagging systems<br/># Create a function to define a mapping between wordnet tags and POS tags <br/>def get_wordnet_pos(pos_tag):</span><span id="e31c" class="lw jy hi ls b fi mg ly l lz ma">if pos_tag.startswith(‘J’):<br/> return wordnet.ADJ</span><span id="881c" class="lw jy hi ls b fi mg ly l lz ma">elif pos_tag.startswith(‘V’):<br/> return wordnet.VERB</span><span id="bcef" class="lw jy hi ls b fi mg ly l lz ma">elif pos_tag.startswith(‘N’):<br/> return wordnet.NOUN</span><span id="b390" class="lw jy hi ls b fi mg ly l lz ma">elif pos_tag.startswith(‘R’):<br/> return wordnet.ADV<br/> <br/> else:<br/> return wordnet.NOUN # default, return wordnet tag “NOUN”</span><span id="7ca7" class="lw jy hi ls b fi mg ly l lz ma">#Create a function to lemmatize tokens in the reviews<br/>def lemmatized_tokens(text):<br/> text = text.lower()<br/> pattern = r’\b[a-zA-Z]{3,}\b’ <br/> tokens = nltk.regexp_tokenize(text, pattern) # tokenize the text<br/> tagged_tokens = nltk.pos_tag(tokens) # a list of tuples (word, pos_tag)<br/> <br/> stop_words = stopwords.words(‘english’)<br/> new_stopwords = [“hotel”,”everything”,”anything”,”nothing”,”thing”,”need”,<br/> “good”,”great”,”excellent”,”perfect”,”much”,”even”,”really”] #customize extra stop_words<br/> stop_words.extend(new_stopwords)<br/> stop_words = set(stop_words)<br/> <br/> wordnet_lemmatizer = WordNetLemmatizer()<br/> # get lemmatized tokens #call function “get_wordnet_pos”<br/> lemmatized_words=[wordnet_lemmatizer.lemmatize(word, get_wordnet_pos(tag)) <br/> # tagged_tokens is a list of tuples (word, tag)<br/> for (word, tag) in tagged_tokens \<br/> # remove stop words<br/> if word not in stop_words and \<br/> # remove punctuations<br/> word not in string.punctuation]</span><span id="0f3e" class="lw jy hi ls b fi mg ly l lz ma">return lemmatized_words</span></pre><h1 id="b918" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">为正面评价创建词云&amp;负面评价</strong></h1><pre class="ji jj jk jl fd lr ls lt lu aw lv bi"><span id="1194" class="lw jy hi ls b fi lx ly l lz ma">#Create a function to generate wordcloud<br/>def wordcloud(review_df, review_colname, color, title):<br/> ‘’’ <br/> INPUTS:<br/> reivew_df — dataframe, positive or negative reviews<br/> review_colname — column name, positive or negative review<br/> color — background color of worldcloud<br/> title — title of the wordcloud<br/> OUTPUT:<br/> Wordcloud visuazliation<br/> ‘’’ <br/> text = review_df[review_colname].tolist()<br/> text_str = ‘ ‘.join(lemmatized_tokens(‘ ‘.join(text))) #call function “lemmatized_tokens”<br/> wordcloud = WordCloud(collocations = False,<br/> background_color = color,<br/> width=1600, <br/> height=800, <br/> margin=2,<br/> min_font_size=20).generate(text_str)</span><span id="ff3a" class="lw jy hi ls b fi mg ly l lz ma">plt.figure(figsize = (15, 10))<br/> plt.imshow(wordcloud, interpolation = ‘bilinear’)<br/> plt.axis(“off”)<br/> plt.figtext(.5,.8,title,fontsize = 20, ha=’center’)<br/> plt.show() <br/> <br/># Wordcoulds for Positive Reviews<br/>wordcloud(pos_reviews,’positive_reviews’, ‘white’,’Positive Reviews: ‘)</span><span id="98a7" class="lw jy hi ls b fi mg ly l lz ma"># # WordCoulds for Negative Reviews<br/>wordcloud(neg_reviews,’negative_reviews’, ‘black’, ‘Negative Reviews:’)</span></pre><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es mp"><img src="../Images/40d3b1b8df714eaa21d0bdb1b4ca1a88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9-BHZZumFrcJB0qEfzXYXQ.png"/></div></div></figure><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es mp"><img src="../Images/652d9840d3f1805e16061f64d0d27a42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9SrdpzTYxXxySMkrFOlsUw.png"/></div></div></figure><p id="429e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">在积极的评论中，大多数人对酒店靠近海滩、员工友好的位置非常满意。</p><p id="ef02" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">在负面评论中，我们也可以看到员工这个词，这意味着酒店中也有一些员工的行为不好，人们也对房间和食物不满意，这是企业应该重点解决的问题。</p><h1 id="a9d7" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">情感分析</strong></h1><p id="2150" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it kx ky iw ix kz la ja jb lb lc je jf jg hb bi translated">对名为“<strong class="il hj"> reviewer_info </strong>”的数据帧的“<strong class="il hj"> Overall_review </strong>”列进行情感分析</p><pre class="ji jj jk jl fd lr ls lt lu aw lv bi"><span id="af4c" class="lw jy hi ls b fi lx ly l lz ma">#Create a function to get the subjectivity<br/>def subjectivity(text): <br/> return TextBlob(text).sentiment.subjectivity</span><span id="0ac9" class="lw jy hi ls b fi mg ly l lz ma">#Create a function to get the polarity<br/>def polarity(text): <br/> return TextBlob(text).sentiment.polarity</span><span id="4881" class="lw jy hi ls b fi mg ly l lz ma">#Create two new columns<br/>reviewer_info[‘Subjectivity’] = reviewer_info[‘Overall_review’].apply(subjectivity)<br/>reviewer_info[‘Polarity’] = reviewer_info[‘Overall_review’].apply(polarity)<br/>#################################################################################<br/>#Create a function to compute the negative, neutral and positive analysis<br/>def getAnalysis(score):<br/> if score &lt;0:<br/> return ‘Negative’<br/> elif score == 0:<br/> return ‘Neutral’<br/> else:<br/> return ‘Positive’</span><span id="5d14" class="lw jy hi ls b fi mg ly l lz ma">reviewer_info[‘Analysis’] = reviewer_info[‘Polarity’].apply(getAnalysis)<br/>#################################################################################<br/># plot the polarity and subjectivity<br/>fig = px.scatter(reviewer_info, <br/> x=’Polarity’, <br/> y=’Subjectivity’, <br/> color = ‘Analysis’,<br/> size=’Subjectivity’)</span><span id="5272" class="lw jy hi ls b fi mg ly l lz ma">#add a vertical line at x=0 for Netural Reviews<br/>fig.update_layout(title=’Sentiment Analysis’,<br/> shapes=[dict(type= ‘line’,<br/> yref= ‘paper’, y0= 0, y1= 1, <br/> xref= ‘x’, x0= 0, x1= 0)])<br/>fig.show()</span></pre><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es mq"><img src="../Images/ca1411ec86bef2ad40992ea1e6dae9f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vEhDLHDBrAM5cGIXqahSGw.png"/></div></div></figure><p id="4ea3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">X轴是极性，Y轴是主观性。极性代表评论的积极、消极或中立程度，主观性是描述人们对特定主题或话题的感受的观点。所以主观性越高，就越能描述人们对一个主题的感受。更大的点表示更多的主观性。我们可以看到正面评论多于负面评论，但我们需要知道人们对酒店的负面情绪是什么主题，因此我们将进行LDA主题建模。</p><h1 id="5896" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak"> LDA主题建模</strong></h1><p id="0b2e" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it kx ky iw ix kz la ja jb lb lc je jf jg hb bi translated">我们将应用LDA模型来发现主题的分布和每个主题中单词的高概率。这里，进行LDA主题建模的目的是查看负面评论，找出酒店应该关注哪些主题来提高客户满意度。</p><p id="9456" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">要更详细地了解LDA主题建模，请单击此<a class="ae mb" href="https://www.kdnuggets.com/2019/09/overview-topics-extraction-python-latent-dirichlet-allocation.html" rel="noopener ugc nofollow" target="_blank">链接</a>，它将详细解释这个概念。</p><p id="d602" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">执行LDA主题建模的步骤如下:</p><ul class=""><li id="9d32" class="ld le hi il b im in iq ir kx lf kz lg lb lh jg mh lj lk ll bi translated">评论被转换成文档术语矩阵</li><li id="d395" class="ld le hi il b im lm iq ln kx lo kz lp lb lq jg mh lj lk ll bi translated">使用网格搜索和参数调整找到最佳LDA模型</li><li id="310e" class="ld le hi il b im lm iq ln kx lo kz lp lb lq jg mh lj lk ll bi translated">比较LDA模型性能得分</li></ul><pre class="ji jj jk jl fd lr ls lt lu aw lv bi"><span id="edc3" class="lw jy hi ls b fi lx ly l lz ma">#Create a function to build the optimal LDA model<br/>def optimal_lda_model(df_review, review_colname):<br/> ‘’’<br/> INPUTS:<br/> df_review — dataframe that contains the reviews<br/> review_colname: name of column that contains reviews<br/> <br/> OUTPUTS:<br/> lda_tfidf — Latent Dirichlet Allocation (LDA) model<br/> dtm_tfidf — document-term matrix in the tfidf format<br/> tfidf_vectorizer — word frequency in the reviews<br/> A graph comparing LDA Model Performance Scores with different params<br/> ‘’’<br/> docs_raw = df_review[review_colname].tolist()</span><span id="0eb8" class="lw jy hi ls b fi mg ly l lz ma">#************ Step 1: Convert to document-term matrix ************#</span><span id="62e8" class="lw jy hi ls b fi mg ly l lz ma">#Transform text to vector form using the vectorizer object <br/> tf_vectorizer = CountVectorizer(strip_accents = ‘unicode’,<br/> stop_words = ‘english’,<br/> lowercase = True,<br/> token_pattern = r’\b[a-zA-Z]{3,}\b’, # num chars &gt; 3 to avoid some meaningless words<br/> max_df = 0.9, # discard words that appear in &gt; 90% of the reviews<br/> min_df = 10) # discard words that appear in &lt; 10 reviews</span><span id="cbe4" class="lw jy hi ls b fi mg ly l lz ma">#apply transformation<br/> tfidf_vectorizer = TfidfVectorizer(**tf_vectorizer.get_params())</span><span id="e972" class="lw jy hi ls b fi mg ly l lz ma">#convert to document-term matrix<br/> dtm_tfidf = tfidf_vectorizer.fit_transform(docs_raw)</span><span id="c315" class="lw jy hi ls b fi mg ly l lz ma">print(“The shape of the tfidf is {}, meaning that there are {} {} and {} tokens made through the filtering process.”.\<br/> format(dtm_tfidf.shape,dtm_tfidf.shape[0], review_colname, dtm_tfidf.shape[1]))</span><span id="d094" class="lw jy hi ls b fi mg ly l lz ma">#******* Step 2: GridSearch &amp; parameter tuning to find the optimal LDA model *******#</span><span id="bd0d" class="lw jy hi ls b fi mg ly l lz ma"># Define Search Param<br/> search_params = {‘n_components’: [5, 10, 15, 20, 25, 30], <br/> ‘learning_decay’: [.5, .7, .9]}</span><span id="af4d" class="lw jy hi ls b fi mg ly l lz ma"># Init the Model<br/> lda = LatentDirichletAllocation()</span><span id="e642" class="lw jy hi ls b fi mg ly l lz ma"># Init Grid Search Class<br/> model = GridSearchCV(lda, param_grid=search_params)</span><span id="281a" class="lw jy hi ls b fi mg ly l lz ma"># Do the Grid Search<br/> model.fit(dtm_tfidf)</span><span id="78fd" class="lw jy hi ls b fi mg ly l lz ma">#***** Step 3: Output the optimal lda model and its parameters *****#</span><span id="675a" class="lw jy hi ls b fi mg ly l lz ma"># Best Model<br/> best_lda_model = model.best_estimator_</span><span id="5f5b" class="lw jy hi ls b fi mg ly l lz ma"># Model Parameters<br/> print(“Best Model’s Params: “, model.best_params_)</span><span id="245e" class="lw jy hi ls b fi mg ly l lz ma"># Log Likelihood Score: Higher the better<br/> print(“Model Log Likelihood Score: “, model.best_score_)</span><span id="f3d3" class="lw jy hi ls b fi mg ly l lz ma"># Perplexity: Lower the better. Perplexity = exp(-1. * log-likelihood per word)<br/> print(“Model Perplexity: “, best_lda_model.perplexity(dtm_tfidf))</span><span id="d523" class="lw jy hi ls b fi mg ly l lz ma">#*********** Step 4: Compare LDA Model Performance Scores ***********#</span><span id="0ec5" class="lw jy hi ls b fi mg ly l lz ma">#Get Log Likelyhoods from Grid Search Output<br/> gscore=model.fit(dtm_tfidf).cv_results_<br/> n_topics = [5, 10, 15, 20, 25, 30]</span><span id="c6b1" class="lw jy hi ls b fi mg ly l lz ma">log_likelyhoods_5 = [gscore[‘mean_test_score’][gscore[‘params’].index(v)] for v in gscore[‘params’] if v[‘learning_decay’]==0.5]<br/> log_likelyhoods_7 = [gscore[‘mean_test_score’][gscore[‘params’].index(v)] for v in gscore[‘params’] if v[‘learning_decay’]==0.7]<br/> log_likelyhoods_9 = [gscore[‘mean_test_score’][gscore[‘params’].index(v)] for v in gscore[‘params’] if v[‘learning_decay’]==0.9]</span><span id="0c45" class="lw jy hi ls b fi mg ly l lz ma"># Show graph<br/> plt.figure(figsize=(12, 8))<br/> plt.plot(n_topics, log_likelyhoods_5, label=’0.5')<br/> plt.plot(n_topics, log_likelyhoods_7, label=’0.7')<br/> plt.plot(n_topics, log_likelyhoods_9, label=’0.9')<br/> plt.title(“Choosing Optimal LDA Model”)<br/> plt.xlabel(“Num Topics”)<br/> plt.ylabel(“Log Likelyhood Scores”)<br/> plt.legend(title=’Learning decay’, loc=’best’)<br/> plt.show()<br/> <br/> return best_lda_model, dtm_tfidf, tfidf_vectorizer<br/> <br/>best_lda_model, dtm_tfidf, tfidf_vectorizer = optimal_lda_model(neg_reviews, ‘negative_reviews’)</span></pre><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es mr"><img src="../Images/3e78b2f577ca43afb06d3f7dacddd718.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hBezNZV6HDsnPA4YkU8n_w.png"/></div></div></figure><p id="7167" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">从图中，我们看到在15个主题之前选择不同的学习衰减几乎没有影响，然而，5个主题将产生最佳模型。<br/>现在，让我们输出刚刚创建的主题中的单词。</p><pre class="ji jj jk jl fd lr ls lt lu aw lv bi"><span id="cacb" class="lw jy hi ls b fi lx ly l lz ma">#Create a function to inspect the topics we created <br/>def display_topics(model, feature_names, n_top_words):<br/> ‘’’<br/> INPUTS:<br/> model — the model we created<br/> feature_names — tells us what word each column in the matric represents<br/> n_top_words — number of top words to display<br/> OUTPUTS:<br/> a dataframe that contains the topics we created and the weights of each token<br/> ‘’’<br/> topic_dict = {}<br/> for topic_idx, topic in enumerate(model.components_):<br/> topic_dict[“Topic %d words” % (topic_idx+1)]= [‘{}’.format(feature_names[i])<br/> for i in topic.argsort()[:-n_top_words — 1:-1]]<br/> topic_dict[“Topic %d weights” % (topic_idx+1)]= [‘{:.1f}’.format(topic[i])<br/> for i in topic.argsort()[:-n_top_words — 1:-1]]<br/> return pd.DataFrame(topic_dict)</span><span id="afc8" class="lw jy hi ls b fi mg ly l lz ma">display_topics(best_lda_model, tfidf_vectorizer.get_feature_names(), n_top_words = 20)</span></pre><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es ms"><img src="../Images/230029f3b2af3d6aa7aa2dd2fbecf7a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kKPDfl5iUDyAIDbycI6JPA.png"/></div></div></figure><p id="90c8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">现在，让我们用pyLDAVis可视化来可视化主题！</p><pre class="ji jj jk jl fd lr ls lt lu aw lv bi"><span id="bd95" class="lw jy hi ls b fi lx ly l lz ma"># Topic Modelling Visualization for the Negative Reviews<br/>pyLDAvis.sklearn.prepare(best_lda_model, dtm_tfidf, tfidf_vectorizer)</span></pre><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es mt"><img src="../Images/55a2d4cedb4582f4123a74efff82d351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C4zG0E3Y9jAn19N6efm28A.png"/></div></div></figure><p id="a12d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">在可视化的左侧，每个主题由一个气泡表示。气泡越大，该主题越流行，其中数字1是最流行的主题，数字5是最不流行的主题。两个气泡之间的距离代表话题相似度。</p><p id="f5ba" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">右侧显示了与您在左侧选择的主题最相关的前30个术语。蓝色条表示总的术语频率，红色条表示所选主题内的估计术语频率。所以，如果你看到一个既有红色又有蓝色的条形，这意味着这个术语也会出现在其他主题中。您可以将鼠标悬停在该术语上，查看该术语也包含在哪个(些)主题中。</p><p id="d6fa" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kx iv iw ix kz iz ja jb lb jd je jf jg hb bi translated">例如，在上面的输出中，我们可以看到主题3包含一个名为“wifi”的单词，因此企业应该专注于改善他们房间的wifi服务。</p><h1 id="2e6b" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">结尾备注:</strong></h1><p id="c3cd" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it kx ky iw ix kz la ja jb lb lc je jf jg hb bi translated">这个项目的结果可以帮助酒店管理层了解需要为游客采取什么行动，以增加更多游客来酒店，并提高游客满意度，因此任何酒店都可以实施这个项目来提高客人满意度。该项目也可用于洞察竞争对手的酒店，以了解客户对其竞争对手的看法。</p></div></div>    
</body>
</html>