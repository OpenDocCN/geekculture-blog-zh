<html>
<head>
<title>How to use CDATA tag in Golang when making XML Requests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">发出XML请求时如何在Golang中使用CDATA标签</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-use-cdata-tag-in-go-when-making-xml-requests-with-special-characters-23428570f840?source=collection_archive---------27-----------------------#2021-07-28">https://medium.com/geekculture/how-to-use-cdata-tag-in-go-when-making-xml-requests-with-special-characters-23428570f840?source=collection_archive---------27-----------------------#2021-07-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d93ff7ae718d6b347b4fac51f87dfc0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wuEUDAkSJw0qIIAOK4qoiw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@cookiethepom?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Cookie the Pom</a> on <a class="ae iu" href="https://unsplash.com/s/photos/error?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c818" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我最近有幸与第三方集成了一个系统。他们有一个遗留系统，需要大量的XML请求来与他们的基础设施对话。我不是XML的狂热爱好者，但是在试图向他们的API发送未转义文本时遇到了一个问题。</p><blockquote class="jt ju jv"><p id="e176" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated">TLDR:我在请求结构上使用了cdata标记。(请随意跳到解决方案标题)</p></blockquote><p id="8c76" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jw">本文的一个小警告。我假设您正在使用Golang中的XML模块，并且熟悉使用marshaller函数将请求转换为字节。这不是一篇关于如何发送XML http请求的文章</em></p></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><h1 id="946c" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">短信</h1><p id="5f48" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">假设这个第三方系统被用来发送短信，我的短信看起来是这样的"<em class="jw">祝贺你中奖了。请回复领取您的奖品</em>。首先，我为我使用的糟糕的例子道歉。如果你收到类似上面的信息…我可能会忽略它。骗局预警！</p><p id="1059" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">无论如何，看看我的请求负载:</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div><figcaption class="iq ir et er es is it bd b be z dx">XML Request Structs</figcaption></figure><h1 id="dfd7" class="kh ki hi bd kj kk lq km kn ko lr kq kr ks ls ku kv kw lt ky kz la lu lc ld le bi translated">第一期</h1><p id="8622" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">我遇到的第一个问题是第三方API不接受我的请求。我得到了一个“500”的响应和一个解组错误。经过一些尝试和错误，并删除了我的短信中的特殊字符，我能够发送一条成功的消息。太好了！我可以发送消息，但不幸的是这并没有解决我的问题。我的消息是动态的，可以在配置中更改。如果有人决定使用引号或双引号，我不能冒险破坏系统。</p><h1 id="5dcd" class="kh ki hi bd kj kk lq km kn ko lr kq kr ks ls ku kv kw lt ky kz la lu lc ld le bi translated">第一次尝试</h1><p id="4d03" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">我解决这个问题的第一次尝试是使用“html.EscapeString(s string)”对文本进行转义，这是由Go中的html库提供的，我希望第三方能够在另一端解码。好消息，消息发出去了，成功了。坏消息是，我的信息是这样的</p><p id="8cb1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">"<em class="jw">恭喜你&amp;# 39；你是赢家。请回复领取您的奖品</em></p><p id="13de" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，我们有一个工作的API请求，但不是我们想要的结果。然后，我发现从Go1.6开始，您可以使用‘CDATA’标记，但这确实会带来一些额外的开销。让我展示给你看。</p></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><h1 id="51c2" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">解决方案</h1><p id="27b7" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">XML对此有一个内置的解决方案，叫做<a class="ae iu" href="https://www.w3.org/TR/xml/#sec-cdata-sect" rel="noopener ugc nofollow" target="_blank"> CDATA(字符数据)</a>。它可以用于我们的SMS消息，因此我们可以包装我们的SMS消息，使它看起来像下面的`&lt;！[CDATA[祝贺您中奖，请回复领取您的奖品]] &gt;`。通过以下方式轻松完成:</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Sprintf function for CDATA</figcaption></figure><p id="c577" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是…这感觉还是不太对，我想应该有更好的方法。Go1.6添加了<code class="du lv lw lx ly b">,cdata</code>标签，要使用它，我们只需为我们的消息创建一个新的结构。这是最终的结构，点击<a class="ae iu" href="https://pkg.go.dev/encoding/xml#Marshal" rel="noopener ugc nofollow" target="_blank">这里</a>查看文档</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="lo lp l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Solution struct using cdata tag in golang</figcaption></figure></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><p id="731b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">希望这能为你节省一点时间，因为我在这方面浪费了很多时间。如果你觉得这很有帮助，或者知道更好的方法，请给我鼓掌并留下评论。我尽量回复大多数信息</p><p id="7734" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jw">通话完毕</em></p><p id="54fc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jw">克里斯</em></p></div></div>    
</body>
</html>