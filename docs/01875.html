<html>
<head>
<title>Set up Geo-replication</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设置地理复制</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/set-up-geo-replication-f7b9cb79bca4?source=collection_archive---------7-----------------------#2021-04-27">https://medium.com/geekculture/set-up-geo-replication-f7b9cb79bca4?source=collection_archive---------7-----------------------#2021-04-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/efaa655d3c7d55ca3a73416e83afeb72.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*fxugMWXlhHGz0xRxRIhqQg.png"/></div><figcaption class="im in et er es io ip bd b be z dx">Geo-replication</figcaption></figure><p id="38bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上一篇博客中，我们介绍了地理复制的基础知识及其不同的部署服务。在这篇博客中，我们将一步一步地进行设置。🚶</p><h1 id="04dc" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">先决条件👷</h1><p id="cb8a" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">您至少有2台虚拟机。其中一个将容纳主音量💾而另一个将持有<strong class="is hj">二级卷💾</strong>。我们将只在这两个卷上设置地理复制。</p><p id="0687" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们现在开始设置😄</p><h1 id="5eed" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">设置🔧</h1><ol class=""><li id="71e1" class="kr ks hi is b it km ix kn jb kt jf ku jj kv jn kw kx ky kz bi translated">创建2个卷。如果您想知道如何设置卷，请参考本文</li></ol><div class="la lb ez fb lc ld"><a rel="noopener follow" target="_blank" href="/dev-genius/replica-volume-in-glusterfs-b05324ce1b6f"><div class="le ab dw"><div class="lf ab lg cl cj lh"><h2 class="bd hj fi z dy li ea eb lj ed ef hh bi translated">glusterfs中的副本卷</h2><div class="lk l"><h3 class="bd b fi z dy li ea eb lj ed ef dx translated">这是建立glusterfs工作环境故事的延续。</h3></div><div class="ll l"><p class="bd b fp z dy li ea eb lj ed ef dx translated">medium.com</p></div></div><div class="lm l"><div class="ln l lo lp lq lm lr ik ld"/></div></div></a></div><p id="ffe5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是副本卷。只有2台服务器时，您可以使用2个分布式卷，每个卷有1台服务器。可以参考之后的<a class="ae ls" href="https://docs.gluster.org/en/latest/Administrator-Guide/Setting-Up-Volumes/#creating-distributed-volumes" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="c4f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.开始🚲第2卷。在这里，我将这两卷看作是<strong class="is hj"> geom </strong>(主卷)和<strong class="is hj"> geos </strong>(副卷)</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="c36e" class="mc jp hi ly b fi md me l mf mg"># gluster vol start geom<br/># gluster vol start geos</span></pre><p id="67b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下两个命令必须成功，否则卷不会启动。</p><p id="6755" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.如果您的主群集:</p><ul class=""><li id="ba94" class="kr ks hi is b it iu ix iy jb mh jf mi jj mj jn mk kx ky kz bi translated">至少有2个节点的<strong class="is hj">然后执行以下命令并直接转到<strong class="is hj">步骤8 </strong></strong></li></ul><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="5937" class="mc jp hi ly b fi md me l mf mg"># gluster vol set all cluster.enable-shared-storage enable</span></pre><ul class=""><li id="efc1" class="kr ks hi is b it iu ix iy jb mh jf mi jj mj jn mk kx ky kz bi translated">从<strong class="is hj">步骤4 </strong>开始，集群中有<strong class="is hj">个节点</strong>。</li></ul><p id="8e98" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.您需要在主服务器上创建一个共享存储卷。(您可以用IP地址替换主机名)</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="52eb" class="mc jp hi ly b fi md me l mf mg"># gluster vol create gluster_shared_storage replica 3 servera:/data/glusterfs/avol/brick1/b11 servera:/data/glusterfs/avol/brick1/b12 servera:/data/glusterfs/avol/brick1/b13 force</span></pre><p id="612b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为什么<strong class="is hj">逼</strong>？😈</p><p id="95c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是因为它会给出警告😷因为您尝试在同一台服务器上使用三块砖创建复制副本卷，因此会失败。如果你不希望这种情况发生，最终有必要增加力量。</p><p id="0953" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.开始🚲您现在创建的共享卷</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="d81d" class="mc jp hi ly b fi md me l mf mg"># gluster vol start gluster_shared_storage</span></pre><p id="5fcc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">6.现在您需要创建一个共享存储目录。💾这将用作共享存储的装载点。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="edd8" class="mc jp hi ly b fi md me l mf mg"># mkdir -p /var/run/gluster/shared_storage</span></pre><blockquote class="ml mm mn"><p id="a9e1" class="iq ir mo is b it iu iv iw ix iy iz ja mp jc jd je mq jg jh ji mr jk jl jm jn hb bi translated">在<strong class="is hj"> mkdir </strong> - <strong class="is hj"> p </strong>命令的帮助下，你可以创建一个目录的子目录。如果父目录不存在，它将首先创建父目录。但是，如果它已经存在，那么它将不会打印错误消息，并将进一步创建子目录。</p></blockquote><p id="d81e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">7.挂载共享卷💾在刚刚创建的目录中。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="fe9f" class="mc jp hi ly b fi md me l mf mg"># mount -t glusterfs servera:gluster_shared_storage /var/run/gluster/shared_storage</span></pre><blockquote class="ml mm mn"><p id="b92c" class="iq ir mo is b it iu iv iw ix iy iz ja mp jc jd je mq jg jh ji mr jk jl jm jn hb bi translated">当您“挂载”某个东西时，您将对其中包含的文件系统的访问权放在了您的根文件系统结构上。有效地给出文件的位置。</p></blockquote><p id="85ee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要了解更多关于坐骑的信息，请参考<a class="ae ls" href="https://askubuntu.com/questions/20680/what-does-it-mean-to-mount-something" rel="noopener ugc nofollow" target="_blank">本</a>。</p><p id="17ae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">8.<strong class="is hj">无密码ssh设置:</strong></p><p id="e542" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在任一台主服务器上生成ssh-key🔑</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="f10e" class="mc jp hi ly b fi md me l mf mg"># ssh-keygen</span></pre><p id="a34c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将ssh-key复制到任何一个辅助服务器上</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="a399" class="mc jp hi ly b fi md me l mf mg"># ssh-copy-id root@serverb    </span></pre><p id="d98a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以用IP地址替换主机名。</p><p id="82f4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">9.创建ssh密钥</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="0be8" class="mc jp hi ly b fi md me l mf mg"># gluster system:: execute gsec_create </span></pre><p id="bd3d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该命令执行以下操作:</p><ul class=""><li id="06c1" class="kr ks hi is b it iu ix iy jb mh jf mi jj mj jn mk kx ky kz bi translated">它创建了两对ssh密钥(私有和公共)，一对用于集群中每个节点上的“tar over ssg ”,另一对用于“gsyncd shell”。</li><li id="d136" class="kr ks hi is b it ms ix mt jb mu jf mv jj mw jn mk kx ky kz bi translated">它在ssh公钥前面分别加上COMMAND = " tar $ { SSH _ ORIGINAL _ COMMAND # * } "和' COMMAND = "/usr/lib exec/glusterfs/gsyncd " '作为' tar '和gsyncd ssh公钥的前缀。</li><li id="f172" class="kr ks hi is b it ms ix mt jb mu jf mv jj mw jn mk kx ky kz bi translated">它将来自集群所有节点的上述带前缀的ssh公钥聚合到位于“/var/lib/glusterd/geo-replication/common-secret . PEM . pub”的单个文件中</li></ul><p id="c224" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">10.创建会话并将ssh密钥推送到所有辅助集群节点。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="0594" class="mc jp hi ly b fi md me l mf mg"># gluster vol geo-rep geom serverb::geos create push-pem</span></pre><p id="560a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">11.您需要为地理报告启用<code class="du mx my mz ly b">gluster_shared_storage</code>。尽管如果主卷不是复制卷/ EC卷，可以忽略此步骤。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="0aa9" class="mc jp hi ly b fi md me l mf mg"># gluster vol geo-rep geom serverb::geos config use_meta_volume true</span></pre><p id="5c97" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">地理代表使用共享存储卷来决定哪个工作者必须是活动的。它为每个副本创建公共文件，并且工人获得其上的fcntl锁，无论谁赢都将成为活动的。</p><p id="f451" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">12.通过执行以下命令检查地理代表的状态。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="5719" class="mc jp hi ly b fi md me l mf mg"># gluster vol geo-rep geom serverb::geos status</span></pre><p id="ccaa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您将看到一个表格，其中显示了地理代表工作人员的状态。它应该显示<strong class="is hj">创建了</strong>。</p><p id="8de5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">13.您需要启动地理代表并再次检查状态。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="94ce" class="mc jp hi ly b fi md me l mf mg"># gluster vol geo-rep geom serverb::geos start<br/># gluster vol geo-rep geom serverb::geos status</span></pre><p id="3c73" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所有geo-rep worker的状态都应该转到<strong class="is hj">初始化</strong>，然后转到<strong class="is hj">历史抓取</strong>再转到<strong class="is hj">变更日志抓取</strong>。</p><h2 id="0091" class="mc jp hi bd jq na nb nc ju nd ne nf jy jb ng nh kc jf ni nj kg jj nk nl kk nm bi translated">和<strong class="ak">完成😃🎊</strong></h2><h1 id="b80a" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">参考</h1><div class="la lb ez fb lc ld"><a href="https://docs.gluster.org/en/latest/" rel="noopener  ugc nofollow" target="_blank"><div class="le ab dw"><div class="lf ab lg cl cj lh"><h2 class="bd hj fi z dy li ea eb lj ed ef hh bi translated">Gluster文档</h2><div class="lk l"><h3 class="bd b fi z dy li ea eb lj ed ef dx translated">GlusterFS是一个可扩展的网络文件系统，适用于数据密集型任务，如云存储和媒体流…</h3></div><div class="ll l"><p class="bd b fp z dy li ea eb lj ed ef dx translated">docs.gluster.org</p></div></div></div></a></div><h1 id="6432" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">另外，阅读</h1><div class="la lb ez fb lc ld"><a href="https://ujjwal-msrit.medium.com/gluster-directory-quotas-ebdf95bbfef6" rel="noopener follow" target="_blank"><div class="le ab dw"><div class="lf ab lg cl cj lh"><h2 class="bd hj fi z dy li ea eb lj ed ef hh bi translated">Gluster —目录配额</h2><div class="lk l"><h3 class="bd b fi z dy li ea eb lj ed ef dx translated">什么是配额？</h3></div><div class="ll l"><p class="bd b fp z dy li ea eb lj ed ef dx translated">ujjwal-msrit.medium.com</p></div></div><div class="lm l"><div class="nn l lo lp lq lm lr ik ld"/></div></div></a></div><div class="la lb ez fb lc ld"><a rel="noopener follow" target="_blank" href="/geekculture/compiling-rpms-36ac24970f0e"><div class="le ab dw"><div class="lf ab lg cl cj lh"><h2 class="bd hj fi z dy li ea eb lj ed ef hh bi translated">编译rpm</h2><div class="lk l"><h3 class="bd b fi z dy li ea eb lj ed ef dx translated">内容📑</h3></div><div class="ll l"><p class="bd b fp z dy li ea eb lj ed ef dx translated">medium.com</p></div></div><div class="lm l"><div class="no l lo lp lq lm lr ik ld"/></div></div></a></div></div></div>    
</body>
</html>