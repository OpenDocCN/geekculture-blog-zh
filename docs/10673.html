<html>
<head>
<title>Coroutines vs Coroutine Functions in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的协程与协程函数</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/coroutines-vs-coroutine-functions-in-python-a3957c1a0f9b?source=collection_archive---------11-----------------------#2022-02-10">https://medium.com/geekculture/coroutines-vs-coroutine-functions-in-python-a3957c1a0f9b?source=collection_archive---------11-----------------------#2022-02-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="98e9" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">协程和协程函数之间的细微差别。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/6a53cc6872d6d492a4bf11915e05b5d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FvZiR9OBtXzMTdcF-qwjqw.png"/></div></div></figure><h1 id="b6bd" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">简介:</h1><p id="b740" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">有一种常见的误解，认为<code class="du kx ky kz la b">coroutine</code>函数和协程对象是相同的。嗯！不完全是。尽管它们共存，但两者之间还是有一点点微小的差别。理解它们之间的区别是很重要的。</p><h1 id="3038" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">什么是协程？</h1><p id="5bfa" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">简单地说，<code class="du kx ky kz la b">coroutine</code>是一个普通的Python函数，以关键字<code class="du kx ky kz la b">async</code>为前缀。要快速了解Python中的<code class="du kx ky kz la b">asyncio</code>库，请参考这里的<a class="ae lc" href="https://dock2learn.com/tech/asyncio-in-python/" rel="noopener ugc nofollow" target="_blank"/>。用<code class="du kx ky kz la b">async def</code>创建的协程被称为原生协程，因为它们是从<code class="du kx ky kz la b">python</code> 3.5构建到标准库中的。</p><h1 id="0a6c" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">协程函数与协程:</h1><p id="d0e9" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">为了理解其中的区别，让我们使用<code class="du kx ky kz la b">asyncio</code>库编写一个简单的异步函数。</p><pre class="iy iz ja jb fd ld la le lf aw lg bi"><span id="0134" class="lh jk hi la b fi li lj l lk ll">import asyncio, time<br/><br/><br/>async def hello_world():<br/>    print(time.ctime())<br/>    await asyncio.sleep(1.0)<br/>    print(time.ctime())<br/><br/><br/>loop = asyncio.get_event_loop()<br/>task = loop.create_task(hello_world())<br/>loop.run_until_complete(task)<br/>loop.close()</span></pre><p id="e372" class="pw-post-body-paragraph kb kc hi kd b ke lm ij kg kh ln im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">当我们看到这个函数时，我们说这是一个协程。然而，这个假设只是部分正确。<strong class="kd hj"> <em class="lb">请注意，异步函数不是协程。它们就像任何其他Python函数一样。</em></strong></p><p id="00c9" class="pw-post-body-paragraph kb kc hi kd b ke lm ij kg kh ln im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">还不相信？让我们来测试一下。我们将尝试打印<code class="du kx ky kz la b">hello_world function</code>的<code class="du kx ky kz la b">type</code>。</p><pre class="iy iz ja jb fd ld la le lf aw lg bi"><span id="c80a" class="lh jk hi la b fi li lj l lk ll">print(type(hello_world)) </span><span id="5d9a" class="lh jk hi la b fi lr lj l lk ll">Output: <br/>&lt;class 'function'&gt;</span></pre><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="5084" class="pw-post-body-paragraph kb kc hi kd b ke lm ij kg kh ln im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">我和你一样惊讶。这些天来，我一直假设当我们用<code class="du kx ky kz la b">async def</code>声明一个Python函数时，它们就变成了协程。显然不是。如果它们不是协程，那么它们是什么？它们是<strong class="kd hj"> <em class="lb">协程函数</em> </strong>。</p><p id="5e67" class="pw-post-body-paragraph kb kc hi kd b ke lm ij kg kh ln im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">让我们使用<code class="du kx ky kz la b">python</code>中的<code class="du kx ky kz la b">inspect</code>模块对此进行快速测试。</p><pre class="iy iz ja jb fd ld la le lf aw lg bi"><span id="e95c" class="lh jk hi la b fi li lj l lk ll">import inspect </span><span id="2ccf" class="lh jk hi la b fi lr lj l lk ll">print(inspect.iscoroutinefunction(hello_world)) </span><span id="c951" class="lh jk hi la b fi lr lj l lk ll">Output: <br/>True</span></pre><p id="64b3" class="pw-post-body-paragraph kb kc hi kd b ke lm ij kg kh ln im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">那什么是协程？</p><p id="bf65" class="pw-post-body-paragraph kb kc hi kd b ke lm ij kg kh ln im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">执行/评估协程函数时会创建一个<code class="du kx ky kz la b">coroutine</code>。换句话说，当一个<code class="du kx ky kz la b">async def</code>函数被调用时，它将返回一个协程。</p><pre class="iy iz ja jb fd ld la le lf aw lg bi"><span id="1a49" class="lh jk hi la b fi li lj l lk ll">import asyncio, time<br/><br/><br/>async def hello_world():<br/>    print(time.ctime())<br/>    await asyncio.sleep(1.0)<br/>    print(time.ctime())<br/><br/>coro = hello_world()<br/>print(type(coro))<br/>print(inspect.iscoroutine(coro))<br/>print(inspect.iscoroutinefunction(coro))</span></pre><h1 id="bf2f" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">输出:</h1><pre class="iy iz ja jb fd ld la le lf aw lg bi"><span id="cec1" class="lh jk hi la b fi li lj l lk ll">&lt;class 'coroutine'&gt; <br/>True <br/>False</span></pre><p id="98ba" class="pw-post-body-paragraph kb kc hi kd b ke lm ij kg kh ln im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">瞧啊。我们已经打印出了<code class="du kx ky kz la b">coro</code>变量的类型，它具有求值函数<code class="du kx ky kz la b">hello_world()</code>，类型为<code class="du kx ky kz la b">coroutine</code>。<code class="du kx ky kz la b">inspect</code>模块为<code class="du kx ky kz la b">iscoroutine()</code>返回true，为<code class="du kx ky kz la b">iscoroutinefunction()</code>返回<code class="du kx ky kz la b">False</code>。</p><p id="2af6" class="pw-post-body-paragraph kb kc hi kd b ke lm ij kg kh ln im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">这也正是<code class="du kx ky kz la b">generators</code>的工作方式。就像协程和协程函数一样，我们也有生成器和生成器函数。</p><pre class="iy iz ja jb fd ld la le lf aw lg bi"><span id="eed4" class="lh jk hi la b fi li lj l lk ll">def get_number():<br/>    values = range(100)<br/><br/>    for i in values:<br/>        if i % 2 == 0:<br/>            yield i<br/><br/><br/>nums_ = get_number()<br/><br/>print(type(get_number))<br/>print(type(nums_))<br/>print(inspect.isgeneratorfunction(get_number))<br/>print(inspect.isgenerator(nums_))</span></pre><p id="bc75" class="pw-post-body-paragraph kb kc hi kd b ke lm ij kg kh ln im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">输出:</p><pre class="iy iz ja jb fd ld la le lf aw lg bi"><span id="49b1" class="lh jk hi la b fi li lj l lk ll">&lt;class 'function'&gt; <br/>&lt;class 'generator'&gt; <br/>True <br/>True</span></pre><h1 id="6f36" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">总结:</h1><ul class=""><li id="6db8" class="lu lv hi kd b ke kf kh ki kk lw ko lx ks ly kw lz ma mb mc bi translated">协程和协程函数是不同的。</li><li id="357c" class="lu lv hi kd b ke md kh me kk mf ko mg ks mh kw lz ma mb mc bi translated">协程是我们通过评估一个协程函数得到的</li><li id="1697" class="lu lv hi kd b ke md kh me kk mf ko mg ks mh kw lz ma mb mc bi translated">以<code class="du kx ky kz la b">async def</code>为前缀的函数是协程函数</li><li id="b68b" class="lu lv hi kd b ke md kh me kk mf ko mg ks mh kw lz ma mb mc bi translated">带有<code class="du kx ky kz la b">yield</code>关键字的函数是一个<code class="du kx ky kz la b">generator</code>函数</li><li id="37ad" class="lu lv hi kd b ke md kh me kk mf ko mg ks mh kw lz ma mb mc bi translated">生成器函数计算为生成器。</li></ul><div class="mi mj ez fb mk ml"><a href="https://docs.python.org/3/library/asyncio-task.html" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hj fi z dy mq ea eb mr ed ef hh bi translated">协程和任务- Python 3.10.2文档</h2><div class="ms l"><h3 class="bd b fi z dy mq ea eb mr ed ef dx translated">本节概述了使用协程和任务的高级asyncio APIs。用…声明的协程</h3></div><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">docs.python.org</p></div></div></div></a></div></div><div class="ab cl mu mv gp mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="hb hc hd he hf"><p id="2d51" class="pw-post-body-paragraph kb kc hi kd b ke lm ij kg kh ln im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated"><em class="lb">原载于2022年2月10日https://dock2learn.com</em><a class="ae lc" href="https://dock2learn.com/tech/coroutines-vs-coroutine-functions-in-python/" rel="noopener ugc nofollow" target="_blank"><em class="lb"/></a><em class="lb">。</em></p><p id="484f" class="pw-post-body-paragraph kb kc hi kd b ke lm ij kg kh ln im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated"><em class="lb">更多内容看</em> <a class="ae lc" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd hj"> <em class="lb">说白了。报名参加我们的</em> <a class="ae lc" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd hj"> <em class="lb">免费周报</em> </strong> </a> <em class="lb">。在我们的</em> <a class="ae lc" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kd hj"> <em class="lb">社区不和谐</em> </strong> </a> <em class="lb">获得独家获取写作机会和建议。</em></strong></a></p></div></div>    
</body>
</html>