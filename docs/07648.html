<html>
<head>
<title>Software design pattern #3: Builder</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">软件设计模式#3:构建器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/software-design-pattern-3-builder-3bfff590ddbc?source=collection_archive---------17-----------------------#2021-09-25">https://medium.com/geekculture/software-design-pattern-3-builder-3bfff590ddbc?source=collection_archive---------17-----------------------#2021-09-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9852" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设计模式是可重用的模板，帮助我们使用最佳实践解决软件设计问题。通过这种方式，它们帮助我们使用更易于维护、理解、重用和测试的代码来构建应用程序。</p><h1 id="23b0" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">逃离速度实验室</h1><p id="87d6" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">你可以在我们的网站上找到我们所有的文章、课程和教程:<br/><a class="ae kg" href="https://www.evlabs.io/" rel="noopener ugc nofollow" target="_blank">https://www . ev labs . io</a></p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/c677da796afcd719a323f5e3ab10e1f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lJpI8dFz5JqMv3e10VUWFA.png"/></div></div></figure><h1 id="7e3c" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">这个图案是干什么用的？</h1><blockquote class="kt ku kv"><p id="d9fe" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">它允许我们把一个复杂物体的构造和它的表现分开。因此，相同的创建过程可以生成不同的表示。</p></blockquote><p id="9a29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们以本系列前几篇文章为例，即创建一个新的社交网络。我们希望给用户写文章并与在线出版物分享的可能性。这些文章可以包含一个<strong class="ih hj">标题</strong>，几块<strong class="ih hj">文本</strong>、<strong class="ih hj">图片、</strong>和<strong class="ih hj">视频</strong>。当然，这些元素遵循一定的顺序。</p><p id="63d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当一个用户在写一篇文章时，他想看看它在我们的网站和他们要发送的出版物上会是什么样子。但是我们的网站显然会显示<strong class="ih hj"> HTML </strong>元素，在线出版物使用<strong class="ih hj"> Markdown </strong>来显示他们的文章。</p><p id="24e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们的预览工具必须将文章(纯文本)转换为正确的格式，以查看它在目的地的外观。</p><p id="bf0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们可以在预览工具的代码中将文章转换为适当的格式，但这会带来许多问题:</p><ul class=""><li id="c286" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lf lg lh li bi translated">我们把文章草稿的阅读逻辑和文章的表现逻辑混合在一起。</li><li id="5251" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">每次我们想要包含一个新的格式(pdf，epub等)时，我们都必须修改预览工具的逻辑，这使得它很难维护。</li><li id="4abd" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">想象一下，一些出版物用双倍行距或不同的字体显示文章。实现所有这些变体将使预览工具的代码很难维护。</li></ul><p id="7e76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">解决方案</strong>:使用<em class="kw">构建器</em>模式创建文章表示。</p><h1 id="1bf8" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">它是如何工作的？</h1><p id="80b1" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">在这个模式中，有三个参与者:总监<strong class="ih hj">、建造者<strong class="ih hj">、产品</strong>和产品</strong>。产品是将被创建的对象，在我们的例子中是正确格式的文章。构建器是描述如何以正确的格式创建文章的每个部分的对象。最后，导演是描述构建过程的对象，即文章的各部分及其顺序，<em class="kw">但不涉及文章最终格式的细节</em>。生成的图表如下所示:</p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es lo"><img src="../Images/7d913ee4897035aadaa920a2b15226ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*IyMVFAPzXcBoCi-tjDh6EQ.png"/></div></figure><p id="df09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个图中，TextReader是控制器。它是预览工具的一部分，将一部分一部分地处理用户编写的纯文本，以格式化文章的形式构建表示。</p><pre class="ki kj kk kl fd lp lq lr ls aw lt bi"><span id="d2d3" class="lu je hi lq b fi lv lw l lx ly"><strong class="lq hj">class</strong> <strong class="lq hj">TextReader</strong>:<br/><br/>    <strong class="lq hj">def</strong> <strong class="lq hj">__init__</strong>(self) -&gt; <strong class="lq hj">None</strong>:<br/>        self._builder = <strong class="lq hj">None</strong><br/><br/>    <strong class="lq hj">def</strong> <strong class="lq hj">set_builder</strong>(self, builder: ArticleBuilder) -&gt; <strong class="lq hj">None</strong>:<br/>        self._builder = builder<br/><br/>    <strong class="lq hj">def</strong> <strong class="lq hj">read_article</strong>(self) -&gt; <strong class="lq hj">None</strong>:<br/>        while next_block_available():<br/>            article_block = read_next_block()<strong class="lq hj">       <br/>        <br/>            if</strong> is_title(article_block):<br/>                self._builder.add_title(article_block)<br/>            <strong class="lq hj">elif</strong> is_image(article_block):<br/>                self._builder.add_image(article_block)<br/>            <strong class="lq hj">elif</strong> is_video(article_block):<br/>                self._builder.add_video(article_block)<br/>            <strong class="lq hj">elif</strong> is_text(article_block):<br/>                self._builder.add_text(article_block)<br/>            <strong class="lq hj">else</strong>:<br/>                <strong class="lq hj">raise</strong> NotImplementedError("Unknown part of an article.")</span></pre><p id="053b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，向导演传递了构建器的一个实例，该实例实现了ArticleBuilder接口。然后，在其read_article()方法中，导演将处理用户正在编写的草稿的每个纯文本块，检查它是什么类型的内容，并将如何以正确的格式将它合并到文章中的细节委托给它的构建者。构建器必须实现以下接口:</p><pre class="ki kj kk kl fd lp lq lr ls aw lt bi"><span id="f93a" class="lu je hi lq b fi lv lw l lx ly"><strong class="lq hj">from</strong> abc <strong class="lq hj">import</strong> ABC, abstractmethod<br/><strong class="lq hj">from</strong> typing <strong class="lq hj">import</strong> String</span><span id="3b8a" class="lu je hi lq b fi lz lw l lx ly"><strong class="lq hj"><br/>class</strong> <strong class="lq hj">ArticleBuilder</strong>(ABC): <br/>   <br/>    <strong class="lq hj">@property</strong><br/>    <strong class="lq hj">@abstractmethod</strong><br/>    <strong class="lq hj">def article</strong>(self) -&gt; <strong class="lq hj">None</strong>:<br/>        <strong class="lq hj">pass</strong>    <br/>    <br/>    <strong class="lq hj">@abstractmethod</strong><br/>    <strong class="lq hj">def</strong> <strong class="lq hj">add_title</strong>(self, title: String) -&gt; <strong class="lq hj">None</strong>:<br/>        <strong class="lq hj">pass</strong><br/><br/>    <strong class="lq hj">@abstractmethod</strong><br/>    <strong class="lq hj">def</strong> <strong class="lq hj">add_image</strong>(self, href: String) -&gt; <strong class="lq hj">None</strong>:<br/>        <strong class="lq hj">pass    </strong></span><span id="8a24" class="lu je hi lq b fi lz lw l lx ly"><strong class="lq hj">    @abstractmethod</strong><br/>    <strong class="lq hj">def</strong> <strong class="lq hj">add_video</strong>(self, file: String) -&gt; <strong class="lq hj">None</strong>:<br/>        <strong class="lq hj">pass    </strong></span><span id="9be1" class="lu je hi lq b fi lz lw l lx ly"><strong class="lq hj">    @abstractmethod</strong><br/>    <strong class="lq hj">def</strong> <strong class="lq hj">add_text</strong>(self, text: String) -&gt; <strong class="lq hj">None</strong>:<br/>        <strong class="lq hj">pass</strong></span></pre><p id="39f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">director将与这个通用接口交互，实现它的子类负责将纯文本翻译成适当的格式。正如我们所说，我们要将文章转换成两种格式，<strong class="ih hj"> HTML </strong>和<strong class="ih hj"> Markdown </strong>，所以我们需要两个不同的<em class="kw">构建器</em>。</p><pre class="ki kj kk kl fd lp lq lr ls aw lt bi"><span id="d47d" class="lu je hi lq b fi lv lw l lx ly"><strong class="lq hj">class</strong> <strong class="lq hj">HtmlBuilder</strong>(ArticleBuilder):<br/><br/>    <strong class="lq hj">def</strong> <strong class="lq hj">__init__</strong>(self) -&gt; <strong class="lq hj">None</strong>:<br/>        self.article = ""    </span><span id="1c9a" class="lu je hi lq b fi lz lw l lx ly"><strong class="lq hj">    @property</strong><br/>    <strong class="lq hj">def</strong> <strong class="lq hj">article</strong>(self) -&gt; <strong class="lq hj">String</strong>:<br/>        <strong class="lq hj">return</strong> self.article<strong class="lq hj">    </strong></span><span id="e4b3" class="lu je hi lq b fi lz lw l lx ly"><strong class="lq hj">    def</strong> <strong class="lq hj">add_title</strong>(self, title: String) -&gt; <strong class="lq hj">None</strong>:<br/>        self.article += f"&lt;h1&gt;{title}&lt;/h1&gt;"<br/><br/>    <strong class="lq hj">def</strong> <strong class="lq hj">add_image</strong>(self, href: String) -&gt; <strong class="lq hj">None</strong>:<br/>        self.article += f"&lt;img src={href}&gt;"<strong class="lq hj">    </strong></span><span id="c462" class="lu je hi lq b fi lz lw l lx ly"><strong class="lq hj">    def</strong> <strong class="lq hj">add_video</strong>(self, file: String) -&gt; <strong class="lq hj">None</strong>:<br/>        self.article += f"&lt;video&gt;&lt;source src={file}&gt;&lt;/video&gt;"    </span><span id="0e74" class="lu je hi lq b fi lz lw l lx ly"><strong class="lq hj">    def</strong> <strong class="lq hj">add_text</strong>(self, text: String) -&gt; <strong class="lq hj">None</strong>:<br/>        self.article += f"&lt;p&gt;{text}&lt;/p&gt;"</span><span id="34b0" class="lu je hi lq b fi lz lw l lx ly"><strong class="lq hj"><br/>class</strong> <strong class="lq hj">MarkdownBuilder</strong>(ArticleBuilder):<br/><br/>    <strong class="lq hj">def</strong> <strong class="lq hj">__init__</strong>(self) -&gt; <strong class="lq hj">None</strong>:<br/>        self.article = ""<br/><br/>    <strong class="lq hj">@property</strong><br/>    <strong class="lq hj">def</strong> <strong class="lq hj">article</strong>(self) -&gt; <strong class="lq hj">String</strong>:<br/>        <strong class="lq hj">return</strong> self.article<strong class="lq hj">    </strong></span><span id="a66b" class="lu je hi lq b fi lz lw l lx ly"><strong class="lq hj">    def</strong> <strong class="lq hj">add_title</strong>(self, title: String) -&gt; <strong class="lq hj">None</strong>:<br/>        self.article += f"#{title}"<br/><br/>    <strong class="lq hj">def</strong> <strong class="lq hj">add_image</strong>(self, href: String) -&gt; <strong class="lq hj">None</strong>:<br/>        self.article += f"![]({href})"<strong class="lq hj">    </strong></span><span id="13fa" class="lu je hi lq b fi lz lw l lx ly"><strong class="lq hj">    def</strong> <strong class="lq hj">add_video</strong>(self, file: String) -&gt; <strong class="lq hj">None</strong>:<br/>        self.article += f"[![]({file})]"<strong class="lq hj">    </strong></span><span id="f6b0" class="lu je hi lq b fi lz lw l lx ly"><strong class="lq hj">    def</strong> <strong class="lq hj">add_text</strong>(self, text: String) -&gt; <strong class="lq hj">None</strong>:<br/>        self.article += text</span></pre><p id="af33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成后，剩下的工作就是在预览代码中创建导演，将合适的生成器传递给导演，并以期望的格式获得文章:</p><pre class="ki kj kk kl fd lp lq lr ls aw lt bi"><span id="c4c9" class="lu je hi lq b fi lv lw l lx ly"><strong class="lq hj">if</strong> __name__ == "__main__":<br/>    article_reader = TextReader()<br/>    <br/>    # Convierte el artículo a formato HTML.<br/>    html_builder = HtmlBuilder()<br/>    article_reader.set_builder(html_builder)<br/>    article_reader.read_article()<br/>    html_article = html_builder.article<br/><br/>    # Convierte el artículo a formato Markdown.<br/>    markdown_builder = MarkdownBuilder()<br/>    article_reader.set_builder(markdown_builder)<br/>    markdown_builder.read_article()<br/>    markdown_article = markdown_builder.article</span></pre><h1 id="73ae" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">利益</h1><ul class=""><li id="b17c" class="la lb hi ih b ii kb im kc iq ma iu mb iy mc jc lf lg lh li bi translated">减少耦合。<em class="kw"> builder </em>对象为导演提供了一个构建文章的公共接口。</li><li id="81e3" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">考虑到ArticleBuilder类的公共接口，它允许我们改变文章的内部表示。</li><li id="6ede" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">文章构建和表示逻辑保持独立。ArticleBuilder的特定子类将负责表示的细节。</li><li id="8eb4" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">它有助于创建具有相互依赖部分的复杂对象。只有当对象的表示完成时，管理器才能获得该对象。</li></ul></div></div>    
</body>
</html>