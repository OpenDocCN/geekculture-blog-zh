<html>
<head>
<title>Arduino: How to Process Infrared Signals from a Remote Control</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Arduino:如何处理来自遥控器的红外信号</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/arduino-how-to-process-infrared-signals-from-a-remote-control-ee18c1c1f0ad?source=collection_archive---------5-----------------------#2021-10-04">https://medium.com/geekculture/arduino-how-to-process-infrared-signals-from-a-remote-control-ee18c1c1f0ad?source=collection_archive---------5-----------------------#2021-10-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f5c93af4a5cae91ff17afed7296948c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wu9GMMCrXTjfMeYvXdMGEw.png"/></div></div></figure><p id="35bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">红外遥控器无处不在:电视、IOT设备、玩具。有了Arduino和IR接收器，设置接收IR命令并处理它们以控制您的Arduino应用程序只需几分钟。</p><p id="4e92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇博文向你展示了从你的一个遥控器处理任何红外命令的基本步骤。</p><p id="37e5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">本文原载于我的博客</em><a class="ae jp" href="https://admantium.com/blog/micro13_infra_red_commands/" rel="noopener ugc nofollow" target="_blank"><em class="jo">admantium.com</em></a>。</p><h1 id="bf43" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">设置</h1><p id="5bd1" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">该项目的硬件要求很低:</p><ul class=""><li id="e57e" class="kt ku hi is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated">Arduino Uno或变体</li><li id="d66f" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">红外遥控接收器模块</li><li id="1e76" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">任何遥控器</li></ul><p id="c2c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要连接设备，请遵循以下说明。要识别正确的引脚，请参见<a class="ae jp" href="https://content.arduino.cc/assets/Pinout-UNOrev3_latest.pdf" rel="noopener ugc nofollow" target="_blank"> Arduino引脚布局</a>。</p><ul class=""><li id="24b4" class="kt ku hi is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated">将红外传感器Y引脚连接到任何Arduino模拟引脚</li><li id="3ac5" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">将红外传感器R引脚连接到Arduino 5V电源输出</li><li id="027e" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">将红外传感器G引脚连接到任何Arduino接地引脚</li></ul><h1 id="0c34" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">图书馆选择</h1><p id="6e2f" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">按照我的指导，我检查了可用的库。对于一个基本的ATmega328P Arduino Uno，最好的库是<a class="ae jp" href="https://github.com/Arduino-IRremote/Arduino-IRremote" rel="noopener ugc nofollow" target="_blank"> Arduino-IRremote </a>。它正在开发中，有很好的文档，你可以找到有用的例子。我使用平台IO包管理器安装了这个库。</p><p id="8bd6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装完成后，第一步是确定遥控器使用的具体协议。</p><h1 id="6af7" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">识别协议</h1><p id="171f" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">从<a class="ae jp" href="https://github.com/Arduino-IRremote/Arduino-IRremote/blob/master/examples/ReceiveDump/ReceiveDump.ino" rel="noopener ugc nofollow" target="_blank">官方示例草图</a>中，创建以下程序:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="c40e" class="lq jr hi lm b fi lr ls l lt lu">#include &lt;Arduino.h&gt;<br/>#include &lt;IRremote.h&gt;</span><span id="c5a8" class="lq jr hi lm b fi lv ls l lt lu">#define IR_PIN 3;</span><span id="4ff8" class="lq jr hi lm b fi lv ls l lt lu">void setup() {<br/>  pinMode(LED_BUILTIN, OUTPUT);</span><span id="309e" class="lq jr hi lm b fi lv ls l lt lu">  Serial.begin(9600);   <br/>  IrReceiver.begin(IR_PIN, ENABLE_LED_FEEDBACK);<br/>}</span><span id="36f2" class="lq jr hi lm b fi lv ls l lt lu">void loop() {<br/>  if (IrReceiver.decode()) {  <br/>    IrReceiver.printIRResultShort(&amp;Serial);<br/>    Serial.println();<br/>    IrReceiver.printIRResultAsCVariables(&amp;Serial);<br/>  }<br/>  IrReceiver.resume();<br/>}</span></pre><p id="ce5d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，上传程序，连接到串行监视器并按下遥控器上的一些键。您应该会看到如下输出:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="dbc1" class="lq jr hi lm b fi lr ls l lt lu">Protocol=NEC Address=0x4 Command=0x11 Raw-Data=0xEE11FB04 32 bits LSB first</span><span id="97fb" class="lq jr hi lm b fi lv ls l lt lu">uint16_t address = 0x4;<br/>uint16_t command = 0x11;<br/>uint32_t data = 0xEE11FB04;</span></pre><p id="e10e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在极少数情况下，信号可能无法正确处理。在这种情况下，请尝试另一个遥控器。</p><h1 id="c1ed" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">接收和处理红外命令</h1><p id="1f3e" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">当你知道了协议，就该创建真正的程序了。用以下语句开始您的源代码文件，并确保在包含头文件之前定义协议。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="b085" class="lq jr hi lm b fi lr ls l lt lu">#define DECODE_NEC 1<br/>#include &lt;IRremote.h&gt;</span><span id="0052" class="lq jr hi lm b fi lv ls l lt lu">int IR_RECEIVE_PIN = 11;</span></pre><p id="1733" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在程序的<code class="du lw lx ly lm b">setup()</code>部分，初始化<code class="du lw lx ly lm b">IrReceiver</code>事件。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="5935" class="lq jr hi lm b fi lr ls l lt lu">IrReceiver.begin(IR_RECEIVE_PIN, ENABLE_LED_FEEDBACK, USE_DEFAULT_FEEDBACK_LED_PIN);</span></pre><p id="a204" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<code class="du lw lx ly lm b">loop</code>部分，您等待<code class="du lw lx ly lm b">IrReceiver.decode()</code>中断发生。然后，您可以使用类型<code class="du lw lx ly lm b">IRData</code>访问接收到的数据。它的<a class="ae jp" href="https://github.com/Arduino-IRremote/Arduino-IRremote/blob/d27b1e4e7280f7bb335dc57567e95e3881977b62/src/IRremoteInt.h" rel="noopener ugc nofollow" target="_blank">定义</a>是这样的:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="31a0" class="lq jr hi lm b fi lr ls l lt lu">struct IRData {<br/>    decode_type_t protocol;     ///&lt; UNKNOWN, NEC, SONY, RC5, ...<br/>    uint16_t address;           ///&lt; Decoded address<br/>    uint16_t command;           ///&lt; Decoded command<br/>    uint16_t extra;             ///&lt; Used by MagiQuest and for Kaseikyo unknown vendor ID<br/>    uint8_t numberOfBits; ///&lt; Number of bits received for data (address + command + parity) - to determine protocol length if different length are possible (currently only Sony).<br/>    uint8_t flags;              ///&lt; See definitions above<br/>    uint32_t decodedRawData;    ///&lt; up to 32 bit decoded raw data, formerly used for send functions.<br/>    irparams_struct *rawDataPtr; /// pointer of the raw timing data to be decoded<br/>};</span></pre><p id="ab15" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要打印出相关数据，请使用以下命令:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="c7a7" class="lq jr hi lm b fi lr ls l lt lu">void loop() {<br/>  if (IrReceiver.decode()) {<br/>    Serial.print("COMMAND is ");<br/>    Serial.println(IrReceiver.decodedIRData.command);<br/>    Serial.print("ADDRESS is ");<br/>    Serial.println(IrReceiver.decodedIRData.address);<br/>    Serial.print("RAW DATA is ");<br/>    Serial.println(IrReceiver.decodedIRData.decodedRawData);</span><span id="2f55" class="lq jr hi lm b fi lv ls l lt lu">    IrReceiver.resume();<br/>  }<br/>}</span></pre><p id="0452" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你差不多完成了。将此程序上传到您的Arduino，然后从遥控器发送命令。程序的输出将类似于以下内容:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="1b87" class="lq jr hi lm b fi lr ls l lt lu">COMMAND is 18<br/>ADDRESS is 4<br/>RAW DATA is 3977444100<br/>COMMAND is 64<br/>ADDRESS is 4<br/>RAW DATA is 3208706820</span></pre><p id="ac54" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，使用这个程序测试遥控器的每个键，并记下它们的命令ID。例如，在上面的例子中，当我按下<code class="du lw lx ly lm b">2</code>键时会识别出<code class="du lw lx ly lm b">COMMAND 18</code>，而<code class="du lw lx ly lm b">COMMAND 64</code>是向上箭头按钮。</p><h1 id="6ea0" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">定义应用程序逻辑</h1><p id="c6ae" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">最后一部分很简单。在<code class="du lw lx ly lm b">loop()</code>方法中，使用<code class="du lw lx ly lm b">IrReceiver.decode()</code>检查是否收到新的IR命令:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="5a7d" class="lq jr hi lm b fi lr ls l lt lu">void loop() {<br/>   if (IrReceiver.decode()) {<br/>    // handle cases<br/>  }<br/>}</span></pre><p id="1bc8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在方法体中，定义被触发的自定义逻辑。我建议使用一个<code class="du lw lx ly lm b">switch</code>语句来确定当前按下的键，然后用一个专用的<code class="du lw lx ly lm b">case</code>语句来处理每种情况。基本结构如下。重要提示:在语句结束时，一定要调用<code class="du lw lx ly lm b">IrReceiver.resume()</code>来监听新的关键事件。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="c1e3" class="lq jr hi lm b fi lr ls l lt lu">switch (IrReceiver.decodedIRData.command) {<br/>    case (17): {<br/>      // handle key 17<br/>      break;<br/>    }<br/>    case (18): {<br/>     // handle key 18<br/>      break;<br/>    }<br/>    IrReceiver.resume();<br/>}</span></pre><p id="9b1c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我的例子中，我检测遥控器的各种数字，并把它们打印在屏幕上。我也处理用于移动轮式车辆的方向指令。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="c6c2" class="lq jr hi lm b fi lr ls l lt lu">void processIR() {<br/>  switch (IrReceiver.decodedIRData.command) {<br/>    case (17): {<br/>      printCharOnMatrix('1');<br/>      break;<br/>    }<br/>    case (18): {<br/>      printCharOnMatrix('2');<br/>      break;<br/>    }<br/>    case (19): {<br/>      printCharOnMatrix('3');<br/>      break;<br/>    }<br/>    // ....<br/>    default : {<br/>      printCharOnMatrix('@');<br/>      break;<br/>    }<br/>  } <br/>    IrReceiver.resume();<br/>}</span></pre><h1 id="26e5" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">最佳化</h1><p id="4c03" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">默认情况下，所有IR供应商协议——参见<a class="ae jp" href="https://github.com/Arduino-IRremote/Arduino-IRremote/blob/master/examples/SimpleReceiver/SimpleReceiver.ino#L14" rel="noopener ugc nofollow" target="_blank">完整协议列表</a>——将被编译到您的程序中。如果您知道确切的协议，只需使用如下所示的预处理程序指令:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="d6cd" class="lq jr hi lm b fi lr ls l lt lu">#define DECODE_NEC 1</span><span id="ae5d" class="lq jr hi lm b fi lv ls l lt lu">#include &lt;Arduino.h&gt;<br/>#include &lt;IRemote.h&gt;</span></pre><p id="88d8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于微调，有许多由预处理器定义激活的编译选项，参见<a class="ae jp" href="https://github.com/Arduino-IRremote/Arduino-IRremote#compile-options--macros-for-this-library" rel="noopener ugc nofollow" target="_blank">官方文档</a>。</p><h1 id="0d95" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结论</h1><p id="8a05" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">由于出色的<a class="ae jp" href="https://github.com/Arduino-IRremote/Arduino-IRremote" rel="noopener ugc nofollow" target="_blank">Arduino-I remote</a>库，解析IR命令可以在几分钟内完成。本文向您展示了如何设置库并启动一个程序来采样遥控器的命令。然后，我们看到了如何为每个IR命令实现定制的控制逻辑。最后，我给了您一些提示，告诉您如何通过只包含所需的IR协议来优化整个程序。</p></div></div>    
</body>
</html>