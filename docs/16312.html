<html>
<head>
<title>How to parse dates in a data frame using pandas?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用pandas解析数据框中的日期？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/parsing-dates-effb08eccc71?source=collection_archive---------6-----------------------#2022-12-21">https://medium.com/geekculture/parsing-dates-effb08eccc71?source=collection_archive---------6-----------------------#2022-12-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/44fd3b31e116dcba4c3c7fdb9e298718.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Nh4XOEGTpS3ZOBYp"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/es/@ikukevk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kevin Ku</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0aed" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本文将讨论数据框中的<strong class="ix hj">日期，以及如何处理它们，并在任何项目或用例中有效地使用它们。</strong></p><p id="6c04" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在处理任何<strong class="ix hj">数据分析、机器学习或深度学习</strong>问题时，任何数据集中的<strong class="ix hj">日期列</strong>都是<strong class="ix hj">最重要的功能</strong>之一。如果我们试图<strong class="ix hj">解决时间序列问题</strong>，这是最重要的，因为一切都取决于此。在本文中，我们将看到如何以正确的格式处理<strong class="ix hj">日期，如果数据集中的数据类型</strong>出现错误，将它们转换为<strong class="ix hj">正确的数据类型</strong>。</p><p id="1bfd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://www.kaggle.com/datasets/usgs/earthquake-database" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">数据集</strong> </a>取自<strong class="ix hj">美国地质调查局</strong>，它包含了从1956年到2016年的<strong class="ix hj">地震信息。所涉及的最重要的步骤将主要是<strong class="ix hj">检查日期列的数据类型</strong>、<strong class="ix hj">将其更改为正确的数据类型</strong>，发现是否所有日期的格式都正确，并更改格式不正确的日期，等等。</strong></p><p id="62e5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面给出了代码实现。</p><pre class="jt ju jv jw fd jx jy jz bn ka kb bi"><span id="3c11" class="kc kd hi jy b be ke kf l kg kh"># modules we'll use<br/>import pandas as pd<br/>import numpy as np<br/>import seaborn as sns<br/>import datetime<br/><br/># read in our data<br/>earthquakes = pd.read_csv("database.csv")<br/><br/>earthquakes.head()</span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ki"><img src="../Images/3931f7e905fad389df6a534ee4e7f908.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CqAP5hQ0igE5FpewOtx-0A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">First 5 rows of Earthquake dataset (image from Kaggle)</figcaption></figure><p id="25b3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">日期</strong>列为<strong class="ix hj">数据类型</strong>(‘O’表示其属于<strong class="ix hj">对象数据类型</strong>。</p><h2 id="3d78" class="kj kd hi bd kk kl km kn ko kp kq kr ks jg kt ku kv jk kw kx ky jo kz la lb lc bi translated"><strong class="ak">将日期列转换为日期时间</strong></h2><p id="8e25" class="pw-post-body-paragraph iv iw hi ix b iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js hb bi translated"><strong class="ix hj">【日期】</strong>栏中的大部分条目遵循相同的格式:<strong class="ix hj">【月/日/四位数年份】</strong>。然而，<strong class="ix hj">索引3378 </strong>处的条目遵循完全不同的模式。</p><pre class="jt ju jv jw fd jx jy jz bn ka kb bi"><span id="2988" class="kc kd hi jy b be ke kf l kg kh">earthquakes[3378:3383]</span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/d972b4d4c31af9339a1fb2c871275318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wnS2fCVyHI7e9fAdKGSvgA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">The rows from indices 3378 to 3382</figcaption></figure><p id="5338" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">数据被<strong class="ix hj">打错了</strong>或者可能是输入数据的人<strong class="ix hj">试图只对1行进行创新</strong>。玩笑归玩笑，其他行也可能发生这种情况，所以让我们用下面的代码来检查一下。</p><pre class="jt ju jv jw fd jx jy jz bn ka kb bi"><span id="5003" class="kc kd hi jy b be ke kf l kg kh">date_lengths = earthquakes.Date.str.len()<br/>date_lengths.value_counts()<br/><br/>10    23409<br/>24        3</span></pre><p id="4911" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从结果中可以看出，大部分<strong class="ix hj"> (24309) </strong>行的<strong class="ix hj">日期</strong>列<strong class="ix hj">长度为10 </strong>即“<strong class="ix hj">月/日/四位数年份</strong>”格式，只有<strong class="ix hj"> 3行</strong>的<strong class="ix hj">长度为24 </strong>正如我们前面看到的。为了识别长度为24的索引，让我们运行下面的代码。</p><pre class="jt ju jv jw fd jx jy jz bn ka kb bi"><span id="7cef" class="kc kd hi jy b be ke kf l kg kh">indices = np.where([date_lengths == 24])[1]<br/>print('Indices with corrupted data:', indices)<br/>earthquakes.loc[indices]</span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/f67cc4921a9cbeba4792bb1558429738.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XaBfy_dk4JNBDU6s42H0yQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">The rows with the wrong Date representation (image from Kaggle)</figcaption></figure><p id="a10f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">可以看出，索引<strong class="ix hj"> 3378、7512和20650 </strong>是<strong class="ix hj">日期打错</strong>的地方。</p><p id="6a46" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们<strong class="ix hj">将错误表示的日期</strong>转换成<strong class="ix hj">正确的日期</strong>格式，并创建一个新的<strong class="ix hj">日期列</strong> ( <strong class="ix hj"> date_parsed </strong>)。</p><pre class="jt ju jv jw fd jx jy jz bn ka kb bi"><span id="9729" class="kc kd hi jy b be ke kf l kg kh">earthquakes.loc[3378, "Date"] = "02/23/1975"<br/>earthquakes.loc[7512, "Date"] = "04/28/1985"<br/>earthquakes.loc[20650, "Date"] = "03/13/2011"<br/>earthquakes['date_parsed'] = pd.to_datetime(earthquakes['Date'], format = '%m/%d/%Y')<br/>earthquakes.head()</span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/2807401b2f2045c538e554a5f50668f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qI8rGbi9_ENHvgtS_R5NiA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Created date column as can be seen above</figcaption></figure><p id="a03f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，如果我们重新检查创建的列<strong class="ix hj">的数据类型。</strong></p><pre class="jt ju jv jw fd jx jy jz bn ka kb bi"><span id="a3b6" class="kc kd hi jy b be ke kf l kg kh">earthquakes.date_parsed.dtypes<br/><br/>datetime64[ns]</span></pre><p id="d220" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> date_parsed </strong>列是一个<a class="ae iu" href="https://pandas.pydata.org/docs/reference/api/pandas.to_datetime.html" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj">DateTime</strong></a><strong class="ix hj">datatype</strong>格式列。</p><h2 id="a6bf" class="kj kd hi bd kk kl km kn ko kp kq kr ks jg kt ku kv jk kw kx ky jo kz la lb lc bi translated"><strong class="ak">选择一个月中的某一天</strong></h2><p id="e77b" class="pw-post-body-paragraph iv iw hi ix b iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js hb bi translated">创建一个<strong class="ix hj">熊猫系列</strong>来检查任何一个月的某一天。</p><pre class="jt ju jv jw fd jx jy jz bn ka kb bi"><span id="401e" class="kc kd hi jy b be ke kf l kg kh"># try to get the day of the month from the date column<br/>day_of_month_earthquakes = earthquakes['date_parsed'].dt.day</span></pre><p id="c7b4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，让我们<strong class="ix hj">只在<strong class="ix hj">柱状图</strong>上绘制一个月中的</strong>天，以尝试并理解特定月份中<strong class="ix hj">地震</strong>的分布情况(考虑到我们一个月中<strong class="ix hj">最多有31天</strong>，但不是所有月份)。当然，我们在<strong class="ix hj">之前将<strong class="ix hj">中缺失的值</strong>去掉，以避免图中出现任何破损</strong>。</p><pre class="jt ju jv jw fd jx jy jz bn ka kb bi"><span id="9438" class="kc kd hi jy b be ke kf l kg kh"># remove na's<br/>day_of_month_earthquakes = day_of_month_earthquakes.dropna()<br/><br/># plot the day of the month<br/>sns.distplot(day_of_month_earthquakes, kde=False, bins=31);</span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/80ebbea8620f73820a2394689836d594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*06owia4mSAvUDZbGQx7fGA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Daily distribution of earthquakes (Kaggle image)</figcaption></figure><p id="0c82" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">分布为<strong class="ix hj">均匀分布</strong>且<strong class="ix hj">无不均匀尖峰或骤降</strong>。这表明所有的日子都有相同的概率面临地震。</p><p id="fb6c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">关于解析日期的文章到此结束，我把它从<a class="ae iu" href="https://www.kaggle.com/code/alexisbcook/parsing-dates" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">提到这里</strong> </a>。还有<a class="ae iu" href="https://www.educative.io/answers/what-is-the-pandastodatetime-method" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">这篇关于<strong class="ix hj"> pandas.to_datetime() </strong>方法的有趣文章</strong> </a>你可以去看看。它在<strong class="ix hj">不同的日期时间</strong>格式上有各种情况(日-月-年小时-分-秒，t <strong class="ix hj"> ime区域感知</strong>处理日期的技术(<strong class="ix hj"> utc=True </strong>)，如果指定的日期列是日优先还是年优先，等等。仅举几个例子)。</p><p id="1fca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">查看我的其他<a class="ae iu" rel="noopener" href="/@abhi2652254"> <strong class="ix hj">文章</strong> </a>，说<a class="ae iu" href="https://www.linkedin.com/in/obhinaba17/" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">嗨</strong> </a> <strong class="ix hj">。</strong></p></div></div>    
</body>
</html>