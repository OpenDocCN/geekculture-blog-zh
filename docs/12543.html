<html>
<head>
<title>Isar Database: How to use it with Flutter | Todo App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Isar数据库:如何使用Flutter | Todo应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/isar-database-how-to-use-it-with-flutter-todo-app-978a2d7c85dd?source=collection_archive---------1-----------------------#2022-05-18">https://medium.com/geekculture/isar-database-how-to-use-it-with-flutter-todo-app-978a2d7c85dd?source=collection_archive---------1-----------------------#2022-05-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/a4ed0843c24832536ab9686d5b77c3f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-0NLVWdLhpyMBA7_BzRBpw.png"/></div></div></figure><div class=""/><p id="e8d6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">大家好，在这篇文章中，我们将看到如何在Flutter中使用<a class="ae jo" href="https://pub.dev/packages/isar" rel="noopener ugc nofollow" target="_blank"> Isar </a>数据库。现在，你脑海中闪现的第一个问题是，既然有其他选择，例如<a class="ae jo" href="https://pub.dev/packages/hive" rel="noopener ugc nofollow" target="_blank">蜂巢</a>，你为什么还要使用这个新数据库。</p><h1 id="5731" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">为什么使用Isar数据库？</h1><p id="f0d8" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">它是高度可伸缩的、快速的和跨平台的。<br/>此外，它非常容易使用，并提供了大量的功能来过滤和查询数据库中的数据。<br/>我们之前使用的是Hive，但是加载大量数据需要很长时间。但是在转向Isar之后，我们现在能够在几毫秒内加载数据。</p><p id="1ecf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们直接进入实现。</p><h1 id="dd34" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">怎么用？</h1><p id="361e" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">因此，我们将使用Isar构建一个Todo应用程序，即使在关闭应用程序后，该应用程序也将保存数据。对于状态管理，我在这里使用了<strong class="is hu"> Provider </strong>，但是这不会影响数据库功能。</p><p id="7351" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">继续安装这个<a class="ae jo" href="https://pub.dev/packages/isar" rel="noopener ugc nofollow" target="_blank">链接</a>中提到的依赖项。</p><h2 id="cb79" class="ks jq ht bd jr kt ku kv jv kw kx ky jz jb kz la kd jf lb lc kh jj ld le kl lf bi translated">文件结构…</h2><figure class="lh li lj lk fd hk er es paragraph-image"><div class="er es lg"><img src="../Images/c8dc9ca215cb537d26fd7a66e9993c51.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*54ClehbXrpn_8qQCXkiF3g.png"/></div></figure><p id="b927" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> models/todo.dart </strong> →该文件包含一个定义todo项的类。<br/><strong class="is hu">models/todo . g . dart</strong>→此文件由Isar<br/><strong class="is hu">provider/todos _ provider . dart</strong>→此文件包含所有状态管理<br/> <strong class="is hu">屏幕/home_screen.dart </strong> → UI实现</p><h2 id="51ea" class="ks jq ht bd jr kt ku kv jv kw kx ky jz jb kz la kd jf lb lc kh jj ld le kl lf bi translated">待办事项模型</h2><p id="ca18" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在Isar中，可以通过将类注释为<strong class="is hu"> @Collection() </strong>来定义数据集合。你可以在下面的代码片段中看到相同的内容。<br/>同样，如果您需要一个字段是一个<strong class="is hu"> id </strong>，您可以将该字段注释为<strong class="is hu"> @Id() </strong>。我使用了Isar提供的自动增量器。</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><h2 id="03e0" class="ks jq ht bd jr kt ku kv jv kw kx ky jz jb kz la kd jf lb lc kh jj ld le kl lf bi translated">运行代码生成器…</h2><p id="4fa1" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">现在运行这个命令，以便Isar可以为您的模型生成模式文件。</p><pre class="lh li lj lk fd ln lo lp lq aw lr bi"><span id="e4e7" class="ks jq ht lo b fi ls lt l lu lv">flutter pub run build_runner build</span></pre><h1 id="5160" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">会计标准专家组数据库功能</h1><p id="424f" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">首先，我们需要初始化数据库，为此您需要您想要使用的模式。</p><pre class="lh li lj lk fd ln lo lp lq aw lr bi"><span id="6869" class="ks jq ht lo b fi ls lt l lu lv">final isar = await Isar.open(<br/>    schemas: [TodoSchema],<br/>);</span></pre><p id="e907" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果希望将数据库存储在特定位置，也可以传递一个目录路径。</p><h2 id="4c30" class="ks jq ht bd jr kt ku kv jv kw kx ky jz jb kz la kd jf lb lc kh jj ld le kl lf bi translated">获得所有待办事项…</h2><p id="5d35" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">为了在Isar中执行任何CRUD操作，我们需要一个事务。他们还将多个操作合并为一个单元。</p><p id="c924" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有两种类型的交易可用，<br/>、<strong class="is hu">。txn </strong> →该交易仅可用于读取数据。<br/> <strong class="is hu">。writeTxn </strong> →该事务可用于读写。</p><pre class="lh li lj lk fd ln lo lp lq aw lr bi"><span id="b400" class="ks jq ht lo b fi ls lt l lu lv">await isar!.txn((isar) async {<br/>    final <strong class="lo hu">todosCollection</strong> = isar.todos;<br/>    <strong class="lo hu">_todos</strong> = await todosCollection.where().findAll();<br/>    notifyListeners();<br/>});</span></pre><p id="c709" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如你所见，我们可以使用<strong class="is hu">。其中()。findAll() </strong>获取所有数据。您也可以在内部指定任何条件。where()来查询数据。</p><h2 id="4545" class="ks jq ht bd jr kt ku kv jv kw kx ky jz jb kz la kd jf lb lc kh jj ld le kl lf bi translated">正在添加待办事项…</h2><p id="f410" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">现在我们将数据添加到数据库中，我们将使用<strong class="is hu">。writeTxn </strong>来执行操作。要添加或更新记录，您必须使用<strong class="is hu">。put() </strong>函数将返回添加/更新记录的id。</p><pre class="lh li lj lk fd ln lo lp lq aw lr bi"><span id="5105" class="ks jq ht lo b fi ls lt l lu lv">void <strong class="lo hu">addTodo</strong>(Todo todo) async {<br/>    await isar!.writeTxn((isar) async {<br/>        int <strong class="lo hu">id</strong> = await isar.todos<strong class="lo hu">.put</strong>(todo);<br/>    });<br/>    _todos.add(todo);<br/>    notifyListeners();<br/>}</span></pre><blockquote class="lw lx ly"><p id="fccd" class="iq ir lz is b it iu iv iw ix iy iz ja ma jc jd je mb jg jh ji mc jk jl jm jn hb bi translated">如果<code class="du md me mf lo b">id</code>字段不是只读的，Isar将自动为对象分配新的id。</p></blockquote><h2 id="a175" class="ks jq ht bd jr kt ku kv jv kw kx ky jz jb kz la kd jf lb lc kh jj ld le kl lf bi translated">正在删除待办事项…</h2><p id="c7a7" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">要从集合中删除一个条目，您必须调用<strong class="is hu">。【id删除】</strong>功能，传递要删除的记录的id。delete函数将返回一个布尔值，表明删除成功。</p><pre class="lh li lj lk fd ln lo lp lq aw lr bi"><span id="14a8" class="ks jq ht lo b fi ls lt l lu lv">void <strong class="lo hu">deleteTodo</strong>(Todo todo) async {<br/>    await isar!.writeTxn((isar) async {<br/>        bool deleted = await isar.todos.<strong class="lo hu">delete</strong>(todo.id);<br/>        if (deleted) _todos.remove(todo);<br/>        notifyListeners();<br/>    });<br/>}</span></pre><h2 id="3b26" class="ks jq ht bd jr kt ku kv jv kw kx ky jz jb kz la kd jf lb lc kh jj ld le kl lf bi translated">正在更新待办事项…</h2><p id="ff7c" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">这里我们将切换todo的<strong class="is hu"> isImportant </strong>字段。如果集合中存在该id，则。put方法将自动更新记录。</p><pre class="lh li lj lk fd ln lo lp lq aw lr bi"><span id="be58" class="ks jq ht lo b fi ls lt l lu lv">void <strong class="lo hu">toggleImp</strong>(int id) async {<br/>    await isar!.writeTxn((isar) async {<br/>        Todo? todo = await isar.todos.get(id);<br/>        todo!.isImportant = !todo.isImportant;<br/>        await isar.todos.<strong class="lo hu">put</strong>(todo);<br/>    });<br/>}</span></pre><h2 id="8fa4" class="ks jq ht bd jr kt ku kv jv kw kx ky jz jb kz la kd jf lb lc kh jj ld le kl lf bi translated">所有方法的完整代码…</h2><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><h1 id="104b" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">UI实现</h1><p id="2740" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">因为我使用提供者进行状态管理，所以这一部分对您来说可能不同，但是逻辑是相似的。<br/>还有，只是为了教程，我是随机添加todos的。</p><figure class="lh li lj lk fd hk"><div class="bz dy l di"><div class="ll lm l"/></div></figure><h1 id="7e5d" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">这是最终的输出</h1><figure class="lh li lj lk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/de55a5b657b1660a7918d4706f294212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*6rsd9eE49mKrBxlU6lWh_g.gif"/></div></div></figure><p id="69e6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这一次到此为止。希望你喜欢。</p><p id="dee5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢您阅读至此。请务必留下任何建议和评论👏为了这个故事。</p></div></div>    
</body>
</html>