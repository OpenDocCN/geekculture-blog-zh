<html>
<head>
<title>Configure HTTPS on AWS EC2 for Free Using Cloudflare</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Cloudflare在AWS EC2上免费配置HTTPS</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/configure-https-on-aws-ec2-for-free-using-cloudflare-e7120e9a6856?source=collection_archive---------1-----------------------#2021-03-11">https://medium.com/geekculture/configure-https-on-aws-ec2-for-free-using-cloudflare-e7120e9a6856?source=collection_archive---------1-----------------------#2021-03-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="7cc8" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在本文中，我希望能够向您展示如何使用SSL证书保护AWS EC2(或任何服务器)中托管的前端应用程序。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/5b18bef980a2578bfe8051be22257732.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-REtI7XITDLNZOzBOyMkjg.png"/></div></div></figure><p id="da19" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi kf translated">有一次，我用React构建了一个web应用程序，并用Golang编写了一个基础设施。在我完成这个项目后，我想把它部署在某个地方。对于React应用程序，我将它部署到Netlify(顺便说一下，这是一个很棒的工具)，令人惊讶的是，它已经在我的Netlify应用程序中有了SSL证书，这太棒了。对于用Golang编写的应用程序，我尝试了一个AWS EC2自由层来测试我的项目，但我没有预料到的是(因为我没有考虑清楚), EC2机器没有SSL证书，而且，如你所知，安全连接不能在不安全的服务器上执行请求(HTTPS - &gt; HTTP)。</p><p id="45cd" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">当你面临类似的问题时，如果你快速搜索一下，你会发现有一个很棒的认证机构可以免费为你的服务器生成一个证书。我说的是让我们加密，但有一个陷阱:因为AWS EC2免费层是常用的，并与垃圾邮件相关联，他们阻止了EC2域，这意味着它不会工作。</p><h1 id="bcc6" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">Cloudflare —解决方案的第1部分</h1><p id="85c0" class="pw-post-body-paragraph jj jk hi jl b jm lg ij jo jp lh im jr js li ju jv jw lj jy jz ka lk kc kd ke hb bi translated">您可能知道，Cloudflare在其平台上提供免费的带DDoS保护的SSL证书，您可能会问自己，他们为什么要这样做？嗯，因为他们希望流量通过他们的服务器，这样他们就可以区分“好流量”和“坏流量”，在这种情况下，每个人都是赢家。</p><p id="c9cf" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">要实现这个简单的解决方案，你需要三样东西:</p><ul class=""><li id="908b" class="ll lm hi jl b jm jn jp jq js ln jw lo ka lp ke lq lr ls lt bi translated">注册一个域名(可以使用免费域名，当时我用<a class="ae lu" href="https://freenom.com/" rel="noopener ugc nofollow" target="_blank"> Freenom </a>网站注册了一个. tk域名12个月)；</li><li id="7b06" class="ll lm hi jl b jm lv jp lw js lx jw ly ka lz ke lq lr ls lt bi translated">注册一个Cloudflare帐户；</li><li id="7b98" class="ll lm hi jl b jm lv jp lw js lx jw ly ka lz ke lq lr ls lt bi translated">在AWS EC2机器上安装NGINX。</li></ul><p id="586c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">第一点很简单，你可以获得一个免费域名，然后就可以创建你的Cloudflare帐户了。如果您仔细按照步骤操作，您将进入DNS屏幕，在这里您可以将您最近购买的域名与您的EC2 IP地址(或域名)进行映射</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ma"><img src="../Images/8cf7e5b3fe546b898486d5ad2df86c06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UqNDsFJsHISDDWMYfmC9bw.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">DNS Configuration</figcaption></figure><p id="5fd3" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">为此，您必须将您的域默认名称服务器更改为指向Cloudflare的服务器(您的域管理控制台/仪表板中应该有此设置)。请注意，您的域上的这一更改可能需要24小时才能完成。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mf"><img src="../Images/d338a29126a7a78147766f3363d30502.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*eKsu--6Jf0AGc_Rc4IqpIw.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">Cloudflare’s name servers</figcaption></figure><p id="a208" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这样，每个请求都将转到Cloudflare services，自动为您提供免费的SSL证书(HTTPS连接),并且因为您进行了DNS配置，您的域映射到您的EC2服务器，所以请求将到达那里，但不会显示任何内容，因为您没有设置任何web服务器/反向代理。现在是时候在我们的服务器上设置NGINX了。</p><h1 id="49b2" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">NGINX配置——解决方案的第2部分</h1><p id="0e57" class="pw-post-body-paragraph jj jk hi jl b jm lg ij jo jp lh im jr js li ju jv jw lj jy jz ka lk kc kd ke hb bi translated">因为你可以选择一个不同于我的AMI (Amazon机器映像),所以我将向你解释如何为你的版本配置NGINX。</p><p id="998c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">登录到您的EC2服务器并键入</p><pre class="iy iz ja jb fd mg mh mi mj aw mk bi"><span id="f6c7" class="ml kp hi mh b fi mm mn l mo mp">cat /etc/os-release</span></pre><p id="3375" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在输出中，您可以看到安装在您的映像中的Linux版本，在我的例子中是Centos。在NGINX官方文档中，你可以找到如何在你的特定Linux版本上安装NGINX的教程(<a class="ae lu" href="https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/" rel="noopener ugc nofollow" target="_blank">阅读更多</a>)。</p><p id="0bd5" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在我的例子中，我需要配置NGINX的命令是:</p><pre class="iy iz ja jb fd mg mh mi mj aw mk bi"><span id="2808" class="ml kp hi mh b fi mm mn l mo mp">sudo yum update<br/>sudo yum install nginx<br/>sudo vi /etc/yum.repos.d/nginx.repo<br/>&gt;&gt; Add this<br/>[nginx]<br/>name=nginx repo<br/>baseurl=https://nginx.org/packages/mainline/&lt;OS&gt;/&lt;OSRELEASE&gt;/$basearch/<br/>gpgcheck=0<br/>enabled=1 <br/>&lt;&lt;<br/>sudo service nginx start</span></pre><p id="cc1a" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">现在，如果你使用HTTP访问你的域名，你会到达一个默认的NGINX页面。但这不是你想要的。您想要使用HTTPS访问您的域。为此，只需更新您的NGINX配置文件</p><pre class="iy iz ja jb fd mg mh mi mj aw mk bi"><span id="ce6e" class="ml kp hi mh b fi mm mn l mo mp">vi /etc/nginx/conf.d/default.conf</span></pre><p id="baef" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">并补充道，</p><pre class="iy iz ja jb fd mg mh mi mj aw mk bi"><span id="96f8" class="ml kp hi mh b fi mm mn l mo mp">upstream server {<br/>  server 127.0.0.1:9000;<br/>}</span><span id="f31c" class="ml kp hi mh b fi mq mn l mo mp">server {</span><span id="3128" class="ml kp hi mh b fi mq mn l mo mp">listen              443 ssl default_server;<br/>listen              [::]:443 ssl default_server;</span><span id="f09b" class="ml kp hi mh b fi mq mn l mo mp">server_name  localhost;</span><span id="75ba" class="ml kp hi mh b fi mq mn l mo mp">ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt;<br/>ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key;<br/> <br/> location / {<br/>  proxy_pass <a class="ae lu" href="http://wsserver;" rel="noopener ugc nofollow" target="_blank">http://server;</a><br/>  proxy_set_header Upgrade $http_upgrade;<br/>  proxy_set_header Connection "Upgrade";<br/>  proxy_set_header Host            $host;<br/>  proxy_set_header X-Real-IP       $proxy_protocol_addr;<br/>  proxy_set_header X-Forwarded-For $proxy_protocol_addr;<br/>  # Very important, controls proxied websocket connection timeout<br/>  proxy_read_timeout 600s;<br/> }<br/>}</span></pre><p id="e4ac" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这样，您将从端口443接收请求，并将这些请求转发到您的服务器端口(在本例中是9000，这是我的Golang服务器端口)。</p><p id="8e4f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果你注意到我已经添加了为NGINX生成的私有SSL证书。使用OpenSSL，您可以轻松地创建这些证书。</p><pre class="iy iz ja jb fd mg mh mi mj aw mk bi"><span id="2feb" class="ml kp hi mh b fi mm mn l mo mp">sudo mkdir /etc/ssl/private<br/>sudo chmod 700 /etc/ssl/private<br/>sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/nginx-selfsigned.key -out /etc/ssl/certs/nginx-selfsigned.crt</span></pre><p id="568d" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">你会被问一系列的问题，你可以对每个人都按回车键，这部分不是本教程的内容，也不是强制性的。</p><p id="5973" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">仅此而已。如果你用HTTPS访问你的应用程序(使用你的域),它将成功地到达你的后端端口9000。简单又安全。</p></div></div>    
</body>
</html>