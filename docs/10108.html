<html>
<head>
<title>Tale of Two CIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">两个独联体的故事</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/tale-of-two-cis-4a3be311f36c?source=collection_archive---------22-----------------------#2022-01-13">https://medium.com/geekculture/tale-of-two-cis-4a3be311f36c?source=collection_archive---------22-----------------------#2022-01-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1ef2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是几个月前我的<a class="ae jd" href="https://betterprogramming.pub/why-dont-we-do-unit-testing-e0bb55a38aa2" rel="noopener ugc nofollow" target="_blank">单元测试文章</a>的续篇，大致基于真实的生活经历…向所有认为我可能会引用它们的人道歉！</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><p id="790b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，你做一个项目，你写代码，测试它(我希望！)并部署到生产环境中。没那么难吧。那么这些关于CI的噪音是什么？我们做得很好，不是吗？</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jl"><img src="../Images/f37b1b9d251ba1374ee4a50b9dd8d1dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yPRqcOjWUaiaxfKje3sqXA.jpeg"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx">The pipeline of creation</figcaption></figure><p id="8bcd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在快进几年。你的前任(但只有两个)写了一些程序，现在业务依赖这些程序。但是它坏了。它所依赖的库和操作系统已经向前发展，安全标准已经更新，计算机说:<strong class="ih hj">不！不要！不要！</strong></p><p id="f430" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">肯定有人知道这个POS如何工作(毕竟现在是你的工作了！).他们都走了。他们都从LinkedIn的个人资料中删除了任何提及你现在雇主的内容。以防你来找他们。</p><p id="1c44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么源代码在哪里？有吗？是不是太多了？(在一些过时的源代码控制系统中有10个不同的版本——猜猜哪一个被部署到产品中了？)让我们看看最近的版本，希望它不是一个正在进行的工作，几年前当你的前任(两次被删除)离开去另谋高就时被放弃了。</p><p id="8b2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我该如何构建它？看起来他们用的是Visual Studio，但是哪个版本呢？可能是几代人以前(至少)。所以让我们去下载它，然后试着说服it部门让我安装一个他们认为危险的过时软件，这个软件只能在危险防护服的安全范围内使用。</p><p id="dd34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，一周过去了，您终于设法安装了一个古老的、不受支持的开发环境版本——这让您崭新的(非常新的)笔记本电脑很不舒服。只需打开解决方案并构建它。没问题吧？</p><p id="8f66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有多少错误？肯定弄错了。我不相信有人会签入一个与可编译的东西完全不同的软件版本。或者是我？我是不是造错了？</p><p id="00c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好吧，让我们深入研究错误。嗯，他们似乎引用了硬盘上的程序集(我的前任只有两个)。非常有用。当我试图搜索它们时，谷歌只是在嘲笑我。现在怎么办？等等！生产系统必须有这些程序集的副本(不管它们做什么？？？)咻！拯救一天。</p><p id="dd96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尝试重新构建。更多未知程序集。这个人(或女孩)从来没有听说过nuget吗？*叹息*。</p><p id="1a01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以花了一周的时间来查找晦涩和过时的程序集引用。(至少我正在将我的工作检查到一个现代的源代码控制系统中，所以这不是白费力气，不是吗？；-/现在，我或多或少拥有了一些东西(只要我牢牢抓住我的《人月神话》幸运签名本)</p><p id="ae0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么我该如何解决这个问题呢？(我的经理没有站在我的办公桌旁，显得不耐烦。不尽然！)如果我修好了它，我如何确保没有其他东西坏了？我如何部署它？</p><p id="19f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好的，修复看起来并不太难。当我在做的时候，我也可以把它更新到VS的更高版本，并开始使用nuget。现在我们在用煤气做饭！</p><p id="dcee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么单元测试在哪里呢？(我听到笑声了吗？)好吧，我想我知道这首曲子。让我们至少为我已经修复的部分编写一些测试，因为它应该会在以后为我节省一些痛苦。</p><p id="3461" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">后来，很久以后，为什么我的测试失败了？毫无意义！用户从来没有注意到这不能正常工作吗？！！:-O</p><p id="b8bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们问用户:“哦，是的，这是相当恼人的，但我们只是认为这是一个功能！”。Grrr。用力盯着。“要我修吗？”“好的，请吧！”</p><p id="ec5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">又一周过去了。它似乎在建立，而且可能做了正确的事情。现在，我该如何设置测试环境呢？(因为我的现实扭曲领域可能不足以支持交叉手指直接到生产的部署)它必须像生产一样，所以让我们设置一个测试环境并尝试一下。不会很难吧？</p><p id="411c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很久以后——我确定我开始的时候头发还没有变白——我有了一个测试环境。不太像制作环境。我不确定一半的配置值是做什么的，但是看起来它可能是有效的，尽管我没有一半的产品使用的测试实例。</p><p id="82ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后PHB(抱歉，呆伯特)说“你确定这能解决CEO上个月一直缠着我的问题？”。我十指交叉(在背后)，努力让自己听起来很随意但很自信:“是的，当然”。</p><p id="015a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以这一天(或者更可能是周五晚上)来了。部署包括停止生产，备份旧文件，然后拷贝新文件。(至少这次不涉及数据库)。重新开始生产，看看会发生什么…..没什么。我的周末泡汤了！</p><p id="f75d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">周一早上，当我清理桌子上的空披萨盒和软饮料罐时，PHB来了。</p><p id="1183" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“干得好，首席执行官对我最终解决了这个问题非常满意，抱歉，当然是对你”。</p><p id="89bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我睡眼惺忪地盯着他，努力回忆软床的感觉。</p><p id="9449" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“当你这么做的时候，你的前任写的另一个系统并没有运行。你花不了五分钟就能修好，是吗？”</p><p id="5052" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">历史没有记载PHB是否在紧急楼梯上的“工作场所事故”中幸存。</p><h1 id="3d04" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">同时，在附近的平行宇宙中..</h1><p id="f3da" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">我的另一个自我坐在那里擦亮他的玫瑰色眼镜，因为他自己的PHB进来告诉他，生产订单系统出了问题。</p><p id="9a51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“但是不要担心，你的前任和二位真的非常热衷于ALM、CI/CD和devops，所以这应该不在话下”</p><p id="36bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我很清楚，但我是新来的，所以我可能会走运(仅此一次)。让我们在德沃普斯搜索一下，看看我能找到什么。</p><p id="8051" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">答对了。这里有一个生产订单系统的部署管道。据说上次成功部署是在两年前。看起来它是从develop分支构建的，从那以后似乎没有什么变化。看起来构建管道运行良好，所以感谢你的偏爱之神，这家伙对编写单元测试如此着迷。这可以拯救我的一天。</p><p id="34d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们检查一下代码，看看我们能做些什么。它能建造吗？开箱！这家伙知道他在做什么。在我试图破坏/修复任何东西之前，让我们先运行测试套件。看起来不错。让我们复制他的一个测试来重现这个问题。做个测试，你知道什么？它就像生产一样中断。</p><p id="32f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将分支代码，更新它以使我的单元测试工作。签到，拉请求。不去吗？好吧，他真的强迫症了——他正在运行构建和测试套件来检查公关。但是我喜欢它，在签到之前没有运行测试套件是我的错。</p><p id="3e2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">建筑现在看起来不错，主要部分更新了。让我们使用部署管道将它推出到UAT。看起来UAT还在，但这家伙是个明星，他甚至用bicep编写了IaC脚本来创建Azure环境。虽然今天不需要去那里。</p><p id="92fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行集成测试。仍然看起来不错，让我们放弃PHB呼叫。“这真的很急吗？你确定要我下午部署吗？”。哦，你真的相信部署过程有能力恢复到以前的版本吗？那好吧。在你的头上…</p><p id="1f15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我天生谨慎，所以我想我会从发布回来看看有什么变化——devo PS似乎向我展示的正是我期望看到的变化，而不是别的。所以让我们按下按钮开始吧。</p><p id="0471" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5分钟后——部署完成，没有警报响起。有人注意到变化了吗？去和会计部那个乐于助人的家伙谈谈。"你知道PHB之前提到的那个问题吗？"。咔嚓咔嚓。“现在看起来不错，谢谢伙计，真不敢相信你这么快就修好了。在我工作的上一个地方，这种事情通常要花几个月的时间。</p><p id="f346" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我退到我的桌子旁，PHB正在那里等着我。“干得好。我设法在首席执行官收到之前发现了它，为此我表示感谢。”看了看手表。"我想是时候收工了，回家的路上想喝杯啤酒吗？"</p></div></div>    
</body>
</html>