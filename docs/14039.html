<html>
<head>
<title>Dockerize Your Automated Test &amp; Monitoring</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">记录您的自动化测试和监控</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/dockerize-your-automated-test-monitoring-c9ecdbbcf187?source=collection_archive---------5-----------------------#2022-08-12">https://medium.com/geekculture/dockerize-your-automated-test-monitoring-c9ecdbbcf187?source=collection_archive---------5-----------------------#2022-08-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ae0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用docker轻松监控并定期运行您的API/UI测试。随处部署。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><blockquote class="jk jl jm"><p id="8487" class="if ig jn ih b ii ij ik il im in io ip jo ir is it jp iv iw ix jq iz ja jb jc hb bi translated">要实现稳定且可扩展的平台，监控和自动化测试是必须具备的。通过实施持续监控，您可以尽快对停机或错误做出反应。通过实现自动化测试，您可以更加自信地将新特性发布到产品中。</p></blockquote><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es jr"><img src="../Images/268ddb4cd73d807933830a790de0dcdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FMRN04MWYvZhezDi2dAZMQ.jpeg"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx">Photo by <a class="ae kh" href="https://unsplash.com/@dawson2406?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Stephen Dawson</a> on <a class="ae kh" href="https://unsplash.com/s/photos/test-report?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="ab75" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated"><strong class="ak">你已经建立了你的自动化测试</strong></h2><p id="dc05" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">下一个问题是，我应该如何以及何时运行测试？对于单元测试，显然你可以把它们放在CI/CD管道中来检查方法的正确性和合理性。对于集成测试，当测试开始消耗大量时间时，可能会产生疑问。对于UI测试或API测试，将它放在CI/CD管道中并不是一个好的选择，因为它会消耗大量的时间，并可能阻塞另一个等待运行的管道。</p><h2 id="35b9" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated"><strong class="ak">那么我应该在哪里运行我的长跑测试呢？</strong></h2><p id="754a" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">对于长时间运行的测试，您有几个选择:</p><ul class=""><li id="c400" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated"><strong class="ih hj">手动运行测试&amp;检查平台可用性</strong> <br/>优点:不增加额外成本<br/>缺点:一切都是手工操作，难以扩展</li><li id="4098" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">使用测试管理平台</strong> <br/>优点:易于使用和设置<br/>缺点:受限于平台支持的内容</li><li id="a5be" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">推出您自己的测试&amp;监控工具</strong> <br/>优点:很好地融入您当前的环境/技术<br/>缺点:部署和工具维护</li></ul><p id="c154" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个和第二个选项非常简单。如果适合你的团队条件，请随意选择。但是，如果您想推出自己的测试和监控工具，请继续阅读。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h2 id="b155" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">I .选择您的测试报告员</h2><p id="20e8" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">这是必要的，因为我们想要容易地与其他涉众共享测试结果。使用html格式，最简单的方法是确保记者为我们稍后提供index.html。</p><p id="9f3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个例子是使用mochawesome-reporter来支持CodeceptJS测试。</p><ul class=""><li id="48db" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">安装mochawesome</li></ul><pre class="js jt ju jv fd lw lx ly lz aw ma bi"><span id="2c99" class="ki kj hi lx b fi mb mc l md me">npm i mochawesome</span></pre><ul class=""><li id="5856" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">将报表程序配置添加到CodeceptJS运行中</li></ul><pre class="js jt ju jv fd lw lx ly lz aw ma bi"><span id="d537" class="ki kj hi lx b fi mb mc l md me">codeceptjs run --reporter mochawesome --reporter-options reportFilename=index.html</span></pre><p id="c0f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行测试将会产生这样的报告</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es mf"><img src="../Images/2ae25c1ef443435acc4eb29699bdbd36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IKfKnqrJvn-BpRybW2qeow.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx">mochawesome reporter result</figcaption></figure><h2 id="08e3" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">二。设置您的网站监控</h2><p id="e119" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">因为我们正在开发自己的测试和监控工具，所以让我们使用<a class="ae kh" href="https://monika.hyperjump.tech/overview" rel="noopener ugc nofollow" target="_blank"> Monika </a>来设置一个简单的网站监控</p><ol class=""><li id="28d5" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc mg lo lp lq bi translated">生成你站点地图<br/>有几个站点地图生成器。请随意选择一个并生成您的sitemap.xml</li><li id="9bbb" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc mg lo lp lq bi translated">使用命令<code class="du mh mi mj lx b">npm i @hyperjumptech/monika</code>安装Monika</li><li id="bbad" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc mg lo lp lq bi translated">对你的站点地图进行监控</li></ol><pre class="js jt ju jv fd lw lx ly lz aw ma bi"><span id="f49a" class="ki kj hi lx b fi mb mc l md me">monika -c --sitemap=yoursitemap.xml</span></pre><p id="3bcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧啊。你的网站被莫妮卡监控了。不要忘记通过启用<a class="ae kh" href="https://monika.hyperjump.tech/guides/notifications" rel="noopener ugc nofollow" target="_blank">莫尼卡通知</a>来设置提醒通知(支持Slack、Google Chat、Telegram、Discord等)</p><p id="deb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想要一个更加定制的监控，阅读更多关于<a class="ae kh" href="https://monika.hyperjump.tech/guides/configuration-file" rel="noopener ugc nofollow" target="_blank">莫尼卡配置</a>。</p><h2 id="e494" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">三。使用流程管理器</h2><p id="6c51" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">为了运行同步和预定的测试，需要一个过程管理器。让我们用<a class="ae kh" href="https://pm2.keymetrics.io/" rel="noopener ugc nofollow" target="_blank"> PM2 </a>来做这个。</p><p id="9538" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们需要安装pm2</p><pre class="js jt ju jv fd lw lx ly lz aw ma bi"><span id="49a3" class="ki kj hi lx b fi mb mc l md me">npm install pm2 -g</span></pre><p id="7554" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，我们必须为并行流程生成一个配置</p><pre class="js jt ju jv fd lw lx ly lz aw ma bi"><span id="99f5" class="ki kj hi lx b fi mb mc l md me">pm2 init simple</span></pre><p id="d489" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的命令将生成生态系统. config.js。让我们修改该文件，直到它看起来像这样</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es mk"><img src="../Images/fef3027c0c28b4a35145340f412449a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QXoKF8tc0dt1CAgp4lMN4Q.png"/></div></div></figure><p id="97ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过创建上面的配置，并运行<code class="du mh mi mj lx b">pm2 start ecosystem.config.js</code>,我们设法:</p><ul class=""><li id="32bb" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">使用来自pm2的cron特性在每个午夜运行codeceptjs</li><li id="360f" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">运行Monika根据站点地图中的URL监控您的站点</li><li id="fa8c" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">运行静态服务器以查看来自最新codeceptjs执行的mochawesome报告</li></ul><p id="4e00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后一步是在云中准备和部署您的测试。</p><h2 id="3db3" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">四。准备好你的文档</h2><p id="a63f" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">Docker是一个开发、发布和运行应用程序的开放平台。如果你不熟悉Docker，在这里阅读更多<a class="ae kh" href="https://docs.docker.com/get-started/overview/" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es mk"><img src="../Images/a8751fda9107e26c87e632aa74845694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GQ5BA2ojuldHluE2WWC1Hw.png"/></div></div></figure><p id="8645" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将上面的代码放到Dockerfile中，它将</p><ul class=""><li id="79ae" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">使用节点16作为基础映像设置容器</li><li id="8159" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">为codeceptjs测试安装剧作家(您的设置可能会有所不同)</li><li id="93a8" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">运行pm2</li></ul><p id="e382" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过执行以下命令在本地测试您的应用</p><pre class="js jt ju jv fd lw lx ly lz aw ma bi"><span id="63fc" class="ki kj hi lx b fi mb mc l md me">docker build . -t testimg &amp;&amp; docker run -p 8080:8080 -t testimg</span></pre><p id="6ef3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">codeceptjs完成测试后打开<code class="du mh mi mj lx b">localhost:8080</code>,您将在浏览器中看到您的mochawesome报告。</p><h2 id="0ebb" class="ki kj hi bd kk kl km kn ko kp kq kr ks iq kt ku kv iu kw kx ky iy kz la lb lc bi translated">动词 （verb的缩写）部署</h2><p id="4f4e" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">完成上述步骤后，最后一部分是部署docker容器。有很多方法可以部署docker容器，比如</p><ul class=""><li id="fbff" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated"><a class="ae kh" rel="noopener" href="/geekculture/deploy-docker-containers-to-heroku-dc1bca7e4025">将Docker部署到Heroku </a></li><li id="9a82" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><a class="ae kh" rel="noopener" href="/geekculture/deploy-to-aws-docker-in-10-minutes-68a60724dcb9">将Docker部署到AWS </a></li></ul></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="ad21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">玩得开心！</p></div></div>    
</body>
</html>