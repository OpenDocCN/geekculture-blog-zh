<html>
<head>
<title>How to Read Data From Google Sheets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从Google Sheets中读取数据</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-read-data-from-google-sheets-ee335f787de6?source=collection_archive---------2-----------------------#2021-04-11">https://medium.com/geekculture/how-to-read-data-from-google-sheets-ee335f787de6?source=collection_archive---------2-----------------------#2021-04-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/fb3cb9476c816f9d650ce6b63e2892c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GNKQnmYOt2zQThqYJCey1A.png"/></div></div></figure><p id="c6e5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在测试自动化中，根据您的需要，有几种框架可供选择来在您的项目中实现。其中之一是数据驱动的框架。在这个框架中，测试数据存储在单个数据源或数据源组合中，如。csv，。xls。xlsx、数据库、直接来自google sheets等等。这样，您应该有一个实用程序来从这些数据源中提取或读取数据。如果你还没有尝试过从excel文件中读取数据，你可以查看这个<a class="ae jo" rel="noopener" href="/geekculture/how-to-read-data-from-excel-file-using-apache-poi-95b8a4aa3909"> <strong class="is hj">如何使用Apache POI </strong> </a> <strong class="is hj">从Excel文件中读取数据。</strong>在本文中，我们将直接从google sheets中读取数据。</p><p id="bdd2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了从google sheets中读取数据，我们将使用google提供的<a class="ae jo" href="https://developers.google.com/resources/api-libraries/documentation/sheets/v4/java/latest/" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">Google Sheets API</strong></a><strong class="is hj"/>。事实上，谷歌已经为我们提供了非常好的<a class="ae jo" href="https://developers.google.com/sheets/api/quickstart/java" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">文档和示例</strong> </a>关于如何使用他们的API。因此，我们要做的是为您的Google帐户浏览<strong class="is hj">“启用Google Sheets API”</strong>，并简短地浏览一个从Google Sheets读取数据的简单实用程序类。</p><h2 id="2b36" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated"><strong class="ak">启用Google Sheets API </strong></h2><ol class=""><li id="36ec" class="kk kl hi is b it km ix kn jb ko jf kp jj kq jn kr ks kt ku bi translated">打开这个<a class="ae jo" href="https://developers.google.com/sheets/api/quickstart/java" rel="noopener ugc nofollow" target="_blank">T21链接</a>。您将被重定向到Google Sheets API快速入门指南</li></ol><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/edeeac6a4765622aa12c8c5649a0ff7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mr4aSmJ7OrCBwr4c0ALxRg.png"/></div></div></figure><p id="0305" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.查看并点击<strong class="is hj">启用Google Sheets API </strong>。将显示一个提示，要求输入项目名称。出于我们的目的，任何名称都可以，缺省值甚至足够了。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es la"><img src="../Images/68c267060dfe06c2468943d777286caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HLSzCSHBDp1Ug1ShRqgGRg.png"/></div></div></figure><p id="bd5b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.点击<strong class="is hj">下一步。它将尝试启用API，然后会弹出另一个配置OAuth客户端的提示。同样，对于我们的目的，“桌面应用程序”就可以了。</strong></p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es la"><img src="../Images/dc5c54456a97390358ee0ef49144b837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Vw7yj6HGSJNGmNoEIDWiA.png"/></div></div></figure><p id="4d8b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.点击<strong class="is hj">创建</strong>。另一个提示将显示您的客户端ID和客户端密码，以及一个<strong class="is hj">下载客户端配置</strong>的选项。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es la"><img src="../Images/8055935263efdbf26e13dbce9f2500ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HGQpH-6Zgxts64XtWpg5RQ.png"/></div></div></figure><p id="f113" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.点击<strong class="is hj">下载客户端配置，</strong>配置文件将作为json下载。如果需要，您可以重命名该文件，或者保持不变。我们会将该文件添加到我们的自动化项目或您正在处理的任何项目中。当我们在google sheets上阅读我们的数据时，我们将使用该文件的内容来获得授权。</p></div><div class="ab cl lb lc gp ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="hb hc hd he hf"><p id="0ac0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是我的简单实用程序类读取google sheets中数据的方法。这些方法只是抛出异常，为了简化，没有进行其他异常处理。但是为了让这些方法工作，您应该添加这些库，或者只是作为依赖项添加到您的maven项目中。</p><ol class=""><li id="fd96" class="kk kl hi is b it iu ix iy jb li jf lj jj lk jn kr ks kt ku bi translated"><a class="ae jo" href="https://mvnrepository.com/artifact/com.google.apis/google-api-services-sheets/v4-rev614-1.18.0-rc" rel="noopener ugc nofollow" target="_blank"> Google Sheets API V4版本614 1.18.0 RC </a></li><li id="9575" class="kk kl hi is b it ll ix lm jb ln jf lo jj lp jn kr ks kt ku bi translated"><a class="ae jo" href="https://mvnrepository.com/artifact/com.google.oauth-client/google-oauth-client-jetty/1.31.5" rel="noopener ugc nofollow" target="_blank">用于Java的Google OAuth客户端库的OAuth 2.0验证码接收器</a></li><li id="a480" class="kk kl hi is b it ll ix lm jb ln jf lo jj lp jn kr ks kt ku bi translated"><a class="ae jo" href="https://mvnrepository.com/artifact/com.google.api-client/google-api-client/1.22.0" rel="noopener ugc nofollow" target="_blank">Google API Java客户端库</a></li></ol><p id="8c6c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于api客户端库，我们将使用1.22.0，这不是最新版本。如果您计划使用最新版本，请确保为Jackson添加一个单独的依赖项。</p><p id="dd5b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">首先是authorize()方法。</strong></p><pre class="kw kx ky kz fd lq lr ls lt aw lu bi"><span id="9d38" class="jp jq hi lr b fi lv lw l lx ly">private static Credential authorize() throws Exception {</span><span id="1e08" class="jp jq hi lr b fi lz lw l lx ly">    String credentialLocation = System.<em class="ma">getProperty</em>("user.dir") + "/GoogleAPIKey/credentials.json";<br/>    <br/>    GoogleClientSecrets clientSecrets = GoogleClientSecrets.<em class="ma">load</em>(JacksonFactory.<em class="ma">getDefaultInstance</em>(), new FileReader(credentialLocation));<br/><br/>    List&lt;String&gt; scopes = Arrays.<em class="ma">asList</em>(SheetsScopes.<em class="ma">SPREADSHEETS</em>);<br/><br/>    GoogleAuthorizationCodeFlow googleAuthorizationCodeFlow = new GoogleAuthorizationCodeFlow<br/>            .Builder(GoogleNetHttpTransport.<em class="ma">newTrustedTransport</em>(), JacksonFactory.<em class="ma">getDefaultInstance</em>(), clientSecrets, scopes)<br/>            .setDataStoreFactory(new FileDataStoreFactory(new File(System.<em class="ma">getProperty</em>("user.dir") + "/GoogleAPIKey")))<br/>            .setAccessType("offline")<br/>            .build();<br/><br/>    return new AuthorizationCodeInstalledApp(googleAuthorizationCodeFlow, new LocalServerReceiver()).authorize("user");<br/>}</span></pre><p id="eb7e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">基本上，这样做是为了授权我们，并给我们凭证来访问我们的表。看看我们如何使用之前下载的配置。在我的例子中，我在我的项目根目录中创建了一个名为<strong class="is hj">“GoogleAPIKey”</strong>的文件夹，并将名为<strong class="is hj"> credentials.json </strong>的配置文件放在其中。请务必将此添加到您的。gitignore文件，如果你不想把它上传到你的远程仓库。为了更好地理解这个函数，下面是这个方法中使用的主要类的文档链接。</p><ul class=""><li id="e722" class="kk kl hi is b it iu ix iy jb li jf lj jj lk jn mb ks kt ku bi translated"><a class="ae jo" href="https://googleapis.dev/java/google-api-client/latest/com/google/api/client/googleapis/auth/oauth2/GoogleClientSecrets.html" rel="noopener ugc nofollow" target="_blank"> GoogleClientSecrets </a></li><li id="b0e2" class="kk kl hi is b it ll ix lm jb ln jf lo jj lp jn mb ks kt ku bi translated"><a class="ae jo" href="https://googleapis.dev/java/google-api-client/latest/com/google/api/client/googleapis/auth/oauth2/GoogleAuthorizationCodeFlow.html" rel="noopener ugc nofollow" target="_blank">Google authorizationcodeflow</a></li><li id="5f59" class="kk kl hi is b it ll ix lm jb ln jf lo jj lp jn mb ks kt ku bi translated"><a class="ae jo" href="https://googleapis.dev/java/google-oauth-client/1.30.1/com/google/api/client/extensions/java6/auth/oauth2/AuthorizationCodeInstalledApp.html" rel="noopener ugc nofollow" target="_blank">AuthorizationCodeInstalledApp</a></li></ul><p id="23e5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是我们从google工作表中获取数据的方法</p><pre class="kw kx ky kz fd lq lr ls lt aw lu bi"><span id="17f3" class="jp jq hi lr b fi lv lw l lx ly">public static String[][] getData(String spreadSheetId, String sheetName, String rangeDataToRead) throws Exception {</span><span id="2f78" class="jp jq hi lr b fi lz lw l lx ly">    Sheets sheet = new Sheets(GoogleNetHttpTransport.<em class="ma">newTrustedTransport</em>(), JacksonFactory.<em class="ma">getDefaultInstance</em>(), <em class="ma">authorize</em>());<br/>    <br/>    List&lt;List&lt;Object&gt;&gt; data = sheet.spreadsheets().values()<br/>            .get(spreadSheetId, sheetName + "!" + rangeDataToRead)<br/>            .execute().getValues();<br/>    <br/>    return <em class="ma">convertToArray</em>(data);<br/>}</span></pre><p id="0bf0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们首先创建了一个工作表对象。看看我们的Sheets构造函数的最后一个参数。我们通过调用我们的<strong class="is hj"> authorize() </strong>方法来传递凭证。下一行是从工作表中读取数据。注意我们的<strong class="is hj"> get() </strong>方法。我们传递了数据来源的电子表格的ID。第二个参数是工作表的名称和将要读取数据的单元格区域。你会注意到第二个参数的一些字符串操作，因为api要求我们的第二个参数看起来像这个<strong class="is hj">“sheet name！A2:E" </strong>。因为这是为了我们的数据驱动测试自动化框架。TestNG数据提供者，我们选择的测试框架，不接受List&lt;List&lt;Object&gt;&gt;这就是为什么我们必须使用下面的方法将它转换成一个字符串的二维数组。</p><pre class="kw kx ky kz fd lq lr ls lt aw lu bi"><span id="d84e" class="jp jq hi lr b fi lv lw l lx ly">private static String[][] convertToArray(List&lt;List&lt;Object&gt;&gt; data) {<br/>    String[][] array = new String[data.size()][];<br/><br/>    int i = 0;<br/>    for (List&lt;Object&gt; row : data) {<br/>        array[i++] = row.toArray(new String[row.size()]);<br/>    }<br/>    return array;<br/>}</span></pre><p id="db78" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是我们的<strong class="is hj"> getData() </strong>方法的一个示例用法。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/2954eb364998496d0acadf0b34c47006.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O-1AqvKhD-xmIayycP8Y-Q.png"/></div></div></figure><p id="800d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您想知道从哪里获得电子表格id。它在你的电子表格的url中。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/070270151e981e92527741fc45e7fde3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TSPv2FteTvc767EGGNlFKQ.png"/></div></div></figure><p id="ed42" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为这只是为了从google sheets中读取数据。我们不会深究如何更新google sheets中的数据。但是我会留下一个示例代码供您研究。尝试一下，看看文档，了解它是如何工作的。</p><pre class="kw kx ky kz fd lq lr ls lt aw lu bi"><span id="09e0" class="jp jq hi lr b fi lv lw l lx ly">public static void updateData(String spreadSheetId, String sheetName, String cellLocation, String newValue) throws Exception {<br/>    <br/>if (cellLocation.contains(":")) {<br/>        throw new Exception(String.<em class="ma">format</em>("Restricting update to single cell only. You are trying to update cells %s", cellLocation));<br/>}<br/><br/>    Sheets sheets = new Sheets(GoogleNetHttpTransport.<em class="ma">newTrustedTransport</em>(), JacksonFactory.<em class="ma">getDefaultInstance</em>(), <em class="ma">authorize</em>());<br/><br/>    ValueRange updateValue = new ValueRange()<br/>            .setValues(Arrays.<em class="ma">asList</em>(Arrays.<em class="ma">asList</em>(newValue)));<br/><br/>    sheets.spreadsheets().values()<br/>            .update(spreadSheetId, sheetName + "!" + cellLocation, updateValue)<br/>            .setValueInputOption("RAW")<br/>            .execute();<br/>}</span></pre><p id="57a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">是的，我们刚刚为您的工具包添加了另一个实用程序。下一次，如果你不想从excel文件中获取数据，就从google sheets中获取。</p><p id="f636" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi">🍻 🍻 🍻</p></div></div>    
</body>
</html>