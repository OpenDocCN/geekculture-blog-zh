<html>
<head>
<title>Metamask authentication with Moralis in Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Next.js中使用Moralis的元掩码身份验证</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/metamask-authentication-with-moralis-in-next-js-33972b242b05?source=collection_archive---------5-----------------------#2021-12-03">https://medium.com/geekculture/metamask-authentication-with-moralis-in-next-js-33972b242b05?source=collection_archive---------5-----------------------#2021-12-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3cbb80c97905a45de0710f8b784d7aff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ctu1aEMQF3yO6kgRyazDYg.png"/></div></div></figure><p id="e705" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你没有生活在岩石下，你可能听说过Web 3.0！</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es jo"><img src="../Images/85cb40dcfef2005718b6ced535006deb.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*koW9nOO82-J1bq4Q.gif"/></div></figure><p id="f36b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">全栈最重要的部分之一是身份验证。因此，让我们看看如何在Next.js应用程序中授权用户使用他们的元掩码钱包。</p><p id="a03c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你不知道什么是metamask，那就去看看他们的<a class="ae jt" href="https://metamask.io/" rel="noopener ugc nofollow" target="_blank">网站</a></p><h1 id="3681" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">设置应用程序</h1><p id="83b6" class="pw-post-body-paragraph iq ir hi is b it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn hb bi translated"><strong class="is hj">创建新的下一个应用</strong></p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="3bdd" class="lc jv hi ky b fi ld le l lf lg">npx create-next-app next-metamask</span></pre><p id="5c52" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">导航至应用程序</strong></p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="8270" class="lc jv hi ky b fi ld le l lf lg">cd next-metamask</span></pre><p id="abff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">安装所需的依赖关系</strong></p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="6599" class="lc jv hi ky b fi ld le l lf lg">npm i <a class="ae jt" href="http://twitter.com/walletconnect/web3-provider" rel="noopener ugc nofollow" target="_blank">@walletconnect/web3-provider</a> moralis react-moralis # npm</span><span id="5e35" class="lc jv hi ky b fi lh le l lf lg">yarn add <a class="ae jt" href="http://twitter.com/walletconnect/web3-provider" rel="noopener ugc nofollow" target="_blank">@walletconnect/web3-provider</a> moralis react-moralis # yarn</span></pre><p id="0b90" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">启动服务器</strong></p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="4284" class="lc jv hi ky b fi ld le l lf lg">npm run dev # npm</span><span id="7d45" class="lc jv hi ky b fi lh le l lf lg">yarn dev # yarn</span></pre><h1 id="4d77" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">获取道德证书</h1><p id="80f1" class="pw-post-body-paragraph iq ir hi is b it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn hb bi translated">前往<a class="ae jt" href="https://moralis.io/" rel="noopener ugc nofollow" target="_blank"> moralis </a>并注册/登录。之后，点击创建新服务器并选择<code class="du li lj lk ky b">TestNet Server</code></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/e28d9683933e24e2ae728c5c492acbf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZMd7Qm879qVCC8vV"/></div></div></figure><p id="1aba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">选择它，你会看到一个弹出窗口。填写详细信息，并点击<code class="du li lj lk ky b">Add Instance</code>按钮。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/79e8aebfb193a46b0a7260104db89df5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CN57cg4pxcFieiuV"/></div></div></figure><p id="c8f7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">服务器创建完成后，点击<code class="du li lj lk ky b">view details</code></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/2ca7a6958767e93d2e37fb2edaccde36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AMEAKy93UPRZjS03"/></div></div></figure><p id="a694" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要服务器URL和应用程序ID</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/03011076521bee71e9c1779bdaf93d41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4OA4PUtVahK4jrWA"/></div></div></figure><h1 id="b90f" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">构建认证系统</h1><p id="e962" class="pw-post-body-paragraph iq ir hi is b it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn hb bi translated"><strong class="is hj">添加环境变量</strong></p><p id="d90f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在文件夹的根目录下创建一个<code class="du li lj lk ky b">.env.local</code>文件，并添加env变量，如下所示</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="66fd" class="lc jv hi ky b fi ld le l lf lg">NEXT_PUBLIC_MORALIS_APP_ID=&lt;app_id&gt;<br/>NEXT_PUBLIC_MORALIS_SERVER_ID=&lt;server_id&gt;</span></pre><p id="004a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您需要用从Moralis获得的凭证替换变量的值。</p><p id="30d9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">用道德供应商包装应用</strong></p><p id="5471" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">转到<code class="du li lj lk ky b">_app.js</code>,用道德提供者用env变量包装<code class="du li lj lk ky b">&lt;Component {...pageProps} /&gt;</code>,如下所示</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="af35" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在从react-moralis导入<code class="du li lj lk ky b">MoralisProvider</code></p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="411a" class="lc jv hi ky b fi ld le l lf lg">import { MoralisProvider } from "react-moralis";</span></pre><p id="f237" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">创建签到按钮</strong></p><p id="0baf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将在主页上创建登录按钮，你可以随意在任何你需要的页面上创建它。</p><p id="e4e1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从useMoralis钩子中获取authenticate函数-</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="5604" class="lc jv hi ky b fi ld le l lf lg">const { authenticate } = useMoralis();</span></pre><p id="f76e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您还需要从react-moralis导入钩子</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="8d08" class="lc jv hi ky b fi ld le l lf lg">import { useMoralis } from "react-moralis";</span></pre><p id="5d18" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建一个这样的按钮-</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="15c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，如果我们单击登录，将会打开登录的元掩码扩展。</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lr lq l"/></div></figure><p id="6f0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">如果用户已注销，则显示注销按钮</strong></p><p id="aa90" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要从像这样的<code class="du li lj lk ky b">useMoralis</code>钩子中得到更多的东西-</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="8ac4" class="lc jv hi ky b fi ld le l lf lg">const { authenticate, isAuthenticated, logout } = useMoralis();</span></pre><p id="e56a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建一个三元运算符来显示注销按钮，如果用户已登录，则显示登录按钮-</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="3b13" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们的登录和注销在🥳🥳正常工作</p><p id="e028" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">获取用户数据</strong></p><p id="7855" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看看如何获得一些基本数据，如他们的eth地址和用户名。</p><p id="f11d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当用户通过身份验证后，您可以添加这个片段来显示用户名和他们的地址wallet-</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="b139" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你还需要从<code class="du li lj lk ky b">useMoralis</code>钩子中获取用户-</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="327c" class="lc jv hi ky b fi ld le l lf lg">const { authenticate, isAuthenticated, logout, user } = useMoralis();</span></pre><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/2522476df226d9bba25004913e5f0319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gq1w27e6y98wb1K_"/></div></div></figure><p id="7c00" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用户名是非常随机的😂但它在某些情况下会有所帮助，eth地址可用于交易。</p><h1 id="91b8" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">签署</h1><p id="5373" class="pw-post-body-paragraph iq ir hi is b it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn hb bi translated">用moralis实现元掩码的身份验证很容易🤯</p><p id="dd7f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">希望你觉得这个教程有用，并继续关注更多的web 3.0教程✌️</p><p id="222b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jt" href="https://github.com/avneesh0612/metamask-next" rel="noopener ugc nofollow" target="_blank"> GitHub回购</a></p><p id="0d87" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jt" href="https://moralis.io/" rel="noopener ugc nofollow" target="_blank">道德家</a></p><p id="9ac2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jt" href="https://metamask.io/" rel="noopener ugc nofollow" target="_blank"> Metamask </a></p><p id="3ca6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jt" href="https://links.avneesh.tech/" rel="noopener ugc nofollow" target="_blank">和我联系</a></p></div></div>    
</body>
</html>