<html>
<head>
<title>How to Pass Errors Nicely to Front-End with Firebase Cloud Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Firebase云函数将错误很好地传递到前端</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-pass-errors-nicely-to-front-end-with-firebase-cloud-functions-6f224072eae4?source=collection_archive---------5-----------------------#2021-08-19">https://medium.com/geekculture/how-to-pass-errors-nicely-to-front-end-with-firebase-cloud-functions-6f224072eae4?source=collection_archive---------5-----------------------#2021-08-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/46376196764b753b62bc8baaf2f57bac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8AjJxczZK0tBxJ7M"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Photo by <a class="ae hv" href="https://unsplash.com/@jtylernix?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Tyler Nix</a> on <a class="ae hv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><div class=""><h2 id="d4a9" class="pw-subtitle-paragraph iv hx hy bd b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm dx translated">本文<strong class="ak">将向您展示如何</strong>通过后端向前端传递https错误。</h2></div><p id="de2c" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如何将错误从Firebase云函数传递到前端？</p><p id="8edd" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在本文中，我将介绍一个在基于云函数的项目中传递错误对象的技巧。它不会显著地改变你处理错误的方式，但是它不仅仅是好。</p><h1 id="8312" class="kj kk hy bd kl km kn ko kp kq kr ks kt je ku jf kv jh kw ji kx jk ky jl kz la bi translated">例子</h1><p id="9843" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">在这个例子中，我们在后端设置了一个API方法，而前端通过一个<code class="du lg lh li lj b">httpsCallable</code>函数与之通信。如果不熟悉，请参考这个<a class="ae hv" href="https://firebase.google.com/docs/functions/callable?hl=ja" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="9197" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在这个try-catch中，如果出现错误，函数会直接将错误传递给前端，而不是抛出它。</p><figure class="ll lm ln lo fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lk"><img src="../Images/9086ecf04599e4e37859499a38836cf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Txy1lJxM6PaeRL7VNAppUg.png"/></div></div></figure><p id="7193" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">由于错误对象被直接传递到前端，结果将是包含错误对象的数据对象。此处的错误描述了API文档中指定的原因。</p><figure class="ll lm ln lo fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lp"><img src="../Images/0858841c9b0fb5bba1a77378888c4edc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lr4EuyxPJtrcRyIV3tkKgA.png"/></div></div></figure><p id="e640" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">除此之外，如果你没有使用任何API，只是做一些承诺调用，那么一些错误可能会发生。你如何处理前端的这些错误？一个可能的解决方案是构建定制的错误代码来告诉前端错误的类型，比如<code class="du lg lh li lj b">invalid-argument</code>或<code class="du lg lh li lj b">aborted</code></p><p id="a332" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">因此可以将自定义错误代码注入到错误对象中。以上面的例子为例，它看起来像这样:</p><pre class="ll lm ln lo fd lq lj lr ls aw lt bi"><span id="101c" class="lu kk hy lj b fi lv lw l lx ly">return { error, code: "<!-- -->invalid-argument<!-- -->" }</span></pre><p id="da02" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">使用云函数，有内置的错误代码，随时可以从库中使用。您可以在try-catch中抛出<code class="du lg lh li lj b">HttpsError</code>而不是普通错误，在大多数情况下，您只需选择错误代码并抛出错误。您不需要编写自己的自定义代码。</p><p id="0363" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在这里，您将声明函数:</p><figure class="ll lm ln lo fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lz"><img src="../Images/3c7ca2862a4a4d8dea5f4e3a5f40984e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P8zxdKfQflw0cA0dRyXA3Q.png"/></div></div></figure><p id="d026" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">并且您可以访问许多错误代码。</p><figure class="ll lm ln lo fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ma"><img src="../Images/593d46c7934bc2dea1c59a169d41b04a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vBQ1ky-y_mA1YEfxFOYLKg.png"/></div></div></figure><p id="d741" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果您的项目可以使用错误代码列表，云函数的这一实用工具将显著节省您的时间。</p><p id="91ed" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">除了错误代码，您还可以添加消息和详细信息。</p><figure class="ll lm ln lo fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mb"><img src="../Images/474df033de9f16e0ec2687a3136fb428.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxAgalDOwKK8nmQC43TY3A.png"/></div></div></figure><p id="73f1" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这是从前端访问错误的方式。</p><figure class="ll lm ln lo fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mc"><img src="../Images/55e4bd59d9484758c5347f63d6f03089.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dR-X7J7DlHdeZ6u7Ex8EGg.png"/></div></div></figure><p id="a487" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">实际上什么都没有改变，但是如果你运行你的程序，你将会看到一个报错信息。</p><figure class="ll lm ln lo fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es md"><img src="../Images/9425e765bc7d51428152b47390498378.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tTyKOHs4zeEiRkAZUGf-fQ.png"/></div></div></figure><p id="e9dc" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">当我们仔细查看细节时，您可能想知道错误代码和细节去了哪里。该消息仅在控制台中可见。</p><p id="bd00" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">让我分享一下我最近发现的一个技巧。</p><figure class="ll lm ln lo fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es me"><img src="../Images/02ef9d047588434aa6b03a16af1f621c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bW1_Ij8ooX3Ax2HU8wOFmA.png"/></div></div></figure><p id="7ac4" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">当您通过编写<code class="du lg lh li lj b">JSON.parse(JSON.stringify(error))</code>解析json中的错误时，您会看到一个很酷的结果。</p><figure class="ll lm ln lo fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mf"><img src="../Images/c3003ebb0c53ae90e5a36096b76b08ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AlI5VA7F7rwUOLPXme2GWA.png"/></div></div></figure><p id="0538" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在一个对象出现在控制台中。它包含错误代码、消息和错误详细信息。现在，您可以更好、更恰当地处理错误。</p><h1 id="b866" class="kj kk hy bd kl km kn ko kp kq kr ks kt je ku jf kv jh kw ji kx jk ky jl kz la bi translated">结论</h1><p id="d3a1" class="pw-post-body-paragraph jn jo hy jp b jq lb iz js jt lc jc jv jw ld jy jz ka le kc kd ke lf kg kh ki hb bi translated">正如我们所见，云函数提供了一个方便的工具，它提供了内置的定制错误代码。不只是从后端返回一个错误，利用https error函数将帮助您创建一种干净的方式将错误传递到前端，而不会创建错误代码。</p></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><p id="984f" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><a class="ae hv" href="https://imryohei.medium.com/membership" rel="noopener"> <strong class="jp hz"> <em class="mn">使用此链接阅读</em> </strong> </a> <strong class="jp hz"> <em class="mn">我在Medium上的所有帖子和其他上千个帖子，您的会员费直接支持我和您阅读的其他作者。你也可以在媒体上看到所有的故事。</em>T9】</strong></p></div></div>    
</body>
</html>