<html>
<head>
<title>KubeStack-GitOps Made Fast!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">KubeStack-GitOps快速制作！</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/kubestack-gitops-made-fast-176ba9d49a96?source=collection_archive---------16-----------------------#2021-06-19">https://medium.com/geekculture/kubestack-gitops-made-fast-176ba9d49a96?source=collection_archive---------16-----------------------#2021-06-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="44e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个开源的GitOps框架。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/02f1d29dbfd5443e9639e8711e59084d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wNJm2MaqfZ0cFfIA"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Image by Author</figcaption></figure><h1 id="0343" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">介绍</h1><p id="145d" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">随着对云提供商依赖的增加，在容器中部署服务是当今的一个大话题。维护容器的过程可能很麻烦，这就是为什么我们使用像Kubernetes这样的容器编排器。AWS、Google和Azure将Kubernetes作为托管服务提供，但如果通过编码来完成，获得一个全功能的集群并在其背后创建一个GitOps工作流可能会很紧张。</p><p id="1659" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您曾经使用过Kubernetes，那么您一定遇到过从头开始反复部署应用程序的挑战。虽然舵图试图使它更容易，但他们并没有为此带来一个完美的自动化。如果存储在Git存储库中的配置在发生变化时自动部署，那会更好。多亏了KubeStack，这是一个新的开源框架，将帮助Kubernetes (K8s)用户建立基础设施自动化。在这篇文章中，我将根据我在使用这个框架时的经历给出我对这个框架的真实看法。</p><h1 id="09f7" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">了解KubeStack</h1><p id="ced3" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated"><a class="ae kw" href="https://www.kubestack.com/" rel="noopener ugc nofollow" target="_blank"> KubeStack </a>是一个GitOps框架，集成了Kustomize和Terraform，帮助团队构建基础设施自动化，让Kubernetes享受框架的好处。KubeStack框架与Terraform生态系统进行了本机集成。它维护了许多Terraform模块和一个用于集成Terraform和Kustomize的Terraform提供程序。</p><p id="d85e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">KubeStack附带了许多特性，这些特性使它不同于其他自动化框架。其中一些功能包括应用程序开发的高速率，提供经过测试的Terraform模块以供重用，以及为团队提供稳定的GitOps工作流。Kubestack还集成了领先的云提供商，如Azure、谷歌云平台和AWS(亚马逊网络服务)。它附带了用于云的Terraform提供程序来管理K8s集群。其中包括Azure的AKS，谷歌的GKE，亚马逊的EKS。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kx"><img src="../Images/895c2f927ab9ff83eb21a22fa36034df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*I34Gg_hU6S9F4qQ6"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Image Source: <a class="ae kw" href="http://www.dev.to" rel="noopener ugc nofollow" target="_blank">www.dev.to</a></figcaption></figure><p id="90da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">KubeStack附带了大量的文档，指导您如何安装和使用它。在下一节中，我将带您完成KubeStack的安装过程。我也将分享我在使用AWS云提供商测试Kubestack时的经验。</p><h1 id="df6a" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">安装KubeStack</h1><p id="a72e" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">让我带您了解安装KubeStack所需的3个步骤:</p><p id="1e85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一步:在当地发展</strong></p><p id="ed68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一步完全是本地的，不需要任何云资源。它让开发人员有机会在本地环境中尝试配置，以模拟实际的云配置。这个特性是KubeStack最伟大的元素之一。如果您正在使用多个环境，如开发、生产和QA，那么它会非常有用。</p><p id="ccb9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当执行一些配置任务时，您必须进行多次迭代才能正确完成。KubeStack的本地开发环境使您能够迭代将在生产环境中使用的相同结果。更好的是，它会随着更改自动更新，并立即给出反馈，而不必每次都等待CI/CD管道运行。</p><p id="a7fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">KubeStack的本地开发环境也有助于开发人员降低他们的云成本，因为他们不必与云提供商交互来识别和修复错误配置。这也意味着开发人员不必担心将变更部署到云时可能出现的错误。</p><p id="22cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用KinD(Docker中的Kubernetes)技术设置本地环境，其中Kubernetes节点作为Docker容器在本地运行。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ky"><img src="../Images/59a3c4055eed7528f954c48f5620aefa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2mcqx5QUFoOpNgVr"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Image by Author</figcaption></figure><p id="8b60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上面的图片来看，在初始阶段，我只花了175秒来构建我的本地配置。后续构建比初始构建花费的时间少得多。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kz"><img src="../Images/445af37b686419ae3c23f08a070e6577.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*km6q175rzwEclddN"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Image by Author</figcaption></figure><p id="72c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这说明KubeStack是一个快速高效的GitOps框架。</p><p id="b09b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤2:配置基础设施</strong></p><p id="e955" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您对Kubestack在本地开发阶段的表现感到满意，您可以将其转移到所选择的云提供商基础架构。你可以选择AWS，Azure，或者Google。</p><p id="4915" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一步骤包括:</p><ol class=""><li id="99b7" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lf lg lh li bi translated">设置身份验证。</li><li id="d5c9" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">设置远程状态。</li><li id="055e" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">引导您的基础设施。</li><li id="8b3a" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">正在设置DNS。</li></ol><p id="2a0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kubestack附带了一个特殊的容器，可用于引导云基础设施。该容器还可以轻松提供云提供商CLI工具等先决条件。</p><p id="154a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一步中，您必须创建一个GitOps存储库并设置身份验证方法。Terraform需要远程状态来运行CI/CD，因此，您也必须设置它。我创建了一个AWS S3存储桶，并配置了Terraform以将其用于远程状态。我还创建了两个工作区，即<em class="lo"> ops </em>和<em class="lo">app。</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/1260cf710e3ef2fd668beb789b3fb560.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ys0uJbqt0P1V2zf3"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Image by Author</figcaption></figure><p id="acfc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦完成了更改，您应该退出引导容器并将它们提交给git。</p><p id="4ab3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第三步:设置自动化</strong></p><p id="9ed2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一步包括通过添加管道和实现GitOps工作流来创建自动化流程。自动化流程包括:</p><ol class=""><li id="b2b1" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lf lg lh li bi translated">推动您的存储库。</li><li id="bc67" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">设置管道凭据。</li><li id="e295" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">添加管道文件。</li><li id="e3f9" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">遵循GitOps流程。</li></ol><p id="8539" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对我来说，遵循以上4个步骤很容易。我创建了一个新的存储库，然后将我的本地存储库放入其中。然后，我使用base64设置了管道凭证，并为GitOps流创建了管道。对我来说，添加、提交和推送管道很容易。</p><p id="cc52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我最终设法将更改推送到远程存储库，管道更改显示在一个pull请求之后。对我来说，在AWS中部署Kubernetes集群既简单又快捷。</p><p id="bc10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">KubeStack <a class="ae kw" href="https://www.kubestack.com/framework/documentation/tutorial-get-started" rel="noopener ugc nofollow" target="_blank">文档</a>提供了设置KubeStack所需的所有步骤和命令，我的工作就是跟进。还提供了管道文件。</p><h1 id="e9d3" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">库贝斯塔克:最后的想法</h1><p id="8863" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">我使用<a class="ae kw" href="https://www.kubestack.com/" rel="noopener ugc nofollow" target="_blank"> KubeStack </a>的体验很好。从本地开发到设置自动化，这一过程变得简单而快速。KubeStack在线文档上提供的步骤让我更加容易。通过将存储库设置为自动触发管道运行，您将节省大量执行部署所需的时间。我会向任何参与Kubernetes项目的个人推荐KubeStack。它会让你的工作更容易，更快！</p></div></div>    
</body>
</html>