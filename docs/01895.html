<html>
<head>
<title>Using WordPress as a Headless CMS with React/Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用React/Next.js将WordPress作为一个无头CMS</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/using-wordpress-as-a-headless-cms-with-react-next-js-c9b97bfc9ce2?source=collection_archive---------0-----------------------#2021-04-28">https://medium.com/geekculture/using-wordpress-as-a-headless-cms-with-react-next-js-c9b97bfc9ce2?source=collection_archive---------0-----------------------#2021-04-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7070" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">本文首发于</em> <a class="ae je" href="https://www.aeeiee.com/blog/2021/04/28/how-to-use-wordpress-as-a-headless-cms-with-react/" rel="noopener ugc nofollow" target="_blank"> <em class="jd"> Aeeiee博客</em> </a> <em class="jd">。</em></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/61ef3d2c9284b8ec77318eb018b296f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cl1XPAKj32XY6JXDl8kH4A.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx">WordPress as a Headless CMS with React</figcaption></figure><p id="d8f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae je" href="https://en.wikipedia.org/wiki/React_(JavaScript_library)" rel="noopener ugc nofollow" target="_blank"> React </a>，2013年在脸书创建的前端框架，拥有超过165，000个GitHub stars，现在是JavaScript开发人员最喜欢使用的前端框架之一。React是一个强大的框架，允许开发人员创建称为组件的可重用代码块，使用虚拟DOM来更新DOM元素——使web应用程序更具性能，并拥有庞大的库集合，使开发人员的生活更轻松。</p><p id="d22d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一方面，WordPress 是在React第一版发布的10年前创建的，这个强大的、功能丰富的框架至今仍然存在。WordPress仍然占据着超过40%的网络份额，而且不会很快消失。</p><p id="551f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将结合两个框架的力量，在前端使用React创建一个应用程序，将WordPress作为后端——或者更准确地说——作为支持我们应用程序的内容管理系统(CMS)。</p><h1 id="4649" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">先决条件</h1><p id="164b" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">要学习本教程，您需要具备以下基本知识</p><ul class=""><li id="42cb" class="ky kz hi ih b ii ij im in iq la iu lb iy lc jc ld le lf lg bi translated">JavaScript，特别是JSX</li><li id="ada9" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">命令行</li><li id="666b" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">飞轮控制的本地</li><li id="45bb" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">NPM</li><li id="379b" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">结节</li><li id="38e6" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">邮递员(可选)</li></ul><h1 id="d63d" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">设置后端</h1><p id="3bab" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">首先，我们将使用WordPress设置后端。对于这个例子，我们将使用飞轮的<a class="ae je" href="https://localwp.com/" rel="noopener ugc nofollow" target="_blank">本地设置后端。如果你需要在你的机器上设置本地的帮助，你可以参考这篇</a><a class="ae je" href="https://www.aeeiee.com/blog/2021/02/01/getting-started-with-local-by-flywheel/" rel="noopener ugc nofollow" target="_blank">博客文章</a>。</p><p id="2eca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用本地设置你的WordPress后端，在继续本指南之前，添加一些文章到你的WordPress后端。</p><p id="e881" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Postman向<a class="ae je" href="http://YOUR_SITE_NAME.local/wp-json/wp/v2/posts." rel="noopener ugc nofollow" target="_blank">http://YOUR _ SITE _ name . local/WP-JSON/WP/v2/posts发出请求。您应该会得到如下回复。</a></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es lm"><img src="../Images/eba332abbe3f87d5180fb0678e85dce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*W4dzjlWi20Hws4PJ.png"/></div></div></figure><p id="f2bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦您确认POSTS端点正在工作，我们就可以开始了！</p><p id="717b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以使用WordPress GUI在后台添加额外的文章，创建自定义的文章类型等。</p><h1 id="8518" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">设置前端</h1><p id="d908" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">接下来我们将使用<a class="ae je" href="https://github.com/vercel/next.js" rel="noopener ugc nofollow" target="_blank">构建这个应用程序的前端。JS </a>和<a class="ae je" href="http://tailwindcss.com" rel="noopener ugc nofollow" target="_blank"> TailwindCSS </a>(我一直最喜欢的CSS框架)。Next JS自带图像优化、路由、无服务器功能等开箱即用功能。毫不奇怪，该项目有超过64k GitHub明星。TailwindCSS是一个实用程序优先的框架，它为你在HTML中编写CSS提供了底层类。</p><p id="fd09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢天谢地，我们不需要从头开始。NextJS有一个简单的CLI快捷方式，它将为我们生成一个NextJS + TailwindCSS样板文件。</p><p id="96e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要运行下面的命令，请确保您已经在计算机上设置了节点和NPM。</p><p id="26e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ln lo lp lq b">yarn create next-app --example with-tailwindcss wordpress-react-app &amp;&amp; cd wordpress-react-app</code></p><p id="0e87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面命令末尾的wordpress-react-app行在名为wordpress-react-app的文件夹中生成示例文件。</p><p id="82da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装完成后，进入项目的根目录。在您的<strong class="ih hj"> constants.js </strong>文件中创建一个名为<strong class="ih hj"> lib &gt; constants.js. </strong>的文件夹，添加下面这段代码。用你网站的网址替换我们的网址。</p><pre class="jg jh ji jj fd lr lq ls lt aw lu bi"><span id="1887" class="lv jw hi lq b fi lw lx l ly lz">export const POSTS_API_URL = "http://YOUR_SITE_NAME.local/wp-json/wp/v2/posts"</span><span id="c6c1" class="lv jw hi lq b fi ma lx l ly lz">export const AUTHORS_API_URL = "http://YOUR_SITE_NAME.local/wp-json/wp/v2/users"</span><span id="4290" class="lv jw hi lq b fi ma lx l ly lz">export const MEDIA_API_URL = "http://YOUR_SITE_NAME.local/wp-json/wp/v2/media"</span></pre><h1 id="5807" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">在前端获取和显示帖子</h1><p id="1014" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">要向我们的后端WordPress服务器发出请求，我们可以使用JavaScript <a class="ae je" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" rel="noopener ugc nofollow" target="_blank"> Fetch API </a>或<a class="ae je" href="https://www.npmjs.com/package/axios" rel="noopener ugc nofollow" target="_blank"> Axios </a>。就个人而言，我更喜欢使用axios，因为我认为它的语法更简洁。</p><p id="3e51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还需要一个<a class="ae je" href="https://www.npmjs.com/package/html-react-parser" rel="noopener ugc nofollow" target="_blank"> HTML解析器</a>来帮助解析从WordPress服务器返回的HTML标签。</p><p id="2279" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们安装这两个包。</p><p id="e19e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ln lo lp lq b">yarn add axios html-react-parser</code></p><p id="564f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了使我们的代码更简洁，我们还将创建一些帮助器方法来处理对服务器的请求。在您的lib文件夹中，创建一个<strong class="ih hj"> utils.js </strong>文件。在这个文件中，我们将创建从服务器获取文章、作者和特色图片的方法。</p><p id="89bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，WordPress公开一个/post/[id]端点，为我们提供一篇文章的信息。这个端点将只给我们一个帖子的authorId和<strong class="ih hj"> featuredImageId </strong>，我们需要向<strong class="ih hj"> /author/[id] </strong>和<strong class="ih hj"> /media/[id] </strong>端点发出额外的请求，以获得关于帖子作者和特色图片的额外数据。</p><p id="f6e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加以下代码块。</p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="a885" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成后，进入<strong class="ih hj">页面&gt; index.js. </strong>这里，<strong class="ih hj"> </strong>我们将请求从我们的WordPress服务器获取所有的帖子，并将它们存储在React状态。</p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="3b6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，我们正在呈现一个<strong class="ih hj"> &lt; Post / &gt; </strong>组件，该组件接收getAllPostsFromServer函数返回的post <a class="ae je" href="https://reactjs.org/docs/components-and-props.html" rel="noopener ugc nofollow" target="_blank"> prop </a>。</p><p id="1fb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">让我们创建Post组件。</strong></p><p id="7822" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建一个名为<strong class="ih hj">组件的新文件夹。</strong>在该组件中创建一个名为<strong class="ih hj"> Post.js </strong>的文件。我们的post组件将接收一个包含媒体和作者id的Post对象，然后发出后续请求分别获取名称和url。</p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="fe15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，我们在帖子组件模板中构建了每个帖子的链接，即<strong class="ih hj"> /post/${post.id} </strong>。稍后，我们将创建一个从URL中提取id的页面，以便从我们的WordPress服务器中提取特定的帖子。</p><p id="cadb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您应该可以在登录页面上看到所有帖子。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es lm"><img src="../Images/40de98e27011902f483d26608f2657d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*E6E9ZqcvRo1_Vhah.png"/></div></div></figure><h1 id="6f77" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">显示单个帖子</h1><p id="8935" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">接下来，让我们显示单个帖子。NextJS有内置的路由，允许我们动态呈现页面和内容。你可以在Nextjs阅读更多关于<a class="ae je" href="https://nextjs.org/docs/routing/dynamic-routes" rel="noopener ugc nofollow" target="_blank">动态路线</a>的内容。我们将使用getStaticProps和getStaticPaths方法在构建时预先呈现页面。<a class="ae je" href="https://nextjs.org/docs/basic-features/data-fetching#getstaticprops-static-generation" rel="noopener ugc nofollow" target="_blank">此处阅读更多内容</a>。构建时预呈现页面意味着，当Nextjs构建和部署我们的站点时，每个帖子的页面会在同一时间即时创建。这确保了我们的网站在每次路线改变时加载速度很快，因为当用户试图导航到一个特定的帖子时，它不需要额外的旅行来从我们的WordPress服务器获取数据。</p><p id="2088" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们开始吧！</p><p id="5f56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在你的<strong class="ih hj"> pages </strong>文件夹中，创建一个名为<strong class="ih hj"> post </strong>的文件夹，并在其中创建一个名为<strong class="ih hj">id的文件。js </strong>。这将自动生成一条动态路线—<strong class="ih hj">/post/【postId】。js </strong>。然后，我们将从URL中提取id，并使用该id加载文章。</p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="cd2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要使用Nextjs公开的另外两个方法— <strong class="ih hj"> getStaticPaths </strong>和<strong class="ih hj"> getStaticProps </strong>。getStaticPaths 方法将在我们的站点被构建和编译时获取所有的postId。基于从这个方法返回的id，Nextjs将自动开始预渲染页面的过程，确保我们的站点保持快速！</p><p id="385d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们调用<strong class="ih hj"> getStaticProps </strong>方法。该方法将使用从getStaticPaths方法传递来的postId来获取post所需的所有额外参数。<strong class="ih hj"> getStaticProps </strong>然后将这些参数作为道具传递给我们的前端。</p><p id="b6df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随着所有服务器端工作的完成，我们现在可以像上面开始的那样完成渲染特定帖子的代码编写了。</p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="0a9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成后，我们现在可以测试一切正常！</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es md"><img src="../Images/92e1743983c2c79812d9a5ecfa7476fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*ZoqFMrnWnJUDP0vf.gif"/></div></figure><p id="330a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在这里看到完整的代码<a class="ae je" href="https://github.com/Aeeiee-Team/wordpress-nextjs" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>