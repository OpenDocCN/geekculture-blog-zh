<html>
<head>
<title>Fuzzing File Uploads With Burp Intruder</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模糊文件上传与打嗝入侵者</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/fuzzing-file-uploads-with-burp-intruder-3482a10a32d5?source=collection_archive---------10-----------------------#2021-07-21">https://medium.com/geekculture/fuzzing-file-uploads-with-burp-intruder-3482a10a32d5?source=collection_archive---------10-----------------------#2021-07-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="89a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于各种原因，应用程序和网站通常需要允许用户上传文件。有时用户需要上传任意文件，比如像<a class="ae jd" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank"> S3 </a>这样的文件绑定服务，但大多数时候，服务期待的是特定类型的文件。你的银行可能想要你的护照照片，用于<a class="ae jd" href="https://www.investopedia.com/terms/k/knowyourclient.asp" rel="noopener ugc nofollow" target="_blank"> KYC </a>的目的，<a class="ae jd" href="https://www.tiktok.com" rel="noopener ugc nofollow" target="_blank">抖音</a>想要一个视频等等。无限制的文件上传会给web应用程序带来风险，包括完全系统接管、向后端系统转发攻击或客户端攻击。上传的文件会导致<a class="ae jd" href="https://www.reuters.com/technology/hackers-demand-70-million-liberate-data-held-by-companies-hit-mass-cyberattack-2021-07-05/" rel="noopener ugc nofollow" target="_blank">严重的问题</a>。</p><p id="8d32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在服务需要特定类型的文件的情况下，最好根据预期的文件类型来验证文件的神奇字节。</p><h2 id="4825" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">神奇的字节</h2><p id="5ca7" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">文件格式有时会在每个文件的开头指定几个字节。这使得程序能够识别它们。例如，Windows PE可执行文件(<code class="du ke kf kg kh b">.exe</code>文件)以字节序列<code class="du ke kf kg kh b">4D 5A</code> ( <code class="du ke kf kg kh b">MZ</code>)开始</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ki"><img src="../Images/2d29ecf5cbc6e07f1730b734cc9f9df2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cAcj8nSKjKVCiAE59Pelcw.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx">Magic Bytes at the start of a Windows executable shown in a hex editor (<a class="ae jd" href="http://hexfiend.com" rel="noopener ugc nofollow" target="_blank">Hex Fiend</a>).</figcaption></figure><p id="46a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了防止上传恶意文件，web应用程序应该对照预期的文件类型检查文件的前几个字节。维基百科上有一个常见文件类型的神奇字节列表。</p><p id="7b15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些神奇的字节使得通过生成包含对应于不同类型的文件头的合成文件来快速测试允许的文件类型成为可能。我已经创建了一个工具，<a class="ae jd" rel="noopener" href="/swlh/hacking-http-with-httpfuzz-67cfd061b616"> HTTPFuzz </a>可以做到这一点，但是我更喜欢呆在Burp Suite中，而不是切换到CLI窗口。我创建了<a class="ae jd" href="https://github.com/JonCooperWorks/burp-filefuzzer" rel="noopener ugc nofollow" target="_blank">文件生成器扩展</a>来实现这一点。</p><h2 id="1bf0" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">安装文件模糊器</h2><p id="aff5" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">可以通过Burp Suite中的Extender选项卡手动安装文件模糊器。它还没有在BApp商店上架，因为我想对它进行更多的测试，但我在网络渗透测试中使用它没有问题。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ky"><img src="../Images/9404c5f0e690765b22e187efbd8254a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7TAQqQX9nQIJLL2j3HSQeg.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx">Install File Fuzzer through the JAR</figcaption></figure><p id="f485" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">文件Fuzzer JAR在<a class="ae jd" href="https://github.com/JonCooperWorks/burp-filefuzzer/releases" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。最好下载最新版本，在撰写本文时是<code class="du ke kf kg kh b">0.0.2-alpha</code>。只需通过Burp Extender选项卡安装即可。</p><h2 id="8230" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">使用文件模糊器测试文件上传</h2><p id="2306" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">打嗝文件Fuzzer将产生不同类型的合成文件。它提供了三个有效负载生成器:一个生成文件，一个生成MIME类型，一个生成文件名。</p><p id="95fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它应该在Pitchfork模式下使用，注入点放在文件和文件名上。这将导致Burp文件Fuzzer生成合成文件和适当的文件名和MIME类型。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es kz"><img src="../Images/8677da330930af7a2e6af3a4df4fab24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CBR1JMgUUyTDre0P.png"/></div></div></figure><p id="1852" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据文件名和文件内容的位置设置有效载荷集。文件名通常位于多部分请求的第一位。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es la"><img src="../Images/a66385036484dce10560ca2c865d795c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3HBCwA4OWc_Gs7ol.png"/></div></div></figure><p id="53b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">文件名、MIME类型和合成文件的有效载荷应该是分别由文件名生成器、文件MIME类型生成器和文件生成器生成的扩展名。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lb"><img src="../Images/88b7a38499c674f5b013ef2612ef57c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ztVCLYwdE7-4vrNr.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx">Payload Generators included with File Fuzzer</figcaption></figure><p id="e465" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了获得最佳效果，禁用文件名和MIME类型的URL编码，以防止文件名中的<code class="du ke kf kg kh b">.</code>和MIME类型中的<code class="du ke kf kg kh b">/</code>被URL编码。</p><p id="676e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">配置攻击后，只需开始攻击，如果需要，Burp入侵者将生成有效载荷、文件名和MIME类型。随着时间的推移，我会添加更多的类型，但是您可以通过将它们添加到<a class="ae jd" href="https://github.com/JonCooperWorks/burp-filefuzzer/blob/master/src/main/java/FileTypes.kt" rel="noopener ugc nofollow" target="_blank"> FileTypes.kt </a>中的<code class="du ke kf kg kh b">fileHeaders</code>来添加对其他文件类型的支持。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lc"><img src="../Images/7c96871134ef730f11cc3aa906215901.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dHeDCb-brhjTsCvbw2snCg.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx">File Generator generating synthetic files with appropriate filenames</figcaption></figure><p id="b6c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">文件生成器将添加一个标签到Burp的用户界面，允许您设置上传文件的有效载荷大小和基本文件名。如果不设置大小，它将默认为1024字节(1 KB)。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ld"><img src="../Images/3bba6189b5fe9ffd4aa0a153b6594f58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GIE6ebako4u53Fpk.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx">File Generator UI tab that will generate 1024 byte large files named payload.exe, payload.jpg.php, etc.</figcaption></figure><h2 id="e905" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">获取文件模糊器</h2><p id="d3de" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">File Fuzzer是开源的，代码在<a class="ae jd" href="https://github.com/JonCooperWorks/burp-filefuzzer" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。你可以在<a class="ae jd" href="https://github.com/JonCooperWorks/burp-filefuzzer/releases" rel="noopener ugc nofollow" target="_blank">发布页面</a>上获得一个预构建的JAR。它目前处于alpha阶段，但一旦经过更多人的测试，我会将它添加到BApp商店中。我用这个扩展让我的网页测试生活变得更简单。</p></div></div>    
</body>
</html>