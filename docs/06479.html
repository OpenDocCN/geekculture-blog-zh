<html>
<head>
<title>Virtual Hand Cricket Game using OpenCV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OpenCV的虚拟手板球游戏</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/virtual-hand-cricket-game-using-opencv-442f71c6961?source=collection_archive---------6-----------------------#2021-08-21">https://medium.com/geekculture/virtual-hand-cricket-game-using-opencv-442f71c6961?source=collection_archive---------6-----------------------#2021-08-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/48d06f4d28fb4039a39251aeee58ddda.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/0*F-cn3WDO3W7D1Gew"/></div><figcaption class="im in et er es io ip bd b be z dx">Screenshot from the game</figcaption></figure><p id="842a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用OpenCV和机器学习技术实现的虚拟手板球游戏，使玩家能够通过机器人虚拟地重新体验游戏。</p><h1 id="f450" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">目标:</h1><p id="a854" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">小时候，我们很多人都是和朋友一起玩板球长大的，玩得很开心！在社交距离的时候，我觉得虚拟地玩游戏会很有趣。因此我选择OpenCV来实现这个游戏。</p><p id="0b3e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个游戏中，你有<strong class="is hj">玩家(或用户)</strong>和<strong class="is hj">机器人</strong>。该模型将识别玩家显示的数字，机器人将随机生成一个数字。当玩家和机器人打出相同的数字时，击球的用户将出局，另一方试图击败他们。</p><h1 id="d95f" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak"> OpenCV </strong></h1><p id="c7c0" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated"><strong class="is hj"> OpenCV </strong>(开源计算机视觉库)是一个开源的计算机视觉和机器学习软件库。<strong class="is hj"> OpenCV </strong>旨在为计算机视觉应用提供一个公共基础设施，并加速机器感知在商业产品中的<strong class="is hj">使用</strong>。</p><h1 id="5395" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">导入库</h1><ul class=""><li id="4fd4" class="kr ks hi is b it km ix kn jb kt jf ku jj kv jn kw kx ky kz bi translated"><strong class="is hj">cv2:</strong>OpenCV【pip安装OpenCV】</li><li id="7060" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><strong class="is hj"> numpy: </strong>用于处理数组以及数学[pip安装numpy]</li><li id="2f5c" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><strong class="is hj">imutils:</strong>便捷功能，使用OpenCV[pip install imutils]使基本的图像处理功能，如平移、旋转、调整大小变得更加容易</li></ul><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="61bb" class="lo jp hi lk b fi lp lq l lr ls">import cv2 as cv<br/>import numpy as np<br/>import imutils</span></pre><h1 id="9e6a" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">设置初始玩家和机器人分数</strong></h1><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="b6e5" class="lo jp hi lk b fi lp lq l lr ls">player_score = 0 <br/>bot_score = 0 <br/>player = False<br/>bot = True <br/>player_status = False<br/>bot_status = False<br/>Game_status = “Player Begins”<br/>def check_status(player_score, bot_score): <br/>  if player_score &gt; bot_score: <br/>    print(‘* * * Player wins * * *’) <br/>  else: <br/>    print(‘* * * Bot wins * * *’)</span></pre><h1 id="fc84" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">检测玩家的手指/分数</h1><p id="8d6e" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">为了计算玩家的分数，我们将使用OpenCV来检测视频显示过程中的手指数量。我们使用轮廓、遮罩、凸包和缺陷检测来识别它们。</p><h2 id="2b5d" class="lo jp hi bd jq lt lu lv ju lw lx ly jy jb lz ma kc jf mb mc kg jj md me kk mf bi translated">面具</h2><ul class=""><li id="854e" class="kr ks hi is b it km ix kn jb kt jf ku jj kv jn kw kx ky kz bi translated"><strong class="is hj"> hsv </strong>:将BGR(蓝、绿、红)图像更改为hsv(色相、饱和度、明度)。</li><li id="8d71" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><strong class="is hj">lower _ skin</strong>:HSV中较低的肤色范围。</li><li id="9cc0" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><strong class="is hj">upper _ skin</strong>:HSV中皮肤颜色的上限。</li><li id="42d2" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><strong class="is hj">遮罩:</strong>在HSV色彩空间的上下像素值范围内检测皮肤。</li><li id="c52f" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><strong class="is hj">模糊</strong>:模糊图像以改善遮蔽</li></ul><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="7e6e" class="lo jp hi lk b fi lp lq l lr ls">hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)<br/>lower_skin = np.array([0, 20, 80], dtype=np.uint8)            upper_skin = np.array([20,255,255], dtype=np.uint8)<br/>mask = cv2.inRange(hsv, lower_skin, upper_skin)</span><span id="938a" class="lo jp hi lk b fi mg lq l lr ls">mask = cv2.dilate(mask,kernel,iterations = 4)                        <br/>mask = cv2.GaussianBlur(mask,(5,5),100).</span></pre><h2 id="cad0" class="lo jp hi bd jq lt lu lv ju lw lx ly jy jb lz ma kc jf mb mc kg jj md me kk mf bi translated">轮廓</h2><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="1dc6" class="lo jp hi lk b fi lp lq l lr ls">contours,hierarchy= cv2.findContours(mask,cv2.RETR_TREE,cv2.CHAIN_APPROX_SIMPLE)                          if len(contours) &gt; 0:                <br/>  areas = [cv2.contourArea(c) for c in contours]<br/>  max_index = np.argmax(areas)                <br/>  cnt = contours[max_index]<br/>epsilon = 0.0005*cv2.arcLength(cnt,True)            <br/>approx= cv2.approxPolyDP(cnt,epsilon,True)</span></pre><p id="444c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在确定了最大面积并在手上画出轮廓后，我们对其进行近似以得到更精确的轮廓。</p><h2 id="d8a1" class="lo jp hi bd jq lt lu lv ju lw lx ly jy jb lz ma kc jf mb mc kg jj md me kk mf bi translated">凸包</h2><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="d310" class="lo jp hi lk b fi lp lq l lr ls">hull = cv2.convexHull(cnt)<br/>areahull = cv2.contourArea(hull)            <br/>areacnt = cv2.contourArea(cnt)</span></pre><h2 id="6b6a" class="lo jp hi bd jq lt lu lv ju lw lx ly jy jb lz ma kc jf mb mc kg jj md me kk mf bi translated">计数缺陷(手指)</h2><p id="4dcc" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">根据我们已经形成的凸包，我们要识别缺陷。缺陷是属于凸包而不是轮廓的点。</p><figure class="lf lg lh li fd ij er es paragraph-image"><div class="er es mh"><img src="../Images/645a420f139e32affae3213d93cbfd80.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/0*puEAfeFxP8F9svr9.png"/></div><figcaption class="im in et er es io ip bd b be z dx">Defects explained, image from: <a class="ae mi" rel="noopener" href="/analytics-vidhya/hand-detection-and-finger-counting-using-opencv-python-5b594704eb08">https://medium.com/analytics-vidhya/hand-detection-and-finger-counting-using-opencv-python-5b594704eb08</a></figcaption></figure><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="9eba" class="lo jp hi lk b fi lp lq l lr ls">hull = cv2.convexHull(approx, returnPoints=False)          <br/>defects = cv2.convexityDefects(approx, hull)</span></pre><p id="dabc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">计数缺陷:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="3125" class="lo jp hi lk b fi lp lq l lr ls">#code for finding no. of defects due to fingers            <br/>for i in range(defects.shape[0]):               <br/> s,e,f,d = defects[i,0]                <br/> start = tuple(approx[s][0])                <br/> end = tuple(approx[e][0])                <br/> far = tuple(approx[f][0])                                </span></pre><h1 id="8164" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">余弦定理</h1><p id="9ee7" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我们用余弦定理计算了手指的数量。</p><p id="ffb4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在三角学中，余弦定律将三角形边的长度与其中一个角的余弦联系起来。</p><p id="832c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">公式</strong></p><figure class="lf lg lh li fd ij er es paragraph-image"><div class="er es mj"><img src="../Images/d0a08a02756ee3734282d244e91ace79.png" data-original-src="https://miro.medium.com/v2/resize:fit:60/0*epSd7qW1bQJtj_Rz"/></div></figure><figure class="lf lg lh li fd ij er es paragraph-image"><div class="er es mk"><img src="../Images/038f4f01c5cfb56011a8352fdc29211e.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/0*b6vI1cV1fVMg5kFR.png"/></div></figure><p id="4b85" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用这个定理和OpenCV的凸性缺陷，我们正在检测和计数手指。凸度缺陷返回一个数组，其中每行包含以下值:起点、终点、最远点和到最远点的近似距离。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="b542" class="lo jp hi lk b fi lp lq l lr ls"># find length of all sides of triangle                <br/> a = math.sqrt((end[0] - start[0])**2 + (end[1] - start[1])**2)       <br/> b= math.sqrt((far[0] - start[0])**2 + (far[1] - start[1])**2)                 <br/> c = math.sqrt((end[0] - far[0])**2 + (end[1] - far[1])**2)                                # apply cosine rule here                <br/> angle = math.acos((b**2 + c**2 - a**2)/(2*b*c)) * 57</span><span id="f6ca" class="lo jp hi lk b fi mg lq l lr ls">if angle &lt;= 90:                    <br/>  count_defect += 1                    <br/>  cv2.circle(img, far, 5, (255,0,0), -1)</span><span id="5bc5" class="lo jp hi lk b fi mg lq l lr ls">#draw lines around hand                <br/>cv2.line(img,start, end, (255,0,0), 3)                                                  </span></pre><figure class="lf lg lh li fd ij er es paragraph-image"><div class="er es ml"><img src="../Images/399804fd13829d2833998278573e1834.png" data-original-src="https://miro.medium.com/v2/resize:fit:250/format:webp/1*iIZdn-odENhHfNpITRK6KQ.png"/></div><figcaption class="im in et er es io ip bd b be z dx">Finding defects using Cosine Theorem</figcaption></figure><p id="c131" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，将缺陷数+ 1赋予玩家的分数</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="d5f0" class="lo jp hi lk b fi lp lq l lr ls">count_defect += 1<br/><strong class="lk hj">player_num = count_defect</strong></span></pre><h2 id="5061" class="lo jp hi bd jq lt lu lv ju lw lx ly jy jb lz ma kc jf mb mc kg jj md me kk mf bi translated">计算机器人得分并显示</h2><p id="d815" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">当玩家没有击球时，将随机函数分配给机器人得分，并比较得分和显示。</p><p id="e34c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果玩家先击球，将玩家在每次迭代中的得分相加。</p><figure class="lf lg lh li fd ij er es paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="er es mm"><img src="../Images/913287661abbd94608ab6982ded4574a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*krYC2ozBTFgvK82kKGyaxw.png"/></div></div></figure><p id="7f9f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">否则，相应地更新机器人分数。</p><figure class="lf lg lh li fd ij er es paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="er es mr"><img src="../Images/d1ca7ff22a849df353dbb334abba4f29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cGJ1rGXZEg77hljJxjeUhw.png"/></div></div></figure><figure class="lf lg lh li fd ij er es paragraph-image"><div class="er es ms"><img src="../Images/e88e115b17c64602ccf5b57a62cccc63.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*i_r4OkdBCywBSgpdKDbDlA.png"/></div><figcaption class="im in et er es io ip bd b be z dx">Score Display</figcaption></figure><h1 id="bb8a" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">烧瓶API</h1><p id="6547" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">要将模型连接到烧瓶，有3个步骤:</p><ol class=""><li id="f642" class="kr ks hi is b it iu ix iy jb mt jf mu jj mv jn mw kx ky kz bi translated">添加摄像机功能</li></ol><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="f04f" class="lo jp hi lk b fi lp lq l lr ls">class VideoCamera(object):<br/>   def __init__(cap):        <br/>#real time video capture        <br/>      cap.video = cv2.VideoCapture(0, cv2.CAP_DSHOW)    <br/>   def __del__(cap):        <br/>      cap.video.release()            <br/>   def get_frame(cap):        <br/>      try:</span></pre><p id="099a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.App.py</p><p id="d291" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将VideoCamera函数的输出添加到flask app route函数，并导入必要的请求。</p><figure class="lf lg lh li fd ij er es paragraph-image"><div class="er es mx"><img src="../Images/f941e6157ea4e10eba3b0a9b57abf232.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*RCjo1Nv3NVHwpVYv9UdRjQ.png"/></div></figure><p id="81b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.index.html</p><p id="7077" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建一个模板文件夹，并添加一个内容相似的index.html文件。将函数中的视频提要作为图像标签添加到HTML中。如果你想在HTML页面上添加更多的细节。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="48be" class="lo jp hi lk b fi lp lq l lr ls">&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;Hand Cricket API&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;h1&gt;Hand Cricket API&lt;/h1&gt;<br/>    &lt;img id="bg" src="{{ url_for('game') }}"&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><figure class="lf lg lh li fd ij er es paragraph-image"><div class="er es my"><img src="../Images/892cfbc6f1869d0ec024f97ac69030cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/0*TczHzWGu3CnWtym_"/></div><figcaption class="im in et er es io ip bd b be z dx">API- Score Display During a Game</figcaption></figure><p id="b2cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">也可以查看我的<strong class="is hj"> GitHub仓库</strong>中的全部代码，并开始回购:【https://github.com/HarshiniR4/Virtual-Hand-Cricket】T2</p><p id="926b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">如果你喜欢这个博客，请留下你的星星！</strong></p><h2 id="1579" class="lo jp hi bd jq lt lu lv ju lw lx ly jy jb lz ma kc jf mb mc kg jj md me kk mf bi translated">编码快乐！</h2><p id="f25e" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated"><strong class="is hj">参考文献:</strong></p><ul class=""><li id="e897" class="kr ks hi is b it iu ix iy jb mt jf mu jj mv jn kw kx ky kz bi translated"><a class="ae mi" rel="noopener" href="/analytics-vidhya/hand-detection-and-finger-counting-using-opencv-python-5b594704eb08">https://medium . com/analytics-vid hya/hand-detection-and-finger-counting-using-opencv-python-5b 594704 EB 08</a></li><li id="fee3" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><a class="ae mi" href="https://github.com/HarshDave0/OpenCV-hand-gesture-Cricket" rel="noopener ugc nofollow" target="_blank">https://github.com/HarshDave0/OpenCV-hand-gesture-Cricket</a></li><li id="f3a9" class="kr ks hi is b it la ix lb jb lc jf ld jj le jn kw kx ky kz bi translated"><a class="ae mi" href="https://github.com/desertfury/flask-opencv-streaming" rel="noopener ugc nofollow" target="_blank">https://github.com/desertfury/flask-opencv-streaming</a></li></ul></div></div>    
</body>
</html>