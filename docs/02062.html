<html>
<head>
<title>Custom Security Manager for Apache Superset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apache超集的自定义安全管理器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/custom-security-manager-for-apache-superset-c91f413a8be7?source=collection_archive---------5-----------------------#2021-05-03">https://medium.com/geekculture/custom-security-manager-for-apache-superset-c91f413a8be7?source=collection_archive---------5-----------------------#2021-05-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/0f284ad59365652a27fa617e605f7906.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FLOeu9LLhE_KbccC"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@tabrez_syed?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Tabrez Syed</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="dac1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2021年4月，Apache超集社区<a class="ae iu" href="https://github.com/apache/superset/tree/master/RELEASING/release-notes-1-1" rel="noopener ugc nofollow" target="_blank">发布了版本1.1.0 </a>，它为我们带来了更强大的可视化、更简单的安装和许多错误修复。超集在商业智能(BI)工具领域变得越来越流行。越来越多的公司决定使用Superset作为他们的主要BI系统，并希望了解其安全架构。<em class="jt">认证是安全子系统中最重要的部分之一。</em>那么，默认情况下，超集中有哪些选项？</p><p id="7860" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">超集建立在<a class="ae iu" href="https://github.com/dpgaspar/Flask-AppBuilder" rel="noopener ugc nofollow" target="_blank"> Flask App builder </a> (FAB)之上。它有许多内置的认证方法。最好使用其中一个，因为它很可能会满足您的需求，并且由社区维护良好:</p><ul class=""><li id="8a4b" class="ju jv hi ix b iy iz jc jd jg jw jk jx jo jy js jz ka kb kc bi translated"><strong class="ix hj">数据库</strong> —从数据库中查询要匹配的用户名和密码样式。密码在数据库中保持散列。</li><li id="f9b8" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><strong class="ix hj">开放ID </strong> —使用用户的电子邮件字段在Gmail、Yahoo等上进行认证。</li><li id="5442" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><strong class="ix hj"> LDAP </strong> —针对LDAP服务器的身份验证，如Microsoft Active Directory。</li><li id="800e" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><strong class="ix hj"> REMOTE_USER </strong> —当服务器(Apache、Nginx)被配置为使用kerberos时，web服务器负责对用户进行身份验证，这对于内部网站点非常有用。</li><li id="daf0" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><strong class="ix hj"> OAUTH </strong> —使用OAUTH (v1或v2)进行认证。</li></ul><p id="c01b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如您所见，默认情况下，您可以使用许多选项进行安装。但是许多并不意味着全部，对吗？在本文中，我们将介绍创建Apache超集<em class="jt">自定义安全管理器</em>所需的接下来三个简单步骤，这将有助于理解如果默认超集(FAB)选项不能满足我们的需求，该怎么办。</p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="507b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，创建一个新文件<strong class="ix hj"> my_security_manager.py，</strong>并把它放在你的<strong class="ix hj"> PYTHONPATH </strong>目录下。未来的超集定制将有一个基础。将这些行添加到文件中:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="b352" class="ky kz hi ku b fi la lb l lc ld">from superset.security import SupersetSecurityManager</span><span id="5320" class="ky kz hi ku b fi le lb l lc ld"><br/>class MySecurityManager(SupersetSecurityManager):</span><span id="c87a" class="ky kz hi ku b fi le lb l lc ld">    def __init__(self, appbuilder):<br/>        super(MySecurityManager, self).__init__(appbuilder)</span></pre><p id="e486" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">其次，您应该让Superset知道您想要使用全新的安全管理器。为此，请将这些行添加到超集配置文件(superset_config.py)中:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="41a0" class="ky kz hi ku b fi la lb l lc ld">from my_security_manager import MySecurityManager<br/>CUSTOM_SECURITY_MANAGER = MySecurityManager</span></pre><p id="a3ef" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第三，将这一行放到您的<strong class="ix hj"> Dockerfile </strong>中，以便在运行之前将您的自定义设置和新的安全管理器复制到容器中:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="98d9" class="ky kz hi ku b fi la lb l lc ld">COPY my_security_manager.py /app/pythonpath</span></pre><p id="d482" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就是这样！重新构建你的Docker容器，并转到Superset来检查它是否正常工作。</p><p id="7114" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您可以以任何方式扩展您的安全管理器。太神奇了！假设您想要为登录页面创建自己的视图。为此，您可以覆盖MySecurityManager类的<strong class="ix hj"> authdbview </strong>属性。你可以以<a class="ae iu" href="https://github.com/dpgaspar/Flask-AppBuilder/blob/0525e549ef7170f5623af4244f61991ad19bc215/flask_appbuilder/security/views.py#L483" rel="noopener ugc nofollow" target="_blank">这个原始视图代码</a>为例，对其进行扩展。或者，您可能想要创建不同的认证逻辑，例如多域LDAP或SMS网关。您可以覆盖MySecurityManager类的<strong class="ix hj"> auth_user_db() </strong>方法，或者创建一个新方法。对于您自己的身份验证视图，不要忘记在您自己的视图实现中使用它。这里是<a class="ae iu" href="https://github.com/dpgaspar/Flask-AppBuilder/blob/0525e549ef7170f5623af4244f61991ad19bc215/flask_appbuilder/security/manager.py#L821" rel="noopener ugc nofollow" target="_blank">方法</a>的原代码，供参考。</p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><p id="ac38" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">希望你喜欢阅读这篇文章。请关注我的<a class="ae iu" rel="noopener" href="/@agordienko">媒体</a>、<a class="ae iu" href="https://github.com/aleksandrgordienko" rel="noopener ugc nofollow" target="_blank"> GitHub </a>、<a class="ae iu" href="https://twitter.com/data_diving" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae iu" href="https://www.linkedin.com/in/aleksandrgordienko/?lipi=urn%3Ali%3Apage%3Ad_flagship3_feed%3BBS0l2fduQoWolGSffxn%2F1w%3D%3D" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>。</p><p id="cd14" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请阅读前一篇文章中<a class="ae iu" rel="noopener" href="/geekculture/run-apache-superset-locally-in-10-minutes-30bc70ed808c">关于在Docker容器中运行超集的附加信息。</a></p></div></div>    
</body>
</html>