<html>
<head>
<title>My Welcome back to Flutter App work#2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">欢迎回到Flutter应用程序工作#2</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/my-welcome-back-to-flutter-app-work-2-4b851d9ecbbb?source=collection_archive---------25-----------------------#2021-08-04">https://medium.com/geekculture/my-welcome-back-to-flutter-app-work-2-4b851d9ecbbb?source=collection_archive---------25-----------------------#2021-08-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c790c48232a1281d580d775bab148359.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*u77a9QO03UbH8NOj.jpg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">image from morioh.com</figcaption></figure><p id="ba0c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这篇文章是我之前写的关于同一主题的<a class="ae js" rel="noopener" href="/geekculture/my-welcome-back-to-flutter-app-work-1-ec26dec8e4cb"> <strong class="iw hj">文章</strong> </a>的延续。如果你还没有读过，请继续读一读，这样你就可以理解这篇文章了。<br/>无论您是开发简单的应用程序，还是构建梦想中的应用程序，身份验证都可以帮助您利用用户特定信息实现个性化体验。这也是隐私和安全的重要组成部分。</p><blockquote class="jt ju jv"><p id="4ffb" class="iu iv jw iw b ix iy iz ja jb jc jd je jx jg jh ji jy jk jl jm jz jo jp jq jr hb bi translated">🤔你知道吗？</p><p id="de40" class="iu iv jw iw b ix iy iz ja jb jc jd je jx jg jh ji jy jk jl jm jz jo jp jq jr hb bi translated">Firebase Authentication是一种预先配置的后端服务，可以使用SDK轻松集成移动应用程序。您不必为身份验证过程维护任何后端基础设施。Firebase支持与流行的身份提供商集成，如Google、脸书、Twitter和GitHub。</p></blockquote><p id="dbf3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在本文中，我们将在我们的flutter应用程序中集成使用Firebase的身份验证。</p><blockquote class="jt ju jv"><p id="3442" class="iu iv jw iw b ix iy iz ja jb jc jd je jx jg jh ji jy jk jl jm jz jo jp jq jr hb bi translated">让我们建立火力基地。</p></blockquote><p id="04fe" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">步骤1:创建Firebase项目<br/>要将Firebase与Flutter项目集成，我们必须在控制台创建一个新的Firebase项目。然后，添加一个新项目，并给它起个名字(最好是你的flutter项目的名字)。创建完成后，您将被引导至Firebase项目仪表板，如下图所示。虽然，我已经添加了一个Firebase项目显示在图片中。</p><figure class="kb kc kd ke fd ij er es paragraph-image"><div class="er es ka"><img src="../Images/25c074c9039a53526eb4e78cad58846a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*SvsJthyFX2KxFvV5DCaUMg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">firebase dashboard</figcaption></figure><p id="1dc0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">第二步:为Android和iOS设置Firebase</p><p id="f685" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要在Android或iOS上使用Firebase，你必须为每个平台完成一些配置。请参见下面的完整配置指南:</p><ul class=""><li id="9749" class="kf kg hi iw b ix iy jb jc jf kh jj ki jn kj jr kk kl km kn bi translated"><a class="ae js" href="https://firebase.flutter.dev/docs/installation/android" rel="noopener ugc nofollow" target="_blank">安卓安装</a></li><li id="3009" class="kf kg hi iw b ix ko jb kp jf kq jj kr jn ks jr kk kl km kn bi translated"><a class="ae js" href="https://firebase.flutter.dev/docs/installation/ios" rel="noopener ugc nofollow" target="_blank"> iOS安装</a></li></ul><p id="7959" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们已经有了使用Firebase的基本设置，让我们开始研究我们的Flutter应用程序。</p><p id="a66f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">添加Firebase插件</strong></p><p id="f4ae" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在您的<code class="du kt ku kv kw b">pubspec.yaml</code>中，添加以下插件:</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="5fae" class="lb lc hi kw b fi ld le l lf lg">firebase_core: ^1.3.0<br/>firebase_auth: ^2.0.0</span></pre><ul class=""><li id="f91f" class="kf kg hi iw b ix iy jb jc jf kh jj ki jn kj jr kk kl km kn bi translated"><code class="du kt ku kv kw b"><a class="ae js" href="https://pub.dev/packages/firebase_core" rel="noopener ugc nofollow" target="_blank">firebase_core</a></code>，在Flutter app中使用任何Firebase服务都需要它</li><li id="35d0" class="kf kg hi iw b ix ko jb kp jf kq jj kr jn ks jr kk kl km kn bi translated"><code class="du kt ku kv kw b"><a class="ae js" href="https://pub.dev/packages/firebase_auth" rel="noopener ugc nofollow" target="_blank">firebase_auth</a></code>访问Firebase认证服务</li></ul><p id="0a54" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">初始化Firebase App </strong></p><p id="3683" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在使用Flutter应用中的任何Firebase服务之前，您需要初始化<a class="ae js" href="https://firebase.google.com/docs/reference/js/firebase.app.App" rel="noopener ugc nofollow" target="_blank"> Firebase应用</a>。</p><p id="bdae" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在<code class="du kt ku kv kw b">Auth.dart</code>中，添加该方法初始化Firebase App:</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="f967" class="lb lc hi kw b fi ld le l lf lg">Future&lt;FirebaseApp&gt; _initializeFirebase() async {<br/>    FirebaseApp firebaseApp = await Firebase.initializeApp();<br/>    return firebaseApp;<br/>}</span></pre><p id="7f80" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">由于该方法是异步的，我们将在构建方法中使用<code class="du kt ku kv kw b">FutureBuilder</code></p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="55d8" class="lb lc hi kw b fi ld le l lf lg">child: Scaffold(<br/>  body: FutureBuilder(<br/>    future: _inializeFirebase(),<br/>    builder: (context, snapshot) {<br/>      if (snapshot.connectionState == ConnectionState.done) {<br/>        return Container(<br/>          color: Colors.<em class="jw">white</em>,<br/>          child: CustomPaint(<br/>            painter: BackgroundPaint(),</span></pre><p id="a35b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，创建一个名为<code class="du kt ku kv kw b">authentication.dart</code>的新dart文件，并为新用户注册定义一个名为<code class="du kt ku kv kw b">registerUsingEmailPassword()</code>的新方法。</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="e720" class="lb lc hi kw b fi ld le l lf lg">class Authentication {<br/>  // For registering a new user<br/>  static Future&lt;User?&gt; <em class="jw">registerUsingEmailPassword</em>({<br/>    required String email,<br/>    required String password,<br/>  }) async {<br/>    FirebaseAuth auth = FirebaseAuth.<em class="jw">instance</em>;<br/>    User? user;<br/><br/>    try {<br/>      UserCredential userCredential = await auth.createUserWithEmailAndPassword(<br/>        email: email,<br/>        password: password,<br/>      );<br/><br/>      user = userCredential.user;<br/>      // ignore: deprecated_member_use<br/>      await user!.updateProfile(displayName: email);<br/>      await user.reload();<br/>      user = auth.currentUser;<br/>    } on FirebaseAuthException catch (e) {<br/>      if (e.code == 'weak-password') {<br/>        print('The password provided is too weak.');<br/>      } else if (e.code == 'email-already-in-use') {<br/>        print('The account already exists for that email.');<br/>      }<br/>    } catch (e) {<br/>      print(e);<br/>    }<br/><br/>    return user;<br/>  }</span></pre><p id="0eab" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在上面的代码中，我们使用电子邮件和密码注册了一个新用户，并包含了一个条件语句来捕捉错误。</p><p id="c336" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，定义一个名为<code class="du kt ku kv kw b">signInUsingEmailPassword()</code>的新方法，为注册用户传递用户电子邮件和密码:</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="2b4b" class="lb lc hi kw b fi ld le l lf lg">// For signing in an user (have already registered)<br/>static Future&lt;User?&gt; <em class="jw">signInUsingEmailPassword</em>({<br/>  required String email,<br/>  required String password,<br/>}) async {<br/>  FirebaseAuth auth = FirebaseAuth.<em class="jw">instance</em>;<br/>  User? user;<br/><br/>  try {<br/>    UserCredential userCredential = await auth.signInWithEmailAndPassword(<br/>      email: email,<br/>      password: password,<br/>    );<br/>    user = userCredential.user;<br/>  } on FirebaseAuthException catch (e) {<br/>    if (e.code == 'user-not-found') {<br/>      print('No user found.');<br/>    } else if (e.code == 'wrong-password') {<br/>      print('Wrong password');<br/>    }<br/>  }<br/><br/>  return user;<br/>}</span></pre><p id="dfc4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">电子邮件和密码帮助生成Firebase提供的<code class="du kt ku kv kw b">User</code>对象。<code class="du kt ku kv kw b">User</code>对象将用于检索任何附加数据(例如，用户名、个人资料图片等。)存在那个账户里。</p><p id="b0a7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du kt ku kv kw b">signOut()</code>方法注销一个用户。不需要创建signout方法，因为它只是一行代码。</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="2993" class="lb lc hi kw b fi ld le l lf lg">FirebaseAuth.instance.signOut();</span></pre><p id="f6ac" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于电子邮件验证，我们将在<code class="du kt ku kv kw b">User</code>对象上使用<code class="du kt ku kv kw b">sendEmailVerification()</code>方法:</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="365a" class="lb lc hi kw b fi ld le l lf lg">user.sendEmailVerification();</span></pre><p id="10c6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，为表单定义一个验证器</p><p id="b21f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在前一篇文章中，我们创建了一个包含两个表单字段的登录/注册页面:email和password。现在，我们将为每一个创建一个验证器。验证器将帮助检查用户是否在特定字段中输入了任何不适当的值，并相应地显示错误。</p><p id="ad89" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">创建一个名为<code class="du kt ku kv kw b">validator.dart</code>的新文件，定义一个类<code class="du kt ku kv kw b">Validator</code>，并在其中指定两个方法(每个方法都将一个<code class="du kt ku kv kw b">String</code>作为参数):</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="e402" class="lb lc hi kw b fi ld le l lf lg">class Validator {<br/>  static String? <em class="jw">validateEmail</em>({required String? email}) {<br/>    if (email == null) {<br/>      return null;<br/>    }<br/><br/>    RegExp emailRegExp = RegExp(<br/>        r"^[a-zA-Z0-9.!#$%&amp;'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,253}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,253}[a-zA-Z0-9])?)*$");<br/><br/>    if (email.isEmpty) {<br/>      return 'Email can\'t be empty';<br/>    } else if (!emailRegExp.hasMatch(email)) {<br/>      return 'Enter a correct email';<br/>    }<br/><br/>    return null;<br/>  }<br/><br/>  static String? <em class="jw">validatePassword</em>({required String? password}) {<br/>    if (password == null) {<br/>      return null;<br/>    }<br/><br/>    if (password.isEmpty) {<br/>      return 'Password can\'t be empty';<br/>    } else if (password.length &lt; 6) {<br/>      return 'Enter a password with length at least 6';<br/>    }<br/><br/>    return null;<br/>  }<br/>}</span></pre><p id="9b29" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在<code class="du kt ku kv kw b">Auth.dart</code>中定义一个<code class="du kt ku kv kw b">GlobalKey</code>:</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="ae09" class="lb lc hi kw b fi ld le l lf lg">final _formKey = GlobalKey&lt;FormState&gt;();</span></pre><p id="b0cf" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以下列形式指定密钥</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="5054" class="lb lc hi kw b fi ld le l lf lg">child: Form(<br/>  key: _formKey,<br/>  child: Column(<br/>    mainAxisAlignment: MainAxisAlignment.center,<br/>    children: [<br/>      TextFormField(<br/>        controller: _emailTextController,<br/>        // ignore: missing_return<br/>        focusNode: _focusEmail,<br/>        validator: (value) =&gt;<br/>            Validator.<em class="jw">validateEmail</em>(email: value),<br/>        decoration: InputDecoration(<br/>          labelText: 'email',<br/>          labelStyle: TextStyle(<br/>              color: Colors.<em class="jw">white</em>,<br/>              fontSize: 16,<br/>              fontWeight: FontWeight.<em class="jw">w400</em>),<br/>          filled: true,<br/>          contentPadding: EdgeInsets.symmetric(<br/>              vertical: 0, horizontal: 16),<br/>          border: OutlineInputBorder(<br/>            borderRadius: BorderRadius.only(<br/>              topLeft: Radius.circular(25),<br/>              topRight: Radius.circular(25),<br/>            ),<br/>            borderSide: BorderSide(<br/>              width: 0,<br/>              style: BorderStyle.none,<br/>            ),<br/>          ),</span></pre><p id="3e8e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们调用了validator方法来检查电子邮件是否有效。我们将对密码字段进行同样的操作</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="1352" class="lb lc hi kw b fi ld le l lf lg">TextFormField(<br/>  controller: _passwordTextController,<br/>  focusNode: _focusPassword,<br/>  validator: (value) =&gt;<br/>      Validator.<em class="jw">validatePassword</em>(<br/>          password: value),<br/>  decoration: InputDecoration(<br/>    labelText: 'password',<br/>    labelStyle: TextStyle(<br/>        color: Colors.<em class="jw">white</em>,<br/>        fontSize: 16,<br/>        fontWeight: FontWeight.<em class="jw">w400</em>),<br/>    filled: true,<br/>    contentPadding: EdgeInsets.symmetric(<br/>        vertical: 0, horizontal: 16),<br/>    border: OutlineInputBorder(<br/>      borderRadius: BorderRadius.only(<br/>        bottomLeft: Radius.circular(25),<br/>        bottomRight: Radius.circular(25),<br/>      ),<br/>      borderSide: BorderSide(<br/>        width: 0,<br/>        style: BorderStyle.none,<br/>      ),<br/>    ),<br/>  ),<br/>  obscureText: true,<br/>),</span></pre><p id="5dfb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在<strong class="iw hj">登录</strong>按钮中，我们调用了<code class="du kt ku kv kw b">FireAuth.signInUsingEmailPassword()</code>来使用Firebase认证执行登录过程。</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="46d0" class="lb lc hi kw b fi ld le l lf lg">_isProcessing<br/>    ? LoadingIndicator()<br/>    : GestureDetector(<br/>        onTap: () async {<br/>          _focusEmail.unfocus();<br/>          _focusPassword.unfocus();<br/>          if (_formKey.currentState!<br/>              .validate()) {<br/>            setState(() {<br/>              _isProcessing = true;<br/>            });<br/>            User? user = await Authentication<br/>                .<em class="jw">signInUsingEmailPassword</em>(<br/>                    email:<br/>                        _emailTextController<br/>                            .text,<br/>                    password:<br/>                        _passwordTextController<br/>                            .text);<br/>            setState(() {<br/>              _isProcessing = false;<br/>            });<br/>            if (user != null) {<br/>              Navigator.<em class="jw">of</em>(context)<br/>                  .pushReplacement(<br/>                MaterialPageRoute(<br/>                  builder: (context) =&gt;<br/>                      HomePage(user: user),<br/>                ),<br/>              );<br/>            }<br/>          }<br/>        },<br/>        child: Container(<br/>          height: 40,<br/>          decoration: BoxDecoration(<br/>            borderRadius: BorderRadius.all(<br/>              Radius.circular(25),<br/>            ),<br/>            color: Color(0xff8705bf),<br/>            boxShadow: [<br/>              BoxShadow(<br/>                  offset: Offset(0, 3),<br/>                  blurRadius: 3,<br/>                  spreadRadius: 2,<br/>                  color: Color(0xffbf63d8)),<br/>            ],<br/>          ),<br/>          child: Center(<br/>            child: Text(<br/>              'login'.toUpperCase(),<br/>              style: TextStyle(<br/>                fontWeight: FontWeight.<em class="jw">bold</em>,<br/>                fontSize: 24,<br/>                color: Colors.<em class="jw">white</em>,<br/>              ),<br/>            ),<br/>          ),</span></pre><p id="9d92" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">注册页面也将包含一个类似于登录页面的表单。</p><p id="419e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">哇！太多了。现在，我们已经成功地将Firebase身份验证与我们的Flutter应用程序集成在一起。如您所知，Firebase身份验证不仅提供了用于轻松验证用户身份的后端基础架构，还提供了用于自动登录和电子邮件验证的预定义方法。有了Firebase，就有了更多可以探索的东西。</p><p id="8115" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">还有最后一步！</p><p id="c4f0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们需要创建一个配置文件设置页面来验证电子邮件，并添加一个配置文件图像。</p><p id="682e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">创建一个新的dart文件<strong class="iw hj"> profile_setting.dart </strong></p><p id="aa76" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，我们需要image_picker <a class="ae js" href="https://pub.dev/packages/image_picker" rel="noopener ugc nofollow" target="_blank">插件</a>来通过相机和照片库拾取图像。</p><p id="2773" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">步骤1:将插件添加到您的<code class="du kt ku kv kw b">pubspec.yaml</code>文件中。</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="a19e" class="lb lc hi kw b fi ld le l lf lg">image_picker: ^0.8.2</span></pre><p id="d0b5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">步骤2:配置本机设置</p><p id="787b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在Android平台上，不需要任何配置。对于iOS，打开IOS/Runner文件夹下的Info.plist文件，并添加以下键。</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="ea2d" class="lb lc hi kw b fi ld le l lf lg">&lt;key&gt;NSPhotoLibraryUsageDescription&lt;/key&gt;<br/>&lt;string&gt;Allow access to photo library&lt;/string&gt;</span><span id="48c0" class="lb lc hi kw b fi lh le l lf lg">&lt;key&gt;NSCameraUsageDescription&lt;/key&gt;<br/>&lt;string&gt;Allow access to camera to capture photos&lt;/string&gt;</span><span id="4e59" class="lb lc hi kw b fi lh le l lf lg">&lt;key&gt;NSMicrophoneUsageDescription&lt;/key&gt;<br/>&lt;string&gt;Allow access to microphone&lt;/string&gt;</span></pre><p id="a2d6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">步骤3:为<code class="du kt ku kv kw b">profile_setting.dart</code>创建用户界面</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="d75f" class="lb lc hi kw b fi ld le l lf lg">import 'dart:io';<br/><br/>import 'package:flutter/material.dart';<br/>import 'package:image_picker/image_picker.dart';<br/>import 'package:font_awesome_flutter/font_awesome_flutter.dart';<br/><br/>class Settings extends StatefulWidget {<br/> @override<br/>  _SettingsState createState() =&gt; _SettingsState();<br/>}<br/><br/>class _SettingsState extends State&lt;Settings&gt; {<br/>  File? _avatarImage;<br/><br/>  final picker = ImagePicker();<br/><br/>  // create two functions to pick image from gallery/camera<br/><br/>// create a future function. store the result in a variable of File<br/>// as it will return the image Path<br/>Future pickImageFromGallery() async {<br/>  final pickedFile = await picker.pickImage(<br/>    source: ImageSource.gallery,<br/>    imageQuality: 50,<br/>  );<br/><br/>  setState(() {<br/>    _avatarImage = File(pickedFile!.path);<br/>  });<br/>}<br/><br/>Future pickImageFromCamera() async {<br/>  XFile? pickedFile = await picker.pickImage(<br/>    source: ImageSource.camera,<br/>    imageQuality: 50,<br/>  );<br/><br/>  setState(() {<br/>    _avatarImage = pickedFile as File;<br/>  });<br/>}<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>        backgroundColor: Colors.<em class="jw">white</em>,<br/>        leading: IconButton(<br/>          icon: Icon(<br/>            FontAwesomeIcons.<em class="jw">arrowLeft</em>,<br/>            color: Color(0xff8705bf),<br/>          ),<br/>          onPressed: () {<br/>            Navigator.<em class="jw">pop</em>(context);<br/>          },<br/>        ),<br/>      ),</span></pre><p id="849d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在类状态中，我们声明一个文件变量来保存用户选择的图像。然后，我们创建两个函数来通过相机和照片库拾取图像。</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="bc65" class="lb lc hi kw b fi ld le l lf lg">body: Padding(<br/>  padding: const EdgeInsets.all(10.0),<br/>  child: Container(<br/>    color: Colors.<em class="jw">white</em>,<br/>    child: Column(<br/>      mainAxisAlignment: MainAxisAlignment.center,<br/>      crossAxisAlignment: CrossAxisAlignment.stretch,<br/>      children: [<br/>        SizedBox(<br/>          height: 100,<br/>        ),<br/>        Center(<br/>          child: GestureDetector(<br/>            onTap: () =&gt; _displayPicker(context),<br/>            child: CircleAvatar(<br/>              radius: 55,<br/>              // ignore: unnecessary_null_comparison<br/>              child: _avatarImage != null<br/>                  ? ClipOval(<br/>                      child: SizedBox(<br/>                        width: 120,<br/>                        height: 120,<br/>                        child: Image.file(<br/>                          _avatarImage!,<br/>                          fit: BoxFit.fill,<br/>                        ),<br/>                      ),<br/>                    )<br/>                  : Container(<br/>                      decoration: BoxDecoration(<br/>                        color: Colors.<em class="jw">grey</em>.shade200,<br/>                        borderRadius: BorderRadius.circular(50),<br/>                      ),<br/>                      width: 100,<br/>                      height: 100,<br/>                      child: Icon(<br/>                        Icons.<em class="jw">camera_alt_rounded</em>,<br/>                        color: Colors.<em class="jw">grey</em>.shade400,<br/>                      ),<br/>                    ),<br/>            ),<br/>          ),<br/>        ),</span></pre><p id="e727" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们创建了一个<code class="du kt ku kv kw b">CircleAvatar,</code>用<code class="du kt ku kv kw b">ClipOvar</code>包装它的孩子来剪辑图像，如果没有图片被选中，就会显示一个相机图标。</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="26bf" class="lb lc hi kw b fi ld le l lf lg">// create a function for displaying a bottom sheet for the user<br/>// To choose the option of camera or gallery.<br/>void _displayPicker(context) {<br/>  showModalBottomSheet(<br/>    context: context,<br/>    builder: (BuildContext bc) {<br/>      return SafeArea(<br/>        child: Container(<br/>          child: Wrap(<br/>            children: &lt;Widget&gt;[<br/>              ListTile(<br/>                  leading: new Icon(Icons.<em class="jw">photo_library</em>),<br/>                  title: new Text('Gallery'),<br/>                  onTap: () {<br/>                    pickImageFromGallery();<br/>                    Navigator.<em class="jw">of</em>(context).pop();<br/>                  }),<br/>              ListTile(<br/>                leading: new Icon(Icons.<em class="jw">photo_camera</em>),<br/>                title: new Text('Camera'),<br/>                onTap: () {<br/>                  pickImageFromCamera();<br/>                  Navigator.<em class="jw">of</em>(context).pop();<br/>                },<br/>              ),<br/>            ],<br/>          ),<br/>        ),<br/>      );<br/>    },<br/>  );<br/>}</span></pre><p id="af66" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当点击<code class="du kt ku kv kw b">CircleAvatar</code>时，底部会显示一个容器，用于选择相机或图库选项。然后选择的图像显示在<code class="du kt ku kv kw b">CircleAvatar</code>中。</p><div class="kb kc kd ke fd ab cb"><figure class="li ij lj lk ll lm ln paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/28f3b0d22456bac310c8d35039c4f832.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*qRhTsCd7ES_fBfxm5JgX6w.jpeg"/></div></figure><figure class="li ij lo lk ll lm ln paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/a7e8643d62d6964c2f477457fdc1e382.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*BESfIVHuGQbw7tKXEFoAaQ.jpeg"/></div></figure></div><p id="b673" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，让我们编写一些代码来验证用户电子邮件。</p><p id="1a78" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，添加以下代码。用户对象将帮助检索用户的数据。</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="3ef1" class="lb lc hi kw b fi ld le l lf lg">final User user;<br/>const Settings({required this.user});</span></pre><p id="dbbf" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">创建一个变量<strong class="iw hj"> _currentUser </strong>，并在<strong class="iw hj"> initState()中初始化它。</strong></p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="8590" class="lb lc hi kw b fi ld le l lf lg">var _currentUser;<br/>bool _isSendingVerification = false;<br/><br/>@override<br/>void initState() {<br/>  // <em class="jw">TODO: implement initState<br/>  </em>_currentUser = widget.user;<br/>  super.initState();<br/>}</span></pre><p id="dd2e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">发送电子邮件验证的按钮如下:</p><pre class="kb kc kd ke fd kx kw ky kz aw la bi"><span id="f3e8" class="lb lc hi kw b fi ld le l lf lg">Text(<br/>  '${_currentUser.email}',<br/>  style: Theme.<em class="jw">of</em>(context).textTheme.bodyText1,<br/>),<br/>SizedBox(<br/>  height: 16,<br/>),<br/>_currentUser.emailVerified<br/>    ? Text(<br/>        'Email verified',<br/>        style: Theme.<em class="jw">of</em>(context)<br/>            .textTheme<br/>            .bodyText1!<br/>            .copyWith(color: Colors.<em class="jw">green</em>),<br/>      )<br/>    : Text(<br/>        'Email not verified',<br/>        style: Theme.<em class="jw">of</em>(context)<br/>            .textTheme<br/>            .bodyText1!<br/>            .copyWith(color: Colors.<em class="jw">red</em>),<br/>      ),<br/>SizedBox(<br/>  height: 16,<br/>),<br/>_isSendingVerification<br/>    ? CircularProgressIndicator()<br/>    : Row(<br/>        mainAxisSize: MainAxisSize.min,<br/>        children: [<br/>          GestureDetector(<br/>            onTap: () async {<br/>              setState(() {<br/>                _isSendingVerification = true;<br/>              });<br/>              await _currentUser.sendEmailVerification();<br/>              setState(() {<br/>                _isSendingVerification = false;<br/>              });<br/>            },<br/>            child: Text(<br/>              'Verify email',<br/>              style: TextStyle(<br/>                  color: Color(0xff8705bf),<br/>                  fontSize: 16,<br/>                  fontWeight: FontWeight.<em class="jw">bold</em>),<br/>            ),<br/>          ),<br/>          SizedBox(<br/>            width: 8.0,<br/>          ),<br/>          IconButton(<br/>            onPressed: () async {<br/>              User? user =<br/>                  await Authentication.<em class="jw">refreshUser</em>(_currentUser);<br/>              if (user != null) {<br/>                setState(() {<br/>                  _currentUser = user;<br/>                });<br/>              }<br/>            },<br/>            icon: Icon(<br/>              Icons.<em class="jw">refresh_rounded</em>,<br/>              color: Color(0xff8705bf),<br/>            ),<br/>          ),<br/>        ],<br/>      ),</span></pre><p id="dd5d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">电子邮件通过验证后，文本小部件的颜色会从红色变为绿色。</p><h2 id="fd95" class="lb lc hi bd lp lq lr ls lt lu lv lw lx jf ly lz ma jj mb mc md jn me mf mg mh bi translated">结论</h2><p id="2376" class="pw-post-body-paragraph iu iv hi iw b ix mi iz ja jb mj jd je jf mk jh ji jj ml jl jm jn mm jp jq jr hb bi translated">你永远不知道你能有多好，直到你开始这样做。出错没关系，但最棒的是你能解决它。所以，继续编码吧！</p><p id="fcc8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在处检查项目代码<a class="ae js" href="https://github.com/funmi-cod/fashionapp" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="9ff3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae js" href="https://github.com/funmi-cod/fashionapp" rel="noopener ugc nofollow" target="_blank">https://github.com/funmi-cod/fashionapp</a></p></div><div class="ab cl mn mo gp mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="hb hc hd he hf"><figure class="kb kc kd ke fd ij er es paragraph-image"><div class="er es mu"><img src="../Images/b907965cc0b704c5b09f12f6a38c2525.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/0*uiGgmi8zJbHv5uST"/></div></figure><p id="8fdb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">❤ ❤谢谢你坚持到最后。❤❤</p><figure class="kb kc kd ke fd ij er es paragraph-image"><div class="ab fe cl mv"><img src="../Images/31573030d1a65a61fbd5e375cc6c1f55.png" data-original-src="https://miro.medium.com/v2/format:webp/1*b31hiO4ynbDLRrXWEFF4aQ.png"/></div></figure></div></div>    
</body>
</html>