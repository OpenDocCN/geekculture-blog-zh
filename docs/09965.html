<html>
<head>
<title>How to Deploy Any Machine Learning Model to a Cloud in One Line of Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用一行代码将任何机器学习模型部署到云中</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-deploy-any-machine-learning-model-to-a-cloud-in-one-line-of-code-d38eff88a037?source=collection_archive---------8-----------------------#2022-01-07">https://medium.com/geekculture/how-to-deploy-any-machine-learning-model-to-a-cloud-in-one-line-of-code-d38eff88a037?source=collection_archive---------8-----------------------#2022-01-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/86b83c61977169251acb1b282d8a7e4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*4L0o9XIMnjva6uo--leVpg.png"/></div><figcaption class="im in et er es io ip bd b be z dx">Deploy a Machine Learning Model on AWS</figcaption></figure><p id="834c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我仍然记得当我创建了一个机器学习模型，第一次解决了一个现实世界的问题时，我是多么兴奋。然而，真正让我气馁的是，工程团队花了两个多月的时间将其部署到应用程序中。减缓模型部署的因素不是工程师的技能，而是团队协作和迭代的能力。</p><p id="a410" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果有一种工具，只要模型做好了，就能让数据科学家自己部署模型，那会怎么样？从这个想法出发，我和我的团队开始了打造Aibro的征程。</p><p id="31aa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://colab.research.google.com/drive/1NH2Aj1bbCgqJXyNKK9TkzwlO4JDBkTQC?usp=sharing" rel="noopener ugc nofollow" target="_blank"> Colab演示链接</a> &amp; <a class="ae jo" href="https://aipaca.ai/" rel="noopener ugc nofollow" target="_blank">我们的网站</a> &amp; <a class="ae jo" href="https://doc.aipaca.ai/inference" rel="noopener ugc nofollow" target="_blank">推理文档</a></p><h1 id="eff7" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">关于Aibro</h1><p id="173e" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">Aibro是一个无服务器的MLOps工具，可以帮助数据科学家在2分钟内在云平台上训练和部署AI模型。与此同时，Aibro采用了专为机器学习打造的成本节约战略，将云成本降低了85%。稍后我会发表另一篇博客来解释关于成本节约策略的细节。</p><p id="ea54" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你对无服务器训练更感兴趣，这是我以前的一篇关于用一行代码在云上训练神经网络的文章</p><h1 id="3f1d" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">部署工作流程</h1><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es ks"><img src="../Images/3c0bb1a283f84a40f213fea3ce966778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WwJ8_psSVIqh9ISEWVzA-Q.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx">An Aibro Inference Example</figcaption></figure><p id="499c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一般来说，你需要做的就是上传一个格式化的机器学习模型库，从<a class="ae jo" href="https://aipaca.ai/marketplace" rel="noopener ugc nofollow" target="_blank"> Aibro marketplace </a>中选择一个托管服务器。Aibro随后将创建一个推理API，其计算能力和成本将根据工作负载自动调整。</p><p id="5dbe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里有一个格式化的ML模型库的例子:<a class="ae jo" href="https://github.com/AIpaca-Inc/AIbro_model_repo" rel="noopener ugc nofollow" target="_blank">https://github.com/AIpaca-Inc/AIbro_model_repo</a>。</p><h2 id="678d" class="lb jq hi bd jr lc ld le jv lf lg lh jz jb li lj kd jf lk ll kh jj lm ln kl lo bi translated">步骤1:安装aibro python库</h2><p id="2237" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated"><code class="du lp lq lr ls b">pip install aibro</code></p><h2 id="136c" class="lb jq hi bd jr lc ld le jv lf lg lh jz jb li lj kd jf lk ll kh jj lm ln kl lo bi translated">步骤2:准备格式化的模型库</h2><p id="8dbc" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">回购应按照以下格式构建:</p><p id="3791" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">回购<br/>| _ _</strong>| _ _<a class="ae jo" href="https://github.com/AIpaca-Inc/AIbro_model_repo/blob/main/predict.py" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">预测. py</strong></a><strong class="is hj"><br/>| _ _</strong>| _ _<a class="ae jo" href="https://github.com/AIpaca-Inc/AIbro_model_repo/tree/main/model" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">模型</strong></a><strong class="is hj"><br/>| _ _</strong><a class="ae jo" href="https://github.com/AIpaca-Inc/AIbro_model_repo/tree/main/data" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">数据</strong></a><strong class="is hj"><br/>| _ _</strong><a class="ae jo" href="https://github.com/AIpaca-Inc/AIbro_model_repo/blob/main/requirements.txt" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">需求. txt </strong> </a> <strong class="is hj"> <br/> |__其他工件</strong></p><p id="2147" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> predict.py </strong></p><p id="6e57" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是艾布罗入口。</p><p id="991c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lp lq lr ls b">predict.py</code>应该包含两种方法:</p><p id="9fe8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> load_model(): </strong></p><pre class="kt ku kv kw fd lt ls lu lv aw lw bi"><span id="6b3a" class="lb jq hi ls b fi lx ly l lz ma">def load_model():<br/>    # Portuguese to English translator<br/>    translator = tf.saved_model.load('model')<br/>    return translator</span></pre><p id="b4c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个方法应该从<code class="du lp lq lr ls b">model</code>文件夹加载并返回你的机器学习模型。在示例报告中使用了一个基于transformer的葡萄牙语到英语的翻译器。</p><p id="fb97" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">运行():</strong></p><pre class="kt ku kv kw fd lt ls lu lv aw lw bi"><span id="124e" class="lb jq hi ls b fi lx ly l lz ma">def run(model):<br/>    fp = open("./data/data.json", "r")<br/>    data = json.load(fp)<br/>    sentence = data["data"]<br/>    result = {"data": model(sentence).numpy().decode("utf-8")}<br/>    return result</span></pre><p id="44c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该方法使用模型作为输入，从“数据”文件夹中加载数据，预测并返回推理结果。</p><p id="f3d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mb">本地测试提示</em> : <code class="du lp lq lr ls b">predict.py</code>应该能够通过以下方式返回一个推断结果:</p><pre class="kt ku kv kw fd lt ls lu lv aw lw bi"><span id="9ba0" class="lb jq hi ls b fi lx ly l lz ma">run(load_model())</span></pre><p id="cf46" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lp lq lr ls b"><strong class="is hj">model</strong></code><strong class="is hj"/><code class="du lp lq lr ls b"><strong class="is hj">data</strong></code><strong class="is hj">文件夹</strong></p><p id="88da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">只要<code class="du lp lq lr ls b">predict.py</code>结构正确，<code class="du lp lq lr ls b">model</code>和<code class="du lp lq lr ls b">data</code>文件夹没有格式限制。</p><p id="4d71" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> requirement.txt </strong></p><p id="ed93" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在部署模型之前，安装requirement.txt中的包来设置环境。</p><p id="a5ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">其他工件</strong></p><p id="0a6d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lp lq lr ls b">predict.py</code>可以使用的所有其他文件/文件夹。</p><h2 id="a171" class="lb jq hi bd jr lc ld le jv lf lg lh jz jb li lj kd jf lk ll kh jj lm ln kl lo bi translated">步骤3:创建推理API</h2><pre class="kt ku kv kw fd lt ls lu lv aw lw bi"><span id="b983" class="lb jq hi ls b fi lx ly l lz ma">from aibro import Inference<br/>api_url = Inference.deploy(<br/>    model_name = "my_fancy_transformer",<br/>    machine_id_config = "c5.large.od",<br/>    artifacts_path = "./aibro_repo",<br/>)</span></pre><p id="5eca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设格式化的模型回购保存在路径”。/aibro_repo”，我们现在可以用它来创建一个推理作业。在您的配置文件下，模型名称对于所有当前的<a class="ae jo" href="https://aipaca.ai/inference_jobs" rel="noopener ugc nofollow" target="_blank">活动推理作业</a>应该是唯一的。</p><p id="e84a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本例中，我们部署了来自“”的公共自定义模型。/aibro_repo”调用了计算机类型“c5.large.od”上的“my_fancy_transformer ”,并使用访问令牌进行身份验证。</p><p id="2287" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">部署完成后，将返回一个API URL，语法如下:</p><ul class=""><li id="5b0c" class="mc md hi is b it iu ix iy jb me jf mf jj mg jn mh mi mj mk bi translated"><a class="ae jo" href="https://api.aipaca.ai/v1/{username}/{client_id}/{model_name}/predict" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">https://API . ai paca . ai/v1/{用户名}/{客户端标识}/{模型名称}/预测</strong> </a></li></ul><p id="3b92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> {client_id} </strong>:如果您的推理作业是公共的，<code class="du lp lq lr ls b">{client_id}</code>由字符串<code class="du lp lq lr ls b">"public"</code>填充。否则，<code class="du lp lq lr ls b">{client_id}</code>将由您的<a class="ae jo" href="https://doc.aipaca.ai/inference#update_clients" rel="noopener ugc nofollow" target="_blank">客户ID </a>填写。</p><h2 id="a747" class="lb jq hi bd jr lc ld le jv lf lg lh jz jb li lj kd jf lk ll kh jj lm ln kl lo bi translated">步骤4:完成推理工作</h2><pre class="kt ku kv kw fd lt ls lu lv aw lw bi"><span id="7393" class="lb jq hi ls b fi lx ly l lz ma">from aibro import Inference<br/>Inference.complete(job_id)</span></pre><p id="84e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦不再使用推理作业，为了避免不必要的开销，请记得在<code class="du lp lq lr ls b">Inference.complete()</code>前关闭API。</p><h1 id="8542" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结束了</h1><p id="5586" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">就这么简单！如果你觉得Aibro有帮助，请从<a class="ae jo" href="https://aipaca.ai" rel="noopener ugc nofollow" target="_blank"> aipaca.ai </a>加入我们的社区。我们将分享Aibro的最新更新。我们欢迎您的任何反馈！</p></div></div>    
</body>
</html>