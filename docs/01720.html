<html>
<head>
<title>Build a Flutter Android app and deploy it to Google Play using Bitrise CI/CD platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个Flutter Android应用程序，并使用Bitrise CI/CD平台将其部署到Google Play</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/build-a-flutter-android-app-and-deploy-it-to-google-play-using-bitrise-ci-cd-platform-68de0612ede?source=collection_archive---------7-----------------------#2021-04-21">https://medium.com/geekculture/build-a-flutter-android-app-and-deploy-it-to-google-play-using-bitrise-ci-cd-platform-68de0612ede?source=collection_archive---------7-----------------------#2021-04-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2a9e71a840f876b5c6785397b6d45b09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uAQ7tJwRIzeFSeTKlukqyw.png"/></div></div></figure><p id="e944" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我的<a class="ae jo" href="https://i-kurochka.medium.com/build-a-flutter-ios-app-and-deploy-it-to-testflight-using-bitrise-ci-cd-platform-dc1eef5f253a" rel="noopener">上一篇文章</a>中，我描述了什么是<a class="ae jo" href="https://bitrise.io" rel="noopener ugc nofollow" target="_blank"> Bitrise </a>以及如何使用它来构建一个基于Flutter的iOS应用程序，并将其上传到Appstore/Testflight。</p><p id="31d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在是时候弄清楚如何为Android做同样的事情了。</p><p id="c373" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">老实说，Android的过程似乎更容易(对我来说)和简单，尽管它非常类似于iOS。</p><p id="09d6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以过程是:</p><ol class=""><li id="e94c" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">构建应用程序</li><li id="a5b5" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">签署二进制文件(aab或apk)</li><li id="f4cf" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">将签名的二进制文件上传到Google Play控制台</li><li id="e078" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">将构建推向发布轨道(即内部、封闭测试、开放测试或公开发布)</li></ol><h1 id="639d" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">构建应用程序</h1><p id="7b7d" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">因为我已经在我的上一篇文章<a class="ae jo" href="https://i-kurochka.medium.com/build-a-flutter-ios-app-and-deploy-it-to-testflight-using-bitrise-ci-cd-platform-dc1eef5f253a" rel="noopener">中描述了创建Bitrise应用程序和构建Flutter应用程序的过程，所以在这篇文章中我就不深入讨论了。</a></p><p id="8801" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">唯一改变的是，在“Flutter Build”步骤中，您将“Platform”参数更改为“Android”(或者“both”，如果您想使用相同的管道交付给两个平台的话)</p><p id="04c0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦你到了那里，你可能想要将“Android平台配置”部分中的“Android输出工件类型”更改为“appbundle”，因为从2021年8月开始，这种格式<a class="ae jo" href="https://developer.android.com/guide/app-bundle" rel="noopener ugc nofollow" target="_blank">将在Google Play市场中被要求</a>用于所有新应用。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lg"><img src="../Images/ba9733140fc58886540baf03a916a815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HQxUt8hx7XeiVjUCf_rruw.png"/></div></div></figure><h1 id="9251" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">签署android版本</h1><p id="d206" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">要为Google Play market签名，我们需要生成带有私钥的密钥库(keystore.jks)。这里重要的一点是，Android Studio(以及Bitrise)使用java OpenJDK，而不是Oracle Java JDK，并且使用Oracle Java OpenJDK生成的密钥库与使用OpenJDK生成的密钥库不兼容。因此，为了生成我们的密钥库，我使用了Android Studio</p><p id="1b48" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在Android Studio中打开project/android文件夹，等待它索引文件和软件包，并激活菜单构建中的操作。使用“构建→生成签名包/ APK”菜单</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/9741737aacf333074258607d0c8e4654.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TwyljU1v4K5deSE3gyIzxw.png"/></div></div></figure><p id="bd7e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在弹出窗口中，单击“密钥存储路径”下的“新建”</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/3a26827981eb54d2948a4d7fb8b490f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*itiec6bprSl8MYs0Z7eEeA.png"/></div></div></figure><p id="90e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步，填写您的组织的详细信息、您的密钥库的密码、您的私钥的别名和密码，选择保存它的路径，最后生成您的密钥库。不要忘记在某个地方写下你选择的密码，因为你会需要它们。</p><p id="1595" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重要的是要知道，用于签署上传到Play market的应用程序的第一个版本的密钥必须用于上传该应用程序的更新，并且在未来不能更改，所以不要丢失它，否则您将无法上传新版本。</p><p id="45bf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">生成密钥存储后，打开Bitrise应用程序并导航到工作流编辑器→代码签名选项卡。向下滚动到“ANDROID密钥库文件”部分并上传您的文件，填写别名和密码字段。</p><p id="b865" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您将能够使用Bitrise对您的构建进行签名。在“Flutter Build”之后的某个地方添加一个新步骤，在Bitrise steps目录中找到“Android Sign”。要找到它，你需要将右边的过滤器切换到“全部”</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/f16eacf86921cc43e3140321901a4a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8RRWSYXytGdp3TTPcSD_Gg.png"/></div></div></figure><p id="4d74" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你不需要改变任何东西，默认值对我们有用。尝试运行您的工作流，看看构建阶段是否成功通过。</p><h1 id="4182" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">上传第一个已签名的版本以进入市场</h1><p id="80a8" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">在您可以通过Google Play API上传构建之前，您应该手动上传初始构建，以初始化新创建的应用程序。</p><p id="66b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在后期构建完成后，打开它的“应用和工件”部分，找到并下载你的签名*-signed.aab文件。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/2cbd7a0ccf36251be3407d2338673c62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_9RTrXSHkRRxYr_Hm4qUUw.png"/></div></div></figure><p id="966f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，转到<a class="ae jo" href="https://play.google.com/console/developers" rel="noopener ugc nofollow" target="_blank"> Google Play控制台</a>，导航到您的应用程序的发布-封闭测试子部分，为您的内部测试人员创建、设置和展示您的第一个发布。要做到这一点，你需要填写相当多的表格，并上传应用程序的标志和一些虚拟截图。在这个阶段不要担心内容，你可以稍后编辑一切，只需在那里粘贴一些“lorem ipsum”的东西来完成设置并激活Alpha发布轨道。<strong class="is hj">这一步对于激活通过API发布后续版本的能力非常重要。</strong></p><h1 id="10f2" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">配置开发人员API访问</h1><p id="4820" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">要使用Google Play API上传构建，您需要配置开发者API访问权限。导航到Google Play控制台→设置→ API访问并链接您的Google Cloud项目，可以是现有的，也可以像我一样创建一个新项目。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/ab08405862f2aaa2d951bbcc0ecbb995.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0156Wmk26WeSTGzwib3yKA.png"/></div></div></figure><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/4c01271ffe0c84fa0be339313e0eb2cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-4VZskph_uiHqHplWx_x3w.png"/></div></div></figure><p id="2c5f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">项目链接后，创建一个新的服务帐户，这个过程非常简单，不要跳过权限步骤，授予您的服务帐户访问Google Play控制台的权限。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/f15a9bbd8a5ef56590de330f4d49e49e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sv-XzWGkItX8NVqdZPwr4w.png"/></div></div></figure><p id="3a98" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建服务帐户后，转到它的密钥部分，生成并下载一个新密钥</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/901313f67455dc83d7507514e8137646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tQfASPEC8En-4NlcHBwV9g.png"/></div></div></figure><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/ba1a31230cbc653d1167c0532ebba1e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ns311HKPpR9AOR-FZgrYxQ.png"/></div></div></figure><p id="bad5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完成后，您将被导航回播放控制台API访问设置页面，刷新服务帐户列表后，您将在其中看到已创建的帐户。点击授权访问就完成了。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/9ba06964fd3322faefeaaf36d93da6d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BZCosag72N70zDpbD0mgiw.png"/></div></div></figure><h1 id="a3a6" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">配置最后一步，上传</h1><p id="07fb" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">回到你的Bitrise应用程序的工作流程，在“Android Sign”后添加一个新步骤，并在列表中找到“Google Play Deploy”步骤。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/4267058827ef37b986ce7390605f66dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zS5YvOZwe33fF9SRGk6zqA.png"/></div></div></figure><p id="d445" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这一步中，唯一需要配置的是我们的应用程序的“包名”(又名捆绑包ID)和“轨道”，可以设置为您的管道所需的任何轨道(例如，alpha、beta、release等)。我为我的开发构建使用了“内部”跟踪。</p><p id="bcce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就这样，伙计们！希望这是有帮助的(在这种情况下鼓掌三次；)</p><h1 id="88a8" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">陷阱</h1><p id="6499" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">在这一节中，我将列出我在设置工作流程时遇到的错误和问题，以及必须解决的方法。只是为了帮助将来可能会寻找解决方案的人。</p><p id="4cfe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">" Java . io . io exception:Invalid keystore format "<br/></strong>在我的例子中，我首先使用Oracle Java v16生成密钥库，它与bitrise正在使用的openJDK不兼容，我通过使用Android Studio UI生成密钥库解决了这个问题。</p><p id="0d80" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">无法验证编辑，错误:googleapi:错误400:只能在草稿应用程序上创建状态为草稿的发布。<br/> </strong>当你的应用处于草稿状态时，你不能将你上传的构建推送到任何发布轨道。要解决这个问题，请手动配置和展开Alpha轨道。</p><h1 id="abeb" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">资源</h1><p id="10f5" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated"><a class="ae jo" href="https://flutter.dev/docs/deployment/android" rel="noopener ugc nofollow" target="_blank">https://flutter.dev/docs/deployment/android</a></p><p id="373e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" rel="noopener" href="/bewizyu/part-1-how-to-setup-a-flutter-application-with-bitrise-346dba7d1bab">https://medium . com/bewuzyu/part-1-how-to-setup-a-flutter-application-with-bit rise-346 DBA 7d 1 Bab</a></p><p id="d279" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://blog.bitrise.io/how-to-deploy-android-app-to-google-play-store" rel="noopener ugc nofollow" target="_blank">https://blog . bit rise . io/how-to-deploy-Android-app-to-Google-play-store</a></p><p id="29f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://developers.google.com/android-publisher/getting_started" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/Android-publisher/getting _ started</a></p><p id="c82e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://devcenter.bitrise.io/deploy/android-deploy/generating-and-deploying-android-app-bundles/#signing-an-android-app-bundle" rel="noopener ugc nofollow" target="_blank">https://dev center . bit rise . io/deploy/Android-deploy/generating-and-deploying-Android-app-bundles/</a></p></div></div>    
</body>
</html>