<html>
<head>
<title>Routing our TypeScript API in Express.js and using TypeORM for connecting to our PostgreSQL DB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Express.js中路由我们的TypeScript API，并使用TypeORM连接到我们的PostgreSQL DB</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/routing-our-typescript-api-in-express-js-and-using-typeorm-for-connecting-to-our-postgresql-db-bde5132b5102?source=collection_archive---------2-----------------------#2021-12-30">https://medium.com/geekculture/routing-our-typescript-api-in-express-js-and-using-typeorm-for-connecting-to-our-postgresql-db-bde5132b5102?source=collection_archive---------2-----------------------#2021-12-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/301fb6c0a8e5dd86dcb56b7d38952f48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BnvApZpBOi0NQqw1SEUYUQ.jpeg"/></div></div></figure><blockquote class="iq ir is"><p id="6d8d" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">免责声明:</strong>请注意，本文是上一篇文章的延续，在上一篇文章中，我们已经在Express.js和TypeScript中设置了开发环境。如果你想建立项目，你可以在这里找到它<a class="ae js" rel="noopener" href="/geekculture/setting-up-a-node-js-project-environment-with-express-js-and-typescript-best-practices-284cc37c5aa1">。</a></p><p id="0c91" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">先决条件:</strong>在继续本文之前，我们应该对TypeORM有一个基本的了解。如果没有，那么<a class="ae js" href="https://typeorm.io/#/" rel="noopener ugc nofollow" target="_blank">官方文档</a>随时可供大家学习。</p></blockquote><p id="94f3" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">在我们开始实际编写代码之前，有一些事情我们都需要知道。<strong class="iw hj">路由</strong>就是其中之一。当我们用Express创建一个后端应用程序时，这个应用程序不包含任何API。它有多个API。它可以有用于认证的API、用于错误处理的API、用于将课程添加到流中的API等。当我们在处理所有这些的项目中工作时，为了使事情简单易懂，路由变得非常重要。</p><p id="f60a" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">其次，我们需要知道什么是ORM。<strong class="iw hj"> ORM </strong>是<strong class="iw hj">对象关系映射器</strong>的缩写。简而言之，顾名思义，我们在基于类的对象中设计数据库表，ORM将为我们运行SQL查询，而不会破坏原始SQL的真正潜力。在我们的任何项目中使用ORM的好处之一是，它加快了开发过程，因为我们节省了手动编写SQL查询的时间。其次，它很容易集成到我们的项目中。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="f7a4" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">现在让我们看看代码方面的事情。</p><p id="5929" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated"><strong class="iw hj">步骤1: </strong>在我们现有的项目结构中，我们创建一个名为<strong class="iw hj"> src </strong>的文件夹，并将我们的<strong class="iw hj"> index.ts </strong>文件移动到其中。因为我们正在移动我们的index.ts文件，所以确保在<strong class="iw hj"> package.json </strong>中的<strong class="iw hj">‘scripts’</strong>对象内改变<strong class="iw hj">‘start’</strong>的方向。</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="4bd6" class="km kn hi ki b fi ko kp l kq kr">"scripts": {<br/>    "start": "nodemon --exec ts-node src/index.ts",<br/>    "build": "tsc"<br/> }</span></pre><p id="8db5" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">接下来，在src文件夹中再创建两个子文件夹，即<strong class="iw hj">实体</strong>和<strong class="iw hj">路线。我们稍后会谈到这一点。</strong></p><p id="1c49" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">回到我们项目的根目录，我们将创建另一个名为<strong class="iw hj"> config </strong>的文件夹和一个<strong class="iw hj">。env </strong>文件。完成这些步骤后，这就是我们的项目结构的样子。</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es ks"><img src="../Images/8a944347c5099f873ec95cbc8e4defe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*JHu5hsrXLIrlazphMTJM7g.png"/></div><figcaption class="kt ku et er es kv kw bd b be z dx">Project structure so far.</figcaption></figure><p id="b1eb" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">第二步:下一步是在我们的项目中安装typeorm、postgres和dotenv。</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="325d" class="km kn hi ki b fi ko kp l kq kr">yarn add typeorm<br/>yarn add pg<br/>yarn add dotenv</span></pre><p id="f233" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">在这之后，我们将在<strong class="iw hj">配置</strong>文件夹中创建一个名为<strong class="iw hj"> ormconfig.ts </strong>的文件。在这个ormconfig.ts文件中，我们将建立到数据库的连接。你可以从我下面提供的要点中得到帮助。</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="7a4a" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">另外，请注意，我们必须更新。我们不久前创建的env文件。将下面一行代码添加到您的。环境文件。</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="9b58" class="km kn hi ki b fi ko kp l kq kr">DATABASE_URI=YOUR_DB_CREDENTIALS</span></pre><p id="f11c" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">我们从typeorm导入createConnection来创建与数据库的连接。我们导入dotenv，这样我们可以适当地传递敏感信息的环境变量，如数据库URI。logging键设置为true将在执行时将SQL查询记录到您的控制台。synchronize=true键将在我们每次运行应用程序时将实体与数据库同步。</p><p id="7e69" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">目前，我们可以在第13行注释掉entities键，因为我们目前没有任何实体可以使用。</p><p id="f927" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">这样做之后，我们只需将connectDB导入我们的index.ts并相应地调用它。</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="7dd4" class="km kn hi ki b fi ko kp l kq kr">import connectDB from "../config/ormconfig";</span><span id="c803" class="km kn hi ki b fi kz kp l kq kr">// Create connection with database<br/>connectDB();</span></pre><p id="db71" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated"><strong class="iw hj">第三步:</strong> <strong class="iw hj">创建实体:</strong>就像我上面提到的，实体只不过是基于类的对象，或者说是模型，在引擎盖下为我们执行所有的SQL。创建一个非常简单，在我们的实例中，我们将做其中的两个，第一个是学生实体，第二个是电影实体。</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="d6e8" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">这是创建实体的语法。这里我们从typeorm导入了四样东西；<strong class="iw hj">实体</strong>、<strong class="iw hj"> PrimaryGeneratedColumn </strong>、<strong class="iw hj"> Column、</strong>和<strong class="iw hj"> BaseEntity </strong>。PrimaryGeneratedColumn相当于为设置为自动递增的普通SQL中的表提供主键。之后，我们有其他列，我们也指定我们希望这些列包含的数据类型。永远记住导出你的实体。同样，我们也可以创建电影实体。</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="cbbb" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated"><strong class="iw hj">重要提示:</strong>您会注意到，当您创建实体时，IDE会发出一条警告，内容如下:</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es la"><img src="../Images/b88e48193fd9a633f890ffd34331ebe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1xUJPnGIZuRB54wMyIHaOQ.png"/></div></div></figure><p id="4702" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">仅供参考，装饰者是一种特殊的声明。它们可以在类、参数等中使用。要解决此问题，请删除tsconfig.json中以下行的注释:</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/d1f18fcd0d81d2fe99239eb919281d3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*lUbHWFmP5TticvzmfXdyAA.png"/></div></figure><p id="7127" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">一旦您删除了这两行中的注释，您将不会收到此警告。</p><p id="131c" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated"><strong class="iw hj">步骤4:处理这些实体的API的路由:</strong>在我们已经在src中创建的Routes文件夹中，我们将创建两个文件，即<strong class="iw hj"> studentRoutes.ts </strong>和<strong class="iw hj"> movieRoutes.ts </strong>。我们将使用express.js中的router函数来路由我们的API。让我们创建studentRoutes.ts文件。请参考下面的代码要点:</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="9278" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">这里我们调用路由器函数，并用它创建HTTP请求。同样，也可以创建movieRoutes.ts文件。您可以在资源库中查看，资源库的链接在最后提供。不要忘记在最后导出“路由器”作为默认设置。</p><p id="261a" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated"><strong class="iw hj">步骤5: </strong> <strong class="iw hj">在我们的index.ts文件中使用这些路线:</strong>创建这些文件后，我们只需将它们导入我们的index.ts</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="974e" class="km kn hi ki b fi ko kp l kq kr">// Import API Routes<br/>import studentRoutes from "./routes/studentRoutes";<br/>import movieRoutes from "./routes/movieRoutes";</span></pre><p id="a0e6" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">为了使用它们，我们只需要使用express.js提供的<strong class="iw hj">‘use’</strong>函数。首先是我们希望访问API的路线，其次是我们从routes文件夹中导入的路线。</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="caf1" class="km kn hi ki b fi ko kp l kq kr">// Fetching API from the routes<br/>app.use("/api/students", studentRoutes);<br/>app.use("/api/movies", movieRoutes);</span></pre><p id="4301" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">完成这些步骤后，我们的index.ts文件如下所示:</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="677a" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">在。env文件中，我声明了一个SERVER_PORT并将其设置为一个特定的值。不过这一步是可选的。现在剩下的就是测试我们针对学生和电影的API了。为此，我们可以使用任何API测试应用程序，Postman和失眠症是主要的测试应用程序。我将用失眠来测试它。</p><p id="d121" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">让我们测试其中一个APIs</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/fd702d158d6b86774d288753a699c85e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NXN_BrQV-emiD_Gz3K2ajQ.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">POST request: Movies API</figcaption></figure><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/81f5581212991130e44fecf4e4514936.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FReQ45RK06K3y3xRsboO9Q.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">GET request: Movies API</figcaption></figure><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d7e1db46ca321083dcae8c7cd403d10a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mLxwjsWPJUPRMyOqQEqQsw.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">PUT request: Movies API</figcaption></figure><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b4b3b4c28ec1cd55ddfa9005dc2c9dda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQXvsA2GerCWdnlkMuyhMQ.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">DELETE request: Movies API</figcaption></figure><p id="4e3f" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">至此，我们的API已经准备好了，这就是本文的全部内容。我在一开始就提供了这篇文章第一部分的链接，所以也请查看一下。我已经在其中写了设置过程。</p><p id="7678" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated"><a class="ae js" href="https://github.com/chinmaykarmokar/node-express-typescript" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> <em class="iv">链接到资源库</em> </strong> </a></p><p id="18e9" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">谢谢大家！</p></div></div>    
</body>
</html>