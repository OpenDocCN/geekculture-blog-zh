<html>
<head>
<title>A new approach to create APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建API的新方法</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/a-new-approach-to-create-apis-8fe84e158b4c?source=collection_archive---------34-----------------------#2021-07-27">https://medium.com/geekculture/a-new-approach-to-create-apis-8fe84e158b4c?source=collection_archive---------34-----------------------#2021-07-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9fd334c641a88cf56abc4688b6310b74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-4Pz_VqCr-WvxTOc7ish5w.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx"><a class="ae iu" href="https://pixabay.com/photos/greece-parthenon-temple-ruins-1594689/" rel="noopener ugc nofollow" target="_blank">https://pixabay.com/photos/greece-parthenon-temple-ruins-1594689/</a></figcaption></figure><p id="6254" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我想提出一个非常简单的问题。</p><blockquote class="ju jv jw"><p id="f71d" class="iv iw jt ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated"><strong class="ix hj"> <em class="hi">有没有更快创建API的新方法？</em> </strong></p></blockquote><h1 id="9b3a" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">经典的方式</h1><p id="2318" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">通常，我们使用一些框架来创建API，即使它们实际上是MVC框架。或者，如果您是Node.js开发人员，可以从简单的Express服务器开始。我们可以选择许多不同的库和工具。但是，在开发API时，我们有两个不同的任务；实现业务逻辑，一遍又一遍地编写相同的代码。</p><p id="51e5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这么多年后，我问自己，我能不能创建一个健壮的结构来处理API的所有公共特性。我的意思是，不同的方式或方法…</p><h1 id="4afe" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">相同和不同的东西</h1><p id="1599" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">让我们想想你在职业生涯中创造的API。很可能，他们有一些共同的模式。至少，一个实体——一个用户实体——应该有基本的CRUD操作。此外，我很确定在某个地方你需要一些扩展的查询功能。但事情并不简单。有几种设计模式可以用在API设计上。我们正在尽可能地实现它们，这样我们就能有好的、可靠的API。</p><p id="f3c6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，没有人会使用相同的API，因为我们有不同的业务逻辑。因此，我们应该在某个地方设置一个断点，将业务逻辑和共享功能分开。</p><p id="fc74" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">经过这些思考，我有了一个想法，目前我正在努力。</p><h1 id="3d3e" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">首先定义</h1><p id="af78" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">让我们考虑一个用户实体。对于那个实体，你可能想要不同的东西。例如，您可能需要以下功能:</p><ul class=""><li id="c1c5" class="ld le hi ix b iy iz jc jd jg lf jk lg jo lh js li lj lk ll bi translated">创建一个简单的CRUD</li><li id="e235" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">仅允许创建和更新请求的特定字段。</li><li id="6a6f" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">使用一些表单验证来确保用户发送了正确的数据。</li><li id="a0d7" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">对用户隐藏一些秘密数据，如密码散列。</li><li id="f2f9" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">开发扩展查询功能。</li><li id="a6fb" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">在创建过程中应用一些特殊的业务逻辑。</li><li id="2bca" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">等等。</li></ul><p id="d0ad" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以在这个列表中添加更多的东西，但这足以理解我的想法。要为用户实体创建API，让我们创建一个模型文件。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="cd12" class="ma kb hi lw b fi mb mc l md me">class User {<br/>  get fillable() {<br/>    return ["email", "name"];<br/>  }<br/><br/>  get validations() {<br/>    return {<br/>      email: "required|email",<br/>      name: "required",<br/>    };<br/>  }<br/>}</span></pre><p id="9a25" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这不是ORM模型。这只是我们想要的默认特性的定义。如果在你创建了那个模型之后，你可以得到完全工作的API，仅仅是根据你的定义，会怎么样呢？</p><p id="3043" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">嗯，我已经工作了很长时间来创造这样的东西。它被命名为<a class="ae iu" href="https://axe-api.github.io/" rel="noopener ugc nofollow" target="_blank"> Axe API </a>，一种快速创建Rest APIs新方法。</p><p id="f422" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Axe API 希望您提供模型定义。<em class="jt"> Axe API </em>提供了一个健壮的、有效的API，当你定义模型的特性时，比如验证规则、可填充的字段、选定的处理程序(CRUD)以及彼此之间的关系。但不仅仅如此。它为您在HTTP请求的每一步中实现业务逻辑提供了许多转义点。神奇的结果是，您可以为您拥有的每个模型提供非常扩展的查询功能。</p><h1 id="022d" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">入门指南</h1><p id="7868" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">让我们仔细看看，想出这样一个简单的模型；</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="5b58" class="ma kb hi lw b fi mb mc l md me">import { Model } from "axe-api";<br/><br/>class User extends Model {<br/>}<br/><br/>export default User;</span></pre><p id="2bea" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">恭喜你。您已经创建了自己的API！很简单，对吧？现在您有了基本的CRUD请求。</p><p id="6f7f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是，让我们添加更多的功能。让我们选择哪些字段将由用户填写。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="d9bf" class="ma kb hi lw b fi mb mc l md me">class User extends Model {<br/>  get fillable() {<br/>    return {<br/>      POST: ["email", "name"],<br/>      PUT: ["name"],<br/>    };<br/>  }<br/>}</span></pre><p id="4b81" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们不只是选择哪些字段是可填写的。我们还选择了哪些字段可以在哪些HTTP请求中填充。您的创建和更新请求现在是安全的。</p><p id="816d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们更进一步，为创建添加表单验证规则。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="e19f" class="ma kb hi lw b fi mb mc l md me">class User extends Model {<br/>  get fillable() {<br/>    return {<br/>      POST: ["email", "name"],<br/>      PUT: ["name"],<br/>    };<br/>  }<br/><br/>  get validations() {<br/>    return {<br/>      email: "required|email",<br/>      name: "required|max:50",<br/>    };<br/>  }<br/>}</span></pre><p id="4270" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就是这样。用户应该发送正确的数据。</p><p id="ade5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但现在，是时候深入思考了。如果你有两个相关的模型，比如用户和帖子。让我们在模型定义中将它们绑定在一起。</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="792c" class="ma kb hi lw b fi mb mc l md me">class User extends Model {<br/>  posts() {<br/>    return this.hasMany("Post", "id", "user_id");<br/>  }<br/>}<br/><br/>class Post extends Model {<br/>  user() {<br/>    return this.belongsTo("User", "user_id", "id");<br/>  }<br/>}</span></pre><p id="6d9d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">定义之后，Axe API将为您创建所有相关的路线。你能相信你会自动拥有以下路线吗？</p><ul class=""><li id="c877" class="ld le hi ix b iy iz jc jd jg lf jk lg jo lh js li lj lk ll bi translated"><code class="du mf mg mh lw b">GET api/users</code></li><li id="3c73" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mf mg mh lw b">POST api/users</code></li><li id="ad6f" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mf mg mh lw b">GET api/users/:id</code></li><li id="9938" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mf mg mh lw b">PUT api/users/:id</code></li><li id="d000" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mf mg mh lw b">DELETE api/users/:id</code></li><li id="0d26" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mf mg mh lw b">GET api/users/:usedId/posts</code></li><li id="c363" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mf mg mh lw b">POST api/users/:usedId/posts</code></li><li id="e481" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mf mg mh lw b">GET api/users/:usedId/posts/:id</code></li><li id="7d41" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mf mg mh lw b">PUT api/users/:usedId/posts/:id</code></li><li id="f182" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mf mg mh lw b">DELETE api/users/:usedId/posts/:id</code></li></ul><h1 id="60ae" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">业务逻辑</h1><p id="548a" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">也许我能听到你说“是的，看起来不错，但是我们有不同的逻辑。例如，在用户创建中，我应该可以给密码加盐。”</p><p id="953e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是你不知道的是Axe API为HTTP请求的每一层都提供了钩子。让我们像这样为模型创建一个<code class="du mf mg mh lw b">UserHooks.js</code>文件；</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="4bf2" class="ma kb hi lw b fi mb mc l md me">import bcrypt from "bcrypt";<br/><br/>const onBeforeInsert = async ({ formData }) =&gt; {<br/>  // Genering salt<br/>  formData.salt = bcrypt.genSaltSync(10);<br/>  // Hashing the password<br/>  formData.password = bcrypt.hashSync(formData.password, salt);<br/>};<br/><br/>export { onBeforeInsert };</span></pre><p id="d7f6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个函数将在创建过程之前由Axe API触发。但不仅仅如此。Axe API为您提供了以下所有钩子；</p><ul class=""><li id="c3eb" class="ld le hi ix b iy iz jc jd jg lf jk lg jo lh js li lj lk ll bi translated">onBeforeInsert</li><li id="85f5" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">onBeforeUpdateQuery</li><li id="0db2" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">onBeforeUpdate</li><li id="cecb" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">onbeforededeletequery</li><li id="422a" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">onbeforededelete</li><li id="ff2f" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">onBeforePaginate</li><li id="80c1" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">onBeforeShow</li><li id="3b9c" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">onAfterInsert</li><li id="8917" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">onAfterUpdateQuery</li><li id="7587" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">onAfterUpdate</li><li id="5cd9" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">onAfterDeleteQuery</li><li id="acb0" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">onAfterDelete</li><li id="e818" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">onAfterPaginate</li><li id="bbb0" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">午后秀</li></ul><h1 id="92dc" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">扩展查询功能</h1><p id="a8b3" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">我之前说过，创建这样的框架有很多好处。比如说；扩展查询。一旦你定义了你的模型，它就可以被查询了。您可以发送如下查询:</p><pre class="lr ls lt lu fd lv lw lx ly aw lz bi"><span id="f928" class="ma kb hi lw b fi mb mc l md me">GET /api/users<br/>  ?q=[[{"name": "John"}],[{"$or.age.$gt": 18}, {"$and.id": 666 }]]<br/>  &amp;fields:id,name,surname<br/>  &amp;sort=surname,-name<br/>  &amp;with=posts{comments{id|content}}<br/>  &amp;page=2<br/>  &amp;per_page=25</span></pre><p id="3c9a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过这个查询，您可以询问以下内容:</p><ul class=""><li id="6d57" class="ld le hi ix b iy iz jc jd jg lf jk lg jo lh js li lj lk ll bi translated">如果<code class="du mf mg mh lw b">name</code>为“John”或<code class="du mf mg mh lw b">age</code>大于18且<code class="du mf mg mh lw b">id</code>为666，则获取数据。</li><li id="a916" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">仅返回<code class="du mf mg mh lw b">id</code>、<code class="du mf mg mh lw b">name</code>和<code class="du mf mg mh lw b">surname</code>字段。</li><li id="20a1" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">首先按<code class="du mf mg mh lw b">surname</code>排序(ASC)，其次按<code class="du mf mg mh lw b">name</code>排序(DESC)。</li><li id="5909" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">用相关的<code class="du mf mg mh lw b">comments</code>数据获取相关的<code class="du mf mg mh lw b">posts</code>数据。但是在<code class="du mf mg mh lw b">comments</code>对象中，只取<code class="du mf mg mh lw b">id</code>和<code class="du mf mg mh lw b">content</code>字段。</li><li id="f39c" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">每页取25行。</li><li id="31b2" class="ld le hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">取第二页。</li></ul><p id="13dd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">无论何时创建模型，您都可以拥有这些扩展的查询功能。你不能说你不喜欢它！</p><h1 id="3fe3" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">下一步是什么？</h1><p id="2789" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">嗯，还有很多功能我可以说说。但是我不打算创建另一个关于它的文档，因为我已经做了。请访问<a class="ae iu" href="https://axe-api.github.io/" rel="noopener ugc nofollow" target="_blank"> Axe API文档</a>页面。你可能会发现关于这个项目的许多细节。</p><p id="5e29" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我正在征求每个有话要说的人的反馈。每当我想到这个项目，我都会因为它的潜力而兴奋不已。希望你也有同样的感受。</p><p id="5cd3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">另外，请记住<strong class="ix hj"> Axe API </strong>还没有准备好用于生产，它处于测试阶段。</p><p id="9630" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以在<a class="ae iu" href="https://github.com/axe-api/axe-api" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上启动这个项目，并获得新闻通知。</p><blockquote class="ju jv jw"><p id="0532" class="iv iw jt ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated"><em class="hi">感谢</em> <a class="ae iu" href="https://pixabay.com/photos/greece-parthenon-temple-ruins-1594689/" rel="noopener ugc nofollow" target="_blank"> <em class="hi">封面图片</em> </a></p></blockquote></div></div>    
</body>
</html>