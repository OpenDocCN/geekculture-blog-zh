<html>
<head>
<title>Start Your Scripting Journey Today | Bash Script — Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">立即开始您的脚本之旅| Bash脚本—第3部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/start-your-scripting-journey-today-bash-script-part-3-9779ac0abea2?source=collection_archive---------4-----------------------#2022-11-02">https://medium.com/geekculture/start-your-scripting-journey-today-bash-script-part-3-9779ac0abea2?source=collection_archive---------4-----------------------#2022-11-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="574c" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">编写Bash脚本需要知道的一切</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/cfafbf920cdaa270f085d058a75d5deb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tyPuluLkhP923OTD"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@daria_kraplak?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Daria Kraplak</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="6a8e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">以前的零件</h2><p id="25f3" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated"><strong class="ko hj">第1部分:</strong> <a class="ae jn" href="https://levelup.gitconnected.com/start-your-scripting-journey-today-bash-script-part-1-46cbddf4e4e7" rel="noopener ugc nofollow" target="_blank">立即开始您的脚本之旅| Bash脚本—第</a> 1部分<br/> <strong class="ko hj">第2部分:</strong> <a class="ae jn" rel="noopener" href="/geekculture/start-your-scripting-journey-today-bash-script-part-2-4d93ecb59249">立即开始您的脚本之旅| Bash脚本—第</a> 2部分</p><h2 id="f86a" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">Crontab概述</h2><p id="3148" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated">到目前为止，我们已经看到了如何编写bash脚本。在这一部分，我们将了解如何安排任务。在计划任务下，我们可以运行命令或脚本。</p><p id="0895" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">cron 实用程序是最受支持的任务调度实用程序。任何通过crons调度的任务都被称为<strong class="ko hj"> cron作业</strong>。Cron作业帮助我们自动化日常任务，无论是每小时、每天、每月还是每年。<strong class="ko hj"> crontab </strong>是我们希望定期运行的命令列表。</p><p id="3c2c" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">要查看我们如何安排cron作业:</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="f55c" class="jo jp hi ll b fi lp lq l lr ls"><strong class="ll hj">cat /etc/crontab</strong></span></pre><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="c2ad" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">示例:</strong></p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="e4c4" class="jo jp hi ll b fi lp lq l lr ls"><em class="lv">“At minute 5.”</em></span><span id="abb7" class="jo jp hi ll b fi lw lq l lr ls"><strong class="ll hj">*/5 * * * *  </strong></span><span id="b301" class="jo jp hi ll b fi lw lq l lr ls">next at 2022-10-05<strong class="ll hj"> 20:05:00</strong><br/>then at 2022-10-05<strong class="ll hj"> 21:05:00</strong></span><span id="f43b" class="jo jp hi ll b fi lw lq l lr ls">---------------------</span><span id="4c84" class="jo jp hi ll b fi lw lq l lr ls"><em class="lv">“At every 5th minute.”</em></span><span id="e99a" class="jo jp hi ll b fi lw lq l lr ls"><strong class="ll hj">*/5 * * * *  </strong></span><span id="c02e" class="jo jp hi ll b fi lw lq l lr ls">next at 2022-10-05<strong class="ll hj"> 19:55:00</strong><br/>then at 2022-10-05 <strong class="ll hj">20:00:00</strong></span><span id="d2dd" class="jo jp hi ll b fi lw lq l lr ls">---------------------</span><span id="b995" class="jo jp hi ll b fi lw lq l lr ls"><em class="lv">“At 01:00 on every day-of-month from 1 through 7.”</em></span><span id="8981" class="jo jp hi ll b fi lw lq l lr ls"><strong class="ll hj">0 1 1-7 * *  </strong></span><span id="396d" class="jo jp hi ll b fi lw lq l lr ls">next at <strong class="ll hj">2022-10-06 01:00:00</strong><br/>then at <strong class="ll hj">2022-10-07 01:00:00<br/>...</strong></span></pre><p id="fbf6" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">我们可以使用<a class="ae jn" href="https://cronitor.io/cron-job-monitoring?utm_source=crontabguru&amp;utm_campaign=cronitor_top" rel="noopener ugc nofollow" target="_blank"><strong class="ko hj">Cronitor</strong></a><strong class="ko hj">或</strong> <a class="ae jn" href="https://www.generateit.net/cron-job/" rel="noopener ugc nofollow" target="_blank"> <strong class="ko hj">生成cron调度表达式</strong> </a></p><p id="0463" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">重要命令:</strong></p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="6023" class="jo jp hi ll b fi lp lq l lr ls"><strong class="ll hj">crontab -l </strong>           # List the jobs for the current user.<br/><strong class="ll hj">crontab -r </strong>           # Remove all jobs for the current users.<br/><strong class="ll hj">crontab -e </strong>           # Edit jobs for the current user.<br/><strong class="ll hj">crontab -e</strong> <strong class="ll hj">-u &lt;user&gt;</strong>  # Edit jobs for the specified user.<br/><strong class="ll hj">crontab -l -u &lt;user&gt;  </strong># List the jobs for the specified user.<br/><strong class="ll hj">crontab -r -u &lt;user&gt;  </strong># Remove all jobs for the specified users.</span></pre><p id="2ded" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">添加作业:</strong></p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="c434" class="jo jp hi ll b fi lp lq l lr ls"><strong class="ll hj">$</strong> crontab -e</span><span id="b270" class="jo jp hi ll b fi lw lq l lr ls">#add the following line to run the command every 5 minutes<br/><strong class="ll hj">*/5 * * * *</strong> echo "testing" &gt;&gt; /home/admin/bash_script/cron.txt</span></pre><p id="5fa3" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">在crontab中添加上述定义的作业后，每隔5分钟将向名为<strong class="ko hj"> cron.txt. </strong>的文本文件中写入一个文本“测试”</p><h2 id="77f3" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">任务— 1</h2><p id="34c4" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated">假设，您必须监控一个Linux服务器。如果内存使用达到一定水平，您必须重启服务器。换句话说，如果空闲内存低于某个值，服务器应该重新启动。</p><p id="e2be" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">现在，创建一个脚本来执行上述任务，并通过向crontab添加一个作业来安排拍摄。</p><p id="5f2d" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">脚本:</strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="5412" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">添加玉米作业:</strong></p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="8381" class="jo jp hi ll b fi lp lq l lr ls"><strong class="ll hj">$ </strong>crontab -e </span><span id="de03" class="jo jp hi ll b fi lw lq l lr ls">#add the following line to run the script every 10 minutes<br/><strong class="ll hj">*/10 * * * *</strong> /home/ec2-user/bash_script/reboot.sh</span></pre><p id="7933" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">列出所有工作:</strong></p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="346a" class="jo jp hi ll b fi lp lq l lr ls"><strong class="ll hj">$</strong> crontab -l </span><span id="6dd7" class="jo jp hi ll b fi lw lq l lr ls">#add the following line to run the command every 5 minutes<br/><strong class="ll hj">*/5 * * * *</strong> echo "testing" &gt;&gt; /home/admin/bash_script/cron.txt</span><span id="5e92" class="jo jp hi ll b fi lw lq l lr ls">#add the following line to run the script every 10 minutes<br/><strong class="ll hj">*/10 * * * *</strong> /home/admin/bash_script/reboot.sh</span></pre></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><h2 id="d998" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">远程脚本执行</h2><p id="be2d" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated"><strong class="ko hj">基于密钥的SSH通信:<br/> </strong>假设我们要在两台服务器之间配置一个基于密钥的通信。为了更好地理解，我们将服务器命名为server1和server2。</p><p id="24b8" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">我们的目标是建立从server1到server2的基于密钥的SSH通信。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="dee0" class="jo jp hi ll b fi lp lq l lr ls"># Generate public key and private key for server1<br/><strong class="ll hj">server1~ $ </strong>ssh-keygen</span><span id="9bbe" class="jo jp hi ll b fi lw lq l lr ls"># Share the server1’s public key with server2<br/><strong class="ll hj">server1~ $ </strong>ssh-copy-id  -i  ~/.ssh/id_rsa.pub user@server2<br/>  <br/># Check the connection<br/><strong class="ll hj">server1~ $</strong> ssh user@server2</span></pre><p id="217f" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">在服务器之间共享脚本<br/> </strong>如果我们想通过SSH连接执行脚本，那么我们必须事先与目标服务器共享脚本。</p><p id="3f66" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">让我们使用SCP(安全复制协议)与server2共享以下脚本。使用该脚本，我们可以检索相应服务器的磁盘使用信息。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="efad" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">脚本分享:</strong></p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="b8f7" class="jo jp hi ll b fi lp lq l lr ls"># Sharing script from server1 to server2<br/><strong class="ll hj">server1~ $</strong> scp ~/disk_update.sh   user@server2:~/tmp/</span></pre><p id="86bf" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">从远程服务器执行脚本</strong></p><p id="8127" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">现在，是时候执行我们与server2共享的脚本了。但是我们将通过SSH连接从server1执行脚本。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="2a87" class="jo jp hi ll b fi lp lq l lr ls"><strong class="ll hj">server1~ $</strong> ssh user@server2 bash /tmp/disk-update.sh</span><span id="cd66" class="jo jp hi ll b fi lw lq l lr ls">------------------ OUTPUT ----------------------<br/>server2</span><span id="59c5" class="jo jp hi ll b fi lw lq l lr ls">Total Used Use%<br/>106687M 4947M 5%</span></pre><h2 id="f951" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">任务— 2</h2><p id="c808" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated">想象一个环境，我们有数百台服务器。我们的任务是通过检索所有服务器的磁盘使用情况来创建报告。在这种情况下，我们可以编写一些脚本来从数百台服务器中检索磁盘使用信息。</p><p id="1dca" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">步骤1: </strong>创建一个名为<strong class="ko hj"> serverinfo </strong>的文本文件，并用用户名和相应的服务器IP或主机名填充它。<br/> <strong class="ko hj">例如:</strong>管理员@服务器1或管理员@10.3.98.23</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="4010" class="jo jp hi ll b fi lp lq l lr ls"><strong class="ll hj">serverinfo</strong></span><span id="26cb" class="jo jp hi ll b fi lw lq l lr ls">admin@server2<br/>superuser@server3<br/>testuser@server4<br/>...<br/>...</span></pre><p id="6f50" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">步骤2: </strong>编写一个从服务器获取磁盘使用信息的脚本。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="d3c8" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">第三步:</strong>编写一个脚本，将上面创建的脚本执行到多台服务器上，并生成一个包含多台服务器磁盘使用信息的报告:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="56f5" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">执行上述脚本后生成的报告—</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="12a5" class="jo jp hi ll b fi lp lq l lr ls"><strong class="ll hj">server1~ $ cat report.txt</strong></span><span id="02d1" class="jo jp hi ll b fi lw lq l lr ls">-----------------------<br/>server2</span><span id="742c" class="jo jp hi ll b fi lw lq l lr ls">Total Used Use%<br/>133071M 7802M 6%<br/>-----------------------</span><span id="172b" class="jo jp hi ll b fi lw lq l lr ls">-----------------------<br/>server3</span><span id="0632" class="jo jp hi ll b fi lw lq l lr ls">Total Used Use%<br/>65372M 1508M 3%<br/>-----------------------<br/>...<br/>...</span></pre></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><blockquote class="me mf mg"><p id="c011" class="km kn lv ko b kp lf ij kr ks lg im ku mh lh kw kx mi li kz la mj lj lc ld le hb bi translated"><em class="hi">如果你觉得这篇文章很有帮助，请</em> <strong class="ko hj"> <em class="hi">别忘了</em> </strong> <em class="hi">去点击</em> <strong class="ko hj"> <em class="hi">跟随</em></strong><em class="hi"/><strong class="ko hj"><em class="hi">拍拍</em> </strong> <em class="hi">按钮帮我写更多这样的文章。<br/> </em> <strong class="ko hj"> <em class="hi">谢谢🖤 </em> </strong></p></blockquote></div></div>    
</body>
</html>