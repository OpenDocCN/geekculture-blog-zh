<html>
<head>
<title>Automated Triangular Arbitrage of Cryptos in 4 steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">密码的自动化三角套利分4步进行</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/automated-triangular-arbitrage-of-cryptos-in-4-steps-a678f7b01ce7?source=collection_archive---------0-----------------------#2022-03-03">https://medium.com/geekculture/automated-triangular-arbitrage-of-cryptos-in-4-steps-a678f7b01ce7?source=collection_archive---------0-----------------------#2022-03-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a520" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用Python构建自己的套利交易算法</p><h1 id="1682" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">介绍</h1><p id="b06c" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">套利利用了市场上资产价格的差异。套利已经在外汇市场上做了很多年，但考虑到加密市场的波动性，它也可以应用于加密市场。套利机会可能存在于同一交易所内，也可能存在于不同交易所之间。</p><p id="d109" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">三角套利是一种试图同时利用三种不同资产价格差异的技术。例如，我们可以用BTC换USDT，用BTC换瑞士联邦理工学院，再用瑞士联邦理工学院换回USDT。如果同时做这三笔交易的净值是盈利的，那么这三笔交易同时执行。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/f308a3865d63a42a1891c0037fd45de2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pISdd-bTopMAI19k905AQQ.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx"><strong class="bd jf">Example of Triangular Arbitrage</strong> (Image by Author)</figcaption></figure><p id="64aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将探讨同一交易所内的套利机会，特别是我们将深入探讨三角套利方法。重点是开发和实现一个交易算法，它可以识别利润并触发所需的交易订单。</p><p id="52db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与买卖时机至关重要的传统交易相比，套利被认为是一种风险较低的交易方式。此外，在套利交易中，由于所有要求的交易都是同时执行的，因此盈利/亏损可以立即得知。</p><h1 id="94c6" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">三角套利的方法</h1><p id="e912" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">有不同的买卖3种资产的方法来实现三角套利。在本文中，我们将考虑两种方法。</p><h2 id="ac0e" class="kw je hi bd jf kx ky kz jj la lb lc jn iq ld le jr iu lf lg jv iy lh li jz lj bi translated">方法1:买—买—卖</h2><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lk"><img src="../Images/92bba2d5aed0fa76298d76d8453f53c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KtlGzVKSe_7EH6T3JeFtXQ.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx"><strong class="bd jf">BUY-BUY-SELL Approach of Triangle Arbitrage</strong> (Image by Author)</figcaption></figure><p id="762f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的例子中，我们从USDT作为初始投资开始。在完成这3笔交易后，我们最后又剩下USDT了。以下是将要执行的交易:</p><ol class=""><li id="115f" class="ll lm hi ih b ii ij im in iq ln iu lo iy lp jc lq lr ls lt bi translated">用系绳(USDT)买比特币(BTC)</li><li id="ca57" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">用比特币购买以太坊(ETH)(BTC)</li><li id="720c" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">出售以太坊(ETH)的系绳(USDT)</li></ol><p id="0038" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在第三次交易结束时，我们可以比较最终的USDT和我们在第一步开始的初始投资。如果这导致了可观的利润，那么这三笔交易可以同时开始。</p><h2 id="81f3" class="kw je hi bd jf kx ky kz jj la lb lc jn iq ld le jr iu lf lg jv iy lh li jz lj bi translated">方法2:买—卖—卖</h2><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lz"><img src="../Images/4796b1e13b130a1f110a8a855c60c6f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FUzmvymbqCrWZrDdGxmVNw.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx"><strong class="bd jf">BUY-SELL-SELL Approach of Triangle Arbitrage</strong> (Image by Author)</figcaption></figure><p id="0677" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与第一种方法类似，相同的资产用于检查不同流程中的套利机会。在上述示例中，评估了以下3个交易:</p><ol class=""><li id="501e" class="ll lm hi ih b ii ij im in iq ln iu lo iy lp jc lq lr ls lt bi translated">购买以太坊(ETH)带系绳(USDT)</li><li id="16c8" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">卖以太坊(ETH)换比特币(BTC)</li><li id="9cd7" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">卖比特币(BTC)换系绳(USDT)</li></ol></div><div class="ab cl ma mb gp mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hb hc hd he hf"><h1 id="bcaf" class="jd je hi bd jf jg mh ji jj jk mi jm jn jo mj jq jr js mk ju jv jw ml jy jz ka bi translated">交易算法——4步实施</h1><p id="de6b" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">下面是实施三角套利交易算法的不同步骤的概述。我们将在接下来的章节中详细研究这些步骤。</p><blockquote class="mm mn mo"><p id="8916" class="if ig mp ih b ii ij ik il im in io ip mq ir is it mr iv iw ix ms iz ja jb jc hb bi translated">第一步:获取所有有效的加密组合<br/>第二步:执行三角套利<br/>第三步:下达交易订单<br/>第四步:捆绑在一起</p></blockquote><p id="f24f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在进行这些步骤之前，我们需要初始化交易所来进行套利。选择您拥有交易账户的交易所以及支持api交易的交易所。在这个例子中，我使用了WazirX交易所，因为我在这个交易所有一个交易账户。</p><pre class="kh ki kj kk fd mt mu mv mw aw mx bi"><span id="9906" class="kw je hi mu b fi my mz l na nb">import ccxt<br/>from config import myconfig<br/>exchange = ccxt.wazirx({<br/>                         “apiKey”: myconfig.API_KEY,<br/>                         “secret”: myconfig.API_SECRET<br/>                       })</span></pre><p id="2a27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ccxt包支持各种交易所，如果您在任何其他交易所都有帐户，那么您只需在上面的代码片段中更改交易所的名称，就可以获得相同的代码。参考此<a class="ae nc" href="https://github.com/ccxt/ccxt/wiki/Exchange-Markets" rel="noopener ugc nofollow" target="_blank">页面</a>获取ccxt支持的交易所列表。</p><h1 id="2ecc" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">步骤1:获取所有有效的加密组合</h1><p id="5344" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">我们需要一个基础货币与我们的交易账户开始投资。这里我们认为USDT是基础货币。请注意，即使是法定货币，如印度卢比或美元，也可以被视为基础货币。</p><p id="99a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">交易所支持数百种密码，因此我们可以衍生出不同的组合来执行三角套利。我们可以对有限的组合集进行硬编码，或者允许代码考虑交换中所有可能的组合。下面的代码片段实现了识别所有可能的套利组合的第二种方法。</p><p id="37ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在撰写本文时，该交易所支持543种加密资产。</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="nd ne l"/></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es nf"><img src="../Images/180b57b6b06e55c20e49b7836d9164e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KSp7kAn3_JniUWTVOa0H2g.png"/></div></div></figure><p id="a707" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来提取所有可能的组合来应用三角套利的买-买-卖和买-卖-卖方法。</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="nd ne l"/></div></figure><p id="443c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码能够识别63种不同的套利组合。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ng"><img src="../Images/58dde32cd8ed26fca8792371c26e1ad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mmof9Lbb4h_w0q7gy1Q_8A.png"/></div></div></figure><p id="23c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如:如果必须在第一笔交易中应用买-买-卖算法，则:</p><ol class=""><li id="da10" class="ll lm hi ih b ii ij im in iq ln iu lo iy lp jc lq lr ls lt bi translated">为USDT(基础)购买BTC(中级)</li><li id="275a" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">为BTC(中级)购买XRP(股票代码)</li><li id="692e" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">为USDT出售XRP股票(股票代码)</li></ol><p id="9e17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果这种循环交易可以带来利润，那么我们可以同时执行这三种交易。</p><h1 id="7c62" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">第二步:进行三角套利</h1><p id="81e9" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">从交换中提取三种资产的价格，并在执行三次买/卖转换后确定最终价格。</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="nd ne l"/></div></figure><p id="f838" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同样，购买-销售-销售方法也需要实施。为了避免代码拥挤，这里只提供了一段代码。请参考文章末尾链接的git存储库，以获得完整的可执行代码。</p><p id="b2f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过考虑交易所对每笔交易的佣金和交易的最低预期利润，计算执行三角套利的利润/损失。</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="nd ne l"/></div></figure><h1 id="8a2c" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">第三步:下交易订单</h1><p id="163f" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">下面是在交易所执行这三笔交易的代码。如果交易所不支持市价交易，则需要执行限价交易。如果价格在订单执行前波动，限价订单有时会导致交易订单被卡住。</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="nd ne l"/></div></figure><h1 id="f4ea" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">第四步:捆绑在一起</h1><p id="eada" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">将上述步骤打包成一个包，并对所有可能的组合运行它。</p><p id="1824" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于每个组合，执行以下3个步骤<br/>(例如:购买——BTC/USDT，出售——ETH/BTC，出售——ETH/USDT)</p><ol class=""><li id="3096" class="ll lm hi ih b ii ij im in iq ln iu lo iy lp jc lq lr ls lt bi translated">在完成3笔交易后，确定最终的卖出价格</li><li id="bfa1" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">计算这些交易的利润/损失</li><li id="441a" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">如果交易带来了期望的利润，则下3个交易订单</li></ol><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="nd ne l"/></div></figure><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="nd ne l"/></div></figure><h1 id="6a05" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">结果</h1><p id="79e9" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">下面是运行此代码一次迭代的示例结果。</p><p id="dc43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">考虑初始投资100美元。通过63个组合和2种方法，总共检查了126个套利组合，其中26个组合的利润如下。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es nh"><img src="../Images/e735aa4c11495136b9df1c0f24eac048.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qMR3_-c2xXSJwgPZqCZY9Q.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx"><strong class="bd jf">Sample Results from Triangular Arbitrage for 1 iteration</strong></figcaption></figure><p id="6ac3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，上表来自日志，而不是来自实际执行的交易。尽管这张表显示了一个美好的数字，但在现实中，它可能并不总是一帆风顺的。</p><h1 id="4b9d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">为什么这可能是一个颠簸的旅程…</h1><ol class=""><li id="a9a8" class="ll lm hi ih b ii kb im kc iq ni iu nj iy nk jc lq lr ls lt bi translated">由于所有三个订单需要同时执行才能实现利润，因此由于网络延迟或交易所的问题，有些订单可能无法按时执行。在这种情况下，您可能会被密码卡住，可能需要手动干预。</li><li id="8263" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">这里考虑的加密价格是实时报价。在订单执行之前，价格可能会波动。更好的方法是从订单簿中获取条目，并根据数量选择报价。</li><li id="4f54" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">交易所同时需要三个股票价格来执行三角套利。一些交易所设置了不允许重复api调用的速率限制。在这种情况下，api可能会抛出ratelimitexceed(HTTP 429太多请求)异常。<strong class="ih hj"> </strong>这可以通过在api调用之间使用1秒钟的睡眠定时器来处理。但是如果价格在几秒钟内发生变化，订单可能无法执行。</li><li id="d810" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">一些交易所不允许以市价下单(就像我的例子)。需要限价。在这种情况下，由于价格波动，订单也有可能无法执行。</li></ol><h1 id="6a94" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">代码回购</h1><p id="7747" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">参考这个git回购访问完整的代码:<a class="ae nc" href="https://github.com/Lakshmi-1212/TriangularArbitrageCryptos" rel="noopener ugc nofollow" target="_blank">三角任意密码</a></p><h1 id="89fe" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">结论</h1><p id="c71f" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">基于交易所及其提供的api支持，可以进一步调整交易算法。尝试通过改变基础货币、使用市场价格交易或检查其他套利方法来玩弄代码。</p><p id="402b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同样，免责声明，这篇文章只是为了教育的目的，让你了解不同类型的交易选择。记住，你是在和其他几个交易机器人竞争。如果你想在真实交易中进行实验，那么首先要确保你已经建立了一个强大的交易算法，然后再冒险尝试以避免损失。</p><p id="5264" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，如果您对在交易机器人应用程序中包装这些代码感兴趣，可以参考这篇文章:<a class="ae nc" rel="noopener" href="/geekculture/building-a-basic-crypto-trading-bot-in-python-4f272693c375">用Python构建一个基本的加密交易机器人</a></p><p id="7882" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读到最后:-)。快乐实验！！</p></div><div class="ab cl ma mb gp mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hb hc hd he hf"><h2 id="921e" class="kw je hi bd jf kx ky kz jj la lb lc jn iq ld le jr iu lf lg jv iy lh li jz lj bi translated">如果“PYTHON+TRADING”让你着迷，那就看看这些吧…</h2><ul class=""><li id="6619" class="ll lm hi ih b ii kb im kc iq ni iu nj iy nk jc nl lr ls lt bi translated"><a class="ae nc" rel="noopener" href="/geekculture/beginners-guide-to-technical-analysis-in-python-for-algorithmic-trading-19164fb6149"> <em class="mp">算法交易Python技术分析入门</em> </a></li><li id="bbaf" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc nl lr ls lt bi translated"><a class="ae nc" rel="noopener" href="/geekculture/building-a-basic-crypto-trading-bot-in-python-4f272693c375"> <em class="mp">用Python构建一个基本的加密交易机器人</em> </a></li><li id="88c0" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc nl lr ls lt bi translated"><em class="mp">Cryptos的自动化三角套利分4步进行【你在这里】</em></li><li id="d599" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc nl lr ls lt bi translated"><a class="ae nc" rel="noopener" href="/geekculture/identifying-trading-patterns-behavioural-analysis-of-traders-5184dfa0350b"> <em class="mp">识别交易模式——交易者行为分析</em> </a></li><li id="6013" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc nl lr ls lt bi translated"><a class="ae nc" rel="noopener" href="/geekculture/fundamental-analysis-of-stocks-using-python-d5ad050e6372"> <em class="mp">股票基本面分析使用Python </em> </a></li></ul></div></div>    
</body>
</html>