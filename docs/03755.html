<html>
<head>
<title>Why and how to get started with Next auth?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么以及如何开始下一次授权？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/why-and-how-to-get-started-with-next-auth-61740558b45b?source=collection_archive---------4-----------------------#2021-06-15">https://medium.com/geekculture/why-and-how-to-get-started-with-next-auth-61740558b45b?source=collection_archive---------4-----------------------#2021-06-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="be02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Next.js的Google身份验证</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/9f6c2d73065416a496ea01f4d4adde90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DuTXEz3ArM1x6rfM"/></div></div></figure><h2 id="99fd" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">为什么您应该选择下一个身份验证？</h2><p id="374d" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">你可能想知道，如果你已经在使用类似firebase的东西，那么为什么还要使用Next auth呢？原因如下</p><ul class=""><li id="f365" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">使用方便</li><li id="5f61" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">为我们提供了许多身份验证提供商</li><li id="c8c2" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">使用serverSideProps，您可以在用户到达页面时立即获得详细信息，而使用firebase等工具，您可以在几秒钟后获得用户的详细信息。</li><li id="97cb" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">它非常安全，因为它使用HTTP POST + CSRF令牌验证<br/> JWT与JWS / JWE / JWK / JWK</li></ul></div><div class="ab cl ld le gp lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hb hc hd he hf"><h2 id="4f80" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">设置</h2><p id="760f" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">我将使用create-next-app设置一个新的next应用程序。</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="6d82" class="jp jq hi ll b fi lp lq l lr ls">npx create-next-app next-auth-demo</span></pre><p id="01d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">清除</p><p id="53cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我会删除从主页面到页脚的所有内容。</p><p id="6494" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装下一个-授权</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="9440" class="jp jq hi ll b fi lp lq l lr ls">npm i next-auth # npm<br/>yarn add next-auth # yarn</span></pre><h2 id="18a0" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">开始使用下一次授权</h2><p id="c2b7" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">我们将首先在页面中的api文件夹内创建一个名为auth的文件夹。</p><p id="f09f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在该文件夹中创建一个名为[…nextauth]的文件。射流研究…</p><p id="eaa3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将从谷歌认证开始。所以将这段代码添加到您的[…nextauth].js中。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="9e5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将最终像这样配置下一个auth in _app.js</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lt lu l"/></div></figure><h2 id="d8ce" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">谷歌认证</h2><p id="cb06" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">我们将使用firebase为我们创建凭证。我们可以直接使用谷歌云控制台，但我们需要配置额外的东西。</p><p id="c582" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前往<a class="ae lv" href="https://console.firebase.google.com/u/0/" rel="noopener ugc nofollow" target="_blank">火力基地</a>。创建一个新帐户，然后点击添加项目。</p><p id="b584" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">给你的应用取一个名字，然后你可以保留所有的默认设置，点击下一步。</p><p id="26f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到边栏中的“认证”标签。单击开始。点击谷歌登录并启用它。现在只需点击保存。</p><p id="ed9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您再次点击编辑并打开Web SDK配置折叠。你可以看到我们需要的凭证。我在展示我的演示凭证，但你不应该展示你的凭证。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/a92bf8789ee570a0f320dd38633a36f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2esJhM2Gl9HMcaTfpiprLg.png"/></div></div></figure><p id="d571" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们将在文件夹的根目录下创建一个名为. env.local的新文件。在这个文件中，我们将创建两个名为GOOGLE_CLIENT_ID和GOOGLE_CLIENT_SECRET的环境变量。</p><p id="1cf7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在将客户端id和密码复制粘贴到这里。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="9d5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将创建另一个名为NEXTAUTH_URL的变量，它将成为我们的应用程序URL，在开发中它将成为我们的本地主机。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="0c51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加变量后，确保重启服务器。</p><p id="cdb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将在index.js中创建一个登录按钮</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="d827" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，如果我们单击“登录”按钮，它将显示类似以下的错误</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lx lu l"/></div></figure><p id="cd1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在复制错误底部的链接，并将该链接粘贴到一个新的选项卡中。向下滚动，你将能够看到重定向URI的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/e1d51b5fcf9575f4966ca2900074af25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FRv1AgDrMRTDbHO06hhgGw.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">Redirect URIs</figcaption></figure><p id="b977" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在点击添加URI并添加这个</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="db04" class="jp jq hi ll b fi lp lq l lr ls"> <a class="ae lv" href="http://localhost:3000/api/auth/callback/google" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/api/auth/callback/google</a></span></pre><p id="f14f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后点击保存。如果你尝试登录。您现在可以登录了。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lx lu l"/></div></figure><h2 id="f776" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">获取用户信息</h2><p id="309d" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">我们将首先在客户机上获取数据，然后看看如何用serverSideProps获取数据。</p><p id="632e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了在客户端获取用户信息，我们将使用useSession钩子。</p><p id="2667" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">useSession钩子给了我们一个Session对象，里面有用户的信息。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="7e8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们看看登录后会得到什么</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lx lu l"/></div></figure><p id="915a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果用户已经登录，我们希望有一个注销按钮。因此，如果没有用户，我们将有一个登录按钮，如果有用户，我们将有一个退出按钮。</p><p id="fb8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以像这样创建一个三元运算符</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="74eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后从下一个身份验证/客户端导入注销。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lt lu l"/></div></figure><h2 id="232b" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">获取服务器上的用户数据</h2><p id="a1f0" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">我们将使用serverSideProps创建一个函数，通过会话获取用户详细信息。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="eb97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将从next-auth/client导入getSession，而不是导入useSession</p><pre class="je jf jg jh fd lk ll lm ln aw lo bi"><span id="3332" class="jp jq hi ll b fi lp lq l lr ls">import { getSession, signIn, signOut } from "next-auth/client";</span></pre><p id="1fb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它现在将立即获取数据，没有延迟。</p><h2 id="56c2" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">部署</h2><p id="2926" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">我将创建一个新的GitHub库，并将代码推送到那里。如果你不了解git和GitHub。查看我的<a class="ae lv" href="https://avneeshagarwal.medium.com/git-and-github-crash-course-b44f4885ff66" rel="noopener"> Git和Github速成班</a>。</p><p id="0af1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后去<a class="ae lv" href="https://vercel.com/" rel="noopener ugc nofollow" target="_blank">威瑟尔</a></p><ul class=""><li id="b300" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">注册你的GitHub</li><li id="0416" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">点击创建一个新项目</li><li id="85bc" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">导入您创建的存储库</li><li id="df8c" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">单击部署</li></ul><p id="8915" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您的站点现在将被部署，但身份验证将不起作用。</p><p id="b8af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加环境变量。</p><ul class=""><li id="dc79" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">网站部署后，进入当前应用程序的仪表板，点击设置，然后环境变量。</li><li id="dc7c" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">添加Google client id和Google client secret，它们存在于我们的. env.local文件中。</li><li id="05f9" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">在你添加了这两个之后，它看起来就像这样。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/c70e5549bb203f1560ca37454d6c504a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R1Red506lKDMk_QD9tqe_Q.png"/></div></div></figure><ul class=""><li id="4279" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">我们将添加另一个变量，这是我们的下一个auth URL，它将是部署的URL，而不是本地主机。</li><li id="f9fc" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">要获取URL，请单击domains并获取最短的链接，然后将其添加到NEXTAUTH_URL变量中。这将类似于https://next-auth-demo-lemon.vercel.app/的<a class="ae lv" href="https://next-auth-demo-lemon.vercel.app/" rel="noopener ugc nofollow" target="_blank"/></li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es me"><img src="../Images/6e06b1de4329a2ac2ced636832c8b0d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dzink2UGLy_bnjLpb2mvJA.png"/></div></div></figure><ul class=""><li id="7b07" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">最后，转到标题中选项卡上的“部署”选项卡。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mf"><img src="../Images/7b97d4fab3f974bcfa1bb3116ff504be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*IthJ2R0mArpwRmN4VTFvpg.png"/></div></figure><ul class=""><li id="394a" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">点击最新版本，并按下重新部署。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mg"><img src="../Images/693605036a9fd3d2f69815a47a5624c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q3CtaQoRaxCV4s7m6jjC3A.png"/></div></div></figure><h2 id="e6e0" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">将URI添加到谷歌</h2><p id="30ec" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">重新部署后，尝试再次登录，它会显示一个错误。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mh"><img src="../Images/21180dab47b2088e08075499d8024fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*6s_4D8W1rPeLdK-tJCFFKA.png"/></div></figure><ul class=""><li id="261a" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">转到错误底部的URL。</li><li id="0a7f" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">创建一个新的URI，并将链接粘贴到“请求中的重定向URI”之后，在我的例子中是https://next-auth-demo-lemon . vercel . app/API/auth/callback/Google。</li></ul><p id="824a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的认证现在运行良好</p><p id="2798" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">祝贺你🥳.您已经使用下一个身份验证创建了您的第一个Google登录。如果您想定制登录页面，点击<a class="ae lv" href="https://javascript.plainenglish.io/how-to-create-a-custom-sign-in-page-in-next-auth-1612dc17beb7" rel="noopener ugc nofollow" target="_blank">此处</a>。如果您想添加Auth0认证，请点击此处的<a class="ae lv" href="https://javascript.plainenglish.io/how-to-authenticate-users-with-auth0-in-next-auth-9c1160ce48a8" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="7351" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我知道，如果你想看到任何其他类型的认证😉。</p><p id="b244" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有用的链接-</p><p id="32cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lv" href="https://github.com/avneesh0612/next-auth-demo" rel="noopener ugc nofollow" target="_blank"> Github库</a></p><p id="e742" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lv" href="https://nextjs.org/docs" rel="noopener ugc nofollow" target="_blank"> NextJS docs </a></p><p id="c1f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lv" href="https://next-auth.js.org/" rel="noopener ugc nofollow" target="_blank">下一个授权</a></p><p id="8ce5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lv" href="https://avneesh-links.vercel.app/" rel="noopener ugc nofollow" target="_blank">所有社交</a></p></div></div>    
</body>
</html>