<html>
<head>
<title>How to Ensure Reproducibility Easily in Data Science Through Version Control</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何通过版本控制轻松确保数据科学的再现性</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-ensure-reproducibility-easily-in-data-science-through-version-control-1777ae3b15a?source=collection_archive---------30-----------------------#2021-06-27">https://medium.com/geekculture/how-to-ensure-reproducibility-easily-in-data-science-through-version-control-1777ae3b15a?source=collection_archive---------30-----------------------#2021-06-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="4a4e" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">人工智能</h2><div class=""/><div class=""><h2 id="72e6" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">了解如何使用DVC对模型和数据进行版本化</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/55bd50fada12f87c871fbdd5466b54f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RpdCB8ssHVk6dpHL31rKbA.jpeg"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Photo by <a class="ae jw" href="https://unsplash.com/@yancymin?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Yancy Min</a> on <a class="ae jw" href="https://unsplash.com/s/photos/github?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="fdcd" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ix ki iy kj ja kk jb kl jd km je kn ko bi translated"><strong class="ak">简介</strong></h1><p id="d4d5" class="pw-post-body-paragraph kp kq hi kr b ks kt is ku kv kw iv kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">曾经在数据科学项目中工作过，然后你意识到在几次尝试之后，你无法复制令人敬畏的数据清理技术或你构建的辉煌架构，或者你调整得如此之好的超参数，以至于你的模型曾经达到超过99%的准确性。可悲的是，每个ML从业者在他们的数据科学之旅中都经历过这种情况。</p><p id="f476" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">数据和模型版本化是每个机器学习生命周期的一个非常重要的方面，所有ML工程师和数据科学家都应该认真对待。不能过分强调版本化模型或数据众多好处:</p><ul class=""><li id="e6d3" class="lq lr hi kr b ks ll kv lm ky ls lc lt lg lu lk lv lw lx ly bi translated">它确保您的实验是可重复的</li><li id="0dc6" class="lq lr hi kr b ks lz kv ma ky mb lc mc lg md lk lv lw lx ly bi translated">它允许在正确的时间部署正确的版本</li><li id="e722" class="lq lr hi kr b ks lz kv ma ky mb lc mc lg md lk lv lw lx ly bi translated">它跟踪每一次修改。</li><li id="c6be" class="lq lr hi kr b ks lz kv ma ky mb lc mc lg md lk lv lw lx ly bi translated">它允许与队友轻松协作。</li></ul><p id="445e" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">不幸的是，传统的版本控制方法Git不能有效地处理大文件，因此导致对正确跟踪模型和数据的版本控制工具的需求不断增加。在本文中，我们将看看如何通过使用DVC(数据版本控制)的数据和模型版本化来实现可再现性。</p><h1 id="4400" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ix ki iy kj ja kk jb kl jd km je kn ko bi translated">什么是DVC</h1><p id="b1a5" class="pw-post-body-paragraph kp kq hi kr b ks kt is ku kv kw iv kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">要理解什么是DVC以及它是如何工作的，你需要首先理解Git(一个版本控制系统)是如何工作的。本教程不会涵盖这一点，所以最好去看看Udacity的一个免费课程，名为<em class="me">版本控制与Git </em>，<em class="me"> </em>涵盖了这一点。</p><p id="3021" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">你可能会问，DVC到底是什么？</p><blockquote class="mf"><p id="061d" class="mg mh hi bd mi mj mk ml mm mn mo lk dx translated">“数据版本控制，或DVC，是一个数据和ML实验管理工具，它利用了您已经熟悉的现有工程工具集(Git、CI/CD等)。)”根据dvc.org的<a class="ae jw" href="https://dvc.org/doc" rel="noopener ugc nofollow" target="_blank">DVC的</a></p></blockquote><p id="e78c" class="pw-post-body-paragraph kp kq hi kr b ks mp is ku kv mq iv kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated"><a class="ae jw" href="https://dvc.org/" rel="noopener ugc nofollow" target="_blank"> DVC </a>做了很多事情，其中之一是它在实验过程中跟踪模型或数据文件版本的能力。使用DVC和使用git一样简单。</p><p id="9cbf" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">它可以用来跟踪本地和几个常见的远程存储解决方案，如S3，Azure，GCP的大文件。一旦文件被添加到DVC，它就会创建一个元数据文件，作为原始数据的占位符，可以像大多数Git源代码一样轻松地进行版本控制和跟踪。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es mu"><img src="../Images/51a419ac406f66984e699583855c35b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AU8KBmonUlKu3HRmgZ4SLQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Source: <a class="ae jw" href="https://dvc.org/doc" rel="noopener ugc nofollow" target="_blank">DVC</a></figcaption></figure><p id="5b53" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">DVC的神奇之处在于，它不仅限于跟踪模型和数据，它可以跟踪任何东西，只要它太大，git无法有效处理。在本教程中，我们将重点关注使用DVC本地和远程版本化模型和数据。</p><h1 id="9c48" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ix ki iy kj ja kk jb kl jd km je kn ko bi translated">让我们把手弄脏，</h1><p id="edcf" class="pw-post-body-paragraph kp kq hi kr b ks kt is ku kv kw iv kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">我们需要做的第一件事是安装DVC和<a class="ae jw" href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html" rel="noopener ugc nofollow" target="_blank">boto 3</a><em class="me">(python的一个</em> AWS SDK ),因为我们将使用S3作为本教程的远程存储:</p><pre class="jh ji jj jk fd mv mw mx my aw mz bi"><span id="82f0" class="na jy hi mw b fi nb nc l nd ne"><strong class="mw hs">$ pip install "dvc[s3]"</strong></span></pre><p id="eda5" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">接下来克隆用于跟踪的存储库:</p><pre class="jh ji jj jk fd mv mw mx my aw mz bi"><span id="e35b" class="na jy hi mw b fi nb nc l nd ne"><strong class="mw hs">$ mkdir DVC_GITHUB_CODE <br/>$ cd DVC_GITHUB_CODE  <br/>$ git clone </strong><a class="ae jw" href="https://github.com/yourusername/DVC_GITHUB_CODE" rel="noopener ugc nofollow" target="_blank"><strong class="mw hs">https://github.com/yourusername/DVC_GITHUB_CODE</strong></a><strong class="mw hs"> .</strong></span></pre><h1 id="8b7b" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ix ki iy kj ja kk jb kl jd km je kn ko bi translated">跟踪本地文件</h1><p id="69ae" class="pw-post-body-paragraph kp kq hi kr b ks kt is ku kv kw iv kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">首先，我们初始化DVC:</p><pre class="jh ji jj jk fd mv mw mx my aw mz bi"><span id="e936" class="na jy hi mw b fi nb nc l nd ne"><strong class="mw hs">$ dvc init</strong></span></pre><p id="535f" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">然后我们开始跟踪数据/模型</p><pre class="jh ji jj jk fd mv mw mx my aw mz bi"><span id="e844" class="na jy hi mw b fi nb nc l nd ne"><strong class="mw hs">$ dvc add data.tfrecord</strong></span></pre><p id="af8f" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">你会注意到这创建了一个<code class="du nf ng nh mw b">data.tfrecord.dvc</code>文件和<code class="du nf ng nh mw b">.dvc/cache</code> <strong class="kr hs"> </strong>目录。</p><p id="5f72" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated"><code class="du nf ng nh mw b">.dvc/cache</code>本质上是一个内容可寻址的存储器(即存储信息，因此可以根据其内容而不是位置来检索)，DVC跟踪的文件和目录的不同版本都存储在这里。它可以与任何远程存储同步。关于任何目录或添加文件的信息都存储在<code class="du nf ng nh mw b">data.tfrecord.dvc</code>文件中，该文件是一个小文本文件，包含人类可读的内容，如哈希值或etags、文件路径和许多其他内容(它充当指向原始文件的指针)。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es ni"><img src="../Images/22a52d241c75a745e774c7c2697970dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*jVxSlfiptG0UVMmJNZb37g.png"/></div><figcaption class="js jt et er es ju jv bd b be z dx">data.tfrecord.dvc content</figcaption></figure><p id="8361" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">您可以将跟踪的数据存储在远程存储中(S3、Gdrive、Azure Blob存储):</p><pre class="jh ji jj jk fd mv mw mx my aw mz bi"><span id="7db2" class="na jy hi mw b fi nb nc l nd ne"><strong class="mw hs">$ dvc remote add -d storage </strong><strong class="mw hs">s3://mybucket/datastorage</strong><strong class="mw hs"><br/>$ dvc push</strong></span></pre><p id="0af3" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">最后，我们添加、提交并推送到Git:</p><pre class="jh ji jj jk fd mv mw mx my aw mz bi"><span id="f720" class="na jy hi mw b fi nb nc l nd ne"><strong class="mw hs">$ git add data.tfrecord.dvc .gitignore<br/></strong><strong class="mw hs">$ TAG="V1"<br/>$ git commit -m "Created data ${TAG}"<br/>$ git tag ${TAG}<br/>$ git push</strong></span></pre><p id="0182" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">现在我们本地的<code class="du nf ng nh mw b">data.tfrecord</code>正在被DVC追踪。要恢复跟踪的DVC文件，创建一个新目录，<code class="du nf ng nh mw b">git clone</code>和<code class="du nf ng nh mw b">git pull</code>您的存储库，然后运行<code class="du nf ng nh mw b">dvc pull</code>:</p><pre class="jh ji jj jk fd mv mw mx my aw mz bi"><span id="d4b0" class="na jy hi mw b fi nb nc l nd ne"><strong class="mw hs">$ dvc pull</strong></span></pre><p id="5e1e" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">你可以在<a class="ae jw" href="https://gist.github.com/seunboy1/f70d5df891aca0409d583b14f499443b" rel="noopener ugc nofollow" target="_blank"><strong class="kr hs"><em class="me">Github gist</em></strong></a>上找到完整的代码。</p><h1 id="075b" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ix ki iy kj ja kk jb kl jd km je kn ko bi translated">跟踪远程文件</h1><p id="d044" class="pw-post-body-paragraph kp kq hi kr b ks kt is ku kv kw iv kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">跟踪远程文件略有不同，应该有一些数据(。tfrecord，。zip)或型号(. h5，.tflite，。onnx，。pt)已经在任何远程存储器中。在本教程中，我们将重点关注AWS S3:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es nj"><img src="../Images/0a5288e67ee050e7c9c140585d849cf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZSQyMnZJ-ngM4QLM1FvHUQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">S3 bucket</figcaption></figure><p id="0843" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">如前所示，如果DVC尚未初始化，我们将从初始化它开始:</p><pre class="jh ji jj jk fd mv mw mx my aw mz bi"><span id="74f0" class="na jy hi mw b fi nb nc l nd ne"><strong class="mw hs">$ dvc init</strong></span></pre><p id="22ed" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">由于我们的数据已经驻留在远程位置，我们将在S3上创建一个外部缓存，例如<code class="du nf ng nh mw b">s3://mybucket/cache</code>，因为DVC要求缓存配置在与被跟踪数据相同的位置。要配置外部缓存，请运行以下命令:</p><pre class="jh ji jj jk fd mv mw mx my aw mz bi"><span id="4473" class="na jy hi mw b fi nb nc l nd ne"><strong class="mw hs">$ dvc remote add s3cache s3://mybucket/cache<br/>$ dvc config cache.s3 s3cache</strong></span></pre><p id="29eb" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">下一步是使用以下方法跟踪数据:</p><pre class="jh ji jj jk fd mv mw mx my aw mz bi"><span id="83dd" class="na jy hi mw b fi nb nc l nd ne"><strong class="mw hs">$ dvc add --external s3://mybucket/existing-data</strong></span></pre><p id="a7e2" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">这将创建一个由Git跟踪的<code class="du nf ng nh mw b"><strong class="kr hs">existing-data.dvc</strong></code>文件。你还会注意到在<code class="du nf ng nh mw b"><strong class="kr hs">s3://mybucket/cache</strong></code> <strong class="kr hs"> </strong>路径中，DVC会为你的每个数据或者模型版本创建一个类似下图的文件夹结构。这将使数据或模型易于跟踪，而不会丢失信息。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es nk"><img src="../Images/df5a80755f9dd7e62c666b314c66d0ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i0aK_YZpc8tvztS1WUgRGw.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">cache directory</figcaption></figure><p id="c642" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">接下来，我们添加、提交并推送到Git:</p><pre class="jh ji jj jk fd mv mw mx my aw mz bi"><span id="f1ac" class="na jy hi mw b fi nb nc l nd ne"><strong class="mw hs">$ git add  data.dvc" .dvc/config .gitignore<br/>$ TAG="V2"<br/>$ git commit -m "Created data ${TAG}"<br/>$ git tag ${TAG}</strong></span></pre><p id="dd1c" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">你会从教程中注意到，DVC不处理版本控制，Git做所有的事情。DVC只是帮助我们将版本控制扩展到文件。这是完整的代码。</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="nl nm l"/></div></figure><h1 id="be03" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ix ki iy kj ja kk jb kl jd km je kn ko bi translated">结论</h1><p id="c6fe" class="pw-post-body-paragraph kp kq hi kr b ks kt is ku kv kw iv kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">现在，您已经了解了版本控制在数据科学中的重要性，以及如何使用DVC在本地和远程跟踪对数据所做的更改，我建议您在数据科学之旅中进一步探索该工具。</p></div></div>    
</body>
</html>