<html>
<head>
<title>Build Interactive CLI Tools in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python构建交互式CLI工具</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/build-interactive-cli-tools-in-python-47303c50d75?source=collection_archive---------0-----------------------#2021-01-24">https://medium.com/geekculture/build-interactive-cli-tools-in-python-47303c50d75?source=collection_archive---------0-----------------------#2021-01-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="2b88" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">厌倦了传统的气候？用PyInquirer开发交互式命令行</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/2e0371a4ceaa2d58ef6cb96173dc9950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ad70DXvT0AFmwNfC"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Sigmund</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9c09" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">注:对于非会员，本文也可在</strong><a class="ae jn" href="https://dineshkumarkb.com/tech/how-to-build-interactive-command-line-tools-in-python/" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj">https://dineshkumarkb . com/tech/how-to-build-interactive-command-line-tools-in-python/</strong></a>获得</p><h2 id="4253" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">简介:</h2><p id="f366" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">命令行界面是完成任务的快速有效的工具。不仅如此，为您开发的任何web应用程序提供命令行界面也很酷，这样可以避免最终用户迷失在庞大的UI站点地图中。</p><p id="47f0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这就是为什么尽管aws有一个功能丰富的控制台，但它有一个由<code class="du lk ll lm ln b">botocore</code>模块支持的惊人的cli，不是吗？</p><h2 id="766c" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">动机:</h2><ol class=""><li id="04fb" class="lo lp hi jq b jr lf ju lg jx lq kb lr kf ls kj lt lu lv lw bi translated">你厌倦了传统的命令行界面吗？</li><li id="84ff" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj lt lu lv lw bi translated">您是否厌倦了在cli中记录每个功能的命令？</li></ol><p id="d84d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果是，那么你一定要进一步阅读。</p><p id="96df" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以使用<code class="du lk ll lm ln b">PyInquirer</code>和其他库在python中构建交互式和沉浸式命令行界面。</p><p id="a4d2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对于我的例子，我选择了<code class="du lk ll lm ln b">click</code>和<code class="du lk ll lm ln b">PyInquirer</code>。</p><h2 id="a572" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">点击的快速介绍:</h2><p id="1771" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">编写Click是为了支持python中的Flask web框架。Flask的命令行使用点击来执行操作。</p><p id="478a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您曾经尝试过从命令行向flask中的数据库添加值吗？嗯，那你用过click。</p><h2 id="2e9d" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated"><strong class="ak">为什么不是argparse？</strong></h2><p id="d604" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">我们完全可以用argparse编写一个简单的计算器cli。在我看来，随着cli应用程序的增长，维护用argparse编写的代码变得越来越复杂。而使用click，代码看起来更加模块化和可伸缩。所以我选择点击这里。</p><p id="fb0b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你可以自由选择任何你喜欢的cli框架，甚至可以只使用<code class="du lk ll lm ln b">PyInquirer</code>来解决。</p><h2 id="584e" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">安装点击</h2><pre class="iy iz ja jb fd mc ln md me aw mf bi"><span id="518f" class="kk kl hi ln b fi mg mh l mi mj">pip install click</span></pre><p id="04a6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在我们已经完成了安装，让我们使用click编写一个简单的计算器cli。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="cdc5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是编写简单计算器cli的一种方式。让我们为这个cli执行help命令。</p><pre class="iy iz ja jb fd mc ln md me aw mf bi"><span id="c4a0" class="kk kl hi ln b fi mg mh l mi mj">Output:</span><span id="21dc" class="kk kl hi ln b fi mm mh l mi mj">python simplecalc.py --help<br/>Usage: simplecalc.py [OPTIONS] COMMAND [ARGS]...</span><span id="a2e1" class="kk kl hi ln b fi mm mh l mi mj">Options:<br/>  --help  Show this message and exit.</span><span id="45bf" class="kk kl hi ln b fi mm mh l mi mj">Commands:<br/>  add<br/>  div<br/>  mul<br/>  sub</span></pre><p id="ed28" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">help命令的输出如下所示。我们将执行一个添加操作。</p><pre class="iy iz ja jb fd mc ln md me aw mf bi"><span id="9cbb" class="kk kl hi ln b fi mg mh l mi mj">Output:</span><span id="6680" class="kk kl hi ln b fi mm mh l mi mj">python simplecalc.py add<br/>Enter the first number: 2<br/>Enter the second number: 2<br/>The added value 4</span></pre><p id="3cf5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这相当不错。这样，用户必须记住命令或查看帮助来获得可用的cli选项。当您有多个包含嵌套子命令的命令时，这将变得更加混乱。用户可能会发现很难记住每个命令及其对应的子命令。此外，最后但同样重要的是，我们作为开发人员可能必须相应地编写一个全面的帮助命令。</p></div><div class="ab cl mn mo gp mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="hb hc hd he hf"><p id="67ab" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">另一种方法是使用<code class="du lk ll lm ln b">PyInquirer</code>的交互式cli。让我们安装PyInquirer。</p><pre class="iy iz ja jb fd mc ln md me aw mf bi"><span id="5920" class="kk kl hi ln b fi mg mh l mi mj">pip install PyInquirer</span></pre><h2 id="a772" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">介绍PyInquirer:</h2><p id="5652" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">PyInquirer努力成为一个易于嵌入的漂亮的Python命令行界面。PyInquirer的工作基于可以提示给用户的问题，而不是由用户提供cli命令。它帮助我们编写身临其境的命令行工具。</p><p id="2162" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">PyInquirer让</p><ul class=""><li id="3938" class="lo lp hi jq b jr js ju jv jx mu kb mv kf mw kj mx lu lv lw bi translated">您定义一个问题列表，并交给prompt</li><li id="6fe5" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj mx lu lv lw bi translated">prompt返回答案列表</li></ul><p id="debd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">它支持以下问题类型</p><ul class=""><li id="4169" class="lo lp hi jq b jr js ju jv jx mu kb mv kf mw kj mx lu lv lw bi translated"><strong class="jq hj">列表</strong></li><li id="548d" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj mx lu lv lw bi translated"><strong class="jq hj">原始列表</strong></li><li id="e994" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj mx lu lv lw bi translated"><strong class="jq hj">展开</strong></li><li id="285a" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj mx lu lv lw bi translated"><strong class="jq hj">确认</strong></li><li id="2f60" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj mx lu lv lw bi translated"><strong class="jq hj">复选框</strong></li><li id="1dcb" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj mx lu lv lw bi translated"><strong class="jq hj">输入</strong></li><li id="685f" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj mx lu lv lw bi translated"><strong class="jq hj">密码</strong></li><li id="198d" class="lo lp hi jq b jr lx ju ly jx lz kb ma kf mb kj mx lu lv lw bi translated"><strong class="jq hj">编辑</strong></li></ul><p id="e77d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">此处提供了所有这些问题类型的示例<a class="ae jn" href="https://github.com/CITGuru/PyInquirer/" rel="noopener ugc nofollow" target="_blank">。我相信大多数问题类型都是不言自明的。</a></p><p id="140b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，让我们使用PyInquirer重写简单的计算器程序。</p><h2 id="aab0" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">使用PyInquirer的简单计算器:</h2><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mk ml l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Interactive Simple Calculator</figcaption></figure><h2 id="1eda" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">了解PyInquirer:</h2><p id="671c" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">问题的<code class="du lk ll lm ln b">type</code>定义了用户得到什么样的提示。如果类型被定义为一个列表，我们得到一个选项列表，而当它是一个输入时，我们提示用户得到输入，等等。</p><p id="0139" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在上面的代码片段中，问题是一个包含类型、名称、消息、验证、过滤和其他一些问题属性的字典列表。让我们看看所使用的属性。</p><p id="33b8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">类型</strong> —定义问题的类型。可以是输入、问题列表、密码提示等。我们在这里使用了一个列表来为用户提供一个计算器选项列表，而不是让用户为我们提供命令。很酷不是吗？这是吸引我的第一件事。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es my"><img src="../Images/e2b1e8a80b23437616d83aef7d60b090.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2In7zLgpthHdJSr-XT6TbQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Type-list</figcaption></figure><p id="5ff5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这也提供了视觉提示来通知用户正在选择什么选项。</p><p id="a640" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">注意:请注意，外观可能会因平台而异。我用的是ubuntu系统。</strong></p><p id="f12b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> name </strong> — Name是存储用户选择的选项的变量。例如，如果用户在上面的列表中选择了<code class="du lk ll lm ln b">product</code>，<code class="du lk ll lm ln b">user_option</code>变量将具有值<code class="du lk ll lm ln b">product</code>。</p><p id="4a16" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">输入</strong> —输入类似于提示用户输入值的常规python输入。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/7d9d1c4804c64678297313f4fbaa4104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FdC6rMNxmxacbcEXAjJX6A.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Type-Input</figcaption></figure><p id="6730" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">消息</strong> —消息是显示给用户的消息。</p><p id="c59d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> validate </strong> — Validate通常调用一个<code class="du lk ll lm ln b">Validator</code>类来检查用户的输入。例如，我们在这里期待一个<code class="du lk ll lm ln b">int</code>值。</p><p id="a080" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果用户提供了一个<code class="du lk ll lm ln b">string</code>或者一个<code class="du lk ll lm ln b">None</code>值呢？我们不应该验证用户的输入吗？这正是验证的用途。您可以在这里拥有您的验证逻辑。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es na"><img src="../Images/865b3c1bb36c381af94d67b574083cff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1iD_hMhq8euZl0dRVbo45A.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">InputValidation</figcaption></figure><p id="0aea" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">过滤器</strong> —默认情况下，在输入中输入的任何用户值都属于<code class="du lk ll lm ln b">str</code>类型。如果我们需要将它们转换成<code class="du lk ll lm ln b">int</code>或任何其他类型，我们可以利用<code class="du lk ll lm ln b">filter</code>函数来完成。这也可以用于<code class="du lk ll lm ln b">strip</code>用户输入的空白。</p><p id="1883" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">可以扩展为任何复杂的cli，为您的CLI吸引更多用户。</p><p id="0bb4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">整体执行如下所示。</p><h2 id="deeb" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">输出:</h2><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nb ml l"/></div></figure><p id="40b9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下次当您开发或增强命令行工具时，一定要尝试一下。</p><h2 id="4dd1" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">参考资料:</h2><ul class=""><li id="1173" class="lo lp hi jq b jr lf ju lg jx lq kb lr kf ls kj mx lu lv lw bi translated"><a class="ae jn" href="https://github.com/CITGuru/PyInquirer/" rel="noopener ugc nofollow" target="_blank">https://github.com/CITGuru/PyInquirer/</a></li></ul></div></div>    
</body>
</html>