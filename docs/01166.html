<html>
<head>
<title>Automate Your Digital Appointments and Bookings With NodeJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用NodeJS自动化您的数字约会和预订</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/automate-your-digital-appointments-and-bookings-with-nodejs-6e914cd8a4e5?source=collection_archive---------12-----------------------#2021-03-30">https://medium.com/geekculture/automate-your-digital-appointments-and-bookings-with-nodejs-6e914cd8a4e5?source=collection_archive---------12-----------------------#2021-03-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="03df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本指南中，我们将了解iCalendar协议，以及它在日常生活中如何用于安排约会和预订。</p><h1 id="beee" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">介绍</h1><p id="1594" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">电子邮件行业经历了很多历史问题。允许用户使用电子邮件安排和预订活动就是其中之一。早在1998年，iCalendar协议被发明出来，为通过电子邮件安排约会和事件提供标准接口。简单来说，就是你的邮件客户端(Gmail、Outlook等)收发的文件。).这个文件包含了事件的细节:状态，组织者细节，参加者细节，以及像RSVP这样有用的插件。</p><p id="ab53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的例子展示了iCalendar的实际应用(在Gmail上)。基本上，它只是一封附有活动的标准电子邮件(invite.ics文件)——这使得Gmail可以显示一个漂亮的用户界面，上面有活动的详细信息:日期、地点、与会者和RSVP按钮(是，也许，不是)。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/1640693242ec09223813819b82f5319e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*t5eL7qA1QRZxoI2C.png"/></div></div></figure><h1 id="2d17" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">综合</h1><p id="84e1" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">使用iCalendar协议相当简单，大多数编程语言都有许多维护良好的库。我们今天将使用NodeJS。</p><p id="3785" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完整的GitHub代码可以在我们的库找到。包含所有逻辑的文件是<code class="du kt ku kv kw b">index.js</code>，我们将在这里分析它。</p><h1 id="87ba" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">体系结构</h1><p id="e607" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">我们的简单应用程序充当一个REST服务，只有一个GET端点。我们将这个端点称为我们的WebHook。这意味着外部应用/服务可以向我们的WebHook URL发出GET请求，这将创建一个iCalendar事件并通过电子邮件发送给所有与会者。</p><p id="6643" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">端点URL将类似于:<code class="du kt ku kv kw b">/appointment?name=Billy&amp;email=billy@gmail.com</code></p><p id="4b80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的整个流程可以想象成这样:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kx"><img src="../Images/eaa4257d635d65252562dc407d06e526.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pcXs6tUHKg-X7oWv.png"/></div></div></figure><p id="a8b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">流量分析:</p><ol class=""><li id="d9a5" class="ky kz hi ih b ii ij im in iq la iu lb iy lc jc ld le lf lg bi translated">一个客户使用我们的前端部件来预约。</li><li id="3240" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">Spurwing API接收并处理客户端的请求。</li><li id="638c" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">成功后，小部件的代码调用我们的WebHook。</li><li id="657f" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">webhook创建一个iCalendar事件，并向参与者发送电子邮件。</li><li id="4991" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated">每位与会者都会收到带有RSVP选项的电子邮件。</li></ol><p id="da6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的流程实际上是一个临时的变通方法，不安全。理想情况下，这个流程应该被简化。WebHook应该由私有服务(而不是公共REST服务)来处理。在我们的例子中，它应该是Spurwing API级别的附加功能，目前正在建设中:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kx"><img src="../Images/b0ce6b875710b67c4814da31c118bd73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GC5ylTzXl0d_NPJs.png"/></div></div></figure><h1 id="a2ed" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">履行</h1><p id="2b0d" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">这里我们简单分析一下NodeJS的代码结构。如前所述，完整代码请参考我们的GitHub资源库。</p><p id="07bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要配置这个WebHook服务，您需要创建一个文件<code class="du kt ku kv kw b">config.js</code>(或者重命名它)并输入以下凭证:</p><pre class="kh ki kj kk fd lm kw ln lo aw lp bi"><span id="7879" class="lq je hi kw b fi lr ls l lt lu">module.exports = {<br/>  organizer: {<br/>    name: '',      // organizer's name<br/>    email: '',     // organizer's email<br/>    smtp_pass: '', // email password (or app password)<br/>  },<br/>  attendee: {<br/>    name: '',      // host's name<br/>    email: '',     // host's email<br/>  },<br/>}</span></pre><p id="764e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">需要注意的是，在这种配置中，我们提供了一个组织者和一个参与者(也称为主持人)。组织者可以是一个<code class="du kt ku kv kw b">no-reply</code>公司电子邮件或一个仅用于发送自动电子邮件的电子邮件帐户。这不应该是你真正的电子邮件帐户。</p><p id="bb33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">出席者/主持人其实是你自己；安排与客户约会的人(从网站)。这可能看起来很奇怪，但组织者是一个不包括在约会中的电子邮件帐户。它只是一个用于发送电子邮件的账户(但不是实际会议的一部分)。但是，与会者/主持人包括在会议中。</p><p id="fce8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我自己花了一些时间才弄明白这一点，原因是这样的:当我们使用Gmail/Outlook手动安排活动时，组织者也是与会者/主持人——您不会收到RSVP电子邮件，因为您的电子邮件服务已经将活动放在您的日历中。但是在这里，我们不直接访问我们的日历，而是利用iCalendar协议向我们自己和客户发送电子邮件。</p><p id="ec77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果组织者和与会者/主持人使用相同的电子邮件帐户，您将不会收到任何电子邮件，也无法将其添加到您的日历中。因为iCalendar协议假定您的电子邮件服务已经为您做到了这一点。</p><p id="838b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦配置了这些细节，您就可以按原样使用代码了。但是你也应该对<code class="du kt ku kv kw b">index.js</code>做一些修改，比如配置服务端口和邮件的标题、主题、正文/摘要。这些字段在行尾标有<code class="du kt ku kv kw b">// change</code>。</p><p id="662a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要启动这项WebHook服务，您可以使用<code class="du kt ku kv kw b">node index.js</code>或PM2(包括<code class="du kt ku kv kw b">ecosystem.config.js</code>)。</p><h1 id="72ad" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">调用WebHook</h1><p id="e5b5" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">要从前端JavaScript调用你的WebHook，你可以使用XHR/Ajax。我更喜欢这样使用jQuery:</p><pre class="kh ki kj kk fd lm kw ln lo aw lp bi"><span id="fe9c" class="lq je hi kw b fi lr ls l lt lu">// SpurwingHookURL = "https://YourSite.com/SpurwingHook/appointment"<br/>if (SpurwingHookURL) {<br/>    $.getJSON(SpurwingHookURL, {<br/>        name,<br/>        email,<br/>        start: fixDateOffset(selectedSlot),<br/>        end: fixDateOffset(D.appointment.end),<br/>    }, function(resp) {<br/>        console.log(SpurwingHookURL, resp)<br/>    })<br/>}</span></pre><p id="f1ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将创建一个带有四个URL参数的GET请求:客户端名称、电子邮件和事件的开始/结束时间(ISO格式)。</p><h1 id="8ce8" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">结论</h1><p id="ff97" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">这实际上非常简单明了。唯一违背直觉的部分是，我们需要为组织者使用另一个电子邮件帐户，为与会者/主持人部分使用您的个人电子邮件。</p><p id="2a70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ks" href="https://github.com/Spurwingio/iCalendar-Integrations/" rel="noopener ugc nofollow" target="_blank"> iCalendar集成代码</a></p><p id="11a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ks" href="https://github.com/Spurwingio/Appointment-Scheduling-Widgets/tree/main/SimpleAppointmentScheduling" rel="noopener ugc nofollow" target="_blank">预约小工具代码</a></p><p id="bdaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">欲了解更多日程安排、预订和日历资源，请访问斯普林<a class="ae ks" href="https://www.spurwing.io/" rel="noopener ugc nofollow" target="_blank">https://www.spurwing.io/</a></p><p id="4857" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尽情享受吧！</p></div></div>    
</body>
</html>