# 我如何用 Python 节省金钱、时间(和环境)

> 原文：<https://medium.com/geekculture/how-i-saved-money-time-and-the-environment-with-python-950d5c51a71f?source=collection_archive---------17----------------------->

![](img/85688cc24c1349f5d11536581a3a7f40.png)

Photo by [Appolinary Kalashnikova](https://unsplash.com/es/@appolinary_kalashnikova?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

这篇文章讲述了我如何最终编程出有用的东西的故事。

# 介绍

诚然，这篇文章的标题雄心勃勃。所以请允许我解释一下。

不久前，我开始订阅一些锻炼计划。我的计划是在健身房的时候用手机看这个节目。

很快就发现这个程序仅仅是 YouTube 视频的集合。只有当你有链接的时候才能访问。顺便说一下，每个月要为此支付 50 多欧元。

我内心的吝啬鬼想出了一个主意。

“为什么不下载这些视频并取消订阅？”

于是，我下载了一个 App 到我的手机上，开始了肮脏的工作。但问题来了:因为我不想花钱买这个应用程序，所以我买了一个免费版本。

这带来了一系列的问题。它迫使我看了一吨添加。下载视频时添加。当我想看视频时添加。

现在，我心中的程序员想出了一个主意。

"应该可以下载这些视频与一些 Python 代码."

就这样开始了。

# 回到标题

让我们分别讨论题目中的要点。

我如何省钱应该是显而易见的。我不再需要支付订阅费。

这样我会错过新的内容，但我可以在几个月后回来，下载新的东西，然后再次退出。

因为我真的不知道羞耻。

此外，我的移动数据量有限。因为我不必为了看视频而升级，所以又省钱了。我承认有点牵强，我知道。

时间是如何节省的？

好吧，既然我是在手机上看这些视频，我就不得不忍受广告。无论是在 YouTube 还是在用于下载的应用程序中。不再是了，先生！

除此之外，还可以节省因缓冲问题而损失的时间。

但是我到底是怎么拯救环境的呢？

我对此的想法很简单:有些我喜欢的视频我会反复观看。如果我要多次播放那个视频，服务器必须提供给我，传输基础设施必须把它传输给我。

这需要电力，并且会留下碳足迹。如果它被避免，环境被保存(一点点)。

很有可能我的思维过程过于简单，研究对[流媒体对环境的实际影响有点模糊](https://www.iea.org/commentaries/the-carbon-footprint-of-streaming-video-fact-checking-the-headlines)。

那么…我在标题中提到环境是为了得到更多的关注吗？答案很清楚……也许。但是既然我们已经在这里了，我们就来谈谈…

必须解决三个主要问题:

*   我如何访问该产品的网站？
*   我如何从上述网站提取视频 id？
*   我如何下载这些视频？

简单总结一下:

*   第一个问题是用[请求包](https://requests.readthedocs.io/en/latest/)解决的，它以 cookies 和头的形式提供活动会话凭证。
*   第二个问题用 [BeautifulSoup4 包](https://www.crummy.com/software/BeautifulSoup/bs4/doc/)解决了，它可以执行一些粗糙的 html 解析。
*   最后一个问题用 [pytube](https://pytube.io/en/latest/) 解决了，这使得下载 youtube 视频变得轻而易举。

希望你不是某种已经把所有的点连接起来的编码专家，你将在下面的部分找到细节。

# 怎么进去

这不是我的第一次竞技，我以前刮过网站。这通常对我有用:

启动这段代码通常会导致返回代码 200——巨大的成功——以及对网站代码的完全访问权。

然而网站需要认证。我得到的不是闪亮的 200 分，而是暗淡的 403 分。所以我做了每个开发人员都会做的事情…我去了 stackoverflow。

瞧，我找到了[这个](https://stackoverflow.com/questions/23102833/how-to-scrape-a-website-which-requires-login-using-python-and-beautifulsoup)

我最终使用的解决方案是在登录并以 cURL 的形式提取请求后，导航到我的浏览器的开发工具中的 network 选项卡。这可以被复制到[https://curlconverter.com/](https://curlconverter.com/)，它将创建访问该网站所需的 python 代码。

现在代码看起来像这样，COOKIES 和标题直接取自前面提到的网站。

这些是我喜欢的解决方案。他们先试着工作，不需要我去理解到底发生了什么。

我是否因为在某个随机网站上输入了潜在的敏感信息而担心？

不，你这个笨蛋！因为网站上的隐私声明承诺，一切都发生在我的浏览器中，不会向任何地方发送任何信息。

如果一个网站向我保证我的数据是安全的，我为什么会不信任呢？

# 提取

进入下一步。我们现在拥有的是纯 html 代码，充满了尖尖的“>”和“

怎么办？就像在现实生活中一样:如果你把一些危险的东西煮一段时间，它会变得不那么危险…而且在这个过程中可能会变得美味。

可怕的类比，但都是为了过渡到我一直使用的 Python 库:BeautifulSoup。

根据该网站:

> Beautiful Soup 是一个 Python 库，用于从 HTML 和 XML 文件中提取数据。它与您喜欢的解析器一起工作，提供导航、搜索和修改解析树的惯用方式。它通常为程序员节省数小时或数天的工作。

我高度复杂的工作流程如下所示:

*   在我的浏览器中加载网站。
*   右键单击我感兴趣的对象，然后选择“检查”。
*   在网站的 html 代码中突出显示了元素后，我试图用唯一的标签来标识父元素，以便找到该元素。
*   冲洗，必要时重复。

以下是我在案例中必须浏览的结构:

起始页上有几个下拉菜单。第三个包含的条目会把我带到有我想要的视频的站点。

所以我不得不这么做:

*   找到所有下拉菜单并获取第三个菜单的内容。
*   从所述下拉菜单中提取所有链接。
*   遍历链接列表，在每个实例中找到嵌入的 YouTube 视频并提取 ID。

让我们来看看一些代码片段。请注意，这不是我实际使用的代码。它仅仅是为了展示我一直在使用的功能。

此外，由于这不是一个关于 BeautifulSoup 的深度指南，我将简单解释一下我的代码的目的。我决不认为这是做这件事最有效的方法。

第一步是解析 html 字符串，在我的例子中，它来自“response.content”。

为了找到我要找的标签，我主要使用“find”和“findAll”功能。令人震惊，我知道。
如果只需要匹配描述的第一个标签，使用“查找”。如果对所有实例都感兴趣，请使用“findAll”(或“find_all”)。

您必须提供的第一个参数是标记的类型，也就是说，在'

在我的例子中，查找标签的 class 属性就足够了。

但是也可以提供一个返回 True 或 False 的函数。在我的例子中，我使用 lambda 函数检查标签是否为“li”以及标签是否具有属性“data-post_id”。

对我个人来说，使用 lambda 函数更容易，我还认为它们提供了更大的灵活性。但是我也可能错了…

注意，find 函数的结果也是一个 Soup 对象，因此可以执行多次连续的搜索。

如果您想浏览标签的直接子标签列表，即所述标签中的所有顶级标签，请使用“contents”属性。

如果你想访问一个给定属性的值，那么你可以把 soup 对象当作一个字典，就像我在最后一行中做的那样。

至此，我想结束关于我如何提取视频 id 的部分。如果你想了解更多关于 BeautifulSoup 的 html 解析，那就去看看教程吧，非常棒。或者在评论区告诉我，我可能会更“深入”地讨论它。

# 保护货物

完成所有这些繁重的工作后，我们终于可以开始有趣的部分了。自己下载视频。由于其他人的努力，这是一项相当容易的任务。

有一个叫做“Pytube”的包，它可以处理所有的事情。以下是您需要的所有代码:

首先，通过提供视频的 url 来“连接”视频。

然后，您可以通过“video.stream”获得所有可用流的列表。

该列表可以通过不同的属性进行过滤，如文件扩展名或分辨率。

对属性“progressive=True”的一个注释。如果你检查一个视频，你会注意到大多数都有‘progressive = False’。这意味着对于大多数流来说，音频和视频是分开的。在这种情况下，你必须分别下载视频和音频，然后再把它们结合起来。

因为我懒，所以我希望有一个‘progressive = True’的流。

然后，我选择我得到的第一个结果，从标题中删除那些讨厌的空格，并继续下载视频。

遗憾的是，默认情况下，您不会得到太多关于下载当前进度的反馈。这段代码只是暂停执行，直到下载完成。看起来你可以在下载过程中提供一个回调函数，这样就可以知道还有多少东西需要下载。但是我没有深入调查。

# 额外奖励:下载音乐

既然我们在这里，我不妨提一下，上面的代码稍微修改一下，就可以让你只下载一个视频的音轨。如果你想下载一些音乐的理想选择。

你需要做的就是更换过滤器。在我的例子中，检查“mime_type”是最可靠的，因为 mp3 并不总是可用的，所以我使用了“webm”。

# 结论

现在，你应该有了自己的工具，可以从网站上提取 youtube 视频 id，然后下载它们。

我很想在下面的评论区听到你的反馈。

*原载于 2022 年 11 月 1 日【https://topjer.net】[](https://topjer.net/index.php/2022/11/01/i-saved-money-time-and-the-environment-with-python/)**。***