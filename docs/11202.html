<html>
<head>
<title>How to Add the Uniswap Swap Widget to your React dApp</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Uniswap交换小部件添加到React dApp</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-add-the-uniswap-swap-widget-to-your-react-dapp-9be353e2bd46?source=collection_archive---------3-----------------------#2022-03-10">https://medium.com/geekculture/how-to-add-the-uniswap-swap-widget-to-your-react-dapp-9be353e2bd46?source=collection_archive---------3-----------------------#2022-03-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e87f92a73b2ee64ae3232a6b7448c258.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YNUwLJSv46HdFnUimSVXGA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx"><a class="ae iu" href="https://docs.uniswap.org/sdk/widgets/swap-widget" rel="noopener ugc nofollow" target="_blank">Swap widget state</a></figcaption></figure><p id="b0f8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">几周前，我参加了Polygon Guild Lagos的活动，会上<a class="ae iu" href="https://twitter.com/TejuAdeyinka" rel="noopener ugc nofollow" target="_blank"> Teju </a>发表了一个关于<strong class="ix hj">人与协议</strong>的演讲，以及我们如何通过预测用户需求来改善Web3的用户体验。</p><p id="185e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">她讲述了自己试图在dApp上下注的经历，但她没能这么做，因为她没有所需的令牌。除了表达她的不满，她还谈到了我们如何通过让用户轻松访问所需的应用内令牌来改善这种体验。</p><p id="5e15" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这一点一直困扰着我，从那以后，我在构建任何web3产品时都要考虑令牌可访问性。因此，我决定在Uniswap Labs Swap小部件上试一试，这样用户就可以在uni WAP协议上交换令牌，而不用离开我的dApp。</p><p id="4c21" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在进行这项工作时，我遇到了一些小障碍，也了解了其他人在梳理Uniswap discord服务器时面临的常见问题。所以我决定写一本对初学者友好的指南，这样你就不必面对我们所面临的同样的问题。</p><h1 id="5125" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">交换部件</h1><p id="91e4" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">如果您需要您的用户使用本地令牌(例如<code class="du kw kx ky kz b">ENS</code>)进行交易，您需要让他们无需离开您的dApp就能轻松获得令牌。这样做将有助于改善您的用户体验，并减少由于本机令牌的不可访问性而导致的掉线。</p><p id="3f68" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将交换小部件添加到dApp非常简单，只需几行代码就可以完成。但是在我们开始实现之前，这里有一些你需要开始做的事情。</p><h2 id="5f74" class="la ju hi bd jv lb lc ld jz le lf lg kd jg lh li kh jk lj lk kl jo ll lm kp ln bi translated">JSON-RPC端点</h2><p id="52d9" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">JSON-RPC端点需要获取链上数据和提交事务。如果您的DApp中已经有一个，您可以跳过这一步。但是如果你没有，你可以在像<a class="ae iu" href="http://infura.io" rel="noopener ugc nofollow" target="_blank"> Infura </a>或<a class="ae iu" href="http://alchemy.com" rel="noopener ugc nofollow" target="_blank"> Alchemy </a>这样的服务上轻松创建一个。</p><p id="c77e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里有一个简单的指南，告诉你如何在Infura上创建一个:</p><p id="9591" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第一步:</strong>访问Infura网站，然后注册或登录您的帐户(如果您已经有一个)。</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/ab166489ba2b5b6e31d18fc01d29e3b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s6TSRisoKQu_6dWg222I4w.png"/></div></div></figure><p id="a0cd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第2步:</strong>导航至您的仪表盘，点击<code class="du kw kx ky kz b">CREATE NEW PROJECT</code></p><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/7b601bc5fc4e133e895dade3ea6e2a3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Km49mQ4dzABML-_5Onp8_A.png"/></div></div></figure><p id="1bd1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">第三步:</strong>选择一个适用的产品，为您的项目命名，然后点击<code class="du kw kx ky kz b">CREATE</code>。</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/f943384a676aeb2104bb9dd198e68460.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wwait3NBarHt4-GeXEVmhA.png"/></div></div></figure><p id="8239" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">步骤4: </strong>向下滚动到<strong class="ix hj">键</strong>并复制您的端点URL或项目ID。</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/f7bc229f4a7cdbe80dbd789740b11af2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C726DlRK5Kc23kvS4jKTxw.png"/></div></div></figure><p id="2b15" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">干得好！您已经成功地生成了一个JSON-RPC端点。</p><p id="09f5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> Web3提供商</strong></p><p id="ffbc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Swap小部件还需要一个web3提供者来获取余额，并通过用户连接的钱包提交交易。如果你正在创建一个DApp，那么你将需要一个web3提供商。</p><p id="2109" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有各种各样的供应商可供你选择。但在本文中，我们将使用<a class="ae iu" href="https://docs.ethers.io/v5/api/providers/" rel="noopener ugc nofollow" target="_blank">醚类</a>。</p><pre class="lp lq lr ls fd lw kz lx ly aw lz bi"><span id="92e1" class="la ju hi kz b fi ma mb l mc md">//install the ethers library</span><span id="b5b1" class="la ju hi kz b fi me mb l mc md">npm install --save ethers</span></pre><h2 id="36cb" class="la ju hi bd jv lb lc ld jz le lf lg kd jg lh li kh jk lj lk kl jo ll lm kp ln bi translated"><strong class="ak">钱包连接流程</strong></h2><p id="0faf" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">您的应用程序中还需要一个钱包连接流，以便用户可以连接他们的钱包来执行交易。您可以使用各种库(例如web3-react、wagmi等。).为简单起见，我们将连接到用户安装的浏览器钱包，如metamask。</p><p id="3bb6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是，我们只能在用户安装了钱包的情况下这样做。因此，我们将使用metamask的<code class="du kw kx ky kz b">detect-provider</code>库检查wallet安装。</p><pre class="lp lq lr ls fd lw kz lx ly aw lz bi"><span id="cc70" class="la ju hi kz b fi ma mb l mc md">//install metamask detect-provider</span><span id="5829" class="la ju hi kz b fi me mb l mc md">npm install --save @metamask/detect-provider</span></pre><p id="dec1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经准备好了我们的需求，让我们开始吧。</p></div><div class="ab cl mf mg gp mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hb hc hd he hf"><h1 id="771a" class="jt ju hi bd jv jw mm jy jz ka mn kc kd ke mo kg kh ki mp kk kl km mq ko kp kq bi translated">添加小部件库</h1><p id="c3a8" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">首先，安装小部件库和<code class="du kw kx ky kz b">react-redux</code>(如果你还没有安装的话)。</p><pre class="lp lq lr ls fd lw kz lx ly aw lz bi"><span id="f31b" class="la ju hi kz b fi ma mb l mc md">//install the swap widget</span><span id="f306" class="la ju hi kz b fi me mb l mc md">npm install --save @uniswap/widgets react-redux </span><span id="e19f" class="la ju hi kz b fi me mb l mc md">or</span><span id="a0b3" class="la ju hi kz b fi me mb l mc md">yarn add @uniswap/widgets react-redux</span></pre><h2 id="c78d" class="la ju hi bd jv lb lc ld jz le lf lg kd jg lh li kh jk lj lk kl jo ll lm kp ln bi translated">导入应用依赖项</h2><pre class="lp lq lr ls fd lw kz lx ly aw lz bi"><span id="6c5e" class="la ju hi kz b fi ma mb l mc md">//Store some state variables.<br/>import { useState } from 'react';</span><span id="8d0f" class="la ju hi kz b fi me mb l mc md">//connect to our infura endpoint<br/>import { providers, ethers } from 'ethers';</span><span id="cb87" class="la ju hi kz b fi me mb l mc md">//check if metamask is installed in the browser.<br/>import detectEthereumProvider from '@metamask/detect-provider';</span><span id="8159" class="la ju hi kz b fi me mb l mc md">//uniswap widgets library<br/>import { SwapWidget } from '@uniswap/widgets';</span></pre><h2 id="c597" class="la ju hi bd jv lb lc ld jz le lf lg kd jg lh li kh jk lj lk kl jo ll lm kp ln bi translated">定义常数</h2><pre class="lp lq lr ls fd lw kz lx ly aw lz bi"><span id="5cc3" class="la ju hi kz b fi ma mb l mc md">const infuraId = process.env.REACT_APP_INFURA_ID;<br/>const jsonRpcEndpoint = `https://mainnet.infura.io/v3/${infuraId}`;<br/>const jsonRpcProvider = new providers.JsonRpcProvider(jsonRpcEndpoint);<br/>const provider = new ethers.providers.Web3Provider(jsonRpcProvider);</span></pre><h2 id="f8ce" class="la ju hi bd jv lb lc ld jz le lf lg kd jg lh li kh jk lj lk kl jo ll lm kp ln bi translated">定义状态变量</h2><pre class="lp lq lr ls fd lw kz lx ly aw lz bi"><span id="3ed8" class="la ju hi kz b fi ma mb l mc md">function App() {</span><span id="91b0" class="la ju hi kz b fi me mb l mc md">  const [account, setAccount] = useState({<br/>      address: '',<br/>      provider: provider,<br/>  })</span></pre><h2 id="af3a" class="la ju hi bd jv lb lc ld jz le lf lg kd jg lh li kh jk lj lk kl jo ll lm kp ln bi translated">创建connectWallet功能</h2><pre class="lp lq lr ls fd lw kz lx ly aw lz bi"><span id="7303" class="la ju hi kz b fi ma mb l mc md">async function connectWallet() {</span><span id="c583" class="la ju hi kz b fi me mb l mc md">//check if Metamask is installed in the browser<br/>const ethereumProvider = await detectEthereumProvider();</span><span id="4ccc" class="la ju hi kz b fi me mb l mc md">  if (ethereumProvider) {</span><span id="4a58" class="la ju hi kz b fi me mb l mc md">  //prompt user to connect their wallet<br/>  const accounts = await window.ethereum.request({<br/>        method: 'eth_requestAccounts',<br/>      })</span><span id="39c8" class="la ju hi kz b fi me mb l mc md">     const address = accounts[0];</span><span id="f84b" class="la ju hi kz b fi me mb l mc md">     setAccount({<br/>        address: address,<br/>        provider: ethereumProvider<br/>     })<br/>  }<br/>}</span></pre><p id="923b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可能想知道为什么我们添加了一个提供者，无论如何它都将被更新。原因如下👇</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/4b7e1378d348bdac5d936591ded34308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oOwnRJLj7CKCqj3TJ0JirQ.png"/></div></div></figure><p id="7ef7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们没有从一开始就定义一个提供者，那么当我们加载应用程序时，我们的小部件就会以这种方式出现。</p><h2 id="0b05" class="la ju hi bd jv lb lc ld jz le lf lg kd jg lh li kh jk lj lk kl jo ll lm kp ln bi translated">添加返回元素</h2><p id="a9f0" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">最后，我们添加返回元素。这里可以看到“连接钱包”按钮调用onClick的Connect wallet函数。SwapWidget也接受两个参数；提供者和JsonRpcEndpoint。</p><pre class="lp lq lr ls fd lw kz lx ly aw lz bi"><span id="287b" class="la ju hi kz b fi ma mb l mc md">return (<br/>  &lt;div className="App"&gt;<br/>    &lt;div&gt;<br/>      &lt;button onClick={connectWallet}&gt;Connect Wallet&lt;/button&gt;<br/>    &lt;/div&gt;</span><span id="10c8" class="la ju hi kz b fi me mb l mc md">    &lt;div className="Uniswap"&gt;<br/>      &lt;SwapWidget<br/>        provider={account.provider}<br/>        JsonRpcEndpoint={jsonRpcEndpoint} /&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="99ca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">干得好！您已成功将交换小部件添加到您的dApp。现在，你可以运行<code class="du kw kx ky kz b">npm start</code>来查看你的dApp。</p></div><div class="ab cl mf mg gp mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hb hc hd he hf"><p id="d51e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以在<a class="ae iu" href="https://github.com/jelilat/uniswap-widget" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上查看完整代码。</p><figure class="lp lq lr ls fd ij"><div class="bz dy l di"><div class="ms mt l"/></div></figure></div></div>    
</body>
</html>