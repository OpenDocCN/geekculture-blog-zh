<html>
<head>
<title>A complete overview of Ansible Dynamic inventory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">静态动态库存的完整概述</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/a-complete-overview-of-ansible-dynamic-inventory-a9ded104df4c?source=collection_archive---------8-----------------------#2021-09-08">https://medium.com/geekculture/a-complete-overview-of-ansible-dynamic-inventory-a9ded104df4c?source=collection_archive---------8-----------------------#2021-09-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="f567" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">什么是Ansible？</h1><p id="a3c3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hj"> Ansible </strong>是一款开源软件<strong class="jf hj">供应、配置管理和部署工具。</strong>它运行在许多类Unix系统上，可以配置类Unix系统和Microsoft Windows。Ansible使用SSH协议来配置远程服务器。Ansible遵循基于<strong class="jf hj">推的</strong>机制来配置远程服务器。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kb"><img src="../Images/0b2e7f01ccc163074ce23c3451290335.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l-U9GJtmL5GwPqFPJdQo-w.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Ansible</figcaption></figure><h1 id="a2db" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">什么是动态库存？</h1><p id="e582" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">默认情况下，ansible处理静态清单，但在生产环境中，应用程序在自动扩展组上运行，因此，服务器的IP地址会不断变化，因此，在这种情况下，动态清单就会出现。Ansible dynamic inventory连接到云提供商，它将获得可用的虚拟机IP，然后在这些虚拟机上运行剧本。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kr"><img src="../Images/bc018df78fca08e7726e282374e329bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pqcETBWxrnDO6lhU.jpg"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Ansible dynamic inventory</figcaption></figure><p id="c178" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">在本教程中，我将解释如何在AWS上使用Ansible动态库存。</p><h1 id="4c9a" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">先决条件:</h1><ul class=""><li id="fa41" class="kx ky hi jf b jg jh jk jl jo kz js la jw lb ka lc ld le lf bi translated">安装了<a class="ae lg" href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj"> ansible </strong> </a>的网络服务器</li><li id="2a8b" class="kx ky hi jf b jg lh jk li jo lj js lk jw ll ka lc ld le lf bi translated">对<a class="ae lg" href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj"> ansible </strong> </a>的基本了解</li><li id="2589" class="kx ky hi jf b jg lh jk li jo lj js lk jw ll ka lc ld le lf bi translated">基本了解<a class="ae lg" href="https://docs.aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj"> AWS </strong> </a></li><li id="62be" class="kx ky hi jf b jg lh jk li jo lj js lk jw ll ka lc ld le lf bi translated">AWS <strong class="jf hj">访问密钥</strong> &amp; <strong class="jf hj">秘密密钥</strong></li></ul><p id="4f5b" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">对于本教程，我已经有了一个安装了<strong class="jf hj"> ansible </strong>的<strong class="jf hj"> ubuntu 20.04 OS </strong>的<strong class="jf hj"> EC2 </strong>实例。在继续本教程之前，创建一个目录并将所有文件存储在其中总是一个好的做法。</p><p id="f09c" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">让我们开始配置项目。</p><p id="c878" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><strong class="jf hj">第一步:- </strong>安装<strong class="jf hj"> Ansible-EC2 </strong>插件</p><ul class=""><li id="ab1b" class="kx ky hi jf b jg ks jk kt jo lm js ln jw lo ka lc ld le lf bi translated">运行以下命令以安装Ansible-EC2插件</li></ul><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="04dd" class="lu ig hi lq b fi lv lw l lx ly">ansible-galaxy collection install amazon.aws</span></pre><p id="ca0c" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><strong class="jf hj">第二步:- </strong>安装<strong class="jf hj"> python3 &amp; pip </strong></p><ul class=""><li id="90c4" class="kx ky hi jf b jg ks jk kt jo lm js ln jw lo ka lc ld le lf bi translated">运行以下命令以安装<strong class="jf hj">大钳3 </strong>和<strong class="jf hj">小钳</strong></li></ul><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="90fd" class="lu ig hi lq b fi lv lw l lx ly">sudo apt-get install python3 -y<br/>sudo apt-get install python3-pip -y</span></pre><p id="4416" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">步骤3:-安装<strong class="jf hj"> boto3 </strong>库</p><ul class=""><li id="8192" class="kx ky hi jf b jg ks jk kt jo lm js ln jw lo ka lc ld le lf bi translated">Ansible使用引导核心对AWS进行API调用，以检索EC2实例细节。</li><li id="ffeb" class="kx ky hi jf b jg lh jk li jo lj js lk jw ll ka lc ld le lf bi translated">运行以下命令安装<strong class="jf hj"> boto3库</strong></li></ul><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="d17c" class="lu ig hi lq b fi lv lw l lx ly">sudo pip3 install boto3</span></pre><p id="296d" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><strong class="jf hj">第四步:- </strong>创建<strong class="jf hj">。yaml </strong>文件</p><ul class=""><li id="3cc9" class="kx ky hi jf b jg ks jk kt jo lm js ln jw lo ka lc ld le lf bi translated">创建名为<code class="du lz ma mb lq b">aws_ec2.yaml</code>或<code class="du lz ma mb lq b">aws_ec2.yml</code>的文件</li><li id="f0f8" class="kx ky hi jf b jg lh jk li jo lj js lk jw ll ka lc ld le lf bi translated">上面的文件对我们来说就像动态清单一样</li><li id="f172" class="kx ky hi jf b jg lh jk li jo lj js lk jw ll ka lc ld le lf bi translated">在<code class="du lz ma mb lq b">aws_ec2.yaml</code>或<code class="du lz ma mb lq b">aws_ec2.yml</code>文件中添加以下代码</li></ul><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="293c" class="lu ig hi lq b fi lv lw l lx ly"><strong class="lq hj">plugin:</strong> aws_ec2<br/><strong class="lq hj">regions:</strong><br/>  <strong class="lq hj">-</strong> us-east-1</span></pre><blockquote class="mc md me"><p id="bc5f" class="jd je mf jf b jg ks ji jj jk kt jm jn mg ku jq jr mh kv ju jv mi kw jy jz ka hb bi translated">您也可以更改地区</p></blockquote><p id="2efb" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><strong class="jf hj">步骤5:- </strong>创建一个<strong class="jf hj"> IAM </strong>角色</p><ul class=""><li id="a0c9" class="kx ky hi jf b jg ks jk kt jo lm js ln jw lo ka lc ld le lf bi translated">为了获取EC2实例的详细信息，ansible server必须需要一个IAM角色来允许与EC2实例进行交互。</li><li id="9e8e" class="kx ky hi jf b jg lh jk li jo lj js lk jw ll ka lc ld le lf bi translated">将<code class="du lz ma mb lq b">AWS_EC2_FullAccess</code>角色附加到服务器</li></ul><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mj"><img src="../Images/8e47fe2fbb5ee781e86fbb2418b41933.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W1ncbPY6Na11RLX9XjunbQ.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">IAM Role</figcaption></figure><p id="614e" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><strong class="jf hj">步骤6:- </strong>验证<strong class="jf hj">输出</strong></p><ul class=""><li id="c37f" class="kx ky hi jf b jg ks jk kt jo lm js ln jw lo ka lc ld le lf bi translated">运行以下命令以验证输出</li></ul><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="d274" class="lu ig hi lq b fi lv lw l lx ly">ansible-inventory -i aws_ec2.yaml --list</span></pre><ul class=""><li id="bda2" class="kx ky hi jf b jg ks jk kt jo lm js ln jw lo ka lc ld le lf bi translated">上述命令将给出您在<code class="du lz ma mb lq b">aws_ec2.yaml</code>或<code class="du lz ma mb lq b">aws_ec2.yml</code>文件中指定的区域中所有EC2实例的详细信息</li></ul><blockquote class="mc md me"><p id="b182" class="jd je mf jf b jg ks ji jj jk kt jm jn mg ku jq jr mh kv ju jv mi kw jy jz ka hb bi translated"><strong class="jf hj">注意:- </strong>如果您的ansible服务器不在AWS中，那么您不能将IAM角色附加到它，因此您可以修改<code class="du lz ma mb lq b">aws_ec2.yaml</code>或<code class="du lz ma mb lq b">aws_ec2.yml</code>文件并在其中添加以下内容。</p></blockquote><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="6349" class="lu ig hi lq b fi lv lw l lx ly">aws_access_key: &lt;YOUR-AWS-ACCESS-KEY&gt; <br/>aws_secret_key: &lt;YOUR-AWS-SECRET-KEY&gt;</span></pre><p id="4310" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">通过添加<strong class="jf hj"> AWS访问密钥</strong>和<strong class="jf hj"> AWS秘密密钥</strong>，ansible服务器可以与AWS帐户通信，并可以获得所有<strong class="jf hj"> EC2实例</strong>的详细信息。</p><p id="b2d5" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">您应该得到如下所示的输出。我在<code class="du lz ma mb lq b">us-east-1</code>地区有1个EC2实例</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mj"><img src="../Images/d706405fe649d9d1dec5d41e968906d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tiC2t_RmFgUlFMUaMmWD1g.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">EC2 instance</figcaption></figure><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="9923" class="lu ig hi lq b fi lv lw l lx ly">ansible-inventory -i aws_ec2.yaml --list<br/>{<br/>    "_meta": {<br/>        "hostvars": {<br/>            "ec2-52-90-221-25.compute-1.amazonaws.com": {<br/>                "ami_launch_index": 0,<br/>                "architecture": "x86_64",<br/>                "block_device_mappings": [<br/>                    {<br/>                        "device_name": "/dev/xvda",<br/>                        "ebs": {<br/>                            "attach_time": "2021-09-08T06:32:38+00:00",<br/>                            "delete_on_termination": true,<br/>                            "status": "attached",<br/>                            "volume_id": "vol-0e65b1e8755de632c"<br/>                        }<br/>                    }<br/>                ],<br/>                "capacity_reservation_specification": {<br/>                    "capacity_reservation_preference": "open"<br/>                },<br/>                "client_token": "",<br/>                "cpu_options": {<br/>                    "core_count": 1,<br/>                    "threads_per_core": 1<br/>                },<br/>                "ebs_optimized": false,<br/>                "ena_support": true,<br/>                "enclave_options": {<br/>                    "enabled": false<br/>                },<br/>                "hibernation_options": {<br/>                    "configured": false<br/>                },<br/>                "hypervisor": "xen",<br/>                "image_id": "ami-087c17d1fe0178315",<br/>                "instance_id": "i-0d1f6c9e678e60185",<br/>                "instance_type": "t2.micro",<br/>                "key_name": "tests",<br/>                "launch_time": "2021-09-08T06:32:37+00:00",<br/>                "metadata_options": {<br/>                    "http_endpoint": "enabled",<br/>                    "http_protocol_ipv6": "disabled",<br/>                    "http_put_response_hop_limit": 1,<br/>                    "http_tokens": "optional",<br/>                    "state": "applied"<br/>                },<br/>                "monitoring": {<br/>                    "state": "disabled"<br/>                },<br/>                "network_interfaces": [<br/>                    {<br/>                        "association": {<br/>                            "ip_owner_id": "amazon",<br/>                            "public_dns_name": "ec2-52-90-221-25.compute-1.amazonaws.com",<br/>                            "public_ip": "52.90.221.25"<br/>                        },<br/>                        "attachment": {<br/>                            "attach_time": "2021-09-08T06:32:37+00:00",<br/>                            "attachment_id": "eni-attach-00b9e24d154e08de2",<br/>                            "delete_on_termination": true,<br/>                            "device_index": 0,<br/>                            "network_card_index": 0,<br/>                            "status": "attached"<br/>                        },<br/>                        "description": "",<br/>                        "groups": [<br/>                            {<br/>                                "group_id": "sg-06e7003e04d368388",<br/>                                "group_name": "launch-wizard-1"<br/>                            }<br/>                        ],<br/>                        "interface_type": "interface",<br/>                        "ipv6_addresses": [],<br/>                        "mac_address": "12:ec:04:76:8c:1d",<br/>                        "network_interface_id": "eni-0bd2237d5c6d162a7",<br/>                        "owner_id": "765631733981",<br/>                        "private_dns_name": "ip-172-31-84-192.ec2.internal",<br/>                        "private_ip_address": "172.31.84.192",<br/>                        "private_ip_addresses": [<br/>                            {<br/>                                "association": {<br/>                                    "ip_owner_id": "amazon",<br/>                                    "public_dns_name": "ec2-52-90-221-25.compute-1.amazonaws.com",<br/>                                    "public_ip": "52.90.221.25"<br/>                                },<br/>                                "primary": true,<br/>                                "private_dns_name": "ip-172-31-84-192.ec2.internal",<br/>                                "private_ip_address": "172.31.84.192"<br/>                            }<br/>                        ],<br/>                        "source_dest_check": true,<br/>                        "status": "in-use",<br/>                        "subnet_id": "subnet-e490c9c5",<br/>                        "vpc_id": "vpc-84bfd0f9"<br/>                    }<br/>                ],<br/>                "owner_id": "765631733981",<br/>                "placement": {<br/>                    "availability_zone": "us-east-1d",<br/>                    "group_name": "",<br/>                    "region": "us-east-1",<br/>                    "tenancy": "default"<br/>                },<br/>                "private_dns_name": "ip-172-31-84-192.ec2.internal",<br/>                "private_ip_address": "172.31.84.192",<br/>                "product_codes": [],<br/>                "public_dns_name": "ec2-52-90-221-25.compute-1.amazonaws.com",<br/>                "public_ip_address": "52.90.221.25",<br/>                "requester_id": "",<br/>                "reservation_id": "r-061722678cf48ffa4",<br/>                "root_device_name": "/dev/xvda",<br/>                "root_device_type": "ebs",<br/>                "security_groups": [<br/>                    {<br/>                        "group_id": "sg-06e7003e04d368388",<br/>                        "group_name": "launch-wizard-1"<br/>                    }<br/>                ],<br/>                "source_dest_check": true,<br/>                "state": {<br/>                    "code": 16,<br/>                    "name": "running"<br/>                },<br/>                "state_transition_reason": "",<br/>                "subnet_id": "subnet-e490c9c5",<br/>                "tags": {<br/>                    "Name": "Slave-1"<br/>                },<br/>                "virtualization_type": "hvm",<br/>                "vpc_id": "vpc-84bfd0f9"<br/>            }<br/>        }<br/>    },<br/>    "all": {<br/>        "children": [<br/>            "aws_ec2",<br/>            "ungrouped"<br/>        ]<br/>    },<br/>    "aws_ec2": {<br/>        "hosts": [<br/>            "ec2-52-90-221-25.compute-1.amazonaws.com"<br/>        ]<br/>    }<br/>}</span></pre><blockquote class="mc md me"><p id="f435" class="jd je mf jf b jg ks ji jj jk kt jm jn mg ku jq jr mh kv ju jv mi kw jy jz ka hb bi translated"><strong class="jf hj">注意:- </strong>您也可以使用过滤器，通过添加以下细节来修改<code class="du lz ma mb lq b">aws_ec2.yaml</code>或<code class="du lz ma mb lq b">aws_ec2.yml</code>文件，从而获得特定的输出</p></blockquote><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="1b93" class="lu ig hi lq b fi lv lw l lx ly"><strong class="lq hj">filters:</strong><br/>  <em class="mf"># All instances with their `Environment` tag set to `dev`</em><br/>  tag:Environment<strong class="lq hj">:</strong> dev<br/>  <em class="mf"># All dev and QA hosts</em><br/>  tag:Environment<strong class="lq hj">:</strong><br/>    <strong class="lq hj">-</strong> dev<br/>    <strong class="lq hj">-</strong> qa</span></pre><p id="0a34" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><strong class="jf hj">第7步:- </strong>运行<code class="du lz ma mb lq b">ad-hoc</code>命令</p><ul class=""><li id="ad8a" class="kx ky hi jf b jg ks jk kt jo lm js ln jw lo ka lc ld le lf bi translated">我们可以通过运行下面的命令在EC2实例上运行各种命令</li></ul><ol class=""><li id="4c1e" class="kx ky hi jf b jg ks jk kt jo lm js ln jw lo ka mk ld le lf bi translated"><strong class="jf hj">乒</strong></li></ol><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="d3d6" class="lu ig hi lq b fi lv lw l lx ly">ansible &lt;group-name&gt; -i aws_ec2.yaml -m ping --private-key=&lt;private-key-name&gt; </span></pre><p id="36b3" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">您应该得到如下所示的输出</p><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="c596" class="lu ig hi lq b fi lv lw l lx ly">ec2-107-21-17-60.compute-1.amazonaws.com | SUCCESS =&gt; {<br/>    "ansible_facts": {<br/>        "discovered_interpreter_python": "/usr/bin/python"<br/>    }, <br/>    "changed": false, <br/>    "ping": "pong"<br/>}</span></pre><p id="1117" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">2.安装<strong class="jf hj"> Git </strong></p><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="ca92" class="lu ig hi lq b fi lv lw l lx ly">ansible &lt;group-name&gt; -i aws_ec2.yaml -m yum -a 'name=git state=present' --private-key=&lt;private-key-name&gt;</span></pre><p id="8f78" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">您应该得到如下所示的输出</p><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="7364" class="lu ig hi lq b fi lv lw l lx ly">ec2-54-86-185-90.compute-1.amazonaws.com | CHANGED =&gt; {<br/>    "ansible_facts": {<br/>        "discovered_interpreter_python": "/usr/bin/python"<br/>    }, <br/>    "changed": true, <br/>    "changes": {<br/>        "installed": [<br/>            "git"<br/>        ]<br/>    }, <br/>    "msg": "", <br/>    "rc": 0, <br/>    "results": </span></pre><p id="de39" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><strong class="jf hj">第八步:</strong>-<strong class="jf hj">分组</strong>实例</p><ul class=""><li id="da30" class="kx ky hi jf b jg ks jk kt jo lm js ln jw lo ka lc ld le lf bi translated">您可以使用标签、实例类型、实例名称、自定义过滤器等对实例进行分组</li><li id="9fd1" class="kx ky hi jf b jg lh jk li jo lj js lk jw ll ka lc ld le lf bi translated">你可以从<a class="ae lg" href="https://docs.ansible.com/ansible/latest/collections/amazon/aws/aws_ec2_inventory.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj">这里</strong> </a>找到更多细节</li><li id="61ae" class="kx ky hi jf b jg lh jk li jo lj js lk jw ll ka lc ld le lf bi translated">在<code class="du lz ma mb lq b">aws_ec2.yaml</code>文件中添加以下代码</li></ul><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="94d3" class="lu ig hi lq b fi lv lw l lx ly">keyed_groups:<br/>  - key: tags<br/>    prefix: tag<br/>  - prefix: instance_type<br/>    key: instance_type<br/>  - key: placement.region<br/>    prefix: aws_region</span></pre><ul class=""><li id="a65e" class="kx ky hi jf b jg ks jk kt jo lm js ln jw lo ka lc ld le lf bi translated">运行以下命令以检查输出</li></ul><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="06d5" class="lu ig hi lq b fi lv lw l lx ly">ansible-inventory --graph</span></pre><ul class=""><li id="ff1d" class="kx ky hi jf b jg ks jk kt jo lm js ln jw lo ka lc ld le lf bi translated">您将看到如下所示的输出，所有实例都分组在标签、区域和区域下，动态组名为<code class="du lz ma mb lq b">aws_region_us_east_1</code>、<code class="du lz ma mb lq b">instance_type_t2_micro</code>、<code class="du lz ma mb lq b">tag_Name_Ansible</code></li></ul><p id="ef90" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated"><strong class="jf hj">第9步:- </strong>运行<strong class="jf hj"> ansible-playbook </strong></p><ul class=""><li id="9b34" class="kx ky hi jf b jg ks jk kt jo lm js ln jw lo ka lc ld le lf bi translated">我们还可以使用动态库存来运行ansible-playbook</li><li id="2493" class="kx ky hi jf b jg lh jk li jo lj js lk jw ll ka lc ld le lf bi translated">创建一个名为<code class="du lz ma mb lq b">apache.yml</code>的文件，并将下面的代码添加到其中</li></ul><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="15e0" class="lu ig hi lq b fi lv lw l lx ly">---<br/>- hosts: aws_ec2<br/>  become: true<br/>  tasks:<br/>    - name: ensure apache is at the latest version<br/>      yum: name=httpd state=latest<br/>    - name: start apache<br/>      service:<br/>          name: httpd<br/>          state: started</span></pre><ul class=""><li id="0de7" class="kx ky hi jf b jg ks jk kt jo lm js ln jw lo ka lc ld le lf bi translated">上面的代码将在所有EC2实例上安装apache，并启动apache服务</li><li id="4522" class="kx ky hi jf b jg lh jk li jo lj js lk jw ll ka lc ld le lf bi translated">运行以下命令来执行行动手册</li></ul><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="2023" class="lu ig hi lq b fi lv lw l lx ly">ansible-playbook -i aws_ec2.yml apache.yml --private-key=&lt;your-private-key&gt;</span></pre><ul class=""><li id="9f4e" class="kx ky hi jf b jg ks jk kt jo lm js ln jw lo ka lc ld le lf bi translated">您应该会看到如下所示的输出</li></ul><pre class="kc kd ke kf fd lp lq lr ls aw lt bi"><span id="b499" class="lu ig hi lq b fi lv lw l lx ly">PLAY [aws_ec2] ****************************************************************************************************************************************</span><span id="c29b" class="lu ig hi lq b fi ml lw l lx ly">TASK [Gathering Facts] ********************************************************************************************************************************</span><span id="ef07" class="lu ig hi lq b fi ml lw l lx ly">[WARNING]: Platform linux on host ec2-54-86-185-90.compute-1.amazonaws.com is using the discovered Python interpreter at /usr/bin/python, but future</span><span id="c773" class="lu ig hi lq b fi ml lw l lx ly">installation of another Python interpreter could change this. See https://docs.ansible.com/ansible/2.9/reference_appendices/interpreter_discovery.html</span><span id="52b0" class="lu ig hi lq b fi ml lw l lx ly">for more information.</span><span id="dd07" class="lu ig hi lq b fi ml lw l lx ly">ok: [ec2-54-86-185-90.compute-1.amazonaws.com]</span><span id="0665" class="lu ig hi lq b fi ml lw l lx ly">[WARNING]: Platform linux on host ec2-107-21-17-60.compute-1.amazonaws.com is using the discovered Python interpreter at /usr/bin/python, but future</span><span id="6919" class="lu ig hi lq b fi ml lw l lx ly">installation of another Python interpreter could change this. See https://docs.ansible.com/ansible/2.9/reference_appendices/interpreter_discovery.html</span><span id="ea3b" class="lu ig hi lq b fi ml lw l lx ly">for more information.</span><span id="46b4" class="lu ig hi lq b fi ml lw l lx ly">ok: [ec2-107-21-17-60.compute-1.amazonaws.com]</span><span id="1bb3" class="lu ig hi lq b fi ml lw l lx ly">TASK [ensure apache is at the latest version] *********************************************************************************************************</span><span id="5896" class="lu ig hi lq b fi ml lw l lx ly">changed: [ec2-54-86-185-90.compute-1.amazonaws.com]</span><span id="5075" class="lu ig hi lq b fi ml lw l lx ly">changed: [ec2-107-21-17-60.compute-1.amazonaws.com]</span><span id="7b30" class="lu ig hi lq b fi ml lw l lx ly">TASK [start apache] ***********************************************************************************************************************************</span><span id="176d" class="lu ig hi lq b fi ml lw l lx ly">changed: [ec2-54-86-185-90.compute-1.amazonaws.com]</span><span id="0464" class="lu ig hi lq b fi ml lw l lx ly">changed: [ec2-107-21-17-60.compute-1.amazonaws.com]</span><span id="4973" class="lu ig hi lq b fi ml lw l lx ly">PLAY RECAP ********************************************************************************************************************************************</span><span id="3bea" class="lu ig hi lq b fi ml lw l lx ly">ec2-107-21-17-60.compute-1.amazonaws.com : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span><span id="0c99" class="lu ig hi lq b fi ml lw l lx ly">ec2-54-86-185-90.compute-1.amazonaws.com : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span></pre><p id="2258" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">就这样，你已经了解了Ansible动态库存的所有内容。您可以从<a class="ae lg" href="https://docs.ansible.com/ansible/latest/collections/amazon/aws/aws_ec2_inventory.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj">这里</strong> </a>进一步探索Ansible动态库存。</p><p id="28bc" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">如果您发现此指南有帮助，请点击👏按钮，也可以随意发表评论。</p><p id="c796" class="pw-post-body-paragraph jd je hi jf b jg ks ji jj jk kt jm jn jo ku jq jr js kv ju jv jw kw jy jz ka hb bi translated">关注更多类似的故事😊</p></div></div>    
</body>
</html>