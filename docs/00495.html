<html>
<head>
<title>How I Filtered Tests with Cypress.io</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何用Cypress.io过滤测试</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-i-filtered-tests-with-cypress-io-9c7a85460a1d?source=collection_archive---------1-----------------------#2021-02-20">https://medium.com/geekculture/how-i-filtered-tests-with-cypress-io-9c7a85460a1d?source=collection_archive---------1-----------------------#2021-02-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="f12d" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">了解如何使用Cypress测试框架通过标签过滤测试。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/4ba2bb73f9a99945b08aeb506648d136.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2koKAGfoIwlSNjDX"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@wadeaustinellis?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Wade Austin Ellis</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d739" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">测试自动化领域的一个常见实践是基于一组标准来过滤运行，无论是单独运行UI测试还是API测试。测试过滤有助于减少运行，从而使它们的范围适合手头的工作。</p><p id="b2d7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Cypress不提供原生过滤测试运行的能力，这是一个自2018年以来一直存在的问题。相反，工程师必须编写他们自己的过滤方法来使用Cypress。</p><p id="1f26" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我在北卡罗来纳州罗利的一家初创企业工作时遇到了这个问题。该商店有数百个用Ruby和Python编写的测试，但没有一个是用JavaScript编写的。有了丰富的Python和Pytest经验，我选择模仿我最喜欢的框架，<strong class="jq hj">标记</strong>。</p><p id="5093" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Pytest标记类似于标记，因为它们允许在完整运行期间确定测试范围。我可以选择一个目标(或者更多，如果我想的话)来运行，而不是运行整个套件。Pytest会自动选择所有带有特定标记的测试并加载它们。所有其他测试都将被取消选择，因此不会在测试运行中进行处理。</p><p id="5ff8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在本教程中，我将教您如何为Cypress测试构建您自己的过滤器，它将基于一个(或多个)测试标签进行加载。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="260f" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">入门指南</h1><p id="c7ce" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">对于任何新的JavaScript项目，我们必须使用NPM进行初始化。一旦我们有了<code class="du lo lp lq lr b">package.json</code>，现在我们可以开始装载柏树。</p><pre class="iy iz ja jb fd ls lr lt lu aw lv bi"><span id="b303" class="lw ks hi lr b fi lx ly l lz ma">npm install --save-dev cypress</span></pre><p id="8b3c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦安装了Cypress，用NPM运行它，这样它就可以完成安装。</p><pre class="iy iz ja jb fd ls lr lt lu aw lv bi"><span id="ea37" class="lw ks hi lr b fi lx ly l lz ma">npx cypress open</span></pre><p id="3e4d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">当一个<code class="du lo lp lq lr b">cypress</code>目录被创建后，Cypress就完成了安装。您还可以通过运行<code class="du lo lp lq lr b">npx cypress --version</code>来验证安装是否正确。</p><h1 id="c818" class="kr ks hi bd kt ku mb kw kx ky mc la lb io md ip ld ir me is lf iu mf iv lh li bi translated">构建更好的过滤器</h1><p id="b2a0" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">在谷歌上快速搜索“cypress测试标签”会返回两个很好的结果:</p><ol class=""><li id="26f3" class="mg mh hi jq b jr js ju jv jx mi kb mj kf mk kj ml mm mn mo bi translated">Marie Drake的“使用标签过滤Cypress测试”</li><li id="f92c" class="mg mh hi jq b jr mp ju mq jx mr kb ms kf mt kj ml mm mn mo bi translated">TestersDock的“如何将标签应用到Cypress测试中”</li></ol><p id="a6e7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">第一篇文章是我的解决方案的基础。第二篇文章使用了我不太喜欢的GREP解决方案。实际上，我最终为一家使用TestersDock提出的GREP解决方案的公司工作，结果喜忧参半。我们发现GREP会引入不属于它的测试，仅仅因为在测试描述中写了一个词。例如，包含单词“API”的测试将被拉入API套件。</p><p id="820a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我最终选择删除GREP解决方案，支持修改Marie Drake的原始提案。</p><p id="6609" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我首先用函数<code class="du lo lp lq lr b">filterTests</code>在我的<code class="du lo lp lq lr b">support</code>目录中构建了一个<code class="du lo lp lq lr b">filterTests.js</code>模块。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">The beginning of our filterTests method.</figcaption></figure><p id="c6f1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">按照玛丽·德雷克的大纲，我添加了两个参数— <code class="du lo lp lq lr b">definedTags</code>和<code class="du lo lp lq lr b">runTest</code>。<code class="du lo lp lq lr b">definedTags</code>参数是一个字符串数组。<code class="du lo lp lq lr b">runTest</code>是包含一个模块内所有测试的函数。在这里，我创建了一个名为<code class="du lo lp lq lr b">tags</code>的Cypress环境变量。我选择使用<code class="du lo lp lq lr b">tags</code>而不是Marie Drake的“TEST_TAGS ”,因为Cypress环境变量是小写的，而不是大写和小写。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">The addition of our environment variable, “tags”.</figcaption></figure><p id="adf5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，我可以通过运行以下命令，使用tags环境变量打开Cypress:</p><pre class="iy iz ja jb fd ls lr lt lu aw lv bi"><span id="413b" class="lw ks hi lr b fi lx ly l lz ma">npx cypress open --env tags=api</span></pre><p id="02ed" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们需要一个条件来检查标签是否存在，以便对我们的标签采取类似于Marie Drake实现的行动。主要的区别是，我们不是在逗号上拆分，而是在斜杠上拆分。一旦找到，调用<code class="du lo lp lq lr b">runTest</code>方法来运行测试。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Conditional code for if “tags” is true.</figcaption></figure><h1 id="b017" class="kr ks hi bd kt ku mb kw kx ky mc la lb io md ip ld ir me is lf iu mf iv lh li bi translated">运行不带标签的测试</h1><p id="1aa5" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">上面的过滤器(以及Marie Drake提出的过滤器)将在所有情况下工作，除了那些没有提供环境标签的情况。尝试使用<code class="du lo lp lq lr b">npx cypress open</code>运行测试将会失败，因为我们没有默认运行测试的第二个条件。这是一个错误，因为在很多情况下需要运行整个套件。</p><p id="c027" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">简单地添加一个包含<code class="du lo lp lq lr b">runTest()</code>的<code class="du lo lp lq lr b">else</code>子句就可以了。</p><h1 id="a1be" class="kr ks hi bd kt ku mb kw kx ky mc la lb io md ip ld ir me is lf iu mf iv lh li bi translated">成品</h1><p id="8bff" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">您可以复制下面的要点，并将其粘贴到您的<code class="du lo lp lq lr b">support</code>目录下的<code class="du lo lp lq lr b">filterTests.js</code>模块中。继续阅读，了解如何在测试规范中使用过滤器。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Our finished filtering method.</figcaption></figure><h1 id="654e" class="kr ks hi bd kt ku mb kw kx ky mc la lb io md ip ld ir me is lf iu mf iv lh li bi translated">过滤测试</h1><p id="5783" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">我们可以通过将新建的过滤器导入到测试文件中来使用它，然后在第一个<code class="du lo lp lq lr b">describe</code>块之前添加一个方法调用。这样，规范文件中的所有测试都将被过滤。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">An incomplete use of the filterTests method.</figcaption></figure><p id="d354" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">因为我们正在使用Cypress自动化UI，所以我们可以向<code class="du lo lp lq lr b">filterTests</code>方法添加两个标签，“all”和“UI”。我已经写出了两个测试来演示过滤器的要点如下。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">A properly filtered series of tests.</figcaption></figure><p id="b2f1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以通过使用以下代码启动Cypress UI来测试我们的过滤方法:</p><pre class="iy iz ja jb fd ls lr lt lu aw lv bi"><span id="89d8" class="lw ks hi lr b fi lx ly l lz ma">npx cypress open --env tags=api</span></pre><p id="bfbe" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">选择<code class="du lo lp lq lr b">elements.spec.js</code>并运行。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mw"><img src="../Images/c50a5b88487a8ac062d1c1dc42ff53ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g8OsmHaMdCpaBM-4LozOrg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">The result of using an “api” tag on a UI repository.</figcaption></figure><p id="c3b1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">结果是没有找到测试，因为标签<code class="du lo lp lq lr b">api</code>与<code class="du lo lp lq lr b">filterTests</code>方法中的<code class="du lo lp lq lr b">definedTags</code>不匹配。为了在规范文件中运行测试，我们必须包含“all”或“ui”。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mx"><img src="../Images/abb28d69132f0f52d4ebebd3b7778b82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Piwt4sjvC6i6hx54O0xtfg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">A properly filtered run using the “ui” tag.</figcaption></figure><h1 id="df95" class="kr ks hi bd kt ku mb kw kx ky mc la lb io md ip ld ir me is lf iu mf iv lh li bi translated">使用Cypress模块API运行测试</h1><p id="c42f" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">通过创建包含Cypress运行参数的JavaScript文件，可以通过Cypress模块API过滤测试。例如，我们将创建一个在元素页面模块中运行所有测试的模块。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="db68" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">创建后，您可以在终端中运行以下内容:</p><pre class="iy iz ja jb fd ls lr lt lu aw lv bi"><span id="5170" class="lw ks hi lr b fi lx ly l lz ma">node .\run-elements-tests.js</span></pre><p id="949d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这将启动一个带有环境标签“elements”的自动化运行，它不应该加载任何不包含该标签的模块。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es my"><img src="../Images/1ac193c3762b75fae795e0f1c7582c92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_TeWYUbaRPU1gmEc8bqWzg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">An unloaded test module.</figcaption></figure><p id="4cdc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">跳过的测试将在所有区域显示零，因为Cypress runner中没有加载测试。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/b4230e6acbe643e355cd80ef9b9670ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n2mpHZmU_e_3ZNG2rO9Nww.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">A loaded test module.</figcaption></figure><p id="9d75" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">加载的测试模块将按预期运行。</p><h1 id="a829" class="kr ks hi bd kt ku mb kw kx ky mc la lb io md ip ld ir me is lf iu mf iv lh li bi translated">项目目录</h1><p id="d5d7" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">完成本教程后，您的目录应该如下所示:</p><pre class="iy iz ja jb fd ls lr lt lu aw lv bi"><span id="61b4" class="lw ks hi lr b fi lx ly l lz ma">cypress<br/>    |__ integration<br/>        |__ elements.spec.js<br/>    |__ plugins<br/>        |__ index.js<br/>    |__ support<br/>        |__ filterTests.js<br/>        |__ index.js</span><span id="65b3" class="lw ks hi lr b fi na ly l lz ma">.gitignore<br/>cypress.json<br/>package-lock.json<br/>package.json<br/>README.md</span></pre><h1 id="7faf" class="kr ks hi bd kt ku mb kw kx ky mc la lb io md ip ld ir me is lf iu mf iv lh li bi translated">摘要</h1><p id="f531" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">一旦构建了一个定制的方法，用Cypress过滤测试就很容易了。使用环境变量，我们可以将测试标签传递给Cypress，然后过滤掉超出我们运行范围的测试。如果我们选择不使用标签运行，我们可以有效地运行我们的存储库，不会有任何问题。</p><h1 id="3c20" class="kr ks hi bd kt ku mb kw kx ky mc la lb io md ip ld ir me is lf iu mf iv lh li bi translated">资源</h1><ol class=""><li id="e66e" class="mg mh hi jq b jr lj ju lk jx nb kb nc kf nd kj ml mm mn mo bi translated">"要运行的过滤器或Grep特定测试(如Mocha Grep模式)问题#1865 Cypress-Io/Cypress . "<em class="ne"> GitHub </em>，hannah06，【github.com/cypress-io/cypress/issues/1865】T2。</li><li id="1a91" class="mg mh hi jq b jr mp ju mq jx mr kb ms kf mt kj ml mm mn mo bi translated">德雷克玛丽。"使用标签来过滤你的Cypress测试."<em class="ne">玛丽·德雷克</em>，玛丽·德雷克，2019年12月15日，<a class="ae jn" href="http://www.mariedrake.com/post/using-tags-to-filter-your-cypress-tests." rel="noopener ugc nofollow" target="_blank">www . Marie Drake . com/post/using-tags-to-filter-your-cypress-tests。</a></li><li id="9b7b" class="mg mh hi jq b jr mp ju mq jx mr kb ms kf mt kj ml mm mn mo bi translated">"如何应用标签到你的柏树测试，如烟雾，E2E . "<em class="ne">测试者码头</em>，2020年10月29日，<a class="ae jn" href="http://testersdock.com/cypress-test-tags/" rel="noopener ugc nofollow" target="_blank">testersdock.com/cypress-test-tags/</a>。</li></ol></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><p id="4dfd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> Jonathan Thompson </strong>是Pendo.io的高级质量工程师，专攻测试自动化。他目前和妻子以及一只名叫温斯顿的金毛猩猩住在北卡罗来纳州的罗利。你可以在<a class="ae jn" href="https://www.linkedin.com/in/jonathanmnthompson/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系他，或者在<a class="ae jn" href="https://twitter.com/jacks_elsewhere" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae jn" href="http://github.com/ThompsonJonM" rel="noopener ugc nofollow" target="_blank"> Github </a>上关注他。</p></div></div>    
</body>
</html>