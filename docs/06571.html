<html>
<head>
<title>Classifying spiders of Kentucky with fastAi. Part V</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用fastAi分类肯塔基蜘蛛。第五部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/classifying-spiders-of-kentucky-with-fastai-part-v-e797af27e65?source=collection_archive---------50-----------------------#2021-08-23">https://medium.com/geekculture/classifying-spiders-of-kentucky-with-fastai-part-v-e797af27e65?source=collection_archive---------50-----------------------#2021-08-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="af4b" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">第五部分</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/b0e46eaa3f9de72e47088d34df7a4fc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IO7Dxwe82OnO_46i3bYGPQ.png"/></div></div></figure><p id="0a07" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">太好了！你从第三部分回来了，在那里我们微调了我们的超参数，并学习了如何找到正确的学习率。第三部分向我们展示了使用Resnet152为我提供了最低的错误率。最后我得到了0.38%的错误率。在我看来，这对于这款车型来说相当不错。下面是一个混淆矩阵，通过这个矩阵，你可以看到深度学习算法只是犯了简单的错误，只有专业的主题专家才能区分，例如，模型错误地分类了一只蜘蛛是北方黑寡妇还是南方黑寡妇。这可能很常见，因为它试图分类的图像可能没有显示沙漏，一个沙漏是满的，而另一个沙漏是空的。如果图像没有显示出好的图像，那么它必须做出最好的预测。另一个错误的分类是捕鱼蜘蛛。当我看这些照片时，我觉得它们看起来都一样。就像跳蛛一样，区分它们也是一个问题。我们可以结合我们的蜘蛛类型，这将大大降低我们的学习速度，达到一个非常体面的数字。例如，我们可以使用诸如跳蛛、黑寡妇、钓鱼蛛、花园蛛等标签。然而，这不是我们的目标，我们实际上想了解这个物种。现在你可以改变标签和导入图片，如果你想的话，事实上我建议如果你想降低你的错误率，去试试吧。使用较小的传输模型(如Resnet34)可能不会有问题。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kg"><img src="../Images/f109098bb221e7796aee56f718e9465d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cdszjJZwZk68HkVvG-i-yw.png"/></div></div></figure><p id="e4d0" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">要构建Resnet34应用程序，请在构建我们的应用程序之前遵循下面的github要点。要构建更大的moder，如Resnet152，请将传输模型更改为Resnet152 vs Resnet34。差别不大，除了我的花园蜘蛛实际上被标记为99%的概率对78%的概率。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="3d51" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">为了开始构建我们的应用程序，我们导入以下库。</p><pre class="iy iz ja jb fd kj kk kl km aw kn bi"><span id="8524" class="ko kp hi kk b fi kq kr l ks kt">!pip install -Uqq fastbook<br/>!pip install voila<br/>!jupyter serverextension enable --sys-prefix voila</span><span id="58bc" class="ko kp hi kk b fi ku kr l ks kt">import fastbook<br/>import warnings<br/>import os</span><span id="81a1" class="ko kp hi kk b fi ku kr l ks kt">fastbook.setup_book()<br/>from fastai.vision.all import *<br/>from fastbook import *<br/>from fastai.vision.widgets import *</span></pre><p id="c56a" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这就设置了我们所有必需的fastai工具。我们看到fastai导入小部件，这些小部件用于构建我们的原型。所以，我应该先解释一下我们要做的事情。第五部分使用pkl文件，发音为“pickle ”,在这个应用程序中进行我们的预测。因此，在第三部分中，我们将模型保存为spider_model.pkl。我们将在此应用程序中使用该文件来生成我们的spider_classification_app。</p><p id="68ed" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果使用Google Colab，不要把它放在gdrive目录中。我只是下载了文件，并上传到sample downloads下的本地目录中。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es kv"><img src="../Images/28addf50982827d9c18a263c323b4260.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*aP3LYHpN8DEV5tQl_X-ZfA.png"/></div></figure><p id="4922" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们的下一步是设置我们的路径并指向我们上面提到的pkl文件。</p><pre class="iy iz ja jb fd kj kk kl km aw kn bi"><span id="6abd" class="ko kp hi kk b fi kq kr l ks kt"># setting the path to Path</span><span id="4814" class="ko kp hi kk b fi ku kr l ks kt">path = Path()<br/>learn_inf = load_learner('spider_model.pkl', cpu=True)</span><span id="a365" class="ko kp hi kk b fi ku kr l ks kt"># get the imagefrom the upload, display size 128, 128</span><span id="40a5" class="ko kp hi kk b fi ku kr l ks kt">btn_upload = widgets.FileUpload()<br/>out_pl = widgets.Output()<br/>btn_run = widgets.Button(description='Classify')<br/>lbl_pred = widgets.Label()</span></pre><p id="6ccf" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们刚刚开始用上面的代码制作我们的应用程序。我们刚刚建立了几个按钮，将出现在我们的应用程序。我们有一个上传文件的按钮，和一个分类按钮。接下来，我们将使用“上传”按钮上传一张图像，一旦图像被加载，我们将点击“分类”按钮并获得预测。我们用下面的函数来实现这一切。</p><pre class="iy iz ja jb fd kj kk kl km aw kn bi"><span id="ef95" class="ko kp hi kk b fi kq kr l ks kt"># define the function to put all the buttons together and make our app</span><span id="525e" class="ko kp hi kk b fi ku kr l ks kt">def on_click_classify(change):<br/>    img = PILImage.create(btn_upload.data[-1])<br/>    out_pl.clear_output()<br/>    with out_pl: display(img.to_thumb(128, 128))<br/>    pred,pred_idx,probs = learn_inf.predict(img)<br/>    lbl_pred.value = f'Predictions: {pred}; Probability<br/>    {probs[pred_idx]:.04f}'</span><span id="8009" class="ko kp hi kk b fi ku kr l ks kt">btn_run.on_click(on_click_classify)</span></pre><p id="c9f6" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们的函数创建了一个按钮(我们使用python pil库),单击该按钮将清除输出，并显示所选图像，大小为128 X 128。我们使用我们的learn_inf.predict来显示fastai预测并显示概率。</p><pre class="iy iz ja jb fd kj kk kl km aw kn bi"><span id="a269" class="ko kp hi kk b fi kq kr l ks kt"># you use upload to upload the image of your spider, then click classify to get the results</span><span id="2aeb" class="ko kp hi kk b fi ku kr l ks kt">VBox([widgets.Label('Select your spider!'),<br/>btn_upload, btn_run, out_pl, lbl_pred])</span></pre><p id="aed4" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们使用VBox来显示我们的标签并获得我们的预测，VBox是小部件的一部分。如果一切顺利，你会有一个相似的结果。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kw"><img src="../Images/e045d379bfdf3f288994d5eccb0fcc30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fJ5NJ9AiqG0mpS3im8k78Q.png"/></div></div></figure><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="003c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">对于下一步，我必须下到resnet34，因为我的。pkl文件超过200MB。我们将需要我们的pkl文件上传或推入我们的github repo。使用Renset34将允许我们上传84mb到github。文件很大，所以我会使用这里列出的步骤<a class="ae kf" href="https://git-lfs.github.com" rel="noopener ugc nofollow" target="_blank">使用大文件系统(lsf)将您的pkl文件推送到github。在接下来的步骤中，我们将依靠github知识库和一个名为</a><a class="ae kf" href="https://mybinder.org" rel="noopener ugc nofollow" target="_blank"> binder </a>的程序来发布我们的原型。</p><p id="33a3" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在我们开始之前，您需要创建一个名为requirements.txt的txt文件，并将这两项添加到文本文件中。快本和瞧。将这两个文件推送到我们的github库。一个简单的方法是在github中创建文件，选择add file，创建新文件，将其命名为requirements.txt，然后添加这两个项目。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kx"><img src="../Images/4569fb424ba810a2abac5972b4119506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TrIQ-N0eYdfEeLRICuTc8Q.png"/></div></div></figure><p id="bee0" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">首先，我们导航到https://mybinder.org<a class="ae kf" href="https://mybinder.org" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ky"><img src="../Images/994f0571eb68e707ad5137f6e36a0333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Rco6KsslTsc7R-JJ3SBPg.png"/></div></div></figure><p id="c6e0" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在第一个文本框中，我们放置了我们的存储库的位置，然后在笔记本文件的路径中，我们添加了/voila/render/spider _ classifier _ app . ipynb</p><p id="027f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">一旦我们添加了我们的存储库信息，选择启动。坐下来放松，这需要一两分钟。</p><p id="4bc9" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这是我的活页夹应用<a class="ae kf" href="https://hub.gke2.mybinder.org/user/chris-kehl-spider_classifier-3e0jgzp7/voila/render/spider_classifier_app.ipynb?token=m4dhDn6KRKGfWDnGtz6JBw" rel="noopener ugc nofollow" target="_blank">(点击这里)</a>的链接</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kz"><img src="../Images/60066f9e141496d27d678707a093113d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a2RatQnaSCcAuDqOqKicOQ.png"/></div></div></figure><p id="1823" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">所以这款应用可以在任何设备上运行。最酷的是，如果你用手机加载它，你可以给你的蜘蛛拍照。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es la"><img src="../Images/6e9c2369b004e824823fb7846f1d9868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UB5ThLORvVAEKPpNfjlbfA.png"/></div></div></figure><p id="9c8e" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这是最终产品。现在我有一个文件路径显示，你可以玩它，让你的屏幕干净一点。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es la"><img src="../Images/8affbb3d8967ebe19a00104d00d196f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p5epDc-PHkFEb2G0UGmEsg.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">end of phone</figcaption></figure><p id="50e5" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">请继续关注我，我将研究如何用swift和flutter构建这个应用程序，以将它添加为一个实际的移动应用程序。</p></div></div>    
</body>
</html>