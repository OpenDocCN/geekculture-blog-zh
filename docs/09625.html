<html>
<head>
<title>Discord bot using DailoGPT and HuggingFace API.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用DailoGPT和HuggingFace API的Discord bot。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/discord-bot-using-dailogpt-and-huggingface-api-c71983422701?source=collection_archive---------6-----------------------#2021-12-20">https://medium.com/geekculture/discord-bot-using-dailogpt-and-huggingface-api-c71983422701?source=collection_archive---------6-----------------------#2021-12-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="63ec" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">使用Hugging face API设计自己的Rick bot，并将其部署在Replit服务器上。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/f3b6daa1abbb8baa7b40ea17b774a11e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9x1EmiAyie6zVAr2"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@michael_marais?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Michael Marais</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="887c" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">介绍</h1><p id="93cb" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">如果你想知道Discord bot是如何工作的，以及如何创建自己的机器人，像你最喜欢的漫画中的某个名人或某个角色那样说话，这表明你处于最佳起点。我们将学习如何使用HuggingFace API，并把它作为一个不和谐的机器人。我们还将学习Replit、Kaggle CLI和<strong class="ki hj"> uptimerobot </strong>来保持你的机器人运行。我们不会深入调整我们的<strong class="ki hj"> DailoGPT </strong>模型，你可以查看这个<a class="ae jn" href="https://towardsdatascience.com/make-your-own-rick-sanchez-bot-with-transformers-and-dialogpt-fine-tuning-f85e6d1f4e30" rel="noopener" target="_blank">博客</a>。</p></div><div class="ab cl lc ld gp le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hb hc hd he hf"><h1 id="298a" class="jo jp hi bd jq jr lj jt ju jv lk jx jy io ll ip ka ir lm is kc iu ln iv ke kf bi translated">资料组</h1><p id="3147" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">我们将使用一个<strong class="ki hj"> Kaggle CLI </strong>来下载公开发布的<a class="ae jn" href="https://www.kaggle.com/andradaolteanu/rickmorty-scripts" rel="noopener ugc nofollow" target="_blank"> Rick &amp; Morty脚本| Kaggle </a>。如果你想学习如何获得你的Kaggle API和如何使用Kaggle CLI，请点击这个<a class="ae jn" href="https://github.com/Kaggle/kaggle-api" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><pre class="iy iz ja jb fd lo lp lq lr aw ls bi"><span id="fec0" class="lt jp hi lp b fi lu lv l lw lx">!kaggle datasets download andradaolteanu/rickmorty-scripts -f RickAndMortyScripts.csv</span></pre><p id="2168" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">如你所见，我们有几列:<em class="md">索引，第几季，第几集，第几集名字，角色名字，和第15行。我们将关注名称和行列。</em></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es me"><img src="../Images/1fd337454ee6053fa5585cd4226cc412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uoEVrC8hWPsZh4Fy5U_W5A.png"/></div></div></figure><p id="b6a3" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">我们将转换这个数据集，每个响应行将包含<strong class="ki hj"> n </strong>个以前的响应作为上下文。</p><pre class="iy iz ja jb fd lo lp lq lr aw ls bi"><span id="e754" class="lt jp hi lp b fi lu lv l lw lx">CHARACTER_NAME = 'Rick'</span><span id="ab59" class="lt jp hi lp b fi mf lv l lw lx">contexted = []<br/><br/><em class="md"># context window of size 7</em><br/>n = 7<br/><br/><strong class="lp hj">for</strong> i <strong class="lp hj">in</strong> data[data.name == CHARACTER_NAME].index:<br/>  <strong class="lp hj">if</strong> i &lt; n:<br/>    <strong class="lp hj">continue</strong><br/>  row = []<br/>  prev = i - 1 - n <em class="md"># we additionally substract 1, so row will contain current responce and 7 previous responces  </em><br/>  <strong class="lp hj">for</strong> j <strong class="lp hj">in</strong> range(i, prev, -1):<br/>    row.append(data.line[j])<br/>  contexted.append(row)<br/><br/>columns = ['response', 'context'] <br/>columns = columns + ['context/' + str(i) <strong class="lp hj">for</strong> i <strong class="lp hj">in</strong> range(n - 1)]<br/><br/>df = pd.DataFrame.from_records(contexted, columns=columns)</span></pre><p id="594d" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">正如您在下面看到的，我们有响应列和6个上下文列。这将帮助我们微调我们的生成模型。之后，我们将从拥抱脸下载模型，并开始训练我们的模型。你可以在这里查看完整代码<a class="ae jn" href="https://deepnote.com/viewer/github/kingabzpro/DailoGPT-RickBot/blob/main/Training%20Model.ipynb" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mg"><img src="../Images/341febc6d2f1a336ea910f17aa9a6054.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gtdQzFhtORNMobb1KMn5EA.png"/></div></div></figure><h1 id="92e8" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">展开至拥抱脸</h1><p id="a3ba" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在对你的模型进行微调后，你可以简单地将你的模型部署到拥抱脸云，但在此之前，你需要创建一个HF ( <a class="ae jn" href="https://huggingface.co/" rel="noopener ugc nofollow" target="_blank">拥抱脸</a>)账户，并创建如下所示的模型。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mh"><img src="../Images/1c5420d37ef76baf4a5ebac22c308ee5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GjZ8yHM-MhoC4GpqzEHTUw.png"/></div></div></figure><p id="2f3d" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">你将需要HF API来上传你的模式，你可以从设置中得到它。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/6692bbda4bd0fde9658b3b56c41c0167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DLW0B0qSEIED1fF3ucg0Yg.png"/></div></div></figure><ul class=""><li id="60bd" class="mj mk hi ki b kj ly km lz kp ml kt mm kx mn lb mo mp mq mr bi translated">安装git-lfs: git扩展来上传更大的文件</li><li id="8b20" class="mj mk hi ki b kj ms km mt kp mu kt mv kx mw lb mo mp mq mr bi translated">配置git电子邮件和用户邮件</li><li id="8c22" class="mj mk hi ki b kj ms km mt kp mu kt mv kx mw lb mo mp mq mr bi translated">使用名为的HF API密钥和模型来上传标记化器和模型。</li></ul><pre class="iy iz ja jb fd lo lp lq lr aw ls bi"><span id="da2d" class="lt jp hi lp b fi lu lv l lw lx">!sudo apt-get install git-lfs</span><span id="52f7" class="lt jp hi lp b fi mf lv l lw lx">Reading package lists... Done<br/>Building dependency tree       <br/>Reading state information... Done<br/>git-lfs is already the newest version (2.3.4-1).<br/>The following package was automatically installed and is no longer required:<br/>  libnvidia-common-460<br/>Use 'sudo apt autoremove' to remove it.<br/>0 upgraded, 0 newly installed, 0 to remove and 40 not upgraded.</span><span id="9186" class="lt jp hi lp b fi mf lv l lw lx">!git config --<strong class="lp hj">global</strong> user.email "abidaliawan@rocketmail.com"<br/><em class="md"># Tip: using the same email as your huggingface.co account will link your commits to your profile</em><br/>!git config --<strong class="lp hj">global</strong> user.name "kingabzpro"</span><span id="a004" class="lt jp hi lp b fi mf lv l lw lx">MY_MODEL_NAME = 'DialoGPT-small-Rick-Bot'<br/><strong class="lp hj">with</strong> open('/content/HuggingFace_API.txt', 'rt') <strong class="lp hj">as</strong> f:<br/>  HUGGINGFACE_API_KEY = f.read().strip()</span><span id="15d1" class="lt jp hi lp b fi mf lv l lw lx">model.push_to_hub(MY_MODEL_NAME, use_auth_token=HUGGINGFACE_API_KEY)<br/>tokenizer.push_to_hub(MY_MODEL_NAME, use_auth_token=HUGGINGFACE_API_KEY)</span></pre><p id="5780" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">您可以通过编辑您的型号卡来添加诸如conversational、gpt2等标签。你可以在这里查看我的型号<a class="ae jn" href="https://huggingface.co/kingabzpro/DialoGPT-small-Rick-Bot" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mx"><img src="../Images/bb10fdd95b115d7319f8802ed9efae21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y7i1wrQo-7WN6WucQxBCIw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Image by Author</figcaption></figure><h1 id="f576" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">测试您的模型</h1><p id="b13b" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">部署之后，让我们使用transformers在python脚本中测试它。</p><ul class=""><li id="ce9a" class="mj mk hi ki b kj ly km lz kp ml kt mm kx mn lb mo mp mq mr bi translated">使用transformer下载tokenizer和model。</li><li id="cdc2" class="mj mk hi ki b kj ms km mt kp mu kt mv kx mw lb mo mp mq mr bi translated">运行4个输入的循环</li><li id="79d4" class="mj mk hi ki b kj ms km mt kp mu kt mv kx mw lb mo mp mq mr bi translated">用户输入用于生成文本</li></ul><pre class="iy iz ja jb fd lo lp lq lr aw ls bi"><span id="7e18" class="lt jp hi lp b fi lu lv l lw lx">tokenizer = AutoTokenizer.from_pretrained('kingabzpro/DialoGPT-small-Rick-Bot')<br/>model = AutoModelWithLMHead.from_pretrained('kingabzpro/DialoGPT-small-Rick-Bot')<br/><em class="md"># Let's chat for 4 lines</em><br/><strong class="lp hj">for</strong> step <strong class="lp hj">in</strong> range(4):<br/>    <em class="md"># encode the new user input, add the eos_token and return a tensor in Pytorch</em><br/>    new_user_input_ids = tokenizer.encode(input("&gt;&gt; User:") + tokenizer.eos_token, return_tensors='pt')<br/>    <em class="md"># print(new_user_input_ids)</em><br/><br/>    <em class="md"># append the new user input tokens to the chat history</em><br/>    bot_input_ids = torch.cat([chat_history_ids, new_user_input_ids], dim=-1) <strong class="lp hj">if</strong> step &gt; 0 <strong class="lp hj">else</strong> new_user_input_ids<br/><br/>    <em class="md"># generated a response while limiting the total chat history to 1000 tokens, </em><br/>    chat_history_ids = model.generate(<br/>        bot_input_ids, max_length=200,<br/>        pad_token_id=tokenizer.eos_token_id,  <br/>        no_repeat_ngram_size=3,       <br/>        do_sample=True, <br/>        top_k=100, <br/>        top_p=0.7,<br/>        temperature=0.8<br/>    )<br/>    <br/>    <em class="md"># pretty print last ouput tokens from bot</em><br/>    print("RickBot: {}".format(tokenizer.decode(chat_history_ids[:, bot_input_ids.shape[-1]:][0], skip_special_tokens=True)))</span></pre><p id="e156" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">如你所见，我们的模型运行良好。对于每个用户输入，Rick都会有一个响应。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es my"><img src="../Images/dac29face8d21aba498caf6ccc91ad3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*j5hK5XyIPwwd1AT6uFa1ag.png"/></div></figure><h1 id="82a1" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">不和谐机器人</h1><p id="33a7" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">为了创建<a class="ae jn" href="https://discord.com/developers/applications" rel="noopener ugc nofollow" target="_blank">不和谐</a>机器人，首先，你需要进入门户<a class="ae jn" href="https://discord.com/developers/applications" rel="noopener ugc nofollow" target="_blank">不和谐开发者门户</a>。点击新的应用程序并开始。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/e1728ad37fb7876419d44c6b1a4a9f62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vKaW8Gqf0Xi6HKlpdzeueQ.png"/></div></div></figure><p id="aded" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">写下应用程序名称。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/ad19128d853ede5e8259f36a5a7d43c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fbqDVDUSChtcTidOc_QRHQ.png"/></div></div></figure><p id="758a" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">现在点击Bot选项卡，然后添加Bot。它会把你带到一个新窗口，要求你写下机器人的名字，并给机器人添加一个图像。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/4ff5f816ad6745f2aa3d2f6dbfa99661.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eoym_8CdsnAJeU0by9mhLQ.png"/></div></div></figure><p id="61fa" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">单击OAuth2选项卡并选中标记机器人和机器人权限:发送消息。稍后复制链接并粘贴到一个新的标签。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/83608ccfc7b45746d8d9f87aadc556e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pjyVytXvn2hQeSwkigW3uA.png"/></div></div></figure><p id="7911" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">在新标签页粘贴链接后，它会让你选择服务器，就这样。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/0863326fc9570a5321fdb986d5b42db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*suwu9EOr2l1u4yf-ULc3Eg.png"/></div></div></figure><h1 id="324b" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">雷普利特</h1><p id="f092" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">您可以在<a class="ae jn" href="https://replit.com/" rel="noopener ugc nofollow" target="_blank">https://replit.com/</a>上创建您的账户。我们将使用这个平台作为我们的不和谐机器人的服务器。创建帐户后，只需创建一个新的python repl或导入我的GitHub <a class="ae jn" href="https://github.com/kingabzpro/DailoGPT-RickBot" rel="noopener ugc nofollow" target="_blank"> repo </a>。这个平台是初学者友好的，它不会花超过5分钟来理解如何使用编辑器。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/20aa4011d050f0511d672025cc494165.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AyGEvHxqSe-r3Hu5W7_O5w.png"/></div></div></figure><h1 id="e8a6" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">测试API</h1><p id="b736" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在我们需要使用replit secret特性来添加我们的HF API和Discord API之前，如下所示。您的Discord API密钥在开发人员门户:Bot选项卡中。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es na"><img src="../Images/4ad15fdd98564164a9de995e3f7f393a.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*JRpaG6EXf52ICcCGMNIVmw.png"/></div></figure><ul class=""><li id="c63f" class="mj mk hi ki b kj ly km lz kp ml kt mm kx mn lb mo mp mq mr bi translated">创建测试python文件来测试HF API</li><li id="e7cf" class="mj mk hi ki b kj ms km mt kp mu kt mv kx mw lb mo mp mq mr bi translated">创建使用模型id和HF API令牌使用<code class="du nb nc nd lp b">requests</code>发送和接收信息的函数。</li><li id="a382" class="mj mk hi ki b kj ms km mt kp mu kt mv kx mw lb mo mp mq mr bi translated">打印生成的响应。</li></ul><p id="8454" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">该功能现在运行良好，我们需要将该功能添加到bot.py中。</p><pre class="iy iz ja jb fd lo lp lq lr aw ls bi"><span id="a28a" class="lt jp hi lp b fi lu lv l lw lx">import requests</span><span id="1386" class="lt jp hi lp b fi mf lv l lw lx">def query(payload, model_id, api_token):</span><span id="e396" class="lt jp hi lp b fi mf lv l lw lx"> headers = {"Authorization": f"Bearer {api_token}"}</span><span id="1974" class="lt jp hi lp b fi mf lv l lw lx"> API_URL = f"https://api-inference.huggingface.co/models/{model_id}"</span><span id="8681" class="lt jp hi lp b fi mf lv l lw lx"> response = requests.post(API_URL, headers=headers, json=payload)</span><span id="49f1" class="lt jp hi lp b fi mf lv l lw lx"> return response.json()<br/></span><span id="0c6c" class="lt jp hi lp b fi mf lv l lw lx">model_id = "kingabzpro/DialoGPT-small-Rick-Bot"</span><span id="af08" class="lt jp hi lp b fi mf lv l lw lx">api_token = "api_XXXXXXXXXXXXXXXXXXXXXX" # get yours at hf.co/settings/token</span><span id="9531" class="lt jp hi lp b fi mf lv l lw lx">data = query('What you think about mom', model_id, api_token)</span><span id="9900" class="lt jp hi lp b fi mf lv l lw lx">print(data['generated_text'])</span></pre><h1 id="3d41" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">Replit的正常运行时间</h1><p id="5ea1" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">我们将使用<a class="ae jn" href="https://uptimerobot.com/" rel="noopener ugc nofollow" target="_blank">https://uptimerobot.com</a>来保持我们的机器人永远运行。正如您在下面看到的，我们可以添加Monitor并添加我们将使用flask创建的URL。它将在5分钟后ping我们的bot应用程序，这将欺骗Replit服务器永远运行。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ne"><img src="../Images/dea4c64f6f2387545184381829d637fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YEhV3ROlqVmEJV9XoLYZ5g.png"/></div></div></figure><h2 id="bddf" class="lt jp hi bd jq nf ng nh ju ni nj nk jy kp nl nm ka kt nn no kc kx np nq ke nr bi translated">Flask WebApp</h2><p id="2aae" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">下面的代码是一个简单的Flash web应用程序，它将在运行时显示“我还活着”。web应用程序将在Replit中生成链接，就像这样:<a class="ae jn" href="https://DailoGPT-RickBot.kingabzpro.repl.co" rel="noopener ugc nofollow" target="_blank">https://DailoGPT-RickBot.kingabzpro.repl.co</a>。你要将此链接粘贴到uptimerobot中，这将在5分钟后触发此应用程序。</p><pre class="iy iz ja jb fd lo lp lq lr aw ls bi"><span id="1713" class="lt jp hi lp b fi lu lv l lw lx">from flask import Flask</span><span id="b492" class="lt jp hi lp b fi mf lv l lw lx">from threading import Thread</span><span id="214a" class="lt jp hi lp b fi mf lv l lw lx">app = Flask('')<br/></span><span id="e3d8" class="lt jp hi lp b fi mf lv l lw lx">@app.route('/')</span><span id="c212" class="lt jp hi lp b fi mf lv l lw lx">def home():</span><span id="a3f3" class="lt jp hi lp b fi mf lv l lw lx"> return "I am Alive"</span><span id="d9d1" class="lt jp hi lp b fi mf lv l lw lx"><br/>def run():</span><span id="14ce" class="lt jp hi lp b fi mf lv l lw lx"> app.run(host='0.0.0.0',port=8080)</span><span id="dc03" class="lt jp hi lp b fi mf lv l lw lx">def keep_alive():</span><span id="fe6e" class="lt jp hi lp b fi mf lv l lw lx"> t=Thread(target=run)</span><span id="040f" class="lt jp hi lp b fi mf lv l lw lx"> t.start()</span></pre><h1 id="1c8c" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">Bot代码</h1><p id="96e4" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">这段代码包含了我们的Discord bot的主干，以及HF API和Flask web app的集成。</p><ul class=""><li id="362b" class="mj mk hi ki b kj ly km lz kp ml kt mm kx mn lb mo mp mq mr bi translated">我们正在使用刚刚创建的<code class="du nb nc nd lp b">web_app</code>文件中的<code class="du nb nc nd lp b">keep_alive</code>函数。</li><li id="8b48" class="mj mk hi ki b kj ms km mt kp mu kt mv kx mw lb mo mp mq mr bi translated">使用discord python客户端。</li><li id="4256" class="mj mk hi ki b kj ms km mt kp mu kt mv kx mw lb mo mp mq mr bi translated">函数发送和接收来自HF API的响应，该响应由API密钥保护。</li><li id="c533" class="mj mk hi ki b kj ms km mt kp mu kt mv kx mw lb mo mp mq mr bi translated"><code class="du nb nc nd lp b">on_ready</code>通过发送“Hello”消息来预热HF API。预热服务器大约需要20秒钟。</li><li id="da84" class="mj mk hi ki b kj ms km mt kp mu kt mv kx mw lb mo mp mq mr bi translated"><code class="du nb nc nd lp b">on_message</code>检查消息是来自机器人还是用户，然后获取用户消息并发送给HF API，然后在discord聊天机器人上显示响应。额外的错误检查或不响应服务被添加，以确保我们可以轻松地调试。</li></ul><p id="d7cb" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">要了解更多信息，您可以查看下面的代码并阅读注释。</p><pre class="iy iz ja jb fd lo lp lq lr aw ls bi"><span id="a908" class="lt jp hi lp b fi lu lv l lw lx">import os</span><span id="311c" class="lt jp hi lp b fi mf lv l lw lx"># these modules are for querying the Hugging Face model<br/>import json<br/>import requests<br/>from web_app import keep_alive</span><span id="0770" class="lt jp hi lp b fi mf lv l lw lx"># the Discord Python API<br/>import discord</span><span id="a398" class="lt jp hi lp b fi mf lv l lw lx"># this is my Hugging Face profile link<br/>API_URL = ‘<a class="ae jn" href="https://api-inference.huggingface.co/models/'" rel="noopener ugc nofollow" target="_blank">https://api-inference.huggingface.co/models/'</a></span><span id="598a" class="lt jp hi lp b fi mf lv l lw lx">class MyClient(discord.Client):<br/> def __init__(self, model_name):<br/> super().__init__()<br/> self.api_endpoint = API_URL + model_name<br/> # retrieve the secret API token from the system environment<br/> huggingface_token = os.environ[‘HUGGINGFACE_TOKEN’]<br/> # format the header in our request to Hugging Face<br/> self.request_headers = {<br/> ‘Authorization’: ‘Bearer {}’.format(huggingface_token)<br/> }</span><span id="ae66" class="lt jp hi lp b fi mf lv l lw lx">def query(self, payload):<br/> “””<br/> make request to the Hugging Face model API<br/> “””<br/> data = json.dumps(payload)<br/> response = requests.post(<br/> self.api_endpoint,<br/> headers=self.request_headers,<br/> data=data)<br/> ret = json.loads(response.content.decode(‘utf-8’))<br/> return ret</span><span id="79b7" class="lt jp hi lp b fi mf lv l lw lx">async def on_ready(self):<br/> # print out information when the bot wakes up<br/> print(‘Logged in as’)<br/> print(self.user.name)<br/> print(self.user.id)<br/> print(‘ — — — ‘)<br/> # send a request to the model without caring about the response<br/> # just so that the model wakes up and starts loading<br/> self.query({‘inputs’: {‘text’: ‘Hello!’}})</span><span id="4794" class="lt jp hi lp b fi mf lv l lw lx">async def on_message(self, message):<br/> “””<br/> this function is called whenever the bot sees a message in a channel<br/> “””<br/> # ignore the message if it comes from the bot itself<br/> if message.author.id == self.user.id:<br/>  return</span><span id="f537" class="lt jp hi lp b fi mf lv l lw lx"> # form query payload with the content of the message<br/> payload = message.content</span><span id="38c6" class="lt jp hi lp b fi mf lv l lw lx"> # while the bot is waiting on a response from the model<br/> # set the its status as typing for user-friendliness<br/> async with message.channel.typing():<br/> response = self.query(payload)<br/> bot_response = response[‘generated_text’]<br/> <br/> # we may get ill-formed response if the model hasn’t fully loaded<br/> # or has timed out<br/> if not bot_response:<br/>  if ‘error’ in response:<br/>   bot_response = ‘`Error: {}`’.format(response[‘error’])<br/>  else:<br/>   bot_response = ‘Hmm… something is not right.’</span><span id="b7b7" class="lt jp hi lp b fi mf lv l lw lx"> # send the model’s response to the Discord channel<br/>  await message.channel.send(bot_response)</span><span id="f9bd" class="lt jp hi lp b fi mf lv l lw lx">def main():<br/> # DialoGPT<br/> client = MyClient(‘kingabzpro/DialoGPT-small-Rick-Bot’)<br/> keep_alive()<br/> client.run(os.environ[‘DISCORD_TOKEN’])</span><span id="7de8" class="lt jp hi lp b fi mf lv l lw lx">if __name__ == ‘__main__’:<br/> main()</span></pre><p id="e2a9" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">如你所见，我们的机器人发球运行良好。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/638567b83bfe269d06f2becd2e8efad5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UhojmlesEWrxKV8KprPUtw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Image by Author</figcaption></figure><p id="18d1" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">现在让我们检查我们的不和谐服务器。如你所见，RickBot在线。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es na"><img src="../Images/781f50f0f99f00542b94301eeff6746c.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*aN2zL6AdgUWESBJ2P3vpgg.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Image by Author</figcaption></figure><p id="33d3" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">玩你训练和部署的机器人玩得开心。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ns"><img src="../Images/a2ea80ed6f61db065f07e1898120ab4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/0*OUll_sFXnClN6sps.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Image by Author</figcaption></figure><p id="7530" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated">您也可以在Replit上导入我的存储库，然后添加您的HF API和Discord API密钥，几分钟后就可以开始使用了。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nt"><img src="../Images/c8d5ebabd1f6d3e47ce1c2149e11f968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*OXkWc3Aj0b7-o6c1v7UlMA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Image by Author</figcaption></figure><h1 id="f4bd" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">密码</h1><p id="a295" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">你可以在<a class="ae jn" href="https://github.com/kingabzpro/DailoGPT-RickBot" rel="noopener ugc nofollow" target="_blank"> GitHub </a>和<a class="ae jn" href="https://dagshub.com/kingabzpro/DailoGPT-RickBot" rel="noopener ugc nofollow" target="_blank"> DAGsHub </a>上找到代码。你也可以查看我的拥抱脸模型<a class="ae jn" href="https://huggingface.co/kingabzpro/DialoGPT-small-Rick-Bot" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nu"><img src="../Images/43348d33c12b2d4365d6378814cbaafe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P6YJtRhkWjuNqQ4CIt0_lw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Image by Author</figcaption></figure></div><div class="ab cl lc ld gp le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hb hc hd he hf"><h1 id="f89d" class="jo jp hi bd jq jr lj jt ju jv lk jx jy io ll ip ka ir lm is kc iu ln iv ke kf bi translated">结论</h1><p id="92ad" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">我从视频教程中学习和训练自己的机器人的经历非常棒。当我开始摆弄discord库和服务器时，情况变得更好了。在本指南中，我们学习了拥抱脸API、变形金刚、不和谐服务器、正常运行时间机器人、Kaggle API和Replit平台。我迫不及待地想看你接下来选择了什么角色，和我分享你的经历。</p><blockquote class="nv nw nx"><p id="9fef" class="kg kh md ki b kj ly ij kl km lz im ko ny ma kr ks nz mb kv kw oa mc kz la lb hb bi translated">机器学习很简单，做起来很难，要一直寻找技巧和窍门来改善你的工作空间。</p></blockquote><h1 id="4cdf" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">参考</h1><ul class=""><li id="5956" class="mj mk hi ki b kj kk km kn kp ob kt oc kx od lb mo mp mq mr bi translated">代码受freeCodeCamp教程影响很大:<a class="ae jn" href="https://www.youtube.com/watch?v=UjDpW_SOrlw" rel="noopener ugc nofollow" target="_blank">编写一个不和谐的聊天机器人，说话像你最喜欢的角色</a></li><li id="470d" class="mj mk hi ki b kj ms km mt kp mu kt mv kx mw lb mo mp mq mr bi translated">微调模型来自<a class="ae jn" href="https://towardsdatascience.com/make-your-own-rick-sanchez-bot-with-transformers-and-dialogpt-fine-tuning-f85e6d1f4e30" rel="noopener" target="_blank">媒体博客</a>。</li><li id="378e" class="mj mk hi ki b kj ms km mt kp mu kt mv kx mw lb mo mp mq mr bi translated">Kaggle数据集来自<a class="ae jn" href="https://www.kaggle.com/andradaolteanu/rickmorty-scripts" rel="noopener ugc nofollow" target="_blank"> Rick &amp; Morty脚本</a>。</li></ul><h1 id="8299" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">关于作者</h1><p id="d4c0" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated"><a class="ae jn" href="https://www.polywork.com/kingabzpro" rel="noopener ugc nofollow" target="_blank">阿比德·阿里·阿万</a> ( <a class="ae jn" href="https://twitter.com/1abidaliawan" rel="noopener ugc nofollow" target="_blank"> @1abidaliawan </a>)是一名认证数据科学家专业人士，热爱构建机器学习模型。目前，他专注于内容创作，并撰写关于机器学习和数据科学技术的技术博客。Abid拥有技术管理硕士学位和电信工程学士学位。他的愿景是为患有精神疾病的学生建立一个使用图形神经网络的人工智能产品。</p></div><div class="ab cl lc ld gp le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hb hc hd he hf"><p id="e17c" class="pw-post-body-paragraph kg kh hi ki b kj ly ij kl km lz im ko kp ma kr ks kt mb kv kw kx mc kz la lb hb bi translated"><em class="md">原载于2021年11月1日</em><a class="ae jn" href="https://www.analyticsvidhya.com/blog/2021/11/learn-how-to-build-your-discord-bot/" rel="noopener ugc nofollow" target="_blank"><em class="md">https://www.analyticsvidhya.com</em></a><em class="md">。</em></p></div></div>    
</body>
</html>