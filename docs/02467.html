<html>
<head>
<title>Transform Notion into RSS reader with AWS Lambda and AWS CDK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Lambda和AWS CDK将概念转化为RSS阅读器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/transform-notion-into-rss-reader-with-aws-lambda-and-aws-cdk-bc91c5fdc8d3?source=collection_archive---------10-----------------------#2021-05-16">https://medium.com/geekculture/transform-notion-into-rss-reader-with-aws-lambda-and-aws-cdk-bc91c5fdc8d3?source=collection_archive---------10-----------------------#2021-05-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="a472" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">探索新发布的概念应用编程接口测试版及其功能</h2></div><p id="2f3f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">TL；DR: </strong>我们将使用概念图API beta和AWS Lambda，在概念图的基础上构建一个定制的RSS阅读器。参见这里的<a class="ae jt" href="https://github.com/dzmitry-kankalovich/notion-rss-feed/tree/v1" rel="noopener ugc nofollow" target="_blank">源代码</a>。</p><blockquote class="ju jv jw"><p id="2ac3" class="ix iy jx iz b ja jb ij jc jd je im jf jy jh ji jj jz jl jm jn ka jp jq jr js hb bi translated"><strong class="iz hj">更新</strong>:请看本系列第二部分:<a class="ae jt" href="https://blog.dmitrykankalovich.com/transform-notion-into-rss-reader-part-2-multiple-rss-endpoints-de3406786845" rel="noopener ugc nofollow" target="_blank">第二部分</a></p></blockquote><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kb"><img src="../Images/4f54bee784fc4e7b6cebb7a0fc34b9f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bKFHEIOcxA-6icXI1pr8uw.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">High-level architecture of what we are about to do</figcaption></figure><p id="dfc7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">截至5月13日，<a class="kr ks ge" href="https://medium.com/u/efd97a1c507b?source=post_page-----bc91c5fdc8d3--------------------------------" rel="noopener" target="_blank">概念车</a>已经发布了他们API的公开测试预览。这是一个期待已久的功能，它使您能够在一个工具中进一步整合您的活动。我一直希望概念提供的一个特别的东西是我每天的RSS提要的集成。</p><p id="bb2c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">虽然概念本身没有现成的东西来吸引你的RSS订阅源，但概念应用编程接口的发布为我们提供了一个机会，可以利用各种自动化平台以及云提供商的无服务器解决方案来实现我们想要的任何集成。</p><h1 id="c7b2" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">开始之前</h1><p id="93ff" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">你应该知道有几个不错的RSS阅读器，比如<a class="ae jt" href="https://feedly.com/" rel="noopener ugc nofollow" target="_blank"> Feedly </a>在聚合你的RSS源方面做得很好，所以在开始之前，我建议你去看看它们。</p><h1 id="7143" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">选择自动化平台</h1><p id="3ce1" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">您可能想了解的另一件事是<a class="ae jt" href="https://automate.io" rel="noopener ugc nofollow" target="_blank">automation . io</a>。这是众多自动化平台之一，承诺您只需点击几下鼠标就能完成所需任务。</p><p id="93b4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">的确有一个关于RSS与idea集成的广告，我去测试了一下——结果发现它对我来说还不够好。似乎缺乏可配置性，比如设置多个RSS源的能力，以及调整触发逻辑的能力。</p><p id="9c80" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，我们仍然可以使用一个更低层次的抽象来构建我们需要的东西——像AWS Lambda或Azure Functions这样的无服务器功能平台。</p><p id="b26f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我个人与AWS合作多年，经常将它用作我个人项目的平台，所以我选择了这个选项。然而，在我们即将解决的问题中，没有AWS独有的细节，所以任何无服务器的功能平台对您来说都很适用。</p><h1 id="c6f8" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">先决条件</h1><p id="ef70" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">以下是前进之前需要完成的工作:</p><ul class=""><li id="0827" class="lq lr hi iz b ja jb jd je jg ls jk lt jo lu js lv lw lx ly bi translated"><strong class="iz hj">14+版的NodeJS </strong>(附带我们稍后会用到的包管理器<strong class="iz hj"> NPM </strong></li><li id="1f10" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">活跃的AWS账户。</li><li id="372d" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">拥有足够权限通过CDK进行部署并使用AWS Lambda—<strong class="iz hj">administrator access</strong>策略的AWS IAM用户就足够了。查看本指南了解更多详情。</li><li id="a545" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">AWS CLI配置了该用户凭证— <strong class="iz hj">访问密钥ID </strong>和<strong class="iz hj">访问密钥机密。</strong>参见<a class="ae jt" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html" rel="noopener ugc nofollow" target="_blank">本指南</a>中如何操作的示例。</li></ul><p id="6858" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">确保您已经使用这些凭证显式导出了AWS概要文件:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="c03f" class="mj ku hi mf b fi mk ml l mm mn">% export AWS_PROFILE=your-profile</span></pre><p id="0703" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">默认情况下，AWS CDK将检查这个变量，以确定它使用哪个帐户以及应该利用什么IAM用户权限。</p><h1 id="8779" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">AWS部分</h1><p id="1788" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">虽然您可以通过手动点击AWS控制台来完成所有需要的AWS更改和配置，但我通常会使用infra-as-a-code (IaaC)方法，所以在这里我将坚持使用这种方法。</p><p id="1279" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">AWS CDK是一种相对较新的方式，它遵循IaaC，甚至比Cloudformation / Terraform以前更直接地供应您的基础设施——使用类似Typescript的编程语言来创建AWS资源。</p><p id="256e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将在这里使用AWS CDK，但你也可以使用其他IaaC选项，如Cloudformation、Terraform等，获得相同的结果。</p><blockquote class="ju jv jw"><p id="5163" class="ix iy jx iz b ja jb ij jc jd je im jf jy jh ji jj jz jl jm jn ka jp jq jr js hb bi translated"><em class="hi">你可以在这里</em> 找到最终的源代码 <a class="ae jt" href="https://github.com/dzmitry-kankalovich/notion-rss-feed/tree/v1" rel="noopener ugc nofollow" target="_blank"> <em class="hi"/></a></p></blockquote><h2 id="63ee" class="mj ku hi bd kv mo mp mq kz mr ms mt ld jg mu mv lf jk mw mx lh jo my mz lj na bi translated">部署您的AWS CDK应用程序</h2><p id="fc66" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">如果你以前从未与AWS CDK合作过——没关系，这一切都相当简单。我建议查看<a class="ae jt" href="https://github.com/aws/aws-cdk#getting-started" rel="noopener ugc nofollow" target="_blank">这份文件</a>。假设您已经安装了至少版本为<strong class="iz hj"> 14+ </strong>的<code class="du nb nc nd mf b">node</code>,运行以下代码片段:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="d26e" class="mj ku hi mf b fi mk ml l mm mn">% npm i -g aws-cdk</span></pre><p id="7129" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，创建您的项目目录并初始化CDK项目:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="c21f" class="mj ku hi mf b fi mk ml l mm mn">% mkdir notion-rss-feed &amp;&amp; cd $_<br/>% cdk init sample-app --language=typescript</span></pre><p id="ec09" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如您所见——我们明确地将语言指定为<code class="du nb nc nd mf b">typescript</code>。CDK支持许多其他语言，但是，使用Typescript，您可以找到大多数的示例，并且它是CDK的一级公民语言，因为所有其他语言都只是包装器。</p><p id="1c52" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设<code class="du nb nc nd mf b">cdk init</code>运行没有问题，你应该得到下面的结构:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="9825" class="mj ku hi mf b fi mk ml l mm mn">notion-rss-feed % tree -L 1<br/>.<br/>├── README.md<br/>├── bin<br/>├── cdk.json<br/>├── jest.config.js<br/>├── lib<br/>├── node_modules<br/>├── package-lock.json<br/>├── package.json<br/>├── test<br/>└── tsconfig.json</span></pre><p id="1d56" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如您所看到的，有相当多的文件，但是不要担心——您不需要处理其中的大部分。您要查看的部分在<code class="du nb nc nd mf b">lib</code>文件夹中——所有的资源栈定义都在那里。按照惯例，CDK将在那里创建一个名为<code class="du nb nc nd mf b">notion-rss-feed-stack.ts</code>的文件。</p><p id="091b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，让我们继续修改我们在<code class="du nb nc nd mf b">notion-rss-feed/lib/notion-rss-feed-stack.ts</code>的堆栈:</p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="ne nf l"/></div></figure><p id="d63a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如您所见，目前还没有定义任何资源。没关系，我们稍后会添加它们，现在，让我们部署这个堆栈来验证我们可以为您的AWS帐户执行这样的操作。</p><p id="9cfc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，引导环境(每个AWS帐户只需要做一次，如果您以前使用过CDK，可能不需要这样做):</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="183c" class="mj ku hi mf b fi mk ml l mm mn">notion-rss-feed % <!-- -->cdk bootstrap --profile your-aws-profile</span></pre><p id="7de1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后—部署我们的资源堆栈:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="8be0" class="mj ku hi mf b fi mk ml l mm mn">notion-rss-feed % cdk deploy</span></pre><p id="f3e3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输出应该如下所示:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="61f2" class="mj ku hi mf b fi mk ml l mm mn">NotionRssFeedStack: deploying...<br/>NotionRssFeedStack: creating CloudFormation changeset...<br/>[██████████████████████████████████████████████████████████] (2/2)</span><span id="b3fc" class="mj ku hi mf b fi ng ml l mm mn"> ✅  NotionRssFeedStack</span><span id="fb6b" class="mj ku hi mf b fi ng ml l mm mn">Stack ARN:<br/>arn:aws:cloudformation:us-east-1:69924*******:stack/NotionRssFeedStack/f6b61890-b4a3-11eb-a371-1266a0dd9289</span></pre><p id="3df4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您现在已经为实际开发做好了准备！</p><blockquote class="ju jv jw"><p id="8b92" class="ix iy jx iz b ja jb ij jc jd je im jf jy jh ji jj jz jl jm jn ka jp jq jr js hb bi translated"><em class="hi">如果您看到</em> <code class="du nb nc nd mf b"><em class="hi">Unable to resolve AWS account to use.</em></code> <em class="hi">，请查看</em> <a class="ae jt" href="https://docs.aws.amazon.com/cdk/latest/guide/getting_started.html#getting_started_prerequisites" rel="noopener ugc nofollow" target="_blank"> <em class="hi">本文档</em> </a> <em class="hi">，了解如何配置部署目标帐户以及相关的</em> <code class="du nb nc nd mf b"><em class="hi">Access Key ID</em></code> <em class="hi"> / </em> <code class="du nb nc nd mf b"><em class="hi">Access Key Secret</em></code></p></blockquote><h2 id="b151" class="mj ku hi bd kv mo mp mq kz mr ms mt ld jg mu mv lf jk mw mx lh jo my mz lj na bi translated">创建Lambda函数</h2><p id="7e7f" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">让我们创建一个Lambda函数，它将提取指定的RSS提要并将其推送到概念。我们将把lambda代码放在一个单独的文件夹中:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="9063" class="mj ku hi mf b fi mk ml l mm mn">notion-rss-feed % mkdir -p resources/lambda<br/>notion-rss-feed % cd resources/lambda</span></pre><p id="d1f8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">初始化<strong class="iz hj"> NPM </strong>项目:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="e44e" class="mj ku hi mf b fi mk ml l mm mn">lambda % npm init -y</span></pre><p id="4286" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后添加所有需要的依赖项:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="b008" class="mj ku hi mf b fi mk ml l mm mn">lambda % npm install --save rss-parser @notionhq/client dotenv</span></pre><p id="b817" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，添加一个Lambda处理程序代码。用以下内容创建<code class="du nb nc nd mf b">index.js</code>:</p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="ne nf l"/></div></figure><p id="0833" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">显然，这不是Lambda函数的最终版本，但我们现在可以用它来实现一个概念验证解决方案，然后逐步改进。</p><p id="ed72" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们回到资源栈，在AWS中创建一个实际的Lambda函数资源。</p><p id="655d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">编辑<code class="du nb nc nd mf b">lib/notion-rss-feed-stack.ts</code>并添加Lambda供应代码:</p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="ne nf l"/></div></figure><p id="253c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果<code class="du nb nc nd mf b">@aws-cdk/aws-lambda</code>无法解决——明确添加各自的NPM包:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="3fb7" class="mj ku hi mf b fi mk ml l mm mn">notion-rss-feed % npm install --save @aws-cdk/aws-lambda</span></pre><p id="d49f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们应该可以部署我们的Lambda:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="7377" class="mj ku hi mf b fi mk ml l mm mn">notion-rss-feed % cdk deploy</span></pre><p id="bb5c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">CDK会要求您确认Lambda执行所需的IAM角色的创建。继续使用<strong class="iz hj"> y </strong>作为您的答案，并查看堆栈更新进度。最后，一旦部署完成，您应该能够看到我们的Lambda函数的ARN:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="416e" class="mj ku hi mf b fi mk ml l mm mn">Outputs:<br/>NotionRssFeedStack.NotionRssFeedHandlerName = NotionRssFeedStack-NotionRssFeedHandler4C3C1ED2-WD0IieIRVroG</span></pre><p id="c2de" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您确切的Lambda名称总是特定于帐户的，并且会与我的名称略有不同，所以请确保复制您在CDK部署输出中实际看到的名称。</p><p id="8d85" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们使用提供函数名来测试Lambda函数:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="f61a" class="mj ku hi mf b fi mk ml l mm mn">notion-rss-feed % aws lambda invoke \<br/>--function-name NotionRssFeedStack-NotionRssFeedHandler4C3C1ED2-WD0IieIRVroG \<br/>--payload '{}' lambda_output.json &amp;&amp; cat lambda_output.json</span></pre><p id="3d3e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输出应该如下所示:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="6322" class="mj ku hi mf b fi mk ml l mm mn">{<br/>    "StatusCode": 200,<br/>    "ExecutedVersion": "$LATEST"<br/>}<br/>"The AWS Cloud platform expands daily. Learn about announcements, launches, news, innovation and more from Amazon Web Services."</span></pre><p id="271e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这最后一行表示我们的Lambda已经成功执行，并获取了AWS最新新闻的RSS提要。随着这个输出的验证，我们现在正式通过了一半。</p><h1 id="699a" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">概念部分</h1><p id="dbe1" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">在开始发送RSS内容之前，我们需要准备一些概念。本质上，我们需要做到以下几点:</p><ol class=""><li id="74c6" class="lq lr hi iz b ja jb jd je jg ls jk lt jo lu js nh lw lx ly bi translated">创建所谓的<strong class="iz hj">私人整合</strong></li><li id="d471" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js nh lw lx ly bi translated">创建一个父页面或数据库来保存我们所有的日常RSS条目</li><li id="fe05" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js nh lw lx ly bi translated">与我们的集成共享页面或数据库</li></ol><blockquote class="ju jv jw"><p id="ccc6" class="ix iy jx iz b ja jb ij jc jd je im jf jy jh ji jj jz jl jm jn ka jp jq jr js hb bi translated"><em class="hi">上面的步骤在</em> <a class="ae jt" href="https://developers.notion.com/docs/getting-started" rel="noopener ugc nofollow" target="_blank"> <em class="hi">这里</em> </a> <em class="hi">也有更详细的描述，所以如果你理解上下文有困难的话——去看看吧。</em></p></blockquote><p id="e608" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是在此之前——让我们弄清楚我们到底要做些什么来显示idea中的RSS内容。我知道有三种方法可以实现我们的需求，我将一一介绍。</p><p id="1898" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">选项1。数据库</strong></p><p id="a965" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以创建一个概念数据库，为属性定义一些模式，并添加项目作为子页面——每个RSS项目一个页面。这种方法将允许我们为每个页面提供丰富的内容(即RSS条目)，就像提要条目的文本预览一样。</p><p id="8947" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，目前一些相当大的缺点源于概念API的限制。这些问题是无法清理数据库或删除特定页面。由于无法在每次集成运行之前进行清理，这意味着数据库可能会堆积重复的页面。</p><p id="3a71" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">选项2。带有嵌套表格的页面</strong></p><p id="8c01" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里的想法是建立一个带有嵌套表的常规概念页面，我们可以在每次集成开始时简单地删除它，然后用RSS条目重新创建。然而，目前的观念API测试版不允许你使用表格。</p><p id="995f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">选项3。带有RSS项目链接的列表</strong></p><p id="fa40" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，我们可以建立一个根页面作为目录，并为每次集成运行创建一个子页面(带有当前日期的页面标题)，并为给定的子页面创建一个带项目符号的链接列表。除了链接名——RSS条目标题，我们没有任何预览，但是在很多情况下这就足够了。<strong class="iz hj">这是我们在这里使用的变体</strong>。</p><h2 id="8345" class="mj ku hi bd kv mo mp mq kz mr ms mt ld jg mu mv lf jk mw mx lh jo my mz lj na bi translated">创建集成</h2><p id="f020" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">假设您是工作区的所有者或管理员，只需点击<strong class="iz hj">设置&amp;成员</strong> <strong class="iz hj"> →集成→开发您自己的集成→新集成</strong>。</p><p id="21cd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">给它取一个有意义的名字，上传一个RSS图标，最后点击<strong class="iz hj">提交。</strong></p><p id="4653" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在打开我们刚刚创建的集成，并获取<strong class="iz hj">内部集成令牌</strong>——我们稍后会用到它。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ni"><img src="../Images/13eac7d56587632cbf7c75d97eb672d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FiHNmDtjDOFjD0HeJRcnGg.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Integration page</figcaption></figure><h2 id="11f3" class="mj ku hi bd kv mo mp mq kz mr ms mt ld jg mu mv lf jk mw mx lh jo my mz lj na bi translated">创建RSS页面</h2><p id="e16c" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">下一步—在idea中创建一个存储RSS项目的地方。对于创建一个新页面，设置标题<strong class="iz hj"> RSS </strong>，这就是页面布局。稍后，我们的集成将在这里创建包含RSS内容的子页面，并且RSS页面——只要它是空的——将以一种目录的形式显示所有子页面。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ni"><img src="../Images/ca82883c385e16f5d552ee1b1ab6f51d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TBixmpRN_zBwK-7Gq09BfA.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Simple page to ingest RSS feed</figcaption></figure><h2 id="8c70" class="mj ku hi bd kv mo mp mq kz mr ms mt ld jg mu mv lf jk mw mx lh jo my mz lj na bi translated">集成共享RSS页面</h2><p id="ffb8" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">概念部分的最后一件事——允许我们的集成实际访问我们刚刚创建的页面。所以继续选择我们的RSS页面，点击<strong class="iz hj">分享</strong> → <strong class="iz hj">邀请</strong> → <strong class="iz hj">选择你的整合</strong>。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ni"><img src="../Images/1512d55559d28b96f5f6ae2e90fae00b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vydP-D79TCm3x1LhlDRfyg.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Share screen</figcaption></figure><h1 id="e2c8" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">将RSS提要转发给概念API</h1><p id="9511" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">切换回代码回购。我们即将开始向概念API发送RSS条目。为此，我们需要将集成令牌传递给Lambda。我强烈建议不要硬编码它，而是建议把它放在<code class="du nb nc nd mf b">.env</code>文件中。只需在项目的根目录下创建<code class="du nb nc nd mf b">.env</code>文件，并用以下条目填充它:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="772b" class="mj ku hi mf b fi mk ml l mm mn">NOTION_INTEGRATION_TOKEN=&lt;your notion integration token value&gt;<br/>NOTION_PAGE_NAME=RSS<br/>RSS_FEED_URL=https://aws.amazon.com/about-aws/whats-new/recent/feed/</span></pre><p id="98dc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以用自己选择的值来替换页面名称和RSS提要URL，但是，请记住，<code class="du nb nc nd mf b">NOTION_PAGE_NAME</code>应该具有与您在上一步中创建的<em class="jx">完全相同的</em>页面名称。稍后，我们将使用概念API搜索端点来查找您的页面惟一ID。</p><p id="5034" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们用这些配置值更新<code class="du nb nc nd mf b">lib/notion-rss-feed-stack.ts</code>:</p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="ne nf l"/></div></figure><p id="402c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以看到，我们只是通过环境变量传递这些值。</p><p id="eb0f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，Lambda处理程序代码:</p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="ne nf l"/></div></figure><p id="acdc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是Lambda部分的大致内容。部署它:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="a46c" class="mj ku hi mf b fi mk ml l mm mn">notion-rss-feed % cdk deploy</span></pre><p id="7311" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">并检查它:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="96b3" class="mj ku hi mf b fi mk ml l mm mn">notion-rss-feed % aws lambda invoke \<br/>--function-name NotionRssFeedStack-NotionRssFeedHandler4C3C1ED2-WD0IieIRVroG \<br/>--payload '{}' lambda_output.json &amp;&amp; cat lambda_output.json</span></pre><blockquote class="ju jv jw"><p id="0025" class="ix iy jx iz b ja jb ij jc jd je im jf jy jh ji jj jz jl jm jn ka jp jq jr js hb bi translated">同样，不要忘记提供您自己在CDK部署输出中找到的特定<code class="du nb nc nd mf b">function-name</code>。</p></blockquote><p id="ba90" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果一切正常，您应该能够看到您的每日RSS源:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ni"><img src="../Images/3cfd15d1981609d81f26413c9ccd9fa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T1C4PAaBSGSBXXbNerYPQQ.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">RSS feed example</figcaption></figure><p id="9fe6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以每次调用Lambda时，都会创建一个带有当前日期的页面，并列出其中所有的RSS条目，链接到相应的页面。</p><h1 id="d9fa" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">安排RSS源</h1><p id="7aca" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">我们已经有了我们的RSS订阅源！然而，我们不想每天都手动使用AWS CLI，所以让我们继续安排我们的Lambda每天自动执行。</p><p id="d68b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为此，我们将使用AWS EventBridge，它提供了定义触发Lambda的CRON表达式的能力。</p><p id="b34b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，需要添加一些相关的依赖项。切换到项目根目录，运行以下命令:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="6a5e" class="mj ku hi mf b fi mk ml l mm mn">notion-rss-feed % npm install --save @aws-cdk/aws-events @aws-cdk/aws-events-targets</span></pre><p id="7aee" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下一步—创建一个事件规则，并让它按计划调用Lambda。编辑<code class="du nb nc nd mf b">lib/notion-rss-feed-stack.ts</code>如下:</p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="ne nf l"/></div></figure><p id="eb81" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意cron表达式——您应该将它设置为适合您的值。在我的例子中，我已经将它设置为在世界协调时每天早上5:30触发Lambda。你可以在这里阅读更多关于AWS cron表达式<a class="ae jt" href="https://docs.aws.amazon.com/lambda/latest/dg/services-cloudwatchevents-expressions.html" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><p id="1b31" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">部署我们的变更:</p><pre class="kc kd ke kf fd me mf mg mh aw mi bi"><span id="40c1" class="mj ku hi mf b fi mk ml l mm mn">notion-rss-feed % cdk deploy</span></pre><p id="8bf0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的示例实现到此结束。</p><blockquote class="ju jv jw"><p id="f6d0" class="ix iy jx iz b ja jb ij jc jd je im jf jy jh ji jj jz jl jm jn ka jp jq jr js hb bi translated"><em class="hi">正如我在开头所说的，你可以在这里找到最终版本的来源</em><a class="ae jt" href="https://github.com/dzmitry-kankalovich/notion-rss-feed/tree/v1" rel="noopener ugc nofollow" target="_blank"><em class="hi"/></a></p><p id="d9d4" class="ix iy jx iz b ja jb ij jc jd je im jf jy jh ji jj jz jl jm jn ka jp jq jr js hb bi translated"><em class="hi">也来看看这个系列的第二部:</em> <a class="ae jt" href="https://blog.dmitrykankalovich.com/transform-notion-into-rss-reader-part-2-multiple-rss-endpoints-de3406786845" rel="noopener ugc nofollow" target="_blank"> <em class="hi">第二部</em> </a></p></blockquote></div><div class="ab cl nj nk gp nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="hb hc hd he hf"><h1 id="b851" class="kt ku hi bd kv kw nq ky kz la nr lc ld io ns ip lf ir nt is lh iu nu iv lj lk bi translated">还剩下什么</h1><p id="6f13" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">为了简单起见，我没有在这里介绍许多需要改进的地方，但是欢迎您参与进来:</p><ul class=""><li id="74df" class="lq lr hi iz b ja jb jd je jg ls jk lt jo lu js lv lw lx ly bi translated">由于我们使用的只是一个测试版的概念API，随着时间的推移，预计会有更多的功能出现:删除、表格，甚至可能是HTML或Markdown支持。这将为构建更复杂的解决方案创造机会，理想情况下允许实际预览内容。</li><li id="bd29" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">该解决方案的安全性并不理想——集成令牌以纯文本形式存储在Lambda环境变量中。如果其他任何人使用此AWS帐户，您应该使用AWS Secrets Manager保护令牌。</li><li id="2b87" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">这里我们只使用了一个RSS端点。我们可以扩展解决方案来聚合几个端点。</li><li id="0886" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">AWS对于个人项目来说不是一个特别友好的地方，所以我通常会建立一些监控和警报，以确保部署中的一些错误(比如说cron表达式中的错误导致更频繁的Lambda调用)不会让我损失惨重。</li><li id="a726" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">将RSS配置提交给repo，尽管是作为配置文件的一部分，这很好，但不如能够用某种简单的UI动态配置它好。</li></ul><p id="896e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">目前——就是这样！</p><p id="c515" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望你喜欢这个指南，如果有足够的兴趣，我将做第二部分，我们将解决一些提到的问题。</p></div></div>    
</body>
</html>