<html>
<head>
<title>How to Deploy Chaincode (Smart Contract)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何部署链码(智能合约)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-deploy-chaincode-smart-contract-45c20650786a?source=collection_archive---------16-----------------------#2021-05-15">https://medium.com/geekculture/how-to-deploy-chaincode-smart-contract-45c20650786a?source=collection_archive---------16-----------------------#2021-05-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es im"><img src="../Images/e546adf22df1959216a5a7c3949a2e2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SKjdN-G2baPh-GEwSEkyXQ.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx">Hyperledger Fabric</figcaption></figure><h1 id="c644" class="jc jd hi bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">介绍</h1><p id="0f69" class="pw-post-body-paragraph ka kb hi kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hb bi translated">在本文中，我们将部署JAVA、GO、JAVASCRIPT的链代码来运行Hyperledger Fabric区块链网络，并将升级相同的链代码。也将讨论链码的生命周期。</p><blockquote class="ky kz la"><p id="784b" class="ka kb lb kc b kd lc kf kg kh ld kj kk le lf kn ko lg lh kr ks li lj kv kw kx hb bi translated">在这里，我从织物样本中提取了链码。</p></blockquote><h1 id="8318" class="jc jd hi bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">观众</h1><p id="d47d" class="pw-post-body-paragraph ka kb hi kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hb bi translated">Hyperledger结构开发人员、操作员和管理员。这是一篇实用的动手文章。在我之前的<a class="ae lk" href="https://cmjagtap.medium.com/hyperledger-fabric-blockchain-setup-from-scratch-21890e26aac7" rel="noopener">作品</a>中，我已经解释了如何从头开始建立一个光纤网络。</p><h1 id="4694" class="jc jd hi bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">网络安装程序</h1><ul class=""><li id="21c2" class="ll lm hi kc b kd ke kh ki kl ln kp lo kt lp kx lq lr ls lt bi translated">具有一个应用程序通道的Hyperledger Fabric v2.3设置。</li><li id="8307" class="ll lm hi kc b kd lu kh lv kl lw kp lx kt ly kx lq lr ls lt bi translated">JAVA链码部署。</li><li id="f4af" class="ll lm hi kc b kd lu kh lv kl lw kp lx kt ly kx lq lr ls lt bi translated">开始链码部署。</li><li id="5315" class="ll lm hi kc b kd lu kh lv kl lw kp lx kt ly kx lq lr ls lt bi translated">JAVASCRIPT链码部署</li></ul><h1 id="9046" class="jc jd hi bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">文件夹结构</h1><ul class=""><li id="d72a" class="ll lm hi kc b kd ke kh ki kl ln kp lo kt lp kx lq lr ls lt bi translated">让我们克隆包含源代码的repo。</li></ul><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="fcda" class="me jd hi ma b fi mf mg l mh mi"><strong class="ma hj">git clone </strong><a class="ae lk" href="https://github.com/cmjagtap/Hyperledger-Fabric" rel="noopener ugc nofollow" target="_blank"><strong class="ma hj">https://github.com/cmjagtap/Hyperledger-Fabric</strong></a></span></pre><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es mj"><img src="../Images/0e0df6f72ed333320d88182452eff6e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1AtgNtYEs6CCUjUjh5wGuA.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx">Folder Structure</figcaption></figure><p id="16fe" class="pw-post-body-paragraph ka kb hi kc b kd lc kf kg kh ld kj kk kl lf kn ko kp lh kr ks kt lj kv kw kx hb bi translated">文件夹结构</p><ul class=""><li id="056b" class="ll lm hi kc b kd lc kh ld kl mk kp ml kt mm kx lq lr ls lt bi translated"><strong class="kc hj"> chaincodes: </strong>包含用JAVA、GO、JavaScript编写的链码源代码。</li><li id="7a90" class="ll lm hi kc b kd lu kh lv kl lw kp lx kt ly kx lq lr ls lt bi translated"><strong class="kc hj"> deployChaincode: </strong>包含链码部署脚本。</li></ul><p id="a617" class="pw-post-body-paragraph ka kb hi kc b kd lc kf kg kh ld kj kk kl lf kn ko kp lh kr ks kt lj kv kw kx hb bi translated">在我之前的<a class="ae lk" href="https://cmjagtap.medium.com/hyperledger-fabric-blockchain-setup-from-scratch-21890e26aac7" rel="noopener">作品</a>中，我已经说明了其他文件夹的内容。</p><h1 id="0724" class="jc jd hi bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">结构区块链设置</h1><p id="1c9f" class="pw-post-body-paragraph ka kb hi kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hb bi translated">如果结构网络已经在运行，则可以跳过这一步。</p><p id="cf09" class="pw-post-body-paragraph ka kb hi kc b kd lc kf kg kh ld kj kk kl lf kn ko kp lh kr ks kt lj kv kw kx hb bi translated">让我们创建一个结构网络，执行以下命令。</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="b23a" class="me jd hi ma b fi mf mg l mh mi"><strong class="ma hj">export PATH=${PWD}/bin:$PATH<br/>sudo service docker start<br/> cd org1<br/>./1_enrollOrg1AdminAndUsers.sh<br/>./2_generateMSPOrg1.sh</strong></span><span id="bf88" class="me jd hi ma b fi mn mg l mh mi"><strong class="ma hj"><em class="lb"> </em>cd ../org2<br/></strong>./<strong class="ma hj">1_enrollOrg2AdminAndUsers.sh<br/></strong>./<strong class="ma hj">2_generateMSPOrg2.sh <br/> <br/> cd ../orderer<br/></strong>./<strong class="ma hj">1_enrollAdminAndMSP.sh<br/>./2_artifact.sh<br/> <br/> cd ../org1</strong><br/>.<strong class="ma hj">/3_createChannel.sh<br/> <br/> cd ../org2</strong><br/>.<strong class="ma hj">/3_joinChannel.sh</strong></span></pre><p id="05ed" class="pw-post-body-paragraph ka kb hi kc b kd lc kf kg kh ld kj kk kl lf kn ko kp lh kr ks kt lj kv kw kx hb bi translated">Hyperledger fabric 2.3区块链已准备就绪。</p><blockquote class="ky kz la"><p id="01b0" class="ka kb lb kc b kd lc kf kg kh ld kj kk le lf kn ko lg lh kr ks li lj kv kw kx hb bi translated">在Fabric 2.x发布之前，没有链码生命周期的概念</p></blockquote><h1 id="0941" class="jc jd hi bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">链码生命周期</h1><ul class=""><li id="4a3c" class="ll lm hi kc b kd ke kh ki kl ln kp lo kt lp kx lq lr ls lt bi translated"><strong class="kc hj"> Package chaincode: </strong>在这一步，我们需要创建一个压缩的chain code packager<strong class="kc hj">tar.gz</strong>文件。这个步骤可以由一个组织完成，也可以由每个组织完成。您可以将链码打包到单个组织中，并将其复制到其它组织中，或者打包到所有其它组织中。</li><li id="dd16" class="ll lm hi kc b kd lu kh lv kl lw kp lx kt ly kx lq lr ls lt bi translated"><strong class="kc hj">安装:</strong>是二进制自动触发事件。每个将使用链码背书交易或查询分类帐的组织都需要完成这一步。所有签署对等方需要执行此操作。</li><li id="66a4" class="ll lm hi kc b kd lu kh lv kl lw kp lx kt ly kx lq lr ls lt bi translated"><strong class="kc hj">批准</strong>每个使用链码的组织都需要完成这一步。在链码可以在渠道上开始之前，链码定义需要得到足够数量的组织的批准，以满足渠道的生命周期管理政策(默认为大多数)。</li><li id="1331" class="ll lm hi kc b kd lu kh lv kl lw kp lx kt ly kx lq lr ls lt bi translated"><strong class="kc hj">提交链代码:</strong>一旦通道上所需数量的组织被批准，提交事务必须由一个组织提交。提交者首先从批准了链码的组织的足够多的同行收集认可，然后提交事务以提交链码定义。</li></ul><h2 id="6e5d" class="me jd hi bd je mo mp mq ji mr ms mt jm kl mu mv jq kp mw mx ju kt my mz jy na bi translated">JAVA链代码部署</h2><p id="c7bc" class="pw-post-body-paragraph ka kb hi kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hb bi translated">让我们导航到<strong class="kc hj"> deployChaincode </strong>目录。在这里，我们可以看到各种部署脚本。</p><p id="6189" class="pw-post-body-paragraph ka kb hi kc b kd lc kf kg kh ld kj kk kl lf kn ko kp lh kr ks kt lj kv kw kx hb bi translated">在目录结构中，我们有<strong class="kc hj"><em class="lb">deployorg 1 _ Java . sh</em></strong>脚本，其中包含部署链代码所需的生命周期命令。在当前的结构网络中，我们有两个组织。首先将在<strong class="kc hj"> Org1 </strong>上部署链码如下。</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="ee13" class="me jd hi ma b fi mf mg l mh mi"><strong class="ma hj">cd deployChaincodes<br/>./deployOrg1_JAVA.sh</strong></span></pre><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es nb"><img src="../Images/ba7cb550f8e32a10ea9b5f4bc9bf7cc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fj9fhHAFLcXzyZECHASh4A.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx">Chaincode Deployment</figcaption></figure><ul class=""><li id="6857" class="ll lm hi kc b kd lc kh ld kl mk kp ml kt mm kx lq lr ls lt bi translated">上图显示了chaincode的成功部署。</li><li id="2acd" class="ll lm hi kc b kd lu kh lv kl lw kp lx kt ly kx lq lr ls lt bi translated">我们成功地将赛车记录推向了区块链。</li><li id="68e4" class="ll lm hi kc b kd lu kh lv kl lw kp lx kt ly kx lq lr ls lt bi translated">我们成功查询了推车记录。</li></ul><blockquote class="ky kz la"><p id="e036" class="ka kb lb kc b kd lc kf kg kh ld kj kk le lf kn ko lg lh kr ks li lj kv kw kx hb bi translated">这里我们不需要org2的批准来提交链代码，因为我已经在config.tx文件中做了策略更改。</p><p id="510d" class="ka kb lb kc b kd lc kf kg kh ld kj kk le lf kn ko lg lh kr ks li lj kv kw kx hb bi translated">请确保您已连接到互联网，以解析链码依赖性。</p></blockquote><p id="f1cf" class="pw-post-body-paragraph ka kb hi kc b kd lc kf kg kh ld kj kk kl lf kn ko kp lh kr ks kt lj kv kw kx hb bi translated"><strong class="kc hj">组织2 </strong></p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="55fc" class="me jd hi ma b fi mf mg l mh mi"><strong class="ma hj">./deployOrg2_JAVA.sh</strong></span></pre><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es nc"><img src="../Images/7f305cd6d2c7d0a7ee85bcf7e86382e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-IRmb6duglx7KCSf89EFsw.png"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx">Chaindoe Deployment</figcaption></figure><ul class=""><li id="6ab0" class="ll lm hi kc b kd lc kh ld kl mk kp ml kt mm kx lq lr ls lt bi translated">上图显示了chaincode的成功部署。</li><li id="d253" class="ll lm hi kc b kd lu kh lv kl lw kp lx kt ly kx lq lr ls lt bi translated">我们成功地查询了汽车数据。</li></ul><blockquote class="ky kz la"><p id="361a" class="ka kb lb kc b kd lc kf kg kh ld kj kk le lf kn ko lg lh kr ks li lj kv kw kx hb bi translated">在第二种组织中，我们不需要执行所有的生命周期命令。链代码提交和初始化由单个组织完成。</p></blockquote><h2 id="cc24" class="me jd hi bd je mo mp mq ji mr ms mt jm kl mu mv jq kp mw mx ju kt my mz jy na bi translated">JAVAScript链码部署</h2><p id="154f" class="pw-post-body-paragraph ka kb hi kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hb bi translated">在目录结构中，我们有<strong class="kc hj"><em class="lb">deployorg 1 _ JavaScript . sh</em></strong>和<strong class="kc hj"><em class="lb">deployorg 2 _ JavaScript . sh</em></strong>执行它们。</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="c81b" class="me jd hi ma b fi mf mg l mh mi"><strong class="ma hj">./deployOrg1_JavaScript.sh<br/>./deployOrg2_JavaScript.sh</strong></span></pre><ul class=""><li id="2bb8" class="ll lm hi kc b kd lc kh ld kl mk kp ml kt mm kx lq lr ls lt bi translated">成功部署chaincode后，将会看到与上图相同的输出。</li></ul><h2 id="483a" class="me jd hi bd je mo mp mq ji mr ms mt jm kl mu mv jq kp mw mx ju kt my mz jy na bi translated">开始链码部署</h2><p id="45b6" class="pw-post-body-paragraph ka kb hi kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hb bi translated">在目录结构中，我们有<strong class="kc hj"><em class="lb">deployorg 1 _ go . sh</em></strong>和<strong class="kc hj"><em class="lb">deployorg 2 _ go . sh</em></strong>执行它们。</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="4e78" class="me jd hi ma b fi mf mg l mh mi"><strong class="ma hj">./deployOrg1_GO.sh<br/>./deployOrg2_GO.sh</strong></span></pre><ul class=""><li id="4ef0" class="ll lm hi kc b kd lc kh ld kl mk kp ml kt mm kx lq lr ls lt bi translated">成功部署chaincode后，将会看到与上图相同的输出。</li></ul><h1 id="61e8" class="jc jd hi bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">如何升级Chaincode？？？</h1><p id="82a3" class="pw-post-body-paragraph ka kb hi kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hb bi translated">假设我们已经在光纤网络上部署了chaincode。现在，我们想为现有的chaincode添加一个新特性。</p><ul class=""><li id="faff" class="ll lm hi kc b kd lc kh ld kl mk kp ml kt mm kx lq lr ls lt bi translated">实现之后，必须遵循相同的链代码生命周期过程来部署链代码。</li><li id="e8eb" class="ll lm hi kc b kd lu kh lv kl lw kp lx kt ly kx lq lr ls lt bi translated">但是这里必须升级一个链码<strong class="kc hj">版本</strong>，链码<strong class="kc hj">序列、</strong>和链码<strong class="kc hj">标签。</strong></li><li id="d2e8" class="ll lm hi kc b kd lu kh lv kl lw kp lx kt ly kx lq lr ls lt bi translated">在部署中，脚本必须将<em class="lb"> CC_VERSION </em>版本从1更改为2，并将<em class="lb"> CC_SEQUENCE </em>从1更改为2。</li></ul><blockquote class="ky kz la"><p id="af90" class="ka kb lb kc b kd lc kf kg kh ld kj kk le lf kn ko lg lh kr ks li lj kv kw kx hb bi translated">我们不需要改变标签，因为我们已经改变了CC_VERSION和CC_SEQUENCE <em class="hi">。</em></p></blockquote><h1 id="2a8b" class="jc jd hi bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">打扫</h1><p id="9c76" class="pw-post-body-paragraph ka kb hi kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hb bi translated">执行以下脚本来清理所有docker容器和加密材料。</p><pre class="in io ip iq fd lz ma mb mc aw md bi"><span id="06ba" class="me jd hi ma b fi mf mg l mh mi">.<strong class="ma hj">/clean.sh</strong></span></pre><h1 id="155c" class="jc jd hi bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">摘要</h1><p id="799e" class="pw-post-body-paragraph ka kb hi kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hb bi translated">我们已经在Hyperledger Fabric区块链上成功部署了JAVA、GO、JavaScript链代码。</p></div></div>    
</body>
</html>