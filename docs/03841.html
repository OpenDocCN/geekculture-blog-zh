<html>
<head>
<title>How to Preview Images Before Upload with Javascript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Javascript在上传前预览图片</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-preview-images-before-upload-with-javascript-3420e3cd2f1c?source=collection_archive---------15-----------------------#2021-06-16">https://medium.com/geekculture/how-to-preview-images-before-upload-with-javascript-3420e3cd2f1c?source=collection_archive---------15-----------------------#2021-06-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f406f1367b48241f6a5b699eed6f6f30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VfOXi51YaRb97XmP"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@xps?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">XPS</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="52c3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您有一个输入类型文件，并希望在选择图像后动态预览它。</p><p id="7169" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我们将探讨如何借助普通JavaScript实现这一点。</p><p id="d4a7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，让我们仔细看看必要的HTML标记。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="2bf0" class="kc kd hi jy b fi ke kf l kg kh">&lt;input type=”<strong class="jy hj">file</strong>” <strong class="jy hj">accept</strong>=”.jpg, .jpeg, .png” id="file-upload"&gt; </span><span id="d92e" class="kc kd hi jy b fi ki kf l kg kh">&lt;img src="#" alt="Preview Uploaded Image" id="file-preview"&gt;</span></pre><p id="2e37" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如您所注意到的，输入类型必须设置为file。最好也设置<em class="kj">接受</em>属性的值。插入值以接受属性的其他有效方法是:<code class="du kk kl km jy b">image/jpg, image/gif</code>或简单的<code class="du kk kl km jy b">image/*</code>。后者允许带有任何图像扩展名的文件上传到页面上。</p><p id="51de" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">img标签中的<code class="du kk kl km jy b"><em class="kj">file-preview</em></code>的Id属性将被用于获取Javascript元素，以便我们在其中加载图像。</p><p id="c447" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有了这些之后，我们可以过渡到JavaScript部分，在这里我们需要首先获得输入元素，然后向它添加一个事件监听器。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="f038" class="kc kd hi jy b fi ke kf l kg kh">const input = document.getElementById(‘file-upload’);</span><span id="5f8c" class="kc kd hi jy b fi ki kf l kg kh">input.addEventListener('<strong class="jy hj">change</strong>', previewPhoto);</span></pre><p id="4104" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="kj">更改</em>每次用户选择图像时，事件监听器都会触发。这正是我们希望我们的图像在页面上可见的时候。正是为了这个目的，将调用名为<strong class="ix hj">预览照片</strong>的函数表达式。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="60f3" class="kc kd hi jy b fi ke kf l kg kh">const <strong class="jy hj">previewPhoto</strong> = () =&gt; {<br/>    const file = input.files;<br/>    if (file) {<br/>        const fileReader = <strong class="jy hj">new FileReader</strong>();<br/>        const preview = document.getElementById('file-preview');</span><span id="2373" class="kc kd hi jy b fi ki kf l kg kh">        fileReader.onload = event =&gt; {<br/>            preview.setAttribute('src', <strong class="jy hj">event.target.result</strong>);<br/>        }<br/>        fileReader.<strong class="jy hj">readAsDataURL</strong>(file[0]);<br/>    }<br/>}</span></pre><p id="74ca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个函数表达式中，我们创建了一个<code class="du kk kl km jy b">new FileReader</code>对象，它使我们能够读取存储在用户机器上的文件，这些文件是用户通过输入类型文件选择的。</p><p id="6a66" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦对象被加载，<code class="du kk kl km jy b"><em class="kj">event.target.result</em></code>将包含作为被调用的<code class="du kk kl km jy b">readAsDataURL</code>方法的结果的可加载url。这个url又可以作为所需对象的<code class="du kk kl km jy b">setAttribute</code>方法中的第二个参数传递。</p><p id="a5a6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，我们可以期望我们的JavaScript看起来像这样:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="0ee9" class="kc kd hi jy b fi ke kf l kg kh"><strong class="jy hj">const</strong> input = document.getElementById('file-input');</span><span id="f4d3" class="kc kd hi jy b fi ki kf l kg kh"><strong class="jy hj">const</strong> previewPhoto = () =&gt; {<br/>    const file = input.files;<br/>    <strong class="jy hj">if</strong> (file) {<br/>        <strong class="jy hj">const</strong> fileReader = new FileReader();<br/>        <strong class="jy hj">const</strong> preview = document.getElementById('file-preview');</span><span id="680a" class="kc kd hi jy b fi ki kf l kg kh">fileReader.onload = function (event) {<br/>            preview.setAttribute('src', event.target.result);<br/>        }<br/>        fileReader.readAsDataURL(file[0]);<br/>    }<br/>}</span><span id="b569" class="kc kd hi jy b fi ki kf l kg kh">input.addEventListener("change", previewPhoto);</span></pre><p id="d6d1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设我们在发生<em class="kj">改变</em>事件后调用函数表达式而不是函数。因为提升在JavaScript中是如何工作的，所以在初始化的表达式下面有我们的事件监听器是很重要的。</p></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><p id="9d70" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在您可以成功地预览屏幕上的图像后，它已被选中。</p></div></div>    
</body>
</html>