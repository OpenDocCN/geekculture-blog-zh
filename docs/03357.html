<html>
<head>
<title>How to Create a personal cloud at home using Openstack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Openstack在家中创建个人云</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-create-a-personal-cloud-at-home-using-openstack-24061f991048?source=collection_archive---------9-----------------------#2021-06-07">https://medium.com/geekculture/how-to-create-a-personal-cloud-at-home-using-openstack-24061f991048?source=collection_archive---------9-----------------------#2021-06-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8e04a3309eb92b4713a3ee6a6a98c6b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iauu1wkJ4G1Fl-z1o4pYkg.png"/></div></div></figure><p id="c432" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">原文:</p><div class="jo jp ez fb jq jr"><a href="https://blog.yassinemaachi.com/2021/06/how-to-create-personal-cloud-at-home.html" rel="noopener  ugc nofollow" target="_blank"><div class="js ab dw"><div class="jt ab ju cl cj jv"><h2 class="bd hj fi z dy jw ea eb jx ed ef hh bi translated">如何使用Openstack在家中创建个人云</h2><div class="jy l"><h3 class="bd b fi z dy jw ea eb jx ed ef dx translated">本文档展示了如何使用Packstack安装实用程序在3个节点上构建概念验证云。的…</h3></div><div class="jz l"><p class="bd b fp z dy jw ea eb jx ed ef dx translated">blog.yassinemaachi.com</p></div></div></div></a></div><p id="ffe6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本文档展示了如何使用Packstack安装实用程序在3个节点上构建概念验证云。</p><p id="ccd2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本指南中使用的硬件配置:</p><ul class=""><li id="39cc" class="ka kb hi is b it iu ix iy jb kc jf kd jj ke jn kf kg kh ki bi translated">1x Dlink DR-600路由器，使用NAT、防火墙等提供互联网接入</li><li id="a302" class="ka kb hi is b it kj ix kk jb kl jf km jj kn jn kf kg kh ki bi translated">1x数据链路交换机，提供机器之间的通信</li><li id="61c1" class="ka kb hi is b it kj ix kk jb kl jf km jj kn jn kf kg kh ki bi translated">3台带有硬件虚拟化扩展的物理机，以及至少一个网络适配器。</li></ul><figure class="kp kq kr ks fd ij er es paragraph-image"><div class="er es ko"><img src="../Images/1a4cfb0eacb7d25b42a5c09dc5ae3d89.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*bU7EFjssPDt3_Ls7N4bbOw.png"/></div><figcaption class="kt ku et er es kv kw bd b be z dx">Homelab architecture</figcaption></figure><ul class=""><li id="e793" class="ka kb hi is b it iu ix iy jb kc jf kd jj ke jn kf kg kh ki bi translated"><em class="kx">compute 01:</em><strong class="is hj"><em class="kx">8 CPU</em></strong><em class="kx">|</em><strong class="is hj"><em class="kx">32G</em></strong><em class="kx">RAM |</em><strong class="is hj"><em class="kx">1，8t</em></strong><em class="kx">data |</em><strong class="is hj"><em class="kx">192 . 168 . 1 . 101</em></strong><em class="kx">|</em><strong class="is hj"><em class="kx">CentOS 7 x86 _ 64</em></strong></li><li id="5aa3" class="ka kb hi is b it kj ix kk jb kl jf km jj kn jn kf kg kh ki bi translated"><em class="kx">compute 02:</em><strong class="is hj"><em class="kx">8 CPU</em></strong><em class="kx">|</em><strong class="is hj"><em class="kx">32G</em></strong><em class="kx">RAM |</em><strong class="is hj"><em class="kx">500g</em></strong><em class="kx">data |</em><strong class="is hj"><em class="kx">192 . 168 . 1 . 102</em></strong>|<strong class="is hj"><em class="kx">CentOS</em></strong></li><li id="b976" class="ka kb hi is b it kj ix kk jb kl jf km jj kn jn kf kg kh ki bi translated"><em class="kx">compute 03:</em><strong class="is hj"><em class="kx">4c pu</em></strong><em class="kx">|</em><strong class="is hj"><em class="kx">16G</em></strong><em class="kx">RAM |</em><strong class="is hj"><em class="kx">500g</em></strong><em class="kx">data |</em><strong class="is hj"><em class="kx">192 . 168 . 103<strong class="is hj"/></em></strong></li></ul><h1 id="eba2" class="ky kz hi bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">在第一个节点“compute 01”us root用户上运行以下命令</h1><p id="a22a" class="pw-post-body-paragraph iq ir hi is b it lw iv iw ix lx iz ja jb ly jd je jf lz jh ji jj ma jl jm jn hb bi translated">在同时充当控制器和计算节点的第一个节点上开始安装。</p><p id="77ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果使用非英语语言环境，请确保填充了/etc/环境:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="fdf3" class="mg kz hi mc b fi mh mi l mj mk">echo "LANG=en_US.utf-8<br/>LC_ALL=en_US.utf-8" &gt;&gt; /etc/environment</span></pre><p id="5576" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在/etc/hosts中添加其他节点地址</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="9378" class="mg kz hi mc b fi mh mi l mj mk">echo "192.168.1.101 compute01<br/>192.168.1.102 compute02<br/>192.168.1.103 compute03" &gt;&gt; /etc/hosts</span></pre><p id="e11a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您的系统满足下面提到的所有先决条件，请继续运行以下命令。</p><ul class=""><li id="2b95" class="ka kb hi is b it iu ix iy jb kc jf kd jj ke jn kf kg kh ki bi translated">Red Hat Enterprise Linux (RHEL) 7是最低推荐版本，或者是基于RHEL的Linux发行版(如CentOS、Scientific Linux等)的等效版本。x86_64是目前唯一支持的体系结构。</li><li id="8b3d" class="ka kb hi is b it kj ix kk jb kl jf km jj kn jn kf kg kh ki bi translated">具有至少16GB RAM、带有硬件虚拟化扩展的处理器和至少一个网络适配器的机器。</li></ul><p id="6bc3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更新您当前的软件包:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="1f2f" class="mg kz hi mc b fi mh mi l mj mk">yum update -y</span></pre><p id="ae88" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您计划通过外部网络访问服务器和实例，这是正确配置网络设置的好时机。一个静态的IP地址给你的网卡，并禁用网络管理器是好主意。</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="cb26" class="mg kz hi mc b fi mh mi l mj mk">systemctl disable firewalld<br/>systemctl stop firewalld<br/>systemctl disable NetworkManager<br/>systemctl stop NetworkManager<br/>systemctl enable network<br/>systemctl start network<br/>yum update -y</span></pre><p id="e447" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在CentOS 7上，Extras存储库提供支持OpenStack存储库的RPM。CentOS 8默认启用Extras，因此您只需安装RPM即可设置OpenStack存储库:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="64d5" class="mg kz hi mc b fi mh mi l mj mk">yum install -y centos-release-openstack-rocky<br/>yum update -y</span></pre><p id="cd7f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装Packstack安装程序:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="e677" class="mg kz hi mc b fi mh mi l mj mk">yum install -y openstack-packstack</span></pre><p id="48bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您有额外的硬盘驱动器，您可以使用它们作为lvm后端来扩展cinder存储容量。要添加装载在/dev/sdb和/dev/sdc上的2个磁盘，请运行以下命令:</p><p id="5bd0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于第一个磁盘/dev/sdb : <br/>在/dev/sdb磁盘上创建一个带有内部日志的XFS文件系统:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="d6d7" class="mg kz hi mc b fi mh mi l mj mk">mkfs.xfs -f -L "HomeLabStore" /dev/sdb</span></pre><p id="2129" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们将使用pvcreate命令创建一个物理卷，供LVM稍后使用。在这种情况下，物理卷将是我们新的/dev/sdb:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="5e6c" class="mg kz hi mc b fi mh mi l mj mk">pvcreate -y /dev/sdb</span></pre><p id="8df1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，使用vgextend命令，我们通过添加/dev/sdb物理卷来扩展centos卷组，该物理卷是我们刚刚使用pvcreate命令创建的。</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="6e03" class="mg kz hi mc b fi mh mi l mj mk">vgextend centos /dev/sdb</span></pre><p id="07eb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后使用lvextend命令扩展逻辑卷。我们在较新的/dev/sdb上扩展了/dev/centos/root的原始逻辑卷</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="6519" class="mg kz hi mc b fi mh mi l mj mk">lvextend -l +100%FREE /dev/centos/root</span></pre><p id="9d20" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过以下方式扩展文件系统:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="082a" class="mg kz hi mc b fi mh mi l mj mk">xfs_growfs /</span></pre><p id="e2a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">检查更改:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="8044" class="mg kz hi mc b fi mh mi l mj mk">lvmdiskscan -l<br/>df -h</span></pre><p id="fba6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于第二个磁盘/dev/sdc : <br/>在/dev/sdc磁盘上创建一个带有内部日志的XFS文件系统:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="0432" class="mg kz hi mc b fi mh mi l mj mk">mkfs.xfs -f -L "HomeLabStore" /dev/sdc</span></pre><p id="c697" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们将使用pvcreate命令创建一个物理卷，供LVM稍后使用。在这种情况下，物理卷将是我们新的/dev/sdc:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="faf2" class="mg kz hi mc b fi mh mi l mj mk">pvcreate -y /dev/sdc</span></pre><p id="b786" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，使用vgextend命令，我们通过添加/dev/sdc物理卷来扩展centos卷组，该物理卷是我们刚刚使用pvcreate命令创建的。</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="7466" class="mg kz hi mc b fi mh mi l mj mk">vgextend centos /dev/sdc</span></pre><p id="b088" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后使用lvextend命令扩展逻辑卷。我们在较新的/dev/sdc上扩展了/dev/centos/root的原始逻辑卷</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="03f8" class="mg kz hi mc b fi mh mi l mj mk">lvextend -l +100%FREE /dev/centos/root</span></pre><p id="f3f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过以下方式扩展文件系统:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="00c2" class="mg kz hi mc b fi mh mi l mj mk">xfs_growfs /</span></pre><p id="a9b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">检查更改:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="2c9d" class="mg kz hi mc b fi mh mi l mj mk">lvmdiskscan -l<br/>df -h</span></pre><p id="3146" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重新启动节点:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="9e56" class="mg kz hi mc b fi mh mi l mj mk">reboot</span></pre><p id="5d8e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Packstack免去了手动设置OpenStack的工作。对于单节点OpenStack部署(我们将在第二个部署中添加其他节点)，运行以下命令:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="fc47" class="mg kz hi mc b fi mh mi l mj mk">packstack<br/> --allinone --provision-demo=n  --os-neutron-l2-agent=openvswitch <br/>--os-neutron-ml2-mechanism-drivers=openvswitch <br/>--os-neutron-ml2-tenant-network-types=vxlan <br/>--os-neutron-ml2-type-drivers=flat,vlan,gre,vxlan  <br/>--os-neutron-ovs-bridge-mappings=extnet:br-ex <br/>--os-neutron-ovs-bridge-interfaces=br-ex:p3p1</span></pre><p id="4486" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这意味着，我们将打开接口，并将其作为端口插入br-ex OVS网桥，以提供上行链路连接。并将为我们的外部物理L2网段定义一个逻辑名称“extnet”。稍后，在创建外部网络时，我们将通过名称来引用我们的提供商网络。</p><p id="dfeb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">检查网络配置的一些有用命令:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="401a" class="mg kz hi mc b fi mh mi l mj mk">ovs-vsctl list-br<br/>cat /etc/sysconfig/network-scripts/ifcfg-p3p1<br/>cat /etc/sysconfig/network-scripts/ifcfg-br-ex<br/>ovs-vsctl list-ports br-tun<br/>ovs-vsctl list-ports br-int<br/>ovs-vsctl list-ports br-ex<br/>cat /etc/neutron/plugins/ml2/ml2_conf.ini |grep type_drivers<br/>cat /etc/neutron/plugins/ml2/ml2_conf.ini |grep tenant_network_types<br/>cat /etc/neutron/plugins/ml2/ml2_conf.ini |grep flat_networks<br/>cat /etc/neutron/plugins/ml2/ml2_conf.ini |grep vni_ranges<br/>cat /etc/neutron/plugins/ml2/openvswitch_agent.ini |grep  tunnel_types -B12<br/>cat /etc/neutron/plugins/ml2/openvswitch_agent.ini |grep  l2_population<br/>cat /etc/neutron/plugins/ml2/openvswitch_agent.ini |grep  prevent_arp_spoofing<br/>cat /etc/neutron/plugins/ml2/openvswitch_agent.ini |grep  bridge_mappings</span></pre><p id="2743" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重新启动节点:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="cad6" class="mg kz hi mc b fi mh mi l mj mk">reboot</span></pre><p id="068e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，用中子创建外部网络。</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="918f" class="mg kz hi mc b fi mh mi l mj mk">source keystonerc_admin<br/>neutron net-create external_network --provider:network_type flat --provider:physical_network extnet  --router:external</span></pre><p id="e38d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意:“extnet”是我们用上面的–OS-neutron-ovs-bridge-mappings定义的L2段。</p><p id="03a3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您需要创建一个分配范围在外部DHCP范围之外的公共子网，并将网关设置为外部网络的默认网关。</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="69e2" class="mg kz hi mc b fi mh mi l mj mk">neutron<br/> subnet-create --name public_subnet --enable_dhcp=False <br/>--allocation-pool=start=192.168.1.110,end=192.168.1.210  <br/>--gateway=192.168.1.254 external_network 192.168.1.0/24</span></pre><p id="7055" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">获得一个cirros映像，在没有演示配置的情况下不进行配置:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="6f98" class="mg kz hi mc b fi mh mi l mj mk">curl<br/> -L <a class="ae ml" href="http://download.cirros-cloud.net/0.3.4/cirros-0.3.4-x86_64-disk.img" rel="noopener ugc nofollow" target="_blank">http://download.cirros-cloud.net/0.3.4/cirros-0.3.4-x86_64-disk.img</a> |<br/> glance          image-create --name='cirros image' --visibility=public <br/>--container-format=bare --disk-format=qcow2</span></pre><p id="f08b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为您还没有创建项目和用户:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="1744" class="mg kz hi mc b fi mh mi l mj mk">openstack project create --enable homelab<br/>openstack user create --project homelab --password SuperPassw0Rd --email ymaachi@yassinemaachi.com --enable ymaachi</span></pre><p id="0972" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，让我们创建一个源文件，以便轻松切换到新创建的用户:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="6b22" class="mg kz hi mc b fi mh mi l mj mk">echo "    export OS_USERNAME=ymaachi<br/>    export OS_PASSWORD='SuperPassw0Rd'<br/>    export OS_TENANT_NAME=homelab<br/>    export PS1='[\u@\h \W(keystone_ymaachi)]\$ '" &gt; keystonerc_ymaachi</span></pre><p id="106f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后创建一个路由器，并使用管理员在前面的某个步骤中创建的外部网络设置其网关:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="a9e0" class="mg kz hi mc b fi mh mi l mj mk">neutron router-create homelab_router<br/>neutron router-gateway-set homelab_router external_network</span></pre><p id="8d26" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在创建一个专用网络并在其中创建一个子网，因为演示配置已被禁用:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="3896" class="mg kz hi mc b fi mh mi l mj mk">neutron net-create homelab_network<br/>neutron<br/> subnet-create --name homelab_subnet --gateway 192.168.100.1 <br/>--dns-nameserver 192.168.1.254 --dns-nameserver 8.8.8.8 --dns-nameserver<br/> 4.4.4.4  homelab_network 192.168.100.0/24</span></pre><p id="bdb8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，通过路由器将新的私有网络连接到公共网络，路由器将提供浮动IP地址。</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="d662" class="mg kz hi mc b fi mh mi l mj mk">neutron router-interface-add homelab_router homelab_subnet</span></pre><p id="4eb4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">导入ssh密钥以访问实例(您可以生成自己的密钥):</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="0680" class="mg kz hi mc b fi mh mi l mj mk">openstack keypair create --public-key ~/.ssh/id_rsa.pub rootATcompute01</span></pre><p id="1949" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建一个安全组来授权对实例的ssh访问:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="0375" class="mg kz hi mc b fi mh mi l mj mk">openstack security group create secgroup01<br/>openstack security group rule create --protocol icmp --ingress secgroup01<br/>openstack security group rule create --protocol tcp --dst-port 22:22 secgroup01<br/>openstack security group rule list</span></pre><h1 id="0e93" class="ky kz hi bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">以root用户身份在第二个节点“Compute02”上运行以下命令</h1><p id="d167" class="pw-post-body-paragraph iq ir hi is b it lw iv iw ix lx iz ja jb ly jd je jf lz jh ji jj ma jl jm jn hb bi translated">如果使用非英语语言环境，请确保填充了/etc/环境:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="e70f" class="mg kz hi mc b fi mh mi l mj mk">echo "LANG=en_US.utf-8<br/>LC_ALL=en_US.utf-8" &gt;&gt; /etc/environment</span></pre><p id="9068" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在/etc/hosts中添加其他节点地址</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="1174" class="mg kz hi mc b fi mh mi l mj mk">echo "192.168.1.101 compute01<br/>192.168.1.102 compute02<br/>192.168.1.103 compute03" &gt;&gt; /etc/hosts</span></pre><p id="460a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您的系统满足下面提到的所有先决条件，请继续运行以下命令。</p><ul class=""><li id="6668" class="ka kb hi is b it iu ix iy jb kc jf kd jj ke jn kf kg kh ki bi translated">Red Hat Enterprise Linux (RHEL) 7是最低推荐版本，或者是基于RHEL的Linux发行版(如CentOS、Scientific Linux等)的等效版本。x86_64是目前唯一支持的体系结构。</li></ul><p id="2749" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更新您当前的软件包:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="6cb0" class="mg kz hi mc b fi mh mi l mj mk">yum update -y</span></pre><p id="2f92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您计划通过外部网络访问服务器和实例，这是正确配置网络设置的好时机。一个静态的IP地址给你的网卡，并禁用网络管理器是好主意。</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="90a4" class="mg kz hi mc b fi mh mi l mj mk">systemctl disable firewalld<br/>systemctl stop firewalld<br/>systemctl disable NetworkManager<br/>systemctl stop NetworkManager<br/>systemctl enable network<br/>systemctl start network<br/>yum update -y</span></pre><p id="0035" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在CentOS 7上，Extras存储库提供支持OpenStack存储库的RPM。CentOS 8默认启用Extras，因此您只需安装RPM即可设置OpenStack存储库:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="f321" class="mg kz hi mc b fi mh mi l mj mk">yum install -y centos-release-openstack-rocky<br/>yum update -y</span></pre><p id="aeda" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重新启动节点:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="ac73" class="mg kz hi mc b fi mh mi l mj mk">reboot</span></pre><h1 id="1ce8" class="ky kz hi bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">以root用户身份在第三个节点“Compute03”上运行以下命令</h1><p id="f79e" class="pw-post-body-paragraph iq ir hi is b it lw iv iw ix lx iz ja jb ly jd je jf lz jh ji jj ma jl jm jn hb bi translated">如果使用非英语语言环境，请确保填充了/etc/环境:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="bb13" class="mg kz hi mc b fi mh mi l mj mk">echo "LANG=en_US.utf-8<br/>LC_ALL=en_US.utf-8" &gt;&gt; /etc/environment</span></pre><p id="ec60" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在/etc/hosts中添加其他节点地址</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="556b" class="mg kz hi mc b fi mh mi l mj mk">echo "192.168.1.101 compute01<br/>192.168.1.102 compute02<br/>192.168.1.103 compute03" &gt;&gt; /etc/hosts</span></pre><p id="bbe8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您的系统满足下面提到的所有先决条件，请继续运行以下命令。</p><ul class=""><li id="44ea" class="ka kb hi is b it iu ix iy jb kc jf kd jj ke jn kf kg kh ki bi translated">Red Hat Enterprise Linux (RHEL) 7是最低推荐版本，或者是基于RHEL的Linux发行版(如CentOS、Scientific Linux等)的等效版本。x86_64是目前唯一支持的体系结构。</li></ul><p id="7c5b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更新您当前的软件包:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="9151" class="mg kz hi mc b fi mh mi l mj mk">yum update -y</span></pre><p id="21fb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您计划通过外部网络访问服务器和实例，这是正确配置网络设置的好时机。一个静态的IP地址给你的网卡，并禁用网络管理器是好主意。</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="73fc" class="mg kz hi mc b fi mh mi l mj mk">systemctl disable firewalld<br/>systemctl stop firewalld<br/>systemctl disable NetworkManager<br/>systemctl stop NetworkManager<br/>systemctl enable network<br/>systemctl start network<br/>yum update -y</span></pre><p id="0c19" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在CentOS 7上，Extras存储库提供支持OpenStack存储库的RPM。CentOS 8默认启用Extras，因此您只需安装RPM即可设置OpenStack存储库:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="3207" class="mg kz hi mc b fi mh mi l mj mk">yum install -y centos-release-openstack-rocky<br/>yum update -y</span></pre><p id="8aa1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重新启动节点:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="fd76" class="mg kz hi mc b fi mh mi l mj mk">reboot</span></pre><h1 id="e916" class="ky kz hi bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">以root用户身份在控制器节点(第一个节点)“Compute01”上运行以下命令</h1><p id="d73e" class="pw-post-body-paragraph iq ir hi is b it lw iv iw ix lx iz ja jb ly jd je jf lz jh ji jj ma jl jm jn hb bi translated">首先，编辑在初始Packstack设置期间生成的“应答文件”。您将在运行Packstack的目录中找到该文件。</p><p id="e833" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意:默认情况下，$youranswerfile名为pack stack-answer-$ date-$ time . txt。</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="a589" class="mg kz hi mc b fi mh mi l mj mk">vi packstack-answers-20210604-163902.txt</span></pre><p id="6d7d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果希望将新节点作为唯一的计算节点，请将CONFIG_COMPUTE_HOSTS的值从第一个主机IP地址的值更改为第二个主机IP地址的值。如果您以逗号分隔列表的形式添加这两个系统，也可以将它们作为计算节点:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="112b" class="mg kz hi mc b fi mh mi l mj mk">CONFIG_COMPUTE_HOSTS=192.168.1.101,192.168.1.102,192.168.1.103</span></pre><p id="faa1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以更改以下值，以便在您的家庭云中安装这些附加服务:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="02ef" class="mg kz hi mc b fi mh mi l mj mk">CONFIG_MANILA_INSTALL=y<br/>CONFIG_PANKO_INSTALL=y<br/>CONFIG_SAHARA_INSTALL=y<br/>CONFIG_HEAT_INSTALL=y<br/>CONFIG_MAGNUM_INSTALL=y<br/>CONFIG_TROVE_INSTALL=y<br/>CONFIG_NEUTRON_FWAAS=y<br/>CONFIG_NEUTRON_VPNAAS=y</span></pre><p id="9a09" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">再次运行Packstack，指定修改后的“应答文件”:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="0a2a" class="mg kz hi mc b fi mh mi l mj mk">packstack --answer-file=packstack-answers-20210604-163902-second-deployment.txt</span></pre><p id="e41f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装程序将要求您为正在网络上安装的每个主机节点输入root密码，以启用主机的远程配置，这样它就可以使用Puppet远程配置每个节点。</p><p id="9172" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在Horizon中安装马尼拉用户界面:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="52d8" class="mg kz hi mc b fi mh mi l mj mk">yum install -y openstack-manila-ui</span></pre><p id="2b2f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">自定义Horizon徽标:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="31f8" class="mg kz hi mc b fi mh mi l mj mk">mv<br/> /usr/share/openstack-dashboard/static/dashboard/img/logo-splash.svg <br/>/usr/share/openstack-dashboard/static/dashboard/img/logo-splash.svg.old<br/>mv /usr/share/openstack-dashboard/static/dashboard/img/logo.svg /usr/share/openstack-dashboard/static/dashboard/img/logo.svg.old<br/>mv<br/> <br/>/usr/share/openstack-dashboard/openstack_dashboard/static/dashboard/img/logo.svg<br/> <br/>/usr/share/openstack-dashboard/openstack_dashboard/static/dashboard/img/logo.svg.old<br/>mv<br/> <br/>/usr/share/openstack-dashboard/openstack_dashboard/static/dashboard/img/logo-splash.svg<br/> <br/>/usr/share/openstack-dashboard/openstack_dashboard/static/dashboard/img/logo-splash.svg.old</span></pre><p id="f707" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从您的计算机上，将新徽标复制到horizon，以替换openstack默认徽标:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="b5bc" class="mg kz hi mc b fi mh mi l mj mk">scp<br/> img/Color-logo-no-background.svg <br/>root@192.168.1.101:/usr/share/openstack-dashboard/openstack_dashboard/static/dashboard/img/logo.svg<br/>scp<br/> img/Color-logo-no-background-splash.svg <br/>root@192.168.1.101:/usr/share/openstack-dashboard/openstack_dashboard/static/dashboard/img/logo-splash.svg<br/>scp img/Color-logo-no-background.svg root@192.168.1.101:/usr/share/openstack-dashboard/static/dashboard/img/logo.svg<br/>scp<br/> img/Color-logo-no-background-splash.svg <br/>root@192.168.1.101:/usr/share/openstack-dashboard/static/dashboard/img/logo-splash.svg</span></pre><p id="6da5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，从控制器节点(compute01)添加Horizon的DNS别名并重启httpd服务:</p><pre class="kp kq kr ks fd mb mc md me aw mf bi"><span id="2fe9" class="mg kz hi mc b fi mh mi l mj mk">vi /etc/httpd/conf.d/15-horizon_vhost.conf<br/>  ServerAlias cloud.yassinemaachi.com<br/>systemctl restart httpd<br/>systemctl restart memcached</span></pre><p id="5d0c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">流程完成后，您可以通过访问<a class="ae ml" rel="noopener ugc nofollow" target="_blank" href="/$YOURIP/dashboard."> http://$YOURIP/dashboard登录OpenStack web界面Horizon。</a>用户名是admin。可以在控制节点的/根目录下的keystonerc_admin文件中找到该密码。</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/c7d55e1278b088703b01ebd21b0912d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZKUMgmOERb7rNbMbydzTyw.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">Horizon homelab access</figcaption></figure><p id="4ad6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要检查horizon中所有计算节点的状态，请转至管理项目中“计算”下的“虚拟机管理程序”部分:</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/4ea1ab6b35c719bdf55a8cd0beb4435b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B1YIHL5tV38QcnlOqKF2Bg.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">homelab horizon hypervisors</figcaption></figure><p id="dbf2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步:</p><div class="jo jp ez fb jq jr"><a href="https://yassinemaachi5.medium.com/deploy-a-virtual-machine-in-openstack-then-install-docker-and-rancher-on-it-ea21d40da700" rel="noopener follow" target="_blank"><div class="js ab dw"><div class="jt ab ju cl cj jv"><h2 class="bd hj fi z dy jw ea eb jx ed ef hh bi translated">在Openstack中部署一个虚拟机，然后在其上安装docker和rancher</h2><div class="jy l"><h3 class="bd b fi z dy jw ea eb jx ed ef dx translated">Openstack、Heat、centos、docker、rancher</h3></div><div class="jz l"><p class="bd b fp z dy jw ea eb jx ed ef dx translated">yassinemaachi5.medium.com</p></div></div><div class="mo l"><div class="mp l mq mr ms mo mt io jr"/></div></div></a></div><p id="d72b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个故事是基于和灵感来自于https://www.rdoproject.org/install/packstack/<a class="ae ml" href="https://www.rdoproject.org/install/packstack/" rel="noopener ugc nofollow" target="_blank">的RDO项目</a></p></div></div>    
</body>
</html>