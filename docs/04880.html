<html>
<head>
<title>Football Analysis: Attempt to improve upon the current Expected Goals metric using Probabilistic Graphical Methods</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">足球分析:尝试使用概率图形方法改进当前的预期目标度量</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/football-analysis-attempt-to-improve-upon-the-current-expected-goals-metric-using-probabilistic-7372dbed7649?source=collection_archive---------31-----------------------#2021-07-05">https://medium.com/geekculture/football-analysis-attempt-to-improve-upon-the-current-expected-goals-metric-using-probabilistic-7372dbed7649?source=collection_archive---------31-----------------------#2021-07-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="79a7" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">摘要</h1><p id="3fc6" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这个项目基于足球中xG度量的概念，它测量射门质量或平均射门得分的概率。目的是使用贝叶斯网络计算xG指标，并使用逻辑回归将结果与基线模型进行比较。</p></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><h1 id="8980" class="if ig hi bd ih ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc bi translated">介绍</h1><h2 id="8a26" class="kn ig hi bd ih ko kp kq il kr ks kt ip jo ku kv it js kw kx ix jw ky kz jb la bi translated">预期目标(xG)指标</h2><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lb"><img src="../Images/46c258b979000a53686e4935445ecc0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AC48m7ti_sGXVMbA.jpg"/></div></div></figure><blockquote class="ln"><p id="6696" class="lo lp hi bd lq lr ls lt lu lv lw ka dx translated">巴洛特利，…..阿圭罗。我发誓你再也不会看到这样的事情了。所以看着它，喝进去。</p><p id="a7e3" class="lo lp hi bd lq lr lx ly lz ma mb ka dx translated">——2012年马丁·泰勒，曼城对QPR英超冠军赛。</p></blockquote><p id="dd6d" class="pw-post-body-paragraph jd je hi jf b jg mc ji jj jk md jm jn jo me jq jr js mf ju jv jw mg jy jz ka hb bi mh translated">与其他运动相比，足球是一项得分相对较低的运动，因此在比赛中不可预测。1993年至2011年间，英格兰、德国、西班牙、意大利和法国的顶级联赛平均每场进球2.66个，而在国家篮球协会，每场得分超过160分。</p><p id="2110" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">在足球中，比赛和锦标赛往往是由个人的辉煌时刻决定的。这就是这项运动的特别之处，它的球迷如此热情——然而对分析家来说却是一场噩梦。毕竟，一个潜在价值数百万美元的俱乐部做出的决定，不能仅仅基于当前的形式。</p><p id="d0bf" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">为了给这种混乱带来一些秩序，消除进球得分的不确定性，Sam Green在2012年引入了预期进球(xG)指标。它衡量射门质量或平均射门得分的概率(图1)。这意味着我们可以超越固有的随机的实际进球，来研究平均应该发生什么。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es mv"><img src="../Images/bbfbe84349e91753fbeee19f23cbb629.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NRvusPhfeyPZhoF_Fk7cHA.jpeg"/></div></div><figcaption class="mw mx et er es my mz bd b be z dx">Figure 1: The probability of a shot resulting in a goal based on the location.</figcaption></figure><p id="9b2b" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">这很有用，因为足球俱乐部现在可以做出更明智的招聘或战术决定。例如，俱乐部可以超越一名球员的进球或助攻数量，并确定哪些球员可能运气不佳，但创造了高质量的机会。同样，他们也通过确保不会因为一个幸运的连续进球而为一名球员支付过高的价格来降低他们的招聘风险。</p><p id="e558" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">基于这一理论，利物浦俱乐部的分析师得出结论，多特蒙德的教练尤尔根·克洛普在上一个赛季运气不佳，多特蒙德实际上应该在最终的德甲积分榜上高出5位(图2)。因此，尤尔根·克洛普被利物浦聘用，尽管他在多特蒙德的最后一年表现不佳。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es na"><img src="../Images/6816e78cc7e5b916e75d76ea05001293.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iJoMhiL40muyN3P7TS8jfQ.jpeg"/></div></div><figcaption class="mw mx et er es my mz bd b be z dx">Figure 2: Bundesliga, 2014–15</figcaption></figure><p id="3717" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">预期目标是一个经典的监督学习问题，其中分类模型的任务是在给定拍摄时的上下文信息的情况下，识别一个镜头是否是目标。</p><p id="3d79" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">因此，如果我们考虑一个伯努利随机变量，假设<em class="nb">是_目标，</em>当射门得分时为1，否则为0。那么镜头的xG度量被定义为<em class="nb">的条件期望is_goal，</em>因为</p><p id="3b4c" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated"><strong class="jf hj"> E( <em class="nb"> is_goal| </em>地点，身体部位，…)= P(<em class="nb">is _ goal</em>= 1 |地点，身体部位，…) </strong></p><p id="402f" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">通常使用逻辑回归方法计算一个镜头的xG，但是也可以使用其他分类算法，例如决策树和随机森林。在这个项目中，一个概率图形模型，更具体地说是一个贝叶斯网络，将用于计算xG指标。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es nc"><img src="../Images/14153278d47c7a2f8bb8d149ee69bd91.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*Zd-fYjPalSatLqkHY9aAig.png"/></div><figcaption class="mw mx et er es my mz bd b be z dx">Table 1: Features used in the original xG model</figcaption></figure><p id="5a2d" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">与所有其他监督学习问题一样，选择学习的特征对获得的xG有很大影响。Sam Green在他的原始模型中使用的数据如表1所示，其他分析师后来添加了许多其他特性。然而，由于可用数据和时间的限制，本项目中的分析基于有限数量的特征，这将在后续章节中讨论。</p><h2 id="708c" class="kn ig hi bd ih ko kp kq il kr ks kt ip jo ku kv it js kw kx ix jw ky kz jb la bi translated">概率图形模型</h2><p id="66d2" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi mh translated"><span class="l mi mj mk bm ml mm mn mo mp di">一个</span>图包括由链接连接的节点。在概率图形模型中，节点表示随机变量，链接表示变量之间的概率关系。然后，该图捕捉所有随机变量上的联合分布可以被分解的方式，从而可以看到节点之间的条件关系。这个项目将主要关注有向无环图或贝叶斯网。</p><p id="1cb2" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">贝叶斯网络具有带方向性的链接。它们对于表达随机变量之间的因果关系很有用。例如，让我们考虑一个简单的贝叶斯网络的4个变量:湿草(WG)，下雨(R)，多云(C)和喷头(S)。在没有任何进一步信息的情况下，联合概率分布可以写成—</p><h2 id="d93a" class="kn ig hi bd ih ko kp kq il kr ks kt ip jo ku kv it js kw kx ix jw ky kz jb la bi translated"><em class="nd"> P (WG，C，S，R) = P(WG|C，S，R) P(S|C，R) P(R|C) P(C) </em></h2><p id="5939" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在，假设我们能够了解变量之间的因果关系，如图3所示。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es ne"><img src="../Images/3c58524a84f4e5075c76f94d3ecad242.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*ZDvNCGrKjK4YP4J5BEuuXQ.png"/></div><figcaption class="mw mx et er es my mz bd b be z dx">Figure 3: Sample Bayesian Network</figcaption></figure><p id="da32" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">那么联合概率可以分解如下，</p><h2 id="8ef1" class="kn ig hi bd ih ko kp kq il kr ks kt ip jo ku kv it js kw kx ix jw ky kz jb la bi translated">P (WG，C，S，R) = P(W|S，R) P(S|C) P(R|C) P(C)</h2><p id="4c63" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">与逻辑回归或其他分类问题相比，使用PGM的一个主要优势是，它允许我们计算对足球分析有用的边际条件分布，其中所有变量可能并不总是已知的。PGM还提供了各种变量独立性的信息。</p></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><h1 id="5167" class="if ig hi bd ih ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc bi translated">方法学</h1><h2 id="1dda" class="kn ig hi bd ih ko kp kq il kr ks kt ip jo ku kv it js kw kx ix jw ky kz jb la bi translated">数据</h2><p id="6806" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi mh translated"><span class="l mi mj mk bm ml mm mn mo mp di"> D </span>该车型使用的数据可在:<a class="ae nf" href="https://www.kaggle.com/secareanualin/football-events" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/secareanualin/football-events</a>获得。</p><p id="82f2" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">该模型中考虑的特征是-</p><p id="ea7f" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated"><strong class="jf hj">位置</strong> —球场被分成11个区域，分别表示为{ '禁区中心'、'困难角度和远距离'、'左边困难角度'、'右边困难角度'、'禁区左侧'、' 6码禁区左侧'、' 6码禁区右侧'、'非常近距离'、'禁区外'、'远距离'，而不是距离和角度。</p><p id="b0ef" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated"><strong class="jf hj">身体部位</strong> —这个特征是指拍摄时是用右脚、左脚还是用头。</p><p id="735e" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated"><strong class="jf hj">辅助方法</strong> —该特征指导致射门的传球类型。所有的助攻都分为五类，{无，传球，传中，头球，直传球}</p><p id="cb16" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated"><strong class="jf hj">投篮位置</strong>和<strong class="jf hj">快攻* — </strong>投篮位置是指投篮的位置，例如左上角，快攻是一个伯努利变量，表示反击。</p><p id="812e" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">*这些特征尚未用于逻辑回归</p><p id="b65f" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">此外，为了进一步分析，我只考虑了空位投篮，所有的点球、任意球和角球都被删除了。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es ng"><img src="../Images/29d5c4397a6a7ecfa9bf1c1f7c398049.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*cj9ms493BqZZees0fC0yVA.png"/></div><figcaption class="mw mx et er es my mz bd b be z dx">Figure 4: Sample of the Dataset</figcaption></figure><p id="31b9" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">总共有229135次投篮出现在数据中，其中192431次投篮被考虑。</p><h2 id="6ac8" class="kn ig hi bd ih ko kp kq il kr ks kt ip jo ku kv it js kw kx ix jw ky kz jb la bi translated">逻辑回归</h2><p id="8dfa" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi mh translated"><span class="l mi mj mk bm ml mm mn mo mp di">在</span>中，为了验证构建的贝叶斯网络，需要基线。在这个项目中，在与贝叶斯网络相同的特征上实现逻辑回归，并且比较两者预测的xG。</p><p id="2d3e" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">在实现逻辑回归之前，可用的数据被矢量化，即所有特征被转换成k-hot向量。</p><p id="33ce" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">例如，Body part = 3被转换为Bodypart = [0，0，1]</p><p id="49e9" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">使用PCA降低了数据的维数，如图5所示。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nh"><img src="../Images/e67a10135d446184ebd34f7ab064fc12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ggl0BGaQnXG8BZvs6p22nQ.png"/></div></div><figcaption class="mw mx et er es my mz bd b be z dx">Figure 5: Original and Vectorized Dataset represented in 2 dimensions.</figcaption></figure><p id="947f" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">然而，现有数据严重偏向于未命中。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es ni"><img src="../Images/375b42d196f573143422ab29ca7af4bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*FoRvK6ICSRW2F4ILS0htIg.png"/></div><figcaption class="mw mx et er es my mz bd b be z dx">Figure 6: Distribution of Goals in the Dataset</figcaption></figure><p id="0d9a" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">因此，为了调整阶层不平衡，使用了加权逻辑回归。重量计算如下:</p><p id="61f4" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated"><strong class="jf hj">权重= 0.5*(实例数/遗漏数)</strong></p><p id="e20d" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">图7总结了未加权模型和加权模型的结果。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nj"><img src="../Images/569103b73b03d7c36ad2df1a3ffec23f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0-BSbZXlkKT4J_HRyr0ZOA.png"/></div></div><figcaption class="mw mx et er es my mz bd b be z dx">Figure 7: Logistic Regression</figcaption></figure><p id="a334" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">即使未加权的逻辑回归给出了更好的准确性，加权的逻辑回归被认为是基线模型，因为它对新数据的概括更好。</p><h2 id="3124" class="kn ig hi bd ih ko kp kq il kr ks kt ip jo ku kv it js kw kx ix jw ky kz jb la bi translated">贝叶斯网络</h2><p id="9402" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi mh translated">贝叶斯网络的节点由{Location，Is_Goal，Shot_Place，Assist_Method，Bodypart，Fast_Break}给出。</p><p id="7884" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">为了学习网络的结构，使用了基于约束的结构学习，其中程序最初假设节点是独立的，然后验证该假设。获得的结构如图8所示。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nk"><img src="../Images/a173a7c7eb05c9e16c1f004005613121.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wWepT4SOc72QgON9356CPA.png"/></div></div><figcaption class="mw mx et er es my mz bd b be z dx">Figure 8: Bayesian Network Predicted by CBSL</figcaption></figure><p id="3996" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">一旦决定了结构，使用贝叶斯估计器计算每个节点的条件概率分布。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nl"><img src="../Images/635502ff20bc3c1bd0a0f4cb9158ae35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RblqmpUvncrw2cwQUm3xEQ.png"/></div></div><figcaption class="mw mx et er es my mz bd b be z dx">Figure 9: Portion of the CPD table for node — is_goal</figcaption></figure><p id="a546" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">一旦学习了贝叶斯网络的结构和参数，就可以通过生成对网络的查询来计算其他节点的边缘化概率条件。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es nm"><img src="../Images/c9976377c924572ef600d79ddfd2d9a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*fsfkp0tP7CdGzoKp2AwmRQ.png"/></div><figcaption class="mw mx et er es my mz bd b be z dx">Figure 9: Query Result for Goal at Very Close Range</figcaption></figure><p id="a1a0" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">有关贝叶斯网络的结构和参数学习的更多信息，请查看博客末尾的附录。</p></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><h1 id="4418" class="if ig hi bd ih ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc bi translated">结果</h1><p id="a05e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在贝叶斯网络已经学会了，它可以用来找出许多我们对足球比赛不确定的事情的答案。</p><h1 id="c1e8" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">1.评估玩家表现</h1><p id="2a8d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">自从莱昂内尔·梅西和克里斯蒂亚诺·罗纳尔多首次亮相足球世界以来，他们已经完全垄断了世界足球的聚光灯。在过去的十年或更长的时间里，他们继续以许多人认为不可能的技巧和连贯性表演。在这段时间里，除了两人令人难以置信的进球，还有关于谁更优秀的争论。我们可能经常想要比较两个伟大的球员，即使这个模型是开放的解释，它也有希望提供一个关于有问题的球员的更清晰的图片。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nn"><img src="../Images/89cf81d3091969aa0bbfefffb796e477.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*moV3F1Si4MkVScOjvvIUSA.png"/></div></div><figcaption class="mw mx et er es my mz bd b be z dx">Figure 10: Conditional Xg for an Average Player</figcaption></figure><p id="8a42" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">图10显示了普通玩家的条件xG给定身体部位或位置。正如所料，近距离射击的xG最高，一般来说，近距离射击比远距离射击有更高的xG。</p><p id="e71e" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">同样的，xG是头球的最高分。这可以归因于这样一个事实，即头球通常是从可得分区域尝试的。右脚的xG略高，可能是因为右脚球员人数较多而有所偏差。</p><p id="760c" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">使用莱昂内尔·梅西和克里斯蒂亚诺·罗纳尔多的可用数据进行了类似的分析，如图11所示。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es no"><img src="../Images/26fdf83cdaa3e5e5d172e5873900ea4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cMeZ2FG0WlKJ52JxlXm_Iw.png"/></div></div><figcaption class="mw mx et er es my mz bd b be z dx">Figure 11: xG for Lionel Messi and Cristiano Ronaldo</figcaption></figure><p id="4deb" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">从图表中可以清楚地看到，与平均水平相比，两位选手的水平都要高得多。然而，在他们两人中，梅西似乎在几乎每个位置上都表现得最好。事实上，罗纳尔多更好的唯一指标是从右边的困难角度，这可以被原谅，因为梅西是左脚球员，而罗纳尔多是右脚球员。</p><p id="e647" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">图表中一个令人惊讶的结果是，梅西右脚的表现更好。然而，这可能是因为梅西通常不会用右脚射门，但当他用右脚射门时，那是致命的(我想起了2015年UCL半决赛对阵拜仁的诺伊尔芯片)。此外，图表进一步巩固了罗纳尔多作为最佳头球之一的地位。</p><h1 id="0ec1" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">2.真实匹配分析</h1><p id="f2e4" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">到目前为止，该模型已经在受控的模拟环境中进行了评估，为了更好地评估性能，必须为真实比赛计算xG。</p><h1 id="9fe1" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">2015年《经典》——伯纳乌的闪电</h1><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es np"><img src="../Images/3357dfe330681a3f8eca47b3c852dd98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MHmlHruYxAH_xYwv"/></div></div></figure><p id="5ff6" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">2015年11月21日，西班牙足球的巨人，巴塞罗那和皇家马德里，在圣地亚哥伯纳乌迎来了本赛季的第一场经典比赛。加泰罗尼亚人由路易斯·恩里克率领，刚刚结束了一个三冠王赛季。与此同时，皇家马德里由去年夏天任命的新教练拉法·贝尼特斯领导。尽管巴塞罗那队开始时没有莱昂内尔·梅西，但路易斯·苏亚雷斯、内马尔和安德烈斯·伊涅斯塔等其他球员完全控制了比赛，并带领巴塞罗那队以4比0大胜，为连续两次成为西甲冠军铺平了道路。</p><p id="7256" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">比赛中尝试的射门总结在表2中。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nq"><img src="../Images/ecdcde1a85d9f196c950cbacfc16166a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iDUO8V2CXFUw1M305JH50w.png"/></div></div><figcaption class="mw mx et er es my mz bd b be z dx">Table 2: Shots in the match (Only shots with xG_BN &gt; 0.1 are included)</figcaption></figure><p id="1e5a" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">然后使用逻辑回归和贝叶斯网络模型计算每个镜头的xG。</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nr"><img src="../Images/c3f101cb1aba11ab43722cddadd64544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AQeSi1x1h0ZMsrsPkbehqQ.png"/></div></div><figcaption class="mw mx et er es my mz bd b be z dx">Table 3: xG predicted by Logistic Regression and Bayesian Network</figcaption></figure><p id="92f7" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">其中两种模型预测的总xG为—</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es ns"><img src="../Images/1a35707dcac8a55c07c9c03293cb273c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fQf1ztJYI6k8stwM_h066g.png"/></div></div><figcaption class="mw mx et er es my mz bd b be z dx">Table 4: xGpredicted by Logistic Regression and Bayesian Network</figcaption></figure><p id="e8ed" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">从表4中可以看出，贝叶斯网络模型比给定的数据好得多，逻辑回归分类器严重高估了xG。事实上，考虑到数据的限制以及我们忽略了角球、任意球等的事实，贝叶斯网络表现得非常好。</p></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><h1 id="9aa8" class="if ig hi bd ih ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc bi translated">结论</h1><p id="c7d9" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在这个项目中，实现了一个贝叶斯网络来计算射门成为进球的概率，给出了射门背后的上下文信息。逻辑回归也是使用作为上述模型基线的相同特征来实现的。</p><p id="0468" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">该模型用于比较玩家的表现，并在现实世界中使用，发现其表现比逻辑回归模型好得多。尽管使用的数据少得多，但该值也接近足球分析师预测的文献值，这就提出了在更大的数据集上应用贝叶斯网络的有趣问题。</p></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><h1 id="9cf4" class="if ig hi bd ih ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc bi translated">未来作品</h1><ol class=""><li id="896c" class="nt nu hi jf b jg jh jk jl jo nv js nw jw nx ka ny nz oa ob bi translated">相同的模型可以应用于扩展数据集，这可能会导致xG指标的新标准。</li><li id="2f87" class="nt nu hi jf b jg oc jk od jo oe js of jw og ka ny nz oa ob bi translated">可以使用xG提升算法来解决类别不平衡的问题。</li><li id="ac0d" class="nt nu hi jf b jg oc jk od jo oe js of jw og ka ny nz oa ob bi translated">定位球可以单独考虑，也可以与开放式比赛目标一起考虑。</li><li id="f62c" class="nt nu hi jf b jg oc jk od jo oe js of jw og ka ny nz oa ob bi translated">除了理论工作，现有的模型可以用来回答很多实际问题，只受你想象力的限制。</li></ol><p id="a34a" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">作为注脚，这个项目用的代码已经上传到Github上了。任何感兴趣的人都可以公开查阅。</p><p id="965e" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">Github链接:<a class="ae nf" href="https://github.com/Aranya3003/FootballXg" rel="noopener ugc nofollow" target="_blank">https://github.com/Aranya3003/FootballXg</a></p></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><h1 id="e0ec" class="if ig hi bd ih ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc bi translated">附录</h1><h2 id="bc39" class="kn ig hi bd ih ko kp kq il kr ks kt ip jo ku kv it js kw kx ix jw ky kz jb la bi translated">基于约束的结构学习</h2><p id="0428" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">贝叶斯网络中的结构学习指的是学习数据中隐藏的条件依赖。它的计算复杂度在最坏的情况下在节点数量上是超指数级的，在大多数真实世界场景下是多项式级的。有广泛的三种方法用于学习贝叶斯网络的结构，基于<em class="nb">约束、基于</em>分数和<em class="nb">混合</em>算法。在这个项目中，使用了基于约束的结构学习。</p><p id="98be" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">所有基于约束的结构学习算法共享下面给出的公共三阶段结构</p><p id="18c0" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated"><strong class="jf hj">第一阶段:学习马克诺维克毛毯</strong></p><ol class=""><li id="3afe" class="nt nu hi jf b jg mq jk mr jo oh js oi jw oj ka ny nz oa ob bi translated">对于每个变量X，学习它的马尔可夫毯B(X)。节点的马尔可夫链是指全部可用节点的子集，它包含关于该节点的所有有用信息。</li><li id="c780" class="nt nu hi jf b jg oc jk od jo oe js of jw og ka ny nz oa ob bi translated">检查马尔可夫链的对称性。如果X属于B(Y)，那么Y必定属于B(X)。所有非对称节点都从各自的马尔可夫链中删除。</li></ol><p id="5e4c" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated"><strong class="jf hj">第二阶段:学习邻居</strong></p><ol class=""><li id="ae61" class="nt nu hi jf b jg mq jk mr jo oh js oi jw oj ka ny nz oa ob bi translated">对于每个变量X，学习它的邻居的集合N (X)(即X的父母和孩子)。等价地，对于每一对X，Y，搜索所有节点的子集，给定该子集中的任何节点，X和Y是独立的。如果不存在这样的子集，那么X和Y由一条弧连接。</li><li id="7b22" class="nt nu hi jf b jg oc jk od jo oe js of jw og ka ny nz oa ob bi translated">检查网络的对称性，类似于步骤2。</li></ol><p id="07d2" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated"><strong class="jf hj">阶段3:学习圆弧方向</strong></p><ol class=""><li id="2c87" class="nt nu hi jf b jg mq jk mr jo oh js oi jw oj ka ny nz oa ob bi translated">对于每一对具有共同邻居Z的不相邻变量X和Y，检查X和Y是否独立于给定的Z，如果不独立，则设置弧线X-Z和Z-Y的方向以获得V-结构V = {X → Z← Y}。</li><li id="6fd8" class="nt nu hi jf b jg oc jk od jo oe js of jw og ka ny nz oa ob bi translated">如果X与Y相邻，并且从X到Y有一条严格定向的路径(从X到Y的路径不包含无向弧)，则将X-Y的方向设置为X → Y。</li><li id="8455" class="nt nu hi jf b jg oc jk od jo oe js of jw og ka ny nz oa ob bi translated">如果X和Y不相邻，但X → Z和Z Y相邻，则将后者改为Z → Y。</li></ol><h2 id="519b" class="kn ig hi bd ih ko kp kq il kr ks kt ip jo ku kv it js kw kx ix jw ky kz jb la bi translated"><strong class="ak">使用贝叶斯估计的参数学习</strong></h2><p id="af66" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">贝叶斯参数估计(BPE)是一种广泛使用的技术，用于估计参数未知的随机变量的概率密度函数。假设我们有一个随机变量X，它的分布取决于未知参数θ。在Bayes参数估计中，参数θ被视为服从分布p(θ)的随机变量或随机向量。在贝叶斯估计中，给定数据的θ的概率是最大的，即p(θ|S)。根据贝叶斯定理，</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es ok"><img src="../Images/74f8a27b52988a5fcedcfe8dc7cc5546.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*G2r3HaNsR7HXHtbmde6asg.png"/></div></figure><p id="1864" class="pw-post-body-paragraph jd je hi jf b jg mq ji jj jk mr jm jn jo ms jq jr js mt ju jv jw mu jy jz ka hb bi translated">其中p(θ)是先验概率，p(S|θ)是似然性。</p></div></div>    
</body>
</html>