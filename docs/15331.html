<html>
<head>
<title>Visualizing Airline Data with Cube.js, BigQuery and Chart.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Cube.js、BigQuery和Chart.js可视化航空公司数据</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/visualizing-airline-data-with-cube-js-bigquery-and-chart-js-8866a09972a2?source=collection_archive---------6-----------------------#2022-10-26">https://medium.com/geekculture/visualizing-airline-data-with-cube-js-bigquery-and-chart-js-8866a09972a2?source=collection_archive---------6-----------------------#2022-10-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/c6532821264e7e20965c1c17fc9e0645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ih0CxDg0o4x8ZyH24sRWnA.png"/></div></div></figure><div class=""/><p id="2dae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可视化或表示您的数据是添加到项目优先级列表中的一个非常重要的项目，因为我们可以更清晰地了解图形、图表等形式的信息，有了它，不仅可以帮助我们解释大块数据，还可以帮助我们分析数据的趋势和模式。</p><p id="188c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为权力越大，责任越大！我们将通过利用一些惊人的工具使我们的生活变得更容易，这些工具可以将我们的开发时间减少到仅仅几分钟。</p><p id="3bce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程中，我们将学习:</p><ul class=""><li id="da8a" class="jo jp ht is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">我们如何在Google的BigQuery上设置我们自己的自定义数据，而不需要任何额外的成本</li><li id="2832" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">了解如何连接Cube.js，为我们提供BigQuery和我们的前端应用程序之间的后端支持</li><li id="c974" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">添加Chart.js作为依赖项，在Web前端构建漂亮的可视化效果</li></ul></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h1 id="3c75" class="kj kk ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">什么是Google BigQuery？</h1><p id="5835" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">BigQuery是一个企业数据仓库，它通过使用Google基础设施的处理能力实现超快速的SQL查询来解决这个问题。它是无服务器的，意味着存储数据更便宜，扩展数据更快。BigQuery能够以很低的成本快速处理大量T2数据。除此之外，它还具有内置的集成，使得在BigQuery中构建一个<strong class="is hu">数据湖</strong>变得简单、快速且经济高效。</p><p id="79b3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">集中您的数据，以允许与谷歌云的机器学习工具自动集成，获得高级数据科学报告。它还与Data Studio一键式集成，这意味着可视化处理后的表既简单又快速。像DataFlow和DataProc这样的ETL解决方案减少了数据转换的开销。</p><p id="0dbd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">BigQuery还有一个免费使用层:在最初的90天里，你每月可以获得高达1 TB的已处理数据和一些免费积分，用于在谷歌云上消费。</p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h1 id="eca1" class="kj kk ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">在BigQuery上设置航空公司分析数据</h1><p id="492e" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">尽管BigQuery为我们提供了大量免费的公共数据集，对谷歌云用户没有任何限制，但在本教程中，我们将使用我们自己的数据集。</p><p id="fbd8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要开始，请访问<a class="ae ln" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云控制台</a>，如果您还没有帐户，请创建一个帐户。创建帐户后，访问<a class="ae ln" href="https://console.cloud.google.com/projectcreate" rel="noopener ugc nofollow" target="_blank">新项目创建页面</a>并创建一个新项目，在该项目中我们将拥有航空公司分析数据集。</p><p id="cefa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完成基本设置后，建议<a class="ae ln" href="https://console.cloud.google.com/iam-admin/serviceaccounts/create" rel="noopener ugc nofollow" target="_blank">创建一个服务帐户</a>来限制您的API运行工作负载和添加验证的权限。创建服务帐户时，您需要为其指定角色，对数据集进行读访问所需的两个角色是<code class="du lo lp lq lr b">BigQuery Data Viewer</code>和<code class="du lo lp lq lr b">BigQuery Job User</code>。完成后，最后一步是向这个新创建的用户添加一个身份验证密钥。点击右侧<code class="du lo lp lq lr b">Actions</code>下的<code class="du lo lp lq lr b">...</code>按钮，选择<code class="du lo lp lq lr b">Manage keys</code>。从这个部分添加一个新的JSON键，它会自动下载到您的本地系统中。一定要保管好，不要弄丢了。</p><p id="36b9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在您已经完成了创建和读取BigQuery数据集所需的所有配置，是时候从<a class="ae ln" href="https://tmpfiles.org/7359/airlines.csv" rel="noopener ugc nofollow" target="_blank">这里</a>实际下载航空公司数据集了。</p><p id="f38b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下载完成后，访问<a class="ae ln" href="https://console.cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank"> BigQuery仪表板</a>并在浏览器中点击您的项目ID。在右边展开的部分，您会看到一个<code class="du lo lp lq lr b">Create Dataset</code>选项。选择该选项，并提供数据集ID给你想要命名的数据集，最好将其命名为<code class="du lo lp lq lr b">airline</code>以更好地识别它，保留其他设置为默认，仅在需要时调整它。</p><p id="886e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您将能够在explorer部分看到新创建的空数据集，关注刚刚创建的新空数据集，并单击<code class="du lo lp lq lr b">+</code>图标向其添加表。点击后，您将能够看到<code class="du lo lp lq lr b">Create table</code>选项，从源下拉列表中选择<code class="du lo lp lq lr b">Upload</code>作为首选项，并上传您下载的CSV航空公司数据集。交叉检查项目名称和数据集名称是否设置为您新创建的项目。给表格命名，点击底部的蓝色按钮<code class="du lo lp lq lr b">Create table</code>，完成表格创建。</p><p id="e142" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就这样，你的数据都设置好了。</p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h1 id="1e1d" class="kj kk ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">使用Cube.js引导您的项目</h1><p id="cdd0" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">既然我们在BigQuery中有了数据集，我们就需要能够使用这些数据，这意味着要与BigQuery和SQL查询直接交互。SQL没有错；这是一种很棒的特定于领域的语言，但是让SQL查询遍布于您的代码库听起来像是一种泄漏的抽象——您的应用层将知道您的数据库中的列名和数据类型。</p><p id="cba8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了改进这一点，我们将使用Cube.js作为我们选择的开源分析API平台。Cube.js提供了一种称为“语义层”或“数据模式”的抽象，它封装了特定于数据库的东西，为您生成SQL查询，并允许您使用高级的、特定于域的标识符来处理数据。</p><p id="2371" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">导航到您的项目目录，使用Cube.js引导您的项目，以安装所有必要的驱动程序和分析依赖项，并连接数据库</p><pre class="ls lt lu lv fd lw lr lx ly aw lz bi"><span id="0a21" class="ma kk ht lr b fi mb mc l md me">npx cubejs-cli create airline-analysis -d bigquery</span></pre><p id="da9a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Cube.js利用Cube.js CLI创建带有-d标志的新项目，以连接相应的数据库。这里是cube.js支持的数据库的列表<a class="ae ln" href="https://cube.dev/docs/connecting-to-the-database" rel="noopener ugc nofollow" target="_blank">和</a>。在引导的同时，它还会创建一个<code class="du lo lp lq lr b">.env</code>文件，其中包含后端所需的项目配置，包括数据库类型、项目id、项目环境等。</p><p id="8fe2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是我们的BigQuery项目的<code class="du lo lp lq lr b">.env</code>文件的样子。</p><pre class="ls lt lu lv fd lw lr lx ly aw lz bi"><span id="84ea" class="ma kk ht lr b fi mb mc l md me">CUBEJS_DB_BQ_PROJECT_ID=PROJECT_ID<br/>CUBEJS_DB_BQ_KEY_FILE=key.json<br/>CUBEJS_DEV_MODE=true<br/>CUBEJS_DB_TYPE=bigquery<br/>CUBEJS_API_SECRET=SECRET</span></pre><p id="1a1c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将你的<code class="du lo lp lq lr b">PROJECT_ID</code>替换为谷歌云平台新创建的项目ID，点击页面顶部的项目切换按钮即可找到。此外，将先前下载到您系统中的服务帐户密钥复制到您的项目文件夹中，并将其重命名为<code class="du lo lp lq lr b">key.json</code>以便于理解。</p><p id="852e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本地运行Cube.js后端服务，在控制台中键入以下内容<em class="lm">(确保导航到根项目目录)</em></p><pre class="ls lt lu lv fd lw lr lx ly aw lz bi"><span id="a715" class="ma kk ht lr b fi mb mc l md me">npm run dev</span></pre><blockquote class="mf mg mh"><p id="d5cb" class="iq ir lm is b it iu iv iw ix iy iz ja mi jc jd je mj jg jh ji mk jk jl jm jn hb bi translated">您会注意到一条消息，指明服务器默认运行在localhost:4000上。继续操作并打开它以查看您的数据集以及Cube.js开发人员游乐场。</p></blockquote><h1 id="1a07" class="kj kk ht bd kl km ml ko kp kq mm ks kt ku mn kw kx ky mo la lb lc mp le lf lg bi translated">定义数据模式</h1><p id="f361" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">数据模式是对数据的特定于领域的高级描述，我们需要首先定义我们的数据模式，以便浏览数据。使用数据模式，您不需要编写SQL查询，而是依赖于Cube.js查询生成引擎，这使得处理数据更加容易。</p><p id="f183" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的数据模式将作为<code class="du lo lp lq lr b">schema/Airline.js</code>出现在<code class="du lo lp lq lr b">schema</code>文件夹中</p><figure class="ls lt lu lv fd hk"><div class="bz dy l di"><div class="mq mr l"/></div></figure><blockquote class="mf mg mh"><p id="6e3a" class="iq ir lm is b it iu iv iw ix iy iz ja mi jc jd je mj jg jh ji mk jk jl jm jn hb bi translated">如果已经手动更改，请务必将<code class="du lo lp lq lr b">sql: 'SELECT * FROM &lt;Your Dataset&gt;.&lt;Table Name&gt;'</code>更改为您自己的数据集和表格名称。</p></blockquote><p id="0ece" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个模式中，<code class="du lo lp lq lr b">measures</code>是要计算的数值，而<code class="du lo lp lq lr b">dimensions</code>是要计算度量的属性。尺寸可以有<code class="du lo lp lq lr b">string</code>或<code class="du lo lp lq lr b">time</code>类型。像<code class="du lo lp lq lr b">CAST</code>和<code class="du lo lp lq lr b">TIMESTAMP</code>这样的BigQuery函数也可以用在度量和维度中。</p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h1 id="9270" class="kj kk ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">摆弄数据可视化</h1><p id="0ae2" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">考虑到您的服务器已经在运行，您可以访问<code class="du lo lp lq lr b">localhost:4000</code>查看Cube.js开发者园地，在那里您可以找到<code class="du lo lp lq lr b">Build</code>选项卡。该选项卡包含一些令人惊叹的数据选择选项，在这些选项的顶部可以看到可视化效果，只需点击<code class="du lo lp lq lr b">Measure</code>并选择一个度量标准来测量您的数据，然后选择您想要的数量<code class="du lo lp lq lr b">Dimensions</code>，您应该能够看到/过滤您自己的可视化效果以及所有不同的选项。</p><p id="8e11" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们以Cube.js模板为基础来生成我们的前端应用程序。只需导航到<code class="du lo lp lq lr b">Dashboard</code>选项卡，选择<code class="du lo lp lq lr b">Create custom application</code>，使用React和Ant Design，并将Chart.js作为我们的图表库。创建<code class="du lo lp lq lr b">dashboard-app</code>文件夹并安装所有基本的依赖项需要几分钟时间。一旦完成，我们将添加我们自己的图表，并定制我们的前端应用程序。</p><p id="de13" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">导航到<code class="du lo lp lq lr b">dashboard-app</code>文件夹，使用以下命令启动前端服务器:</p><pre class="ls lt lu lv fd lw lr lx ly aw lz bi"><span id="a04b" class="ma kk ht lr b fi mb mc l md me">npm start</span></pre><blockquote class="mf mg mh"><p id="0ca8" class="iq ir lm is b it iu iv iw ix iy iz ja mi jc jd je mj jg jh ji mk jk jl jm jn hb bi translated">您将能够看到在localhost:3000中运行的服务器</p></blockquote><p id="52b0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的应用程序将具有以下结构</p><ul class=""><li id="1e86" class="jo jp ht is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated"><code class="du lo lp lq lr b">App</code>将成为应用程序的主控制器</li><li id="a4a8" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><code class="du lo lp lq lr b">ChartRenderer</code>将负责渲染不同的图表</li><li id="97a4" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><code class="du lo lp lq lr b">DashboardPage</code>将是主UI页面，其中包含所有图表数据<em class="lm">(该页面将调用</em> <code class="du lo lp lq lr b"><em class="lm">ChartRenderer</em></code> <em class="lm">来呈现不同类型的图表)</em></li></ul><h2 id="a45b" class="ma kk ht bd kl ms mt mu kp mv mw mx kt jb my mz kx jf na nb lb jj nc nd lf ne bi translated">App.js</h2><p id="6d54" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated"><code class="du lo lp lq lr b">App</code>组件将是主控制器，看起来像这样，我们使用<code class="du lo lp lq lr b">CubeProvider</code>在整个应用程序中提供cube.js API，以便在任何地方查询/使用数据。</p><figure class="ls lt lu lv fd hk"><div class="bz dy l di"><div class="mq mr l"/></div></figure><h2 id="65e6" class="ma kk ht bd kl ms mt mu kp mv mw mx kt jb my mz kx jf na nb lb jj nc nd lf ne bi translated">仪表板页面</h2><p id="da02" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">对于这个示例应用程序，我将仪表板划分为网格，以显示<code class="du lo lp lq lr b">Line</code>、<code class="du lo lp lq lr b">Area</code>、<code class="du lo lp lq lr b">Pie</code>图形和<code class="du lo lp lq lr b">Table</code>。因此，我们可以使用蚂蚁设计的网格来实现这一点。</p><figure class="ls lt lu lv fd hk"><div class="bz dy l di"><div class="mq mr l"/></div></figure><h2 id="a7f5" class="ma kk ht bd kl ms mt mu kp mv mw mx kt jb my mz kx jf na nb lb jj nc nd lf ne bi translated">呈现图表</h2><p id="4204" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated"><code class="du lo lp lq lr b">ChartRenderer</code>组件负责呈现您的图表，在本例中，我将向您展示仅呈现折线图类型的代码，以使其简单易懂。</p><p id="ead7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lo lp lq lr b">WhichQueryRenderer</code>实用程序找出图表类型，并返回带有适当的<code class="du lo lp lq lr b">measures</code>和<code class="du lo lp lq lr b">dimensions</code>的特定查询。它在内部使用从Chart.js中呈现折线图的<code class="du lo lp lq lr b">renderChart</code>方法。我们将它<code class="du lo lp lq lr b">labels</code>和<code class="du lo lp lq lr b">datasets</code>作为从查询中获得的<code class="du lo lp lq lr b">resultSet</code>的参数传递。</p><figure class="ls lt lu lv fd hk"><div class="bz dy l di"><div class="mq mr l"/></div></figure><p id="d6ca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就这样，我们准备在仪表板中查看我们的第一个折线图。</p><blockquote class="mf mg mh"><p id="fbb1" class="iq ir lm is b it iu iv iw ix iy iz ja mi jc jd je mj jg jh ji mk jk jl jm jn hb bi translated">确保从<code class="du lo lp lq lr b">DashboardPage</code>组件中移除其他图表类型及其网格。</p></blockquote><p id="27de" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用相同的图表呈现器组件来查询更多的图表类型，并将图表提供给DashboardPage组件，该组件将在UI中呈现它们。</p><p id="ed39" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">GitHub上有<a class="ae ln" href="https://github.com/S-ayanide/Airline-Analysis" rel="noopener ugc nofollow" target="_blank">的完整源代码</a>。</p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h1 id="588b" class="kj kk ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">结论</h1><p id="74aa" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hb bi translated">如果我错过了任何一点，或者你想讨论什么，请在下面留下评论，我会尽快加入。🌟</p><p id="6816" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，感谢您能深入到本文中，并对React表现出兴趣。你很了不起，每天都在做出积极的改变。再见。✌🏼</p></div></div>    
</body>
</html>