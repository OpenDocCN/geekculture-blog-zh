<html>
<head>
<title>C#9.0 Pattern Matching in Switch Expression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">C#9.0开关表达式中的模式匹配</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/c-9-0-pattern-matching-in-switch-expression-b84a9daef16a?source=collection_archive---------3-----------------------#2021-05-11">https://medium.com/geekculture/c-9-0-pattern-matching-in-switch-expression-b84a9daef16a?source=collection_archive---------3-----------------------#2021-05-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="354d" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">开始使用模式组合子构建高效的算法</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/020f7f4420da6d89e2cf23f7da26c679.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kz77FG4Q5qsjOUMvAS7IeA.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@maxcodes?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Maxwell Nelson</a> on <a class="ae jn" href="https://unsplash.com/s/photos/c%23?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="aa06" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">C# 9带来了许多激动人心的<a class="ae jn" href="https://docs.microsoft.com/en-gb/dotnet/csharp/whats-new/csharp-9" rel="noopener ugc nofollow" target="_blank">特性和语言增强</a>。在本文中，我们将详细探讨使用开关表达式和模式组合符的新模式匹配。</p><h2 id="5b2c" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">先决条件</h2><p id="ca62" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">首先，请安装<a class="ae jn" href="https://dot.net/get-dotnet5" rel="noopener ugc nofollow" target="_blank">。NET 5 </a>(如果你还没有的话)，因为它包含了C# 9编译器。</p><h2 id="a152" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">模式匹配—它是什么？</h2><p id="0d50" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">这是一种帮助你识别表达式是否具有某些特征的技术。它非常适合处理不相关系统中的对象以及处理来自多个数据源的数据的情况。</p><p id="1c1e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">模式匹配最初是在C# 7中使用“is表达式”和“switch语句”引入的。在新版本中，这些功能得到了扩展。</p><h2 id="ea1f" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated"><strong class="ak">申报模式:</strong></h2><p id="375f" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">考虑以下代码:</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="7201" class="kk kl hi ll b fi lp lq l lr ls">int? result= 100; </span><span id="933b" class="kk kl hi ll b fi lt lq l lr ls">if(result is int number)<br/>{</span><span id="97ab" class="kk kl hi ll b fi lt lq l lr ls">Console.WriteLine( $”The Result has value {number}”);<br/>}</span><span id="bccc" class="kk kl hi ll b fi lt lq l lr ls">else</span><span id="3622" class="kk kl hi ll b fi lt lq l lr ls">{ Console.WriteLine(“Result is null”); }</span></pre><p id="09bc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">它使用<strong class="jq hj">声明模式，(</strong>简单地检查一个表达式的类型是否与给定的类型相匹配)并测试变量结果是否为整数类型，如果为真，则将它赋给变量‘number’。</p><h2 id="3bce" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated"><strong class="ak">逻辑模式:</strong></h2><p id="d48f" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">在C#9.0中，通过将“is”运算符与“not”模式结合使用，可以使用它来检查空引用值:</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="b638" class="kk kl hi ll b fi lp lq l lr ls">string? result = "This is not null string";</span><span id="19ca" class="kk kl hi ll b fi lt lq l lr ls">if(result is not null)<br/>{<br/>   Console.WriteLine(result);<br/>}</span></pre><p id="d50c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">和'，'或'是C#9.0中新的模式组合子，可用于创建逻辑模式。</p><h2 id="e49d" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated"><strong class="ak">C # 9.0中的关系模式和模式组合子</strong></h2><p id="6d08" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">关系模式允许您将表达式结果与常量(可以是int、float、char或enum类型)进行比较。它使用类似于、&lt; = or &gt; =的关系操作符。它可以与“and”模式结合使用，以检查某个值是否在某个范围内。</p><p id="1451" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在下面的示例中，我们创建了检查血氧饱和度值的方法，并确定是否需要任何医疗干预。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="ed7a" class="kk kl hi ll b fi lp lq l lr ls">static string FindOxygenSaturation(int saturation) =&gt;</span><span id="abbd" class="kk kl hi ll b fi lt lq l lr ls">saturation switch</span><span id="1b55" class="kk kl hi ll b fi lt lq l lr ls">{</span><span id="a5c1" class="kk kl hi ll b fi lt lq l lr ls">&gt;= 95 =&gt; "Normal, no significant intervention needed",</span><span id="f211" class="kk kl hi ll b fi lt lq l lr ls">91 or 92 or 93 =&gt; "Keep monitoring",</span><span id="6e69" class="kk kl hi ll b fi lt lq l lr ls">&gt;= 85 and &lt;= 93 =&gt; "Initiate oxygen therapy",</span><span id="ef31" class="kk kl hi ll b fi lt lq l lr ls">&lt;85 and &gt;0 =&gt; "Severly Hypoxic! Administer supplemental oxygen immediately",</span><span id="f3bf" class="kk kl hi ll b fi lt lq l lr ls">_ =&gt; throw new ArgumentOutOfRangeException(nameof(saturation),$"Invalid value:{saturation}"),</span><span id="33e5" class="kk kl hi ll b fi lt lq l lr ls">};</span></pre><p id="9c61" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以看到如何使用“and”模式来检查血氧饱和度值是否在85到93的范围内。</p><p id="4f60" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">析取or模式可用于我们希望将输入与任一模式进行比较的情况。在上面的例子中，如果氧饱和度等于91、92或93，它将返回“保持监测”。</p><h2 id="a20c" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated"><strong class="ak">开关表达式:</strong></h2><p id="9e93" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">您还可以注意到，上面的示例使用了“switch expression ”,而不是带有case块的经典switch语句。(它是在C#8.0中引入的，使开发人员能够使用更简洁的语法，并避免重复的关键字，如case和break，使其更具可读性)。</p><p id="0b0f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">开关表达式的基本元素如下:</p><ul class=""><li id="ab53" class="lu lv hi jq b jr js ju jv jx lw kb lx kf ly kj lz ma mb mc bi translated">一个表达式，后跟switch关键字，在上面的例子中是“saturation”方法参数。</li><li id="09dc" class="lu lv hi jq b jr md ju me jx mf kb mg kf mh kj lz ma mb mc bi translated">开关表达式臂由逗号分隔，并包含一个模式、一个= &gt;标记和一个表达式。</li></ul><p id="b4ce" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">它还使用一种使用下划线(_)的丢弃模式来处理与任何表达式都不匹配的任何整数值。</p><h2 id="4655" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated"><strong class="ak">护箱</strong></h2><p id="c076" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">switch表达式可能包含一个可选的“大小写保护”,可以在模式本身不够用的情况下使用。</p><p id="3d30" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">例如，可以在OxygenSaturation示例中添加以下开关表达式，以便仅在值不超过int.MinValue时检查零。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="2250" class="kk kl hi ll b fi lp lq l lr ls">&lt;0 when saturation &gt; int.MinValue =&gt; "Error;",</span></pre><h2 id="31ef" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated"><strong class="ak">房产模式:</strong></h2><p id="fb6c" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">它是在C# 8.0中引入的，您可以使用属性模式将表达式的属性与任何嵌套模式进行匹配。</p><p id="5002" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">例如，以下示例使用属性模式和嵌套模式来标识使用给定日期的会议日期。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="5163" class="kk kl hi ll b fi lp lq l lr ls">static bool IsMeetingDay(DateTime date) =&gt; <br/>date is { Year: 2021, Month: 5 or 6, Day: 07 or 20 or 30}</span></pre><h2 id="d6cc" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated"><strong class="ak">元组模式:</strong></h2><p id="9740" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">一些功能可能有多个输入。这就是元组模式的用武之地——它允许对多个值使用switch表达式作为“元组”。</p><p id="54c4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">著名的游戏“石头”、“布”、“剪刀”就是使用元组模式的一个很好的例子。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="750b" class="kk kl hi ll b fi lp lq l lr ls">public static string RockPaperScissors(string first, string second)</span><span id="6304" class="kk kl hi ll b fi lt lq l lr ls">=&gt; (first, second) switch</span><span id="5b20" class="kk kl hi ll b fi lt lq l lr ls">{</span><span id="24bb" class="kk kl hi ll b fi lt lq l lr ls">("rock", "paper") =&gt; "rock is covered by paper. Paper wins.",</span><span id="ccb6" class="kk kl hi ll b fi lt lq l lr ls">("rock", "scissors") =&gt; "rock breaks scissors. Rock wins.",</span><span id="11af" class="kk kl hi ll b fi lt lq l lr ls">("paper", "rock") =&gt; "paper covers rock. Paper wins.",</span><span id="4d95" class="kk kl hi ll b fi lt lq l lr ls">("paper", "scissors") =&gt; "paper is cut by scissors. Scissors wins.",</span><span id="054e" class="kk kl hi ll b fi lt lq l lr ls">("scissors", "rock") =&gt; "scissors is broken by rock. Rock wins.",</span><span id="23c2" class="kk kl hi ll b fi lt lq l lr ls">("scissors", "paper") =&gt; "scissors cuts paper. Scissors wins.",</span><span id="c03c" class="kk kl hi ll b fi lt lq l lr ls">(_, _) =&gt; "tie"</span><span id="70c0" class="kk kl hi ll b fi lt lq l lr ls">};</span></pre><p id="7c90" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">C# 9.0还增加了对带括号模式的支持，在这种模式下，你可以简单地在任何模式周围加上括号来强调或改变优先级。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="bd10" class="kk kl hi ll b fi lp lq l lr ls">char c = 't';</span><span id="0b3b" class="kk kl hi ll b fi lt lq l lr ls">if ((c is (&gt;= 'a' and &lt;= 'z') or (&gt;= 'A' and &lt;= 'Z')))</span><span id="d80c" class="kk kl hi ll b fi lt lq l lr ls">Console.WriteLine("Char is alphabet");</span></pre><p id="5435" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以看到当与模式组合一起使用时，这种模式是如何允许实施优先级的。</p><h2 id="6596" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">摘要</h2><p id="41ab" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">在本文中，我们探讨了C# 9.0是如何引入模式和模式组合子的，这些模式和模式组合子可以在switch表达式中用来构建类型驱动和数据驱动的算法，以便以高效的方式处理数据。</p></div></div>    
</body>
</html>