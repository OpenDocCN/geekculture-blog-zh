<html>
<head>
<title>Implementing a kafka consumer and kafka producer with Spring Boot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Spring Boot实现kafka消费者和kafka生产者</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/implementing-a-kafka-consumer-and-kafka-producer-with-spring-boot-60aca7ef7551?source=collection_archive---------1-----------------------#2021-05-12">https://medium.com/geekculture/implementing-a-kafka-consumer-and-kafka-producer-with-spring-boot-60aca7ef7551?source=collection_archive---------1-----------------------#2021-05-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/4df5bf4463cb1ff8993e3c57188630f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/0*2LP49I7YPRQfn2Tp.png"/></div></figure><p id="21da" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这篇文章有更多的信息<a class="ae jk" rel="noopener" href="/@mmarcosab/a-tour-of-kafka-visiting-concepts-and-implementing-applications-locally-with-spring-boot-and-40951ead996">在这里</a>，比如如何使用Python和GUI。</p><p id="1dbe" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是我的第一篇英文文章，所以我在此为最终的错误道歉。</p><p id="5cb1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">前几天我要开发一些在kafka话题中消费/生产的微服务。我决定在这里留下一些笔记，以便随时查阅。我把这篇文章分成两部分:</p><ul class=""><li id="2b96" class="jl jm hi io b ip iq it iu ix jn jb jo jf jp jj jq jr js jt bi translated">创造一个消费者；</li><li id="38c3" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">创造一个生产者；</li></ul><p id="283f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一些基本信息:<br/>我用Java编写了这段代码，使用了Springboot、Lombok、Hibernate和管理与Maven的依赖关系。</p><h1 id="ddeb" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">关于阿帕奇卡夫卡</h1><p id="5e6d" class="pw-post-body-paragraph im in hi io b ip kx ir is it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj hb bi translated"><strong class="io hj">这是什么？</strong></p><p id="60b0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是一个分布式消息和流平台。</p><p id="c450" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">它没有澄清一切，对不对？另一个问题。</p><p id="0fb4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">是为了什么？</strong></p><p id="f7b9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">它用于在不同系统之间移动和转换大量数据。</p><p id="464b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这意味着这种移动和转换可以在数据库中读取和写入，在流上具体化数据，在系统(生产者和消费者)之间发送信息等。右<a class="ae jk" href="https://kafka.apache.org/uses" rel="noopener ugc nofollow" target="_blank">这里</a>有一个卡夫卡的用例列表。</p><p id="10dc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用kafka的简单解决方案是如何工作的:</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lc"><img src="../Images/ab8a229677b4d36cb4389a9f1dd62913.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WCqR3VHYd1ovzNcHSNKqQA.png"/></div></div></figure><p id="ea3d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">生产者生成一条附加到主题的消息，消费者接收该消息并做任何必须做的事情。</p><p id="d11d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">概念:</strong></p><p id="21e7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">生产者</strong>:负责产生特定主题的消息。</p><p id="1193" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">消费者</strong>:负责阅读制作人对某个话题的留言。</p><p id="ba5d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">主题</strong>:主题是一组分类的消息。</p><p id="28df" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">消息</strong>:我认为卡夫卡所有的事件都可以用消息来概括。一个消息可以包含一个简单的文本，比如“Hello World ”,或者一个json格式的对象。</p><h2 id="23ec" class="ll ka hi bd kb lm ln lo kf lp lq lr kj ix ls lt kn jb lu lv kr jf lw lx kv ly bi translated">实现Kafka生成器:</h2><p id="5229" class="pw-post-body-paragraph im in hi io b ip kx ir is it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj hb bi translated">知识库链接:<a class="ae jk" href="https://github.com/mmarcosab/kafka-producer" rel="noopener ugc nofollow" target="_blank">https://github.com/mmarcosab/kafka-producer</a></p><p id="ff2e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对pom.xml的依赖性:</p><pre class="ld le lf lg fd lz ma mb mc aw md bi"><span id="3eef" class="ll ka hi ma b fi me mf l mg mh">&lt;dependency&gt;<br/>   &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;<br/>   &lt;artifactId&gt;kafka-streams&lt;/artifactId&gt;<br/>&lt;/dependency&gt;<br/>&lt;dependency&gt;<br/>   &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;<br/>   &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;<br/>&lt;/dependency&gt;</span></pre><p id="704e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">之后，我们必须配置应用程序。属性:</p><pre class="ld le lf lg fd lz ma mb mc aw md bi"><span id="c434" class="ll ka hi ma b fi me mf l mg mh"># Producer properties<br/>spring.kafka.producer.bootstrap-servers=127.0.0.1:9092<br/>spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer<br/>spring.kafka.producer.value-serializer=org.apache.kafka.common.serialization.StringSerializer<br/>spring.kafka.producer.group-id=group_id<br/>topic.name.producer=topico.comando.teste<br/><br/># Common Kafka Properties<br/>auto.create.topics.enable=true</span></pre><p id="c4aa" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">起初，我使用StringSerializer类来序列化消息，只是为了发送一些文本。</p><p id="c1d0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">auto.create.topics.enable = true属性自动创建注册到这些属性的主题。在这种情况下，我将topic . name . producer = topico . comando . test</p><p id="0ef6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">那我们就去看代码吧。</p><p id="ca91" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在主类中，我放置了注释“@ EnableKafka”，这使得连接到一个主题成为可能。</p><pre class="ld le lf lg fd lz ma mb mc aw md bi"><span id="be52" class="ll ka hi ma b fi me mf l mg mh">@EnableKafka<br/>@SpringBootApplication<br/>public class DemoApplication {<br/><br/>    public static void main(String[] args) {<br/>        SpringApplication.run(DemoApplication.class, args);<br/>    }<br/><br/>}</span></pre><p id="217d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">还有我的制片人班</p><pre class="ld le lf lg fd lz ma mb mc aw md bi"><span id="600f" class="ll ka hi ma b fi me mf l mg mh">@Slf4j<br/>@Service<br/>@RequiredArgsConstructor<br/>public class TopicProducer {<br/><br/>    @Value("${topic.name.producer}")<br/>    private String topicName;<br/><br/>    private final KafkaTemplate&lt;String, String&gt; kafkaTemplate;<br/><br/>    public void send(String message){<br/>        log.info("Payload enviado: {}", message);<br/>        kafkaTemplate.send(topicName, message);<br/>    }<br/><br/>}</span></pre><p id="413e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">KafkaTemplate类是向主题发送消息的类，第一个字符串是主题，第二个是信息的类型。</p><p id="efc9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，我创建了一个控制器来进行测试:</p><pre class="ld le lf lg fd lz ma mb mc aw md bi"><span id="d515" class="ll ka hi ma b fi me mf l mg mh">@RequiredArgsConstructor<br/>@RestController<br/>@RequestMapping(value = "/kafka")<br/>public class KafkaController {<br/>    private final TopicProducer topicProducer;<br/>    @GetMapping (value = "/send")<br/>    public void send(){<br/>        topicProducer.send("Mensagem de teste enviada ao tópico");<br/>    }<br/>}</span></pre><p id="b1cf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">简单来说就是这样。</p><h2 id="b956" class="ll ka hi bd kb lm ln lo kf lp lq lr kj ix ls lt kn jb lu lv kr jf lw lx kv ly bi translated">实现消费者卡夫卡:</h2><p id="0a60" class="pw-post-body-paragraph im in hi io b ip kx ir is it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj hb bi translated">知识库链接:<a class="ae jk" href="https://github.com/mmarcosab/kafka-consumer" rel="noopener ugc nofollow" target="_blank">https://github.com/mmarcosab/kafka-consumer</a></p><p id="fe1b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对pom.xml的依赖性:</p><pre class="ld le lf lg fd lz ma mb mc aw md bi"><span id="9762" class="ll ka hi ma b fi me mf l mg mh">&lt;dependency&gt;<br/>   &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;<br/>   &lt;artifactId&gt;kafka-streams&lt;/artifactId&gt;<br/>&lt;/dependency&gt;<br/>&lt;dependency&gt;<br/>   &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;<br/>   &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;<br/>&lt;/dependency&gt;</span></pre><p id="4e76" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">之后，我们必须配置应用程序。属性:</p><pre class="ld le lf lg fd lz ma mb mc aw md bi"><span id="f64f" class="ll ka hi ma b fi me mf l mg mh"># Kafka Consumer properties<br/>spring.kafka.consumer.bootstrap-servers=127.0.0.1:9092<br/>spring.kafka.consumer.group-id=group_id<br/>spring.kafka.consumer.auto-offset-reset=earliest<br/>spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer<br/>spring.kafka.consumer.value-deserializer=org.apache.kafka.common.serialization.StringDeserializer<br/>topic.name.consumer=topico.teste</span></pre><p id="ba34" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里我有与生产者相同的观察:StringDeserialize用于处理文本和auto.create.topics.enable = true。</p><p id="89ae" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在主类中，我放置了注释“@ EnableKafka”，这使得连接到一个主题成为可能。</p><pre class="ld le lf lg fd lz ma mb mc aw md bi"><span id="eda3" class="ll ka hi ma b fi me mf l mg mh">@EnableKafka<br/>@SpringBootApplication<br/>public class DemoApplication {</span><span id="4aa4" class="ll ka hi ma b fi mi mf l mg mh">    public static void main(String[] args) {<br/>        SpringApplication.run(DemoApplication.class, args);<br/>    }</span><span id="5880" class="ll ka hi ma b fi mi mf l mg mh">}</span></pre><p id="1bdc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">消费者类看起来是这样的:</p><pre class="ld le lf lg fd lz ma mb mc aw md bi"><span id="46c9" class="ll ka hi ma b fi me mf l mg mh">@Slf4j<br/>@RequiredArgsConstructor<br/>@Service<br/>public class TopicListener {<br/><br/>    @Value("${topic.name.consumer")<br/>    private String topicName;<br/><br/>    @KafkaListener(topics = "${topic.name.consumer}", groupId = "group_id")<br/>    public void consume(ConsumerRecord&lt;String, String&gt; payload){<em class="mj">log</em>.info("Tópico: {}", topicName);<br/>        <em class="mj">log</em>.info("key: {}", payload.key());<br/>        <em class="mj">log</em>.info("Headers: {}", payload.headers());<br/>        <em class="mj">log</em>.info("Partion: {}", payload.partition());<br/>        <em class="mj">log</em>.info("Order: {}", payload.value());<br/><br/>    }<br/><br/>}</span></pre><p id="877e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">很简单，注释“@ KafkaListener”允许连接到一个主题来接收消息。</p><p id="1788" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">运行项目时，只需调用生产者项目上的测试控制器，您就可以在日志中看到结果:</p><p id="2709" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">监制:</strong></p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es mk"><img src="../Images/79c7a4451c202e2de843bf3c1895c082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*w-WBaRWVmXn_MPyE.png"/></div></div></figure><p id="79f2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">消费者:</strong></p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es ml"><img src="../Images/ab9de31bf09384b1f15164979aa073a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xNXi7VOkDcyEhX-e.png"/></div></div></figure><p id="2773" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">成功了。</p><figure class="ld le lf lg fd ij er es paragraph-image"><div class="er es mm"><img src="../Images/0e8455938ed31ecf4e9a3a04c479d4a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/0*MymHlWaaO6lRw1Ih.gif"/></div></figure></div></div>    
</body>
</html>