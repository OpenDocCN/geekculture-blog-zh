<html>
<head>
<title>Step-By-Step Guide to Creating a Twitter Clone With React and Supabase — Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React和Supabase创建Twitter克隆的分步指南——第3部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/step-by-step-guide-to-creating-a-twitter-clone-with-react-and-supabase-part-3-1c7ece96b77b?source=collection_archive---------23-----------------------#2021-05-02">https://medium.com/geekculture/step-by-step-guide-to-creating-a-twitter-clone-with-react-and-supabase-part-3-1c7ece96b77b?source=collection_archive---------23-----------------------#2021-05-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/697748de4b0e29c122882e75592212d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*v7Kx2qStiEfYIYr5.png"/></div></div></figure><p id="a5ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">大家好，欢迎来到用React和<a class="ae jo" href="https://supabase.io/" rel="noopener ugc nofollow" target="_blank"> Supabase </a>创建Twitter克隆的第3部分！到本系列结束时，我们将部署一个全功能的应用程序，让用户:</p><ul class=""><li id="7824" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">在推特上发布他们的想法，</li><li id="1bc1" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">上传头像并更改其个人资料，</li><li id="8f89" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">当有新的推文时被通知，并且；</li><li id="e989" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">当有人喜欢他们的推文时得到通知。</li></ul><p id="c2f8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<a class="ae jo" rel="noopener" href="/geekculture/a-step-by-step-guide-to-creating-a-twitter-clone-with-react-and-supabase-part-2-43fd11558fc1">第2部分</a>中，我们已经有了一个非常基本的用户认证流程。在第3部分中，我们将:</p><ol class=""><li id="bec4" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn kd jv jw jx bi translated">用材质UI让东西更漂亮。</li><li id="8739" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated">添加一个在用户登录或注销时刷新的导航栏。</li><li id="0378" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated">添加一个错误页面、一个“确认注册”页面和一个“编辑个人资料”页面。</li><li id="5fb1" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated">更新“编辑配置文件”页面以加载现有配置文件(如果存在)。</li></ol><h2 id="a322" class="ke kf hi bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky bi translated">改变节奏</h2><p id="1f76" class="pw-post-body-paragraph iq ir hi is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated">在我们开始之前，我想让你知道，我将<em class="le">改变本指南的节奏，让它快一点</em>。我已经在之前的帖子中列出并解释了每一步。这种方法花了很多时间来编写(这也是第3部分延迟这么久的原因之一),并且使得帖子太长而没有太多价值。</p><p id="9940" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我不会解释每一步，而是提供一个到每一步的git提交的链接(这样你就可以看到所有的细节了)，并写一些有趣的部分，重点放在Supabase的特性上。这将使个别部分更有用，涵盖更多有趣的主题。我也(希望)能够写得更快！</p><p id="6210" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们开始吧！🏃‍♀️</p><h1 id="9c2a" class="lf kf hi bd kg lg lh li kk lj lk ll ko lm ln lo kr lp lq lr ku ls lt lu kx lv bi translated">让东西更漂亮</h1><p id="22b8" class="pw-post-body-paragraph iq ir hi is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated">在<a class="ae jo" href="https://github.com/horizon0708/react-twitter-clone-follow-along/commit/a0a684c23f5837aa2c8c214080bf61ac1089b049?branch=a0a684c23f5837aa2c8c214080bf61ac1089b049&amp;diff=split" rel="noopener ugc nofollow" target="_blank">这个提交</a>中，我已经使登录、注册和退出页面更加漂亮和一致。大部分是修饰性的改变，但也有一些有趣的部分。</p><h2 id="37db" class="ke kf hi bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky bi translated">在样式化组件中使用CSSchild组合子</h2><p id="8469" class="pw-post-body-paragraph iq ir hi is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated">使用CSS，您可以选择所有带有<a class="ae jo" href="https://developer.mozilla.org/en-US/docs/Web/CSS/Child_combinator" rel="noopener ugc nofollow" target="_blank">子组合符</a>的<code class="du lw lx ly lz b">div</code>的直接子，如下所示:</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="703a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以对JSS做同样的事情。你只需要使用<code class="du lw lx ly lz b">&amp;</code>来引用父元素。我用它来让我的表单中所有的<code class="du lw lx ly lz b">div</code>都有边距。</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><h2 id="890b" class="ke kf hi bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky bi translated">使用URLSearchParams获取查询字符串</h2><p id="a736" class="pw-post-body-paragraph iq ir hi is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated">假设您有一个URL，带有类似于<code class="du lw lx ly lz b">https://localhost:3000/signin?redirectUri=/profile</code>的查询参数，并且想要获取查询字符串。如果不必支持IE11，可以使用<a class="ae jo" href="https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams" rel="noopener ugc nofollow" target="_blank"> URLSearchParams </a>。在下面的代码片段中，我用它来获取“redirectUri”查询字符串。</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><h2 id="6044" class="ke kf hi bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky bi translated">使用React路由器链接和MateriL UI的链接</h2><p id="6644" class="pw-post-body-paragraph iq ir hi is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated">你需要使用React Router的Link组件在路由之间导航而不需要整页加载，但是Material UI也有Link组件！谢天谢地，<a class="ae jo" href="https://material-ui.com/guides/composition/#link" rel="noopener ugc nofollow" target="_blank"> Material UI的Link组件可以拿一个组件当道具</a>。</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="c1c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有了这些变化，我们的形式看起来更好一点now✨.</p><figure class="ma mb mc md fd ij er es paragraph-image"><div class="er es mg"><img src="../Images/64a39fb5c27f3674102ea99181e42b33.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*BIpNHi54VyEGIVggEaICmg.png"/></div></figure><p id="14a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">目前，我们只能通过在地址栏中键入路线来在路线之间导航。接下来让我们添加一个导航条来解决这个问题。</p><h1 id="26d7" class="lf kf hi bd kg lg lh li kk lj lk ll ko lm ln lo kr lp lq lr ku ls lt lu kx lv bi translated">添加导航栏</h1><p id="2944" class="pw-post-body-paragraph iq ir hi is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated">在<a class="ae jo" href="https://github.com/horizon0708/react-twitter-clone-follow-along/commit/6fbd353cf24fca8654aa90ce6704b145bcd1a714" rel="noopener ugc nofollow" target="_blank">这个提交</a>中，我做了两件事:</p><ol class=""><li id="5ade" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn kd jv jw jx bi translated">创建一个新的navbar组件，并将其添加到react-router-dom的<code class="du lw lx ly lz b">&lt;Switch /&gt;</code>组件之外，这样它将在每条路由中呈现。</li><li id="50b6" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated">创建了一个AuthContext提供程序，该提供程序侦听用户身份验证状态的变化，并提供最新的会话(如果用户已登录，则为null)。</li></ol><p id="799f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是新navbar的应用程序外观。</p><figure class="ma mb mc md fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/3fca4a4d089db03299c2168fb125cb8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xzCotLfntxv0Dl9Wxr0ZqA.png"/></div></div></figure><p id="cd21" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">虽然新的导航条看起来不错，但在这个提交中有一个bug。当用户登录或退出时，导航栏不会更新。这是因为导航栏正在获取当前会话，如下所示。</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="463a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该代码将只在navbar呈现时运行一次，这意味着当用户登录和退出时它不会运行。为了修复这个bug，我们需要一些东西来监听用户身份验证状态的变化，并为我们的组件提供一个最新的<code class="du lw lx ly lz b">session</code>对象(或<code class="du lw lx ly lz b">null</code>)。这是由<code class="du lw lx ly lz b">AuthProvider</code>完成的。</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="0a14" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lw lx ly lz b">AuthProvider</code>使用<code class="du lw lx ly lz b">onAuthStatechange</code>回调来监听状态变化。当您在<code class="du lw lx ly lz b">useEffect()</code>钩子中返回一个回调时，它会在组件卸载时运行。这是进行清理的完美地方，比如调用<code class="du lw lx ly lz b">unsubscribe()</code>停止监听状态变化。</p><p id="8c8a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完成后<a class="ae jo" href="https://github.com/horizon0708/react-twitter-clone-follow-along/commit/3fe4b5dcee236d43bcc25ddacfce8a5719c623b9" rel="noopener ugc nofollow" target="_blank">我通过使用以下命令将导航条改为使用AuthProvider提供的会话。</a> <code class="du lw lx ly lz b"><a class="ae jo" href="https://github.com/horizon0708/react-twitter-clone-follow-along/commit/3fe4b5dcee236d43bcc25ddacfce8a5719c623b9" rel="noopener ugc nofollow" target="_blank">useAuth()</a></code> <a class="ae jo" href="https://github.com/horizon0708/react-twitter-clone-follow-along/commit/3fe4b5dcee236d43bcc25ddacfce8a5719c623b9" rel="noopener ugc nofollow" target="_blank">钩。</a></p><h1 id="e0b5" class="lf kf hi bd kg lg lh li kk lj lk ll ko lm ln lo kr lp lq lr ku ls lt lu kx lv bi translated">添加错误页面、确认电子邮件页面和编辑个人资料页面</h1><p id="0a93" class="pw-post-body-paragraph iq ir hi is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated"><a class="ae jo" href="https://github.com/horizon0708/react-twitter-clone-follow-along/commit/b6bd988a70c213cff38407402409fb9fc3f655f3" rel="noopener ugc nofollow" target="_blank">该提交</a>增加了:</p><ol class=""><li id="69ce" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn kd jv jw jx bi translated">这是一个普通的错误页面，当事情发生并且不可恢复时，我们可以显示给用户。</li><li id="3268" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated">“确认注册”页面。</li><li id="441c" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn kd jv jw jx bi translated">“编辑个人资料”页面。</li></ol><p id="45de" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">代码本身并不太有趣，但它是一个很好的地方来谈论我对Supabase注册流程的了解。</p><h2 id="8d50" class="ke kf hi bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky bi translated">默认情况下，注册确认是打开的</h2><p id="ab2d" class="pw-post-body-paragraph iq ir hi is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated">默认情况下，当您用<code class="du lw lx ly lz b">auth.signUp()</code>注册一个用户时，一封确认电子邮件将被发送到用户注册的电子邮件地址。您可以通过转到“身份验证”部分的“设置”选项卡来更改此行为。</p><figure class="ma mb mc md fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/cf1a33b4d3567ec215e2ae837b41f114.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4x7-7zXbRoX-BK495LmAdw.png"/></div></div></figure><h2 id="22d3" class="ke kf hi bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky bi translated">更改注册确认电子邮件的正文</h2><p id="f0a9" class="pw-post-body-paragraph iq ir hi is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated">默认的电子邮件非常简单，但是可以完成工作。</p><figure class="ma mb mc md fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/9f03bc5fd89d74e36679f914ca6a535d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eGWC2eCF_l_3cJYaGNXmkA.png"/></div></div></figure><p id="bec9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以通过转到“身份验证”部分的“模板”选项卡来更改消息。默认的“确认注册”消息是:</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="b98b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我已经将它链接到我的“编辑个人资料”页面(请看href ),这样用户可以在确认他们的电子邮件后立即设置他们的个人资料。</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><h2 id="e445" class="ke kf hi bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky bi translated">如果用户试图在没有确认的情况下登录会发生什么？</h2><p id="2b4d" class="pw-post-body-paragraph iq ir hi is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated">如果不确认注册，用户将无法登录。如果他们尝试，Supabase将给出400响应。</p><figure class="ma mb mc md fd ij er es paragraph-image"><div class="er es mk"><img src="../Images/11072c920e07dc516d77dbc25bb9e6f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*5jRjaVsqLYbrhxSGj8NsXw.png"/></div></figure><h2 id="706f" class="ke kf hi bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky bi translated">Supabase中的升级</h2><p id="a7ef" class="pw-post-body-paragraph iq ir hi is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated">在Supabase中升级非常简单。你只需要叫<code class="du lw lx ly lz b">upsert</code>而不是<code class="du lw lx ly lz b">insert</code>。</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><h1 id="ea44" class="lf kf hi bd kg lg lh li kk lj lk ll ko lm ln lo kr lp lq lr ku ls lt lu kx lv bi translated">更新编辑配置文件页面以加载现有配置文件</h1><p id="7a85" class="pw-post-body-paragraph iq ir hi is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated"><a class="ae jo" href="https://github.com/horizon0708/react-twitter-clone-follow-along/commit/08cd215f2c6381598d595a215980cc3f16a1792a" rel="noopener ugc nofollow" target="_blank">此提交</a>更新“编辑配置文件”页面，以加载用户的配置文件(如果存在)。通常，我们必须为profiles表手写一个<code class="du lw lx ly lz b">Profile</code>类型，但是Supabase通过让您从您的数据库模型中生成一个OpenAPI规范文件<a class="ae jo" href="https://supabase.io/docs/reference/javascript/generating-types" rel="noopener ugc nofollow" target="_blank">使这变得非常方便。</a></p><p id="a069" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">生成类型文件的命令如下:</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="8e92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我已经将它添加到了我的<code class="du lw lx ly lz b">package.json</code>中的“脚本”部分，这样每当我对数据库进行更改时，我就可以运行<code class="du lw lx ly lz b">npm run generate-types</code>来更新文件。</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="8391" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以在<code class="du lw lx ly lz b"><a class="ae jo" href="https://github.com/horizon0708/react-twitter-clone-follow-along/blob/master/src/api/types.ts" rel="noopener ugc nofollow" target="_blank">types.ts</a></code>中看到结果类型文件。当我使用Id查询配置文件时，我们可以使用它。</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="1c4d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第3部分我们就讲到这里。在第4部分中，我们将学习如何让用户上传他们的头像到Supabase存储器，以及我们如何把它们展示给我们的用户！和往常一样，f <a class="ae jo" href="https://twitter.com/James_HJ_Kim" rel="noopener ugc nofollow" target="_blank">可以通过推特</a>或评论提出任何问题。第4部分再见！🙋‍♂️</p></div></div>    
</body>
</html>