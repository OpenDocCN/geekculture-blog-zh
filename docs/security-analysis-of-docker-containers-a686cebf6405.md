# 码头集装箱的安全性分析

> 原文：<https://medium.com/geekculture/security-analysis-of-docker-containers-a686cebf6405?source=collection_archive---------13----------------------->

## Docker 安全挑战和最佳实践。

![](img/4fd6d9e958154e8665239fd92092e266.png)

Docker 被广泛接受，超过 25%的公司已经采用了 Docker。到 2024 年，Docker 的市场规模预计将增长 9.93 亿美元。尽管如此，Docker 面临着许多已知的安全威胁，本文将揭示一些众所周知的、常见的和可避免的安全威胁及其可能的解决方案。

在继续学习之前，您应该熟悉容器化技术、Docker 容器、其框架以及 Docker 中现有的安全机制。

[](https://mayankpatel99.medium.com/understanding-the-docker-containers-d5ee422bfd9d) [## 了解 Docker 容器。

### 深入了解 Docker 容器的框架和工作方式。

mayankpatel99.medium.com](https://mayankpatel99.medium.com/understanding-the-docker-containers-d5ee422bfd9d) 

*先决条件包含在上述文章*中😄*，我强烈推荐你先阅读一下，以便正确理解。*

尽管 Docker 容器提供了比其他虚拟化技术更高的效率和更高的可伸缩性，但它仍然是一种不成熟的技术，正在寻找解决其缺陷的方法。

# 1.易受攻击的 Docker 图像

Docker 有 3 个独立工作的模块，但在协作中，这些模块中的暴露会直接影响 Docker 容器甚至主机的安全性。这些曝光的主要来源是上传到 [Docker hub](https://hub.docker.com) 储存库的图像。大多数 docker 映像都带有预安装的应用程序，这些应用程序可能没有正确配置，从而在系统中留下漏洞，可被利用来发起对 Docker 容器或主机本身的攻击，从而导致劫持主机本身的重大数据泄漏。

# 2.恶意 Docker 图像

Docker Image developer 可能会使用加密货币挖掘程序或特洛伊木马、后门程序、web shell、勒索软件等病毒程序故意将恶意图像上传到 Docker Hub。运行这些容器会自动触发这些程序，你甚至不会注意到它们的存在。一个加密货币矿工可能会继续在你的容器的后台工作，吃掉所有的系统资源，如 CPU 周期和带宽，攻击者最终会因为你而赚很多钱😢。

[](https://threatpost.com/malicious-docker-cryptomining-images/165120/) [## 恶意 Docker 密码挖掘图片的下载量高达 2000 万次

### 公开的云图像正在向不知情的云开发者传播恶意软件。至少 30…

threatpost.com](https://threatpost.com/malicious-docker-cryptomining-images/165120/) 

# 3.集装箱逃逸攻击

docker 容器使用内核共享来降低虚拟化的性能成本。利用映像中存在的一些暴露，在容器中运行的进程可以逃逸到主机计算机系统，实现权限提升。这被称为'*逃逸攻击'，*以根用户权限运行容器会助长这种攻击。一旦该进程以根用户权限逃到主机，它就可以控制整个文件系统，从而关闭主机或泄露所有有价值的信息。

# 4.敏感信息泄露

敏感信息泄漏对于 Docker 容器来说是一个非常严重的问题，如果身份验证 API 或数据库密码以某种方式从容器中泄漏，那么它将影响整个系统。在有些情况下，不必要的凭证会留在映像中，这些凭证对于容器的工作是不需要的，但是用于构建映像。

# 5.网络模式安全性

Docker 有 4 种网络模式——无、主机、容器和网桥。

**无:**在无模式下，Docker 容器有自己独立的网络名称空间，并且没有指定任何网络设置。

**主机:**在主机模式下，容器和主机共享网络名称空间，使用相同的 IP 和端口。容器具有修改主机计算机的网络堆栈信息的特权，因此通信不需要 NAT。但是，不知不觉中，我们可能最终允许一个不可信的容器恶意修改网络堆栈信息。

**容器模式:**在容器模式下，容器可以被分配给其他容器的特定网络名称空间。但是，当名称空间被共享时，不可信容器对网络堆栈的修改仍然存在。

**桥接模式:**在桥接模式下，Docker 容器使用主机的端口进行通信，这是常用的做法。在主机上建立一个虚拟网络，完成不同网络接口之间的包转发。在默认设置中，虚拟网桥不会检查或过滤转发的数据包，因此 ARP 欺骗或 MAC 泛洪攻击很容易成功。

> 如果部署的映像是恶意的，那么它可能会为攻击者打开一个端口来发起对容器的攻击，或者可能会耗尽带宽并泄漏敏感信息，限制不可信或恶意已知的域和 IP 地址与我们的容器进行通信是很重要的。

# 解决方案和良好做法😺！！

作为一项不成熟的技术，它包含一些需要克服的问题，以充分发挥 docker 技术的潜力。因此，要解决这个问题，需要遵循一些最佳实践，还需要一些外部应用和服务来提高集装箱的安全性。

*   总是尝试去寻找官方的 DOCKER 图片，官方图片是由技术维护者或开发者自己发布的经过验证的图片。
*   Docker 甚至有一个“可信内容”功能，可以让你只下载签名图像。这不能保证 100%的安全性，但有了这一层额外的安全保障还是有好处的。
*   切勿在具有 root 权限的系统上部署容器，始终为容器分配其运行所需的最低权限。通过运行 container，您可以创建一个具有最低权限的非 root 用户来执行分配的任务。这将减少**集装箱逃脱**袭击的几率【3】。
*   避免**将敏感信息**【4】泄露到 Docker 映像本身，有时需要 SSH 密钥来提取代码或启动创建映像本身所需的一些中间过程，这些凭证对于最终开发的映像本身是不必要的。但是可能发生的情况是，这些凭证仍然隐藏在图像中的某个地方，并且可能被利用。必须使用 [**多阶段**](https://docs.docker.com/develop/develop-images/multistage-build/) 构建，而不是直接在 Dockerfile 中添加。通过利用 Docker 对多阶段构建的支持，可以在中间映像层管理这些凭证，并在以后处理时不留痕迹。还要声明`.dockerignore`中的所有敏感文件忽略它们。
*   必须在 docker 容器中正确管理秘密，以避免敏感数据泄露。

> 参见[这份](https://docs.docker.com/engine/swarm/secrets/)官方文件，了解处理机密的最佳做法。

*   使用对系统构成严重威胁的**易受攻击的 docker 映像** [1]可以通过了解 Docker 映像中的潜在暴露来避免[可以使用 CVE(常见漏洞和暴露)](https://cve.mitre.org/cve/)数据库。这是一个非常著名的、定期更新的数据库，包含广为人知的风险敞口，具有唯一的 ID 和详细的描述。

> 参考[这份](https://docs.docker.com/engine/scan/)官方文件对你的图像进行漏洞扫描。

*   部署前检查**恶意 Docker 映像**【2】通过扫描映像查找恶意文件或程序， [**ClamAV 恶意库**](https://www.clamav.net/) 它是最受欢迎的恶意数据库之一，及时更新，超过 600 万种恶意文件可用于扫描您的映像。
*   监控您的网络活动，查看来自恶意 IP 地址或域的呼叫，以防止**网络相关攻击**【5】。如果域名或 IP 地址，容器将通信是已知的，然后您可以设置防火墙服务，这将阻止所有其他领域的容器。

> *参照* [*本*](https://docs.docker.com/network/iptables/) *正式文件执行 IP 表。*

*   监控每个已部署容器的资源使用情况，如果有任何容器正在利用所提供的资源，则必须关闭该容器，否则将导致 **DoS(拒绝服务)攻击**。利用 cgroups 可以有效控制 DoS 攻击。

> 参考[本](https://docs.docker.com/config/containers/resource_constraints/)正式文件实施资源约束。

## DoS 是什么？

> 拒绝服务( *DoS* ) *攻击*意在关闭机器或网络，使其目标用户无法访问。有多种方式使带宽被多个系统淹没，从而使真正的用户受苦，或者通过消耗大量系统资源使系统窒息并自行关闭。

# 结论

这些是 docker 容器最常见的威胁，也有许多方法可以用来检测威胁。同样，检测到的威胁也可以通过多种方式解决。

## 留下掌声👏，关注更多🔥不断学习🤓

# 参考资料:

*   Docker 上关于安全分析和威胁检测技术的技术论文—[https://ieeexplore.ieee.org/document/9064441](https://ieeexplore.ieee.org/document/9064441)
*   *Docker 官方安全页面—*[*https://docs.docker.com/engine/security/*](https://docs.docker.com/engine/security/)