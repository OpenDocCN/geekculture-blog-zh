<html>
<head>
<title>Unlock the power of CTRL+Z in React state with useHistoryState</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用useHistoryState释放React状态下CTRL+Z的力量</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/unlock-the-power-of-ctrl-z-in-react-state-with-usehistorystate-7f93b7b62924?source=collection_archive---------11-----------------------#2021-11-21">https://medium.com/geekculture/unlock-the-power-of-ctrl-z-in-react-state-with-usehistorystate-7f93b7b62924?source=collection_archive---------11-----------------------#2021-11-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5e26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">CTRL+Z是开发者最好的朋友。你把你的代码拧到了无法识别的程度？只需CTRL+Z一堆的时间，你会回到正轨。</p><p id="318b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于每个主要的应用程序来说，CTRL+Z也是一个基本的快捷方式，用户几乎希望能够通过CTRL+Z来撤销一些错误。</p><p id="e99c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大多数react应用程序(以及一般的web应用程序)并不关心这一点，如果状态改变了，它们就不会跟踪以前的状态。释放这种能力的逻辑非常非常简单:只要保存一个所有状态的数组，一个指针，你就可以开始了。</p><p id="dc7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，在每个组件中重写这个逻辑会变得非常乏味。这似乎是定制挂钩的完美候选！</p><h1 id="fd53" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">定制挂钩</h1><p id="b9e0" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">React有一组<a class="ae kg" href="https://reactjs.org/docs/hooks-overview.html" rel="noopener ugc nofollow" target="_blank">基本钩子</a>，可以钩住功能组件的状态和生命周期。例如，useState钩子让你创建一个状态变量，useEffect让你在依赖关系改变时运行代码等等。</p><p id="f5dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以简单地通过编写一个函数将这些基本的挂钩组合成更复杂的挂钩(建议以动词“use”开始这些函数，以便react可以检查挂钩的所有<a class="ae kg" href="https://reactjs.org/docs/hooks-rules.html" rel="noopener ugc nofollow" target="_blank">规则是否适用)。</a></p><h1 id="79a8" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">使用历史状态</h1><p id="cd4f" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">那么让我们来看看我们自己定制的钩子。我们需要一个钩子，它包含值的状态钩子、状态历史的状态钩子和指针的状态钩子。然后我们只需要写一些函数(为了提高性能，我们将在一些useCallback中定义)来处理从外部设置状态、撤销和重做。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/5d0d5be805491f593864f1e13b5e5289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*guJbUGb1qLnjdAHmLj6siA.png"/></div></div></figure><p id="1e61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们对这些函数进行注释，以便理解我们正在做的事情:</p><p id="ecfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"/></p><p id="95db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kt">撤销:</em> </strong>非常简单…如果指针小于或等于0，我们就返回，因为没有什么可撤销的了。否则，我们在指针-1处用_setState将状态设置为历史，并减少指针。</p><p id="9a89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kt">重做:</em> </strong>就像撤销…如果指针大于或等于数组长度，我们就返回，因为没有什么可重做的了。否则，我们在指针+1处将state with _setState设置为history，并增加指针。</p><p id="b4ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想复制代码供个人使用，下面是非图像格式的代码:</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="110f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想在你的Typescript项目中使用它，我还写了一个Typescript版本</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="ku kv l"/></div></figure></div></div>    
</body>
</html>