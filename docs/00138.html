<html>
<head>
<title>MongoDB: Model Tree Structures with Materialized Paths</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MongoDB:带有物化路径的模型树结构</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/mongodb-model-tree-structures-with-materialized-paths-ed58f38ded3e?source=collection_archive---------0-----------------------#2020-07-18">https://medium.com/geekculture/mongodb-model-tree-structures-with-materialized-paths-ed58f38ded3e?source=collection_archive---------0-----------------------#2020-07-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="f8dc" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">MongoDB数据建模</h2><div class=""/><div class=""><h2 id="cc24" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">具有物化路径的模型树结构及其使用方法。</h2></div><p id="d175" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated"><a class="ae kc" href="https://docs.mongodb.com/manual/applications/data-models-tree-structures/" rel="noopener ugc nofollow" target="_blank">有不同的方式来建立树形结构</a>。会寻找物化的道路。</p><ul class=""><li id="1076" class="kd ke hi ji b jj jk jm jn jp kf jt kg jx kh kb ki kj kk kl bi translated"><a class="ae kc" href="https://docs.mongodb.com/manual/tutorial/model-tree-structures-with-parent-references/" rel="noopener ugc nofollow" target="_blank"> <strong class="ji hs">带父引用的模型树结构</strong> </a></li><li id="c36a" class="kd ke hi ji b jj km jm kn jp ko jt kp jx kq kb ki kj kk kl bi translated"><a class="ae kc" href="https://docs.mongodb.com/manual/tutorial/model-tree-structures-with-child-references/" rel="noopener ugc nofollow" target="_blank"> <strong class="ji hs">带子参照的模型树结构</strong> </a></li><li id="04a7" class="kd ke hi ji b jj km jm kn jp ko jt kp jx kq kb ki kj kk kl bi translated"><a class="ae kc" href="https://docs.mongodb.com/manual/tutorial/model-tree-structures-with-ancestors-array/" rel="noopener ugc nofollow" target="_blank"> <strong class="ji hs">用祖先数组建立树形结构</strong> </a></li><li id="1892" class="kd ke hi ji b jj km jm kn jp ko jt kp jx kq kb ki kj kk kl bi translated"><a class="ae kc" href="https://docs.mongodb.com/manual/tutorial/model-tree-structures-with-materialized-paths/" rel="noopener ugc nofollow" target="_blank"> <strong class="ji hs">具有物化路径的模型树结构</strong> </a></li><li id="0acf" class="kd ke hi ji b jj km jm kn jp ko jt kp jx kq kb ki kj kk kl bi translated"><a class="ae kc" href="https://docs.mongodb.com/manual/tutorial/model-tree-structures-with-nested-sets/" rel="noopener ugc nofollow" target="_blank"> <strong class="ji hs">具有嵌套集合的模型树结构</strong> </a></li></ul><blockquote class="kr ks kt"><p id="0c58" class="jg jh ku ji b jj jk is jl jm jn iv jo kv jq jr js kw ju jv jw kx jy jz ka kb hb bi translated">如果您希望对节点进行操作，请不要按原样存储嵌入的树。这将增加树中节点操作的复杂性，您将被迫在服务端进行处理。</p></blockquote><p id="0420" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">建模时的规则是一样的，我们应该知道(不涉及太多细节的高层次):</p><ul class=""><li id="4b32" class="kd ke hi ji b jj jk jm jn jp kf jt kg jx kh kb ki kj kk kl bi translated">使用模式—所有操作的[DML]是什么，涉及的复杂性。</li><li id="17bd" class="kd ke hi ji b jj km jm kn jp ko jt kp jx kq kb ki kj kk kl bi translated">数据的性质—[较不频繁更改的非增长数据(主数据/配置数据/一次性数据)与持续增长的数据(统计数据/访问日志/预订/交易数据)]</li><li id="f0b6" class="kd ke hi ji b jj km jm kn jp ko jt kp jx kq kb ki kj kk kl bi translated">性能—请求量、响应时间。</li><li id="759c" class="kd ke hi ji b jj km jm kn jp ko jt kp jx kq kb ki kj kk kl bi translated">复杂性——目标查询，使用MongoDB的特性对其进行操作，而不是在应用程序中提取数据并执行操作。</li></ul><h2 id="9d7c" class="ky kz hi bd la lb lc ld le lf lg lh li jp lj lk ll jt lm ln lo jx lp lq lr ho bi translated">使用案例:</h2><p id="aebe" class="pw-post-body-paragraph jg jh hi ji b jj ls is jl jm lt iv jo jp lu jr js jt lv jv jw jx lw jz ka kb hb bi translated">书籍的类别，每本书都被标记在一个类别下。</p><ul class=""><li id="980e" class="kd ke hi ji b jj jk jm jn jp kf jt kg jx kh kb ki kj kk kl bi translated">用法—将关注不同的搜索模式。</li><li id="742f" class="kd ke hi ji b jj km jm kn jp ko jt kp jx kq kb ki kj kk kl bi translated">数据的性质—频率较低的非增长数据。</li><li id="843b" class="kd ke hi ji b jj km jm kn jp ko jt kp jx kq kb ki kj kk kl bi translated">性能-用索引覆盖查询字段，预期数据量低。</li><li id="a1ad" class="kd ke hi ji b jj km jm kn jp ko jt kp jx kq kb ki kj kk kl bi translated">复杂性——将看到物化路径是如何帮助我们的。</li></ul><figure class="ly lz ma mb fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es lx"><img src="../Images/b4c83d91aa400726b29d69591e8617e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xEsCvowL_IQP0-w3zBsUbQ.png"/></div></div></figure><h2 id="723a" class="ky kz hi bd la lb lc ld le lf lg lh li jp lj lk ll jt lm ln lo jx lp lq lr ho bi translated">准备数据:</h2><pre class="ly lz ma mb fd mj mk ml mm aw mn bi"><span id="10ce" class="ky kz hi mk b fi mo mp l mq mr">db.categories.insertMany( [<br/>   { _id: "Books", path: null },<br/>   { _id: "Programming", path: ",Books," },<br/>   { _id: "Databases", path: ",Books,Programming," },<br/>   { _id: "Languages", path: ",Books,Programming," },<br/>   { _id: "MongoDB", path: ",Books,Programming,Databases," },<br/>   { _id: "dbm", path: ",Books,Programming,Databases," },<br/>   { _id: "Java", path: ",Books,Programming,Languages," },<br/>   { _id: "C++", path: ",Books,Programming,Languages," },<br/>   { _id: "C", path: ",Books,Programming,Languages," }, <br/>   { _id: "Functional", path: ",Books,Programming,Languages,Java," },<br/>   { _id: "Spring", path: ",Books,Programming,Languages,Java," },<br/>   { _id: "MicroServices", path: ",Books,Programming,Languages,Java," },<br/>] );</span><span id="6ac4" class="ky kz hi mk b fi ms mp l mq mr">// add index on "path" field.<br/>db.categories.createIndex<strong class="mk hs">(</strong> <strong class="mk hs">{</strong> path<strong class="mk hs">:</strong> 1 <strong class="mk hs">}</strong> <strong class="mk hs">);</strong></span></pre><ul class=""><li id="2db3" class="kd ke hi ji b jj jk jm jn jp kf jt kg jx kh kb ki kj kk kl bi translated">您可以查询检索整个树，按字段路径排序</li></ul><pre class="ly lz ma mb fd mj mk ml mm aw mn bi"><span id="0e20" class="ky kz hi mk b fi mo mp l mq mr">db.categories.find().sort( { path: 1 } );</span><span id="e409" class="ky kz hi mk b fi ms mp l mq mr">//Output:<br/>{ "_id" : "Books", "path" : null }<br/>{ "_id" : "Programming", "path" : ",Books," }<br/>{ "_id" : "Databases", "path" : ",Books,Programming," }<br/>{ "_id" : "Languages", "path" : ",Books,Programming," }<br/>{ "_id" : "MongoDB", "path" : ",Books,Programming,Databases," }<br/>{ "_id" : "dbm", "path" : ",Books,Programming,Databases," }<br/>{ "_id" : "Java", "path" : ",Books,Programming,Languages," }<br/>{ "_id" : "C++", "path" : ",Books,Programming,Languages," }<br/>{ "_id" : "C", "path" : ",Books,Programming,Languages," }<br/>{ "_id" : "Functional", "path" : ",Books,Programming,Languages,Java," }<br/>{ "_id" : "Spring", "path" : ",Books,Programming,Languages,Java," }<br/>{ "_id" : "MicroServices", "path" : ",Books,Programming,Languages,Java," }</span></pre><ul class=""><li id="96cb" class="kd ke hi ji b jj jk jm jn jp kf jt kg jx kh kb ki kj kk kl bi translated">您可以在path字段上使用正则表达式来查找编程的后代/子代</li></ul><pre class="ly lz ma mb fd mj mk ml mm aw mn bi"><span id="77c9" class="ky kz hi mk b fi mo mp l mq mr">db.categories.find( { path: /,Databases,/ } );</span><span id="f090" class="ky kz hi mk b fi ms mp l mq mr">// Output:</span><span id="6f8b" class="ky kz hi mk b fi ms mp l mq mr">{ "_id" : "MongoDB", "path" : ",Books,Programming,Databases," }<br/>{ "_id" : "dbm", "path" : ",Books,Programming,Databases," }</span></pre><ul class=""><li id="eafc" class="kd ke hi ji b jj jk jm jn jp kf jt kg jx kh kb ki kj kk kl bi translated">查询查找所有与给定节点得分最近的相关节点。</li></ul><p id="45ab" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">《出埃及记》与“春天”关系最密切</p><p id="1598" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">将使用<a class="ae kc" href="https://docs.mongodb.com/manual/text-search/" rel="noopener ugc nofollow" target="_blank">文本搜索</a>。</p><pre class="ly lz ma mb fd mj mk ml mm aw mn bi"><span id="03e2" class="ky kz hi mk b fi mo mp l mq mr">// create text index to use text search.</span><span id="db17" class="ky kz hi mk b fi ms mp l mq mr">db.categories.createIndex( { path: "text"} );</span><span id="d0dc" class="ky kz hi mk b fi ms mp l mq mr">// Find the path for node "Spring"<br/>var pathForNodeSpring = db.getCollection("categories")<br/>      .find({_id: "Spring"}).next().path;</span><span id="5d73" class="ky kz hi mk b fi ms mp l mq mr">// Use it to search the tree with score, highest score is the best // match<br/>db.categories.find(<br/>   { $text: { $search: pathForNodeSpring } },<br/>   { score: { $meta: "textScore" } } // assigns score to best match.<br/>).sort( { score: { $meta: "textScore" } } ) ;</span><span id="cb95" class="ky kz hi mk b fi ms mp l mq mr">// Output:</span><span id="8e6f" class="ky kz hi mk b fi ms mp l mq mr">{ "_id" : "Functional", "path" : ",Books,Programming,Languages,Java,", <strong class="mk hs">"score" : 2.5</strong> }<br/>{ "_id" : "Spring", "path" : ",Books,Programming,Languages,Java,", <strong class="mk hs">"score" : 2.5</strong> }<br/>{ "_id" : "MicroServices", "path" : ",Books,Programming,Languages,Java,", <strong class="mk hs">"score" : 2.5</strong> }<br/>{ "_id" : "Java", "path" : ",Books,Programming,Languages,", <strong class="mk hs">"score" : 2</strong> }<br/>{ "_id" : "C++", "path" : ",Books,Programming,Languages,", "score" : 2 }<br/>{ "_id" : "C", "path" : ",Books,Programming,Languages,", "score" : 2 }<br/>{ "_id" : "Databases", "path" : ",Books,Programming,", "score" : 1.5 }<br/>{ "_id" : "Languages", "path" : ",Books,Programming,", "score" : 1.5 }<br/>{ "_id" : "MongoDB", "path" : ",Books,Programming,Databases,", "score" : 1.3333333333333333 }<br/>{ "_id" : "dbm", "path" : ",Books,Programming,Databases,", "score" : 1.3333333333333333 }<br/>{ "_id" : "Programming", "path" : ",Books,", "score" : 1 }</span></pre><p id="7a20" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">用<strong class="ji hs">“得分”:2.5 </strong>是它最接近节点“春天”的兄弟。这将有助于读者在“Spring”上找不到一本书，但应用程序仍然可以引用同一类别中的相关书籍。</p><h2 id="31f5" class="ky kz hi bd la lb lc ld le lf lg lh li jp lj lk ll jt lm ln lo jx lp lq lr ho bi translated">缺点:</h2><p id="989b" class="pw-post-body-paragraph jg jh hi ji b jj ls is jl jm lt iv jo jp lu jr js jt lv jv jw jx lw jz ka kb hb bi translated">对节点所做的修改应该反映到所有的后代/子节点。</p><p id="8956" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">希望这将是有帮助的，请做评论，如果我错过了一些场景或简短的解释。</p></div></div>    
</body>
</html>