<html>
<head>
<title>Test Coverage, from zero to stability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">测试覆盖率，从零到稳定</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/test-coverage-from-zero-to-stability-cf552e5bd25c?source=collection_archive---------51-----------------------#2021-07-05">https://medium.com/geekculture/test-coverage-from-zero-to-stability-cf552e5bd25c?source=collection_archive---------51-----------------------#2021-07-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/870411ff5fbe2f8f9cf606f695c04d47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dSIlYl-Rpbis3qqp5dMTiA.png"/></div></div></figure><h1 id="b40e" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">出发点</h1><p id="345c" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">项目概述。我们的客户是一个数字化B2B市场，为中型工业公司和金属建筑自动采购金属零件。这项业务的主要想法是创建一个在线平台，在这里人们可以比在任何其他地方更快更便宜地订购金属零件。</p><p id="a52e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们在项目中的职责是改善客户门户网站，增强客户和生产商之间的沟通。业务不断发展，对平台的需求也随之增长。起初，有一个QA工程师能够满足项目的所有需求。现在，有三个测试人员，他们经常感到缺少完成任务的时间。因此，我们意识到我们需要尽可能自动化QA工程师的工作，用测试覆盖代码。</p><p id="b124" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在这篇文章中，我将描述我们面临的挑战和我们在项目中使用的解决方案，我们还将讨论有趣的案例、错误以及我们如何修复它们。</p><p id="68a7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><em class="kr">文章由瓦西里·塔尔纳波斯基撰写</em></p><h1 id="b0da" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">作为商业逻辑处理的摩卡和柴</h1><p id="324c" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">开发团队担心服务器端不同情况下的业务逻辑的正常工作。这就是我们从摩卡和柴开始测试的原因。我们还实现了依赖注入，这给了我们轻松替换服务和快速编写测试的可能性。<br/>例如，我们有<em class="kr"> CompanyManagementService </em>，它有<em class="kr"> userService </em>作为依赖项。那么用InversifyJS模拟依赖关系将如下所示:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="8dab" class="lb ir hi kx b fi lc ld l le lf">describe(‘Validate CompanyManagementService’, () =&gt; {<br/>let user</span><span id="ae69" class="lb ir hi kx b fi lg ld l le lf">let companyManagementService</span><span id="fc9d" class="lb ir hi kx b fi lg ld l le lf">before(async () =&gt; {</span><span id="7347" class="lb ir hi kx b fi lg ld l le lf">user = await setUp()</span><span id="3d75" class="lb ir hi kx b fi lg ld l le lf"><strong class="kx hj"><em class="kr">container</em></strong>.snapshot()</span><span id="9edc" class="lb ir hi kx b fi lg ld l le lf"><strong class="kx hj"><em class="kr">container</em></strong>.rebind(types.UserService).toConstantValue(<strong class="kx hj"><em class="kr">userServiceMock</em></strong>)</span><span id="89e6" class="lb ir hi kx b fi lg ld l le lf">companyManagementService = <strong class="kx hj"><em class="kr">container</em></strong>.get(types.CompanyManagementService)</span><span id="8d22" class="lb ir hi kx b fi lg ld l le lf">})</span></pre><h1 id="b0d4" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">E2E反对单调的工作</h1><p id="78a0" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我们完成了业务逻辑覆盖，但是意识到手工测试的问题仍然存在。我们开始用E2E测试来解决它，这消除了测试人员工作中单调的部分。经过长时间的讨论，我们同意寻找一个JavaScript框架，实际上，团队中的每个开发人员都可以支持它，以防我们需要它。这就是我们决定选择柏树的原因。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es lh"><img src="../Images/2953df93459479fbcfbd5f1288c9525b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*K5UieIpOE4Zdg1J5AbwjrQ.jpeg"/></div><figcaption class="li lj et er es lk ll bd b be z dx"><a class="ae lm" href="https://memegenerator.net/instance/68070195/scheming-baby-automated-testing-yes-no-more-manual-testing" rel="noopener ugc nofollow" target="_blank">Credits</a></figcaption></figure><h1 id="fd83" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">柏树的利与弊</h1><p id="e531" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">该框架的工作始于为期一天的研讨会。每个人都有机会在运行中尝试Cypress，编写测试。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/05b41187d03353c3fe4b812748b2f8b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BgUqMWWCGdpxDiylhfSRRw.jpeg"/></div></div></figure><p id="23c2" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们在项目中面临着一个高度优先的问题。这导致了赛普拉斯工作的一点延误。然而，解决方案是显而易见的，一旦我们雇佣了一个新的软件工程师，我们没有让他参与解决业务问题，而是让他与Cypress integration一起工作。</p><p id="4300" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">通过E2E测试，我们完全覆盖了主要流程，这是我们的客户最常用的，并且我们每个月都要测试一千次。实现它们是一个很酷的决定，因为它帮助我们找到并修复未暴露的bug。说到缺点——像往常一样，没有足够的时间来编写新的测试，并且很难找到具备JavaScript和Cypress知识的QA工程师。我想注意到，这一点非常关键，可能是我们停止使用柏树的主要原因，尽管它有很多优点。</p><h1 id="4369" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">令人印象深刻的笑话力量</h1><p id="3007" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我们项目中一个更脆弱的部分是——Vuex。</p><p id="c7c8" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">基于我们有超过100行的“动作”这一事实，我们不能在那里给出一个意外的结果。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/2bb4840b6e020be625cde1b5d6995fa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VaqyvqSZbyfuaTWVWiiHRw.png"/></div></div></figure><p id="418e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">因此，我们决定这将是我们UI测试覆盖的完美开端。这个时候，我们选择用Jest。主要是因为它可以并行运行测试，也因为它拥有开箱即用测试的一切。Jest真的很快，现在，我们有200多个测试，它们运行6秒钟，实际上，令人印象深刻:</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/a6ec9cbf514a560bece44131c5887383.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*NImvzRUJW5bm74z4XSQwwg.png"/></div></figure><p id="cb23" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">来说几个有趣的案例吧。当我们在讨论Vuex的时候，我们发现代码中的一些地方长时间以错误的方式工作。<br/>例如，我们已经将State中的属性名称从'<em class="kr"> getMinimumOrderValue' </em>更改为<em class="kr">' getminimuordervalues '</em>，但是在其他地方没有更新。这导致了意想不到的错误，很难被E2E测试或手工测试所发现。由于我们在测试过程中发现了类似的问题，所以在测试编写过程中花费的时间完全被覆盖了。</p><p id="2dc7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如下，即使我们的业务每天都在快速增长，我们引入新的功能，我们仍然保持我们的系统安全、稳定，并在最终用户可能遇到问题之前解决大部分问题。</p><p id="9663" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">感谢阅读。我们希望你喜欢我们的新文章。敬请关注最新消息！</p></div></div>    
</body>
</html>