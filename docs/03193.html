<html>
<head>
<title>Does async await block JavaScript Main thread ?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">async await会阻塞JavaScript主线程吗？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/does-async-await-block-javascript-main-thread-c07db9c48c3e?source=collection_archive---------3-----------------------#2021-06-03">https://medium.com/geekculture/does-async-await-block-javascript-main-thread-c07db9c48c3e?source=collection_archive---------3-----------------------#2021-06-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="781b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你已经登陆了这个页面，很可能你知道什么是async和await，并且在某个时候你可能会有这样的疑问:他们真的阻塞了JavaScript主线程吗？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/31670bf2b923de6546bcb7d9cdc87b49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*by5gaszr5oqOyH-s"/></div></div></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jw jx l"/></div></figure><p id="0540" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">什么是异步和等待？</p><p id="1a5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我相信你们大多数人都知道，对于那些不清楚的人，这里有一个简单的解释。</p><p id="5e93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设您想要使用promise进行API调用，该API调用的响应必须传递给另一个promise，并且该promise的响应必须传递给另一个promise。这被称为承诺链，如下面的代码所示。</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="82ad" class="kd ke hi jz b fi kf kg l kh ki">function getUserData()<br/>promise.then(response1 =&gt; {<br/> promise.then(response2 =&gt; {<br/>  promise.then(response3 =&gt; {<br/>     console.log("Inside the promise"); // Will be printed later<br/>  }}<br/> }}<br/>})</span><span id="b14b" class="kd ke hi jz b fi kj kg l kh ki">getUserData()</span></pre><p id="63fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的方法没有问题，事实上，如果你有一个承诺响应作为另一个承诺的参数传递，那么没有其他方法。大多数人都知道，在JavaScript中，promise是用来实现异步任务的。所以在下面的代码片段中，“Before all promise”将被打印在“Inside the promise”之前。</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="8a37" class="kd ke hi jz b fi kf kg l kh ki">function getUserData()<br/>promise.then(response1 =&gt; {<br/> promise.then(response2 =&gt; {<br/>  promise.then(response3 =&gt; {<br/>     console.log("Inside the promise"); // Will be printed later<br/>  }}<br/> }}<br/>})</span><span id="5252" class="kd ke hi jz b fi kj kg l kh ki">getUserData()<br/>console.log("Before all promise"); // will be printed first</span></pre><p id="9cb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在承诺执行之前，我们不会阻塞主线程的执行，一旦承诺完成执行，JavaScript主线程就会从回调队列中挑选那些任务(如果你不知道JavaScript中的事件循环，可以在这个<a class="ae kk" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop" rel="noopener ugc nofollow" target="_blank">链接</a>中找到它)。</p><p id="2e64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">让我们进入异步话题，等待</strong></p><p id="606d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">async和await被认为是语法糖，而不是使用上面的承诺链，您可以使用async、await并编写非常结构化的代码，如下所示。</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="9832" class="kd ke hi jz b fi kf kg l kh ki">async function getUserData(){</span><span id="9325" class="kd ke hi jz b fi kj kg l kh ki">let response1 = await fetch('<a class="ae kk" href="https://jsonplaceholder.typicode.com/users" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/users</a>');</span><span id="db75" class="kd ke hi jz b fi kj kg l kh ki">let response2 = await fetch('<a class="ae kk" href="https://jsonplaceholder.typicode.com/users" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/users</a>');</span><span id="21fd" class="kd ke hi jz b fi kj kg l kh ki">let response3 = await fetch('<a class="ae kk" href="https://jsonplaceholder.typicode.com/users" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/users</a>');<br/>}</span><span id="9a90" class="kd ke hi jz b fi kj kg l kh ki">getUserData();</span></pre><p id="286c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">起初，如果你看着它，一切似乎都很好。但是如果您仔细观察，在执行第一个await和response1得到API调用的响应之前，控制不会传递给第二行，同样的情况会持续到response3。你不认为它阻塞了主线程吗？</p><p id="1ae1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只是为了让你更困惑，看看下面的代码片段，并猜测输出。</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="9a58" class="kd ke hi jz b fi kf kg l kh ki">async function getUserData(){</span><span id="800f" class="kd ke hi jz b fi kj kg l kh ki">let response1 = await fetch('<a class="ae kk" href="https://jsonplaceholder.typicode.com/users" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/users</a>');</span><span id="9abf" class="kd ke hi jz b fi kj kg l kh ki">let response2 = await fetch('<a class="ae kk" href="https://jsonplaceholder.typicode.com/users" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/users</a>');</span><span id="23c6" class="kd ke hi jz b fi kj kg l kh ki">let response3 = await <br/>fetch('<a class="ae kk" href="https://jsonplaceholder.typicode.com/users" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/users</a>');</span><span id="5b86" class="kd ke hi jz b fi kj kg l kh ki">console.log("After all promise is executed");</span><span id="1b68" class="kd ke hi jz b fi kj kg l kh ki">}</span><span id="b31d" class="kd ke hi jz b fi kj kg l kh ki">getUserData();<br/>console.log("Hello World");</span></pre><p id="d40a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将首先记录哪条语句？如果你在进一步阅读之前已经找到了答案，请在评论区添加你的名字。</p><p id="5d0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">答案是，“Hello World”将首先打印，在所有承诺执行后，将打印“所有承诺执行后”声明。</p><p id="aea7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然这造成了混乱，但实际上async和await不会阻塞JavaScript主线程。如上所述，它们只是承诺链的语法糖。</p><p id="b3ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">换句话说，下面的两个代码片段是相同的。</p><p id="91a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">片段1:</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="76fd" class="kd ke hi jz b fi kf kg l kh ki">function getUserData()<br/>promise.then(response1 =&gt; {<br/> promise.then(response2 =&gt; {<br/>  promise.then(response3 =&gt; {<br/>     console.log("Inside the promise"); // Will be printed later<br/>  }}<br/> }}<br/>})</span><span id="60e7" class="kd ke hi jz b fi kj kg l kh ki">getUserData()</span></pre><p id="5a82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">片段2:</p><pre class="je jf jg jh fd jy jz ka kb aw kc bi"><span id="c651" class="kd ke hi jz b fi kf kg l kh ki">async function getUserData(){</span><span id="9537" class="kd ke hi jz b fi kj kg l kh ki">let response1 = await fetch('<a class="ae kk" href="https://jsonplaceholder.typicode.com/users" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/users</a>');</span><span id="822f" class="kd ke hi jz b fi kj kg l kh ki">let response2 = await fetch('<a class="ae kk" href="https://jsonplaceholder.typicode.com/users" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/users</a>');</span><span id="c1c8" class="kd ke hi jz b fi kj kg l kh ki">let response3 = await <br/>fetch('<a class="ae kk" href="https://jsonplaceholder.typicode.com/users" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/users</a>');</span><span id="0d3a" class="kd ke hi jz b fi kj kg l kh ki">console.log("After all promise is executed");</span><span id="f0ff" class="kd ke hi jz b fi kj kg l kh ki">}</span><span id="65e3" class="kd ke hi jz b fi kj kg l kh ki">getUserData();</span></pre><p id="5292" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于函数开头有async关键字，JavaScript会把这个方法执行从调用栈移到web API，继续执行其他任务。这个话题很简单，但是在面试中，许多候选人看到上面的例子会感到困惑。这就是我写这篇文章来详细解释它的原因。</p><p id="789a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">阅读愉快，在我的下一篇文章中再见。</p><p id="eadf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">同一作者的更多文章:</strong></p><ol class=""><li id="2516" class="kl km hi ih b ii ij im in iq kn iu ko iy kp jc kq kr ks kt bi translated"><a class="ae kk" href="https://mevasanth.medium.com/how-everything-is-object-in-javascript-a4164d7e6a2d" rel="noopener">JavaScript中的一切都是对象吗？</a></li><li id="c7c5" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated"><a class="ae kk" href="https://mevasanth.medium.com/hoisting-in-javascript-hot-topic-for-interview-43b463a6a77?source=follow_footer---------0----------------------------" rel="noopener">JavaScript吊装:采访热点</a></li><li id="855c" class="kl km hi ih b ii ku im kv iq kw iu kx iy ky jc kq kr ks kt bi translated"><a class="ae kk" href="https://mevasanth.medium.com/memoization-in-javascript-hot-topic-for-interview-815475544ab0" rel="noopener">JavaScript中的记忆化——采访热点</a></li></ol><p id="7fdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里阅读作者<a class="ae kk" href="https://mevasanth.medium.com/" rel="noopener">的所有文章。</a></p></div></div>    
</body>
</html>