<html>
<head>
<title>How to Create a Rails Backend API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建Rails后端API</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-create-a-rails-backend-api-871fcddd6e20?source=collection_archive---------1-----------------------#2021-01-29">https://medium.com/geekculture/how-to-create-a-rails-backend-api-871fcddd6e20?source=collection_archive---------1-----------------------#2021-01-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="f416" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">构建Rails REST API的分步指南</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/e3bcb7cabde9e1949b092f05338e6187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Gxa7MKTlDTakfPAf"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@andrewtneel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Andrew Neel</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ee35" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您是否开始了一个新项目，需要一个专用的后端API来持久存储数据？不要再看了；这本指南会引导你走向正确的方向。</p><h1 id="e9a1" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">0.规划领域模型和关联</h1><p id="558e" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">当开始一个新项目时，首先规划出你的领域模型和<a class="ae jn" href="https://guides.rubyonrails.org/association_basics.html" rel="noopener ugc nofollow" target="_blank">关联</a>总是很重要的。请参考下面的图表来绘制您的模型关联。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lh"><img src="../Images/052f3b40737dbf02dfa87e0d32393485.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*MqQZi5-uRZ3648Jb2hcqdQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Crow’s Foot notation reference</figcaption></figure><p id="9210" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在本指南中，我们将使用以下领域模型为库应用程序构建一个简单的API:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es li"><img src="../Images/25e882ffbf983ca848d2dd8bcbc0351d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jzAwtUu0eiGqpP8m_t4mbA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Domain model for our library-API</figcaption></figure><p id="00b3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这两个模型之间的联系在上面用“鱼尾纹”符号表示出来了。</p><p id="8b0c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一个作者的书。一本书<code class="du lj lk ll lm b">belongs_to</code>一个作者。</p><h1 id="559d" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">1.正在初始化Rails API</h1><p id="7432" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">在您的终端中，使用下面的命令初始化一个新的<a class="ae jn" href="https://guides.rubyonrails.org/api_app.html" rel="noopener ugc nofollow" target="_blank"> Rails API </a>。</p><p id="6f52" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">模板:</strong></p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="cd9a" class="lr kl hi lm b fi ls lt l lu lv">$ rails new <strong class="lm hj">&lt;API NAME&gt;</strong> --api --database=postgresql</span></pre><p id="b541" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">示例:</strong></p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="eb68" class="lr kl hi lm b fi ls lt l lu lv">$ rails new <strong class="lm hj">library-api</strong> --api --database=postgresql</span></pre><p id="835f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><code class="du lj lk ll lm b">--api</code>标志告诉Rails初始化一个新的应用程序，而不需要膨胀和中间件，这在API应用程序中是不必要的。</p><p id="9ac9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><code class="du lj lk ll lm b">--database=</code>标志向Rails指定我们将使用什么数据库。在这种情况下，如果您计划将API部署到Heroku上，我们将使用PostgreSQL，因为它是Heroku的标准数据库。</p><p id="6e3c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="lw">没有指定数据库类型，Rails默认使用SQLite。</em></p><p id="25a8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">记得将目录更改为新初始化的API的根文件夹，并运行<code class="du lj lk ll lm b">$ bundle</code>来安装您的依赖项。</p><h1 id="026d" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">2.模型</h1><p id="3564" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">一旦Rails完成了对我们的API的初始化，使用下面的命令为我们的API生成我们的<a class="ae jn" href="https://guides.rubyonrails.org/active_model_basics.html" rel="noopener ugc nofollow" target="_blank">模型</a>并为我们的数据库生成表格。</p><p id="38bd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">模板:</strong></p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="ff5a" class="lr kl hi lm b fi ls lt l lu lv">$ rails generate model <strong class="lm hj">&lt;MODEL NAME&gt;</strong> <strong class="lm hj">&lt;COLUMNS&gt;</strong></span></pre><h2 id="0f78" class="lr kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">生成作者模型</h2><p id="ae61" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">在我们的示例中，我们为我们的<strong class="jq hj"> Author </strong>表创建了一个模型和迁移，该表由两列(<strong class="jq hj"> name </strong>和<strong class="jq hj"> bio </strong>)组成，类型为string。</p><p id="15b1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">例如:</strong></p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="5e3e" class="lr kl hi lm b fi ls lt l lu lv">$ rails generate model <strong class="lm hj">Author</strong> <strong class="lm hj">name:string bio:string</strong></span></pre><p id="893c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以通过使用以下规则来缩短生成命令:</p><ul class=""><li id="6869" class="mk ml hi jq b jr js ju jv jx mm kb mn kf mo kj mp mq mr ms bi translated"><em class="lw">如果列类型是字符串，我们可以省略</em> <code class="du lj lk ll lm b"><em class="lw">:string</em></code> <em class="lw">，因为如果没有指定，Rails会默认将每个列类型设置为字符串。</em></li><li id="2cc0" class="mk ml hi jq b jr mt ju mu jx mv kb mw kf mx kj mp mq mr ms bi translated"><em class="lw">将</em> <code class="du lj lk ll lm b"><em class="lw">rails generate model</em></code> <em class="lw">缩短为</em> <code class="du lj lk ll lm b"><em class="lw">rails g model</em></code> <em class="lw">。</em></li></ul><p id="4eff" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">举例(缩短):</strong></p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="b6ab" class="lr kl hi lm b fi ls lt l lu lv">$ rails g model <strong class="lm hj">Author</strong> <strong class="lm hj">name bio</strong></span></pre><h2 id="c0e6" class="lr kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">生成图书模型</h2><p id="47cd" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">基于我们的领域模型，一个作者有很多书，一本书属于一个作者。为了让我们的数据库识别图书和作者之间的关联，我们可以使用我们试图链接的模型的名称添加一个新列，并将列类型设置为<code class="du lj lk ll lm b">:belongs_to</code>。</p><p id="f78c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">例子:</strong></p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="954d" class="lr kl hi lm b fi ls lt l lu lv">$ rails g model Book title pages:integer <strong class="lm hj">author:belongs_to</strong></span></pre><p id="aceb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">将列类型设置为<code class="du lj lk ll lm b">:belongs_to</code>将告诉Rails自动:</p><ul class=""><li id="e283" class="mk ml hi jq b jr js ju jv jx mm kb mn kf mo kj mp mq mr ms bi translated">在Book表中创建一个<code class="du lj lk ll lm b">author_id</code>列，将作者的ID存储为外键。</li><li id="6286" class="mk ml hi jq b jr mt ju mu jx mv kb mw kf mx kj mp mq mr ms bi translated">将<code class="du lj lk ll lm b">belongs_to</code>关联添加到图书模型中。</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es my"><img src="../Images/5b180292b594fc127eeb5143421d5db6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*ypKsdjJWfNw9wg5ZtXlfpQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">app/model/book.rb</figcaption></figure><h2 id="80be" class="lr kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">向模型添加关联</h2><p id="9382" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">尽管Rails可能已经在图书模型生成期间建立了图书与作者之间的关联，但是我们仍然需要手动建立作者与图书模型之间的关联。</p><p id="61a9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在我们的<code class="du lj lk ll lm b">app/models/author.rb</code>文件中，添加关联<code class="du lj lk ll lm b">has_many :books</code>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mz"><img src="../Images/bc345fcf0771f5e61dbba979cb9b0600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Z6iDu7xZ0IF_62JWT4Uupw.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">app/models/author.rb</figcaption></figure><p id="5b97" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="lw">注意:添加</em> <code class="du lj lk ll lm b"><em class="lw">has_many</em></code> <em class="lw">关联时，记得将模型复数化。</em></p><h2 id="dbd2" class="lr kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">向模型添加验证</h2><p id="649a" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">为了防止无效数据被保存到我们的数据库中，我们可以为我们的模型设置<a class="ae jn" href="https://guides.rubyonrails.org/active_record_validations.html" rel="noopener ugc nofollow" target="_blank">验证器</a>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es na"><img src="../Images/e59048df0346bb4c0d3278926e1e6795.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*sadwoHqj_2Iq9Xi3TPlVsg.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">app/models/author.rb</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nb"><img src="../Images/28055e95f95d569bae2ceda076667f1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wk0cvKKg79BkEEUY6l0C9Q.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">app/models/book.rb</figcaption></figure><h1 id="b6d0" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">3.启动数据库</h1><p id="9f84" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">为了启动数据库，我们需要创建数据库并迁移我们的更改以更新模式。</p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="4334" class="lr kl hi lm b fi ls lt l lu lv">$ rails db:create<br/>$ rails db:migrate</span></pre><p id="0e46" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">通过检查<code class="du lj lk ll lm b">db/schema.rb</code>中的模式，确认您的迁移已经发生。如果您发现您的一个表中缺少一列，不要手动更改<code class="du lj lk ll lm b">schema.rb</code>，因为它会破坏您的应用程序。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nc"><img src="../Images/8bbecf39a2569a19b72f4f44f533d8eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZeBad30IyDcD2lAk3x9Nhg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">db/schema.rb</figcaption></figure><h2 id="2821" class="lr kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">生成迁移</h2><p id="9f81" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">其中一个表中缺少一列？我们可以生成一个迁移来向表中添加一列。</p><p id="096b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="lw">注意:记住表名要用复数形式，以符合数据库惯例。</em></p><p id="f5eb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">模板:</strong></p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="e46b" class="lr kl hi lm b fi ls lt l lu lv">$ rails g migration add_<strong class="lm hj">&lt;COLUMN&gt;</strong>_to_<strong class="lm hj">&lt;TABLE NAME&gt;</strong> <strong class="lm hj">&lt;COLUMN&gt;:&lt;TYPE&gt;</strong></span></pre><p id="f709" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">例如:</strong></p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="c548" class="lr kl hi lm b fi ls lt l lu lv">$ rails g migration add_<strong class="lm hj">genre</strong>_to_<strong class="lm hj">books</strong> <strong class="lm hj">genre:string</strong></span></pre><p id="fce7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在生成您的迁移之后，只需运行<code class="du lj lk ll lm b">$ rails db:migrate</code>来迁移任何更改。</p><h1 id="4069" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">4.控制器</h1><p id="615e" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">既然我们已经建立了数据库，我们将需要一种API访问数据的方法。为此，我们需要设置控制器。</p><h2 id="dddd" class="lr kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">发电控制器</h2><p id="b370" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">顾名思义，我们的控制器容纳了所有的方法和动作，将充当集合的“控件”。</p><p id="e270" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="lw">注意:控制器名应该是复数，因为它包含集合的所有方法。</em></p><p id="f85d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">模板:</strong></p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="34ff" class="lr kl hi lm b fi ls lt l lu lv">$ rails g controller <strong class="lm hj">&lt;CONTROLLER NAME&gt;</strong></span></pre><p id="5795" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">示例:</strong></p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="4204" class="lr kl hi lm b fi ls lt l lu lv">$ rails g controller <strong class="lm hj">Authors<br/></strong>$ rails g controller <strong class="lm hj">Books</strong></span></pre><h2 id="860a" class="lr kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated"><strong class="ak">向控制器添加动作</strong></h2><p id="6e8f" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">生成控制器后，我们需要用我们希望API执行的动作填充控制器。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nd"><img src="../Images/0bfffe875e3210606b7eb320111fc793.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y9TLEuTEF5Je57RGVwJ4Bg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Routes and Controller Actions Reference</figcaption></figure><p id="0a65" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">遵循RESTful架构和CRUD惯例，我们可以使用上面的图表作为API中常见动作的参考。</p><p id="c747" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="lw">注意:这并不限制我们创建自己的自定义操作。如果您决定添加一个自定义操作，我们只需要在我们的路由中多做一点配置。</em></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ne"><img src="../Images/2f66c346e7ffa0e01e539924103666dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GxPEEpTulvIyTVsGku9G7Q.png"/></div></div></figure><h1 id="3972" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">5.路线</h1><p id="62d0" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">当设置<a class="ae jn" href="https://guides.rubyonrails.org/routing.html" rel="noopener ugc nofollow" target="_blank">路由</a>时，我们基本上是在设置API端点或URL，它们将分派某个动作来返回响应。</p><h2 id="1a32" class="lr kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">资源路由</h2><p id="756b" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">如果我们在设置控制器动作时遵循Rails喜欢的命名约定，我们就可以利用Rails的资源路由。导航到<code class="du lj lk ll lm b">config/routes.rb</code>并将<code class="du lj lk ll lm b">resources <strong class="jq hj">&lt;CONTROLLER NAME&gt;</strong></code>添加到您的路线中。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mz"><img src="../Images/0e23cab47907a55bc4720d32392b4f49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*NMpv5ZFV4mYpN7f1sHvGQQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">config/routes.rb</figcaption></figure><h2 id="fef5" class="lr kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">自定义路由</h2><p id="ffd3" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">如果您向控制器添加了一个自定义动作，并希望将该动作分派给一个<a class="ae jn" href="https://guides.rubyonrails.org/routing.html#non-resourceful-routes" rel="noopener ugc nofollow" target="_blank">自定义路线</a>，我们可以使用下面的模板。</p><p id="ae41" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">模板:</strong></p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="d19b" class="lr kl hi lm b fi ls lt l lu lv"><strong class="lm hj">&lt;HTTP VERB&gt;</strong> '<strong class="lm hj">&lt;PATH&gt;</strong>', to: '<strong class="lm hj">&lt;CONTROLLER&gt;#&lt;ACTION&gt;'</strong></span></pre><p id="c603" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">例如:</strong></p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="70f4" class="lr kl hi lm b fi ls lt l lu lv">get 'custom/path', to: 'authors#index'</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nf"><img src="../Images/ce5a08b8b1c5f59a192ca675664d9e5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*7w2D_JNoov_q_TFIooZ32A.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">config/routes.rb</figcaption></figure><h1 id="90ed" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">6.测试API</h1><p id="fd68" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">既然我们已经设置了路由，我们希望确保路由正常工作。然而，我们的数据库目前还没有任何数据可以发送回去。我们需要首先播种我们的数据库。</p><h2 id="8544" class="lr kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">种子数据库</h2><p id="620f" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">导航到<code class="du lj lk ll lm b">db/seeds.rb</code>，添加一些种子数据并运行<code class="du lj lk ll lm b">$ rails db:seed</code>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ng"><img src="../Images/45742934611d19ec59d82a5cd47388b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b52LAxz5HjNyp88-nh6J3g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">db/seeds.rb</figcaption></figure><h2 id="c7e0" class="lr kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">启动服务器</h2><p id="1330" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">一旦您的数据库被植入，通过在您的终端中运行<code class="du lj lk ll lm b">$ rails s</code>来启动服务器。默认情况下，您的Rails服务器应该在端口3000上启动。如果您想使用不同的端口，您可以添加<code class="du lj lk ll lm b">-p <strong class="jq hj">&lt;PORT NUMBER&gt;</strong></code> <strong class="jq hj"> </strong>标志来指定您希望您的服务器在哪个端口上运行。</p><p id="cfde" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">例如:</strong></p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="ad3b" class="lr kl hi lm b fi ls lt l lu lv">$ rails s -p 3000</span></pre><h2 id="6325" class="lr kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">测试终点</h2><p id="bfc4" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">一旦服务器运行，我们可以通过在浏览器中导航到<code class="du lj lk ll lm b"><a class="ae jn" href="http://localhost:3000/authors" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/authors</a></code>来检查作者的路线。</p><p id="1287" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="lw">注意:记住，我们的浏览器只能执行GET请求。如果想测试出其他请求，我推荐使用</em> <a class="ae jn" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> <em class="lw"> Postman </em> </a> <em class="lw">。</em></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nc"><img src="../Images/2c4d42bf7964e0b4d0667d3101bfd830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vWQNOwM0hVoO3Dk9nY14AQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">JSON response from /authors</figcaption></figure><p id="2272" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们得到了回应，这很好，但是我们播种的书在哪里呢？这就把我们带到了下一个话题，序列化器。</p><h1 id="9816" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">7.序列化程序</h1><p id="910b" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">序列化器允许我们以一种像我们这样的开发人员容易使用的方式格式化我们的数据。也许，有些东西我们想省略发回，如密码或无意义的元数据。</p><h2 id="8859" class="lr kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">装置</h2><p id="3aa7" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">我们将使用<a class="ae jn" href="https://rubygems.org/gems/active_model_serializers/versions/0.10.10" rel="noopener ugc nofollow" target="_blank">ActiveModelSerializer</a>gem。导航到您的<code class="du lj lk ll lm b">Gemfile</code>并添加<code class="du lj lk ll lm b">gem 'active_model_serializers'</code>作为依赖项。然后运行<code class="du lj lk ll lm b">$ bundle</code>来安装所有的依赖项。</p><h2 id="9d28" class="lr kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">生成序列化程序</h2><p id="a572" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">一旦安装了ActiveModelSerializer，我们就可以访问新的generate命令。</p><p id="7056" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">模板:</strong></p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="3097" class="lr kl hi lm b fi ls lt l lu lv">rails g serializer <strong class="lm hj">&lt;MODEL NAME&gt;</strong></span></pre><p id="d6e0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">例如:</strong></p><pre class="iy iz ja jb fd ln lm lo lp aw lq bi"><span id="57df" class="lr kl hi lm b fi ls lt l lu lv">rails g serializer author<br/>rails g serializer book</span></pre><h2 id="45f8" class="lr kl hi bd km lx ly lz kq ma mb mc ku jx md me kw kb mf mg ky kf mh mi la mj bi translated">序列化您的数据</h2><p id="0431" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">导航到位于<code class="du lj lk ll lm b">app/serializers</code>目录中的序列化器，添加或删除JSON响应中需要的属性。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nh"><img src="../Images/dae60e1e6b1e934ce2a0621f58d559bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7GrHoyBDx_dRtsTskgyD3w.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">app/serializer/author_serializer.rb</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ni"><img src="../Images/2c2ed9bd1caee9e23cb7c9987506eafb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OhWNxiRzWatw0ByiI1UXnQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">app/serializer/book_serializer.rb</figcaption></figure><p id="bc1b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">既然已经设置了序列化器，那么再次启动服务器并检查API的JSON响应。看起来很干净！</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nj"><img src="../Images/3239f0ba23584e6499ee72a19041a97f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZExgHHaVdMGBxenr2iw_9A.png"/></div></div></figure><h1 id="0e70" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">结论</h1><p id="2781" class="pw-post-body-paragraph jo jp hi jq b jr lc ij jt ju ld im jw jx le jz ka kb lf kd ke kf lg kh ki kj hb bi translated">希望本指南让您清楚地了解了如何启动自己的Rails API。能够构建自己的API肯定有它的好处，并为令人敬畏的项目创意开辟了许多机会。</p></div></div>    
</body>
</html>