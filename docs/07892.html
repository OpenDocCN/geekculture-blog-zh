<html>
<head>
<title>Hack This Site: Realistic Web Mission — Level 8</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客这个网站:现实的网络任务-第8级</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/hack-this-site-realistic-web-mission-level-8-938d6cb9f712?source=collection_archive---------12-----------------------#2021-10-05">https://medium.com/geekculture/hack-this-site-realistic-web-mission-level-8-938d6cb9f712?source=collection_archive---------12-----------------------#2021-10-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a67f014ddb9114d21f73c39fd8d141e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*abRgPpjEhqkZ6Fq3UfPdNg.png"/></div></div></figure><p id="2f70" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">嗨，谢谢你访问我的博客。今天我们来看看<a class="ae jo" href="https://hackthissite.org/" rel="noopener ugc nofollow" target="_blank">黑掉这个网站</a>现实网络任务第8关。这项任务要求我们执行SQL注入以获取受害者的用户名。一旦我们有了用户名，我们需要注册一个帐户并操作cookies，以便从受害者的帐户转移一千万美元到我们客户的帐户。之后，我们需要通过删除日志文件来隐藏我们邪恶行为的所有证据。如果你没有看过我在现实系列上的其他帖子，你可以在这里看到:<a class="ae jo" href="https://haxez.org/2021/09/hack-this-site-realistic-web-missions-level-1/" rel="noopener ugc nofollow" target="_blank">第一部分</a>、<a class="ae jo" href="https://haxez.org/2021/09/hack-this-site-realistic-web-mission-level-2/" rel="noopener ugc nofollow" target="_blank">第二部分</a>、<a class="ae jo" href="https://haxez.org/2021/09/hack-this-site-realistic-web-mission-level-3/" rel="noopener ugc nofollow" target="_blank">第三部分</a>、<a class="ae jo" href="https://haxez.org/2021/09/hack-this-site-realistic-web-mission-level-4/" rel="noopener ugc nofollow" target="_blank">第四部分</a>、<a class="ae jo" href="https://haxez.org/2021/09/hack-this-site-realistic-web-mission-level-5/" rel="noopener ugc nofollow" target="_blank">第五部分</a>、<a class="ae jo" href="https://haxez.org/2021/09/hack-this-site-realistic-web-mission-level-6/" rel="noopener ugc nofollow" target="_blank">第六部分</a>和<a class="ae jo" href="https://haxez.org/2021/10/hack-this-site-realistic-web-mission-level-7/" rel="noopener ugc nofollow" target="_blank">第七部分</a>。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es jp"><img src="../Images/590c04e24dc34bfaf8f2b6c5b4e259d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*zxogWiOPlyx_7qvR"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">United Banks of America</figcaption></figure><h1 id="5f84" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">介绍</h1><p id="b38c" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">我们收到了黑暗之王发来的信息。该消息解释说，一位名叫加里·亨特的企业家将一千万美元存入了他的美国联合银行账户。存款的目的是为了让他能把钱捐给一项运动。这场运动的目标是追捕并锁定黑客。客户希望我们闯进去偷这笔钱。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es jp"><img src="../Images/ecfc91d0e67458d37f5769be0483830d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*x7LX7PThrLnoJP-z"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Message From DarkOneWithANeed</figcaption></figure><h1 id="2c16" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">探索Web应用程序</h1><p id="43fc" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">首先，让我们看看应用程序，看看我们在处理什么。乍一看，这个web应用程序似乎相当简单。它有许多页面，包括主页、登录、注册、帮助和用户信息。如果我们回头看这条消息，第一个挑战是找到Gary Hunter的帐户。幸运的是，似乎有一个用户信息页面。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/ba5e15e000b013d255ec98362592d8a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*zXVERr9H0q8LcVf4"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Web Application — United Banks of America</figcaption></figure><h1 id="f776" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">Web应用程序用户信息SQL注入</h1><p id="be6e" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">用户信息页面允许我们搜索用户。然而，如果我们搜索Gary这个名字，我们会得到一个用户返回。我们可以尝试搜索字母A，希望它会返回名称中带有A的所有用户，但这不起作用。如果我们输入一个单引号，就会得到一个SQL错误，说明从表“users”中获取用户名信息时出现了问题。这表明该应用程序易受SQL注入攻击。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/67f1e6a1699ce88c9c13feea26bf235b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*vVIlH6MmY9pJ8oJH"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Web Application — User Info SQL Error</figcaption></figure><p id="1d72" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们在搜索框中使用下面的有效载荷，我们应该得到一个用户列表。这样做的原因是我们避开了语法，添加了我们自己的语法，并注释掉了其余的语法。我们的语法是告诉SQL server返回用户“a”或任何为真(存在)的内容。</p><pre class="jq jr js jt fd lc ld le lf aw lg bi"><span id="be63" class="lh jz hi ld b fi li lj l lk ll">' or 1=1 --</span></pre><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/538370efcad6508577a29ecaf63b5d08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*E-Yn8Fsv0HtxTHw0"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Web Application — SQL Injection</figcaption></figure><p id="cbfe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦我们提交了有效负载，我们应该得到一个返回的用户列表。如果我们在键盘上按ctrl+f，我们可以搜索加里。第一个结果应该是我们的受害者加里·亨特。将他的名字和–$ $ $ $-值复制并粘贴到您的笔记中，因为我们稍后会用到它。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/13fbea48c30748e46eed0edbd00f64a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*dekBnYX4nnGRTGGc"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">SQL Injection — Results</figcaption></figure><h1 id="71dd" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">移动资金Cookie操作</h1><p id="6eb3" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">现在我们有了受害者的用户名，我们需要把一千万美元从他们的账户转到我们客户的账户。为了做到这一点，我们需要注册自己的帐户，看看我们有什么功能。我注册了用户名哈克斯。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/6d1b122ff5d6614d89f5d923b77dd5cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*conyGizfVUFUqbf4"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Web Application — Register Account</figcaption></figure><p id="5a86" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建帐户后，登录。您应该看到您有您的帐户信息和两个选项。清除个人文件夹中的文件，并将资金转移到不同的帐户。不幸的是，就像在现实生活中一样，我们的银行账户里没有钱。然而，也许我们有办法欺骗网络应用程序，让它认为我们是加里·亨特。如果我们预先填充移动资金选项，并加载我们最喜欢的web应用程序渗透测试工具Burp Suite。我们可以在请求发送到服务器之前拦截它。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/05b068442fde1679455304d4655e48be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*G4I_CSsJUAXepsp6"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Web Application — Move Money</figcaption></figure><p id="786c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦您填充了“移动资金”参数，请确保Burp Suite intercept处于打开状态，然后单击“移动资金”按钮。你应该会看到一个像下面这样的窗口(取决于你的主题，黑暗模式规则)。如果我们分析该请求，您可以看到该请求被发送到movemoney.php。请求的内容是两个参数，<code class="du lm ln lo ld b"><em class="lp">TO=dropCash</em></code>和<code class="du lm ln lo ld b">AMOUNT=1000000000</code>。然而，值一千万可能看起来很奇怪，因为它是URL编码的。您还应该看到有许多cookies。我们想要操作的cookies是“<code class="du lm ln lo ld b">accountUsername</code>和“<code class="du lm ln lo ld b">accountPassword"</code>”。幸运的是，Burp允许我们在提交之前直接修改这些值。编辑cookies并用我们从SQL注入(<code class="du lm ln lo ld b">accountUsername=GaryWilliamHunter; accountPassword=-- $$$$$ --;</code>)获得的值替换它们。转发请求。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/23503e5325b164704d7683500390da51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*MhZEQetKnjqUXLTB"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Request — Interception</figcaption></figure><h1 id="f637" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">Web应用程序清除文件黑客</h1><p id="af66" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">既然我们犯下了世纪罪行，我们需要掩盖我们的痕迹。客户的电子邮件告诉我们，日志保存在一个名为logFiles的目录中。转移资金后，您将从应用程序中注销。重新登录到应用程序，并再次打开打嗝拦截。单击“清除个人文件夹中的文件”按钮。跳回打嗝，你应该看到请求。在标题的底部，您会看到参数<code class="du lm ln lo ld b">dir=&lt;usernameSQLFiles&gt;</code>。将该值更改为logFiles并转发请求。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/bd335035e4c96d34da74f0061fd5ea4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*UQzbWU49groZlSVf"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Request — Modification</figcaption></figure><p id="a5d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之后，你可以回到你的浏览器，你应该看到你已经成功地完成了任务。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/69fb1412c8d251977bb897fba7b74c1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*tBXjTriw41XYsJB1"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Congratulations</figcaption></figure><h1 id="06c3" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">结论</h1><p id="14d5" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">这是一个有趣的挑战，让我们再次戴上义务黑客的帽子。虽然该应用程序已经过时，但它证明了糟糕的设计选择会导致安全性方面的缺陷。SQL注入是可能的，因为应用程序没有使用准备好的语句。这可以通过类似下面的方法来缓解。</p><pre class="jq jr js jt fd lc ld le lf aw lg bi"><span id="767b" class="lh jz hi ld b fi li lj l lk ll">$stmt = $conn-&gt;prepare"SELECT FROM Users (Username, Description) VALUES (?)"0;</span><span id="0662" class="lh jz hi ld b fi lq lj l lk ll">$stmt-&gt;bind_param("s", $Username, $Description);</span></pre><p id="3d4c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用于转移资金的cookie操作是一种有趣的技术。这是为什么会话令牌和反跨站点请求伪造令牌很重要的一个例子。通过使用唯一的非描述性cookie和服务器端检查来验证这些cookie，您可以确保恶意威胁参与者无法劫持其他用户的会话，或者在这种情况下，无法冒充用户并提交数据。</p><p id="a063" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">清除日志文件表单上的目录操作是另一个很好的例子，说明了为什么从用户浏览器传输的任何内容都不应该被信任。数据可能被操纵，并产生意想不到的后果。这可以通过使用会话令牌来引用存储在服务器端缓存中的属性来缓解。也可以通过在处理值之前对其进行验证来缓解这一问题。</p><p id="67bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">无论如何，我希望你喜欢这篇文章。下次回来，我们将看看现实9。</p><figure class="jq jr js jt fd ij"><div class="bz dy l di"><div class="lr ls l"/></div></figure></div></div>    
</body>
</html>