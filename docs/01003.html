<html>
<head>
<title>Clock, Time, Timer, Delay, Duration, Moment, Start, Begin, End, Schedule?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时钟，时间，计时器，延迟，持续时间，时刻，开始，开始，结束，时间表？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/clock-time-timer-delay-duration-moment-start-begin-end-schedule-e780d8e4fe49?source=collection_archive---------21-----------------------#2021-03-23">https://medium.com/geekculture/clock-time-timer-delay-duration-moment-start-begin-end-schedule-e780d8e4fe49?source=collection_archive---------21-----------------------#2021-03-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="b382" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">时序逻辑和动画</h2></div><p id="0f08" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">像电子游戏这样的程序有复杂的逻辑(力学)和动画。在这篇文章中，我们将研究一些关于时间的原则。这个题目并不难，但是如果我们不遵循一些基本的规则，可能会非常棘手。</p><p id="b169" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本文适用于任何编程语言，但有几个部分是特定于JavaScript的。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/c47b4526d06beab6a29e448e9159a0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HMVKtJzCX28EXZZV"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Photo by <a class="ae kj" href="https://unsplash.com/@andriklangfield?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Andrik Langfield</a> on <a class="ae kj" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="d831" class="kk kl hi bd km kn ko kp kq kr ks kt ku jg kv kw kx jk ky kz la jo lb lc ld le bi translated">小型会议</h2><p id="e0c0" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">本文中的“<strong class="iz hj">力学</strong>一词指的是游戏逻辑；例如，化身有多少生命。而<strong class="iz hj">动画</strong>一词仅指视觉方面；绘制在游戏画布上的精灵。动画应该与机械相匹配。</p><h1 id="35fe" class="lk kl hi bd km ll lm ln kq lo lp lq ku io lr ip kx ir ls is la iu lt iv ld lu bi translated">主循环(计时的基石)</h1><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lv"><img src="../Images/d15e48fcd99708b9f159ccd7bd3964ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*Zkj0b7kbwrxxpY0P_DOpbg.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx">The main loop</figcaption></figure><p id="8cd0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">像视频游戏这样的程序有一个主要的功能，它以固定的、非常小的时间间隔运行。程序的所有功能都包含在这个主函数中。</p><p id="0e2b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在上面的代码中，<strong class="iz hj"><em class="lw">requestAnimationFrame</em></strong><em class="lw"/>(浏览器中的JavaScript)<em class="lw"/>负责让main函数另一次运行。那下次吧。然后另一次…</p><p id="17da" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"><em class="lw">requestAnimationFrame</em></strong><em class="lw"/>尝试每隔16.666毫秒触发一次主循环执行，使游戏以60 FPS(每秒帧数)运行。</p><p id="ee0c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于主循环的控制，<em class="lw"/><strong class="iz hj"><em class="lw">setTimeout</em></strong><em class="lw"/>为<strong class="iz hj">废弃</strong>。它的替换是<strong class="iz hj"><em class="lw">requestAnimationFrame</em></strong><em class="lw"/>(你可以在别处读到重要原因)。</p><p id="e077" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最重要的是，<strong class="iz hj">永远不要</strong>使用<strong class="iz hj"><em class="lw">setInterval</em></strong>(JavaScript)，因为你可能会在当前循环完成之前触发一个新的主循环，<strong class="iz hj">会严重膨胀</strong>程序的执行。</p><blockquote class="lx"><p id="cb68" class="ly lz hi bd ma mb mc md me mf mg js dx translated">我们有一个主循环(只有一个)和一个(只有一个)机制让它按顺序运行<strong class="ak"/>。</p></blockquote><p id="b069" class="pw-post-body-paragraph ix iy hi iz b ja mh ij jc jd mi im jf jg mj ji jj jk mk jm jn jo ml jq jr js hb bi translated">注意，我们并不依赖于传统的循环语句，如<strong class="iz hj"> <em class="lw">而</em> </strong>或<strong class="iz hj"> <em class="lw"> for </em> </strong>来构造主循环。</p><h1 id="d2a4" class="lk kl hi bd km ll lm ln kq lo lp lq ku io lr ip kx ir ls is la iu lt iv ld lu bi translated">最简单的计时机制</h1><p id="5720" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">最简单的计时机制就是每次主循环运行时执行一些东西；不需要检查主循环计数器。</p><p id="7b67" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如:<em class="lw"> runMainLoop </em>调用<em class="lw">updated creatures，</em>每移动一个向左移动的生物，X坐标减一。当程序以每秒60帧的速度运行时，一秒钟后，一个生物将向左移动60个像素。</p><p id="aaa9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我的代码中，对游戏循环执行进行计数的全局变量的名称是“loop”(清晰、简短、粗体)，打破了大写名称为常量保留的惯例，因为它如此重要且无处不在。对于其他非常重要的全球旗帜，我也遵循这种命名方式。</p><h1 id="6d15" class="lk kl hi bd km ll lm ln kq lo lp lq ku io lr ip kx ir ls is la iu lt iv ld lu bi translated">主循环计数器为王</h1><p id="030e" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">每一个比上面显示的最简单的计时机制要求更多的计时功能将<strong class="iz hj">直接或间接依赖于主循环计数器，除此之外别无其他</strong>。我们将逐案研究。</p><h2 id="f5c4" class="kk kl hi bd km kn ko kp kq kr ks kt ku jg kv kw kx jk ky kz la jo lb lc ld le bi translated">忘记setTimeout和setInterval</h2><p id="e1d3" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">虽然依靠主循环计数器是一个清晰、健壮、足够的策略，但有时，在游戏开发的后期，我们可能会忍不住用<strong class="iz hj"> <em class="lw"> setTimeout </em> </strong> <em class="lw">处理一个简短的、附带的动画。</em>因为非常容易，所以我们不需要思考(或者改编)整个动画逻辑。千万别这么做。它可能看起来像一个小的、无害的、离散的过程，但是它是一个使你的程序变得混乱的变通方法:它很可能会与程序使用的数十个其他计时器发生冲突。在使用<strong class="iz hj"> <em class="lw"> setInterval </em> </strong>的情况下，解决方法要糟糕得多。</p><p id="9379" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> <em class="lw"> setTimeout </em> </strong>和<em class="lw"/><strong class="iz hj"><em class="lw">setInterval</em></strong>打破了<strong class="iz hj">通过<strong class="iz hj">循环</strong>处理游戏机制和动画的模式</strong>。</p><p id="8400" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些功能对于传统的网页来说非常好。句号。</p><blockquote class="lx"><p id="5faf" class="ly lz hi bd ma mb mc md me mf mg js dx translated">拥有并行/并发的计时系统是很麻烦的。</p></blockquote><h1 id="ff34" class="lk kl hi bd km ll lm ln kq lo lp lq ku io mm ip kx ir mn is la iu mo iv ld lu bi translated">毫秒计时</h1><p id="1b8d" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">我们编写代码计数循环的事实并不意味着我们不用秒来思考。一个简单的数学将毫秒转换成循环。例如，应该每秒运行四次的函数被调整为在十五个循环的间隔内触发。</p><h1 id="8336" class="lk kl hi bd km ll lm ln kq lo lp lq ku io lr ip kx ir ls is la iu lt iv ld lu bi translated">使用主循环计数器的基本方式</h1><p id="ef15" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">为每种样式选择一个(<strong class="iz hj">小</strong>和<strong class="iz hj">明显</strong>)后缀，并保留它，这是一个很好的做法。否则一个有几十种计时机制的程序将很难理解和维护。我用“时钟”和“计时器”。</p><h2 id="8d2e" class="kk kl hi bd km kn ko kp kq kr ks kt ku jg kv kw kx jk ky kz la jo lb lc ld le bi translated">计时器样式</h2><p id="a0a1" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated"><em class="lw">如果当前循环号</em> <strong class="iz hj"> <em class="lw">等于</em> </strong> <em class="lw">的存储值，我们执行一些功能。</em></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lv"><img src="../Images/a51178872d2560973f722f90ec9ae8a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*AzoFARm4P80F6yGOc4f8ww.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx">Using timer</figcaption></figure><p id="c671" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面的代码是迷失在迷宫中的浏览器游戏<a class="ae kj" href="https://www.lostinmaze.com/" rel="noopener ugc nofollow" target="_blank">的简化版代码。</a></p><p id="f898" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用计时器就像在现实生活中使用计时器一样:我们现在就设定未来某件事应该发生的时刻。</p><p id="654b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我认为后缀“计时器”是最适合这种情况的，比“时钟”或“开始”更清晰和精确。“开始”是动词；它更适合作为启动某事的函数的后缀(例如<em class="lw"> startPoisonAnimation </em>)。我认为“开始”和“结束”是一样的。</p><p id="773f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="lw"> updatePoisoning </em>是一个关于力学的函数，它触发一个动画函数:<em class="lw"> startPoisonAnimation </em>(它有自己的计时机制，也是基于循环的)。</p><p id="e19a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个计时器使用起来非常简单。一旦设定好了，就没什么好讲道理的了。这是控制中毒的完美方法，即使在第一次中毒结束前一个生物再次中毒。只是覆写<em class="lw">生物.中毒</em>和<em class="lw">生物.中毒计时器</em>(在施加第二次中毒的初始伤害后)。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es mp"><img src="../Images/262d5f536b18f1903ea04e33b8e99eed.png" data-original-src="https://miro.medium.com/v2/resize:fit:318/format:webp/1*Zk4fkwEhpqOb-48Qaq2W8g.jpeg"/></div><figcaption class="kf kg et er es kh ki bd b be z dx">Timer</figcaption></figure><h2 id="b81d" class="kk kl hi bd km kn ko kp kq kr ks kt ku jg kv kw kx jk ky kz la jo lb lc ld le bi translated">时钟样式</h2><p id="7b83" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated"><em class="lw">我们</em><strong class="iz hj"><em class="lw"/></strong><em class="lw">如果当前循环次数是</em><strong class="iz hj"><em class="lw"/></strong><em class="lw"/><strong class="iz hj"><em class="lw">等于</em> </strong> <em class="lw">给一个记忆值加上某个常数就不执行某个功能。</em></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lv"><img src="../Images/1ecb08a0aff95fa28d8a1f9f1a9b45e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*i2WPloi1TMNEjDBFWFHikQ.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx">Using clock</figcaption></figure><p id="dca5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面我们看到了另一个简化版的迷宫游戏的代码。</p><p id="7ab2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在计时器不好用了。我们没有设定未来的时刻。我们正在<strong class="iz hj">记录</strong>当前时刻，以便将来评估。后缀“clock”适用于过去的某个时刻(就像我们将来会理解的那样)。“时刻”可以，但有点长。“开始”和“开始”是动词。我认为“计时器”和“时钟”是很好的一对。</p><p id="3042" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可能会说我们不需要时钟风格，我们可以用定时器风格做任何事情，反之亦然。在这种情况下，我不得不反对:</p><ol class=""><li id="4e7d" class="mq mr hi iz b ja jb jd je jg ms jk mt jo mu js mv mw mx my bi translated">语义对于可读和可维护的代码非常重要。因此，创造一个<em class="lw">攻击计时器</em>(意味着生物冷却的时间)而不是<em class="lw">攻击时钟</em>是违反直觉的。也许把后缀改成<em class="lw"> attackDelayer </em> …反正不会比<em class="lw"> attackClock </em>好。</li></ol><p id="2968" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.有时候，在一个程序中，我们不能只覆盖定时器值。为了执行一些评估，我们需要知道过去的值(时钟)。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es mz"><img src="../Images/7bf1b2b1f0be794d4f99eabcddd2ca0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*vV1_8RMDhdCKPX6tI6iS0A.jpeg"/></div><figcaption class="kf kg et er es kh ki bd b be z dx">Clock</figcaption></figure><h2 id="d42a" class="kk kl hi bd km kn ko kp kq kr ks kt ku jg kv kw kx jk ky kz la jo lb lc ld le bi translated">更多关于名称:时间，延迟，持续时间，循环</h2><p id="c709" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">“时间”、“延迟”、“持续时间”和“循环”是指代没有以“定时器”或“时钟”为后缀的事物的好名字。</p><p id="a44f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我一直在介绍我个人对时间命名的习惯。当然，你可能会随心所欲地改编，甚至根本不用。</p><h1 id="8fea" class="lk kl hi bd km ll lm ln kq lo lp lq ku io lr ip kx ir ls is la iu lt iv ld lu bi translated">时间表</h1><p id="315f" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">还记得关于使用<strong class="iz hj"> <em class="lw"> setTimeout </em> </strong>制作一个小的侧面动画的部分吗？我们现在做的是:</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lv"><img src="../Images/8796bab8d881bdc95fa12fc202b0da3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*1Em9jjOsmSSeQoug6ZY1Tg.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx">The schedule</figcaption></figure><p id="3023" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">函数<em class="lw"> scheduleByTime </em>是我们自己的<strong class="iz hj"> <em class="lw"> setTimeout </em> </strong>函数，完全在我们的控制之下，完全基于循环。</p><p id="029a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">函数<em class="lw"> updateSchedule </em>由函数<em class="lw"> runMainLoop </em>调用，它运行每个循环。</p><h1 id="fa6e" class="lk kl hi bd km ll lm ln kq lo lp lq ku io lr ip kx ir ls is la iu lt iv ld lu bi translated">“计时”结束</h1><p id="620f" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">就是这样。</p><p id="de5f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望你喜欢！</p></div></div>    
</body>
</html>