<html>
<head>
<title>3 Steps To Auto-Install K8S with Cloud-config</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用云配置自动安装K8S的3个步骤</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/5-steps-to-auto-install-k8s-with-cloud-config-ad2935c559c7?source=collection_archive---------20-----------------------#2021-08-03">https://medium.com/geekculture/5-steps-to-auto-install-k8s-with-cloud-config-ad2935c559c7?source=collection_archive---------20-----------------------#2021-08-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="48f5" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">第1部分:自动安装，从头开始配置K8S集群“适合初学者”</h2></div><blockquote class="ix iy iz"><p id="ec6c" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">我:“儿子，你能帮我安装一下<strong class="jd hj"> K8S集群</strong>吗😆？?"</p><p id="b735" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">儿子:"<strong class="jd hj">上Prod Env </strong>！😲"</p><p id="c190" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">我:“Yes Plz！！这事儿<strong class="jd hj">比你</strong>想的<strong class="jd hj">容易</strong>😉"</p></blockquote><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es jx"><img src="../Images/10abb8dd1b717371dcf92110ac822cfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d2G5pxCptBLaoNmUKimArg.jpeg"/></div></div><figcaption class="kj kk et er es kl km bd b be z dx"><strong class="bd kn">We'll Do It</strong></figcaption></figure></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><p id="1d5f" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kv jl jm jn kw jp jq jr kx jt ju jv jw hb bi translated">从头开始安装K8S集群是一项具有挑战性的工作😫，官方文件<strong class="jd hj"> k8s </strong>太大，信息<strong class="jd hj">的<strong class="jd hj">件</strong>分发给不同的部分😅，所以对于想从<strong class="jd hj">开始学</strong>这种<strong class="jd hj">技术的人来说，要花<strong class="jd hj">多</strong>的时间去<strong class="jd hj">搜索</strong>、<strong class="jd hj">了解</strong>、<strong class="jd hj">安装</strong>、<strong class="jd hj">配置</strong>。</strong></strong></p><p id="5f85" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kv jl jm jn kw jp jq jr kx jt ju jv jw hb bi translated">我以一个与我三岁的儿子的对话开始这个故事，来证明在一个相似的生产环境中安装一个T42 K8S集群比你想象的要容易得多😝。</p><p id="a94d" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kv jl jm jn kw jp jq jr kx jt ju jv jw hb bi translated"><strong class="jd hj">目标</strong>在<strong class="jd hj">首先</strong>是<strong class="jd hj">通过简化K8S集群在<strong class="jd hj">类似生产环境</strong>中的安装和配置，让初学者</strong>熟悉这个<strong class="jd hj">环境</strong></p><p id="8fc8" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kv jl jm jn kw jp jq jr kx jt ju jv jw hb bi translated">你可以在这里找到奖金的例子👌：</p><div class="ky kz ez fb la lb"><a href="https://naoufal-gafa.medium.com/3-steps-to-auto-install-k8s-with-cloud-config-1c4f9a6ba572" rel="noopener follow" target="_blank"><div class="lc ab dw"><div class="ld ab le cl cj lf"><h2 class="bd hj fi z dy lg ea eb lh ed ef hh bi translated">使用云配置自动安装K8S的3个步骤</h2><div class="li l"><h3 class="bd b fi z dy lg ea eb lh ed ef dx translated">第2部分:部署额外示例K8S集群“面向初学者”</h3></div><div class="lj l"><p class="bd b fp z dy lg ea eb lh ed ef dx translated">naoufal-gafa.medium.com</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp kh lb"/></div></div></a></div><p id="f7c5" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kv jl jm jn kw jp jq jr kx jt ju jv jw hb bi translated">我们开始吧😁</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="5c4c" class="lq lr hi bd kn ls lt lu lv lw lx ly lz io ma ip mb ir mc is md iu me iv mf mg bi translated">语境</h1><p id="ccee" class="pw-post-body-paragraph ja jb hi jd b je mh ij jg jh mi im jj kv mj jm jn kw mk jq jr kx ml ju jv jw hb bi translated">对于<strong class="jd hj">学习环境，</strong>你可以使用<code class="du mm mn mo mp b"><strong class="jd hj">minikube</strong></code> <strong class="jd hj">、</strong> <code class="du mm mn mo mp b"><strong class="jd hj">micro-k8s</strong></code>或者<code class="du mm mn mo mp b"><strong class="jd hj">kind</strong></code>，这三个都是快速安装配置<strong class="jd hj"> Kubernetes </strong>，不需要一些高级的系统配置。</p><p id="db2e" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kv jl jm jn kw jp jq jr kx jt ju jv jw hb bi translated">然而，在<strong class="jd hj">生产环境</strong>中，我们有3种方法可以做到:</p><ul class=""><li id="0112" class="mq mr hi jd b je jf jh ji kv ms kw mt kx mu jw mv mw mx my bi translated"><code class="du mm mn mo mp b"><strong class="jd hj">kubeadm</strong></code></li><li id="9ec8" class="mq mr hi jd b je mz jh na kv nb kw nc kx nd jw mv mw mx my bi translated"><code class="du mm mn mo mp b"><strong class="jd hj">kops</strong></code></li><li id="ba2e" class="mq mr hi jd b je mz jh na kv nb kw nc kx nd jw mv mw mx my bi translated"><code class="du mm mn mo mp b"><strong class="jd hj">kubesray</strong></code></li></ul><p id="1fef" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kv jl jm jn kw jp jq jr kx jt ju jv jw hb bi translated">我将通过使用<strong class="jd hj">虚拟机、</strong>和的<strong class="jd hj">自定义数据</strong>(对于其他云提供商为<a class="ae ne" href="https://cloudinit.readthedocs.io/en/latest/topics/format.html#user-data-formats" rel="noopener ugc nofollow" target="_blank"> <strong class="jd hj">用户数据</strong> </a>)上的<a class="ae ne" href="https://cloudinit.readthedocs.io/en/latest/topics/format.html#cloud-config-data" rel="noopener ugc nofollow" target="_blank"> <strong class="jd hj">云配置数据</strong> </a> <strong class="jd hj"> </strong>来简化设置我们的PAAS <strong class="jd hj"> K8S </strong>和<strong class="jd hj">两个Azure虚拟机</strong>(您可以选择任何其他云提供商虚拟机)😇。</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><blockquote class="ix iy iz"><p id="9236" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">先决条件:</p><p id="e0f6" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">→ Azure帐户(或创建一个)</p></blockquote></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="06d7" class="lq lr hi bd kn ls lt lu lv lw lx ly lz io ma ip mb ir mc is md iu me iv mf mg bi translated">步骤1:创建网络安全组</h1><p id="32f2" class="pw-post-body-paragraph ja jb hi jd b je mh ij jg jh mi im jj kv mj jm jn kw mk jq jr kx ml ju jv jw hb bi translated">在创建虚拟机之前，让我们创建将用于不同机器的所需的<strong class="jd hj">网络安全组(NSG) </strong>:</p><ul class=""><li id="e306" class="mq mr hi jd b je jf jh ji kv ms kw mt kx mu jw mv mw mx my bi translated">转到网络安全组并创建这两个NSG，如下图所示:</li></ul><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es nf"><img src="../Images/ba7e549d291e2395de66293ee73c4e63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N9qAOcgjhnKkRd7wWErXQA.jpeg"/></div></div><figcaption class="kj kk et er es kl km bd b be z dx">Network Security Group</figcaption></figure><ul class=""><li id="5a7a" class="mq mr hi jd b je jf jh ji kv ms kw mt kx mu jw mv mw mx my bi translated"><code class="du mm mn mo mp b"><strong class="jd hj">medium-k8s-master-nsg</strong></code>将被附加到<strong class="jd hj">控制平面节点(VM)的网络接口</strong><strong class="jd hj">→</strong>入站安全规则必须满足<a class="ae ne" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#check-required-ports" rel="noopener ugc nofollow" target="_blank"> k8s要求</a>，你应该<strong class="jd hj">打开</strong>这些<strong class="jd hj">端口</strong> : <strong class="jd hj"> 6443 </strong>，<strong class="jd hj">2379–2380</strong>，<strong class="jd hj"> 10250- 10251 </strong></li></ul><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es ng"><img src="../Images/458e1b22e19e80bba9b37ed7fc87fdb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IZSCJyXw7ndO6BNdndeS-A.jpeg"/></div></div><figcaption class="kj kk et er es kl km bd b be z dx">medium-k8s-master-nsg</figcaption></figure><ul class=""><li id="5a34" class="mq mr hi jd b je jf jh ji kv ms kw mt kx mu jw mv mw mx my bi translated"><code class="du mm mn mo mp b"><strong class="jd hj">medium-k8s-worker-nsg</strong></code>将被附加到<strong class="jd hj">网络接口的工作节点(VM) → </strong>入站安全规则必须满足<a class="ae ne" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#check-required-ports" rel="noopener ugc nofollow" target="_blank"> k8s要求</a>，你应该<strong class="jd hj">打开</strong>这些<strong class="jd hj">端口</strong> : 10250，30000–32767</li></ul><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es nh"><img src="../Images/5d62872faac92a78b1a2f435cf72a0e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AUMdr7XFcMI2AyULDrlRAA.jpeg"/></div></div><figcaption class="kj kk et er es kl km bd b be z dx"><strong class="bd kn">medium-k8s-workers-nsg</strong></figcaption></figure><blockquote class="ix iy iz"><p id="3080" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">对于这两者，不要忘记打开ssh😉</p></blockquote><h1 id="5498" class="lq lr hi bd kn ls ni lu lv lw nj ly lz io nk ip mb ir nl is md iu nm iv mf mg bi translated">步骤2:在Azure上创建虚拟机:</h1><p id="4213" class="pw-post-body-paragraph ja jb hi jd b je mh ij jg jh mi im jj kv mj jm jn kw mk jq jr kx ml ju jv jw hb bi translated">所有<strong class="jd hj">虚拟机</strong>将运行最新<strong class="jd hj">版本</strong>的<strong class="jd hj"> Ubuntu </strong>并且根据<a class="ae ne" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#before-you-begin" rel="noopener ugc nofollow" target="_blank"> <strong class="jd hj">文档</strong> </a>它们必须至少拥有:RAM≥<strong class="jd hj">2gb</strong>&amp;<strong class="jd hj">CPU</strong>≥<strong class="jd hj">2个CPU</strong></p><blockquote class="ix iy iz"><p id="0cf1" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">如果你用Azure创建了一个新帐户，你将有<strong class="jd hj"> 12个月</strong>的<strong class="jd hj"> 750小时</strong>Linux虚拟机<strong class="jd hj">免费</strong>和<strong class="jd hj"> 200美元信用</strong>用于<strong class="jd hj"> 30天</strong>测试<strong class="jd hj"> Azure付费服务</strong>，如我们将在本教程中使用的<strong class="jd hj">虚拟机</strong>😉</p></blockquote><p id="8592" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kv jl jm jn kw jp jq jr kx jt ju jv jw hb bi translated">转到虚拟机，点击<strong class="jd hj">“创建”</strong>、<strong class="jd hj">“虚拟机”。</strong>通过配置虚拟机创建的每个选项卡，尝试遵循以下步骤👌。</p><h2 id="0350" class="nn lr hi bd kn no np nq lv nr ns nt lz kv nu nv mb kw nw nx md kx ny nz mf oa bi translated">1.基本选项卡:</h2><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es ob"><img src="../Images/a86a93471c8a240512fcb8847626d8a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ij-tq99Tar7Kuj-LE01R-Q.jpeg"/></div></div><figcaption class="kj kk et er es kl km bd b be z dx"><strong class="bd kn">Basic Configuration — 1</strong></figcaption></figure><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es oc"><img src="../Images/d9c340a8b43b39b48c7f8a99fe4e395f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XO7Z9HAXvb95a6q1Gy8yBA.jpeg"/></div></div><figcaption class="kj kk et er es kl km bd b be z dx"><strong class="bd kn">Basic Configuration — 2</strong></figcaption></figure><h2 id="a7b8" class="nn lr hi bd kn no np nq lv nr ns nt lz kv nu nv mb kw nw nx md kx ny nz mf oa bi translated">2.网络选项卡</h2><p id="095e" class="pw-post-body-paragraph ja jb hi jd b je mh ij jg jh mi im jj kv mj jm jn kw mk jq jr kx ml ju jv jw hb bi translated">转到“网络”选项卡，选择之前创建的NSG:</p><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es od"><img src="../Images/f84f6131cbbc010ca854203dace54935.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GDjlXVxWe_jOar7wRl3bZA.jpeg"/></div></div><figcaption class="kj kk et er es kl km bd b be z dx"><strong class="bd kn">Link NSG</strong></figcaption></figure><blockquote class="ix iy iz"><p id="d8cb" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">现在是时候转到<strong class="jd hj">高级选项卡</strong>并将<strong class="jd hj">“魔法代码”</strong>粘贴到<strong class="jd hj">自定义数据</strong>上了</p></blockquote><h2 id="621d" class="nn lr hi bd kn no np nq lv nr ns nt lz kv nu nv mb kw nw nx md kx ny nz mf oa bi translated">3.高级选项卡</h2><p id="1996" class="pw-post-body-paragraph ja jb hi jd b je mh ij jg jh mi im jj kv mj jm jn kw mk jq jr kx ml ju jv jw hb bi translated">这段代码将<strong class="jd hj">更新</strong> &amp; <strong class="jd hj">升级</strong>系统，安装<code class="du mm mn mo mp b"><strong class="jd hj">docker, kubeadm, kubelet, and kubectl</strong></code>，并<a class="ae ne" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#letting-iptables-see-bridged-traffic" rel="noopener ugc nofollow" target="_blank"> <strong class="jd hj">让</strong> </a> <code class="du mm mn mo mp b"><a class="ae ne" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#letting-iptables-see-bridged-traffic" rel="noopener ugc nofollow" target="_blank"><strong class="jd hj">iptables</strong></a></code> <a class="ae ne" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#letting-iptables-see-bridged-traffic" rel="noopener ugc nofollow" target="_blank"> <strong class="jd hj">看到桥接的流量</strong> </a>。</p><blockquote class="ix iy iz"><p id="66b7" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">为了更好地理解，我对这个文件的每个步骤和命令都做了注释👌。</p></blockquote><figure class="jy jz ka kb fd kc"><div class="bz dy l di"><div class="oe of l"/></div></figure><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es og"><img src="../Images/6b5e89bb239d2099fd578b16b717f612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mRWSur9jl5SmEFcV6NNuOg.jpeg"/></div></div><figcaption class="kj kk et er es kl km bd b be z dx"><strong class="bd kn">Advanced Tab</strong></figcaption></figure><ul class=""><li id="a12d" class="mq mr hi jd b je jf jh ji kv ms kw mt kx mu jw mv mw mx my bi translated">全部完成后，点击<strong class="jd hj">“审核+创建”</strong>和<strong class="jd hj">“创建”</strong></li><li id="003d" class="mq mr hi jd b je mz jh na kv nb kw nc kx nd jw mv mw mx my bi translated">下载私钥并保存在~/。ssh文件夹</li></ul><figure class="jy jz ka kb fd kc er es paragraph-image"><div class="er es oh"><img src="../Images/45d70218f4b248f7b72f57979ace0e90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*ddlZ44e2O3FqM0XqnQhy0A.jpeg"/></div></figure><ul class=""><li id="f06f" class="mq mr hi jd b je jf jh ji kv ms kw mt kx mu jw mv mw mx my bi translated">现在<strong class="jd hj">重复</strong>同样的<strong class="jd hj">事情</strong>到<strong class="jd hj">通过附加<strong class="jd hj">工作器的网络安全组</strong>创建</strong>工作器节点机<code class="du mm mn mo mp b"><strong class="jd hj">medium-k8s-workers-nsg</strong></code></li><li id="e2f0" class="mq mr hi jd b je mz jh na kv nb kw nc kx nd jw mv mw mx my bi translated">使用下载的私钥SSH您的机器:</li></ul><pre class="jy jz ka kb fd oi mp oj ok aw ol bi"><span id="b892" class="nn lr hi mp b fi om on l oo op">chmod 400 ~/.ssh/medium-k8s-master_key.pem<br/>ssh -i ~/.ssh/medium-k8s-master_key.pem k8s-user@40.127.103.3 #the ip address of your machine</span></pre><h1 id="37d3" class="lq lr hi bd kn ls ni lu lv lw nj ly lz io nk ip mb ir nl is md iu nm iv mf mg bi translated">步骤3:配置您的K8S集群</h1><h2 id="9253" class="nn lr hi bd kn no np nq lv nr ns nt lz kv nu nv mb kw nw nx md kx ny nz mf oa bi translated">配置主节点:</h2><blockquote class="ix iy iz"><p id="3932" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">Y <!-- -->您必须部署一个基于<a class="ae ne" href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/#cni" rel="noopener ugc nofollow" target="_blank">容器网络接口</a> (CNI)的Pod网络插件，以便您的Pod可以相互通信。</p><p id="bf05" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">在我们的例子中，我们将使用<strong class="jd hj">法兰绒</strong>作为<code class="du mm mn mo mp b"><strong class="jd hj">CNI</strong></code> <strong class="jd hj">附件</strong>来实现<a class="ae ne" href="https://kubernetes.io/docs/concepts/cluster-administration/networking/#how-to-implement-the-kubernetes-networking-model" rel="noopener ugc nofollow" target="_blank"> Kubernetes网络模型</a>。所以我们必须把它传递给<code class="du mm mn mo mp b"><strong class="jd hj">kubeadm init</strong></code>指挥部。</p></blockquote><ul class=""><li id="2353" class="mq mr hi jd b je jf jh ji kv ms kw mt kx mu jw mv mw mx my bi translated">在主节点上，通过指定P <strong class="jd hj"> od网络CIDR </strong>来初始化集群</li></ul><pre class="jy jz ka kb fd oi mp oj ok aw ol bi"><span id="6a06" class="nn lr hi mp b fi om on l oo op">sudo kubeadm init --pod-network-cidr=10.244.0.0/16</span></pre><ul class=""><li id="43c8" class="mq mr hi jd b je jf jh ji kv ms kw mt kx mu jw mv mw mx my bi translated"><strong class="jd hj">复制</strong>和<strong class="jd hj">保存</strong>生成的<strong class="jd hj">加入命令</strong></li></ul><pre class="jy jz ka kb fd oi mp oj ok aw ol bi"><span id="d6f2" class="nn lr hi mp b fi om on l oo op">sudo kubeadm join 10.1.0.4:6443 --token 4tyt9j.uve6tfdb3a7rvb63         --discovery-token-ca-cert-hash sha256:04c3d3f38b3229fe7b8f808b02bbd48ce95d8a973882b281db579ce6734555c5</span></pre><ul class=""><li id="9db2" class="mq mr hi jd b je jf jh ji kv ms kw mt kx mu jw mv mw mx my bi translated">在公开的地方获取配置供<code class="du mm mn mo mp b"><strong class="jd hj">kubectl</strong></code> <strong class="jd hj"> </strong>使用:</li></ul><pre class="jy jz ka kb fd oi mp oj ok aw ol bi"><span id="ddcb" class="nn lr hi mp b fi om on l oo op">mkdir -p $HOME/.kube<br/>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config<br/>sudo chown $(id -u):$(id -g) $HOME/.kube/config</span></pre><ul class=""><li id="40da" class="mq mr hi jd b je jf jh ji kv ms kw mt kx mu jw mv mw mx my bi translated">手动展开<a class="ae ne" href="https://github.com/flannel-io/flannel#flannel" rel="noopener ugc nofollow" target="_blank">法兰绒</a></li></ul><pre class="jy jz ka kb fd oi mp oj ok aw ol bi"><span id="e7d6" class="nn lr hi mp b fi om on l oo op">kubectl apply -f <a class="ae ne" href="https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</a></span></pre><h2 id="0dc5" class="nn lr hi bd kn no np nq lv nr ns nt lz kv nu nv mb kw nw nx md kx ny nz mf oa bi translated">配置从属节点:</h2><p id="2c64" class="pw-post-body-paragraph ja jb hi jd b je mh ij jg jh mi im jj kv mj jm jn kw mk jq jr kx ml ju jv jw hb bi translated"><strong class="jd hj">通过添加<code class="du mm mn mo mp b">--node-name worker1</code>将</strong>join命令粘贴到工作者节点上。</p><blockquote class="ix iy iz"><p id="f95a" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">如果有多个员工，也要这样做👌。</p></blockquote><p id="f5ef" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kv jl jm jn kw jp jq jr kx jt ju jv jw hb bi translated">示例:</p><pre class="jy jz ka kb fd oi mp oj ok aw ol bi"><span id="2f95" class="nn lr hi mp b fi om on l oo op">sudo kubeadm join 10.1.0.4:6443 --token 4tyt9j.uve6tfdb3a7rvb63         --discovery-token-ca-cert-hash sha256:04c3d3f38b3229fe7b8f808b02bbd48ce95d8a973882b281db579ce6734555c5 --node-name worker1</span></pre><h2 id="9f82" class="nn lr hi bd kn no np nq lv nr ns nt lz kv nu nv mb kw nw nx md kx ny nz mf oa bi translated">检查您的集群:</h2><ul class=""><li id="6748" class="mq mr hi jd b je mh jh mi kv oq kw or kx os jw mv mw mx my bi translated">在主节点上运行</li></ul><pre class="jy jz ka kb fd oi mp oj ok aw ol bi"><span id="7dc8" class="nn lr hi mp b fi om on l oo op"># to see all resources on all namespace<br/>kubectl get all --all-namespaces</span><span id="21f6" class="nn lr hi mp b fi ot on l oo op"># to verify the joined worker nodes<br/>kubectl get nodes</span><span id="d543" class="nn lr hi mp b fi ot on l oo op">NAME                STATUS   ROLES                  AGE     VERSION<br/>medium-k8s-master   Ready    control-plane,master   3d22h   v1.21.3<br/>worker2             Ready    &lt;none&gt;                 3d22h   v1.21.3</span></pre><blockquote class="ix iy iz"><p id="6fb0" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">K8S集群的安装和基本配置已经完成，现在是部署额外示例的时候了</p><p id="ede9" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">下一篇文章再见🙋</p></blockquote></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="d156" class="lq lr hi bd kn ls lt lu lv lw lx ly lz io ma ip mb ir mc is md iu me iv mf mg bi translated">结论</h1><p id="3d23" class="pw-post-body-paragraph ja jb hi jd b je mh ij jg jh mi im jj kv mj jm jn kw mk jq jr kx ml ju jv jw hb bi translated"><strong class="jd hj"> Cloud-init </strong>是一个初始化云实例(Azure VM)的伟大工具，它允许我们自动化软件包安装、文件创建和命令执行💪。<br/>这种自动化限制<strong class="jd hj">手动干预</strong>到<strong class="jd hj">集群的配置</strong>。因此，在<strong class="jd hj">几分钟内</strong>，您将准备好<strong class="jd hj">集群</strong>，并且您可以开始<strong class="jd hj">部署</strong>基础示例，如<strong class="jd hj"> k8s仪表板</strong> &amp; <strong class="jd hj"> hello world </strong>。</p><p id="cd0f" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kv jl jm jn kw jp jq jr kx jt ju jv jw hb bi translated">您现在可以对您的集群做任何您想做的事情:安装一个<strong class="jd hj"> MetalLb </strong>来创建类似<strong class="jd hj">负载平衡器</strong>的服务，使用<strong class="jd hj">入口控制器</strong>，挂载<strong class="jd hj">卷，部署Prometheus和Grafana仪表板</strong> …</p><p id="ed7b" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kv jl jm jn kw jp jq jr kx jt ju jv jw hb bi translated">在下一个故事中，你会看到额外的例子 ✌️</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><p id="4e07" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj kv jl jm jn kw jp jq jr kx jt ju jv jw hb bi ou translated"><span class="l ov ow ox bm oy oz pa pb pc di">如果</span>你对<strong class="jd hj"> AWS云架构</strong>感兴趣，请<strong class="jd hj">参考</strong>我关于<strong class="jd hj">微</strong>和<strong class="jd hj">无服务器架构</strong>的文章</p><div class="ky kz ez fb la lb"><a href="https://naoufal-gafa.medium.com/aws-when-serverless-and-microservice-get-married-securely-6585f7856a0f" rel="noopener follow" target="_blank"><div class="lc ab dw"><div class="ld ab le cl cj lf"><h2 class="bd hj fi z dy lg ea eb lh ed ef hh bi translated">AWS S3M模式:安全结合无服务器和微服务的5个步骤</h2><div class="li l"><h3 class="bd b fi z dy lg ea eb lh ed ef dx translated">“使用这种抽象模式来构建复杂的云架构，可以节省您的时间”</h3></div><div class="lj l"><p class="bd b fp z dy lg ea eb lh ed ef dx translated">naoufal-gafa.medium.com</p></div></div><div class="lk l"><div class="pd l lm ln lo lk lp kh lb"/></div></div></a></div><div class="ky kz ez fb la lb"><a href="https://levelup.gitconnected.com/aws-s3m-pattern-terraform-devops-for-a-10-years-child-dac4610017ff" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab dw"><div class="ld ab le cl cj lf"><h2 class="bd hj fi z dy lg ea eb lh ed ef hh bi translated">AWS S3M模式:适用于10岁儿童的Terraform和DevOps</h2><div class="li l"><h3 class="bd b fi z dy lg ea eb lh ed ef dx translated">第2部分:地形和开发</h3></div><div class="lj l"><p class="bd b fp z dy lg ea eb lh ed ef dx translated">levelup.gitconnected.com</p></div></div><div class="lk l"><div class="pe l lm ln lo lk lp kh lb"/></div></div></a></div><div class="ky kz ez fb la lb"><a rel="noopener follow" target="_blank" href="/codex/aco-architecture-5-tips-to-auto-costoptimization-on-aws-67f026e3abcc"><div class="lc ab dw"><div class="ld ab le cl cj lf"><h2 class="bd hj fi z dy lg ea eb lh ed ef hh bi translated">ACO架构:AWS自动成本优化的5个技巧</h2><div class="li l"><h3 class="bd b fi z dy lg ea eb lh ed ef dx translated">第1部分:ACO架构</h3></div><div class="lj l"><p class="bd b fp z dy lg ea eb lh ed ef dx translated">medium.com</p></div></div><div class="lk l"><div class="pf l lm ln lo lk lp kh lb"/></div></div></a></div><blockquote class="pg"><p id="a06a" class="ph pi hi bd pj pk pl pm pn po pp jw dx translated"><strong class="ak">别忘了</strong>拍拍<strong class="ak">，评论、分享、订阅最新故事😜</strong></p><p id="8c9c" class="ph pi hi bd pj pk pq pr ps pt pu jw dx translated">如果您有任何意见，请随时通过我的<a class="ae ne" href="https://www.facebook.com/neogafa" rel="noopener ugc nofollow" target="_blank"> Fb页面</a>、<a class="ae ne" href="https://twitter.com/NaoufalGafa" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或通过<a class="ae ne" href="https://www.elgafa.com/" rel="noopener ugc nofollow" target="_blank">我的网站</a>联系我</p></blockquote><h1 id="f8bf" class="lq lr hi bd kn ls ni lu lv lw nj ly lz io pv ip mb ir pw is md iu px iv mf mg bi translated">参考</h1><ul class=""><li id="37fc" class="mq mr hi jd b je mh jh mi kv oq kw or kx os jw mv mw mx my bi translated"><a class="ae ne" href="https://kubernetes.io/docs" rel="noopener ugc nofollow" target="_blank"> K8s文档</a></li><li id="a9cc" class="mq mr hi jd b je mz jh na kv nb kw nc kx nd jw mv mw mx my bi translated"><a class="ae ne" href="https://github.com/kubernetes/dashboard/blob/master/docs/user/access-control/creating-sample-user.md" rel="noopener ugc nofollow" target="_blank"> K8S仪表板</a></li><li id="1b15" class="mq mr hi jd b je mz jh na kv nb kw nc kx nd jw mv mw mx my bi translated"><a class="ae ne" href="https://betterprogramming.pub/kubernetes-from-scratch-4691283e3995" rel="noopener ugc nofollow" target="_blank"> Kubernetes从零开始</a></li><li id="44b7" class="mq mr hi jd b je mz jh na kv nb kw nc kx nd jw mv mw mx my bi translated"><a class="ae ne" href="https://gist.github.com/tsertkov/63592dda12d1b1818b7297fd2dccee0f" rel="noopener ugc nofollow" target="_blank"> K8s云配置</a></li></ul></div></div>    
</body>
</html>