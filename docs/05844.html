<html>
<head>
<title>Headless WooCommerce &amp; Next.js: Display Products and Create Orders</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Headless WooCommerce &amp; Next.js:展示产品和创建订单</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/headless-woocommerce-next-js-display-products-and-create-orders-593a6c5aee86?source=collection_archive---------4-----------------------#2021-08-01">https://medium.com/geekculture/headless-woocommerce-next-js-display-products-and-create-orders-593a6c5aee86?source=collection_archive---------4-----------------------#2021-08-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1fe59162ea1bfcb337704ef80c50e990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DOWGh3NvP-nJBRU6"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@martinadams?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Martin Adams</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c3f1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">到目前为止，我们已经从WooCommerce获取了我们的产品，并设置了样式组件。接下来是展示这些产品，并向您展示如何创建订单的基础知识。</p><h1 id="1e46" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">展示您的产品</h1><p id="2634" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我们已经获得了一系列产品，我们可以用我们的创造性思维喜欢的任何方式来操纵它们。对于这个项目，主页将是一个简单的菜单页面，您可以在其中滚动浏览可用的产品。</p><p id="143a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">菜单最重要的部分是指出用户想要选择什么产品，所以你需要提取WooCommerce产品ID。</p><p id="c12b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我创建了一个非常简单的、移动优先的显示，方法是创建一个产品卡组件，并使用CSS Grid来布局产品。我想包括断点和媒体查询，以创建一个响应应用程序，但我想保持事情简单。</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Example of the Product Card component</figcaption></figure><p id="cf8e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们有了一个产品卡组件来显示我们的产品，我们可以映射已经获取的产品数组，并使用我们的产品卡组件。</p><pre class="kw kx ky kz fd lc ld le lf aw lg bi"><span id="f1e8" class="lh ju hi ld b fi li lj l lk ll">{ products.map((product) =&gt; {</span><span id="0785" class="lh ju hi ld b fi lm lj l lk ll">  return &lt;ProductCard product={product} key={product.id} /&gt;;</span><span id="4d26" class="lh ju hi ld b fi lm lj l lk ll">})}</span></pre><p id="4e4f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">记住，当使用map函数时，我们需要传递一个键，我选择了<code class="du ln lo lp ld b">product.id</code>作为惟一标识符。</p><p id="6d5f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我使用CSS Grid layout来管理新返回的数组<code class="du ln lo lp ld b">ProductCard</code>，但是你可以做任何你想做的事情！</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/aca6c4d1535d3af2b5d8ff5187f46124.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*jMv3iH2zClQjUk_xrCXOoQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Screenshot of ProductCards in a CSS Grid. Images were taken from pexels.com</figcaption></figure><p id="74eb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">简单说说图像优化</strong></p><p id="51a3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们继续之前，你们中的一些人可能已经注意到我使用了Next.js 中的<code class="du ln lo lp ld b">&lt;Image /&gt;</code> <a class="ae iu" href="https://nextjs.org/docs/api-reference/next/image" rel="noopener ugc nofollow" target="_blank">组件，而不是标准的<code class="du ln lo lp ld b">&lt;img /&gt;</code> HTML标签。之所以这样，是因为从v.10.0.0开始，</a><a class="ae iu" href="https://nextjs.org/docs/basic-features/image-optimization" rel="noopener ugc nofollow" target="_blank"> Next.js内置了自动图像优化</a>。图片通常占网站权重的很大一部分，所以优化图片会提高页面加载速度和性能。js默认情况下也延迟加载图像，所以图像只在滚动到视窗中时才加载。</p></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/84b90bb24171ef812dfdcc71093b4594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*b5nWzNnu29tKjuLc"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@_danbrad?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Daniel Bradley</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="10e8" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">创建订单</h1><p id="a149" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">你可能想知道为什么我们在用户界面和UX几乎没有接触的情况下直接创建订单。现在这样做的原因是向您展示我们可以用最少的数据创建订单。对你们中的一些人来说，这意味着你可以放弃这些教程，用WooCommerce开发者文档武装自己，然后自己上路。</p><p id="5b6f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">电子商务的目标是向人们展示你的产品，让他们向你下订单。有许多脚手架到位，以确保订单到位(例如，浏览产品系列、展示特定产品详情、跟踪和管理购物车商品、轻松结账流程的好方法)。</p><p id="a0da" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们中的许多人本质上都熟悉已经就位的脚手架，有很多东西需要考虑和构建。然而，并不是所有的技术都是必要的。通过一路剥离，您可以看到下订单是多么容易，然后我们可以一层一层地添加，直到您拥有您正在寻找的电子商务体验。</p><p id="908d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">使用WooCommerceRestApi </strong></p><p id="dadd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当我们从WooCommerce获取产品时，我们使用了来自他们官方Javascript SDK的<code class="du ln lo lp ld b">WooCommerceRestApi</code>。我们想再次使用这个客户端向<code class="du ln lo lp ld b">/orders</code>端点发出一个<code class="du ln lo lp ld b">POST</code>请求。在<a class="ae iu" href="https://woocommerce.github.io/woocommerce-rest-api-docs/?javascript#create-an-order" rel="noopener ugc nofollow" target="_blank"> WooCommerce开发人员文档</a>中，您可以看到一个可以传递给端点的<code class="du ln lo lp ld b">data</code>对象的例子——它是WooCommerce订单对象的子集。</p><p id="dbe9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">检查文档以查看订单的所有属性，您可能会注意到它们都不是必填字段。没错，您可以传递一个空的JSON对象，并且您将能够创建一个新的订单。</p><p id="7ef1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">毫无信息的新订单显然没有多大意义，但至少你知道你可以根据自己的需要包含尽可能多的信息。如果你不需要帐单地址或送货地址——也许你只需要一个电子邮件地址——那么就不要创建一个获取这些信息的表单。我们很习惯在收银台看到地址表格，但是如果你不需要，那就把它删掉。</p><p id="f2fb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我的例子中，我想向您展示如何向订单中添加一些产品。为了做到这一点，WooCommerce期待着一系列的<code class="du ln lo lp ld b">Line Items</code>。再次检查<a class="ae iu" href="https://woocommerce.github.io/woocommerce-rest-api-docs/?javascript#order-line-items-properties" rel="noopener ugc nofollow" target="_blank"> WooCommerce开发者文档</a>中的<code class="du ln lo lp ld b">Line Items</code>属性，您会注意到有许多只读字段，但我们可以传递关键字段，如<code class="du ln lo lp ld b">product_id</code>、<code class="du ln lo lp ld b">quantity</code>和<code class="du ln lo lp ld b">subtotal</code>。实际上，当添加一个新的行项目时，你需要做的就是通过<code class="du ln lo lp ld b">product_id</code>和<code class="du ln lo lp ld b">quantity</code>，WooCommerce将计算出剩余的数据。</p><p id="31be" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当您更新行项目时，事情会变得有点棘手，但我们可以稍后再回到这一点——如果您正在更新现有行项目的数量，只需在更新后再次检查<code class="du ln lo lp ld b">subtotal</code>、<code class="du ln lo lp ld b">total</code>和<code class="du ln lo lp ld b">price</code>。</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Example of a data object to pass into creating WooCommerce order</figcaption></figure><p id="e697" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我上面的例子中，我还添加了一些额外的字段来显示关于支付方式的信息，以及订单是否已支付。如果您将<code class="du ln lo lp ld b">set_paid</code>指定为<code class="du ln lo lp ld b">true</code>，那么WooCommerce订单状态将被设置为<code class="du ln lo lp ld b">Processing</code>。如果您将<code class="du ln lo lp ld b">set_paid</code>指定为<code class="du ln lo lp ld b">false</code>，那么订单状态将被设置为<code class="du ln lo lp ld b">Pending payment</code>。</p><p id="9244" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有了硬编码的数据对象(出于开发目的)，我们现在可以在<code class="du ln lo lp ld b">/orders</code>端点上使用带有<code class="du ln lo lp ld b">POST</code>方法的<code class="du ln lo lp ld b">WooCommerceRestApi</code>客户端。</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="f8f6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我已经包含了我们用来初始化<code class="du ln lo lp ld b">WooCommerceRestApi</code>的代码。我喜欢把它放在文件的顶部，这样我就可以在<code class="du ln lo lp ld b">wooCommerceApi.ts</code>的所有后续函数中访问<code class="du ln lo lp ld b">api</code>客户端。</p><p id="db87" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意代码中的注释，它提醒我们这些API调用必须在服务器端进行，以便访问环境变量。我通过<a class="ae iu" href="https://nextjs.org/docs/api-routes/introduction" rel="noopener ugc nofollow" target="_blank">在Next.js中创建一个调用服务器端<code class="du ln lo lp ld b">createWooCommerceOrder</code>的自定义API端点</a>来实现这一点。如果出于测试和开发的目的，您宁愿跳过这一步，那么尝试将您的<code class="du ln lo lp ld b">consumerKey</code>和<code class="du ln lo lp ld b">consumerSecret</code>直接放入<code class="du ln lo lp ld b">WooCommerceRestApi</code>配置中，并从前端调用它。(如果您希望我涵盖自定义API端点，请告诉我。)</p><p id="4dca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个例子中，我将硬编码的<code class="du ln lo lp ld b">data</code>对象传递给<code class="du ln lo lp ld b">createWooCommerceOrder</code>，并使用临时dev按钮调用该函数。</p><p id="02f0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，如果你在Wordpress站点的WooCommerce仪表板上查看订单，你应该会看到你的新订单。你会注意到你可以在WooCommerce的仪表盘上手动改变订单状态，同时还有一大堆其他功能。如果您需要在不深入代码的情况下进行任何更改，这是非常有用的。</p><p id="10b0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们希望建立一个更复杂的电子商务平台，它有一个允许信用卡支付的收银台和一个允许用户查看和管理他们想要的商品的购物车。为了有助于未来的营销，我们希望至少获得客户的姓名、电子邮件和/或电话，以便我们日后联系他们。</p></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><p id="6981" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第一部分:用WooCommerce创建一个本地WordPress】</p><p id="f895" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-set-up-woocommerce-test-with-postman-5e7859c65626" rel="noopener">第2部分:设置WooCommerce &amp;测试与邮递员</a></p><p id="ad3a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-set-up-next-js-b8d2193b2688" rel="noopener">第三部分:设置Next.js </a></p><p id="b99d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-set-up-styled-components-with-typescript-and-next-js-18cc047ccd79" rel="noopener">第4部分:用TypeScript和Next.js设置样式组件</a></p><p id="9883" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-display-products-and-create-orders-593a6c5aee86" rel="noopener">第5部分:展示产品并创建订单</a></p><p id="e794" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-set-up-redux-toolkit-for-state-management-c605adda58fe" rel="noopener">第6部分:为状态管理建立Redux工具包</a></p><p id="907f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-create-a-cart-8a3e49b90076" rel="noopener">第7部分:创建购物车</a></p><p id="1985" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-set-up-stripe-and-create-checkout-d01333607a66" rel="noopener">第8部分:设置条带并创建检验</a></p></div></div>    
</body>
</html>