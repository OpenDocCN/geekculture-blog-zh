<html>
<head>
<title>Setting Up Monorepo With Create React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Create React应用程序设置Monorepo</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/setting-up-monorepo-with-create-react-app-cb2cfa763b96?source=collection_archive---------1-----------------------#2021-03-28">https://medium.com/geekculture/setting-up-monorepo-with-create-react-app-cb2cfa763b96?source=collection_archive---------1-----------------------#2021-03-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1b68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">问候大家！正如往常一样，这篇文章有一个视频版本，您可以一步一步地查看，让您开始使用monorepo for Create React应用程序！:D</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div></figure><p id="6434" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简单介绍一下，我的任务是转换一个monorepo，其中有2个create react应用程序。尽管这是一个monorepo，但代码不能在不同的应用程序之间共享，create react app很难让它开箱即用。因此，我在网上四处寻找一篇文章或一个人，希望能在我运气不佳的情况下帮助我。我不得不阅读8篇不同的文章，从每篇文章中获取一些信息，找出如何让多个create react应用程序在彼此之间共享代码的简单任务。因此，我希望这篇文章能帮助你开箱即用！</p><h1 id="833e" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated"><strong class="ak">你需要什么工具来完成这项工作？</strong></h1><p id="2bbd" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">首先你需要两个create react应用程序，其次你需要craco(create-react-app-config-ovveride)。我发现使用craco比react-app-rewired容易得多。<br/>我们还将使用lerna和yarn工作区来帮助管理monorepo。</p><p id="b022" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们运行几个命令并开始吧！</p><pre class="jd je jf jg fd kn ko kp kq aw kr bi"><span id="7c25" class="ks jl hi ko b fi kt ku l kv kw">npx lerna init<br/>mkdir packages/app<br/>mkdir packages/components</span></pre><p id="cd21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将在您的工作区中设置lerna。即使我们使用的是yarn工作空间，为什么还要使用lerna？lerna自带了非常有用的cli命令，可以并行运行进程，我认为与yarn workspaces相结合，它使事情变得非常强大。<br/>修改您的<code class="du kx ky kz ko b">lerna.json</code>文件，如下所示</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es la"><img src="../Images/0b5fd1c0648eb69ae21d4d1967da8b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*e-jS6A5iOxdK3KkimpMFyA.png"/></div><figcaption class="ld le et er es lf lg bd b be z dx">lerna.json</figcaption></figure><p id="7434" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将告诉lerna使用纱线作为客户端，使用<code class="du kx ky kz ko b">useWorkspaces</code>作为纱线。如果您没有创建一个<code class="du kx ky kz ko b">package.json</code>文件，您将需要做一个<code class="du kx ky kz ko b">yarn init -y</code>。如果你已经创建了一个，修改如下</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lh"><img src="../Images/dcfab2db4a1c3904a8bb358443626a70.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*7s7LlC5stGi_juhuif_TGw.png"/></div><figcaption class="ld le et er es lf lg bd b be z dx">package.json</figcaption></figure><p id="7743" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以添加任何你喜欢的名字，重要的是<code class="du kx ky kz ko b">"private": true</code>和<code class="du kx ky kz ko b">"workspaces"</code></p><p id="7989" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经完成了所有的设置，让我们准备好应用程序，从运行<code class="du kx ky kz ko b">npx create-react-app --template typescript</code>的<code class="du kx ky kz ko b">app</code>和<code class="du kx ky kz ko b">components</code>文件夹，以及运行<code class="du kx ky kz ko b">lerna.json</code>文件的顶层文件夹<code class="du kx ky kz ko b">yarn add -W craco</code>。同样，craco将是帮助我们共享组件的关键。</p><p id="295a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦安装了两个应用程序<code class="du kx ky kz ko b">app/components</code>，将<code class="du kx ky kz ko b">package.json</code>文件中的名称更改为您将用来引用应用程序的名称。在我的例子中，我选择了<code class="du kx ky kz ko b">@tdotcode/app</code>和<code class="du kx ky kz ko b">@tdotcode/components</code>。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es li"><img src="../Images/6ce7f35ff2b09e4325bcdad9b33b9db2.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*Z1AvksuxeXkt1_fnEo7Kpw.png"/></div></figure><p id="ce29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是你的<code class="du kx ky kz ko b">package.json</code>文件应该看起来的样子。重要字段会突出显示。确保当您将另一个repo作为依赖项添加时，确保您也添加了在<code class="du kx ky kz ko b">components</code>package . JSON文件中声明的正确版本。还要注意我们是如何用<code class="du kx ky kz ko b">craco</code>替换<code class="du kx ky kz ko b">react-scripts</code>的。</p><p id="b2ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要做的最后一件事是在<code class="du kx ky kz ko b">app</code>目录下创建一个<code class="du kx ky kz ko b">craco.config.js</code>文件。在这个文件中，我们将具体说明当我们引用我们的<code class="du kx ky kz ko b">components</code>文件夹中的文件时，我们希望webpack如何表现。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lj"><img src="../Images/0f2e705b9a9f02ae2546c939c4104f96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*xwmbSr_tO3tsR2ru3kraFw.png"/></div><figcaption class="ld le et er es lf lg bd b be z dx">craco.config.js</figcaption></figure><p id="1e68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您之前已经设置了自己的wepack配置，这应该对您有意义。本质上，我们只是提取<code class="du kx ky kz ko b">babel-loader</code>配置，并告诉<code class="du kx ky kz ko b">babel-loader</code>转换来自组件目录的代码。如果我们不这样做，我们的浏览器将加载文件，这是JavaScript无法解析的。</p><p id="b66f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后一件事，在你的根文件夹中，我将运行<code class="du kx ky kz ko b">yarn lerna bootstrap</code>这将引导所有应用程序到根节点模块文件夹，以便其他repos可以使用它。</p><h1 id="7180" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">万岁你完蛋了！！！！🎊🎊🎊</h1><p id="ef6f" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">现在您需要做的就是在您的<code class="du kx ky kz ko b">components</code>文件夹中创建组件，并从您的<code class="du kx ky kz ko b">app</code>文件夹中提取它们。在我的例子中，我在components文件夹中创建了一个按钮。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lk"><img src="../Images/693324b38e5db98d99c85fb968cb187b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6fHFbbS9YlsLB8WvaT3UnA.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">components folder</figcaption></figure><p id="2735" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">需要注意的一点是，我在package.json文件中设置了一个属性为<code class="du kx ky kz ko b">"main": "./src/index.tsx</code>,这将是引用组件目录的应用程序的入口点。</p><p id="7ac8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们看看<code class="du kx ky kz ko b">app</code>是如何使用按钮的</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lp"><img src="../Images/eb06bdfd4666b964b9f81ab9a609da61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WK1RdzaeKRdkKLD7Sn-STg.png"/></div></div></figure><p id="bec4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，我们通过在<code class="du kx ky kz ko b">package.json</code>文件中设置的名称来引用另一个应用程序。</p><h1 id="488b" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">结论</h1><p id="4b5b" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">我们已经学会了如何设置我们的create-react-apps来在monorepo类型的设置中工作，这对我的项目来说是巨大的，因为两个应用程序可以共享公共组件，这消除了两个应用程序之间的差异！</p><ul class=""><li id="cb45" class="lq lr hi ih b ii ij im in iq ls iu lt iy lu jc lv lw lx ly bi translated">**Github代码可在此处找到***</li><li id="dd7b" class="lq lr hi ih b ii lz im ma iq mb iu mc iy md jc lv lw lx ly bi translated"><a class="ae me" href="https://github.com/floydjones1/monorepo-cra" rel="noopener ugc nofollow" target="_blank">https://github.com/floydjones1/monorepo-cra</a></li></ul></div></div>    
</body>
</html>