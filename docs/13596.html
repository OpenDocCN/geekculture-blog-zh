<html>
<head>
<title>Scraping a Dynamic Website, Selenium Part-V</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">刮一个动态网站，硒第五部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/scraping-a-dynamic-website-selenium-part-v-50fd5fc386cb?source=collection_archive---------11-----------------------#2022-07-17">https://medium.com/geekculture/scraping-a-dynamic-website-selenium-part-v-50fd5fc386cb?source=collection_archive---------11-----------------------#2022-07-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3cb9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随着时间的推移，开发人员已经成长到足以克服网站中Java脚本的挑战。但是，这是一个目的。由于开发者已经学习和开发了很多关于抓取网站的知识，网站开发者也开发了新的策略来对付抓取工具。</p><p id="c0dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这次我的挑战是摧毁一个匈牙利网站。虽然语言不是一个大的挑战，但网站本身却是一个从其中删除数据的挑战。这是我刮的网站。</p><div class="jd je ez fb jf jg"><a href="https://hu.ryobitools.eu/" rel="noopener  ugc nofollow" target="_blank"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hj fi z dy jl ea eb jm ed ef hh bi translated">ryobi Tools HU | elektro mos kézisserszámok，ONE+，kertigépek，36V</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">费代兹·费尔a one+HP gépcsaláDJát . a ryobi 18v-OS纳吉·teljesítményűgépcsaládja fejlett technologiával，TBB…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">hu.ryobitools.eu</p></div></div><div class="jp l"><div class="jq l jr js jt jp ju jv jg"/></div></div></a></div><h2 id="8f81" class="jw jx hi bd jy jz ka kb kc kd ke kf kg iq kh ki kj iu kk kl km iy kn ko kp kq bi translated">我的目标是什么？这里的挑战是什么？我是如何应对的？</h2><p id="ee07" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated"><strong class="ih hj">目标:</strong></p><p id="8734" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的目标是从网站上，从几乎所有的菜单上获取产品的详细信息和图片。</p><p id="2205" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">挑战:</strong></p><p id="2132" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1-接受cookies警告</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es kw"><img src="../Images/a98edb284cd9452a23c5e7e923debce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ef7nRtPVKwskk92S1-WRyw.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx">image showing cookies handler for https://hu.ryobitools.eu</figcaption></figure><p id="d7f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2-菜单的交互行为，也就是说，要获得所有菜单选项的列表，我必须单击主菜单选项，然后单击子菜单，然后子子菜单等等。所有主菜单选项都要重复这一步骤。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div class="er es ll"><img src="../Images/d30257b5cb0f1e777ac9abb3c76b4c35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/1*hIPf0Js6yToBPQWgxhMH_g.gif"/></div><figcaption class="lh li et er es lj lk bd b be z dx">hu.ryobitool.eu interactive menu</figcaption></figure><p id="b9f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3- Session expiration:为了删除产品的信息，我首先收集所有产品的链接，然后为每个产品的链接删除它的信息。但是，由于大量的链接和缓慢的网络，会话通常会在一些迭代/链接后过期。</p><p id="8f6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">解决方案:</strong></p><p id="d58c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1-cookie警告:这很容易处理。在下面的代码行中，只需找到cookie警告，然后接受它们。</p><pre class="kx ky kz la fd lm ln lo lp aw lq bi"><span id="f5d3" class="jw jx hi ln b fi lr ls l lt lu">def open_url(self, url) -&gt; None:        <br/>    # self.driver = Chrome()                <br/>    time.sleep(0.2)<br/>    self.driver.get(url)</span><span id="cfb5" class="jw jx hi ln b fi lv ls l lt lu">    self.driver.maximize_window()        <br/>    time.sleep(.1)         <br/>    try:            <br/>        Alert(self.driver).dismiss()        <br/>    except:            <br/>        ...         <br/>    # cookie handler       <br/>    try:            <br/>        self.driver.find_element(By.ID, 'onetrust-accept-btn-handler').click()           <br/>        time.sleep(random.choice(self.sleeps))<br/>    except:<br/>        ...</span><span id="0dbe" class="jw jx hi ln b fi lv ls l lt lu">    return self.driver.current_url</span></pre><p id="8729" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2-交互式菜单:为了解决这个问题，我实现了不同的功能。在While循环中。下面是详细的解决方案。</p><pre class="kx ky kz la fd lm ln lo lp aw lq bi"><span id="b3c2" class="jw jx hi ln b fi lr ls l lt lu">class Ryobi(Support):        <br/>    def __init__(self) -&gt; None:<br/>        super().__init__()<br/>        self.ryo_ini = 0<br/>        self.cat_ini = 1<br/>        self.sub_cat_ini = 10<br/>        self.sub_sub_cat_ini = 0<br/>        self.cat_len = 0<br/>        self.sub_cat_len = 0<br/>        self.sub_sub_cat_len = 0<br/>        self.link_counter = 0</span></pre><p id="642f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个网站的scraper是我的支持类的一个实例，我曾经创建它来抓取网站的支持链接，我没有做太多的修改。</p><p id="0c62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个构造函数包含一些定义，是我的脚本的基础。</p><pre class="kx ky kz la fd lm ln lo lp aw lq bi"><span id="5f39" class="jw jx hi ln b fi lr ls l lt lu">self.cat_ini =&gt; index counter for main categories<br/>self.sub_cat_ini =&gt; index counter for sub-categories<br/>self.sub_sub_cat_ini =&gt; index counter for sub-sub-categories<br/>self.cat_len =&gt; total length counter for main categories<br/>self.sub_cat_len =&gt; total length counter for sub-categories<br/>self.sub_sub_cat_len =&gt; total length counter for sub-sub-categories<br/>self.link_counter =&gt; counter for links</span></pre><p id="e4cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是这些变量的重要性。</p><p id="11db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> self.cat_ini </strong>初始设置为1，即从找到的类别的第二个索引开始。因为第一个索引是一些不相关的链接。它将保持不变，直到它的所有子类别和子子类别的产品链接都被删除。当主类别的所有子类别和子子类别都被刮到时，它将增加1。这将增加到主要类别的总长度。</p><p id="5d31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> self.sub_cat_ini，</strong>子类别的索引计数器将保持不变，直到其所有子子类别的产品链接都被删除。当所有的子子类别都被清除后，该索引器将被重置为“0”。</p><p id="5c12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> self.sub_sub_cat_ini，</strong>子子类别的索引器，在保持其父子类和主类索引计数器的情况下只增加1。</p><p id="fd40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> self.cat_len </strong>是主要类别的总数。这是增加<strong class="ih hj"> self.cat_ini的极限。</strong>当this main index等于main categories的计数时，循环将中断，流程将结束。</p><p id="7ceb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> self.sub_cat_len </strong>是主类别的子类别总数。当<strong class="ih hj"> self.sub_cat_ini </strong>等于<strong class="ih hj"> self.sub_cat_len </strong>时，将<strong class="ih hj"> self.cat_ini </strong>加1。</p><pre class="kx ky kz la fd lm ln lo lp aw lq bi"><span id="5a1c" class="jw jx hi ln b fi lr ls l lt lu">if self.sub_cat_ini == self.sub_cat_len:<br/>    self.sub_cat_ini = 0<br/>    self.sub_cat_len = 0<br/>    self.cat_ini += 1</span></pre><p id="6e12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> self.sub_sub_cat_len </strong>为主类别的子类别的子子类别总数。<strong class="ih hj"> self.cat_ini </strong>和<strong class="ih hj"> self.sub_cat_ini </strong>保持不变，直到<strong class="ih hj"> self.sub_sub_cat_ini </strong>等于<strong class="ih hj"> self.sub_sub_cat_len </strong>。</p><pre class="kx ky kz la fd lm ln lo lp aw lq bi"><span id="056e" class="jw jx hi ln b fi lr ls l lt lu">if self.sub_cat_ini == self.sub_cat_len:<br/>    self.sub_cat_ini = 0<br/>    self.sub_cat_len = 0<br/>    self.cat_ini += 1</span></pre><p id="6f46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是完整的伪代码实现。</p><pre class="kx ky kz la fd lm ln lo lp aw lq bi"><span id="b46b" class="jw jx hi ln b fi lr ls l lt lu">while True:<br/>    get main categories<br/>    if self.cat_len ==0:<br/>        self.cat_len = length(main categories)<br/>    categories[self.cat_ini].click() # click on the particular main category<br/>    get sub-categories<br/>    if self.sub_cat_len == 0:<br/>        self.sub_cat_len = length(sub_categories)<br/>    sub_cats[self.sub_cat_ini].click() # click open a sub-category<br/>    <br/>    # try to find sub-sub-categories of a sub-category<br/>    sub_sub_cats = []<br/>    try:<br/>        sub_sub_cats = self.driver.find_elements(By.CLASS_NAME, 'CategoryDropdownstyles__Link-kkzqgd-9')<br/>    except:<br/>        ...</span><span id="b223" class="jw jx hi ln b fi lv ls l lt lu">    if length(sub_sub_cats)&gt;0 and self.sub_sub_cat_len == 0:<br/>        self.sub_sub_cat_len = length(sub_sub_cats)<br/>    if length(sub_sub_cats)&gt;0:<br/>        sub_sub_cats[self.sub_sub_cat_ini].click()<br/>        print(f'now on sub sub category: {self.sub_sub_cat_ini}')<br/>        self.sub_sub_cat_ini += 1</span><span id="aa46" class="jw jx hi ln b fi lv ls l lt lu">    products = get_products from the current link, that is either from sub-categories or from sub-sub-categories</span><span id="1390" class="jw jx hi ln b fi lv ls l lt lu">i = 1<br/>    for link in products:<br/>        if self.link_counter&gt;0:<br/>            print(f'saving record number: {i}, in the dataset for the link: ', link)                    <br/>            ryo = os.path.join(cur_dir, f'scraped_data/hu.ryobytools.eu-sample.xlsx')<br/>            get_details_of_the_product(link, ryo, which='ryobi')<br/>            i+=1</span><span id="e0b5" class="jw jx hi ln b fi lv ls l lt lu">    if self.sub_sub_cat_ini == self.sub_sub_cat_len:<br/>        self.sub_sub_cat_ini = 0<br/>        self.sub_sub_cat_len = 0<br/>        self.sub_cat_ini += 1</span><span id="de72" class="jw jx hi ln b fi lv ls l lt lu">    if self.sub_cat_ini == self.sub_cat_len:<br/>        self.sub_cat_ini = 0<br/>        self.sub_cat_len = 0<br/>        self.cat_ini += 1</span><span id="0a82" class="jw jx hi ln b fi lv ls l lt lu">    if self.cat_ini == self.cat_len:<br/>        break</span></pre><p id="b02c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3-第三个问题在下面的代码片段中处理:</p><pre class="kx ky kz la fd lm ln lo lp aw lq bi"><span id="f2f6" class="jw jx hi ln b fi lr ls l lt lu">try:<br/>    self.driver.get(url)<br/>except:<br/>    self.driver.start_session({})<br/>    self.driver.maximize_window()<br/>    time.sleep(0.2)<br/>    self.driver.get(url)</span></pre><p id="f7be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，就这样我得到了解决办法。<a class="ae lw" href="https://github.com/Irfan-Ahmad-byte/hungarian_scraping_proj" rel="noopener ugc nofollow" target="_blank">这里的</a>是指向包含我的解决方案的我的存储库的链接。我为这个项目使用了不同的解决方案。该库还包含通过docker使用selenium hub的设置，这是我的优先事项。它还包括独立selenium的设置。</p><p id="cec3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你是新来的，你可以查看这个系列的<a class="ae lw" rel="noopener" href="/swlh/scraping-a-dynamic-web-page-its-selenium-da161999c975?source=your_stories_page-------------------------------------">第一部分</a>、<a class="ae lw" rel="noopener" href="/geekculture/scraping-a-dynamic-website-selenium-part-ii-1f30a4b59285?source=your_stories_page-------------------------------------">第二部分</a>、<a class="ae lw" rel="noopener" href="/geekculture/scraping-a-dynamic-website-selenium-part-iii-7138d2a3131?source=your_stories_page-------------------------------------">第三部分</a>和<a class="ae lw" rel="noopener" href="/geekculture/scraping-dynamic-websites-through-remote-webdrivers-selenium-part-iv-424b6a9cc02d?source=your_stories_page-------------------------------------">第四部分</a>。</p><p id="6009" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来我将在这个系列中发表一篇文章</p><blockquote class="lx ly lz"><p id="b1c2" class="if ig ma ih b ii ij ik il im in io ip mb ir is it mc iv iw ix md iz ja jb jc hb bi translated">刮个动态网站，但不是硒。</p></blockquote></div></div>    
</body>
</html>