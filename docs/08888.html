<html>
<head>
<title>Understanding the Three.js Transmission example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解Three.js传输示例</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/understanding-the-three-js-transmission-example-13e952a8ab55?source=collection_archive---------4-----------------------#2021-11-18">https://medium.com/geekculture/understanding-the-three-js-transmission-example-13e952a8ab55?source=collection_archive---------4-----------------------#2021-11-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/30bcb18bb47d298ff975852950c147f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pCIJo4i37YmnxRM2_7WACA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">screenshot of the cute striped bubble demonstrated in the official example</figcaption></figure><p id="de48" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">threejs.org上的官方例子是初学者想要达到的大多数视觉效果的很好的参考。但是有时候你可能会发现它们很难理解，因为对于代码中发生的事情没有直接的解释。在我能够理解<a class="ae js" href="https://threejs.org/examples/?q=trans#webgl_materials_physical_transmission" rel="noopener ugc nofollow" target="_blank">中的大部分代码之前，我还需要做充分的研究，这个官方例子</a>展示了通过基于物理的材料的传输效应。</p><p id="ef69" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这篇文章中，我将尝试解释<a class="ae js" href="https://github.com/mrdoob/three.js/blob/master/examples/webgl_materials_physical_transmission.html" rel="noopener ugc nofollow" target="_blank">条纹气泡示例</a>中使用的最重要的概念或代码:</p><ul class=""><li id="cb28" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated"><code class="du kc kd ke kf b">RGBELoader</code></li><li id="e914" class="jt ju hi iw b ix kg jb kh jf ki jj kj jn kk jr jy jz ka kb bi translated"><code class="du kc kd ke kf b">THREE.EquirectangularReflectionMapping</code>和<code class="du kc kd ke kf b">envMap</code>房产</li><li id="eb98" class="jt ju hi iw b ix kg jb kh jf ki jj kj jn kk jr jy jz ka kb bi translated"><code class="du kc kd ke kf b">THREE.ACESFilmicToneMapping</code></li><li id="cdc4" class="jt ju hi iw b ix kg jb kh jf ki jj kj jn kk jr jy jz ka kb bi translated"><code class="du kc kd ke kf b">THREE.sRGBEncoding</code></li><li id="164c" class="jt ju hi iw b ix kg jb kh jf ki jj kj jn kk jr jy jz ka kb bi translated">透明的条纹纹理</li></ul><h1 id="59c9" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">RGBELoader</h1><p id="ec98" class="pw-post-body-paragraph iu iv hi iw b ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn ln jp jq jr hb bi translated">根据维基百科，RGBE也代表光辉HDR。与普通的24位每像素格式相比，RGBE可以存储更多颜色和细节的图像，这意味着RGBE图像具有更高的动态范围。</p><p id="a4b3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">经过进一步的研究，虽然我找不到RGBE的明确的长形式，但我相信“E”代表指数。这是因为RGBE基本上是每像素32位的格式，前24位存储三原色的3个字节，后8位存储共享指数，这实质上是颜色通道的公共比例因子。这种格式利用了各种颜色的幅度通常高度相关且接近的事实，因此共享指数可以用紧凑的存储大小支持高动态范围，而不必为每种颜色存储单独的指数。</p><p id="4b11" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">单个通道通过以下公式进行联合调整，通过交换R，该公式也适用于G和B:</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div class="er es lo"><img src="../Images/8f0cdfdfce98c6ba29b7613473bde76c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*hzlGDSHGt1hndrt58U70jA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Reference: <a class="ae js" href="https://www.cl.cam.ac.uk/~rkm38/pdfs/artusi2017hdr_column.pdf" rel="noopener ugc nofollow" target="_blank">https://www.cl.cam.ac.uk/~rkm38/pdfs/artusi2017hdr_column.pdf</a></figcaption></figure><p id="8504" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">该公式中的e是作为RGBE格式的最后8位存储的共享指数。</p><p id="2b02" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在一些背景知识会议之后，你现在应该清楚为什么这个例子使用<code class="du kc kd ke kf b">RGBELoader</code>来加载背景场景，这仅仅是因为加载的图像是一个hdr文件。</p><h1 id="fab7" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated"><code class="du kc kd ke kf b">THREE.EquirectangularReflectionMapping</code>和<code class="du kc kd ke kf b">envMap</code></h1><p id="210b" class="pw-post-body-paragraph iu iv hi iw b ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn ln jp jq jr hb bi translated">代码中RGBELoader加载的hdr纹理是一个等矩形图像。这个<code class="du kc kd ke kf b">hdrEquirect</code>纹理被设置为条纹气泡的<code class="du kc kd ke kf b">MeshPhysicalMaterial</code>的<code class="du kc kd ke kf b">envMap</code>属性，同时也通过下面这条线被设置为场景的天空盒:</p><pre class="lp lq lr ls fd lt kf lu lv aw lw bi"><span id="d19a" class="lx km hi kf b fi ly lz l ma mb">scene.background = hdrEquirect;</span></pre><p id="936f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">引用关于<a class="ae js" href="https://threejs.org/docs/#api/en/constants/Textures" rel="noopener ugc nofollow" target="_blank">纹理常数</a>的官方文档，一个等矩形贴图是:</p><blockquote class="mc md me"><p id="dd6d" class="iu iv mf iw b ix iy iz ja jb jc jd je mg jg jh ji mh jk jl jm mi jo jp jq jr hb bi translated">也称为纬度-经度贴图，等矩形纹理表示沿水平中心线的360度视图和沿垂直轴的180度视图，图像的顶部和底部边缘对应于贴图球体的北极和南极</p></blockquote><p id="8b67" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">但是要让这个天空盒和环境反射贴图发挥作用，您必须设置<code class="du kc kd ke kf b">hdrEquirect</code>纹理的映射属性以使用<code class="du kc kd ke kf b">THREE.EquirectangularReflectionMapping</code>，它只是在three.js代码中定义的某个数字的常数。如果没有这个，天空盒将只是整个等矩形图像的静态显示，并且在气泡上没有环境反射。</p><h1 id="8029" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated"><code class="du kc kd ke kf b">THREE.ACESFilmicToneMapping</code></h1><p id="1ef2" class="pw-post-body-paragraph iu iv hi iw b ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn ln jp jq jr hb bi translated">一般来说，色调映射是计算机图形学中使用的一种技术，当显示设备不能显示HDR颜色时，将HDR颜色值映射到LDR。在Three.js中，我们可以从一些色调映射设置中进行选择，而<code class="du kc kd ke kf b">ACESFilmicToneMapping</code>只是其中之一；参见渲染器页面上的<a class="ae js" href="https://threejs.org/docs/#api/en/constants/Renderer" rel="noopener ugc nofollow" target="_blank">色调映射部分。</a></p><p id="a56c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因为HDR图像被用作场景背景和材质的环境贴图，所以使用了色调贴图。老实说，我仍然不明白Three.js中所有的幕后东西，比如这个特定的<code class="du kc kd ke kf b">ACESFilmicToneMapping</code>将对从HDR文件加载的颜色做什么，但我可以为你做一个场景中打开和关闭色调映射的比较。</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/8376a48e6f650d88acf9a5074087c5bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qs85hNL2ZnICtwqeZIR7sg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx"><code class="du kc kd ke kf b">ACESFilmicToneMapping is on for the left image, while off for the right</code></figcaption></figure><h1 id="1743" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated"><code class="du kc kd ke kf b">THREE.sRGBEncoding</code></h1><p id="641b" class="pw-post-body-paragraph iu iv hi iw b ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn ln jp jq jr hb bi translated">如果您使用Three.js的时间足够长，您应该会经常遇到这种设置:</p><pre class="lp lq lr ls fd lt kf lu lv aw lw bi"><span id="eeb4" class="lx km hi kf b fi ly lz l ma mb">renderer.outputEncoding = THREE.sRGBEncoding;</span></pre><p id="6471" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这告诉渲染器将每个片段的最终颜色值转换到sRGB颜色空间。我们之所以希望最终输出在sRGB空间，是因为sRGB是现代电子设备的事实上的标准，包括监视器、照相机、扫描仪等。要更好地理解这个主题，请查看约翰·诺瓦克的这篇<a class="ae js" href="https://blog.johnnovak.net/2016/09/21/what-every-coder-should-know-about-gamma/#gamma-vs-srgb" rel="noopener ugc nofollow" target="_blank">深入的文章</a>，它也帮助了我。</p><p id="9381" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">大多数时候，当我们必须处理图像纹理时，我们通常也必须设置<code class="du kc kd ke kf b">texture.encoding = THREE.sRGBEncoding</code>，因为大多数在线图像都是sRGB编码的。显式设置此选项允许Three.js在对这些纹理进行任何进一步的计算之前，正确地将这些纹理上的颜色值从sRGB空间解码到线性空间。这一点很重要，因为光照方程、后期处理或许多其他着色器代码都假设线性空间中的颜色值。对于简单的项目，你可能看不出区别，但是对于更大更复杂的场景，如果你忽略<a class="ae js" href="https://stackoverflow.com/questions/69962432/when-do-we-need-to-use-renderer-outputencoding-three-srgbencoding" rel="noopener ugc nofollow" target="_blank">这个sRGB工作流程</a>，你会发现颜色不对。</p><p id="62f2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你可能会想，为什么我们不需要在这个例子中设置<code class="du kc kd ke kf b">hdrEquirect.encoding = THREE.sRGBEncoding</code>。这是因为HDR文件的处理方式不同。根据130–131的<a class="ae js" href="https://github.com/mrdoob/three.js/wiki/Migration-Guide#130--131" rel="noopener ugc nofollow" target="_blank">迁移指南，默认加载了<code class="du kc kd ke kf b">RGBELoader</code>、<code class="du kc kd ke kf b">HDRCubeTextureLoader</code>和<code class="du kc kd ke kf b">EXRLoader</code>的纹理类型现在是<code class="du kc kd ke kf b">THREE.HalfFloatType</code>，这意味着<code class="du kc kd ke kf b">texture.encoding</code>是在<code class="du kc kd ke kf b">RGBELoader</code>内部设置的，如果你看一下</a><a class="ae js" href="https://github.com/mrdoob/three.js/blob/master/examples/jsm/loaders/RGBELoader.js" rel="noopener ugc nofollow" target="_blank"> RGBELoader源代码</a>的load函数。</p><h1 id="86c1" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">条纹透明纹理</h1><p id="013b" class="pw-post-body-paragraph iu iv hi iw b ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn ln jp jq jr hb bi translated">为了使示例中的气泡具有透明条纹，对<code class="du kc kd ke kf b">MeshPhysicalMaterial</code>的<code class="du kc kd ke kf b">alphaMap</code>属性应用了重复的黑白条纹纹理。<code class="du kc kd ke kf b">generateTexture</code>函数生成一个正方形的画布元素，其中只有下半部分是白色的。如果你只是想看看纹理通常是什么样子，你可以创建一个新的<code class="du kc kd ke kf b">MeshBasicMaterial</code>来加载纹理，并将这个基本材质应用到球体上:</p><pre class="lp lq lr ls fd lt kf lu lv aw lw bi"><span id="8fcb" class="lx km hi kf b fi ly lz l ma mb">const material2 = new THREE.MeshBasicMaterial({map: texture})</span></pre><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/095bcf27bce538ead06d68255442f44a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5gw7f086wzzeTst75Cm8Bw.png"/></div></div></figure><p id="275d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，alphaMap贴图中的白色基本上意味着100%不透明(示例中的透明度是由PBR材质上的<code class="du kc kd ke kf b">transmission</code>和<code class="du kc kd ke kf b">transparent</code>属性额外引入的)，黑色意味着100%透明或不可见。</p></div><div class="ab cl ml mm gp mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="hb hc hd he hf"><h1 id="1e69" class="kl km hi bd kn ko ms kq kr ks mt ku kv kw mu ky kz la mv lc ld le mw lg lh li bi translated">结论</h1><p id="55b2" class="pw-post-body-paragraph iu iv hi iw b ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn ln jp jq jr hb bi translated">在我写下并发表之前，我已经花了将近两周的时间来学习所有这些新概念。我确信我在这里写的东西在任何意义上都不是权威的，所以我通常边走边粘贴参考文献的链接。大多数时候，我写作是因为它不仅能帮助我巩固和加强我的知识，还能激励我学习新的很酷的东西，这样我就可以和我的听众分享它们。</p><p id="6e62" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">希望你也学到了新的东西！</p><h1 id="4f24" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">关于伽马校正的进一步阅读</h1><ol class=""><li id="343d" class="jt ju hi iw b ix lj jb lk jf mx jj my jn mz jr na jz ka kb bi translated"><a class="ae js" href="https://www.cambridgeincolour.com/tutorials/gamma-correction.htm" rel="noopener ugc nofollow" target="_blank">https://www . Cambridge in colour . com/tutorials/gamma-correction . htm</a></li><li id="89d2" class="jt ju hi iw b ix kg jb kh jf ki jj kj jn kk jr na jz ka kb bi translated">https://www.wildlifeinpixels.net/blog/gamma-encoding/<a class="ae js" href="https://www.wildlifeinpixels.net/blog/gamma-encoding/" rel="noopener ugc nofollow" target="_blank"/></li></ol></div></div>    
</body>
</html>