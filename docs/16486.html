<html>
<head>
<title>Angular: How a Directive when applied to the Parent Element can access the Child Elements as well</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular:应用于父元素的指令如何访问子元素</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/angular-how-a-directive-when-applied-to-the-parent-element-can-access-the-child-elements-as-well-1d83c2cb4602?source=collection_archive---------2-----------------------#2022-12-30">https://medium.com/geekculture/angular-how-a-directive-when-applied-to-the-parent-element-can-access-the-child-elements-as-well-1d83c2cb4602?source=collection_archive---------2-----------------------#2022-12-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="0de7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您将指令应用到元素A以执行某个操作时，这是一个非常常见的用例，但是这个操作还需要其他相关的元素。</p><p id="aa82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">考虑屏幕上显示的项目列表。假设我想选择一个列表项，并以不同的样式显示选定的项，以区别于其他列表项。在Angular组件中使用JavaScript和jQuery很容易实现这一点，但是我们的目标是完全使用Angular指令来实现。</p><p id="78f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些是目标:</p><ol class=""><li id="5262" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">我们将显示如下5个项目的简单列表。默认情况下，将选择第一个列表项。选定项目的背景颜色为黄色。</li></ol><figure class="jn jo jp jq fd jr er es paragraph-image"><div class="er es jm"><img src="../Images/555b0d3fea2db918278bbdee375a4767.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WYqFlPG5N516Piew.png"/></div></figure><p id="80a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.一次只能选择一个列表项目，当我选择任何其他列表项目时，例如:列表中的第三个项目，最初选择的项目即第一个项目应该取消选择，如下所示。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div class="er es jm"><img src="../Images/1438e0b8e69c0c76b327567183b730aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WKrprkCETml8PuQv.png"/></div></figure><p id="9119" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.为了演示如何将第2点中使用的逻辑重用到任何其他类型的事件中，我们将在这个例子中添加另一个特性。每当<strong class="ih hj">鼠标悬停在列表项</strong>上，列表项文本将<strong class="ih hj">从黑色变为红色</strong>。当<strong class="ih hj">鼠标离开列表项时，颜色从红色变回黑色</strong>。</p><p id="a638" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如下面的截图所示，我选择了<strong class="ih hj">最后一个列表项</strong>，因此它的背景颜色为黄色，但是因为我的鼠标悬停在<strong class="ih hj">第三个列表项</strong>上，所以它的文本颜色为红色。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div class="er es jm"><img src="../Images/1dc8a4ce14084236849cdb1aa860e544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*H-EFf1OSyaB82EDT.png"/></div></figure><p id="4a01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是<strong class="ih hj"> AppComponent模板</strong>。这只是一个简单的列表，通过遍历一个对象数组来创建— <strong class="ih hj"> optionsList1。</strong>每个对象都有一个<strong class="ih hj">属性值</strong>，其中包含要在列表中显示的文本。</p><figure class="jn jo jp jq fd jr"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="53e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个列表项<li>标签都被分配了一个<strong class="ih hj"> ID </strong>，它基本上是字符串“<strong class="ih hj"> option </strong>”后跟列表项索引。</li></p><p id="a7b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，每个<li>标签也被分配了一个参考<strong class="ih hj">#选项</strong>。</li></p><p id="8850" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自定义指令<strong class="ih hj"> ListDirective </strong>应用于&lt; ul &gt;标签。我们将很快看到为什么该指令适用于ul标签而不是li标签。</p><p id="b2e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> App组件类:</strong>组件类只是定义了数组<strong class="ih hj"> optionsList1。</strong></p><figure class="jn jo jp jq fd jr"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="95fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> ListDirective类:</strong></p><figure class="jn jo jp jq fd jr"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="b15c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将指令应用于<ul>标签的两个主要目的是:</ul></p><p id="a94e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">= &gt;使用@ContentChildren捕获<ul>标签下的所有<li>标签。</li></ul></p><p id="7523" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">= &gt;监听<li>标签上的点击事件。</li></p><pre class="jn jo jp jq fd jw jx jy bn jz ka bi"><span id="470d" class="kb kc hi jx b be kd ke l kf kg">@ContentChildren(‘options’) options: QueryList&lt;ElementRef&gt;;ngAfterContentInit() {<br/>this.renderer.addClass(<br/>this.options.toArray()[0].nativeElement,‘activeOption’);<br/>}</span></pre><p id="fed3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如你在上面的代码中看到的，我们已经使用<strong class="ih hj"> ContentChildren </strong>访问了引用<strong class="ih hj"> #options </strong>的所有<li>标签。</li></p><p id="c875" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj"> ngAfterContentInit()生命周期挂钩</strong>中，我们正在访问第一个列表项，并向其中添加了<strong class="ih hj"> activeOption </strong>类。这个类将为第一个选项添加一个<strong class="ih hj">黄色背景色</strong>。我们已经使用了<strong class="ih hj"> Renderer2 </strong>来操作DOM。</p><pre class="jn jo jp jq fd jw jx jy bn jz ka bi"><span id="10ff" class="kb kc hi jx b be kd ke l kf kg">.activeOption{<br/>background-color: yellow;<br/>}</span></pre><p id="d8fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这完成了我们的第一个目标。</p><p id="dfb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.为了监听<li>标签上的点击事件，我们添加了一个@HostListener，如下所示。每当我们单击任何列表选项，就会调用<strong class="ih hj"> onClick() </strong>，它又调用另一个方法<strong class="ih hj"> actionElement() </strong>，传递&lt; li &gt;标签目标细节和作为参数命名的类</li></p><pre class="jn jo jp jq fd jw jx jy bn jz ka bi"><span id="719f" class="kb kc hi jx b be kd ke l kf kg">@HostListener(‘click’, [‘$event.target’])<br/>onClick(target: any) {<br/>this.actionElement(‘activeOption’, target);<br/>}</span></pre><p id="a9cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建另一个方法<strong class="ih hj"> actionElement() </strong>的目的是为任何其他可能使用不同CSS类的事件类型重用相同的逻辑。</p><pre class="jn jo jp jq fd jw jx jy bn jz ka bi"><span id="d0b5" class="kb kc hi jx b be kd ke l kf kg">actionElement(className: string, target: any) {<br/><br/>this.options.toArray().forEach((item) =&gt; {<br/><br/>if (target.id === item.nativeElement.id) {<br/>if (!item.nativeElement.classList.contains(className)) {<br/>this.renderer.addClass(item.nativeElement, className);<br/>}<br/>} else {<br/>this.renderer.removeClass(item.nativeElement, className);<br/>}<br/>});<br/>}</span></pre><p id="faee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个方法中，我们迭代通过<strong class="ih hj"> ContentChildren </strong>引用<strong class="ih hj"> #options </strong>。在每次迭代中，我们检查哪个列表选项具有与目标&lt; li &gt;相同的ID(即被点击的&lt; li &gt;标签)。</p><pre class="jn jo jp jq fd jw jx jy bn jz ka bi"><span id="eb6d" class="kb kc hi jx b be kd ke l kf kg">this.options.toArray().forEach((item) =&gt; {<br/>if (target.id === item.nativeElement.id) {<br/>//logic for adding css class<br/>}<br/>else{<br/>//logic for removing css class<br/>}<br/>})</span></pre><p id="8aae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">肯定会有匹配的。我们<strong class="ih hj">将activeOption </strong> CSS类添加到匹配的&lt; li &gt;列表选项中，<strong class="ih hj">将activeOption </strong> CSS类从其他&lt; li &gt;列表选项中移除。</p><p id="019c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这也完成了我们的第二个目标。</p><p id="bb74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于第三个目标，我们增加了2个@HostListener来监听<strong class="ih hj"> mouseover </strong>和<strong class="ih hj"> mouseleave </strong>事件。这些事件分别触发<strong class="ih hj"> onMouseover() </strong>和<strong class="ih hj"> onMouseLeave() </strong>方法。这些方法依次调用现有的<strong class="ih hj"> actionElement() </strong>传递目标&lt; li &gt;细节和一个新的类名作为参数。</p><pre class="jn jo jp jq fd jw jx jy bn jz ka bi"><span id="4047" class="kb kc hi jx b be kd ke l kf kg">@HostListener(‘mouseover’, [‘$event.target’])<br/>onMouseover(target: any) {<br/>this.actionElement(‘onHover’, target);<br/>}</span></pre><pre class="kh jw jx jy bn jz ka bi"><span id="35c0" class="kb kc hi jx b be kd ke l kf kg">@HostListener(‘mouseleave’, [‘$event.target’])<br/>onMouseLeave(target: any) {<br/>this.actionElement(‘onLeave’, target);<br/>}</span></pre><p id="0c21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完整的工作示例可以在下面找到。</p><div class="ki kj ez fb kk kl"><a href="https://stackblitz.com/edit/angular-c9vbkt?file=src/app/app.component.ts" rel="noopener  ugc nofollow" target="_blank"><div class="km ab dw"><div class="kn ab ko cl cj kp"><h2 class="bd hj fi z dy kq ea eb kr ed ef hh bi translated">角形(叉形)堆叠</h2><div class="ks l"><h3 class="bd b fi z dy kq ea eb kr ed ef dx translated">一个基于rxjs，tslib，jquery，core-js，zone.js，bootstrap，popper.js，@angular/core的angular-cli项目…</h3></div><div class="kt l"><p class="bd b fp z dy kq ea eb kr ed ef dx translated">stackblitz.com</p></div></div><div class="ku l"><div class="kv l kw kx ky ku kz js kl"/></div></div></a></div></div></div>    
</body>
</html>