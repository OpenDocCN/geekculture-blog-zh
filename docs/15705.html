<html>
<head>
<title>Lesson learned: the sampling impact on monitoring</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">吸取的教训:取样对监测的影响</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/lesson-learned-the-sampling-impact-on-monitoring-cb454deeda88?source=collection_archive---------10-----------------------#2022-11-15">https://medium.com/geekculture/lesson-learned-the-sampling-impact-on-monitoring-cb454deeda88?source=collection_archive---------10-----------------------#2022-11-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f0abe9830d02c58095183ec68bdc64fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gk2XdGzJ_acnx1XWOksGJw.png"/></div></div></figure><p id="2355" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">今天，我想介绍一下您在日常监控图表中使用的指标可能会对您产生的影响。</p><p id="4f5e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你喜欢这个故事，记得鼓掌并订阅，我真的很感激！</p><p id="3719" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本文中使用的技术:</p><ul class=""><li id="ce11" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">库伯内特斯</li><li id="8701" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">新遗迹(类似普罗米修斯或数据狗)</li></ul><p id="e8c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我的目标是找到满足特定工作负载所需的适当数量的副本/资源(内存和cpu)。我不会讨论如何调优pod或HPA/VPA，因为没有神奇的方法来微调您的工作负载。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><p id="85d8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们将重点关注三个指标，它们会在您受到采样影响时突出显示:</p><ul class=""><li id="e52d" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">输入流量—在我的测试中保持不变</li><li id="f83d" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">副本数量</li><li id="3a5c" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">交易数量</li></ul><figure class="kl km kn ko fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/1f47723aebcdf14fb8cf73485cf06aa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q4B8Pgq-IVVqVOVeMiQpkQ.png"/></div></div></figure><p id="16df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从这张图中可以看出，有四个阶段:</p><ul class=""><li id="981c" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">20个副本，12万个事务</li><li id="f7d1" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">10个副本，6万个事务</li><li id="421c" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">5个副本，3万个事务</li><li id="e94f" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">猫耳朵复制品<a class="ae kp" href="https://emojipedia.org/cat/" rel="noopener ugc nofollow" target="_blank">🐈</a></li></ul><p id="85bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这种行为完全没有意义，因为输入流量在存在时基本上是恒定的。</p><p id="7e25" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，仔细观察绘制的指标:</p><pre class="kl km kn ko fd kq kr ks bn kt ku bi"><span id="b6f2" class="kv kw hi kr b be kx ky l kz la">Select rate(count(*), 1 second) from Transaction where containerName = 'pod-under-test' FACET containerName  TIMESERIES MAX LIMIT MAX</span></pre><p id="b5b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">浏览文档几分钟后，我终于发现了是怎么回事:</p><figure class="kl km kn ko fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/9ae7dde05cb594016277e922a6fa1167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sm3-b821Dh16W3k2UNV1zA.png"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx"><a class="ae kp" href="https://docs.newrelic.com/docs/data-apis/understand-data/event-data/new-relic-event-limits-sampling/#impact" rel="noopener ugc nofollow" target="_blank">https://docs.newrelic.com/docs/data-apis/understand-data/event-data/new-relic-event-limits-sampling/#impact</a></figcaption></figure><blockquote class="lg lh li"><p id="ce09" class="iq ir jo is b it iu iv iw ix iy iz ja lj jc jd je lk jg jh ji ll jk jl jm jn hb bi translated">有上限且需要抽样事件包括:<br/> -交易</p></blockquote><p id="165c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">🎉 🎉 🎉 🎉 🎉<br/>在高流量的情况下，每个pod发送的样本数量都达到了New Relic APM代理中默认配置的最大数量。</p><p id="458c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以，这种行为是由于意外的采样和具有意外含义的图形。</p><h1 id="6963" class="lm kw hi bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">吸取的教训:</h1><ul class=""><li id="6d48" class="jp jq hi is b it mj ix mk jb ml jf mm jj mn jn ju jv jw jx bi translated">始终验证您正在使用的指标。</li><li id="e278" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">不要绘制抽样指标，以避免错误的结论。</li></ul><p id="4368" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我希望你能从这篇博文中得到一些帮助，并支持我。你可以在接下来的几周内获得更多信息！</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><figure class="kl km kn ko fd ij er es paragraph-image"><div class="er es mo"><img src="../Images/5e942234f579c9081df2fc372dab8480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*BOuMEt5xHDy0yZE6mtKsFA.png"/></div></figure><blockquote class="mp"><p id="34d5" class="mq mr hi bd ms mt mu mv mw mx my jn dx translated"><a class="ae kp" href="https://pie-r.medium.com/" rel="noopener">关注我</a>和<a class="ae kp" href="https://pie-r.medium.com/subscribe" rel="noopener">订阅</a>来获取这个系列和下一个系列的更新！</p></blockquote><figure class="na nb nc nd ne ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mz"><img src="../Images/e7f0083d2d403fddee9b0b2ae88dc120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PEb_oUovOcoNiv5k"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx">Photo by <a class="ae kp" href="https://unsplash.com/@musicfox?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">River Fx</a> on <a class="ae kp" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div></div>    
</body>
</html>