<html>
<head>
<title>KubeStack — A Must Use</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">KubeStack —必须使用</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/kubestack-a-must-use-117a32efd427?source=collection_archive---------11-----------------------#2021-06-10">https://medium.com/geekculture/kubestack-a-must-use-117a32efd427?source=collection_archive---------11-----------------------#2021-06-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="5524" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">一个开源、易用的GitOps框架</h2></div><p id="15e0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">自动化是新的趋势。自动化帮助并影响了许多行业，但在我看来，IT行业从中获益最大。在自动化这个巨大的话题中，GitOps吸引了从全栈工程师到SREs和DevOps专业人员的大量关注。GitOps是一种为云原生应用程序应用连续部署的方法。这是一种使用开发人员友好的方法(如Git和持续部署)部署应用程序的方式。</p><p id="065d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">每当Git存储库中发生变化时，没有什么比自动部署存储在其中的配置更好的了。如果您是使用Kubernetes的开发人员，那么您一定遇到过从头开始重复部署应用程序的困难。舵图缓解了其中的一些痛点，但没有引入开箱即用的完美自动化。幸运的是，有一个新的开源框架将帮助您为Kubernetes (K8s)构建基础设施自动化。KubeStack 是一个开源的Terraform框架，面向希望实现基础设施自动化的团队。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ju"><img src="../Images/5e687ff63119b7a8f8fae48b66f3186d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Oo_ttcRus2NYwKZbf6cSA.png"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx">Image Source — <a class="ae jt" href="https://github.com/kbst" rel="noopener ugc nofollow" target="_blank">https://github.com/kbst</a> (Authorized by Owner)</figcaption></figure><p id="4e6e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">KubeStack是一个与Terraform生态系统集成良好的框架。KubeStack支持用于Kustomize和Terraform集成的Terraform模块和提供程序。KubeStack与亚马逊网络服务、谷歌云平台和Azure等主要云提供商进行了整合。它使用各自的云平台提供商来管理K8s集群，即亚马逊的EKS、Azure的AKS和谷歌的GKE。在这个框架中，集群基础设施和集群服务是使用Terraform模块定义的。</p><p id="a3ca" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">KubeStack的另一大特点是它是一个开源框架。有一些特性使它从竞争中脱颖而出，成为最受欢迎的自动化框架。为团队提供稳定的GitOps工作流、简化测试过的Terraform模块、重用测试过的Terraform模块的能力、加快应用程序开发速度等特性使自动化更加顺畅和高效。这是一个理想的解决方案，因为很容易将KubeStack与多个云K8s提供商(如EKS、AKS和GKE)集成。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es kk"><img src="../Images/3598a9991e78f7814c237b34e19f09cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*EiIa06Q0TEydulGq41Cnng.png"/></div><figcaption class="kg kh et er es ki kj bd b be z dx">Image by Author</figcaption></figure><p id="43c9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">KubeStack对我来说非常容易理解和安装，因为它有文档和教程。KubeStack文档写得很好，即使对于初学者也很容易理解。我用AWS平台尝试了KubeStack框架。这些命令和逐步指导教程对我的理解很有帮助。</p><p id="6e91" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae jt" href="https://www.kubestack.com/framework/documentation/tutorial-get-started" rel="noopener ugc nofollow" target="_blank"> KubeStack安装</a>包括三个主要步骤。</p><ol class=""><li id="c93d" class="kl km hi iz b ja jb jd je jg kn jk ko jo kp js kq kr ks kt bi translated">在当地发展</li><li id="7bfa" class="kl km hi iz b ja ku jd kv jg kw jk kx jo ky js kq kr ks kt bi translated">供应基础设施</li><li id="00fb" class="kl km hi iz b ja ku jd kv jg kw jk kx jo ky js kq kr ks kt bi translated">设置自动化</li></ol><p id="8060" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将详细介绍这些步骤，并解释我使用KubeStack的经历。</p><h1 id="c314" class="kz la hi bd lb lc ld le lf lg lh li lj io lk ip ll ir lm is ln iu lo iv lp lq bi translated">在当地发展</h1><p id="1951" class="pw-post-body-paragraph ix iy hi iz b ja lr ij jc jd ls im jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated">在我看来，这是KubeStack中最好的元素之一。开发人员可以在本地环境中模拟配置。多棒啊。如果您正在使用多个环境，比如开发、质量保证和生产，我确信这个特性会派上用场。您可以在本地机器上模拟您在特定环境中为云所做的配置更改。因此，您不必担心在将您的更改部署到云时可能出现的错误。</p><p id="6f28" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过利用本地主机开发，您可以降低与云提供商进行交互以排除故障和修复错误配置的成本。本地环境是通过使用一种称为KinD(Docker中的Kubernetes)的技术创建的，其中K8s节点作为Docker容器在本地运行。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es lw"><img src="../Images/af60c4d17949d23eb9d3e459e3389293.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*JwLy1idz0xSUpZIWoy4_BQ.png"/></div></figure><p id="908e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如你所见，KubeStack也是快速高效的。在初始阶段，在本地构建我的配置只花了112.5秒。</p><h1 id="6efb" class="kz la hi bd lb lc ld le lf lg lh li lj io lk ip ll ir lm is ln iu lo iv lp lq bi translated">供应基础设施</h1><p id="a50d" class="pw-post-body-paragraph ix iy hi iz b ja lr ij jc jd ls im jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated">这是教程的第二部分。如果您对本地更改感到满意，在这一步中，您可以将其移动到您首选的云提供商基础架构。KubeStack中有一个特殊的容器用于引导。该容器提供了与其他云提供商CLI工具类似的工具。</p><p id="5e7b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个阶段，您将创建GitOps存储库。为此，您需要设置身份验证方法和Terraform配置的远程状态。在此阶段创建了两个Terraform工作空间，称为应用程序和运营。在此阶段，远程状态配置应用于两个工作区。我跟随教程，这对我来说很容易设置。这些工作区创建AWS资源，例如:</p><ul class=""><li id="2b9c" class="kl km hi iz b ja jb jd je jg kn jk ko jo kp js lx kr ks kt bi translated">VPC和子网配置</li><li id="e124" class="kl km hi iz b ja ku jd kv jg kw jk kx jo ky js lx kr ks kt bi translated">路由表和RT关联</li><li id="e44d" class="kl km hi iz b ja ku jd kv jg kw jk kx jo ky js lx kr ks kt bi translated">互联网网关</li><li id="c2ed" class="kl km hi iz b ja ku jd kv jg kw jk kx jo ky js lx kr ks kt bi translated">Route53托管区域和相应的route 53记录</li><li id="741e" class="kl km hi iz b ja ku jd kv jg kw jk kx jo ky js lx kr ks kt bi translated">安全组</li><li id="7c17" class="kl km hi iz b ja ku jd kv jg kw jk kx jo ky js lx kr ks kt bi translated">IAM角色、策略和实例配置文件</li><li id="e24e" class="kl km hi iz b ja ku jd kv jg kw jk kx jo ky js lx kr ks kt bi translated">EKS集群—集群服务，节点组</li><li id="7cf8" class="kl km hi iz b ja ku jd kv jg kw jk kx jo ky js lx kr ks kt bi translated">Kustomization资源—</li></ul><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ly"><img src="../Images/e6502c9cb23115932c040ddfe3bbee2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vx66nmati0kfbxANnGXsQA.jpeg"/></div></div></figure><p id="7958" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在应用配置更改之后，需要将更改提交给git，以便在GitOps过程中遵循。</p><h1 id="16fc" class="kz la hi bd lb lc ld le lf lg lh li lj io lk ip ll ir lm is ln iu lo iv lp lq bi translated">设置自动化</h1><p id="078f" class="pw-post-body-paragraph ix iy hi iz b ja lr ij jc jd ls im jf jg lt ji jj jk lu jm jn jo lv jq jr js hb bi translated">这是KubeStack工作流程中我最喜欢的一步。在这个阶段，通过添加管道和实现GitOps工作流来创建自动化流程。</p><p id="2b95" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我创建了一个名为“<strong class="iz hj">infra structure-automation</strong>”的新存储库，并将本地存储库推给它。在为管道设置凭证之后，为GitOps流创建管道就像单击一个按钮一样简单。KubeStack教程包含管道文件，我所要做的就是遵循教程中的命令。</p><p id="5a17" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将更改推送到远程repo后，可以在发出拉请求时显示管道更改。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es lw"><img src="../Images/7ef6861cd0134285ad422b4984d50caa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*MXADNEM8aYI4593RJmGRog.png"/></div></figure><p id="6636" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就这样，我能够在很短的时间内在AWS中部署K8s集群。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es lw"><img src="../Images/c81bdc200af792fe17f5a565ea767b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*uHLsgH3J2oIRLFwgZY4jNg.png"/></div></figure><p id="acdc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">总的来说，我对KubeStack的体验非常满意。这个过程花费了一个多小时，而我能够在两分钟内使用GitOps工作流进行部署。如果您链接您的存储库来触发自动化管道运行，您将能够为您的部署节省大量时间。KubeStack是K8S项目的优秀自动化框架工具。我向任何SRE和DevOps工程同事推荐这一框架，并了解它如何简化您的日常运营工作。</p></div></div>    
</body>
</html>