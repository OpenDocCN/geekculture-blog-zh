# 使用地理编码创建基于位置的搜索

> 原文：<https://medium.com/geekculture/creating-a-location-based-search-using-geocoding-a139ff48212?source=collection_archive---------7----------------------->

![](img/eaf42fcebfc9a234a645385dafa4332e.png)

[https://miro.medium.com/max/1181/1*AS1LAUPL5gfRCZb1M2T1gg.jpeg](https://miro.medium.com/max/1181/1*AS1LAUPL5gfRCZb1M2T1gg.jpeg)

我喜欢船。如果你看过我的媒体故事，你会看到我发布的第一个故事是关于我买游艇的。让我重申一下，我并不富有。这是对我未来的投资，而不是买房子。

总之，我开始了一个项目，类似于 AirBnB，只是为了船滑。这个想法是让人们把他们的卡片放在网站上，当他们不在的时候，可以把它们租出去。

结果是，游艇码头不允许这样做，并明确告知他们的合同中不允许这样做。由于这个限制，我决定放弃这个项目，然后再花更多的钱在它上面进行营销。

然而，我确实学到了很多基于位置的搜索，并想分享我在如何实现这种搜索方面的经验。

# 什么是基于位置的搜索？

你可能已经知道它是什么了。当你在你的区域寻找一家新餐馆试一试时，或者当你外出在路上寻找最近的加油站时，你每天都要使用它。

简单地说，基于位置的搜索就是根据你的位置和它的相对物理位置来搜索某样东西。基于位置的搜索帮助我们看到任何东西都可以在我们的范围内，不管我们在哪里。

# 我是如何实现基于位置的搜索的？

## 收集数据

你首先需要的是一些数据。无论是你用一些随机的 GPS 坐标创建的假位置，还是从网站上搜集的真实数据，你肯定需要某种包含 GPS 坐标的数据。

对我来说，这些数据是用户发布在平台上出租的清单。当用户张贴纸条时，他们需要输入纸条的准确位置的 GPS 坐标，这样就可以用小册子在卫星图像上显示出来。有了 GPS 坐标，我还可以实现搜索功能。

## 将搜索字符串转换为 GPS 坐标

现在我有了带有坐标的纸条列表，我需要弄清楚如何获得用户输入的位置的 GPS 坐标。

幸运的是，有一些服务提供地理编码或者将一个位置转换成 GPS 坐标。

首先，我看了一下谷歌地理编码 API。然而，一开始我决定不这么做，因为我不得不为每个请求支付一点点费用。由于我刚开始只是测试，并不期望平台上线后会有太多的负载，所以我可以使用一些更具限制性的东西。

这时我偶然发现了 OpenCage 地理编码器 API。

[OpenCage](https://opencagedata.com/) 是一个地理编码 API，它聚合来自多个来源的数据，并使用置信度得分对每个结果进行评级。置信度越高，这个结果就越有可能是你想要的。更棒的是，OpenCage 提供免费试用，允许你以 1 次请求/秒的速度每天发送 2500 次请求。

这对于发布平台来说已经足够好了。如果我需要更多，我会转而使用其他服务，但是 2500 个请求已经足够了。

OpenCage 社区还为 30 多种语言和框架提供了[SDK](https://opencagedata.com/sdks)和[教程](https://opencagedata.com/tutorials)，这非常棒。

因为我用 Java 编写了我的后端，所以我使用了[jopen page SDK](https://github.com/moberwasserlechner/jopencage)来处理请求。老实说，这是一个非常简单明了的实现。

下面是 JOpenCage 的用法:

我所要做的就是创建一个 JOpenCageGeocoder 的实例，创建一个带有地理编码所需位置的转发请求，然后获得响应。方法“getFirstPosition”以最高的可信度返回结果，这正是我想要的。

## 做一些数学

现在，我已经有了一个位置列表，其中包含它们的 GPS 坐标和被搜索位置的 GPS 坐标，我必须计算出哪些卡瓦在被搜索位置的某个半径范围内。

一个简单的谷歌搜索给了我一个 StackOverflow 帖子，上面有我正在寻找的东西:

我承认我不再理解它背后的数学原理，但是代码片段确实起作用了。为了确保它能工作，我用真实世界的位置编写了单元测试，它们都通过了。

# 敲定一切

我所要做的就是浏览每一张纸条，并检查地理编码搜索位置是否在给定的半径范围内，仅此而已。

起初，实现这样的东西似乎是一项只有专家才能实现的艰巨任务，但事实证明它比预期的要容易得多。

所以，如果你需要实现基于位置的搜索，我的建议是去做吧。这并不困难，即使不是生产代码，做这样的事情也是非常值得的。