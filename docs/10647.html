<html>
<head>
<title>Learn Solidity : Addresses and Global Variables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习可靠性:地址和全局变量</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/learn-solidity-2-addresses-and-global-variables-667ffdb924d7?source=collection_archive---------5-----------------------#2022-02-09">https://medium.com/geekculture/learn-solidity-2-addresses-and-global-variables-667ffdb924d7?source=collection_archive---------5-----------------------#2022-02-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/82dbc0dfb90483f9b5ac28ce21dd0498.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xc4XWLHRlOSuroGSqgVX-g.jpeg"/></div></div></figure><p id="18ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇文章是正在进行的学习可靠性系列的继续。为了更容易理解这篇文章，请查阅以前的文章。</p><div class="jo jp ez fb jq jr"><a rel="noopener follow" target="_blank" href="/geekculture/learn-solidity-1-simple-variables-dc2750f05d57"><div class="js ab dw"><div class="jt ab ju cl cj jv"><h2 class="bd hj fi z dy jw ea eb jx ed ef hh bi translated">学习可靠性— 1:简单变量</h2><div class="jy l"><h3 class="bd b fi z dy jw ea eb jx ed ef dx translated">自从以太坊引入了图灵完整系统——智能契约，它彻底改变了…</h3></div><div class="jz l"><p class="bd b fp z dy jw ea eb jx ed ef dx translated">medium.com</p></div></div><div class="ka l"><div class="kb l kc kd ke ka kf io jr"/></div></div></a></div><h1 id="345b" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">更多关于地址的信息</h1><p id="8168" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">在以太坊和Solidity中，地址的大小为<strong class="is hj"> 20字节值</strong> (160位或40个十六进制字符)。正如我们在上一篇文章中了解到的，一个地址可以分别通过<em class="lj"> balance </em>和<em class="lj"> transfer </em>方法来获取余额或转移余额。在本节中，我们将通过一个示例契约来更深入地了解这些方法。</p><p id="fa99" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将创建一个可以管理自己资金的示例合同。我们将从与合同交互的地址接收资金，也从合同向用户指定的地址发送资金。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/c99c8adbd43ec205a5d96f340717fdc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*A-ziBphn47-LuGFveavA4A.png"/></div><figcaption class="lp lq et er es lr ls bd b be z dx">Example contract</figcaption></figure><p id="7a52" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在契约中，我们定义了三个函数，<strong class="is hj">receivemoneyto()</strong>，它从与契约交互的地址接收资金，<strong class="is hj"> getBalance()，</strong>，它返回契约地址持有的余额，以及<strong class="is hj"> sendMoneyTo()，</strong>，它将资金从契约地址发送到用户指定的地址。</p><p id="173e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意，我们在recieveMoneyTo()函数中使用了修饰符<strong class="is hj"> payable </strong>。应付款修饰符使函数处理非零值的事务处理。如果一个转移Ether的交易来到契约，调用某个函数X，那么如果这个函数X没有payable修饰符，那么这个交易就会被拒绝。</p><p id="a549" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在recieveMoney()函数内部，我们使用了一个全局变量<code class="du lt lu lv lw b">msg</code>来更新totalRecieved的值。<code class="du lt lu lv lw b">msg</code>全局变量是特殊的全局变量，包含允许访问区块链的属性。<code class="du lt lu lv lw b">msg.value</code>是以太网上发送(状态转换)交易时msg(消息)对象的成员。<code class="du lt lu lv lw b">msg.value</code>自动设置为通过<code class="du lt lu lv lw b">payable</code>功能发送的乙醚量。</p><p id="225f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">还要注意，在函数sendMoneyTo()中，我们声明了一个<strong class="is hj">地址应付款</strong>变量_to。<code class="du lt lu lv lw b">address</code>和<code class="du lt lu lv lw b">address payable</code>的区别在于，你可以发送以太到一个定义为address payable的变量，但不能发送到一个定义为address的变量。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es lx"><img src="../Images/24ea2918211f4ced69391d363a45828f.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*ptMf4ECYAuklD9rCqvTnnQ.png"/></div><figcaption class="lp lq et er es lr ls bd b be z dx">10 Wei as value.</figcaption></figure><p id="b1df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我已经选择了一个有100个测试以太网的JavaScript VM帐户，并且我已经输入了<strong class="is hj"> 10 Wei </strong>作为要发送给该帐户正在与之交互的合同的值。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/798c99d6f80b29bb9a3f1b413a9f6058.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*TS__4h7d7t6JVS6eg6lZNg.png"/></div><figcaption class="lp lq et er es lr ls bd b be z dx">deployed contract.</figcaption></figure><p id="78ed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">recieveMoney()函数收到了我的帐户转来的10元钱。您可以使用getBalance()查看余额。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es lz"><img src="../Images/d4fce072108b0a24b5ede7f5637f23cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*CxfxJQ1WLVY50RiKM76Zcg.png"/></div><figcaption class="lp lq et er es lr ls bd b be z dx">getBalance() and totalRecieved().</figcaption></figure><p id="24be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我又发送了3个Wei到契约，契约地址现在总共保存了13个Wei。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/0541f34a99ee616c0a389c999bb30c79.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*3V_OxscNCHsEmax3AbPuOw.png"/></div><figcaption class="lp lq et er es lr ls bd b be z dx">sendMoneyTo()</figcaption></figure><p id="a6ac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我使用sendMoneyTo()函数将合同帐户持有的所有资金发送到我指定的另一个帐户。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es mb"><img src="../Images/3a799cbfe6587dfe875730d3503d80f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*O-jY-38kAo1SFOsKIWt0bQ.png"/></div></figure><p id="b1d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可以看到这个账户从合同中收到了13魏。现在，如果您检查收到的总额，金额将是<strong class="is hj"> 13魏</strong>，而getBalance将是<strong class="is hj"> 0 </strong>。</p><p id="7189" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们的示例合同中，我们看到有两种类型的帐户存储以太网，即<strong class="is hj">外部拥有的帐户</strong>和<strong class="is hj">合同帐户</strong>。外部拥有的帐户是由私钥控制的帐户，并且能够从私钥发送以太网和消息。我们用来向合同发送ether的JavaScript虚拟机帐户是外部拥有的帐户。合同帐户有一些相关的代码，可以发送或接收以太网。eoa在以太坊区块链之外，而合约账户在区块链之内，完全由代码控制。</p><h2 id="3fa2" class="mc kh hi bd ki md me mf km mg mh mi kq jb mj mk ku jf ml mm ky jj mn mo lc mp bi translated">改进我们的示例合同</h2><p id="8b0c" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">有时，我们只需要合同的所有者就可以提取发送给合同的资金，这与我们之前的合同不同。让我们学习如何使用全局变量和地址来实现这一点。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/8173ccfb4e2a138f58f23ca8bedff962.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t61WO_MDC4GBzW9HmI6Nlw.png"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx">Example contract 2</figcaption></figure><p id="1695" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们定义了两个函数<em class="lj"> sendMoney() </em>，通过它向合同发送资金，以及<em class="lj"> withdrawAllMoney() </em>，通过它可以从合同中提取资金。</p><p id="ddcc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，我们定义一个<strong class="is hj">地址</strong>所有者，在契约的<strong class="is hj">构造器</strong>中，我们将它初始化为<code class="du lt lu lv lw b">msg.sender</code>，这是在部署契约时当前与契约交互的地址。因为只有在部署协定时才调用构造函数，所以设置了所有者地址。</p><p id="9c36" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了取钱，我们检查当前与合同交互的地址是否等于所有者地址。如果是，那么钱就被取出来了。我们使用<strong class="is hj">要求</strong>功能来检查条件。要求可靠性功能保证了在执行之前无法检测到的条件的有效性。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es mr"><img src="../Images/3aa0ee862428de000a108c3db487a908.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*jgG4-ytYMnanpK-oVG_COg.png"/></div><figcaption class="lp lq et er es lr ls bd b be z dx">Contract Deploy and Run Transactions</figcaption></figure><p id="d4ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我使用<em class="lj"> sendMoney() </em>函数从所有者帐户向合同发送10个以太网。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ms"><img src="../Images/1926de535615f2f142494abdb995be62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1-UetE6933JmX2zflmnXTQ.png"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx">withdraeAllMoney()</figcaption></figure><p id="5da7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，如果我试图从合同中汇款到一个不是所有者地址的不同地址，我会得到一条错误消息，说<strong class="is hj">“你不是合同的所有者”</strong>，交易将恢复到初始状态。</p><p id="6d8e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以添加额外的功能，如暂停和销毁智能合同到我们以前的合同，使其更加灵活。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/4930d569f225107e7c5ac24ad5e88ae4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3uCtSJQzfQ0HDnfsQuE2dg.png"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx">setPaused() function</figcaption></figure><p id="3bbd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此功能将暂停合同进行任何交易。我们以这样的方式定义<em class="lj"> setPaused() </em>函数，只有合同所有者可以暂停合同。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/06df13ddb6bfb72faedef8ff00845557.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*epF-m9nAYgYRBTVIhwgufQ.png"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx">destroyContract() function</figcaption></figure><p id="77a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了销毁契约，solidity有<em class="lj">自毁()</em>功能，将契约中存储的所有剩余乙醚发送到指定地址。当使用<em class="lj">自毁()</em>功能时，你必须小心，因为恶意合同可以利用它来强制发送以太到任何合同。</p><p id="3089" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇文章到此为止！我们将讨论映射、结构、数组等。在本系列的下一篇文章中。</p></div></div>    
</body>
</html>