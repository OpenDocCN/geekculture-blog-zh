<html>
<head>
<title>Interview Questions: Why can’t you create a file?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面试问题:为什么不能建档？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/interview-questions-why-cant-you-create-a-file-e08f3486a92a?source=collection_archive---------0-----------------------#2022-04-13">https://medium.com/geekculture/interview-questions-why-cant-you-create-a-file-e08f3486a92a?source=collection_archive---------0-----------------------#2022-04-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es et"><img src="../Images/04385e5487bbb629e40833b60cfd6f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lWoQ15WhTHfg8zFh4oWRZA.jpeg"/></div></div></figure><h1 id="f2db" class="ip iq hi bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">介绍</h1><p id="7166" class="pw-post-body-paragraph jn jo hi jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">最近和我的朋友聊天时，他告诉我一个他在面试中被问到的简单问题。该公司是一个知名的家庭品牌，薪酬也是他在业内听到的最好的薪酬之一。但是这个问题并不常见。问题很简单，“我试图在Linux上创建一个文件，但是我做不到。发生这种情况的可能原因是什么？</p><p id="59e6" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">这个问题很独特，但这种<em class="kl">类型的问题</em>一点也不独特。诸如此类的开放式问题意在考察应聘者的思维过程和技能。我真的很喜欢这个问题，因为它与候选人的具体经历或使用的技术无关。</p><p id="01cb" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">比如“<em class="kl">如何在NodeJS </em>中做XYZ”，或者“<em class="kl">如何配置NGINX </em>”之类的问题，在我看来都不是什么大问题。当然，他们可以告诉面试官某人是否了解NodeJS或NGINX，但是你真的想雇佣特别了解NodeJS或NGINX的人吗？如果您决定在Django中构建一个新的服务，或者将来在Golang中使用一些web框架，该怎么办？如果公司决定转向不同的代理，比如Envoy，该怎么办？</p><p id="c2f2" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">类似于"<em class="kl">的问题我试图在Linux上创建一个文件，但是我不能。能发生这种情况的可能原因是什么？”</em>是很好的问题，因为它允许候选人在更广泛的领域展示他的技能和经验<em class="kl">。</em>一个DevOps/SRE的家伙可能会开始专门考虑Linux，考虑服务器、权限、进程或inodes。具有云经验的后端人员可能会开始考虑与云基础架构相关的原因，如EBS卷中的错误配置、EFS卷中的错误配置问题等。全栈开发人员可能会认为API正在以编程方式编写文件，并认为代码给出了错误消息，等等。这些都不是错误的答案，但它们显示了受访者的经验和知识。</p><p id="b12d" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">在这个系列中，我想提出类似这样的开放式问题，并深入讨论我的答案，回顾相关的技术以及它们是如何结合在一起的。这些问题可能有一百万个答案，所以请在评论中告诉我你认为可能的答案。</p><h1 id="43e7" class="ip iq hi bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">这个问题</h1><p id="a210" class="pw-post-body-paragraph jn jo hi jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我想在这篇文章中讨论的问题是，</p><p id="1eaa" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">我试图在Linux上创建一个文件，但是我做不到。发生这种情况的可能原因是什么？</p><p id="7eda" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">在你阅读我的答案之前，试着想一想，看看你能想到什么可能的解决方案。为了便于阅读，我还将我的答案从最容易到最难排序，并且有一些链接可以更好地理解每个答案中的主题。</p><h1 id="3cb4" class="ip iq hi bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">可能的答案</h1><h2 id="d368" class="kr iq hi bd ir ks kt ku iv kv kw kx iz jy ky kz jd kc la lb jh kg lc ld jl le bi translated">没有剩余的磁盘空间</h2><p id="f140" class="pw-post-body-paragraph jn jo hi jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">这可能是最简单的答案之一。显然，要创建一个文件，您的辅助存储器中应该有足够的磁盘空间来创建它。您可以将简单的固态硬盘视为本地服务器，或者将存储视为云环境中的云资源(如EBS卷)。</p><p id="6cda" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">接下来的问题可能是你如何知道还有多少存储空间。有很多方法可以解决这个问题。我的方法是检查您已经拥有的任何指标/仪表板。许多AWS服务为您提供磁盘使用指标，或者您也可以在CloudWatch上创建自己的指标。可能有一些配置要求，例如，安装代理，但除此之外，过程应该非常简单。</p><p id="9239" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">你也可以查看其他第三方解决方案，比如Nagios。<a class="ae lf" href="https://www.youtube.com/watch?v=CAQ_a2-9UOI&amp;t=342s" rel="noopener ugc nofollow" target="_blank">关于监控有很多要说的</a>，这篇文章并不是真的要说这个，但是要知道有很多方法可以监控你的磁盘使用情况，设置警报，以及配置所有这些。</p><p id="d3a7" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">最后，一个简单的<code class="du lg lh li lj b">df -h /</code>也是一个有效的答案，虽然通常在较小的应用程序或概念证明中使用。</p><h2 id="5506" class="kr iq hi bd ir ks kt ku iv kv kw kx iz jy ky kz jd kc la lb jh kg lc ld jl le bi translated">权限问题</h2><p id="c66a" class="pw-post-body-paragraph jn jo hi jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">另一个可能导致您无法创建文件的简单问题是权限问题。可能是进程或用户没有在该目录下创建文件的权限。</p><p id="ce67" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">一个可能的反问题是如何检查用户或进程是否有正确的权限。这很大程度上取决于您如何配置您的服务器。运行一个简单的<code class="du lg lh li lj b">ls -l</code>应该会告诉你任何文件/目录的权限。</p><h2 id="fda6" class="kr iq hi bd ir ks kt ku iv kv kw kx iz jy ky kz jd kc la lb jh kg lc ld jl le bi translated">高CPU/内存消耗</h2><p id="5620" class="pw-post-body-paragraph jn jo hi jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">您执行的每个命令通常都会在自己的进程中执行。每个进程都必然有一些资源，并利用某种程度的CPU和内存。</p><p id="abbb" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">在最简单的层面上，任何正在运行的进程都会存储一堆关于它自己的元数据信息，比如打开的文件描述符、它的PID、它的状态等等。操作系统还会尝试运行该进程，在我们的示例中，该进程可能会打开一个文件，写入该文件并关闭它。这需要少量的RAM和CPU。没有这一点，该进程就不可能正常工作。</p><p id="45e0" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">因此，如果您的服务器RAM已满和/或正在运行的进程使用了100%的CPU，您就不太可能创建新文件。事实上，试图创建新文件的进程也可能会冻结。例如，如果您试图通过在SSH shell中运行<code class="du lg lh li lj b">touch newfile</code>来创建一个新文件，如果CPU和内存消耗足够高，您就不太可能通过SSH进入服务器。</p><h2 id="acf5" class="kr iq hi bd ir ks kt ku iv kv kw kx iz jy ky kz jd kc la lb jh kg lc ld jl le bi translated">分区问题</h2><p id="3694" class="pw-post-body-paragraph jn jo hi jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">分区问题也会导致您无法创建新文件。也许您已经将您的EBS卷配置为具有多个分区，或者也许您决定增加您的EBS卷的大小，但是还没有更新OS文件系统，或者卷的一些其他错误配置。</p><p id="2d6a" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">一般来说，分区本身就是一个很大的话题，所以对它的修改可能会导致您无法在卷中创建新文件的情况。</p><h2 id="db7e" class="kr iq hi bd ir ks kt ku iv kv kw kx iz jy ky kz jd kc la lb jh kg lc ld jl le bi translated">使用网络文件系统时的网络问题</h2><p id="a73e" class="pw-post-body-paragraph jn jo hi jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">您可能正在使用基于NFS或SMB等协议的网络文件系统。其工作方式是，从技术上讲，您的文件存储在另一台服务器上，但另一台服务器可以使用网络协议读写这些文件。</p><p id="5754" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">一个流行的例子是AWS的EFS(弹性文件系统)。该服务允许您创建一个网络文件系统，然后将其作为一个卷挂载到EC2实例中。如果你想了解更多，T2官方文件做了很好的解释EFS是什么。<a class="ae lf" href="https://docs.aws.amazon.com/efs/latest/ug/wt1-test.html" rel="noopener ugc nofollow" target="_blank">这个在EC2上挂载和EFS文件系统的演练</a>也是一个很好的资源。</p><p id="b820" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">由于您的文件系统现在依赖于网络，可能导致服务器之间断开连接的问题(例如，防火墙、安全组、NACL、子网问题)也可能导致文件写入或读取问题。</p><h2 id="7cd7" class="kr iq hi bd ir ks kt ku iv kv kw kx iz jy ky kz jd kc la lb jh kg lc ld jl le bi translated">信息节点耗尽</h2><p id="6023" class="pw-post-body-paragraph jn jo hi jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">信息节点存储关于系统中文件或目录的元数据。该元数据存储诸如文件位置、文件大小、文件链接数量等信息。所有常规文件都有一个inode。</p><p id="2f03" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">您的操作系统对每个文件系统上可以创建的inodes数量有限制。运行<code class="du lg lh li lj b">df -i</code>向您展示可以创建的最大索引节点数量、当前使用的索引节点数量和空闲的索引节点数量。</p><p id="61ac" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">例如，对于我的个人笔记本电脑，我得到了根文件系统的如下输出</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="b40e" class="kr iq hi lj b fi ls lt l lu lv">Filesystem       Inodes   IUsed    IFree IUse% Mounted on<br/>/dev/nvme0n1p2 31227904 2439357 28788547    8% /</span></pre><p id="feff" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">不用说，创建31，227，904个文件并不常见，但是可能会出现索引节点耗尽的情况，<a class="ae lf" href="https://stackoverflow.com/questions/52628094/docker-inode-exhaustion-when-pulling-image-from-docker-hub" rel="noopener ugc nofollow" target="_blank">例如</a>。此外，如果您的inodes耗尽，错误消息通常会指示您的磁盘已满，即使它可能还有很多剩余空间。</p><p id="359c" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">需要注意的另一个有趣的地方是，一些文件系统，如<a class="ae lf" href="https://serverfault.com/a/505742" rel="noopener ugc nofollow" target="_blank"> ZFS，对于可以在fs </a>中分配的inodes数量没有限制。</p><h2 id="b3b7" class="kr iq hi bd ir ks kt ku iv kv kw kx iz jy ky kz jd kc la lb jh kg lc ld jl le bi translated">PID耗尽</h2><p id="6b92" class="pw-post-body-paragraph jn jo hi jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">在bash上运行命令通常包括两个步骤</p><ol class=""><li id="5936" class="lw lx hi jp b jq km ju kn jy ly kc lz kg ma kk mb mc md me bi translated"><code class="du lg lh li lj b">fork</code>创建新的重复流程</li><li id="ea8c" class="lw lx hi jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated"><code class="du lg lh li lj b">exec</code>用您想要运行的流程替换新流程</li></ol><p id="85cc" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">Bash会在没有您任何干预的情况下完成这项工作，但是您应该知道，您执行的每个命令都会创建一个新的进程。</p><p id="492b" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">如果您正在使用类似于<code class="du lg lh li lj b">touch</code>或<code class="du lg lh li lj b">nano</code>的东西创建一个文件，那么bash很可能会为您创建一个进程，在进程中运行该命令，并在命令完成后终止该进程。因为每个新进程都需要一个PID，所以生成这个创建文件的进程也需要一个PID。</p><p id="e10f" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">PID耗尽理论上是可能的，文件<code class="du lg lh li lj b">/proc/sys/kernel/pid_max</code>定义了可能的PID的最大数量。例如，在我的笔记本电脑中，这个值是4，194，304。正如这个<a class="ae lf" href="https://unix.stackexchange.com/a/304076" rel="noopener ugc nofollow" target="_blank">的回答</a>所解释的，没有对PID递增的要求，唯一的要求是当前运行的进程的PID应该是唯一的。因此，为了用尽可能的PID，您需要400多万个进程同时运行，这似乎不是一个常见的场景。</p><p id="090e" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">还有其他相关的限制需要考虑，例如，在任何时间点可以打开的文件描述符的数量限制(如果您想进一步了解文件描述符，我写了一篇关于文件描述符的文章)。根据服务器配置和您使用的特定Linux发行版，还可能有其他形式的限制。如果你想了解更多，这是一个很好的资源。</p><p id="a032" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">尽管这看起来不太可能发生，但它仍然是一个有效的答案，并展示了你跳出框框思考的技巧。</p><h2 id="64c8" class="kr iq hi bd ir ks kt ku iv kv kw kx iz jy ky kz jd kc la lb jh kg lc ld jl le bi translated">断电</h2><p id="6332" class="pw-post-body-paragraph jn jo hi jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">另一个简单的原因可能是用于管理文件系统的服务中断。例如，EBS中的中断会导致您在使用EBS卷时无法创建文件。</p><h1 id="7062" class="ip iq hi bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">结论</h1><p id="ba8b" class="pw-post-body-paragraph jn jo hi jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">如果你喜欢这篇文章，一定要看看我最近写的一篇类似的文章，关于另一个非常流行的面试问题— <a class="ae lf" rel="noopener" href="/geekculture/interview-questions-how-to-improve-the-performance-of-your-database-21b42aba352e">面试问题:如何提高数据库的性能</a></p><p id="70a0" class="pw-post-body-paragraph jn jo hi jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">感谢您花时间阅读本文。如果你有任何反馈，请在评论中告诉我。</p></div></div>    
</body>
</html>