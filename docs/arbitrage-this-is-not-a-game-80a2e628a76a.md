# 套利——这不是游戏

> 原文：<https://medium.com/geekculture/arbitrage-this-is-not-a-game-80a2e628a76a?source=collection_archive---------15----------------------->

![](img/be19eebe152bc8c8b4dafb2b5636e5f3.png)

Photo by [Sean Do](https://unsplash.com/es/@everywheresean?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

本文将描述我如何为我最近开始玩的一个游戏创建和实现一个交易模型。即使它“只是一个游戏”，因此“不是真实的”。它仍然是一个很好的沙盒，可以用来玩、探索概念和提高编码技能。

我将从描述市场状况开始，然后从中得出结论。下一步将是剖析我创建的第一个模型，最后我将描述所有的缺陷和如何改进。

# 这一切都始于一场游戏

几个月前，我开始玩《最终幻想 14 》,这是一款大型多人在线角色扮演游戏(MMO ),背景是广受欢迎的《最终幻想》宇宙。和通常的 MMO 游戏一样，这款游戏有一个拍卖行，你可以用游戏中的货币买卖游戏中的物品。

虽然这对大多数人来说可能只是一个附带功能，但如果玩得好，它可以成为虚拟收入的一个巨大来源。

# 事实

让我们首先收集市场的确凿事实，因为它们为我们确实需要的模型设定了界限。

![](img/c83abee3fb21715b57ad0f24455adb66.png)

Photo by [Ben Hershey](https://unsplash.com/@benhershey?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

*   游戏中的货币叫做‘吉尔’。
*   这些市场被称为“市场板块”。
*   这个游戏有所谓的“数据中心”,也就是他们各自区域的数据中心。每个数据中心都有多个世界，您可以轻松地在这些世界之间穿梭。(加载只需要几秒钟，而且你不用支付任何费用。)
*   数据中心世界之间的市场板没有连接。这意味着不同世界的价格会根据玩家基础产生的供给和需求而有所不同。
*   一个角色只能在他们的家乡世界(即他们被创造出来的世界)的市场上出售物品，但是可以从他们的数据中心的每个世界购买。
*   如果你想出售一件物品，你必须下一个卖单，指定每件物品的价格和你想作为一堆出售的物品的数量。堆栈大小限制为 99。
*   买单不可用！如果你想买一件物品，你必须在现有的卖单中进行选择。
*   部分买入卖单是不可能的。你必须买下整个位置。
*   销售产生 5%的费用。事实上，它可以减少到 3%,但为了简单起见，我们将使用 5%,因为这不会改变一般的方法。
*   如果你在一个不是你家乡的世界购买一件物品，只需支付 5%的费用。
*   直接访问市场数据是不可能的，但是有网站让用户收集和上传价格数据。例如 [Universalis](https://universalis.app/) ，它方便地提供了一个 API，我们可以用它来查询订单和销售数据。(作为一个旁注，实际上似乎有一个 API 用于游戏中的市场数据，但它不是公开的。)
*   交易全天候进行。

# 暗示

现在是时候从上面的事实中得出一些结论了。同样，让我们以要点的形式来做这件事。

*   因为不同世界的市场板没有连接，跨世界套利机会可能出现。
*   理想情况下，您会希望将您家乡的买入订单与国外的卖出订单相匹配，并立即执行。但是因为你只能在你的家乡创建一个卖单，价格可能会迅速下跌，让你无所适从。这意味着所选择的方法存在一定的风险，因此从技术上讲，谈论“套利”可能并不完全正确。但我会继续这样做，因为这样听起来更酷。
*   不能部分执行订单也很麻烦。一方面，你可能负担不起一个有利可图的职位。另一方面，这迫使我们在推销自己时考虑好筹码数量。
*   因为我们无法获得最新的数据，我们发现的套利机会可能不再存在。

# 模型 v0.1

![](img/cdc5fdec3f1c42fe6a1f9c6962e2dd43.png)

Photo by [GVZ 42](https://unsplash.com/@gvz42?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

这是我的第一个模型的高级工作流程。

*   查询给定世界上最后更新的项目列表。Universalis 为此提供了一个 [API 端点](https://docs.universalis.app/#most-recently-updated-items)。
*   对于每件物品，我将通过再次查询 Universalis 的 [API 来确定我的数据中心的每个世界的最低价格。](https://docs.universalis.app/#market-board-current-data)
*   计算其他世界的价格与我的家乡世界的价格之间的差异，并记住所有价格差异为正的服务器，即我可以赚钱的服务器。
*   查询过去交易的列表(再次调用 [Universalis API](https://docs.universalis.app/#market-board-sale-history) )并过滤过去 14 天的交易。计算每天交易的物品总数。然后，计算可用天数的最大值、最小值和中值。
*   作为衡量一件商品利润的标准，我计算了“中值利润”,即计算出的价格差乘以交易商品的中值数量。
*   最后我会报告那些有
*   有利可图的差价
*   过去 14 天中 85%的日子有交易活动。

# 缺点

每个旅程都要从第一步开始。这种情况下也是如此。你可能不会感到惊讶，这种模式效果不太好。但是它允许探索基本的概念和基本的实现技术。

说够了！以下是迅速出现的问题，以及一些未来可能的改进。

“中值胜利”令人难以置信地具有误导性。它通常会高估潜在的胜利，显然是由于其糟糕的设计。

*   可能只有一个头寸的定价会比其他头寸便宜得多。所以同样的差价在其他头寸上无法实现。
*   或者，有利位置的数量可能少于中位数。
*   将其他世界的实际列表与我的家乡世界的最低价格进行比较会好得多。这样我就能看到利润。

事实证明，“随机”挑选商品并不是最好的方法。真是个修卡！这样就很难找到潜在的套利机会，即使找到了，也可能是在需求很少的类别中。

*   专注于需求更高、交易活动也更活跃的类别，会更有希望。这一部分的利润可能较小，但能够快速平仓可以降低风险。开仓时间越长，价格下跌的可能性就越大。
*   按类别分类需要准备项目到类别的映射。这是可以实现的，因为这些数据是免费提供的。

我完全忽略了费用。

*   幸运的是，这件事的影响还不算太坏。它只是略微高估了利润率。最重要的是，它很容易修复。只需将费用添加到价格差异的公式中。如此简单，以至于你想知道为什么它没有在第一时间实现。

我的脚本有很差的错误处理，这将导致它崩溃的非流动性的项目。

*   大部分是恼人的，没有什么是不能很快修复的。

处理绝对价格差异。昂贵的项目会产生更大的差价，但也会带来更大的风险/需要更大的初始投资。5000 英镑的差价听起来似乎很大，但当这件商品的价格达到 700 万英镑时，就不值得这么做了。

*   这可以通过将成功与所需投资相关联来解决。

很难决定我的卖单的筹码数量。我知道每天的交易量，但不知道应该选择多大的筹码。

*   这是一个棘手的问题。我注意到了一些物品的趋势，例如，当人们需要较少的物品时，他们会花更多的钱购买较少的物品。
*   一种可能的方法是查看过去堆栈大小的直方图，但我感觉这里有更多的东西要揭示。

最后一个缺点较少，但包含了很多潜力:根据工作日的不同，商品的价格似乎会有波动。这可以从更多的人在周末玩耍的事实中得到证明。然而，其影响并不容易预测。也许这意味着需求增加是因为每个人都需要某种物品，或者相反，供应增加是因为生产了更多的物品。

*   这里的大问题是数据的可用性，因为 Universalis 似乎没有保存完整的销售历史。因此，有必要自己创建一个价格时间序列，然后分析一周内的价格变化。

# 履行

最后，我想简单介绍一下我是如何实现这个脚本的，而不涉及太多的细节。一切都是用 Python 实现的，并在我的 Windows 游戏电脑上的 Windows 子系统下运行。这让我每次都吃吃地笑，因为我认为我是唯一一个在玩游戏时在他的第二个屏幕上有 bash 窗口的人。

API 请求通过“请求”包完成，最经常需要的调用被封装在函数中。

数据争论是通过“熊猫”完成的，这让我头疼不已，因为我对这个包不太熟悉。还因为我清楚地知道如何用一组 SQL 语句实现我想要的东西。
这对于日期和日期时间操作来说特别烦人。

# 结论

到目前为止，这个项目有起有落。

实现有时相当令人沮丧。尤其是因为我清楚地知道如何用其他工具解决问题。似乎这还不够，最终结果比我希望的更不可用。

但是他们怎么说:‘重要的是旅程，而不是目的地’。思考发现套利的方法真的很有趣，模型的第一个版本使得改进变得非常容易。

实施过程中的问题也很有教育意义，现在我对熊猫有了第一印象。如果我要重复实现的话，我可能仍然需要谷歌所有的东西。但也许在这个过程中我会更快一点。

我肯定想继续这个项目，因为它拥有巨大的潜力，甚至在这里提到的事情之外，我肯定会带你一起踏上旅程。

你对如何改进我的模型有其他想法吗？或者你在其他地方意识到套利的可能性了吗？请在评论中告诉我。

*原载于 2022 年 6 月 22 日*[*【https://topjer.net】*](https://topjer.net/index.php/2022/06/22/arbitrage-this-is-not-a-game/)*。*