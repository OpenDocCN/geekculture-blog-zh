<html>
<head>
<title>Getting Started with DynamoDB using Rust Language</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Rust语言开始使用DynamoDB</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/getting-started-with-dynamodb-using-rust-language-5876686f352d?source=collection_archive---------8-----------------------#2021-11-15">https://medium.com/geekculture/getting-started-with-dynamodb-using-rust-language-5876686f352d?source=collection_archive---------8-----------------------#2021-11-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2e4c3a6e7a6bfc0b2eb73c5ee592a7a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9ehRtNANfcZP9kur"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@marcojodoin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Marc-Olivier Jodoin</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8ee2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本文展示了一些使用Rust在DynamoDB上执行基本操作的例子和代码片段。</p><p id="834c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为此，我们将使用Rusoto库，它有许多与AWS集成的优秀特性。查看<a class="ae iu" href="https://rusoto.github.io/rusoto/rusoto_dynamodb/" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多详情！</p><p id="ad8a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，我们将在本地运行DynamoDB，将其用作docker容器，因此您不需要在AWS帐户中创建数据库。</p><h2 id="88cb" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">用docker在本地运行DynamoDB</h2><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="8f6a" class="jt ju hi kt b fi kx ky l kz la">docker run -p 8000:8000 amazon/dynamodb-local \<br/>  -jar DynamoDBLocal.jar -sharedDb</span></pre><p id="b8f0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm" rel="noopener ugc nofollow" target="_blank">安装NPM </a>(如果你没有的话)并安装<a class="ae iu" href="https://www.npmjs.com/package/dynamodb-admin" rel="noopener ugc nofollow" target="_blank"> dynamodb-admin </a>，使用NPM在你喜欢的命令行工具中运行下面的命令:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="c8d5" class="jt ju hi kt b fi kx ky l kz la">npm install -g dynamodb-admin</span></pre><p id="bc23" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行dynamodb-amin:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="afec" class="jt ju hi kt b fi kx ky l kz la">dynamodb-admin</span></pre><p id="71bf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个工具对于查询和可视化您的表非常有用。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/a08961443a541bfc61ddc8e785dec3a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PSx3j4FFKy5WXax77ifLkw.png"/></div></div></figure><p id="1b17" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以使用它来检查我们将在示例中插入的数据。</p><p id="72e8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我创建了一个名为Users的表，使用“document”作为键。您可以使用dynamodb-admin工具完成同样的工作。</p><h2 id="9663" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">创建Rust项目</h2><p id="8c61" class="pw-post-body-paragraph iv iw hi ix b iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">使用Cargo创建一个Rust项目。项目名称由你决定。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="af25" class="jt ju hi kt b fi kx ky l kz la">cargo new dynamo_tutorial</span></pre><p id="4130" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">更改Cargo.toml文件以添加以下依赖项:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="5dcb" class="jt ju hi kt b fi kx ky l kz la">[dependencies]</span><span id="bce6" class="jt ju hi kt b fi lh ky l kz la">tokio = { version = "1", features = ["full"] }</span><span id="c25b" class="jt ju hi kt b fi lh ky l kz la">rusoto = { version = "0.24.2" }</span><span id="a4fe" class="jt ju hi kt b fi lh ky l kz la">rusoto_core = "0.47.0"</span><span id="aeb7" class="jt ju hi kt b fi lh ky l kz la">rusoto_dynamodb = "0.47.0"</span></pre><p id="b590" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">main.rs文件必须包括相关的板条箱，如下所示。</p><p id="cb91" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">之后，我们需要创建一个<em class="li"> DynamoDbClient </em>对象来连接数据库。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/aceadb2519c820d03235d0729353b6f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FxDcedPPXnt8WjQNIs_P8A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">main function (not yet finished)</figcaption></figure><p id="5aa1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意，需要通过添加tokio::main属性来更改main函数。这允许我们的程序等待异步操作。</p><p id="8fd4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我添加了全局区域作为区域对象的属性。然而，这并不重要，因为我们在本地运行数据库。</p><h2 id="c6e8" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">列出所有表格</h2><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/884ffba84f665ad1b9c16e5d9634924d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tz_I_VBsYcSGUqhg-u-9pw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">List of tables</figcaption></figure><p id="a39e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该函数将列出数据库中包含的所有表。执行此操作不需要任何参数。</p><h2 id="fcf7" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">选择项目</h2><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/f9fbf811cff6c9fb4c42361d465ab45a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*93Gt26ddUwb-XJx5zLf8Hw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Function to list users</figcaption></figure><p id="8cdf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">任何查询操作都需要分区键，在本例中为<em class="li">文档</em>。</p><p id="2fcf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，我创建了作为查询参数的映射，只通知文档，因为我们在这个操作中只使用分区键。该函数将列出数据库返回的所有用户。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="dae7" class="jt ju hi kt b fi kx ky l kz la">let mut map: HashMap&lt;String, AttributeValue&gt; = HashMap::new();</span><span id="8146" class="jt ju hi kt b fi lh ky l kz la">map.insert("document".to_owned(), AttributeValue { s: Some(document.to_owned()), b: None, bool: None, bs: None, l: None, m: None, n: None, ns: None, null: None, ss: None});</span></pre><p id="efb7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意，对于每个参数，我们必须填充<em class="li"> AttributeValue </em>对象。此对象需要填充类型属性。检查<a class="ae iu" href="https://rusoto.github.io/rusoto/rusoto_dynamodb/struct.AttributeValue.html" rel="noopener ugc nofollow" target="_blank">文件</a>以正确填写。在我们的例子中，<em class="li"> s </em>是我们必须作为<em class="li">文档填充的属性，</em>我们的键是一个字符串。</p><h2 id="11ec" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">插入项目</h2><p id="745a" class="pw-post-body-paragraph iv iw hi ix b iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated"><em class="li">属性值</em>也将用于该操作。在这种情况下，对于每个属性，我们将需要一个<em class="li"> AttributeValue </em>对象。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="743c" class="jt ju hi kt b fi kx ky l kz la">map.insert("document".to_owned(),</span><span id="dda1" class="jt ju hi kt b fi lh ky l kz la">AttributeValue {</span><span id="8d7e" class="jt ju hi kt b fi lh ky l kz la">s: Some(document.to_owned()),</span><span id="5572" class="jt ju hi kt b fi lh ky l kz la">b: None, bool: None, bs: None, l: None, m: None, n: None, ns: None, null: None, ss: None</span><span id="1513" class="jt ju hi kt b fi lh ky l kz la">});</span></pre><p id="96ed" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个代码片段中，我为文档创建了对象。<em class="li">名称</em>和<em class="li">城市</em>的对象也将被创建。</p><p id="034e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将使用<em class="li"> put_item </em>函数将商品插入数据库。此操作需要类型为<em class="li"> PutItemInput </em>的对象作为参数。</p><p id="492f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个例子中，我传递了插入属性和表名的映射。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="38e6" class="jt ju hi kt b fi kx ky l kz la">PutItemInput {item: map,table_name: "Users".to_owned(),</span><span id="5cc2" class="jt ju hi kt b fi lh ky l kz la">condition_expression: None, conditional_operator: None, expected: None, expression_attribute_names: None, expression_attribute_values: None, return_consumed_capacity: None, return_item_collection_metrics: None, return_values: None}</span></pre><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/7bfc34a098544f933ca907400be65da6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y8INToI1aczRg-x4vHxTyg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">insert_user function</figcaption></figure><h2 id="9e05" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">删除项目</h2><p id="0068" class="pw-post-body-paragraph iv iw hi ix b iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">要从数据库中删除一个项目，我们将在update_user函数中使用<em class="li"> delete_item </em>函数，如下所示:</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/791c37dd1cd693c985a3b3dbe66c83ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ujIU0ei-WRew9tV1te2glw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">delete_user function</figcaption></figure><p id="cfc6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该函数需要一个<a class="ae iu" href="https://rusoto.github.io/rusoto/rusoto_dynamodb/struct.DeleteItemInput.html" rel="noopener ugc nofollow" target="_blank"><em class="li">delete item input</em></a>对象。下面是一个例子。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="f0f6" class="jt ju hi kt b fi kx ky l kz la">DeleteItemInput {</span><span id="768b" class="jt ju hi kt b fi lh ky l kz la">key: map,</span><span id="6b3b" class="jt ju hi kt b fi lh ky l kz la">table_name: "Users".to_owned(),</span><span id="34c7" class="jt ju hi kt b fi lh ky l kz la">condition_expression: None, conditional_operator: None, expected: None, expression_attribute_names: None,</span><span id="488f" class="jt ju hi kt b fi lh ky l kz la">expression_attribute_values: None, return_consumed_capacity: None, return_item_collection_metrics: None, return_values: None}</span></pre><p id="0cdd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">移除项目需要密钥。在这种情况下，键是一个映射，我们必须通知键(在我们的例子中是“文档”)和值。</p><h2 id="9ce9" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">更新项目</h2><p id="8c33" class="pw-post-body-paragraph iv iw hi ix b iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">要更新项目，将使用<em class="li"> update_item </em>函数。这个操作需要一个<a class="ae iu" href="https://rusoto.github.io/rusoto/rusoto_dynamodb/struct.UpdateItemInput.html" rel="noopener ugc nofollow" target="_blank"><em class="li">update item input</em></a><em class="li">，</em>，它需要表名和两个映射:一个用于键，另一个用于要更新的属性。</p><p id="7133" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们创建一个函数update_user和两个映射，如下所示:</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/48020648116bbd1319f3d34cd8c58204.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c4CAiUBbJYsf3I4bwRCT_Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">update_user function</figcaption></figure><p id="b7e0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">完整的源代码在我的github上:</p><p id="5b47" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://github.com/paoloposso/rust_dynamo_poc" rel="noopener ugc nofollow" target="_blank">保洛波索/鲁斯特_迪纳摩_ POC(github.com)</a></p><p id="f1fe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望这可能有用。回头见！</p></div></div>    
</body>
</html>