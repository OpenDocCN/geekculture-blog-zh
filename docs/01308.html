<html>
<head>
<title>The Secret of “New” Operator in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中“新”运算符的秘密</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/the-secret-of-new-operator-in-javascript-eafc0e98996?source=collection_archive---------15-----------------------#2021-04-05">https://medium.com/geekculture/the-secret-of-new-operator-in-javascript-eafc0e98996?source=collection_archive---------15-----------------------#2021-04-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f285f9b7f2323acde3511430f7bb48d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TYKVI9wy60DyvKmTwotJqQ.png"/></div></div></figure><p id="041b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您喜欢JavaScript，并且对幕后没有语法糖的事情如何工作感兴趣，那么您来对地方了！</p><p id="536c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Javascript中的运算符允许开发人员实例化用户定义的对象。</p><p id="319c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了理解<strong class="is hj">如何</strong>和<strong class="is hj">什么</strong>是在JavaScript中实例化对象的步骤，我们将实现<code class="du jo jp jq jr b">new</code>操作符。</p><p id="fd07" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为<code class="du jo jp jq jr b">new</code>关键字是javascript中的保留字，我们不能使用它，所以我们必须实现一个将返回实例化对象的<code class="du jo jp jq jr b">createInstance()</code>函数。</p><h1 id="df0f" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">1.创建空对象</h1><p id="7a2c" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">这个很简单。</p><p id="a89d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们的<code class="du jo jp jq jr b">createInstance()</code>函数中，我们简单地创建了一个名为<code class="du jo jp jq jr b">newInstance</code>的<strong class="is hj">空</strong>对象，它后来成为了我们的新实例。就是这样。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/d7df64b7f9351e084bf2445218839dda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ac_sD6_0jbGE5qxMgUo1Qw.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx">Create empty object</figcaption></figure><h1 id="a0fa" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">2.设置原型</h1><p id="ddf7" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">在这一步中会发生两件事:</p><ol class=""><li id="0757" class="le lf hi is b it iu ix iy jb lg jf lh jj li jn lj lk ll lm bi translated">我们将<code class="du jo jp jq jr b">constructor</code>参数传递给<code class="du jo jp jq jr b">createInstance()</code>函数。</li><li id="af30" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm bi translated"><code class="du jo jp jq jr b">constructor</code>参数是我们计划实例化的<strong class="is hj">构造函数</strong>(由于各种原因，它不能是a)。</li><li id="935c" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm bi translated">为了访问由<code class="du jo jp jq jr b">constructor</code>参数定义的<strong class="is hj">属性</strong>和<strong class="is hj">方法</strong>，我们借助内置函数<code class="du jo jp jq jr b">Object.setPrototypeOf()</code>将<code class="du jo jp jq jr b">newInstance</code>对象的原型设置为引用一个<code class="du jo jp jq jr b">constructor</code>原型。</li></ol><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/fb0a1d2f7c50a0c20a2f85d13817bcf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e211fVneRc3zsfp6aL_4KA.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx">Set prototype</figcaption></figure><h1 id="8170" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">3.获取参数</h1><p id="3129" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">在实例化一个对象时，我们可能会向它传递任意数量的参数，所以我们需要在我们的参数中获取这些参数。</p><p id="88fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在JavaScript中，每个函数的主体中都有可用的<code class="du jo jp jq jr b">arguments</code>对象。</p><p id="8e75" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du jo jp jq jr b">arguments</code>是一个类似数组的对象，这意味着它可以访问<code class="du jo jp jq jr b">length</code>属性，但是没有任何我们知道并且喜欢的数组方法(即<code class="du jo jp jq jr b">map</code>、<code class="du jo jp jq jr b">reduce</code>、<code class="du jo jp jq jr b">filter</code>...).</p><p id="f82e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为<code class="du jo jp jq jr b">createInstance()</code>函数的第一个参数是对<code class="du jo jp jq jr b">constructor</code>函数的引用，所以我们必须从用于实例创建的参数中省略它。</p><p id="020d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们为实例构造创建<code class="du jo jp jq jr b">constructorArguments</code>数组，如下所示:</p><ol class=""><li id="58b4" class="le lf hi is b it iu ix iy jb lg jf lh jj li jn lj lk ll lm bi translated">在内置的<code class="du jo jp jq jr b">Array.from()</code>的帮助下，我们将一个<code class="du jo jp jq jr b">arguments</code>对象转换成数组。</li><li id="b05a" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm bi translated">我们使用<code class="du jo jp jq jr b">Array.method.slice()</code>来删除第一个参数。</li></ol><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/f38986f74322c1504b5262c2c6296452.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ceIsAE67SxTjYjZZfjZVtw.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx">Get arguments for instance construction</figcaption></figure><h1 id="93e2" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">4.返回一个新实例</h1><p id="2a7b" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">最后，我们必须调用<code class="du jo jp jq jr b">constructor</code>(别忘了这只是一个函数)并传递给它我们自己的<code class="du jo jp jq jr b">this</code>和上一步的参数并返回它</p><ul class=""><li id="2c5f" class="le lf hi is b it iu ix iy jb lg jf lh jj li jn lv lk ll lm bi translated">在我们的例子中，应用于<code class="du jo jp jq jr b">constructor</code>的<code class="du jo jp jq jr b">this</code>是我们的<code class="du jo jp jq jr b">newInstance</code>对象。</li><li id="0751" class="le lf hi is b it ln ix lo jb lp jf lq jj lr jn lv lk ll lm bi translated">在内置<code class="du jo jp jq jr b">Function.prototype.apply()</code>的帮助下，我们可以使用自定义<code class="du jo jp jq jr b">this</code>和参数数组<code class="du jo jp jq jr b">constructorArguments</code>调用<code class="du jo jp jq jr b">constructor</code>函数。</li></ul><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/e7caba5e21be33248b6734a909793003.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TGfSe6ffdy_woHhMEQ8Anw.png"/></div></div></figure><p id="bdbc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在理想的世界里，应该是这样。但是在JavaScript中，构造函数不应该返回值。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/661a74524625757d4c11547ea6895b63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wgaliCINtnNJfkYHq4MVkg.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx">Invalid constructor function</figcaption></figure><p id="1aeb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面提到的情况中，<code class="du jo jp jq jr b">new</code>操作符简单地返回<code class="du jo jp jq jr b">constructor</code>函数的返回值，并且定义的属性将不可访问。</p><p id="2f4a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以在JavasScript中完全模拟一个<code class="du jo jp jq jr b">new</code>操作符，我们必须检查<code class="du jo jp jq jr b">constructor</code>函数的返回值。</p><p id="7a53" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果<code class="du jo jp jq jr b">constructor</code>函数只返回<code class="du jo jp jq jr b">undefined</code>，那么我们可以返回我们的<code class="du jo jp jq jr b">newInstance</code>。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/399a9ad42279cba65c7e101e8d3e200a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KoQtrgKZiVzjoMoH-IDFlw.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx">Emulated new operator in JavaScript</figcaption></figure><h1 id="ea9e" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">结论</h1><p id="e2b7" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">就是这样！我们实现了自己的<code class="du jo jp jq jr b">new</code>操作符，所以你现在可以测试和使用它。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/3e7c1ad3fe50bb2a1560bc04e44af74e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sCfymC9Kl0ZYlNgHOUH7YA.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx">Johny instance :D</figcaption></figure><p id="afa9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我希望我发现了Javascript的一些神奇之处，我们每天都在使用它，而没有进一步思考，你也从中学到了一些东西。😊</p><p id="ead1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">祝您愉快！🌻</p></div></div>    
</body>
</html>