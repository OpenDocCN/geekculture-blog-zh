<html>
<head>
<title>What happens when you update Common Table Expressions (CTEs)?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更新公共表表达式(cte)时会发生什么？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/what-happens-when-you-update-common-table-expressions-ctes-f46b71f1f646?source=collection_archive---------13-----------------------#2021-07-03">https://medium.com/geekculture/what-happens-when-you-update-common-table-expressions-ctes-f46b71f1f646?source=collection_archive---------13-----------------------#2021-07-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="7755" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated"><strong class="ak">在CTEs中提升您的SQL技能</strong></h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/db6bde0bf551298335bd33f3f9cbcb39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7JhbILoXOv30wq8q"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx"><strong class="bd jn">Photo by </strong><a class="ae jo" href="https://unsplash.com/@elenatrn?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"><strong class="bd jn">Elena Taranenko</strong></a><strong class="bd jn"> on </strong><a class="ae jo" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"><strong class="bd jn">Unsplash</strong></a></figcaption></figure><p id="6f61" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><strong class="jr hj">目录</strong></p><p id="082f" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><strong class="jr hj">在本文中，我们将在cte中看到3种不同的更新场景，例如:</strong></p><ol class=""><li id="17a5" class="kl km hi jr b js jt jv jw jy kn kc ko kg kp kk kq kr ks kt bi translated"><strong class="jr hj">基于单基表的CTE</strong></li><li id="ebba" class="kl km hi jr b js ku jv kv jy kw kc kx kg ky kk kq kr ks kt bi translated"><strong class="jr hj"> CTE基于多个基表，更新影响1个基表</strong></li><li id="05ae" class="kl km hi jr b js ku jv kv jy kw kc kx kg ky kk kq kr ks kt bi translated"><strong class="jr hj"> CTE基于多个基表，更新影响2个基表</strong></li></ol><p id="28d5" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">考虑下面的两个表雇员和部门</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es kz"><img src="../Images/02fc0c2088acbe2f7d127632a36baaef.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*4OBkQTq6pOwEOmTF3pTNJA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx"><strong class="bd jn">Employee</strong></figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es la"><img src="../Images/52d274d43d499ffc13c5cdb6e3b82e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:266/format:webp/1*r4PicmcZpQsF8VVXkQ-bLQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx"><strong class="bd jn">Department</strong></figcaption></figure><p id="ad57" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><strong class="jr hj"> CTE基于单基表</strong></p><blockquote class="lb lc ld"><p id="c930" class="jp jq le jr b js jt ij ju jv jw im jx lf jz ka kb lg kd ke kf lh kh ki kj kk hb bi translated">让我们基于tblEmployee创建一个CTE，并更新id=20的性别</p></blockquote><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="47e0" class="ln lo hi lj b fi lp lq l lr ls"><strong class="lj hj">With EmpUpdateGender<br/>as<br/>( Select Id, Name, Gender from tblEmployee)<br/>Update EmpUpdateGender Set Gender = 'Female' where Id = 20</strong></span></pre><p id="0390" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><strong class="jr hj">更新成功</strong></p></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ma"><img src="../Images/54751fcfcbc6153cb6ee1ac8a6f88a24.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/1*S2n6gFXg8Q_t5Df0_Rb3Lw.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Updated Employee Table: Alen’s gender is updated</figcaption></figure><p id="c50b" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><strong class="jr hj"> CTE基于2个以上的基表，更新影响1个基表</strong></p><blockquote class="lb lc ld"><p id="d928" class="jp jq le jr b js jt ij ju jv jw im jx lf jz ka kb lg kd ke kf lh kh ki kj kk hb bi translated">让我们基于tblEmployee和tblDepartment创建一个CTE，并更新id=20的性别</p></blockquote><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="1e27" class="ln lo hi lj b fi lp lq l lr ls"><strong class="lj hj">With EmpUpdateGender as <br/>(Select Id, Name, Gender, DeptName<br/>from tblEmployee<br/>join tblDepartment<br/>on tblDepartment.DeptId = tblEmployee.DepartmentId)</strong></span><span id="135b" class="ln lo hi lj b fi mb lq l lr ls"><strong class="lj hj">Update EmpUpdateGender set Gender = 'Male' where Id = 20</strong></span></pre><p id="bfa9" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><strong class="jr hj">更新成功</strong></p></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mc"><img src="../Images/1c13059b803e2ca986305ea89f5cd655.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*6Lg5brIjYZG82ltp3myS9Q.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Update Employee Table: Alen’s gender is updated</figcaption></figure><h2 id="a077" class="ln lo hi bd jn md me mf mg mh mi mj mk jy ml mm mn kc mo mp mq kg mr ms mt mu bi translated">基于2个基表的CTE和基于2个基表的更新</h2><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="65a9" class="ln lo hi lj b fi lp lq l lr ls"><strong class="lj hj">With EmpByDeptName as<br/>(Select Id, Name, Gender, DeptName <br/>from tblEmployee <br/>join tblDepartment <br/>on tblDepartment.DeptId = tblEmployee.DepartmentId)</strong></span><span id="0aa7" class="ln lo hi lj b fi mb lq l lr ls"><strong class="lj hj">Update EmpByDeptName set Gender = 'Female', DeptName='Engineering' where id = 20</strong></span></pre><blockquote class="lb lc ld"><p id="18d6" class="jp jq le jr b js jt ij ju jv jw im jx lf jz ka kb lg kd ke kf lh kh ki kj kk hb bi translated"><strong class="jr hj">没有更新！！！！！！！！！！！！！！！！！！</strong></p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mv"><img src="../Images/2bafa0c3caac14b124b9565eb7db291c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*bbZLxmGOswl6NBqZ4-P0-A.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">ERROR !!!!!!</figcaption></figure><blockquote class="lb lc ld"><p id="eb98" class="jp jq le jr b js jt ij ju jv jw im jx lf jz ka kb lg kd ke kf lh kh ki kj kk hb bi translated">简而言之，如果CTE基于多个基表，并且更新影响多个基表，则不允许更新(抛出错误)</p></blockquote><p id="0076" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我们将看到一个特殊场景的最后一个案例，在更新CTE时我们必须非常小心</p><pre class="iy iz ja jb fd li lj lk ll aw lm bi"><span id="ea57" class="ln lo hi lj b fi lp lq l lr ls">With EmpByDeptName as<br/>(Select Id, Name, Gender, DeptName <br/>from tblEmployee <br/>join tblDepartment <br/>on tblDepartment.DeptId = tblEmployee.DepartmentId)</span><span id="0be0" class="ln lo hi lj b fi mb lq l lr ls">Update EmpByDeptName set DeptName='Production' where id = 30</span></pre><blockquote class="lb lc ld"><p id="252e" class="jp jq le jr b js jt ij ju jv jw im jx lf jz ka kb lg kd ke kf lh kh ki kj kk hb bi translated"><strong class="jr hj">更新成功。小心点！！！！！！！！！！！</strong></p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mw"><img src="../Images/cf19f1cac2233b893b8845306fbc9156.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*WBc10-XYH4H3s1d3R0LfwA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Data Comparison when DeptName is updated for Id=30</figcaption></figure><p id="f4b1" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">执行更新后，当您尝试从CTE中选择数据时，您会看到Alex的DeptName也更改为Production。</p><p id="5f19" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">所以在这里，更新并没有像预期的那样工作，因为它也改变了Alex的DeptName。这是因为，更新将DeptName从工程更改为生产。</p><h1 id="342a" class="mx lo hi bd jn my mz na mg nb nc nd mk io ne ip mn ir nf is mq iu ng iv mt nh bi translated">结论</h1><p id="161d" class="pw-post-body-paragraph jp jq hi jr b js ni ij ju jv nj im jx jy nk ka kb kc nl ke kf kg nm ki kj kk hb bi translated">我们已经在CTE看到了3种不同的更新情况:<br/> 1) CTE基于1个基表，更新如预期的那样成功</p><p id="2bc3" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">2)基于2个基表的CTE和基于2个基表的更新，查询因错误而终止</p><p id="a2fa" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">3)基于2个基表的CTE和对1个基表的更新，更新成功。但是，更新没有按预期运行</p></div></div>    
</body>
</html>