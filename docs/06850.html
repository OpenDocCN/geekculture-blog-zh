<html>
<head>
<title>Running AWS Lambda with Alpine Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Alpine Docker运行AWS Lambda</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/setup-a-lambda-function-using-docker-72356e0a4f13?source=collection_archive---------8-----------------------#2021-08-31">https://medium.com/geekculture/setup-a-lambda-function-using-docker-72356e0a4f13?source=collection_archive---------8-----------------------#2021-08-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/fc63c9547b70df7c1be313b243931f2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*dBKqex2wCVjhSyuN6WOHuQ.png"/></div></figure><p id="350e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当宣布AWS Lambda将支持Docker时，许多人欢呼雀跃，因为AWS最终采用了他们首选的部署方法。事实上，使用zip存档是一种部署代码的老方法。此外，大多数公司甚至个人都有过多的免费CI来建立Docker形象。但是，开发者仍然有很多问题:与zip相比，使用Docker时的延迟如何，尤其是在启动时，以及如何才能看到图像。</p><p id="56d5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们从最简单的Lambda函数开始:</p><figure class="jk jl jm jn fd ij"><div class="bz dy l di"><div class="jo jp l"/></div></figure><p id="c518" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如您所见，这是一个非常简单的函数，它返回发送给它的几个属性。它与来自AWS Lambda的样本测试事件相匹配。我将在以后的其他教程中构建一些高级函数，这是我的入门教程。</p></div><div class="ab cl jq jr gp js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hb hc hd he hf"><h2 id="bdfd" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ix ki kj kk jb kl km kn jf ko kp kq kr bi translated">要求</h2><p id="516e" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">要运行实际的代码，您需要几样东西:</p><ol class=""><li id="574b" class="kx ky hi io b ip iq it iu ix kz jb la jf lb jj lc ld le lf bi translated">一个活跃的AWS管理帐户显然</li><li id="20bd" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated">AWS CLI配置为工作</li><li id="9c32" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated">码头工人</li></ol><p id="cc3a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">AWS CLI是由AWS构建和维护的一组工具，允许开发人员使用AWS。我不打算在这里详细说明如何安装CLI，而是将您指向下面的文档。安装非常简单，只需遵循以下指南:</p><div class="ll lm ez fb ln lo"><a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html" rel="noopener  ugc nofollow" target="_blank"><div class="lp ab dw"><div class="lq ab lr cl cj ls"><h2 class="bd hj fi z dy lt ea eb lu ed ef hh bi translated">安装、更新和卸载AWS CLI版本2</h2><div class="lv l"><h3 class="bd b fi z dy lt ea eb lu ed ef dx translated">在您的系统上安装AWS命令行界面版本2 (AWS CLI版本2)。</h3></div><div class="lw l"><p class="bd b fp z dy lt ea eb lu ed ef dx translated">docs.aws.amazon.com</p></div></div></div></a></div><ol class=""><li id="e7fc" class="kx ky hi io b ip iq it iu ix kz jb la jf lb jj lc ld le lf bi translated">在<a class="ae lx" href="https://console.aws.amazon.com/iamv2/home#/users" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/iamv2/home#/users</a>创建一个具有管理员权限的用户</li><li id="6c46" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated">现在，您必须配置AWS CLI以访问编程用途:<code class="du ly lz ma mb b">aws configure</code>并提供帐户名和密码。</li><li id="c94d" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated">使用下面的命令在ECR中创建一个存储库，我们称之为hello-world】</li><li id="f3a3" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated">登录Docker: <code class="du ly lz ma mb b">aws ecr get-login-password --region &lt;region&gt; | docker login --username AWS --password-stdin &lt;account&gt;.dkr.ecr.&lt;region&gt;.amazonaws.com</code></li><li id="a2ae" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated">你完了！</li></ol><p id="ffa3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">根据AWS文档，我们有两种选择:</p><ol class=""><li id="e6ad" class="kx ky hi io b ip iq it iu ix kz jb la jf lb jj lc ld le lf bi translated">使用AWS官方的图片来构建你的容器</li><li id="c7c5" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated">使用<strong class="io hj">任何</strong>图像(Alpine，Ubuntu等。)和<strong class="io hj">添加lambda运行时</strong></li></ol><p id="14cb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这两种情况下，<strong class="io hj">工作流程</strong>是相同的:</p><ol class=""><li id="e1b7" class="kx ky hi io b ip iq it iu ix kz jb la jf lb jj lc ld le lf bi translated">将docker文件添加到lambda函数所在的文件夹中</li><li id="3626" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated">创建包含该函数的图像</li><li id="5ed4" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated">给图像加标签</li><li id="afa2" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated">将图像推送到ECR</li><li id="0f01" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated">现在，当创建/更新新的Lambda时，我们必须使用这个映像</li></ol><p id="5903" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以这可以解释为:</p><ol class=""><li id="1cdd" class="kx ky hi io b ip iq it iu ix kz jb la jf lb jj lc ld le lf bi translated"><code class="du ly lz ma mb b">docker build -t hello-world .</code></li><li id="9733" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated"><code class="du ly lz ma mb b">docker tag hello-world:latest &lt;account&gt;.dkr.ecr.&lt;region&gt;.amazonaws.com/hello-world:latest</code></li><li id="a43b" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated"><code class="du ly lz ma mb b">docker push &lt;account&gt;.dkr.ecr.&lt;region&gt;.amazonaws.com/hello-world:latest</code></li><li id="24f5" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated">使用select from容器重新部署Lambda。</li></ol><h2 id="cda9" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ix ki kj kk jb kl km kn jf ko kp kq kr bi translated">1.使用AWS官方映像进行设置</h2><p id="b650" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">第一步是选择提供的图像之一。每种语言都有大量的图片。关于这些基础映像的一个伟大之处在于它们是安全的，并且包含了所有的东西。在我的例子中，我选择Nodejs基本映像。</p><figure class="jk jl jm jn fd ij"><div class="bz dy l di"><div class="jo jp l"/></div></figure><h2 id="6f18" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ix ki kj kk jb kl km kn jf ko kp kq kr bi translated">2.设置自定义镜像并安装<strong class="ak"> lambda运行时</strong></h2><p id="6edf" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">就像官方图片一样，你首先需要选择一个，它可以是任何东西，所以我选择了阿尔卑斯山，因为那里非常小。</p><p id="54fc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">选择基本映像时要小心，因为许多映像都有很多安全漏洞，您必须修复和部署这些漏洞，然后更新lambda函数。幸运的是，AWS有一个扫描工具来找到一个已知的漏洞。</p><p id="c3e0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您需要向Docker添加一堆构建工具，因为lambda接口是在您的容器中本地编译的。</p><p id="add6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在你需要安装<a class="ae lx" href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-api.html" rel="noopener ugc nofollow" target="_blank">运行时API </a> aws-lambda-ric，可选的你可以添加模拟器用于测试目的。</p><figure class="jk jl jm jn fd ij"><div class="bz dy l di"><div class="jo jp l"/></div></figure><p id="f7ce" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">可选</strong>我们可以添加一个模拟器，用于在发送到ECR之前测试功能。</p><div class="ll lm ez fb ln lo"><a href="https://github.com/aws/aws-lambda-runtime-interface-emulator" rel="noopener  ugc nofollow" target="_blank"><div class="lp ab dw"><div class="lq ab lr cl cj ls"><h2 class="bd hj fi z dy lt ea eb lu ed ef hh bi translated">GitHub-AWS/AWS-lambda-运行时-接口-仿真器</h2><div class="lv l"><h3 class="bd b fi z dy lt ea eb lu ed ef dx translated">Lambda运行时接口仿真器是Lambda运行时和扩展API的代理，它允许客户…</h3></div><div class="lw l"><p class="bd b fp z dy lt ea eb lu ed ef dx translated">github.com</p></div></div><div class="mc l"><div class="md l me mf mg mc mh ik lo"/></div></div></a></div><h2 id="f9c4" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ix ki kj kk jb kl km kn jf ko kp kq kr bi translated">结果:</h2><p id="787b" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">我测试了多次Docker图像，下面是结果:</p><figure class="jk jl jm jn fd ij"><div class="bz dy l di"><div class="jo jp l"/></div></figure><p id="45b2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我注意到有时容器的大小被缓存在AWS上，并且它变化很大，显然最好将大小保持在最小值以获得最佳性能。</p><p id="8675" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请记住，我们的lambda是一个简单的函数，大多数生产函数都有很大的依赖性。幸运的是，容器大小限制已经增加，现在我们可以达到10GB。</p><h2 id="126a" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ix ki kj kk jb kl km kn jf ko kp kq kr bi translated">结论:</h2><p id="ebd0" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">AWS通过Docker image for lambda为客户提供了出色的体验。它有一个有点慢的开始，特别是与zip文件相比，但考虑到大得多的大小，这是可以预料的。</p><h2 id="b769" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ix ki kj kk jb kl km kn jf ko kp kq kr bi translated">助手链接:</h2><ol class=""><li id="3105" class="kx ky hi io b ip ks it kt ix mi jb mj jf mk jj lc ld le lf bi translated">AWS CLI配置指南:<a class="ae lx" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-creds" rel="noopener ugc nofollow" target="_blank">此处</a></li><li id="060a" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated">创建图像的lambda文档指南:<a class="ae lx" href="https://docs.aws.amazon.com/lambda/latest/dg/images-create.html" rel="noopener ugc nofollow" target="_blank">此处</a></li><li id="1ce3" class="kx ky hi io b ip lg it lh ix li jb lj jf lk jj lc ld le lf bi translated">从备选图像创建图像的指南:<a class="ae lx" href="https://docs.aws.amazon.com/lambda/latest/dg/images-create.html#images-create-from-alt" rel="noopener ugc nofollow" target="_blank">此处</a></li></ol><p id="0cd2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">此外，点击查看整个示例项目<a class="ae lx" href="https://github.com/BogdanNic/aws-lambda-docker" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="827e" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ix ki kj kk jb kl km kn jf ko kp kq kr bi translated">附录(Postscript)</h2><p id="d87f" class="pw-post-body-paragraph im in hi io b ip ks ir is it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj hb bi translated">如果你想要更多的教程，请鼓掌！</p></div></div>    
</body>
</html>