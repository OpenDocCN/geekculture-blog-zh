<html>
<head>
<title>Everything about Focal Loss</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于焦点丢失的一切</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/everything-about-focal-loss-f2d8ab294133?source=collection_archive---------6-----------------------#2022-08-05">https://medium.com/geekculture/everything-about-focal-loss-f2d8ab294133?source=collection_archive---------6-----------------------#2022-08-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9d6b" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">让我们来理解聚焦损失及其对不平衡问题的影响。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/69b788dd625a6c1976f6d7db771b77ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S8MWTU36Y62Ze8cSwypzFA.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Source:<a class="ae jn" href="https://stock.adobe.com/" rel="noopener ugc nofollow" target="_blank">https://stock.adobe.com</a></figcaption></figure><p id="7bbc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">脸书人工智能研究所(FAIR)提出了<strong class="jq hj">聚焦损失</strong>概念来处理类别不平衡，并通过他们的一级探测器RetinaNet展示了其有效性。在进入正题之前，我们会先了解一些先决条件。</p><ul class=""><li id="5e0f" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated"><strong class="jq hj">反面例子</strong>:与真实情况(低IOU)或背景信息重叠度低的样本。</li><li id="9c2d" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated"><strong class="jq hj">正例</strong>:与地面真实(高IOU)或前景信息重叠较多的样本。</li><li id="cc06" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated"><strong class="jq hj">简单例子</strong>:正确分类的样本。</li><li id="a7f3" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated"><strong class="jq hj">硬例</strong>:分类错误的样本。</li></ul><h2 id="afca" class="ky kz hi bd la lb lc ld le lf lg lh li jx lj lk ll kb lm ln lo kf lp lq lr ls bi translated"><strong class="ak">阶层失衡</strong></h2><p id="6be7" class="pw-post-body-paragraph jo jp hi jq b jr lt ij jt ju lu im jw jx lv jz ka kb lw kd ke kf lx kh ki kj hb bi translated">在训练期间，当一个类在数据集或小批量中有更多样本时，就会出现类不平衡。从对象检测的角度来看，这可能以两种不同的方式发生:</p><ul class=""><li id="9c48" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated">在<strong class="jq hj">前景-背景类不平衡</strong>中，过表示的类是背景类，欠表示的类是前景类。</li><li id="1b3b" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">在<strong class="jq hj">前景-前景类不平衡</strong>中，过度表现和表现不足的类都是前景类。</li></ul><p id="de52" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">前景-背景不平衡发生在密集检测器的训练期间。因为容易分类的背景样本(容易否定)对学习没有贡献，导致低效的训练并导致退化的模型。</p><h2 id="099c" class="ky kz hi bd la lb lc ld le lf lg lh li jx lj lk ll kb lm ln lo kf lp lq lr ls bi translated"><strong class="ak">焦损失</strong></h2><p id="583a" class="pw-post-body-paragraph jo jp hi jq b jr lt ij jt ju lu im jw jx lv jz ka kb lw kd ke kf lx kh ki kj hb bi translated">我们将从用于二进制分类的基函数交叉熵损失开始理解焦点损失函数。</p><ul class=""><li id="a055" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated"><strong class="jq hj">交叉熵损失</strong></li></ul><p id="39b1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">交叉熵在数学上表示为:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ly"><img src="../Images/407fad5e80699435ed5188073fd47ebf.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*nf0YlCaToPBCwD7BAGIsZQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Eq-1</figcaption></figure><p id="b20a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">其中，y =基础真实类，p=标注y=1的类的估计概率。</p><p id="4fdd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为简单起见，我们可以将交叉熵损失重写为:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lz"><img src="../Images/9d31d4ed4af872b104bce012270cde9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*w2X8q7rBsbEBOU0FyJia7Q.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Eq-2</figcaption></figure><p id="e00f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在哪里，</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ma"><img src="../Images/53655384b9b259933cfd6f99b41d68b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*cRPV6SqJtFE7IHY0-QpFJw.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Eq-3</figcaption></figure><ul class=""><li id="094a" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated"><strong class="jq hj">平衡交叉熵</strong></li></ul><p id="848f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了解决类别不平衡，交叉熵乘以参数α。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ma"><img src="../Images/ba1b9407ed2578b7b5533be39df3dfe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*c2yiXWybnyMDRAEWsAgnsQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Eq-4</figcaption></figure><p id="1c83" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">其中，alpha的范围在[0，1]和class 1= alpha，class 0= (1-alpha)之间。</p><p id="5417" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">参数α着重于在训练期间平衡正面和反面的例子。</p><ul class=""><li id="b45f" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated"><strong class="jq hj">焦损失</strong></li></ul><p id="9299" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">焦点损失是交叉熵损失函数的改进版本。它处理单级检测器面临的类别不平衡。由于平衡交叉熵区分正面和负面的例子，焦点损失进一步区分简单和困难的例子。</p><p id="03de" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">焦损失给具有超参数γ的交叉熵函数增加了调制因子。伽马值为0到5的焦损失是可见的。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mb"><img src="../Images/8fbe8e9e4df61da6f4114e056f8317f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*pGLl2O6AzRtyZR1GxnGXRg.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Eq-5</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mc"><img src="../Images/955d42abf52f7b17e282f32490e27166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EsLO9iXSxpx-TqcqCvp_eA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">fig: Focal loss and cross-entropy loss comparison[1]</figcaption></figure><p id="21f1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">上图显示，</p><ol class=""><li id="1130" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj md kq kr ks bi translated">对于简单的例子(p&gt;=0.5)，焦点损失值小于交叉熵。</li><li id="a297" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj md kq kr ks bi translated">随着伽玛值的增加，调制因子降低了分类良好的样本的损失值，并在训练期间对错误分类的样本给予较高的权重。</li><li id="f008" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj md kq kr ks bi translated">伽玛的变化集中了硬样品的损失，并将所有注意力集中在硬底片上。</li></ol><p id="110c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们，用例子比较一下简单和困难样本的焦损失和交叉熵损失。使用以下代码计算损失值，</p><pre class="iy iz ja jb fd me mf mg mh aw mi bi"><span id="19c1" class="ky kz hi mf b fi mj mk l ml mm"># calculate cross entropy loss.</span><span id="0bfd" class="ky kz hi mf b fi mn mk l ml mm">def cross_entropy(p, label):<br/>   if (p&gt;=0.5 and label==1) or (p&lt;0.5 and label==0):<br/>      print("correctly classified example")<br/>   else:<br/>      print('Misclassified example')<br/>   loss= -(label*(math.log(p)))-((1-label)*(math.log(1-p)))<br/>   return loss</span><span id="2f3f" class="ky kz hi mf b fi mn mk l ml mm"># calculate focal loss.</span><span id="b287" class="ky kz hi mf b fi mn mk l ml mm">def focal_loss(p, label, alpha, gamma):<br/>    if (p&gt;=0.5 and label==1) or (p&lt;0.5 and label==0):<br/>       print("correctly classified example")<br/>    else:<br/>       print('Misclassified example')<br/>    loss= -((alpha)*(1-p)**gamma*(label*(math.log(p))))-((1-alpha)*(1-(1-p))**gamma*((1-label)*(math.log(1-p))))</span><span id="f8fa" class="ky kz hi mf b fi mn mk l ml mm">    return loss</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mo"><img src="../Images/e640e30e36dd7fc309e85173d7802864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KlCLXZTxnDlBiOOVpfVjsg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Comparison between cross entropy and focal loss with example.</figcaption></figure><p id="59c7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">从上面的比较，我们可以得出结论，</p><ol class=""><li id="f4bd" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj md kq kr ks bi translated">交叉熵与焦损之比:易正~405.23，易负~133.36，硬正~ 4.938，硬负~ 1.646。</li><li id="e28c" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj md kq kr ks bi translated">与交叉熵损失相比，聚焦损失值较小。</li><li id="c0c0" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj md kq kr ks bi translated">比值证明了简单样本的衰减贡献的焦点损失性质，并证明了在训练期间集中在硬样本上以校正错误分类的样本。</li><li id="eb36" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj md kq kr ks bi translated">焦点损失更多地集中在硬底片上。</li></ol><p id="021c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我希望这篇博客能让你对焦损失和改变伽玛的效果有更好的了解。</p><p id="f760" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">谢谢你..！！！</p><h2 id="7525" class="ky kz hi bd la lb lc ld le lf lg lh li jx lj lk ll kb lm ln lo kf lp lq lr ls bi translated"><strong class="ak">参考文献</strong></h2><ol class=""><li id="2d49" class="kk kl hi jq b jr lt ju lu jx mp kb mq kf mr kj md kq kr ks bi translated">https://arxiv.org/pdf/1708.02002.pdf<a class="ae jn" href="https://arxiv.org/pdf/1708.02002.pdf" rel="noopener ugc nofollow" target="_blank"/></li><li id="dd6c" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj md kq kr ks bi translated">【https://arxiv.org/pdf/1909.00169.pdf T4】</li></ol></div></div>    
</body>
</html>