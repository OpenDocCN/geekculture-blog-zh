<html>
<head>
<title>MotionLayout</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">运动布局</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/motionlayout-bba34ce7fa69?source=collection_archive---------8-----------------------#2021-03-17">https://medium.com/geekculture/motionlayout-bba34ce7fa69?source=collection_archive---------8-----------------------#2021-03-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2c6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我非常自豪地向您展示我的约束布局系列的最后一部分🤘🏻。这一次将是最长和最密集的一次👊🏻。我们将潜入海洋的最深处，找出ConstraintLayout的真正潜力。您可以通过下面的链接查看该系列的前两部分:</p><div class="jd je ez fb jf jg"><a rel="noopener follow" target="_blank" href="/swlh/constraint-layout-8b13ace936df"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hj fi z dy jl ea eb jm ed ef hh bi translated">约束布局</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">约束布局已经成为Android开发中最基本的组件之一，具有许多有效的功能</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">medium.com</p></div></div><div class="jp l"><div class="jq l jr js jt jp ju jv jg"/></div></div></a></div><div class="jd je ez fb jf jg"><a href="https://emre-arslan.medium.com/constraint-layout-2-0-98df8c74856b" rel="noopener follow" target="_blank"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hj fi z dy jl ea eb jm ed ef hh bi translated">约束布局2.0</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">我们的约束布局之旅将在第二部分继续。如果错过了第一部，可以去看看…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">emre-arslan.medium.com</p></div></div><div class="jp l"><div class="jw l jr js jt jp ju jv jg"/></div></div></a></div><p id="550b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">读完这篇文章后，我相信你会有足够的背景知识开始使用MotionLayout。准备好了请系好安全带，我们就要起飞了🚀🚀</p><figure class="jx jy jz ka fd kb"><div class="bz dy l di"><div class="kc kd l"/></div></figure><h1 id="4c6c" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">什么是MotionLayout？</h1><blockquote class="lc ld le"><p id="a59e" class="if ig lf ih b ii ij ik il im in io ip lg ir is it lh iv iw ix li iz ja jb jc hb bi translated">MotionLayout是ConstraintLayout的一个子类，具有动画视图的其他方法。</p></blockquote><p id="a019" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">MotionLayout可以被认为是一个ConstraintLayout，它具有许多很酷的属性，可以获得由交互驱动的复杂视图动画(按下按钮，在Recyclerview上拖动，等等)。).您可以继续使用所有ConstraintLayout基本功能(链、障碍、组等。)同时使用MotionLayout。MotionLayout最强大的特性之一是它允许您进行<code class="du lj lk ll lm b">midway seeking of animations</code>。我的意思是，你不必等待动画结束，你可以在它还在运行的时候操纵它！</p><p id="6af6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以将MotionLayout和<strong class="ih hj"> API等级14或者更高的</strong>一起使用。</p><p id="5568" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，既然我们知道了MotionLayout的基本概念，让我们来看看它的实际应用以及它的功能！</p><figure class="jx jy jz ka fd kb"><div class="bz dy l di"><div class="ln kd l"/></div></figure><p id="d828" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您不必做任何额外的步骤就可以开始使用它。我们只需要将ConstraintLayout依赖项的正确版本添加到我们的<code class="du lj lk ll lm b">app/build.gradle</code>文件中。</p><pre class="jx jy jz ka fd lo lm lp lq aw lr bi"><span id="c003" class="ls kf hi lm b fi lt lu l lv lw">dependencies {<br/>implementation'androidx.constraintlayout:constraintlayout:2.0.0beta'<br/>}</span></pre><p id="47ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我前面提到的，因为MotionLayout是ConstraintLayout的子类，所以可以直接用MotionLayout标记替换ConstraintLayout标记。</p><pre class="jx jy jz ka fd lo lm lp lq aw lr bi"><span id="a608" class="ls kf hi lm b fi lt lu l lv lw">&lt;!-- before: ConstraintLayout --&gt;<br/>&lt;androidx.constraintlayout.widget.ConstraintLayout .../&gt;<br/>&lt;!-- after: MotionLayout --&gt;<br/>&lt;androidx.constraintlayout.motion.widget.MotionLayout .../&gt;</span></pre><p id="9e01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以直接使用Android Studio设计工具将ConstraintLayout转换为MotionLayout。</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div class="er es lx"><img src="../Images/8a16f06a19496339f9fd5faff41355cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*BF4BXULev2sZnSO5OpcOPw.png"/></div></figure><p id="6a3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">普通的MotionLayout XML文件如下所示:</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es lz"><img src="../Images/8f525a9d662f56539d0aea8efeeea1e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XGXfBH4_PV2CdQQIauS7KA.png"/></div></div><figcaption class="me mf et er es mg mh bd b be z dx">MotionLayout XML</figcaption></figure><p id="e99c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们逐一研究MotionLayout的核心概念。首先，你可能会注意到上面的<code class="du lj lk ll lm b">app:layoutDescription="@xml/activity_main_scene"</code>。那是什么鬼东西？？？它叫做<strong class="ih hj">运动场景</strong>。</p><p id="b1b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运动场景只是一个XML文件，它定义了布局的所有动画行为。换句话说，我们声明我们将在那里使用什么样的动画。最基本的MotionScene文件如下所示:</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div class="er es mi"><img src="../Images/56624d9438140ec584229fbcbe009ba0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*q5DjAecvQrFc6LLM-zfcaA.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx">MotionScene XML</figcaption></figure><p id="0b81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们逐一调查这些标签。</p><h2 id="d16f" class="ls kf hi bd kg mj mk ml kk mm mn mo ko iq mp mq ks iu mr ms kw iy mt mu la mv bi translated">约束集</h2><p id="7cd2" class="pw-post-body-paragraph if ig hi ih b ii mw ik il im mx io ip iq my is it iu mz iw ix iy na ja jb jc hb bi translated">顾名思义，它只不过是一组约束😑。ConstraintLayout和MotionLayout的主要区别在于，可以在MotionLayout的MotionScene文件中指定约束。换句话说，您可以将约束分离到另一个文件中。但我为什么要这么做🤔？</p><blockquote class="lc ld le"><p id="c58e" class="if ig lf ih b ii ij ik il im in io ip lg ir is it lh iv iw ix li iz ja jb jc hb bi translated">您可以为视图指定多个约束集，并使用它们来制作动画！</p></blockquote><p id="8cbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你创建你的运动场景时，你可能已经在设计工具中注意到了这个图。</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div class="er es nb"><img src="../Images/bf03bdc46f8535b5c96b473b93f589cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*ja-VY0jbdSfdT9V-_DDa_w.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx">Motion Editor</figcaption></figure><p id="d613" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这到底是什么？？？这个叫做<em class="lf">“运动编辑器”</em>，代表运动流。这是一个伟大的工具来建立，修改或预览动画。默认情况下，它为您带来了<code class="du lj lk ll lm b">start</code>和<code class="du lj lk ll lm b">end</code>约束集。你可以在这两者之间定义不同的约束，制作你的第一个动画！</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div class="er es nc"><img src="../Images/a421600288f707db3b0c2bfc1794dd75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*FbhoNI4xw7F0OuvazEgkrA.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx">layout.xml</figcaption></figure><figure class="jx jy jz ka fd kb er es paragraph-image"><div class="er es nd"><img src="../Images/9faf28762903c47bc82c7d6a40b98bb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*yqc7uwI6TbqnG9B3fy1CwQ.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx">activity_motion_scene.xml</figcaption></figure><figure class="jx jy jz ka fd kb er es paragraph-image"><div class="er es ne"><img src="../Images/eac4508f6035aabaab34de7fdbb4121a.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*jaAVbdQlynucShHeAa_weg.gif"/></div><figcaption class="me mf et er es mg mh bd b be z dx">ConstraintSet Animation</figcaption></figure><p id="2e18" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你习惯了，你可以通过定义不同的约束集来创建复杂的动画🚀🚀。</p><h2 id="bf18" class="ls kf hi bd kg mj mk ml kk mm mn mo ko iq mp mq ks iu mr ms kw iy mt mu la mv bi translated">过渡</h2><blockquote class="lc ld le"><p id="dfa2" class="if ig lf ih b ii ij ik il im in io ip lg ir is it lh iv iw ix li iz ja jb jc hb bi translated">过渡基本上是两个约束集之间的连接。</p></blockquote><p id="1564" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个运动场景<strong class="ih hj">必须有</strong>至少一个过渡。它只是决定要在约束集之间执行的运动序列。MotionScene可能包含多个过渡。如果是，MotionLayout足够智能，可以根据用户交互(向左滑动、向右滑动、点击事件等)选择最合适的一个。).</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div class="er es nf"><img src="../Images/f6e71327a965da3858f6dfefb92e0171.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*cLEMaKHbdq9AjFa4lih2pA.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx">Transition Tags</figcaption></figure><p id="e8dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们用onSwipe标签做一个简单的例子。当用户滑动视图时，它会从上到下滑动。</p><p id="5433" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，定义你的运动布局。</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div class="er es ng"><img src="../Images/1034462d39272018a3ed57ed26d84571.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*QPIYAMsDP9seYxe4ef_pEQ.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx">layout.xml</figcaption></figure><p id="d081" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，在设置开始和结束约束集之后，在过渡标记中定义onSwipe功能。你可以根据需要定义任何方向。</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div class="er es nh"><img src="../Images/35b4ef315ad17e4aa0fb4552531798ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*Eij2Zb-E9qilUIqW2NSKeA.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx">activity_motion_scene.xml</figcaption></figure><p id="ae94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以将视图拖动到所需的方向😎。</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div class="er es ni"><img src="../Images/c0a27e99d00d51c881b288445e914d1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*oWbRkPpupgaFZ71sZZM9lg.gif"/></div><figcaption class="me mf et er es mg mh bd b be z dx">onSwipe Transition</figcaption></figure><h2 id="9377" class="ls kf hi bd kg mj mk ml kk mm mn mo ko iq mp mq ks iu mr ms kw iy mt mu la mv bi translated">关键帧集</h2><blockquote class="lc ld le"><p id="dc92" class="if ig lf ih b ii ij ik il im in io ip lg ir is it lh iv iw ix li iz ja jb jc hb bi translated">可以将关键帧集视为动画中的一个检查点。</p></blockquote><p id="447e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面我提到过，视图事务可以有两个以上的约束集。关键帧集可以被认为是轻量级约束集。您可以通过关键帧集更改视图属性。说够了，让我们看看实际行动吧！</p><p id="6708" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这次我们将一起使用多个属性。我们的布局文件保持不变。</p><p id="6873" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将只改变运动场景的布局。</p><p id="8d42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，让我们改变视图滑动时的颜色。为此，我们可以在ConstraintSet中使用<code class="du lj lk ll lm b">CustomAttribute</code>标签。</p><pre class="jx jy jz ka fd lo lm lp lq aw lr bi"><span id="aca0" class="ls kf hi lm b fi lt lu l lv lw">&lt;CustomAttribute<br/>        motion:attributeName="backgroundColor"<br/>        motion:customColorValue="#1A7FCF"/&gt;<br/>&lt;/Constraint&gt;</span></pre><p id="b151" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们来玩一下我们的路径。我们将使它蜿蜒曲折，而不是直线路径。为此，我们可以使用<em class="lf">关键帧集</em>中的<code class="du lj lk ll lm b">KeyPosition</code>标签。你可以用不同的值来得到不同的结果。</p><pre class="jx jy jz ka fd lo lm lp lq aw lr bi"><span id="bbda" class="ls kf hi lm b fi lt lu l lv lw">&lt;KeyPosition<br/>    motion:keyPositionType="parentRelative"<br/>    motion:percentX="0.25"<br/>    motion:framePosition="50"<br/>    motion:motionTarget="@+id/first_view"/&gt;</span></pre><p id="83de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我想改变视图移动时的大小。为此，我们可以在<em class="lf">关键帧集中使用<code class="du lj lk ll lm b">KeyAttribute</code>标签。</em></p><pre class="jx jy jz ka fd lo lm lp lq aw lr bi"><span id="3a78" class="ls kf hi lm b fi lt lu l lv lw">&lt;KeyAttribute<br/>    android:scaleX="2"<br/>    android:scaleY="2"<br/>    android:rotation="-45"<br/>    motion:framePosition="50"<br/>    motion:motionTarget="@+id/first_view"/&gt;</span></pre><p id="76c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有了这些，我们的运动场景看起来会像这样:</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es nj"><img src="../Images/7582338afa726cbdadb75cdad00dda8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*l0LgkTc630Hh1TaHhurnpA.png"/></div></div><figcaption class="me mf et er es mg mh bd b be z dx">activity_motion_scene.xml</figcaption></figure><p id="38b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有哒哒哒！</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div class="er es ni"><img src="../Images/3a0128c060c0963badf948b4a64a5880.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*PWOpWKMrW_BNDJg4ffdg2g.gif"/></div></figure><p id="ad07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是所有的乡亲。恭喜你，🥳。您可以开始使用MotionLayout😎。当然，仍然有大量的内容需要介绍。但是我敢说你已经做了一个很好的开端💪🏻👊🏻。</p><p id="4547" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一集再见👋🏻。</p></div><div class="ab cl nk nl gp nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="hb hc hd he hf"><figure class="jx jy jz ka fd kb"><div class="bz dy l di"><div class="ln kd l"/></div></figure></div></div>    
</body>
</html>