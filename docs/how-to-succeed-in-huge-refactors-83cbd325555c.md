# 如何在大型重构中取得成功

> 原文：<https://medium.com/geekculture/how-to-succeed-in-huge-refactors-83cbd325555c?source=collection_archive---------21----------------------->

如何把事情做好，相信自己&队友的价值。

![](img/7f78ef79db858abd70720610da54d0ca.png)

Photo by [Martin Sanchez](https://unsplash.com/@zekedrone?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/s/photos/mountain-lava-person?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

我正在写一个大型重构任务的故事；一路上的主要决定是什么？我列出了各种取舍，以及我是如何在短时间内取得巨大进步的。

# 出了什么问题？

我们的业务逻辑层包含“应用程序”，即表示功能的类。它不是按比例编写的，我们有许多应用程序，每个应用程序都有自己的线程，它们之间有回调和依赖关系。

问题是我们不知道什么时候会遇到竞争或死锁。为了修复这样的错误，我们必须重写整个基础设施，所以决定将其转换为单线程。

# 我从以前的任务所有者那里继承了什么？

这项任务已经进行了一年多，大量代码漂浮在一个大的提交中，没有被推到任何地方。我决定打开一个全新的提交，并获取旧代码的片段，因为我必须阅读并理解我自己的提交中的每一行。

权衡:

*   将一个开发人员添加到一个项目中，从长远来看可以加速，而这个开发人员从零开始学习项目的开销[从短期来看很慢]
*   重用尚未测试的现有代码，而不是从头开始并放慢速度。
*   深入理解每一行代码，而不是开始使用它，然后一头扎进一个特定的问题[现在花时间，而不是以后浪费时间在不熟悉的代码上]。

我的经理选择给这个任务添加一个新的开发人员(我)，我选择使用现有的代码*和*重新阅读并理解它的每一行。

# 过去阻碍这项工作完成的主要障碍是什么？

当我回顾我的队友所做的工作时，我注意到需要的改变可以分成两组:

*   允许多个应用程序在同一线程上运行的新基础设施
*   将应用从旧基础架构迁移到新基础架构。

以前的任务所有者试图在一次提交中完成所有事情，实际上改变了业务逻辑层中的每个文件。每当它们从主分支重定基础时，就会导致令人精疲力竭的合并冲突，因为需要一次又一次地检查一个特性的所有逻辑，并对新的基础结构进行必要的调整。所以自然地，这减慢了开发过程。

# 我的混合阶段策略是什么？

我把这项任务分成几次提交；第一个包括新的基础架构，以一个应用程序转换为例。这意味着我们有两个不同的架构同时存在，每个架构上有几个应用程序。

稍后，我们将能够进行小的提交；每个转换一个应用程序。

混合阶段的缺点是:

*   更多的 QA 资源，因为我们必须在每次提交时进行回归测试
*   让两种架构并存，容易出现逻辑错误
*   我们不太可能完成整个重构，因为紧急问题会导致我们离开未重构的应用程序，去解决 bug。

优点是:

*   当我获得基础架构批准时，我不需要改变基础或者考虑大部分业务逻辑。我把一些独特的问题留给了一个未解决的应用程序，因为我知道我以后会处理它们。
*   我可以在几个冲刺阶段内提交任务。
*   添加应用程序的任务是独立的，这意味着几个开发人员可以并行完成，并且比主要的基础设施任务更容易——因此它们可以交给经验较少的开发人员。

我对我的逻辑和设计有信心，这两种架构可以共存，所以我选择了混合策略。

# 我不得不放弃哪些原则？

我不得不放弃让每一段代码都尽善尽美的愿望。有太多的边缘案例和问题需要解决。在开始编码之前，我无法计划一个能解决所有问题的设计。

相反，我必须相信自己能够处理问题，并在工作中不断进步。

我也不得不放弃一定程度的骄傲——独自完成任务的每一部分并允许他人帮助我的骄傲。幸运的是，我发现我真的喜欢指导，看着其他开发人员成功地钻研我的代码给了我极大的快乐。

# 总结—我学到了什么？

我学会了相信自己的逻辑和直觉，我的经理也信任我做出的重要决定。

我学会了把一个大任务分成小的、可分块的任务。

最重要的是，作为一名团队成员，我进步了，我们完成了任务。

![](img/66f9e748704d8a0b74183c13edd6269d.png)

Photo by [Tim Marshall](https://unsplash.com/@timmarshall?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/s/photos/circle-people?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)