<html>
<head>
<title>Importing and exporting JavaScript Gantt chart data from and to Excel®</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Excel导入和导出JavaScript甘特图数据</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/importing-and-exporting-javascript-gantt-chart-data-from-and-to-excel-7b25304e7552?source=collection_archive---------32-----------------------#2021-05-24">https://medium.com/geekculture/importing-and-exporting-javascript-gantt-chart-data-from-and-to-excel-7b25304e7552?source=collection_archive---------32-----------------------#2021-05-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8504" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们最近发表了一篇关于使用我们新的<a class="ae jd" href="http://nuget.org/packages/DlhSoft.ProjectManagementFramework.Xlsx" rel="noopener ugc nofollow" target="_blank">项目管理框架加载和保存Excel文件的文章。来自Windows桌面应用的Xlsx </a>包(当然是在<a class="ae jd" href="https://dlhsoft.com/PMF" rel="noopener ugc nofollow" target="_blank"> DlhSoft项目管理框架</a>之上)。</p><p id="ca8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，如果您想在支持JavaScript的页面(或应用程序)中导入/导出数据表，该怎么办呢？例如在ASP中。基于. NET的网站。网芯2.x，。净5甚至。NET框架4+。</p><p id="55c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">别担心，我们会掩护你的。我们的<a class="ae jd" href="https://github.com/DlhSoftTeam/ProjectManagementXlsx" rel="noopener ugc nofollow" target="_blank">开源</a>库已经被开发为<em class="je">。NET Standard 2.0 </em>库，所以它也绝对可以在那里工作。</p></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><p id="eca0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能会问为什么是Excel表格。我们会回答说，为什么不呢？CSV或制表符分隔的数据确实很容易导出/导入，但是——对于许多用户来说——如果您也可以直接转到Office文件会好得多。显然，Microsoft Office是最常见的商业套件，几乎所有其他平台都集成并支持该套件。</p></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><p id="8e55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你想知道细节，对吗？所以我们开始吧:</p><h2 id="f7af" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">NuGet包</h2><p id="cbbb" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">如果你只是想开始，这里是你要去的地方:</p><div class="km kn ez fb ko kp"><a href="https://www.nuget.org/packages/DlhSoft.ProjectManagementFramework.Xlsx" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab dw"><div class="kr ab ks cl cj kt"><h2 class="bd hj fi z dy ku ea eb kv ed ef hh bi translated">DlhSoft。Xlsx 1.0.3</h2><div class="kw l"><h3 class="bd b fi z dy ku ea eb kv ed ef dx translated">DlhSoft项目管理框架的Excel工作表适配器(Microsoft Project XML格式的内容)</h3></div><div class="kx l"><p class="bd b fp z dy ku ea eb kv ed ef dx translated">www.nuget.org</p></div></div><div class="ky l"><div class="kz l la lb lc ky ld le kp"/></div></div></a></div><h2 id="e07e" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">GitHub项目</h2><p id="141a" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">但是，如果你想进一步定制的东西，只是克隆我们的回购，而是有乐趣！</p><div class="km kn ez fb ko kp"><a href="https://github.com/DlhSoftTeam/ProjectManagementXlsx/tree/master/ProjectManagementXlsx" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab dw"><div class="kr ab ks cl cj kt"><h2 class="bd hj fi z dy ku ea eb kv ed ef hh bi translated">dlhsofteam/ProjectManagementXlsx</h2><div class="kw l"><h3 class="bd b fi z dy ku ea eb kv ed ef dx translated">DlhSoft项目管理框架的Excel表适配器(Microsoft Project XML格式的内容)…</h3></div><div class="kx l"><p class="bd b fp z dy ku ea eb kv ed ef dx translated">github.com</p></div></div><div class="ky l"><div class="lf l la lb lc ky ld le kp"/></div></div></a></div><h2 id="6871" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">项目XML格式</h2><p id="958d" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">如上所述，我们的新工具利用了<a class="ae jd" href="https://dlhsoft.com/PMF" rel="noopener ugc nofollow" target="_blank"> DlhSoft项目管理框架</a>，除了内联添加和删除项目之外，它还可以处理Microsoft Project XML格式的数据。(我们所有的甘特图组件也是如此。)</p><div class="km kn ez fb ko kp"><a href="https://docs.microsoft.com/en-us/office-project/xml-data-interchange/project-elements-and-xml-structure?view=project-client-2016" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab dw"><div class="kr ab ks cl cj kt"><h2 class="bd hj fi z dy ku ea eb kv ed ef hh bi translated">项目元素和XML结构</h2><div class="kw l"><h3 class="bd b fi z dy ku ea eb kv ed ef dx translated">本节包含有关Microsoft Office中定义的项目元素及其子项目的信息…</h3></div><div class="kx l"><p class="bd b fp z dy ku ea eb kv ed ef dx translated">docs.microsoft.com</p></div></div><div class="ky l"><div class="lg l la lb lc ky ld le kp"/></div></div></a></div><h2 id="78ce" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">组件许可</h2><p id="5dba" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">但是不要担心:尽管你确实需要一个项目管理框架的开发许可证，你可以直接从我们的网站上免费获得一个，只要你是一个DlhSoft甘特图超级许可证持有者。</p><h1 id="ad01" class="lh jn hi bd jo li lj lk js ll lm ln jw lo lp lq jz lr ls lt kc lu lv lw kf lx bi translated">将项目XML与Excel工作表相互转换</h1><p id="2c12" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">这就是你在Microsoft Project XML和Excel文件之间转换内容的方式。</p><p id="2c6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将Excel文件作为项目XML内容读取:</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="c707" class="jm jn hi md b fi mh mi l mj mk">var excelBytes = File.ReadAllBytes(<em class="je">sourceXlsxFilePath</em>);<br/>var <em class="je">projectXml</em> = ProjectManagementXlsx.Adapter.GetProjectXml(excelBytes);</span></pre><p id="acf4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要用项目XML字符串创建Excel文件:</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="2d34" class="jm jn hi md b fi mh mi l mj mk">var excelBytes = ProjectManagementXlsx.Adapter.GetExcelBytes(<em class="je">projectXml</em>);                File.WriteAllBytes(<em class="je">targetXlsxFilePath</em>, excelBytes);</span></pre><h2 id="7244" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">内置Excel模板</h2><p id="08b8" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">工具生成的Excel表格当然需要尊重一些条件。</p><p id="0615" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">具体来说，假设任务数据总是在文件的第一个工作表中，并且工作表的第一行应该总是包含标题值。和实际任务域必须准确地映射到列，如下所示:</p><figure class="ly lz ma mb fd ml"><div class="bz dy l di"><div class="mm mn l"/></div></figure><h1 id="cfd5" class="lh jn hi bd jo li lj lk js ll lm ln jw lo lp lq jz lr ls lt kc lu lv lw kf lx bi translated">ASP的示例应用程序。NET和JavaScript</h1><p id="c278" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">现在，让我们把所有东西放在一起，直接从浏览器中显示的甘特图数据加载并保存Excel表格。</p><figure class="ly lz ma mb fd ml er es paragraph-image"><div class="er es mo"><img src="../Images/d8ff219242a624d3eb96c5745fb677ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*AMRTZGo7fVKpV8XcawrtbQ.png"/></div></figure><p id="c222" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个使用ASP开发的小示例应用程序。NET Core (MVC)和一点JavaScript，利用来自<a class="ae jd" href="https://dlhsoft.com/GCHL" rel="noopener ugc nofollow" target="_blank"> DlhSoft甘特图超级库</a>的<a class="ae jd" href="https://dlhsoft.com/GCHL/GanttChartView.html" rel="noopener ugc nofollow" target="_blank"> GanttChartView </a>组件作为UI。</p><p id="7a5d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随意提取相关的进出口代码(见<a class="ae jd" href="https://github.com/DlhSoftTeam/XlsxGanttChartWeb/blob/master/XlsxGanttChartWeb/wwwroot/js/site.js" rel="noopener ugc nofollow" target="_blank"> site.js </a>和<a class="ae jd" href="https://github.com/DlhSoftTeam/XlsxGanttChartWeb/blob/master/XlsxGanttChartWeb/Controllers/HomeController.cs" rel="noopener ugc nofollow" target="_blank"> HomeController.cs </a>)并根据需要进行扩展！</p><p id="7e20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(同样，如果您真的需要进一步定制，请不要犹豫更新执行实际XML-Excel转换的<a class="ae jd" href="https://github.com/DlhSoftTeam/ProjectManagementXlsx/blob/master/ProjectManagementXlsx/Adapter.cs" rel="noopener ugc nofollow" target="_blank">适配器</a>！)</p><div class="km kn ez fb ko kp"><a href="https://github.com/DlhSoftTeam/XlsxGanttChartWeb" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab dw"><div class="kr ab ks cl cj kt"><h2 class="bd hj fi z dy ku ea eb kv ed ef hh bi translated">dlhsofteam/XlsxGanttChartWeb</h2><div class="kw l"><h3 class="bd b fi z dy ku ea eb kv ed ef dx translated">与Excel示例集成。NET MVC-dlhsofteam/XlsxGanttChartWeb</h3></div><div class="kx l"><p class="bd b fp z dy ku ea eb kv ed ef dx translated">github.com</p></div></div><div class="ky l"><div class="mq l la lb lc ky ld le kp"/></div></div></a></div><p id="7f9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要将甘特图数据保存为Excel表格，您需要从客户端获取<em class="je">项目XML </em>内容，在服务器上将它转换为Excel字节，然后将字节下载回来。要将上传到服务器的Excel表格转换成Project XML，也同样简单。只看下面的代码:</p><h2 id="21da" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">导出数据</h2><p id="34a0" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">从<em class="je"> site.js </em>文件中提取(客户端):</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="926b" class="jm jn hi md b fi mh mi l mj mk">function saveXlsx() {<br/>  let data = new FormData();<br/>  var projectSerializer = DlhSoft.Controls.GanttChartView.ProjectSerializer.initialize(ganttChartView);<br/>  var projectXml = projectSerializer.getXml();<br/>  data.append('ProjectXml', projectXml);<br/>  fetch('/Home/SaveXlsx', { method: 'POST', body: data }).then(response =&gt; response.json()).then(response =&gt; {<br/>    var excelBase64 = response.data;<br/>    var dataUrl = 'data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,' + excelBase64;<br/>    const a = document.createElement('a');<br/>    a.href = dataUrl;<br/>    a.download = 'GanttChart.xlsx';<br/>    a.click();<br/>  });<br/>}</span></pre><p id="0416" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从<em class="je"> HomeController.cs </em>文件中提取(服务器端):</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="8ca1" class="jm jn hi md b fi mh mi l mj mk">[HttpPost]<br/>public IActionResult SaveXlsx(ProjectXmlForm form)<br/>{<br/>  var excelBytes = ProjectManagementXlsx.Adapter.GetExcelBytes(form.ProjectXml);<br/>  return Ok(new { data = Convert.ToBase64String(excelBytes) });<br/>}</span></pre><h2 id="31ed" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">导入数据</h2><p id="a1bd" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">从<em class="je"> site.js </em>文件中提取(客户端):</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="6f0a" class="jm jn hi md b fi mh mi l mj mk">function loadXlsx() {<br/>  let data = new FormData();<br/>  var fileInput = document.getElementById('xlsxFileInput');<br/>  let file = fileInput.files[0];<br/>  if (!file) {<br/>    alert('Select a file first.');<br/>    return;<br/>  }<br/>  data.append('file', file);<br/>  fetch('/Home/LoadXlsx', { method: 'POST', body: data }).then(response =&gt; response.json()).then(response =&gt; {<br/>    var projectXml = response.data;<br/>    var projectSerializer = DlhSoft.Controls.GanttChartView.ProjectSerializer.initialize(ganttChartView);<br/>    projectSerializer.loadXml(projectXml);<br/>  });<br/>}</span></pre><p id="966e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从<em class="je"> HomeController.cs </em>文件中提取(服务器端):</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="a4b3" class="jm jn hi md b fi mh mi l mj mk">[HttpPost]<br/>public IActionResult LoadXlsx(IFormFile file)<br/>{<br/>  using (var stream = file.OpenReadStream()) {<br/>    byte[] excelBytes = new byte[file.Length];<br/>    stream.Read(excelBytes, 0, excelBytes.Length);<br/>    var projectXml = ProjectManagementXlsx.Adapter.GetProjectXml(excelBytes);<br/>    return Ok(new { data = projectXml });<br/>  }<br/>}</span></pre></div></div>    
</body>
</html>