<html>
<head>
<title>Create a Solana Client with Rust</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Rust创建一个Solana客户端</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/create-a-solana-client-with-rust-62b35a59511d?source=collection_archive---------6-----------------------#2022-04-02">https://medium.com/geekculture/create-a-solana-client-with-rust-62b35a59511d?source=collection_archive---------6-----------------------#2022-04-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/4cde7a130db4990c5a71b0f9713fc8a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*snFQ8EJG7O8eKF_bmXIuWg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@chuttersnap?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">CHUTTERSNAP</a> on <a class="ae iu" href="https://unsplash.com/s/photos/blockchain?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="22c0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Solana是一个分散的区块链，允许你运行分散的应用程序。</p><p id="729a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在过去的几个月里，我一直在探索这个世界，并想分享一些关于Solana的Rust API的好东西。这对我来说是一个很好的起点。</p><p id="c42f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个描述非常简短，但是你可以通过这个<a class="ae iu" href="https://solana.com/" rel="noopener ugc nofollow" target="_blank">链接</a>更好地了解索拉纳。(我也会这么做)</p><p id="dcb5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Solana提供了一些不同的客户端API，比如<a class="ae iu" href="https://docs.solana.com/developing/clients/rust-api" rel="noopener ugc nofollow" target="_blank"> Rust </a>和Node.js</p><p id="15d7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">完整的源代码在<a class="ae iu" href="https://github.com/paoloposso/solana_rust_client" rel="noopener ugc nofollow" target="_blank">paoloposso/Solana _ rust _ client(github.com)</a>上。如果你愿意的话，可以查看它以获得代码片段和/或克隆它。</p><h2 id="da5e" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">入门指南</h2><p id="7422" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">我想你已经安装了Rust。如果不是这样，使用这个<a class="ae iu" href="https://www.rust-lang.org/tools/install" rel="noopener ugc nofollow" target="_blank">连杆</a>。</p><p id="d89e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">用<code class="du kt ku kv kw b">cargo new --bin rust_client</code>创建一个rust项目</p><p id="f830" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">导航到包含项目的文件夹，并打开您喜欢的IDE /编辑器。我用的是Visual Studio代码。</p><p id="40be" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建一个lib.rs文件。</p><figure class="ky kz la lb fd ij er es paragraph-image"><div class="er es kx"><img src="../Images/d5f1145f6762a69cef07ba8092bcda7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:558/format:webp/1*dbX_LzUB6B6DyYCMRH_Otg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Structure of my project</figcaption></figure><p id="81a3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将下列依赖项添加到。toml文件。</p><pre class="ky kz la lb fd lc kw ld le aw lf bi"><span id="d729" class="jt ju hi kw b fi lg lh l li lj">[dependencies]<br/>solana-sdk = "1.10.0"<br/>solana-client = "1.10.0"<br/>solana-program = "1.7.14"</span></pre><p id="fa3b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在main.rs上创建一个RPC客户端，它将被注入到lib.rs文件的函数中。这样我们可以集中配置。</p><p id="b8a5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意，我使用的是<a class="ae iu" href="https://docs.solana.com/clusters" rel="noopener ugc nofollow" target="_blank">Solana<em class="lk">devnet</em></a><em class="lk"/>URL。</p><pre class="ky kz la lb fd lc kw ld le aw lf bi"><span id="7b51" class="jt ju hi kw b fi lg lh l li lj">let rpc_client = RpcClient::new("https://api.devnet.solana.com");</span></pre><p id="e139" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">同样为了简单起见，我注入了RPC客户机，而不是用客户机创建一个结构。</p><p id="22e5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要包含在lib.rs文件中的导入:</p><pre class="ky kz la lb fd lc kw ld le aw lf bi"><span id="414f" class="jt ju hi kw b fi lg lh l li lj">use std::error::Error;<br/>use solana_client::rpc_client::RpcClient;<br/>use solana_program::pubkey::Pubkey;<br/>use solana_sdk::{system_transaction, signature::{Keypair, Signature}};</span></pre><p id="e329" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将创建一个方法来返回一个新的keypair，只是为了减少rust SDK在主文件中的依赖性，并更好地集中对Solana网络的调用。</p><figure class="ky kz la lb fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/4a977bfa5d029675038ad1c31305a05f.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/format:webp/1*CDVpZkPNI9PH85Y6ybpqNg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Function that returns newly created keypair</figcaption></figure><p id="7119" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本例中，对于每次执行，我们将为发送方和接收方创建新的密钥对。</p><h2 id="d587" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">Airdrop:向发送方密钥对添加资金</h2><p id="4105" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">下面的代码片段显示了请求空投的代码。</p><p id="90d4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些方法接收lamports中的数量，表示0.000000001 SOL。因此，在将lamports发送到RPC客户端方法之前，有必要计算它的值。</p><p id="323e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们通过创建一个值为1000000000的const LAMPORTS_PER_SOL来实现。</p><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/19d6bf0c082929e61bf187f484a7add2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nYbMyN23XhrupuDFr4r8LA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Requesting an airdrop on Solana devnet</figcaption></figure><p id="7040" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意，在请求空投之后，我们调用<em class="lk"> confirm_transaction </em>方法，并且只在确认之后返回函数。</p><h2 id="1292" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">检查账户余额</h2><p id="f24c" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">我们还可以使用帐户的公钥来检查余额。余额在lamports中返回，所以我们可以通过除以我们创建的常量来格式化它。</p><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/2a6cfa2b5dec637980dc3b8c2b560047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H8Jjv30cF9tQ5X6sXuBDUA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Function that checks the balance for a public key</figcaption></figure><h2 id="ca0f" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">转移资金</h2><p id="337d" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">现在我们两个新创建的账户之间的转账。</p><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/8d4a61b73a29240d135b45429b9fde49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ehj6PWNywWgrkDXKS0v4bw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Transferring funds between accounts</figcaption></figure><p id="a4a2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个<em class="lk">send _ and _ confirm _ transaction</em>方法包含了这个只有在确认后才返回的版本。这样，我们可以以一致的形式输出帐户余额。</p><h2 id="8afa" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">调用我们的函数</h2><p id="9954" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">在<strong class="ix hj"> main方法</strong>，main.rs文件中，我们将调用<em class="lk"> create_keypair </em>函数来创建发送方和接收方。</p><figure class="ky kz la lb fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/549ad19a24ea32337ec387859a3c61a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*-SsNSfxbOtU8IEWsVsCWMQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Creation of keypairs and output of both keypair’s public keys</figcaption></figure><figure class="ky kz la lb fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/88d8d3d8896535df67dfe5ea96b1fbe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*aXdKWobkqOR8NZkd1PPMmw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Output of public keys on console</figcaption></figure><p id="8162" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">之后，我们可以打印密钥并使用<a class="ae iu" href="https://explorer.solana.com/?cluster=devnet" rel="noopener ugc nofollow" target="_blank"> Solana Explorer </a>在<em class="lk"> devnet </em>上检查它们的余额。下面的例子是接收器<strong class="ix hj">在</strong>传输之后，因此0.5 SOL平衡。</p><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/588f9022ba9d6213724a7aded3a3a56d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nIwyfzPk75sCMbAkrH4y6Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Example of an account balance on Solana Explorer</figcaption></figure><p id="7c55" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，我们用1 SOL的<em class="lk"> request_air_drop </em>为发送方请求空投，这样发送方将有余额转移到接收方。</p><pre class="ky kz la lb fd lc kw ld le aw lf bi"><span id="18a1" class="jt ju hi kw b fi lg lh l li lj">request_air_drop(&amp;rpc_client, &amp;sender.pubkey(), 1.0);</span></pre><p id="d6dd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们还可以使用<em class="lk"> check_balance </em>检查两个键对的平衡，并打印两个<em class="lk">的平衡。</em>该方法也返回交易签名。</p><pre class="ky kz la lb fd lc kw ld le aw lf bi"><span id="50c9" class="jt ju hi kw b fi lg lh l li lj">check_balance(&amp;rpc_client, &amp;sender.pubkey());<br/>check_balance(&amp;rpc_client, &amp;receiver.pubkey());</span><span id="7bba" class="jt ju hi kw b fi ls lh l li lj">println!("Sender balance: {:?}", balance);</span></pre><p id="ae4d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">空投后，我们可以使用<em class="lk"> transfer_funds调用转账。</em></p><pre class="ky kz la lb fd lc kw ld le aw lf bi"><span id="7476" class="jt ju hi kw b fi lg lh l li lj">transfer_funds(&amp;rpc_client, &amp;sender, &amp;receiver.pubkey(), transfer_amount);</span><span id="eb6d" class="jt ju hi kw b fi ls lh l li lj">println!("Transfer of {:?} finished. Signature: {:?}", transfer_amount, sig);</span></pre><h2 id="3c4d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">把所有东西都包起来！</h2><p id="e3e1" class="pw-post-body-paragraph iv iw hi ix b iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">我们快完成了。下面是main.rs文件中完整执行的片段:</p><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/2a59997d686367249a3b2c427b7565fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zrOVx_zmm87sjZhASKT8dg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">main function</figcaption></figure><p id="8ca4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行<code class="du kt ku kv kw b">cargo run</code>来执行它。输出应该如下所示:</p><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/f3df4aeda832d8b34ff0eeae1adc626e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KfXQFusbf6WVQhbZWZK7MQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Console output</figcaption></figure><p id="55d2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以在<a class="ae iu" href="https://explorer.solana.com/?cluster=devnet" rel="noopener ugc nofollow" target="_blank"> Solana Explorer </a>上使用各自的键查看转账和账户余额，如前所示。</p><p id="9ba8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里您可以看到转账交易:</p><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/7b6f44740429f2d9380874c8cfdfb5c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Da1-BVPxkSAGg-TdFWkiyA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Solana Explorer</figcaption></figure><p id="795d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就这些了，伙计们。希望它可能对像我一样正在学习Rust和Solana其他人有用。</p><p id="7d91" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下一集再见！</p></div></div>    
</body>
</html>