<html>
<head>
<title>How to monitor Jenkins metrics using Prometheus &amp; Grafana?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Prometheus &amp; Grafana监控Jenkins指标？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-monitor-jenkins-metrics-using-prometheus-grafana-5901a6bcb789?source=collection_archive---------1-----------------------#2022-03-03">https://medium.com/geekculture/how-to-monitor-jenkins-metrics-using-prometheus-grafana-5901a6bcb789?source=collection_archive---------1-----------------------#2022-03-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="0f97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">普罗米修斯是什么？<br/> </strong> Prometheus是一款开源监控工具，主要用于指标监控、事件监控、告警配置等。Prometheus设计用于监控目标、服务器、数据库、独立虚拟机等。Prometheus使用一种叫做<strong class="ih hj">“PromQL”的强大查询语言。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/05a0535988b46f67d72d0eb87ea9d95f.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/0*RuaJBe8-jVxI-oDy.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">Prometheus Logo</figcaption></figure><p id="5c64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">普罗米修斯配置文件和组件:</strong></p><ul class=""><li id="9b71" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated"><strong class="ih hj"> prometheus.yml:- </strong>这是prometheus的配置文件，我们可以在其中对Prometheus的配置进行所有更改。</li><li id="2faa" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated"><strong class="ih hj"> Promtool:- </strong>它是用于验证Prometheus配置的命令行实用工具。</li><li id="43dc" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated"><strong class="ih hj"> PromQL:- </strong>它是Prometheus使用的强查询语言。</li></ul><p id="4a6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">Grafana是什么？Grafana是一个免费的开源可视化工具，它为特定的数据源提供了各种仪表板、图表、图形和警告。Grafana允许我们查询、可视化、探索指标并为数据源设置警报。我们还可以创建自己的动态仪表板进行可视化和监控。我们可以保存仪表板，并与其他成员共享。我们还可以导入外部仪表板。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kd"><img src="../Images/b60dae6b7260cc627b0b5e177756ea67.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/0*VG1XTSzAHB5TMKAp.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">Grafana Logo</figcaption></figure><p id="e5fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本教程中，我们将使用<strong class="ih hj"> Prometheus </strong>和<strong class="ih hj">Grafana</strong>T61】来监控各种<strong class="ih hj"> Jenkins </strong>指标，并在Grafana中创建仪表板</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ke"><img src="../Images/f1e3d6ac21b5b127d08d08520e5d6614.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*3Jv-eav6Gh-JXZOljf3k3g.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">Jenkins + Prometheus + Grafana</figcaption></figure><p id="7146" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">先决条件:- </strong></p><ul class=""><li id="469a" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated"><strong class="ih hj">普罗米修斯</strong> &amp; <strong class="ih hj">格拉夫纳</strong>的基本概况</li><li id="0e98" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">AWS帐户</li><li id="ba67" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">安装了<strong class="ih hj">詹金斯</strong>的服务器</li></ul><p id="f361" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤1:-创建服务器</strong></p><ul class=""><li id="881e" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">在本教程中，我已经创建了Ubuntu 20.04 AMI的服务器</li><li id="107c" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">在<strong class="ih hj"> AWS </strong>中创建<strong class="ih hj"> Ubuntu 20.04 </strong>服务器。在这个服务器中，我们将安装普罗米修斯</li><li id="f957" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">对于<strong class="ih hj"> Prometheus &amp; Grafana </strong>服务器，我们需要为SSH打开<strong class="ih hj">9090</strong>&amp;<strong class="ih hj">3000</strong>port&amp;port<strong class="ih hj">22</strong></li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kf"><img src="../Images/ab806765b7648de7571582f99c4c8949.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AyORubkrDAOcI27DWHg1iw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Servers</figcaption></figure><p id="c513" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤2:-安装普罗米修斯</strong></p><ul class=""><li id="bc21" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">从这个<a class="ae kk" href="https://prometheus.io/download/#node_exporter" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">链接</strong>下载Prometheus并安装在服务器上。</a></li><li id="5877" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">为了启动普罗米修斯，我们需要在普罗米修斯目录中运行<code class="du kl km kn ko b">./prometheus</code></li><li id="2d7d" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">我们可以在<strong class="ih hj"> &lt;公共IP:9090 &gt; </strong>查看<strong class="ih hj">普罗米修斯</strong>的UI</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="ab fe cl kp"><img src="../Images/31573030d1a65a61fbd5e375cc6c1f55.png" data-original-src="https://miro.medium.com/v2/format:webp/1*b31hiO4ynbDLRrXWEFF4aQ.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">Prometheus UI</figcaption></figure><p id="b43e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤3:-安装Grafana </strong></p><ul class=""><li id="a52a" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">从这个<a class="ae kk" href="https://prometheus.io/download/#node_exporter" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">链接</strong> </a>下载Grafana并安装在我们安装Prometheus的同一台服务器上</li><li id="2675" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">为了启动Grafana，我们需要从Grafana目录运行<code class="du kl km kn ko b">./bin/grafana-server</code>命令</li><li id="d170" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">当你第一次打开Grafana的用户界面时，它会要求输入用户名和密码。默认用户名和密码是<strong class="ih hj"> admin。</strong>您可以在以后更改密码</li><li id="f196" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">我们可以在<strong class="ih hj"> &lt;公共IP: 3000 &gt; </strong>查看Grafana的UI</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kq"><img src="../Images/f81c47d0138adcf9fcd40c410746e0f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CcNtD7nbGcfxLZkf.jpeg"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Grafana UI</figcaption></figure><p id="e27d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤4:-在Jenkins中安装Prometheus插件</strong></p><ul class=""><li id="8a80" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">我们需要在Jenkins中安装Prometheus的插件，这样Prometheus就可以收集Jenkins的所有指标</li><li id="6c51" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">在Jenkins中，点击管理插件，搜索<strong class="ih hj"> Prometheus metrics插件</strong>，然后点击安装</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kr"><img src="../Images/461329f1bc2e25e887ab53a4f1e5aef1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mJ4bElA5uFJSznyMgOux2A.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Prometheus Metrics Plugin</figcaption></figure><ul class=""><li id="eafb" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">Jenkins指标的默认路径是<strong class="ih hj">&lt;Public-IP:8080/Prometheus&gt;</strong></li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ks"><img src="../Images/a4fe1c0edb5b13db069e6c25925745af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IhkllV58xqKr0Xv56gAH-w.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Jenkins Metrics</figcaption></figure><ul class=""><li id="675c" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">我们还可以更改Jenkins指标的默认路径。点击<strong class="ih hj">管理詹金斯- &gt;配置系统- &gt;搜索普罗米修斯</strong>并更改路径。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ks"><img src="../Images/89678c3a89cc052d533f89e41f432192.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ubWWAqHl3ab_etmjgul_uQ.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Default Path</figcaption></figure><p id="557c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤5:-修改普罗米修斯的配置文件</strong></p><ul class=""><li id="3535" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">Prometheus管理名为<strong class="ih hj"> prometheus.yml </strong>的配置文件，我们可以在其中定义各种配置，如<strong class="ih hj"> alerts、scrape_configs </strong>等。</li><li id="591d" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">为了让Prometheus收集Docker节点的指标，我们需要在<strong class="ih hj"> scrape_configs </strong>节下的<strong class="ih hj"> prometheus.yml </strong>中定义以下代码</li></ul><pre class="je jf jg jh fd kt ko ku kv aw kw bi"><span id="5390" class="kx ky hi ko b fi kz la l lb lc">- job_name: "Jenkins Job"<br/>  static_configs:<br/>    - targets: ["&lt;Public IP of Jenkins Node:8080"]</span></pre><ul class=""><li id="ca99" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">添加代码后，我们可以在Prometheus中将我们的节点作为目标进行检查。Prometheus需要一些时间来收集所有指标并显示节点到<strong class="ih hj">到</strong>的状态。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ks"><img src="../Images/76cdd39d61392669ee0649c7fd79ff0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VE0h0jVtCLa1_Qord3IoMw.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Targets</figcaption></figure><p id="2189" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤6:-在Grafana中添加数据源</strong></p><ul class=""><li id="11f5" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">现在，在Grafana中，我们需要添加Prometheus作为数据源</li><li id="20ac" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">之后，在的URL部分我们需要输入Prometheus服务器的IP地址和<strong class="ih hj"> 9090 </strong>端口</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kq"><img src="../Images/9a38b0c4a48a5364f6605fe14cc9fb65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9D6F9EH2w3qpHtgc.jpeg"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Data Source</figcaption></figure><p id="1836" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第7步:-创建仪表板</strong></p><ul class=""><li id="bdd5" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">在Grafana中，我们可以根据需要创建各种仪表板</li><li id="da31" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">因此，在本教程中，我们将创建一个包含4个面板的仪表板</li><li id="3d54" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">第一个面板将显示<strong class="ih hj">活动插件数量，</strong>第二个面板将显示<strong class="ih hj">需要更新的插件数量，</strong>第三个面板将显示<strong class="ih hj">非活动插件数量，</strong>最后一个面板将显示<strong class="ih hj">失败插件数量。</strong></li><li id="dc53" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">点击<strong class="ih hj">创建</strong> - &gt;添加<strong class="ih hj">面板</strong></li><li id="29c5" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">在“指标浏览器”部分，在下面添加查询。以下查询将获取<strong class="ih hj">个活动插件</strong>的数量</li></ul><pre class="je jf jg jh fd kt ko ku kv aw kw bi"><span id="1722" class="kx ky hi ko b fi kz la l lb lc">jenkins_plugins_active{}</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ks"><img src="../Images/754f270993d3efdf4de134f6a30dc4ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WQlx_T-FqM3LYRx9bG_Eww.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Active Plugins</figcaption></figure><ul class=""><li id="7f06" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">您可以将可视化更改为<strong class="ih hj">状态</strong></li><li id="57cc" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">点击<strong class="ih hj">添加面板</strong>添加第二个面板</li><li id="fb24" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">在“指标浏览器”部分，在下面添加查询。以下查询将获取<strong class="ih hj">非活动插件</strong>的数量</li></ul><pre class="je jf jg jh fd kt ko ku kv aw kw bi"><span id="84f4" class="kx ky hi ko b fi kz la l lb lc">jenkins_plugins_inactive{}</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ks"><img src="../Images/43733d14f455de77fc4802bd5f29dcbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rW-qmo_edSScklY-95v-ig.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Inactive Plugins</figcaption></figure><ul class=""><li id="b292" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">点击<strong class="ih hj">添加面板</strong>添加第三个面板</li><li id="f885" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">在“指标浏览器”部分，在下面添加查询。以下查询将获取<strong class="ih hj">失败插件</strong>的数量</li></ul><pre class="je jf jg jh fd kt ko ku kv aw kw bi"><span id="f471" class="kx ky hi ko b fi kz la l lb lc">jenkins_plugins_failed{}</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ks"><img src="../Images/277b6fb582f88ea59f0c4977be8a03c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VQak2nvuJTP27CEgamNcxg.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Failed Plugins</figcaption></figure><ul class=""><li id="f8c5" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">在“指标浏览器”部分，在下面添加查询。以下查询将获取需要更新的<strong class="ih hj">插件的数量</strong></li></ul><pre class="je jf jg jh fd kt ko ku kv aw kw bi"><span id="3aa5" class="kx ky hi ko b fi kz la l lb lc">jenkins_plugins_withUpdate{}</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ks"><img src="../Images/d76c5d09355ae4cfeb6b41793456ce1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aCr4UI-gLFB5GUiR6evX5g.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Update required Plugins</figcaption></figure><ul class=""><li id="b1f2" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">单击“保存仪表板”按钮保存仪表板，并为其选择一个名称</li><li id="0b40" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">仪表板的最终结果将如下所示:</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ks"><img src="../Images/0fc13b656daec01fdaf62c4ee2b13107.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JE14z4aOKuDqGi8SLggOwg.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Dashboard</figcaption></figure><ul class=""><li id="25e7" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">您可以更改仪表板自动加载的时间频率。在我的例子中，我将它设置为5m。</li><li id="5f3e" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">就是这样。你已经学会了如何使用<strong class="ih hj"> Prometheus </strong>和<strong class="ih hj"> Grafana </strong>监控Jenkins指标。</li></ul><p id="c232" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以通过访问下面的网址来探索更多关于普罗米修斯和T21的信息。</p><ul class=""><li id="6b30" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated"><a class="ae kk" href="https://prometheus.io/docs/introduction/overview/" rel="noopener ugc nofollow" target="_blank">https://prometheus.io/docs/introduction/overview/</a></li><li id="1a30" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated"><a class="ae kk" href="https://grafana.com/" rel="noopener ugc nofollow" target="_blank">https://grafana.com/</a></li></ul><p id="9b2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您发现此指南有帮助，请点击👏按钮，也可以随意发表评论。</p><p id="01a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关注更多类似的故事😊</p></div></div>    
</body>
</html>