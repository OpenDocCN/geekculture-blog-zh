<html>
<head>
<title>Rock-Paper-Scissors Image Classification Using CNN</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于CNN的石头剪子布图像分类</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/rock-paper-scissors-image-classification-using-cnn-eefe4569b415?source=collection_archive---------3-----------------------#2021-05-14">https://medium.com/geekculture/rock-paper-scissors-image-classification-using-cnn-eefe4569b415?source=collection_archive---------3-----------------------#2021-05-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es im"><img src="../Images/19aacf32ba938c3df23bf63320042a33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ae_J9CLW5_vdM1Lh7PXA0g.jpeg"/></div></div></figure><p id="3057" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">这是我第一次在<a class="ae jw" href="https://www.dicoding.com/learningpaths/30" rel="noopener ugc nofollow" target="_blank"> Dicoding Academy </a>学习作为ML开发者学习路径的一部分的图像分类，所以我决定把它贴出来，以便特别为初学者提供一个更好的图像分类的图片。</p><p id="f910" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">您可以在<a class="ae jw" href="https://github.com/Farah-Amalia/Rock-Paper-Scissors-Image-Classification/blob/main/Rock_Paper_Scissors.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上访问完整的代码。</p><h1 id="6cfb" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">了解数据集</h1><p id="1f57" class="pw-post-body-paragraph iy iz hi ja b jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv hb bi translated">数据集由Dicoding Academy提供，可通过此<a class="ae jw" href="https://dicodingacademy.blob.core.windows.net/picodiploma/ml_pemula_academy/rockpaperscissors.zip" rel="noopener ugc nofollow" target="_blank">链接</a>访问。该数据集总共包含2188幅300 x 200像素的图像，对应于石头剪刀布游戏的手势:“石头”(726幅图像)、“布”(710幅图像)和“剪刀”(752幅图像)。以下是从数据集中截取的一些图像:</p><div class="in io ip iq fd ab cb"><figure class="la ir lb lc ld le lf paragraph-image"><img src="../Images/95d50f07094b25121d5e023162467df7.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*P5M1L5RCIS2FNShm-jA9ng.png"/></figure><figure class="la ir lb lc ld le lf paragraph-image"><img src="../Images/cef863c1a04ac1daf4bc5f0883564894.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*7GqSDN0qeFZfK_l8gC5ehA.png"/></figure><figure class="la ir lb lc ld le lf paragraph-image"><img src="../Images/39cceb64113627c556e9598d4a52bdb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*Ute4HP-zN__NjnxZuvZ1-g.png"/></figure></div><h1 id="163a" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">加载数据集</h1><p id="aafa" class="pw-post-body-paragraph iy iz hi ja b jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv hb bi translated">我们将使用wget命令来加载数据集。我们还需要导入我们将在这个项目中使用的库。</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="lg lh l"/></div></figure><h1 id="f002" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">数据预处理</h1><p id="327a" class="pw-post-body-paragraph iy iz hi ja b jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv hb bi translated">首先，我们提取已经下载的文件。</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="d5cf" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">下一步是使用数据扩充来帮助训练过程。数据集非常有组织，所以我们需要添加一些变化。</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="f854" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">根据参数的不同，上面的代码可以生成不同变化的随机图像。下面是对我们刚刚写的内容的解释<a class="ae jw" href="https://blog.keras.io/building-powerful-image-classification-models-using-very-little-data.html" rel="noopener ugc nofollow" target="_blank">【1】</a>:</p><ul class=""><li id="d9c8" class="li lj hi ja b jb jc jf jg jj lk jn ll jr lm jv ln lo lp lq bi translated"><code class="du lr ls lt lu b">rescale</code>是一个值，在进行任何其他处理之前，我们会将数据乘以该值。我们的原始图像包含0-255范围内的RGB系数，但是这样的值对于我们的模型来说太高而无法处理(给定典型的学习率)，因此我们通过以1/255的因子进行缩放来将目标值设置在0和1之间</li><li id="c203" class="li lj hi ja b jb lv jf lw jj lx jn ly jr lz jv ln lo lp lq bi translated"><code class="du lr ls lt lu b">rotation_range</code>以度为单位的值(0-180)，在此范围内随机旋转图片</li><li id="666a" class="li lj hi ja b jb lv jf lw jj lx jn ly jr lz jv ln lo lp lq bi translated"><code class="du lr ls lt lu b">horizontal_flip</code>用于在没有水平不对称假设的情况下，随机翻转一半水平相关的图像(如真实图片)</li><li id="6ac3" class="li lj hi ja b jb lv jf lw jj lx jn ly jr lz jv ln lo lp lq bi translated"><code class="du lr ls lt lu b">shear_range</code>用于随机应用剪切变换</li><li id="467a" class="li lj hi ja b jb lv jf lw jj lx jn ly jr lz jv ln lo lp lq bi translated"><code class="du lr ls lt lu b">fill_mode</code>是用于填充新创建的像素的策略，它可以在旋转或宽度/高度移动后出现</li><li id="2ec6" class="li lj hi ja b jb lv jf lw jj lx jn ly jr lz jv ln lo lp lq bi translated"><code class="du lr ls lt lu b">validation_split</code>是将训练数据集分为训练和验证</li></ul><p id="a438" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">请注意，数据扩充应该只应用于训练数据集，而不是验证数据集。</p><h1 id="e6e1" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">卷积神经网络(CNN)</h1><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es ma"><img src="../Images/92dde12201dd6afc67b9ef98d9b09dfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LaEgAU-vdsR_pClMcgbikQ.jpeg"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">A regular Neural Network representation (<a class="ae jw" href="https://cs231n.github.io/convolutional-networks/" rel="noopener ugc nofollow" target="_blank">source</a>)</figcaption></figure><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es mf"><img src="../Images/28400c16ce139a8b21a8b1765394832d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*1F8wom5X1DeCj5BWeGfJbw.jpeg"/></div><figcaption class="mb mc et er es md me bd b be z dx">CNN representation (<a class="ae jw" href="https://cs231n.github.io/convolutional-networks/" rel="noopener ugc nofollow" target="_blank">source</a>)</figcaption></figure><p id="a2e5" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">卷积神经网络(简称CNN)是图像分类中最流行的技术之一。</p><p id="1578" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">CNN与前一章中的普通神经网络非常相似:它们由具有可学习的权重和偏差的神经元组成。每个神经元接收一些输入，执行点积，并且可选地以非线性跟随它。整个网络仍然表达一个可微分的分数函数:从一端的原始图像像素到另一端的类分数。并且它们在最后(全连接)层上仍然具有损失函数(例如，SVM/软最大),并且我们为学习常规神经网络开发的所有提示/技巧仍然适用。</p><p id="df13" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">不同之处在于，CNN架构明确假设输入是图像，这允许我们将某些属性编码到架构中。这使得转发功能更有效地实现，并极大地减少了网络中的参数数量<a class="ae jw" href="https://cs231n.github.io/convolutional-networks/" rel="noopener ugc nofollow" target="_blank">【2】</a>。</p><h2 id="f242" class="mg jy hi bd jz mh mi mj kd mk ml mm kh jj mn mo kl jn mp mq kp jr mr ms kt mt bi translated">模型构建</h2><p id="2673" class="pw-post-body-paragraph iy iz hi ja b jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv hb bi translated">在我们完成预处理和分割数据集之后，我们就可以开始构建CNN模型了。</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="b351" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">下面是对上述代码的简要解释:</p><ul class=""><li id="db7e" class="li lj hi ja b jb jc jf jg jj lk jn ll jr lm jv ln lo lp lq bi translated">第一层由16个大小为3的过滤器组成，包括大小为100 x 150的输入形状。</li><li id="3303" class="li lj hi ja b jb lv jf lw jj lx jn ly jr lz jv ln lo lp lq bi translated">ReLU(整流线性单元)用于激活功能</li><li id="dcb3" class="li lj hi ja b jb lv jf lw jj lx jn ly jr lz jv ln lo lp lq bi translated">接下来，我们有2 x 2最大池层。最大池是一种技术，通过提供抽象形式的表示<a class="ae jw" href="https://deepai.org/machine-learning-glossary-and-terms/max-pooling" rel="noopener ugc nofollow" target="_blank">【3】</a>来帮助减少过度拟合。</li><li id="327e" class="li lj hi ja b jb lv jf lw jj lx jn ly jr lz jv ln lo lp lq bi translated">速率为0.2的退出技术用于最小化训练网络内的过拟合效应<a class="ae jw" href="https://towardsdatascience.com/understanding-and-implementing-dropout-in-tensorflow-and-keras-a8a3a02c1bfa" rel="noopener" target="_blank">【4】</a>。</li><li id="36d7" class="li lj hi ja b jb lv jf lw jj lx jn ly jr lz jv ln lo lp lq bi translated">随着过滤器32和64数量的增加，重复相同的层</li><li id="f6ee" class="li lj hi ja b jb lv jf lw jj lx jn ly jr lz jv ln lo lp lq bi translated">使用展平层是因为完全连接的层的输入应该是二维的。</li><li id="389b" class="li lj hi ja b jb lv jf lw jj lx jn ly jr lz jv ln lo lp lq bi translated">128个单元的密集隐藏层</li><li id="56b5" class="li lj hi ja b jb lv jf lw jj lx jn ly jr lz jv ln lo lp lq bi translated">最后是输出层，包含3个单元，因为我们有3类输出。该层的激活函数是softmax。</li></ul><h2 id="ee91" class="mg jy hi bd jz mh mi mj kd mk ml mm kh jj mn mo kl jn mp mq kp jr mr ms kt mt bi translated">回调、编译和拟合</h2><p id="6098" class="pw-post-body-paragraph iy iz hi ja b jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv hb bi translated">接下来我们将使用回调，然后编译并拟合我们构建的模型。</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="f1c1" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">回调函数(ReduceLROnPlateau)用于在指标停止改善时降低学习率<a class="ae jw" href="https://keras.io/api/callbacks/reduce_lr_on_plateau/" rel="noopener ugc nofollow" target="_blank">【5】</a>。</p><p id="61fe" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">对于模型编译，我们使用Adam算法，一种基于一阶和二阶矩的自适应估计的随机梯度下降方法<a class="ae jw" href="https://keras.io/api/optimizers/adam/" rel="noopener ugc nofollow" target="_blank">【6】</a>。</p><h2 id="c87e" class="mg jy hi bd jz mh mi mj kd mk ml mm kh jj mn mo kl jn mp mq kp jr mr ms kt mt bi translated">模型评估</h2><p id="7f78" class="pw-post-body-paragraph iy iz hi ja b jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv hb bi translated">现在让我们评价一下我们CNN模型的性能。我创建了一个函数来绘制每个训练和验证数据集的准确度和损失。</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="a59d" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我还创建了一个函数来显示混淆矩阵和分类报告。</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="24a4" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">接下来我们只需要调用函数来显示情节和报告。您可以在下面看到结果:</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="lg lh l"/></div></figure><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es mu"><img src="../Images/56c5e5806a7956e62b7257a9e9dd1e6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LzUaERUSy-CTy9FJHr_q9A.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">Accuracy and Loss Plot</figcaption></figure><p id="796f" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">上述结果表明，对于训练数据集和验证数据集，精度在稳步增加，而损失也在减少。</p><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es mv"><img src="../Images/d6a78a64eec4d4754f0a12e1c3157a27.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*juBPfZUkdWcr9dRVI0I1aQ.png"/></div><figcaption class="mb mc et er es md me bd b be z dx">Confusion Matrix and Classification Report</figcaption></figure><p id="d2b7" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">接下来，我们评估验证数据，我们获得了96%的准确率，这是相当高的。我们可以通过上传新图像来测试它，并让模型预测它是一个纸、石头还是剪刀的手势。这是我创建的预测新图像的函数。</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="lg lh l"/></div></figure><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="lg lh l"/></div></figure><div class="in io ip iq fd ab cb"><figure class="la ir mw lc ld le lf paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><img src="../Images/2ce614dc73527d5cd96572d70ba890e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*rGcS6Vu9o6iDwWlI5i7L3A.png"/></div></figure><figure class="la ir mx lc ld le lf paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><img src="../Images/5328fd96bf77f21e61a2ac247febde4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*EUe_Mcg_8-GxOra8srlAgA.png"/></div></figure><figure class="la ir my lc ld le lf paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><img src="../Images/136e9ebc18d8ead8b37778c04df319cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*TkO87pVgKGyHqF6ePRcoTA.png"/></div></figure></div><p id="3584" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">正如我们所看到的，CNN模型可以正确地将图像预测到它们各自的手势类别。现在，我们还想测试模型的其他手的形象如下所示。</p><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es mz"><img src="../Images/4fa4b7ce9d519201cc1b14e488d5155a.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*aFfx3K2wC9khgese8Rd5rA.png"/></div></figure><p id="b297" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">有趣的是，模型将图像分类为纸张，而事实上，手并不意味着石头、纸张或剪刀的手势。无论如何，模型预测它是纸，因为它看起来更像纸手势。</p><h1 id="87ca" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">结论</h1><p id="9bd1" class="pw-post-body-paragraph iy iz hi ja b jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv hb bi translated">我们的CNN模型能够以96%的准确率检测石头剪刀布手势。在下一篇文章中，我将讲述在相同的数据集上使用ResNet50V2实现迁移学习。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="1d96" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">参考资料:</p><p id="9f51" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">[1]<a class="ae jw" href="https://blog.keras.io/building-powerful-image-classification-models-using-very-little-data.html" rel="noopener ugc nofollow" target="_blank">https://blog . keras . io/building-powerful-image-class ification-models-using-very-little-data . html</a></p><p id="8bef" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">[2]https://cs231n.github.io/convolutional-networks/<a class="ae jw" href="https://cs231n.github.io/convolutional-networks/" rel="noopener ugc nofollow" target="_blank"/></p><p id="cd40" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">[3]<a class="ae jw" href="https://deepai.org/machine-learning-glossary-and-terms/max-pooling" rel="noopener ugc nofollow" target="_blank">https://deepai . org/machine-learning-glossary-and-terms/max-pooling</a></p><p id="ebdc" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">[4]<a class="ae jw" href="https://towardsdatascience.com/understanding-and-implementing-dropout-in-tensorflow-and-keras-a8a3a02c1bfa" rel="noopener" target="_blank">https://towards data science . com/understanding-and-implementing-dropout-in-tensor flow-and-keras-a 8 a3 a 02 C1 BFA</a></p><p id="7455" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated"><a class="ae jw" href="https://keras.io/api/callbacks/reduce_lr_on_plateau/" rel="noopener ugc nofollow" target="_blank">https://keras.io/api/callbacks/reduce_lr_on_plateau/</a></p><p id="fb7c" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated"><a class="ae jw" href="https://keras.io/api/optimizers/adam/" rel="noopener ugc nofollow" target="_blank">https://keras.io/api/optimizers/adam/</a></p></div></div>    
</body>
</html>