<html>
<head>
<title>System Design Solutions: When to use Cassandra and when not to</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">系统设计解决方案:何时使用Cassandra，何时不使用</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/system-design-solutions-when-to-use-cassandra-and-when-not-to-496ba51ef07a?source=collection_archive---------0-----------------------#2022-06-14">https://medium.com/geekculture/system-design-solutions-when-to-use-cassandra-and-when-not-to-496ba51ef07a?source=collection_archive---------0-----------------------#2022-06-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b26b039c388a491662acec075d603340.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QaEKgvFjmM4orDeG3lEpwg.png"/></div></div></figure><h1 id="13e1" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">快速入门:卡珊德拉是什么？</h1><p id="759e" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我想大多数软件工程师都知道卡珊德拉。即使他们不理解它，他们至少在他们的软件工程职业生涯中的某个时候，在某些上下文或某些对话中听说过Cassandra。</p><p id="d633" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">对我来说也是如此，直到我开始使用它一点点，并有机会更深入地探索它。</p><p id="5fbd" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在我开始之前，让我澄清一下，如果你还不知道的话，卡珊德拉有多大。它在Github 上有<a class="ae kr" href="https://github.com/apache/cassandra" rel="noopener ugc nofollow" target="_blank"> 7.3k+颗星，被苹果、</a><a class="ae kr" href="https://www.youtube.com/watch?v=86olupkuLlU" rel="noopener ugc nofollow" target="_blank"> Discord </a>、<a class="ae kr" href="https://www.dataversity.net/case-study-cassandra-meets-call-of-duty/" rel="noopener ugc nofollow" target="_blank">动视</a>、百思买、<a class="ae kr" href="https://netflixtechblog.com/tagged/cassandra" rel="noopener ugc nofollow" target="_blank">网飞</a>等玩家使用。不用说，it <em class="ks">显然</em>有一个它擅长的流行用例。</p><p id="cd3d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">那是什么？</p><p id="ab88" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Cassandra确实好用如果你想在分布式系统中编写和存储大量数据，不要太在意性能好的ACID。这似乎有点宽泛，所以让我简单介绍一下Cassandra是如何工作的。</p><p id="0b3f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Cassandra最受欢迎的特性之一是它可以作为分布式系统运行。</p><p id="cf2f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">但这似乎不是Cassandra和传统RDBMS之间的一个大的区别因素，因为现在大多数数据库都可以在分布式环境中运行。</p><p id="e6d5" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Cassandra和关系数据库的不同之处在于Cassandra在这个分布式系统中的运行和管理是多么的容易。事实上，人们开玩笑说，将其作为单节点系统运行比作为分布式系统运行更困难。分布式是Cassandra的一种内置功能，在单个节点上运行它看起来像是在浪费它的潜力，有点像你在高峰时间在城市交通中使用兰博基尼。</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/cd7e5aa5513dd92e4c56b03d7e0d9d72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ztSSapNs2vBvsN23.jpg"/></div></div></figure><p id="4f2e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Cassandra的另一个受欢迎的特点是它作为一个无主系统运行。大多数传统数据库依赖于主节点和从节点。从节点通常用于复制，主节点用于写入。</p><p id="633f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这通常会增加系统升级的复杂性和难度。当您想要添加更多节点时，您需要决定添加多少主节点和添加多少从节点。添加或删除节点也会给系统带来很多变化。如果一个主节点变得不可用，通常会有一个主节点选举，其中一个新节点成为主节点。</p><p id="71e4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">一个依赖于同质节点而没有主节点和从节点之分的系统看起来要简单得多。</p><p id="c83f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">让我们更深入地研究一下这些特性。</p><h2 id="bc41" class="ky ir hi bd is kz la lb iw lc ld le ja jz lf lg je kd lh li ji kh lj lk jm ll bi translated">无主复制和高可用性</h2><p id="3490" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我想说的第一个是Cassandra最受欢迎的功能之一，即它如何复制。如果你在网上任何地方读到关于卡桑德拉的文章，这可能是你首先听到的。那是什么？你为什么要在乎？</p><p id="b6e6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">传统的SQL数据库以两种方式扩展，第一种是复制或主从架构。这个想法很简单，你添加一个副本数据库，它只保存与你的主数据库相同的数据。这些数据库可能作为不同的进程运行在不同的机器上，甚至在世界的不同角落。</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div class="er es lm"><img src="../Images/8ea355b9430c75a5d6bee31fb5001744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*5fK4ILX5wt1kpf7_7UE9tQ.png"/></div></figure><p id="1da4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">它们使用特定的协议相互通信</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div class="er es lm"><img src="../Images/383318ac35dd3f1fe01721b3bf7a6923.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*0hu2mo4MnVp6wTRYfJNlzw.png"/></div></figure><p id="a07e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">其中之一是<em class="ks">主</em>数据库。这个数据库是唯一可以执行写操作的数据库，其他数据库只是复制这个主数据库保存的数据来为客户端服务。</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/88ea7680604d858d9fa11ceb08e1ad45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*20cZPaznMzXdzqSJsIBrNw.png"/></div></div></figure><p id="f137" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这意味着您有更高的读取能力(由于每个服务器都有自己的内存、CPU和网络带宽),而写入能力没有变化。</p><p id="59ec" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这对大多数应用程序来说是一件好事，因为大多数应用程序倾向于大量读取(想想你读了多少条tweet，写了多少条tweet)。</p><p id="0358" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">另一种选择是拥有多个主数据库或一个主-主或多主数据库。</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/ed7004400ff337f70ac8806bd8c5513a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BRMTarYBr0c7gzsHRHduRA.png"/></div></div></figure><p id="2adf" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这两种解决方案通常都存在巨大的挑战。第一种情况是，有多个副本和一个主数据库，存在单点故障，即主数据库。而且，由于您只有一个主数据库，这也意味着您不能扩展您的写性能。</p><p id="a11d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">添加更多的主节点解决了最后一个问题，但是也带来了更多的挑战。想象一下，如果两个用户同时在不同的主数据库的同一行上编写列<em class="ks">薪水</em>会怎么样！谁来决定哪个数据是正确的！</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/8a7d836e2f21c819ac17fd5d328628ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NADdCvYd-2aSmgzDC9-gwg.png"/></div></div></figure><p id="95a2" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">或者，如果您将一个表存储在一个数据库中，而将另一个表存储在另一个数据库中，您将如何对两个不同数据库中的表执行连接呢？如何在一个服务器的一个表中使用外键来引用另一个数据库中的一个键，甚至可能运行在不同的洲呢？！</p><p id="7515" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">数据库中的分片、分区和复制是一个巨大的主题，我可能在这里过于简化了一些事情，所以我将避免深入探讨。但简而言之，即使添加多个主节点，扩展传统的SQL数据库也很困难。这是因为SQL数据库有复杂严格的要求，比如ACID、验证等。</p><p id="38a1" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">除此之外，关系模型很难将数据分别存储在不同的数据库中，比如不能执行连接和拥有外键。</p><p id="9d2a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">不是说不可能，而是不容易。</p><p id="520c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">那么，卡珊德拉是怎么做到的呢？</p><p id="6689" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">它依赖于一个无主模型。在这个模型中，所有节点的行为实际上都是一样的，每个节点都存储数据的一个子集。没有<em class="ks">主</em>或<em class="ks">从。</em></p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/8e8a38d2d6b82de74a4ff4e8d463c80c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*_LnmT52m2BM-MsnjxYDylg.png"/></div></div></figure><p id="9ed1" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果您要在数据库中插入一个新行，它将至少转到这些节点中的一个，并被复制到一定数量的节点。</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/8a5bb943940304673617c0f8c3a08ef5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L42ldPEJZ_RL9DFuB7kj4w.png"/></div></div></figure><p id="3b0e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">当您请求您的行时，节点<em class="ks">会在彼此之间八卦</em>以找出谁持有该数据并将其返回给您。事实上，所有节点都可以处理对任何数据的请求，即使它们实际上并不持有这些数据。所有这些实际上都是由集群中的数据库节点管理的，不需要我们的干预。集群中的节点是<em class="ks">感知集群的，</em>它们知道自己在分布式环境中运行，并且不断地相互交谈(事实上，它们之间的交谈如此之多，以至于这种交谈被称为<a class="ae kr" href="https://en.wikipedia.org/wiki/Gossip_protocol" rel="noopener ugc nofollow" target="_blank"> <em class="ks">嚼舌根</em> </a>)。</p><p id="816f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Redis也有类似的八卦协议。不久前我也写过关于Redis的文章，我在Redis <a class="ae kr" rel="noopener" href="/geekculture/horizontally-scaling-writes-with-redis-clusters-a77cdcdf6de2">这里</a>写了一整篇关于分片的文章。我也有一个我写的Redis帖子列表，从解释Redis的基础开始，到复制、分片，最后到在AWS上部署一个工作生产级Redis集群<a class="ae kr" rel="noopener" href="/@sanilkhurana7/list/redis-88a4c95150fa">这里</a>。如果你觉得这些帖子有意思，就去看看吧。</p><p id="2c54" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">很快，你就可以看到Cassandra是如何解决我们之前看到的一些问题的。我们不用太担心管理主人和奴隶。整个系统是由同构节点构建的，所以我们只需指定我们想要的节点数量，就可以了。不需要主选举，没有单点故障，并且易于管理和使用。</p><h2 id="a842" class="ky ir hi bd is kz la lb iw lc ld le ja jz lf lg je kd lh li ji kh lj lk jm ll bi translated">缺乏酸支持</h2><p id="7c99" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我们已经讨论了一点，当试图提供强酸支持时，关系数据库在分布式环境中如何遭受损失。让我们更深入地探讨一下。</p><p id="b15a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这种分布式环境中的数据库需要不断地相互交换数据，以获得强酸支持。例如，如果您想要强一致性，那么所有节点应该彼此同步，并且应该总是保存相同的数据。如果您需要添加一个新行或对一个节点进行更新，那么它首先需要等待所有节点进行更新，并且所有节点必须一起进行更新。</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div class="er es lm"><img src="../Images/383318ac35dd3f1fe01721b3bf7a6923.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*0hu2mo4MnVp6wTRYfJNlzw.png"/></div></figure><p id="57fd" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">将数据从一个数据库节点发送到另一个数据库节点可能非常耗时。注意一些节点甚至不在同一个大陆上！</p><p id="07cc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">除此之外，网络是复杂的，并因不可靠而臭名昭著。</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/122a1fa67eb9ee6e2560b324ecd9ea04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RW0KIu_jOGBXZTG9.jpg"/></div></div></figure><p id="556f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">简单地说，这种持续的数据同步和通信在这样一个分布式系统中是不可靠的，尤其是当您每秒钟收到数千个请求时(如果不是更多的话！)而您的数据库彼此相距数万英里。</p><p id="4925" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这实质上就是对酸进行权衡。</p><p id="af32" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">另一方面，卡桑德拉支持弱酸体系。简而言之，它提供了某种程度的原子性、一致性、隔离性和持久性，但不完全是关系数据库能够提供的全套服务。</p><p id="a6f8" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">它提供分区级别的原子性，但是如果写操作在一些节点上成功，而在其他节点上失败，则不提供回滚。此外，根据您如何配置Cassandra，您的集群可能会处于不一致的状态。因此，节点可能对它们持有的数据有不同意见。</p><p id="f5d2" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">简而言之，它对ACID的支持很弱，如果ACID对您很重要，您可能应该重新考虑使用Cassandra。</p><h2 id="9308" class="ky ir hi bd is kz la lb iw lc ld le ja jz lf lg je kd lh li ji kh lj lk jm ll bi translated">可调一致性</h2><p id="293c" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">Cassandra提供了一个可调的一致性模型。在这个模型中，Cassandra允许开发人员选择他们想要的一致性级别。您可以以可用性为代价，在最终一致性或强一致性之间进行选择。</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/37f4a03a46145b8215c40082da831119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/0*ZeHGVdAENcgrgqJe.png"/></div></figure><p id="47f1" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">分布式数据库系统通常分为两类，AP系统最大化可用性而不是一致性，CP系统强调一致性而不是可用性。这里没有正确或错误的系统，它只是取决于什么对您的应用程序重要，一致性或可用性。</p><p id="7069" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Cassandra通常被描述为一个AP系统，它被广泛使用的部分原因是它的高可用性。</p><p id="2a9d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">但是，您可以控制或调整可用性和一致性之间的平衡。正如<a class="ae kr" href="https://en.wikipedia.org/wiki/CAP_theorem" rel="noopener ugc nofollow" target="_blank">上限定理所解释的那样</a>，在任何系统中两者都不可能实现，所以你唯一能做的就是用一个和另一个进行交易。</p><p id="99ef" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">控制一致性的方法是使用一致性级别和复制因子。这些规定了数据复制的次数，在响应返回给用户之前必须有多少节点同步写入数据，以及在读取时必须有多少节点返回数据。</p><p id="566a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">深入解释这是如何工作的将是一个完整的帖子，所以我现在会避免更深入地探讨它，简而言之，Cassandra通常被用作一个最终一致的分布式系统，<em class="ks">但它可以被调整和配置以支持更严格的一致性水平。</em></p><h2 id="69de" class="ky ir hi bd is kz la lb iw lc ld le ja jz lf lg je kd lh li ji kh lj lk jm ll bi translated">高写入性能</h2><p id="5779" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">由于Cassandra群集中通常会有许多节点，并且每个节点都可以执行写操作，因此可以获得良好的写性能。事实上，<a class="ae kr" href="https://netflixtechblog.com/benchmarking-cassandra-scalability-on-aws-over-a-million-writes-per-second-39f45f066c9e" rel="noopener ugc nofollow" target="_blank">这篇网飞的博客文章</a>解释了他们如何测试它每秒一百万次写入而没有变慢的迹象。</p><p id="ec99" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">对于关系数据库中的单主多从体系结构，这种级别的写性能是不可能的。如前所述，使用多主系统会带来复杂性。</p><h2 id="44bf" class="ky ir hi bd is kz la lb iw lc ld le ja jz lf lg je kd lh li ji kh lj lk jm ll bi translated">缺少关系模式</h2><p id="4d8b" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">Cassandra不支持复杂的关系模式。因此，它不支持关系数据库中常见的外部密钥、关系和其他功能。</p><p id="c852" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Cassandra中的表比关系数据库更为赤裸裸。查询也有其独特之处。数据设计也会影响您可以运行的查询及其性能。例如，如果没有资料表的资料分割索引键，就无法(技术上可以，但您<em class="ks">真的</em>不应该)查询资料表。这个分区密钥是Cassandra将用于在多个节点中分发数据的密钥，因此没有分区密钥的查询实际上意味着需要扫描所有节点中的所有行。这似乎不是一件好事，而且对于生产级系统通常是不实际的</p><p id="1367" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在Cassandra中，数据建模有很多细微差别，我现在不会深入探讨，但TLDR的观点是，在开始为数据建模之前，您需要考虑在系统上运行什么查询。</p><h1 id="4f68" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">卡桑德拉能解决什么问题？</h1><h2 id="eb18" class="ky ir hi bd is kz la lb iw lc ld le ja jz lf lg je kd lh li ji kh lj lk jm ll bi translated">单节点系统的资源约束</h2><p id="674b" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如果整个数据库系统运行在单个节点上，则这也意味着它受限于可以连接到单个节点的CPU能力、内存和网络带宽。</p><p id="9cb8" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">不用说，这还不算最佳。数据库是笨重的系统，需要打开大量文件，进行大量读写操作，一般来说都非常繁忙和庞大。如果我将一个数据库拟人化，我可能会想到不可思议先生。</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/ad3e8d76ef4e14d5796a960bef5e303d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*12Vp-qmzXUwIjSOb.jpg"/></div></div></figure><p id="7d1e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这些大家伙只能执行这么多与几吉吉的RAM。</p><p id="b090" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">除此之外，单个节点还意味着单点故障。最终，在某个点上，您的实例将关闭。无论是由于网络分区、运行在实例上的代码中的某个错误，还是AWS造成的混乱。如果你的数据库宕机了，而现在又不是2010年，应用程序可以脱机运行，那么你的应用程序也将宕机，这意味着你的客户/公司无法盈利，意味着你会在周六凌晨2点接到一个电话，打断你宝贵的睡眠。所以简而言之，不要依赖单点失败。</p><p id="e2b7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">单个节点也是非弹性的。大多数应用程序在一天中的某个时间点获得大量流量，而在其他时间点获得很少流量。这意味着，如果你是一家流媒体服务公司的工程师，人们会在上面看节目和电影，那么你在周五晚上的流量很可能会超过周一下午3点的流量。如果您需要一个在周五晚上拥有16千兆内存的节点，那么您可能会在周一浪费掉它。</p><p id="7140" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">不过，如果可以选择较小的多个节点，则可以在需求上升时添加节点，在需求下降时将其删除。</p><h2 id="e5dd" class="ky ir hi bd is kz la lb iw lc ld le ja jz lf lg je kd lh li ji kh lj lk jm ll bi translated">低写入性能</h2><p id="30db" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">说到写作表现，卡桑德拉确实才华横溢。</p><p id="ecd6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">无论系统中的数据大小如何，它的分布式特性以及对对等节点的异步写入都会转化为非常快速的写入。</p><p id="377b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这与大多数数据库系统不同，在大多数数据库系统中，当您向系统中添加更多数据时，写入速度会变慢。这可能是由于许多因素造成的，如锁定或对ACID性能的影响。</p><h2 id="5b4a" class="ky ir hi bd is kz la lb iw lc ld le ja jz lf lg je kd lh li ji kh lj lk jm ll bi translated">非线性标度</h2><p id="8057" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">大多数数据库以非线性方式扩展。这意味着加倍节点并不意味着加倍性能。加倍节点通常意味着<em class="ks">比加倍性能少</em>。</p><p id="0cf2" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">例如，看看下面的图表，</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/960071c43aeca5a2d3a46748ef3535e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v8APJcF_2o-Sc8ytDFUTYg.png"/></div></div></figure><p id="21c9" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果运行两个节点可以获得2个单位的性能，那么运行4个节点可以获得不到4个单位的性能。例如，这里的性能单位可以是每秒请求数。</p><p id="3954" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这是因为传统数据库的性能也取决于它们保存的数据量，而不仅仅是你想做的操作。因此Postgres数据库可能需要为插入一行做大量的工作(比如验证行中的惟一键、确保外部映射、确保强一致性等)。)如果它保存一千万行，而它只保存十行。</p><p id="a142" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这再次归结到关系模型到底有多复杂。在传统数据库中，任何操作都有很大的开销。</p><p id="d030" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">对于卡珊德拉来说，情况并非如此。</p><p id="b068" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">卡珊德拉线性缩放。这意味着将系统中的节点加倍或者将系统中的计算能力加倍将会使系统的性能加倍。</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/29f087a31dd13006c0b5597c6ec61603.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MgYjknCCSz-ojLDQLDRqWA.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx">From this amazing blog post by Netflix that dives deeper into this — <a class="ae kr" href="https://netflixtechblog.com/benchmarking-cassandra-scalability-on-aws-over-a-million-writes-per-second-39f45f066c9e" rel="noopener ugc nofollow" target="_blank">https://netflixtechblog.com/benchmarking-cassandra-scalability-on-aws-over-a-million-writes-per-second-39f45f066c9e</a></figcaption></figure><p id="8c03" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">您可以看到，Cassandra中的每秒写入数与节点数成线性关系。</p><p id="bbf8" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果您认为您的应用程序在未来将获得每秒大量的写入，这是非常棒的。</p><h1 id="629b" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">为什么不应该用Cassandra？</h1><h2 id="a3bc" class="ky ir hi bd is kz la lb iw lc ld le ja jz lf lg je kd lh li ji kh lj lk jm ll bi translated">当您需要大量不同类型的查询或者您无法预测您的数据使用情况时</h2><p id="5c8d" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">虽然卡桑德拉有很多优点，但它远非完美。它有自己的一系列令人头疼的问题。如果没有，我们都会一直用卡珊德拉。</p><p id="6611" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">其中一个令人头疼的问题是它的数据建模。Cassandra中的数据建模并不简单。事实上，受著名的Dynamo论文的启发，许多其他数据库都具有这种特性。简而言之，允许您执行的查询取决于您的数据模型。即使允许您执行查询，其性能也取决于您在决定表的数据模型时所做的决定。</p><p id="0185" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Cassandra中的数据建模是一个复杂的话题，我将留待以后讨论，但是我知道在对数据建模之前，您需要知道您将执行哪些查询<em class="ks">。</em></p><h2 id="a718" class="ky ir hi bd is kz la lb iw lc ld le ja jz lf lg je kd lh li ji kh lj lk jm ll bi translated">当单个节点工作时</h2><p id="408a" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">分布式系统很复杂，通常比单节点系统需要更多的管道。</p><p id="6c8e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">所以，这很简单，如果单节点数据库适合您，那么Cassandra可能不会带来太多好处。</p><p id="c92b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果您只是想要更高的读取性能和能够处理写入的单节点数据库，那么Cassandra可能并不是完美的选择。用一个词来说，Cassandra的真实用例是规模。扩展到数千RPS级别，数百GB RAM级别。</p><p id="82e0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">所以，就像我之前说的，不要在城市交通中使用兰博基尼，你只会浪费汽油。</p><h2 id="178d" class="ky ir hi bd is kz la lb iw lc ld le ja jz lf lg je kd lh li ji kh lj lk jm ll bi translated">当您需要强酸顺应性时</h2><p id="7bab" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">Cassandra(事实上，大多数Dynamo风格的数据库)使用ACID进行权衡。在某种程度上，所有这些都提供了更高的性能和更容易的伸缩性，但是在原子性、一致性和隔离性上有所妥协。</p><p id="4b21" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">说卡珊德拉没有提供任何孤立、一致性或原子性是错误的。比这更微妙一点。为了避免现在就深入研究它，要知道它在某种程度上支持ACID事务，但不像关系数据库那样严格。例如，您将获得分区级别的原子性(尽管没有回滚)，并且如果您真的想要的话，您将获得很强的一致性(但是没有人想使用它，因为您将在可用性上做出很大的妥协)。所以把它想成卡珊德拉支持酸，但条款和条件适用。</p><p id="db47" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果你想要酸性合规，你可能应该看看别的地方。</p><h2 id="fab7" class="ky ir hi bd is kz la lb iw lc ld le ja jz lf lg je kd lh li ji kh lj lk jm ll bi translated">当您需要多对多映射或连接表时</h2><p id="9977" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">Cassandra不支持带有外键和连接表的关系模式。因此，如果您想编写大量复杂的连接查询，那么Cassandra可能不适合您。</p><h2 id="256a" class="ky ir hi bd is kz la lb iw lc ld le ja jz lf lg je kd lh li ji kh lj lk jm ll bi translated">当你不想要一个僵化的模式时</h2><p id="d5ff" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如果您认为表中的单个项目应该是灵活的，并且有不同的列，那么您可能应该看看其他一些数据库，比如像Mongo这样的文档数据库。</p><h1 id="200e" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">结论</h1><p id="7646" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在我看来(可能有争议)，Cassandra不是一个令人愉快的数据库。我更愿意使用Postgres或MySQL或其他能给我一致性保证、良好的事务支持以及更多的东西。然而，对于许多应用程序来说，这些类型的数据库在它们所接受的规模下并不实用。</p><p id="419c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Cassandra和类似的数据库比传统的关系数据库更加简单，但是它们是为规模而构建的。他们为了性能而牺牲了许多特性<em class="ks">，但他们确实提供了性能</em>。</p><p id="e4e9" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我最初将卡珊德拉比作一辆高速超跑的类比在我看来仍然成立。把Postgres想象成劳斯莱斯幻影，这是一辆超级豪华的汽车，它会给你钱所能买到的一切华而不实的东西，但是当你想加大油门，想要绝对原始的性能时，兰博基尼Huracan会轻而易举地击败幻影。</p><p id="5b33" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我在这篇文章中错过的一个话题是Cassandra中的数据建模。Cassandra中的数据建模与我们在传统数据库中的数据建模有很大不同。我想谈很多关于Cassandra是如何鼓励反规范化和复制的，我觉得这很有趣。如果你有兴趣，我鼓励你多研究一下这个。稍后我可能会在另一篇博文中讨论这个问题。</p><p id="7cd6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果你喜欢看这篇文章，请给我一个掌声，并跟随我看更多类似的故事！</p><figure class="ku kv kw kx fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/ffc4b2b1ad131015ed3f9d964b4666da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/0*N1Knnkxc1RahXVOR.jpg"/></div></figure></div></div>    
</body>
</html>