<html>
<head>
<title>Configuring NeoVim for C++ Development on OSX in 2021</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2021年在OSX上为C++开发配置NeoVim</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/configuring-neovim-for-c-development-in-2021-33f86296a8b3?source=collection_archive---------4-----------------------#2021-08-18">https://medium.com/geekculture/configuring-neovim-for-c-development-in-2021-33f86296a8b3?source=collection_archive---------4-----------------------#2021-08-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6220029f6c2a0260c9f1a9635a8b58e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NPB7fNXplFczMlpPPh5BMg.png"/></div></div></figure><p id="beea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在尝试用我喜欢的文本编辑器学习C++时，我遇到了一大堆错误，甚至在编写简单程序时也是如此。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es jo"><img src="../Images/e5e9a2363f7ec44d236f4a38a16d697d.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*shF1e2QLc5jYY7n-PwQ5lA.png"/></div></figure><p id="4a8a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我试图调试和消除这些错误的6个小时里，我在网上遇到了一堆建议和技巧，它们本身并没有多大帮助。这种跨越较新的OSX机器的原因是没有将依赖关系保存在最初的建议被张贴时曾经是通用的目录中，缺乏正确的插件，以及某些路径没有被ZSH或终端正确地识别或使用。在这篇文章中，我想说明我为C++开发正确配置NeoVim所做的一切，并希望它可以帮助你摆脱大量错误或丢失文件和库的压力！</p><h1 id="02a2" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">安装正确的依赖项</h1><p id="d1dd" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">这是我尝试配置此权限的第一个地方。经过多次搜索，我发现<a class="ae kw" href="https://releases.llvm.org/download.html#12.0.1" rel="noopener ugc nofollow" target="_blank"> LLVM </a>是开始的地方(在brew、node和yarn之前，你可能已经有了)。LLVM是模块化编译器的集合，可以帮助C++顺利运行。接下来，我安装并构建了用于C++的服务器<a class="ae kw" href="https://github.com/MaskRay/ccls" rel="noopener ugc nofollow" target="_blank"> CCLS </a>。接下来，<a class="ae kw" href="https://cmake.org/download/" rel="noopener ugc nofollow" target="_blank"> CMake </a>强烈推荐(甚至有一节是编辑器语法文件包括Vim)。据该网站称:“CMake是一个可扩展的开源系统，它在操作系统中以独立于编译器的方式管理构建过程”。我发现这有助于在终端中编译和构建，而不是在本地编译器中。接下来，我安装了<a class="ae kw" href="https://clang.llvm.org/" rel="noopener ugc nofollow" target="_blank"> Clang </a>、<a class="ae kw" href="https://clangd.llvm.org/" rel="noopener ugc nofollow" target="_blank"> Clangd </a>和<a class="ae kw" href="https://gcc.gnu.org/" rel="noopener ugc nofollow" target="_blank"> GCC </a>，它们也有助于澄清语法和编译。</p><h1 id="ec76" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">COC。NVIM和CCLS</h1><p id="bfef" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">接下来，使用通过Vim-Plug安装的<a class="ae kw" href="https://github.com/neoclide/coc.nvim" rel="noopener ugc nofollow" target="_blank"> coc.nvim </a>(完成的征服)，我将所有这些代码添加到我的init.vim:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="8024" class="lc ju hi ky b fi ld le l lf lg">" if hidden is not set, TextEdit might fail.<br/>set hidden</span><span id="3e78" class="lc ju hi ky b fi lh le l lf lg">" Some servers have issues with backup files, see #649<br/>set nobackup<br/>set nowritebackup</span><span id="1262" class="lc ju hi ky b fi lh le l lf lg">" Better display for messages<br/>set cmdheight=2</span><span id="0a0c" class="lc ju hi ky b fi lh le l lf lg">" You will have bad experience for diagnostic messages when it's default 4000.<br/>set updatetime=300</span><span id="4044" class="lc ju hi ky b fi lh le l lf lg">" don't give |ins-completion-menu| messages.<br/>set shortmess+=c</span><span id="2bdd" class="lc ju hi ky b fi lh le l lf lg">" always show signcolumns<br/>set signcolumn=yes</span><span id="299d" class="lc ju hi ky b fi lh le l lf lg">" Use tab for trigger completion with characters ahead and navigate.<br/>" Use command ':verbose imap &lt;tab&gt;' to make sure tab is not mapped by other plugin.<br/>inoremap &lt;silent&gt;&lt;expr&gt; &lt;TAB&gt;<br/>      \ pumvisible() ? "\&lt;C-n&gt;" :<br/>      \ &lt;SID&gt;check_back_space() ? "\&lt;TAB&gt;" :<br/>      \ coc#refresh()<br/>inoremap &lt;expr&gt;&lt;S-TAB&gt; pumvisible() ? "\&lt;C-p&gt;" : "\&lt;C-h&gt;"</span><span id="13b6" class="lc ju hi ky b fi lh le l lf lg">function! s:check_back_space() abort<br/>  let col = col('.') - 1<br/>  return !col || getline('.')[col - 1]  =~# '\s'<br/>endfunction</span><span id="b5f7" class="lc ju hi ky b fi lh le l lf lg">" Use &lt;c-space&gt; to trigger completion.<br/>inoremap &lt;silent&gt;&lt;expr&gt; &lt;c-space&gt; coc#refresh()</span><span id="7c0d" class="lc ju hi ky b fi lh le l lf lg">" Use &lt;cr&gt; to confirm completion, `&lt;C-g&gt;u` means break undo chain at current position.<br/>" Coc only does snippet and additional edit on confirm.<br/>inoremap &lt;expr&gt; &lt;cr&gt; pumvisible() ? "\&lt;C-y&gt;" : "\&lt;C-g&gt;u\&lt;CR&gt;"</span><span id="a0d4" class="lc ju hi ky b fi lh le l lf lg">" Use `[c` and `]c` to navigate diagnostics<br/>nmap &lt;silent&gt; [c &lt;Plug&gt;(coc-diagnostic-prev)<br/>nmap &lt;silent&gt; ]c &lt;Plug&gt;(coc-diagnostic-next)</span><span id="a2ef" class="lc ju hi ky b fi lh le l lf lg">" Remap keys for gotos<br/>nmap &lt;silent&gt; gd &lt;Plug&gt;(coc-definition)<br/>nmap &lt;silent&gt; gy &lt;Plug&gt;(coc-type-definition)<br/>nmap &lt;silent&gt; gi &lt;Plug&gt;(coc-implementation)<br/>nmap &lt;silent&gt; gr &lt;Plug&gt;(coc-references)</span><span id="04c4" class="lc ju hi ky b fi lh le l lf lg">" Use K to show documentation in preview window<br/>nnoremap &lt;silent&gt; K :call &lt;SID&gt;show_documentation()&lt;CR&gt;</span><span id="9f18" class="lc ju hi ky b fi lh le l lf lg">function! s:show_documentation()<br/>  if (index(['vim','help'], &amp;filetype) &gt;= 0)<br/>    execute 'h '.expand('&lt;cword&gt;')<br/>  else<br/>    call CocAction('doHover')<br/>  endif<br/>endfunction</span><span id="2ee7" class="lc ju hi ky b fi lh le l lf lg">" Highlight symbol under cursor on CursorHold<br/>autocmd CursorHold * silent call CocActionAsync('highlight')</span><span id="ac64" class="lc ju hi ky b fi lh le l lf lg">" Remap for rename current word<br/>nmap &lt;leader&gt;rn &lt;Plug&gt;(coc-rename)</span><span id="de17" class="lc ju hi ky b fi lh le l lf lg">" Remap for format selected region<br/>xmap &lt;leader&gt;f  &lt;Plug&gt;(coc-format-selected)<br/>nmap &lt;leader&gt;f  &lt;Plug&gt;(coc-format-selected)</span><span id="3cf3" class="lc ju hi ky b fi lh le l lf lg">augroup mygroup<br/>  autocmd!<br/>  " Setup formatexpr specified filetype(s).<br/>  autocmd FileType typescript,json setl formatexpr=CocAction('formatSelected')<br/>  " Update signature help on jump placeholder<br/>  autocmd User CocJumpPlaceholder call CocActionAsync('showSignatureHelp')<br/>augroup end</span><span id="3000" class="lc ju hi ky b fi lh le l lf lg">" Remap for do codeAction of selected region, ex: `&lt;leader&gt;aap` for current paragraph<br/>xmap &lt;leader&gt;a  &lt;Plug&gt;(coc-codeaction-selected)<br/>nmap &lt;leader&gt;a  &lt;Plug&gt;(coc-codeaction-selected)</span><span id="1b04" class="lc ju hi ky b fi lh le l lf lg">" Remap for do codeAction of current line<br/>nmap &lt;leader&gt;ac  &lt;Plug&gt;(coc-codeaction)<br/>" Fix autofix problem of current line<br/>nmap &lt;leader&gt;qf  &lt;Plug&gt;(coc-fix-current)</span><span id="5fd5" class="lc ju hi ky b fi lh le l lf lg">" Use &lt;tab&gt; for select selections ranges, needs server support, like: coc-tsserver, coc-python<br/>nmap &lt;silent&gt; &lt;TAB&gt; &lt;Plug&gt;(coc-range-select)<br/>xmap &lt;silent&gt; &lt;TAB&gt; &lt;Plug&gt;(coc-range-select)<br/>xmap &lt;silent&gt; &lt;S-TAB&gt; &lt;Plug&gt;(coc-range-select-backword)</span><span id="b013" class="lc ju hi ky b fi lh le l lf lg">" Use `:Format` to format current buffer<br/>command! -nargs=0 Format :call CocAction('format')</span><span id="68fc" class="lc ju hi ky b fi lh le l lf lg">" Use `:Fold` to fold current buffer<br/>command! -nargs=? Fold :call     CocAction('fold', &lt;f-args&gt;)</span><span id="f5b4" class="lc ju hi ky b fi lh le l lf lg">" use `:OR` for organize import of current buffer<br/>command! -nargs=0 OR   :call     CocAction('runCommand', 'editor.action.organizeImport')</span><span id="5172" class="lc ju hi ky b fi lh le l lf lg">" Add status line support, for integration with other plugin, checkout `:h coc-status`<br/>set statusline^=%{coc#status()}%{get(b:,'coc_current_function','')}</span><span id="1b66" class="lc ju hi ky b fi lh le l lf lg">" Using CocList<br/>" Show all diagnostics<br/>nnoremap &lt;silent&gt; &lt;space&gt;a  :&lt;C-u&gt;CocList diagnostics&lt;cr&gt;<br/>" Manage extensions<br/>nnoremap &lt;silent&gt; &lt;space&gt;e  :&lt;C-u&gt;CocList extensions&lt;cr&gt;<br/>" Show commands<br/>nnoremap &lt;silent&gt; &lt;space&gt;c  :&lt;C-u&gt;CocList commands&lt;cr&gt;<br/>" Find symbol of current document<br/>nnoremap &lt;silent&gt; &lt;space&gt;o  :&lt;C-u&gt;CocList outline&lt;cr&gt;<br/>" Search workspace symbols<br/>nnoremap &lt;silent&gt; &lt;space&gt;s  :&lt;C-u&gt;CocList -I symbols&lt;cr&gt;<br/>" Do default action for next item.<br/>nnoremap &lt;silent&gt; &lt;space&gt;j  :&lt;C-u&gt;CocNext&lt;CR&gt;<br/>" Do default action for previous item.<br/>nnoremap &lt;silent&gt; &lt;space&gt;k  :&lt;C-u&gt;CocPrev&lt;CR&gt;<br/>" Resume latest coc list<br/>nnoremap &lt;silent&gt; &lt;space&gt;p  :&lt;C-u&gt;CocListResume&lt;CR&gt;</span></pre><p id="2d52" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">大部分应该被注释，以澄清发生了什么。我在这个网站上找到了这段代码。CoC配置的其余部分可以在NeoVim中通过:CocConfig启动。</p><p id="b102" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">说到这里，有一大段代码需要添加到:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="2524" class="lc ju hi ky b fi ld le l lf lg">{<br/>    <strong class="ky hj">"languageserver"</strong>: {<br/>        <strong class="ky hj">"ccls"</strong>: {<br/>            <strong class="ky hj">"command"</strong>: "ccls",<br/>            <strong class="ky hj">"filetypes"</strong>: [<br/>                "c",<br/>                "cpp",<br/>                "objc",<br/>                "objcpp"<br/>            ],<br/>            <strong class="ky hj">"rootPatterns"</strong>: [<br/>                ".ccls",<br/>                "compile_commands.json",<br/>                ".vim/",<br/>                ".git/",<br/>                ".hg/"<br/>            ],<br/>            <strong class="ky hj">"initializationOptions"</strong>: {<br/>                <strong class="ky hj">"cache"</strong>: {<br/>                    <strong class="ky hj">"directory"</strong>: "/tmp/ccls"<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</span></pre><p id="ba88" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是CCLS服务器的标准配置，除了简单的C++ 之外，它还支持<a class="ae kw" href="https://github.com/neoclide/coc.nvim/wiki/Language-servers" rel="noopener ugc nofollow" target="_blank">许多不同的语言。</a></p><h1 id="252c" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">修复损坏的标题</h1><p id="de5c" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">最终，这是我最需要的，我要感谢<a class="ae kw" href="https://ianding.io/2019/07/29/configure-coc-nvim-for-c-c++-development/" rel="noopener ugc nofollow" target="_blank">伊恩·丁</a>提供了这个解决方案。在较新的OSX机器上不能容易地找到C++头文件的原因是，CCLS服务器将在不再存在的“/usr/include”目录中寻找它们。由于SDK路径没有被硬编码到这个目录中，所以头文件还在中间。要包含C++开发的头文件，请在终端中运行以下命令:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="6a2f" class="lc ju hi ky b fi ld le l lf lg">g++ -E -x c++ - -v &lt; /dev/null</span></pre><p id="5af9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将返回一个你的编译器将从中提取的位置列表。它们将出现在参数“搜索从此处开始”和“搜索列表结束”之间。您需要做的是复制这些路径(或者在tmux中打开一个新的终端窗口进行复制)，并将它们放在根目录下一个名为. ccls的新文件中。这种配置的示例如下:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="eeef" class="lc ju hi ky b fi ld le l lf lg">-isystem<br/>/usr/local/include<br/>-isystem<br/>/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1<br/>-isystem<br/>/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/clang/10.0.1/include<br/>-isystem<br/>/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include<br/>-isystem<br/>/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.14.sdk/usr/include</span></pre><p id="1c6e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这之后，你的。cpp项目应该能够找到标题，错误应该会消失。如果你一直在为在NeoVim中正确配置C++而奋斗，我祈祷这个解决方案对你有用！我花了几乎整整一个周末的时间进行实验，我很高兴摆脱了那场灾难。虽然我意识到可能有几个步骤看起来有些多余(特别是在安装许多冗余包的时候)，但我发现把所有东西都扔向墙壁，看看什么是让这些东西工作的最好方法。如果你有任何问题，请在下面评论。🙏</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es li"><img src="../Images/443e08fcf1edd95a02c8ce7b032056ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*Uocg6hO0bDUI4wgN10hy7g.gif"/></div></figure></div></div>    
</body>
</html>