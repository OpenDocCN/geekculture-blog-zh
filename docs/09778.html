<html>
<head>
<title>Timedeltas, DateOffsets and Periods in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫的时差、时差和周期</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/timestamps-and-date-ranges-in-depth-work-with-special-date-and-time-objects-in-pandas-692ae6ff02d0?source=collection_archive---------7-----------------------#2021-12-28">https://medium.com/geekculture/timestamps-and-date-ranges-in-depth-work-with-special-date-and-time-objects-in-pandas-692ae6ff02d0?source=collection_archive---------7-----------------------#2021-12-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="1da5" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">你应该知道的特殊日期和时间对象。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/2c16a6c956c09b5e3b517fa0faab4349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TTXF4ASEq495hDnGlyae8w.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://pixabay.com/users/geralt-9301/" rel="noopener ugc nofollow" target="_blank">geralt</a> from <a class="ae jn" href="https://pixabay.com/" rel="noopener ugc nofollow" target="_blank">pixabay</a></figcaption></figure><p id="559e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在pandas日期和时间系列的第一部分中，我已经探索了pandas时间系列功能的核心——在本文中，我想看一下更特殊的时间对象，这些对象旨在简化时间戳算法，并满足在数据中标记时间的特殊需要。</p><div class="kk kl ez fb km kn"><a rel="noopener follow" target="_blank" href="/geekculture/working-with-dates-and-time-in-pandas-part-1-timestamps-and-date-ranges-ac87e74878cf"><div class="ko ab dw"><div class="kp ab kq cl cj kr"><h2 class="bd hj fi z dy ks ea eb kt ed ef hh bi translated">深入研究时间戳和日期范围:在Pandas中处理日期和时间</h2><div class="ku l"><h3 class="bd b fi z dy ks ea eb kt ed ef dx translated">深入研究时间戳，它是熊猫日期和时间功能的核心数据对象。</h3></div><div class="kv l"><p class="bd b fp z dy ks ea eb kt ed ef dx translated">medium.com</p></div></div><div class="kw l"><div class="kx l ky kz la kw lb jh kn"/></div></div></a></div><p id="241d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对于本文，我将使用Kaggle的“Twitter上的平坦地球”数据集。</p><p id="b376" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">注意:本文中展示的特性只是Python和Pandas中不同时间对象的所有功能的一小部分——我觉得值得在一篇介绍性的文章中展示这些特性，只是为了体验一下这些对象的强大功能。我不想给人留下这样的印象，即这些是这个话题的极限——无论怎么想象都不会是真的。</p><h2 id="ed65" class="lc ld hi bd le lf lg lh li lj lk ll lm jx ln lo lp kb lq lr ls kf lt lu lv lw bi translated"><strong class="ak">时间差</strong></h2><blockquote class="lx ly lz"><p id="fad8" class="jo jp ma jq b jr js ij jt ju jv im jw mb jy jz ka mc kc kd ke md kg kh ki kj hb bi translated"><em class="hi">时间增量</em>是表示两个时间戳之间的两个时间点之间的差异的对象。</p></blockquote><p id="2cb7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">它可以使用几种不同的度量单位(例如分钟、天)，可以是正数也可以是负数。</p><p id="de76" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">创建<em class="ma">时间增量</em>的一种方法是从另一个时间增量中减去一个时间戳:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es me"><img src="../Images/6168573c2abfcf676b344e789829de9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qPth91g3a42Iscc_"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="20db" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以使用<a class="ae jn" href="https://pandas.pydata.org/docs/reference/api/pandas.Timedelta.html#pandas-timedelta" rel="noopener ugc nofollow" target="_blank"> Pandas构造一个<em class="ma"> Timedelta </em>对象。时间增量</a>。这里您需要指定您想要的时间增量持续时间作为参数。为此，例如，您可以使用字符串作为参数，或者提供整数作为关键字参数(在文档的<a class="ae jn" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timedeltas.html#parsing" rel="noopener ugc nofollow" target="_blank">解析时间增量</a>一节中，您可以找到其他几种方法):</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mf"><img src="../Images/f49049f5d9f9b003fdfc06c2b073d085.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VQwtY9MYPfC0zYZR"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="1081" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果我们想要增加一个特定时间量的<em class="ma">时间戳的</em>值，我们可以使用timedeltas来完成这个操作。假设你不能等到圣诞节，所以你决定将时钟拨快3天:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mg"><img src="../Images/1fa641a683a0b564f7a33eb02ecdefbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A09WqfXU-D9Z3RGF"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="7bf6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">注意:如果你想执行这个操作，你必须在你所在的宇宙中找到一个足够重的物体(黑洞总是一个不错的选择)，它可以帮助你度过等待圣诞老人的这段时间。</p><p id="07ad" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们当然也可以从<em class="ma">时间戳</em>中提取<em class="ma">时间增量</em>，更重要的是，我们可以对整个日期范围进行操作而无需循环:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mh"><img src="../Images/db0314fa3b8b70d2942845860ee54488.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KDCkXvrslTX2fJWr"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="32f5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="ma">时间增量</em>也可以应用于日期时间序列。回到我们的Flat Earth数据，我们可以根据原始用户创建日期轻松创建一个新系列:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/899b32deb763172e863ff56205253ac0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TedIrwBUfTLpVBr2"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="0bcc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">假设我们想知道示例数据帧中的用户是多少天(月、年、秒)前创建的。我们可以使用标记今天和创建日期之差的<em class="ma"> Timedelta </em>对象除以另一个<em class="ma"> Timedelta </em>，其值取决于我们希望看到的度量:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mj"><img src="../Images/7b71414b30203a6623a15d2711fa42d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PNqj-hoNbUu5aZca"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="08b6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Timedelta对象具有访问数据的特定部分或执行进一步操作的属性和方法——所有这些都可以在<a class="ae jn" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timedeltas.html#attributes" rel="noopener ugc nofollow" target="_blank">文档</a>中找到。</p><blockquote class="lx ly lz"><p id="ca35" class="jo jp ma jq b jr js ij jt ju jv im jw mb jy jz ka mc kc kd ke md kg kh ki kj hb bi translated">如果你想让我保持咖啡因创造更多这样的内容，请考虑支持我，只要一杯咖啡。</p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><a href="https://buymeacoffee.com/zoltanguba2"><div class="er es mk"><img src="../Images/42de2d890e13d488021d94ea1a1b9877.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*SMZM9K5hha91xzFtSBS88Q.png"/></div></a></figure><h2 id="f47a" class="lc ld hi bd le lf lg lh li lj lk ll lm jx ln lo lp kb lq lr ls kf lt lu lv lw bi translated"><strong class="ak">日期偏移</strong></h2><p id="d609" class="pw-post-body-paragraph jo jp hi jq b jr ml ij jt ju mm im jw jx mn jz ka kb mo kd ke kf mp kh ki kj hb bi translated"><em class="ma"> DateOffests </em>与<em class="ma"> Timedeltas </em>密切相关，但是工作方式略有不同。这两者背后的不同逻辑是，例如，有时连续两天的午夜之间的差异不是24小时:例如，夏令时可以稍微改变一下。1天<em class="ma">时间增量</em>将始终为时间戳增加24小时，而<em class="ma">日期偏移</em>将时间戳向前移动到第二天以及原始时间戳的确切时间:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mq"><img src="../Images/4136d9831adc7396a3bfa0a6bfa203c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UJYMruCm3Z2itWgq"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="b7ab" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">偏移对象提供了很多机会将时间戳向前或向后移动到某个逻辑时间点，而不是一个固定的时间段。使用平面地球数据，让我们找出离创建用户帐户最近的工作日:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mr"><img src="../Images/5e1c00940fdc7a40b61dd41735c1b30d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gRiCPTQe7YW29SCP"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="4a18" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如您所见，如果一个<em class="ma">时间戳</em>是在营业时间，那么“下一个营业日”<em class="ma">时间戳</em>与原始时间戳相同。在工作时间之外，向前滚动将<em class="ma">时间戳</em>移动到下一个工作日——如果它碰巧在星期六应用，而不是翻转到第二天，偏移将寻找下一个星期一。</p><h2 id="9a65" class="lc ld hi bd le lf lg lh li lj lk ll lm jx ln lo lp kb lq lr ls kf lt lu lv lw bi translated"><strong class="ak">周期</strong></h2><blockquote class="lx ly lz"><p id="b1b4" class="jo jp ma jq b jr js ij jt ju jv im jw mb jy jz ka mc kc kd ke md kg kh ki kj hb bi translated"><em class="hi">周期</em>是时间对象中表示的某个时间段(小时、天、周、月、季度等)。</p></blockquote><p id="a688" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这背后的主要思想是，当一个<em class="ma">时间戳</em>表示某个时刻时，当你的数据被标记为与周期性重现相关联时，使用一个<em class="ma">周期</em>(即使它可能非常高的分辨率，例如它指向某一秒)，该对象与数据链接的时间跨度相关联。</p><p id="1ab8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">销售数据就是一个很好的例子:每次你在商店里卖一个甜甜圈，你就做一个销售记录，销售时间(一个<em class="ma">时间戳</em>)与每笔交易相关联。一天100次购买导致多达100个不同的<em class="ma">时间戳</em>。然而，当你在一天结束时总结你的收入时，你得到的是收入和收入实现的那一天(T4期)的总和。第二天，交易的下100个<em class="ma">时间戳</em>，但是你的每日收入只有1个<em class="ma">周期</em>标记——不需要特定的<em class="ma">时间戳</em>。你每天的<em class="ma">周期</em>也可以总结成每月、每季度和每年的<em class="ma">周期</em>。关键是这些时间段以某种逻辑重新出现，这就是<em class="ma">时间段</em>所捕捉的内容。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ms"><img src="../Images/9d50c2b1882bf5899d34d68945ef76f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AOQ9diYpMYjWZhHq"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="35a9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">很快，时间戳和周期<em class="ma"/>之间似乎没有太大的区别——当我们开始处理与周期<em class="ma"/>相关的算法和方法/属性时，这一点开始变得清晰起来。例如，频率参数在逻辑中起着巨大的作用:当对一个周期进行加减时，频率参数中指定的数量将被相加:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ms"><img src="../Images/d579360a8b23bcb8715554ff3be64fa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IlgogEsqxOdO5g6J"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="3821" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">正如您所看到的，由于在上面的示例中频率设置为3小时，所以加1会增加3小时(=频率的1个单位)。</p><p id="7623" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">创建<em class="ma">周期范围</em>是我认为使用这些对象时的基本用例之一，毕竟在使用这些类型时，重点是要有某种规则的循环:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mt"><img src="../Images/fdb979a4d21f81f6f34abe4a97821a11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pQ9TDDsgD86vghTP"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="359c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="ma"> Periods </em>包含给定的时间跨度，对象可以返回这些时间跨度的开始和结束。创建一个<em class="ma">周期范围</em>，其中频率标记季度，开始和结束日期如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ms"><img src="../Images/f3b385a57644af21087161fa86695a5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uXCYsptEXN4715pP"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure><p id="85fe" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<a class="ae jn" href="https://pandas.pydata.org/docs/reference/api/pandas.Period.html" rel="noopener ugc nofollow" target="_blank">文档</a>中可以找到周期对象中可用的属性和方法的完整列表。</p><p id="466b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="ma">时间戳</em>可以转换为<em class="ma">周期</em>当然(反之亦然):在平地数据集中添加每个用户被创建的季度的开始就像下面一行代码一样简单:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mf"><img src="../Images/17e0a7385ca88f69f8886ead7ad7edc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FaJdIMuZKX1aL9BQ"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Screenshot by Author</figcaption></figure></div><div class="ab cl mu mv gp mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="hb hc hd he hf"><p id="8364" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">熊猫的日期和时间功能有着难以置信的深度。根据这两篇关于这个主题的文章，你可能会发现，很难想象有什么问题是你不能使用现有的内置解决方案来解决的。我希望您已经找到了这2部分系列的教育意义，并且一如既往地鼓励您访问和阅读链接文档以了解更多信息。</p></div></div>    
</body>
</html>