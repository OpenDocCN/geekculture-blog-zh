<html>
<head>
<title>Designing Complex REST API Structure With State Machine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用状态机设计复杂的REST API结构</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/designing-complex-rest-api-structure-with-state-machine-cc2b8804d467?source=collection_archive---------11-----------------------#2021-05-02">https://medium.com/geekculture/designing-complex-rest-api-structure-with-state-machine-cc2b8804d467?source=collection_archive---------11-----------------------#2021-05-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3e26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大多数开发人员使用不同的HTTP方法编写REST API，如GET、POST、PUT、DELETE和HEAD。假设我们有一个微服务，它必须处理不同的状态和转换，因此，它应该构建在一个有限状态机中。基本上，所有需要做的就是定义机器中的所有状态，并描述从一个状态到另一个状态的转换。</p><p id="843e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文是关于通过javascript-state-machine处理REST APIs中不同的状态和转换。</p><p id="81f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">什么是REST API </strong></p><p id="cd13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">REST代表<strong class="ih hj"> RE </strong>表象<strong class="ih hj"> S </strong>状态<strong class="ih hj"> T </strong>转移。</p><blockquote class="jd je jf"><p id="c1ec" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">RESTful API是应用程序<strong class="ih hj">接口</strong> (API)的一种架构风格，它使用HTTP请求来访问和使用数据。该数据可用于获取、放置、发布和删除数据类型，这是指读取、更新、创建和删除与资源相关的操作。</p></blockquote><p id="e1cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">REST API的特性:</p><ol class=""><li id="fe34" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc jp jq jr js bi translated">可量测性</li><li id="3a77" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc jp jq jr js bi translated">灵活性和便携性</li><li id="df56" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc jp jq jr js bi translated">独立性ˌ自立性</li></ol><p id="1f7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">REST API的设计原则:</p><ol class=""><li id="7692" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc jp jq jr js bi translated">统一接口:统一接口让客户机用单一语言与服务器对话，独立于两者的架构后端。</li><li id="18a4" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc jp jq jr js bi translated">客户机-服务器:客户机和服务器的松散耦合，这样它可以单独和独立地发展。</li><li id="af07" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc jp jq jr js bi translated">无状态:REST API调用可以彼此独立进行，它不应该依赖于存储在服务器中的数据。</li><li id="a7c8" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc jp jq jr js bi translated">缓存:为了管理大量的入站和出站调用，设计应该能够处理可缓存的数据。缓存在客户端完成。</li><li id="4077" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc jp jq jr js bi translated">分层系统:几个层一起工作，构建一个层次结构，提供一个更具伸缩性和灵活性的应用程序</li><li id="2729" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc jp jq jr js bi translated">按需编码:它允许代码或applet通过API传输，以便在应用程序中使用。</li></ol><p id="fdc2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">什么是状态机？</p><blockquote class="jd je jf"><p id="148b" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">状态机图模拟了单个<strong class="ih hj">对象</strong>的行为，指定了<strong class="ih hj">对象</strong>在其响应事件的生命周期中经历的事件序列。</p></blockquote><p id="40a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">状态机图包括:</p><ol class=""><li id="ddef" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc jp jq jr js bi translated">州</li><li id="4f2c" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc jp jq jr js bi translated">过渡</li></ol><p id="a279" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设您的服务需要一个专用资源来运行一个特定的应用程序，这个资源可以是一个<a class="ae jy" href="https://www.docker.com/resources/what-container" rel="noopener ugc nofollow" target="_blank"> docker容器</a>。</p><p id="4979" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">资源创建的状态机图:</p><figure class="ka kb kc kd fd ke er es paragraph-image"><div class="er es jz"><img src="../Images/1840941e9b2d21b525f7132f2efb318f.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*JcPNNz5lHMdMhIQeVyqzdQ.png"/></div></figure><p id="4792" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">建筑</strong>:</p><p id="8856" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">各国:</p><ul class=""><li id="ee0e" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc kh jq jr js bi translated">初始化:资源的初始状态</li><li id="0b5f" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">Queued:资源在队列中时的状态</li><li id="c75a" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">已创建:资源已创建</li><li id="35c0" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">正在运行:资源处于运行模式。</li><li id="178f" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">停止:在任何失败的情况下，停止资源</li><li id="fca4" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">已停止:资源已清理</li></ul><p id="6592" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">过渡:</p><ul class=""><li id="7d0f" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc kh jq jr js bi translated">最初，资源处于初始化状态，它可以移动到停止或排队。</li><li id="d327" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">排队后，它可以移动到“已创建”或“已停止”。</li><li id="2553" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">创建后，可能的转换正在运行或已停止。</li><li id="8fc8" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">运行后，可能的转换会在失败时停止。</li></ul><p id="deaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用于处理状态机的npm库:<a class="ae jy" href="https://www.npmjs.com/package/javascript-state-machine" rel="noopener ugc nofollow" target="_blank">JavaScript-状态机</a></p><pre class="ka kb kc kd fd ki kj kk kl aw km bi"><span id="d470" class="kn ko hi kj b fi kp kq l kr ks">const StateMachine = require('javascript-state-machine');<br/><br/>let fsm = new StateMachine({<br/>  init: 'Initializing',<br/>  transitions: [<br/>    {<br/>      name: 'updateState',<br/>      from: '*',<br/>      to: function (n) {<br/>        return n;<br/>      }<br/>    },<br/>    {<br/>      name: 'queue', from: 'Initializing', to: 'Queued'<br/>    },<br/>    {<br/>      name: 'create', from: 'Queued', to: 'Created'<br/>    },<br/>    {<br/>      name: 'start', from: 'Created', to: 'Running'<br/>    },<br/>    {<br/>      name: 'stop', from: ['Created', 'Running'], to: 'Stopping'<br/>    },<br/>    {<br/>      name: 'stopped', from: ['Initializing', 'Queued', 'Stopping'], to: 'Stopped'<br/>    }<br/>  ],<br/>  methods: {<br/>    onStopped: function() { console.log('State transition to Stopped') }<br/>  },<br/>  data: {<br/>    endState: 'Stopped',<br/>  }<br/>});</span></pre><p id="9c9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">生命周期事件:每当发生任何转换时跟踪一个动作。</p><ul class=""><li id="4271" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc kh jq jr js bi translated">onBeforeTransition</li><li id="a611" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">onAfterTransition</li><li id="7a5d" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">过渡</li><li id="c466" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">单一状态</li><li id="b36d" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">onLeaveState</li></ul><p id="e1a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">助手方法:</p><ul class=""><li id="35ea" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc kh jq jr js bi translated">is(state):如果状态为当前状态，则返回true</li><li id="0339" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">can(t):如果转换t可能，则返回true</li><li id="b77c" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">transitions():当前状态的可能转换</li></ul><p id="9d7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GitHub repo上的完整代码:<a class="ae jy" href="https://github.com/maranranu/state-machine" rel="noopener ugc nofollow" target="_blank">状态机</a></p><h1 id="e6ef" class="kt ko hi bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">总结:</h1><ul class=""><li id="0315" class="jk jl hi ih b ii lq im lr iq ls iu lt iy lu jc kh jq jr js bi translated">理解REST API</li><li id="a2c6" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">REST API的特性</li><li id="70ca" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">状态机理解</li><li id="f690" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">资源处理状态机图</li><li id="2045" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kh jq jr js bi translated">Javascript状态机库及其方法</li></ul><h1 id="33b0" class="kt ko hi bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">来源:</h1><div class="lv lw ez fb lx ly"><a href="https://restfulapi.net/" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab dw"><div class="ma ab mb cl cj mc"><h2 class="bd hj fi z dy md ea eb me ed ef hh bi translated">REST API教程</h2><div class="mf l"><h3 class="bd b fi z dy md ea eb me ed ef dx translated">REST是表述性状态转移的首字母缩写。它是分布式超媒体系统的一种架构风格，并且…</h3></div><div class="mg l"><p class="bd b fp z dy md ea eb me ed ef dx translated">restfulapi.net</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm kf ly"/></div></div></a></div><div class="lv lw ez fb lx ly"><a href="https://www.npmjs.com/package/javascript-state-machine" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab dw"><div class="ma ab mb cl cj mc"><h2 class="bd hj fi z dy md ea eb me ed ef hh bi translated">javascript状态机</h2><div class="mf l"><h3 class="bd b fi z dy md ea eb me ed ef dx translated">有限状态机库。3.0版是对早期版本的重大改写。现有2.x用户…</h3></div><div class="mg l"><p class="bd b fp z dy md ea eb me ed ef dx translated">www.npmjs.com</p></div></div><div class="mh l"><div class="mn l mj mk ml mh mm kf ly"/></div></div></a></div></div></div>    
</body>
</html>