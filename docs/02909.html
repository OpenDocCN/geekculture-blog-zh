<html>
<head>
<title>Deploy Your Machine Learning Model with Flask or Voila</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Flask部署你的机器学习模型</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/deploy-your-machine-learning-model-with-flask-or-voila-c74a07921604?source=collection_archive---------35-----------------------#2021-05-27">https://medium.com/geekculture/deploy-your-machine-learning-model-with-flask-or-voila-c74a07921604?source=collection_archive---------35-----------------------#2021-05-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2d2f4e4967f673a71b9afb3d3bb8d27b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cHZp157hEzXqZODzGmNtFw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@nate_dumlao?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Nathan Dumlao</a> on <a class="ae iu" href="https://unsplash.com/s/photos/college?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0592" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您从未有机会在安全的环境中尝试，数据科学模型部署听起来可能会令人生畏。你想做一个REST API，还是一个全前端的app？做这些需要什么？这并没有你想象的那么难！</p><p id="abcb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">今天我们将介绍如何将模型部署到webapp(使用<a class="ae iu" href="https://www.saturncloud.io/" rel="noopener ugc nofollow" target="_blank"> Saturn Cloud </a>)，以便其他人可以与之交互。在这个应用程序中，我们将让用户做出一些功能选择，然后模型将预测他们的结果。但是使用同样的想法，您可以很容易地做其他事情，比如让用户重新训练模型，上传图像之类的东西，或者与您的模型进行其他交互。</p><blockquote class="jt ju jv"><p id="8c2c" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated">声明:我是Saturn Cloud的一名高级数据科学家，Saturn Cloud是一个支持使用Dask对Python进行简单并行化和扩展的平台。如果你想了解更多关于土星云的信息，请登陆<a class="ae iu" href="https://www.saturncloud.io/" rel="noopener ugc nofollow" target="_blank">网站www.saturncloud.io </a>访问我们。</p></blockquote><p id="ace7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有趣的是，我们将用两个框架来做同样的项目，Voila和Flask，所以你可以看到它们是如何工作的，并决定哪一个适合你的需要。在Flask中，我们将创建一个REST API和一个web UI版本。</p><p id="c498" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们今天的工具包:</p><ul class=""><li id="9de1" class="ka kb hi ix b iy iz jc jd jg kc jk kd jo ke js kf kg kh ki bi translated"><a class="ae iu" href="https://www.saturncloud.io/" rel="noopener ugc nofollow" target="_blank">土星云</a>(这样你就可以轻松部署了！)</li><li id="a47b" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated"><a class="ae iu" href="https://flask.palletsprojects.com/en/2.0.x/" rel="noopener ugc nofollow" target="_blank">烧瓶</a></li><li id="b5ea" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated"><a class="ae iu" href="https://voila.readthedocs.io/en/stable/index.html" rel="noopener ugc nofollow" target="_blank">瞧吧</a></li><li id="32c0" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated"><a class="ae iu" href="https://plotly.com/" rel="noopener ugc nofollow" target="_blank">情节性</a> (python和JS)</li><li id="ef19" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated"><a class="ae iu" href="https://scikit-learn.org/stable/index.html" rel="noopener ugc nofollow" target="_blank"> Scikit-learn </a>(针对我们的车型)</li></ul><h1 id="1ff9" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">其他有用的链接</h1><ul class=""><li id="b81e" class="ka kb hi ix b iy lm jc ln jg lo jk lp jo lq js kf kg kh ki bi translated"><a class="ae iu" href="https://ipywidgets.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> ipywidgets </a>(对Voila有帮助)</li><li id="4f11" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated"><a class="ae iu" href="https://collegescorecard.ed.gov/assets/FieldOfStudyDataDocumentation.pdf" rel="noopener ugc nofollow" target="_blank">数据集的码本</a></li><li id="853c" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated"><a class="ae iu" href="https://images.plot.ly/plotly-documentation/images/plotly_js_cheat_sheet.pdf?_ga=2.249711556.332176051.1622039680-1660549259.1622039680" rel="noopener ugc nofollow" target="_blank"> plotly.js备忘单</a></li><li id="c61f" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated"><a class="ae iu" href="https://jinja.palletsprojects.com/en/3.0.x/" rel="noopener ugc nofollow" target="_blank">金贾</a>(有助于烧瓶)</li></ul></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><h1 id="07bd" class="ko kp hi bd kq kr ly kt ku kv lz kx ky kz ma lb lc ld mb lf lg lh mc lj lk ll bi translated">该项目</h1><p id="09dc" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">无论是Voila还是Flask，我们流程的第一步都是完全相同的。我们需要获取一些数据并建立一个模型！我将利用美国教育部的大学记分卡数据，建立一个快速线性回归模型，该模型接受一些输入，并预测学生毕业两年后的可能收入。(你可以在<a class="ae iu" href="https://collegescorecard.ed.gov/data/" rel="noopener ugc nofollow" target="_blank">https://collegescorecard.ed.gov/data/</a>亲自获取这些数据)</p><h2 id="98d8" class="mg kp hi bd kq mh mi mj ku mk ml mm ky jg mn mo lc jk mp mq lg jo mr ms lk mt bi translated"><strong class="ak">关于三围</strong></h2><ul class=""><li id="ef4a" class="ka kb hi ix b iy lm jc ln jg lo jk lp jo lq js kf kg kh ki bi translated">接受收入指标评估的毕业生群体包括那些接受联邦财政资助的人，但不包括那些随后在测量年度入学的人、在测量年度结束前死亡的人、获得比测量的研究领域证书级别更高的证书的人或在测量年度没有工作的人。</li></ul></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><h1 id="b87b" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">加载数据</h1><p id="173c" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">我已经做了一些数据清理工作，并把我想要的功能上传到了S3的一个公共存储桶中，以便于访问。这样，当应用程序运行时，我可以快速加载它。</p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><h1 id="5085" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">培训形式</h1><p id="fcd8" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">一旦我们有了数据集，这将为我们提供一些特征和我们的结果。我们只需要用scikit将它分为特性和目标——学会准备建模。(请注意，所有这些功能将完全按照我们每个应用程序中编写的那样运行。)</p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="a7c5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的特点是:</p><ul class=""><li id="b687" class="ka kb hi ix b iy iz jc jd jg kc jk kd jo ke js kf kg kh ki bi translated">区域:学院的地理位置</li><li id="388d" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">地区:学校所在的城市或城镇的类型</li><li id="e8a7" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">控制:学院类型(公立/私立/营利性)</li><li id="4142" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">CIPDESC_new:主要研究领域(CIP代码)</li><li id="c58e" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">证书(学士、硕士等)</li><li id="7a2b" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">ADM_RATE_ALL:接纳率</li><li id="3c44" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">SAT_AVG_ALL:被录取学生的平均SAT分数(代表大学声望)</li><li id="78b1" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">学费:就读该机构一年的费用</li></ul><p id="318f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的目标结果是EARN_MDN_HI_2YR:完成学位两年后测量的收入中位数。</p><h1 id="8715" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">火车模型</h1><p id="f194" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">我们将使用scikit-learn的管道使我们的特征工程尽可能简单快捷。我们将返回一个经过训练的模型以及测试样本的R平方值，这样我们就可以在测试集上快速而直接地测量模型的性能，并可以与模型对象一起返回。</p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="19e4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们有了一个模型，我们准备把应用程序放在一起！所有这些函数都会在app运行的时候运行，因为速度太快了，保存一个要加载的模型对象是没有意义的。如果你的模型没有训练得这么快，保存你的模型对象，当你需要预测的时候在你的应用中返回。</p></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><h1 id="3972" class="ko kp hi bd kq kr ly kt ku kv lz kx ky kz ma lb lc ld mb lf lg lh mc lj lk ll bi translated">形象化</h1><p id="4e8f" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">除了建立模型和创建预测，我们希望我们的应用程序显示一个相关分布预测的视觉效果。两个应用程序可以使用相同的绘图功能，因为我们正在使用Plotly进行工作。</p><p id="a82f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面的函数接受学位和专业的类型，以生成分布以及模型给出的预测。这样，观众就可以看到他们的预测和其他人的相比如何。稍后，我们将看到不同的应用程序框架如何使用Plotly对象。</p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="c3b9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是我们将生成的一般视觉效果——但是因为它很有情节性，所以它将是交互式的！</p><figure class="mu mv mw mx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es na"><img src="../Images/dd9247bdac4efda4b711b8e518ef3922.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pD4T9mLSoDhiDqldoAnyNQ.png"/></div></div></figure><p id="01ca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可能想知道您最喜欢的其他可视化库是否可以在这里工作——答案是，可能！每个python viz库都有自己的特点，并且不太可能对Voila和Flask提供完全相同的支持。我选择plotly是因为它具有交互性，并且在两个框架中都有完整的功能，但是欢迎您尝试自己的可视化工具，看看效果如何！</p></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><h1 id="0c1e" class="ko kp hi bd kq kr ly kt ku kv lz kx ky kz ma lb lc ld mb lf lg lh mc lj lk ll bi translated">瞧</h1><p id="9e9d" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">现在我们准备开始构建我们的Voila应用程序。瞧，这完全包含在一个Jupyter笔记本中，所以你需要启动一个新的笔记本，并添加我们上面写的所有功能。您不需要任何其他文件类型或框架，您可以在一个Jupyter笔记本中完成所有工作！</p><p id="3421" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以继续添加一个包含建模函数调用的块，这样我们就准备好了数据。</p><pre class="mu mv mw mx fd nb nc nd ne aw nf bi"><span id="98d3" class="mg kp hi nc b fi ng nh l ni nj">df = load_data() <br/>X, y = split_data(df) <br/>modobj, modscore = trainmodel(X, y)</span></pre><p id="d513" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这样，我们就有了原始数据、模型对象和R平方值。</p><p id="1b0e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我们开始构建小部件——这是您的查看者选择填充预测的方式。在一个或多个块中，为用户可能想要的每个输入添加一个小部件——这里有一个例子。这些可以引用您已经在笔记本中创建的项目—正如我们在这里所做的，这可能意味着使用数据集中的数据来填充选择器。(按照您希望的方式进行排序，因为小部件不会对列表进行重新排序。)</p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="d4e8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当您创建了所有的小部件并且应用程序运行时，您的输入选择器将看起来像这样。</p><figure class="mu mv mw mx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nk"><img src="../Images/7909b18393a594a7c475194b2affcda5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VSHh9I-zSvyIz7TmJ0MkFw.png"/></div></div></figure><h1 id="5047" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">创建渲染函数</h1><p id="a63e" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">下一个任务是将所有这些与监听用户输入的功能放在一起，并完成一项任务——对我们来说，这就是预测盈利价值。</p><p id="d2e5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以编写一个或多个这样的函数，但关键是您如何在<code class="du nl nm nn nc b">interactive_output</code>包装器中调用它们。</p><p id="3403" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个函数监听所有的输入部件，当其中任何一个部件发生变化时，它就会运行。它接受所有用户输入，并将它们形成一个数据帧，该数据帧的形状适合模型对象。它在该数据帧上进行预测，然后使用f字符串创建一个HTML块。然后它调用我们的绘图函数，如前所述。它显示HTML和情节在一起，这是我们将在应用程序上看到的。</p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="0e7f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，回想一下我提到过我们需要称它为<code class="du nl nm nn nc b">interactive_output</code>。如果我们不这样做，Voila就不知道我们打算让它监听输入并运行。但是这是一个简单的任务，只需要一个调用，如下所示。它调用这个函数，并传递一个包含作为键的参数和作为值的小部件名称的dict。</p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="308d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这一点上，我们已经准备好做我们的页面布局。如果你愿意，你当然可以添加许多其他的设计元素，并以HTML或其他小部件的形式传递它们。</p><h1 id="241a" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">页面布局</h1><p id="1898" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">为了做我们的布局，我使用了Voila的网格元素——但是有许多方法可以安排Voila应用程序，这里没有显示。正如你可能猜到的，VBox的意思是垂直的盒子，HBox的意思是水平的盒子，这些就是我正在使用的容器。</p><p id="645a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我的垂直盒子叫做<code class="du nl nm nn nc b">vb</code>，它保存了我所有的小部件供用户交互。我的水平框将位于它的下面，叫做<code class="du nl nm nn nc b">hb</code>，它包含了之前创建的<code class="du nl nm nn nc b">out2</code>交互小部件。这里的“孩子”只是指放在每个盒子里的物品。您可以在这里操作这些框的一些布局元素。</p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="05cb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下一件事，我想做的是创建我的实际网格。我正在制作我的网格<code class="du nl nm nn nc b">gb</code>，它包含了两个对象<code class="du nl nm nn nc b">vb</code>和<code class="du nl nm nn nc b">hb</code>。网格跨越80%的页面宽度，形状为2x2。每个柱的宽度是网格的一半，并描述了网格模板。网格样式可能很难，但是有一个很棒的图表教程可以帮助你:<a class="ae iu" href="https://ipywidgets.readthedocs.io/en/latest/examples/Widget%20Styling.html" rel="noopener ugc nofollow" target="_blank">https://ipywidgets.readthedocs.io/en/latest/examples/Widget·Styling.html</a></p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="886a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您已经准备好运行您的应用程序。运行这个程序块，你的应用程序就会出现在你的笔记本页面上！</p><pre class="mu mv mw mx fd nb nc nd ne aw nf bi"><span id="6778" class="mg kp hi nc b fi ng nh l ni nj">display(gb)<!-- --> </span></pre><figure class="mu mv mw mx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es no"><img src="../Images/f10727b6eae6688939d94482f2aa79d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bbPiQ8HCEcBoNvVbuHAvnQ.png"/></div></div></figure><p id="6ed7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这很好，但是这不是我们想要的最终产品。使用Saturn Cloud，将此笔记本部署给其他用户是一项简单的任务。</p><h1 id="5464" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">部署</h1><p id="78bd" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">确保您的代码在您可以访问的Github repo中。转到您选择的Saturn Cloud项目，并将该repo连接到您的项目。(<a class="ae iu" href="https://www.saturncloud.io/docs/using-saturn-cloud/gitrepo/" rel="noopener ugc nofollow" target="_blank">https://www.saturncloud.io/docs/using-saturn-cloud/gitrepo/</a>)这是您的部署将如何找到代码。</p><p id="acf7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后返回土星云UI，<a class="ae iu" href="https://www.saturncloud.io/docs/getting-started/start_project/" rel="noopener ugc nofollow" target="_blank">打开一个项目</a>。在项目页面中，进入<a class="ae iu" href="https://www.saturncloud.io/docs/using-saturn-cloud/jobs_and_deployments/" rel="noopener ugc nofollow" target="_blank">到部署</a>。您有机会在这里自定义很多，但最重要的部分是命令—这需要使用主机0.0.0.0和端口8000才能在Saturn Cloud上正确运行。如果您在笔记本电脑上本地运行Voila，您可能会使用相同的命令，只需确保端口和主机是正确的。代码的路径很可能以<code class="du nl nm nn nc b">../git-repos/</code>开始，然后是你附加的repo中文件的路径。</p><figure class="mu mv mw mx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es np"><img src="../Images/15255c89d785d5435017e3b9747bb80b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JIynwe75XhwrS16VQtr5mA.png"/></div></div></figure><p id="1f18" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于这个项目，除了您应该确保在<strong class="ix hj"> Extra Packages </strong>部分中您注意到plotly是必需的之外，没有太多其他内容需要更改。</p><figure class="mu mv mw mx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nq"><img src="../Images/dcea81952755ec13cfd842d47cd8fca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UIFFsXMkrA9A0SQLkNruaw.png"/></div></div></figure><p id="b671" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，保存您的部署并点击绿色的开始箭头！启动需要一些时间，然后该部署的URL将显示您的交互式应用程序。我的有一些额外的文本元素来解释应用程序，你也可以在你的应用程序中写这种东西。</p><figure class="mu mv mw mx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nr"><img src="../Images/81f537f08d1207d016f5ca7d92fbac21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7AxuZGn4LDkRHpKF3_o-nQ.png"/></div></div></figure><figure class="mu mv mw mx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ns"><img src="../Images/00396b522f461aad543eef63d2d46072.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BotOREPWv24UYSAYfHeFsw.png"/></div></div></figure></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><h1 id="af32" class="ko kp hi bd kq kr ly kt ku kv lz kx ky kz ma lb lc ld mb lf lg lh mc lj lk ll bi translated">瓶</h1><p id="1766" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">在Flask中，我们不会使用Jupyter，但是有更多的灵活性和可能性——特别是如果你开始集成额外的前端框架。对于这个项目，我们有两种选择:</p><ul class=""><li id="1ae2" class="ka kb hi ix b iy iz jc jd jg kc jk kd jo ke js kf kg kh ki bi translated">一个裸REST API</li><li id="9eef" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">一个webapp(显示一个界面，就像我们之前用Voila制作的一样)</li></ul><p id="0cdd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们选择webapp，我们将使用Python、HTML、CSS和一些Javascript进行开发。这听起来可能很多，但并没有乍看起来那么复杂。在API的例子中，你可以避免很多前端设计，但是一些帮助你的用户掌握事情的诀窍仍然是可取的。</p><h1 id="b400" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">应用程序脚本</h1><p id="f066" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">就像Voila一样，我们想把我们写的函数放到一个脚本中——而不是<code class="du nl nm nn nc b">.ipynb</code>,这将只是<code class="du nl nm nn nc b">.py</code>。我们的大部分工作可以包含在这个Python脚本中，为了方便起见，我们称之为<code class="du nl nm nn nc b">app.py</code>。这包含了我们上面描述的所有代码，以及一些取决于我们正在构建的端点类型的函数。我还将添加一个额外的函数，它封装了我们所做的所有工作，并在被调用时一起运行。</p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="4a8e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，在我们的脚本中，我们初始化Flask，调用我们的模型函数，并设置好一切。</p><pre class="mu mv mw mx fd nb nc nd ne aw nf bi"><span id="c8de" class="mg kp hi nc b fi ng nh l ni nj">app = Flask(__name__) <br/>modobj, modscore, df = train_model()</span></pre><h1 id="b489" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">索引</h1><p id="ac20" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">不管你的用户是否会在浏览器中使用你的应用程序，为他们创建一个登陆页面可能是件好事，这样他们就有地方获取信息和学习使用你的工具。在<code class="du nl nm nn nc b">app.py</code>脚本中，我们将有一个创建这个登陆页面的函数。</p><p id="d736" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个名为<code class="du nl nm nn nc b">index</code>的函数中，我们的Flask应用程序被指示呈现HTML——这几乎是这个函数所做的全部工作。我们也有一些数据在那里，以帮助渲染器使我们的值选择器正确。(空格的缩写列表。)注意这个函数没有返回——那是因为它的全部目的是生成HTML，仅此而已。</p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="8f11" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以它在生成一些HTML——但是它怎么知道要做什么呢？我们将制作一个设计模板，然后填充我们需要向用户展示的内容。</p><p id="fc0e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">HTML模板需要看起来像什么？可以从最基本的HTML页面大纲开始。Flask使用Jinja模板来填充变量并传递信息，所以您会看到许多用双花括号括起来的项，表示Jinja变量。此外，请注意我们的body标记内的部分，因为这是我们制作的任何页面将填充它们包含的信息的地方。</p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="fd3e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">作为模板的结果，索引HTML页面根本不需要重复HTML包装。它可以像一些HTML描述和我们要求用户选择的字段一样简单。然而，它确实需要包装在下面，所以模板系统知道该做什么。</p><pre class="mu mv mw mx fd nb nc nd ne aw nf bi"><span id="9c16" class="mg kp hi nc b fi ng nh l ni nj">{% extends "design.html" %} {% block content %}<br/>	&lt;! -- our index-specific HTML and form --&gt;<br/>{% endblock %}</span></pre><h1 id="c840" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">交互性</h1><blockquote class="jt ju jv"><p id="29fc" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated">如果您想让用户能够通过UI提交选项，那么在这个页面上添加一个表单和选择器——如果您只是想让用户通过URL参数提交选项，那么您可以跳过这一步。</p></blockquote><p id="2356" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">几乎你在索引页面中做的所有事情都可以是标准的HTML。我的选择器被封装在一个表单中，看起来像这样。注意凭证选择器有几个Jinja变量——这些变量是怎么来的？来自<code class="du nl nm nn nc b">app.py</code>！</p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="c0e4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">根据您的工作需要添加任意数量的选择器，您就可以开始了。</p><h1 id="037d" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">结果</h1><p id="d470" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">我们的下一个任务是将结果返回给用户。我们可以将普通JSON作为REST API(更容易传递给其他应用程序)或UI版本(例如，更容易被业务用户使用)返回。无论我们走哪条路，我们都需要在<code class="du nl nm nn nc b">app.py</code>中的一个函数，它将从输入中产生结果。这个存根可以帮我们做到。它遍历我们所有的输入，检查它们是否出现在URL的参数中，然后根据模型运行我们的预测。</p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><h1 id="ab20" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">REST API</h1><p id="b4c0" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">如果我们没有创建UI端点，那么我们可以将它添加到我们的<code class="du nl nm nn nc b">result</code>函数中来完成脚本。</p><pre class="mu mv mw mx fd nb nc nd ne aw nf bi"><span id="e2bf" class="mg kp hi nc b fi ng nh l ni nj">...<br/>variables['predicted_earn'] = pred_final<br/>    return jsonify(variables)</span></pre><p id="e3cf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就这样吧！当用户访问我们的网页时，他们将提交选项，或者他们可以直接访问我们的URL并以编程方式传递信息。将返回一个JSON结果。(您可以自定义<code class="du nl nm nn nc b">@app.route</code>调用，将其命名为“api”或适合您的类似名称。)</p><h1 id="edfc" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">UI端点</h1><p id="b4c9" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">如果我们需要更吸引人地展示我们的结果，我们可以将输出制作成一个<code class="du nl nm nn nc b">result.html</code>页面。我们已经看到的<code class="du nl nm nn nc b">index.html</code>的模板也可以做到这一点，所以所需的HTML是最少的。为了好玩，我还将向您展示绘图渲染，以便我们可以完全复制Voila功能。</p><p id="4159" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，如果我们想创建一个UI端点，这是<code class="du nl nm nn nc b">app.py</code>的<code class="du nl nm nn nc b">results</code>函数的剩余部分。没有更多的-我们只是创建我们的情节(与Voila相同的功能)，并运行<code class="du nl nm nn nc b">render_template</code>，就像我们用一些不同的参数运行<code class="du nl nm nn nc b">index.html</code>一样。</p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="101b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的<code class="du nl nm nn nc b">results.html</code>代码将接收所有这些内容并显示出来。如果需要，我们还可以传递所有的模型输入，并显示它们，这样用户就可以看到它们提供的所有值——这只是可选的。</p><p id="1ab4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于渲染，所有的结果页面都需要像HTML一样。它使用<code class="du nl nm nn nc b">pred_final</code>和<code class="du nl nm nn nc b">graphJSON</code>打印预测和绘图。当然，我们使用了一点Javascript来打印情节，但是如果您不想深入研究，您可以很容易地省略它。</p><figure class="mu mv mw mx fd ij"><div class="bz dy l di"><div class="my mz l"/></div></figure><h1 id="bf1b" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">部署</h1><p id="6cf0" class="pw-post-body-paragraph iv iw hi ix b iy lm ja jb jc ln je jf jg md ji jj jk me jm jn jo mf jq jr js hb bi translated">现在我们有两个应用:API和Webapp。部署它们实际上是一样的！在我们的<code class="du nl nm nn nc b">app.py</code>脚本中，我们将添加最后一点(不要忘记端口和主机！):</p><pre class="mu mv mw mx fd nb nc nd ne aw nf bi"><span id="3388" class="mg kp hi nc b fi ng nh l ni nj">if __name__ == "__main__":<br/>  app.run(host='0.0.0.0', port=8000)</span></pre><p id="dd79" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这让我们可以使用命令<code class="du nl nm nn nc b">python app.py</code>来运行我们的应用程序。</p><figure class="mu mv mw mx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nt"><img src="../Images/6162e677b2c5c09d5fedecf32d966298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2-KnmVUVsu6ZsyaNX8dYdQ.png"/></div></div></figure><p id="4e62" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的文件结构看起来会像这样(如果我们只是做API的话，去掉results.html。)</p><pre class="mu mv mw mx fd nb nc nd ne aw nf bi"><span id="fd31" class="mg kp hi nc b fi ng nh l ni nj">flask_app/<br/>├── app.py<br/>├── templates/<br/>│   ├── design.html<br/>│   └── index.html<br/>│   └── results.html</span></pre><p id="7418" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是我们所需要的，尽管你当然可以添加更多的CSS或Javascript文件。将所有这些添加到我们之前讨论过的Github存储库中——或者如果需要的话创建一个新的。</p><p id="51ec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们可以像部署Voila应用程序一样部署这个应用程序——即使我们想这样做，也可以在同一个项目中完成！</p><p id="92d9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Saturn Cloud项目已经附加了我们的Github库，但是如果您需要再次执行这个步骤，只需<a class="ae iu" href="https://www.saturncloud.io/docs/using-saturn-cloud/gitrepo" rel="noopener ugc nofollow" target="_blank">查看我们的文档</a>。这是您的部署查找代码的方式。</p><p id="876f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">部署Flask的命令不同于Voila——但是记住地址和端口是相同的。您只是在您的<code class="du nl nm nn nc b">app.py</code>脚本中设置了它，而不是在部署中。</p><figure class="mu mv mw mx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nu"><img src="../Images/145ad009abea73ccca5a2dfefb0c86cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9BaHFsz8seRFClvIQeRCKg.png"/></div></div></figure><p id="1ce1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在你准备好了！保存，单击绿色的开始箭头，您的部署将启动。</p><figure class="mu mv mw mx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nv"><img src="../Images/9409c838750b9ddc01451c1c72531c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CGoiLleJ-88Wq_ldwz45cQ.png"/></div></div></figure><p id="c048" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该表单将接受您的查看者的输入，然后将它们带到您的结果页面。</p><figure class="mu mv mw mx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nw"><img src="../Images/7a88d03ea0fb65e496726497af0c97c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uDu0ZPupGuLHi2_61kubQQ.png"/></div></div></figure><p id="e6d1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<a class="ae iu" href="https://github.com/skirmer/college_scorecard" rel="noopener ugc nofollow" target="_blank">我的Github页面</a>获取更多信息和该项目的完整代码库！</p></div></div>    
</body>
</html>