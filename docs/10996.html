<html>
<head>
<title>yield — Python (Part III)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">yield — Python(第三部分)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/yield-python-part-iii-643b7b240f1f?source=collection_archive---------5-----------------------#2022-02-26">https://medium.com/geekculture/yield-python-part-iii-643b7b240f1f?source=collection_archive---------5-----------------------#2022-02-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/5d58a622d730b12adc12f7034795fe05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*PnOo52jS9FVQdutUZ2T_rw.jpeg"/></div><figcaption class="im in et er es io ip bd b be z dx">Photo by <a class="ae iq" href="https://unsplash.com/@anniespratt?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Annie Spratt</a> on <a class="ae iq" href="https://unsplash.com/s/photos/compost?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d7aa" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">在本文中，我们将看到如何关闭生成器并向生成器抛出异常。如果你想知道什么是生成器，发送值给生成器，你可以分别看<code class="du jp jq jr js b">yield</code>系列的<a class="ae iq" href="https://dkhambu.medium.com/yield-python-part-i-4dbfe914ad2d" rel="noopener">第一部分</a>和<a class="ae iq" href="https://dkhambu.medium.com/yield-python-part-ii-e93abb619a16" rel="noopener">第二部分</a>。</p><p id="4dac" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">让我们举一个使用生成器读取文件的例子:</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div><figcaption class="im in et er es io ip bd b be z dx">generator with call to close() example</figcaption></figure><p id="7fa9" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">输出是:</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="9046" class="kd ke hi js b fi kf kg l kh ki">state after initialization: GEN_CREATED<br/><strong class="js hj">Sonnet 65: Since brass, nor stone, nor earth, nor boundless sea</strong><br/>By William Shakespeare</span><span id="dd0f" class="kd ke hi js b fi kj kg l kh ki">Since brass, nor stone, nor earth, nor boundless sea<br/>But sad mortality o'er-sways their power,</span><span id="fe5e" class="kd ke hi js b fi kj kg l kh ki">state after iterating over 5 lines: GEN_SUSPENDED<br/>closing generator with .close() ...<br/>state after closing the generator: GEN_CLOSED</span></pre><p id="7eb7" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我们看到我们可以使用<code class="du jp jq jr js b">.close()</code>方法关闭发电机。因此，<code class="du jp jq jr js b">.close()</code>方法后发电机的状态为<code class="du jp jq jr js b">GEN_CLOSED</code>。<code class="du jp jq jr js b">GeneratorExit</code>幕后，异常发生器被调用。</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div><figcaption class="im in et er es io ip bd b be z dx">behind the scene of `close()` call in a generator</figcaption></figure><p id="138d" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">输出是:</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="cf4d" class="kd ke hi js b fi kf kg l kh ki">first value: a<br/>closing generator...<br/>Generator close() is called...<br/>cleanup here...</span></pre><p id="d757" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">调用<code class="du jp jq jr js b">close()</code>时Python的期望:</p><p id="bbda" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj"> i) </strong>一个<code class="du jp jq jr js b">GeneratorExit</code>异常冒了出来- &gt;这个异常被Python沉默了</p><p id="c939" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我们在示例1中看到，我们不需要捕获<code class="du jp jq jr js b">GeneratorExit</code>异常。它由Python负责。</p><p id="96ca" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj"> ii) </strong>发电机干净地存在(返回)——&gt;对呼叫者来说，一切工作“正常”</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div><figcaption class="im in et er es io ip bd b be z dx">generator closing without exception example</figcaption></figure><p id="b466" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">输出是:</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="b532" class="kd ke hi js b fi kf kg l kh ki">print all values : [1, 2]<br/>state of generator after getting all value: GEN_CLOSED</span></pre><p id="be26" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">看，在我们通过<code class="du jp jq jr js b">list</code>调用发电机的所有值后，发电机的状态是<code class="du jp jq jr js b">GEN_CLOSED</code>。</p><p id="0187" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj"> iii) </strong>发生器内部出现其他异常- &gt;调用者看到异常</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div><figcaption class="im in et er es io ip bd b be z dx">catching exception that is raised from inside the generator</figcaption></figure><p id="031e" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">运行时，输出为:</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="9658" class="kd ke hi js b fi kf kg l kh ki">z<br/>StopIteration Encountered.<br/>GEN_CLOSED</span></pre><p id="6d25" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">看，当我们试图从耗尽的生成器中获取下一个值时，我们得到了在调用者中捕获的<code class="du jp jq jr js b">StopIteration</code>异常。发生<code class="du jp jq jr js b">StopIteration</code>异常后，发电机关闭。</p><p id="f3d6" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我们还可以使用<code class="du jp jq jr js b">throw()</code>方法向生成器发送异常。</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div><figcaption class="im in et er es io ip bd b be z dx">throw() example in generator</figcaption></figure><p id="5352" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">输出是:</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="c813" class="kd ke hi js b fi kf kg l kh ki">received: hello</span><span id="c5e7" class="kd ke hi js b fi kj kg l kh ki">ValueError exception encountered.<br/>GEN_SUSPENDED</span><span id="81f7" class="kd ke hi js b fi kj kg l kh ki">received: world</span><span id="a1ac" class="kd ke hi js b fi kj kg l kh ki">StopIteration exception encountered.<br/>StopIteration exception caught by a caller<br/>GEN_CLOSED</span></pre><p id="b540" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">看到我们可以<code class="du jp jq jr js b">throw()</code>一个生成器的异常，并且可以在一个生成器中处理它们。如果一个异常不是由生成器处理的，那么这个异常将被冒泡到调用者那里。</p><p id="bc48" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">在本例中，我们向生成器抛出了<code class="du jp jq jr js b">StopIteration</code>异常。如果我们有一个来自生成器的<strong class="it hj"> return </strong>语句，在<code class="du jp jq jr js b">StopIteration</code>被处理后，调用方将会收到<code class="du jp jq jr js b">StopIteration</code>异常，我们已经在调用方处理过了，生成器的状态得到<strong class="it hj">关闭</strong>。</p><p id="98cd" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">如果一个异常被抛出到一个发生器，并且在发生器中被捕获，但是<strong class="it hj">没有</strong> <strong class="it hj">引发</strong>任何异常或者<strong class="it hj">返回</strong>，如示例中抛出的<code class="du jp jq jr js b">ValueError</code>异常所示，发生器的状态将处于<strong class="it hj">暂停</strong>。</p><p id="26cd" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">如果我们从任何类型的异常处理中返回，调用者都会看到<code class="du jp jq jr js b">StopIteration</code>,如下例所示:</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="1959" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">输出是:</p><pre class="jt ju jv jw fd jz js ka kb aw kc bi"><span id="f32b" class="kd ke hi js b fi kf kg l kh ki">received: hello world</span><span id="43bc" class="kd ke hi js b fi kj kg l kh ki">ValueError exception encountered.<br/>StopIteration exception caught by a caller<br/>GEN_CLOSED</span></pre><p id="d0b3" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">总之，有一种<code class="du jp jq jr js b">close()</code>方法可以退出发电机并将发电机置于<code class="du jp jq jr js b">GEN_CLOSED</code>状态。这是由python通过处理<code class="du jp jq jr js b">GeneratorExit</code>异常来完成的，不需要调用者的参与。调用方可以看到生成器引发的任何其他类型的异常。我们也可以向生成器抛出异常。如果生成器返回或引发异常，调用者将会看到它。</p><p id="3e18" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">本文到此为止。我希望这是一个有用的！我的下一篇文章会在<code class="du jp jq jr js b">yield from</code>上！</p><p id="b574" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">感谢您的阅读，再见。</p><p id="2e06" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">灵感:</p><ul class=""><li id="a730" class="kk kl hi it b iu iv iy iz jc km jg kn jk ko jo kp kq kr ks bi translated"><a class="ae iq" href="https://www.udemy.com/course/python-3-deep-dive-part-2/" rel="noopener ugc nofollow" target="_blank">蟒蛇深潜</a></li></ul></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><p id="4725" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">你可以在<a class="ae iq" href="https://www.patreon.com/dkhambu" rel="noopener ugc nofollow" target="_blank"> Patreon </a>上支持我！</p></div></div>    
</body>
</html>