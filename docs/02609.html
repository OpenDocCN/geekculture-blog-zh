<html>
<head>
<title>Context.startForegroundService() Did Not Then Call Service.startForeground(): Solved</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Context.startForegroundService()未调用Service.startForeground():已解决</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/context-startforegroundservice-did-not-then-call-service-startforeground-solved-7640d5ba394a?source=collection_archive---------0-----------------------#2021-05-22">https://medium.com/geekculture/context-startforegroundservice-did-not-then-call-service-startforeground-solved-7640d5ba394a?source=collection_archive---------0-----------------------#2021-05-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/cc49e653acc544bc8d81d7572ef51126.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Gto7dXH-t3G_PZZnowaBA.png"/></div></div></figure><div class=""/><p id="1287" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在过去一年左右的时间里，这个问题一直伴随着我。这次崩溃的原因是</p><p id="0e22" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“如果你的服务在使用命令<code class="du jo jp jq jr b">startForegroundService</code>启动后5秒钟内没有调用<code class="du jo jp jq jr b">startForeground</code>...然后它会产生一个ANR +崩溃。”</p><p id="e0ee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不管我做了什么，包括</p><ol class=""><li id="1e74" class="js jt ht is b it iu ix iy jb ju jf jv jj jw jn jx jy jz ka bi translated">在前台服务的onStartCommand方法的开头添加一个带有通知的<a class="ae kb" href="https://developer.android.com/reference/android/app/Service.html#startForeground(int,%20android.app.Notification)" rel="noopener ugc nofollow" target="_blank"> startForeground() </a>命令。</li><li id="9c1c" class="js jt ht is b it kc ix kd jb ke jf kf jj kg jn jx jy jz ka bi translated">添加<a class="ae kb" href="https://developer.android.com/reference/android/app/Service.html#startForeground(int,%20android.app.Notification)" rel="noopener ugc nofollow" target="_blank"> startForeground() </a>命令，在onCreate方法中通知。</li></ol><p id="514a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">没用。此外，这个问题在测试过程中无法重现，这使得修复变得更加困难。<br/>在我们开始讨论解决方案之前，让我们看看当我们启动前台服务时会发生什么。</p><figure class="ki kj kk kl fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kh"><img src="../Images/00bce8d03eb800a39fe0a2f2284d9567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oH-v8_-wC34MSkBV4qTUfw.png"/></div></div></figure><p id="e7ba" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你刚刚阅读了开发者文档<a class="ae kb" href="https://developer.android.com/guide/components/foreground-services" rel="noopener ugc nofollow" target="_blank">这里的</a>，你就会这么做。</p><pre class="ki kj kk kl fd km jr kn ko aw kp bi"><span id="04b0" class="kq kr ht jr b fi ks kt l ku kv">Before we start discussing the solution, you must be aware of what a bound service is. Read about bound services here<br/><a class="ae kb" href="https://developer.android.com/guide/components/bound-services" rel="noopener ugc nofollow" target="_blank">https://developer.android.com/guide/components/bound-services</a></span></pre><p id="63fc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那么让我们来谈谈解决方案:</p><p id="6e0d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不是作为前台服务启动服务，而是作为后台服务启动服务，绑定到它，然后当您的活动/UI组件中有可用的服务实例时，您可以直接调用服务内部的方法。此时，您可以调用</p><pre class="ki kj kk kl fd km jr kn ko aw kp bi"><span id="34cb" class="kq kr ht jr b fi ks kt l ku kv">Intent intent = new Intent(context, MyService.class);<br/>ContextCompat.<em class="kw">startForegroundService</em>(context, intent);<br/>mService.doForegroundThings();</span></pre><p id="b02f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在服务类中添加一个方法doForeGroundThings()，并在该方法中添加前台通知。<br/>就是这样。现在您有了带有通知的前台服务。<br/>如果您对代码感兴趣，可以看看这个示例应用程序代码</p><div class="hh hi ez fb hj kx"><a href="https://github.com/svvashishtha/ServiceStartExample" rel="noopener  ugc nofollow" target="_blank"><div class="ky ab dw"><div class="kz ab la cl cj lb"><h2 class="bd hu fi z dy lc ea eb ld ed ef hs bi translated">svvashishtha/ServiceStartExample</h2><div class="le l"><h3 class="bd b fi z dy lc ea eb ld ed ef dx translated">展示启动前台服务的优化的一个示例一个与前台服务的使用相关的常见崩溃…</h3></div><div class="lf l"><p class="bd b fp z dy lc ea eb ld ed ef dx translated">github.com</p></div></div><div class="lg l"><div class="lh l li lj lk lg ll hp kx"/></div></div></a></div></div></div>    
</body>
</html>