<html>
<head>
<title>Enhancing Kubeflow with MLFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用MLFlow增强Kubeflow</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/enhancing-kubeflow-with-mlflow-8983373d0cac?source=collection_archive---------0-----------------------#2021-03-06">https://medium.com/geekculture/enhancing-kubeflow-with-mlflow-8983373d0cac?source=collection_archive---------0-----------------------#2021-03-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/45f64f7841c03fc17e601773f701bd50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZG1rC64FW2CfLa9e87qD8w.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">MLFlow and Kubeflow</figcaption></figure><p id="0712" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对机器学习有了解的人都明白，机器学习模型开发不同于传统的软件工程问题。许多工具已经上市，试图解决这个问题。在我们开始之前，看看我以前的一篇关于为什么我们需要MLOps的文章，链接到文章:<a class="ae js" rel="noopener" href="/@wajeehulhassan/ai-is-electricity-and-mlops-is-the-transmission-line-7960e7e8c7fb">https://medium . com/@ wajeehulhassan/ai-is-electricity-and-MLOps-is-the-transmission-line-7960 e7e 8 c7fb</a></p><p id="c0b4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Kubeflow和MLFlow是该领域中两个最著名的工具。Kubeflow和MLFlow都是很好的模型部署工具，而Kubeflow更加丰富，为我们提供了更多的组件。MLFlow可以在本地机器上使用，也可以在Kubernetes集群上使用，但Kubeflow只能在Kubernetes上运行，因为Kubeflow是在考虑部署可扩展的机器学习模型的情况下制作的。我们也可以在Kubernetes上部署MLFlow，但在本文中，我将向您展示如何在Kubeflow上安装MLFlow并增强Kubeflow的功能。</p><p id="f2be" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Kubeflow本身从未打算取代任何机器学习工具，而是旨在创建一个可扩展的环境，其中所有工具可以协同工作，并创建一个顺畅的工作流管道。</p><h1 id="bd96" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">先决条件</h1><ul class=""><li id="3c48" class="kr ks hi iw b ix kt jb ku jf kv jj kw jn kx jr ky kz la lb bi translated">库伯内特斯</li><li id="e3e7" class="kr ks hi iw b ix lc jb ld jf le jj lf jn lg jr ky kz la lb bi translated">库贝弗洛</li><li id="e4d7" class="kr ks hi iw b ix lc jb ld jf le jj lf jn lg jr ky kz la lb bi translated">舵3</li><li id="4566" class="kr ks hi iw b ix lc jb ld jf le jj lf jn lg jr ky kz la lb bi translated">YAML</li><li id="2204" class="kr ks hi iw b ix lc jb ld jf le jj lf jn lg jr ky kz la lb bi translated">MLFlow</li><li id="74fe" class="kr ks hi iw b ix lc jb ld jf le jj lf jn lg jr ky kz la lb bi translated">码头工人</li></ul><p id="347a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">假设你已经有了一个正在运行的Kuberflow或者在云中(GCP，AWS，Azure) </strong>。首先，我们将确保所有的pod都在运行，为此运行命令:<br/><strong class="iw hj">kube CTL get pods-n kube flow</strong></p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/7f0e4f3416ad5aa026d1ad82de24e55a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2MfggYh2hF4Xk3AfXwp_hg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Kubeflow pods, mlflow deployed</figcaption></figure><p id="2205" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你可以看到我机器中的pods大约有2个月了，那是我在Minikube上重新创建Kubeflow集群并在其中安装MLFlow的时候。</p><p id="a240" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您还可以看到，我已经在我的Kubeflow集群上安装了MLFLow，当您安装Kubeflow时，您将不会获得MLFlow pod，因为它没有与Kubeflow打包在一起。</p><h1 id="a2fd" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak"> MLFlow组件:</strong></h1><p id="d669" class="pw-post-body-paragraph iu iv hi iw b ix kt iz ja jb ku jd je jf lm jh ji jj ln jl jm jn lo jp jq jr hb bi translated">MLFlow有三个主要组件:</p><ul class=""><li id="e2df" class="kr ks hi iw b ix iy jb jc jf lp jj lq jn lr jr ky kz la lb bi translated">物流跟踪</li><li id="1922" class="kr ks hi iw b ix lc jb ld jf le jj lf jn lg jr ky kz la lb bi translated">MLFlow项目</li><li id="67b6" class="kr ks hi iw b ix lc jb ld jf le jj lf jn lg jr ky kz la lb bi translated">ml流程模型</li></ul><p id="85ad" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Kubeflow还为我们提供了不同的组件。MLFlow相对来说更容易使用，而Kubeflow为我们提供了企业级的工作流管理，MLFlow在这方面落后于Kubeflow。在本文中，我们将只讨论MLFlow。我们将把Kubeflow留到后面的文章中。</p><p id="554d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">用于在Kubeflow集群上安装MLFlow，这将允许我们从不同的docker容器中写入元数据，并集中查看元数据。MLFlow的主要组件可以在下面的架构图中找到:</p><ul class=""><li id="780d" class="kr ks hi iw b ix iy jb jc jf lp jj lq jn lr jr ky kz la lb bi translated">Minio(预装了Kubeflow)</li><li id="eaf4" class="kr ks hi iw b ix lc jb ld jf le jj lf jn lg jr ky kz la lb bi translated">MLFlow跟踪服务器—(我们将在Kubeflow clulster中安装该组件)</li></ul><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/43ffd6de0db87b940ce86a678bc55080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*AfP9_Aa8WsuDSAw_-34d7w.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Architecture of MLFlow on Kubeflow (Kubernetes) with local backend and minio based artifact storage</figcaption></figure><p id="51a4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们可以以编程方式指定MLFlow日志度量和MLFLow日志参数。我们还可以指定MLFlow日志工件和本地工件存储的位置。</p><h1 id="422a" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">在Kubeflow (Kubernetes)上安装MLFLow跟踪服务器:</strong></h1><p id="9d95" class="pw-post-body-paragraph iu iv hi iw b ix kt iz ja jb ku jd je jf lm jh ji jj ln jl jm jn lo jp jq jr hb bi translated">由于MLFlow默认用于本地机器，因此MLFlow服务器将MLFlow运行存储到本地文件或SQLAlchemy兼容数据库，但在我们的情况下，我们将在Kubeflow集群中安装它，因此我们将使用远程服务器作为后端。</p><p id="6321" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于存储，MLFLow有两个组件:</p><ul class=""><li id="9ebc" class="kr ks hi iw b ix iy jb jc jf lp jj lq jn lr jr ky kz la lb bi translated"><strong class="iw hj">后端存储- </strong> (MLFlow tracking server在后端存储中存储实验和运行元数据以及运行的标记、指标和参数)。后端存储可以存储为文件存储或数据库支持的存储。这里我们将使用docker映像中的文件存储。<strong class="iw hj">注意:</strong>如果容器重启，数据将会丢失。对于更长时间的存储，我们可以使用NFS服务器或数据库。</li><li id="2364" class="kr ks hi iw b ix lc jb ld jf le jj lf jn lg jr ky kz la lb bi translated"><strong class="iw hj">工件存储</strong> —它必须是能够存储更大文件的存储系统，比如可以是云上的存储桶，甚至是NFS文件系统。如果您想使用NFS，您可能需要先配置NFS。按照链接安装和配置NFS<a class="ae js" href="https://www.kubeflow.org/docs/other-guides/kubeflow-on-multinode-cluster/" rel="noopener ugc nofollow" target="_blank">https://www . kube flow . org/docs/other-guides/kube flow-on-multi node-cluster/</a>。在这篇文章中，我们不会使用NFS。</li><li id="ee84" class="kr ks hi iw b ix lc jb ld jf le jj lf jn lg jr ky kz la lb bi translated">Minio与硬件无关，可以使我们的工件存储云独立。对于藏物存储，我们将使用Minio。</li></ul><p id="96e4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们的docker文件应该安装mlflow、awscli、boto3，它应该公开post 5000以便与MLFlow跟踪服务器进行通信。它还应该有不同的环境变量来配置云存储。</p><figure class="li lj lk ll fd ij"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="f4bd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们利用了一个脚本，该脚本将docker容器作为入口点运行。</p><p id="7b0c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">运行脚本将为mlflow创建所需的目录，该目录将用作后端存储，同时我们还将定义用于存储人工制品的s3存储桶。在我们的例子中，s3存储桶是minio存储系统，minio使用的是在安装过程中提供给Kubeflow的存储系统。该脚本在0.0.0.0上运行主机，因此任何ip都可以访问端口5000上的服务器。</p><p id="b260" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，我们将通过运行build.sh脚本来构建docker容器。该构建脚本将构建Dockerfile文件，并将其命名为“lightbend/mlflow:1.0”。</p><p id="7f5d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Dockerfile、run和build脚本可以在Github资源库中找到:<a class="ae js" href="https://github.com/wajeehulhassanvii/mlflow_on_kubeflow" rel="noopener ugc nofollow" target="_blank">https://github.com/wajeehulhassanvii/mlflow_on_kubeflow/</a></p><p id="ad88" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">docker容器启动后。<strong class="iw hj"> </strong>海图可以安装舵。Helm将安装MLFlow部署服务器、将公开MLFlow部署的Kubernetes服务以及将通过Istio入口网关向用户公开MLFlow服务的虚拟服务。</p><p id="c9d7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在终端中运行以下命令，在Kubeflow Kubernetes集群中安装MLFlow helm chart。</p><p id="4f5a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> <em class="lv">舵安装&lt;舵图位置&gt; </em> </strong></p><p id="0597" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">链接到Github库:【https://github.com/wajeehulhassanvii/mlflow_on_kubeflow T4】</p><p id="0d5c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在后面的文章中，我们将更深入地研究MLOps工具。</p></div></div>    
</body>
</html>