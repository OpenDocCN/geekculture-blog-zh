<html>
<head>
<title>Create a GraphQL-powered project management endpoint in Golang and MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Golang和MongoDB中创建一个基于GraphQL的项目管理端点</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/create-a-graphql-powered-project-management-endpoint-in-golang-and-mongodb-98a7a8ca483f?source=collection_archive---------7-----------------------#2022-07-25">https://medium.com/geekculture/create-a-graphql-powered-project-management-endpoint-in-golang-and-mongodb-98a7a8ca483f?source=collection_archive---------7-----------------------#2022-07-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/aca5d479a8dec3e5c789620130b16d0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1KS2XwxW85iYwCzcKa5WMA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">cover</figcaption></figure><p id="89b9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">GraphQL是一种用于读取和操作API数据的查询语言。它通过提供灵活、直观的语法来描述数据，从而优先向客户端或服务器提供准确的数据需求。</p><p id="989e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">与传统的REST API相比，GraphQL提供了一个类型系统来描述数据的模式，从而为API的消费者提供了使用单个端点来探索和请求所需数据的能力。</p><p id="d43a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这篇文章将讨论用Golang使用<a class="ae js" href="https://github.com/99designs/gqlgen" rel="noopener ugc nofollow" target="_blank"> gqlgen </a>库和<a class="ae js" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>构建一个项目管理应用程序。在本教程的最后，我们将学习如何创建一个支持读取和操作项目管理数据的GraphQL端点，并使用MongoDB持久化我们的数据。</p><p id="e61c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">GitHub资源库可以在<a class="ae js" href="https://github.com/Mr-Malomz/project-mngt-golang-graphql-gin" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="6506" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">先决条件</h1><p id="b704" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">要完全掌握本教程中介绍的概念，需要Golang方面的经验。使用MongoDB的经验不是必需的，但是拥有它是很好的。</p><p id="bcba" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们还需要以下物品:</p><ul class=""><li id="507b" class="kw kx hi iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">GraphQL的基础知识</li><li id="433f" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">一个<a class="ae js" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB帐户</a>来托管数据库。<a class="ae js" href="https://www.mongodb.com/cloud/atlas/register" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj">报名</strong> </a> <strong class="iw hj">完全免费</strong></li></ul><h1 id="c699" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">让我们编码</h1><h2 id="67d6" class="lk ju hi bd jv ll lm ln jz lo lp lq kd jf lr ls kh jj lt lu kl jn lv lw kp lx bi translated">入门指南</h2><p id="8265" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">首先，我们需要导航到所需的目录，并在我们的终端中运行下面的命令</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="6b17" class="lk ju hi md b fi mh mi l mj mk">mkdir project-mngt-golang-graphql &amp;&amp; cd project-mngt-golang-graphql</span></pre><p id="17ce" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">该命令创建一个<code class="du ml mm mn md b">project-mngt-golang-graphql</code>文件夹，并导航到项目目录。</p><p id="e678" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们需要通过运行以下命令来初始化Go模块以管理项目依赖关系:</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="1b5f" class="lk ju hi md b fi mh mi l mj mk">go mod init project-mngt-golang-graphql</span></pre><p id="243d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">该命令将创建一个<code class="du ml mm mn md b">go.mod</code>文件，用于跟踪项目依赖关系。</p><p id="16de" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们继续安装所需的依赖项:</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="120c" class="lk ju hi md b fi mh mi l mj mk">go get github.com/99designs/gqlgen go.mongodb.org/mongo-driver/mongo github.com/joho/godotenv</span></pre><p id="20a4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ml mm mn md b">github.com/99designs/gqlgen</code>是一个用于在Go中创建GraphQL应用程序的库。</p><p id="7add" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ml mm mn md b">go.mongodb.org/mongo-driver/mongo</code>是连接MongoDB的驱动。</p><p id="c39c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ml mm mn md b">github.com/joho/godotenv</code>是一个管理环境变量的库。</p><h1 id="4fa1" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">项目初始化</h1><p id="7129" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">gqlgen库使用模式优先的方法；它允许我们使用GraphQL的模式定义语言来定义我们的API。该库还让我们通过生成项目样板文件来关注实现。</p><p id="3455" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要生成项目样板文件，我们需要运行下面的命令:</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="ba67" class="lk ju hi md b fi mh mi l mj mk">go run github.com/99designs/gqlgen init</span></pre><p id="d6b9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的命令会生成以下文件:</p><ul class=""><li id="fad2" class="kw kx hi iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated"><code class="du ml mm mn md b">gqlgen.yml</code>用于配置gqlgen的文件</li><li id="57b7" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><code class="du ml mm mn md b">graph/generated/generated.go</code>包含gqlgen在执行过程中自动生成的所有代码的文件。我们不需要编辑这个文件。</li><li id="1a28" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><code class="du ml mm mn md b">graph/model/models_gen.go</code>包含构建GraphQL所需的生成模型的文件。这个文件也是由gqlgen自动生成的。</li><li id="8e6a" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><code class="du ml mm mn md b">graph/schema.graphqls</code>定义我们的模式的文件。</li><li id="74f7" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><code class="du ml mm mn md b">graph/schema.resolvers.go</code>一个定义我们应用程序逻辑的文件。</li><li id="e52e" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><code class="du ml mm mn md b">server.go</code>这个文件是我们的应用入口点。</li></ul><p id="c427" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">PS:  <em class="mo">我们可能会得到一个关于缺少依赖项的错误。我们可以通过重新安装之前安装的软件包来解决这个问题。</em></p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="f5c4" class="lk ju hi md b fi mh mi l mj mk">go get github.com/99designs/gqlgen go.mongodb.org/mongo-driver/mongo github.com/joho/godotenv</span></pre><h1 id="60cf" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">设置MongoDB</h1><p id="8378" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">完成后，我们需要登录或注册我们的<a class="ae js" rel="noopener ugc nofollow" target="_blank" href="/"> MongoDB </a>账户。点击项目下拉菜单并点击<strong class="iw hj">新建项目</strong>按钮。</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/a8c3496f2b5500b37e2b93d531267917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VdIhsnrxLl6fhN1I.png"/></div></div></figure><p id="3eda" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">输入<code class="du ml mm mn md b">projectMngt</code>作为项目名称，点击下一个<strong class="iw hj">，点击<strong class="iw hj">创建项目。</strong></strong></p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/3d39804183e12bbc0838b8e6328db97b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VlkpZCn5f3eep_o8.png"/></div></div></figure><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/ef8ea4aa1c83a941474a466d516ff415.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0h1pCnLVb3Gub1at.png"/></div></div></figure><p id="2759" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">点击<strong class="iw hj">建立数据库</strong></p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/8078ee686c757414a548d0b7a1540b6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_d9LzhK44DeN4MHy.png"/></div></div></figure><p id="b925" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">选择<strong class="iw hj">共享</strong>作为数据库类型。</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/d88c344ec8de44caa130f9cbd8f81f44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cRmq9nQJ6MuOWR_t.png"/></div></div></figure><p id="0b81" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">点击<strong class="iw hj">创建</strong>来设置集群。这可能需要一些时间来设置。</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/a6f2be1e72661d7cd0387cd04348cb84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YYTdZ8doT8L2e2Zh.png"/></div></div></figure><p id="4ee4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们需要创建一个用户，通过输入<strong class="iw hj">用户名</strong>、<strong class="iw hj">密码</strong>，然后点击<strong class="iw hj">创建用户</strong>，从外部访问数据库。我们还需要添加我们的IP地址，以便通过点击<strong class="iw hj">添加我当前的IP地址</strong>按钮安全地连接到数据库。然后点击<strong class="iw hj">完成并关闭</strong>保存更改。</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/8f1d3dc1b2b02aae780240cd0d9cd419.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LqHWJZsvtgq6jw_X.png"/></div></div></figure><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/d1fefc6346c4400e3f4228d903f03702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MwJWAkEvpK-RyZ2Z.png"/></div></div></figure><p id="328a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">保存更改后，我们应该会看到一个数据库部署屏幕，如下所示:</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/fd08eb4d9bc779bbc90f70288a81f643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*u-kZz8weNVRe7BRu.png"/></div></div></figure><h1 id="f3c5" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">将我们的应用程序连接到MongoDB</h1><p id="19b3" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">配置完成后，我们需要将应用程序与创建的数据库连接起来。为此，点击<strong class="iw hj">连接</strong>按钮</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/ba3f7ff97d3c734a771ae6ac7f755ab9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Bw0IOPVx65-ysb-X.png"/></div></div></figure><p id="c394" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">点击<strong class="iw hj">连接你的应用</strong>，改变<strong class="iw hj">驱动</strong>为<code class="du ml mm mn md b">Go</code>和<strong class="iw hj">版本</strong>，如下图所示。然后点击复制<strong class="iw hj">图标</strong>复制连接字符串。</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/430d530d0c6ac771612699bc007723e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EiMYDtigumB3tmO8.png"/></div></div></figure><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/785a5d094c2cc1ea792bf32c6adf0ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*awDYDYp9iKFhtq4W.png"/></div></div></figure><p id="4bd2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">设置环境变量<br/> </strong>接下来，我们必须用我们之前创建的用户密码修改复制的连接字符串，并更改数据库名称。为此，首先，我们需要在根目录中创建一个<code class="du ml mm mn md b">.env</code>文件，并在该文件中添加以下代码片段:</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="887b" class="lk ju hi md b fi mh mi l mj mk">MONGOURI=mongodb+srv://&lt;YOUR USERNAME HERE&gt;:&lt;YOUR PASSWORD HERE&gt;@cluster0.e5akf.mongodb.net/&lt;DATABASE NAME&gt;?retryWrites=true&amp;w=majority</span></pre><p id="cf85" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下面是正确填充的连接字符串示例:</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="ca5f" class="lk ju hi md b fi mh mi l mj mk">MONGOURI=mongodb+srv://malomz:malomzPassword@cluster0.e5ahghkf.mongodb.net/projectMngt?retryWrites=true&amp;w=majority</span></pre><p id="af69" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">加载环境变量<br/> </strong>完成后，我们需要创建一个助手函数，使用我们之前安装的<code class="du ml mm mn md b">github.com/joho/godotenv</code>库来加载环境变量。为此，我们需要在根目录下创建一个<code class="du ml mm mn md b">configs</code>文件夹；在这里，创建一个<code class="du ml mm mn md b">env.go</code>文件并添加下面的代码片段:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="599d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的代码片段执行了以下操作:</p><ul class=""><li id="ecc5" class="kw kx hi iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">导入所需的依赖项。</li><li id="5971" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个<code class="du ml mm mn md b">EnvMongoURI</code>函数，检查环境变量是否被正确加载并返回环境变量。</li></ul><h1 id="49d5" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">定义我们的模式</h1><p id="b763" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">为此，我们需要导航到<code class="du ml mm mn md b">graph</code>文件夹，并在该文件夹中更新<code class="du ml mm mn md b">schema.graphqls</code>文件，如下所示:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="95b2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的代码片段通过创建两种类型定义了我们的API所需的模式；一个<code class="du ml mm mn md b">Project</code>和一个<code class="du ml mm mn md b">Owner</code>。我们还定义了<code class="du ml mm mn md b">Query</code>来对类型执行操作，<code class="du ml mm mn md b">inputs</code>来定义创建属性，<code class="du ml mm mn md b">Mutation</code>来创建项目和所有者。</p><h1 id="c1b6" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">创建应用程序逻辑</h1><p id="a245" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">接下来，我们需要使用<code class="du ml mm mn md b">gqlgen</code>库为我们新创建的模式生成逻辑。为此，我们需要在终端中运行以下命令:</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="af40" class="lk ju hi md b fi mh mi l mj mk">go run github.com/99designs/gqlgen generate</span></pre><p id="d36f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在运行上面的命令时，我们将得到关于<code class="du ml mm mn md b">schema.resolvers.go</code>文件中缺少<code class="du ml mm mn md b">Todo</code>模型的错误；这是因为我们更改了默认模型。我们可以通过删除<code class="du ml mm mn md b">CreateTodo</code>和<code class="du ml mm mn md b">Todo</code>功能来修复错误。删除后，我们的代码应该类似于下面的代码片段:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="095c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">创建数据库逻辑<br/> </strong>随着GraphQL逻辑的生成，我们需要创建代码对应的数据库逻辑。为此，我们需要导航到<code class="du ml mm mn md b">configs</code>文件夹，在这里，创建一个<code class="du ml mm mn md b">db.go</code>文件并添加下面的代码片段:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="bbc3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的代码片段执行了以下操作:</p><ul class=""><li id="4763" class="kw kx hi iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">导入所需的依赖项</li><li id="57f4" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个带有客户端字段的<code class="du ml mm mn md b">DB</code>结构来访问MongoDB。</li><li id="9e47" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个<code class="du ml mm mn md b">ConnectDB</code>函数，首先配置<code class="du ml mm mn md b">client</code>使用正确的URI并检查错误。其次，我们定义了一个10秒的超时，我们希望在尝试连接时使用。第三，检查连接到数据库时是否有错误，如果连接时间超过10秒，则取消连接。最后，我们pinged数据库来测试我们的连接，并返回一个指向<code class="du ml mm mn md b">DB</code>结构的指针。</li><li id="0099" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个<code class="du ml mm mn md b">colHelper</code>函数来创建一个集合。</li><li id="f83c" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个将<code class="du ml mm mn md b">DB</code>结构作为指针接收器的<code class="du ml mm mn md b">CreateProject</code>函数，并返回创建的<code class="du ml mm mn md b">Project</code>或<code class="du ml mm mn md b">Error</code>。在函数内部，我们还创建了一个项目集合，在向集合中插入数据时定义了10秒的超时，并使用<code class="du ml mm mn md b">InsertOne</code>函数来插入输入。</li><li id="a250" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个将<code class="du ml mm mn md b">DB</code>结构作为指针接收器的<code class="du ml mm mn md b">CreateOwner</code>函数，并返回创建的<code class="du ml mm mn md b">Owner</code>或<code class="du ml mm mn md b">Error</code>。在函数内部，我们还创建了一个所有者集合，定义了在向集合中插入数据时10秒的超时，并使用了<code class="du ml mm mn md b">InsertOne</code>函数来插入输入。</li><li id="1ccc" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个将<code class="du ml mm mn md b">DB</code>结构作为指针接收器的<code class="du ml mm mn md b">GetOwners</code>函数，并返回<code class="du ml mm mn md b">Owners</code>或<code class="du ml mm mn md b">Error</code>的列表。该函数遵循前面的步骤，使用<code class="du ml mm mn md b">Find</code>函数获取所有者列表。我们还使用<code class="du ml mm mn md b">Next</code>属性方法遍历返回的所有者列表，以最佳方式读取返回的列表。</li><li id="40bb" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个将<code class="du ml mm mn md b">DB</code>结构作为指针接收器的<code class="du ml mm mn md b">GetProjects</code>函数，并返回<code class="du ml mm mn md b">Projects</code>或<code class="du ml mm mn md b">Error</code>的列表。该函数遵循前面的步骤，使用<code class="du ml mm mn md b">Find</code>函数获取项目列表。我们还使用<code class="du ml mm mn md b">Next</code>属性方法遍历返回的项目列表，以最佳方式读取返回的列表。</li><li id="ffb7" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个将<code class="du ml mm mn md b">DB</code>结构作为指针接收器的<code class="du ml mm mn md b">SingleOwner</code>函数，并使用<code class="du ml mm mn md b">FindOne</code>函数返回匹配的<code class="du ml mm mn md b">Owner</code>或错误。</li><li id="4662" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个<code class="du ml mm mn md b">SingleProject</code>函数，该函数将DB struct作为指针接收器，并使用FindOne函数返回匹配的项目或错误。</li></ul><p id="29fe" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">更新应用程序逻辑<br/> </strong>接下来，我们需要用数据库函数更新应用程序逻辑。为此，我们需要更新<code class="du ml mm mn md b">schema.resolvers.go</code>文件，如下所示:</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="8199" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面的代码片段执行了以下操作:</p><ul class=""><li id="50e7" class="kw kx hi iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">导入所需的依赖项</li><li id="7cbd" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">使用<code class="du ml mm mn md b">ConnectDB</code>函数创建一个<code class="du ml mm mn md b">db</code>变量来初始化MongoDB。</li><li id="1df4" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">使用数据库逻辑中相应的功能修改<code class="du ml mm mn md b">CreateProject</code>、<code class="du ml mm mn md b">CreateOwner</code>、<code class="du ml mm mn md b">Owners</code>、<code class="du ml mm mn md b">Projects</code>、<code class="du ml mm mn md b">Owner</code>和<code class="du ml mm mn md b">Project</code>功能。</li></ul><p id="3c13" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最后，我们需要用一个<code class="du ml mm mn md b">bson:”_id”</code> struct标签修改<code class="du ml mm mn md b">models_gen.go</code>文件中生成的模型id。我们使用struct标签重新格式化MongoDB返回的JSON <code class="du ml mm mn md b">_id</code>。</p><figure class="ly lz ma mb fd ij"><div class="bz dy l di"><div class="mr ms l"/></div></figure><p id="eaa1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">完成后，我们可以使用下面的命令启动开发服务器:</p><pre class="ly lz ma mb fd mc md me mf aw mg bi"><span id="abe6" class="lk ju hi md b fi mh mi l mj mk">go run server.go</span></pre><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/dbbe2217c13d6526d3a1e124746b7d1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*r74Eq5NGCz_RWqTH.png"/></div></div></figure><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/6f2ddd2d89842825b94be582c60fe011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*32orB4eZBZzYIc9R.png"/></div></div></figure><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/66457170bdd0f3399dbf4d5a159d7e81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-250XuseObNPzQbs.png"/></div></div></figure><p id="26ca" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们还可以在MongoDB上验证操作。</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/40b2036b82bab6f5161cf97b29e29143.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WOmupC1JrlacA6z5.png"/></div></div></figure><h1 id="3c31" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="bc20" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">这篇文章讨论了如何使用gqlgen库和MongoDB用Golang构建一个项目管理应用程序。</p><p id="5aae" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这些资源可能会有所帮助:</p><ul class=""><li id="1466" class="kw kx hi iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated"><a class="ae js" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank"> GraphQL官方页面</a></li><li id="8b97" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><a class="ae js" href="https://github.com/99designs/gqlgen" rel="noopener ugc nofollow" target="_blank"> gqlgen GraphQL库</a></li><li id="4772" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><a class="ae js" href="https://docs.mongodb.com/drivers/go/current/" rel="noopener ugc nofollow" target="_blank"> MongoDB Go驱动</a></li><li id="7901" class="kw kx hi iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><a class="ae js" href="https://dev.to/hackmamba/build-a-rest-api-with-golang-and-mongodb-gin-gonic-version-269m" rel="noopener ugc nofollow" target="_blank">用Golang和MongoDB构建一个REST API</a></li></ul></div></div>    
</body>
</html>