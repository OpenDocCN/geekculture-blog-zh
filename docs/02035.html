<html>
<head>
<title>Starting Your Data Science Project With Metaflow? The MNIST Use-Case.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Metaflow开始您的数据科学项目？MNIST用例。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/starting-your-data-science-project-with-metaflow-the-mnist-use-case-44e3b3ad6ec3?source=collection_archive---------13-----------------------#2021-05-02">https://medium.com/geekculture/starting-your-data-science-project-with-metaflow-the-mnist-use-case-44e3b3ad6ec3?source=collection_archive---------13-----------------------#2021-05-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3de4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据科学家的优先事项仅仅在于挑选正确的功能，构建和部署他们的模型，他们不喜欢特别担心其他方面，如模型版本控制、作业调度、流程架构、计算资源管理，这些都是成功实施数据科学所必需的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/0d0ad2961a908b9e2d778abbd412fd01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CprRdVOkOQpnxOha.png"/></div></div></figure><p id="4eeb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是元流的用武之地</p><p id="981b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Metaflow是网飞开发的用于管理数据科学工作流的开源工具。它旨在通过让数据科学家专注于实际的数据科学工作并促进其交付成果的更快生产来提高他们的生产力。</p><p id="c109" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你熟悉气流或Luigi，那么你会理解元流的功能。它允许您分步运行数据科学流程，因此每一步都是流程中的一个节点，节点之间的连接就像下图所示。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jp"><img src="../Images/b37b183dc987643381b277e8d75202c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hGC43sZro4zt5plb"/></div></div></figure><p id="2630" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个系统被称为有向无环图。在这个假设的例子中，流程并行训练两个版本的模型，并输出最高的准确度分数。</p><p id="c013" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Metaflow的另一个有趣的属性是它附带了一个轻量级的服务,它提供了一个集中的地方来检查和跟踪所有的流执行。Metaflow将使用一个本地目录来跟踪笔记本电脑上执行的所有元数据。这种元数据被称为数据工件。</p><p id="8d9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用一个本地Jupyter笔记本来与您以前执行的以及当前运行的数据工件进行交互。但是，如果您希望与同行共享结果并跟踪您的工作而不用担心丢失任何状态，那么将Metaflow服务与Amazon S3一起部署作为数据存储会很有帮助。</p><p id="c946" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jr">随着我们的继续，我们将会看到一个使用Metaflow执行流并检查数据工件的例子。</em></p><h2 id="8428" class="js jt hi bd ju jv jw jx jy jz ka kb kc iq kd ke kf iu kg kh ki iy kj kk kl km bi translated"><strong class="ak">元流的基本组件</strong></h2><p id="82bf" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">元流Dag本质上由流、步骤和过渡组成。</p><ul class=""><li id="e638" class="ks kt hi ih b ii ij im in iq ku iu kv iy kw jc kx ky kz la bi translated">流:管理管道所有代码的实例。在本例中，它是一个Python对象<em class="jr">类MyFlow(Flowspec) </em></li><li id="b1ba" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">步骤:步骤是最小的可恢复计算单元，由decorator <em class="jr"> @step </em>分隔，它们是MyFlow对象中的python函数，在本例中是<em class="jr"> def start，fitA，fitB，eval，end </em>。</li><li id="dc80" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">转换:步骤之间的链接可以是不同的类型(线性、分支和for each)；关于<a class="ae jq" href="https://docs.metaflow.org/" rel="noopener ugc nofollow" target="_blank">文档</a>有更多细节。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lg"><img src="../Images/f34bf3660a09668f6c877464b0eb43e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZWeLlLtG1c3y7ES-.jpeg"/></div></div></figure><p id="9127" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该流程有3个组成部分:</p><ul class=""><li id="6fb0" class="ks kt hi ih b ii ij im in iq ku iu kv iy kw jc kx ky kz la bi translated">数据存储是存储流程中生成的所有数据(数据工件)的地方</li><li id="e01a" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">元数据是存储流程执行信息的地方</li><li id="d473" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">客户端是访问数据存储中的数据并从元数据中获取流信息的连接组件</li></ul><p id="e9ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">围绕流程的这些组件允许数据科学家恢复运行、检查运行元数据、进行混合运行和协作。</p><h2 id="3e3d" class="js jt hi bd ju jv jw jx jy jz ka kb kc iq kd ke kf iu kg kh ki iy kj kk kl km bi translated"><strong class="ak">设置元流</strong></h2><p id="3bf0" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">像AWS这样的本地和远程服务器都可以使用元流</p><p id="6eb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本地和远程服务器上，只需简单地</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="7198" class="js jt hi li b fi lm ln l lo lp">pip install metaflow</span></pre><p id="f446" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者升级已经安装的元流</p><pre class="je jf jg jh fd lh li lj lk aw ll bi"><span id="34f8" class="js jt hi li b fi lm ln l lo lp">pip install - upgrade metaflow</span></pre><p id="a196" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，考虑到所需数据和资源的规模，人们可以选择远程选项，或者需要快速交互但资源有限的本地选项。</p><p id="8883" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有一种混合方法，通过在两个服务器之间轻松切换来获得本地和远程两个世界的优势。Metaflow会自动对云中的所有数据和代码进行快照。这意味着您可以<a class="ae jq" href="https://docs.metaflow.org/metaflow/client" rel="noopener ugc nofollow" target="_blank">检查</a>，<a class="ae jq" href="https://docs.metaflow.org/metaflow/debugging#how-to-use-the-resume-command" rel="noopener ugc nofollow" target="_blank">恢复</a>，并恢复任何先前的元流执行，而不必担心您辛勤工作的成果会丢失。</p><h2 id="61a5" class="js jt hi bd ju jv jw jx jy jz ka kb kc iq kd ke kf iu kg kh ki iy kj kk kl km bi translated"><strong class="ak">开始你的数据科学/机器学习项目——MNIST</strong></h2><p id="fa1a" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">在这篇文章中，我们将建立一个数据科学工作流，使用<strong class="ih hj"> MNIST数据集训练机器学习模型。</strong></p><p id="ba06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jq" href="https://www.kaggle.com/oddrationale/mnist-in-csv" rel="noopener ugc nofollow" target="_blank"> MNIST数据集</a>最初是一个手写数字图像的数据库，但是对于这个项目，图像数据已经使用其通道(RGB)转换为CSV格式，作为数据集中的特征，即矢量化。</p><p id="3da6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lq lr ls li b">data</code>文件包含60，000个例子和标签。每行包含785个值:第一个值是标签(从0到9的数字)，其余784个值是像素值(从0到255的数字)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/4114fdf2758b46edb107ab75b094184d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QDzN8SynVf7FePyQbxhTjQ.jpeg"/></div></div></figure><p id="3ad6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将涉及数据提取、数据准备、数据分割、模型拟合和预测以及模型评估。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lu"><img src="../Images/670ff241d55d7c3c720416ae73484d41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vgj8x7hT3ED9Y48Vsqq0Dw.jpeg"/></div></div></figure><p id="fb79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的图表可以用下面的代码来表示</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lv"><img src="../Images/c84d8880b807e972bb8591ec4cad8ca5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MCKwYWjpSDgbCXGIYGk96A.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/1a439c8260b0d7ef03a9ae6a85f1546c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*4qWBEuXV6Y5zJnlzs_3UtA.png"/></div></div></figure><p id="ae54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">遍历图中的每一步</strong></p><p id="0c52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一步是设置MNIST数据文件的路径，并将数据集加载到熊猫数据框中</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lx"><img src="../Images/87d1a716a134da3ace2c34e20a2d278d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*m4j5KjG6Ma6ftRUw8HYW0g.png"/></div></figure><p id="79d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第二步是通过从整个数据集中提取特征和标注来准备数据集</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ly"><img src="../Images/f3fd1be3ef3e12ca1de9d53e13363c99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*P2KX8KYku91hiA04xqGxBw.png"/></div></figure><p id="5cd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是以50:50的比例将数据分为训练集和测试集</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lz"><img src="../Images/0215e93543de5d94fad692862741f604.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*52eVQeYBjyG741bD7U7TQw.png"/></div></div></figure><p id="eaa3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们对高斯朴素贝叶斯模型的数据进行拟合预测</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ma"><img src="../Images/21ca86eb606c291bbe3cac890f471490.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*kKcBPO5d7B8zdIhj4p1WMQ.png"/></div></div></figure><p id="44ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们对随机森林模型的数据进行拟合预测</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mb"><img src="../Images/88645f25c3cc28cc55ba2550a04ce72a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vg-kb83zCOdcAaQq6uVT8Q.png"/></div></div></figure><p id="b060" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，我们将运行分类模型的两个分支连接起来。我们合并了来自两个分支的数据工件。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mc"><img src="../Images/821d2eac7bb0a4ae4edeb858a324a673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*nFphSGxHanvunOk2KO4ZfA.png"/></div></figure><p id="db95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们评估了这个模型</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es md"><img src="../Images/0a656ff06ed4636ee62534ab6cc231ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*VW-rlcG_QIwozg6s-chcnw.png"/></div></figure><p id="563b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结束了这场赛跑</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es me"><img src="../Images/97b3a1c4a6b679988c606a5a616edaaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*Q1KktXXuZQpLQkmrRMtclg.png"/></div></figure><p id="1cc5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参见下面的完整代码库</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="1648" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查看流程运行的结果</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mh"><img src="../Images/af5557899f1084c3ab25a14e78d3c219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2gxafMeyNVLbcIrIzaS-Eg.png"/></div></div></figure><p id="d483" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到，随机森林模型比高斯朴素贝叶斯模型表现更好，得分为93.6%，比56.7%。</p></div><div class="ab cl mi mj gp mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="hb hc hd he hf"><p id="7ded" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Metaflow，我们还可以检查我们的流程，即检查流程列表、运行次数、最近运行、步骤列表和每个步骤的数据工件。这在调试您的流时特别有用。</p><p id="a5b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">错误通常以这种形式出现</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mp"><img src="../Images/a26ccaa33e5b60590145ef60dabb837a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P-kR4i0-099pJr_7vQ0vFg.png"/></div></div></figure><p id="c998" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面，你可以用这种方式检查你的流程，这可以通过Jupyter笔记本或你的CLI来完成。我们在这个项目中使用Jupyter笔记本。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mq"><img src="../Images/32982dc4b9cfb44ffbdabfe10f3099ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CkmQz8Yr6gXuuN4DQMA3Qw.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mr"><img src="../Images/7ae8101216e6e724e224e87dc9ef09bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d6sKdBn6W7mY9RxOl4be4g.png"/></div></div></figure><p id="655d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们介绍了对元流的理解，它的基本组件，一个使用MNIST数据集和检查数据流的流执行示例</p><p id="c0cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这是有益的。一定要分享。</p><p id="2e16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">干杯</p></div></div>    
</body>
</html>