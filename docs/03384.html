<html>
<head>
<title>Build an image browsing App with React Native (4) — RecyclerListView</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React Native (4)构建图像浏览应用程序— RecyclerListView</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/build-an-image-browsing-app-with-react-native-4-recyclerlistview-b3cb465e1ef7?source=collection_archive---------36-----------------------#2021-06-07">https://medium.com/geekculture/build-an-image-browsing-app-with-react-native-4-recyclerlistview-b3cb465e1ef7?source=collection_archive---------36-----------------------#2021-06-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="5a33" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated"><em class="hi"> React原生为iOS和Android带来了</em> <a class="ae jh" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> <em class="hi"> React的</em> </a> <em class="hi">声明式UI框架。使用React Native，您可以使用原生UI控件，并拥有对原生平台的完全访问权限。</em><a class="ae jh" href="https://github.com/facebook/react-native" rel="noopener ugc nofollow" target="_blank"><em class="hi">(https://github.com/facebook/react-native</em></a><em class="hi">)</em></p></blockquote><p id="7095" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">这是本教程关于如何用React Native构建图片浏览应用的第4篇文章。所以我想你已经读过它的前几部分了。</p><p id="68b5" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">这是前面章节的链接。</p><div class="jl jm ez fb jn jo"><a rel="noopener follow" target="_blank" href="/geekculture/build-an-image-browsing-app-with-react-native-df303d222a0d"><div class="jp ab dw"><div class="jq ab jr cl cj js"><h2 class="bd hj fi z dy jt ea eb ju ed ef hh bi translated">使用React Native构建图片浏览应用程序</h2><div class="jv l"><h3 class="bd b fi z dy jt ea eb ju ed ef dx translated">React Native为iOS和Android带来了React的声明式UI框架。使用React Native，您可以使用本机UI控件…</h3></div><div class="jw l"><p class="bd b fp z dy jt ea eb ju ed ef dx translated">medium.com</p></div></div><div class="jx l"><div class="jy l jz ka kb jx kc kd jo"/></div></div></a></div><div class="jl jm ez fb jn jo"><a href="https://kxie0124.medium.com/build-an-image-browsing-app-with-react-native-2-redux-68f2d7a6744f" rel="noopener follow" target="_blank"><div class="jp ab dw"><div class="jq ab jr cl cj js"><h2 class="bd hj fi z dy jt ea eb ju ed ef hh bi translated">使用React Native(2)-Redux构建图片浏览应用程序</h2><div class="jv l"><h3 class="bd b fi z dy jt ea eb ju ed ef dx translated">React Native为iOS和Android带来了React的声明式UI框架。使用React Native，您可以使用本机UI控件…</h3></div><div class="jw l"><p class="bd b fp z dy jt ea eb ju ed ef dx translated">kxie0124.medium.com</p></div></div></div></a></div><div class="jl jm ez fb jn jo"><a href="https://kxie0124.medium.com/build-an-image-browsing-app-with-react-native-3-persistent-storage-2acdf01f3c62" rel="noopener follow" target="_blank"><div class="jp ab dw"><div class="jq ab jr cl cj js"><h2 class="bd hj fi z dy jt ea eb ju ed ef hh bi translated">使用React Native (3)构建图像浏览应用程序—持久存储</h2><div class="jv l"><h3 class="bd b fi z dy jt ea eb ju ed ef dx translated">React Native为iOS和Android带来了React的声明式UI框架。使用React Native，您可以使用本机UI控件…</h3></div><div class="jw l"><p class="bd b fp z dy jt ea eb ju ed ef dx translated">kxie0124.medium.com</p></div></div><div class="jx l"><div class="ke l jz ka kb jx kc kd jo"/></div></div></a></div><p id="c352" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">实际上，我们已经实现了这样一个图像浏览应用程序的所有功能，包括在一个<code class="du kf kg kh ki b">FlatList</code>中显示图像，从后端API获取数据，在持久存储中保存数据，用Redux在全局状态存储中保存数据，用<code class="du kf kg kh ki b">react-navigation</code>从一条路线导航到另一条路线。所以在这篇文章中，我只是做了一些改进，比如使用<code class="du kf kg kh ki b">RecyclerListView</code>来显示图片，而不是使用FlatList。</p><blockquote class="if ig ih"><p id="ae8c" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">什么是RecyclerListView？这是一个支持复杂布局的React Native和Web的高性能listview。受Android上的RecyclerView和iOS上的UICollectionView的启发，只有JS，没有原生依赖。</p><p id="8963" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">RecyclerListView使用“单元回收”来重用不再可见的视图以呈现项目，而不是创建新的视图对象。对象的创建是非常昂贵的，并且伴随着内存开销，这意味着当你在列表中滚动时，内存占用会不断增加。释放内存中的不可见项是另一种技术，但是这会导致创建更多的对象和大量的垃圾收集。回收是呈现无限列表的最佳方式，不会影响性能或内存效率。</p><p id="4c9f" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">—<a class="ae jh" href="https://github.com/Flipkart/recyclerlistview" rel="noopener ugc nofollow" target="_blank">https://github.com/Flipkart/recyclerlistview</a></p></blockquote><p id="e227" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">它可以做FlatList能做的所有事情，但是性能更好。</p><h1 id="cb05" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">添加RecyclerListView包</h1><p id="31e8" class="pw-post-body-paragraph ii ij hi il b im lh io ip iq li is it ji lj iw ix jj lk ja jb jk ll je jf jg hb bi translated">首先我们需要添加一个新的包来支持<code class="du kf kg kh ki b">RecyclerListView</code>,方法是运行</p><pre class="lm ln lo lp fd lq ki lr ls aw lt bi"><span id="d033" class="lu kk hi ki b fi lv lw l lx ly">yarn add recyclerlistview</span></pre><p id="13a2" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">您会发现一个新的依赖项被添加到项目的<code class="du kf kg kh ki b">Package.json</code>中。</p><h1 id="a31b" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">创建回收列表组件</h1><p id="b58f" class="pw-post-body-paragraph ii ij hi il b im lh io ip iq li is it ji lj iw ix jj lk ja jb jk ll je jf jg hb bi translated">然后，让我们在<code class="du kf kg kh ki b">home</code>文件夹中创建一个新文件<code class="du kf kg kh ki b">RecyclerList.tsx</code>，并添加以下代码</p><pre class="lm ln lo lp fd lq ki lr ls aw lt bi"><span id="0c21" class="lu kk hi ki b fi lv lw l lx ly">import React from 'react';<br/>import {<br/>  RecyclerListView,<br/>  DataProvider,<br/>  LayoutProvider,<br/>  Dimension,<br/>} from 'recyclerlistview';<br/>import {StyleSheet, StatusBar, Dimensions} from 'react-native';<br/>import Item from './Item';</span><span id="3965" class="lu kk hi ki b fi lz lw l lx ly">const getWindowWidth = () =&gt;<br/>  Math.round(Dimensions.get('window').width * 1000) / 1000 - 6;<br/>const RecyclerList = ({<br/>  data,<br/>  nextPage,<br/>  navigation,<br/>}: {<br/>  data: Array&lt;Photo&gt;;<br/>  nextPage: () =&gt; void;<br/>  navigation: any;<br/>}): JSX.Element =&gt; {<br/>  console.log(<br/>    'RecyclerList',<br/>    data.map(item =&gt; item.id),<br/>  );</span><span id="fa9f" class="lu kk hi ki b fi lz lw l lx ly">const renderItem = (type: string | number, data: any) =&gt; (<br/>    &lt;Item photo={data} navigation={navigation} /&gt;<br/>  );<br/>  const dataProvider = new DataProvider((r1, r2) =&gt; {<br/>    return r1 !== r2;<br/>  }).cloneWithRows(data);<br/>  const layoutProvider = new LayoutProvider(<br/>    index =&gt; {<br/>      return JSON.stringify({<br/>        width: data[index].width,<br/>        height: data[index].height,<br/>      });<br/>    },<br/>    (type: string | number, dim: Dimension) =&gt; {<br/>      switch (type) {<br/>        case 'VSEL':<br/>          dim.width = getWindowWidth() / 2;<br/>          dim.height = 150;<br/>          break;<br/>        default:<br/>          if (typeof type === 'string') {<br/>            const {width, height} = JSON.parse(type);<br/>            dim.width = getWindowWidth() / 2;<br/>            dim.height = 250;<br/>          }<br/>      }<br/>    },<br/>  );<br/>  return (<br/>    &lt;RecyclerListView<br/>      style={styles.container}<br/>      dataProvider={dataProvider}<br/>      layoutProvider={layoutProvider}<br/>      rowRenderer={renderItem}<br/>      onEndReached={nextPage}<br/>    /&gt;<br/>  );<br/>};</span><span id="81b5" class="lu kk hi ki b fi lz lw l lx ly">const styles = StyleSheet.create({<br/>  container: {<br/>    flex: 1,<br/>    paddingTop: StatusBar.currentHeight || 0,<br/>    marginHorizontal: 0,<br/>  },<br/>});<br/>export default RecyclerList;</span></pre><p id="dc04" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">然后我们用<code class="du kf kg kh ki b">RecyclerListView</code>实现了一个组件<code class="du kf kg kh ki b">RecyclerList</code>。我们可以用这个新组件来呈现图像列表。稍后，我们将替换<code class="du kf kg kh ki b">Home</code>组件上原来的<code class="du kf kg kh ki b">List</code>组件。</p><p id="3c6e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">其实大部分代码都是标准的。我们需要做的是实现我们自己的<code class="du kf kg kh ki b">DataProvider</code>，用它来消费图像数组，还有<code class="du kf kg kh ki b">LayoutProvider</code>，用它我们可以定制布局。但是仍然有一些限制，例如,<code class="du kf kg kh ki b">RecyclerListView</code>不支持每个元素的动态高度，所以我们不能用砖石列表来呈现元素。</p><h1 id="4543" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">更新主页组件</h1><p id="980d" class="pw-post-body-paragraph ii ij hi il b im lh io ip iq li is it ji lj iw ix jj lk ja jb jk ll je jf jg hb bi translated">最后一步是更新<code class="du kf kg kh ki b">Home</code>组件中的下面一行</p><pre class="lm ln lo lp fd lq ki lr ls aw lt bi"><span id="3173" class="lu kk hi ki b fi lv lw l lx ly">import List from './List';</span></pre><p id="836f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">随着</p><pre class="lm ln lo lp fd lq ki lr ls aw lt bi"><span id="743c" class="lu kk hi ki b fi lv lw l lx ly">import {default as List} from './RecyclerList';</span></pre><p id="2465" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">然后再次运行该应用程序。但是您会发现没有什么变化，因为使用<code class="du kf kg kh ki b">RecyclerListView</code>代替FlatList只是性能增强。用户没有任何变化。</p><p id="e8b5" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">好的。这一章简短明了。谢谢你阅读它。</p></div></div>    
</body>
</html>