# 如何保护网络支付系统

> 原文：<https://medium.com/geekculture/how-to-not-secure-web-payment-systems-e23be321b168?source=collection_archive---------44----------------------->

![](img/a431739fbdbe207341988cf9fa87693f.png)

因为这里的故事是真实的，我将避免使用具体的名称或地点。这可能会让我陷入尴尬的境地。如果你经历过类似的事情，这可能听起来很熟悉。
也就是说，识别细节与故事本身关系不大。这不是一个新的或复杂的黑客。这是开发人员最大的懒惰。假设用户都是非技术羊。在很大程度上，他们是对的，但是，一个贪婪淘气的用户可以改变图片。

免责声明:

*   我实际上没有使用我得到的东西，并且报告了这个错误
*   我不建议人们试图通过利用糟糕的系统来获得免费服务。这是为了帮助保护那些被暴露的人
*   我希望开发者对系统更加警惕，尤其是那些涉及跨越他们国家边界的每个人的个人和医疗信息的系统
*   然而，我确实认为，在家里测试这些类型的错误对互联网有更大的好处。

# 从前

我一直在旅行。在 covid 期间比“正常”时间更是如此，以获得疫苗、医疗检查和其他个人义务。旅行变成了巨大的支付负担，你必须在登机前和落地后支付测试费用。哦，回去的时候再来一遍。虽然我对测试的必要性没有任何批评(我也没有专业背景来评论它)，但我不得不承担和支付的一堆测试开始感觉像一种税收。一种消极的经济激励，如果你愿意，就不去旅行。

在过去的一年里，我一直在我的祖国旅行，不得不在机场搭乘免费的聚合酶链式反应测试航班。在在线专用系统中安排预约，每次使用相同的折扣代码:`Free1`。

几天前，当我在计划另一次回家的旅程时，我又重复了一遍同样漫长的例行公事。填写乘客定位器表格(出境和入境旅行——🤷)和预购我的机场 Covid 聚合酶链式反应测试。

令我惊讶的是，测试名称从“Covid PCR —强制”变成了类似“Covid PCR—80 美元强制”的东西。

*等什么？*

是的，似乎从现在开始，如果你想离开机场，每人 80 美元的罚款(对不起，是收费)是必须的。另一种选择是，抵达时用现金支付 100 美元(有些交易可能？).

我重试了过去一年一直有效的代码。`Free1`和“应用”。屏幕显示红色错误信息。上面写着“无效的优惠券代码”。

我做了任何一个网络罪犯在那个时候都会做的事情——重复做同样的事情 3-5 次(天才)。当那不起作用时，我尝试了`Free2`、`Free80`和其他几个。

当我检查传出的请求时，我发现它被发送到一个`/api/validate-voucher`端点。它返回一个奇怪的 HTTP 错误；`422 (Unprocessable entity)`还有一个`{statusCode: 422, message: "Invalid Voucher or Appointment ID"}`，嗯..什么“约会”？我想申请一个折扣代码。如果响应不好，UI 会删除输入的代码，有效地“阻止”代码的使用。事实上，它确实被删除了，这可能是一个很好的用户体验，但同时也是一个糟糕的预防机制。"*为什么不自己测试一下？*“我想。😈

为救援而忙碌！
我通过打嗝启动 Firefox 和[代理](https://addons.mozilla.org/en-US/firefox/addon/foxyproxy-standard/)一切。

查看发出的请求，我看到了指标和更多指标、第三方跟踪程序等等。有时候我真希望我没有看到网站让我们发的那堆垃圾。转发一切不感兴趣的东西，直到哎呦，那是什么？

保存 JSON 数据的请求:

```
{
  appointmentId: "12345",
  voucher: ""
}
```

好了，把之前有效的凭证滑过来怎么样？等等，这听起来很熟悉..早些时候，当我试图输入我的旧折扣代码时，我得到了一个“无效的约会 id……”，同一个系统实际上可以用于两个目的吗——验证代码**和**创建约会？感觉不对劲，直觉告诉我，我会看到一些有趣的东西。
我动态编辑对象，并打着嗝转发。

```
{
  appointmentId: "12345",
  voucher: "Free1"
}
```

而你知道吗，屏幕上出现了一个巨大闪亮的绿色标签:“已付费”。五秒钟后，屏幕重新加载，生成了一个带有约会的新 QR。

# 这个故事的寓意

用户不傻。他们中的一些人可能没有技能或精力去钻研。但是，如果一个保存个人医疗记录和结果的系统如此容易被利用，那么在其他领域会发生什么呢？

企业的建立和运行是为了赚钱。因此，它们总是会成为攻击的目标。更不用说一项直到最近还免费的服务了，现在这项服务被强加给所有回国的乘客，阻止他们回家。

> 人们必须检查每一个传入的请求，就好像它来自野外一样(实际上是这样！).雇佣 [*零信任*](https://en.wikipedia.org/wiki/Zero_trust_security_model) *。*

# 处理方式和一般方法

首先，**假设你会被剥削**。就像检查前门是否上锁一样，应用程序应该确保用户只能做他们想做的事情。

检查折扣代码在 UI 中是否有效？太棒了，后端呢？浏览器生活在用户世界里，开发者不能控制应用程序如何被操作或被错误使用。我们必须检查每一个传入的请求，就好像它来自野外一样(实际上是……)。雇佣[零信任](https://en.wikipedia.org/wiki/Zero_trust_security_model)。

同样，对输入请求进行速率限制；当我不能使用旧的`Free1`折扣代码时，我尝试了`Free2`，然后是`Free3`等等不同的排列。看起来很奇怪，我可以不停地输入代码，并了解它们是否有效，所以我做了任何人都会做的事情；我写了一个剧本。尝试了几十个只是为了好玩。虽然什么都没有出现，但我很高兴再次使用 [ffuf](https://github.com/ffuf/ffuf) 进行模糊处理，并且我刚刚了解到系统并不限制请求的速率。如果有足够的时间，不同的用户可以连续几小时甚至几天运行一个类似的脚本。这很糟糕，有两个主要原因- **a)** 服务器被请求轰炸。如果构建正确，它可以扩展为暴力攻击服务(这本身就很有趣)。在最坏的情况下，它会崩溃。 **b)** 在某个时候，会弹出一个有效的折扣代码。

另一个“折扣代码友好”的漏洞(在获得全面降价后我还没有尝试过)，是一个[竞争条件](https://www.veracode.com/security/race-condition)，用户可以重新应用相同的折扣代码，通常会多次给出折扣百分比。[这里有一个几年前在 Dropbox 上发现的著名案例](https://hackerone.com/reports/59179)。

总而言之，系统的安全性应该是最重要的。如果不是为了收益，至少是为了客户的隐私。Web 应用程序可以通过多种方式被“入侵”，这可能很简单。我在测试自己的应用程序时的首选方法是像一个恶意的演员一样思考。我不一定是顶尖的安全专家，但我只是一个拥有简单技能和一些简单愿望的用户。比如得到免费服务，或者我不该得到的折扣。

感谢你阅读🖤

请随意提出问题或评论。