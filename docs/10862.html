<html>
<head>
<title>Jenkins and TIBCO BusinessWorks — Lesson Learned</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jenkins和TIBCO BusinessWorks —吸取的教训</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/jenkins-and-tibco-businessworks-lesson-learned-3d40dfb93b4b?source=collection_archive---------9-----------------------#2022-02-19">https://medium.com/geekculture/jenkins-and-tibco-businessworks-lesson-learned-3d40dfb93b4b?source=collection_archive---------9-----------------------#2022-02-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="78e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个故事可以作为我的故事的续集<a class="ae jd" href="https://s-maletta-k2.medium.com/jenkins-pipeline-for-tibco-businessworks-6-x-72773506f9dc" rel="noopener">詹金斯管道TIBCO BW 6.x </a>。虽然我在前面的故事中谈到了设置您的第一个管道，但在这里，我将向您展示一些我收到的反馈意见，在现实生活的项目中使用Jenkins管道。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/95863217ac597e9a28c65d70559f8cd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*xpNq-C-y8yIx9GMuskOk6w.png"/></div></figure><h2 id="fc48" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">GIT子模块</h2><p id="7413" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">在代码中使用库是一种常见的开发和架构模式:这允许您提高代码的质量和稳定性。<br/> TIBCO Business Works使用共享模块作为库:它们可以在应用程序之间使用，并被应用程序模块和共享模块引用。<br/>如果你的版本控制是GIT，通常的做法是给你的公共库分配一个专用的项目。</p><p id="e1d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您的应用程序所依赖的项目包含库1作为引用。看下面的图表</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es km"><img src="../Images/25c050d6f517c8b907ac83136dfd5750.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*ZfTIgFYcS2L8Ro86QoVw1A.png"/></div></figure><p id="838e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个场景中，我描述的管道不起作用，因为GIT不能下载引用的项目:结果，编译器给你一个依赖异常。您必须显式地配置git插件来使用子模块。</p><p id="d596" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了避免这种情况，我们在管道中增加了一个明确的<em class="kn">检验</em>阶段</p><pre class="jf jg jh ji fd ko kp kq kr aw ks bi"><span id="c169" class="jm jn hi kp b fi kt ku l kv kw">stage('Checkout')<br/>    {<br/>        checkout(<br/>            [<br/>                $class: 'GitSCM',<br/>                branches:[<br/>                    [<br/>                        name: '*/<strong class="kp hj"><em class="kn">branch</em></strong>'<br/>                        ]<br/>                    ],<br/>                dogenerateSubmoduleConfigurations:false,<br/>                extensions:[<br/>                    [<br/>                        $class: 'SubmoduleOption',<br/>                        disableSubmodules: false,<br/>                        parentCredentials: true,<br/>                       <strong class="kp hj"> recursiveSubmodles: true</strong>,<br/>                        reference: '',<br/>                        trackingSubmodules: false<br/>                    ]<br/>                ],<br/>                submodulesCfg:[],<br/>                userRemoteConfigs:[<br/>                    [<br/>                        credentialsId:'<strong class="kp hj">GIT_Account</strong>',<br/>                        url:'<strong class="kp hj"><em class="kn">http://</em></strong><a class="ae jd" href="http://ahhycsvap04.aceaspa.it/bitbucket/scm/tss/salesforcemessagereceiver.git'" rel="noopener ugc nofollow" target="_blank"><strong class="kp hj"><em class="kn">giturl/projecturl.git</em></strong>'</a><br/>                        ]<br/>                    ]<br/>                ]<br/>            )<br/>    }</span></pre><p id="106d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们指导插件配置:</p><ul class=""><li id="2e0f" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated"><strong class="ih hj">分支</strong>:应用模块所依赖的分支名称</li><li id="9c61" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><strong class="ih hj"> GIT_Accout </strong>:用于访问GIT的凭证</li><li id="c975" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><strong class="ih hj">递归子模块</strong>:递归子模块使能；这指示插件遵循子模块依赖性</li><li id="0826" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><strong class="ih hj">http://giturl/project url . GIT</strong>:GIT项目URL</li></ul><p id="373c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了让一切正常工作，你必须急着获取文件。<em class="kn"> gitmodules </em>包含了<em class="kn">条目</em></p><pre class="jf jg jh ji fd ko kp kq kr aw ks bi"><span id="9d6c" class="jm jn hi kp b fi kt ku l kv kw">[submodule "lib"]<br/> path = library<br/> url = <a class="ae jd" href="http://ahhycsvap04.aceaspa.it/bitbucket/scm/tss/commonutils.git" rel="noopener ugc nofollow" target="_blank"><strong class="kp hj"><em class="kn">http://giturl/libraryurl.git</em></strong></a></span></pre><p id="74d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">必须在<em class="kn">中找到。git/config </em>文件。</p><p id="02e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请务必不仅在本地TIBCO Business Studio文件夹中，而且在远程分支中保存更新的GIT引用。它自动管理引用:这就是为什么我们不显式库GIT位置。我试着用下面的例子来解释它是如何工作的:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ll"><img src="../Images/31b393fab83e8ede10de0b84e8b1f710.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iGA325Sanf2UqgFqzMDdhg.png"/></div></div></figure><p id="7376" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应用程序没有嵌入库的副本，但是它只将项目URL和提交点存储到树中的<em class="kn">中。gitmodules </em>文件如前所述。</p><p id="c73a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这解释了为什么每次您拉一个新的库提交点时都需要提交黄色的圆柱体:根据模型，您将指针移动到库树中，更新。<em class="kn">I modules</em>文件。如果不这样做，您的存储库副本仍然指向另一个提交点，您的构建可能会失败。</p><p id="9c85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要了解更多关于GIT子模块的信息，请点击这里。</p><h2 id="8abc" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">詹金斯标准网钩</h2><p id="affa" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">我在前面的故事中描述的管道必须手动启动。我们曾经想要一个完全自动化的过程，让Jenkins随时部署:我们选择启用Jenkins标准Webhook。</p><p id="d665" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要启用webhook，您需要在两端进行配置:一个来自Jenkins端，一个来自git服务器。在本文中，我将讨论Jenkins方面:事实上，配置您的git服务器取决于大量变量，如您的服务器提供商(GitHub、GitLab、Bitbucket等)和安装的插件。由于这些原因，我更愿意让您从官方文档中学习这一部分。</p><p id="06ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从Jenkins Pipeline屏幕标记<strong class="ih hj">通用Webhook触发器:</strong></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lq"><img src="../Images/e78b1c5a6a57d8e68aaacb0f5f76621b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K-B3KMtvWeCfr8LBNgMCog.png"/></div></div></figure><p id="2496" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这样，您的管道将侦听来自服务器的请求。<br/>这个解决方案带来了一个问题:如果你配置了不止一个管道，通常情况下，暴露的URL对于每个管道都是相同的。所有构建将同时开始！</p><p id="152e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了避免不必要的并发，我们需要定制每个钩子。最快的方法是定义一个自定义令牌:它代表一个共享文本，当然没有加密文本，这允许Jenkins识别它必须启动的管道。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lr"><img src="../Images/01c60a3b0cc72efd5b490807d899e354.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OGUjs5Mt8yg-U96XuLTEJg.png"/></div></div></figure><p id="7f00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以关联一个凭据集以避免未经授权的访问。</p><p id="6f5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我发现有用的还有参数定制:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ls"><img src="../Images/35c9c50270e44acad15e2d299862d353.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LDL7wvPEH-QWVh6gQgrJww.png"/></div></div></figure><p id="2f33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用请求的头部和主体来参数化您的构建。</p><h2 id="2bd0" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">GIT flow和Jenkins</h2><p id="9c34" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">当你使用GIT时，CVC就像喝一杯<a class="ae jd" href="https://en.wikipedia.org/wiki/India_pale_ale" rel="noopener ugc nofollow" target="_blank"> IPA </a>配一份玛格丽塔披萨一样普遍，采用标准的GIT流程。</p><p id="6914" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们希望让我们的管理模式与标准流程相匹配时，麻烦就诞生了。</p><p id="8341" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们有三种运行时环境:</p><ul class=""><li id="1ae9" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated"><em class="kn">开发</em>:用于开发者测试和调试</li><li id="c8a0" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><em class="kn">预编程</em> ( <em class="kn">预生产</em>):最终用户测试代码的地方</li><li id="64f7" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><em class="kn">生产</em></li></ul><p id="1553" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们对git-flow中的环境建模如下</p><ul class=""><li id="0b6d" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated"><em class="kn">主人</em></li><li id="9a4a" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><em class="kn">预编程</em></li><li id="5d3a" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><em class="kn">开发</em></li></ul><p id="4a88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kn">开发</em>分支带来我们部署在<em class="kn">开发</em>环境中的代码，用于调试和内部测试目的，<em class="kn">预开发</em>存储最终用户验收测试的代码，而<em class="kn">主</em>当然反映产品。</p><p id="1381" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除主管环境的经理外，任何人不得推动<em class="kn">开发</em>、<em class="kn">预开发</em>、<em class="kn">主控</em>分支。</p><p id="130e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">来自我们运营团队的<em class="kn">主要指令</em>是:</p><blockquote class="lt lu lv"><p id="a97d" class="if ig kn ih b ii ij ik il im in io ip lw ir is it lx iv iw ix ly iz ja jb jc hb bi translated">如果没有在d <em class="hi"> evelop </em>和<em class="hi">pre Prog</em>环境中进行测试，任何功能和修复都不会部署到生产环境中。</p></blockquote><p id="71f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了遵循这个规则，我们选择在上层环境中提升ear本身，而不是代码。我们不会为每个环境重新构建代码，而是在上层重新安装相同的工件。</p><p id="0fe4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们必须在Jenkins的自动部署单元中重现这种行为。</p><p id="0c9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最现代的解决方案将使用软件组件管理库和两条不同的管道:一条负责构建和测试，另一条负责在正确的环境中部署。</p><p id="e828" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于时间限制和没有可用的SCM，我们创建了一个混合版本的解决方案，我在图中展示了之前说过的一行:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lz"><img src="../Images/63e8cd4a437816367c9510c6e66fd04a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vfb1IpMCL5aruu-T_U1V8g.png"/></div></div></figure><p id="b49e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们知道的管道用于编译、构建自动测试和部署开发环境的代码:它将生成的ear备份到一个共享文件夹中。</p><p id="8d77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当代码对于提升到pre-prod环境中很有价值时，使用第二个管道:它使用一个虚拟maven <em class="kn"> pom </em>和用于正确环境的TEA配置。It只负责使用正确的配置文件来部署它。</p><p id="d440" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">管道与开发环境中使用的管道完全不同。</p><p id="0a5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它使用:</p><ul class=""><li id="6e97" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">特设maven pom文件称来自官方文件的虚拟文件</li><li id="294f" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">配置文件:针对您需要部署的环境，即<em class="kn"> AppSpace </em>名称、<em class="kn"> AppNode </em>名称、端口等；</li><li id="65db" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">当然是藏物了。</li></ul><p id="bf5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">管道只执行一个目标:<em class="kn"> deploy。</em></p><h2 id="2613" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">结论</h2><p id="9c8f" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">写这个故事是为了说明在现实生活模式中完成常见任务的解决方案。我知道许多人可以变得更好或重新设计，但这些是我们找到的。</p><p id="288d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有表达的观点和描述的解决方案都来自我和我的团队，而非TIBCO Software Inc .</p></div></div>    
</body>
</html>