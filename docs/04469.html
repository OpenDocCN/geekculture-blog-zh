<html>
<head>
<title>Using Assertion Scopes to execute multiple Assertions in C#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在C#中使用断言范围执行多个断言</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/using-assertion-scopes-to-execute-multiple-assertions-in-c-fcded73b1a35?source=collection_archive---------9-----------------------#2021-06-28">https://medium.com/geekculture/using-assertion-scopes-to-execute-multiple-assertions-in-c-fcded73b1a35?source=collection_archive---------9-----------------------#2021-06-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="13df" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">当在我们的单元测试中使用多个断言时，断言作用域使我们的生活变得更容易，因为它节省了我们找出测试失败原因的时间和精力。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/9b00556bc4d7ecf8cd3d0e4512b1b058.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VMjNtoDdV2cyn7xs.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Assertion Scopes allow us to test multiple assertions within a single test execution</figcaption></figure><p id="07f6" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">流利断言是一个. NET库，它提供了一系列有用的扩展方法，允许我们以更自然的方式测试我们的C#代码。</p><p id="4386" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">比方说，我们正在测试一个字符串的输出。如果没有流畅的断言，我们可能会写出这样的东西:</p><pre class="iy iz ja jb fd kk kl km kn aw ko bi"><span id="85a5" class="kp kq hi kl b fi kr ks l kt ku">string testString = "hello";<br/>string expectedOutput = testString.ToUpper();<br/>Assert.Equal(expectedOutput, "HELLO");</span></pre><p id="aedc" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果我们要使用流畅的断言来编写这个测试，我们可以这样做:</p><pre class="iy iz ja jb fd kk kl km kn aw ko bi"><span id="b1a8" class="kp kq hi kl b fi kr ks l kt ku">string testString = "hello";<br/>string expectedOutput = testString.ToUpper();<br/>expectedOutput.Should().Be("HELLO");</span></pre><p id="0466" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">看到了吗？更加自然😊</p><h1 id="bbd6" class="kv kq hi bd kw kx ky kz la lb lc ld le io lf ip lg ir lh is li iu lj iv lk ll bi translated">引入断言范围</h1><p id="bcba" class="pw-post-body-paragraph jn jo hi jp b jq lm ij js jt ln im jv jw lo jy jz ka lp kc kd ke lq kg kh ki hb bi translated">让我们用一个更广泛的例子。假设我有一个生成购物清单的类，如下所示:</p><pre class="iy iz ja jb fd kk kl km kn aw ko bi"><span id="1e9a" class="kp kq hi kl b fi kr ks l kt ku">public class ShoppingListGenerator<br/>    {<br/>        public static List&lt;Item&gt; GenerateItems()<br/>        {<br/>            return new List&lt;Item&gt;<br/>            {<br/>                new Item<br/>                {<br/>                    Name = "Apple",<br/>                    Quantity = 5<br/>                },<br/>                new Item<br/>                {<br/>                    Name = "Banana",<br/>                    Quantity = 1<br/>                },<br/>                new Item<br/>                {<br/>                    Name = "Orange",<br/>                    Quantity = 3<br/>                }<br/>            };<br/>        }<br/>    }</span></pre><p id="0b73" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">对于更复杂的单元测试，我们可能想要断言多个属性，如下所示:</p><pre class="iy iz ja jb fd kk kl km kn aw ko bi"><span id="1003" class="kp kq hi kl b fi kr ks l kt ku">public class ShoppingListGeneratorShould<br/>{<br/>    [Fact]<br/>    public void MultipleAssertions()<br/>    {<br/>       var testShoppingList = ShoppingListGenerator.GenerateItems();<br/>       testShoppingList.Should().NotBeNullOrEmpty();<br/>       testShoppingList.Should().Contain(new Item { Name = "Cheese", Quantity = 2 });<br/>       testShoppingList.Should().HaveCount(10);<br/>       testShoppingList.Should().OnlyHaveUniqueItems();           <br/>     }<br/>}</span></pre><p id="1c92" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这种方法很好，但是看看我们的代码，我们可以看到，如果断言我们的列表将在。Contain()方法，因为我们的列表中没有包含奶酪的条目。这个测试也会在我们的。HaveCount()方法，因为我们的列表中只有3项，而不是10项。</p><p id="8628" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">让我们通过运行测试来确认我们的想法。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lr"><img src="../Images/f75a570f505afc3e7408446e0d5a7621.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*c5vrUpeUpGjxOTo4.png"/></div></div></figure><p id="37a2" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们是正确的！但是在这个例子中，不仅我们的测试失败了。包含()方法，但它已经停止运行我们的测试！</p><p id="df94" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">假设我们修复了这个错误，使得断言通过，但是在下一个断言时失败。下一个，下一个，等等。</p><p id="3c8a" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">像这样测试我们的代码是相当乏味的。谢天谢地，我们可以使用断言范围来解决这个问题！</p><p id="ca83" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">使用断言作用域，我们可以将多个断言批处理到一个AssertionScope中，这样FluentAssertions将只在作用域的末尾抛出一个异常，并处理所有的失败。</p><p id="1779" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">让我们将测试改为使用断言范围:</p><pre class="iy iz ja jb fd kk kl km kn aw ko bi"><span id="af69" class="kp kq hi kl b fi kr ks l kt ku">using AssertionScopes;<br/>using FluentAssertions;<br/>using FluentAssertions.Execution;<br/>using System;<br/>using Xunit;<br/><br/>namespace Tests<br/>{<br/>    public class ShoppingListGeneratorShould<br/>    {<br/>        [Fact]<br/>        public void MultipleAssertions()<br/>        {<br/>            var testShoppingList = ShoppingListGenerator.GenerateItems();<br/><br/>            using (new AssertionScope())<br/>            {<br/>                testShoppingList.Should().NotBeNullOrEmpty();<br/>                testShoppingList.Should().Contain(new Item { Name = "Cheese", Quantity = 2 });<br/>                testShoppingList.Should().HaveCount(10);<br/>                testShoppingList.Should().OnlyHaveUniqueItems();<br/>            }                     <br/>        }<br/>    }<br/>}</span></pre><p id="9d88" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们现在将断言包装在using语句中，我们的异常将只在处理AssertionScope时抛出。</p><p id="5936" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">让我们运行测试，看看会发生什么！</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lr"><img src="../Images/1336332af3520af3e18e9d0b4a60e45b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TGy30qnNem32akWB.png"/></div></div></figure><p id="5a96" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们的测试失败了，但是现在我们得到了返回给我们的两个异常！</p><pre class="iy iz ja jb fd kk kl km kn aw ko bi"><span id="c079" class="kp kq hi kl b fi kr ks l kt ku">Message: <br/>    Expected testShoppingList {AssertionScopes.Item<br/>       {<br/>          Name = "Apple"<br/>          Quantity = 5<br/>       }, AssertionScopes.Item<br/>       {<br/>          Name = "Banana"<br/>          Quantity = 1<br/>       }, AssertionScopes.Item<br/>       {<br/>          Name = "Orange"<br/>          Quantity = 3<br/>       }} to contain <br/><br/>    AssertionScopes.Item<br/>    {<br/>       Name = "Cheese"<br/>       Quantity = 2<br/>    }.<br/>    Expected testShoppingList to contain 10 item(s), but found 3.</span></pre><p id="baec" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在，我们不必在每次测试中断言失败时都运行并重新运行我们的测试，我们可以一次看到测试中失败的所有断言！</p><h1 id="7ea2" class="kv kq hi bd kw kx ky kz la lb lc ld le io lf ip lg ir lh is li iu lj iv lk ll bi translated">结论</h1><p id="6c9f" class="pw-post-body-paragraph jn jo hi jp b jq lm ij js jt ln im jv jw lo jy jz ka lp kc kd ke lq kg kh ki hb bi translated">流畅的断言是一个很棒的库，它允许我们以一种更自然、更有表现力的方式编写C#测试。当在我们的单元测试中使用多个断言时，断言作用域使我们的生活变得更容易，因为它节省了我们找出测试失败原因的时间和精力。</p><p id="eca7" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果你想了解更多关于流畅断言的知识，可以查看这里的文档:【https://fluentassertions.com/about/<a class="ae kj" href="https://fluentassertions.com/about/" rel="noopener ugc nofollow" target="_blank"/></p><p id="1495" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我希望你从这篇文章中学到了一些东西！如果你有任何问题，请在下面评论或者在推特上联系我:<a class="ae kj" href="https://twitter.com/willvelida" rel="noopener ugc nofollow" target="_blank">https://twitter.com/willvelida</a></p><p id="49db" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">编码快乐！☕💻</p></div></div>    
</body>
</html>