<html>
<head>
<title>Deploy node application and Postgresql database to Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将节点应用程序和Postgresql数据库部署到Heroku</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/deploy-node-application-and-postgresql-database-to-heroku-6efaa6be3b9b?source=collection_archive---------7-----------------------#2021-05-25">https://medium.com/geekculture/deploy-node-application-and-postgresql-database-to-heroku-6efaa6be3b9b?source=collection_archive---------7-----------------------#2021-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/61b64364a95fc08b8b07ca4c1309b106.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oo1NRU9BKRYaZNydoKlpcQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Heroku Postgres</figcaption></figure><p id="376a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在全栈开发中，部署全栈应用是一件非常棒的事情。由于部署在Heroku上起初看起来令人生畏，我把部署一个工作的全栈应用需要遵循的所有步骤放在一起。这是一件迅速而直接的事。</p><p id="3564" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="js">创建PostgreSQL数据库和设置express应用程序超出了本博客的范围。</em></p><p id="c5fe" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你应该做的第一件事是在。env文件，基本应用程序所需的变量如下。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="aa93" class="kc kd hi jy b fi ke kf l kg kh">jwtSecret=lucky11<br/>PG_USER= postgres_user<br/>PG_PASSWORD= password<br/>PG_HOST= localhost<br/>PG_PORT= 5432<br/>PG_DATABASE= database_name<br/>NODE_ENV=development</span></pre><p id="cdfb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="js">确保你的</em><strong class="iw hj"><em class="js">git ignore</em></strong><em class="js">the。env文件，因为保持这些环境变量打开和可访问是一件不安全的事情。</em></p><p id="ec33" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，你应该检查的下一件事是你<strong class="iw hj">正确地</strong>编写了你的数据库连接程序，下面的代码举例说明了一个合适的<strong class="iw hj">数据库连接程序</strong>，用于在开发和生产中运行全栈应用。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="292b" class="kc kd hi jy b fi ke kf l kg kh">const Pool = require("pg").Pool;<br/>require("dotenv").config();</span><span id="c6bd" class="kc kd hi jy b fi ki kf l kg kh">const isProduction = process.env.NODE_ENV === "production";</span><span id="bceb" class="kc kd hi jy b fi ki kf l kg kh">const connectionString = `postgresql://${process.env.PG_USER}:${process.env.PG_PASSWORD}@${process.env.PG_HOST}:${process.env.PG_PORT}/${process.env.PG_DATABASE}`;</span><span id="c499" class="kc kd hi jy b fi ki kf l kg kh">const pool = new Pool({<br/>    connectionString: isProduction ? process.env.DATABASE_URL : connectionString,<br/>    ssl: {<br/>        rejectUnauthorized: false,<br/>    },<br/>});<br/>module.exports = pool;</span></pre><p id="c3bc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="js">connectionString变量是将数据库连接到应用程序的变量，所以要确保连接字符串的拼写正确。</em></p><p id="be83" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你想在<strong class="iw hj">开发中运行你的应用程序，</strong>注释掉<strong class="iw hj"> SSL </strong>代码块。因为开发服务器不支持SSL。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="5c1d" class="kc kd hi jy b fi ke kf l kg kh">ssl: {<br/>        rejectUnauthorized: false,<br/>    },</span></pre><p id="0cb9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">但是一定要为生产添加SSL，这是用户在Heroku部署中最容易出错的地方。</p><p id="ca01" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">需要注意的一件重要事情是，在部署之后，Heroku将运行<strong class="iw hj">“开始”脚本</strong>，所以要确保你在<strong class="iw hj"> package.json </strong>中正确地添加了它</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="d169" class="kc kd hi jy b fi ke kf l kg kh">"script":{<br/> "start":"node index.js"<br/>}</span></pre><p id="8004" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您必须添加的另一个文件是<strong class="iw hj">Procfile.txt .</strong>web:node index . js将这一行添加到procfile . txt</p><p id="aeb4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在你已经在代码编辑器中准备好了，剩下的就是将它部署到Heroku并设置Heroku</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kj"><img src="../Images/35dc3c89fef3b30dbc0a1a11beb59a24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iSBDpkkDrlWWMtCnZ2ZNuA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">heroku</figcaption></figure><p id="d4ce" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">注册/登录到<a class="ae kk" href="http://www.heroku.com" rel="noopener ugc nofollow" target="_blank"><em class="js">www.heroku.com</em></a>，进入新建&gt;创建新应用开始。</p><p id="220b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">添加应用名称和地区，并点击<strong class="iw hj">创建应用。</strong></p><p id="eb53" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在部署方法中，选择<strong class="iw hj"> Github </strong>，搜索您想要选择的repo名称，同时在同一个选项卡上点击<strong class="iw hj">启用自动部署</strong>。完成上述操作后，点击手动部署部分的<strong class="iw hj">部署分支</strong>。</p><p id="3b21" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">正确完成上述步骤后，您将看到以下消息。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/dc48c17177e7c1d23cfbeaee7f3ef977.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1p7zgp3ofFhMycaNhVaoHQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">heroku</figcaption></figure><p id="3a74" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们需要将Postgresql数据库添加到Heroku。</p><p id="1c46" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为此，转到“<strong class="iw hj">资源</strong>标签搜索<strong class="iw hj"> Heroku-Postgres </strong>附加组件，然后选择<strong class="iw hj">爱好开发免费</strong>版本的免费东西，然后点击<strong class="iw hj">供应</strong>按钮。</p><p id="7fa8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">返回<strong class="iw hj">资源</strong>选项卡，点击<strong class="iw hj"> Heroku Postgres </strong>，您将能够看到下图，其中表格显示为0。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es km"><img src="../Images/9d7570e5b1463618fb69ffcc56cec0d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EhlLhMirkxFNhPYoPvNTDg.png"/></div></div></figure><p id="6c71" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">连接到数据库。</strong></p><p id="783e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Heroku将生成<strong class="iw hj"> DATABASE_URL </strong>，您也可以使用它来连接Heroku生成的数据库。</p><p id="c8d6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这可以在<strong class="iw hj">设置</strong>和<strong class="iw hj">显示配置变量</strong>中找到。</p><p id="d9b7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">重要</strong> : <em class="js">在Heroku </em> <strong class="iw hj"> <em class="js">设置</em> </strong> <em class="js">选项卡&gt;点击</em> <strong class="iw hj"> <em class="js">显示配置变量</em> </strong> <em class="js">现在将所有的环境变量添加到Heroku中。</em> <strong class="iw hj"> <em class="js"> env文件</em> </strong>。</p><p id="37a6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您必须添加一个新的环境变量并更改一个现有的环境变量，即<strong class="iw hj">NODE _ ENV = production</strong><br/>并添加<strong class="iw hj"> PGSSLMODE=require </strong></p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/5d771da06ad193d6e8f91f82282ad3d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LGPsXeSq4964QI9Yzu8UYg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">environment variables in Heroku</figcaption></figure><p id="ba9c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在转到您的<strong class="iw hj"> psql </strong>并运行以下命令。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es ko"><img src="../Images/5ac76cf6756ff82b9fcf2a2738aab1dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*zC2qtd3egpzPNyOiaSCP3Q.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">run in psql</figcaption></figure></div></div>    
</body>
</html>