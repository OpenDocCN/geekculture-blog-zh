<html>
<head>
<title>ElasticSearch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">弹性搜索</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/elasticsearch-aeb867a1f805?source=collection_archive---------20-----------------------#2021-04-09">https://medium.com/geekculture/elasticsearch-aeb867a1f805?source=collection_archive---------20-----------------------#2021-04-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="fb04" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated"><strong class="ak">什么是ElasticSearch？</strong></h2></div><p id="048d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> Elasticsearch </strong>是一个分布式、免费和开放的搜索和分析引擎，适用于所有类型的数据，包括文本、数字、地理空间、结构化和非结构化数据。</p><p id="7d72" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">为什么选择ElasticSearch？</strong></p><p id="d430" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> Elasticsearch </strong>允许你快速、近乎实时地存储、搜索和分析海量数据，并在几毫秒内给出答案。它能够实现快速搜索响应，因为它不是直接搜索文本，而是搜索索引。</p><h1 id="38ac" class="jt ju hi bd jv jw jx jy jz ka kb kc kd io ke ip kf ir kg is kh iu ki iv kj kk bi translated">索引</h1><p id="d58f" class="pw-post-body-paragraph ix iy hi iz b ja kl ij jc jd km im jf jg kn ji jj jk ko jm jn jo kp jq jr js hb bi translated">Elasticsearch能够实现快速搜索响应，因为它不是直接搜索文本，而是搜索索引。</p><p id="e6e6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就像通过扫描书后面的索引来检索书中与关键字相关的页面，而不是搜索书的每一页的每个单词。</p><p id="57f4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这种类型的索引被称为<strong class="iz hj">倒排索引</strong>，因为它将以页面为中心的数据结构(page- &gt; words)转换为以关键字为中心的数据结构(word- &gt; pages)。</p><p id="e814" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Elasticsearch使用Apache Lucene来创建和管理这个倒排索引。</p><p id="9a9b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于索引文档，ElasticSearch使用一个分析器。</p><figure class="kr ks kt ku fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es kq"><img src="../Images/1437e99c127e5352197a8fe1a80efd8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SOR69v83RESgANXb5Bm_Tw.png"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx">Indexing Process</figcaption></figure><p id="bf99" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">分析器</strong>是记号化器<strong class="iz hj">和过滤器</strong>的组合，可应用于弹性研究中的任何分析领域。Elasticsearch中已经有内置的分析器可用。您也可以创建自己的定制分析器。这里 可以阅读内置分析器<a class="ae lg" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-analyzers.html" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj">。</strong></a></p><p id="0de1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">文件1 </strong></p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="833a" class="lm ju hi li b fi ln lo l lp lq">{<br/> "name" : "my name in luv"<br/>}</span></pre><p id="c9c6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">文件2</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="d4ae" class="lm ju hi li b fi ln lo l lp lq">{<br/> "name": "my father name is ram"<br/>}</span></pre><p id="9aa2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在标准分析器之后，文档中的术语如下</p><p id="2331" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">文件1 </strong></p><p id="ac46" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">字段术语</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="8127" class="lm ju hi li b fi ln lo l lp lq">"name": "my","name","is","luv"</span></pre><p id="3649" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">文件二</strong></p><p id="9e6b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">字段术语</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="09b5" class="lm ju hi li b fi ln lo l lp lq">"name" : "my","father","name","is","ram"</span></pre><p id="9a7b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，让我们将上面两个“名称”字段术语表合并成一个，如下所示:</p><figure class="kr ks kt ku fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es lr"><img src="../Images/2667511b1f9c30ba3536d1f0894cfcbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yGzVzGPqFXwHOolEj9JMoQ.png"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx">Visual Representation of an Inverted Index</figcaption></figure><p id="45cd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在上面的表被称为字段“name”的倒排索引。使用倒排索引的优点是，可以在“terms”列中查找搜索术语，然后，如果有匹配，查找搜索术语所在的文档是在相应列中查找的非常简单的工作。</p><p id="84a4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以检查哪个分析器应用于索引中的任何字段，如下所示</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="65d1" class="lm ju hi li b fi ln lo l lp lq">GET &lt;index&gt;/_analyze<br/>{<br/>  "text": "software engineer blr",<br/>  "field": "&lt;ur_field&gt;"<br/>}</span></pre><p id="e7ba" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">弹性搜索基本储物概念</strong></p><p id="38be" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">文档</strong>是存储在弹性搜索索引中的JSON对象，被认为是存储的基本单元。</p><p id="958d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一份文件的例子:</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="0a25" class="lm ju hi li b fi ln lo l lp lq">{<br/>   "_id": 3,<br/>   “_index”: [“your index name”],<br/>   "_source":{<br/>   "age": 28,<br/>   "name": ["daniel”],<br/>   "year":1989,<br/>}</span></pre><p id="746f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">映射</strong>它为特定类型的文档定义了<em class="ls">字段</em>——数据类型(如关键字、文本和long)以及这些字段应该如何在Elasticsearch中进行索引和存储。</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="86c4" class="lm ju hi li b fi ln lo l lp lq">{<br/>  "mappings": {<br/>      "properties": {<br/>        "name": {<br/>          "type": "keyword"<br/>        },<br/>        "age": {<br/>          "type": "long"<br/>        },<br/>        "year": {<strong class="li hj"><br/></strong>          "type": "long"<br/>        }<br/>      }<br/>    }<br/>}</span></pre><p id="af45" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">索引</strong>索引是Elasticsearch中最大的数据单位，是文档的逻辑分区，可以比作关系数据库世界中的一个数据库。</p><p id="c986" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">碎片</strong>简单地说，碎片是一个单一的Lucene索引。它们是Elasticsearch的组成部分，也是促进其可扩展性的因素。</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="9ff6" class="lm ju hi li b fi ln lo l lp lq">curl -XPUT localhost:9200/example -d '{<br/>  "settings" : {<br/>    "index" : {<br/>      "number_of_shards" : 3, <br/>      "number_of_replicas" : 1 <br/>    }<br/>  }<br/>}'</span></pre><p id="4136" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">副本</strong>是主分片的副本，防止硬件故障时数据丢失。默认情况下，Elastisearch中的每个索引分配有5个主碎片和1个副本，这意味着如果集群中至少有两个节点，那么索引将有5个主碎片和另外5个副本碎片(1个完整副本)，每个索引总共有10个碎片。</p><p id="88a5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">节点</strong>任何时候启动一个Elasticsearch实例，都是在启动一个<em class="ls">节点</em>。更多阅读请参考<a class="ae lg" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-analyzers.html" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj">和</strong> </a>。</p><p id="d501" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">集群</strong>连接节点的集合称为<a class="ae lg" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-analyzers.html" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj">集群</strong> </a>。</p><figure class="kr ks kt ku fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es lt"><img src="../Images/ca6e0479db39321f35652c3a2e3508a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ads3HgHZO2jzo-UXbPLf7Q.png"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx">Typical Elastic CLuser</figcaption></figure><p id="858c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">查询示例</strong>对于每个示例，我们将创建一个新的索引，其中包含根据需要定制的数据。我使用Kibana是因为它们易于配置，并且有非常直观的用户界面。</p><p id="3a66" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将对所有三个查询“术语”、“文本”、“嵌套”使用相同的索引。</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="f22d" class="lm ju hi li b fi ln lo l lp lq">PUT /test-index</span><span id="d1f4" class="lm ju hi li b fi lu lo l lp lq">PUT /test-index/_mapping<br/>{<br/>  "properties": {<br/>    "firstname": {<br/>      "type": "keyword"<br/>    },<br/>    "lastname": {<br/>      "type": "keyword"<br/>    },<br/>    "fullname": {<br/>      "type": "text"<br/>    },<br/>    "age": {<br/>      "type": "long"<br/>    },<br/>    "friends": {<br/>      "type": "nested"<br/>    }<br/>  }<br/>}</span><span id="1978" class="lm ju hi li b fi lu lo l lp lq">POST /test-index/_doc<br/>{<br/>  "firstname": "Jay",<br/>  "lastname": "Prakash",<br/>  "fullname": "Jay Prakash",<br/>  "age": 30,<br/>  "friends":[{"friendname": "Adarsh"}, {"friendname": "Jaismin"}<br/>    ]<br/>}</span><span id="b463" class="lm ju hi li b fi lu lo l lp lq">POST /test-index/_doc<br/>{<br/>  "firstname": "Viral",<br/>  "lastname": "Prasad",<br/>  "fullname": "Viral Prasad",<br/>  "age": 30,<br/>  "friends":[{"friendname": "Lovenish"}, {"friendname": "Sandeep"}, {"friendname": "Shashank"}<br/>    ]<br/>}</span><span id="74fe" class="lm ju hi li b fi lu lo l lp lq">POST /test-index/_doc<br/>{<br/>  "firstname": "Sandeep",<br/>  "lastname": "Dash",<br/>  "fullname": "Viral Prasad",<br/>  "age": 30,<br/>  "friends":[{"friendname": "Jaismin"}, {"friendname": "Adarsh"}, {"friendname": "Shashank"}<br/>    ]<br/>}</span></pre><p id="6068" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae lg" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj">术语查询</strong> </a> <strong class="iz hj"> </strong>返回在提供的字段中包含<strong class="iz hj">精确</strong>术语的文档。这主要用于“<strong class="iz hj">关键字</strong>”类型字段。</p><ol class=""><li id="0a90" class="lv lw hi iz b ja jb jd je jg lx jk ly jo lz js ma mb mc md bi translated">获取名字为Jay的用户</li></ol><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="7a96" class="lm ju hi li b fi ln lo l lp lq">GET /test-index/_search<br/>{<br/>  "query": {<br/>    "bool": {<br/>      "must": [<br/>        {"term": {<br/>          "firstname": {<br/>            "value": "Jay"<br/>          }<br/>        }}<br/>      ]<br/>    }<br/>  }<br/>}</span></pre><p id="e357" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">结果</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="ca34" class="lm ju hi li b fi ln lo l lp lq">{<br/>  "took" : 4,<br/>  "timed_out" : false,<br/>  "_shards" : {<br/>    "total" : 5,<br/>    "successful" : 5,<br/>    "skipped" : 0,<br/>    "failed" : 0<br/>  },<br/>  "hits" : {<br/>    "total" : {<br/>      "value" : 1,<br/>      "relation" : "eq"<br/>    },<br/>    "max_score" : 0.2876821,<br/>    "hits" : [<br/>      {<br/>        "_index" : "test-index",<br/>        "_type" : "_doc",<br/>        "_id" : "lSUVtHgBw7rVVucQG7xH",<br/>        "_score" : 0.2876821,<br/>        "_source" : {<br/>          "firstname" : "Jay",<br/>          "lastname" : "Prakash",<br/>          "fullname" : "Jay Prakash",<br/>          "age" : 30,<br/>          "friends" : [<br/>            {<br/>              "friendname" : "Adarsh"<br/>            },<br/>            {<br/>              "friendname" : "Jaismin"<br/>            }<br/>          ]<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="2e36" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">对名字和姓氏的查询也将区分大小写。因为关键词是按原样存储在ElasticSearch索引中的。</strong></p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="6ca2" class="lm ju hi li b fi ln lo l lp lq">GET /test-index/_search<br/>{<br/>  "query": {<br/>    "bool": {<br/>      "must": [<br/>        {"term": {<br/>          "firstname": {<br/>            "value": "Jay"<br/>          }<br/>        }}<br/>      ]<br/>    }<br/>  }<br/>}</span></pre><p id="7484" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面的查询不会给你任何结果。</p><p id="7e6a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.在同一个字段上查询多个值。</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="db2c" class="lm ju hi li b fi ln lo l lp lq">GET /test-index/_search<br/>{<br/>  "query": {<br/>    "bool": {"must": [<br/>      {"terms": {<br/>        "firstname": [<br/>          "Jay",<br/>          "Viral"<br/>        ]<br/>      }}<br/>    ]}<br/>  }<br/>}</span></pre><p id="2816" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">结果</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="9930" class="lm ju hi li b fi ln lo l lp lq">{<br/>  "took" : 171,<br/>  "timed_out" : false,<br/>  "_shards" : {<br/>    "total" : 5,<br/>    "successful" : 5,<br/>    "skipped" : 0,<br/>    "failed" : 0<br/>  },<br/>  "hits" : {<br/>    "total" : {<br/>      "value" : 2,<br/>      "relation" : "eq"<br/>    },<br/>    "max_score" : 1.0,<br/>    "hits" : [<br/>      {<br/>        "_index" : "test-index",<br/>        "_type" : "_doc",<br/>        "_id" : "lSUVtHgBw7rVVucQG7xH",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "firstname" : "Jay",<br/>          "lastname" : "Prakash",<br/>          "fullname" : "Jay Prakash",<br/>          "age" : 30,<br/>          "friends" : [<br/>            {<br/>              "friendname" : "Adarsh"<br/>            },<br/>            {<br/>              "friendname" : "Jaismin"<br/>            }<br/>          ]<br/>        }<br/>      },<br/>      {<br/>        "_index" : "test-index",<br/>        "_type" : "_doc",<br/>        "_id" : "y04VtHgBBK0Ei3S1KHhq",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "firstname" : "Viral",<br/>          "lastname" : "Prasad",<br/>          "fullname" : "Viral Prasad",<br/>          "age" : 30,<br/>          "friends" : [<br/>            {<br/>              "friendname" : "Lovenish"<br/>            },<br/>            {<br/>              "friendname" : "Sandeep"<br/>            },<br/>            {<br/>              "friendname" : "Shashank"<br/>            }<br/>          ]<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="63ea" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae lg" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/full-text-queries.html" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj">全文查询</strong> </a> <strong class="iz hj"> </strong>全文查询使您能够搜索<a class="ae lg" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis.html" rel="noopener ugc nofollow" target="_blank">已分析的文本字段</a>，例如电子邮件的正文。使用在索引期间应用于字段的同一分析器来处理查询字符串。</p><p id="c6d2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面的所有查询都将给出输入，因为“全名”在用标准分析器分析后存储在索引中。如果没有指定，默认情况下，ElasticSearch对文本字段使用模糊匹配。</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="0540" class="lm ju hi li b fi ln lo l lp lq">GET /test-index/_search<br/>{<br/>  "query": {"bool": {<br/>    "must": [<br/>      {<br/>        "match": {<br/>          "fullname": "jay"<br/>        }<br/>      }<br/>    ]<br/>  }}<br/>}</span><span id="f01b" class="lm ju hi li b fi lu lo l lp lq">GET /test-index/_search<br/>{<br/>  "query": {"bool": {<br/>    "must": [<br/>      {<br/>        "match": {<br/>          "fullname": "JAy"<br/>        }<br/>      }<br/>    ]<br/>  }}<br/>}</span><span id="abcc" class="lm ju hi li b fi lu lo l lp lq">GET /test-index/_search<br/>{<br/>  "query": {"bool": {<br/>    "must": [<br/>      {<br/>        "match": {<br/>          "fullname": "prakash"<br/>        }<br/>      }<br/>    ]<br/>  }}<br/>}</span></pre><p id="4037" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">结果</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="9852" class="lm ju hi li b fi ln lo l lp lq">{<br/>  "took" : 5,<br/>  "timed_out" : false,<br/>  "_shards" : {<br/>    "total" : 5,<br/>    "successful" : 5,<br/>    "skipped" : 0,<br/>    "failed" : 0<br/>  },<br/>  "hits" : {<br/>    "total" : {<br/>      "value" : 1,<br/>      "relation" : "eq"<br/>    },<br/>    "max_score" : 0.2876821,<br/>    "hits" : [<br/>      {<br/>        "_index" : "test-index",<br/>        "_type" : "_doc",<br/>        "_id" : "lSUVtHgBw7rVVucQG7xH",<br/>        "_score" : 0.2876821,<br/>        "_source" : {<br/>          "firstname" : "Jay",<br/>          "lastname" : "Prakash",<br/>          "fullname" : "Jay Prakash",<br/>          "age" : 30,<br/>          "friends" : [<br/>            {<br/>              "friendname" : "Adarsh"<br/>            },<br/>            {<br/>              "friendname" : "Jaismin"<br/>            }<br/>          ]<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="e813" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae lg" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-nested-query.html" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj">嵌套查询</strong> </a> <strong class="iz hj"> </strong>包装另一个查询来搜索<a class="ae lg" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/nested.html" rel="noopener ugc nofollow" target="_blank">嵌套的</a>字段。</p><p id="b181" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">获取所有和贾西敏是朋友的用户</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="be71" class="lm ju hi li b fi ln lo l lp lq">GET /test-index/_search<br/>{<br/>  "query": {"bool": {<br/>    "must": [<br/>      {<br/>        "nested": {<br/>          "path": "friends",<br/>          "query": {<br/>            "term": {<br/>              "friends.friendname.keyword": {<br/>                "value": "Jaismin"<br/>              }<br/>            }<br/>          }<br/>        }<br/>      }<br/>    ]<br/>  }}<br/>}</span></pre><p id="c99d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">结果</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="770b" class="lm ju hi li b fi ln lo l lp lq">{<br/>  "took" : 1023,<br/>  "timed_out" : false,<br/>  "_shards" : {<br/>    "total" : 5,<br/>    "successful" : 5,<br/>    "skipped" : 0,<br/>    "failed" : 0<br/>  },<br/>  "hits" : {<br/>    "total" : {<br/>      "value" : 2,<br/>      "relation" : "eq"<br/>    },<br/>    "max_score" : 0.9808291,<br/>    "hits" : [<br/>      {<br/>        "_index" : "test-index",<br/>        "_type" : "_doc",<br/>        "_id" : "604rtHgBBK0Ei3S1aXjk",<br/>        "_score" : 0.9808291,<br/>        "_source" : {<br/>          "firstname" : "Sandeep",<br/>          "lastname" : "Dash",<br/>          "fullname" : "Viral Prasad",<br/>          "age" : 30,<br/>          "friends" : [<br/>            {<br/>              "friendname" : "Jaismin"<br/>            },<br/>            {<br/>              "friendname" : "Adarsh"<br/>            },<br/>            {<br/>              "friendname" : "Shashank"<br/>            }<br/>          ]<br/>        }<br/>      },<br/>      {<br/>        "_index" : "test-index",<br/>        "_type" : "_doc",<br/>        "_id" : "lSUVtHgBw7rVVucQG7xH",<br/>        "_score" : 0.6931471,<br/>        "_source" : {<br/>          "firstname" : "Jay",<br/>          "lastname" : "Prakash",<br/>          "fullname" : "Jay Prakash",<br/>          "age" : 30,<br/>          "friends" : [<br/>            {<br/>              "friendname" : "Adarsh"<br/>            },<br/>            {<br/>              "friendname" : "Jaismin"<br/>            }<br/>          ]<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="3f72" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> Suggester </strong>使用Suggester根据提供的文本建议相似的术语。如果你看到ElasticSearch文档，你会看到这样的文字“建议功能的部分仍在开发中。”但是从6.4开始，我已经经历了多次ElasticSearch的变更日志，但是除了错误修复之外，我没有看到任何东西，所以我相信它使用起来相当稳定。</p><p id="3274" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">三种类型的建议者</p><ol class=""><li id="ee0d" class="lv lw hi iz b ja jb jd je jg lx jk ly jo lz js ma mb mc md bi translated">完成</li><li id="a611" class="lv lw hi iz b ja me jd mf jg mg jk mh jo mi js ma mb mc md bi translated">学期</li><li id="ea46" class="lv lw hi iz b ja me jd mf jg mg jk mh jo mi js ma mb mc md bi translated">短语</li></ol><p id="7ce6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">完工建议者</strong></p><ol class=""><li id="f35c" class="lv lw hi iz b ja jb jd je jg lx jk ly jo lz js ma mb mc md bi translated">提供自动完成功能</li><li id="ae36" class="lv lw hi iz b ja me jd mf jg mg jk mh jo mi js ma mb mc md bi translated">仅基于前缀工作</li><li id="5ab3" class="lv lw hi iz b ja me jd mf jg mg jk mh jo mi js ma mb mc md bi translated">将数据存储在名为<a class="ae lg" href="https://en.wikipedia.org/wiki/Finite-state_transducer" rel="noopener ugc nofollow" target="_blank">的特殊数据结构中，有限状态传感器</a>用于检测速度。这存储在内存中</li></ol><p id="fbcd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将创建一个带有两个字段标题和建议的索引“<code class="du mj mk ml li b">test-completion</code>”，如下所示。</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="1be1" class="lm ju hi li b fi ln lo l lp lq">PUT /test-completion<br/>PUT /test-completion/_mapping<br/>{<br/>  "properties" :{<br/>    "title":{<br/>      "type": "keyword"<br/>    },<br/>    "suggest": {<br/>      "type": "completion"<br/>    }<br/>  }<br/>}</span></pre><p id="ebae" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们在索引中插入四个文档</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="0e56" class="lm ju hi li b fi ln lo l lp lq">POST /test-completion/_doc<br/>{<br/>  "title": "Software Developer",<br/>  "suggest": ["Software", "Developer"]<br/>}</span><span id="4754" class="lm ju hi li b fi lu lo l lp lq">POST /test-completion/_doc<br/>{<br/>  "title": "Software Engineer",<br/>  "suggest": ["Software", "Engineer"]<br/>}</span><span id="78c1" class="lm ju hi li b fi lu lo l lp lq">POST /test-completion/_doc<br/>{<br/>  "title": "Software",<br/>  "suggest": ["Software"]<br/>}</span><span id="b511" class="lm ju hi li b fi lu lo l lp lq">POST /test-completion/_doc<br/>{<br/>  "title": "Abs",<br/>  "suggest": ["Abs is aabsolute system"]<br/>}</span></pre><p id="8068" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以通过搜索所有内容来查看结果</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="87a1" class="lm ju hi li b fi ln lo l lp lq">GET /test-completion/_search{}</span></pre><p id="be8a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您将会看到类似这样的输出。</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="be40" class="lm ju hi li b fi ln lo l lp lq">{<br/>  "took" : 3,<br/>  "timed_out" : false,<br/>  "_shards" : {<br/>    "total" : 5,<br/>    "successful" : 5,<br/>    "skipped" : 0,<br/>    "failed" : 0<br/>  },<br/>  "hits" : {<br/>    "total" : {<br/>      "value" : 4,<br/>      "relation" : "eq"<br/>    },<br/>    "max_score" : 1.0,<br/>    "hits" : [<br/>      {<br/>        "_index" : "test-completion",<br/>        "_type" : "_doc",<br/>        "_id" : "c6aFs3gBlUt7Kuo2Rfuc",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "title" : "Software Engineer",<br/>          "suggest" : [<br/>            "Software",<br/>            "Engineer"<br/>          ]<br/>        }<br/>      },<br/>      {<br/>        "_index" : "test-completion",<br/>        "_type" : "_doc",<br/>        "_id" : "fE6Ks3gBBK0Ei3S1NXjA",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "title" : "Abs",<br/>          "suggest" : [<br/>            "Abs is aabsolute system"<br/>          ]<br/>        }<br/>      },<br/>      {<br/>        "_index" : "test-completion",<br/>        "_type" : "_doc",<br/>        "_id" : "baaEs3gBlUt7Kuo2Bfuk",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "title" : "Software Developer",<br/>          "suggest" : [<br/>            "Software",<br/>            "Developer"<br/>          ]<br/>        }<br/>      },<br/>      {<br/>        "_index" : "test-completion",<br/>        "_type" : "_doc",<br/>        "_id" : "a06Es3gBBK0Ei3S1MXiI",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "title" : "Software",<br/>          "suggest" : [<br/>            "Software"<br/>          ]<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><ol class=""><li id="859b" class="lv lw hi iz b ja jb jd je jg lx jk ly jo lz js ma mb mc md bi translated">带软前缀的自动完成</li></ol><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="9082" class="lm ju hi li b fi ln lo l lp lq">GET /test-completion/_search<br/>{<br/>  "suggest": {<br/>    "autocoplete": {<br/>      "prefix":"soft",<br/>      "completion":{<br/>        "field": "suggest",<br/>        "skip_duplicates": true<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="98f9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">结果</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="78c8" class="lm ju hi li b fi ln lo l lp lq">{<br/>  "took" : 5,<br/>  "timed_out" : false,<br/>  "_shards" : {<br/>    "total" : 5,<br/>    "successful" : 5,<br/>    "skipped" : 0,<br/>    "failed" : 0<br/>  },<br/>  "hits" : {<br/>    "total" : {<br/>      "value" : 0,<br/>      "relation" : "eq"<br/>    },<br/>    "max_score" : null,<br/>    "hits" : [ ]<br/>  },<br/>  "suggest" : {<br/>    "autocoplete" : [<br/>      {<br/>        "text" : "soft",<br/>        "offset" : 0,<br/>        "length" : 4,<br/>        "options" : [<br/>          {<br/>            "text" : "Software",<br/>            "_index" : "test-completion",<br/>            "_type" : "_doc",<br/>            "_id" : "c6aFs3gBlUt7Kuo2Rfuc",<br/>            "_score" : 1.0,<br/>            "_source" : {<br/>              "title" : "Software Engineer",<br/>              "suggest" : [<br/>                "Software",<br/>                "Engineer"<br/>              ]<br/>            }<br/>          }<br/>        ]<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="e9d4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.使用前缀Abs自动完成</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="7217" class="lm ju hi li b fi ln lo l lp lq">GET /test-completion/_search<br/>{<br/>  "_source": false,<br/>  "suggest": {<br/>    "autocoplete": {<br/>      "prefix":"abs",<br/>      "completion":{<br/>        "field": "suggest",<br/>        "skip_duplicates": true<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="3fe9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">结果</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="9dad" class="lm ju hi li b fi ln lo l lp lq">{<br/>  "took" : 3,<br/>  "timed_out" : false,<br/>  "_shards" : {<br/>    "total" : 5,<br/>    "successful" : 5,<br/>    "skipped" : 0,<br/>    "failed" : 0<br/>  },<br/>  "hits" : {<br/>    "total" : {<br/>      "value" : 0,<br/>      "relation" : "eq"<br/>    },<br/>    "max_score" : null,<br/>    "hits" : [ ]<br/>  },<br/>  "suggest" : {<br/>    "autocoplete" : [<br/>      {<br/>        "text" : "abs",<br/>        "offset" : 0,<br/>        "length" : 3,<br/>        "options" : [<br/>          {<br/>            "text" : "Abs is aabsolute system",<br/>            "_index" : "test-completion",<br/>            "_type" : "_doc",<br/>            "_id" : "fE6Ks3gBBK0Ei3S1NXjA",<br/>            "_score" : 1.0<br/>          }<br/>        ]<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="71e3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">自动完成也支持模糊性。这在打字错误的情况下很有帮助。</strong></p><p id="19d2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.键入时自动完成</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="9854" class="lm ju hi li b fi ln lo l lp lq">GET /test-completion/_search<br/>{<br/>  "_source": false,<br/>  "suggest": {<br/>    "autocoplete": {<br/>      "prefix":"dve",<br/>      "completion":{<br/>        "field": "suggest",<br/>        "skip_duplicates": true,<br/>        "fuzzy":{<br/>          "fuzziness": "auto"<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="1d7d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">结果</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="3f3e" class="lm ju hi li b fi ln lo l lp lq">{<br/>  "took" : 7,<br/>  "timed_out" : false,<br/>  "_shards" : {<br/>    "total" : 5,<br/>    "successful" : 5,<br/>    "skipped" : 0,<br/>    "failed" : 0<br/>  },<br/>  "hits" : {<br/>    "total" : {<br/>      "value" : 0,<br/>      "relation" : "eq"<br/>    },<br/>    "max_score" : null,<br/>    "hits" : [ ]<br/>  },<br/>  "suggest" : {<br/>    "autocoplete" : [<br/>      {<br/>        "text" : "dve",<br/>        "offset" : 0,<br/>        "length" : 3,<br/>        "options" : [<br/>          {<br/>            "text" : "Developer",<br/>            "_index" : "test-completion",<br/>            "_type" : "_doc",<br/>            "_id" : "baaEs3gBlUt7Kuo2Bfuk",<br/>            "_score" : 1.0<br/>          }<br/>        ]<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="edcb" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">如果您密切关注，您会注意到最后两个结果没有_source字段。当您对大型数据集进行自动完成时，这是一个很好的技术。</strong></p><p id="d174" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">术语建议者</strong></p><ol class=""><li id="1ada" class="lv lw hi iz b ja jb jd je jg lx jk ly jo lz js ma mb mc md bi translated">用于纠正用户的拼写</li><li id="2605" class="lv lw hi iz b ja me jd mf jg mg jk mh jo mi js ma mb mc md bi translated">基于编辑距离。(编辑距离基本上就是需要改变多少个字符来匹配术语。比如“softwwere”就是离软件一个距离。)</li></ol><p id="46f2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建一个索引"<code class="du mj mk ml li b">test-term</code>"并为其创建映射。</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="32fd" class="lm ju hi li b fi ln lo l lp lq">PUT /test-term</span><span id="0112" class="lm ju hi li b fi lu lo l lp lq">PUT /test-term/_mapping<br/>{<br/>  "properties":{<br/>    "title": {<br/>      "type": "text"<br/>    }<br/>  }<br/>}</span></pre><p id="aaa7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在里面插入一些文件。</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="548e" class="lm ju hi li b fi ln lo l lp lq">POST /test-term/_doc<br/>{<br/>  "title": "Senior Software Engineer"<br/>}</span><span id="aebb" class="lm ju hi li b fi lu lo l lp lq">POST /test-term/_doc<br/>{<br/>  "title": "Senior Software Engineer Test"<br/>}</span><span id="4003" class="lm ju hi li b fi lu lo l lp lq">POST /test-term/_doc<br/>{<br/>  "title": "Senior Software Anlyst Test"<br/>}</span></pre><p id="c72d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">查看其中的所有文档。</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="00f5" class="lm ju hi li b fi ln lo l lp lq">GET /test-term/_search {}</span><span id="e264" class="lm ju hi li b fi lu lo l lp lq">{<br/>  "took" : 353,<br/>  "timed_out" : false,<br/>  "_shards" : {<br/>    "total" : 5,<br/>    "successful" : 5,<br/>    "skipped" : 0,<br/>    "failed" : 0<br/>  },<br/>  "hits" : {<br/>    "total" : {<br/>      "value" : 3,<br/>      "relation" : "eq"<br/>    },<br/>    "max_score" : 1.0,<br/>    "hits" : [<br/>      {<br/>        "_index" : "test-term",<br/>        "_type" : "_doc",<br/>        "_id" : "kaams3gBlUt7Kuo2YPtl",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "title" : "Senior Software Anlyst Test"<br/>        }<br/>      },<br/>      {<br/>        "_index" : "test-term",<br/>        "_type" : "_doc",<br/>        "_id" : "iU6ms3gBBK0Ei3S1U3gQ",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "title" : "Senior Software Engineer Test"<br/>        }<br/>      },<br/>      {<br/>        "_index" : "test-term",<br/>        "_type" : "_doc",<br/>        "_id" : "kKams3gBlUt7Kuo2Rvv4",<br/>        "_score" : 1.0,<br/>        "_source" : {<br/>          "title" : "Senior Software Engineer"<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="de2c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里我们将忽略术语的错误拼写，看看ElasticSearch给出了什么建议。</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="ca5e" class="lm ju hi li b fi ln lo l lp lq">GET /test-term/_search<br/>{<br/>  "suggest": {<br/>    "spellcheck": {<br/>      "text": "softewre",<br/>      "term": {<br/>        "field": "title"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="3b2b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">结果</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="5562" class="lm ju hi li b fi ln lo l lp lq">{<br/>  "took" : 326,<br/>  "timed_out" : false,<br/>  "_shards" : {<br/>    "total" : 5,<br/>    "successful" : 5,<br/>    "skipped" : 0,<br/>    "failed" : 0<br/>  },<br/>  "hits" : {<br/>    "total" : {<br/>      "value" : 0,<br/>      "relation" : "eq"<br/>    },<br/>    "max_score" : null,<br/>    "hits" : [ ]<br/>  },<br/>  "suggest" : {<br/>    "spellcheck" : [<br/>      {<br/>        "text" : "softewre",<br/>        "offset" : 0,<br/>        "length" : 8,<br/>        "options" : [<br/>          {<br/>            "text" : "software",<br/>            "score" : 0.75,<br/>            "freq" : 3<br/>          }<br/>        ]<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="4c70" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果仔细观察结果，您会发现“freq ”,这基本上是这个术语在我们的数据集中出现的次数。借助于此，我们建议最接近的正确术语。</p><p id="2863" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">短语提示器</strong></p><ol class=""><li id="b0c3" class="lv lw hi iz b ja jb jd je jg lx jk ly jo lz js ma mb mc md bi translated">类似于术语建议者。</li><li id="1d56" class="lv lw hi iz b ja me jd mf jg mg jk mh jo mi js ma mb mc md bi translated">基于n元模型</li></ol><p id="2413" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">N-gram模型是对字符串进行标记化的一种方式。有些人把带状疱疹叫做克氏病，而不是克氏病。</p><p id="640f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例子</p><ol class=""><li id="7755" class="lv lw hi iz b ja jb jd je jg lx jk ly jo lz js ma mb mc md bi translated">索引字符串“域”的gram大小为2，则每两个连续的字符将是一个术语，如“do”、“om”、“ma”、“ai”、“in”。</li><li id="f10a" class="lv lw hi iz b ja me jd mf jg mg jk mh jo mi js ma mb mc md bi translated">最小克数为2、最大克数为3的“快速棕色狐狸”将成为“快速棕色”、“棕色狐狸”、“快速棕色狐狸”。</li></ol><p id="b293" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于短语建议者，我们需要按照我们的要求创建一个自定义分析器。我们将创建一个索引，并通过自定义的“分析器”传递设置。</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="cb3a" class="lm ju hi li b fi ln lo l lp lq">PUT /test-phrase<br/>{<br/>  "settings": {<br/>    "analysis": {<br/>      "analyzer": {<br/>        "trigram": {<br/>          "type": "custom",<br/>          "tokenizer": "standard",<br/>          "filter": [<br/>            "shingle", "lowercase"<br/>          ]<br/>        }<br/>      },<br/>      "filter": {<br/>        "shingle": {<br/>          "type": "shingle",<br/>          "min_shingle_size": 2,<br/>          "max_shingle_size": 3<br/>        }<br/>      }<br/>    }<br/>  },<br/>  "mappings": {<br/>    "properties":{<br/>      "title":{<br/>        "type": "text",<br/>        "fields":{<br/>          "trigram": {<br/>            "type": "text",<br/>            "analyzer": "trigram"<br/>          }<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="1b2d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们在索引中插入一些文档。</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="3da1" class="lm ju hi li b fi ln lo l lp lq">POST /test-phrase/_doc<br/>{<br/>  "title": "Domain Driven Design"<br/>}</span><span id="1e85" class="lm ju hi li b fi lu lo l lp lq">POST /test-phrase/_doc<br/>{<br/>  "title": "Domain Driven Design by Jay"<br/>}</span></pre><ol class=""><li id="1297" class="lv lw hi iz b ja jb jd je jg lx jk ly jo lz js ma mb mc md bi translated">只是想建议正确的短语</li></ol><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="785b" class="lm ju hi li b fi ln lo l lp lq">GET /test-phrase/_search<br/>{<br/>  "suggest": {<br/>    "phrase-fix": {<br/>      "text": "domian driven design",<br/>      "phrase": {<br/>        "field": "title.trigram"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="1d66" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">结果</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="0bf2" class="lm ju hi li b fi ln lo l lp lq">{<br/>  "took" : 15,<br/>  "timed_out" : false,<br/>  "_shards" : {<br/>    "total" : 5,<br/>    "successful" : 5,<br/>    "skipped" : 0,<br/>    "failed" : 0<br/>  },<br/>  "hits" : {<br/>    "total" : {<br/>      "value" : 0,<br/>      "relation" : "eq"<br/>    },<br/>    "max_score" : null,<br/>    "hits" : [ ]<br/>  },<br/>  "suggest" : {<br/>    "phrase-fix" : [<br/>      {<br/>        "text" : "domian driven design",<br/>        "offset" : 0,<br/>        "length" : 20,<br/>        "options" : [<br/>          {<br/>            "text" : "domain driven design",<br/>            "score" : 0.40580386<br/>          }<br/>        ]<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="d7bd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">短语提示器有多种有趣的功能。</p><ol class=""><li id="5127" class="lv lw hi iz b ja jb jd je jg lx jk ly jo lz js ma mb mc md bi translated">想要突出显示更正短语—“突出显示”</li><li id="0227" class="lv lw hi iz b ja me jd mf jg mg jk mh jo mi js ma mb mc md bi translated">想要将返回建议与索引中的文档进行匹配—“根据返回的建议与查询进行比较”</li><li id="9671" class="lv lw hi iz b ja me jd mf jg mg jk mh jo mi js ma mb mc md bi translated">区分索引中匹配和不匹配的建议—使用“修剪”</li></ol><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="c722" class="lm ju hi li b fi ln lo l lp lq">GET /test-phrase/_search<br/>{<br/>  "suggest": {<br/>    "phrase-fix": {<br/>      "text": "domian driven design",<br/>      "phrase": {<br/>        "field": "title.trigram",<br/>        "confidence": 0,<br/>        "collate":{<br/>          "query": {<br/>            "source":{<br/>              "match_phrase":{<br/>                "{{field_name}}" : "{{suggestion}}"<br/>              }<br/>            }<br/>          },<br/>          "params": {"field_name" : "title"},<br/>          "prune": true<br/>        },<br/>        "highlight":{<br/>          "pre_tag": "&lt;em&gt;",<br/>          "post_tag": "&lt;/em&gt;"<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="54a0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">结果</p><pre class="kr ks kt ku fd lh li lj lk aw ll bi"><span id="3f47" class="lm ju hi li b fi ln lo l lp lq">{<br/>  "took" : 16,<br/>  "timed_out" : false,<br/>  "_shards" : {<br/>    "total" : 5,<br/>    "successful" : 5,<br/>    "skipped" : 0,<br/>    "failed" : 0<br/>  },<br/>  "hits" : {<br/>    "total" : {<br/>      "value" : 0,<br/>      "relation" : "eq"<br/>    },<br/>    "max_score" : null,<br/>    "hits" : [ ]<br/>  },<br/>  "suggest" : {<br/>    "phrase-fix" : [<br/>      {<br/>        "text" : "domian driven design",<br/>        "offset" : 0,<br/>        "length" : 20,<br/>        "options" : [<br/>          {<br/>            "text" : "domain driven design",<br/>            "highlighted" : "&lt;em&gt;domain&lt;/em&gt; driven design",<br/>            "score" : 0.40580386,<br/>            "collate_match" : true<br/>          },<br/>          {<br/>            "text" : "domian driven design",<br/>            "highlighted" : "domian driven design",<br/>            "score" : 0.065872006,<br/>            "collate_match" : false<br/>          }<br/>        ]<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="3a93" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">关于suggester的进一步阅读，请参考本<a class="ae lg" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-suggesters.html" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj">页</strong> </a></p></div></div>    
</body>
</html>