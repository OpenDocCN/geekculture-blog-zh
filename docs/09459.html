<html>
<head>
<title>Jayway Jsonpath can consume most of your service CPU, If you are using it in wrong way.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如果你用错了方法，Jayway Jsonpath会消耗你大部分的服务CPU。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/jayway-jsonpath-can-consume-most-of-your-service-cpu-if-you-are-using-it-in-wrong-way-3230ba0d4407?source=collection_archive---------7-----------------------#2021-12-12">https://medium.com/geekculture/jayway-jsonpath-can-consume-most-of-your-service-cpu-if-you-are-using-it-in-wrong-way-3230ba0d4407?source=collection_archive---------7-----------------------#2021-12-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/fdb32e67794318214c484a1ab65d234f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b0m9jcqWokbyBzpZOONTFg.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Photo by <a class="ae hv" href="https://unsplash.com/@rreason?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">riccardo ragione</a> on <a class="ae hv" href="https://unsplash.com/s/photos/cpu?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="02ed" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我有幸参与服务优化任务，并在优化过程中解决了几个问题，我认为这些问题对优化我们服务具有重要作用。</p><p id="65fd" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">其中一个问题是Jayway Jsonpath库CPU消耗。Jayway Jsonpath库使用了大部分服务CPU，我们无法支持我们平台上想要支持的用户数量。</p><p id="a80d" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在深入研究并进行cpu分析之后，我们能够发现Jayway jsonpath库几乎使用了我们所有的CPU。我已经写了关于如何使用你的工具包工具进行服务CPU/内存分析的独立博客。如果你感兴趣的话，请看看。</p><p id="732d" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Jayway jsonpath库用于通过json路径访问json属性。</p><p id="7387" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">示例:-</p><figure class="jt ju jv jw fd hk"><div class="bz dy l di"><div class="jx jy l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">Example code to read json attributes</figcaption></figure><p id="b966" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在上面的示例代码片段中，我们提取了json属性“a”的值并打印出来。</p><p id="6fd2" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们的项目中，Jayway Jsonpath库的使用非常复杂。我们的服务充当中间件，调用其他第三方服务，并使用JayJason路径库将这些第三方服务的响应转换为我们自己的Json契约，并将响应返回给我们API的调用者。</p><p id="a9e2" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们以错误的方式使用了Jayway Jsonpath，这导致了高CPU使用率。我们为每个读取的json属性解析json对象，而不是解析json一次，然后用它进行后续的属性读取。</p><p id="c603" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在发现读取属性值的方法存在问题后，我们修改了代码，只解析一次文档上下文，然后用它来读取所有json属性值。</p><p id="e29c" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是示例代码，我们已经解析了一次json文档，并重用它来读取后续的json属性。</p><figure class="jt ju jv jw fd hk"><div class="bz dy l di"><div class="jx jy l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">Parsing once and reading many times</figcaption></figure><p id="24a3" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过这一代码更改，我们服务的CPU使用率下降到了80%,我们能够支持我们想要支持的用户数量。</p><p id="7fdd" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢阅读。<br/>请👏或者关注我，如果你想从我这里读到更多。</p></div></div>    
</body>
</html>