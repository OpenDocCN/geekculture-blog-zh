<html>
<head>
<title>Postman: JSON Schema Validation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Postman: JSON模式验证</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/postman-json-schema-validation-ed09b3532a39?source=collection_archive---------0-----------------------#2021-05-14">https://medium.com/geekculture/postman-json-schema-validation-ed09b3532a39?source=collection_archive---------0-----------------------#2021-05-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es im"><img src="../Images/58c6d55845ae44347955b553f656a4bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uuhsaEPY4zSfd9Uvmr2Lrg.jpeg"/></div></div></figure><p id="0341" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">在我之前的<a class="ae jw" rel="noopener" href="/geekculture/automating-rest-apis-with-postman-c740049b56dd">文章</a>中，我们讨论了如何使用postman自动化和验证API。在本文中，我们将看到如何使用postman验证JSON模式。</p><h2 id="02f3" class="jx jy hi bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr bi translated">什么是JSON模式？</h2><p id="5eae" class="pw-post-body-paragraph iy iz hi ja b jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr kw jt ju jv hb bi translated"><a class="ae jw" href="https://json-schema.org/" rel="noopener ugc nofollow" target="_blank"> JSON Schema </a>是定义JSON数据结构的规范，即JSON请求体和API情况下的响应。基本上，JSON模式定义了各种键和它们的值，以及对这些值的某些约束。</p><p id="8543" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">JSON模式中使用的各种重要关键字如下:</p><ol class=""><li id="8ea6" class="kx ky hi ja b jb jc jf jg jj kz jn la jr lb jv lc ld le lf bi translated"><strong class="ja hj">type:</strong>type关键字定义了JSON数据的第一个约束。类型可以是空值、布尔值、对象、数组、数字、整数或字符串。</li><li id="b8e6" class="kx ky hi ja b jb lg jf lh jj li jn lj jr lk jv lc ld le lf bi translated"><strong class="ja hj">properties:</strong>properties的值是一个对象，其中每个键是一个属性的名称，每个值是一个用于验证该属性的JSON模式。</li><li id="b02b" class="kx ky hi ja b jb lg jf lh jj li jn lj jr lk jv lc ld le lf bi translated"><strong class="ja hj">必需的:</strong>这保存了一个必需属性的列表，即强制属性。</li><li id="5824" class="kx ky hi ja b jb lg jf lh jj li jn lj jr lk jv lc ld le lf bi translated"><strong class="ja hj">最小值:</strong>表示数字类型属性的最小可接受值。</li><li id="285a" class="kx ky hi ja b jb lg jf lh jj li jn lj jr lk jv lc ld le lf bi translated"><strong class="ja hj">最大值:</strong>表示数字类型属性的最大可接受值。</li><li id="5d21" class="kx ky hi ja b jb lg jf lh jj li jn lj jr lk jv lc ld le lf bi translated"><strong class="ja hj"> maxItems: </strong>数组类型属性中的最大项数。</li><li id="48c8" class="kx ky hi ja b jb lg jf lh jj li jn lj jr lk jv lc ld le lf bi translated"><strong class="ja hj"> minItems: </strong>数组类型属性中的最小项数。</li><li id="ffe8" class="kx ky hi ja b jb lg jf lh jj li jn lj jr lk jv lc ld le lf bi translated"><strong class="ja hj"> maxLength: </strong>表示字符串类型属性的最大长度。</li><li id="14ea" class="kx ky hi ja b jb lg jf lh jj li jn lj jr lk jv lc ld le lf bi translated"><strong class="ja hj"> minLength: </strong>表示字符串类型属性的最小长度。</li><li id="0d44" class="kx ky hi ja b jb lg jf lh jj li jn lj jr lk jv lc ld le lf bi translated"><strong class="ja hj">模式:</strong>如果正则表达式成功匹配实例，则认为字符串实例有效。</li><li id="4f6b" class="kx ky hi ja b jb lg jf lh jj li jn lj jr lk jv lc ld le lf bi translated"><strong class="ja hj"> additionalProperties: </strong>用于处理那些名字没有列在Properties关键字中的属性。它可以是布尔值，也可以是对象。如果它是布尔值并设置为false，则不允许任何附加属性。</li></ol><p id="ba4d" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">整个名单可以在这里找到<a class="ae jw" href="https://json-schema.org/understanding-json-schema/index.html" rel="noopener ugc nofollow" target="_blank">。可以自己写JSON schema，也可以在线生成。转到</a><a class="ae jw" href="https://jsonschema.net/" rel="noopener ugc nofollow" target="_blank"> URL </a>，粘贴您的JSON并提交，JSON模式将会生成。</p><h2 id="3e26" class="jx jy hi bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr bi translated">为什么需要JSON模式验证？</h2><p id="66b4" class="pw-post-body-paragraph iy iz hi ja b jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr kw jt ju jv hb bi translated">JSON模式验证确保我们得到的JSON响应格式与预期的格式相同。使用模式来验证RESTful服务的结构很简单，否则，几乎不可能在每次发生变化时都手工测试每个字段</p><h2 id="520c" class="jx jy hi bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr bi translated">如何使用Postman验证JSON模式？</h2><h2 id="b845" class="jx jy hi bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr bi translated"><a class="ae jw" href="https://ajv.js.org/" rel="noopener ugc nofollow" target="_blank">另一个JSON模式验证器(Ajv) </a>:</h2><p id="3c40" class="pw-post-body-paragraph iy iz hi ja b jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr kw jt ju jv hb bi translated">它是一个JavaScript库，提供了验证JSON模式的函数。它内置在postman中。</p><p id="7741" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">让我们验证以下API响应的JSON模式。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es ll"><img src="../Images/cc5de0992cb5015042509df117b4b01d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RabsgTh1GlU9YIfYKhDs9Q.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx">API Response</figcaption></figure><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es lq"><img src="../Images/ac3ec3bfd5482fe3cabaa75e788cc9a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*an1K8yiMlj9-aAyTqUUyYg.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx">Test Script And Test result</figcaption></figure><p id="0577" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我们已经成功地根据JSON模式验证了JSON响应。现在，如果属性的类型<code class="du lr ls lt lu b">age</code>被更改为<code class="du lr ls lt lu b">Integer</code>会怎样。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es lv"><img src="../Images/080747f0a92d7f7be35c2c49ff101ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MInKKwFpcCqN579whpN5GA.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx">Changed Response</figcaption></figure><p id="f37c" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我们的测试会失败，因为在JSON模式中，我们已经将属性类型<code class="du lr ls lt lu b">age</code>定义为<code class="du lr ls lt lu b">String</code></p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es lw"><img src="../Images/ffd35f2833c974999c3910937b2ada8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cM1B4HIhdE6irJT_2wri9g.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx">Failed Test</figcaption></figure><p id="44bb" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">让我们验证一个更复杂的JSON响应。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es lx"><img src="../Images/c175add1b15cd4d66955175e1f8188b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8kAq5RdReTz03CP27g7eyg.png"/></div></div></figure><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es ly"><img src="../Images/2f6174b2ad000f6c755aea0b46f74d78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P2FlfJD9QvqmE8U4xFK4Hg.png"/></div></div></figure><p id="515d" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">这里您可以看到测试已经通过，尽管我们的JSON模式没有包括所有其他属性。这是因为<code class="du lr ls lt lu b">additionalProperties</code>默认为真。如果<code class="du lr ls lt lu b">additionalProperties</code>设置为假呢？</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es lz"><img src="../Images/d66ffc64b77d56acfb5caa9bf2c062f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NHiy13Ml2YB7DGcI2kfN_Q.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx">additionalProperties :false</figcaption></figure><p id="7989" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">测试失败，字符串<code class="du lr ls lt lu b">data should NOT have additional properties</code>重复三次，每个<code class="du lr ls lt lu b">isEmployed</code>、<code class="du lr ls lt lu b">familyMembers</code>和<code class="du lr ls lt lu b">features</code>一次。</p><p id="e0ef" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">现在让我们验证以下条件:</p><ol class=""><li id="035e" class="kx ky hi ja b jb jc jf jg jj kz jn la jr lb jv lc ld le lf bi translated"><code class="du lr ls lt lu b">name</code>应仅包含字母和空格，即匹配正则表达式<code class="du lr ls lt lu b">^[A-Za-z\\s]+$</code></li><li id="22e4" class="kx ky hi ja b jb lg jf lh jj li jn lj jr lk jv lc ld le lf bi translated">响应中缺少属性<code class="du lr ls lt lu b">isEmployed</code>之一。</li><li id="37e7" class="kx ky hi ja b jb lg jf lh jj li jn lj jr lk jv lc ld le lf bi translated"><code class="du lr ls lt lu b">familyMembers</code>数组的最小长度应为2，最大长度应为4。</li><li id="13e9" class="kx ky hi ja b jb lg jf lh jj li jn lj jr lk jv lc ld le lf bi translated">属性<code class="du lr ls lt lu b">height</code>的最小值和最大值。</li></ol><p id="1677" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">包含上述条件的JSON模式:</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="352d" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">现在假设反应已经改变</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es mc"><img src="../Images/3eb20f6f126e4c9af97a944d685b59cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D-Ykx2zsQLGSOMJ-qsuTCg.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx">Modified Response</figcaption></figure><p id="1a35" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">对于上面的响应，我们的测试应该会失败，因为在JSON模式中，我们已经定义了属性<code class="du lr ls lt lu b">name</code>应该只有字母和空格，<code class="du lr ls lt lu b">familyMembers</code>必须至少有一项，<code class="du lr ls lt lu b">isEmployed</code>是强制属性，最小值<code class="du lr ls lt lu b">height</code>是4。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es md"><img src="../Images/f0c3a62cb645b310d49ab5d10e4af7ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uzhju5m8oeQ0buSgD80oUA.png"/></div></div></figure><p id="a752" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我们可以看到测试失败了，断言清楚地显示了失败的原因。</p><p id="042e" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">使用JSON模式解决了RESTful API服务的提供者和消费者之间的大多数通信问题。提供者可以是后端开发人员，消费者可以是移动开发团队。JSON模式有一个惊人的学习曲线。一些开发人员觉得这很难操作，认为它“太罗嗦”。</p><p id="bdcd" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">这就是本文的全部内容。</p><p id="d98e" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated"><em class="me">完整项目和更多库可以在我的</em><a class="ae jw" href="https://github.com/attrideepak" rel="noopener ugc nofollow" target="_blank"><em class="me">github</em></a><em class="me">上找到。</em></p></div></div>    
</body>
</html>