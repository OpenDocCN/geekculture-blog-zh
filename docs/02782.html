<html>
<head>
<title>Trigger pipe via slack command</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过松弛命令触发管道</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/trigger-pipe-via-slack-command-8990fe707609?source=collection_archive---------41-----------------------#2021-05-25">https://medium.com/geekculture/trigger-pipe-via-slack-command-8990fe707609?source=collection_archive---------41-----------------------#2021-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f51dc892d74a54f58549ffb842c7c6a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NynqNgVmsChLwNt31WsmRw.jpeg"/></div></div></figure><p id="f6d6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，这将是我的有趣文章列表的开始，因为我处于部分失业状态🍻</p><p id="90af" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">今天我们将制作一个快速斜杠命令，它将触发一个自定义管道并运行它。</p><h1 id="f5bb" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">为什么？</h1><p id="76cb" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">老实说，当我没有心情时，我喜欢玩这样的东西，而且在我的工作中，似乎开发人员太懒了，以至于无法在bitbucket中运行自定义管道或手动管道</p><h1 id="91ff" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">如何？</strong></h1><p id="72dd" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">这是非常简单的pips，我想在slack上键入/deploy2uat，它会在bitbucket管道中触发一个自定义管道</p><blockquote class="kr ks kt"><p id="a892" class="iq ir ku is b it iu iv iw ix iy iz ja kv jc jd je kw jg jh ji kx jk jl jm jn hb bi translated">/deploy2uat:表示松弛API</p><p id="da48" class="iq ir ku is b it iu iv iw ix iy iz ja kv jc jd je kw jg jh ji kx jk jl jm jn hb bi translated">触发位桶管道:表示位桶API</p></blockquote><p id="29b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一块拼图是松弛的</p><p id="d29e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">让我们创建一个slack应用程序</strong></p><ol class=""><li id="bb11" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">到这里【https://api.slack.com/apps/ T4】并输入你的应用程序名和你想要命令执行的工作空间</li></ol><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/9711f03c8e2a5f524ed887e839bc4547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FbIOwQxupVYq5L8QOu0CKg.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">create slack application</figcaption></figure><p id="5935" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.单击斜杠命令并创建一个</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/2b491930afbb0007a0b5150bd4dccc5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cuOPwLw-DToLw9fyeBw3Ew.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">Slash commands interface</figcaption></figure><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/ab6c7ec8e1f7fe46f58bff2ba5a56763.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M9iMRnIX8P9EgVHcFcUUQQ.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">3.Create slash command</figcaption></figure><p id="491b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">只需键入命令的名称，请求URL是您的后端API正在运行的地方，这意味着IP地址或端点名称...剩下的就是你的命令要做什么了。</p><p id="7b58" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">拼图的第二块是bitbucket API</p><p id="08be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">让我们看看bitbucket API </strong></p><p id="31f0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将打开<a class="ae lh" href="https://developer.atlassian.com/bitbucket/api/2/reference/resource/repositories/%7Bworkspace%7D/%7Brepo_slug%7D/pipelines/" rel="noopener ugc nofollow" target="_blank"> API文档</a>，如你所见，curl命令操作起来非常简单</p><pre class="lj lk ll lm fd lt lu lv lw aw lx bi"><span id="158d" class="ly jp hi lu b fi lz ma l mb mc">curl -X POST -is -u username:apppassword \<br/>  -H 'Content-Type: application/json' \<br/> https://api.bitbucket.org/2.0/repositories/usernameororg/repo/pipelines/ \<br/>  -d '<br/>  {<br/>    "target": {<br/>      "ref_type": "branch",<br/>      "type": "pipeline_ref_target",<br/>      "ref_name": "master"<br/>    }<br/>  }'</span></pre><p id="d60f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将把这个命令翻译成一个原始的python flask应用程序(😜不尽然)</p><pre class="lj lk ll lm fd lt lu lv lw aw lx bi"><span id="b21d" class="ly jp hi lu b fi lz ma l mb mc">import requests</span><span id="97b5" class="ly jp hi lu b fi md ma l mb mc">import os</span><span id="43cc" class="ly jp hi lu b fi md ma l mb mc">from flask import Flask, jsonify</span><span id="7baa" class="ly jp hi lu b fi md ma l mb mc">app = Flask(__name__)</span><span id="b5d2" class="ly jp hi lu b fi md ma l mb mc"># The route of the application </span><span id="5751" class="ly jp hi lu b fi md ma l mb mc">@app.route('/deploy-2-uat', methods=['POST'])</span><span id="0c9f" class="ly jp hi lu b fi md ma l mb mc">def testmedium():</span><span id="e520" class="ly jp hi lu b fi md ma l mb mc"># pattern is the name of your custom pipe</span><span id="c56a" class="ly jp hi lu b fi md ma l mb mc">data = ' { "target": { "ref_type": "branch", "type": "pipeline_ref_target", "ref_name": "master", "selector": { "type": "custom", "pattern": patternName } } }'</span><span id="8a5d" class="ly jp hi lu b fi md ma l mb mc">response = requests.post('https://api.bitbucket.org/2.0/repositories/username/reponame/pipelines/', headers={'Content-Type': 'application/json',}, data=data, auth=(username, appapssword))</span><span id="006a" class="ly jp hi lu b fi md ma l mb mc">return jsonify(</span><span id="db57" class="ly jp hi lu b fi md ma l mb mc">text='It is deployed',</span><span id="de20" class="ly jp hi lu b fi md ma l mb mc">)</span><span id="5a02" class="ly jp hi lu b fi md ma l mb mc">if __name__ == '__main__':</span><span id="101b" class="ly jp hi lu b fi md ma l mb mc">app.run()</span></pre><p id="cf99" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以将用户名、应用程序密码(可以在bitbucket上生成)和repo name作为环境变量传递，对于更标准的命令，我建议您将这些变量作为slack命令的参数传递。(我只是在这里玩得开心，所以我保持简单)</p><p id="9d00" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后一步是在某个无服务器选项上部署这个小脚本，因为我说过我只是玩玩，我运行flask应用程序，我使用ngrok获得一个公共URL，我们将在图3中输入它作为请求URL，结果是</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/14f435a35c8d22b506a4d00d92520535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*AEvewBey63mNT72TvucRWA.gif"/></div></div></figure><p id="66dd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是一个非常基本的例子，但只是想一想，像这样小小的第一步，你能做什么，例如，一个完整的CI/CD，为什么不呢😃</p><p id="3556" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">来自突尼西亚的和平和原谅我的英语✌️</p></div></div>    
</body>
</html>