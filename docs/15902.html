<html>
<head>
<title>SQL Interview Question4: Finding Year On Year (YoY) increase in salaries of employees— Use Case of Lag() Window Function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL面试问题4:查找员工工资的同比增长Lag()窗口函数的用例</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/sql-interview-question4-finding-year-on-year-yoy-increase-in-salaries-of-employees-use-case-of-7846315cc297?source=collection_archive---------6-----------------------#2022-11-29">https://medium.com/geekculture/sql-interview-question4-finding-year-on-year-yoy-increase-in-salaries-of-employees-use-case-of-7846315cc297?source=collection_archive---------6-----------------------#2022-11-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="f3c3" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">SQL面试问题系列中的第4名</h2><div class=""/><div class=""><h2 id="e9b4" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">最常见的SQL面试查询和概念#SQL #RDBMS</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/a4ebfb6d5fdea8b992246c801cce3832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qRwAlesbs-vb5w7q82TX9Q.jpeg"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Photo by <a class="ae jw" href="https://unsplash.com/@rubaitulazad?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Rubaitul Azad</a> on <a class="ae jw" href="https://unsplash.com/s/photos/sql-query?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d0cf" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">你好。！</p><p id="4ae6" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">在我最近的产品分析师职位面试中，我被问了许多基于窗口函数的SQL问题，如row_number()、rank()、dense_rank()、lead()、lag()、first_value()、last_value()等。因此，在今天的文章中，我将基于lag()函数的使用来解决一个问题，在接下来的3-4篇文章中，我也将写其他问题。所以，让我们直接进入今天的问题陈述。</p><blockquote class="kt ku kv"><p id="2692" class="jx jy kw jz b ka kb is kc kd ke iv kf kx kh ki kj ky kl km kn kz kp kq kr ks hb bi translated"><strong class="jz hs">问题陈述:我们有员工连续三年的工资数据。找出每个员工的工资增长百分比。</strong></p></blockquote><p id="26a8" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">数据:我使用一个表<em class="kw"> basic_pays </em>，总共有120条记录，列<strong class="jz hs"> <em class="kw"> employee_id、财政年度、薪水</em> </strong>，并在PostgreSQL上运行我的查询。下面是表中的<em class="kw"> Select * </em>查询的片段。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es la"><img src="../Images/fd00e3b18262a42acecd346199753b5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YZgZZWY6CEerXwmeNyKVKw.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Credits: By Author</figcaption></figure><p id="8006" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">当我们说“同比增长”时，它的意思是，相对于去年的工资，今年的工资增长了多少。下面是相同的计算公式。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es lb"><img src="../Images/7a8f50906a8621d5014582b28eb4f660.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*RYGD8TuVP906rn9dZtDM4w.png"/></div><figcaption class="js jt et er es ju jv bd b be z dx">Credits: By Author</figcaption></figure><p id="5acd" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> <em class="kw">现在，为了访问当前行的前一条记录，我们必须使用lag() window函数。Lag()函数提供对当前行指定物理偏移量的前一行数据的访问。</em>语法是，</strong></p><pre class="jh ji jj jk fd lc ld le bn lf lg bi"><span id="5018" class="lh li hi ld b be lj lk l ll lm">LAG( expression, offset, default) Over(PARTITION BY ……… ORDER BY......)<br/><br/>Expression: Value which we want to return<br/>Offset: The number of rows back from current row, which we want to access. By default, it is 1.<br/>dafault: When Preceding row is not defined, deafult will be returned. If not mentioned, NULL will be returned for the first row, since they don't have any preceeding rows.</span></pre><p id="0beb" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">让我们在SQL中实现它，</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ln"><img src="../Images/b013ad060cbb2569326c75d7c7cd902e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cc2QYyOx5ZH93DyDVHFtJQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Credits: By Author</figcaption></figure><p id="07bc" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">在这段代码中，由执行的第一个<strong class="jz hs">分区将数据划分到雇员组中。</strong></p><p id="faf8" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> Order by </strong>子句按财政年度的升序对数据进行排序。</p><p id="b95c" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> Lag() </strong>函数在<strong class="jz hs"> prev_salary </strong>列中取当前行的上年薪资。</p><p id="f8c6" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">注意:因为没有提到默认值，并且每个雇员的第一行没有前面的行，所以在每个雇员的第一行返回NULL。同样，默认情况下，偏移为1。</strong></p><p id="c708" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">假设第一年，以前的工资与现在的工资相同，工资没有增长，即增长0%。<strong class="jz hs">因此，在默认值中填充薪金，</strong></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es lo"><img src="../Images/9ceef431cf50d1d4fb897930d8cf6308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vRVLcxHc4XXBrL78BhmNzQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Credits: By author</figcaption></figure><p id="6321" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">请注意，对于第一行，薪金与prev_salary相同。</p><p id="220a" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">现在，为了找到YoY，使用一个公共表表达式(CTE)作为salary_data并执行我们的计算，</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es lp"><img src="../Images/f6808bd79edc5a2104fb43e8d6ea993a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aEXdK4P33eIB25yHIT9mEw.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Credits: By Author</figcaption></figure><p id="4ff5" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">但是per_increase有这么多零似乎不太好，所以我将它四舍五入&amp;还将它与%ge值连接起来，这样就可以看到它增加了一个百分比。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ca"><img src="../Images/feb8f2afb44701c806bd619dfe6e4e66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M3XVp1HW4uj2TPZhnDNksA.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Credits: By Author</figcaption></figure><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es lq"><img src="../Images/f8b8b3f14bccac427d37185f0a7a36a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5mEjp1y1CBiqKf70Wr4x4g.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Credits: By Author</figcaption></figure><p id="439c" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">这是关于使用lag()窗口函数来查找工资的同比增长。同样，如果我们清楚这些函数的用法概念，我们可以解决许多问题。</p><p id="a896" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">希望对你有所帮助。</p><p id="220c" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">如有任何疑问，请通过LinkedIn、Twitter或电子邮件联系我。</p><p id="e97f" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> <em class="kw">邮箱:sdeevi07@gmail.com</em></strong></p><p id="5f30" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">【https://twitter.com/sdeeksha07】<em class="kw">碎碎念:</em><a class="ae jw" href="https://twitter.com/sdeeksha07" rel="noopener ugc nofollow" target="_blank"><strong class="jz hs"><em class="kw"/></strong></a></p><p id="e637" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> <em class="kw">领英:</em></strong><a class="ae jw" href="https://www.linkedin.com/in/sdeeksha07/" rel="noopener ugc nofollow" target="_blank"><strong class="jz hs"><em class="kw">https://www.linkedin.com/in/sdeeksha07/</em></strong></a></p><p id="1b18" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">坚持学习，坚持练习！！</strong></p></div></div>    
</body>
</html>