<html>
<head>
<title>Creating a CRUD app with Quarkus, Reactive Hibernate, Panache and GraphQL using a PostgreSQL database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PostgreSQL数据库创建一个包含Quarkus、反应式Hibernate、Panache和GraphQL的CRUD应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/creating-a-crud-app-with-quarkus-reactive-hibernate-panache-and-graphql-using-a-postgresql-216ecd75ee52?source=collection_archive---------11-----------------------#2021-06-07">https://medium.com/geekculture/creating-a-crud-app-with-quarkus-reactive-hibernate-panache-and-graphql-using-a-postgresql-216ecd75ee52?source=collection_archive---------11-----------------------#2021-06-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/fd594443aab3aef88d6d186854dac058.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zHYLR_hv4ctJ_TtvUZnScQ.jpeg"/></div></div></figure><div class=""/><p id="6532" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本指南演示了您的Quarkus应用程序如何使用<a class="ae jo" href="https://github.com/smallrye/smallrye-graphql/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> SmallRye GraphQL </strong> </a>，<a class="ae jo" href="https://github.com/eclipse/microprofile-graphql/" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">micro profile graph QL</strong></a>规范的实现，以及反应式的<strong class="is hu">Hibernate</strong><strong class="is hu">Panache</strong>扩展和<strong class="is hu"> PostgreSQL </strong>数据库。简而言之，它提供了一组电影和演员及其对应关系和突变操作。</p><figure class="jq jr js jt fd hk er es paragraph-image"><div class="er es jp"><img src="../Images/ce7ac1b0824d01cdc66b46c24cdc4c14.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*d9VDqITcsyUkTcncECeJBA.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">quarkus.io</figcaption></figure><p id="4732" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">GraphQL是一种用于API的查询语言，也是一种用现有数据完成这些查询的运行时语言。GraphQL为API中的数据提供了完整且易于理解的描述，使客户能够准确地要求他们需要的东西，使API更容易随时间发展，并支持强大的开发工具。</p><p id="6898" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> GraphQL </strong>最初是由<strong class="is hu">脸书</strong>在2012年开发的，从2015年开始成为开放标准。</p><blockquote class="jz ka kb"><p id="5897" class="iq ir jy is b it iu iv iw ix iy iz ja kc jc jd je kd jg jh ji ke jk jl jm jn hb bi translated">GraphQL不是REST API规范的替代品，而仅仅是一种替代方案。与REST不同，GraphQL API能够通过以下方式使客户端受益:</p></blockquote><p id="afd6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> <em class="jy">防止超取和欠取</em> </strong></p><blockquote class="jz ka kb"><p id="5372" class="iq ir jy is b it iu iv iw ix iy iz ja kc jc jd je kd jg jh ji ke jk jl jm jn hb bi translated">REST API是服务器驱动的固定数据响应，不能由客户端决定。虽然客户端不需要所有的字段，但是客户端必须检索所有的数据，因此<code class="du kf kg kh ki b">Over-fetching</code>。根据第一次调用(HATEOAS ),客户端可能还需要多次REST API调用来检索所需的所有数据<code class="du kf kg kh ki b">Under-fetching</code>。</p></blockquote><p id="e992" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> <em class="jy"> API进化</em> </strong></p><blockquote class="jz ka kb"><p id="9102" class="iq ir jy is b it iu iv iw ix iy iz ja kc jc jd je kd jg jh ji ke jk jl jm jn hb bi translated">由于GraphQL API返回客户端请求的数据，因此向现有API添加额外的字段和功能不会对现有客户端造成重大更改。</p></blockquote><p id="3a51" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">考虑到这一点，我们在设计实体时可以有许多不同的灵活方法，并使我们的查询更加松散耦合。GraphQL驱动的设计也有助于解决围绕数据库的<strong class="is hu"> n + 1选择</strong>的问题。</p><h1 id="3972" class="kj kk ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">先决条件</h1><ul class=""><li id="7f7d" class="lh li ht is b it lj ix lk jb ll jf lm jj ln jn lo lp lq lr bi translated">PostgreSQL ≥ 10.5(在Docker中)</li><li id="627e" class="lh li ht is b it ls ix lt jb lu jf lv jj lw jn lo lp lq lr bi translated">Java 8+</li><li id="2b09" class="lh li ht is b it ls ix lt jb lu jf lv jj lw jn lo lp lq lr bi translated">龙目岛≥ 1.18.18</li><li id="3fc4" class="lh li ht is b it ls ix lt jb lu jf lv jj lw jn lo lp lq lr bi translated">Maven ≥ 3.6.2</li></ul><h1 id="c5c4" class="kj kk ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">Quarkus扩展</h1><pre class="jq jr js jt fd lx ki ly lz aw ma bi"><span id="97ee" class="mb kk ht ki b fi mc md l me mf">$ ./mvnw quarkus:add-extension -Dextensions="quarkus-hibernate-reactive-panache,quarkus-reactive-pg-client,quarkus-resteasy-reactive-jsonb,quarkus-smallrye-graphql"</span></pre></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><p id="358c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本指南基于本指南中的发现。</p><p id="d6b7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://quarkus.io/guides/smallrye-graphql" rel="noopener ugc nofollow" target="_blank">夸尔库斯—小黑麦图QL </a></p><figure class="jq jr js jt fd hk er es paragraph-image"><div class="er es mn"><img src="../Images/4d6e2aa69509500a7fbda3904698aad1.png" data-original-src="https://miro.medium.com/v2/resize:fit:560/format:webp/1*qLZPbdtr6jRgtq-s2NwkjQ.png"/></div></figure></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><h1 id="c4e4" class="kj kk ht bd kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc ms le lf lg bi translated">实体设计</h1><figure class="jq jr js jt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mt"><img src="../Images/0eda041580f9758c9afaebb416743dbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ParNShG32GcVAMpFqq3KAw.png"/></div></div></figure><p id="7d00" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">多对多的实体关系需要规范化，以获得更好的结构。这是通过将描述电影和演员之间关系的新实体分解成一个<em class="jy">actor movie relationship</em>表来完成的，该表将成为我们的桥接表。</p></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><h1 id="e654" class="kj kk ht bd kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc ms le lf lg bi translated">声明演员派头实体</h1><figure class="jq jr js jt fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><h1 id="86a9" class="kj kk ht bd kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc ms le lf lg bi translated">宣布电影派头实体</h1><figure class="jq jr js jt fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><h1 id="1373" class="kj kk ht bd kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc ms le lf lg bi translated">宣告演员电影关系的华丽实体</h1><figure class="jq jr js jt fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><h1 id="3736" class="kj kk ht bd kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc ms le lf lg bi translated">反应式GraphQL查询</h1><p id="acff" class="pw-post-body-paragraph iq ir ht is b it lj iv iw ix lk iz ja jb mw jd je jf mx jh ji jj my jl jm jn hb bi translated">例如，可以通过使用<code class="du kf kg kh ki b">Uni</code>或<code class="du kf kg kh ki b">CompletionStage</code>作为返回类型来使查询变得被动。我们将使用<strong class="is hu">small rye-哗变</strong>反应流的反应方式。</p><h1 id="5913" class="kj kk ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">GraphQL执行元API</h1><figure class="jq jr js jt fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><h1 id="1223" class="kj kk ht bd kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc ms le lf lg bi translated">GraphQL电影API</h1><figure class="jq jr js jt fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><h1 id="5944" class="kj kk ht bd kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc ms le lf lg bi translated">配置</h1><figure class="jq jr js jt fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><h1 id="493a" class="kj kk ht bd kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc ms le lf lg bi translated">运转</h1><p id="b116" class="pw-post-body-paragraph iq ir ht is b it lj iv iw ix lk iz ja jb mw jd je jf mx jh ji jj my jl jm jn hb bi translated">运行PostgreSQL数据库。</p><pre class="jq jr js jt fd lx ki ly lz aw ma bi"><span id="c8b1" class="mb kk ht ki b fi mc md l me mf">$ docker run -d --rm --name my_reative_db -e POSTGRES_USER=user -e POSTGRES_PASSWORD=password -e POSTGRES_DB=my_db -p 5432:5432 postgres:10.5</span></pre><p id="5e86" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用实时编码预览运行quarkus应用程序。</p><pre class="jq jr js jt fd lx ki ly lz aw ma bi"><span id="c732" class="mb kk ht ki b fi mc md l me mf">$ ./mvnw compile quarkus:dev</span></pre></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><h1 id="51bf" class="kj kk ht bd kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc ms le lf lg bi translated">GraphQL生成的模式</h1><p id="c5f5" class="pw-post-body-paragraph iq ir ht is b it lj iv iw ix lk iz ja jb mw jd je jf mx jh ji jj my jl jm jn hb bi translated">这将从我们的GraphQL注释类中生成。位于</p><p id="9775" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="http://localhost:8080/graphql/schema.graphql" rel="noopener ugc nofollow" target="_blank"><em class="jy">http://localhost:8080/graph QL/schema . graph QL</em></a></p><figure class="jq jr js jt fd hk"><div class="bz dy l di"><div class="mu mv l"/></div></figure></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><h1 id="608e" class="kj kk ht bd kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc ms le lf lg bi translated">Quarkus图形用户界面</h1><p id="f5f1" class="pw-post-body-paragraph iq ir ht is b it lj iv iw ix lk iz ja jb mw jd je jf mx jh ji jj my jl jm jn hb bi translated">这是默认启用的，用户界面位于</p><p id="7dde" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="http://localhost:8080/q/graphql-ui/" rel="noopener ugc nofollow" target="_blank"><em class="jy">http://localhost:8080/q/graph QL-ui/</em></a></p><p id="76b1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将以下查询添加到GraphQL编辑器中，并开始交互。</p><pre class="jq jr js jt fd lx ki ly lz aw ma bi"><span id="3345" class="mb kk ht ki b fi mc md l me mf">mutation addActorToMovie {<br/>  addActorToMovie(movieId: 1, actorId: 1) {<br/>    title<br/>    releaseDate<br/>    director<br/>    actors {<br/>      name<br/>      id<br/>    }<br/>  }<br/>}</span><span id="118d" class="mb kk ht ki b fi mz md l me mf">mutation addMovieToActor {<br/>  addMovieToActor(movieId: 3, actorId: 3) {<br/>    name<br/>    id<br/>    movies {<br/>      title<br/>      actors {<br/>        name<br/>      }<br/>    }<br/>  }<br/>}</span><span id="39de" class="mb kk ht ki b fi mz md l me mf">query allActors {<br/>  allActors {<br/>    name<br/>    id<br/>    movies {<br/>      title<br/>      director<br/>      id<br/>      releaseDate<br/>      actors {<br/>        name<br/>      }<br/>    }<br/>  }<br/>}</span><span id="753d" class="mb kk ht ki b fi mz md l me mf">query allMovies {<br/>  allMovies {<br/>    title<br/>    releaseDate<br/>    director<br/>    id<br/>    actors {<br/>      name<br/>      id<br/>    }<br/>  }<br/>}</span><span id="7ab5" class="mb kk ht ki b fi mz md l me mf">mutation deleteMovie {<br/>  deleteMovie(movieId: 2)<br/>}</span><span id="09e4" class="mb kk ht ki b fi mz md l me mf">mutation updateMovie {<br/>  updateMovie(movieId: 1, movie: {title: "rEsErvOiR d0Gs"}) {<br/>    title<br/>  }<br/>}</span></pre><figure class="jq jr js jt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es na"><img src="../Images/80ee55ad565d0fd05e65dd02ba3f7426.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H4f7nU1X4vs9d7eZmh08fg.png"/></div></div></figure></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><h1 id="b7fe" class="kj kk ht bd kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc ms le lf lg bi translated">结论</h1><p id="ab50" class="pw-post-body-paragraph iq ir ht is b it lj iv iw ix lk iz ja jb mw jd je jf mx jh ji jj my jl jm jn hb bi translated">正如所见，我们可以立即开始与不同的API资源和实体进行交互。更多操作和例子可以在GitHub repo中找到。</p><p id="9e0e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://github.com/dvddhln/quarkus-reactive-hibernate-graphql-crud" rel="noopener ugc nofollow" target="_blank">在这里找到GitHub源码项目</a></p><p id="b25a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">祝你好运！</p></div></div>    
</body>
</html>