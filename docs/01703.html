<html>
<head>
<title>Macroeconomic Data with Quantiacs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有量化指标的宏观经济数据</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/macroeconomic-data-with-quantiacs-8c2b18257e29?source=collection_archive---------20-----------------------#2021-04-20">https://medium.com/geekculture/macroeconomic-data-with-quantiacs-8c2b18257e29?source=collection_archive---------20-----------------------#2021-04-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ed66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://www.quantiacs.com" rel="noopener ugc nofollow" target="_blank"><em class="je"/></a><em class="je">quanti ACS为用户提供来自</em> <a class="ae jd" href="https://www.bls.gov" rel="noopener ugc nofollow" target="_blank"> <em class="je">美国劳工统计局</em> </a> <em class="je">的宏观经济数据。这些数据可以用</em> <a class="ae jd" href="https://quantiacs.com/personalpage/login" rel="noopener ugc nofollow" target="_blank"> <em class="je">云</em> </a> <em class="je">或</em> <a class="ae jd" href="https://quantiacs.com/documentation/en/user_guide/local_development.html" rel="noopener ugc nofollow" target="_blank"> <em class="je">本地下载</em> </a> <em class="je">进行进一步分析。在这篇文章中，我们展示了如何使用宏观经济数据来开发一个交易算法。</em></p><h1 id="f674" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">劳工统计局数据</h1><p id="0d7f" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">美国劳工统计局是美国政府在劳工经济和统计领域的主要机构。它提供了几个有趣类别的宏观经济数据:价格、就业和失业、薪酬和工作条件以及生产率。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ki"><img src="../Images/8a876dac010903ea145c67000eb8a328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w2qKNKULgQ-Vv6k4X_yD4g.jpeg"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx">Photo by <a class="ae jd" href="https://unsplash.com/@juvx?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Vlad Busuioc</a> on <a class="ae jd" href="https://unsplash.com/s/photos/economy?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0bb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">美国国会和其他联邦机构利用劳工统计局提供的宏观经济数据做出关键决策。它们对于学术研究来说是非常重要的数据。此外，对于定量分析师来说，它们是一个有趣的想法来源，可以补充市场数据，用于开发交易算法。</p><p id="4afd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="http://www.quantiacs.com" rel="noopener ugc nofollow" target="_blank"> Quantiacs </a>已经在其<a class="ae jd" href="https://quantiacs.com/personalpage/login" rel="noopener ugc nofollow" target="_blank">云</a>上实现了这些数据集，并使它们也可用于<a class="ae jd" href="https://quantiacs.com/documentation/en/user_guide/local_development.html" rel="noopener ugc nofollow" target="_blank">您机器上的本地使用</a>。</p><h1 id="0d94" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">检查数据集</h1><p id="8cb1" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq kf is it iu kg iw ix iy kh ja jb jc hb bi translated">数据被组织在<strong class="ih hj"> 34个数据集</strong>中，这些数据集可通过以下方式进行检查:</p><pre class="kj kk kl km fd ky kz la lb aw lc bi"><span id="7aaa" class="ld jg hi kz b fi le lf l lg lh">import pandas as pd<br/>import numpy as np</span><span id="d961" class="ld jg hi kz b fi li lf l lg lh">import qnt.data as qndata</span><span id="64f3" class="ld jg hi kz b fi li lf l lg lh">dbs = qndata.blsgov.load_db_list()</span><span id="5d59" class="ld jg hi kz b fi li lf l lg lh">display(pd.DataFrame(dbs))</span></pre><p id="4ca9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果是一个表格，其中显示了上次可用更新的日期和时间以及每个数据集的名称:</p><figure class="kj kk kl km fd kn er es paragraph-image"><div class="er es lj"><img src="../Images/19126a8098d637a58bcfe6ce7d8991e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*pj9BntQ24iexETQKdpOn-w.png"/></div></figure><p id="068e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个数据集包含几个可用作指标的<strong class="ih hj">时间序列</strong>。</p><p id="8057" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这个例子，我们使用<code class="du lk ll lm kz b">AP</code>，包含<strong class="ih hj">平均消费价格</strong>的数据集。它们是根据为编制<a class="ae jd" href="https://www.bls.gov/cpi/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">消费者价格指数</strong> </a>而收集的价格，为家庭燃料、汽车燃料和食品项目计算的。</p><p id="be34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们加载并显示包含在<code class="du lk ll lm kz b">AP</code>数据集中的时间序列:</p><pre class="kj kk kl km fd ky kz la lb aw lc bi"><span id="9a92" class="ld jg hi kz b fi le lf l lg lh">series_list = list(qndata.blsgov.load_series_list('AP'))<br/><br/>display(pd.DataFrame(series_list).set_index('id'))</span></pre><p id="3f2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lk ll lm kz b">AP</code>平均价格数据集包含<strong class="ih hj"> 1479个时间序列</strong>，每个时间序列有<strong class="ih hj"> 8个不同的字段</strong>:</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ln"><img src="../Images/9a1d439db853abe290c971dfba156b27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qo1QZ2F51Z18TVU61q_AnQ.png"/></div></div></figure><p id="cdbe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一些字段对于时间序列的意义是显而易见的:<code class="du lk ll lm kz b">series_title</code>、<code class="du lk ll lm kz b">begin_year</code>或<code class="du lk ll lm kz b">end_year</code>无需解释。其他字段乍一看不明显，应检查其含义:例如<code class="du lk ll lm kz b">area_code</code>、<code class="du lk ll lm kz b">item_code</code>、<code class="du lk ll lm kz b">begin_period </code>和<code class="du lk ll lm kz b">end_period</code>就是这种情况。</p><p id="f4ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以使用以下方法检查含义:</p><pre class="kj kk kl km fd ky kz la lb aw lc bi"><span id="01b3" class="ld jg hi kz b fi le lf l lg lh">meta = qndata.blsgov.load_db_meta('AP')<br/><br/><strong class="kz hj">for</strong> k <strong class="kz hj">in</strong> meta.keys():<br/>    print('### ' + k + " ###")<br/>    m = meta[k]<br/>    <br/>    <strong class="kz hj">if</strong> type(m) == str:<br/>        <em class="je"># show only the first line if this is a text entry:</em><br/>        print(m.split('<strong class="kz hj">\n</strong>')[0])<br/>        print('...')<br/>        <em class="je"># full text option, uncomment:</em><br/>        <em class="je"># print(m) </em><br/><br/>    <strong class="kz hj">if</strong> type(m) == dict:<br/>        <em class="je"># convert dictionaries to pandas DataFrame:</em><br/>        df = pd.DataFrame(meta[k].values())<br/>        df = df.set_index(np.array(list(meta[k].keys())))<br/>        display(df)</span></pre><p id="15b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lk ll lm kz b">area_code</code>列反映了与时间序列相关的<strong class="ih hj">美国地区</strong>，例如0000代表整个美国；</p><figure class="kj kk kl km fd kn er es paragraph-image"><div class="er es lo"><img src="../Images/719317b0dc5dc7e7fc02707870e3474d.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*GnlUBqGjv9YZKIvG-dydCg.png"/></div></figure><p id="d4a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们只选择与整个美国相关的时间序列；</p><pre class="kj kk kl km fd ky kz la lb aw lc bi"><span id="a0a7" class="ld jg hi kz b fi le lf l lg lh">us_series_list = [s <strong class="kz hj">for</strong> s <strong class="kz hj">in</strong> series_list \<br/>  <strong class="kz hj">if</strong> s['area_code'] == '0000']<br/><br/>display(pd.DataFrame(us_series_list).set_index('id'))</span></pre><p id="f121" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们从最初的1479个时序中获得了160个时序。这些是<strong class="ih hj">全球美国时间序列</strong>，它们与预测全球金融市场更相关:</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lp"><img src="../Images/3f0c7afbf1fafabbec33334e54dddc5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eE7Y1uWfeKG-5rO9aKo94w.png"/></div></div></figure><p id="e87c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从<strong class="ih hj"> 55个时间序列</strong>中选择一个子集，这些时间序列目前正在更新，并且至少有20年的历史:</p><pre class="kj kk kl km fd ky kz la lb aw lc bi"><span id="ac5b" class="ld jg hi kz b fi le lf l lg lh">actual_us_series_list = [s <strong class="kz hj">for</strong> s <strong class="kz hj">in</strong> us_series_list \<br/>    <strong class="kz hj">if</strong> s['begin_year'] &lt;= '2000' <strong class="kz hj">and</strong> s['end_year'] == '2021' ]<br/><br/>display(pd.DataFrame(actual_us_series_list).set_index('id'))</span></pre><p id="369b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些时间序列的长度足以对交易想法进行回溯测试:</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lq"><img src="../Images/ea7a41d8852c5c63200d9265bd77d2fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H61GzsP_cXkq-GMlFpXL7Q.png"/></div></div></figure><p id="1cdd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们可以加载其中一个系列，并将其用于我们的策略。让我们关注能源市场。我们按月考虑燃料油<code class="du lk ll lm kz b">APU000072511</code>:</p><pre class="kj kk kl km fd ky kz la lb aw lc bi"><span id="d7de" class="ld jg hi kz b fi le lf l lg lh">series_data = qndata.blsgov.load_series_data('APU000072511', \<br/>              tail = 30*365)<br/><br/><em class="je"># convert to pandas.DataFrame:</em><br/>series_data = pd.DataFrame(series_data)<br/>series_data = series_data.set_index('pub_date')<br/><br/><em class="je"># remove yearly average data, see period dictionary:</em><br/>series_data = series_data[series_data['period'] != 'M13']<br/><br/>series_data</span></pre><p id="6bd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并获得一个可用于开发交易算法的时间序列:</p><figure class="kj kk kl km fd kn er es paragraph-image"><div class="er es lr"><img src="../Images/c706b46d39bb7c9461b80f5ce8084d73.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*MaNBrSN0j7u1tpyszwxTqQ.png"/></div></figure><h1 id="ff12" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated"><strong class="ak">交易算法</strong></h1><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ls"><img src="../Images/e50257c20f42de547469a7061d5d1236.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nTSKe9HErhb2WOe4LhnG-Q.jpeg"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx">Photo by <a class="ae jd" href="https://unsplash.com/@qwitka?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Maksym Kaharlytskyi</a> on <a class="ae jd" href="https://unsplash.com/s/photos/fuel?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0da9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们关注<strong class="ih hj">能源市场</strong>,我们使用以下工具进行检查:</p><pre class="kj kk kl km fd ky kz la lb aw lc bi"><span id="0dbf" class="ld jg hi kz b fi le lf l lg lh">futures_list = qndata.futures_load_list()<br/><br/>energy_futures_list = [f <strong class="kz hj">for</strong> f <strong class="kz hj">in</strong> futures_list \<br/>    <strong class="kz hj">if</strong> f['sector'] == 'Energy']<br/><br/>pd.DataFrame(energy_futures_list)</span></pre><p id="ed18" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并获得:</p><figure class="kj kk kl km fd kn er es paragraph-image"><div class="er es lt"><img src="../Images/a9fe6dd230bc499b15c75d1e9fe70c21.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*6xsPd440U5t3Khf1jtUZUg.png"/></div></figure><p id="9afa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用<strong class="ih hj">原油WTI </strong>期货合约F_CL，并开发一个简单的策略，该策略使用燃料油作为外部指标:</p><pre class="kj kk kl km fd ky kz la lb aw lc bi"><span id="1a5b" class="ld jg hi kz b fi le lf l lg lh">import xarray as xr<br/>import numpy as np<br/>import pandas as pd<br/><br/>import qnt.ta as qnta<br/>import qnt.backtester as qnbt<br/>import qnt.data as qndata<br/><br/><br/>def load_data(period):<br/>    <br/>    futures = qndata.futures_load_data(assets=['F_CL'], \<br/>             tail=period, dims=('time','field','asset'))<br/>    <br/>    ap = qndata.blsgov.load_series_data('APU000072511', tail=period)<br/>    <br/>    <em class="je"># convert to pandas.DataFrame:</em><br/>    ap = pd.DataFrame(ap)<br/>    ap = ap.set_index('pub_date')<br/><br/>    <em class="je"># remove yearly average data, see period dictionary:</em><br/>    ap = ap[ap['period'] != 'M13']<br/>    <br/>    <em class="je"># convert to xarray:</em><br/>    ap = ap['value'].to_xarray().rename(pub_date='time').\<br/>      assign_coords(time=pd.to_datetime(ap.index.values))<br/>    <br/>    <em class="je"># return both time series:</em><br/>    return dict(ap=ap, futures=futures), futures.time.values<br/><br/><br/>def window(data, max_date: np.datetime64, lookback_period: int):<br/>    <em class="je"># the window function isolates data which are <br/>    # needed for one iteration of the backtester call</em><br/>    <br/>    min_date = max_date - np.timedelta64(lookback_period, 'D')<br/>    <br/>    return dict(<br/>        futures = data['futures'].sel(time=slice(min_date, \<br/>                  max_date)),<br/>        ap = data['ap'].sel(time=slice(min_date, max_date))<br/>    )<br/><br/><br/>def strategy(data, state):<br/>    <br/>    close = data['futures'].sel(field='close')<br/>    ap = data['ap']<br/>    <br/>    <em class="je"># the strategy complements indicators based on the <br/>    # Futures price with macro data and goes long/short <br/>    # or takes no exposure:<br/>    </em>if ap.isel(time=-1) &gt; ap.isel(time=-2) \<br/>            and close.isel(time=-1) &gt; close.isel(time=-20):<br/>        return xr.ones_like(close.isel(time=-1)), 1<br/>    <br/>    elif ap.isel(time=-1) &lt; ap.isel(time=-2) \<br/>            and ap.isel(time=-2) &lt; ap.isel(time=-3) \<br/>            and ap.isel(time=-3) &lt; ap.isel(time=-4) \<br/>            and close.isel(time=-1) &lt; close.isel(time=-40):<br/>        return -xr.ones_like(close.isel(time=-1)), 1 <br/>    <br/>    <em class="je"># When the state is None, we are in the beginning<br/>    # and no weights were generated.</em><br/>    <em class="je"># We use buy'n'hold to fill these first days.</em><br/>    elif state is None: <br/>        return xr.ones_like(close.isel(time=-1)), None<br/>    <br/>    else:<br/>        return xr.zeros_like(close.isel(time=-1)), 1<br/><br/><br/>weights, state = qnbt.backtest(<br/>    competition_type='futures',<br/>    load_data=load_data,<br/>    window=window,<br/>    lookback_period=365,<br/>    start_date='2006-01-01',<br/>    strategy=strategy,<br/>    analyze=True,<br/>    build_plots=True<br/>)</span></pre><p id="9107" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此策略可用作改进的起点(注意，性能是积极的，但样本内夏普比率小于1，因此应该改进系统以便提交):</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lu"><img src="../Images/7107ed4496d787bf1990269c4c480b76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uJkuyzQKcMpaAAtPKSRD1A.png"/></div></div></figure><p id="a10a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://github.com/quantiacs/strategy-futures-bls/blob/master/strategy.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">源代码</strong> </a>在我们的<a class="ae jd" href="https://github.com/quantiacs" rel="noopener ugc nofollow" target="_blank"> GitHub页面</a>公开发布，并且可以在<a class="ae jd" href="https://quantiacs.com/personalpage/login" rel="noopener ugc nofollow" target="_blank">你的</a>账号<a class="ae jd" href="https://www.quantiacs.com" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Quantiacs </strong> </a>找到。</p><p id="2c28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你有意见吗？让我们现在就进入<a class="ae jd" href="https://quantiacs.com/community/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">论坛</strong> </a>页面吧！</p></div></div>    
</body>
</html>