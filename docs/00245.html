<html>
<head>
<title>Quartz Scheduler using Rest API with Spring Boot and MongoDB — Onload Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Rest API和Spring Boot和MongoDB的Quartz调度程序——加载代码</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/quartz-scheduler-using-rest-api-with-spring-boot-and-mongodb-onload-code-9e70a13d88cc?source=collection_archive---------0-----------------------#2020-12-06">https://medium.com/geekculture/quartz-scheduler-using-rest-api-with-spring-boot-and-mongodb-onload-code-9e70a13d88cc?source=collection_archive---------0-----------------------#2020-12-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f36f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文演示了如何通过Spring Boot和MongoDB使用Rest API来实现和管理Quartz调度程序</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/886ff6dc42ea3ba8d043e94e770c2b26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nsDoHazQXBhlnkAe.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Quartz Scheduler using Rest API with Spring Boot and MongoDB</figcaption></figure><h1 id="17d4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">介绍</h1><p id="3546" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">Quartz是一个作业调度库，可以集成到各种各样的Java应用程序中。Quartz通常用于企业级应用程序，以支持流程工作流、系统管理操作，并在应用程序中提供及时的服务，quartz支持集群。</p><p id="de99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kw" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>是一个跨平台的面向文档的数据库程序。作为一个NoSQL数据库程序，MongoDB使用带有可选模式的类似JSON的文档。MongoDB是由MongoDB Inc .开发的，并在服务器端公共许可证下获得许可。</p><h1 id="58c9" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步骤1 —创建一个包含所需依赖项的Spring boot项目。</h1><p id="4de7" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">模仿spring boot项目我们可以使用<a class="ae kw" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank"> Spring Initializr </a>。我使用IntelliJ Idea来创建项目。</p><p id="2c39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我用的是Java 11 Gradle项目。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kx"><img src="../Images/2b6767fc9ed7ad944587775f6d1aee01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hAQa0ZNkqWn1sPgE.png"/></div></div></figure><p id="5d82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用以下依赖项</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="6d9b" class="ld ju hi kz b fi le lf l lg lh">dependencies {<br/>    implementation 'org.springframework.boot:spring-boot-starter-data-mongodb'<br/>    implementation 'org.springframework.boot:spring-boot-starter-quartz'<br/>    implementation 'org.springframework.boot:spring-boot-starter-web'<br/>    implementation("org.mongodb:mongodb-driver-sync:4.0.5")<br/>    compile "com.novemberain:quartz-mongodb:2.2.0-rc2"<br/>    implementation 'com.github.lalyos:jfiglet:0.0.3'<br/>    compileOnly 'org.projectlombok:lombok'<br/>    compile 'org.springdoc:springdoc-openapi-ui:1.2.32'<br/>    developmentOnly 'org.springframework.boot:spring-boot-devtools'<br/>    annotationProcessor 'org.projectlombok:lombok'<br/>    testImplementation 'org.springframework.boot:spring-boot-starter-test'<br/>    testImplementation 'io.projectreactor:reactor-test'<br/>}</span></pre><h1 id="b970" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步骤2——用MongoDB配置创建quartz属性文件。</h1><p id="62cb" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">在resources文件夹中创建新的属性<code class="du li lj lk kz b">quartz.properties</code>文件。并添加以下配置。请确保更改mongo数据库URL和数据库名称。</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="75c5" class="ld ju hi kz b fi le lf l lg lh"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br/># Quartz Job Scheduling<br/># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br/>#org.quartz.scheduler.instanceName=springboot-quartz-mongodb<br/>#org.quartz.scheduler.instanceId=AUTO<br/># Use the MongoDB store<br/>org.quartz.jobStore.class=com.novemberain.quartz.mongodb.MongoDBJobStore<br/># MongoDB URI (optional if 'org.quartz.jobStore.addresses' is set)<br/>org.quartz.jobStore.mongoUri=mongodb://user:password@database_IP:port/DATABASE_NAME?authSource=admin<br/># MongoDB Database name<br/>org.quartz.jobStore.dbName=DATABASE_NAME<br/># Will be used to create collections like quartz_jobs, quartz_triggers, quartz_calendars, quartz_locks<br/>org.quartz.jobStore.collectionPrefix=onload_quartz_<br/># Thread count setting is ignored by the MongoDB store but Quartz requires it<br/>org.quartz.threadPool.threadCount=1<br/># Skip running a web request to determine if there is an updated version of Quartz available for download<br/>org.quartz.scheduler.skipUpdateCheck=true<br/># Register Quartz plugins to be executed<br/># turn clustering on:<br/>#org.quartz.jobStore.isClustered=true<br/># Must be unique for each node or AUTO to use autogenerated:<br/>org.quartz.scheduler.instanceId=onloadcode<br/># org.quartz.scheduler.instanceId=node1<br/># The same cluster name on each node:<br/>org.quartz.scheduler.instanceName=onloadcode<br/># To setup other clusters use different collection prefix<br/>org.quartz.scheduler.collectionPrefix=onloadcode_quartz_<br/># Frequency (in milliseconds) at which this instance checks-in to cluster.<br/># Affects the rate of detecting failed instances.<br/># Defaults to 7500 ms.<br/>org.quartz.scheduler.clusterCheckinInterval=10000<br/># Time in millis after which a trigger can be considered as expired.<br/># Defaults to 10 minutes:<br/>org.quartz.scheduler.triggerTimeoutMillis=1200000<br/># Time in millis after which a job can be considered as expired.<br/># Defaults to 10 minutes:<br/>org.quartz.scheduler.jobTimeoutMillis=1200000<br/># Time limit in millis after which a trigger should be treated as misfired.<br/># Defaults to 5000 ms.<br/>org.quartz.scheduler.misfireThreshold=10000<br/># WriteConcern timeout in millis when writing in Replica Set.<br/># Defaults to 5000 ms.<br/>org.quartz.scheduler.mongoOptionWriteConcernTimeoutMillis=10000</span></pre><h1 id="2e7c" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步骤3 —创建配置类以从Spring Boot访问MongoDB。</h1><p id="230a" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">首先，我们必须为SpringBeanJobFactory创建一个配置文件。</p><p id="e8ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du li lj lk kz b">AutowiringSpringBeanJobFactory.java</code></p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="0232" class="ld ju hi kz b fi le lf l lg lh">package com.onloadcode.quartz.lesson.config;<br/><br/>import org.quartz.spi.TriggerFiredBundle;<br/>import org.springframework.beans.BeansException;<br/>import org.springframework.beans.factory.config.AutowireCapableBeanFactory;<br/>import org.springframework.context.ApplicationContext;<br/>import org.springframework.context.ApplicationContextAware;<br/>import org.springframework.scheduling.quartz.SpringBeanJobFactory;<br/>import org.springframework.stereotype.Component;<br/><br/>@Component<br/>public class AutowiringSpringBeanJobFactory extends SpringBeanJobFactory<br/>        implements ApplicationContextAware {<br/>    private transient AutowireCapableBeanFactory beanFactory;<br/><br/>    @Override<br/>    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {<br/>        beanFactory = applicationContext.getAutowireCapableBeanFactory();<br/>    }<br/><br/>    @Override<br/>    protected Object createJobInstance(TriggerFiredBundle bundle) throws Exception {<br/>        final Object job = super.createJobInstance(bundle);<br/>        beanFactory.autowireBean(job);<br/>        return job;<br/>    }<br/>}</span></pre><p id="52cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们必须为负载属性创建JobConfigaration类，并创建SchedulerFactoryBean。</p><p id="e73f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du li lj lk kz b">JobConfiguration.java</code></p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="7197" class="ld ju hi kz b fi le lf l lg lh">package com.onloadcode.quartz.lesson.config;<br/><br/>import lombok.extern.slf4j.Slf4j;<br/>import org.springframework.beans.factory.annotation.Autowired;<br/>import org.springframework.beans.factory.config.PropertiesFactoryBean;<br/>import org.springframework.context.ApplicationContext;<br/>import org.springframework.context.annotation.Bean;<br/>import org.springframework.context.annotation.Configuration;<br/>import org.springframework.core.io.ClassPathResource;<br/>import org.springframework.scheduling.quartz.SchedulerFactoryBean;<br/><br/>import java.io.IOException;<br/>import java.util.Properties;<br/><br/>@Slf4j<br/>@Configuration<br/>public class JobConfiguration {<br/>    @Autowired<br/>    AutowiringSpringBeanJobFactory jobFactory;<br/><br/>    @Bean<br/>    public SchedulerFactoryBean schedulerFactory(ApplicationContext applicationContext) {<br/>        try {<br/>            SchedulerFactoryBean factoryBean = new SchedulerFactoryBean();<br/>            factoryBean.setQuartzProperties(quartzProperties());<br/>            jobFactory.setApplicationContext(applicationContext);<br/>            factoryBean.setJobFactory(jobFactory);<br/>            factoryBean.setOverwriteExistingJobs(true);<br/>            factoryBean.setSchedulerName("onloadcode-job-scheduler");<br/>            log.info("onloadcode Quartz Scheduler initialized");<br/>            return factoryBean;<br/>        } catch (Exception e) {<br/>            log.error(<br/>                    "onloadcode Scheduler can not be initialized, the error is "<br/>                            + e.getMessage());<br/>            return null;<br/>        }<br/>    }<br/><br/>    @Bean<br/>    public Properties quartzProperties() throws IOException {<br/>        PropertiesFactoryBean propertiesFactoryBean = new PropertiesFactoryBean();<br/>        propertiesFactoryBean.setLocation(new ClassPathResource("/quartz.properties"));<br/>        propertiesFactoryBean.afterPropertiesSet();<br/>        return propertiesFactoryBean.getObject();<br/>    }<br/>}</span></pre><h1 id="1549" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步骤4 —创建一个用于测试的示例作业类。</h1><p id="83c1" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">接下来，我们必须创建一个示例作业类来执行quartz作业。这里我们打印上下文的内容</p><p id="df48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du li lj lk kz b">SampleJob.java</code></p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="85a7" class="ld ju hi kz b fi le lf l lg lh">package com.onloadcode.quartz.lesson.job;<br/><br/>import lombok.extern.slf4j.Slf4j;<br/>import org.quartz.Job;<br/>import org.quartz.JobDataMap;<br/>import org.quartz.JobExecutionContext;<br/>import org.quartz.JobExecutionException;<br/><br/>@Slf4j<br/>public class SampleJob implements Job {<br/>    /**<br/>     * &lt;p&gt;<br/>     * Called by the &lt;code&gt;{@link Scheduler}&lt;/code&gt; when a &lt;code&gt;{@link Trigger}&lt;/code&gt;<br/>     * fires that is associated with the &lt;code&gt;Job&lt;/code&gt;.<br/>     * &lt;/p&gt;<br/>     *<br/>     * &lt;p&gt;<br/>     * The implementation may wish to set a<br/>     * {@link JobExecutionContext#setResult(Object) result} object on the<br/>     * {@link JobExecutionContext} before this method exits.  The result itself<br/>     * is meaningless to Quartz, but may be informative to<br/>     * &lt;code&gt;{@link JobListener}s&lt;/code&gt; or<br/>     * &lt;code&gt;{@link TriggerListener}s&lt;/code&gt; that are watching the job's<br/>     * execution.<br/>     * &lt;/p&gt;<br/>     *<br/>     * @param context<br/>     * @throws JobExecutionException if there is an exception while executing the job.<br/>     */<br/>    @Override<br/>    public void execute(JobExecutionContext context) throws JobExecutionException {<br/>        log.info("Job triggered - Sample Job");<br/>        JobDataMap map = context.getMergedJobDataMap();<br/>        printData(map);<br/>        log.info("Job completed");<br/>    }<br/><br/>    private void printData(JobDataMap map) {<br/>        log.info("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; START: ");<br/>        map.entrySet().forEach(entry -&gt; {<br/>            log.info(entry.getKey() + " " + entry.getValue());<br/>        });<br/>        log.info("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; END: ");<br/>    }<br/>}</span></pre><h1 id="f743" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">第5步——通过rest APIs创建运行Quartz调度程序的Rest端点。</h1><p id="ddc7" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">让我们创建一个rest控制器类和支持请求和响应bean类来访问和操作quartz作业。</p><h1 id="d095" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">控制器类别</h1><p id="114c" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated"><code class="du li lj lk kz b">SchedulerManagementController.java</code></p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="620b" class="ld ju hi kz b fi le lf l lg lh">package com.onloadcode.quartz.lesson.controller;<br/><br/>import com.onloadcode.quartz.lesson.bean.request.JobDetailRequestBean;<br/>import com.onloadcode.quartz.lesson.bean.response.SchedulerResponseBean;<br/>import com.onloadcode.quartz.lesson.service.SchedulerService;<br/>import io.swagger.v3.oas.annotations.Operation;<br/>import io.swagger.v3.oas.annotations.media.Content;<br/>import io.swagger.v3.oas.annotations.media.Schema;<br/>import io.swagger.v3.oas.annotations.responses.ApiResponse;<br/>import io.swagger.v3.oas.annotations.responses.ApiResponses;<br/>import io.swagger.v3.oas.annotations.tags.Tag;<br/>import org.springframework.beans.factory.annotation.Autowired;<br/>import org.springframework.http.ResponseEntity;<br/>import org.springframework.web.bind.annotation.*;<br/><br/>import static org.springframework.http.HttpStatus.CREATED;<br/>import static org.springframework.http.HttpStatus.OK;<br/><br/>@RestController<br/>@RequestMapping("/api/v1/scheduler")<br/>@Tag(<br/>        name = "SchedulerManagementController",<br/>        description = "MongoDB Quartz | Scheduler Management API")<br/>public class SchedulerManagementController {<br/><br/>    public static final String JOBS = "/job-group/{jobGroup}/jobs";<br/>    public static final String JOBS_BY_NAME = "/job-group/{jobGroup}/jobs/{jobName}";<br/>    public static final String JOBS_PAUSE = "/job-group/{jobGroup}/jobs/{jobName}/pause";<br/>    public static final String JOBS_RESUME = "/job-group/{jobGroup}/jobs/{jobName}/resume";<br/>    @Autowired<br/>    private SchedulerService schedulerService;<br/><br/>    @Operation(<br/>            summary = "MongoDB Quartz | Scheduler create a new Job",<br/>            description = "",<br/>            tags = {"SchedulerManagementController"})<br/>    @ApiResponses(<br/>            value = {<br/>                    @ApiResponse(<br/>                            responseCode = "200",<br/>                            description = "successful operation",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "404",<br/>                            description = "Scheduler Job Creation API not found",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "400",<br/>                            description = "Bad Request,Scheduler Job Creation type not supported",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "500",<br/>                            description = "Failure",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class)))<br/>            })<br/>    @PostMapping(path = JOBS)<br/>    public ResponseEntity&lt;SchedulerResponseBean&gt; createJob(<br/>            @PathVariable String jobGroup, @RequestBody JobDetailRequestBean jobDetailRequestBean) {<br/>        return new ResponseEntity&lt;SchedulerResponseBean&gt;(<br/>                schedulerService.createJob(jobGroup, jobDetailRequestBean), CREATED);<br/>    }<br/><br/>    @Operation(<br/>            summary = "MongoDB Quartz | Scheduler find a Job",<br/>            description = "",<br/>            tags = {"SchedulerManagementController"})<br/>    @ApiResponses(<br/>            value = {<br/>                    @ApiResponse(<br/>                            responseCode = "200",<br/>                            description = "successful operation",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "404",<br/>                            description = "Scheduler Job find API not found",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "400",<br/>                            description = "Bad Request,Scheduler Job find type not supported",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "500",<br/>                            description = "Failure",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class)))<br/>            })<br/>    @GetMapping(path = JOBS_BY_NAME)<br/>    public ResponseEntity&lt;SchedulerResponseBean&gt; findJob(<br/>            @PathVariable String jobGroup, @PathVariable String jobName) {<br/>        return new ResponseEntity&lt;&gt;(schedulerService.findJob(jobGroup, jobName), OK);<br/>    }<br/><br/>    @Operation(<br/>            summary = "MongoDB Quartz | Scheduler update an existing Job",<br/>            description = "",<br/>            tags = {"SchedulerManagementController"})<br/>    @ApiResponses(<br/>            value = {<br/>                    @ApiResponse(<br/>                            responseCode = "200",<br/>                            description = "successful operation",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "404",<br/>                            description = "Scheduler Job update API not found",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "400",<br/>                            description = "Bad Request,Scheduler Job update type not supported",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "500",<br/>                            description = "Failure",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class)))<br/>            })<br/>    @PutMapping(path = JOBS_BY_NAME)<br/>    public ResponseEntity&lt;SchedulerResponseBean&gt; updateJob(<br/>            @PathVariable String jobGroup,<br/>            @PathVariable String jobName,<br/>            @RequestBody JobDetailRequestBean jobDetailRequestBean) {<br/>        return new ResponseEntity&lt;&gt;(schedulerService.updateJob(jobGroup, jobName, jobDetailRequestBean), OK);<br/>    }<br/><br/>    @Operation(<br/>            summary = "MongoDB Quartz | Scheduler delete Job",<br/>            description = "",<br/>            tags = {"SchedulerManagementController"})<br/>    @ApiResponses(<br/>            value = {<br/>                    @ApiResponse(<br/>                            responseCode = "200",<br/>                            description = "successful operation",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "404",<br/>                            description = "Scheduler Job delete API not found",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "400",<br/>                            description = "Bad Request,Scheduler Job delete type not supported",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "500",<br/>                            description = "Failure",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class)))<br/>            })<br/>    @DeleteMapping(path = JOBS_BY_NAME)<br/>    public ResponseEntity&lt;SchedulerResponseBean&gt; deleteJob(<br/>            @PathVariable String jobGroup, @PathVariable String jobName) {<br/>        return new ResponseEntity&lt;&gt;(schedulerService.deleteJob(jobGroup, jobName), OK);<br/>    }<br/><br/>    @Operation(<br/>            summary = "MongoDB Quartz | Scheduler pause Job",<br/>            description = "",<br/>            tags = {"SchedulerManagementController"})<br/>    @ApiResponses(<br/>            value = {<br/>                    @ApiResponse(<br/>                            responseCode = "200",<br/>                            description = "successful operation",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "404",<br/>                            description = "Scheduler Job pause API not found",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "400",<br/>                            description = "Bad Request,Scheduler Job pause type not supported",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "500",<br/>                            description = "Failure",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class)))<br/>            })<br/>    @PatchMapping(path = JOBS_PAUSE)<br/>    public ResponseEntity&lt;SchedulerResponseBean&gt; pauseJob(<br/>            @PathVariable String jobGroup, @PathVariable String jobName) {<br/>        return new ResponseEntity&lt;&gt;(schedulerService.pauseJob(jobGroup, jobName), OK);<br/>    }<br/><br/>    @Operation(<br/>            summary = "MongoDB Quartz | Scheduler resume Job",<br/>            description = "",<br/>            tags = {"SchedulerManagementController"})<br/>    @ApiResponses(<br/>            value = {<br/>                    @ApiResponse(<br/>                            responseCode = "200",<br/>                            description = "successful operation",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "404",<br/>                            description = "Scheduler Job resume API not found",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "400",<br/>                            description = "Bad Request,Scheduler Job resume type not supported",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class))),<br/>                    @ApiResponse(<br/>                            responseCode = "500",<br/>                            description = "Failure",<br/>                            content = @Content(schema = @Schema(implementation = SchedulerResponseBean.class)))<br/>            })<br/>    @PatchMapping(path = JOBS_RESUME)<br/>    public ResponseEntity&lt;SchedulerResponseBean&gt; resumeJob(<br/>            @PathVariable String jobGroup, @PathVariable String jobName) {<br/>        return new ResponseEntity&lt;&gt;(schedulerService.resumeJob(jobGroup, jobName), OK);<br/>    }<br/>}</span></pre><h1 id="b280" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">请求Bean类</h1><p id="6502" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">JobDetailRequestBean.java</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="200f" class="ld ju hi kz b fi le lf l lg lh">package com.onloadcode.quartz.lesson.bean.request;<br/><br/>import com.fasterxml.jackson.annotation.JsonIgnore;<br/>import com.fasterxml.jackson.annotation.JsonProperty;<br/>import com.onloadcode.quartz.lesson.job.SampleJob;<br/>import lombok.Data;<br/>import org.quartz.JobDataMap;<br/>import org.quartz.JobDetail;<br/>import org.quartz.Trigger;<br/><br/>import javax.validation.constraints.NotBlank;<br/>import javax.validation.constraints.NotEmpty;<br/>import java.io.Serializable;<br/>import java.util.*;<br/>import java.util.stream.Collectors;<br/><br/>import static org.quartz.JobBuilder.newJob;<br/><br/>@Data<br/>public class JobDetailRequestBean implements Serializable {<br/>    @NotBlank<br/>    private String name;<br/>    private String group;<br/>    @JsonProperty("triggers")<br/>    private List&lt;TriggerDetailsRequestBean&gt; triggerDetails = new ArrayList&lt;&gt;();<br/>    @NotEmpty<br/>    private String orgCode;<br/>    @NotEmpty<br/>    private String jobType;<br/>    @NotEmpty<br/>    private String uniqueKey;<br/>    private Map&lt;String, Object&gt; data = new LinkedHashMap&lt;&gt;();<br/><br/>    public static JobDetailRequestBean buildJobDetail(JobDetail jobDetail, List&lt;? extends Trigger&gt; triggersOfJob) {<br/>        List&lt;TriggerDetailsRequestBean&gt; triggerDetailsRequestBeanList = triggersOfJob.stream()<br/>                .map(TriggerDetailsRequestBean::buildTriggerDetails)<br/>                .collect(Collectors.toList());<br/><br/>        return new JobDetailRequestBean()<br/>                .setName(jobDetail.getKey().getName())<br/>                .setGroup(jobDetail.getKey().getGroup())<br/>                .setOrgCode(jobDetail.getJobDataMap().getString("orgCode"))<br/>                .setJobType(jobDetail.getJobDataMap().getString("jobType"))<br/>                .setUniqueKey(jobDetail.getJobDataMap().getString("uniqueKey"))<br/>                .setData((Map&lt;String, Object&gt;) jobDetail.getJobDataMap().get("data"))<br/>                .setTriggerDetails(triggerDetailsRequestBeanList);<br/>    }<br/><br/>    public JobDetailRequestBean setTriggerDetails(final List&lt;TriggerDetailsRequestBean&gt; triggerDetails) {<br/>        this.triggerDetails = triggerDetails;<br/>        return this;<br/>    }<br/><br/>    public JobDetailRequestBean setData(final Map&lt;String, Object&gt; data) {<br/>        this.data = data;<br/>        return this;<br/>    }<br/><br/>    public JobDetailRequestBean setUniqueKey(String uniqueKey) {<br/>        this.uniqueKey = uniqueKey;<br/>        return this;<br/>    }<br/><br/>    public JobDetailRequestBean setJobType(String jobType) {<br/>        this.jobType = jobType;<br/>        return this;<br/>    }<br/><br/>    public JobDetailRequestBean setOrgCode(String orgCode) {<br/>        this.orgCode = orgCode;<br/>        return this;<br/>    }<br/><br/>    public JobDetailRequestBean setGroup(final String group) {<br/>        this.group = group;<br/>        return this;<br/>    }<br/><br/>    public JobDetailRequestBean setName(final String name) {<br/>        this.name = name;<br/>        return this;<br/>    }<br/><br/>    public JobDetail buildJobDetail() {<br/>        JobDataMap jobDataMap = new JobDataMap(getData());<br/>        jobDataMap.put("orgCode", orgCode);<br/>        jobDataMap.put("jobType", jobType);<br/>        jobDataMap.put("uniqueKey", uniqueKey);<br/>        jobDataMap.put("data", data);<br/>        return newJob(SampleJob.class)<br/>                .withIdentity(getName(), getGroup())<br/>                .usingJobData(jobDataMap)<br/>                .build();<br/>    }<br/><br/>    @JsonIgnore<br/>    public Set&lt;Trigger&gt; buildTriggers() {<br/>        return triggerDetails.stream()<br/>                .map(TriggerDetailsRequestBean::buildTrigger)<br/>                .collect(Collectors.toCollection(LinkedHashSet::new));<br/>    }<br/>}</span></pre><p id="7f20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">TriggerDetailsRequestBean.java</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="1724" class="ld ju hi kz b fi le lf l lg lh">package com.onloadcode.quartz.lesson.bean.request;<br/><br/>import lombok.Data;<br/>import org.quartz.JobDataMap;<br/>import org.quartz.Trigger;<br/><br/>import javax.validation.constraints.NotBlank;<br/>import java.io.Serializable;<br/>import java.sql.Date;<br/>import java.time.LocalDateTime;<br/>import java.util.TimeZone;<br/><br/>import static java.time.ZoneId.systemDefault;<br/>import static java.util.UUID.randomUUID;<br/>import static org.quartz.CronExpression.isValidExpression;<br/>import static org.quartz.CronScheduleBuilder.cronSchedule;<br/>import static org.quartz.SimpleScheduleBuilder.simpleSchedule;<br/>import static org.quartz.TriggerBuilder.newTrigger;<br/>import static org.springframework.util.StringUtils.isEmpty;<br/><br/>@Data<br/>public class TriggerDetailsRequestBean implements Serializable {<br/>    @NotBlank<br/>    private String name;<br/>    private String group;<br/>    private LocalDateTime fireTime;<br/>    private String cron;<br/><br/>    /**<br/>     * Build trigger details trigger details request bean.<br/>     *<br/>     * @param trigger the trigger<br/>     * @return the trigger details request bean<br/>     */<br/>    public static TriggerDetailsRequestBean buildTriggerDetails(Trigger trigger) {<br/>        return new TriggerDetailsRequestBean()<br/>                .setName(trigger.getKey().getName())<br/>                .setGroup(trigger.getKey().getGroup())<br/>                .setFireTime((LocalDateTime) trigger.getJobDataMap().get("fireTime"))<br/>                .setCron(trigger.getJobDataMap().getString("cron"));<br/>    }<br/><br/>    /**<br/>     * Sets cron.<br/>     *<br/>     * @param cron the cron<br/>     * @return the cron<br/>     */<br/>    public TriggerDetailsRequestBean setCron(final String cron) {<br/>        this.cron = cron;<br/>        return this;<br/>    }<br/><br/>    /**<br/>     * Sets fire time.<br/>     *<br/>     * @param fireTime the fire time<br/>     * @return the fire time<br/>     */<br/>    public TriggerDetailsRequestBean setFireTime(final LocalDateTime fireTime) {<br/>        this.fireTime = fireTime;<br/>        return this;<br/>    }<br/><br/>    /**<br/>     * Sets group.<br/>     *<br/>     * @param group the group<br/>     * @return the group<br/>     */<br/>    public TriggerDetailsRequestBean setGroup(final String group) {<br/>        this.group = group;<br/>        return this;<br/>    }<br/><br/>    /**<br/>     * Sets name.<br/>     *<br/>     * @param name the name<br/>     * @return the name<br/>     */<br/>    public TriggerDetailsRequestBean setName(final String name) {<br/>        this.name = name;<br/>        return this;<br/>    }<br/><br/>    /**<br/>     * Build trigger trigger.<br/>     *<br/>     * @return the trigger<br/>     */<br/>    public Trigger buildTrigger() {<br/>        if (!isEmpty(cron)) {<br/>            if (!isValidExpression(cron))<br/>                throw new IllegalArgumentException(<br/>                        "Provided expression " + cron + " is not a valid cron expression");<br/>            return newTrigger()<br/>                    .withIdentity(buildName(), group)<br/>                    .withSchedule(<br/>                            cronSchedule(cron)<br/>                                    .withMisfireHandlingInstructionFireAndProceed()<br/>                                    .inTimeZone(TimeZone.getTimeZone(systemDefault())))<br/>                    .usingJobData("cron", cron)<br/>                    .build();<br/>        } else if (!isEmpty(fireTime)) {<br/>            JobDataMap jobDataMap = new JobDataMap();<br/>            jobDataMap.put("fireTime", fireTime);<br/>            return newTrigger()<br/>                    .withIdentity(buildName(), group)<br/>                    .withSchedule(simpleSchedule().withMisfireHandlingInstructionNextWithExistingCount())<br/>                    .startAt(Date.from(fireTime.atZone(systemDefault()).toInstant()))<br/>                    .usingJobData(jobDataMap)<br/>                    .build();<br/>        }<br/>        throw new IllegalStateException("unsupported trigger details " + this);<br/>    }<br/><br/>    private String buildName() {<br/>        return isEmpty(name) ? randomUUID().toString() : name;<br/>    }<br/>}</span></pre><h1 id="d970" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">响应Bean类</h1><p id="84b7" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated"><code class="du li lj lk kz b">SchedulerResponseBean.java</code></p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="323e" class="ld ju hi kz b fi le lf l lg lh">package com.onloadcode.quartz.lesson.bean.response;<br/><br/>import lombok.AllArgsConstructor;<br/>import lombok.Builder;<br/>import lombok.Data;<br/>import lombok.NoArgsConstructor;<br/>import org.springframework.http.HttpStatus;<br/><br/>@Data<br/>@AllArgsConstructor<br/>@NoArgsConstructor<br/>@Builder<br/>public class SchedulerResponseBean {<br/>    private Object result;<br/>    private HttpStatus resultCode;<br/>}</span></pre><h1 id="0fe4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步骤6-为change quartz调度程序操作创建一个服务类。</h1><p id="e919" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">让我们创建一个服务类来操作quartz调度程序的基本操作。</p><p id="cb01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du li lj lk kz b">SchedulerService.java</code></p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="827f" class="ld ju hi kz b fi le lf l lg lh">package com.onloadcode.quartz.lesson.service;<br/><br/>import com.onloadcode.quartz.lesson.bean.request.JobDetailRequestBean;<br/>import com.onloadcode.quartz.lesson.bean.response.SchedulerResponseBean;<br/>import lombok.RequiredArgsConstructor;<br/>import lombok.extern.slf4j.Slf4j;<br/>import org.quartz.*;<br/>import org.springframework.http.HttpStatus;<br/>import org.springframework.stereotype.Service;<br/><br/>import java.util.Objects;<br/>import java.util.Optional;<br/>import java.util.Set;<br/><br/>import static org.quartz.JobKey.jobKey;<br/><br/>@Slf4j<br/>@Service<br/>@RequiredArgsConstructor<br/>public class SchedulerService {<br/><br/>    private final Scheduler scheduler;<br/><br/>    /**<br/>     * Create job scheduler response bean.<br/>     *<br/>     * @param jobGroup             the job group<br/>     * @param jobDetailRequestBean the job detail request bean<br/>     * @return the scheduler response bean<br/>     */<br/>    public SchedulerResponseBean createJob(<br/>            String jobGroup, JobDetailRequestBean jobDetailRequestBean) {<br/>        SchedulerResponseBean responseBean = new SchedulerResponseBean();<br/>        jobDetailRequestBean.setGroup(jobGroup);<br/>        JobDetail jobDetail = jobDetailRequestBean.buildJobDetail();<br/>        Set&lt;Trigger&gt; triggersForJob = jobDetailRequestBean.buildTriggers();<br/>        log.info("About to save job with key - {}", jobDetail.getKey());<br/>        try {<br/>            scheduler.scheduleJob(jobDetail, triggersForJob, false);<br/>            log.info("Job with key - {} saved sucessfully", jobDetail.getKey());<br/>            responseBean.setResult(jobDetailRequestBean);<br/>            responseBean.setResultCode(HttpStatus.CREATED);<br/>        } catch (SchedulerException e) {<br/>            log.error(<br/>                    "Could not save job with key - {} due to error - {}",<br/>                    jobDetail.getKey(),<br/>                    e.getLocalizedMessage());<br/>            throw new IllegalArgumentException(e.getLocalizedMessage());<br/>        }<br/>        return responseBean;<br/>    }<br/><br/>    /**<br/>     * Find job scheduler response bean.<br/>     *<br/>     * @param jobGroup the job group<br/>     * @param jobName  the job name<br/>     * @return the scheduler response bean<br/>     */<br/>    public SchedulerResponseBean findJob(String jobGroup, String jobName) {<br/>        SchedulerResponseBean responseBean = new SchedulerResponseBean();<br/>        try {<br/>            JobDetail jobDetail = scheduler.getJobDetail(jobKey(jobName, jobGroup));<br/>            if (Objects.nonNull(jobDetail))<br/>                responseBean.setResult(<br/>                        Optional.of(<br/>                                JobDetailRequestBean.buildJobDetail(<br/>                                        jobDetail, scheduler.getTriggersOfJob(jobKey(jobName, jobGroup)))));<br/>            responseBean.setResultCode(HttpStatus.OK);<br/><br/>        } catch (SchedulerException e) {<br/>            String errorMsg =<br/>                    String.format(<br/>                            "Could not find job with key - %s.%s  due to error -  %s",<br/>                            jobGroup, jobName, e.getLocalizedMessage());<br/>            log.error(errorMsg);<br/>            responseBean.setResultCode(HttpStatus.INTERNAL_SERVER_ERROR);<br/>            responseBean.setResult(errorMsg);<br/>        }<br/>        log.warn("Could not find job with key - {}.{}", jobGroup, jobName);<br/>        return responseBean;<br/>    }<br/><br/>    /**<br/>     * Update job scheduler response bean.<br/>     *<br/>     * @param jobGroup             the job group<br/>     * @param jobName              the job name<br/>     * @param jobDetailRequestBean the job detail request bean<br/>     * @return the scheduler response bean<br/>     */<br/>    public SchedulerResponseBean updateJob(<br/>            String jobGroup, String jobName, JobDetailRequestBean jobDetailRequestBean) {<br/>        SchedulerResponseBean responseBean = new SchedulerResponseBean();<br/>        try {<br/>            JobDetail oldJobDetail = scheduler.getJobDetail(jobKey(jobName, jobGroup));<br/>            if (Objects.nonNull(oldJobDetail)) {<br/>                JobDataMap jobDataMap = oldJobDetail.getJobDataMap();<br/>                jobDataMap.put("orgCode", jobDetailRequestBean.getOrgCode());<br/>                jobDataMap.put("jobType", jobDetailRequestBean.getJobType());<br/>                jobDataMap.put("uniqueKey", jobDetailRequestBean.getUniqueKey());<br/>                jobDataMap.put("data", jobDetailRequestBean.getData());<br/>                JobBuilder jb = oldJobDetail.getJobBuilder();<br/>                JobDetail newJobDetail = jb.usingJobData(jobDataMap).storeDurably().build();<br/>                scheduler.addJob(newJobDetail, true);<br/>                log.info("Updated job with key - {}", newJobDetail.getKey());<br/>                responseBean.setResult(jobDetailRequestBean);<br/>                responseBean.setResultCode(HttpStatus.CREATED);<br/>            }<br/>            log.warn("Could not find job with key - {}.{} to update", jobGroup, jobName);<br/>        } catch (SchedulerException e) {<br/>            String errorMsg =<br/>                    String.format(<br/>                            "Could not find job with key - %s.%s to update due to error -  %s",<br/>                            jobGroup, jobName, e.getLocalizedMessage());<br/>            log.error(errorMsg);<br/>            responseBean.setResultCode(HttpStatus.INTERNAL_SERVER_ERROR);<br/>            responseBean.setResult(errorMsg);<br/>        }<br/>        return responseBean;<br/>    }<br/><br/>    /**<br/>     * Delete job scheduler response bean.<br/>     *<br/>     * @param jobGroup the job group<br/>     * @param jobName  the job name<br/>     * @return the scheduler response bean<br/>     */<br/>    public SchedulerResponseBean deleteJob(String jobGroup, String jobName) {<br/>        SchedulerResponseBean responseBean = new SchedulerResponseBean();<br/>        try {<br/>            scheduler.deleteJob(jobKey(jobName, jobGroup));<br/>            String msg = "Deleted job with key - " + jobGroup + "." + jobName;<br/>            responseBean.setResult(msg);<br/>            responseBean.setResultCode(HttpStatus.OK);<br/>            log.info(msg);<br/>        } catch (SchedulerException e) {<br/>            String errorMsg =<br/>                    String.format(<br/>                            "Could not find job with key - %s.%s to Delete due to error -  %s",<br/>                            jobGroup, jobName, e.getLocalizedMessage());<br/>            log.error(errorMsg);<br/>            responseBean.setResultCode(HttpStatus.INTERNAL_SERVER_ERROR);<br/>            responseBean.setResult(errorMsg);<br/>        }<br/>        return responseBean;<br/>    }<br/><br/>    /**<br/>     * Pause job scheduler response bean.<br/>     *<br/>     * @param jobGroup the job group<br/>     * @param jobName  the job name<br/>     * @return the scheduler response bean<br/>     */<br/>    public SchedulerResponseBean pauseJob(String jobGroup, String jobName) {<br/>        SchedulerResponseBean responseBean = new SchedulerResponseBean();<br/>        try {<br/>            scheduler.pauseJob(jobKey(jobName, jobGroup));<br/>            String msg = "Paused job with key - " + jobGroup + "." + jobName;<br/>            responseBean.setResult(msg);<br/>            responseBean.setResultCode(HttpStatus.OK);<br/>        } catch (SchedulerException e) {<br/>            String errorMsg =<br/>                    String.format(<br/>                            "Could not find job with key - %s.%s  due to error -  %s",<br/>                            jobGroup, jobName, e.getLocalizedMessage());<br/>            log.error(errorMsg);<br/>            responseBean.setResultCode(HttpStatus.INTERNAL_SERVER_ERROR);<br/>            responseBean.setResult(errorMsg);<br/>        }<br/>        return responseBean;<br/>    }<br/><br/>    /**<br/>     * Resume job scheduler response bean.<br/>     *<br/>     * @param jobGroup the job group<br/>     * @param jobName  the job name<br/>     * @return the scheduler response bean<br/>     */<br/>    public SchedulerResponseBean resumeJob(String jobGroup, String jobName) {<br/>        SchedulerResponseBean responseBean = new SchedulerResponseBean();<br/>        try {<br/>            scheduler.resumeJob(jobKey(jobName, jobGroup));<br/>            String msg = "Resumed job with key - " + jobGroup + "." + jobName;<br/>            responseBean.setResult(msg);<br/>            responseBean.setResultCode(HttpStatus.OK);<br/>        } catch (SchedulerException e) {<br/>            String errorMsg =<br/>                    String.format(<br/>                            "Could not find job with key - %s.%s  due to error -  %s",<br/>                            jobGroup, jobName, e.getLocalizedMessage());<br/>            log.error(errorMsg);<br/>            responseBean.setResultCode(HttpStatus.INTERNAL_SERVER_ERROR);<br/>            responseBean.setResult(errorMsg);<br/>        }<br/>        return responseBean;<br/>    }<br/>}</span></pre><h1 id="4476" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步骤7-创建开放API配置。</h1><p id="73a8" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">让我们为swagger文档配置开放API配置</p><p id="a4a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建OpenApiConfig类文件</p><p id="2adb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du li lj lk kz b">OpenApiConfig.java</code></p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="64e0" class="ld ju hi kz b fi le lf l lg lh">package com.onloadcode.quartz.lesson.config;<br/><br/>import io.swagger.v3.oas.models.Components;<br/>import io.swagger.v3.oas.models.OpenAPI;<br/>import io.swagger.v3.oas.models.info.Contact;<br/>import io.swagger.v3.oas.models.info.Info;<br/>import io.swagger.v3.oas.models.info.License;<br/>import org.springframework.beans.factory.annotation.Value;<br/>import org.springframework.context.annotation.Bean;<br/>import org.springframework.context.annotation.Configuration;<br/><br/>import java.util.Arrays;<br/>import java.util.HashSet;<br/>import java.util.Set;<br/><br/>@Configuration<br/>public class OpenApiConfig {<br/>    /**<br/>     * The constant DEFAULT_CONTACT.<br/>     */<br/>    public static final Contact DEFAULT_CONTACT =<br/>            new Contact()<br/>                    .name("Onload Code")<br/>                    .email("author@onloadcode.com")<br/>                    .url("www.onloadcode.com");<br/><br/>    /**<br/>     * The constant LICENSE.<br/>     */<br/>    public static final License LICENSE =<br/>            new License().name("Apache 2.0").url("http://www.apache.org/licenses/LICENSE-2.0.html");<br/><br/>    private static final Set&lt;String&gt; DEFAULT_PRODUCES_AND_CONSUMES =<br/>            new HashSet&lt;&gt;(Arrays.asList("application/json", "application/xml"));<br/>    /**<br/>     * The Api controller package.<br/>     */<br/>    @Value("${api-package}")<br/>    public String API_CONTROLLER_PACKAGE;<br/>    /**<br/>     * The Application name.<br/>     */<br/>    @Value("${application.name}")<br/>    public String APPLICATION_NAME;<br/>    /**<br/>     * The Application description.<br/>     */<br/>    @Value("${application.description}")<br/>    public String APPLICATION_DESCRIPTION;<br/><br/>    /**<br/>     * Custom open api open api.<br/>     *<br/>     * @return the open api<br/>     */<br/>    @Bean<br/>    public OpenAPI customOpenAPI() {<br/>        return new OpenAPI().components(new Components()).info(apiEndPointsInfo());<br/>    }<br/><br/>    private Info apiEndPointsInfo() {<br/>        return new Info()<br/>                .title(APPLICATION_NAME)<br/>                .description(APPLICATION_DESCRIPTION)<br/>                .contact(DEFAULT_CONTACT)<br/>                .license(LICENSE)<br/>                .version("1.0.0");<br/>    }<br/>}</span></pre><p id="d046" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">向<code class="du li lj lk kz b">application.properties</code>文件添加属性。</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="3259" class="ld ju hi kz b fi le lf l lg lh">api-package=com.onloadcode.quartz.lesson.controller<br/>application.name=quarts-scheduling-spring-boot-mongodb<br/>application.description=Quartz Scheduler using Rest API with Spring Boot and MongoDB</span></pre><h1 id="8802" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步骤8-测试应用程序。</h1><p id="573a" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">让我们运行应用程序，并验证它的运行没有任何问题</p><p id="2b32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">成功申请后，我们可以检查mongo数据库，并看到4石英收集有我们给定的前缀。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ll"><img src="../Images/a8787a4d213c2bedced71dd026e9a987.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/0*bq-BK1ttvuRG3us6.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx">quartz collections</figcaption></figure><p id="eba8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以从开放的api文档中看到所有的rest端点</p><p id="3a68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kw" href="http://localhost:8080/swagger-ui/index.html?configUrl=/v3/api-docs/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/swagger-ui/index . html？configUrl=/v3/api-docs/ </a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/fda44129218965409554c1f8933fd5bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SpuBivBxJozO6REI.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Open API documentations</figcaption></figure><h1 id="6d4c" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">演示—创建作业</h1><p id="9885" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">让我们尝试使用API的其余部分创建一个新作业。</p><p id="d1bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请求卷曲</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="1c8a" class="ld ju hi kz b fi le lf l lg lh">curl --location --request POST 'http://localhost:8080/api/v1/scheduler/job-group/TEST_TEMPLATE/jobs' \<br/>--header 'Content-Type: application/json' \<br/>--data-raw '{<br/>    "name": "testJ1",<br/>    "orgCode": "SIN",<br/>    "uniqueKey": "uniqueKey",<br/>    "jobType": "QUERY_TEMPLATE",<br/>    "jobProperties": [<br/>        {<br/>            "propertyKey": "template-name",<br/>            "propertyValue": "temp-1"<br/>        }<br/>    ],<br/>    "triggers": [<br/>        {<br/>            "name": "testJ1",<br/>            "group": "QUERY_TEMPLATE",<br/>            "cron": "0/30 0/1 * 1/1 * ? *"<br/>        }<br/>    ]<br/>}'</span></pre><p id="1e02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果将是<code class="du li lj lk kz b">201 Created</code></p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="662c" class="ld ju hi kz b fi le lf l lg lh">{<br/>    "result": {<br/>        "name": "testJ1",<br/>        "group": "TEST_TEMPLATE",<br/>        "orgCode": "SIN",<br/>        "jobType": "QUERY_TEMPLATE",<br/>        "uniqueKey": "uniqueKey",<br/>        "data": {},<br/>        "triggers": [<br/>            {<br/>                "name": "testJ1",<br/>                "group": "QUERY_TEMPLATE",<br/>                "fireTime": null,<br/>                "cron": "0/30 0/1 * 1/1 * ? *"<br/>            }<br/>        ]<br/>    },<br/>    "resultCode": "CREATED"<br/>}</span></pre><p id="794c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据给定的参数，每30秒就会触发一次该作业，我们可以在日志中看到</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="e0d5" class="ld ju hi kz b fi le lf l lg lh">2020-12-06 20:23:00.034  INFO 33552 --- [eduler_Worker-1] c.o.quartz.lesson.job.SampleJob          : Job triggered - Sample Job<br/>2020-12-06 20:23:00.034  INFO 33552 --- [eduler_Worker-1] c.o.quartz.lesson.job.SampleJob          : &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; START: <br/>2020-12-06 20:23:00.034  INFO 33552 --- [eduler_Worker-1] c.o.quartz.lesson.job.SampleJob          : cron 0/30 0/1 * 1/1 * ? *<br/>2020-12-06 20:23:00.034  INFO 33552 --- [eduler_Worker-1] c.o.quartz.lesson.job.SampleJob          : data {}<br/>2020-12-06 20:23:00.034  INFO 33552 --- [eduler_Worker-1] c.o.quartz.lesson.job.SampleJob          : orgCode SIN<br/>2020-12-06 20:23:00.034  INFO 33552 --- [eduler_Worker-1] c.o.quartz.lesson.job.SampleJob          : uniqueKey uniqueKey<br/>2020-12-06 20:23:00.034  INFO 33552 --- [eduler_Worker-1] c.o.quartz.lesson.job.SampleJob          : jobType QUERY_TEMPLATE<br/>2020-12-06 20:23:00.034  INFO 33552 --- [eduler_Worker-1] c.o.quartz.lesson.job.SampleJob          : &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; END: <br/>2020-12-06 20:23:00.034  INFO 33552 --- [eduler_Worker-1] c.o.quartz.lesson.job.SampleJob          : Job completed<br/>2020-12-06 20:23:00.043  INFO 33552 --- [eduler_Worker-1] c.n.quartz.mongodb.dao.LocksDao          : Removing trigger lock QUERY_TEMPLATE.testJ1.onloadcode<br/>2020-12-06 20:23:00.050  INFO 33552 --- [eduler_Worker-1] c.n.quartz.mongodb.dao.LocksDao          : Trigger lock QUERY_TEMPLATE.testJ1.onloadcode removed.<br/>2020-12-06 20:23:00.067  INFO 33552 --- [SchedulerThread] c.n.quartz.mongodb.dao.LocksDao          : Inserting lock for trigger QUERY_TEMPLATE.testJ1<br/>2020-12-06 20:23:00.079  INFO 33552 --- [SchedulerThread] c.n.quartz.mongodb.TriggerRunner         : Acquired trigger: QUERY_TEMPLATE.testJ1</span></pre><h1 id="f105" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">演示—找工作</h1><p id="6df2" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">让我们使用rest API来搜索我们创建的作业。</p><p id="a527" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请求卷曲</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="d104" class="ld ju hi kz b fi le lf l lg lh">curl --location --request GET 'http://localhost:8080/api/v1/scheduler/job-group/TEST_TEMPLATE/jobs/testJ1' \<br/>--data-raw ''</span></pre><p id="6e11" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果将会是<code class="du li lj lk kz b">200 OK</code></p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="b394" class="ld ju hi kz b fi le lf l lg lh">{<br/>    "result": {<br/>        "name": "testJ1",<br/>        "group": "TEST_TEMPLATE",<br/>        "orgCode": "SIN",<br/>        "jobType": "QUERY_TEMPLATE",<br/>        "uniqueKey": "uniqueKey",<br/>        "data": {},<br/>        "triggers": [<br/>            {<br/>                "name": "testJ1",<br/>                "group": "QUERY_TEMPLATE",<br/>                "fireTime": null,<br/>                "cron": "0/30 0/1 * 1/1 * ? *"<br/>            }<br/>        ]<br/>    },<br/>    "resultCode": "OK"<br/>}</span></pre><h1 id="2c44" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">演示—更新作业</h1><p id="cc55" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">让我们更新我们创建的现有作业。</p><p id="b658" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请求卷曲</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="f693" class="ld ju hi kz b fi le lf l lg lh">curl --location --request PUT 'http://localhost:8080/api/v1/scheduler/job-group/TEST_TEMPLATE/jobs/testJ1' \<br/>--header 'Content-Type: application/json' \<br/>--data-raw '{<br/>    "name": "testJ1",<br/>    "orgCode": "SIN",<br/>    "uniqueKey": "uniqueKey",<br/>    "jobType": "QUERY_TEMPLATE",<br/>    "data": <br/>        {<br/>            "propertyKey": "template-name",<br/>            "propertyValue": "temp-1"<br/>        }<br/>    ,<br/>    "triggers": [<br/>        {<br/>            "name": "testJ1",<br/>            "group": "QUERY_TEMPLATE",<br/>            "cron": "0/30 0/1 * 1/1 * ? *"<br/>        }<br/>    ]<br/>}'</span></pre><p id="8bf6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果将是<code class="du li lj lk kz b">200 OK</code></p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="e04f" class="ld ju hi kz b fi le lf l lg lh">{<br/>    "result": {<br/>        "name": "testJ1",<br/>        "group": null,<br/>        "orgCode": "SIN",<br/>        "jobType": "QUERY_TEMPLATE",<br/>        "uniqueKey": "uniqueKey",<br/>        "data": {<br/>            "propertyKey": "template-name",<br/>            "propertyValue": "temp-1"<br/>        },<br/>        "triggers": [<br/>            {<br/>                "name": "testJ1",<br/>                "group": "QUERY_TEMPLATE",<br/>                "fireTime": null,<br/>                "cron": "0/30 0/1 * 1/1 * ? *"<br/>            }<br/>        ]<br/>    },<br/>    "resultCode": "CREATED"<br/>}</span></pre><p id="3ee1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您也可以尝试暂停、恢复和删除操作。</p><h1 id="cf8f" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="16a2" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">感谢您阅读文章《如何通过Spring Boot和MongoDB使用Rest API实现和管理Quartz调度程序》</p><p id="5bc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以从我们的<a class="ae kw" href="https://github.com/authoronloadcode/Quarts-Scheduling-using-Rest-API-with-Spring-Boot-and-MongoDB" rel="noopener ugc nofollow" target="_blank"> Github </a>中找到本教程的源代码。</p></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><p id="b09d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lu">原载于2020年12月6日https://onloadcode.com</em><em class="lu">的</em> <a class="ae kw" href="https://onloadcode.com/quartz-scheduler-using-rest-api-with-spring-boot-and-mongodb/" rel="noopener ugc nofollow" target="_blank"> <em class="lu">。</em></a></p></div></div>    
</body>
</html>