<html>
<head>
<title>Create Memes Generator with NodeJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用NodeJS创建迷因生成器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/create-memes-generator-with-nodejs-2400aa1b3eb5?source=collection_archive---------21-----------------------#2021-05-07">https://medium.com/geekculture/create-memes-generator-with-nodejs-2400aa1b3eb5?source=collection_archive---------21-----------------------#2021-05-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es im"><img src="../Images/8d224b2a655744602ff16c1be07ee5ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BC_BW-o2HXt_21NyV9PxSg.jpeg"/></div></div></figure><p id="4ac6" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">本教程需要的是。</p><ol class=""><li id="630c" class="jw jx hi ja b jb jc jf jg jj jy jn jz jr ka jv kb kc kd ke bi translated">HTML和CSS</li><li id="ac43" class="jw jx hi ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke bi translated">一些Javascript</li><li id="1bd4" class="jw jx hi ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke bi translated">节点和快速</li><li id="62f6" class="jw jx hi ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke bi translated">Axios</li></ol><p id="3889" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">让我们创建一个名为meme_generator的文件夹，并通过键入<code class="du kk kl km kn b">npm init -y</code>来初始化节点项目</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es ko"><img src="../Images/8029e90c41fb37a788fd9b3264b28468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q-paU89eI28_N3v6rVTA5Q.png"/></div></div></figure><p id="f019" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">现在我们已经初始化了NodeJS项目，让我们打开该文件夹中的代码并设置我们的express和webservers配置。</p><p id="b68d" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我将创建一个index.js、public和views目录。</p><ul class=""><li id="6158" class="jw jx hi ja b jb jc jf jg jj jy jn jz jr ka jv kp kc kd ke bi translated">公共目录将存储我们的静态文件，如js，css，图像等。</li><li id="3002" class="jw jx hi ja b jb kf jf kg jj kh jn ki jr kj jv kp kc kd ke bi translated">视图目录将存储我们的意见(网页)。</li><li id="1e8b" class="jw jx hi ja b jb kf jf kg jj kh jn ki jr kj jv kp kc kd ke bi translated">Index.js将包含我们服务器的代码。</li></ul><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es kq"><img src="../Images/97b506ed0dbc7717b6d70856075486de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YfC_coTe-jwctaoI4x2n2w.png"/></div></div></figure><p id="bf36" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">首先让我们设置我们的express服务器。让我们通过键入<code class="du kk kl km kn b">npm install express ejs axios lodash</code>在那个文件夹中安装一些模块。</p><ul class=""><li id="452d" class="jw jx hi ja b jb jc jf jg jj jy jn jz jr ka jv kp kc kd ke bi translated">Express将创建我们的服务器。</li><li id="acc9" class="jw jx hi ja b jb kf jf kg jj kh jn ki jr kj jv kp kc kd ke bi translated">ejs是一个模板模块。</li><li id="03cf" class="jw jx hi ja b jb kf jf kg jj kh jn ki jr kj jv kp kc kd ke bi translated">axios是一个http请求库，它将向imgflip api发出请求。</li><li id="fe91" class="jw jx hi ja b jb kf jf kg jj kh jn ki jr kj jv kp kc kd ke bi translated">lodash是我们需要的列表函数。</li></ul><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es ko"><img src="../Images/3827251ba7dee1bec657129a6b9632c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fjcpN93Bz1mWk40OjQMMIA.png"/></div></div></figure><p id="6ded" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">现在我们已经安装了模块，让我们打开index.js并编写一些代码。</p><pre class="in io ip iq fd kr kn ks kt aw ku bi"><span id="a522" class="kv kw hi kn b fi kx ky l kz la">// IMPORTS<br/>const express = require('express');<br/>const axios = require('axios').default;<br/>const _ = require('lodash');</span><span id="787a" class="kv kw hi kn b fi lb ky l kz la">// CONSTANTS<br/>const app = express();</span><span id="fa9c" class="kv kw hi kn b fi lb ky l kz la">// MIDDLEWARES<br/>app.use(express.json()); // This will parse json payload.<br/>app.use(express.urlencoded({extended: true}); // This will parse urlencoded payload.<br/>app.use(express.static('public')); // This will serve public directory on our server.<br/>app.set('view engine', 'ejs'); // So express uses ejs as its templating engine.</span><span id="8c0e" class="kv kw hi kn b fi lb ky l kz la">// Routes<br/></span><span id="9682" class="kv kw hi kn b fi lb ky l kz la">// Listeing to server<br/>app.listen(3000, () =&gt; {<br/>  console.log("Server is running on http://localhost:3000");<br/>});</span></pre><p id="206c" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">现在我们已经准备好了代码和服务器代码。要运行它，我们需要Nodemon(一个当代码改变时重新运行文件的库)。让我们在全球范围内安装它。<code class="du kk kl km kn b">npm install -g nodemon</code></p><p id="7ef3" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">现在让我们运行这个index.js。在您的终端中键入<code class="du kk kl km kn b">nodemon index.js</code>。</p><p id="c57b" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">如果你打开浏览器进入<code class="du kk kl km kn b">http://localhost:3000</code>。将显示一条消息。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es lc"><img src="../Images/ea222f576f5b7155614e970bd7f64822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mnWMaqrcH6R0-uj3GXQxwQ.png"/></div></div></figure><pre class="in io ip iq fd kr kn ks kt aw ku bi"><span id="04d0" class="kv kw hi kn b fi kx ky l kz la">cannot get '/'</span></pre><p id="6ae2" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">这意味着我们的服务器运行正常。现在让我们设置一些路线。</p><p id="c405" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">在这里，我将创建两条路线。</p><ul class=""><li id="ed4e" class="jw jx hi ja b jb jc jf jg jj jy jn jz jr ka jv kp kc kd ke bi translated">/'将包含我们的热图生成器。</li><li id="f266" class="jw jx hi ja b jb kf jf kg jj kh jn ki jr kj jv kp kc kd ke bi translated">“/generate”将让方法POST并向imgflip API发送请求，然后返回响应。</li></ul><pre class="in io ip iq fd kr kn ks kt aw ku bi"><span id="d162" class="kv kw hi kn b fi kx ky l kz la">// IMPORTS<br/>const express = require('express');<br/>const axios = require('axios').default;<br/>const _ = require('lodash');<br/><br/>// CONSTANTS<br/>const app = express();<br/><br/>// MIDDLEWARES<br/>app.use(express.json()); // This will parse json payload.<br/>app.use(express.urlencoded({extended: true}); // This will parse urlencoded payload.<br/>app.use(express.static('public')); // This will serve public directory on our server.<br/>app.set('view engine', 'ejs'); // So express uses ejs as its templating engine.<br/><br/>// Routes<br/>app.get('/', (req, res) =&gt; {<br/>  return res.render("index");<br/>});<br/><br/>app.post("/generate", (req, res) =&gt; {<br/>  return res.send("Hello World!");<br/>});<br/><br/>// Listeing to server<br/>app.listen(3000, () =&gt; {<br/>  console.log("Server is running on http://localhost:3000");<br/>});</span></pre><p id="2d3e" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">现在我们的代码设置好了，让我们进入前端。在您的<code class="du kk kl km kn b">views</code>目录中创建一个名为<code class="du kk kl km kn b">index.ejs</code>的文件。</p><p id="4bc9" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">编写一些代码，用form-urlencoded编码类型的<code class="du kk kl km kn b">template_id, username, password, text0, text1</code>的参数向<code class="du kk kl km kn b">/generate</code>路由发出post请求。如下面的代码块所示。</p><pre class="in io ip iq fd kr kn ks kt aw ku bi"><span id="9d4d" class="kv kw hi kn b fi kx ky l kz la">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>    &lt;meta charset="UTF-8"&gt;<br/>    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;<br/>    &lt;title&gt;Input&lt;/title&gt;<br/>    &lt;link rel="stylesheet" href="style.css"&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>    &lt;div class="container"&gt;<br/>        &lt;div class="d-flex"&gt;<br/>        &lt;/div&gt;<br/>        &lt;form action="/generate" method="POST" enctype="application/x-www-form-urlencoded"&gt;<br/>            &lt;div class="input-container"&gt;<br/>                &lt;label for=""&gt;ID&lt;/label&gt;<br/>                &lt;input id="template_id" required name="template_id" type="text"&gt;<br/>            &lt;/div&gt;<br/>            &lt;div class="input-container"&gt;<br/>                &lt;label for=""&gt;Username&lt;/label&gt;<br/>                &lt;input required name="username" type="text"&gt;<br/>            &lt;/div&gt;<br/>            &lt;div class="input-container"&gt;<br/>                &lt;label for=""&gt;Password&lt;/label&gt;<br/>                &lt;input required name="password" type="password"&gt;<br/>            &lt;/div&gt;<br/>            &lt;div class="input-container"&gt;<br/>                &lt;label for=""&gt;Upper text&lt;/label&gt;<br/>                &lt;input required name="text0" type="text"&gt;<br/>            &lt;/div&gt;<br/>            &lt;div class="input-container"&gt;<br/>                &lt;label for=""&gt;Lower Text&lt;/label&gt;<br/>                &lt;input required name="text1" type="text"&gt;<br/>            &lt;/div&gt;<br/>            &lt;button type="submit" class="btn-primary"&gt;<br/>                Send<br/>            &lt;/button&gt;<br/>        &lt;/form&gt;<br/>    &lt;/div&gt;<br/>&lt;/body&gt;<br/><br/>&lt;/html&gt;</span></pre><p id="ca2b" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">现在让我们来设计一下，在你的公共目录中创建<code class="du kk kl km kn b">style.css</code>。</p><pre class="in io ip iq fd kr kn ks kt aw ku bi"><span id="0992" class="kv kw hi kn b fi kx ky l kz la">.container{<br/>    display: flex;<br/>    flex-direction: column;<br/>}<br/><br/>.input-container{<br/>    margin: 15px;<br/>    display: flex;<br/>    flex-direction: column;<br/>    width: 30%;<br/>}<br/><br/>.input-container label{<br/>    font-size: 24px;<br/>    font-family: 'Consolas', sans-serif;<br/>    font-weight: bold;<br/>}<br/><br/>.input-container input{<br/>    border-radius: 25px;<br/>    padding: 10px;<br/>    border: 1px solid grey;<br/>}<br/><br/>.btn-primary{<br/>    width: 30%;<br/>    height: 50px;<br/>    border: 1px solid white;<br/>    border-radius: 15px;<br/>    margin: 15px;<br/>    background-color: rgb(4, 156, 194);<br/>    color: white;<br/>    cursor: pointer;<br/>}<br/><br/>.d-flex{<br/>    display: flex;<br/>}<br/><br/>.d-flex img{<br/>    width: auto;<br/>    height: 100px;<br/>    margin: 10px;<br/>    border: 1px solid black;<br/>    cursor: pointer;<br/>}</span></pre><p id="0431" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">如果你在浏览器中进入<code class="du kk kl km kn b">/</code>路线，你会看到这个。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es lc"><img src="../Images/8418ed9770236218333fd0159a411e60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tLfyvVusa-6CWIjzjL2Dxw.png"/></div></div></figure><p id="e31f" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">现在让我们设置我们的邮政路线。在<code class="du kk kl km kn b">index.js</code>文件中。向imgflip api发出请求，并传递我们从服务器的索引页面发送请求时获得的参数。</p><pre class="in io ip iq fd kr kn ks kt aw ku bi"><span id="2707" class="kv kw hi kn b fi kx ky l kz la">app.post("/generate", (req, res) =&gt; {<br/>	axios<br/>		.post(<br/>			"https://api.imgflip.com/caption_image",<br/>			{},<br/>			{<br/>				params: {<br/>					template_id: req.body.template_id,<br/>					username: req.body.username,<br/>					password: req.body.password,<br/>					text0: req.body.text0,<br/>					text1: req.body.text1,<br/>				},<br/>			}<br/>		)<br/>		.then((response) =&gt; {<br/>			return res.send(`&lt;img src=${response.data.data.url}&gt;`);<br/>		}).catch((e) =&gt; {<br/>            return res.status(403).send("403 Client Error")<br/>        });<br/>});</span></pre><h2 id="3218" class="kv kw hi bd ld le lf lg lh li lj lk ll jj lm ln lo jn lp lq lr jr ls lt lu lv bi translated">注意:您需要用户名和密码来请求imgflip api，在img lip上创建您的帐户</h2><p id="85bb" class="pw-post-body-paragraph iy iz hi ja b jb lw jd je jf lx jh ji jj ly jl jm jn lz jp jq jr ma jt ju jv hb bi translated">现在我们已经完全完成了我们的POST路由，让我们创建我们的前端。</p><p id="62e9" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">让我们从imgflip api中获取所有的meme模板，并显示10个随机的meme_template，供用户选择。去你的<code class="du kk kl km kn b">/</code>路线，写这个代码。</p><pre class="in io ip iq fd kr kn ks kt aw ku bi"><span id="049c" class="kv kw hi kn b fi kx ky l kz la">app.get("/", (req, res) =&gt; {<br/>	axios<br/>		.get("https://api.imgflip.com/get_memes")<br/>		.then((memes) =&gt; {<br/>			return res.render("index", {<br/>				memes: _.sampleSize(memes.data.data.memes, 10)<br/>			});<br/>		})<br/>		.catch((e) =&gt; {<br/>			return res.status(500).send("500 Internal Server Error");<br/>		});<br/>});</span></pre><ul class=""><li id="5a78" class="jw jx hi ja b jb jc jf jg jj jy jn jz jr ka jv kp kc kd ke bi translated">sampleSize方法以列表为参数，以大小数为参数，给出随机模因数。</li><li id="baf5" class="jw jx hi ja b jb kf jf kg jj kh jn ki jr kj jv kp kc kd ke bi translated">如果有错误，这将产生互联网服务器错误信息。</li></ul><p id="0575" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">现在让我们迭代并在我们的<code class="du kk kl km kn b">index</code>视图中显示图像。</p><pre class="in io ip iq fd kr kn ks kt aw ku bi"><span id="aea9" class="kv kw hi kn b fi kx ky l kz la">&lt;div class="container"&gt;<br/>    &lt;div class="d-flex"&gt;<br/>        &lt;% for(const i of memes){ %&gt;<br/>            &lt;img class="meme_image" id=&lt;%= i.id %&gt; src=&lt;%= i.url %&gt;&gt;<br/>        &lt;% } %&gt;<br/>    &lt;/div&gt;<br/>    &lt;form action="/generate" method="POST" enctype="application/x-www-form-urlencoded"&gt;<br/>    ...<br/>&lt;/div&gt;</span></pre><p id="aeb5" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">现在我们想添加事件监听器到所有的图片，这样当我们点击图片时，它的id将会改变。</p><pre class="in io ip iq fd kr kn ks kt aw ku bi"><span id="754c" class="kv kw hi kn b fi kx ky l kz la">...<br/>&lt;/body&gt;</span><span id="8d91" class="kv kw hi kn b fi lb ky l kz la">&lt;script&gt;<br/>    var images = document.getElementsByClassName("meme_image");<br/>    var templateInput = document.getElementById("template_id");<br/>    for(const i of images){<br/>        i.addEventListener('click', (e) =&gt; {<br/>            templateInput.value = i.id;<br/>        });<br/>    }<br/>&lt;/script&gt;<br/>&lt;/html&gt;</span></pre><p id="cd6d" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">现在我们的项目完成了。如果你点击一张图片，输入你的用户名、密码和文字，然后点击提交，你的迷因就会生成。</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es mb"><img src="../Images/037980fc74c10cb2f8f87f48cae19888.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*l95D15yKaq_Kkhi7.png"/></div></div></figure><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es mc"><img src="../Images/d4d7656bc701b56d4392172e0fc5b45c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RlyAlYp6r2aXxBSJ.png"/></div></div></figure><p id="be5c" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">您可以从我的Github下载这个源代码。</p><p id="86fd" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated"><a class="ae md" href="https://github.com/Programmer101N/make-meme-generator" rel="noopener ugc nofollow" target="_blank">在Github </a>上访问这个项目</p><p id="6fe6" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">也可以看看我的博客，<a class="ae md" href="https://programmer101n.com" rel="noopener ugc nofollow" target="_blank">这里是链接</a></p></div></div>    
</body>
</html>