<html>
<head>
<title>How to Create a Subscription with Stripe Payment. Here’s the Subscription Made for You.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建带条纹支付的套餐？这是为你订的。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/get-ready-to-start-a-subscription-with-stripe-payment-ef15db43f0c0?source=collection_archive---------3-----------------------#2021-12-03">https://medium.com/geekculture/get-ready-to-start-a-subscription-with-stripe-payment-ef15db43f0c0?source=collection_archive---------3-----------------------#2021-12-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/b15ad8390387065f44fe05a329af487c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EQfA3696DioWahV8"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Photo by <a class="ae hv" href="https://unsplash.com/@swell?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">S'well</a> on <a class="ae hv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><div class=""><h2 id="91b2" class="pw-subtitle-paragraph iv hx hy bd b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm dx translated">在本文中，您将了解如何准备好订阅，以及一步一步的示例代码；产品、计划、付款方式、客户和订阅。</h2></div><p id="07b8" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">本文旨在解释如何使用Stripe Payment API创建订阅。要完全理解订阅机制，您还需要理解Stripe Webhook是如何工作的，它定义了订阅生命周期。这是一个复杂的话题，所以我不打算在这篇文章中写，但我会在以后的文章中写。</p><blockquote class="kj kk kl"><p id="48cc" class="jn jo km jp b jq jr iz js jt ju jc jv kn jx jy jz ko kb kc kd kp kf kg kh ki hb bi translated">通过<a class="ae hv" href="https://stripe.com/docs/billing/subscriptions/creating" rel="noopener ugc nofollow" target="_blank">订阅</a>，客户为获得产品支付定期费用。与一次性购买相比，订阅需要您保留更多的客户信息，因为您需要在将来自动向他们收费。</p></blockquote><p id="bc18" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">您也可以查看<a class="ae hv" href="https://stripe.com/docs/billing/subscriptions/overview" rel="noopener ugc nofollow" target="_blank">条纹文档</a>了解更多详情。</p></div><div class="ab cl kq kr gp ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hb hc hd he hf"><p id="ce4a" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在本教程中，我举例说明了如何创建一个<strong class="jp hz"><em class="km">【20美元】的每月健康饮食计划</em> </strong>。通过这一步，您将能够理解如何使用Stripe Payment API创建订阅。</p><h1 id="b001" class="kx ky hy bd kz la lb lc ld le lf lg lh je li jf lj jh lk ji ll jk lm jl ln lo bi translated">产品</h1><blockquote class="kj kk kl"><p id="cef2" class="jn jo km jp b jq jr iz js jt ju jc jv kn jx jy jz ko kb kc kd kp kf kg kh ki hb bi translated">产品描述了你提供给顾客的特定商品或服务。例如，你可以提供你的商品或服务的标准和高级版本；每个版本都是独立的产品。它们可以与<a class="ae hv" href="https://stripe.com/docs/api/products#prices" rel="noopener ugc nofollow" target="_blank">价格</a>结合使用，以配置结账和订阅中的价格。</p></blockquote><figure class="lq lr ls lt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lp"><img src="../Images/4ea3839a5b4044d2b7590207e63c06c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*67yebuvZaHY9_nsg8FbIzA.png"/></div></div></figure><p id="12df" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">例如，假设您想要销售一个<strong class="jp hz">蔬菜盒</strong>进行订阅，您需要首先在Stripe Admin中或通过Stripe API注册产品信息。</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="8bc0" class="lz ky hy lv b fi ma mb l mc md">const product = await stripe.products.create({<br/>           name='Vegetable Box',<br/>           statement_descriptor='Venetable Box'<br/>})</span></pre><p id="e742" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">就是这样。你现在有了一个叫做“蔬菜盒”的产品。接下来，让我们决定订阅间隔的价格和频率，也就是说，客户多久收到一次账单和<strong class="jp hz">蔬菜盒</strong>。</p><h1 id="d843" class="kx ky hy bd kz la lb lc ld le lf lg lh je li jf lj jh lk ji ll jk lm jl ln lo bi translated">计划</h1><blockquote class="kj kk kl"><p id="2502" class="jn jo km jp b jq jr iz js jt ju jc jv kn jx jy jz ko kb kc kd kp kf kg kh ki hb bi translated">计划定义了产品重复购买的基础价格、货币和计费周期。上面解释的产品帮助您跟踪库存或供应，计划帮助您跟踪定价。</p></blockquote><figure class="lq lr ls lt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es me"><img src="../Images/a9ed74a9c72b35b2688dc5d3e4be023f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y9hxZizTYGTq19pOOcXwmQ.png"/></div></div></figure><p id="95ff" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">例如，您可以创建一个<strong class="jp hz">健康订阅计划</strong>，向客户提供一个蔬菜盒。要创建一个计划，您需要指定<code class="du mf mg mh lv b">interval</code>、<code class="du mf mg mh lv b">currency</code>、<code class="du mf mg mh lv b">product</code>和<code class="du mf mg mh lv b">amount</code>。<em class="km">一个计划关联一个产品</em>。</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="fccb" class="lz ky hy lv b fi ma mb l mc md">const plan = await stripe.plans.create({<br/>        currency='usd',<br/>        interval='month',<br/>        product='pro_xxxxx', this is the id of vegetable box product<br/>        nickname='monthly heathly plan',<br/>        amount=20,<br/>        usage_type='licensed',<br/>})</span></pre><p id="b569" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">通过将<code class="du mf mg mh lv b">usage_type</code>设置为<code class="du mf mg mh lv b">licensed</code>，您将在套餐开始后立即收到账单。<code class="du mf mg mh lv b">interval</code>是订阅计费的频率。您可以指定<code class="du mf mg mh lv b">day</code>、<code class="du mf mg mh lv b">week</code>、<code class="du mf mg mh lv b">month</code>或<code class="du mf mg mh lv b">year</code>。在本例中，当订阅开始时，该订阅将按“月”计费。</p><p id="5f98" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在一个健康的计划已经准备好了！</p><p id="80d9" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">接下来，为了真正开始订阅，还需要三个步骤。<em class="km">需要创建支付方式、客户和订阅。</em></p><h1 id="94ad" class="kx ky hy bd kz la lb lc ld le lf lg lh je li jf lj jh lk ji ll jk lm jl ln lo bi translated">付款方式</h1><blockquote class="kj kk kl"><p id="3790" class="jn jo km jp b jq jr iz js jt ju jc jv kn jx jy jz ko kb kc kd kp kf kg kh ki hb bi translated">PaymentMethod对象代表客户的支付工具。它们可以与<a class="ae hv" href="https://stripe.com/docs/payments/payment-intents" rel="noopener ugc nofollow" target="_blank"> PaymentIntents </a>一起使用，以收集付款或保存到客户对象，以存储未来付款的工具详细信息。</p></blockquote><figure class="lq lr ls lt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mi"><img src="../Images/fa53d61dd2df70ddfb7908bdc7e56a65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EfnQbQnxkajV2e4hm1Omiw.png"/></div></div></figure><p id="a8cb" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">要保存客户的信用卡，您需要在结账时使用<a class="ae hv" href="https://stripe.dev/elements-examples/ja/" rel="noopener ugc nofollow" target="_blank">条纹元素</a>收集客户的信用卡。<strong class="jp hz"> Stripe Elements </strong>是丰富的预建UI组件，帮助您在桌面和移动设备上创建自己的结账流程。</p><p id="0e2b" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">从那里，顾客输入他们的卡信息。客户的卡信息被收集并安全地保存在Stripe中，而不是您的服务器中。</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="3f77" class="lz ky hy lv b fi ma mb l mc md">const card = elements.getElement(CardNumberElement);<br/>const payload = await stripe.createPaymentMethod({<br/>       type: 'card',<br/>       card: card,<br/>       billing_details: {<br/>          name: shipping.name,<br/>          phone: phone,<br/>          address,<br/>       },<br/>});</span></pre><p id="076c" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">成功创建后，您可以通过访问下面的付款方式id。该id将用于下一个<strong class="jp hz">客户</strong>部分。</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="2e9e" class="lz ky hy lv b fi ma mb l mc md">payload.paymentMethod.id </span></pre><p id="a131" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><em class="km">如果客户保存了多张卡，那么将会有多个付款方式id与客户相关联。</em></p><p id="74eb" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">还有，Stripe提供Apple Pay和Google Pay按钮。如果你想实施，你可以去<a class="ae hv" href="https://stripe.com/docs/stripe-js/elements/payment-request-button" rel="noopener ugc nofollow" target="_blank">详细了解他们的doc </a>。之前也写了一篇关于如何测试的详细文章。你也可以检查这个。</p><div class="hh hi ez fb hj mj"><a rel="noopener follow" target="_blank" href="/geekculture/tips-on-google-pay-and-apple-pay-with-stripe-3eaaabd6ccab"><div class="mk ab dw"><div class="ml ab mm cl cj mn"><h2 class="bd hz fi z dy mo ea eb mp ed ef hx bi translated">关于Google Pay和Apple Pay使用Stripe的提示</h2><div class="mq l"><h3 class="bd b fi z dy mo ea eb mp ed ef dx translated">这是我在实现支付请求按钮时学到的全部内容，这是Stripe Elements的一个特性。</h3></div><div class="mr l"><p class="bd b fp z dy mo ea eb mp ed ef dx translated">medium.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx hp mj"/></div></div></a></div><h1 id="6ca1" class="kx ky hy bd kz la lb lc ld le lf lg lh je li jf lj jh lk ji ll jk lm jl ln lo bi translated">顾客</h1><blockquote class="kj kk kl"><p id="4fd2" class="jn jo km jp b jq jr iz js jt ju jc jv kn jx jy jz ko kb kc kd kp kf kg kh ki hb bi translated"><code class="du mf mg mh lv b">Customer</code>对象允许您执行重复收费，并跟踪与同一客户相关的多项收费</p></blockquote><figure class="lq lr ls lt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es my"><img src="../Images/a9b17bbfa574a39781f539a66a4aa0f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NH2Lv9SkQaBZIUnG8wI0vw.png"/></div></div></figure><p id="9bdb" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><em class="km">当您的服务提供订购服务时，需要创建客户帐户并保存客户的卡信息</em>。</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="0b35" class="lz ky hy lv b fi ma mb l mc md">const customer = await stripe.customers.create({<br/>        name: shipping.name,<br/>        address: address,<br/>        invoice_settings: {<br/>            default_payment_method: paymentMethodID,<br/>        },<br/>        shipping: shipping,<br/>})</span></pre><p id="f094" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><code class="du mf mg mh lv b">default_payment_method</code>是客户默认的付款方式。</p><p id="143b" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">收集付款方式后，将其作为<code class="du mf mg mh lv b">default_payment_method</code>附加给客户。对订阅进行计费时，将自动使用默认支付方式进行计费。如果订购的客户保存了多张卡，则只对设置为<code class="du mf mg mh lv b">default_payment_method</code>的一张卡计费。当客户更换用于订购的卡时，您需要更新<code class="du mf mg mh lv b">default_payment_method</code>以便正确地对卡计费。</p><h1 id="1609" class="kx ky hy bd kz la lb lc ld le lf lg lh je li jf lj jh lk ji ll jk lm jl ln lo bi translated">签署</h1><blockquote class="kj kk kl"><p id="1770" class="jn jo km jp b jq jr iz js jt ju jc jv kn jx jy jz ko kb kc kd kp kf kg kh ki hb bi translated">订阅允许您向客户重复收费</p></blockquote><figure class="lq lr ls lt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mz"><img src="../Images/a9369ab8be138235078dc406a3239b82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iqKJey7IKWIavD6ZvXIVag.png"/></div></div></figure><p id="58f2" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">创建订阅需要<em class="km">一个客户和一个计划</em>。在我们的例子中，我们制作了一个<strong class="jp hz">健康计划</strong>，因此您可以获取计划id并将其设置为订阅和客户id。</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="1875" class="lz ky hy lv b fi ma mb l mc md">const subscription = await stripe.subscriptions.create({<br/>        customer: customerID,<br/>        tax_percent: 8,<br/>        items: [{ plan: plan.id, quantity: 1 }],<br/>        coupon: coupon<br/>})</span></pre><p id="0d47" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">您也可以在一个套餐中添加多个计划。但是在我们的例子中，让我们只购买一个数量为1的健康计划。如果您添加多个计划，将根据计划间隔和金额对您进行多次计费。</p><p id="b744" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">此外，您也可以添加可选项目。例如，如果您想要对订阅应用折扣，您可以从Stripe dashboard或通过Stripe API创建优惠券，并将其附加到订阅。</p><p id="542a" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我之前也写了一篇关于优惠券的详细文章，所以如果你对了解订阅上的优惠券是如何工作的感兴趣，你也可以查看一下。</p><div class="hh hi ez fb hj mj"><a rel="noopener follow" target="_blank" href="/geekculture/stripe-subscription-payment-create-coupon-for-subscription-89908ea86d93"><div class="mk ab dw"><div class="ml ab mm cl cj mn"><h2 class="bd hz fi z dy mo ea eb mp ed ef hx bi translated">条带订阅付款:创建并应用订阅优惠券</h2><div class="mq l"><h3 class="bd b fi z dy mo ea eb mp ed ef dx translated">订阅优惠券</h3></div><div class="mr l"><p class="bd b fp z dy mo ea eb mp ed ef dx translated">medium.com</p></div></div><div class="ms l"><div class="na l mu mv mw ms mx hp mj"/></div></div></a></div></div><div class="ab cl kq kr gp ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hb hc hd he hf"><p id="eb83" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在，当客户购买健康计划时，客户将每月支付20美元的费用。</p><h1 id="f418" class="kx ky hy bd kz la lb lc ld le lf lg lh je li jf lj jh lk ji ll jk lm jl ln lo bi translated">结束语</h1><p id="5149" class="pw-post-body-paragraph jn jo hy jp b jq nb iz js jt nc jc jv jw nd jy jz ka ne kc kd ke nf kg kh ki hb bi translated">我向您展示了如何开始使用条带订阅。与一次性购买不同，这有点困难，尤其是如果您是Stripe的新手，因为您需要创建客户、计划、产品和订阅。学习成本可能很高，但Stripe惊人地简化了这一切，初学者可以很快做好准备。我希望我的文章能帮助你理解它是如何工作的。</p><p id="f3a4" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果你有任何意见，请放下你的评论。另外，如果你愿意，请随时订阅我的学习之旅。我现在是第一次创业，我正在分享我学到的东西。</p></div><div class="ab cl kq kr gp ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hb hc hd he hf"><p id="f4dd" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我现在也正在撰写与电子商务和支付相关的其他文章，所以请随时关注我，以便在我未来的文章准备好时立即得到通知。我的账户主题是电子商务、支付和生产力。</p></div><div class="ab cl kq kr gp ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hb hc hd he hf"><p id="965a" class="pw-post-body-paragraph jn jo hy jp b jq jr iz js jt ju jc jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">(如果您希望向我发送提示🙂☕️) <br/> -以太坊地址<br/>0x 45 b 8 c 8712159 be fab 29 C3 B1 e 97 b 4534272 adff 31</p></div></div>    
</body>
</html>