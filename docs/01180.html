<html>
<head>
<title>How to Create a SwiftUI Paging Tab View</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建SwiftUI分页选项卡视图</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-create-a-swiftui-paging-tab-view-4587c19bcffb?source=collection_archive---------5-----------------------#2021-03-31">https://medium.com/geekculture/how-to-create-a-swiftui-paging-tab-view-4587c19bcffb?source=collection_archive---------5-----------------------#2021-03-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="5941" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">SwiftUI教程</h2><div class=""/><div class=""><h2 id="e428" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">Swift分页集合视图的SwiftUI版本。</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es jg"><img src="../Images/210599d077a2d6e08fe0ce3939852a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*r_9aXkwPb0P9oVttqi7H4w.jpeg"/></div><figcaption class="jo jp et er es jq jr bd b be z dx">My daily process</figcaption></figure><p id="2743" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">我在做一个纯粹的SwiftUI项目，它有一个搜索栏，一个地图，然后是一个结果部分。结果部分需要是用户可以刷卡的卡片集合，当用户停止刷卡时，焦点会捕捉到中心项目(如照片)。然后，中心项目将更新地图中的大头针。</p><p id="602c" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">在Swift中，这可以通过使用“<code class="du ko kp kq kr b">section.orthogonalScrollingBehavior = .groupPagingCentered</code>”的集合视图轻松完成</p><p id="924f" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">但是，当我在SwiftUI中搜索这样做的方法时，我没有找到一个简单的答案。</p><p id="9774" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">我尝试在ScrollView中使用LazyHGrid，但是它不能捕捉到中心项目，也不能提取中心项目的索引来更新地图。</p><p id="c8ab" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">所以我创建了一个自定义的视图修改器，并在HStack上使用。这解决了对齐中心的问题，但它并不总是有效，而且很难让卡片看起来正确。再加上还是没有解决索引问题。</p><p id="b49e" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">所以我咬紧牙关，将集合视图转换为UIViewRepresentable(这里有一组很好的指令<a class="ae ks" href="https://defagos.github.io/swiftui_collection_intro/" rel="noopener ugc nofollow" target="_blank">和</a>)，这让它很好地捕捉到项目，但我仍然不能可靠地获得居中的索引。</p><p id="174d" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">昨晚，我突然灵光一现。我正在摆弄标签视图，我看到了这个<a class="ae ks" href="https://swiftwithmajid.com/2020/09/16/tabs-and-pages-in-swiftui/" rel="noopener ugc nofollow" target="_blank">帖子</a>展示了如何用分页风格制作标签视图。</p><p id="e1b5" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">我想知道TabView是否只用于整页项目，或者它是否可以在另一个视图中工作。所以我试了一下，瞧！很好用！</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="eb5d" class="la lb hi bd lc ld le lf lg lh li lj lk ix ll iy lm ja ln jb lo jd lp je lq lr bi translated">教程项目</h1><p id="858d" class="pw-post-body-paragraph js jt hi ju b jv ls is jx jy lt iv ka kb lu kd ke kf lv kh ki kj lw kl km kn hb bi translated">我创建了一个示例项目，所以你也可以测试它。本教程假设您对SwiftUI有些陌生，但至少对Swift有基本的了解。只是想看看选项卡视图的实现？跳到<a class="ae ks" href="#a46b" rel="noopener ugc nofollow">底部</a>。</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="lx ly l"/></div><figcaption class="jo jp et er es jq jr bd b be z dx">Search App with paging Tab View</figcaption></figure><h2 id="216a" class="lz lb hi bd lc ma mb mc lg md me mf lk kb mg mh lm kf mi mj lo kj mk ml lq ho bi translated">模型和数据</h2><p id="d148" class="pw-post-body-paragraph js jt hi ju b jv ls is jx jy lt iv ka kb lu kd ke kf lv kh ki kj lw kl km kn hb bi translated">首先，在Xcode中创建新的iOS App项目。确保为界面选择“SwiftUI”，为生命周期选择“SwiftUI App”。</p><p id="03bd" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">在名为“Models.swift”的内容视图下创建一个新的Swift文件。这是我们将创建地点和假期模型的地方。</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm ly l"/></div></figure><p id="f4d4" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">现在让我们制作一些模拟数据进行搜索。您可以将其添加到模型文件中，或者创建一个“MockData.swift”文件。我为图像添加了随机的系统图片。</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm ly l"/></div></figure><h2 id="2998" class="lz lb hi bd lc ma mb mc lg md me mf lk kb mg mh lm kf mi mj lo kj mk ml lq ho bi translated">初始设置</h2><p id="9bca" class="pw-post-body-paragraph js jt hi ju b jv ls is jx jy lt iv ka kb lu kd ke kf lv kh ki kj lw kl km kn hb bi translated">现在我们已经建立了数据，让我们开始创建视图。</p><p id="0c39" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">在ContentView.swift文件下，新建4个SwiftUIViews:“searchbarview . swift”、“SearchMapView.swift”、“SearchResultsView.swift”和“ResultCardView.swift”。现在，将每个文件主体中的默认文本更改为文件名，这样您就可以在测试过程中看到视图。</p><p id="6b44" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">打开ContentView，添加两个状态属性，一个用于结果，一个用于当前选择的结果索引。然后在主体中，创建SearchBarView、SearchMapView和SearchResultsView的VStack。</p><p id="42a2" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">它应该是这样的:</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm ly l"/></div></figure><h2 id="7d91" class="lz lb hi bd lc ma mb mc lg md me mf lk kb mg mh lm kf mi mj lo kj mk ml lq ho bi translated">搜索栏</h2><p id="9e4b" class="pw-post-body-paragraph js jt hi ju b jv ls is jx jy lt iv ka kb lu kd ke kf lv kh ki kj lw kl km kn hb bi translated">搜索栏视图有几个组成部分:标题、文本字段和搜索功能。</p><p id="34bd" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">为我们希望用于搜索的输入文本创建一个State属性，并为结果创建一个绑定。在正文中，添加一个带有文本标题和文本字段的VStack。文本字段将链接到State属性中的文本。然后，您可以添加一个按钮来开始搜索，或者让文本字段搜索“onCommit”。我觉得搜索onCommit更直观。</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm ly l"/></div></figure><p id="e07b" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">在我们创建搜索功能之前，让我们在文件底部添加一个小助手。这个助手非常适合查找数组中满足特定条件的所有值。我在这里找到了这个帮手<a class="ae ks" href="https://learnappmaking.com/find-item-in-array-swift/#finding-all-items-in-an-array-with-allwhere" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="jh ji jj jk fd mn kr mo mp aw mq bi"><span id="5b4a" class="lz lb hi kr b fi mr ms l mt mu"><strong class="kr hs">extension</strong> Array <strong class="kr hs">where</strong> Element: Equatable {<br/><strong class="kr hs">  func</strong> all(where predicate: (Element) -&gt; Bool) -&gt; [Element]  {<br/><strong class="kr hs">    return</strong> <strong class="kr hs">self</strong>.compactMap { predicate($0) ? $0 : <strong class="kr hs">nil</strong> }<br/>  }<br/>}</span></pre><p id="e26c" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">现在我们可以使用all(where:)方法来动态过滤我们的数据。我选择让它在Vacation.name或Place.name中查找搜索词</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm ly l"/></div></figure><h2 id="1334" class="lz lb hi bd lc ma mb mc lg md me mf lk kb mg mh lm kf mi mj lo kj mk ml lq ho bi translated">地图</h2><p id="ac46" class="pw-post-body-paragraph js jt hi ju b jv ls is jx jy lt iv ka kb lu kd ke kf lv kh ki kj lw kl km kn hb bi translated">[本节于2011年4月8日更新，以正确更新地区。]</p><p id="3a21" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">为了让地图动态更新，我们需要创建一个ObservableObject模型和一个ObservedObject属性。使用可观察对象可以防止视图在视图更新期间修改状态，这可能会产生意想不到的结果。首先，让我们创建区域模型:</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm ly l"/></div></figure><p id="adf4" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">然后将ObservedObject作为属性添加到地图中。我为我的国家给它一个缺省值，但是你能在你喜欢的任何地方设置你的。</p><p id="f130" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">我们还需要结果和索引的绑定。</p><p id="bfdf" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">然后，每当结果或当前选择发生变化时，我们将需要一个函数来重新居中和缩放地图。</p><p id="c444" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">当我们创建地图时，我们希望注释根据当前选择的结果进行更新。但是我们不能指望结果总是有一个值。在用户搜索之前，或者如果搜索是空的，地图不应该有任何注释。annotationItems将接受空数组，但不接受可选的/nil项。</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm ly l"/></div></figure><h2 id="bb91" class="lz lb hi bd lc ma mb mc lg md me mf lk kb mg mh lm kf mi mj lo kj mk ml lq ho bi translated">成绩卡</h2><p id="fc69" class="pw-post-body-paragraph js jt hi ju b jv ls is jx jy lt iv ka kb lu kd ke kf lv kh ki kj lw kl km kn hb bi translated">现在我们需要制作显示每个结果的卡片。对于本教程，我决定在假期中添加随机的系统图片，这样卡片会更有视觉吸引力。你可以随意调整这张卡片的设计。我很想看看人们想出的一些创造性的东西。</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm ly l"/></div></figure><h2 id="702b" class="lz lb hi bd lc ma mb mc lg md me mf lk kb mg mh lm kf mi mj lo kj mk ml lq ho bi translated">搜索结果视图</h2><p id="914e" class="pw-post-body-paragraph js jt hi ju b jv ls is jx jy lt iv ka kb lu kd ke kf lv kh ki kj lw kl km kn hb bi translated">现在项目已经设置好了，我们终于可以在搜索结果视图中实现TabView了。我们需要绑定结果和选择属性。实际的选项卡视图非常容易实现。</p><p id="c7fc" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">让我们从构建视图的主要部分开始。</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mm ly l"/></div></figure><p id="71b3" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">构建选项卡视图类似于在SwiftUI中创建列表，因为您创建它，并使用ForEach迭代数组。神奇之处在于第一行，在这里，TabView被绑定到选择。它将根据您当前查看的结果自动更新选择。</p><pre class="jh ji jj jk fd mn kr mo mp aw mq bi"><span id="37e4" class="lz lb hi kr b fi mr ms l mt mu">TabView(selection: $selection) {</span><span id="a52f" class="lz lb hi kr b fi mv ms l mt mu">}</span></pre><p id="9556" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">在这种情况下，我们将稍微不同地实现ForEach，因为我们希望将当前显示的卡片的索引传递给map，因此它将更新pin。使用results.enumerated()来做到这一点很有诱惑力，但我警告不要这样做。特别是当数组改变时(你做了一个新的搜索)，有可能得到一个“索引越界”的错误。所以我们将压缩数组，就像<a class="ae ks" href="https://stackoverflow.com/questions/59295206/how-do-you-use-enumerated-with-foreach-in-swiftui" rel="noopener ugc nofollow" target="_blank"> this </a>:</p><pre class="jh ji jj jk fd mn kr mo mp aw mq bi"><span id="c77b" class="lz lb hi kr b fi mr ms l mt mu">ForEach(Array(zip(results.indices, results)), id: \.0) { index, result <strong class="kr hs">in<br/></strong>  ResultCardView(vacation: results[index]).tag(index)<br/>}</span></pre><p id="77cf" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">标签非常重要，因为这是TabView知道将选择更新到哪个数字的方法。</p><p id="4930" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">现在给TabView一些样式</p><pre class="jh ji jj jk fd mn kr mo mp aw mq bi"><span id="80c3" class="lz lb hi kr b fi mr ms l mt mu">.tabViewStyle(PageTabViewStyle(indexDisplayMode: .always))</span></pre><p id="5847" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">完成的TabView应该如下所示:</p><pre class="jh ji jj jk fd mn kr mo mp aw mq bi"><span id="f22d" class="lz lb hi kr b fi mr ms l mt mu">TabView(selection: $selection)  {<br/>  ForEach(Array(zip(results.indices, results)), id: \.0) { index, result <strong class="kr hs">in<br/>    </strong>ResultCardView(vacation: results[index]).tag(index)<br/>  }<br/>} //: TabView<br/>.tabViewStyle(PageTabViewStyle(indexDisplayMode: .always))</span></pre><p id="a46b" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">现在项目完成了！通过运行来测试它，并告诉我你的想法。在此找到已完成的项目<a class="ae ks" href="https://github.com/CrystalKnightCodes/SearchResults" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>