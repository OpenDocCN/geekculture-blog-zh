<html>
<head>
<title>Zuul API Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Zuul API网关</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/zuul-api-gateway-2bcdf4dd33e6?source=collection_archive---------0-----------------------#2021-02-07">https://medium.com/geekculture/zuul-api-gateway-2bcdf4dd33e6?source=collection_archive---------0-----------------------#2021-02-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5bf4e7fee756e267f32c46941c54ca56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LTXkBeFW-vq8L9mD.png"/></div></div></figure><p id="b096" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程中，我们主要关注于<strong class="is hj"> Zuul API网关</strong>。我们有这么多可用的API网关。在<strong class="is hj">春云</strong>我们有一个<strong class="is hj"> Zuul API网关</strong>。如果您在基于AWS的环境中工作，那么您将拥有不同的AWS API网关。所以你可以用任何一个。</p><p id="57b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">什么是<strong class="is hj">微服务</strong>？</p><p id="38f7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">微服务</strong>——也称为<strong class="is hj">微服务</strong>架构——是一种架构风格，将应用程序构建为一组服务。高度可维护和可测试。松散耦合。可独立部署。围绕业务能力组织。</p><p id="3a8b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想知道更多关于微服务的细节，请参考我以前的文章。</p><div class="jo jp ez fb jq jr"><a href="https://kasunprageethdissanayake.medium.com/monolithic-vs-microservices-architecture-part-1-3bc5d4070a4e" rel="noopener follow" target="_blank"><div class="js ab dw"><div class="jt ab ju cl cj jv"><h2 class="bd hj fi z dy jw ea eb jx ed ef hh bi translated">单片与微服务架构(第1部分)</h2><div class="jy l"><h3 class="bd b fi z dy jw ea eb jx ed ef dx translated">在本教程中，我们将深入了解单片架构和微服务。这里我们关注的是…</h3></div><div class="jz l"><p class="bd b fp z dy jw ea eb jx ed ef dx translated">kasunprageethdissanayake.medium.com</p></div></div><div class="ka l"><div class="kb l kc kd ke ka kf io jr"/></div></div></a></div><h2 id="dcb7" class="kg kh hi bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la bi translated">什么是尤里卡服务器？</h2><p id="badd" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated"><strong class="is hj"> Eureka </strong> Server是一个保存所有客户端服务应用程序信息的应用程序。每个微服务将注册到<strong class="is hj"> Eureka </strong>服务器中，并且<strong class="is hj"> Eureka </strong>服务器知道在每个端口和IP地址上运行的所有客户端应用。<strong class="is hj">尤里卡</strong>服务器也被称为发现服务器。有了<strong class="is hj">网飞尤里卡</strong>每个客户端可以同时充当服务器，把自己的状态复制给连接的对等体。换句话说，客户机检索服务注册中心的所有连接对等体的列表，并通过负载平衡算法向任何其他服务发出所有进一步的请求。</p><h2 id="9628" class="kg kh hi bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la bi translated">Zuul API网关</h2><p id="de27" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">Zuul服务器是一个API网关应用。它处理所有请求，并执行微服务应用程序的动态路由。它也被称为边缘服务器。Zuul的构建是为了实现动态路由、监控、弹性和安全性。它还可以将请求路由到多个Amazon Auto Scaling组。</p><p id="4d45" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，<strong class="is hj">/API/产品</strong>映射到<strong class="is hj">产品</strong>服务，<strong class="is hj">/API/用户</strong>映射到<strong class="is hj">用户</strong>服务。Zuul服务器动态地将请求路由到相应的后端应用程序。</p><h2 id="3a32" class="kg kh hi bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la bi translated">如何在微服务应用中使用Zuul API网关？</h2><p id="ce83" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">假设我们有一个名为Eureka Registry 的注册服务器<strong class="is hj">，我们有不同的微服务应用。<strong class="is hj">微服务1 </strong>和<strong class="is hj">微服务2 </strong>。它们部署在不同的主机上，端口也不同。我们也有一个注册在网飞尤里卡的UI服务。现在所有的微服务都在尤里卡注册服务器上注册了。</strong></p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lg"><img src="../Images/c07c4a0723affe9ba23a0460039bd64e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UwxdEprFRhUoUPFHuxNeGA.png"/></div></div></figure><p id="cbf0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，假设我们需要从<strong class="is hj"> UI服务</strong>与<strong class="is hj">微服务</strong>进行通信，这里的安全性非常危险。在这种场景中，我们需要为所有的微服务提供安全性。假设我们有100个微服务，如果您想要在<strong class="is hj">授权2 </strong>和<strong class="is hj"> JWT </strong>下为所有这100个微服务提供安全性，这将会非常危险。我们需要为所有这100个微服务编写相同的代码，并且需要进行授权和认证。这可不好。</p><p id="0521" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们实时做的是，所有的微服务都将部署在一个私有网络中，这样这些微服务就不会暴露给外界。没人能接触到它。那我们怎么保证这里的安全呢？。</p><p id="c1ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后Zuul API网关就出现了。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/f0a036f91b91b1d4aa07c3e655936349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MReN7nz3HPh4ypoPJG4tHQ.png"/></div></div></figure><p id="7ca7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设我们有微服务注册中心，我们有多个微服务。所有微服务都在网飞尤里卡注册，我们还有一个API网关，它是微服务之一，也是Spring Cloud的一部分。所以一旦所有的服务都注册了，所有的服务都可以在网飞尤里卡注册中心找到。现在微服务1和微服务2在一个私有网络中，它们不暴露在外面。现在，我们如何将Web UI微服务传达给微服务1？</p><p id="fc80" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每当来自用户的任何请求到来时，对任何UI服务的请求将被发送到<strong class="is hj"> Zuul API网关</strong>。Zuul将把所有的请求路由到相应的微服务。因此，这里不是向UI公开所有的微服务，UI需要向API网关发送请求，而网关应该提供安全性(授权和认证)和路由。在这里，我们需要过滤所有的请求(用户),这个特定的用户是否被授权，如果被授权，允许路由到用户到特定的微服务。</p><p id="ba70" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在下一个教程中，我们将通过创建一个示例项目来了解如何以编程方式实现这一点。</p><h2 id="5992" class="kg kh hi bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la bi translated">Zuul组件</h2><p id="1f50" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">Zuul主要有四种类型的过滤器，使我们能够在任何特定交易的请求处理的不同时间线中拦截流量。我们可以为特定的<strong class="is hj"> URL模式</strong>添加任意数量的过滤器。</p><ul class=""><li id="6e8d" class="lm ln hi is b it iu ix iy jb lo jf lp jj lq jn lr ls lt lu bi translated"><strong class="is hj">预过滤器</strong> —在请求被路由之前被调用</li><li id="785c" class="lm ln hi is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu bi translated"><strong class="is hj">后归档器</strong> —在请求被路由后调用</li><li id="d0f9" class="lm ln hi is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu bi translated"><strong class="is hj">路由过滤器</strong> —用于路由请求</li><li id="51cb" class="lm ln hi is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu bi translated"><strong class="is hj">错误过滤器</strong> —当处理请求时出现错误时被调用。</li></ul><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ma"><img src="../Images/c94c4c6b73b2459b8a1c3b13c49ff0d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*P8YEqRqexDS4RHyb.png"/></div></div></figure><h2 id="e9a2" class="kg kh hi bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la bi translated">网关服务的共同责任</h2><ul class=""><li id="8733" class="lm ln hi is b it lb ix lc jb mb jf mc jj md jn lr ls lt lu bi translated">在网关层应用微服务认证和安全性来保护实际的服务</li><li id="5f64" class="lm ln hi is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu bi translated">我们可以对进入生态系统的所有流量进行微服务洞察和监控，方法是启用一些日志记录，在边缘获取有意义的数据和统计信息，以便为我们提供准确的生产视图。</li><li id="0399" class="lm ln hi is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu bi translated">动态路由可以根据需要将请求路由到不同的后端集群。</li><li id="6361" class="lm ln hi is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu bi translated">我们可以通过逐渐增加新集群的流量来进行运行时压力测试，以便在许多场景中评估性能。例如:集群具有新的硬件和网络设置，或者部署了新版本的生产代码。</li><li id="363c" class="lm ln hi is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu bi translated">我们可以动态减载。例如:为每种类型的请求分配容量，并丢弃超过限制的请求。</li><li id="1637" class="lm ln hi is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu bi translated">我们可以应用静态响应处理，例如:直接在边缘构建一些响应，而不是将它们转发到内部集群进行处理。</li></ul><h2 id="77d6" class="kg kh hi bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la bi translated">创建Zuul API网关的步骤</h2><ul class=""><li id="8527" class="lm ln hi is b it lb ix lc jb mb jf mc jj md jn lr ls lt lu bi translated"><strong class="is hj">尤里卡服务</strong>:尤里卡服务/命名服务器不需要任何改变</li><li id="81f8" class="lm ln hi is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu bi translated"><strong class="is hj">生产者服务</strong>:假设我们的微服务1</li><li id="df2d" class="lm ln hi is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu bi translated"><strong class="is hj">消费者服务</strong>:假设我们的微服务2</li><li id="49aa" class="lm ln hi is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu bi translated"><strong class="is hj"> Zuul服务</strong>:编写一个Zuul服务，并将所有来自UI的请求路由到相应的生产者服务</li></ul><p id="87ea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在下一个教程中，我们将通过创建一个示例项目来了解如何以编程方式设计Zuul API网关。</p><p id="ddc0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我希望你对Zuul API网关有所了解。下节课再见。</p><p id="0b2d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">谢谢大家！</p></div></div>    
</body>
</html>