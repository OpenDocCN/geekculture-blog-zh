<html>
<head>
<title>Explore Clipboard Operation in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索JavaScript中的剪贴板操作</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/explore-clipboard-operation-in-javascript-c6399619c0ac?source=collection_archive---------4-----------------------#2021-03-22">https://medium.com/geekculture/explore-clipboard-operation-in-javascript-c6399619c0ac?source=collection_archive---------4-----------------------#2021-03-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="44b0" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在JavaScript中剪切、复制和粘贴</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/31950001d75f5f1fc32a595df8ed27d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5NqK_GvOb0buWsDmDUvWkg.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://www.pexels.com/@alex-green?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Alex Green</a> from <a class="ae jn" href="https://www.pexels.com/photo/crop-interviewer-writing-in-notepad-and-talking-to-job-seeker-5699480/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><p id="0250" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">浏览器允许JavaScript脚本读写剪贴板，并自动复制或粘贴内容。一般来说，脚本不应该修改用户的剪贴板，以免不符合用户的期望。不过有时候这样做也可以很方便，比如“一键复制”功能，用户点击一个按钮，指定的内容就自动输入到剪贴板中。目前，有三种方法来实现剪贴板操作。</p><ul class=""><li id="977d" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated"><code class="du kt ku kv kw b">Document.execCommand()</code>方法</li><li id="0413" class="kk kl hi jq b jr kx ju ky jx kz kb la kf lb kj kp kq kr ks bi translated">异步剪贴板API</li><li id="04a7" class="kk kl hi jq b jr kx ju ky jx kz kb la kf lb kj kp kq kr ks bi translated"><code class="du kt ku kv kw b">copy</code>、<code class="du kt ku kv kw b">cut</code>和<code class="du kt ku kv kw b">paste</code>事件</li></ul><p id="5010" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">本文逐一介绍这三种方法。这是我第37篇中型文章。</p></div><div class="ab cl lc ld gp le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hb hc hd he hf"><h1 id="a2d2" class="lj lk hi bd ll lm ln lo lp lq lr ls lt io lu ip lv ir lw is lx iu ly iv lz ma bi translated">Document.execCommand()方法</h1><p id="c717" class="pw-post-body-paragraph jo jp hi jq b jr mb ij jt ju mc im jw jx md jz ka kb me kd ke kf mf kh ki kj hb bi translated"><code class="du kt ku kv kw b">Document.execCommand()</code>是操作剪贴板的传统方法，各种浏览器都支持。它支持复制、剪切和粘贴三种操作。</p><ul class=""><li id="3ffd" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated"><code class="du kt ku kv kw b">Document.execCommand('copy')</code> —复制</li><li id="7e1f" class="kk kl hi jq b jr kx ju ky jx kz kb la kf lb kj kp kq kr ks bi translated"><code class="du kt ku kv kw b">Document.execCommand('cut')</code> —切割</li><li id="1164" class="kk kl hi jq b jr kx ju ky jx kz kb la kf lb kj kp kq kr ks bi translated"><code class="du kt ku kv kw b">Document.execCommand('paste')</code> —粘贴</li></ul><h2 id="dc7d" class="mg lk hi bd ll mh mi mj lp mk ml mm lt jx mn mo lv kb mp mq lx kf mr ms lz mt bi translated">复制或剪切操作</h2><p id="f078" class="pw-post-body-paragraph jo jp hi jq b jr mb ij jt ju mc im jw jx md jz ka kb me kd ke kf mf kh ki kj hb bi translated">复制时，先选中文本然后调用<code class="du kt ku kv kw b">Document.execCommand('copy')</code>，选中的文本将进入剪贴板。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="a970" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在上面的例子中，脚本首先选择输入框(<code class="du kt ku kv kw b">inputElement.select()</code>)的<code class="du kt ku kv kw b">inputElement</code>中的文本，然后<code class="du kt ku kv kw b">Document.execCommand('copy')</code>将其复制到剪贴板。请注意，复制操作最好放在事件侦听器函数中，由用户触发(例如，用户单击一个按钮)。如果脚本自动执行，一些浏览器可能会报告错误。剪切操作也类似于复制操作。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h2 id="9cbd" class="mg lk hi bd ll mh mi mj lp mk ml mm lt jx mn mo lv kb mp mq lx kf mr ms lz mt bi translated">粘贴操作</h2><p id="17a5" class="pw-post-body-paragraph jo jp hi jq b jr mb ij jt ju mc im jw jx md jz ka kb me kd ke kf mf kh ki kj hb bi translated">粘贴时，调用<code class="du kt ku kv kw b">Document.execCommand('paste')</code>会将剪贴板的内容输出到当前焦点元素。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h2 id="7b19" class="mg lk hi bd ll mh mi mj lp mk ml mm lt jx mn mo lv kb mp mq lx kf mr ms lz mt bi translated">不足之处</h2><p id="7258" class="pw-post-body-paragraph jo jp hi jq b jr mb ij jt ju mc im jw jx md jz ka kb me kd ke kf mf kh ki kj hb bi translated">虽然<code class="du kt ku kv kw b">Document.execCommand()</code>方法很方便，但也有一些缺点。第一，它只能将选中的内容复制到剪贴板，不能任意将内容写入剪贴板。其次，它是一个异步操作。如果复制/粘贴大量数据，页面会冻结。有些浏览器还会弹出提示框，询问用户权限。此时，在用户做出选择之前，页面将变得没有响应。为了解决这些问题，浏览器厂商提出了异步剪贴板API。</p></div><div class="ab cl lc ld gp le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hb hc hd he hf"><h1 id="c587" class="lj lk hi bd ll lm ln lo lp lq lr ls lt io lu ip lv ir lw is lx iu ly iv lz ma bi translated">异步剪贴板API</h1><p id="a496" class="pw-post-body-paragraph jo jp hi jq b jr mb ij jt ju mc im jw jx md jz ka kb me kd ke kf mf kh ki kj hb bi translated">Clipboard API是下一代剪贴板操作方法，比传统的<code class="du kt ku kv kw b">Document.execCommand()</code>方法更加强大合理。它的所有操作都是异步的，并且返回Promise对象而不会导致页面阻塞。此外，它可以将任意内容(如图片)放入剪贴板。<code class="du kt ku kv kw b">navigator.clipboard</code>属性返回Clipboard对象，所有操作都通过该对象执行。</p><pre class="iy iz ja jb fd mw kw mx my aw mz bi"><span id="dfbb" class="mg lk hi kw b fi na nb l nc nd">const clipboardObj = navigator.clipboard;</span></pre><p id="125f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果<code class="du kt ku kv kw b">navigator.clipboard</code>属性返回<code class="du kt ku kv kw b">undefined</code>，则意味着当前浏览器不支持该API(你可以在<a class="ae jn" href="https://caniuse.com/async-clipboard" rel="noopener ugc nofollow" target="_blank">上看到完整的兼容表我可以使用</a> …)。由于用户可能会将敏感数据(如密码)放在剪贴板上，允许脚本任意读取会造成安全隐患，所以这个API有更多的安全限制。首先，Chrome浏览器规定只有HTTPS协议页面可以使用这个API。然而，开发环境(<code class="du kt ku kv kw b">localhost</code>)允许使用非加密协议。其次，调用时需要明确获得用户的许可。权限的具体实现使用权限API。与剪贴板相关的权限有两种:<code class="du kt ku kv kw b">clipboard-write</code>(写权限)和<code class="du kt ku kv kw b">clipboard-read</code>(读权限)。“写权限”自动授予脚本，而“读权限”必须由用户明确授予。换句话说，脚本在写入剪贴板时可以自动完成，但在读取剪贴板时，浏览器会弹出一个对话框，询问用户是否同意读取。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ne"><img src="../Images/2e1b01c40d0264da0343d18d699051f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fmmX3ymNeN4iSPfG8UU1QA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">The permission prompt for the Clipboard API.</figcaption></figure><p id="41ce" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">另外需要注意的是，脚本读取的始终是当前页面的剪贴板。这样带来的一个问题是，如果将相关代码粘贴到开发者工具中直接运行，可能会报错，因为此时的当前页面是开发者工具的窗口，而不是网页。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="499f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果您将上述代码粘贴到开发人员工具中并运行它，将会报告一个错误。因为在代码运行的时候，开发者工具窗口就是当前页面，并没有剪贴板API依赖这个页面的DOM接口。一种解决方法是将相关代码放在setTimeout()中延迟运行，在调用函数之前快速点击浏览器的页面窗口，使其变成当前页面。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="4315" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">将上述代码粘贴到开发者工具中运行后，快速点击网页的页面窗口，使其成为当前页面，这样就不会报错。</p><h2 id="30ab" class="mg lk hi bd ll mh mi mj lp mk ml mm lt jx mn mo lv kb mp mq lx kf mr ms lz mt bi translated">剪贴板对象</h2><p id="c122" class="pw-post-body-paragraph jo jp hi jq b jr mb ij jt ju mc im jw jx md jz ka kb me kd ke kf mf kh ki kj hb bi translated"><strong class="jq hj"> clipboard.readText() </strong></p><p id="7d83" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><code class="du kt ku kv kw b">clipboard.readText()</code>方法用于复制剪贴板中的文本数据。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="63c5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在上面的例子中，用户点击页面后，剪贴板中的文本将被输出。注意，此时浏览器会弹出一个对话框，询问用户是否同意脚本读取剪贴板。</p><p id="92a6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果用户不同意，脚本将报告一个错误。这时，你可以使用<code class="du kt ku kv kw b">try...catch</code>结构来处理错误。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="ddf4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> clipboard.read() </strong></p><p id="5e4c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><code class="du kt ku kv kw b">clipboard.read()</code>方法用于复制剪贴板中的数据，可以是文本数据，也可以是二进制数据(比如图片)。此方法需要用户的明确许可。这个方法返回一个Promise对象。一旦对象的状态被解析，就可以获得一个数组，每个数组成员都是ClipboardItem对象的一个实例。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="c212" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">ClipboardItem对象表示单个剪辑项，每个剪辑项都有一个<code class="du kt ku kv kw b">clipboardItem.types</code>属性和一个<code class="du kt ku kv kw b">clipboardItem.getType()</code>方法。属性返回一个数组，该数组的成员是剪辑项可用的MIME类型。例如，剪辑项可以以HTML格式或纯文本格式粘贴。然后它有两个MIME类型(<code class="du kt ku kv kw b">text/html</code>和<code class="du kt ku kv kw b">text/plain</code>)。<code class="du kt ku kv kw b">clipboardItem.getType(type)</code>方法用于读取剪辑项的数据，并返回一个Promise对象。该方法接受剪辑项的MIME类型作为参数，并返回该类型的数据。此参数是必需的，否则将会报告错误。</p><p id="2d57" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> clipboard.writeText() </strong></p><p id="0bbd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><code class="du kt ku kv kw b">clipboard.writeText()</code>方法用于将文本内容写入剪贴板。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="ef0d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">上面的例子是用户点击网页后，脚本将文本数据写入剪贴板。该方法不需要用户权限，但最好放在<code class="du kt ku kv kw b">try...catch</code>中，以防出错。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="3d1d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> clipboard.write() </strong></p><p id="c40f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><code class="du kt ku kv kw b">clipboard.write()</code>方法用于将任意数据写入剪贴板，可以是文本数据，也可以是二进制数据。此方法接受ClipboardItem实例作为参数，该实例表示写入剪贴板的数据。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="b939" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在上面的例子中，脚本将一张图片写入剪贴板。请注意，Chrome浏览器目前(直到本文作者撰写本文之前)仅支持以PNG格式编写图像。<code class="du kt ku kv kw b">clipboardItem()</code>是浏览器原生提供的构造函数，用于生成<code class="du kt ku kv kw b">clipboardItem</code>的实例。它接受一个对象作为参数。对象的键名是数据的MIME类型，键值是数据本身。下面的例子是将同一个剪辑项的值以多种格式写入剪贴板，一种是文本数据，一种是二进制数据，用于不同场合的粘贴。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure></div><div class="ab cl lc ld gp le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hb hc hd he hf"><h1 id="9df4" class="lj lk hi bd ll lm ln lo lp lq lr ls lt io lu ip lv ir lw is lx iu ly iv lz ma bi translated">拷贝、剪切和粘贴事件</h1><p id="a04a" class="pw-post-body-paragraph jo jp hi jq b jr mb ij jt ju mc im jw jx md jz ka kb me kd ke kf mf kh ki kj hb bi translated">当用户将数据放入剪贴板时，会触发<code class="du kt ku kv kw b">copy</code>事件。以下示例将用户放在剪贴板上的文本转换为大写。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="b31f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在上面的例子中，事件对象的<code class="du kt ku kv kw b">clipboardData</code>属性包含剪贴板数据。它是一个具有下列属性和方法的对象。</p><ul class=""><li id="88bd" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated"><code class="du kt ku kv kw b">Event.clipboardData.setData(type, data)</code>:要修改剪贴板数据，需要指定数据类型。</li><li id="20cf" class="kk kl hi jq b jr kx ju ky jx kz kb la kf lb kj kp kq kr ks bi translated"><code class="du kt ku kv kw b">Event.clipboardData.getData(type)</code>:获取剪贴板数据，需要指定数据类型。</li><li id="9d8f" class="kk kl hi jq b jr kx ju ky jx kz kb la kf lb kj kp kq kr ks bi translated"><code class="du kt ku kv kw b">Event.clipboardData.clearData([type])</code>:清除剪贴板数据，可以指定数据类型。如果不指定类型，所有类型的数据都将被清除。</li><li id="a288" class="kk kl hi jq b jr kx ju ky jx kz kb la kf lb kj kp kq kr ks bi translated">类似数组的对象包含所有的剪辑项，但通常只有一个剪辑项</li></ul><p id="9e7d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下面的例子是截取用户的复制操作，将指定的内容放入剪贴板。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="f180" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在上面的例子中，首先使用<code class="du kt ku kv kw b">e.preventDefault()</code>取消剪贴板的默认操作，然后脚本接管复制操作。当用户执行切割操作时，触发<code class="du kt ku kv kw b">cut</code>事件。其处理与<code class="du kt ku kv kw b">copy</code>事件完全相同，剪切数据也是从<code class="du kt ku kv kw b">Event.clipboardData</code>属性中获取的。</p><p id="dabc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">当用户使用剪贴板数据进行粘贴时，会触发<code class="du kt ku kv kw b">paste</code>事件。下面的例子是截取粘贴操作，剪贴板中的数据由脚本取出。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mu mv l"/></div></figure></div><div class="ab cl lc ld gp le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hb hc hd he hf"><h1 id="7e41" class="lj lk hi bd ll lm ln lo lp lq lr ls lt io lu ip lv ir lw is lx iu ly iv lz ma bi translated">结论</h1><p id="ec46" class="pw-post-body-paragraph jo jp hi jq b jr mb ij jt ju mc im jw jx md jz ka kb me kd ke kf mf kh ki kj hb bi translated">对于用户体验，剪贴板访问是一个很好的工具。但是剪贴板访问有它的缺点。有些用户携带恶意数据，有些用户携带敏感数据。确保你负责任地处理其他用户的数据。你需要为那些讨厌的粘贴事件做好准备。</p><p id="014d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">异步剪贴板API是新的，没有浏览器支持所有功能，但它比旧的<code class="du kt ku kv kw b">Document.execCommand()</code>方法更容易使用，也更健壮。</p></div></div>    
</body>
</html>