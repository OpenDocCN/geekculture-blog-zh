<html>
<head>
<title>Monitoring AWS SQS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">监控SQS自动气象站</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/monitoring-aws-sqs-53b34455788d?source=collection_archive---------4-----------------------#2021-05-06">https://medium.com/geekculture/monitoring-aws-sqs-53b34455788d?source=collection_archive---------4-----------------------#2021-05-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/926cead2f895560d53c926acd8a0be98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JuumOzlhOOFA32HMkMBY6A.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Image by author</figcaption></figure><div class=""/><p id="9a39" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">SQS指标的快速复习</p><p id="e14d" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在我们看到指标之前，快速浏览一下<strong class="iw hy"> SQS工作流程</strong></p><ol class=""><li id="bda6" class="js jt hx iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">生成器将消息发送到SQS队列。</li><li id="2369" class="js jt hx iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">如果没有延迟配置，消息在队列中对所有使用者都可用(可见)。如果我们有一个延迟配置，那么消息将以延迟状态留在队列中，并且在延迟到期后对消费者可见。</li><li id="2446" class="js jt hx iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">消费者在SQS的邮件队列中投票。这将从队列中返回可见的消息。这个操作也使得消息对消费者不可见。</li><li id="fc48" class="js jt hx iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">消费者处理完消息后，会将其从队列中显式删除。否则，在可见性超时之后，消息将对消费者可见。</li><li id="9224" class="js jt hx iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">如果配置了DLQ，经过预配置的轮询次数后，消息将在DLQ结束。</li></ol><p id="757a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，让我们来看看与工作流一起生成的指标。</p><h2 id="8a1d" class="kg kh hx bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">发送的消息数</h2><blockquote class="lb lc ld"><p id="f059" class="iu iv le iw b ix iy iz ja jb jc jd je lf jg jh ji lg jk jl jm lh jo jp jq jr hb bi translated">度量测量排队/添加的消息数</p></blockquote><figure class="lj lk ll lm fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es li"><img src="../Images/353f0f30f54ff48b1891da523aa7f77d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*biVjrF8STP8_0YXLjyk3eQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Image by author</figcaption></figure><h2 id="ca9e" class="kg kh hx bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">可见消息的数量</h2><blockquote class="lb lc ld"><p id="8899" class="iu iv le iw b ix iy iz ja jb jc jd je lf jg jh ji lg jk jl jm lh jo jp jq jr hb bi translated">衡量可供使用的消息数量的指标</p></blockquote><figure class="lj lk ll lm fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es li"><img src="../Images/ee343d90851a399cc40915911da5e525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fv_IGbh6g4tMFQsjD_u3fw.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Image by author</figcaption></figure><p id="1670" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这个度量给出了关于队列的积压以及何时扩展消费者的想法。此度量应用于死信队列，以便尽快处理主队列中的任何消息故障。</p><h2 id="0a6e" class="kg kh hx bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">收到的消息数</h2><blockquote class="lb lc ld"><p id="fcae" class="iu iv le iw b ix iy iz ja jb jc jd je lf jg jh ji lg jk jl jm lh jo jp jq jr hb bi translated">度量测量从队列中读取的消息数量</p></blockquote><figure class="lj lk ll lm fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ln"><img src="../Images/7fe24a56e9a4b69529cd0253b7ca2e4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dwe-62aPTyL4quoMUHTm7A.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Image by author</figcaption></figure><h2 id="f8ed" class="kg kh hx bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">不可见的消息数</h2><blockquote class="lb lc ld"><p id="655c" class="iu iv le iw b ix iy iz ja jb jc jd je lf jg jh ji lg jk jl jm lh jo jp jq jr hb bi translated">衡量消费者已收到但尚未处理(删除/失败)的消息数量的指标</p></blockquote><figure class="lj lk ll lm fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lo"><img src="../Images/02c1355b0ff0e035687c371d5267070f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ixoLc0CwR2HdfoDrWTwwLg.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Image by author</figcaption></figure><p id="9cfa" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这也被称为飞行中信息。飞行中的信息限制为120000条。</p><h2 id="d9f7" class="kg kh hx bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">删除的邮件数</h2><blockquote class="lb lc ld"><p id="b1a6" class="iu iv le iw b ix iy iz ja jb jc jd je lf jg jh ji lg jk jl jm lh jo jp jq jr hb bi translated">指标衡量处理的消息数量</p></blockquote><figure class="lj lk ll lm fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es li"><img src="../Images/85d2fd05cdc3607803b36dc60062fc5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K32XC3N9PBxmrZoeSb2TDw.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Image by author</figcaption></figure><p id="b5d8" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">亚马逊SQS为每个成功的删除操作发出<code class="du lp lq lr ls b">NumberOfMessagesDeleted</code>度量，包括重复删除。</p><p id="2fbd" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">理想场景:</p><blockquote class="lb lc ld"><p id="ce3b" class="iu iv le iw b ix iy iz ja jb jc jd je lf jg jh ji lg jk jl jm lh jo jp jq jr hb bi translated">number of messages sent = number of messages received = number of messages deleted</p></blockquote><h2 id="bff6" class="kg kh hx bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">空接收数</h2><blockquote class="lb lc ld"><p id="d6a6" class="iu iv le iw b ix iy iz ja jb jc jd je lf jg jh ji lg jk jl jm lh jo jp jq jr hb bi translated">度量导致无消息的API调用的数量，即队列为空时进行的API调用</p></blockquote><figure class="lj lk ll lm fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lt"><img src="../Images/9e3b276d110ee9959b8790fad28a15d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dygfsNBIqK1tAESfrJwo0A.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Image by author</figcaption></figure><p id="774d" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果这个指标一直很高，你可能有太多渴望的消费者。尽量减少这些呼叫，因为这些是不必要的排队呼叫。调整您的轮询频率或消费者数量，以降低基础设施的成本。长时间投票。</p><p id="cb3b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">希望这有用。</p></div></div>    
</body>
</html>