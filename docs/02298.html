<html>
<head>
<title>Create Youtube Video Downloader with NodeJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用NodeJS创建Youtube视频下载器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/create-youtube-video-downloader-with-nodejs-986a207b943e?source=collection_archive---------2-----------------------#2021-05-10">https://medium.com/geekculture/create-youtube-video-downloader-with-nodejs-986a207b943e?source=collection_archive---------2-----------------------#2021-05-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/12a4da7509db81b8cbba3781d59362a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LJPa1e6SKdq-QUvdT5cGBw.png"/></div></div></figure><h2 id="b6b5" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">本教程我们需要的是</h2><ul class=""><li id="91f5" class="jo jp hi jq b jr js jt ju jb jv jf jw jj jx jy jz ka kb kc bi translated">诺杰斯和NPM</li><li id="80d3" class="jo jp hi jq b jr kd jt ke jb kf jf kg jj kh jy jz ka kb kc bi translated">快速(用于创建Web服务器)</li><li id="9689" class="jo jp hi jq b jr kd jt ke jb kf jf kg jj kh jy jz ka kb kc bi translated">ytdl-core(获取youtube视频信息的npm模块)</li><li id="e23c" class="jo jp hi jq b jr kd jt ke jb kf jf kg jj kh jy jz ka kb kc bi translated">模板引擎</li></ul><h2 id="f58c" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">设置我们的项目</h2><p id="00cd" class="pw-post-body-paragraph ki kj hi jq b jr js kk kl jt ju km kn jb ko kp kq jf kr ks kt jj ku kv kw jy hb bi translated">创建一个名为<code class="du kx ky kz la b">yt_downloader</code>的目录，并用<code class="du kx ky kz la b">npm init</code>初始化该文件夹中的一个节点项目。现在打开Visual Studio代码或该文件夹中的任何其他编辑器。用<code class="du kx ky kz la b">npm install ytdl-core express ejs</code>安装所有需要的模块</p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/6da80aa4dc00dc4f7888edba3b680efd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EvQlGfl7UueHubpT.png"/></div></div></figure><p id="c6b4" class="pw-post-body-paragraph ki kj hi jq b jr lg kk kl jt lh km kn jb li kp kq jf lj ks kt jj lk kv kw jy hb bi translated">现在我们有了项目设置，让我们写一些代码。</p><h2 id="8734" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">设置我们的服务器</h2><p id="f6fd" class="pw-post-body-paragraph ki kj hi jq b jr js kk kl jt ju km kn jb ko kp kq jf kr ks kt jj ku kv kw jy hb bi translated">在该文件夹中创建名为<code class="du kx ky kz la b">index.js</code>的文件并编写代码。</p><pre class="lc ld le lf fd ll la lm ln aw lo bi"><span id="eaac" class="iq ir hi la b fi lp lq l lr ls">const express = require("express");<br/>const app = express();<br/>const ytdl = require("ytdl-core");</span><span id="4afd" class="iq ir hi la b fi lt lq l lr ls">app.set("view engine", "ejs");</span><span id="e8a1" class="iq ir hi la b fi lt lq l lr ls">// OUR ROUTES WILL GO HERE<br/></span><span id="f3e0" class="iq ir hi la b fi lt lq l lr ls">app.listen(3000, () =&gt; {<br/>	console.log("Server is running on http://localhost:3000");<br/>});</span></pre><p id="90a9" class="pw-post-body-paragraph ki kj hi jq b jr lg kk kl jt lh km kn jb li kp kq jf lj ks kt jj lk kv kw jy hb bi translated">你可以在你的终端输入<code class="du kx ky kz la b">nodemon .</code>来运行这个服务器。</p><figure class="lc ld le lf fd ij er es paragraph-image"><div class="er es lu"><img src="../Images/ff65063466461823e538a5c3c57c3427.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/0*U-GQoQuqqKr279bj.png"/></div></figure><h2 id="1f5a" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">用EJS创建简单的图形用户界面</h2><p id="762f" class="pw-post-body-paragraph ki kj hi jq b jr js kk kl jt ju km kn jb ko kp kq jf kr ks kt jj ku kv kw jy hb bi translated">创建一个名为<code class="du kx ky kz la b">views</code>的文件夹，在其中创建一个名为<code class="du kx ky kz la b">index.ejs</code>的文件，并通过编写简单的HTML创建您的GUI。</p><pre class="lc ld le lf fd ll la lm ln aw lo bi"><span id="8757" class="iq ir hi la b fi lp lq l lr ls">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>	&lt;head&gt;<br/>		&lt;meta charset="UTF-8" /&gt;<br/>		&lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;<br/>		&lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;<br/>		&lt;title&gt;Youtube Downloader&lt;/title&gt;<br/>		&lt;link<br/>			rel="stylesheet"<br/>			href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"<br/>			integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"<br/>			crossorigin="anonymous"<br/>		/&gt;<br/>	&lt;/head&gt;<br/>	&lt;body&gt;<br/>		&lt;div class="container my-5"&gt;<br/>			&lt;h1&gt;&lt;strong&gt;Youtube Downloader&lt;/strong&gt;&lt;/h1&gt;<br/>			&lt;form method="GET" action='/download' class="my-5"&gt;<br/>				&lt;div class="form-group"&gt;<br/>					&lt;label for="videoURL"<br/>						&gt;Video Link from Youtube&lt;/label<br/>					&gt;<br/>					&lt;input<br/>						type="text"<br/>						class="form-control"<br/>						placeholder="Enter Video URL"<br/>                        name="url"<br/>					/&gt;<br/>				&lt;/div&gt;<br/>				&lt;button type="submit" class="btn btn-primary"&gt;Download&lt;/button&gt;<br/>			&lt;/form&gt;<br/>		&lt;/div&gt;<br/>	&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="80c7" class="pw-post-body-paragraph ki kj hi jq b jr lg kk kl jt lh km kn jb li kp kq jf lj ks kt jj lk kv kw jy hb bi translated">这里我们的表单将使用参数<code class="du kx ky kz la b">url</code>到<code class="du kx ky kz la b">\download</code>发出GET请求。</p><p id="fe67" class="pw-post-body-paragraph ki kj hi jq b jr lg kk kl jt lh km kn jb li kp kq jf lj ks kt jj lk kv kw jy hb bi translated">我使用了Bootstrap，但是你也可以使用css，只要记住你必须提供静态文件。</p><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/27bec90b1d992ec8d4f46c586d2db3b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MSOeHiwKcJpocHnM.png"/></div></div></figure><p id="52bf" class="pw-post-body-paragraph ki kj hi jq b jr lg kk kl jt lh km kn jb li kp kq jf lj ks kt jj lk kv kw jy hb bi translated">在您的<code class="du kx ky kz la b">index.js</code>中创建一个新的路由<code class="du kx ky kz la b">\</code>来服务这个index.ejs</p><pre class="lc ld le lf fd ll la lm ln aw lo bi"><span id="fc16" class="iq ir hi la b fi lp lq l lr ls">app.get("/", (req, res) =&gt; {<br/>	return res.render("index");<br/>});</span></pre><h2 id="dedb" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">正在创建<code class="du kx ky kz la b">\download</code>路线。</h2><p id="7726" class="pw-post-body-paragraph ki kj hi jq b jr js kk kl jt ju km kn jb ko kp kq jf kr ks kt jj ku kv kw jy hb bi translated">创建一条将参数<code class="du kx ky kz la b">url</code>传递给<code class="du kx ky kz la b">download</code>视图的路线。</p><pre class="lc ld le lf fd ll la lm ln aw lo bi"><span id="e1e2" class="iq ir hi la b fi lp lq l lr ls">app.get('\download' , (req, res) =&gt; {<br/>    const v_id = req.query.url.split('v=')[1];<br/>    return res.render('download', {<br/>        url: "https://www.youtube.com/embed/" + v_id,<br/>    });<br/>});</span></pre><p id="eba6" class="pw-post-body-paragraph ki kj hi jq b jr lg kk kl jt lh km kn jb li kp kq jf lj ks kt jj lk kv kw jy hb bi translated">在上面的代码中，我正在获取视频id，并通过自定义嵌入到url。(Youtube否认它嵌入了不可信的网站)</p><p id="466c" class="pw-post-body-paragraph ki kj hi jq b jr lg kk kl jt lh km kn jb li kp kq jf lj ks kt jj lk kv kw jy hb bi translated">在您的<code class="du kx ky kz la b">views</code>目录中创建新文件<code class="du kx ky kz la b">download.ejs</code>。</p><pre class="lc ld le lf fd ll la lm ln aw lo bi"><span id="164f" class="iq ir hi la b fi lp lq l lr ls">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>	&lt;head&gt;<br/>		&lt;meta charset="UTF-8" /&gt;<br/>		&lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;<br/>		&lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;<br/>		&lt;title&gt;Download Options for the link&lt;/title&gt;<br/>		&lt;link<br/>			rel="stylesheet"<br/>			href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"<br/>			integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"<br/>			crossorigin="anonymous"<br/>		/&gt;<br/>		&lt;link<br/>			rel="stylesheet"<br/>			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"<br/>			integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w=="<br/>			crossorigin="anonymous"<br/>		/&gt;<br/>		&lt;script<br/>			src="https://code.jquery.com/jquery-3.2.1.slim.min.js"<br/>			integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"<br/>			crossorigin="anonymous"<br/>		&gt;&lt;/script&gt;<br/>		&lt;script<br/>			src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"<br/>			integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"<br/>			crossorigin="anonymous"<br/>		&gt;&lt;/script&gt;<br/>		&lt;script<br/>			src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"<br/>			integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"<br/>			crossorigin="anonymous"<br/>		&gt;&lt;/script&gt;<br/>	&lt;/head&gt;<br/>	&lt;body&gt;<br/>		&lt;div class="container"&gt;<br/>			&lt;iframe class="d-flex" width="640" height="480" src="&lt;%= url %&gt;"&gt;<br/>			&lt;/iframe&gt;<br/>		&lt;/div&gt;<br/>		&lt;div class="container"&gt;<br/>			<br/>		&lt;/div&gt;<br/>	&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="74db" class="pw-post-body-paragraph ki kj hi jq b jr lg kk kl jt lh km kn jb li kp kq jf lj ks kt jj lk kv kw jy hb bi translated">现在让我们用路线中的<code class="du kx ky kz la b">ytdl-core</code>模块获取视频信息。因为我们的<code class="du kx ky kz la b">ytdl-core</code>库是异步的，所以我们将创建到异步的路由。我正在按照视频的mime类型(如<code class="du kx ky kz la b">video/webm</code>和<code class="du kx ky kz la b">video/mp4</code>)对我的视频格式进行分类。</p><pre class="lc ld le lf fd ll la lm ln aw lo bi"><span id="3654" class="iq ir hi la b fi lp lq l lr ls">app.get("/download", async (req, res) =&gt; {<br/>	const v_id = req.query.url.split('v=')[1];<br/>    const info = await ytdl.getInfo(req.query.url);</span><span id="2e65" class="iq ir hi la b fi lt lq l lr ls">	return res.render("download", {<br/>		url: "https://www.youtube.com/embed/" + v_id,<br/>        info: info.formats.sort((a, b) =&gt; {<br/>            return a.mimeType &lt; b.mimeType;<br/>        }),<br/>	});<br/>});</span></pre><p id="d739" class="pw-post-body-paragraph ki kj hi jq b jr lg kk kl jt lh km kn jb li kp kq jf lj ks kt jj lk kv kw jy hb bi translated">现在在我们的<code class="du kx ky kz la b">download.ejs</code>文件中显示带有EJS的下载按钮。</p><pre class="lc ld le lf fd ll la lm ln aw lo bi"><span id="2edc" class="iq ir hi la b fi lp lq l lr ls">...<br/>            &lt;/iframe&gt;<br/>        &lt;/div&gt;<br/>        &lt;div class="container"&gt;<br/>			&lt;div class="btn-group"&gt;<br/>				&lt;button<br/>					type="button"<br/>					class="btn btn-success dropdown-toggle"<br/>					data-toggle="dropdown"<br/>					aria-haspopup="true"<br/>					aria-expanded="false"<br/>				&gt;<br/>					Download<br/>				&lt;/button&gt;<br/>				&lt;div class="dropdown-menu"&gt;<br/>					&lt;% info.forEach((format) =&gt; { %&gt;<br/>					&lt;a class="dropdown-item" href="&lt;%= format.url %&gt;"&gt;<br/>						&lt;%= format.mimeType.split(";")[0] %&gt; &lt;%= format.hasVideo<br/>						? format.height + "p" : "" %&gt; &lt;% if(!format.hasAudio) {<br/>						%&gt;<br/>						&lt;i class="fas fa-volume-mute text-danger"&gt;&lt;/i&gt;<br/>						&lt;% } %&gt;<br/>					&lt;/a&gt;<br/>					&lt;% }); %&gt;<br/>				&lt;/div&gt;<br/>			&lt;/div&gt;<br/>		&lt;/div&gt;<br/>	&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><figure class="lc ld le lf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/0fd50ecd48cc8d6990ea18fca8d7dfa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0Gu02cyet8QJUkyV.png"/></div></div></figure><p id="03f4" class="pw-post-body-paragraph ki kj hi jq b jr lg kk kl jt lh km kn jb li kp kq jf lj ks kt jj lk kv kw jy hb bi translated">现在我们的视频下载器完成了，如果你点击下载按钮，你可以选择下载哪个视频。</p><p id="fbfd" class="pw-post-body-paragraph ki kj hi jq b jr lg kk kl jt lh km kn jb li kp kq jf lj ks kt jj lk kv kw jy hb bi translated">你可以从我的Github下载这个项目。</p><p id="eec2" class="pw-post-body-paragraph ki kj hi jq b jr lg kk kl jt lh km kn jb li kp kq jf lj ks kt jj lk kv kw jy hb bi translated"><a class="ae lx" href="https://github.com/Programmer101N/create-youtube-video-downloader" rel="noopener ugc nofollow" target="_blank">在Github上访问这个项目</a></p><p id="3884" class="pw-post-body-paragraph ki kj hi jq b jr lg kk kl jt lh km kn jb li kp kq jf lj ks kt jj lk kv kw jy hb bi translated">也可以看看我的博客，<a class="ae lx" href="https://programmer101n.com" rel="noopener ugc nofollow" target="_blank">这里是链接</a>。</p></div></div>    
</body>
</html>