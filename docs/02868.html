<html>
<head>
<title>Practical Natural Language Processing for Language Learning: Part 2A. Deploying Large Language Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">语言学习的实用自然语言处理:2A部分。部署大型语言模型</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/practical-natural-language-processing-for-language-learning-part-2-b91ae3428448?source=collection_archive---------55-----------------------#2021-05-26">https://medium.com/geekculture/practical-natural-language-processing-for-language-learning-part-2-b91ae3428448?source=collection_archive---------55-----------------------#2021-05-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="6f8d" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在AWS上部署大型命名实体识别(NER)模型，帮助学生识别专有名词(创建EC2实例)</h2></div><h2 id="a424" class="ix iy hi bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">文章摘要和快速警告</h2><p id="46d3" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ji ke kf kg jm kh ki kj jq kk kl km kn hb bi translated">如果你读了我之前的文章，你就会知道为什么我认为NER对语言学习者很重要。简短总结:语言学习者迷失在一篇课文中的一个原因是，他们学习了很多语法和实词(名词/动词)，但他们没有学习专有名词(人名、地名、组织机构、电影片名等)。)在你的本地机器上使用NER的<a class="ae ko" href="https://spacy.io/models" rel="noopener ugc nofollow" target="_blank">空间语言模型</a>很容易，但是我想要一种方式让人们在线访问模型，而不必为自己设置。然而，在互联网上托管Spacy(免费)被证明是很麻烦的，因为这种模式需要超过2GB的内存，而大多数提供托管的网站，如Heroku或Streamlit share，只需500 MB。如果你想看最终产品，它将在AWS <a class="ae ko" href="http://44.241.102.79/" rel="noopener ugc nofollow" target="_blank">这里</a>展出。以下是我们将涵盖的内容列表:</p><ol class=""><li id="7158" class="kp kq hi jx b jy kr kb ks ji kt jm ku jq kv kn kw kx ky kz bi translated">设置AWS帐户</li><li id="57be" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn kw kx ky kz bi translated">创建EC2实例</li><li id="972e" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn kw kx ky kz bi translated">连接到您的实例并准备一个Ubuntu服务器</li><li id="0bc3" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn kw kx ky kz bi translated">进行内存交换以增加可用内存</li><li id="f8bb" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn kw kx ky kz bi translated">将EC2实例与一个固定的IP地址相关联</li><li id="edb4" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn kw kx ky kz bi translated">设置账单提醒，这样您就不会收到意外的惊喜:)</li><li id="7458" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn kw kx ky kz bi translated">文章第2部分(即将发布):创建一个虚拟环境，创建一个Flask应用程序，并使用wsgi和nginx设置一个生产级服务器</li></ol><h2 id="de1f" class="ix iy hi bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">首先是一些背景信息</h2><p id="79af" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ji ke kf kg jm kh ki kj jq kk kl km kn hb bi translated">这篇文章的重点是免费在线获得一个超过2 GB的语言模型，而不用做任何疯狂的模型修补。我假设观众对web开发只有中等程度的了解(像我一样)。我是一名向计算机工作转型的语言学家，所以我对非技术人员在web开发中可能遇到的困难有第一手的了解。托管生产级API是一个漫长的过程，我将详细讨论我遇到的一些棘手问题，同时还会为您提供一些指南以获取更多信息。如果您熟悉在AWS上设置EC2，您可能想跳过本文的某些部分，或者直接进入本主题的第2部分(使用wsgi和nginx设置生产级服务器)。另一方面，如果你想知道更多细节，请在评论中或github/LinkedIn上联系我。</p><h2 id="f4f6" class="ix iy hi bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">如果这很痛苦，我为什么要部署全尺寸模型呢？</h2><p id="09c6" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ji ke kf kg jm kh ki kj jq kk kl km kn hb bi translated">在Heroku和Streamlit Sharing等免费服务上部署一个小模型相对容易，但这些服务通常会将你限制在500 MB。我使用的型号每个都超过400 MB，它们还要求您安装pytorch或tensorflow，因此我们至少需要2 GB的RAM才能运行。有一个强有力的论点是，训练一个较小的模型或使用基于规则的方法比部署一个巨大的模型更有效。尽管如此，NLP目前的趋势是使用建立在transformer架构上的大型预训练语言模型，如BERT、RoBERTa、XLNet、GPT-2等。此外，自从transformer架构问世以来，已经取得了快速的进步，如果在不久的将来，基于transformer的模型的精度和效率没有显著提高，我会感到很惊讶。这些模型很容易使用，可以在Spacy和Hugging Face等网站上公开获得，你可以在开箱后立即获得出色的性能。我想，一旦我知道如何部署和运行一个更大的模型，我就可以用这个模型在NER之外做许多其他的工作。另外，瞎折腾AWS也挺好玩的:)</p><h2 id="4082" class="ix iy hi bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">什么是AWS，什么是Amazon EC2实例？</h2><p id="9b23" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ji ke kf kg jm kh ki kj jq kk kl km kn hb bi translated">亚马逊网络服务是亚马逊提供给开发者的一套应用。重要的是，他们有一个免费层，这样你就可以免费做小规模的工作，但同时，如果你对一个项目很认真，亚马逊会按你的需求扩大规模——但要付费。EC2代表弹性计算云，是这些免费服务之一。EC2实例是一个虚拟服务器；也就是一个web服务，在云端给你提供一台电脑。基本上，亚马逊有一大堆实际的机器24/7运行，他们会根据你的需求卖给你一些计算能力。您可以根据需要使用，并且只为您使用的东西付费，而不是购买自己的机器。最重要的是，我们可能期望的业余爱好项目的有限流量落在他们的免费等级的限制之内。所以，让我们开始吧。</p><h2 id="31ce" class="ix iy hi bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">(1)建立一个亚马逊AWS账户</h2><p id="e741" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ji ke kf kg jm kh ki kj jq kk kl km kn hb bi translated">去aws.amazon.com，点击创建账户。基本上只需按照屏幕上的提示创建一个免费帐户。你需要提供一张信用卡，如果你不遵守规则，你可能需要支付一些费用。但是亚马逊有一个很好的系统来防止令人讨厌的意外……如果你注意的话。记下你在哪个地区开设了账户，这很重要！如果您失去了EC2实例的踪迹，请确保您位于Amazon dashboard上的正确区域。例如，如果你看下面，我的EC2在USWest2 -Oregon，但是如果我换到另一个地区(例如US east (N. Virginia)us-east-1)。我看不到我的实例。</p><figure class="lg lh li lj fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lf"><img src="../Images/6acbf7882f69dfb9d813fe36be894a38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zuNMwlUr9qoealp3qZDEEg.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">This is what your AWS dashboard should look like</figcaption></figure><h2 id="58e7" class="ix iy hi bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">(2)创建一个EC2实例(30 GB内存)</h2><p id="2571" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ji ke kf kg jm kh ki kj jq kk kl km kn hb bi translated">创建帐户并登录后，转到“服务”(见上文)并选择EC2，您将看到一个橙色的“启动实例”按钮。启动实例的过程有6个步骤。以下是每一步要做的事情:</p><ul class=""><li id="49f2" class="kp kq hi jx b jy kr kb ks ji kt jm ku jq kv kn lv kx ky kz bi translated">第一步:选择亚马逊机器映像(AMI):我们将使用Ubuntu Server 20.04 LTS (HVM)</li><li id="c109" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn lv kx ky kz bi translated">步骤2选择实例类型:选择t2.micro(符合自由层条件)</li><li id="1011" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn lv kx ky kz bi translated">步骤3配置实例细节:使用默认值即可</li><li id="a164" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn lv kx ky kz bi translated">添加存储空间:最大30GB，即使你不会用光它。</li><li id="664d" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn lv kx ky kz bi translated">添加标签:留空即可</li><li id="c650" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn lv kx ky kz bi translated">步骤6:安全组:如果你想让其他人访问你的api，你可以在这里给他们访问权限。按下“添加规则”按钮，添加一个规则，将“类型”更改为“所有流量”，将“来源”更改为“任何地方”。亚马逊会警告你这是有风险的…不要把任何有价值的东西放在服务器上。</li></ul><p id="1dd9" class="pw-post-body-paragraph jv jw hi jx b jy kr ij ka kb ks im kd ji lw kf kg jm lx ki kj jq ly kl km kn hb bi translated">新闻评论和发布。Amazon会提示你做一个PEM文件以保证安全。确保将PEM文件保存在一个您以后可以找到的地方。启动将需要几分钟时间，但是当您返回到实例仪表板时，您应该会发现一个实例正在运行。您可以在等待时点击“获得估计费用通知”下的链接来创建一个账单提醒，因为…..</p><p id="7ceb" class="pw-post-body-paragraph jv jw hi jx b jy kr ij ka kb ks im kd ji lw kf kg jm lx ki kj jq ly kl km kn hb bi translated">提醒一句，亚马逊称免费层“包括每月750小时的Linux、RHEL或SLES t2.micro或t3.micro实例，具体视地区而定。”此外，如果您启动然后停止一个实例，它将计为1小时。一个月有672到744个小时，所以如果你启动一个实例并且不频繁地启动和停止它，你将停留在自由层。但是，如果您启动2个或更多实例并让它们运行，或者如果您频繁地启动/停止您的实例，您将超过限制。</p><h2 id="3217" class="ix iy hi bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">(3)连接到您的实例</h2><p id="7521" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ji ke kf kg jm kh ki kj jq kk kl km kn hb bi translated">您将通过一个虚拟机(我们在上面的步骤2中创建的Ubuntu服务器)来控制您的实例。请记住，一切实际上都发生在世界上某个地方的亚马逊真实电脑上。您将在这个虚拟的ubuntu机器上“云中”部署您的模型，所以您需要从您的机器连接到它。按查看实例，您应该会看到:</p><figure class="lg lh li lj fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lz"><img src="../Images/2b56ad0f54e1bb7d7af4e7258bf877b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_-rpBfMOYGnA4GSCFy0NyA.png"/></div></div></figure><p id="6d75" class="pw-post-body-paragraph jv jw hi jx b jy kr ij ka kb ks im kd ji lw kf kg jm lx ki kj jq ly kl km kn hb bi translated">选中您的实例旁边的复选框(这里是“ner”)，connect按钮将会亮起。按连接，你会看到以下选项。选择“SSH客户端”并按照屏幕上的说明进行操作。请注意，SSH代表安全外壳协议，它用于在不安全的网络上提供安全性。我们用它在Ubuntu服务器上远程登录和执行命令。另外，请记住SSH默认使用端口22。</p><figure class="lg lh li lj fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es ma"><img src="../Images/8d7b704c668806a4cc7e9c044df01809.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l3HMFi3c1Fx79EYQLd3PeA.png"/></div></div></figure><p id="6875" class="pw-post-body-paragraph jv jw hi jx b jy kr ij ka kb ks im kd ji lw kf kg jm lx ki kj jq ly kl km kn hb bi translated">打开您的终端/bash，导航到您计算机上存储您的的位置。pem文件。您可以复制3和4中的命令(示例)。“chmod 400 file_name.pem”防止其他任何人看到/使用您的安全证书。" ssh-I " file _ name . PEM "<strong class="jx hj">ubuntu @ ec2–54–244–107–106 . us-west-2 . compute . Amazon AWS . com "</strong>在您的电脑和虚拟Ubuntu之间建立实际连接。<strong class="jx hj">命令中加粗的部分是您的公共DNS，稍后您会用到它</strong>。您也可以在EC2仪表板上看到它。请注意，amazon将尝试获得正确的文件名(对我来说是“new_ner.pem”)，但是如果您的pem文件名由于某种原因不同，您将需要更改它。您可以在文件名两边保留“.”。您现在应该在终端/bash的命令提示符下看到<strong class="jx hj">Ubuntu @ IP-XXX–XX–X–XX</strong>:<strong class="jx hj">~</strong>$了。</p><h2 id="4f0e" class="ix iy hi bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">(4)进行内存交换以增加可用RAM</h2><p id="d78b" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ji ke kf kg jm kh ki kj jq kk kl km kn hb bi translated">接下来，您需要进行内存交换。EC2实例提供了1 GB的RAM，但是对于更大的型号，我们需要更多。我们将把30 GB的一部分换成RAM。换下来的内存会慢一些，但价格没问题。让我们使用以下命令添加4 GB的RAM。请注意，您可能需要对所有命令使用sudo来建立您的管理访问权限。首先为您的新RAM创建一个交换文件。</p><ul class=""><li id="906d" class="kp kq hi jx b jy kr kb ks ji kt jm ku jq kv kn lv kx ky kz bi translated">sudo fallocate -l 4G /swapfile</li><li id="9120" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn lv kx ky kz bi translated">sudo chmod 600 /swapfile</li><li id="476f" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn lv kx ky kz bi translated">sudo mkswap /swapfile</li><li id="20e8" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn lv kx ky kz bi translated">sudo swapon /swapfile</li></ul><p id="7224" class="pw-post-body-paragraph jv jw hi jx b jy kr ij ka kb ks im kd ji lw kf kg jm lx ki kj jq ly kl km kn hb bi translated">您还需要保存您的交换文件，以便它在机器启动时初始化。您可以这样做:</p><ul class=""><li id="1737" class="kp kq hi jx b jy kr kb ks ji kt jm ku jq kv kn lv kx ky kz bi translated">sudo cp /etc/fstab /etc/fstab.bak</li><li id="4fb9" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn lv kx ky kz bi translated">echo '/swap file none swap SW 0 0 ' | sudo tee-a/etc/fstab</li><li id="6973" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn lv kx ky kz bi translated">要查看您的内存情况，请键入“free -h”或“df -h”</li></ul><h2 id="b61c" class="ix iy hi bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">(5)将您的文件传输到虚拟机:</h2><p id="e51f" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ji ke kf kg jm kh ki kj jq kk kl km kn hb bi translated">你需要一种简单的方法在你的机器和虚拟ubuntu机器之间传输文件。您可以使用文件传输协议(FTP)客户端。我用的是麦金塔电脑，所以我选择了赛博鸭；Windows用户可能想尝试WinSCP或只是谷歌“免费FTP客户端”和货比三家。<strong class="jx hj">请记住，如果您的防火墙被激活，您需要使用命令“sudo ufw allow SSH”</strong>通过端口22允许SSH。顺便说一下，ufw代表简单防火墙；更多详情<a class="ae ko" href="https://phoenixnap.com/kb/ssh-connection-refused" rel="noopener ugc nofollow" target="_blank">此处</a>。要连接赛博鸭，选择菜单栏上的“打开连接”，将会打开一个窗口</p><figure class="lg lh li lj fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mb"><img src="../Images/de9a95a9fc4710ded115aca8d0a9cbc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0DlWgut8gMCIPnIXyyChJg.png"/></div></div></figure><ul class=""><li id="efaf" class="kp kq hi jx b jy kr kb ks ji kt jm ku jq kv kn lv kx ky kz bi translated">在下拉菜单中选择SFTP (SSH文件传输协议)</li><li id="e560" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn lv kx ky kz bi translated">服务器是您的公共DNS(记得回到“连接到您的实例”)</li><li id="2426" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn lv kx ky kz bi translated">默认用户名= ubuntu</li><li id="46ab" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn lv kx ky kz bi translated">将密码留空</li><li id="518e" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn lv kx ky kz bi translated">单击SH private key旁边的箭头，导航到您的PEM文件(参见步骤2)并选择它</li><li id="7f96" class="kp kq hi jx b jy la kb lb ji lc jm ld jq le kn lv kx ky kz bi translated">按连接</li></ul><h2 id="131c" class="ix iy hi bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">(6)将您的实例与固定的IP地址相关联。</h2><p id="f6b5" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ji ke kf kg jm kh ki kj jq kk kl km kn hb bi translated">我将在本文的第2部分讨论如何部署Flask应用程序。但是，如果你已经让你的API工作，你会希望能够分享它。每次重新启动实例时，EC2 IP地址都会改变，这可能很烦人。亚马逊为你的EC2提供了一个免费的“弹性IP ”,它将保持相同的IP地址。请注意，您不必为弹性IP <strong class="jx hj">付费，只要它与您的实例相关联。</strong>也就是说，如果您启动您的实例，将它关联到弹性IP，然后让一切运行，这一切都是免费的。但是，如果您停止实例或取消弹性IP与实例的关联，您将需要付费。当您解除弹性IP的关联时，您还必须将其归还给亚马逊池，以避免支付。要获取弹性IP，请返回AWS EC2控制台，从左侧菜单的“网络&amp;安全”中选择弹性IP。您将看到下面的屏幕，这是一个两步过程:</p><p id="992e" class="pw-post-body-paragraph jv jw hi jx b jy kr ij ka kb ks im kd ji lw kf kg jm lx ki kj jq ly kl km kn hb bi translated">首先，您分配弹性IP地址，然后操作下拉列表将可用(或只需转到白色大关联此弹性IP地址按钮)。</p><figure class="lg lh li lj fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mc"><img src="../Images/f7e43d91fded124fd19e283a5b0ec60b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ejKt6rfMvYDZ3GRfVAZvbg.png"/></div></div></figure><p id="6e8c" class="pw-post-body-paragraph jv jw hi jx b jy kr ij ka kb ks im kd ji lw kf kg jm lx ki kj jq ly kl km kn hb bi translated">当您关联地址时，您必须选择将它关联到哪个实例(假设您只有一个实例:)。此外，在您将实例关联到新的IP地址之后，您必须再次连接到ubuntu终端(上面的步骤3)。请记住，如果您取消弹性IP与EC2的关联，您还必须<a class="ae ko" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html#using-instance-addressing-eips-associating-different" rel="noopener ugc nofollow" target="_blank">释放</a>它以避免被收费。</p><p id="368b" class="pw-post-body-paragraph jv jw hi jx b jy kr ij ka kb ks im kd ji lw kf kg jm lx ki kj jq ly kl km kn hb bi translated">最后，一定要设置一个<a class="ae ko" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/monitor_estimated_charges_with_cloudwatch.html" rel="noopener ugc nofollow" target="_blank">提醒</a>，如果你将要超过免费等级的限制，它会提醒你。</p><p id="96c4" class="pw-post-body-paragraph jv jw hi jx b jy kr ij ka kb ks im kd ji lw kf kg jm lx ki kj jq ly kl km kn hb bi translated">好吧，我试图在太长的路和不够的信息之间找到一个平衡，我不知道我是否击中了它！尽管如此，您现在有了一个工作的EC2实例，即使它还没有做任何事情。您将希望在您的实例上部署一些东西。如果您想听我讲述将语言模型部署为Flask应用程序的具体细节，请阅读我的帖子，它即将发布。</p><p id="f4ff" class="pw-post-body-paragraph jv jw hi jx b jy kr ij ka kb ks im kd ji lw kf kg jm lx ki kj jq ly kl km kn hb bi translated">一如既往，如果您有任何问题或意见，请告诉我。</p></div></div>    
</body>
</html>