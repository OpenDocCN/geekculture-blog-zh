<html>
<head>
<title>How to move my application to Containers (Docker)?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将我的应用程序移动到容器(Docker)？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-move-your-application-to-containers-docker-2337416dbe8c?source=collection_archive---------19-----------------------#2021-08-25">https://medium.com/geekculture/how-to-move-your-application-to-containers-docker-2337416dbe8c?source=collection_archive---------19-----------------------#2021-08-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/355be2d69be3ef624645823bcf954ecc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BSHpRrVx9DPQ45El"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@hdbernd?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Bernd Dittrich</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="35d2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇博客中，您将了解如何构建容器映像，将应用程序迁移到docker，以及部署容器和使用Github操作的各种方法。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="52f5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您不熟悉容器<a class="ae iu" href="https://sainadh086.medium.com/containers-a-way-for-building-and-deploying-applications-9061e9fc3e2d" rel="noopener">，请点击此处</a></p><p id="10a9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">T3】简介T5】</strong></p><p id="de34" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">大多数人认为集装箱和码头是一样的。是的，他们只是在某种程度上是对的，当你深入这个世界，你会探索很多。</p><p id="e298" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Docker只是一个容器运行时引擎，作为一个客户端-服务器应用程序。Docker使用runC对容器进行操作。</p><p id="b025" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">runC是一个轻量级、可移植的容器运行时。它包括所有与Linux操作系统交互的底层代码。</p><p id="f6e0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Docker使用这种技术来创建容器并相应地操作它们。随着docker变得如此受欢迎，我们在整个博客中使用相同的工具。</p><p id="13af" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">选择正确的容器</strong></p><p id="5949" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当您想要将应用程序移动到容器中时，您应该选择可以运行用于构建应用程序的编程语言的容器。</p><p id="e8ba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">docker hub中有许多容器，这是一个容器库，您可以在其中存储容器映像。有许多官方容器可用。还要选择语言版本。</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="e808" class="kk kl hi kg b fi km kn l ko kp"># pull the container image from the docker hub<br/>$ docker pull &lt;container_name&gt;:&lt;tag&gt;</span></pre><p id="3ff0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">构建自定义容器映像</strong></p><p id="5157" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为此，我们必须编写一个docker文件。许多容器运行时引擎都支持这个文件。</p><p id="8b73" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个文件中，我们必须编写一些基本的命令。</p><p id="b36f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">FROM:我们必须提到我们是在哪个基础容器上构建的。</p><p id="a69c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行:运行容器内部的命令。</p><p id="8eb1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ENV:用于编写应用程序所需的环境变量</p><p id="217e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">复制:将文件从本地系统复制到容器中。</p><p id="041e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ADD:类似于copy，用来复制压缩文件，直接解压到容器中。</p><p id="8af4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">WORKDIR:将任意目录设置为容器的根目录。</p><p id="cf79" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">EXPOSE:通过隧道将内部端口连接到主机非常有用。用于通过应用程序的端口号向真实世界公开应用程序。</p><p id="d782" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ENTRYPOINT:当您启动它时，它运行容器中的命令。</p><p id="b114" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">CMD:它类似于ENTRYPOINT，CMD可以在我们创建容器时更改，而ENTRYPOINT不能更改。</p><p id="166d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意Dockerfile的文件名必须是Dockerfile。</p><p id="9ee4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，我用一个名为url short ner的小应用程序构建了一个docker图像，它将长URL转换为短URL。</p><p id="b097" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用的编程语言是python。</p><p id="9262" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">提取应用程序</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="e7bd" class="kk kl hi kg b fi km kn l ko kp">docker pull python:latest</span></pre><p id="f544" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Dockerfile文件</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="5bcc" class="kk kl hi kg b fi km kn l ko kp"># building the Dockerfile<br/>FROM python:latest</span><span id="96ea" class="kk kl hi kg b fi kq kn l ko kp"># creating a directory for the application<br/>RUN mkdir URL_SHORTNER </span><span id="c792" class="kk kl hi kg b fi kq kn l ko kp"># my dockerfile is in the same workspace as my application</span><span id="2730" class="kk kl hi kg b fi kq kn l ko kp"># copying the files from local system to container<br/>COPY . URL_SHORTNER/</span><span id="274d" class="kk kl hi kg b fi kq kn l ko kp">#setting my working directory <br/>WORKDIR URL_SHORTNER</span><span id="ea33" class="kk kl hi kg b fi kq kn l ko kp">#installing the required packages<br/>RUN pip3 install requirements.txt</span><span id="4224" class="kk kl hi kg b fi kq kn l ko kp">#Exposing the application <br/>EXPOSE 8080</span><span id="fa07" class="kk kl hi kg b fi kq kn l ko kp"># final command which run after container starts</span><span id="d7d4" class="kk kl hi kg b fi kq kn l ko kp">#here we write the command arguments in string format inside the list<br/>CMD ["python3", "app.py"]</span></pre><p id="c316" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">构建映像的命令</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="54af" class="kk kl hi kg b fi km kn l ko kp"># inside the application workspace<br/>$ docker build -t myapp:v1 .</span></pre><p id="1065" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您在创建容器后遇到任何问题，请检查您的容器日志。</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="71ca" class="kk kl hi kg b fi km kn l ko kp">$ docker logs &lt;container_name&gt;</span></pre><p id="fe2b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在将图像推送到容器存储库。</p><p id="5314" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">市场上有很多集装箱仓库，很少是Docker hub、Quay、AWS集装箱仓库等。</p><p id="06b3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里我使用的是docker hub</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="49df" class="kk kl hi kg b fi km kn l ko kp"># login to the docker hub using docker command</span><span id="759d" class="kk kl hi kg b fi kq kn l ko kp">$ docker login</span></pre><p id="e4ad" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输入上述命令的凭据。</p><p id="51ff" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要将图像推送到docker hub或任何其他容器repo，它应该是特定的格式。</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="4fa7" class="kk kl hi kg b fi km kn l ko kp">&lt;container_repo_url&gt;/&lt;username&gt;/&lt;your_container_name&gt;:&lt;tag&gt;</span></pre><p id="5563" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里，container_repo_url对于docker hub是可选的。</p><p id="5771" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Docker hub: docker.io</p><p id="a7d9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Quay: quay.io</p><p id="483c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在AWS中，它将在您创建存储库时显示。</p><p id="f743" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将映像推送到存储库的命令。</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="d5a4" class="kk kl hi kg b fi km kn l ko kp">#attaching tag</span><span id="85a2" class="kk kl hi kg b fi kq kn l ko kp">$ docker tag sainadh086/url-shortner:v1 myapp:v1</span><span id="fa68" class="kk kl hi kg b fi kq kn l ko kp">#push the image to repo<br/>$ docker push sainadh086/url-shortner:v1</span></pre><p id="51ee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">通过Github动作引入自动化。</strong></p><p id="eba4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在向我们的代码中添加新特性之后，一次又一次地创建docker映像需要很长时间。</p><p id="8934" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因为我们大多数人都在使用git这样的版本控制工具，并将代码存储在Github中。因此，将您的Github存储库与Github操作集成在一起。</p><p id="d4e1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在那里它自动构建容器并推送到存储库。</p><p id="6c57" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Github还提供了一些预构建工作流来集成不同的应用程序。</p><p id="b833" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正在写入Github操作文件。</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="4578" class="kk kl hi kg b fi km kn l ko kp">name: CI #naming the pipeline</span><span id="bd5e" class="kk kl hi kg b fi kq kn l ko kp">on: <strong class="kg hj"># select the branch and request type</strong><br/>  push: <strong class="kg hj"># selecting push command as the request</strong><br/>     branches: [ master ]  # branch<br/>  pull_request:<br/>     branches: [ master ]</span><span id="7594" class="kk kl hi kg b fi kq kn l ko kp">jobs: <strong class="kg hj">#multiple stages to run</strong><br/>   build: <strong class="kg hj"># it is one the stage named build</strong></span><span id="0671" class="kk kl hi kg b fi kq kn l ko kp"><strong class="kg hj">#selecting the os the instance to run our configuration file</strong><br/><strong class="kg hj">      </strong>runs-on: ubuntu-latest     <br/>      <br/>      <strong class="kg hj"># Multiple commands or tasks to run</strong> <br/>      steps:</span><span id="6a27" class="kk kl hi kg b fi kq kn l ko kp">       - uses: actions/checkout@v2 </span><span id="84f9" class="kk kl hi kg b fi kq kn l ko kp">       - name: build a docker image <br/>         run: docker build -t infra:v1 .</span><span id="9b6c" class="kk kl hi kg b fi kq kn l ko kp">       - name: pushing the image to docker hub<br/>         <strong class="kg hj">#here we require login credentials and we cannot show to everyone.<br/>         # We use secrets feature provided by github.<br/>         # here we read our secrets and pass them to the commands</strong></span><span id="d0c8" class="kk kl hi kg b fi kq kn l ko kp">shell: bash <strong class="kg hj">#using bash terminal</strong><br/>         env: <strong class="kg hj">#passing the secrets to environmental variables</strong><br/>           user_name: ${{ secrets.DOCKER_USER_NAME }}<br/>           user_password: ${{ secrets.DOCKER_USER_PASSWORD }}you, guys</span><span id="7df5" class="kk kl hi kg b fi kq kn l ko kp"><br/>        run: | <strong class="kg hj">#we use this symbol for writing multiple commands</strong><br/>          docker login -u $user_name -p $user_password<br/>          docker tag infra:v1 sainadh086/url-shortner:latest<br/>          docker push sainadh086/url-shortner:latest<br/>          echo "Success"</span></pre><p id="6805" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您成功地构建了一个应用程序，然后将应用程序容器化，并将其移动到容器存储库中。现在，它已准备好进行部署。</p><p id="73a5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">选择您选择的云计算平台并部署应用程序。</p><p id="f097" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在下一篇博客中，您将了解如何使用terraform将容器应用程序部署到AWS云中。</p><p id="a85c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">结论</strong></p><p id="a8a4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您已经学习了一些关于容器的知识，将您的应用程序移动到容器中，将您的容器映像移动到docker hub，以及将Github操作与Github集成。</p><p id="ad4d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如有疑问，请在下方评论。让我知道你想阅读什么类型的内容，或者你在使用devops工具时遇到了什么问题。</p><p id="c651" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">谢谢大家有美好的一天。</p><div class="kr ks ez fb kt ku"><a href="https://github.com/Sainadh086/URL-Shortener" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">GitHub-sainadh 086/URL-Shortener:这个项目用于缩短URL。</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">github.com</p></div></div><div class="ld l"><div class="le l lf lg lh ld li io ku"/></div></div></a></div></div></div>    
</body>
</html>