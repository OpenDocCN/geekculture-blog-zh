<html>
<head>
<title>Building an Interactive Map with Mapbox &amp; React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Mapbox &amp; React构建交互式地图</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/building-an-interactive-map-with-mapbox-react-f335384f4863?source=collection_archive---------0-----------------------#2021-04-08">https://medium.com/geekculture/building-an-interactive-map-with-mapbox-react-f335384f4863?source=collection_archive---------0-----------------------#2021-04-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4e36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Mapbox API是一个非常棒的工具，可以用来构建定制的交互式地图。然而，将Mapbox集成到一个更大的应用程序中一开始可能会感到棘手——就我个人而言，我发现自己花了一些时间搜索文档之外的资源，以便将关键特性集成到我的React应用程序中。如果你能感同身受，希望这篇文章将是你读过的最后一篇！在这里，我将分解使用两个库react-map-gl和react-map-gl-geocoder构建交互式地图的步骤。具体来说，我将介绍如何:1)渲染地图，2)合并地理编码器，3)创建标记，4)添加弹出窗口。</p><h2 id="f9db" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">1.创建React应用程序并安装依赖项</h2><p id="53cb" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">首先，让我们使用<a class="ae kd" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank">创建React app </a>并安装<a class="ae kd" href="https://visgl.github.io/react-map-gl/" rel="noopener ugc nofollow" target="_blank"> react-map-gl </a>和<a class="ae kd" href="https://www.npmjs.com/package/react-map-gl-geocoder" rel="noopener ugc nofollow" target="_blank"> react-map-gl-geocoder </a>来建立一个项目。将以下内容粘贴到您的终端中:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="b81c" class="jd je hi kj b fi kn ko l kp kq">npx create-react-app mapbox-project<br/>cd mapbox-project<br/>npm i react-map-gl react-map-gl-geocoder<br/>npm start</span></pre><h2 id="acd2" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">2.获取地图框API令牌</h2><p id="8f52" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">接下来，我们必须为<a class="ae kd" href="https://www.mapbox.com/" rel="noopener ugc nofollow" target="_blank">地图框</a>创建一个账户。如果您没有使用令牌自动重定向到您的控制面板，请单击蓝色的“创建令牌”按钮创建一个。</p><figure class="ke kf kg kh fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es kr"><img src="../Images/a8d9f38f403d165e48135d089c9dd6cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CHL9AlITz-tKWDqnXKCPug.png"/></div></div></figure><h2 id="cc52" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">3.创建地图</h2><p id="a275" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">现在我们有了API令牌，让我们开始编码吧！接下来，我将使用类组件。(如果您更喜欢使用无状态组件，请查阅<a class="ae kd" href="https://visgl.github.io/react-map-gl/docs" rel="noopener ugc nofollow" target="_blank">文档</a>。)为了构建地图，我们将利用react-map-gl提供的<em class="kz"> ReactMapGl </em>组件。它接受大量的道具，包括API令牌、<em class="kz"> viewport </em>、<em class="kz"> mapStyle </em>和<em class="kz"> onViewportChange </em>。</p><ul class=""><li id="86f6" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lf lg lh li bi translated"><em class="kz">视口</em>:地图的尺寸、中心点和缩放常数。</li><li id="e409" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">地图风格:地图盒子上有各种各样的风格(有不同的配色方案、街景、标签等组合。)，甚至在这里创造自己的<a class="ae kd" href="https://studio.mapbox.com/" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="e9b1" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated"><em class="kz"> onViewportChange </em>:控制视口过渡(即当用户拖动地图时更新视口)的函数。</li></ul><figure class="ke kf kg kh fd ks"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="62fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保存后，您应该能够在本地主机上看到地图渲染！</p><figure class="ke kf kg kh fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es lq"><img src="../Images/1a3a11fdcc81f7e8a75e671cf750d24c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7nnsUCN3p7ixowMkn4oNVg.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">Rendered map</figcaption></figure><h2 id="516a" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">4.添加地理编码器</h2><p id="de16" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">接下来，让我们使用react-map-gl-geocoder在地图上添加一个地理编码器。该库方便地为我们提供了<em class="kz">地理编码器</em>组件，它接受几个道具，包括一个API令牌、<em class="kz"> mapRef </em>、<em class="kz"> onResult </em>和<em class="kz"> onViewportChange </em>、<em class="kz"> position </em>和<em class="kz"> countries </em>。导入样式并在<em class="kz"> ReactMapGl </em>中添加<em class="kz">地理编码器</em>组件。</p><p id="20a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下描述来自<a class="ae kd" href="https://www.npmjs.com/package/react-map-gl-geocoder" rel="noopener ugc nofollow" target="_blank">文件</a>:</p><ul class=""><li id="6795" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lf lg lh li bi translated"><em class="kz">mapRef</em>:react-map-GL映射组件的Ref。</li></ul><p id="6e96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要添加这个属性，请定义一个变量(如下例所示)。然后，在<em class="kz"> ReactMapGl </em>组件上添加一个ref键。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="ee51" class="jd je hi kj b fi kn ko l kp kq">mapRef = React.createRef()</span></pre><ul class=""><li id="0db1" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lf lg lh li bi translated"><em class="kz"> onViewportChange </em>:在执行查询后，被传递更新的视区值</li><li id="f4fd" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated"><em class="kz">位置</em>:地图上地理编码器控件将被添加到的位置。有效值为<code class="du lv lw lx kj b">"top-left"</code>、<code class="du lv lw lx kj b">"top-right"</code>、<code class="du lv lw lx kj b">"bottom-left"</code>和<code class="du lv lw lx kj b">"bottom-right"</code>。</li><li id="1a35" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated"><em class="kz">国家</em>:逗号分隔的国家代码列表，将结果限制在指定的一个或多个国家。</li></ul><p id="97e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查看附加定制道具的文档！</p><figure class="ke kf kg kh fd ks"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="1a44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在将道具传递给<em class="kz">地理编码器</em>组件并保存文件后，您应该能够在地图上看到一个搜索栏。您可以键入一个位置，并在选择后将地图重新置于该位置的坐标中心！</p><figure class="ke kf kg kh fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ly"><img src="../Images/1e515b748f675b5556dce8f412e7bd6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eGwMwzPlod5B3Wo2WZddhw.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">Geocoder search bar</figcaption></figure><h2 id="26b9" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">4.在地图上创建和渲染标记</h2><p id="5481" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">现在让我们来看看标记。从react-map-gl导入<em class="kz">标记</em>组件。<em class="kz">标记</em>唯一需要的道具是纬度和经度。要添加标记，只需在父组件中插入纬度为<em class="kz">经度为</em>和<em class="kz">经度为</em>的组件，如下所示:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="34e5" class="jd je hi kj b fi kn ko l kp kq">import ReactMapGl, {Marker} from 'react-map-gl'<br/>...<br/>&lt;ReactMapGl<br/>...<br/>/&gt;<br/>&lt;Marker<br/>latitude={<em class="kz">insert latitude</em>}<br/>longitude={<em class="kz">insert longitude</em>}<br/>&gt;<br/>  <em class="kz">[insert image or custom marker]</em><br/>&lt;/Marker&gt;</span><span id="87ec" class="jd je hi kj b fi lz ko l kp kq">&lt;/ReactMapGl&gt;<br/>...</span></pre><p id="60ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用硬编码值渲染一个标记很酷，但是我们想做一个<strong class="ih hj"> <em class="kz">交互式</em> </strong>地图。通过在我们的本地州存储位置信息，我们将能够在搜索和选择地址时创建标记。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="eee5" class="jd je hi kj b fi kn ko l kp kq">this.state = {<br/>  ...<br/>  currMarker: null,<br/>  markers: []<br/>}</span></pre><p id="e0d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">地理编码器组件接受一个<em class="kz"> onResult </em> prop，其中我们可以传入一个在选择地理编码器输入时要执行的函数。我们将创建一个<em class="kz"> handleResult </em>函数来更新<em class="kz"> currentMarker </em>的值，并将其传递给<em class="kz"> onResult </em>(记得在构造函数内部绑定它！).</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="4d79" class="jd je hi kj b fi kn ko l kp kq">handleResult(result) {<br/>  this.setState({<br/>    currMarker: {<br/>      name: result.result.place_name,<br/>      latitude: result.result.center[1],<br/>      longitude: result.result.center[0]<br/>    }<br/>  })<br/>}</span></pre><p id="383b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将创建一个函数来传递给按钮的<em class="kz"> onClick </em>事件属性，以保存地图上的<em class="kz"> currentMarker </em>！该功能将通过将<em class="kz">当前标记</em>推送到<em class="kz">映射</em>数组来更新状态。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="51e2" class="jd je hi kj b fi kn ko l kp kq">addMarker() {<br/>  const {currMarker} = this.state<br/>  this.setState(prevState =&gt; ({<br/>    markers: [...prevState.markers, currMarker],<br/>    currMarker: null<br/>  }))<br/>}</span></pre><p id="5114" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了最终渲染保存在我们的<em class="kz"> maps </em>数组中的位置标记，只需映射通过(没有双关的意思！)map组件内部的数组，为每个组件传入各自的属性。您的代码应该类似于下面的示例:</p><figure class="ke kf kg kh fd ks"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="f5ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用上面的代码，您应该能够通过选择一个位置并单击add按钮在地图上添加标记！</p><figure class="ke kf kg kh fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ma"><img src="../Images/7d08c164b30baf3dfc4515321cedb80c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*89mF4UY9KOXQ38xFfULWnQ.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">Map with markers</figcaption></figure><h2 id="5c9c" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">4.创建弹出窗口</h2><p id="3077" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">最后但同样重要的是，我们将为地图上的标记创建弹出窗口。同样，我们将使用react-map-gl提供的内置弹出组件。它接受众多的道具——出于我们的目的，我们将包括以下:<em class="kz"> mapRef </em>、<em class="kz">纬度</em>、<em class="kz">经度</em>、<em class="kz">关闭按钮</em>、<em class="kz">关闭点击</em>和<em class="kz">关闭。</em></p><ul class=""><li id="7118" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lf lg lh li bi translated"><em class="kz">关闭按钮</em>:(默认:<code class="du lv lw lx kj b">true</code>)如果<code class="du lv lw lx kj b">true</code>，弹出窗口的右上角会出现一个关闭按钮。</li><li id="38e0" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated"><em class="kz">关闭点击</em>:(默认:<code class="du lv lw lx kj b">true</code>)如果<code class="du lv lw lx kj b">true</code>，点击地图时弹出窗口会关闭。</li><li id="b545" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated"><em class="kz"> onClose </em>:用户关闭弹出窗口时的回调。</li></ul><p id="4e38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要在单击标记时呈现弹出窗口，让我们将<em class="kz"> selectedMarker </em>添加到本地状态，并添加两个实例方法<em class="kz"> handleMarkerClick </em>和<em class="kz"> handleClose </em>。点击标记时将调用<em class="kz"> handleMarkerClick </em>方法，该方法将更新selectedMarker以保存该标记的信息。当点击弹出窗口上的关闭按钮时，将调用<em class="kz"> handleClose </em>方法，并将handleMarkerClick更新为<code class="du lv lw lx kj b">null</code>。</p><p id="39e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是最终代码:</p><figure class="ke kf kg kh fd ks"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="9981" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保存代码后，您应该能够单击地图上的标记来查看弹出窗口！</p><figure class="ke kf kg kh fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es mb"><img src="../Images/89607f169213fa320a58890463e98565.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*08fGjNZub1_9ArAm0S3O4w.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">Pop-up</figcaption></figure></div><div class="ab cl mc md gp me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hb hc hd he hf"><p id="a643" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">恭喜你，你现在有一个交互式地图了！🎉这只是一个开始-尝试实现更多的功能，为您的地图添加更多的复杂图层。感谢您的阅读，如果您有任何问题、评论或担忧，请随时联系我们！</p><h1 id="757a" class="mj je hi bd jf mk ml mm jj mn mo mp jn mq mr ms jq mt mu mv jt mw mx my jw mz bi translated">参考</h1><p id="c33a" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated"><a class="ae kd" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank">https://github.com/facebook/create-react-app</a></p><p id="e0c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kd" href="https://docs.mapbox.com/mapbox-gl-js/api/" rel="noopener ugc nofollow" target="_blank">https://docs.mapbox.com/mapbox-gl-js/api/</a></p><p id="0ee2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kd" href="https://visgl.github.io/react-map-gl/docs/get-started/get-started" rel="noopener ugc nofollow" target="_blank">https://visgl . github . io/react-map-GL/docs/get-started/get-started</a></p><p id="ab96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kd" href="https://www.npmjs.com/package/react-map-gl-geocoder" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/react-map-gl-geocoder</a></p></div></div>    
</body>
</html>