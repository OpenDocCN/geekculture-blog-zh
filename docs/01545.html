<html>
<head>
<title>Using Redis with Docker and NodeJS/Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Redis与Docker和NodeJS/Express一起使用</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/using-redis-with-docker-and-nodejs-express-71dccd495fd3?source=collection_archive---------0-----------------------#2021-04-15">https://medium.com/geekculture/using-redis-with-docker-and-nodejs-express-71dccd495fd3?source=collection_archive---------0-----------------------#2021-04-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/482e928050a90dd9e762a49078a772fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PD01VCYerK4bNAYayCG4ww.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx"><a class="ae iu" href="https://unsplash.com/photos/EaB4Ml7C7fE?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/EaB4Ml7C7fE?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink</a></figcaption></figure><p id="e92e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我将介绍在本地机器上使用<strong class="ix hj"> DOCKER </strong>安装<strong class="ix hj"> REDIS </strong>的步骤，并在本地运行的<strong class="ix hj"> node/expressJS </strong>应用程序中访问DOCKER容器服务。</p><h1 id="7e23" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">先决条件</h1><p id="f052" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我假设您已经在本地机器上完成了基本设置，例如<strong class="ix hj">节点包管理器、Docker </strong>，并且对<strong class="ix hj"> Javascript </strong>、<strong class="ix hj"> NodeJS </strong>、<strong class="ix hj"> Express </strong>、<strong class="ix hj"> REDIS、</strong>和<strong class="ix hj"> Docker </strong>有相当的了解。</p><h1 id="2695" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">我们开始吧</h1><p id="78d9" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我将从使用docker安装REDIS的构造开始，然后转向在本地开发环境中的使用。</p><h1 id="1033" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用DOCKER安装REDIS</h1><p id="7628" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">要完成这一步，启动您的终端并执行以下命令。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="6296" class="lf ju hi lb b fi lg lh l li lj">docker run -d --name &lt;CONTAINER_NAME&gt; -p 127.0.0.1:6379:6379 redis</span></pre><ul class=""><li id="3ff0" class="lk ll hi ix b iy iz jc jd jg lm jk ln jo lo js lp lq lr ls bi translated"><strong class="ix hj">运行</strong> —创建并启动容器</li><li id="ecf5" class="lk ll hi ix b iy lt jc lu jg lv jk lw jo lx js lp lq lr ls bi translated"><strong class="ix hj"> d </strong> —以分离模式运行容器</li><li id="b4b7" class="lk ll hi ix b iy lt jc lu jg lv jk lw jo lx js lp lq lr ls bi translated"><strong class="ix hj"> —名称&lt;容器名称&gt; </strong> —为容器指定名称。</li><li id="0638" class="lk ll hi ix b iy lt jc lu jg lv jk lw jo lx js lp lq lr ls bi translated"><strong class="ix hj"> p </strong> —将端口和IP映射到本地机器。这是在本地启用服务的关键。如果您创建的映像没有本地映射，那么您将无法访问这些信息。<strong class="ix hj"> 6379 </strong>是<strong class="ix hj"> REDIS </strong>的<strong class="ix hj">默认端口</strong>。</li><li id="6186" class="lk ll hi ix b iy lt jc lu jg lv jk lw jo lx js lp lq lr ls bi translated"><strong class="ix hj"> Redis </strong> —要下载的图像的名称。</li></ul><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="7906" class="lf ju hi lb b fi lg lh l li lj">docker ps -a</span></pre><p id="8ddf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个命令将向您显示与您机器上的docker相关联的所有容器的列表。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/0be57be9004b3d3640c2ae186cfc2fad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*75MDH7TCJe6sjqgM"/></div></div></figure><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="fdcf" class="lf ju hi lb b fi lg lh l li lj">docker exec -it &lt;CONTAINER_NAME|ID&gt; sh</span></pre><p id="2068" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您已经为容器提供了名称，那么就使用名称或利用与容器相关联的ID。</p><p id="4223" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要测试您的安装，请按如下步骤进行并运行一些基本的REDIS命令</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="680c" class="lf ju hi lb b fi lg lh l li lj"># redis-cli<br/>127.0.0.1:6379&gt; ping<br/>PONG<br/>127.0.0.1:6379&gt; set customer_name "John Doe"<br/>OK<br/>127.0.0.1:6379&gt; get customer_name<br/>"John Doe"<br/>127.0.0.1:6379&gt; del customer_name<br/>(integer) 1<br/>127.0.0.1:6379&gt; exit<br/># exit</span></pre><h1 id="df51" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">基本ExpressJS应用程序设置</h1><p id="0a2a" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">既然我们已经完成了REDIS的安装，那么让我们继续创建一个小型的ExpressJS应用程序。</p><p id="425b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">转到您的终端并执行以下命令</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="6529" class="lf ju hi lb b fi lg lh l li lj">npm init</span></pre><p id="ba32" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">init命令将通过一个基于终端的向导为package.json文件提供默认值。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="4502" class="lf ju hi lb b fi lg lh l li lj">npm i -P express<br/>npm i -D nodemon</span></pre><p id="03ad" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面的命令将安装开发所需的依赖项。</p><p id="a734" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在您选择的编辑器中打开package.json文件，并在脚本部分下添加以下命令。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="fedb" class="lf ju hi lb b fi lg lh l li lj">"dev": "nodemon server"</span></pre><p id="8318" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，打开您的<strong class="ix hj">index . js/server . js(main)</strong>并添加以下代码片段来创建一个基本的ExpressJS应用程序。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="c8a8" class="lf ju hi lb b fi lg lh l li lj">const express = require('express');</span><span id="f14d" class="lf ju hi lb b fi lz lh l li lj">const PORT = 5001;</span><span id="9b88" class="lf ju hi lb b fi lz lh l li lj">const app = express();<br/>const router = express.Router();</span><span id="34ee" class="lf ju hi lb b fi lz lh l li lj">app.use(express.json());</span><span id="1c82" class="lf ju hi lb b fi lz lh l li lj">router.get('/', (req,res) =&gt; {<br/>    res.status(200).json({<br/>        message : "Sample Docker Redis Application"<br/>    });<br/>});</span><span id="bbf6" class="lf ju hi lb b fi lz lh l li lj">app.listen(PORT, () =&gt; {<br/>    console.log(`Server running on PORT ${PORT}`);<br/>});</span></pre><p id="f747" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的基本ExpressJs应用程序已经准备好了。</p><p id="7822" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，启动服务器。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="bb23" class="lf ju hi lb b fi lg lh l li lj">npm run dev</span></pre><p id="f276" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">打开一个新的终端实例，使用“cURL”命令检查应用程序是否正常工作。输出将类似于以下内容。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="2c30" class="lf ju hi lb b fi lg lh l li lj">HTTP/1.1 200 OK<br/>X-Powered-By: Express<br/>Content-Type: application/json; charset=utf-8<br/>Content-Length: 45<br/>ETag: W/"2d-bO6czhAp6+qsrxSQWqx38pGjRvo"<br/>Date: Thu, 15 Apr 2021 18:14:24 GMT<br/>Connection: keep-alive<br/>Keep-Alive: timeout=5</span><span id="3e9f" class="lf ju hi lb b fi lz lh l li lj">{"message":"Sample Docker Redis Application"}</span></pre><h1 id="0f1b" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">通过应用程序访问REDIS</h1><p id="f639" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">要访问REDIS，我们需要在我们的应用程序中访问<strong class="ix hj"> REDIS客户端</strong>。</p><p id="c613" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">转到您的终端-&gt;应用程序根文件夹</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="5558" class="lf ju hi lb b fi lg lh l li lj">npm i -P redis</span></pre><p id="0844" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将为您的应用程序安装<strong class="ix hj"> REDIS </strong>支持。</p><p id="cd60" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在编辑器中打开s【erver.js/index.js】的<strong class="ix hj">主文件</strong>，并对enable access进行修改。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="3ee0" class="lf ju hi lb b fi lg lh l li lj">const redis = require('redis');</span><span id="ade4" class="lf ju hi lb b fi lz lh l li lj">const redisClient = redis.createClient(6379,'127.0.0.1');</span><span id="9d02" class="lf ju hi lb b fi lz lh l li lj">redisClient.on('error', (err) =&gt; {<br/>    console.log('Error occured while connecting or accessing redis server');<br/>});</span><span id="2bd8" class="lf ju hi lb b fi lz lh l li lj">if(!redisClient.get('customer_name',redis.print)) {<br/>    //create a new record<br/>    redisClient.set('customer_name','John Doe', redis.print);<br/>    console.log('Writing Property : customer_name');<br/>} else {<br/>    let val = redisClient.get('customer_name',redis.print);<br/>    console.log(`Reading property : customer_name - ${val}`);<br/>}</span></pre><p id="ac24" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当您保存文件时，由于我们有<strong class="ix hj"> nodemon </strong>监视我们的资产变化，服务器将重启。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="90ba" class="lf ju hi lb b fi lg lh l li lj">[nodemon] starting `node server.js`<br/>Writing Property : customer_name<br/>Server running on PORT 5001<br/>Reply: null<br/>Reply: OK</span></pre><p id="df7d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过终止线程或再次保存文件来重新启动服务器。现在，它将从REDIS中读取属性，并在控制台上显示它。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="0ba7" class="lf ju hi lb b fi lg lh l li lj">[nodemon] restarting due to changes...<br/>[nodemon] starting `node server.js`<br/>Writing Property : customer_name<br/>Server running on PORT 5001<br/>Reply: John Doe<br/>Reply: OK</span></pre><p id="e74d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以进一步检查信息是否成功存储在实例中。“SSH”加载到容器中，并读取属性。</p><p id="60d2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">好吧，就这样。我们已经准备好在本地应用程序中访问REDIS。本文到此结束。</p><p id="d362" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你喜欢这篇文章，请随意分享。</p><p id="74a0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">访问示例代码@<a class="ae iu" href="https://github.com/cmgabriel/docker_redis_express" rel="noopener ugc nofollow" target="_blank">https://github.com/cmgabriel/docker_redis_express</a></p><p id="7834" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢您的阅读和快乐编码！</p></div></div>    
</body>
</html>