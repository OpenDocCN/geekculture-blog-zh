<html>
<head>
<title>How we automagically recognized human languages in Microsoft Word</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们如何在微软Word中自动识别人类语言</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/auto-detecting-languages-in-microsoft-word-58356a9e1649?source=collection_archive---------6-----------------------#2021-10-12">https://medium.com/geekculture/auto-detecting-languages-in-microsoft-word-58356a9e1649?source=collection_archive---------6-----------------------#2021-10-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9bf3" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">将我在大学学到的算法应用到现实生活中</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/12b41239483ffc2a025f778d81287da6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*aTwbqX3xyevOLpWYV8ag-w.png"/></div></figure><p id="856e" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我双击了微软Word 2000图标。那是1998年1月，所以这是一个早期的调试版本。我的硬盘疯狂地旋转，我的400Mhz奔腾II试图加载我刚刚安装的内存猪。最终，经过一分钟的努力，闪屏出现了，又过了一分钟，真正的窗口和菜单栏出现了。我开始用西班牙语打一个句子。因为Word的默认语言是英语，所以拼写者用红笔画出了每个单词。但是大约5个字之后，奇迹发生了！Word识别该语言，并代表我自动切换拼写。我很敬畏。</p><p id="99ad" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我刚刚从大学毕业，<a class="ae kb" href="https://link.medium.com/TqZqGyydThb" rel="noopener">开始在微软工作，在自然语言小组，一个从微软研究院分离出来的25人的小公司，我会看着它在5年内成长为拥有500名工程师的庞然大物。我们的崇高目标是让计算机能够理解人类语言。微软研究院在这样的长期赌注上基本上没有任何让步。对我来说，在大学里完成了这么多理论上的、看似做作的作业后，在专业环境中剖析一个现实世界的问题，并看看我所学的一些计算机科学算法是如何实际应用于它的，这是非常令人着迷的。</a></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es kd"><img src="../Images/a1885aeb5d65cfef1e7a6792cc51c326.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z4Hp1N_kqJUjNDyD"/></div></div><figcaption class="ki kj et er es kk kl bd b be z dx">Some old swag from the nineties</figcaption></figure><p id="fc01" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">今天，我们似乎认为语言自动检测是理所当然的。微软Office和谷歌文档都在无处不在地运行它，只需输入几个单词，它们就悄悄地将校对工具(拼写检查、语法检查等)切换到正确的语言。你甚至不知道它正在发生。像我这样的双语者非常欣赏这一点，并且在有多种官方语言的国家广泛使用。</p><p id="006f" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在Office 97和更早的版本中，您必须手动执行此操作。打开一个不同语言的文档是一个糟糕的客户体验，因为英语拼写者会踢进来，不认识任何外国单词，并高兴地在每个单词下面加上红色的波浪线。然后，你必须高亮显示整个文本，点击4或5次后，将语言设置为正确的语言(如果你知道要完成这项艰巨的任务必须遵循的晦涩的菜单项)。</p><p id="03c4" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">想知道语言自动检测的魔力是如何工作的吗？我们花了一年时间来完善它，但基本算法出奇的简单。事实上，我今天花了一个小时用150行Java重新写了一遍，因为那是一个下雨的星期天，我很享受这段回忆之旅。你应该试试！这是一个有趣的小编码挑战。</p><p id="d01b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">直觉是:每种语言都有共同的模式，即在该语言中比在其他语言中出现频率更高的字符序列。例如，序列“t-h-e”在英语中比在西班牙语中出现得更频繁。如果我在一个句子中看到“the ”,我会立刻对这个句子是英语有更高的信心。当你看到越来越多的字符序列时，你所要做的就是积累信心，在某个时刻，你有足够的信心，这是语言X而不是任何其他语言。</p><p id="8236" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这些3个字符的序列被称为<em class="kc">三元组</em>。我们看了看是否可以用二元模型或n元模型来做这件事，其中n &gt; 3，但实际上，3是一个令人惊讶的好点。在句子“<em class="kc">敏捷的棕色狐狸跳过懒惰的狗</em>”<strong class="jh hj">T5】中，你的卦将是:<em class="kc"> the，qui，uic，ick，bro，row，own，fox，</em> …</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es km"><img src="../Images/30e2d8c56a7793db04ef132aa9726bc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*erNdICDduxd3TV7rqqQzvg.png"/></div></div><figcaption class="ki kj et er es kk kl bd b be z dx">How trigrams work</figcaption></figure><p id="a1c8" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">标记化(把你的句子分解成单词)实际上是第一个重要的问题。听起来很简单:一个简单的断字器只会在空白上断开。但是当你开始更详细地考虑它的时候，有各种各样的边缘情况和标点符号会使事情变得更难。这还只是英语。德语有疯狂的长复合词。日语没有空格。阿拉伯语和希伯来语从左到右，所以你的整个算法必须反向运行。当你这样做的时候，你需要从你的流中清除所有无用的字符:标点符号、多余的空格、数字等等。你也要思考如何看待大写和小写。但是让我们假设我们已经编写了一个像样的记号赋予器(或者，如果你只是为了好玩而写代码，你可以偷懒，在空白上分开，这里没有判断！).</p><p id="8ae7" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如今，一些开源的NLP库做得非常出色。但是在那个时候，我们试图用自然语言做的一切都是在探索未知的领域。今天我要讲的一些事情看起来相当明显；他们那时还没回来。</p><p id="9d81" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">对于Microsoft Word中的语言自动检测，我们为每种语言创建了一个<em class="kc">模型</em>。我们有语言的语料库(“语料库”或它的复数“语料库”是“一堆文本”的一个有趣的词)，我们把它分成简介<a class="ae kb" href="https://en.wikipedia.org/wiki/Training,_validation,_and_test_sets" rel="noopener ugc nofollow" target="_blank">训练、验证和测试集</a>。然后，我们需要一个数据结构来跟踪我们在训练集中看到的每个三元模型有多少个实例。因此，我们将该语言中的数千个句子解析成三元模型，然后跟踪每个三元模型的计数器。</p><p id="2ac7" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">您希望优化这种数据结构，以便实时检测语言。有什么好的数据结构可以快速查找这些三元模型的实例？嗯，一个<a class="ae kb" href="https://en.wikipedia.org/wiki/Trie" rel="noopener ugc nofollow" target="_blank"> trie </a>非常适合这个，它是一个为搜索优化的树形数据结构。在查找三元模型“the”的情况下，我们在trie的最顶层找到节点“t”。然后，我们在“t”的孩子中找到“h”，在“h”的孩子中找到“e”。而“e”是叶节点，它具有三元模型在每种语言中出现的次数。您可以在O(n)时间内遍历一个句子中的三元模型，并在O(1)时间内查找每个三元模型的值。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es kn"><img src="../Images/0512fb987d660bca7055e03a6a729e8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sfhDxqmpB7mBmo6IrHA7Hw.png"/></div></div><figcaption class="ki kj et er es kk kl bd b be z dx">Tries are awesome! Three little O(1) lookups and you’ve got a leaf node</figcaption></figure><p id="470b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">一路上我们需要考虑一些细微的事情。</p><p id="d165" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">例如，因为我们用每种语言不同数量的句子进行训练，我们需要标准化数据，而不是保留原始数据，否则我们最终会得到扭曲的置信度。</p><p id="ef35" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">或者，这并不像构建一个每层有26个节点的“a-z”trie那么简单，因为许多语言都有<a class="ae kb" href="https://en.wikipedia.org/wiki/Diacritic" rel="noopener ugc nofollow" target="_blank">变音符号</a>，那些对字母的时髦的额外修饰，如ā、δ、á、σ、ģ、ķ、ü等。这些发音符号在识别语言时非常有用，应该在trie中有自己的节点。</p><p id="db69" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们还必须做出一些产品决策，例如:在什么时候我们告诉Word我们确信它是一种特定的语言？我们使用什么粒度？(一个段落可以合法地包含不同语言的句子)。我们默认每个句子都做这个<em class="kc"/>，所以每次有人按下点+空格。但是有时候句子太短了，所以我们必须继续。有时候，对于长句子，我们在句子结束之前就有足够的信心，这样我们就可以提前说出单词。有时，我们告诉Word这是一种特定的语言，然后当我们继续前进时，我们意识到我们错了，所以我们必须告诉Word返回并切换语言。所以我们必须建立撤销缓冲区和回溯决策的能力。</p><p id="b102" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">有些语言非常接近，比如西班牙语、葡萄牙语、意大利语和法语。区分这些是一场噩梦。所以我们决定只启用我们的客户实际安装了拼写器的语言。这提高了准确性，但也使测试矩阵变得更加复杂，因为我们支持21种语言，现在我们必须测试所有这些组合。</p><p id="94a0" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在其他情况下，我们可以用一些简单的带有Unicode范围检查的if语句来代替trie。不使用<a class="ae kb" href="https://en.wikipedia.org/wiki/Latin_alphabet" rel="noopener ugc nofollow" target="_blank">拉丁字母</a>的语言，如阿拉伯语、希伯来语、印地语、孟加拉语、马拉地语、日语等，通常都有非常具体的Unicode范围，所以很容易识别。特里实际上只是为了使用拉丁字母的语言。</p><p id="a24a" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们必须在测试方法上花很多心思。语言自动检测需要实时运行，否则它可能会在我们的客户键入时引入延迟，因此解析文本的延迟非常重要，我们测量了不同语言组合下每个字符的毫秒数。我们在Microsoft Word进程中作为DLL运行，所以我们的内存消耗也很重要，因为Word已经是一个内存猪。我想确保我们不会慢慢地泄漏内存(这是用老式的C语言编写的，为了好玩，在这里或那里加入了一些实际的汇编语言)，因为Word进程可能会运行数周，所以我在同一个进程中运行了数百万个句子。还记得你不得不频繁地点击“保存”吗？因为如果Word崩溃，你会丢失所有没有保存的东西。Word没有在try/catch中包装他们对我们的调用，所以当我们崩溃时，我们崩溃了整个应用程序——所以可靠性很重要。最后，精确度和召回率为我们了解每种语言的表现提供了很好的衡量标准。</p><p id="b4e4" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们发了一个DLL(【mslid.dll】，代表“微软语言标识符”)……不知道Office安装里还包含不包含？如果是这样，你看到的是25年前的C代码，现在还在运行！因为是DLL，所以我所有的测试都是直接调用DLL的CLI工具，我从MS-DOS运行它们。但是，我们还必须确保Office中的对应部分正确集成了DLL，所以我还必须编写一些驱动Office UI的基本健全性测试。太痛苦了，太不可靠了，尤其是针对那些没有好的理由就挂起一半时间的调试版本！</p><p id="1990" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们做了很多额外的试探法和调整来提高准确性或性能，但这只是基本算法。出奇的简洁优雅。我今天写了一个简单的版本，只是为了好玩，它有80%的准确率。我们最终发布的产品DLL对大多数语言的准确度都在90%以上。</p><p id="2f1d" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">多年来，我为5个版本的Microsoft Office和40种不同的语言提供了校对工具(语言自动检测、断词工具、拼写工具、语法检查工具、同义词库)。当我看到那些红色和绿色的曲线时，我仍然会微笑。最终，整个自然语言领域的进展比我想象的要慢得多。语法检查器和拼写器离计算机用你自己的语言与你自然交流的梦想还很遥远。他们是朝着那个目标迈出的谦卑的一步。但是今天，当我让我的谷歌助手做一些事情，或者当我对着我智能家居中的11个亚马逊Alexas中的一个大喊大叫，并思考自然语言处理的进展时，我可以看到技术是如何建立在技术之上的:无论如何，我们都站在前人的肩膀上。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es ko"><img src="../Images/bf031773ca42852f0d9669a16bf9d60a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_VNZd0_Pt82mwx0K"/></div></div><figcaption class="ki kj et er es kk kl bd b be z dx">A giant beach towel that we got as swag, I got it signed by all my co-workers in NLG! Among other things, these are all the engineers that wrote the spellers and grammar checkers in Microsoft Office.</figcaption></figure></div></div>    
</body>
</html>