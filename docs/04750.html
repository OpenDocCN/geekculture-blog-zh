<html>
<head>
<title>How to NOT secure web payment systems</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何保护网络支付系统</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-not-secure-web-payment-systems-e23be321b168?source=collection_archive---------44-----------------------#2021-07-02">https://medium.com/geekculture/how-to-not-secure-web-payment-systems-e23be321b168?source=collection_archive---------44-----------------------#2021-07-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a431739fbdbe207341988cf9fa87693f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7SwqWRO5MjW9LaC9nA3JdQ.jpeg"/></div></div></figure><p id="2bda" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为这里的故事是真实的，我将避免使用具体的名称或地点。这可能会让我陷入尴尬的境地。如果你经历过类似的事情，这可能听起来很熟悉。<br/>也就是说，识别细节与故事本身关系不大。这不是一个新的或复杂的黑客。这是开发人员最大的懒惰。假设用户都是非技术羊。在很大程度上，他们是对的，但是，一个贪婪淘气的用户可以改变图片。</p><p id="0fcf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">免责声明:</p><ul class=""><li id="dbbc" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">我实际上没有使用我得到的东西，并且报告了这个错误</li><li id="3ffd" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">我不建议人们试图通过利用糟糕的系统来获得免费服务。这是为了帮助保护那些被暴露的人</li><li id="49f5" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">我希望开发者对系统更加警惕，尤其是那些涉及跨越他们国家边界的每个人的个人和医疗信息的系统</li><li id="6005" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">然而，我确实认为，在家里测试这些类型的错误对互联网有更大的好处。</li></ul></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="6c0f" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">从前</h1><p id="c849" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">我一直在旅行。在covid期间比“正常”时间更是如此，以获得疫苗、医疗检查和其他个人义务。旅行变成了巨大的支付负担，你必须在登机前和落地后支付测试费用。哦，回去的时候再来一遍。虽然我对测试的必要性没有任何批评(我也没有专业背景来评论它)，但我不得不承担和支付的一堆测试开始感觉像一种税收。一种消极的经济激励，如果你愿意，就不去旅行。</p><p id="3a97" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在过去的一年里，我一直在我的祖国旅行，不得不在机场搭乘免费的聚合酶链式反应测试航班。在在线专用系统中安排预约，每次使用相同的折扣代码:<code class="du ln lo lp lq b">Free1</code>。</p><p id="8a3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">几天前，当我在计划另一次回家的旅程时，我又重复了一遍同样漫长的例行公事。填写乘客定位器表格(出境和入境旅行——🤷)和预购我的机场Covid聚合酶链式反应测试。</p><p id="c9b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">令我惊讶的是，测试名称从“Covid PCR —强制”变成了类似“Covid PCR—80美元强制”的东西。</p><p id="9562" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lr">等什么？</em></p><p id="013e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">是的，似乎从现在开始，如果你想离开机场，每人80美元的罚款(对不起，是收费)是必须的。另一种选择是，抵达时用现金支付100美元(有些交易可能？).</p><p id="9a38" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我重试了过去一年一直有效的代码。<code class="du ln lo lp lq b">Free1</code>和“应用”。屏幕显示红色错误信息。上面写着“无效的优惠券代码”。</p><p id="34b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我做了任何一个网络罪犯在那个时候都会做的事情——重复做同样的事情3-5次(天才)。当那不起作用时，我尝试了<code class="du ln lo lp lq b">Free2</code>、<code class="du ln lo lp lq b">Free80</code>和其他几个。</p><p id="1dd7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我检查传出的请求时，我发现它被发送到一个<code class="du ln lo lp lq b">/api/validate-voucher</code>端点。它返回一个奇怪的HTTP错误；<code class="du ln lo lp lq b">422 (Unprocessable entity)</code>还有一个<code class="du ln lo lp lq b">{statusCode: 422, message: "Invalid Voucher or Appointment ID"}</code>，嗯..什么“约会”？我想申请一个折扣代码。如果响应不好，UI会删除输入的代码，有效地“阻止”代码的使用。事实上，它确实被删除了，这可能是一个很好的用户体验，但同时也是一个糟糕的预防机制。"<em class="lr">为什么不自己测试一下？</em>“我想。😈</p><p id="5384" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为救援而忙碌！<br/>我通过打嗝启动Firefox和<a class="ae kc" href="https://addons.mozilla.org/en-US/firefox/addon/foxyproxy-standard/" rel="noopener ugc nofollow" target="_blank">代理</a>一切。</p><p id="5c35" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">查看发出的请求，我看到了指标和更多指标、第三方跟踪程序等等。有时候我真希望我没有看到网站让我们发的那堆垃圾。转发一切不感兴趣的东西，直到哎呦，那是什么？</p><p id="3e3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">保存JSON数据的请求:</p><pre class="ls lt lu lv fd lw lq lx ly aw lz bi"><span id="fcb7" class="ma kl hi lq b fi mb mc l md me">{<br/>  appointmentId: "12345",<br/>  voucher: ""<br/>}</span></pre><p id="413d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好了，把之前有效的凭证滑过来怎么样？等等，这听起来很熟悉..早些时候，当我试图输入我的旧折扣代码时，我得到了一个“无效的约会id……”，同一个系统实际上可以用于两个目的吗——验证代码<strong class="is hj">和</strong>创建约会？感觉不对劲，直觉告诉我，我会看到一些有趣的东西。<br/>我动态编辑对象，并打着嗝转发。</p><pre class="ls lt lu lv fd lw lq lx ly aw lz bi"><span id="83d9" class="ma kl hi lq b fi mb mc l md me">{<br/>  appointmentId: "12345",<br/>  voucher: "Free1"<br/>}</span></pre><p id="42dc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">而你知道吗，屏幕上出现了一个巨大闪亮的绿色标签:“已付费”。五秒钟后，屏幕重新加载，生成了一个带有约会的新QR。</p><h1 id="0c16" class="kk kl hi bd km kn mf kp kq kr mg kt ku kv mh kx ky kz mi lb lc ld mj lf lg lh bi translated">这个故事的寓意</h1><p id="79f3" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">用户不傻。他们中的一些人可能没有技能或精力去钻研。但是，如果一个保存个人医疗记录和结果的系统如此容易被利用，那么在其他领域会发生什么呢？</p><p id="a322" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">企业的建立和运行是为了赚钱。因此，它们总是会成为攻击的目标。更不用说一项直到最近还免费的服务了，现在这项服务被强加给所有回国的乘客，阻止他们回家。</p><blockquote class="mk ml mm"><p id="1a1c" class="iq ir lr is b it iu iv iw ix iy iz ja mn jc jd je mo jg jh ji mp jk jl jm jn hb bi translated">人们必须检查每一个传入的请求，就好像它来自野外一样(实际上是这样！).雇佣 <a class="ae kc" href="https://en.wikipedia.org/wiki/Zero_trust_security_model" rel="noopener ugc nofollow" target="_blank"> <em class="hi">零信任</em> </a> <em class="hi">。</em></p></blockquote></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="40e5" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">处理方式和一般方法</h1><p id="1725" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">首先，<strong class="is hj">假设你会被剥削</strong>。就像检查前门是否上锁一样，应用程序应该确保用户只能做他们想做的事情。</p><p id="ddb5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">检查折扣代码在UI中是否有效？太棒了，后端呢？浏览器生活在用户世界里，开发者不能控制应用程序如何被操作或被错误使用。我们必须检查每一个传入的请求，就好像它来自野外一样(实际上是……)。雇佣<a class="ae kc" href="https://en.wikipedia.org/wiki/Zero_trust_security_model" rel="noopener ugc nofollow" target="_blank">零信任</a>。</p><p id="96bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">同样，对输入请求进行速率限制；当我不能使用旧的<code class="du ln lo lp lq b">Free1</code>折扣代码时，我尝试了<code class="du ln lo lp lq b">Free2</code>，然后是<code class="du ln lo lp lq b">Free3</code>等等不同的排列。看起来很奇怪，我可以不停地输入代码，并了解它们是否有效，所以我做了任何人都会做的事情；我写了一个剧本。尝试了几十个只是为了好玩。虽然什么都没有出现，但我很高兴再次使用<a class="ae kc" href="https://github.com/ffuf/ffuf" rel="noopener ugc nofollow" target="_blank"> ffuf </a>进行模糊处理，并且我刚刚了解到系统并不限制请求的速率。如果有足够的时间，不同的用户可以连续几小时甚至几天运行一个类似的脚本。这很糟糕，有两个主要原因- <strong class="is hj"> a) </strong>服务器被请求轰炸。如果构建正确，它可以扩展为暴力攻击服务(这本身就很有趣)。在最坏的情况下，它会崩溃。<strong class="is hj"> b) </strong>在某个时候，会弹出一个有效的折扣代码。</p><p id="0101" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一个“折扣代码友好”的漏洞(在获得全面降价后我还没有尝试过)，是一个<a class="ae kc" href="https://www.veracode.com/security/race-condition" rel="noopener ugc nofollow" target="_blank">竞争条件</a>，用户可以重新应用相同的折扣代码，通常会多次给出折扣百分比。<a class="ae kc" href="https://hackerone.com/reports/59179" rel="noopener ugc nofollow" target="_blank">这里有一个几年前在Dropbox上发现的著名案例</a>。</p><p id="c544" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">总而言之，系统的安全性应该是最重要的。如果不是为了收益，至少是为了客户的隐私。Web应用程序可以通过多种方式被“入侵”，这可能很简单。我在测试自己的应用程序时的首选方法是像一个恶意的演员一样思考。我不一定是顶尖的安全专家，但我只是一个拥有简单技能和一些简单愿望的用户。比如得到免费服务，或者我不该得到的折扣。</p><p id="eb77" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢你阅读🖤</p><p id="51cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请随意提出问题或评论。</p></div></div>    
</body>
</html>