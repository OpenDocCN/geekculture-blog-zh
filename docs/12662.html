<html>
<head>
<title>What Is Optimizer Hint In Oracle?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Oracle中的优化器提示是什么？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/what-is-optimizer-hint-in-oracle-fd3c1b612e97?source=collection_archive---------14-----------------------#2022-05-25">https://medium.com/geekculture/what-is-optimizer-hint-in-oracle-fd3c1b612e97?source=collection_archive---------14-----------------------#2022-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="36cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我们将了解oracle中的优化器提示和用法</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/9b2e2915f3510bfc24d256c102cf01f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zrfmVXh6zUjhZT0ikvFTFw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">oracle optimizer hint</figcaption></figure><p id="5699" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">什么是优化器提示？</strong></p><ul class=""><li id="f24a" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">有时候优化器不会做我们想做的事情，因为它只是程序员为了帮助我们而编写的一段代码。</li><li id="85f7" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">所以它不可能总是使用最好的方法。</li><li id="6fe5" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">有时，我们希望优化你，让你做一些不同于最佳选择的事情。因为我们可能知道，我们的数据比优化器更好。</li><li id="984b" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">我们可能会建议优化器做一些它不想做的事情。</li><li id="00e6" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">这可能有几个原因。</li><li id="f593" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">例如，如果统计信息是旧的，优化器很可能会执行一个错误的执行计划，或者因为选择性是由优化器估计的，如果我们比优化器更了解特定查询的选择性，我们可以命令它使用不同的方法。</li><li id="c055" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">因此，为了推荐优化器做某事，我们使用优化器。</li><li id="a4e4" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">优化你的手，基本上迫使优化器选择一个特定的动作，例如，通过使用适当的提示，你可以告诉优化器使用一个特定的访问路径，或者你可以命令</li><li id="387d" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">它使用不同的方法，或者你可以说使用全表扫描等。我们手里有很多优化，会引导优化者做一些特定的事情。</li><li id="7833" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">然而，有时优化器可能不听您的，即使您在查询中使用了一些提示，</li><li id="cc81" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">如果优化器认为你想要的不是合理的东西。</li><li id="f66a" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">它可能不会这样做，但这种情况发生的次数很少，所以它很可能会做你想让它做的事情。</li></ul><blockquote class="kh ki kj"><p id="8272" class="if ig kk ih b ii ij ik il im in io ip kl ir is it km iv iw ix kn iz ja jb jc hb bi translated">"<strong class="ih hj">提示用于改变执行计划，并强制优化器使用最佳执行计划。此外，它还会影响优化器的决策。它根据特定的标准选择某个执行计划</strong></p></blockquote><ul class=""><li id="5e3c" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">但基本上，提示可以对单个表、多标签查询块或特定语句进行操作。</li></ul><p id="014c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">甲骨文中的提示有哪些类型？</strong></p><p id="89f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提示类型:</p><p id="9f69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.单表=在一个表或视图上指定单表提示。INDEX和USE_NL是单表提示的示例。</p><p id="8854" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.多表=多表提示类似于单表提示，只是该提示可以指定一个或多个表或视图。<br/> LEADING是多表提示的一个例子。请注意，USE_NL(table1 table2)不被视为多表提示，因为它实际上是USE_NL(table1)和USE_NL(table2)的快捷方式。</p><p id="8306" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.查询块=查询块提示对单个查询块进行操作。STAR_TRANSFORMATION和UNNEST是查询块提示的例子。</p><p id="b1f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.Statement =语句提示适用于整个SQL语句。ALL_ROWS是语句提示的一个示例。</p><p id="7bc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">如何使用提示？</strong></p><ul class=""><li id="fc3c" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">正如您所记得的，在编写所有查询时，我们可以很容易地向文章添加一些注释，例如添加注释，我们可以很容易地使用select close中的提示。</li><li id="a528" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">唯一要做的就是在第一个星号后面加一个加号。</li><li id="0d04" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">因此，如果编译器看到斜杠和+符号在一起，它将理解下一个文本是一个提示</li></ul><blockquote class="kh ki kj"><p id="34c2" class="if ig kk ih b ii ij ik il im in io ip kl ir is it km iv iw ix kn iz ja jb jc hb bi translated"><strong class="ih hj"> select /*+提示名(p1 p2 p3…) */列名from表名；</strong></p></blockquote><ul class=""><li id="80c7" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">这里，这个区域内的所有东西都被认为是提示</li><li id="7314" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">它可能有一个或多个参数，如果有多个参数，我们通过在参数之间留一个空格来写它们。</li><li id="1bee" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">提示可以用在选择、更新或删除关键字之后</li><li id="0edb" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">我们可以使用表名或它的别名作为提示参数。但是如果有别名，我们就不能使用表名</li><li id="85ca" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">它只能是一个提示区域</li><li id="1fc2" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">我们应该小心我们选择的提示，特别是当你使用多个提示的时候。我们可能会将优化器引向一个糟糕的执行计划。</li><li id="d7f6" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">在这个例子中，查询没有任何提示，让我们获取它的执行计划，并查看优化器决定的访问路径。</li></ul><p id="0bd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">没有提示的询问。它执行范围扫描:</strong></p><blockquote class="kh ki kj"><p id="c2fd" class="if ig kk ih b ii ij ik il im in io ip kl ir is it km iv iw ix kn iz ja jb jc hb bi translated"><strong class="ih hj"> SELECT employee_id，last_name <br/> FROM employees e <br/>其中last _ name LIKE ' A %；</strong></p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ko"><img src="../Images/257b5e2778c851177fc81da0e51d4c5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gJPWi_8MkkmcV9yHzAos2g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Range scan</figcaption></figure><ul class=""><li id="195a" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">它选择的范围再次超过应用程序名称索引作为最佳选择，其成本也是如此。</li></ul><p id="5bb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">使用提示命令优化器使用全表扫描:</strong></p><ul class=""><li id="a43f" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">在我们的下一个查询中，我们使用全表can提示，因此我们希望优化器选择全表扫描作为访问路径。</li><li id="d699" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">为了做到这一点，我们把作为提示名，把表的别名作为括号内的参数。</li></ul><blockquote class="kh ki kj"><p id="5869" class="if ig kk ih b ii ij ik il im in io ip kl ir is it km iv iw ix kn iz ja jb jc hb bi translated"><strong class="ih hj">SELECT/*+FULL(e)*/employee _ id，last _ name<br/>FROM employees e<br/>其中last _ name LIKE ' A %</strong></p></blockquote><ul class=""><li id="229d" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">执行计划结果显示成本太高，所以我们让优化器处于不利的位置。所以我们应该非常小心</li><li id="27e2" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">我们使用表的别名作为提示的基础。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kp"><img src="../Images/b9acedaaf4dd5bdbd29e39fa549580ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pyL8AvSwH_5d8IzimO4zQw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Full Table Scan</figcaption></figure><p id="6647" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我在下一个查询中直接使用表名会怎么样？</p><p id="df6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">使用带有表名的提示作为参数:</strong></p><ul class=""><li id="8db3" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">我们直接使用表名作为搜索的前缀。</li></ul><blockquote class="kh ki kj"><p id="3a7c" class="if ig kk ih b ii ij ik il im in io ip kl ir is it km iv iw ix kn iz ja jb jc hb bi translated"><strong class="ih hj">SELECT/*+FULL(employees)*/employee _ id，last _ name<br/>FROM employees<br/>其中last _ name LIKE ' A %</strong></p></blockquote><ul class=""><li id="7a16" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">正如您所看到的，它没有考虑我们的提示，因为当表有别名时，我们不能使用表名，所以如果表有别名，我们需要使用别名。</li><li id="30a9" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">但是如果表没有别名，我们可以使用表名。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kq"><img src="../Images/c4a48b615565871e01c5e55e02912538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HNlfDEBo3Lcsd_32mmu6OQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Index access scan</figcaption></figure><ul class=""><li id="3d19" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">在我们的下一个例子中，我使用了一个不合理的提示，原因是即使我在where子句中使用了姓氏列，我也在试图强制优化器使用部门想法索引。</li></ul><p id="bf80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">使用多个提示，优化器选择全表扫描作为最佳选择:</strong></p><blockquote class="kh ki kj"><p id="15d4" class="if ig kk ih b ii ij ik il im in io ip kl ir is it km iv iw ix kn iz ja jb jc hb bi translated">SELECT/*+INDEX(EMP _ NAME _ IX)FULL(e)*/employee _ id，last _ NAME<br/>FROM employees e<br/>其中last _ name LIKE ' A %</p></blockquote><ul class=""><li id="4f74" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">但是这不太符合逻辑，因为我们试图找到姓氏以“A%”开头的雇员，试图在部门和索引中查看这些雇员。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kq"><img src="../Images/90b5e3f40d83f63519cf9a5c7c3050cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C8tqxUAqnNwzIYmxHekQsg.png"/></div></div></figure><ul class=""><li id="5776" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">但是这个指标作为一个部门是视情况而定，而不是名称。</li><li id="e4b8" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">所以优化器会认为这不是一个合理的请求。它不会考虑这个提示。</li><li id="e8f8" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">如果我们看到执行计划的结果，它不会考虑我们的请求，而是对名称索引执行索引大脑扫描</li><li id="987d" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">因为我们在搜索姓氏。</li></ul><p id="17ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们改变提示的顺序时。但是这并没有改变优化器的决定:</p><blockquote class="kh ki kj"><p id="8460" class="if ig kk ih b ii ij ik il im in io ip kl ir is it km iv iw ix kn iz ja jb jc hb bi translated"><strong class="ih hj">SELECT/*+FULL(e)INDEX(EMP _ NAME _ IX)*/employee _ id，last_name <br/> FROM employees e <br/>其中last _ name LIKE ' A %</strong></p></blockquote><ul class=""><li id="13e3" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">在上面的例子中，我们使用了多个提示</li><li id="d899" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">正如我们已经知道的，如果我们想写多个提示，我们应该把它们写到一个命令区。</li><li id="e429" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">在本例中，我们告诉优化器对name列使用全扫描和索引扫描。</li><li id="9b1c" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">所以这不是一个合理的请求，但是这会使优化器困惑，它很可能会选择最有保证的方法。</li><li id="d6eb" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">这是一种成功的表访问方法</li><li id="3f3f" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">现在让我们得到执行计划，看看会发生什么。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/0b532a05b1bafa214dd68a84867a12cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kAvMnLppP19uLnJmwu7oRw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Full table access</figcaption></figure><ul class=""><li id="2ebe" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">如您所见，这不是全表扫描，实际上是一个更好的选择。这有时可能会改变。</li><li id="680f" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">这是没有保证的。</li><li id="4dea" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">我们认为这是因为全表扫描</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ks"><img src="../Images/8e124819a2ef5697bea314272c116d17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sBPQz-CqxcG7LWSGnYpG0w.png"/></div></div></figure><ul class=""><li id="99a1" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">如您所见，它再次选择了全表扫描作为最佳选择，但是当然，使用索引会更好。</li><li id="f995" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">在我们接下来的例子中，我将在接下来的时间里向你展示如何正确使用多只手。</li><li id="6ef9" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">我没有使用任何暗示。</li></ul><p id="0793" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">不使用提示:</strong></p><blockquote class="kh ki kj"><p id="5dd5" class="if ig kk ih b ii ij ik il im in io ip kl ir is it km iv iw ix kn iz ja jb jc hb bi translated">SELECT <br/> e.department_id，d.department_name，<br/> MAX(薪金)，AVG(薪金)<br/> FROM employees e，departments d <br/>其中e . department _ id = e . department _ id<br/>GROUP BY e . department _ id，d . department _ name；</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kp"><img src="../Images/51646f6d9b368b3e63bdf4eb426b705d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t9NO60w9QeVO88rJUl0HuQ.png"/></div></div></figure><ul class=""><li id="5941" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">如您所见，它对两个表执行全表扫描，并选择department的表作为驱动表。</li><li id="4fc8" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">在下一个查询中，我添加了一个前导提示。作为一个参数，我首先添加雇员表的列表，然后添加部门表的列表。</li></ul><p id="0fae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">使用多个提示更改执行计划:</strong></p><blockquote class="kh ki kj"><p id="f8fd" class="if ig kk ih b ii ij ik il im in io ip kl ir is it km iv iw ix kn iz ja jb jc hb bi translated"><strong class="ih hj">SELECT/*+LEADING(e d)INDEX(d DEPT _ ID _ PK)INDEX(e EMP _ DEPARTMENT _ IX)*/<br/>e . DEPARTMENT _ ID，d.department_name，<br/> MAX(薪金)，AVG(薪金)<br/> FROM employees e，departments d <br/>其中e . DEPARTMENT _ ID = e . DEPARTMENT _ ID<br/>GROUP BY e . DEPARTMENT _ ID，d . DEPARTMENT _ name；</strong></p></blockquote><ul class=""><li id="bb46" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">因为他们有别名，我写了E和D，中间有一个空格。</li><li id="c66a" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">这是我们使用引导暗示的方式。</li><li id="730f" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">此外，我添加了更多的索引提示，我命令优化器使用类似于两个表中的索引的部门。</li><li id="b5b6" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">如您所见，我首先输入了一个表E，然后输入了一个空格和该表的索引名。</li><li id="f02d" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">所以我希望优化器选择employees表作为驱动表，并使用这两个表的索引。</li><li id="b940" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">让我们来看看这个查询的执行计划</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/3a9891e0e739bb9a2b2c6fae388ca1d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UBvPOtronqiRUzhmEOnpDA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Index scan access</figcaption></figure><ul class=""><li id="7488" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">正如您现在看到的，employees表在顶部，这意味着它是一个驱动表，我们的索引在两个表中都使用。</li><li id="4427" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">因此，我们使用三只手，优化程序使用了所有的手。</li><li id="6fb8" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">正如这里可以理解的，提示必须针对不同的动作，这意味着不应该覆盖其他动作。</li><li id="4182" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">在下一个示例中，我们有两条访问路径。</li></ul><p id="c628" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">有两条访问路径时使用提示:</strong></p><blockquote class="kh ki kj"><p id="1f11" class="if ig kk ih b ii ij ik il im in io ip kl ir is it km iv iw ix kn iz ja jb jc hb bi translated"><strong class="ih hj">SELECT/*+INDEX(EMP _ DEPARTMENT _ IX)*/employee _ id，last_name <br/> FROM employees e <br/>其中last _ name LIKE‘A %’<br/>和DEPARTMENT _ id&gt;120；</strong></p></blockquote><ul class=""><li id="b39a" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">这里，我在where子句中同时使用了姓氏和部门</li><li id="26f7" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">在第一个例子中，我在提示中使用了部门id索引。</li><li id="31c0" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">实际上，即使你没有写提示，它也会选择这个索引。但是我会给你看一些不同的东西。</li><li id="7757" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">作为执行计划的结果，它在emp_department_ix上执行索引范围扫描</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/7a799e6f0d6bd1ed40fa68034f06b92d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JWCAGuASZkAJJd-paqa9ig.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Index Range Scan</figcaption></figure><p id="1a38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">当我们改变姓氏搜索的选择性时:</strong></p><blockquote class="kh ki kj"><p id="2872" class="if ig kk ih b ii ij ik il im in io ip kl ir is it km iv iw ix kn iz ja jb jc hb bi translated"><strong class="ih hj">SELECT/*+INDEX(EMP _ DEPARTMENT _ IX)*/employee _ id，last _ name<br/>FROM employees e<br/>其中last _ name LIKE‘Al %’<br/>和DEPARTMENT _ id&gt;120；</strong></p></blockquote><ul class=""><li id="3c5e" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">在上面的例子中，我把where子句的姓改成了“Al”</li><li id="74be" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">如果我们看到执行计划结果，优化器访问emp_name_ix上的索引范围扫描是最佳选择，即使我们命令优化器使用emp_department_ix，它也不听我们的，而是使用名称索引。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/b045496bdf7ef21cb9e3449b1d4fd7c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*roeJqIr04BgyK9qSLTdgoA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Index Range Scan</figcaption></figure><blockquote class="kh ki kj"><p id="d044" class="if ig kk ih b ii ij ik il im in io ip kl ir is it km iv iw ix kn iz ja jb jc hb bi translated"><strong class="ih hj">原因是优化器认为姓氏列对新的现实更具选择性。这意味着它认为将只搜索字母a搜索部门，这将更有选择性，所以我会使用它，因为我们已经在姓氏搜索“Al”中做了更改，所以优化器认为这将更有选择性，所以我可以使用名称的索引对我来说将更容易。</strong></p></blockquote><ul class=""><li id="f7df" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">即使我们推荐使用部门列索引，它也发现这不是一个合理的要求，以至于我不想听它们</li><li id="1906" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">因此，优化器有时会监听我们，但有时到现在还没有，所以我不能通过使用提示向您展示显著的增加。</li><li id="af89" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">原因是这些表格准备充分，统计数据是最新的，而且表格非常小。在一个大的数据库中，你会更有效地使用它。</li><li id="5512" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">在下一个例子中，我们将使用没有提示的连接、分组</li></ul><blockquote class="kh ki kj"><p id="6f34" class="if ig kk ih b ii ij ik il im in io ip kl ir is it km iv iw ix kn iz ja jb jc hb bi translated"><strong class="ih hj">SELECT customers . cust _ first _ name，customers.cust_last_name，<br/> MAX(数量_售出)，AVG(数量_售出)<br/> FROM sales，customers<br/>WHERE sales . cust _ id = customers . cust _ id<br/>GROUP BY customers . cust _ first _ name，customers . cust _ last _ name；</strong></p></blockquote><ul class=""><li id="4740" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">让我们看看这个查询的执行计划</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/a70ee79e1841bb9f2ebcb9791922a703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zGRMftMRBmRFeZCb2oDmbw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Multiple joins,group by without hint</figcaption></figure><ul class=""><li id="063b" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">结果显示成本太高，即882英镑</li><li id="b4f0" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">下一个例子我已经使用了具有相同查询的并行结果，查询性能得到了提高</li></ul><p id="3c7d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">执行并行执行时的性能提升提示:</strong></p><blockquote class="kh ki kj"><p id="33fc" class="if ig kk ih b ii ij ik il im in io ip kl ir is it km iv iw ix kn iz ja jb jc hb bi translated"><strong class="ih hj">SELECT/*+PARALLEL(4)*/customers . cust _ first _ name，customers.cust_last_name，<br/> MAX(QUANTITY_SOLD)，AVG(QUANTITY _ SOLD)<br/>FROM sales，customers <br/>其中sales . cust _ id = customers . cust _ id<br/>GROUP BY customers . cust _ first _ name，customers . cust _ last _ name；</strong></p></blockquote><ul class=""><li id="22bb" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">在这个例子中，我使用了parallel提示，并且基本上将读取任务分解为多个线程。如果我们使用并行的四个all任务将读取我们的表和连接，那么它将显著提高性能</li><li id="79f3" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">让我们看看上面这个查询的执行计划</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/f4a70ce4b043ad3521bd15d6e11563e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*532ldi8iWXoUsTK2aEJVFA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Parallel hint</figcaption></figure><ul class=""><li id="7776" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">结果显示查询值的开销是246，几乎比我们之前的开销值快了四倍。</li><li id="5923" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">如果我们使用并行提示值100，会不会阻碍时间更快？</li><li id="5672" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">不幸的是，没有，因为他们分别阅读相关的规则，然后加入它们，这也是有成本的，尤其是CPU的成本</li><li id="879c" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">很可能它会比前一个查询运行得慢，所以我们要根据我们的表、cpu、查询来为我们的查询找到最佳的并行执行计数..等等</li></ul><p id="8f19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结论:</strong></p><ul class=""><li id="a5c6" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">在这篇博客中，我们讨论了什么是暗示？如何在我们的查询中使用提示。</li><li id="70ee" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">此外，我们使用合理的提示，优化器将根据这些提示更新其执行计划，因此我们可以大大提高性能。</li><li id="327c" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">我们应该非常小心，这个提示也可能会降低性能</li><li id="c129" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">有时候如果你的预测不是那么合理，优化器就不会听从你的指挥，去做它认为最好的事情。</li><li id="2453" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">我们需要对此保持谨慎，因为随着时间的推移，表的结构或容量或者列的选择性可能会发生变化。</li><li id="c26d" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">有时我们可能会让乐观者做出更糟糕的决定，即使它在过去表现良好。因此，使用提示可能会显著提高性能，但我们在使用提示时应该小心</li></ul></div></div>    
</body>
</html>