<html>
<head>
<title>Create A Simple Captcha using PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PHP创建一个简单的验证码</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/create-a-simple-captcha-using-php-f787ac77e8b6?source=collection_archive---------3-----------------------#2021-10-16">https://medium.com/geekculture/create-a-simple-captcha-using-php-f787ac77e8b6?source=collection_archive---------3-----------------------#2021-10-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/6d32a333b7baf77291f3905f98178625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*x3cDTzkBzpOuv9aTEE1GUA.png"/></div></figure><p id="7686" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我最近用PHP创建了一个自定义的图片验证码，我也将向你展示如何使用它。</p><h1 id="268f" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">我们的文件结构</h1><figure class="kj kk kl km fd ij er es paragraph-image"><div class="er es ki"><img src="../Images/1fd14d5d7e583c43ea9460d50916c2d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/0*iXNjoqNh0Uv_jB3n.png"/></div></figure><ul class=""><li id="eb47" class="kn ko hi io b ip iq it iu ix kp jb kq jf kr jj ks kt ku kv bi translated">让我们从核心文件夹开始。</li></ul><p id="a0fe" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将创建两个文件。其中一个将为我们生成验证码图像，另一个将使我们能够验证生成的验证码</p><h2 id="274c" class="kw jl hi bd jm kx ky kz jq la lb lc ju ix ld le jy jb lf lg kc jf lh li kg lj bi translated">验证码_图像. php</h2><p id="8b2b" class="pw-post-body-paragraph im in hi io b ip lk ir is it ll iv iw ix lm iz ja jb ln jd je jf lo jh ji jj hb bi translated">我们需要生成我们的验证码文本，用<strong class="io hj"> md5() </strong>散列它，然后将散列值存储在一个会话中进行验证。</p><p id="6aa8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在我们的函数中，您可以指定用户需要填写多少字符。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="ce3e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我对这个脚本做了一些有趣的事情。</p><p id="7102" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将使用PHP生成一个图像，创建一个数组来存储生成的图像的随机背景颜色，然后我们将从数组中选择一个随机颜色。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="fb28" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们将使用函数<strong class="io hj">imagecolorhallocate()</strong>来分配图像的背景颜色，记住我们的数组索引。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="62bb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们需要使用函数image string()来绘制图像字符串。</p><p id="aafc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将传入参数；</p><ul class=""><li id="b89b" class="kn ko hi io b ip iq it iu ix kp jb kq jf kr jj ks kt ku kv bi translated">$image —生成的图像</li><li id="83ad" class="kn ko hi io b ip lr it ls ix lt jb lu jf lv jj ks kt ku kv bi translated">5-内置字体选择</li><li id="4816" class="kn ko hi io b ip lr it ls ix lt jb lu jf lv jj ks kt ku kv bi translated">50-左上角的x坐标</li><li id="c6cb" class="kn ko hi io b ip lr it ls ix lt jb lu jf lv jj ks kt ku kv bi translated">0 —左上角的y坐标(我们需要它居中)</li><li id="7b3d" class="kn ko hi io b ip lr it ls ix lt jb lu jf lv jj ks kt ku kv bi translated">$captcha_txt —验证码文本挑战</li><li id="cf21" class="kn ko hi io b ip lr it ls ix lt jb lu jf lv jj ks kt ku kv bi translated">$img_clr —验证码图像颜色</li></ul><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="11b9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我们需要为验证码文本设置一个到期时间，用验证码文本散列到期时间，然后将它存储在一个会话变量中。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="32ae" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，我们需要将使用<strong class="io hj"> imagestring() </strong>生成的图像字符串转换为png图像，然后通过销毁图像来释放与图像相关的内存。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="8b75" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">至此，我们完成了captcha_image文件。</p><p id="1d7e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们现在保存文件，并创建一个新的来验证我们的验证码。</p><h2 id="ce84" class="kw jl hi bd jm kx ky kz jq la lb lc ju ix ld le jy jb lf lg kc jf lh li kg lj bi translated">验证码_验证. php</h2><p id="1633" class="pw-post-body-paragraph im in hi io b ip lk ir is it ll iv iw ix lm iz ja jb ln jd je jf lo jh ji jj hb bi translated">我们将声明一个函数，它只接受一个参数，即用户输入<em class="lw"/>，然后将状态代码设置为返回值。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><h2 id="7dcd" class="kw jl hi bd jm kx ky kz jq la lb lc ju ix ld le jy jb lf lg kc jf lh li kg lj bi translated"><strong class="ak">第一步</strong></h2><p id="fa9a" class="pw-post-body-paragraph im in hi io b ip lk ir is it ll iv iw ix lm iz ja jb ln jd je jf lo jh ji jj hb bi translated">检查3个会话变量是否存在，然后将它们的值赋给我们的局部变量。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="a982" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">第二步</p><ul class=""><li id="86f6" class="kn ko hi io b ip iq it iu ix kp jb kq jf kr jj ks kt ku kv bi translated">我们将检查验证码是否仍然有效。</li><li id="e29d" class="kn ko hi io b ip lr it ls ix lt jb lu jf lv jj ks kt ku kv bi translated">重新散列用户输入MD5(＄input。$captcha_expire)。</li><li id="912d" class="kn ko hi io b ip lr it ls ix lt jb lu jf lv jj ks kt ku kv bi translated">然后把它和我们治疗中的进行比较。</li></ul><p id="4ba8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果匹配，我们将返回状态码200，这意味着我们的验证码验证成功。但是如果不匹配，我们将返回一个状态码400。</p><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="2cec" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在保存文件并创建一个索引页面，我们将在这里向用户显示我们的验证码</p><h2 id="1a67" class="kw jl hi bd jm kx ky kz jq la lb lc ju ix ld le jy jb lf lg kc jf lh li kg lj bi translated">Index.php</h2><p id="d858" class="pw-post-body-paragraph im in hi io b ip lk ir is it ll iv iw ix lm iz ja jb ln jd je jf lo jh ji jj hb bi translated">以下是我们将要做的事情</p><ul class=""><li id="5013" class="kn ko hi io b ip iq it iu ix kp jb kq jf kr jj ks kt ku kv bi translated">我们将创建一个图像标签，并将src设置为core/captcha_image.php。</li><li id="627a" class="kn ko hi io b ip lr it ls ix lt jb lu jf lv jj ks kt ku kv bi translated">我们将为用户创建一个表单，以填写他们看到的图像中的文本。</li><li id="0601" class="kn ko hi io b ip lr it ls ix lt jb lu jf lv jj ks kt ku kv bi translated">一旦用户点击提交按钮，我们将处理表单输入，然后向用户显示我们的验证结果</li></ul><figure class="kj kk kl km fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="fa40" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，让我们测试我们的脚本。</p><p id="3084" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我将提供两种不同的输入，并故意让验证码无人值守4分钟，以便我向您展示该功能是如何工作的。</p><ul class=""><li id="55ba" class="kn ko hi io b ip iq it iu ix kp jb kq jf kr jj ks kt ku kv bi translated">验证码挑战</li></ul><figure class="kj kk kl km fd ij er es paragraph-image"><div class="er es lx"><img src="../Images/512ceb01fd4a2d0d913b856656af63f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/0*Bu7Pbj7MGQEyxxws.png"/></div></figure><ul class=""><li id="cbf2" class="kn ko hi io b ip iq it iu ix kp jb kq jf kr jj ks kt ku kv bi translated">挑战失败</li></ul><figure class="kj kk kl km fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/ac8395fe832e71f90871e273619f092a.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/0*vl30k1ZJI6fOwRF2.png"/></div></figure><ul class=""><li id="d2cb" class="kn ko hi io b ip iq it iu ix kp jb kq jf kr jj ks kt ku kv bi translated">成功挑战</li></ul><figure class="kj kk kl km fd ij er es paragraph-image"><div class="er es lz"><img src="../Images/10ff183743b94e7efa59247a7cd50cfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/0*PvXYm7QIMaIDR_Uj.png"/></div></figure><ul class=""><li id="7f25" class="kn ko hi io b ip iq it iu ix kp jb kq jf kr jj ks kt ku kv bi translated">过期挑战</li></ul><figure class="kj kk kl km fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/c69494a6ee0a418839ff5c0e5dc68a2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/0*vb8Oo3YAIPt4FLC9.png"/></div></figure><h1 id="bc80" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">资产文件夹</h1><p id="e310" class="pw-post-body-paragraph im in hi io b ip lk ir is it ll iv iw ix lm iz ja jb ln jd je jf lo jh ji jj hb bi translated">我已经向你展示了我们需要的基本功能。然而，你可以扩展你的验证码脚本来自动切换图像，以防用户看不到当前图像。</p><p id="67bc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你也可以为你的验证码定义一些样式。</p><p id="b239" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">访问我的<a class="ae ma" href="https://github.com/Octagon-simon/PHP-Snippets/tree/main/Captcha" rel="noopener ugc nofollow" target="_blank"> GitHub Repo </a>来看看我是如何定制和设计我的。</p><p id="e444" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果有任何与这个脚本相关的东西我可以帮到你，请告诉我！</p><p id="05eb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">谢谢大家！</p></div></div>    
</body>
</html>