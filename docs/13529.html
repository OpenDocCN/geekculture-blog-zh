<html>
<head>
<title>How To Execute Python Modules From Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从Java执行Python模块</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-execute-python-modules-from-java-2384041a3d6d?source=collection_archive---------3-----------------------#2022-07-14">https://medium.com/geekculture/how-to-execute-python-modules-from-java-2384041a3d6d?source=collection_archive---------3-----------------------#2022-07-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/4c097b5cc872fcae878b36121e5a7fa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HeQhXbE4apHCvkiv0xaeoQ.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Photo by <a class="ae hv" href="https://www.peakpx.com/" rel="noopener ugc nofollow" target="_blank">Peakpx</a></figcaption></figure><h2 id="1d78" class="hw hx hy bd b fp hz ia ib ic id ie dx if translated" aria-label="kicker paragraph">逐步指南</h2><div class=""/><div class=""><h2 id="7cde" class="pw-subtitle-paragraph je ih hy bd b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv dx translated">本教程基于macOSX，带有用于Python 3.8/3.9和Java 11的M1芯片</h2></div><h1 id="3d32" class="jw jx hy bd jy jz ka kb kc kd ke kf kg jn kh jo ki jq kj jr kk jt kl ju km kn bi translated"><strong class="ak">介绍。</strong></h1><p id="9fcc" class="pw-post-body-paragraph ko kp hy kq b kr ks ji kt ku kv jl kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">根据我的实践，我遇到的最后一个案例是当基础应用程序引擎是Java时的任务，我应该添加一个新的机器学习功能。这里的关键挑战是ML特性在Python中。</p><p id="1e1c" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">那我们要做什么？我们对这项任务应用什么样的解决方案？一个可行的解决方案是在docker中运行这个服务。或者我们可以找到另一个更有效的产品友好型解决方案:通过<strong class="kq ii"> Jep库(Java Embedded python)直接从Java代码中执行Python代码。</strong></p><h1 id="6d44" class="jw jx hy bd jy jz ka kb kc kd ke kf kg jn kh jo ki jq kj jr kk jt kl ju km kn bi translated"><strong class="ak"> <em class="lp">什么是JEP图书馆——一个</em> </strong>纯粹的巫毒教本身。</h1><p id="d98a" class="pw-post-body-paragraph ko kp hy kq b kr ks ji kt ku kv jl kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">下面是他们在GitHub上常见问题的一些引文:</p><blockquote class="lq lr ls"><p id="65e3" class="ko kp lt kq b kr lk ji kt ku ll jl kw lu lm kz la lv ln ld le lw lo lh li lj hb bi translated">Jep使用JNI和CPython API在JVM中启动Python解释器。当您在Java中创建一个解释器实例时，将为该Java解释器实例创建一个Python解释器，它将保留在内存中，直到用<code class="du lx ly lz ma b">Interpreter.close().</code>关闭该解释器实例</p><p id="91d6" class="ko kp lt kq b kr lk ji kt ku ll jl kw lu lm kz la lv ln ld le lw lo lh li lj hb bi translated">由于需要管理一致的Python线程状态，创建解释器实例的线程必须在对该解释器实例的所有方法调用中重用。</p></blockquote><p id="ffb6" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">这里有一个关于Python模块执行的引用:</p><blockquote class="lq lr ls"><p id="1eaf" class="ko kp lt kq b kr lk ji kt ku ll jl kw lu lm kz la lv ln ld le lw lo lh li lj hb bi translated">Jep应该与任何纯Python模块一起工作。它可以与各种CPython扩展一起工作。开发人员报告说，Jep可以与NumPy、Scipy、Pandas、TensorFlow、Matplotlib、cvxpy等等一起工作。</p></blockquote><p id="c1c9" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">速度性能是一个至关重要指标，尤其是当您的应用程序处理大数据时。我的研究中的测试表明，使用JEP几乎是纯粹的python执行。</p><h1 id="3956" class="jw jx hy bd jy jz ka kb kc kd ke kf kg jn kh jo ki jq kj jr kk jt kl ju km kn bi translated">如何为您的项目设置JEP。</h1><p id="f9ef" class="pw-post-body-paragraph ko kp hy kq b kr ks ji kt ku kv jl kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">假设你的系统中有Java (Maven)和Python。<strong class="kq ii"> <em class="lt">在Java </em> </strong>项目中，在<code class="du lx ly lz ma b"><em class="lt">pom.xml</em></code> <em class="lt"> </em>文件中，你设置了一个依赖关系:</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">The pom.xml dependency for running Python from Java</figcaption></figure><p id="36c7" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">在项目终端中运行:</p><pre class="mb mc md me fd mh ma mi mj aw mk bi"><span id="1328" class="ml jx hy ma b fi mm mn l mo mp">mvn clean install</span><span id="2b19" class="ml jx hy ma b fi mq mn l mo mp">or</span><span id="dcd2" class="ml jx hy ma b fi mq mn l mo mp">mvn clean install <!-- -->-DskipTests</span></pre><p id="07da" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">你在Java里安装了JEP！</p><p id="eba7" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">要在Python中安装JEP <strong class="kq ii"> <em class="lt">，运行</em> </strong>:</p><pre class="mb mc md me fd mh ma mi mj aw mk bi"><span id="9161" class="ml jx hy ma b fi mm mn l mo mp">pip install jep </span></pre><p id="cda4" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">此命令安装最新的JEP版本。如果需要，您可以指定特定的JEP版本。在我的例子中，我使用JEP 4.0.3版本。</p><p id="b36b" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">这里的版本不兼容性很大。Python版本和Jep库版本越低，使用的java语法就越复杂(反之亦然)。但是最新的JEP版本可以很容易地执行JEP旧版本的语法。</p><p id="2c88" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">在您的系统中，必须设置一个环境变量。对于macOSX，它将像在终端中运行一样:</p><pre class="mb mc md me fd mh ma mi mj aw mk bi"><span id="d01b" class="ml jx hy ma b fi mm mn l mo mp">export DYLD_LIBRARY_PATH="&lt;your_user&gt;/myenv/lib/python3.8/site-packages/jep"$DYLD_LIBRARY_PATH</span></pre><p id="17f1" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">不要忘记在你的<code class="du lx ly lz ma b"><em class="lt">~/.zshrc</em></code>文件中添加相同的一行！JEP正在寻找macOS上的<code class="du lx ly lz ma b"><em class="lt">libjep.jnilib</em></code>文件和Linux上的<code class="du lx ly lz ma b"><em class="lt">libjep.so</em></code> <em class="lt"> </em>文件<em class="lt"> </em>。</p><p id="17d3" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">此外，对于Linux系统，它将是一个不同的环境变量名称:</p><pre class="mb mc md me fd mh ma mi mj aw mk bi"><span id="f98e" class="ml jx hy ma b fi mm mn l mo mp">export LD_LIBRARY_PATH="&lt;your_user_path&gt;/myenv/lib/python3.8/site-packages/jep"$LD_LIBRARY_PATH</span></pre><p id="0588" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">你建立了JEP图书馆。现在可以直接从Java执行Python了。</p><h1 id="db98" class="jw jx hy bd jy jz ka kb kc kd ke kf kg jn kh jo ki jq kj jr kk jt kl ju km kn bi translated">Python 3.8 macOSX M1芯片的语法。</h1><p id="3b45" class="pw-post-body-paragraph ko kp hy kq b kr ks ji kt ku kv jl kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">首先，我们应该定义JEP库路径(特别是Java将搜索Python执行的位置)并初始化MainInterpreter对象:</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">Example of how to set up a Python Path for Jep library in Java</figcaption></figure><p id="3f56" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">第二步—设置JEP配置(我们应该添加Python库来操作和我们的项目文件夹)。然后，创建一个SharedInterpreter对象。SharedInterpreter将直接执行python代码或python执行文档:</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">Example of how to set up the Jep configurations and to create a SharedInterpreter for Python execution</figcaption></figure><p id="7136" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">我有一个带有两个简单函数的python文档来检查JEP的工作。一个函数应该使用本地Python库来搜索目录中的特定文档。第二个函数调用更复杂的Python库Spacy。在Jep运行之前，确保在Python中安装了包含下载模型的Spacy库:</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">Example of simple Python functions for Jep check</figcaption></figure><p id="10b7" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">现在，让我们从Java运行Python文档函数:</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">Example of function run from the python_functions.py document (python 3.8)</figcaption></figure><p id="77cb" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">输出是:</p><pre class="mb mc md me fd mh ma mi mj aw mk bi"><span id="d931" class="ml jx hy ma b fi mm mn l mo mp">&gt;&gt;&gt; [Apple, Apple, PROPN, NNP, nsubj, Xxxxx, true, false]<br/>&gt;&gt;&gt; [is, be, AUX, VBZ, aux, xx, true, true]<br/>&gt;&gt;&gt; [looking, look, VERB, VBG, ROOT, xxxx, true, false]<br/>&gt;&gt;&gt; [at, at, ADP, IN, prep, xx, true, true]<br/>&gt;&gt;&gt; [buying, buy, VERB, VBG, pcomp, xxxx, true, false]<br/>&gt;&gt;&gt; [U.K., U.K., PROPN, NNP, dobj, X.X., false, false]<br/>&gt;&gt;&gt; [startup, startup, VERB, VBD, dep, xxxx, true, false]<br/>&gt;&gt;&gt; [for, for, ADP, IN, prep, xxx, true, true]<br/>&gt;&gt;&gt; [$, $, SYM, $, quantmod, $, false, false]<br/>&gt;&gt;&gt; [1, 1, NUM, CD, compound, d, false, false]<br/>&gt;&gt;&gt; [billion, billion, NUM, CD, pobj, xxxx, true, false]</span></pre><p id="ae8f" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">这太棒了。我们可以直接从Java调用和执行Python！但是等等，我在文章开头提到的其他Python版本的语法呢？</p><h1 id="9257" class="jw jx hy bd jy jz ka kb kc kd ke kf kg jn kh jo ki jq kj jr kk jt kl ju km kn bi translated">Python 3.9 macOSX M1芯片的语法。</h1><p id="803f" class="pw-post-body-paragraph ko kp hy kq b kr ks ji kt ku kv jl kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">我在更高的Python和Jep版本之前说过，Java中更简单的语法。之所以如此，是因为在Python 3.9+版本的最新Jep版本中，JEP开发者在你做“pip install jep”时，增加了对Python路径的自动搜索。下面来看看语法！</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">Example of how to set the path for jep and create the SubInterpreter for executing python3.9</figcaption></figure><p id="ce23" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">四行代码，我们就有了一个Java的python3.9解释器！现在，您将看到如何从已经看过的文档中运行Python函数。</p><figure class="mb mc md me fd hk"><div class="bz dy l di"><div class="mf mg l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">Example of how to run python3.9 functions from Java Jep</figcaption></figure><p id="bd6f" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">打印输出将与Python 3.8版本相同。那都是乡亲们！！</p><h1 id="48ee" class="jw jx hy bd jy jz ka kb kc kd ke kf kg jn kh jo ki jq kj jr kk jt kl ju km kn bi translated">结论。</h1><p id="7106" class="pw-post-body-paragraph ko kp hy kq b kr ks ji kt ku kv jl kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">在本教程中，您了解了如何从Python 3.8和Python 3.9版本的任何Java应用程序中执行Python代码。</p><p id="6b92" class="pw-post-body-paragraph ko kp hy kq b kr lk ji kt ku ll jl kw kx lm kz la lb ln ld le lf lo lh li lj hb bi translated">文章中的所有代码示例都可以在macOSX M1芯片和Linux上运行。您只需要为每个系统正确设置Jep库。</p><h1 id="b011" class="jw jx hy bd jy jz ka kb kc kd ke kf kg jn kh jo ki jq kj jr kk jt kl ju km kn bi translated">来源。</h1><ol class=""><li id="cfb0" class="mr ms hy kq b kr ks ku kv kx mt lb mu lf mv lj mw mx my mz bi translated"><a class="ae hv" href="https://github.com/ninia/jep" rel="noopener ugc nofollow" target="_blank"> Jep库GitHub </a></li><li id="ee3d" class="mr ms hy kq b kr na ku nb kx nc lb nd lf ne lj mw mx my mz bi translated"><a class="ae hv" href="https://github.com/Galina-Blokh/jep-java-python" rel="noopener ugc nofollow" target="_blank">我的GitHub项目及代码示例</a></li></ol></div></div>    
</body>
</html>