<html>
<head>
<title>The Darker Side of NPM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NPM的阴暗面</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/the-darker-side-of-npm-42dedfe41aa4?source=collection_archive---------52-----------------------#2021-08-03">https://medium.com/geekculture/the-darker-side-of-npm-42dedfe41aa4?source=collection_archive---------52-----------------------#2021-08-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="1f32" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated"><strong class="ak"> NPM软件包从你的Windows机器上窃取密码！</strong></h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/407515c1fd0aa24be84c5554cd3a4ab5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tz221UFdLcue4eyQzpEpyQ.jpeg"/></div></div></figure><h2 id="d18a" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">真实的丑闻！</strong></h2><p id="317f" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">在最近的一系列事件中，<strong class="kj hj">节点包管理器</strong> (npm)已经成为数字世界的威胁。发布到npm上的代码被发现<strong class="kj hj">通过<strong class="kj hj">谷歌Chrome </strong>中安全合法的账户恢复工具窃取了用户的</strong>密码。</p><p id="1e12" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">经过调查，发现有两个恶意的npm软件包窃取了存储在Chrome中的密码。这种恶意软件是多功能的，即它可以监听攻击者服务器的命令，也可以滥用受感染系统的隐私。它可以从受害者的相机和麦克风记录和上传文件，也可以播放PowerShell命令。</p><p id="7d74" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">在这篇文章中，我们将尝试分析黑暗网络开发者是如何设法滥用Chrome和npm的安全性，并能够将恶意软件添加到用户的本地机器中的。</p><blockquote class="lf lg lh"><p id="c8c3" class="kh ki li kj b kk la ij km kn lb im kp lj lc kr ks lk ld ku kv ll le kx ky kz hb bi translated">什么是Npm？</p><p id="da20" class="kh ki li kj b kk la ij km kn lb im kp lj lc kr ks lk ld ku kv ll le kx ky kz hb bi translated">这是怎么曝光的？</p><p id="c185" class="kh ki li kj b kk la ij km kn lb im kp lj lc kr ks lk ld ku kv ll le kx ky kz hb bi translated">chrunlee如何设法滥用chrome的安全工具？</p><p id="c8d3" class="kh ki li kj b kk la ij km kn lb im kp lj lc kr ks lk ld ku kv ll le kx ky kz hb bi translated">获得对持续npm配置的控制</p><p id="2418" class="kh ki li kj b kk la ij km kn lb im kp lj lc kr ks lk ld ku kv ll le kx ky kz hb bi translated">开发者陷入了自己的陷阱。</p><p id="242f" class="kh ki li kj b kk la ij km kn lb im kp lj lc kr ks lk ld ku kv ll le kx ky kz hb bi translated">npm是第一次面对这个吗？</p><p id="67de" class="kh ki li kj b kk la ij km kn lb im kp lj lc kr ks lk ld ku kv ll le kx ky kz hb bi translated">结论</p></blockquote><h2 id="39c4" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">什么是NPM？</strong></h2><p id="e3e5" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated"><strong class="kj hj"> NPM </strong>被认为是<strong class="kj hj"> Node.js </strong>运行时环境的默认包管理器，类似于GitHub的包管理器。它在<strong class="kj hj"> JavaScript </strong>包的供应和管理中起着关键作用。它拥有超过150万个独特的JS包，并在24小时内管理超过10亿个JS请求。</p><p id="41fb" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">这个威胁是如何暴露的？一个拥有超过120亿用户的存储库是如何感染这种恶意软件的？它是如何被忽视超过6个月的？</p><p id="11ef" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">这些问题的答案就藏在windows.exe的档案里，这些档案是由<strong class="kj hj">翻转实验室</strong>的研究人员在名为<code class="du lm ln lo lp b">nodejs_net_server</code>和<code class="du lm ln lo lp b">temptesttempfile</code>的包裹里找到的。</p><p id="7de6" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">有趣的是。exe文件被命名为<code class="du lm ln lo lp b">Win32.Infostealer.Heuristics</code>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lq"><img src="../Images/bd92a1e873b45c8dc4a3fc77e8d7d844.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rdZHbsB-Di-PXuzLcCKltw.png"/></div></div></figure><h2 id="fcf4" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">这件事是怎么曝光的？</h2><p id="f04f" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated"><code class="du lm ln lo lp b">nodejs_net_server</code>的总下载量超过1.3千次，<code class="du lm ln lo lp b">temptesttempfile </code>的总下载量超过800次。这个恶意软件可疑地被<strong class="kj hj"> ReversingLabs </strong>平台静态分析引擎捕获，该引擎基于<a class="ae lr" rel="noopener" href="/@randylaosat/a-beginners-guide-to-machine-learning-dfadc19f6caf">机器学习</a>算法工作。</p><p id="bce0" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">大约6个月前，GitHub上一位名叫<em class="li"> chrunlee的活跃开发者对<code class="du lm ln lo lp b">nodejs_net_server</code>进行了更新。</em>通过静态分析，研究人员发现，<code class="du lm ln lo lp b">Win32.Infostealer.Heuristics</code>原本是一个<strong class="kj hj">单字母。exe </strong>文件，通常是单个字母。exe文件对威胁猎人来说是一个危险信号。</p><p id="6cbf" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">进一步深挖，发现exe竟然是<strong class="kj hj"> ChromePass </strong>，一个合法的密码恢复工具。</p><h2 id="dcae" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">chrun lee如何设法滥用chrome的安全工具？</strong></h2><p id="180f" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated"><em class="li"> Chrunlee </em>成功发布并缓冲了带有<strong class="kj hj"> 12个版本</strong> &amp;的包，在最终版本中他成功插入了一个<strong class="kj hj">脚本</strong>，用于在开发者托管网站时下载密码窃取器。该脚本启用了<strong class="kj hj">TeamViewer.exe</strong>的使用，这当然允许攻击者在用户不注意的情况下访问用户的信息，并且这也失去了恶意软件和网站之间的链接，以保持恶意软件不被不同的云网络安全注意到。Chrunlee于2020年4月开始在不同版本的软件包中测试他的软件，并于2020年12月发布了密码窃取脚本。</p><p id="26fe" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">进入<em class="li"> chrunlee的</em>第二个包，即<code class="du lm ln lo lp b">temptesttempfile</code>，给研究人员带来了各种问题，因为主页readme和GitHub存储库链接都被重定向到<strong class="kj hj">不存在的网页</strong>。</p><p id="37d7" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">这个包中的一个文件test.js实现了与<code class="du lm ln lo lp b">nodejs_net_server</code>中相同的远程<strong class="kj hj"> shell功能</strong>，但是这个包没有执行任何类型的劫持，而且还缺少一个持久性机制，这使得格言可疑且不清楚。</p><h2 id="b2c6" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">获得对持续npm配置的控制</strong></h2><p id="e4fb" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">Npm包依靠像<strong class="kj hj">域名仿冒</strong>和<strong class="kj hj">依赖混淆</strong>这样的方法来捕捉包管理器内部的恶意活动。</p><p id="07c7" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">然而，据<strong class="kj hj">反转实验室</strong>的研究人员称，两个包中都没有发现<strong class="kj hj">仿冒</strong>，这仍然是一个困惑，<em class="li"> chrunlee </em>是如何吸引人们安装这个包的。</p><p id="a863" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">有趣的是，人们发现每当开发者安装<code class="du lm ln lo lp b">nodejs_net_server</code>软件包时，恶意软件就会试图通过滥用<code class="du lm ln lo lp b">bin</code>选项来访问本地机器。</p><p id="3815" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated"><code class="du lm ln lo lp b">bin</code>选项存在于<code class="du lm ln lo lp b">package.json</code>文件中，它旨在通过著名的<code class="du lm ln lo lp b">jstest</code>包感染和断言访问。</p><p id="af77" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">根据统计数据，<code class="du lm ln lo lp b">jstest</code>是下载量最大的JavaScript测试框架之一，这使得它肯定会出现在大多数<strong class="kj hj"> NodeJS </strong>开发者中。</p><p id="1a5a" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">恶意软件并不完全依赖于<code class="du lm ln lo lp b">jstest</code>的存在才能发挥作用，但它的存在通过提供持久性来简化感染过程。</p><p id="5e58" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated"><em class="li"> Chrunlee </em>设法<strong class="kj hj">自动化</strong>软件包中的<code class="du lm ln lo lp b">jstest</code>命令，这两种方式都为恶意软件提供了持久性，并且它还执行后门功能。</p><p id="a62a" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">默认情况下，恶意软件执行的命令会覆盖现有的<code class="du lm ln lo lp b">jstest</code>文件，并添加一个<code class="du lm ln lo lp b">test.js</code>文件，为恶意软件访问<strong class="kj hj"> windows </strong>机器提供持久性。</p><p id="b228" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">这项新增的<code class="du lm ln lo lp b">test.js</code>服务开放了<strong class="kj hj"> <em class="li">端口7353 </em> </strong>，允许执行各种监控活动和访问用户数据:</p><ul class=""><li id="8a6b" class="ls lt hi kj b kk la kn lb ju lu jy lv kc lw kz lx ly lz ma bi translated">反转主机和端口配置</li><li id="0daa" class="ls lt hi kj b kk mb kn mc ju md jy me kc mf kz lx ly lz ma bi translated">文件上传和搜索</li><li id="1fb9" class="ls lt hi kj b kk mb kn mc ju md jy me kc mf kz lx ly lz ma bi translated">目录内容列表</li><li id="b820" class="ls lt hi kj b kk mb kn mc ju md jy me kc mf kz lx ly lz ma bi translated">shell命令执行</li><li id="0b39" class="ls lt hi kj b kk mb kn mc ju md jy me kc mf kz lx ly lz ma bi translated">屏幕和摄像机访问和录制</li><li id="48a9" class="ls lt hi kj b kk mb kn mc ju md jy me kc mf kz lx ly lz ma bi translated">通过ChromePass恢复实用工具窃取密码</li></ul><p id="1c8d" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated"><strong class="kj hj">唷</strong>！为什么我们现在使用我们的Windows机器？</p><p id="38ba" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">劫机者可以接触到任何东西。这听起来很危险。希望您安全地浏览和开发。</p><p id="e589" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">根据研究人员的说法，只有<code class="du lm ln lo lp b">nodejs_net_server</code>是可以为劫机者提供多重访问的包，而<code class="du lm ln lo lp b">temptesttempfile</code>只能为劫机者提供<strong class="kj hj">外壳命令</strong>访问。</p><h2 id="ceae" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">开发者陷入了自己的陷阱。</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mg"><img src="../Images/35ea6a36b6054ffe65d5dc9e24dd34e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-1GnMzpVuOVwSDI2Acrf2w.jpeg"/></div></div></figure><p id="92fd" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">在调查这一事件的过程中出现了一个有趣的事件，即在早期版本中，chrunlee泄露了他自己计算机的凭证。</p><p id="758c" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">在测试恶意软件时，<strong class="kj hj"> ChromePass </strong>实用程序打开了<em class="li"> chrunlee的</em>个人密码，超过250个登录凭证存储在存储库中的一个. txt文件中，该文件被命名为<strong class="kj hj">a.exe</strong>。</p><p id="b756" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">有趣的是，研究人员还发现<em class="li"> chrunlee </em>从不关心密码策略实践，而是使用蹩脚而常见的密码，如1234。</p><p id="eabe" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">就这样，<em class="li"> chrunlee </em>自己掉进了自己的陷阱，公开发布了自己的个人怪异密码。</p><h2 id="6b5d" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">NPM是第一次面临这种情况吗？</strong></h2><p id="f712" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">不，这不是恶意软件第一次进入npm，</p><ul class=""><li id="8d37" class="ls lt hi kj b kk la kn lb ju lu jy lv kc lw kz lx ly lz ma bi translated">2021年初，三个恶意软件包被发布到<strong class="kj hj"> npm </strong>上，它们能够从<strong class="kj hj"> Discord </strong>用户那里窃取令牌和信息。</li><li id="e25b" class="ls lt hi kj b kk mb kn mc ju md jy me kc mf kz lx ly lz ma bi translated">2018年11月，发现了一个恶意包，该包基本上是著名包<code class="du lm ln lo lp b">event-stream</code>3 . 3 . 6版本的依赖。这个名为<code class="du lm ln lo lp b">flatmap-stream</code>的恶意软件包包含一个加密的有效载荷，旨在从<strong class="kj hj"> Copay </strong>应用程序中窃取<strong class="kj hj">比特币</strong>。</li></ul><h2 id="8f32" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">结论</strong></h2><p id="dd6c" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">经过内部调查后，国家预防机制安全部门已经从国家预防机制手中拿走了这两个包。</p><p id="1599" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">随着近来技术劫持数量的增加，维持和依赖我们安装在本地机器上的第三方包变得非常困难。</p><p id="a7f7" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">发生在<strong class="kj hj">公共存储库</strong>上的攻击数量正在迅速增加，而安全实验室正在尽最大努力保持存储库中的清洁，但作为一个负责任的开发者，我们应该在使用第三方包之前弄清楚它。</p><p id="5b09" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">编码快乐！安全编码！</p><p id="335e" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">如果你喜欢我的博客，那么你可以支持我</p><figure class="iy iz ja jb fd jc er es paragraph-image"><a href="https://www.buymeacoffee.com/ddevm"><div class="er es mh"><img src="../Images/6e17c6a950057c9c9bd6c9393f007367.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*oH9GvFemA4J2dDcHJPpz3g.png"/></div></a></figure></div></div>    
</body>
</html>