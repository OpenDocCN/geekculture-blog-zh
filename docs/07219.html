<html>
<head>
<title>Using log4net in Your Azure App Service Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Azure应用服务应用中使用log4net</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/using-log4net-in-your-azure-app-service-applications-faeb5de7809c?source=collection_archive---------5-----------------------#2021-09-12">https://medium.com/geekculture/using-log4net-in-your-azure-app-service-applications-faeb5de7809c?source=collection_archive---------5-----------------------#2021-09-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3138" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将配置我们的<a class="ae jd" href="https://logging.apache.org/log4net/" rel="noopener ugc nofollow" target="_blank"> log4net </a>来将我们的日志写到<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/app-service/resources-kudu#:~:text=Kudu%20is%20the%20engine%20behind,like%20Dropbox%20and%20OneDrive%20sync." rel="noopener ugc nofollow" target="_blank"> Kudu </a>，这样我们就可以随时消化它们。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/4b67cc8cf455e0e39c315288a0bc45f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dflQAXx4le6MmikBIeI8vQ.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Image by <a class="ae jd" href="https://unsplash.com/@hudsonhintze" rel="noopener ugc nofollow" target="_blank">hudsonhintze </a>on <a class="ae jd" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="731d" class="kb kc hi bd kd ke kf kg kh ki kj kk kl iq km kn ko iu kp kq kr iy ks kt ku kv bi translated">log4net是什么？</h2><p id="3b63" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">log4net是一个日志记录工具。NET应用程序，基于Java流行的<a class="ae jd" href="https://logging.apache.org/log4j/2.x/" rel="noopener ugc nofollow" target="_blank"> log4j </a>。下面是Apache对它的描述:</p><blockquote class="lb lc ld"><p id="6f49" class="if ig le ih b ii ij ik il im in io ip lf ir is it lg iv iw ix lh iz ja jb jc hb bi translated">Apache log4net库是一个帮助程序员将日志语句输出到各种输出目标的工具。log4net是优秀的Apache log4j框架到微软的一个移植。NET运行时。我们保留了与原始log4j精神上相似的框架，同时利用了。NET运行时。有关log4net的更多信息，请参见<a class="ae jd" href="https://logging.apache.org/log4net/release/features.html" rel="noopener ugc nofollow" target="_blank">功能</a>文档。</p></blockquote><p id="c463" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">探索这个工具的强大特性超出了本文的范围，您唯一需要知道的是<strong class="ih hj"> log4net </strong>允许我们以高度可定制的方式编写应用程序日志。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="278c" class="kb kc hi bd kd ke kf kg kh ki kj kk kl iq km kn ko iu kp kq kr iy ks kt ku kv bi translated">在ASP中设置log4net。网</h2><p id="f29d" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">使用NuGet添加Log4Net插件</p><pre class="jf jg jh ji fd li lj lk ll aw lm bi"><span id="034d" class="kb kc hi lj b fi ln lo l lp lq">PM&gt; Install-Package log4net -Version 2.0.12</span></pre><p id="0b24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，为了将Log4net配置为我们的ASP.NET核心应用程序上的Microsoft扩展日志处理程序，我们需要安装以下扩展:</p><pre class="jf jg jh ji fd li lj lk ll aw lm bi"><span id="7921" class="kb kc hi lj b fi ln lo l lp lq">PM&gt; Install-Package Microsoft.Extensions.Logging.Log4Net.AspNetCore -Version 5.0.3</span></pre><p id="cfe9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在项目的根级别，创建包含以下内容的<code class="du lr ls lt lj b">log4net.config</code>文件:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lu lv l"/></div><figcaption class="jq jr et er es js jt bd b be z dx">log4net.config</figcaption></figure><p id="a32f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们解释一下Kudu日志的相关部分:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lu lv l"/></div><figcaption class="jq jr et er es js jt bd b be z dx">logfile appender section</figcaption></figure><p id="8e63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简而言之，appender是负责将日志消息发送到某个目的地的部分。在我们的案例中，我们希望将日志发送到</p><pre class="jf jg jh ji fd li lj lk ll aw lm bi"><span id="be48" class="kb kc hi lj b fi ln lo l lp lq">D:\Home\LogFiles\Log4Net\application.log</span></pre><p id="0a53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如<a class="ae jd" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/logging/?view=aspnetcore-5.0" rel="noopener ugc nofollow" target="_blank">登录中所述。NET Core和ASP.NET Core</a>，日志文件的默认位置在<strong class="ih hj">D:\ home \ log files \ Application</strong>文件夹中。在我们的例子中，我们引入了一个额外的文件夹Log4Net(我们需要在Kudu中创建它)，我们的日志将驻留在这个文件夹中。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="8fb5" class="kb kc hi bd kd ke kf kg kh ki kj kk kl iq km kn ko iu kp kq kr iy ks kt ku kv bi translated">在应用程序中配置log4net</h2><p id="5e28" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">在配置日志的最后一部分，我们需要将以下内容添加到<code class="du lr ls lt lj b">Program.cs</code>:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lu lv l"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Program.cs</figcaption></figure><p id="7fc7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅此而已！让我们在应用程序中添加一些日志:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lu lv l"/></div><figcaption class="jq jr et er es js jt bd b be z dx">SomeApplication.cs</figcaption></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="55f0" class="kb kc hi bd kd ke kf kg kh ki kj kk kl iq km kn ko iu kp kq kr iy ks kt ku kv bi translated">访问应用服务中的日志</h2><p id="ce6e" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">正如我们之前提到的，我们应该创建<strong class="ih hj"> Log4Net </strong>文件夹。导航到Kudu控制台:</p><p id="5ade" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> https:// &lt;你的应用名称&gt;. SCM . azure websites . net/debug console</strong></p><p id="8c3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并创建一个新文件夹，如下图所示:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lw"><img src="../Images/77e6fd621f10c7def9289ba00ecbc19b.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*G-MEJJoag3vYcqRErO4A8A.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Creating the Log4Net folder</figcaption></figure><p id="6d9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，发布您的应用程序，触发代码，您应该会看到新创建的日志文件<strong class="ih hj"> application.log </strong>，其中有行“Hello user”。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h2 id="d58a" class="kb kc hi bd kd ke kf kg kh ki kj kk kl iq km kn ko iu kp kq kr iy ks kt ku kv bi translated">摘要</h2><p id="4780" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">如果您的应用程序已经配置为使用log4net，并且您正在迁移到Azure app service，您可以保留该库，只需添加一个appender，这样您的日志就可以在app service本身中查看，而无需更改日志库。</p><p id="045b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">延伸阅读:</p><ul class=""><li id="6721" class="lx ly hi ih b ii ij im in iq lz iu ma iy mb jc mc md me mf bi translated"><a class="ae jd" href="https://docs.microsoft.com/en-us/azure/app-service/troubleshoot-diagnostic-logs" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/app-service/troubleshoot-diagnostic-logs</a></li><li id="0799" class="lx ly hi ih b ii mg im mh iq mi iu mj iy mk jc mc md me mf bi translated"><a class="ae jd" href="https://docs.microsoft.com/en-us/azure/app-service/resources-kudu" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/app-service/resources-kudu</a></li><li id="5267" class="lx ly hi ih b ii mg im mh iq mi iu mj iy mk jc mc md me mf bi translated"><a class="ae jd" href="https://logging.apache.org/log4net/" rel="noopener ugc nofollow" target="_blank">https://logging.apache.org/log4net/</a></li><li id="13bb" class="lx ly hi ih b ii mg im mh iq mi iu mj iy mk jc mc md me mf bi translated"><a class="ae jd" href="https://dotnetthoughts.net/how-to-use-log4net-with-aspnetcore-for-logging/" rel="noopener ugc nofollow" target="_blank">https://dotnetthoughts . net/how-to-use-log 4 net-with-aspnetcore-for-logging/</a></li></ul></div></div>    
</body>
</html>