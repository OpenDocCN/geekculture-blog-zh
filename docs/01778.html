<html>
<head>
<title>Predicting Churn Using User Event Logs — Capstone Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用用户事件日志预测流失—顶点项目</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/predicting-churn-using-user-event-logs-capstone-project-df27fd825009?source=collection_archive---------11-----------------------#2021-04-23">https://medium.com/geekculture/predicting-churn-using-user-event-logs-capstone-project-df27fd825009?source=collection_archive---------11-----------------------#2021-04-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c7de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用PySpark为一个名为“Sparkify”的虚构音乐流媒体服务解决了一个现实世界的业务问题</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/4dd2b7e1a23879785c790ccebf5c2791.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*pEKplbQ_Ca5sTvss2Mcbsg.png"/></div></figure><h1 id="ffc9" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated"><strong class="ak">简介</strong></h1><p id="d6f4" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">这篇文章是关于我作为Udacity数据科学家Nanodegree的一部分进行的capstone项目的讨论。这个项目是一个了解大数据和使用PySpark处理大数据的机会。</p><p id="7d96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该项目的数据集由Udacity与Insight Data Science合作提供。它包含由服务Sparkify的用户生成的事件日志数据。</p><p id="0699" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像大多数基于订阅的商业模式一样，Sparkify的主要收入来源是用户订阅费和向免费用户提供的广告。因此，完全停止使用该服务的用户会影响公司的底线。</p><p id="7040" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个项目的目的是进行分析，并建立一个模型，可以利用手头的数据将用户分类为有搅动风险的用户。</p><h1 id="b905" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated"><strong class="ak">预测客户流失有什么帮助？</strong></h1><p id="c4ba" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">Sparkify用户分为两类。那些每月付费的网站和那些免费使用该服务但作为回报的网站会收到广告。通过这种方式，Sparkify可以从每个用户那里获得收入，即以费用或广告商的形式。因此，Sparkify增长的唯一途径要么是获得新用户，要么是留住现有用户。</p><p id="4445" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇<a class="ae ko" href="https://devblogs.microsoft.com/cse/2019/01/10/develop-and-deploy-a-hybrid-multi-input-churn-prediction-model-with-azure-machine-learning-services/" rel="noopener ugc nofollow" target="_blank">文章</a>很好地定义了客户流失，</p><blockquote class="kp kq kr"><p id="5b7c" class="if ig ks ih b ii ij ik il im in io ip kt ir is it ku iv iw ix kv iz ja jb jc hb bi translated">对于订阅服务业务来说，有两种方法可以推动增长:增加新客户的数量，或者通过留住更多的客户来增加现有客户的终身价值。提高客户保留率需要能够预测哪些用户可能会取消预订(称为<em class="hi">流失</em>)，并在适当的时间提供适当的保留优惠。</p></blockquote><p id="020b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">客户流失是衡量企业生死存亡的标准。这在<a class="ae ko" href="https://www.profitwell.com/customer-churn/analysis#:~:text=Churn%20leads%20to%20higher%20CAC,required%20to%20acquire%20a%20customer.&amp;text=The%20more%20customers%20you%20churn,business%20by%20finding%20new%20ones." rel="noopener ugc nofollow" target="_blank">这里</a>有很好的阐述，</p><blockquote class="kp kq kr"><p id="ecc3" class="if ig ks ih b ii ij ik il im in io ip kt ir is it ku iv iw ix kv iz ja jb jc hb bi translated">流失导致更高的CAC和减少的收入</p><p id="20f9" class="if ig ks ih b ii ij ik il im in io ip kt ir is it ku iv iw ix kv iz ja jb jc hb bi translated">客户获取成本(CAC)是获取客户所需的销售和营销总成本。</p><p id="03b5" class="if ig ks ih b ii ij ik il im in io ip kt ir is it ku iv iw ix kv iz ja jb jc hb bi translated">不管你的营销策略有多强，你培养潜在客户的方法有多有效，每个客户都需要花钱去获得。事实上，获得新客户比维护和升级现有客户关系要昂贵得多。你流失的客户越多，你就必须花更多的钱通过寻找新客户来弥补业务损失。</p><p id="0999" class="if ig ks ih b ii ij ik il im in io ip kt ir is it ku iv iw ix kv iz ja jb jc hb bi translated">CAC吞噬了基本收入，从根本上阻碍了财务增长——你可以保持它越低越好，你可以通过积极对抗流失来保持CAC较低。</p></blockquote><p id="c7f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在它发生之前预测它对任何企业的长期成功都是不可或缺的。通过分析客户流失，企业可以采取措施尽可能地防止客户流失。这些措施可以是提供免费订阅扩展、提供折扣等等。</p><h1 id="1234" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">游戏计划</h1><p id="f126" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">预测用户流失需要了解与非流失者相比流失者的用户行为模式和用户状态。</p><p id="b647" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用户事件日志是理解这些模式的表格数据的重要来源。因此，我们预测客户流失的策略如下:</p><ul class=""><li id="f52b" class="kw kx hi ih b ii ij im in iq ky iu kz iy la jc lb lc ld le bi translated">使用事件日志了解一般数据</li><li id="7b3b" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">识别任何损坏或丢失的数据，并决定如何处理它们</li><li id="20c9" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">基于所述数据将用户识别为搅动者或非搅动者</li><li id="c800" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">比较两组的几个特征</li><li id="2423" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">使用这些特征将数据转换成一组ML模型友好的数字矩阵</li><li id="c757" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">基于商定的指标训练和评估模型</li></ul><h1 id="005b" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">数据集和所用工具概述</h1><p id="718f" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">数据集是虚构的Sparkify用户生成的事件集合。用于此项目的数据集是完整数据集(12GB)的子集(256MB)。</p><p id="50fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然这里使用的小子集可以放在本地机器的内存中，但是完整的数据集却不能。完整的数据集才是大数据。大数据需要使用分布式计算来解决这个问题。</p><p id="51ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是支持分布式计算的专用工具，Apache Spark是业界广泛使用的工具之一。官方网站对Spark的定义如下:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lk"><img src="../Images/934ef40b6b24642949895796eb98de2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B8Q1To6ebupTdjfmu9YwAw.png"/></div></figure><blockquote class="kp kq kr"><p id="1220" class="if ig ks ih b ii ij ik il im in io ip kt ir is it ku iv iw ix kv iz ja jb jc hb bi translated"><strong class="ih hj"><em class="hi">Apache Spark</em></strong><em class="hi">是用于大规模数据处理的统一分析引擎。</em></p></blockquote><p id="af7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用了Spark的PySpark python API。它提供了一整套功能来处理和分析数据，同时抽象出分布式计算的底层细节。它提供了两种方式— Spark SQL和Spark Dataframe。虽然每一种都迎合特定的人群，但我们可以互换使用。</p><p id="c8d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过使用PySpark，子集上使用的代码可以很容易地用于处理完整的Spark集群上的完整数据集，而无需任何更改。</p><p id="a70a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我强烈推荐Udacity的<a class="ae ko" href="https://www.udacity.com/course/learn-spark-at-udacity--ud2002" rel="noopener ugc nofollow" target="_blank">免费课程</a>，它详细介绍了Spark及其特性。</p><h1 id="4227" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">顶点项目概述</h1><p id="8780" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">手中的数据是使用Sparkify服务时每个用户交互的日志。因此，每一行都是单个事件，包含几个细节，如用户执行的操作、时间戳、会话id、操作时的订阅级别、位置等。</p><p id="3c97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该项目涉及几个步骤，将这些数据处理成可用于训练机器学习模型的格式。我在下面的小节中详细介绍了这个过程。</p><h2 id="0062" class="ll jm hi bd jn lm ln lo jr lp lq lr jv iq ls lt jz iu lu lv kd iy lw lx kh ly bi translated">环境设置</h2><p id="893c" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">Udacity提供了三个数据集，并根据每个数据集的大小建议了三种不同的环境。第一个也是推荐的选项是使用完整数据集(12GB)并在AWS EMR上执行分析，这是一个基于云的Spark集群。这种方法很花钱，因此不是我的选择。第二个选项是在基于IBM cloud的Spark集群的免费层上使用中等大小的子集(256MB)。最后一个选项是在Udacity提供的工作空间中使用较小的子集(128MB)。提供了每个选项的设置说明。</p><p id="10bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我最初从第二个选项开始，并在IBM cloud上开始我的分析。设置和使用都很友好，但是，我很快就用完了每月的使用报价。这意味着，我将无法继续到下个月。</p><p id="3cf4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最终，我求助于在我的笔记本电脑上完成这个项目。从头开始在本地安装Spark可能会很有挑战性。但是感谢Docker和Jupyter背后的开发人员，我只是使用了一个<a class="ae ko" href="https://hub.docker.com/r/jupyter/pyspark-notebook" rel="noopener ugc nofollow" target="_blank">Docker文件，它包含了所有PySpark依赖项和Jupyter </a>。也就是说，几乎不需要任何设置。关于使用Docker和设置环境的细节可以在这个<a class="ae ko" href="https://realpython.com/pyspark-intro/#running-pyspark-programs" rel="noopener ugc nofollow" target="_blank">帖子</a>中找到。</p><h2 id="306c" class="ll jm hi bd jn lm ln lo jr lp lq lr jv iq ls lt jz iu lu lv kd iy lw lx kh ly bi translated">导入和清理数据</h2><p id="7885" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">首先看模式。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lz"><img src="../Images/0dc0c0494531c3006464da57155b27fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*TzYLAMRpkwliWEDq7Fq6kA.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ma"><img src="../Images/03508624691b76fe0be28f3cb0a46973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*nyUrPSHKsHlIAEF9hKdEGA.png"/></div></figure><p id="1d7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">寻找空值和空字符串</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mb"><img src="../Images/340d807f7ea42fdd8c8c6fc5c8918ce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ZQsF5cfUSu5hkhqPpbDCw.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mb"><img src="../Images/1418fa16161dbc211c9ebf4be327051c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YKx-eXOHazGY2xIVbJY26w.png"/></div></div></figure><p id="04a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数字列的描述</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mg"><img src="../Images/1b8c2c5d1621ccd2b301761cc2285b0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*snxa07tl6eGyyGNW3iff7w.png"/></div></div></figure><p id="1ed3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该数据集有两种缺失值:</p><ul class=""><li id="2675" class="kw kx hi ih b ii ij im in iq ky iu kz iy la jc lb lc ld le bi translated">值保持为空，因为该事件与用户听歌无关。因此，艺术家、长度和歌曲等字段仍然为空。</li><li id="11da" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">值保持为空，因为用户在事件期间没有登录。因此，当用户未登录时，名字、性别、姓氏、位置、注册、用户代理等字段保持为空，而用户Id是空字符串。</li></ul><p id="2a67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设目标是识别处于混乱边缘的用户，没有用户标识、用户代理、位置等用户信息的事件是没有用的。因此，删除了userId为空的行。</p><h2 id="348c" class="ll jm hi bd jn lm ln lo jr lp lq lr jv iq ls lt jz iu lu lv kd iy lw lx kh ly bi translated">关于数据的一些统计</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mb"><img src="../Images/16be0c2a99086926a3dcc712b3ba1b57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8yoK47K65lfF6StDKwRoCA.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mb"><img src="../Images/42dba6462c130851bd8357d91ef72dbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*597YJYIkWQLtmDXBTw_qgg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mh"><img src="../Images/6097b0289f1ecd3913f2ca85d2e1e2e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RfLtpKUxoScajhLNWE74oA.png"/></div></div></figure><p id="b829" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上述图中观察到:</p><ul class=""><li id="a2d5" class="kw kx hi ih b ii ij im in iq ky iu kz iy la jc lb lc ld le bi translated">最常出现的动作是“NextSong”，这在用户使用该服务听音乐时是有意义的</li><li id="fba5" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">纽约、纽瓦克、泽西城是这项服务的主要流量来源</li><li id="5a03" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">出于某种奇怪的原因，用户代理通常都是Mozilla</li><li id="7c47" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">大多数事件在用户登录时发生</li><li id="0bac" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">大多数活动来自男性</li><li id="1177" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">付费用户的活跃度是免费用户的四倍</li><li id="7ff0" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">在该数据集中，男性(250人)多于女性(198人)，共有448名用户</li><li id="2352" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">免费账户(370个)多于付费账户(321个)，总计691个。这个数字高于用户数，因为用户可以升级或降级。因此，如果用户更改了级别，同一用户将在该条形图中被计数两次</li><li id="a7a2" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">我们手头的数据是2018年最后3个月的</li></ul><h2 id="815d" class="ll jm hi bd jn lm ln lo jr lp lq lr jv iq ls lt jz iu lu lv kd iy lw lx kh ly bi translated">定义流失和识别流失用户</h2><p id="709a" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">鉴于基于订阅的商业模式的性质，有两种类型的搅动者——从付费用户降级为免费用户的用户和通过删除其注册账户来完全停止用户服务的用户。</p><p id="54d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当用户将其级别从“付费”更改为“免费”时，会记录“提交降级”事件；当用户删除其帐户时，会记录“取消确认”事件。</p><p id="287f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然这两种类型的搅动器都会影响该服务的业务量，但删除账户的用户受到的损害更大。这是因为即使用户是通过广告的免费用户，该服务也能继续获得收入，而一旦用户删除了他们的账户，该服务就停止从该用户获得收入。</p><p id="ae0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们将把这些删除账户的用户视为投机者。我们创建新的字段，首先标记取消事件，然后将所有活动标记为属于不愉快用户或不愉快用户。</p><p id="77d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种操作之后，我们已经确定了99个用户。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mi"><img src="../Images/2d1f5fdcee691e9706d38a8dde36b90d.png" data-original-src="https://miro.medium.com/v2/resize:fit:222/format:webp/1*IBzapx6OMISMM2p94mQ5QA.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mj"><img src="../Images/54e9b68bfcfc93a44e8d3a26214da983.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/format:webp/1*6GB4rgZpA8oWDjDIUo08LQ.png"/></div></figure><h2 id="fc68" class="ll jm hi bd jn lm ln lo jr lp lq lr jv iq ls lt jz iu lu lv kd iy lw lx kh ly bi translated">创建和比较易激动和非易激动用户的各种特征</h2><p id="400c" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">在识别搅动器之后，在进行任何EDA之前，我将数据集分成训练和测试两个层次。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mk"><img src="../Images/7b2b602e1c047876d131af033a87e810.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*qnz6_rYOrcLuFjaUcvIJQA.png"/></div></figure><p id="bc2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了以一种可以输入到机器学习模型的格式来减少数据，我们聚合了几个特征，以便每个用户都有一个单独的行，标记为正在搅动或未搅动，以及几个工程特征。</p><p id="9cf0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设计了以下功能:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ml"><img src="../Images/00fde0b2afb41fb3dc30e6a0cf4b6f61.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*jWK3U5gPco4N5aq6jSJjbQ.png"/></div></figure><p id="1fed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦这些特征被汇总，每一个特征都会在两组用户中进行比较——搅拌者和非搅拌者。</p><p id="c77e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是一些重点内容:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mb"><img src="../Images/0c0532d947d25491e82cc421a1467892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SaWqfPMNzPjFx8s-TmyWVw.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx"><strong class="bd jn">churners get shown more number of adverts per session</strong></figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mb"><img src="../Images/7eb180143e273344ceb2240249f1ca80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sQuC3xbAwIA2O3A6m8Ce8A.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx"><strong class="bd jn">non-churners add friends more frequently per session</strong></figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mb"><img src="../Images/56ba7a42e57a6187f323db801809a5b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8uaO_eTaC1xrvS8qox3QTg.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx"><strong class="bd jn">non-churners listen to more number of artist per session</strong></figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mb"><img src="../Images/6f1114c525c1ae6e1cd154d70de0fc46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tw1qQ_pi1m8NCZVTG33p4w.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx"><strong class="bd jn">non-churners add songs to their playlist more frequently per session</strong></figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mb"><img src="../Images/3cd2a50cb905f6a30eea704833731b1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GnaqoaBuxKjPjxFMo9DFkA.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx"><strong class="bd jn">churners hit the thumbs down button more frequently per session</strong></figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mb"><img src="../Images/b62ba420cf7a91b13ca016c927fee7e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*srepVntDItvTPLB9N25ycw.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx"><strong class="bd jn">churners visit the help page slightly more frequently per session</strong></figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mb"><img src="../Images/d4039c3a77962c55c5d80637688842d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ViSxYHG6qPVjhPPffo5Sw.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx"><strong class="bd jn">non-churners use the thumbs up more frequently per session</strong></figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="er es mb"><img src="../Images/a27d3ffe369c9c0f8b672c82f23477e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kiPKXzEyPiIYcEc5S62Wkg.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx"><strong class="bd jn">non-churners listen to slightly more number of songs per session</strong></figcaption></figure><h2 id="7e13" class="ll jm hi bd jn lm ln lo jr lp lq lr jv iq ls lt jz iu lu lv kd iy lw lx kh ly bi translated"><strong class="ak">将这些特征聚集成机器学习的特征矩阵</strong></h2><p id="e1a6" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">创建这些特征后，所有特征被组合成具有以下模式的特征矩阵:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mq"><img src="../Images/11391a71195c37f047bc08cc125f3f2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*ojWY97SKBr6ZkqQ4-_602g.png"/></div></figure><p id="bc27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于这些特征中有些是数字的，有些是类别的，进一步的预处理步骤执行如下:</p><ul class=""><li id="b093" class="kw kx hi ih b ii ij im in iq ky iu kz iy la jc lb lc ld le bi translated">使用最小-最大缩放技术缩放数字要素</li><li id="ae39" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">唯一的分类栏“性别”是标签编码</li><li id="52df" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">所有的特征被组合成一个向量。这是Spark的ML API所期望的格式。</li></ul><p id="e971" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有这些步骤被组合成流水线。</p><h2 id="8d9a" class="ll jm hi bd jn lm ln lo jr lp lq lr jv iq ls lt jz iu lu lv kd iy lw lx kh ly bi translated">评估绩效的标准</h2><p id="ec5b" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">在训练任何模型之前，我们必须决定用于衡量性能的指标。</p><p id="76b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个二元分类问题，如下图所示，搅拌者的数量远远少于非搅拌者，</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mr"><img src="../Images/80ac9cff341ee8c2f6eb8499aba95414.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*Fn8hTdHlEiewGocgP6hKAQ.png"/></div></figure><p id="17e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这种不平衡的数据集，选择合适的指标变得至关重要，因为一些指标可能会导致误导性的结论。</p><p id="a7f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，通过简单地对多数类的所有观察值进行分类，很容易获得高<strong class="ih hj">准确度分数</strong>。</p><p id="4e8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有不同的诊断工具帮助解释二元分类模型，AUC-ROC是其中之一。这对于现有的不平衡数据集是一个很好的选择，也是比较不同分类器性能的一个很好的度量。</p><p id="d295" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ROC曲线:不同阈值的假阳性率(x)对真阳性率(y)的曲线图</p><p id="ea75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">true positive rate = true positives/(true positives+False Negatives)</p><p id="04a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假阳性率=假阳性/(假阳性+真阴性)</p><p id="3cfd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">AUC-ROC:计算ROC曲线下的面积，以给出分类器模型的单一分数</p><p id="54ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分数是介于0.0和1.0之间的值。值为0.5表示模型无法区分这两个类别。</p><p id="23a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在这里阅读更多关于这个<a class="ae ko" href="https://machinelearningmastery.com/roc-curves-and-precision-recall-curves-for-imbalanced-classification/" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><h2 id="0ec0" class="ll jm hi bd jn lm ln lo jr lp lq lr jv iq ls lt jz iu lu lv kd iy lw lx kh ly bi translated">机器学习模型选择</h2><p id="6bfd" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">Pyspark提供了所有常用的ML算法。我们对以下内容进行了培训和比较:</p><ul class=""><li id="5362" class="kw kx hi ih b ii ij im in iq ky iu kz iy la jc lb lc ld le bi translated">逻辑回归</li><li id="f813" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">随机森林分类器</li><li id="e2f1" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">梯度增强树分类器</li><li id="9d3d" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">支持向量机分类器</li><li id="93dc" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">决策树分类器</li><li id="abc1" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">朴素贝叶斯分类器</li></ul><p id="be92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">交叉验证得分以及训练数据的AUC-ROC得分如下:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ms"><img src="../Images/99c621e5df1474779c169d8748da1c70.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/format:webp/1*u3c9K5S0K_6dJYg13rDSiQ.png"/></div></figure><p id="cd2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">逻辑回归有最好的平均交叉验证分数。其次是线性SVC。我们使用网格搜索对逻辑回归模型进行了超参数调整。</p><p id="a466" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在以下参数中搜索了多个值，最佳模型的值为:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mt"><img src="../Images/66c46cf753cf0748f0fe041c485d4301.png" data-original-src="https://miro.medium.com/v2/resize:fit:256/format:webp/1*0CooNL869g6ppVuZBekrXw.png"/></div></figure><p id="fb8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最佳模型的交叉验证分数仅略高，为0.6184。最后在搁置测试数据集上对该模型进行了评估。0.5144的AUC-ROC分数根本不乐观。</p><p id="97ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">各种特征的系数如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mu"><img src="../Images/f8ff41ecd225aae917e5b96a051d5d13.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*J6jo-bSl5QE1YjasNagOJA.png"/></div></figure><h2 id="534b" class="ll jm hi bd jn lm ln lo jr lp lq lr jv iq ls lt jz iu lu lv kd iy lw lx kh ly bi translated">对训练模型性能的思考</h2><p id="065e" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">模型的性能很差。它不能使用这些特征来学习两个分类标签之间的分离。出现这种情况的主要原因可能是:</p><ul class=""><li id="74f1" class="kw kx hi ih b ii ij im in iq ky iu kz iy la jc lb lc ld le bi translated">不平衡的数据意味着模型没有足够的信息来学习搅动器和非搅动器的特征。有几种方法可以改善这种情况，如上采样、下采样和SMOTE。</li><li id="7d99" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">我们设计的功能对算法没有太大帮助。我们将不得不回到绘图板，并考虑其他功能。例如，还可以使用时间戳设计其他功能，这是我们在这个项目中没有做到的。</li><li id="0305" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">整个数据集的这个子集太小，模型无法了解任何有用的信息。使用完整数据集进行训练时，性能可能会有所不同。</li></ul><h1 id="d64f" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">结论</h1><p id="ab55" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">在这个项目中，我们着手解决一个名为“Sparkify”的虚拟音乐流媒体服务所面临的实际业务问题。可用的数据是“Sparkify”用户的事件日志。利用这些数据，我们试图识别出那些处于混乱边缘的用户。有了这些信息，企业就可以对客户流失采取预防措施。</p><p id="b8e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">整个数据集的大小为12GB，符合大数据的条件，即整个数据集不再完全适合我们本地计算机的内存。因此，处理和分析该数据集需要支持分布式计算的工具。我们使用Apache Spark作为工具。然而，分析是使用较小的数据子集进行的，但是当在完全成熟的Spark集群上执行时，相同的代码可以用于完整的数据集。</p><p id="6bb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然我们设计了几个有前途的功能，并格式化了数据，使其适合训练机器学习模型，但在这个项目中创建的最终模型表现不佳。这表明数据科学是一个迭代过程，最终结果并不总是令人眼前一亮。</p><p id="7000" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尽管结果不尽如人意，但这个项目有很多很好的收获。最主要的是学习Spark并将其应用于实际问题的机会。</p><p id="cfef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有与这个项目相关的代码都可以在这里找到<a class="ae ko" href="https://github.com/vishnu-raju/sparkify-churn-prediction" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>