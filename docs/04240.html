<html>
<head>
<title>Anomaly Detection On IP Address Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">IP地址数据的异常检测</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/anomaly-detection-on-ip-address-data-1520955fa568?source=collection_archive---------7-----------------------#2021-06-23">https://medium.com/geekculture/anomaly-detection-on-ip-address-data-1520955fa568?source=collection_archive---------7-----------------------#2021-06-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="5bd3" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">使用高斯混合模型(GMM)聚类的简单示例</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/aa17c212bf52442624aa9f7fd2971138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pzMrgN1Hex1H5hoV"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@randyfath?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Randy Fath</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="9111" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">在本文中，我们将尝试聚类的无监督机器学习方法，根据IP地址的相似性将IP网络中的主机分组到不同的集群中。重要的是，我们将看到K-Means和GMM(高斯混合模型)在聚类方法上的差异，并比较它们的结果。我们还将看到如何使用GMM更有效地找出数据中的异常值</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="d23f" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">介绍</h1><p id="b0c1" class="pw-post-body-paragraph jv jw hi jx b jy lj ij ka kb lk im kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">聚类是一类无监督的ML算法，它将给定的数据点分离并分组到不同的数据组中，使得任何聚类中的数据点在特征上彼此相似。聚类使用我们提供的特征来学习数据点总体中的相似性模式，然后相应地对它们进行分组。</p><p id="ff41" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">有许多不同的聚类算法，如K-Means聚类，DBSCAN和GMM，仅举几个流行的例子。<br/>在下面的练习中，我们将从庞大的网络数据包数据集中提取数据包的源和目的IP地址，并使用无监督的ML聚类方法，根据IPv4地址的四个八位位组将其聚类到不同的组中。在路上，我们将做一些异常检测，并看看GMM和K-Means如何相互比较。异常是离群值(尽管它们是已形成的集群的成员)。由于与同一群中的其他人有很大程度的不相似性，或换句话说有很小程度的相似性，所以他们离群中的其他人相对较远。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="709b" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">K-均值和GMM聚类算法的基础</h1><p id="4928" class="pw-post-body-paragraph jv jw hi jx b jy lj ij ka kb lk im kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">我们不会深入研究K-Means和GMM算法如何工作的细节，因为这超出了本文的范围。相反，我们将两者应用于对IP地址群体进行聚类的任务，注意两种算法采用的不同方法如何对最终的聚类形成产生影响，以及GMM如何看起来更适合我手头的数据集。</p><p id="3845" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated"><strong class="jx hj">关于这两种算法的一些基本信息如下。</strong></p><p id="9462" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated"><strong class="jx hj"> K-Means算法</strong>在选择初始聚类质心之后，循环迭代两步，直到结果聚类收敛。</p><ol class=""><li id="7deb" class="lo lp hi jx b jy jz kb kc ke lq ki lr km ls kq lt lu lv lw bi translated">将每个数据观测值分配给最近的聚类质心</li><li id="e858" class="lo lp hi jx b jy lx kb ly ke lz ki ma km mb kq lt lu lv lw bi translated">将每个质心更新为分配给它的数据点的平均值。</li></ol><p id="e9a7" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">因此，对于K-Means，每个数据点被分配到任何一个聚类，这被称为<strong class="jx hj">硬聚类</strong>或硬聚类分配。</p><p id="33d0" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated"><strong class="jx hj">硬聚类:</strong>在硬聚类中，数据点被完全分配到任何一个聚类中。这意味着对于硬聚类<strong class="jx hj">来说，在数据点的分配中没有考虑不确定性。</strong></p><p id="605c" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated"><strong class="jx hj">软聚类:<br/> </strong>在软聚类中，将数据点分配给一个聚类是<strong class="jx hj">基于该数据点存在于该聚类中的概率或可能性。</strong></p><p id="96c9" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">对于软聚类，我们有一种称为GMMs或高斯混合模型的算法。<br/> <strong class="jx hj"> GMM </strong>相比K均值有两个优势:</p><ol class=""><li id="7151" class="lo lp hi jx b jy jz kb kc ke lq ki lr km ls kq lt lu lv lw bi translated">GMM在聚类协方差方面更加灵活，更适合椭圆形斑点。</li><li id="f30e" class="lo lp hi jx b jy lx kb ly ke lz ki ma km mb kq lt lu lv lw bi translated">GMM模式适应混合成员。</li></ol><p id="75ca" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">现在让我们进入示例练习的细节..</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="46d6" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">数据先决条件</h1><p id="403d" class="pw-post-body-paragraph jv jw hi jx b jy lj ij ka kb lk im kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">我取了一个<a class="ae jn" href="https://www.netresec.com/?page=PcapFiles" rel="noopener ugc nofollow" target="_blank">公开可用的pcap文件</a>，其中包含数百万个数据包，提取了数据包的详细信息，如IP报头字段、TCP报头字段等，并将其保存在一个大的csv文件中。我使用了流行的<a class="ae jn" href="https://scapy.net/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx hj"> python工具</strong> <strong class="jx hj"> Scapy </strong> </a>提取pcap文件中每个包的协议数据。因此，我们将从一个现成的csv文件开始练习，该文件包含数百万行，每行描述一个网络数据包。</p><h1 id="db45" class="kr ks hi bd kt ku mc kw kx ky md la lb io me ip ld ir mf is lf iu mg iv lh li bi translated">本练习的代码</h1><p id="688a" class="pw-post-body-paragraph jv jw hi jx b jy lj ij ka kb lk im kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">这个练习的完整代码可以在这个<a class="ae jn" href="https://github.com/raja-surya/Anomaly-Detection-IP-Address" rel="noopener ugc nofollow" target="_blank"> github链接</a>中找到。<br/>笔记本大多是不言自明的，所以我在本文中只解释练习的重要步骤和方面。建议读者浏览这里跳过的其他步骤的完整代码。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="17c9" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">1.数据准备</h1><h2 id="2276" class="mh ks hi bd kt mi mj mk kx ml mm mn lb ke mo mp ld ki mq mr lf km ms mt lh mu bi translated">读取csv文件并提取源和目标IP地址</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mv"><img src="../Images/21729d6a633e88382a5e74805bf16144.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bY1DrGDy68AXeLLtATT5yA.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mw"><img src="../Images/2b457d02bc38697f564d3854719b481b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MHbrLVFoxZJlXB9v1Kaz1Q.png"/></div></div></figure><p id="5a77" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">上面，我们已经阅读了包含数据包数据的csv文件，该文件有近6百万行和39列。每行包含一个数据包的详细信息。我们将只使用数据包的isrc(源IP地址)和idst(目的IP地址)进行进一步分析。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mx"><img src="../Images/c82b2fa853a9dca74806ed00a68de6cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*2iX0F-DJ6qmO5McppqLyeA.png"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es my"><img src="../Images/b2f831f2a564d8b93b501758edbca575.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZWwGj_bylC4k5ok6FpkoA.png"/></div></div></figure><p id="c4df" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">在数据清理和删除重复条目后，我们有187个源IP地址和2673个目的IP地址用于分析。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="9c45" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">2.从IP地址中提取特征</h1><p id="203f" class="pw-post-body-paragraph jv jw hi jx b jy lj ij ka kb lk im kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">对于数据的聚类，我们需要选择数据的特定特征，基于这些特征，聚类算法可以将数据分成相似成员的聚类。在这里，因为我们希望基于IPv4地址进行聚类，所以我们需要某种方法将IP地址编码到一个特征向量中。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/d5458c1f21554ae55cc4082e84320086.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LKgZgovgKRhj25jr7ZFJbg.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es na"><img src="../Images/67e9284146ecfbcea2dd9da4cc821c6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bvq1_rzn4goDPtrcJMFUuA.png"/></div></div></figure><p id="5a5f" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们选择了拆分每个IPv4地址的四个八位字节，并将它们用作长度为4的向量，以提供给聚类算法来表示每个数据(IP地址)。选择这种方法背后的理由摘自<a class="ae jn" href="https://hammer.purdue.edu/articles/thesis/Encoding_IP_Address_as_a_Feature_for_Network_Intrusion_Detection/11307287" rel="noopener ugc nofollow" target="_blank">这篇研究论文。</a></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nb"><img src="../Images/4a69158e83196a47d04425838e271120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UarrCcNyWvrBpuu3y-OGkA.png"/></div></div></figure><p id="a593" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">然后，我们将PCA应用于X_matrix，将维数从4降低到2，这样我们就可以很容易地用2维散点图来可视化聚类。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nc"><img src="../Images/9d81ca3d3ed9864f3a209a1b556a061d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KNxoIgGOZSyISsSkCp9cUQ.png"/></div></div></figure><p id="5d93" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">当我们对src_ip_df的pca1和pca2进行散点图绘制时，我们会得到以下图</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nd"><img src="../Images/26a3df05c51b171b7e93f1700a53efe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U0yVwJG3uNBaf6nheChbyA.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ne"><img src="../Images/935081e2330cf38d1ee6004f5557f0e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O70Q1cb0GZ39J1fYj33enQ.png"/></div></div></figure><p id="8045" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">从视觉上看，似乎有6或7个小集群。广义上讲，有两个椭球形的大星团，它们的方向相似。星团模式更接近椭圆形，尤其是左边的。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="386a" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">3.对源IP地址数据使用高斯混合模型(GMM)聚类算法</h1><p id="80c3" class="pw-post-body-paragraph jv jw hi jx b jy lj ij ka kb lk im kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">高斯混合模型(GMM)聚类比适合球形斑点的K-均值聚类更适合椭圆形聚类。GMM也是一种概率聚类算法，并提供了更容易的方法来检测异常。让我们尝试用GMM对源IP地址进行聚类。</p><p id="933a" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们使用BayesianGaussianMixture类，它帮助我们找到给定数据所需的最佳聚类数。如果我们输入的聚类数超过了最佳值，它会通过给那些不必要的聚类赋予等于或接近于零的权重来消除不必要的聚类。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nf"><img src="../Images/8125c10c79643d350bcc58eba83500e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ws-nUL3TMVeq2dL2WWKCFg.png"/></div></div></figure><p id="4050" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们尝试了7个集群，但是根据给定的权重，3个似乎足够了。然后，我们在源IP数据上训练BGM(贝叶斯高斯混合),要求创建三个聚类。在上面看到的输出中，我们看到BGM为算法创建的三个聚类中的每一个分配的权重。</p><p id="b370" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们还可以获得三个聚类的高斯平均值，并通过PCA对其进行转换，如下所示，以便在可视化过程中定位聚类的平均值。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ng"><img src="../Images/be4707be7c1476b76d65d3c2a2c991dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dYzt4QFX5hl2ARZs5Wk21g.png"/></div></div></figure><p id="ca7d" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">接下来，我们预测所有源IP数据的群集</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nh"><img src="../Images/bcbf33b7f74dc7147f0dc390b3d78f15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wyGnJH3fPP1tp9VrcqudCw.png"/></div></div></figure><p id="39c4" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">如上所示，我们将每个IP地址的集群标签存储为一个单独的列‘k cluster’。此外，我们为每个聚类创建单独的数据框，以便有助于绘制聚类。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ni"><img src="../Images/46ccac2728fdc6c68b05189a5c0c74a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cp5bX6O8wjRn4bm7a9Nvig.png"/></div></div></figure><p id="ca11" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们绘制了GMM创建的三个集群，如下图所示。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nj"><img src="../Images/ed05ebf96eb1ab5955d8578fe95ddf8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hqfTW7eOgCO3xd_mcTOr8g.png"/></div></div></figure><p id="87d8" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们可以看到3个集群形成整齐，但确实包含一些异常值/异常。</p><h2 id="b6a3" class="mh ks hi bd kt mi mj mk kx ml mm mn lb ke mo mp ld ki mq mr lf km ms mt lh mu bi translated">在分析每个集群的成员时，我们看到，使用GMM集群，3个集群明显是从源IP地址形成的。</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nk"><img src="../Images/c196682bf34dafa4b8911edad7a51352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EKBq4oQds_gKONNOtTS0-w.png"/></div></div></figure><p id="4d56" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">簇0主要由192.168组成。(21–27)子网有几个可能的异常值/异常值。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nl"><img src="../Images/468b3c8cf3dcab409073b01c7c8dfb85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TEIFbq8lseDFCykCfUxwIA.png"/></div></div></figure><p id="72cd" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">簇1主要由192.168组成。(200+)个子网。这个集群不是很紧密，有一个稀疏的第三个八位字节的范围，似乎有可能异常。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nm"><img src="../Images/0d61ebe9a4772196773bdc361be22b78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ean6Pwf9RoO-PRjjOSu0A.png"/></div></div></figure><p id="c7ce" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">群集2只包含两个IP地址，与群集0和1的地址相比，这两个地址显然是异常的。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="9317" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">4.从IP地址集群中查找异常/异常值</h1><p id="9450" class="pw-post-body-paragraph jv jw hi jx b jy lj ij ka kb lk im kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">我们使用GMM的score_samples()方法来估计聚类中每个数据点所在位置的密度。分数越大，该数据点位置的聚类密度越高。位于低密度区域的任何实例都可以被认为是异常。我们可以定义一个密度阈值，比如说4%,并且将位于低于密度值范围的第4个百分点的密度区域中的所有数据视为异常。这个阈值是任意的，我们可以根据自己的判断来选择。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nn"><img src="../Images/afc94e26128afbd736c29bd248f049a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1w0X0LKl_GIMfhJEPGixPQ.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es no"><img src="../Images/6d3ff24c57dfc54ab1d46b5b01d8d037.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aTNgY26bVTawta0e0ajPKw.png"/></div></div></figure><p id="d8e7" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们在源IP地址集中发现了八个异常IP地址。</p><p id="b5a4" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们再次绘制聚类图，这次标记异常数据点。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es np"><img src="../Images/c69f974591a2362819e46501ba94f8cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u8zcPLwIEGsGto4Y_Iemhg.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nq"><img src="../Images/2c1702acb3ebe3af8ad2580a326d3853.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cc84M7fRohTh8d6iGH-R_Q.png"/></div></div></figure><p id="2a0f" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">聚类图清楚地显示了远离紧密聚类组的异常(红色)。此外，如果您将异常IP地址与集群中常见的IP地址进行比较，您会发现显著的差异。</p><p id="9444" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">例如，许多异常以范围&gt; 250的最后一个八位字节结束(即接近八位字节范围0–255的末尾)。集群2的地址172.19.2.66和0.0.0.0都被标记为异常。从192.168中可以看出他们的价值。群集0和1中的IP地址。<br/>192 . 168 . 169 . 129也是如此，它的第三个八位字节169不在观测范围内。</p><p id="9c53" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated"><strong class="jx hj">因此，我们成功地使用高斯混合模型对数据包中的源IP地址进行了聚类，并提取了所用地址中可能存在的异常/异常值。</strong></p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="09eb" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">5.对目的IP地址重复同样的练习，看看GMM的情况如何。</h1><p id="8e03" class="pw-post-body-paragraph jv jw hi jx b jy lj ij ka kb lk im kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">这里，我们对目的IP地址重复我们已经对源IP地址遵循的相同步骤。<br/>首先，我们使用两个相应的PCA组件绘制IP地址数据。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nr"><img src="../Images/e811baa7a80b319cdc63c8848456c556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z4YSdTXs5iq-prUHLuzvCA.png"/></div></div></figure><p id="3a15" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">目的地IP地址显然看起来更像椭圆形，在顶部和底部至少有两个形状和方向相似的长簇。</p><p id="6e66" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">下面我们估计集群的最佳数量为4，并相应地使用目的地IP数据进行训练。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ns"><img src="../Images/690881c0554562a9aae0425eee6cb837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m3QvNN9Rgn2gfbBNgbDf7Q.png"/></div></div></figure><p id="0f06" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">与我们在前面几节中看到的源IP数据类似，我们可以预测每个目的IP地址的群集，并绘制如下图。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nt"><img src="../Images/d84f65bad6d9c24b0c295b58db297876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8wOxvHb4SBD7arKlK9YUvw.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nu"><img src="../Images/77a73085dfa30e92b475bc61e553602f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xm4rI36-ch-69_aJkNO_BA.png"/></div></div></figure><p id="02f1" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们可以看到，GMM已经将IP地址合理地分为三个大集群和一个小集群(cl 2)。</p><p id="b2c8" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">需要注意的是<strong class="jx hj"> GMM很好地考虑了星团的椭球形状和方向。这就是GMM与K-Means的不同之处，K-Means假设聚类是球形的(我们将在下面看到)。</strong></p><p id="9be9" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">然后，我们分析每个集群，看每个集群中的IP地址有多相似。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nv"><img src="../Images/7d84b6638dbf52c2e8bfc5059a645357.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E9Rf2OIk15YVKzeND1mrvA.png"/></div></div></figure><p id="a155" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">群集0看起来非常分散，地址来自广泛的子网。从上面的聚类图中我们也可以看到这一点。<strong class="jx hj">看起来里面会包含很多异常情况。</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nw"><img src="../Images/60f74179c686e43ba78c54b69cf48124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sNyVY65DHX7EKUikLpd0Cg.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nx"><img src="../Images/8cc6cdc2b8b8b5265976ca65ecc1b300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*rqonF_61xY3a12GfHJVZ3g.png"/></div></figure><p id="7433" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">聚类1非常紧密，几乎只包含192.168。[21–28]子网地址。在所有四个集群中，这个集群是最多的。只有一个异常值— 192.168.10。*我们也可以在聚类图中看到远处。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ny"><img src="../Images/bf192560d7d9612225ef4149b35804b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LnbspUBgPVHpVj_DOsVqxQ.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nz"><img src="../Images/508a502ea325d4b567c6e4d61892abdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*p5hacH5-3mq8ljZJO2xehA.png"/></div></figure><p id="6ffe" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">群集2很小，非常紧凑，包含173.194.43个子网地址。该集群是所有四个集群中最少填充的。可以看到一个异常值183.182.82.14，它在上面的聚类图中也很突出。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oa"><img src="../Images/7da0c38174ed3bf9a923b26c46744dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vURGWD-hQFRSuM8y5x6_vQ.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nz"><img src="../Images/377317deeaccb64d8d5e98e0a67da434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*SgdihG7ZZkHKQ7lmcX8KjA.png"/></div></figure><p id="c8e9" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">聚类3是紧密的，主要包含192.168。[&gt;200]个子网地址。</p><p id="7a4c" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">因此，通过GMM集群，我们可以清楚地看到上述四个集群是由目的IP地址组成的。</p><p id="b15e" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">然后，我们使用与源IP地址分析相同的密度阈值比较，从数据中分离出异常。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ob"><img src="../Images/1af18dcf6fb270bd5c40265f4e4d5ad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PhLvu-eoYPMl5lPqeInjWQ.png"/></div></div></figure><p id="fe4b" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们绘制了检测到的107个异常，以及如下所示的集群。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oc"><img src="../Images/40ff43a5918ce8554707769c51c12790.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nEFNrnPBrARUfgu4Y-LMjg.png"/></div></div></figure><p id="aebb" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们可以看到，所有的异常都是广泛分散的星团0的一部分。我们可以看到上面用红色标出的他们的位置。</p><p id="d4b3" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated"><strong class="jx hj">因此，我们已经使用GMM成功地群集了源ip地址和目的ip地址，并且还检测到了流程中的异常。</strong></p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="0677" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">6.尝试在目标IP地址上进行K-Means聚类，并与GMM进行比较。</h1><p id="5eb8" class="pw-post-body-paragraph jv jw hi jx b jy lj ij ka kb lk im kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">首先，我们通过使用不同数量的簇来尝试KMeans，并检查图中簇紧密度和簇数量之间的“肘”点，来估计最佳的簇数量。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es od"><img src="../Images/8256e0ea2884671040c557b0ec6d59fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0dgn3fLWHlY62eSdm7gQ0w.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oe"><img src="../Images/e62458cc98b980d759fb9d14db31cefb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y7M3GSx4N7lv_Ojh_fn2cQ.png"/></div></div></figure><p id="82b9" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">没有明确的一个肘点。我们将选择5作为聚类的最佳数量，并通过K-Means fit_predict对数据点进行聚类。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es of"><img src="../Images/d25bffa198b35d48b621548319b65b3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p4i5vFjLRU_WIIQcdgLaYQ.png"/></div></div></figure><p id="4815" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们绘制了由K-均值确定的聚类。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es og"><img src="../Images/1f23c7919eb0c429b36689ddbcee121a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Gpx5JG0L4iTkKX-4lnZjw.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nu"><img src="../Images/d8d84cf262c83d2bc7a934baeed1cbab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gpII9ezvgZr0IQtIcvpumQ.png"/></div></div></figure><p id="b345" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们可以看到，K-Means所做的聚类是不同于GMM。</p><ol class=""><li id="49a6" class="lo lp hi jx b jy jz kb kc ke lq ki lr km ls kq lt lu lv lw bi translated">底部的椭圆体数据点被分成3个簇，而GMM将它们聚集成一个大簇。</li><li id="b0e9" class="lo lp hi jx b jy lx kb ly ke lz ki ma km mb kq lt lu lv lw bi translated">聚类看起来没有清楚地分开，并且包含来自分散数据点的混合数据点。</li></ol><p id="cdd9" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated"><strong class="jx hj">总的来说，集群没有GMM做得好，界限也不清楚。</strong> <strong class="jx hj">这应该是因为K-Means基于聚类中心方法，该方法更适合球形数据块，而不是不同大小和方向的椭球形。</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es oh"><img src="../Images/b747390a9da5bceeb8f5a6b1a814a262.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*EO5J2kY7Zfaj1YMObXGn8g.png"/></div></figure><p id="3497" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">查看群集0的第一个二进制八位数本身，我们可以看到它包含子网的混合。虽然它主要由192.168组成，但也包含208。, 195.等等。</p><p id="9977" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">K-Means打破了192.168的同质聚类。[21–28]将IP地址划分为三个更小的集群，并将它们与分散集中的其他不同IP地址混合在一起。</p><p id="6394" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">但是如果你还记得，GMM已经把所有192.168年的。[21–28]将地址划分到一个集群(集群1)中，并且不要与其他IP地址混淆。<strong class="jx hj">因此，如预期的那样，对于椭圆形群组，GMM聚类比K均值聚类提供了更好的结果。</strong></p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="0c35" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">结论</h1><p id="0b44" class="pw-post-body-paragraph jv jw hi jx b jy lj ij ka kb lk im kd ke ll kg kh ki lm kk kl km ln ko kp kq hb bi translated">我们使用GMM和K-Means聚类算法对数据集中的IP地址进行聚类。</p><p id="f953" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们看到，GMM通过清晰地划分椭圆形数据块，比K-Means提供了更好的结果，特别是对于目的IP地址。</p><p id="853f" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">在此过程中，我们还发现了所用IP地址中的异常情况。</p><p id="b6d9" class="pw-post-body-paragraph jv jw hi jx b jy jz ij ka kb kc im kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated"><strong class="jx hj">谢谢！<br/>希望这很有趣，并对学习有所帮助！</strong></p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="33a1" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">参考资料</h1><ul class=""><li id="ba44" class="lo lp hi jx b jy lj kb lk ke oi ki oj km ok kq ol lu lv lw bi translated"><a class="ae jn" href="https://www.ciscopress.com/store/data-analytics-for-it-networks-developing-innovative-9780135183465" rel="noopener ugc nofollow" target="_blank">IT网络数据分析</a> -作者John Garret</li><li id="7af6" class="lo lp hi jx b jy lx kb ly ke lz ki ma km mb kq ol lu lv lw bi translated"><a class="ae jn" href="https://www.oreilly.com/library/view/hands-on-machine-learning/9781492032632/" rel="noopener ugc nofollow" target="_blank">使用Scikit-Learn、Keras和TensorFlow进行机器实践学习，第二版</a></li></ul></div></div>    
</body>
</html>