<html>
<head>
<title>How to Make a Web Map with Python’s Flask and Leaflet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python的烧瓶和传单制作网络地图</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-make-a-web-map-with-pythons-flask-and-leaflet-9318c73c67c3?source=collection_archive---------2-----------------------#2022-01-12">https://medium.com/geekculture/how-to-make-a-web-map-with-pythons-flask-and-leaflet-9318c73c67c3?source=collection_archive---------2-----------------------#2022-01-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="12d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本教程向您展示了如何使用Python的Flask和传单构建web地图，Flask和传单是一个用于移动友好的交互式地图的开源JavaScript库。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/6045ee027614637bd38c7ac3d0091e4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zg0ftYB4eySyhG_jtHPHBw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Image by author.</figcaption></figure><p id="774f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">经历</strong>:初学者</p><h1 id="f682" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">要求:</h1><p id="2621" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated"><strong class="ih hj">python、html、javascript的基础知识。</strong></p><p id="88b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">一个python解释器比如</strong> <a class="ae kw" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> VSCode </strong> </a> <strong class="ih hj">或者</strong><a class="ae kw" href="https://www.anaconda.com/products/individual" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">Spyder</strong></a><strong class="ih hj">。这些解释器让你很容易编辑你的代码。</strong></p><p id="e3e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">本教程基于基本的</strong> <a class="ae kw" rel="noopener" href="/geekculture/how-to-make-a-website-for-free-with-pythons-flask-and-google-app-engine-5278a6041762"> <strong class="ih hj"> Google App引擎示例</strong></a><strong class="ih hj">(github</strong><strong class="ih hj">上有</strong> <a class="ae kw" href="https://github.com/spmcneal/Medium-Flask/tree/main/Flask-AppEngine" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">)。</strong></a></p><p id="a803" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在前一篇教程中，我们构建了一个基本的flask应用程序，并仅使用4个文件将其部署到Google App Engine:一个<strong class="ih hj"> HTML页面</strong>，一个<strong class="ih hj"> Python文件</strong>作为“控制器】，一个<strong class="ih hj">需求</strong>文件，以及一个告诉App Engine做什么的文件，称为<strong class="ih hj">一个. yaml </strong>文件。</p><p id="a3e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基于这些文件，我们只需要另外两个文件来创建一个网络地图:</p><p id="9caf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个CSS文件和一个JavaScript文件。Flask知道在名为“static”的子目录中查找这些文件。在与main.py相同的位置创建目录。对于organization，在这个目录中创建两个额外的目录，一个用于javascript文件，另一个用于css文件。最后，在各自的文件夹中创建这两个空文件。结构应该是这样的:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="f6a3" class="lc ju hi ky b fi ld le l lf lg">static/css/universal.css<br/>static/css/universal.js</span></pre><p id="348a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们要一个全屏地图，所以我们要删除所有的填充和空白，并设置地图的高度和宽度为100%。</p><p id="69b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将以下代码粘贴到universal.css文件中:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="4162" class="lc ju hi ky b fi ld le l lf lg">body {</span><span id="4071" class="lc ju hi ky b fi lh le l lf lg">padding: 0;</span><span id="0c17" class="lc ju hi ky b fi lh le l lf lg">margin: 0;</span><span id="86f1" class="lc ju hi ky b fi lh le l lf lg">}</span><span id="92bd" class="lc ju hi ky b fi lh le l lf lg">html, body, #map {</span><span id="0569" class="lc ju hi ky b fi lh le l lf lg">height: 100%;</span><span id="a832" class="lc ju hi ky b fi lh le l lf lg">width: 100vw;</span><span id="6042" class="lc ju hi ky b fi lh le l lf lg">}</span></pre><p id="f389" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将添加一个带有openstreet切片图层的标准传单地图。</p><p id="3697" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将以下内容粘贴到universal.js中:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="70f7" class="lc ju hi ky b fi ld le l lf lg">var map = L.map('map').fitWorld();</span><span id="f7c7" class="lc ju hi ky b fi lh le l lf lg">L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {</span><span id="7960" class="lc ju hi ky b fi lh le l lf lg">attribution: '&amp;copy; &lt;a href="https://www.openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; contributors'</span><span id="a6f0" class="lc ju hi ky b fi lh le l lf lg">}).addTo(map);</span></pre><p id="94e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本教程有趣的部分是利用“jinja”模板将变量从python转换成javascript。为此，我们需要给页面一些变量。在main.py中，我们将添加一个参数，将“标记”作为jsons列表输入页面。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="a68a" class="lc ju hi ky b fi ld le l lf lg">from flask import Flask, render_template</span><span id="65dc" class="lc ju hi ky b fi lh le l lf lg">app=Flask(__name__)</span><span id="6802" class="lc ju hi ky b fi lh le l lf lg">@app.route('/')</span><span id="035d" class="lc ju hi ky b fi lh le l lf lg">def root():</span><span id="1996" class="lc ju hi ky b fi lh le l lf lg">   markers=[</span><span id="368b" class="lc ju hi ky b fi lh le l lf lg">   {</span><span id="1b75" class="lc ju hi ky b fi lh le l lf lg">   'lat':0,</span><span id="63e6" class="lc ju hi ky b fi lh le l lf lg">   'lon':0,</span><span id="43a5" class="lc ju hi ky b fi lh le l lf lg">   'popup':'This is the middle of the map.'</span><span id="a95d" class="lc ju hi ky b fi lh le l lf lg">    }</span><span id="07f2" class="lc ju hi ky b fi lh le l lf lg">   ]<br/>   return render_template('index.html',markers=markers )</span><span id="4c9e" class="lc ju hi ky b fi lh le l lf lg">if __name__ == '__main__':</span><span id="eb62" class="lc ju hi ky b fi lh le l lf lg">   app.run(host="localhost", port=8080, debug=True)</span></pre><p id="2cce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，在index.html页面中，我们添加了标准的javascript和css来呈现传单地图，以及静态目录中的css和javascript文件。通过使用jinja“for循环”遍历标记jsons列表，并将标记变量添加到页面内脚本中，我们可以将变量从python传递到javascript。这允许我们使用python的代码和逻辑来利用所有传单的特性。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="0a0e" class="lc ju hi ky b fi ld le l lf lg">&lt;!doctype html&gt;</span><span id="a52a" class="lc ju hi ky b fi lh le l lf lg">&lt;html lang="en"&gt;</span><span id="5a17" class="lc ju hi ky b fi lh le l lf lg">&lt;head&gt;</span><span id="5d2c" class="lc ju hi ky b fi lh le l lf lg">&lt;title&gt;Flask Leaflet Website&lt;/title&gt;</span><span id="b34b" class="lc ju hi ky b fi lh le l lf lg">&lt;meta charset="utf-8"&gt;</span><span id="5da4" class="lc ju hi ky b fi lh le l lf lg">&lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;</span><span id="09c1" class="lc ju hi ky b fi lh le l lf lg">&lt;link rel="stylesheet" href="{{ url_for('static', filename='css/universal.css') }}" /&gt;</span><span id="f663" class="lc ju hi ky b fi lh le l lf lg">&lt;link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"</span><span id="4f4c" class="lc ju hi ky b fi lh le l lf lg">integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="</span><span id="23b4" class="lc ju hi ky b fi lh le l lf lg">crossorigin=""/&gt;</span><span id="88d2" class="lc ju hi ky b fi lh le l lf lg">&lt;script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"</span><span id="3c8c" class="lc ju hi ky b fi lh le l lf lg">integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="</span><span id="6b41" class="lc ju hi ky b fi lh le l lf lg">crossorigin=""&gt;&lt;/script&gt;</span><span id="95ca" class="lc ju hi ky b fi lh le l lf lg">&lt;/head&gt;</span><span id="fd05" class="lc ju hi ky b fi lh le l lf lg">&lt;body&gt;</span><span id="3fe3" class="lc ju hi ky b fi lh le l lf lg">&lt;div id="map"&gt;&lt;/div&gt;</span><span id="d8db" class="lc ju hi ky b fi lh le l lf lg">&lt;script src="{{ url_for('static', filename='js/universal.js') }}" /&gt;&lt;/script&gt;</span><span id="5ab7" class="lc ju hi ky b fi lh le l lf lg">&lt;script&gt;</span><span id="7903" class="lc ju hi ky b fi lh le l lf lg">{% for marker in markers %}</span><span id="3379" class="lc ju hi ky b fi lh le l lf lg">L.marker([{{ marker['lat'] }}, {{ marker['lon'] }}]).addTo(map)</span><span id="5218" class="lc ju hi ky b fi lh le l lf lg">.bindPopup("{{ marker['popup'] }}")</span><span id="8c44" class="lc ju hi ky b fi lh le l lf lg">.openPopup();</span><span id="96cf" class="lc ju hi ky b fi lh le l lf lg">{% endfor %}</span><span id="8ac6" class="lc ju hi ky b fi lh le l lf lg">&lt;/script&gt;</span><span id="bf55" class="lc ju hi ky b fi lh le l lf lg">&lt;/body&gt;</span><span id="29d8" class="lc ju hi ky b fi lh le l lf lg">&lt;/html&gt;</span></pre><p id="7440" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧啊。只有6个文件的免费网络地图。在<a class="ae kw" href="https://github.com/spmcneal/Medium-Flask/tree/main/Flask-Leaflet" rel="noopener ugc nofollow" target="_blank"> github </a>上查看存储库。</p></div></div>    
</body>
</html>