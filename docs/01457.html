<html>
<head>
<title>EDA for Image Classification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于图像分类的EDA</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/eda-for-image-classification-dcada9f2567a?source=collection_archive---------1-----------------------#2021-04-11">https://medium.com/geekculture/eda-for-image-classification-dcada9f2567a?source=collection_archive---------1-----------------------#2021-04-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/bce86d9d374652d886755552b2ec878e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*orwXjJmNu28EcJX3"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@corinarainer?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Corina Rainer</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ba8c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我从事数据科学项目期间，图像分类一直是我最喜欢的项目，但EDA不像其他模型那样简单。我和我的同伴发现自己在谷歌上搜索想法，阅读博客文章，不知道如何前进。我们应该如何分析成千上万的图像来寻找模式或学习…好吧，关于数据集的任何我们不知道的东西？</p><p id="3ea0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这需要回到基础。把我们学过的有趣的、时髦的EDA放在一边，而是把注意力放在会影响整个模型的东西上。我们需要知道什么来确保我们的CNN尽可能好地运行？作为数据科学家，为了更好地理解模型本身，我们需要了解哪些数据？</p><p id="f12d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">识别阶级不平衡</strong></p><p id="2a6a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">识别阶级不平衡是简单的第一步。我们将找到分配给每个类别的图像数量，并将其绘制在条形图中，以便轻松识别任何不平衡。CNN中的不平衡可能导致代表性较低的类的较差性能，从而影响整体性能。</p><p id="872b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">* *以下代码假设您已经根据类别将图像拆分到文件夹中，并为每个目录创建了变量。</p><p id="56b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我们需要创建一个字典，以类名作为键，以图片数量作为值。下面我们从存储图片的文件夹中直接提取一些图片。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="ac66" class="kc kd hi jy b fi ke kf l kg kh">number_classes = {'Class_0': len(os.listdir(healthy_dir)),</span><span id="5e1e" class="kc kd hi jy b fi ki kf l kg kh">'Class_1': len(os.listdir(blight_dir)),</span><span id="9aee" class="kc kd hi jy b fi ki kf l kg kh">'Class_2': len(os.listdir(gray_dir)),</span><span id="0ebd" class="kc kd hi jy b fi ki kf l kg kh">'Class_3': len(os.listdir(rust_dir))}</span></pre><p id="063d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，使用轴的键和值绘制一个简单的条形图。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="6387" class="kc kd hi jy b fi ke kf l kg kh">plt.bar(number_classes.keys(), number_classes.values(), width = .5);</span><span id="5047" class="kc kd hi jy b fi ki kf l kg kh">plt.title("Number of Images by Class");</span><span id="4d4e" class="kc kd hi jy b fi ki kf l kg kh">plt.xlabel('Class Name');</span><span id="b7fe" class="kc kd hi jy b fi ki kf l kg kh">plt.ylabel('# Images');</span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kj"><img src="../Images/3a3113c7fa6133ba82a7020026e01967.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*4AENzwL1JZFyQPvWA2O-cw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">A simple bar chart to quickly identify class imbalance.</figcaption></figure><p id="2306" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">标绘图像尺寸</strong></p><p id="5d00" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一致的图像大小对深度学习至关重要，不匹配的矩阵会让你的项目快速停止。可视化原始图像大小还可以帮助您更好地理解数据集。所以让我们开始吧！</p><p id="558f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将创建另一个简单的字典—您可以创建一个字典用于上面的图表和下面的图表，但我想展示一个不同的选项，它不需要每个文件夹目录都有变量。我们还将设置一个返回图像尺寸的函数。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="d26f" class="kc kd hi jy b fi ke kf l kg kh">directories = {'Class_0': 'data/Class_0/',</span><span id="d292" class="kc kd hi jy b fi ki kf l kg kh">'Class_1': 'data/Class_1/',</span><span id="e112" class="kc kd hi jy b fi ki kf l kg kh">'Class_2': 'data/Class_2/',</span><span id="b6d6" class="kc kd hi jy b fi ki kf l kg kh">'Class_3': 'data/Class_3/'}</span><span id="0341" class="kc kd hi jy b fi ki kf l kg kh"><br/>def get_dims(file):</span><span id="3e44" class="kc kd hi jy b fi ki kf l kg kh">'''Returns dimenstions for an RBG image'''</span><span id="7309" class="kc kd hi jy b fi ki kf l kg kh">im = Image.open(file)</span><span id="889a" class="kc kd hi jy b fi ki kf l kg kh">arr = np.array(im)</span><span id="787e" class="kc kd hi jy b fi ki kf l kg kh">h,w,d = arr.shape</span><span id="1241" class="kc kd hi jy b fi ki kf l kg kh">return h,w</span></pre><p id="7a90" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下一步将创建一个循环，该循环将遍历字典中的文件夹，并返回每个图像的尺寸，这些尺寸将被添加到数据帧中以供绘制。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="f83f" class="kc kd hi jy b fi ke kf l kg kh">for n,d in directories.items():</span><span id="ba15" class="kc kd hi jy b fi ki kf l kg kh">filepath = d</span><span id="b5c9" class="kc kd hi jy b fi ki kf l kg kh">filelist = [filepath + f for f in os.listdir(filepath)]</span><span id="4746" class="kc kd hi jy b fi ki kf l kg kh">dims = bag.from_sequence(filelist).map(get_dims)</span><span id="fc78" class="kc kd hi jy b fi ki kf l kg kh">with diagnostics.ProgressBar():</span><span id="591d" class="kc kd hi jy b fi ki kf l kg kh">dims = dims.compute()<br/></span><span id="bd4e" class="kc kd hi jy b fi ki kf l kg kh">dim_df = pd.DataFrame(dims, columns=['height', 'width'])</span><span id="74a5" class="kc kd hi jy b fi ki kf l kg kh">sizes = dim_df.groupby(['height', 'width']).size().reset_index().rename(columns={0:'count'})</span><span id="73ba" class="kc kd hi jy b fi ki kf l kg kh">sizes.plot.scatter(x='width', y='height');</span><span id="fa0b" class="kc kd hi jy b fi ki kf l kg kh">plt.title('Image Sizes (pixels) | {}'.format(n))</span></pre><div class="jt ju jv jw fd ab cb"><figure class="kk ij kl km kn ko kp paragraph-image"><img src="../Images/c7bee66a74f666a796050bc04bb909a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*CzwIW_gNUuGhy8x8-U_T5Q.png"/></figure><figure class="kk ij kq km kn ko kp paragraph-image"><img src="../Images/865ae1c26ab6408614d7c33580647ec0.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*y7s_7i2vwMzNunpY8g2a2Q.png"/></figure></div><div class="ab cb"><figure class="kk ij kr km kn ko kp paragraph-image"><img src="../Images/5114855c1b02d2f7aeef5e1ac5f68989.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*MAadL1crg9y3IN3-M5WJHQ.png"/></figure><figure class="kk ij kr km kn ko kp paragraph-image"><img src="../Images/a2174ec78127a4d005f232ff424636c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*Oi-L6fBSKqR8iDI-XF24-w.png"/></figure></div><p id="596b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">查看图像样本</strong></p><p id="df00" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，让我们来看看每个班级的一些图片。尽管这对模型本身并不重要，但它将帮助您熟悉数据。您对数据越熟悉，您就越能理解模型输出，从而允许智能迭代，并最终得到更智能的模型。</p><p id="9407" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我想说的是，我的一个了不起的同事写了下面的代码，看看她的中间页面<a class="ae iu" href="https://diane-tunnicliffe.medium.com/" rel="noopener">这里</a>😊</p><p id="1aaa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">设置将迭代文件夹中图像的变量。需要为每个类创建一个变量。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="be8e" class="kc kd hi jy b fi ke kf l kg kh"># Show images displayed 4x4</span><span id="c2dd" class="kc kd hi jy b fi ki kf l kg kh">nrows = 4</span><span id="cf35" class="kc kd hi jy b fi ki kf l kg kh">ncols = 4</span><span id="7e43" class="kc kd hi jy b fi ki kf l kg kh"># Index for iterating over images</span><span id="01c3" class="kc kd hi jy b fi ki kf l kg kh">pic_index = 0</span><span id="4464" class="kc kd hi jy b fi ki kf l kg kh">pic_index += 8</span><span id="7e24" class="kc kd hi jy b fi ki kf l kg kh">next_blight_pix = [os.path.join(blight_dir, fname)</span><span id="aa60" class="kc kd hi jy b fi ki kf l kg kh">for fname in train_blight_names[pic_index-8:pic_index]]</span></pre><p id="def4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">并设置一个函数，创建一个情节来查看我们的图像。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="4492" class="kc kd hi jy b fi ke kf l kg kh">def show_image_sample(pic_directory):<br/>'''display 4x4 images'''</span><span id="0fca" class="kc kd hi jy b fi ki kf l kg kh">fig = plt.gcf()</span><span id="609b" class="kc kd hi jy b fi ki kf l kg kh">fig.set_size_inches(ncols * 4, nrows * 4)</span><span id="82ed" class="kc kd hi jy b fi ki kf l kg kh">for i, img_path in enumerate(pic_directory):</span><span id="6e8f" class="kc kd hi jy b fi ki kf l kg kh">sp = plt.subplot(nrows, ncols, i + 1)</span><span id="5dd1" class="kc kd hi jy b fi ki kf l kg kh">sp.axis('Off')</span><span id="ad32" class="kc kd hi jy b fi ki kf l kg kh">img = mpimg.imread(img_path)</span><span id="3907" class="kc kd hi jy b fi ki kf l kg kh">plt.imshow(img)</span><span id="698e" class="kc kd hi jy b fi ki kf l kg kh">plt.show()</span><span id="7925" class="kc kd hi jy b fi ki kf l kg kh">show_image_sample(Class_0)</span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/685948db6b92d35fc3064e0ba9412425.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cSS9t6fgSAKml6eWRIQmXQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">A sampling of images for each class can teach us a lot! This particular project was to identify disease in corn leaves.</figcaption></figure><p id="14af" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如我们上面看到的，单个类的小样本可以教会我们很多关于数据集的东西。我们可以看到图像有不同的大小和形状，我们也可以看到在这个类中有相当多的变化。背景、亮度、方向等的变化会导致深度学习中的几个问题，我们可以通过查看数据集的这个样本来做好准备。</p><p id="0bf5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">希望这已经给了你一个图像分类EDA的良好开端。感谢阅读，祝你好运！</p></div></div>    
</body>
</html>