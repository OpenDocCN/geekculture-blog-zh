<html>
<head>
<title>Searchable RecyclerView</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可搜索回收视图</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/searchable-recyclerview-e316289edc25?source=collection_archive---------3-----------------------#2021-04-11">https://medium.com/geekculture/searchable-recyclerview-e316289edc25?source=collection_archive---------3-----------------------#2021-04-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div class="er es hg"><img src="../Images/34fe52bdfbf12d8079bc4c9e0abfcdbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/0*Su6ysx5oPk5lDWY1.jpg"/></div><figcaption class="hn ho et er es hp hq bd b be z dx">Searchable RecyclerView</figcaption></figure><div class=""/><p id="b869" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了制作一个可搜索的recycle view，我们需要一个recycle view(duh)和一个接受用户查询的搜索视图(T1)。</p><p id="7a33" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们先设计布局。xml应该是这样的</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="234e" class="jy jz ht ju b fi ka kb l kc kd">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent"<br/>    tools:context=".MainActivity"&gt;<br/><br/>    &lt;androidx.appcompat.widget.SearchView<br/>        android:id="@+id/search_bar"<br/>        android:layout_width="0dp"<br/>        android:layout_height="wrap_content"<br/>        android:layout_margin="@dimen/dimen_12dp"<br/>        app:layout_constraintEnd_toEndOf="parent"<br/>        app:layout_constraintStart_toStartOf="parent"<br/>        app:layout_constraintTop_toTopOf="parent" /&gt;<br/><br/><br/>    &lt;androidx.recyclerview.widget.RecyclerView<br/>        android:id="@+id/city_name_list"<br/>        android:layout_width="0dp"<br/>        android:layout_height="0dp"<br/>        android:layout_margin="@dimen/dimen_12dp"<br/>        app:layout_constraintBottom_toBottomOf="parent"<br/>        app:layout_constraintEnd_toEndOf="parent"<br/>        app:layout_constraintStart_toStartOf="parent"<br/>        app:layout_constraintTop_toBottomOf="@id/search_bar"<br/>        app:layout_constraintVertical_bias="0"<br/>        tools:listitem="@layout/city_name_row_layout" /&gt;<br/><br/>&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span></pre><p id="762a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">列表项的xml布局是:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="aeb2" class="jy jz ht ju b fi ka kb l kc kd">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="wrap_content"<br/>    android:orientation="horizontal"&gt;<br/><br/>    &lt;TextView<br/>        android:id="@+id/city_code"<br/>        android:layout_width="@dimen/dimen_64dp"<br/>        android:layout_height="@dimen/dimen_64dp"<br/>        android:layout_margin="@dimen/dimen_12dp"<br/>        android:background="@drawable/circle_shape"<br/>        android:gravity="center"<br/>        android:padding="@dimen/dimen_12dp"<br/>        android:textColor="@color/grey_text"<br/>        android:textSize="@dimen/text_size_medium_large"<br/>        tools:text="DL" /&gt;<br/><br/>    &lt;TextView<br/>        android:id="@+id/city_name"<br/>        android:layout_width="wrap_content"<br/>        android:layout_height="wrap_content"<br/>        android:layout_gravity="center_vertical"<br/>        android:textColor="@color/grey_text"<br/>        android:textSize="@dimen/text_size_medium"<br/>        tools:text="New Delhi" /&gt;<br/>&lt;/LinearLayout&gt;</span></pre><p id="a492" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这给了我们一个类似这样的布局</p><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es ke"><img src="../Images/eec2330fbbf36ccff9cfcc3aa7eb93c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*ETCI1lGj-IO1sI5hXAdWjw.png"/></div><figcaption class="hn ho et er es hp hq bd b be z dx">Screenshot of Searchable Recyclerview layout</figcaption></figure><p id="6a0b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我假设此时您有一个适配器连接到您的回收器视图。现在，为了能够根据用户输入的查询过滤列表，我们需要一个过滤器。向RecyclerView的适配器添加筛选器</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="dfa7" class="jy jz ht ju b fi ka kb l kc kd">class CityListAdapter(private var cityDataList: ArrayList&lt;CityDataObject&gt;) :<br/>    RecyclerView.Adapter&lt;CityViewHolder&gt;() {<br/><br/>   <strong class="ju hu"><br/><br/>    </strong>override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): CityViewHolder {<br/>        //...<br/>    }<br/><br/>    override fun onBindViewHolder(holder: CityViewHolder, position: Int) {<br/>        //...<br/>    }<br/><br/>    override fun getItemCount(): Int {<br/>        return cityDataList.size<br/>    }<br/><br/>    fun getFilter(): Filter {<br/>        return cityFilter<br/>    }<br/><br/>    private val cityFilter = object : Filter() {<br/>        override fun performFiltering(constraint: CharSequence?): FilterResults {<br/>            val filteredList: ArrayList&lt;CityDataObject&gt; = ArrayList()<br/>            if (constraint == null || constraint.<em class="kf">isEmpty</em>()) {<br/>                cityDataList.<em class="kf">let </em><strong class="ju hu">{ </strong>filteredList.addAll(<strong class="ju hu">it</strong>) <strong class="ju hu">}<br/>            </strong>} else {<br/>                val query = constraint.toString().<em class="kf">trim</em>().<em class="kf">toLowerCase</em>()<br/>                cityDataList.<em class="kf">forEach </em><strong class="ju hu">{<br/>                    </strong>if (<strong class="ju hu">it</strong>.cityName.<em class="kf">toLowerCase</em>(Locale.<em class="kf">ROOT</em>).<em class="kf">contains</em>(query)) {<br/>                        filteredList.add(<strong class="ju hu">it</strong>)<br/>                    }<br/>                <strong class="ju hu">}<br/>            </strong>}<br/>            val results = FilterResults()<br/>            results.values = filteredList<br/>            return results<br/>        }<br/><br/>        override fun publishResults(constraint: CharSequence?, results: FilterResults?) {<br/>            if (results?.values is ArrayList&lt;*&gt;) {<br/>                cityDataList.clear()<br/>                cityDataList.addAll(results.values as ArrayList&lt;CityDataObject&gt;)<br/>                notifyDataSetChanged()<br/>            }<br/>        }<br/>    }<br/>}</span></pre><p id="a299" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在github的<a class="ae jo" href="https://github.com/svvashishtha/searchableRecyclerView/blob/master/app/src/main/java/com/example/recyclerview/CityListAdapter.kt" rel="noopener ugc nofollow" target="_blank"> CityListAdapter </a>的实现中检查这个类。</p><p id="a577" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，为了接受来自用户的查询，我们将一个OnQueryTextListener附加到我们的SearchView，如下所示</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="bd22" class="jy jz ht ju b fi ka kb l kc kd">searchBar.setOnQueryTextListener(object : SearchView.OnQueryTextListener {<br/>    override fun onQueryTextSubmit(query: String?): Boolean {<br/>        adapter?.getFilter()?.filter(query)<br/>        return true<br/>    }<br/><br/>    override fun onQueryTextChange(newText: String?): Boolean {<br/>        adapter?.getFilter()?.filter(newText);<br/>        return true<br/>    }<br/><br/>})</span></pre><p id="a32c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">瞧。您现在有了一个可搜索的RecyclerView。</p><p id="ff5f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">上述代码的问题</strong>:第一次搜索时效果很好，但当你改变查询时就不那么好了。这是因为在过滤器实现中，我们对原始列表进行了更改。现在它只包含第一个查询的搜索结果。</p><p id="2142" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要解决此问题，请创建列表的副本，并在原始列表上发布结果时始终对该副本执行搜索，反之亦然。我在下面强调了需要进行的更改:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="3653" class="jy jz ht ju b fi ka kb l kc kd">package com.example.recyclerview<br/><br/>import android.view.LayoutInflater<br/>import android.view.View<br/>import android.view.ViewGroup<br/>import android.widget.Filter<br/>import android.widget.TextView<br/>import androidx.recyclerview.widget.RecyclerView<br/>import java.util.*<br/>import kotlin.collections.ArrayList<br/><br/>class CityListAdapter(private var cityDataList: ArrayList&lt;CityDataObject&gt;) :<br/>    RecyclerView.Adapter&lt;CityViewHolder&gt;() {<br/><br/>    // Create a copy of localityList that is not a clone<br/>    // (so that any changes in localityList aren't reflected in this                                                           //list)<br/>    <strong class="ju hu">val initialCityDataList = ArrayList&lt;CityDataObject&gt;().<em class="kf">apply </em>{<br/>        cityDataList?.<em class="kf">let </em>{ addAll(it) }<br/>    }<br/><br/>    </strong>override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): CityViewHolder {<br/>//...<br/>    }<br/><br/>    private val cityFilter = object : Filter() {<br/>        override fun performFiltering(constraint: CharSequence?): FilterResults {<br/>            val filteredList: ArrayList&lt;CityDataObject&gt; = ArrayList()<br/>            if (constraint == null || constraint.<em class="kf">isEmpty</em>()) {<br/>                <strong class="ju hu">initialCityDataList</strong>.<em class="kf">let </em><strong class="ju hu">{ </strong>filteredList.addAll(<strong class="ju hu">it</strong>) <strong class="ju hu">}<br/>            </strong>} else {<br/>                val query = constraint.toString().<em class="kf">trim</em>().<em class="kf">toLowerCase</em>()<br/>                <strong class="ju hu">initialCityDataList</strong>.<em class="kf">forEach </em><strong class="ju hu">{<br/>                    </strong>if (<strong class="ju hu">it</strong>.cityName.<em class="kf">toLowerCase</em>(Locale.<em class="kf">ROOT</em>).<em class="kf">contains</em>(query)) {<br/>                        filteredList.add(<strong class="ju hu">it</strong>)<br/>                    }<br/>                <strong class="ju hu">}<br/>            </strong>}<br/>            val results = FilterResults()<br/>            results.values = filteredList<br/>            return results<br/>        }<br/><br/>        override fun publishResults(constraint: CharSequence?, results: FilterResults?) {<br/>            if (results?.values is ArrayList&lt;*&gt;) {<br/>                cityDataList.clear()<br/>                cityDataList.addAll(results.values as ArrayList&lt;CityDataObject&gt;)<br/>                notifyDataSetChanged()<br/>            }<br/>        }<br/>    }<br/>}<br/></span></pre><p id="4f8b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这之后，你的可搜索回收视图应该每次都能工作。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kg"><img src="../Images/83bb16073942eb9a943d9d91f764532f.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/1*jn4pnvsrss0NDl8ngPA98w.gif"/></div></div><figcaption class="hn ho et er es hp hq bd b be z dx">Demo gif of searchable recyclerview</figcaption></figure><p id="53f0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请点击此处查看本文的示例项目:</p><div class="hh hi ez fb hj kl"><a href="https://github.com/svvashishtha/searchableRecyclerView" rel="noopener  ugc nofollow" target="_blank"><div class="km ab dw"><div class="kn ab ko cl cj kp"><h2 class="bd hu fi z dy kq ea eb kr ed ef hs bi translated">svvashishtha/searchableRecyclerView</h2><div class="ks l"><h3 class="bd b fi z dy kq ea eb kr ed ef dx translated">可搜索的回收视图。通过在…上创建帐户，为svvashishtha/searchableRecyclerView开发做出贡献</h3></div><div class="kt l"><p class="bd b fp z dy kq ea eb kr ed ef dx translated">github.com</p></div></div><div class="ku l"><div class="kv l kw kx ky ku kz hl kl"/></div></div></a></div></div><div class="ab cl la lb gp lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="hb hc hd he hf"><p id="54d5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你发现这篇文章/代码有任何问题或者有任何建议，请留下评论。</p></div></div>    
</body>
</html>