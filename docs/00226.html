<html>
<head>
<title>Middleware Components (.Net Core) -Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">中间件组件(。网络核心)-第1部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/middleware-components-part-1-eec773b37b7a?source=collection_archive---------1-----------------------#2020-11-19">https://medium.com/geekculture/middleware-components-part-1-eec773b37b7a?source=collection_archive---------1-----------------------#2020-11-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/69a17b5755e79fd45743eb55ca211490.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QrvNbREamXEPMPPSZ71QiQ.png"/></div></div></figure><p id="44b0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">来自ASP.Net web forms和ASP.Net MVC的背景，其中一个主要的特点让我印象深刻。Net核心是中间件组件<strong class="is hj">。如果您使用过早期版本的。Net，在Core之前，您可能听说过http处理程序和模块(尽管我花了很长时间才学会)。嗯，在。Net核心，它们被替代了，取而代之的是一个单一的实体，它被称为“中间件组件”。因此，它们可以被视为我们可以用来拦截请求、在请求通过系统时对其进行修改的东西，也可以用来改变响应。简单地说，排列成链的中间件组件形成了请求管道。</strong></p><p id="7a3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">中间件组件是在“StartUp”类的“Configure”方法中编写(或注册)的。</p><p id="4baa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">主要有两种中间件组件。标准(内置)和定制中间件组件。</p><p id="eff7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看看一些标准的(它们也很容易理解)。</p><ol class=""><li id="0883" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated"><strong class="is hj">欢迎页面中间件</strong></li></ol><p id="b086" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以为我们的创建一个简单的欢迎页面。Net核心app，使用“WelcomePageMiddleware”。当您第一次设置应用程序时，这是很方便的，可以确保处理请求时没有任何问题。</p><p id="46e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在startup类的“Configure”方法中，替换所有默认代码，只放置app。UseWelcomePage()；</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jx"><img src="../Images/f7f3418e5ab7dce3cc269c22a013111f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oE5aoRca9qL4CkpP45NqwA.png"/></div></div></figure><p id="0cb2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">(正如我在之前的博文中提到的。Net核心应用程序是高度模块化的。如果我们只是想要一个简单的欢迎页面，那么我们不需要用MVC或Web API组件的所有负担来启动应用程序。我们可以在需要的时候添加这些东西)</p><p id="d148" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们现在运行应用程序，我们可以看到一个简单但漂亮的欢迎页面</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kc"><img src="../Images/83172562cfa2b766061dda8edb7b5bf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LweQ7sS6WlF1gDg0uQmzQQ.png"/></div></div></figure><p id="0661" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.<strong class="is hj">静态文件中间件</strong></p><p id="3d6f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个中间件组件用在一个应用程序中，该应用程序在被请求时只提供wwwroot文件夹中的静态文件。例如，我创建了一个名为somemessage.html的静态html文件，并将它放在wwwroots文件夹中。我还更新了<strong class="is hj">配置</strong>方法，如下所示:</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/4961434b79f2f75d6c7a32f26b1d9579.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A7acmVvxt51BrU2wQFOQ1Q.png"/></div></div></figure><p id="6f16" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我们点击F5时，我们可以看到如下结果:</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div class="er es ke"><img src="../Images/9f722e64397e6c96a4f39713061bd8a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*SrBGS5hVCG05QxwRILDO_g.png"/></div></figure><p id="8217" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.<strong class="is hj">状态卸载中间件</strong></p><p id="b138" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当服务器端发生一些灾难性错误而没有得到处理时，我们通常会看到500内部服务器错误，或者当用户发送无效请求时，我们会看到404 Not found错误。如果没有正确地处理这些错误，最终用户会感到困惑，并可能认为应用程序坏了。</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kf"><img src="../Images/8a3caf15460c1e4126d4014db3727b76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hZUhEj3Jns9zBvq7gA_4mQ.png"/></div></div></figure><p id="da7d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这种情况下，我们可以使用statuscodepagesmiddleware来显示友好的错误代码，如下所示。</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kg"><img src="../Images/1fd29105b2622b00033a954db7de00cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AJanJm3EX3i4pJAkw2pB7A.png"/></div></div></figure><p id="0fe7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.<strong class="is hj"> DeveloperException页面中间件</strong></p><p id="33c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您处于应用程序的开发阶段时，您希望在发生错误时获得尽可能多的信息。这个中间件正好给了你这个。出于演示目的，我建立了一个示例MVC应用程序，并故意引入了一个空引用异常。</p><p id="1fb5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，我将向您展示有/没有DeveloperExceptionPage中间件的情况。</p><p id="10c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">a)不带DeveloperExceptionPage</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kh"><img src="../Images/fb121ffd0d6b7ddbf92a8b03c608cf13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zu1iGLEBMShYLdW2csuLxg.png"/></div></div></figure><p id="5a33" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出是:</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ki"><img src="../Images/9496d9ac2210fc523eb67e585e3efdf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BvRGijyDa3yi8LqpF4NxTA.png"/></div></div></figure><p id="c032" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，我们只是得到一个500内部错误。没有具体细节。现在让我们看看另一个案例</p><p id="a11d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">b)使用DeveloperExceptionPage</p><p id="38b1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里我取消了UseDeveloperExceptionPage()方法的注释。</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kj"><img src="../Images/9ab8ce9abfbdeec927ef1508713b2625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KYfkKj93sa1FRoLfNWo9BQ.png"/></div></div></figure><p id="f31e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是输出结果:</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/e6162d90bdf3602073b2ff38eb82a3ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x2pIo3oR3Kl0NoOrG93WBg.png"/></div></div></figure><p id="5de0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我认为照片本身是不言自明的。在这里，我们以直观的方式获得了异常的完整细节，包括堆栈跟踪。</p><p id="45a3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.<strong class="is hj">生产中的异常HandlerMiddleware。</strong></p><p id="f425" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您处于应用程序的开发阶段时，DeveloperExceptionMiddleware非常方便。但是一旦app被推送到生产端呢？透露错误的详细信息对恶意攻击者非常有用。为了解决这个问题，我们可以使用ExceptionHandlerMiddleware。如果生产中出现错误，用户将被重定向到预定义的错误页面(不显示堆栈跟踪等)，这在外观上与应用程序的其他部分一致。为此，我们只需要在Configure方法中进行微小的修改。</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/0c3bdd5e2319bfd90a05348edf0b1e83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bOWRvix4WLjf2SW5kb28yQ.png"/></div></div></figure><h1 id="e170" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">结论:</h1><p id="6051" class="pw-post-body-paragraph iq ir hi is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hb bi translated">嗯，对于中间件组件来说，这是一个卑微的开始。让我们在下一篇文章中看看如何创建定制的中间件组件。</p><p id="5afc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢阅读！</p></div></div>    
</body>
</html>