<html>
<head>
<title>Dgraph I: Introduction to Dgraph</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">d graph I:d graph简介</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/dgraph-i-introduction-to-dgraph-2fcf00466f3f?source=collection_archive---------20-----------------------#2021-07-27">https://medium.com/geekculture/dgraph-i-introduction-to-dgraph-2fcf00466f3f?source=collection_archive---------20-----------------------#2021-07-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7996" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你好，这是关于Dgraph的介绍帖。在这篇文章中，我将简单介绍一下在it中突变和查询是如何工作的。</p><p id="d6ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Dgraph代表<strong class="ih hj"> D </strong>分布的<strong class="ih hj">图。它是由Dgraph实验室开发的。目前，开源和完全是用Golang编写的。</strong></p><h1 id="d6a3" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">设计</h1><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kb"><img src="../Images/372be29eaa55051ed860b05b571e3862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-2CCjZV2Uh48Nyd7.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Dgraph High-Level Overview of Different Components, credit: Dgraph White Paper</figcaption></figure><p id="efb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有两种类型的组件。</p><p id="a862" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">零</strong>，以Raft组号命名的管理服务器，是零组的一部分。在其他组中，运行一种不同类型的服务器，称为<strong class="ih hj"> Alpha </strong>。在典型的设置中，应该只有一个零组和至少一个alpha组。</p><p id="9760" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据高可用性要求，每个组应该有一个领导者，其余的零个或多个副本/追随者。图中，<strong class="ih hj"> L </strong>表示领导者，<strong class="ih hj"> F </strong>表示跟随者。根据可伸缩性要求，可以在单个机器/节点或多个机器/节点中设置每个组及其关联的领导者、追随者。</p><p id="0165" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每组使用Raft协议与另一组通信。每个领导者、跟随者也使用Raft协议相互通信，用于复制、故障转移等。</p><p id="05bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应用程序<strong class="ih hj">客户端</strong>将查询/变异到仅一个阿尔法组领导者以获得应用程序数据。</p><blockquote class="kr ks kt"><p id="0d48" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">组的总数限制为2 -1。</p></blockquote></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><p id="f35c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们详细讨论一下这些组件</p><h2 id="382f" class="lf je hi bd jf lg lh li jj lj lk ll jn iq lm ln jr iu lo lp jv iy lq lr jz ls bi translated">零</h2><p id="2ab0" class="pw-post-body-paragraph if ig hi ih b ii lt ik il im lu io ip iq lv is it iu lw iw ix iy lx ja jb jc hb bi translated">如前所述，Zero是一个管理服务器，其职责如下:</p><ul class=""><li id="79d4" class="ly lz hi ih b ii ij im in iq ma iu mb iy mc jc md me mf mg bi translated">跟踪所有Alpha组的数据。</li><li id="0113" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">负责Alpha组之间的数据移动。</li><li id="ea75" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">负责分发node<strong class="ih hj">u</strong>nique<strong class="ih hj">id</strong>s。</li><li id="304b" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">维护<a class="ae mm" href="https://en.wikipedia.org/wiki/Lamport_timestamp" rel="noopener ugc nofollow" target="_blank">逻辑时间戳</a>并将它们交给Alphas。分布式事务所需的。</li></ul><h2 id="0aea" class="lf je hi bd jf lg lh li jj lj lk ll jn iq lm ln jr iu lo lp jv iy lq lr jz ls bi translated"><strong class="ak">阿尔法</strong></h2><p id="f234" class="pw-post-body-paragraph if ig hi ih b ii lt ik il im lu io ip iq lv is it iu lw iw ix iy lx ja jb jc hb bi translated">Alpha group管理应用程序数据，是任何应用程序客户的联系点。无论哪个阿尔法小组管理哪个应用程序数据，客户都可以与任何阿尔法小组负责人交谈。</p><ul class=""><li id="86be" class="ly lz hi ih b ii ij im in iq ma iu mb iy mc jc md me mf mg bi translated">使用键值存储来存储应用程序数据。</li><li id="4f7d" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">借助Zero跟踪交易。</li><li id="aa9e" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">客户端与其中一个Alpha组就突变或查询进行对话。</li></ul></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><p id="8f20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们以一所大学为例，我们需要显示教授和学生之间的关系，并讨论alpha如何处理突变和查询。</p><h2 id="a0a3" class="lf je hi bd jf lg lh li jj lj lk ll jn iq lm ln jr iu lo lp jv iy lq lr jz ls bi translated">教授-学生网络</h2><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mn"><img src="../Images/2070c3443fd69054baf864b1bf772908.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*_EMMR7Ad2117XqWOdXObtQ.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx">Professor-Student Relationship</figcaption></figure><p id="c30b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的例子中，教授-学生网络由学生和教授之间的关系组成。在这个例子中，一位教授教学生1和学生2。</p><p id="18e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">数据表示</strong></p><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mn"><img src="../Images/ef16dfa0c02fb17d6db348db2ec4306e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*brDAaY8_J7wY7T15NCbqbA.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx">Professor-Student Relationship Dgraph Triples Presentation</figcaption></figure><p id="799f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Dgraph中，数据呈现为<strong class="ih hj">主谓宾</strong>。在这个图像中，主语是教授，谓语是教师，宾语是学生。这里有一些关于这些的事实</p><ul class=""><li id="3974" class="ly lz hi ih b ii ij im in iq ma iu mb iy mc jc md me mf mg bi translated"><strong class="ih hj">主题</strong>总是由<strong class="ih hj"> u </strong> nique <strong class="ih hj"> id唯一标识的节点。</strong></li><li id="b275" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated"><strong class="ih hj">谓词</strong>总是表示一个关系，因此属于类型<strong class="ih hj">字符串。</strong></li><li id="74f9" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated"><strong class="ih hj">对象</strong>可以是另一个节点(即<strong class="ih hj"> u </strong> nique <strong class="ih hj"> id </strong>)或另一个原始数据类型的<strong class="ih hj">属性</strong>(通常是golang原始数据类型，因为Dgraph是用GoLang编写的)</li></ul><p id="ee09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">关系数据库类比</strong></p><p id="aa41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于Postgres订单表</p><pre class="kc kd ke kf fd mo mp mq mr aw ms bi"><span id="1b82" class="lf je hi mp b fi mt mu l mv mw">+-----------+--------------------+---------------+<br/>| prof_id   | subject_expert     |  student      |<br/>+-----------+--------------------+---------------+<br/>| prof_id_1 | Maths              | student_123   |<br/>| prof_id_2 | Computer Science   | student_124   |<br/>+-----------+--------------------+---------------+</span></pre><p id="0622" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，对于每一列<strong class="ih hj">主题专家，</strong>每行将有以下三元组。</p><p id="adfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">教授(uid)——&gt;学科专家——&gt;数学</strong></p><blockquote class="kr ks kt"><p id="7f70" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">这里，uid将从prof_id派生，但由Dgraph生成。</p></blockquote><p id="11ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果引用外键<strong class="ih hj">付款人</strong>的列，每行将有以下三元组。</p><p id="56cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">教授(uid)——&gt;教师——&gt;学生(uid) </strong></p><blockquote class="kr ks kt"><p id="71c7" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">这里，Professor(uid)，Student(uid)将分别从prof_id和student_id派生，但由Dgraph生成。</p></blockquote></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><h2 id="701d" class="lf je hi bd jf lg lh li jj lj lk ll jn iq lm ln jr iu lo lp jv iy lq lr jz ls bi translated">突变</h2><p id="0e94" class="pw-post-body-paragraph if ig hi ih b ii lt ik il im lu io ip iq lv is it iu lw iw ix iy lx ja jb jc hb bi translated">任何客户端都可以使用Dgraph查询语言(GraphQL的修改版本)与Dgraph进行通信。在DQL，客户端可以将数据以JSON格式或RDF Nquad格式发送给alpha。在收到一个DQL请求后，Dgraph将该请求分成三部分。</p><p id="8289" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个教授的JSON表示应该是这样的</p><pre class="kc kd ke kf fd mo mp mq mr aw ms bi"><span id="9b00" class="lf je hi mp b fi mt mu l mv mw">{</span><span id="15a5" class="lf je hi mp b fi mx mu l mv mw">  "uid": "0xab1e89c",</span><span id="33fa" class="lf je hi mp b fi mx mu l mv mw">  "Professor.Name": "Radeash",</span><span id="02d8" class="lf je hi mp b fi mx mu l mv mw">  "Professor.SubjectExpert": "Maths",</span><span id="3fb2" class="lf je hi mp b fi mx mu l mv mw">  "Professor.JoinedDate": "2021-03-24T10:33:06Z",</span><span id="da21" class="lf je hi mp b fi mx mu l mv mw">  "Professor.Student": [{"uid": "0x71de296"...}...],</span><span id="8737" class="lf je hi mp b fi mx mu l mv mw">  "Professor.Student": [{"uid": "0x71ac27e"...}...]</span><span id="f194" class="lf je hi mp b fi mx mu l mv mw">}</span></pre><p id="30b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同样可以用RDF格式表示为</p><pre class="kc kd ke kf fd mo mp mq mr aw ms bi"><span id="ac18" class="lf je hi mp b fi mt mu l mv mw">&lt;0xab1e89c&gt; &lt;Professor.Name&gt; "Radeash" .</span><span id="693f" class="lf je hi mp b fi mx mu l mv mw">&lt;0xab1e89c&gt; &lt;Professor.SubjectExpert&gt; "Maths" .</span><span id="4512" class="lf je hi mp b fi mx mu l mv mw">&lt;0xab1e89c&gt; &lt;Professor.JoinedDate&gt; "2021-03-24T10:33:06Z" .</span><span id="99bd" class="lf je hi mp b fi mx mu l mv mw">&lt;0xab1e89c&gt; &lt;Professor.Student&gt; &lt;0x71de296&gt; .</span><span id="8280" class="lf je hi mp b fi mx mu l mv mw">&lt;0xab1e89c&gt; &lt;Professor.Student&gt; &lt;0x71ac27e&gt; .</span></pre><blockquote class="kr ks kt"><p id="8e23" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">uid是golang无符号整数(uint64)类型。</p></blockquote><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mn"><img src="../Images/82c939daec9c84c5949a448b208a99ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*kkHb8geaRLW0Jy-S3nt1VA.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx">Professor-Student Relationship Dgraph Presentation</figcaption></figure><p id="198d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">边缘是有方向的。要创建双向边，请使用反向边。客户不需要在图中创建每个单独的反向边，它只需要通知图。</p><p id="7418" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">模式</strong></p><p id="120a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Dgraph提供了对模式的支持，但这并不是获取数据的必要条件。在编写优化的查询时，模式很有帮助。</p><pre class="kc kd ke kf fd mo mp mq mr aw ms bi"><span id="c5e5" class="lf je hi mp b fi mt mu l mv mw">type &lt;Student&gt; {<br/>  Student.Name<br/>  &lt;~Professor.Teaches&gt;<br/>}<br/>type &lt;Professor&gt; {<br/>  Professor.Name<br/>  Professor.SubjectExpert<br/>  Professor.JoinedDate<br/>  Professor.Teaches<br/>}</span></pre><p id="b6d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">存储引擎</strong></p><p id="53be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦DQL查询到达Alpha，Alpha会将查询分解成三元组，并将其转换为协议缓冲区数据。</p><p id="666a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如前所述，数据存储在一个名为Badger的嵌入式键值数据库中，用于磁盘上的数据输入输出。</p><p id="0776" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了简单起见，让我们看看Alpha如何使用三元组高效地存储数据。</p><p id="ab64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们假设一位教授是多个学科的专家，因此RDF格式的相应三元组如下所示:</p><pre class="kc kd ke kf fd mo mp mq mr aw ms bi"><span id="9e5b" class="lf je hi mp b fi mt mu l mv mw">&lt;0x01&gt; &lt;Professor.SubjectExpert&gt; "Maths" .</span><span id="1252" class="lf je hi mp b fi mx mu l mv mw">&lt;0x01&gt; &lt;Professor.SubjectExpert&gt; "Computer Science" .</span><span id="10d4" class="lf je hi mp b fi mx mu l mv mw">&lt;0x01&gt; &lt;Professor.SubjectExpert&gt; "Biology" .</span></pre><p id="54ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，Dgraph将这些数据以键值格式压缩为</p><p id="d2c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">关键</strong> : &lt;谓语，主语&gt;</p><p id="388a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">值</strong>:排序压缩列表(&lt;对象&gt;)</p><p id="332b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，上面一组特定教授的三元组看起来会像</p><pre class="kc kd ke kf fd mo mp mq mr aw ms bi"><span id="b243" class="lf je hi mp b fi mt mu l mv mw">key = &lt;Professor.SubjectExpert, 0x01&gt;</span><span id="10b7" class="lf je hi mp b fi mx mu l mv mw">value = &lt;"Maths", "Computer Science", "Biology", ...&gt;</span></pre><p id="492b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同样地，陶教授也教育多个学生。RDF三元组看起来像</p><pre class="kc kd ke kf fd mo mp mq mr aw ms bi"><span id="acf0" class="lf je hi mp b fi mt mu l mv mw">&lt;0x02&gt; &lt;Professor.Teaches&gt; &lt;0xab&gt; .</span><span id="1b2d" class="lf je hi mp b fi mx mu l mv mw">&lt;0x02&gt; &lt;Professor.Teaches&gt; &lt;0xbc&gt; .</span><span id="1c07" class="lf je hi mp b fi mx mu l mv mw">&lt;0x02&gt; &lt;Professor.Teaches&gt; &lt;0xcd&gt; .</span></pre><p id="c7ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">相应的存储键值将如下所示</p><pre class="kc kd ke kf fd mo mp mq mr aw ms bi"><span id="783d" class="lf je hi mp b fi mt mu l mv mw">key = &lt;Professor.Teaches, 0x02&gt;</span><span id="c599" class="lf je hi mp b fi mx mu l mv mw">value = &lt;0xab, 0xbc, 0xcd, ...&gt;</span></pre><blockquote class="kr ks kt"><p id="7f23" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">该键值仅用于表示目的，如果对象是另一个节点/主题(排序整数编码)，Dgraph会进一步压缩数据。</p></blockquote><p id="159f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">数据分片</strong></p><p id="8a40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">没有分片就谈不上分布式数据库。Dgraph智能分片数据，减少不同Alpha组之间的网络跳数。</p><ul class=""><li id="c392" class="ly lz hi ih b ii ij im in iq ma iu mb iy mc jc md me mf mg bi translated">基于谓词对数据进行分片。</li><li id="a282" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">每个碎片都属于一个阿尔法小组。</li><li id="81dd" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">如果一个分片在一个组中变得太大，Zero会基于不同的策略(比如分片大小、查询频率等)在可用的Alpha组中开始分片移动。</li></ul><blockquote class="kr ks kt"><p id="6096" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">默认情况下，zero配置了分片大小策略。虽然我自己没有验证过。</p></blockquote><p id="96f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的例子中，所有的数据都与谓词<strong class="ih hj">顺序有关。付款人</strong>将位于单个Alpha组中。</p><p id="9be1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">关系数据库类比:</strong>一个列由一个分片表示。</p></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><h2 id="fb0e" class="lf je hi bd jf lg lh li jj lj lk ll jn iq lm ln jr iu lo lp jv iy lq lr jz ls bi translated">问题</h2><p id="f11d" class="pw-post-body-paragraph if ig hi ih b ii lt ik il im lu io ip iq lv is it iu lw iw ix iy lx ja jb jc hb bi translated">一个典型的Dgraph查询可以找到许多Alphas，这取决于谓词的位置。每个查询被细分为任务，每个任务负责一个谓词。</p><p id="d36c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要编写任何查询，您应该熟悉以下内容:</p><p id="c6b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">函数</strong>:当全局uid空间需要限制在一个小集合(甚至单个uid)时，提供一种简单的方法来查询Dgraph。例如:eq、has、ge、gt等。</p><p id="7e54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">过滤器/交叉点</strong>:组合多个函数来检索特定数据的方法。例如:AND、OR、NOT等。</p><p id="1ca6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">索引</strong></p><p id="bd6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了提供更好的查询性能，Dgraph提供了原始数据类型(string、DateTime、bool等)的索引。).</p><blockquote class="kr ks kt"><p id="b7ce" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">索引仅适用于原始数据类型，因此仅适用于三元组的<strong class="ih hj">对象</strong>。</p></blockquote><p id="33d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">函数使用索引来查找使用值的节点。不同的类型支持不同类型的索引。例如，支持字符串类型的子字符串索引，而对于整数类型，只支持全整数搜索。(查看更多示例<a class="ae mm" href="https://dgraph.io/docs/query-language/schema/#indexing" rel="noopener ugc nofollow" target="_blank">此处</a>)</p><p id="2879" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">索引的存储方式类似于数据的存储方式:</p><p id="0774" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">键</strong> : &lt;谓词，令牌(数据)&gt;</p><p id="f0e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">值</strong> : uids</p><p id="0ad0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里的令牌是从数据中导出的。例如，在散列的情况下，index token(data)返回数据的散列。</p><p id="a795" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">示例:prof-id上的散列索引</strong></p><p id="def2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于给定的教授姓名</p><pre class="kc kd ke kf fd mo mp mq mr aw ms bi"><span id="2c53" class="lf je hi mp b fi mt mu l mv mw">&lt;0x01&gt; &lt;Professor.Name&gt; "Radeash" .</span><span id="54e8" class="lf je hi mp b fi mx mu l mv mw">&lt;0x02&gt; &lt;Professor.Name&gt; "Kateash" .</span><span id="b010" class="lf je hi mp b fi mx mu l mv mw">&lt;0x03&gt; &lt;Professor.Name&gt; "Laceash" .</span></pre><p id="41e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们想使用order-id有效地找到一个节点/uid，下面的索引应该存在。</p><pre class="kc kd ke kf fd mo mp mq mr aw ms bi"><span id="a49f" class="lf je hi mp b fi mt mu l mv mw">key = &lt;Professor.Name, hash(Radeash)&gt;<br/>value = &lt;0x01&gt;<br/><br/>key = &lt;Professor.Name, hash(Kateash)&gt;<br/>value = &lt;0x02&gt;<br/><br/>key = &lt;Professor.Name, hash(Laceash)&gt;<br/>value = &lt;0x03&gt;</span></pre><p id="9db0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">查询执行</strong></p><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mn"><img src="../Images/82c939daec9c84c5949a448b208a99ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*kkHb8geaRLW0Jy-S3nt1VA.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx">Professor-Student Relationship Dgraph Presentation</figcaption></figure><p id="267f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设我们想要在给定的图中找到给定的教授是否存在，并找到像SubjectExpert这样的节点的其他属性。</p><p id="d5ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">类似于基本SQL语法(选择和查询)的查询如下所示:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es my"><img src="../Images/a354d9dfe8a05b94941de04c5d4817e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yaH7hcV9xuFjemKshpAt6Q.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">A sample DQL statement with SELECT and QUERY similarity with SQL statement</figcaption></figure><pre class="kc kd ke kf fd mo mp mq mr aw ms bi"><span id="254d" class="lf je hi mp b fi mt mu l mv mw">{<br/>  node(func: eq(Professor.Name, ["Radeash", "Kateash"])){<br/>    Professor.SubjectExpert<br/>    Professor.Name<br/>  }<br/>}</span></pre><p id="f716" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它是如何在阿尔法小组中运行的？专家和教授。名字碎片出现在两个不同的阿尔法群体中？</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mz"><img src="../Images/0b25fe1633d9a8a91b3fd6ada9f37e54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bv78KdXtBW5x2EeIkwhvTA.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Query Exection Across Different Alpha Groups</figcaption></figure><p id="da9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">查询执行步骤</strong></p><blockquote class="kr ks kt"><p id="6724" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">对于给定的教授姓名(“Radeash”、“Kateash”)</p><p id="fe07" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">→从教授姓名中找出相应的标记</p><p id="4d10" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">→从这些令牌中找到相应的uid(本例中为hash)</p><p id="cbd1" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">→对于每个请求的谓词，并行运行每个uid</p><p id="3384" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">→教授。名字</p><p id="66e1" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">→找到它的碎片</p><p id="1a7b" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">→找到该碎片所属的阿尔法组</p><p id="196d" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">→将该特定任务发送到那里。</p><p id="009d" class="if ig ku ih b ii ij ik il im in io ip kv ir is it kw iv iw ix kx iz ja jb jc hb bi translated">→组合每个uid的所有谓词的结果</p></blockquote><h1 id="83fc" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">参考</h1><ul class=""><li id="d880" class="ly lz hi ih b ii lt im lu iq na iu nb iy nc jc md me mf mg bi translated"><a class="ae mm" href="https://github.com/dgraph-io/dgraph/blob/master/paper/dgraph.pdf" rel="noopener ugc nofollow" target="_blank"> Dgraph白皮书</a></li><li id="b970" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated"><a class="ae mm" href="https://dgraph.io/docs/" rel="noopener ugc nofollow" target="_blank">图形文件</a></li></ul></div></div>    
</body>
</html>