<html>
<head>
<title>How to deploy a three-tier architecture in AWS using Terraform?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Terraform在AWS中部署三层架构？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-deploy-a-three-tier-architecture-in-aws-using-terraform-e5dfd7b6d38f?source=collection_archive---------1-----------------------#2021-10-05">https://medium.com/geekculture/how-to-deploy-a-three-tier-architecture-in-aws-using-terraform-e5dfd7b6d38f?source=collection_archive---------1-----------------------#2021-10-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="9dbc" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">什么是Terraform？</h1><p id="44c4" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Terraform是一个开源的基础设施代码(IAC)工具，允许创建、管理和部署生产就绪环境。Terraform将云API编码成声明性的配置文件。Terraform可以管理现有的服务提供商和定制的内部解决方案。</p><p id="5b30" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">从<a class="ae kg" href="https://www.terraform.io/intro/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj">这里</strong> </a>阅读更多关于地形的信息</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/5fa902631019022d57bad06ecc320940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UqJYKOh7oup4qhrn.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">Terraform</figcaption></figure><p id="3b22" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在本教程中，我将使用Terraform在AWS中部署一个三层应用程序。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kx"><img src="../Images/adbfea8134647740796c4c734b564e7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CqUoNdOwnB0ZKRfK.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">Three-Tier Architecture</figcaption></figure><h1 id="1274" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">先决条件:</h1><ul class=""><li id="1fea" class="ky kz hi jf b jg jh jk jl jo la js lb jw lc ka ld le lf lg bi translated"><strong class="jf hj"> AWS </strong> &amp; <strong class="jf hj">地形</strong>的基础知识</li><li id="f054" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka ld le lf lg bi translated">AWS帐户</li><li id="6d4d" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka ld le lf lg bi translated"><strong class="jf hj"> AWS访问</strong> &amp; <strong class="jf hj">密钥</strong></li></ul><blockquote class="lm ln lo"><p id="624e" class="jd je lp jf b jg kb ji jj jk kc jm jn lq kd jq jr lr ke ju jv ls kf jy jz ka hb bi translated">在这个项目中，我使用了一些变量，我将在本文后面讨论。</p></blockquote><p id="0dcf" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">第一步:- </strong>为<strong class="jf hj"> VPC </strong>创建一个文件</p><ul class=""><li id="4b70" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">创建<code class="du lw lx ly lz b">vpc.tf</code>文件并将下面的代码添加到其中</li></ul><pre class="ki kj kk kl fd ma lz mb mc aw md bi"><span id="c8ef" class="me ig hi lz b fi mf mg l mh mi"># Creating VPC<br/>resource "aws_vpc" "demovpc" {<br/>  cidr_block       = "${var.vpc_cidr}"<br/>  instance_tenancy = "default"tags = {<br/>    Name = "Demo VPC"<br/>  }<br/>}</span></pre><p id="7ff4" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">步骤2:- </strong>为<strong class="jf hj">子网</strong>创建一个文件</p><ul class=""><li id="e2aa" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">对于这个项目，我将为前端层和后端层创建总共6个子网，混合使用公共和私有子网</li><li id="7a64" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka ld le lf lg bi translated">创建<code class="du lw lx ly lz b">subnet.tf</code>文件，并将下面的代码添加到其中</li></ul><pre class="ki kj kk kl fd ma lz mb mc aw md bi"><span id="6e2b" class="me ig hi lz b fi mf mg l mh mi"># Creating 1st web subnet <br/>resource "aws_subnet" "public-subnet-1" {<br/>  vpc_id                  = "${aws_vpc.demovpc.id}"<br/>  cidr_block             = "${var.subnet_cidr}"<br/>  map_public_ip_on_launch = true<br/>  availability_zone = "us-east-1a"</span><span id="7f6d" class="me ig hi lz b fi mj mg l mh mi">tags = {<br/>    Name = "Web Subnet 1"<br/>  }<br/>}</span><span id="9692" class="me ig hi lz b fi mj mg l mh mi"># Creating 2nd web subnet <br/>resource "aws_subnet" "public-subnet-2" {<br/>  vpc_id                  = "${aws_vpc.demovpc.id}"<br/>  cidr_block             = "${var.subnet1_cidr}"<br/>  map_public_ip_on_launch = true<br/>  availability_zone = "us-east-1b"</span><span id="8137" class="me ig hi lz b fi mj mg l mh mi">tags = {<br/>    Name = "Web Subnet 2"<br/>  }<br/>}</span><span id="0f0f" class="me ig hi lz b fi mj mg l mh mi"># Creating 1st application subnet <br/>resource "aws_subnet" "application-subnet-1" {<br/>  vpc_id                  = "${aws_vpc.demovpc.id}"<br/>  cidr_block             = "${var.subnet2_cidr}"<br/>  map_public_ip_on_launch = false<br/>  availability_zone = "us-east-1a"</span><span id="70dc" class="me ig hi lz b fi mj mg l mh mi">tags = {<br/>    Name = "Application Subnet 1"<br/>  }<br/>}</span><span id="ae55" class="me ig hi lz b fi mj mg l mh mi"># Creating 2nd application subnet <br/>resource "aws_subnet" "application-subnet-2" {<br/>  vpc_id                  = "${aws_vpc.demovpc.id}"<br/>  cidr_block             = "${var.subnet3_cidr}"<br/>  map_public_ip_on_launch = false<br/>  availability_zone = "us-east-1b"</span><span id="01a3" class="me ig hi lz b fi mj mg l mh mi">tags = {<br/>    Name = "Application Subnet 2"<br/>  }<br/>}</span><span id="666b" class="me ig hi lz b fi mj mg l mh mi"># Create Database Private Subnet<br/>resource "aws_subnet" "database-subnet-1" {<br/>  vpc_id            = "${aws_vpc.demovpc.id}"<br/>  cidr_block        = "${var.subnet4_cidr}"<br/>  availability_zone = "us-east-1a"</span><span id="d32d" class="me ig hi lz b fi mj mg l mh mi">tags = {<br/>    Name = "Database Subnet 1"<br/>  }<br/>}</span><span id="479c" class="me ig hi lz b fi mj mg l mh mi"># Create Database Private Subnet<br/>resource "aws_subnet" "database-subnet-2" {<br/>  vpc_id            = "${aws_vpc.demovpc.id}"<br/>  cidr_block        = "${var.subnet5_cidr}"<br/>  availability_zone = "us-east-1a"</span><span id="a041" class="me ig hi lz b fi mj mg l mh mi">tags = {<br/>    Name = "Database Subnet 1"<br/>  }<br/>}</span></pre><p id="83eb" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">步骤3:- </strong>为<strong class="jf hj">互联网网关</strong>创建一个文件</p><ul class=""><li id="3c13" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">创建<code class="du lw lx ly lz b">igw.tf</code>文件，并添加以下代码</li></ul><pre class="ki kj kk kl fd ma lz mb mc aw md bi"><span id="be0b" class="me ig hi lz b fi mf mg l mh mi"># Creating Internet Gateway <br/>resource "aws_internet_gateway" "demogateway" {<br/>  vpc_id = "${aws_vpc.demovpc.id}"<br/>}</span></pre><p id="7541" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">第四步:- </strong>为<strong class="jf hj">路由表</strong>创建一个文件</p><ul class=""><li id="5536" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">创建<code class="du lw lx ly lz b">route_table_public.tf</code>文件，并将下面的代码添加到其中</li></ul><pre class="ki kj kk kl fd ma lz mb mc aw md bi"><span id="8c07" class="me ig hi lz b fi mf mg l mh mi"># Creating Route Table<br/>resource "aws_route_table" "route" {<br/>    vpc_id = "${aws_vpc.demovpc.id}"</span><span id="8606" class="me ig hi lz b fi mj mg l mh mi">route {<br/>        cidr_block = "0.0.0.0/0"<br/>        gateway_id = "${aws_internet_gateway.demogateway.id}"<br/>    }</span><span id="7aca" class="me ig hi lz b fi mj mg l mh mi">tags = {<br/>        Name = "Route to internet"<br/>    }<br/>}</span><span id="c06a" class="me ig hi lz b fi mj mg l mh mi"># Associating Route Table<br/>resource "aws_route_table_association" "rt1" {<br/>    subnet_id = "${aws_subnet.demosubnet.id}"<br/>    route_table_id = "${aws_route_table.route.id}"<br/>}</span><span id="7a97" class="me ig hi lz b fi mj mg l mh mi"># Associating Route Table<br/>resource "aws_route_table_association" "rt2" {<br/>    subnet_id = "${aws_subnet.demosubnet1.id}"<br/>    route_table_id = "${aws_route_table.route.id}"<br/>}</span></pre><ul class=""><li id="0d4d" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">在上面的代码中，我创建了一个新的路由表，并将所有请求转发到<code class="du lw lx ly lz b">0.0.0.0/0</code> CIDR块。</li><li id="918b" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka ld le lf lg bi translated">我还将这个路由表附加到前面创建的子网。因此，它将作为公共子网工作</li></ul><p id="cc3b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">第五步:- </strong>为<strong class="jf hj"> EC2实例</strong>创建一个文件</p><ul class=""><li id="5371" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">创建<code class="du lw lx ly lz b">ec2.tf</code>文件，并将下面的代码添加到其中</li></ul><pre class="ki kj kk kl fd ma lz mb mc aw md bi"><span id="bd7b" class="me ig hi lz b fi mf mg l mh mi"># Creating 1st EC2 instance in Public Subnet<br/>resource "aws_instance" "demoinstance" {<br/>  ami                         = "ami-087c17d1fe0178315"<br/>  instance_type               = "t2.micro"<br/>  count                       = 1<br/>  key_name                    = "tests"<br/>  vpc_security_group_ids      = ["${aws_security_group.demosg.id}"]<br/>  subnet_id                   = "${aws_subnet.demoinstance.id}"<br/>  associate_public_ip_address = true<br/>  user_data                   = "${file("data.sh")}"</span><span id="9887" class="me ig hi lz b fi mj mg l mh mi">tags = {<br/>    Name = "My Public Instance"<br/>  }<br/>}</span><span id="d16e" class="me ig hi lz b fi mj mg l mh mi"># Creating 2nd EC2 instance in Public Subnet<br/>resource "aws_instance" "demoinstance1" {<br/>  ami                         = "ami-087c17d1fe0178315"<br/>  instance_type               = "t2.micro"<br/>  count                       = 1<br/>  key_name                    = "tests"<br/>  vpc_security_group_ids      = ["${aws_security_group.demosg.id}"]<br/>  subnet_id                   = "${aws_subnet.demoinstance.id}"<br/>  associate_public_ip_address = true<br/>  user_data                   = "${file("data.sh")}"</span><span id="7293" class="me ig hi lz b fi mj mg l mh mi">tags = {<br/>    Name = "My Public Instance 2"<br/>  }<br/>}</span></pre><ul class=""><li id="bbd2" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">我已经使用了<code class="du lw lx ly lz b">userdata</code>来配置EC2实例，我将在本文后面讨论<code class="du lw lx ly lz b">data.sh</code>文件</li></ul><p id="b722" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">步骤6:- </strong>为<strong class="jf hj">前端</strong> <strong class="jf hj">层</strong>的<strong class="jf hj">安全组</strong>创建一个文件</p><ul class=""><li id="e5b0" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">创建<code class="du lw lx ly lz b">web_sg.tf</code>文件，并将下面的代码添加到其中</li></ul><pre class="ki kj kk kl fd ma lz mb mc aw md bi"><span id="ca6c" class="me ig hi lz b fi mf mg l mh mi"># Creating Security Group <br/>resource "aws_security_group" "demosg" {<br/>  vpc_id = "${aws_vpc.demovpc.id}"</span><span id="c177" class="me ig hi lz b fi mj mg l mh mi"># Inbound Rules<br/>  # HTTP access from anywhere<br/>  ingress {<br/>    from_port   = 80<br/>    to_port     = 80<br/>    protocol    = "tcp"<br/>    cidr_blocks = ["0.0.0.0/0"]<br/>  }</span><span id="e043" class="me ig hi lz b fi mj mg l mh mi"># HTTPS access from anywhere<br/>  ingress {<br/>    from_port   = 443<br/>    to_port     = 443<br/>    protocol    = "tcp"<br/>    cidr_blocks = ["0.0.0.0/0"]<br/>  }</span><span id="979c" class="me ig hi lz b fi mj mg l mh mi"># SSH access from anywhere<br/>  ingress {<br/>    from_port   = 22<br/>    to_port     = 22<br/>    protocol    = "tcp"<br/>    cidr_blocks = ["0.0.0.0/0"]<br/>  }</span><span id="91c8" class="me ig hi lz b fi mj mg l mh mi"># Outbound Rules<br/>  # Internet access to anywhere<br/>  egress {<br/>    from_port   = 0<br/>    to_port     = 0<br/>    protocol    = "-1"<br/>    cidr_blocks = ["0.0.0.0/0"]<br/>  }</span><span id="79fc" class="me ig hi lz b fi mj mg l mh mi">tags = {<br/>    Name = "Web SG"<br/>  }<br/>}</span></pre><ul class=""><li id="b212" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">我已经为入站连接打开了<strong class="jf hj"> 80，443 &amp; 22 </strong>个端口，并为出站连接打开了所有端口</li></ul><p id="675c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">步骤7:- </strong>为<strong class="jf hj">数据库</strong> <strong class="jf hj">层</strong>的<strong class="jf hj">安全组</strong>创建一个文件</p><ul class=""><li id="1af7" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">创建<code class="du lw lx ly lz b">database_sg.tf</code>文件并将下面的代码添加到其中</li></ul><pre class="ki kj kk kl fd ma lz mb mc aw md bi"><span id="2fb1" class="me ig hi lz b fi mf mg l mh mi"># Create Database Security Group<br/>resource "aws_security_group" "database-sg" {<br/>  name        = "Database SG"<br/>  description = "Allow inbound traffic from application layer"<br/>  vpc_id      = aws_vpc.demovpc.id</span><span id="f13f" class="me ig hi lz b fi mj mg l mh mi">ingress {<br/>    description     = "Allow traffic from application layer"<br/>    from_port       = 3306<br/>    to_port         = 3306<br/>    protocol        = "tcp"<br/>    security_groups = [aws_security_group.demosg.id]<br/>  }</span><span id="9b88" class="me ig hi lz b fi mj mg l mh mi">egress {<br/>    from_port   = 32768<br/>    to_port     = 65535<br/>    protocol    = "tcp"<br/>    cidr_blocks = ["0.0.0.0/0"]<br/>  }</span><span id="96c5" class="me ig hi lz b fi mj mg l mh mi">tags = {<br/>    Name = "Database SG"<br/>  }</span></pre><ul class=""><li id="0c7e" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">我已经为入站连接打开了<strong class="jf hj"> 3306 </strong>端口，也为出站连接打开了所有端口。</li></ul><p id="42a7" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">步骤8:- </strong>创建文件<strong class="jf hj">应用负载均衡器</strong></p><ul class=""><li id="a99c" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">创建<code class="du lw lx ly lz b">alb.tf</code>文件，并将下面的代码添加到其中</li></ul><pre class="ki kj kk kl fd ma lz mb mc aw md bi"><span id="a6aa" class="me ig hi lz b fi mf mg l mh mi"># Creating External LoadBalancer<br/>resource "aws_lb" "external-alb" {<br/>  name               = "External LB"<br/>  internal           = false<br/>  load_balancer_type = "application"<br/>  security_groups    = [aws_security_group.demosg.id]<br/>  subnets            = [aws_subnet.public-subnet-1.id, aws_subnet.public-subnet-1.id]<br/>}</span><span id="9fc6" class="me ig hi lz b fi mj mg l mh mi">resource "aws_lb_target_group" "target-elb" {<br/>  name     = "ALB TG"<br/>  port     = 80<br/>  protocol = "HTTP"<br/>  vpc_id   = aws_vpc.demovpc.id<br/>}</span><span id="5e01" class="me ig hi lz b fi mj mg l mh mi">resource "aws_lb_target_group_attachment" "attachment" {<br/>  target_group_arn = aws_lb_target_group.external-alb.arn<br/>  target_id        = aws_instance.demoinstance.id<br/>  port             = 80</span><span id="6ce0" class="me ig hi lz b fi mj mg l mh mi">depends_on = [<br/>    aws_instance.demoinstance,<br/>  ]<br/>}</span><span id="eaa6" class="me ig hi lz b fi mj mg l mh mi">resource "aws_lb_target_group_attachment" "attachment" {<br/>  target_group_arn = aws_lb_target_group.external-alb.arn<br/>  target_id        = aws_instance.demoinstance1.id<br/>  port             = 80</span><span id="eb56" class="me ig hi lz b fi mj mg l mh mi">depends_on = [<br/>    aws_instance.demoinstance1,<br/>  ]<br/>}</span><span id="b3d0" class="me ig hi lz b fi mj mg l mh mi">resource "aws_lb_listener" "external-elb" {<br/>  load_balancer_arn = aws_lb.external-alb.arn<br/>  port              = "80"<br/>  protocol          = "HTTP"</span><span id="f862" class="me ig hi lz b fi mj mg l mh mi">default_action {<br/>    type             = "forward"<br/>    target_group_arn = aws_lb_target_group.external-alb.arn<br/>  }<br/>}</span></pre><ul class=""><li id="bac8" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">上述负载平衡器是类型<strong class="jf hj">外部</strong></li><li id="bf09" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka ld le lf lg bi translated">负载平衡器类型设置为<strong class="jf hj">应用</strong></li><li id="37d9" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka ld le lf lg bi translated"><strong class="jf hj">AWS _ lb _ Target _ Group _ attachment</strong>资源会将我们的实例附加到<strong class="jf hj">目标组</strong>。</li><li id="6929" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka ld le lf lg bi translated">负载平衡器将监听<strong class="jf hj">端口80 </strong>上的请求</li></ul><p id="5112" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">第9步:- </strong>为<strong class="jf hj"> RDS实例</strong>创建一个文件</p><ul class=""><li id="f04a" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">创建一个<code class="du lw lx ly lz b">rds.tf</code>文件，并将下面的代码添加到其中</li></ul><pre class="ki kj kk kl fd ma lz mb mc aw md bi"><span id="17b2" class="me ig hi lz b fi mf mg l mh mi"># Creating RDS Instance<br/>resource "aws_db_subnet_group" "default" {<br/>  name       = "main"<br/>  subnet_ids = [aws_subnet.database-subnet-1.id, aws_subnet.database-subnet-1.id]</span><span id="7d49" class="me ig hi lz b fi mj mg l mh mi">tags = {<br/>    Name = "My DB subnet group"<br/>  }<br/>}</span><span id="ad01" class="me ig hi lz b fi mj mg l mh mi">resource "aws_db_instance" "default" {<br/>  allocated_storage      = 10<br/>  db_subnet_group_name   = aws_db_subnet_group.default.id<br/>  engine                 = "mysql"<br/>  engine_version         = "8.0.20"<br/>  instance_class         = "db.t2.micro"<br/>  multi_az               = true<br/>  name                   = "mydb"<br/>  username               = "username"<br/>  password               = "password"<br/>  skip_final_snapshot    = true<br/>  vpc_security_group_ids = [aws_security_group.database-sg.id]<br/>}</span></pre><ul class=""><li id="69af" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">在上面的代码中，需要更改<code class="du lw lx ly lz b">username</code> &amp; <code class="du lw lx ly lz b">password</code>的值</li><li id="7150" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka ld le lf lg bi translated"><code class="du lw lx ly lz b">multi-az</code>设置为真，以获得高可用性</li></ul><p id="95b3" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">第十步:- </strong>为<strong class="jf hj">输出</strong>创建一个文件</p><ul class=""><li id="8a11" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">创建<code class="du lw lx ly lz b">outputs.tf</code>文件并将下面的代码添加到其中</li></ul><pre class="ki kj kk kl fd ma lz mb mc aw md bi"><span id="4df2" class="me ig hi lz b fi mf mg l mh mi"># Getting the DNS of load balancer<br/>output "lb_dns_name" {<br/>  description = "The DNS name of the load balancer"<br/>  value       = "${aws_lb.external-alb.dns_name}"<br/>}</span></pre><ul class=""><li id="032c" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">从上面的代码中，我将获得应用程序负载平衡器的DNS。</li></ul><p id="3f22" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">步骤11:- </strong>为<strong class="jf hj">变量</strong>创建一个文件</p><ul class=""><li id="c515" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">创建<code class="du lw lx ly lz b">vars.tf</code>文件并将下面的代码添加到其中</li></ul><pre class="ki kj kk kl fd ma lz mb mc aw md bi"><span id="6d70" class="me ig hi lz b fi mf mg l mh mi"># Defining CIDR Block for VPC<br/>variable "vpc_cidr" {<br/>  default = "10.0.0.0/16"<br/>}<br/># Defining CIDR Block for 1st Subnet<br/>variable "subnet_cidr" {<br/>  default = "10.0.1.0/24"<br/>}<br/># Defining CIDR Block for 2nd Subnet<br/>variable "subnet1_cidr" {<br/>  default = "10.0.2.0/24"<br/>}<br/># Defining CIDR Block for 3rd Subnet<br/>variable "subnet2_cidr" {<br/>  default = "10.0.3.0/24"<br/>}<br/># Defining CIDR Block for 3rd Subnet<br/>variable "subnet2_cidr" {<br/>  default = "10.0.4.0/24"<br/>}<br/># Defining CIDR Block for 3rd Subnet<br/>variable "subnet2_cidr" {<br/>  default = "10.0.5.0/24"<br/>}<br/># Defining CIDR Block for 3rd Subnet<br/>variable "subnet2_cidr" {<br/>  default = "10.0.6.0/24"<br/>}</span></pre><p id="8dfc" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">步骤12:- </strong>为<strong class="jf hj">用户数据</strong>创建一个文件</p><ul class=""><li id="10c3" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">创建<code class="du lw lx ly lz b">data.sh</code>文件，并将下面的代码添加到其中</li></ul><pre class="ki kj kk kl fd ma lz mb mc aw md bi"><span id="b546" class="me ig hi lz b fi mf mg l mh mi">#!/bin/bash</span><span id="60cd" class="me ig hi lz b fi mj mg l mh mi">yum update -y<br/>yum install -y httpd.x86_64<br/>systemctl start httpd.service<br/>systemctl enable httpd.service<br/>echo "Hello World from $(hostname -f)" &gt; /var/www/html/index.html</span></pre><ul class=""><li id="5d5e" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">上面的代码将在<strong class="jf hj"> EC2实例</strong>中安装一个<strong class="jf hj"> apache webserver </strong></li></ul><p id="9b6f" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">所以，现在我们的全部代码都准备好了。我们需要运行以下步骤来创建基础架构。</p><ul class=""><li id="915f" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated"><code class="du lw lx ly lz b">terraform init</code>初始化提供者的工作目录和下载插件</li><li id="ff5e" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka ld le lf lg bi translated"><code class="du lw lx ly lz b">terraform plan</code>是为我们的代码创建执行计划</li><li id="301e" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka ld le lf lg bi translated"><code class="du lw lx ly lz b">terraform apply</code>是创建实际的基础设施。它会要求您提供<strong class="jf hj">访问密钥</strong>和<strong class="jf hj">秘密密钥</strong>，以便创建基础架构。因此，与其硬编码<strong class="jf hj">访问密钥</strong>和<strong class="jf hj">秘密密钥，</strong>不如在运行时应用。</li></ul><p id="61b4" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">步骤13:- </strong>验证th <strong class="jf hj"> e资源</strong></p><ul class=""><li id="b399" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka ld le lf lg bi translated">Terraform将创建以下资源</li></ul><ol class=""><li id="d72a" class="ky kz hi jf b jg kb jk kc jo lt js lu jw lv ka mk le lf lg bi translated"><strong class="jf hj"> VPC </strong></li><li id="a62c" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka mk le lf lg bi translated"><strong class="jf hj">应用负载平衡器</strong></li><li id="f562" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka mk le lf lg bi translated"><strong class="jf hj">公共&amp;私有子网</strong></li><li id="a5eb" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka mk le lf lg bi translated"><strong class="jf hj"> EC2实例</strong></li><li id="c3fb" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka mk le lf lg bi translated"><strong class="jf hj">路由表</strong></li><li id="9284" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka mk le lf lg bi translated"><strong class="jf hj">互联网网关</strong></li><li id="4b16" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka mk le lf lg bi translated"><strong class="jf hj"> RDS实例</strong></li><li id="f7d3" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka mk le lf lg bi translated"><strong class="jf hj">Web的安全组&amp; RDS实例</strong></li></ol><p id="d0c9" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">资源创建完成后，您可以获取负载平衡器的DNS，并将其粘贴到浏览器中，您可以看到负载平衡器将向两个实例发送请求。</p><p id="483a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">现在就这样，你已经学会了如何使用Terraform在AWS中创建各种资源。你可以在这里进一步探索地形<a class="ae kg" href="https://terraform.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jf hj"/></a></p><p id="269b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">你可以在我的<a class="ae kg" href="https://github.com/DhruvinSoni30/Terraform-AWS-3tier-Architecture/tree/main" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj"> GitHub </strong> </a>账号找到完整的代码。也可以随意查看我的其他库。</p><p id="0d51" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">如果您发现此指南有帮助，请点击👏按钮，也可以随意发表评论。</p><p id="227f" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">关注更多类似的故事😊</p></div></div>    
</body>
</html>