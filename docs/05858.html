<html>
<head>
<title>PDF Manipulation Application Part 3— Deploying the application on Heroku and output result as zip file</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PDF操作应用程序第3部分—在Heroku上部署应用程序并将结果输出为zip文件</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/pdf-manipulation-application-part-3-deploying-the-application-on-heroku-and-output-result-as-zip-531886732f0e?source=collection_archive---------18-----------------------#2021-08-01">https://medium.com/geekculture/pdf-manipulation-application-part-3-deploying-the-application-on-heroku-and-output-result-as-zip-531886732f0e?source=collection_archive---------18-----------------------#2021-08-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="10c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文是我创建的PDF操作应用程序的最后一部分。在本文中，我将介绍我是如何在Heroku上部署这个应用程序的，以及在这个过程中我所面临的挑战。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/bc693738ac40b59cb07b78fd875789e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*b1AZYKl913t0VdZZ3lRagg.png"/></div></figure><h1 id="1427" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">介绍</h1><p id="f897" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">在根据我的需求成功地创建和增强了PDF操纵应用程序之后，理想的下一步是能够以一种其他人能够使用它的方式部署它，而不需要安装必要的python包并在python上运行它以便他们能够访问它。</p><p id="dfa9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不完全理解在http或虚拟机上托管应用程序的要求和后端基础设施。但是我知道我可以很容易地在Heroku上部署这个应用程序(很确定还有其他一些平台/服务也提供这个功能)。</p><p id="0d8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然这个过程并不全是阳光和彩虹。在这个过程中，我遇到了一些挑战，导致我需要找到一个解决方案，或者对我的初始应用程序进行妥协，以便我能够在Heroku上部署它。</p><p id="c601" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在本文中，我将讲述我是如何在Heroku上部署我的应用程序的，以及我是如何应对这些挑战的。</p><p id="7f89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你有兴趣知道在Heroku上的最终产品之前，我对python streamlit应用程序做了哪些要求和增强，你可以参考<a class="ae kp" rel="noopener" href="/codex/pdf-manipulation-application-using-streamlit-and-pdfrw-917a1f89bf5a">第1部分</a>和<a class="ae kp" href="https://choodesmond42.medium.com/pdf-manipulation-how-to-remove-unwanted-pages-using-pdfminer-56ba93bdd7d1" rel="noopener">第2部分</a>。</p><h1 id="d0e9" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">入门指南</h1><p id="4479" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">为了在Heroku上部署我的streamlit web应用程序，我碰巧看到了这个数据教授的youtube视频。他建议我们可以直接在Heroku上部署Github中的脚本，尽管我们需要添加一些文件。这引起了我的兴趣，因为它听起来很简单。</p><h2 id="efa6" class="kq jn hi bd jo kr ks kt js ku kv kw jw iq kx ky ka iu kz la ke iy lb lc ki ld bi translated">Github的附加文件</h2><p id="4f5b" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">有三个额外的文件需要添加到Github存储库中——(1)setup . sh，(2) requirements.txt和(3) Procfile。</p><ul class=""><li id="0376" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated"><strong class="ih hj"> setup.sh </strong>:无需修改。</li><li id="7b5e" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><strong class="ih hj"> requirements.txt </strong>:您需要指定您需要Heroku安装的特定版本，以便运行您的应用程序。您可以通过在cmd上运行命令“pip freeze”来轻松检查这一点。</li><li id="0d1a" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><strong class="ih hj"> Procfile </strong>:你可以直接复制粘贴synatx，并更改。py”脚本添加到您希望Heroku部署的应用程序中。</li></ul><p id="5a8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更多细节见下图。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es ls"><img src="../Images/2b493b733d1470eea372ec64f7d83d1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zaRdkkzY9Vc3Gy_xlWI7iQ.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx"><strong class="bd jo">Additional files needed in order to deploy on Heroku</strong></figcaption></figure><h2 id="c1bd" class="kq jn hi bd jo kr ks kt js ku kv kw jw iq kx ky ka iu kz la ke iy lb lc ki ld bi translated">赫罗库</h2><p id="2f68" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">注册或登录您的帐户后，在左上角单击“新建”，然后单击“创建新应用程序”。给你的应用取一个合适的名字，你就可以点击“创建应用”而不用改变地区。</p><p id="96ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成后，您将自动导航到“部署”页面，在“部署方法”下，单击“Github”。将你的Github账号连接到Heroku，然后选择正确的库，输入你的包名。完成后，点击“搜索”，如果正确，点击“连接”。如果你做了所有这些，你应该会看到下图。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mb"><img src="../Images/5e294fff5cc48431a85022fd2544a995.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bzlLEDEZhkVjK-9OFrNXXg.jpeg"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx"><strong class="bd jo">Github and package connected on Heroku</strong></figcaption></figure><p id="f4da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保要部署的分支是“手动部署”下的“主”分支，然后单击“部署分支”。</p><p id="004c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您是第一次部署，这将需要一些时间，因为Heroku会在部署应用程序之前尝试安装所有必需的包。您将能够看到描述状态的日志以及错误消息(如果有的话)。一旦部署完毕，将会有一个按钮将您引导到您的应用程序。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mc"><img src="../Images/a9b3015802f7d4890870d5a72997068c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3CHSTWEihWn6FMb91BOIXg.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx"><strong class="bd jo">Deployment successful on Heroku</strong></figcaption></figure><h1 id="9df1" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">挑战</h1><p id="9f39" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">正如你从上面读到的，这个过程非常简单明了。然而，在尝试让我的完整应用程序在Heroku上运行时，我确实面临了一些挑战。</p><h2 id="132f" class="kq jn hi bd jo kr ks kt js ku kv kw jw iq kx ky ka iu kz la ke iy lb lc ki ld bi translated">Comtypes</h2><p id="0ccf" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">我的完整应用程序有一个功能，用户可以根据他们的输入在处理之前将他们的doc/docx文件转换成pdf。然而，要做到这一点，需要一个python包调用“Comtypes”。</p><p id="97b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，这个软件包只能在Windows平台上运行，即使安装成功，Heroku似乎也无法运行。没有简单的方法可以解决这个问题，因为我想保持我的脚本基于PDFrw和PDFminer。因此，我从最初的包中删除了这个功能。</p><h2 id="e5d9" class="kq jn hi bd jo kr ks kt js ku kv kw jw iq kx ky ka iu kz la ke iy lb lc ki ld bi translated">输出处理后的pdf</h2><p id="5445" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">我面临的另一个挑战是，Heroku或虚拟机(VM)无法访问用户的目录。我想从安全的角度来看这是有道理的，但这也意味着即使Heroku上的应用程序显示状态为“成功”,将处理后的pdf直接输出到文件夹的过程也不会工作。</p><p id="095e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我能想到的变通解决方案是创建一个下载链接供用户点击下载处理过的pdf，但是如果有多个pdf，这就不理想了，因为这会创建多个下载链接。因此，我认为压缩这些pdf文件并给用户一个下载链接是最好的解决方案。</p><p id="8357" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我决定采用这种方法后，是时候使用这些解决方案并清理我的应用程序代码了。</p><h1 id="b0a6" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">实施变更</h1><p id="fe5f" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">如上所述，我的解决方案是将所有处理过的pdf文件压缩在一起，为此，我仍然打算先将我的pdf文件输出到一个文件夹中，然后再将其读入一个zip文件。该文件夹将在虚拟机中，因此用户将无法在他们的目录中看到它，但我仍然可以读取它。</p><p id="e48e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至此，我用下面列出的输出路径代替了原来的过程。这样，它会在虚拟机中查找工作目录，并将其保存在目标文件夹中。</p><pre class="jf jg jh ji fd md me mf mg aw mh bi"><span id="5330" class="kq jn hi me b fi mi mj l mk ml">## If user is concatenating the PDFs<br/>writer.write(os.getcwd()+”/Intermediate_Data/”+”Annex “+str(i+1)+”.pdf”)</span><span id="c34b" class="kq jn hi me b fi mm mj l mk ml">## If user wants to concatenate the PDFs<br/>writer.write(os.getcwd()+"/Intermediate_Data/Annex.pdf")</span></pre><p id="17d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我讨论zip文件之前，我们需要先做一个重要的步骤，那就是确保脚本开始时文件夹(“Intermediate_Data”)是空的，这样就不会有任何不需要的旧pdf文件输出到zip文件中。</p><pre class="jf jg jh ji fd md me mf mg aw mh bi"><span id="027e" class="kq jn hi me b fi mi mj l mk ml">def find_ext(dr, ext): <br/>  return glob(path.join(dr,”*.{}”.format(ext)))</span><span id="bf83" class="kq jn hi me b fi mm mj l mk ml">## Making sure that all residue annex files were deleted in the intermediate folder    </span><span id="179e" class="kq jn hi me b fi mm mj l mk ml">filepath_todel = find_ext(os.getcwd()+"/Intermediate_Data","pdf")    <br/>for file in filepath_todel:        <br/>  os.remove(file)</span></pre><p id="8aa5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦完成，我将需要在我的脚本中创建一个下载的zip文件。您不需要任何新的zip文件包，只需使用已经存在于python中的zip file包。但是，为了执行下面的代码，您将需要另一个包调用base64。</p><p id="7f75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们使用streamlit的markdown使链接“可下载”。</p><pre class="jf jg jh ji fd md me mf mg aw mh bi"><span id="fb03" class="kq jn hi me b fi mi mj l mk ml">from zipfile import ZipFile<br/>import base64</span><span id="a93c" class="kq jn hi me b fi mm mj l mk ml">## Creating a zipfile for download     <br/>zipObj = ZipFile("download.zip", "w")    </span><span id="1e79" class="kq jn hi me b fi mm mj l mk ml"># Add multiple files to the zip    <br/>filepath = find_ext(os.getcwd()+"/Intermediate_Data","pdf")    <br/>for file in filepath:        <br/>  zipObj.write(file)    </span><span id="9d0b" class="kq jn hi me b fi mm mj l mk ml"># close the Zip File    <br/>zipObj.close()     </span><span id="a3e2" class="kq jn hi me b fi mm mj l mk ml">ZipfileDotZip = "download.zip"     </span><span id="8d56" class="kq jn hi me b fi mm mj l mk ml">with open(ZipfileDotZip, "rb") as f:        <br/>  bytes = f.read()        <br/>  b64 = base64.b64encode(bytes).decode()        <br/>  href = f"&lt;a href=\"data:file/zip;base64,{b64}\" download='{ZipfileDotZip}.zip'&gt;\ Click here to download amended PDFs\        &lt;/a&gt;"    </span><span id="2e1d" class="kq jn hi me b fi mm mj l mk ml">st.markdown(href, unsafe_allow_html=True)</span></pre><h1 id="8f52" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">试映</h1><p id="b35b" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">如果你想试用这个应用程序，你可以在这里访问它<a class="ae kp" href="https://pdf-manipulation.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">。否则，下面是最终产品的片段。</a></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mn"><img src="../Images/bfc6af6380e93da70877110baad05696.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ArpEZtVItCNecHKdIMELVQ.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx"><strong class="bd jo">Preview of the application on Heroku</strong></figcaption></figure><h1 id="ae41" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">最终想法</h1><p id="f60a" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">虽然这个应用程序绝不是一个完美的产品，也不是一个复杂的产品，但我仍然很高兴能够开始使用它，因为我从它身上学到了很多东西——从使用PDFrw处理pdf，到思考用户在Streamlit中使用该应用程序的体验，以及最终如何通过创造性的解决方法和妥协在Heroku上部署它。</p><p id="15f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的这次学习之旅更加坚定了我自己的信念，即最快的学习方法就是亲自动手，没有比从像这个项目这样的小事开始更好的学习方法了。</p><p id="0d0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望本系列中的这些文章对您也有用，非常感谢您阅读我的文章。:)</p><h1 id="78b4" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">其他项目</h1><ul class=""><li id="6598" class="le lf hi ih b ii kk im kl iq mo iu mp iy mq jc lj lk ll lm bi translated"><a class="ae kp" href="https://choodesmond42.medium.com/price-comparison-application-using-streamlit-and-selenium-96212aa5a229" rel="noopener">使用Streamlit和Selenium进行价格比较</a></li><li id="2176" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae kp" href="https://choodesmond42.medium.com/tabular-data-from-pdf-camelot-vs-tabula-why-not-use-both-together-433aa852f607" rel="noopener">表格数据来自PDF:卡米洛特vs Tabula？为什么不两者并用呢？</a></li><li id="5d05" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae kp" rel="noopener" href="/codex/pdf-manipulation-application-using-streamlit-and-pdfrw-917a1f89bf5a">使用Streamlit和PDFRW的PDF处理应用程序</a></li><li id="26b6" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae kp" href="https://choodesmond42.medium.com/pdf-manipulation-how-to-remove-unwanted-pages-using-pdfminer-56ba93bdd7d1" rel="noopener"> PDF处理—如何使用PDFminer删除不需要的页面</a></li></ul></div></div>    
</body>
</html>