<html>
<head>
<title>Build a Resilient Application Using Redis Offering.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Redis产品构建弹性应用程序。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/build-a-resilient-application-using-redis-offering-7145d2b2e1c?source=collection_archive---------22-----------------------#2022-07-28">https://medium.com/geekculture/build-a-resilient-application-using-redis-offering-7145d2b2e1c?source=collection_archive---------22-----------------------#2022-07-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="8c59" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">让我们尝试使用Node Js和Redis构建一个应用程序进行缓存，并利用Redis发布子模型。</h2></div><p id="7fa3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们尝试使用Node Js和Redis构建一个应用程序，这些应用程序利用了缓存，并且还利用了Redis发布-订阅模式。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/947978796fbb7986af166c9128488dd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WnQwi-IKqlLJl-S1BVEJTQ.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Icon showing NodeJs and Redis.</figcaption></figure><p id="0e19" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，在本文中，我们将探讨如何利用Redis作为一个缓存系统，并利用Redis提供的发布/订阅消息传递范例的能力。目前，我们使用Node JS作为我们的后端技术，但是Redis与大多数编程语言兼容。</p><h1 id="b560" class="kj kk hi bd kl km kn ko kp kq kr ks kt io ku ip kv ir kw is kx iu ky iv kz la bi translated">介绍</h1><p id="6603" class="pw-post-body-paragraph ix iy hi iz b ja lb ij jc jd lc im jf jg ld ji jj jk le jm jn jo lf jq jr js hb bi translated">首先，让我们试着了解我们计划构建的整个系统的概况。为了更好的视觉理解，我绘制了架构图，这将有助于我们关联不同服务之间的链接。还有Redis在整个系统中的作用。</p><p id="a3f8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你不了解基于微服务的架构，我建议你阅读这篇关于<a class="ae lg" href="https://apoorv-tomar.medium.com/microservices-orchestration-vs-choreography-technology-5dbe612cf7e9" rel="noopener">微服务编排与编排|(技术)</a>的文章。这篇文章会让你对微服务有一个基本的了解。此外，它将告诉您微服务编排与编排之间的区别。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lh"><img src="../Images/72ab4969517c0aeb51d0b6ae608881db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*bB6LKM2Phe-hnv3wnrTXVg.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx">1. Architecture Diagram</figcaption></figure><p id="f5e3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">出于演示目的，我们计划使用Node Js技术构建两个微服务。发布我们将创建一个登录API，在其中一个包含用户登录细节的服务中。微服务将检查数据是否存在于Redis中。如果它不能从Redis中找到数据，它将会去被选择的数据库，那将会是事实的最终来源。</p><p id="7ad7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦它找到数据，它将更新Redis，在未来，Redis将是我们的真理来源。</p><p id="92c6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">之后，第二个微服务将开始发挥作用。它将通过连接到同一个Redis实例，尝试按ID获取用户信息。我们将通过直接从数据库中获取数据来进行比较。虽然Redis代表远程词典服务，可以作为数据库使用。但是Redis数据库产品将在另一篇文章中讨论。否则，这只会使当前的文章变得混乱。</p><p id="7963" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在发布登录逻辑的第二步中，我们将更新其中一个微服务中的用户信息，并让另一个微服务监听它，而不是轮询。我们将利用Redis提供的发布-订阅范例。这将是整个教程的议程。</p><h1 id="b45d" class="kj kk hi bd kl km kn ko kp kq kr ks kt io ku ip kv ir kw is kx iu ky iv kz la bi translated">教程的先决条件。</h1><ol class=""><li id="d826" class="li lj hi iz b ja lb jd lc jg lk jk ll jo lm js ln lo lp lq bi translated">理解node，express和javascript。该节点应该安装在您的系统上。</li><li id="45ab" class="li lj hi iz b ja lr jd ls jg lt jk lu jo lv js ln lo lp lq bi translated">对MongoDB的理解。MongoDB应该安装在您的系统上。</li><li id="d3ca" class="li lj hi iz b ja lr jd ls jg lt jk lu jo lv js ln lo lp lq bi translated">微软VS代码编辑器。虽然任何编辑器都可以使用。</li></ol><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="e6cf" class="mb kk hi lx b fi mc md l me mf"><strong class="lx hj">Table of Content<br/></strong>1. Setting Up Two microservices using Node JS.<br/>2. Setting Up Mongo DB and connecting it with the microservices.<br/>3. Setting Up Redis and connecting them with microservices.<br/>4. Creating Login API in Microservice One.<br/>5. Setting Up Redis Pub-Sub and utilising it in our microservices.<br/>6. Redis Commander.<br/>7. Wrap Up and References.</span></pre><h1 id="a3d1" class="kj kk hi bd kl km kn ko kp kq kr ks kt io ku ip kv ir kw is kx iu ky iv kz la bi translated">1.使用Node JS设置两个微服务。</h1><p id="8780" class="pw-post-body-paragraph ix iy hi iz b ja lb ij jc jd lc im jf jg ld ji jj jk le jm jn jo lf jq jr js hb bi translated">让我们从两个节点服务开始。为了设置这两个服务，我们需要执行以下步骤。</p><ol class=""><li id="9284" class="li lj hi iz b ja jb jd je jg mg jk mh jo mi js ln lo lp lq bi translated">使用npm init初始化项目</li><li id="8a49" class="li lj hi iz b ja lr jd ls jg lt jk lu jo lv js ln lo lp lq bi translated">创建一个“index.js”文件，并添加基本的express代码。</li><li id="a018" class="li lj hi iz b ja lr jd ls jg lt jk lu jo lv js ln lo lp lq bi translated">使用npm install express命令安装快速软件包。</li></ol><p id="0c6e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以按照命令设置节点项目，这将初始化</p><p id="828f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用以下命令创建节点项目。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="6279" class="mb kk hi lx b fi mc md l me mf">&gt; npm init</span></pre><p id="303c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您将在您的终端中看到以下命令，填写以下细节，您可以在下图中看到。信息如名称，版本，描述，主要，脚本，作者，许可证等。让我们称这个服务为后端服务1。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mj"><img src="../Images/14ad08414d83bbf0ff3054b319d505e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*STL6_Uq1QZ9pDqRP1I7IAQ.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">2. Npm init screen</figcaption></figure><p id="d974" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">发布我们将创建一个文件index.js文件。我们可以通过添加以下命令来创建一个简单的express服务器。这个服务将在端口3000上启动您的express服务器，正如我们在代码中提到的。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="445b" class="mb kk hi lx b fi mc md l me mf"><strong class="lx hj">// index.js</strong></span><span id="117a" class="mb kk hi lx b fi mk md l me mf">const express = require('express')<br/>const app = express()<br/>const port = 3000</span><span id="5422" class="mb kk hi lx b fi mk md l me mf">app.get('/', (req, res) =&gt; {<br/>    res.send('Hello World Service 1! ')<br/>})</span><span id="1f3a" class="mb kk hi lx b fi mk md l me mf">app.listen(port, () =&gt; {<br/>    console.log(`Example app listening on port ${port}`)<br/>});</span></pre><p id="763a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们可以创建另一个类似于backend-service-1的服务，并将其命名为backend-service-2。让我们为backend-service-2服务重复类似的过程。即</p><ol class=""><li id="80b6" class="li lj hi iz b ja jb jd je jg mg jk mh jo mi js ln lo lp lq bi translated">从npm初始化开始</li><li id="b92a" class="li lj hi iz b ja lr jd ls jg lt jk lu jo lv js ln lo lp lq bi translated">创建index.js文件</li><li id="af0e" class="li lj hi iz b ja lr jd ls jg lt jk lu jo lv js ln lo lp lq bi translated">使用命令安装express。npm快速安装</li><li id="4a9a" class="li lj hi iz b ja lr jd ls jg lt jk lu jo lv js ln lo lp lq bi translated">添加基本express代码并在端口3001上运行。通过更新端口变量。const port = 3001</li></ol><p id="7d66" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">提交这两个服务的创建，你的代码结构应该类似下图(图3)。为了方便起见，下面是后端服务1的代码结构的扩展视图。后端服务2也有类似的结构。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ml"><img src="../Images/7062746d6f7176182207c6288b5dd93d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t_mWqcvxER7LFoFogVb75g.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">3. Code structure of Backed Service 1.</figcaption></figure><p id="1145" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过打开目标位置并使用以下命令，您可以为每个服务运行代码</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="6b05" class="mb kk hi lx b fi mc md l me mf">&gt; node index.js</span></pre><p id="07c4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">发布此消息后，您将在终端上看到以下命令。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mj"><img src="../Images/712c7cf247f85c398097900557cfed34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cdO4X-qSZVqsRknYMUZQqA.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Node JS Application.</figcaption></figure><h1 id="9e80" class="kj kk hi bd kl km kn ko kp kq kr ks kt io ku ip kv ir kw is kx iu ky iv kz la bi translated">2.设置Mongo DB并将其与微服务连接。</h1><p id="8300" class="pw-post-body-paragraph ix iy hi iz b ja lb ij jc jd lc im jf jg ld ji jj jk le jm jn jo lf jq jr js hb bi translated">发布设置微服务的步骤，我们需要连接MongoDB和我们的应用程序。为了将MongoDB与我们的应用程序连接起来，我们需要首先在我们的系统/服务器上安装并运行MongoDB。</p><p id="33a3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要安装和运行MongoDB，您可以遵循本教程。在OSX上安装MongoDB。</p><p id="142d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一般来说，我们在多台服务器上设置MongoDB集群，这有助于使它更加防摔。</p><p id="6d25" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是出于教程的目的，单个实例将非常有效。本教程适用于OSX，但如果你使用的是另一个操作系统，如Windows或Ubuntu。您可以搜索相应的教程并继续安装。</p><p id="a5f4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以尝试以下命令，检查是否安装了mongo，您将看到类似下面的内容。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="5450" class="mb kk hi lx b fi mc md l me mf">&gt; mongo</span></pre><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mj"><img src="../Images/4f21e95e324b35f37ff7ac8684f315b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lci7tvHOGmhzyihHv5bGMA.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">4. Image showing mongo is installed.</figcaption></figure><p id="6f93" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦我们完成了安装和其他工作，现在我们可以使用MongoDB npm包将mongo与NodeJS微服务连接起来。</p><p id="76d6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用以下命令安装npm软件包。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="20ee" class="mb kk hi lx b fi mc md l me mf">&gt; npm i mongodb</span></pre><p id="ac7e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">安装包之后，我们需要为mongo连接添加代码。通过创建一个名为mongo.js的文件，我们将在其中添加mongo代码。</p><p id="5062" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="mm">我们需要在你的package.json文件中添加{type: "module"}，这个文件可以在根目录下找到，它将帮助你使用es6语法。</em></p><p id="eea9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是连接mongo DB和你的应用程序的代码。在这里您可以看到我们已经连接了mongo DB，它运行在localhost:27017上。</p><p id="3181" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> Mongo DB默认端口:27017 </strong></p><p id="f2cc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是一个全局函数，将创建与数据库的连接。使用该连接，我们将进行后续的Db查询。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="db50" class="mb kk hi lx b fi mc md l me mf"><strong class="lx hj">//mongo.js</strong></span><span id="f9ab" class="mb kk hi lx b fi mk md l me mf">import { MongoClient } from 'mongodb';</span><span id="0ab3" class="mb kk hi lx b fi mk md l me mf">export async function connectToCluster() {<br/>    const uri = 'mongodb://localhost:27017';<br/>    let mongoClient;</span><span id="d097" class="mb kk hi lx b fi mk md l me mf">    try {<br/>        mongoClient = new MongoClient(uri);<br/>        console.log('Connecting to MongoDB');<br/>        await mongoClient.connect();<br/>        console.log('Successfully connected to MongoDB!');</span><span id="1dfe" class="mb kk hi lx b fi mk md l me mf">        return mongoClient;<br/>    } catch (error) {<br/>        console.error('Connection to MongoDB failed!', error);<br/>        process.exit();<br/>    }<br/>}</span></pre><p id="88f9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以为backend-service-2做一个类似的实现，并设置mongo DB。</p><h1 id="c2f5" class="kj kk hi bd kl km kn ko kp kq kr ks kt io ku ip kv ir kw is kx iu ky iv kz la bi translated">3.设置Redis并将其与微服务连接。</h1><p id="d191" class="pw-post-body-paragraph ix iy hi iz b ja lb ij jc jd lc im jf jg ld ji jj jk le jm jn jo lf jq jr js hb bi translated">设置好node微服务并与MongoDB连接后。我们已经准备好期待我们的下一步，即安装Redis并将其与我们的微服务连接</p><p id="e2d0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于Mac OS，我们可以使用brew在我们的项目上安装和运行Redis服务。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="7c68" class="mb kk hi lx b fi mc md l me mf">brew install redis</span></pre><p id="6484" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> Redis默认端口:6379 </strong></p><p id="00c9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您可以使用以下任何命令启动Redis服务器。当然是后装。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="9bea" class="mb kk hi lx b fi mc md l me mf">redis-server</span></pre><p id="b79f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">或者您可以将其作为brew服务启动，这将有助于此服务在后台持续运行。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="de4b" class="mb kk hi lx b fi mc md l me mf">brew services start redis</span></pre><p id="2dcd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">到目前为止，我们已经在本地系统上完成了Redis的设置。我们可以在云(AWS，G Cloud，Azure等)上设置Redis的类似过程。).</p><p id="0e7c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们将Redis连接到我们的服务。因此，下一步是使用以下命令将Redis npm软件包安装到您的两个服务上。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="ddaf" class="mb kk hi lx b fi mc md l me mf">npm i redis</span></pre><p id="6590" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">安装Redis包后，我们需要创建一个Redis实例，我们将进一步使用它。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="e9a5" class="mb kk hi lx b fi mc md l me mf">//redis.js<br/>import redis from 'redis';</span><span id="0f79" class="mb kk hi lx b fi mk md l me mf">export const client = redis.createClient();</span><span id="1724" class="mb kk hi lx b fi mk md l me mf">client.on('connect', () =&gt; {<br/>    console.log('Connected to Redis Successfully.')<br/>});</span></pre><p id="6341" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里我们导出一个Redis实例，我们将用它来连接和进一步查询。</p><p id="7c9f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们完成了基本的设置，下一步，我们将连接到Redis服务器。在建立了正确的连接之后，我们将利用缓存来处理get请求。</p><h1 id="7e6e" class="kj kk hi bd kl km kn ko kp kq kr ks kt io ku ip kv ir kw is kx iu ky iv kz la bi translated">4.在微服务一中创建登录API。</h1><p id="65e9" class="pw-post-body-paragraph ix iy hi iz b ja lb ij jc jd lc im jf jg ld ji jj jk le jm jn jo lf jq jr js hb bi translated">现在，一旦我们完成了Redis和Mongo DB连接，并将其与我们的应用程序连接，现在是时候通过一个简单的登录API使用Redis缓存了。</p><p id="62e7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个API中，我们将创建一个简单的登录API，其中我们将传递登录用户名和密码。</p><blockquote class="mn mo mp"><p id="f428" class="ix iy mm iz b ja jb ij jc jd je im jf mq jh ji jj mr jl jm jn ms jp jq jr js hb bi translated"><em class="hi">不建议用明文传递密码。但是出于辅导的目的，我们正在做这个活动。</em></p></blockquote><p id="e4c7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们添加登录API的代码，张贴我们将通过代码。下面是更新后的index.js文件。它包含一个登录API，如果我们在Redis内存数据库中找不到数据，它会调用我们的数据库。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="d65c" class="mb kk hi lx b fi mc md l me mf"><strong class="lx hj">// index.js</strong></span><span id="87df" class="mb kk hi lx b fi mk md l me mf">import express from 'express';<br/>import { connectToCluster } from './mongo.js';<br/>import { client } from './redis.js';</span><span id="8db4" class="mb kk hi lx b fi mk md l me mf">const app = express()<br/>const port = 3000<br/>let mongoClient = null;</span><span id="137b" class="mb kk hi lx b fi mk md l me mf">app.get('/', async (req, res) =&gt; {<br/>    res.send('Hello World Service 1! ')<br/>});<br/></span><span id="781c" class="mb kk hi lx b fi mk md l me mf">app.get('/login/:name/:password', async (req, res) =&gt; {<br/>    try {</span><span id="66ae" class="mb kk hi lx b fi mk md l me mf">        const { name, password } = req.params;<br/>        // check if pass exist in redis.<br/>        const tempPassword = await client.get(name);<br/>        if (tempPassword) {<br/>            if (tempPassword === password) {<br/>                res.send('Login Success from Redis.');<br/>            }<br/>        } <br/>        else {</span><span id="0c9b" class="mb kk hi lx b fi mk md l me mf">            // Mongo DB Query<br/>            mongoClient = await connectToCluster();<br/>            const dbName = 'test';<br/>            const db = mongoClient.db(dbName);<br/>            const collection = db.collection('user');<br/>            const findResult = await collection.findOne({ name, password })<br/></span><span id="b09f" class="mb kk hi lx b fi mk md l me mf">            if (findResult) {<br/>                await client.set(name, password);<br/>                res.send('Login Success from DB.');<br/>            } else {<br/>                res.send('Login Failed.');<br/>            }</span><span id="c950" class="mb kk hi lx b fi mk md l me mf">        }</span><span id="0284" class="mb kk hi lx b fi mk md l me mf">    } catch (err) {<br/>        console.log(err)<br/>        res.send('Login Failed.');<br/>    }<br/>    finally {<br/>        await mongoClient.close();<br/>    }<br/>});</span><span id="aed0" class="mb kk hi lx b fi mk md l me mf">app.listen(port, async () =&gt; {<br/>    client.connect();<br/>    console.log(`Example app listening on port ${port}`)<br/>});</span></pre><h2 id="5d6e" class="mb kk hi bd kl mt mu mv kp mw mx my kt jg mz na kv jk nb nc kx jo nd ne kz nf bi translated">以上代码的解释。</h2><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="c700" class="mb kk hi lx b fi mc md l me mf">app.get('/login/:name/:password'</span></pre><p id="3627" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是我们定义的API端点，它期望用户将名称和密码作为参数传递。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="f9e3" class="mb kk hi lx b fi mc md l me mf">const tempPassword = await client.get(name);<br/>if (tempPassword) {<br/>        if (tempPassword === password) {<br/>            res.send('Login Success from Redis.');<br/>        }<br/>}</span></pre><p id="df30" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，我们检查我们在Redis中有一些条目，它们的名称是关键字。</p><blockquote class="mn mo mp"><p id="0844" class="ix iy mm iz b ja jb ij jc jd je im jf mq jh ji jj mr jl jm jn ms jp jq jr js hb bi translated">在Redis中，我们可以存储各种数据类型，从普通的字符串到散列映射。我们将数据存储为简单的键和值。其中密钥是用户名，值是密码。</p></blockquote><p id="a723" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">再次强调，在生产中，我们不会以纯文本形式存储密码，这只是为了让我们理解Redis。</p><p id="740c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我们将检查是否正在Redis中获取数据，我们只需比较密码。如果我们没有得到任何与传递的名称相匹配的键，我们就前进到DB调用。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="df82" class="mb kk hi lx b fi mc md l me mf">else {<br/>            // Mongo DB Query<br/>            mongoClient = await connectToCluster();<br/>            const dbName = 'test';<br/>            const db = mongoClient.db(dbName);<br/>            const collection = db.collection('user');<br/>            const findResult = await collection.findOne({ name, password })<br/></span><span id="6b60" class="mb kk hi lx b fi mk md l me mf">            if (findResult) {<br/>                await client.set(name, password);<br/>                res.send('Login Success from DB.');<br/>            } else {<br/>                res.send('Login Failed.');<br/>            }</span><span id="6267" class="mb kk hi lx b fi mk md l me mf">        }</span></pre><p id="80c2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是else的简单表示，以防我们在Redis存储中找不到该名称。在else块中，一旦我们能够找到一个成功的登录，我们就将用户名和密码添加到Redis内存缓存中。使用下面的代码。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="26f2" class="mb kk hi lx b fi mc md l me mf">if (findResult) {<br/>                await client.set(name, password);<br/>                res.send('Login Success from DB.');<br/>} else {<br/>                res.send('Login Failed.');<br/> }</span></pre><p id="2e86" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将制作一个如下所示的API，它需要一个用户名。一旦我们收到用户名，我们就将它发布到名为“user”的通道上的其他服务，将会有许多请求返回相同的数据，缓存似乎是一个很好的选择。</p><h1 id="ee9b" class="kj kk hi bd kl km kn ko kp kq kr ks kt io ku ip kv ir kw is kx iu ky iv kz la bi translated">5.建立Redis发布订阅并在我们的微服务中使用它。</h1><p id="757d" class="pw-post-body-paragraph ix iy hi iz b ja lb ij jc jd lc im jf jg ld ji jj jk le jm jn jo lf jq jr js hb bi translated">为了利用发布-订阅范式，我们正在创建一个API来更新后端服务-1中的用户信息。并且另一个服务，即后端服务-2将通过订阅该信道来监听这些变化。</p><p id="184c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将制作一个如下所示的API，它需要一个用户名。一旦我们收到用户名，我们就将它发布到名为“user”的通道上的其他服务。基本上，这个消息是从我们的后端服务1广播的。现在，任何想听这个变化的人都可以简单地订阅这个频道，并利用消息广播。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="d936" class="mb kk hi lx b fi mc md l me mf">app.get('/updateName/:name', async (req, res) =&gt; {<br/>    const { name } = req.params;</span><span id="4d6b" class="mb kk hi lx b fi mk md l me mf">    client.publish('user', name);<br/>    res.send(`Name: ${name} is been published`)<br/>});</span></pre><p id="fd71" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们已经在后端服务2中订阅了名为“用户”的频道。如前所述，一旦有人点击后端服务1上的更新名称API，消息就会发布到用户通道。因为后端服务2预订了相同的信道，所以它将接收发送的消息，即要更新的名称。</p><p id="94aa" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，服务2可以自由地处理数据了。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="807e" class="mb kk hi lx b fi mc md l me mf">app.listen(port, async () =&gt; {<br/>    client.connect();<br/>    await client.subscribe('user', (message) =&gt; {<br/>        console.log(message); // 'message'<br/>    });<br/>    console.log(`Example app listening on port ${port}`)<br/>});</span></pre><p id="49dc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">类似地，我们可以使用发布-订阅范例来解决各种用例。</p><h1 id="192c" class="kj kk hi bd kl km kn ko kp kq kr ks kt io ku ip kv ir kw is kx iu ky iv kz la bi translated">6.Redis指挥官。</h1><p id="0f4c" class="pw-post-body-paragraph ix iy hi iz b ja lb ij jc jd lc im jf jg ld ji jj jk le jm jn jo lf jq jr js hb bi translated">作为额外的提示，我们有一个名为Redis commander的工具。Redis commander是一个用户界面，可以让你看到Redis中的数据。</p><p id="4c74" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要安装该工具，您可以使用以下命令。</p><pre class="ju jv jw jx fd lw lx ly lz aw ma bi"><span id="8460" class="mb kk hi lx b fi mc md l me mf">&gt; npm i -g redis-commander<br/>// Post installation to run redis commander, use this command.<br/>&gt; redis-commander</span></pre><p id="150e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将呈现如下所示的用户界面。这使得搜索和分析变得非常容易。</p><p id="7e85" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">参考:<a class="ae lg" href="https://www.npmjs.com/package/redis-commander" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/redis-commander</a></p><h1 id="b38c" class="kj kk hi bd kl km kn ko kp kq kr ks kt io ku ip kv ir kw is kx iu ky iv kz la bi translated">7.总结和参考。</h1><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mj"><img src="../Images/19c7fcb7e3d37ab633f3e49f5d9b2112.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S3V3IA0N4fG9BsUqYQ_i-A.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">User Interface of Redis Commander.</figcaption></figure><p id="968a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi ng translated"><span class="l nh ni nj bm nk nl nm nn no di">在</span>这篇教程中，我们探讨了Redis缓存机制和发布-订阅范式。Redis提供的这些功能可用于各种目的。这些特性可以帮助您的应用程序更好地伸缩。</p><p id="4b78" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">除了另一个好处，数据在内存中，随时可用。因此，与典型的数据库相比，延迟要小得多。</p><p id="ba4f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Redis提供了各种各样的附加特性可以使用，比如将Redis用作完整的数据库、数据持久性等。但是将在接下来的教程中讨论这个主题。</p><p id="acf6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">同时，从他们的官方网站(<a class="ae lg" href="https://redis.io/" rel="noopener ugc nofollow" target="_blank"> Redis </a>)上了解更多关于Redis的信息</p><p id="b5de" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">其他参考。</p><ul class=""><li id="0ee0" class="li lj hi iz b ja jb jd je jg mg jk mh jo mi js np lo lp lq bi translated"><a class="ae lg" href="https://redis.info/3NBGJRT" rel="noopener ugc nofollow" target="_blank">免费试用Redis云</a></li><li id="2dc6" class="li lj hi iz b ja lr jd ls jg lt jk lu jo lv js np lo lp lq bi translated"><a class="ae lg" href="https://redis.info/3Ga9YII" rel="noopener ugc nofollow" target="_blank">观看此视频，了解Redis云相对于其他Redis提供商的优势</a></li><li id="8177" class="li lj hi iz b ja lr jd ls jg lt jk lu jo lv js np lo lp lq bi translated">如果可能，嵌入此视频</li><li id="db28" class="li lj hi iz b ja lr jd ls jg lt jk lu jo lv js np lo lp lq bi translated"><a class="ae lg" href="https://redis.info/3LC4GqB" rel="noopener ugc nofollow" target="_blank"> Redis开发者中心——关于Redis的工具、指南和教程</a></li><li id="1e97" class="li lj hi iz b ja lr jd ls jg lt jk lu jo lv js np lo lp lq bi translated"><a class="ae lg" href="https://redis.info/3wMR7PR" rel="noopener ugc nofollow" target="_blank"> RedisInsight桌面GUI </a> Redis</li></ul><p id="9e84" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="mm">这篇文章是与Redis合作的。</em></p></div><div class="ab cl nq nr gp ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="hb hc hd he hf"><h1 id="6bd6" class="kj kk hi bd kl km nx ko kp kq ny ks kt io nz ip kv ir oa is kx iu ob iv kz la bi translated">关于作者</h1><p id="099c" class="pw-post-body-paragraph ix iy hi iz b ja lb ij jc jd lc im jf jg ld ji jj jk le jm jn jo lf jq jr js hb bi translated">Apoorv Tomar是一名软件开发人员，也是<a class="ae lg" href="https://mindroast.com/" rel="noopener ugc nofollow" target="_blank">mind bake</a>的一员。你可以在<a class="ae lg" href="https://twitter.com/apoorvtomar_" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae lg" href="https://www.linkedin.com/in/apoorvtomar/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>、<a class="ae lg" href="https://t.me/ApoorvTomar" rel="noopener ugc nofollow" target="_blank"> Telegram </a>和<a class="ae lg" href="https://www.instagram.com/apoorvsinghtomar/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>上和他联系。订阅<a class="ae lg" href="https://www.mindroast.com/newsletter" rel="noopener ugc nofollow" target="_blank">简讯</a>获取最新策划内容。不要犹豫在任何平台上说“嗨”,只要说明你是在哪里找到我的资料的。</p></div></div>    
</body>
</html>