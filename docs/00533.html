<html>
<head>
<title>Headless WordPress Gutenberg &amp; Next.js — Part 1/3: Creating a Block with React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无头WordPress Gutenberg &amp; Next.js —第1/3部分:用React创建一个块</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/headless-wordpress-gutenberg-next-js-part-1-3-creating-a-block-with-react-e8d69e8460d4?source=collection_archive---------0-----------------------#2021-02-27">https://medium.com/geekculture/headless-wordpress-gutenberg-next-js-part-1-3-creating-a-block-with-react-e8d69e8460d4?source=collection_archive---------0-----------------------#2021-02-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/8af74e1af778c294f4322c5ed71fb31b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMnzmYK24GRGcv9w0A2smg.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="72d4" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">WordPress的生态系统肯定会朝着用JavaScript和非PHP方式开发插件、主题和核心本身的方向发展。感谢<strong class="ak">古腾堡</strong>和<strong class="ak"> WordPress JavaScript API </strong>，我们可以创造一些很酷的东西。其中之一就是<strong class="ak">生产就绪的WordPress静态站点构建器</strong>，我们将在本系列中对其进行编码。</h2></div><h1 id="276a" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">开始之前</h1><p id="f94b" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">如果你不了解<strong class="kc hu">古腾堡</strong>、<strong class="kc hu"> React </strong>或<strong class="kc hu"> WordPress </strong>的某些坚实层面，这篇文章可能对你来说太难了。为了熟悉<strong class="kc hu">古腾堡开发</strong>，请继续阅读来自<a class="ae kw" href="https://developer.wordpress.org/block-editor/developers/" rel="noopener ugc nofollow" target="_blank">官方文档</a>的一些文章。它会帮助你理解它的用途和使用的技术。</p><h1 id="0478" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">介绍</h1><p id="a86d" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">我总是寻找最好的解决方案和编码方式。有些人可能会说我懒惰，但是我不喜欢在任何事情上重复自己，包括代码。这就是为什么我花了一些时间进行研究，开发了一种用WordPress作为无头后端，Gutenberg作为页面编辑器来构建SSG生成页面的方法。<strong class="kc hu">全部同一个构件结构来源。</strong></p><h2 id="92f5" class="kx jj ht bd jk ky kz la jo lb lc ld js kj le lf ju kn lg lh jw kr li lj jy lk bi translated">但是它与互联网上的其他文章或教程有什么不同呢？</h2><p id="4173" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">我的实现从头到尾都是自定义的，这意味着我们不使用预定义的WP块(虽然我们可以！).我们构建了自己的模块，可以同时在三种环境中使用:</p><ul class=""><li id="1355" class="ll lm ht kc b kd ln kg lo kj lp kn lq kr lr kv ls lt lu lv bi translated"><strong class="kc hu">管理端WordPress </strong>(后期编辑屏幕)——作为一个全功能的古腾堡模块，具有自定义数据字段、JS事件、实时编辑等</li><li id="6e62" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv ls lt lu lv bi translated"><strong class="kc hu">客户端WordPress(前端)</strong>——作为一个带有可选样式和脚本的静态HTML</li><li id="0c07" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv ls lt lu lv bi translated"><strong class="kc hu"> Next.js(或Gatsby或Nuxt或其他SSG/SSR框架)</strong> —作为全功能React组件，然后是静态HTML+CSS+JS</li></ul><p id="a8f0" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">下面是我们将要做的一个简短采访:</p><figure class="me mf mg mh fd hk"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="mk ml et er es mm mn bd b be z dx">A video about Gutenberg to Next.js connection</figcaption></figure><p id="00e5" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">请注意，视频中的样式或功能可能与项目存储库中的不同，因为它们可能会被更新。</p><p id="9f73" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated"><strong class="kc hu">在视频中可以看到，整件事都是关于</strong>:</p><ol class=""><li id="718b" class="ll lm ht kc b kd ln kg lo kj lp kn lq kr lr kv mo lt lu lv bi translated">创建一个<strong class="kc hu"> React组件</strong>，它将成为我们的块</li><li id="127f" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv mo lt lu lv bi translated">使用React组件，我们在上面的<strong class="kc hu"> WordPress </strong>，<strong class="kc hu"> </strong>中创建了一个<strong class="kc hu">古腾堡</strong> <strong class="kc hu">块</strong>，仅使用JavaScript和React(我们也可以使用许多<code class="du mp mq mr ms b">@wordpress/*</code>包，如<code class="du mp mq mr ms b">@wordpress/blocks</code>，<code class="du mp mq mr ms b">@wordpress/i18n</code>)</li><li id="f8c6" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv mo lt lu lv bi translated">添加一些基本的样式，使<strong class="kc hu">块</strong> <strong class="kc hu">与额外的JavaScript交互</strong></li><li id="14a2" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv mo lt lu lv bi translated">在WordPress和外部应用程序(<strong class="kc hu"> REST API或GraphQL </strong>)之间创建一个<strong class="kc hu">通信层</strong></li><li id="d289" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv mo lt lu lv bi translated">用Next.js或Gatsby构建一个<strong class="kc hu"> SSG生成的网站</strong>，使用之前构建的模块和一个<strong class="kc hu">通信层</strong>with(headless)<strong class="kc hu">WordPress</strong></li></ol></div><div class="ab cl mt mu gp mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="hb hc hd he hf"><h1 id="0caa" class="ji jj ht bd jk jl na jn jo jp nb jr js iz nc ja ju jc nd jd jw jf ne jg jy jz bi translated">WordPress开发环境</h1><p id="ef38" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">为了开始我们的项目，我们需要一个可以工作的WordPress实例。就个人而言，对于这样的小项目，我使用Docker docs 中的<strong class="kc hu"> Docker </strong>和一个基本的<code class="du mp mq mr ms b">docker-compose.yml</code>配置文件。非常好用。</p><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nf"><img src="../Images/b92e9ad2d053faa7acd1680e636c090a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AeTV3O6MlBVsRs_imhpJEw.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">docker-compose.yml (placed inside project root folder)</figcaption></figure><p id="ea4b" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">请注意，<strong class="kc hu">我已经在默认文件</strong>中添加了几行:</p><ul class=""><li id="1cc2" class="ll lm ht kc b kd ln kg lo kj lp kn lq kr lr kv ls lt lu lv bi translated"><strong class="kc hu">第9–10行</strong>:这将映射我们的端口，并允许我们从Docker容器外部连接到MySQL(使用TablePlus或Sequel Pro)——它将在第10行定义的端口<strong class="kc hu"> 33061 </strong>上被访问</li><li id="fa90" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv ls lt lu lv bi translated"><strong class="kc hu">第29–31行</strong>:这将把我们的WordPress文件映射到容器之外，并允许我们在本地编辑文件，而不需要进入Docker容器。它在一个子文件夹中，所以以后可以添加到<code class="du mp mq mr ms b">.gitignore</code></li></ul><p id="6a58" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">您现在可以打开终端并键入<code class="du mp mq mr ms b">docker-compose up -d --remove-orphans</code>。这将运行我们的<strong class="kc hu"> Docker </strong>容器并“启动”我们的新<strong class="kc hu"> WordPress实例</strong>。标志<code class="du mp mq mr ms b">-d</code>和<code class="du mp mq mr ms b">--remove-orphans</code>在文档中有描述。</p><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ng"><img src="../Images/0b09b7b9585f75516f2f5ce506405edc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NfTKDFNJerk20A41UXJMFA.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">It should output green “done” flags twice — one for database and one for WordPress container</figcaption></figure><p id="af05" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">现在<strong class="kc hu">打开你的浏览器，输入</strong> <code class="du mp mq mr ms b"><a class="ae kw" href="http://localhost:8000." rel="noopener ugc nofollow" target="_blank">http://localhost:8000</a></code>。为什么:8000？因为我们已经在docker-compose的第22行定义了这个端口。</p><p id="f662" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">你现在应该看到默认的WordPress配置屏幕。继续并配置站点。</p><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nh"><img src="../Images/7dd31b87fae4bd94e89a56fec3c618f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vr-M-MvTnma-R7KEbqBMgw.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">WordPress new instance config screen</figcaption></figure></div><div class="ab cl mt mu gp mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="hb hc hd he hf"><h1 id="822e" class="ji jj ht bd jk jl na jn jo jp nb jr js iz nc ja ju jc nd jd jw jf ne jg jy jz bi translated">PHP部分</h1><p id="f391" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">正如我之前说过的，我们需要编写PHP。但是不要担心，这只是一个文件中的几行内容。也可以在整个项目中完成一次。我们需要用PHP编码什么？</p><ul class=""><li id="0eec" class="ll lm ht kc b kd ln kg lo kj lp kn lq kr lr kv ls lt lu lv bi translated">插件核心(我们块的家)</li><li id="5af1" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv ls lt lu lv bi translated">使用一些WP过滤器或钩子(但这也可以用JavaScript <code class="du mp mq mr ms b"><a class="ae kw" href="https://developer.wordpress.org/block-editor/packages/packages-hooks/" rel="noopener ugc nofollow" target="_blank">@wordpress/hooks</a></code>来完成)</li><li id="f137" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv ls lt lu lv bi translated">将块的资产入队</li></ul><p id="d418" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">首先，让我们创建插件。为此，在<code class="du mp mq mr ms b">./wp/wp-content/plugins</code>中创建一个文件夹。我将把它命名为<code class="du mp mq mr ms b">fancy-block</code>。在这个文件夹中，我将创建主插件文件:<code class="du mp mq mr ms b">index.php</code>。</p><figure class="me mf mg mh fd hk er es paragraph-image"><div class="er es ni"><img src="../Images/a85203f07848350d77caaa6f1a37c1dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*KDyA-BFtgs95FP2_FQnzcg.png"/></div><figcaption class="mk ml et er es mm mn bd b be z dx">Basic structure of a plugin</figcaption></figure><p id="820c" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">接下来，我们需要编写一些PHP代码。我们需要:</p><ol class=""><li id="c063" class="ll lm ht kc b kd ln kg lo kj lp kn lq kr lr kv mo lt lu lv bi translated">添加一个<code class="du mp mq mr ms b">&lt;?php</code>声明(以便服务器理解)——第1行</li><li id="b7cb" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv mo lt lu lv bi translated">在插件的标题(WordPress)中添加一个带有插件信息的评论——第2-8行——和在WP插件或主题中一样</li><li id="f08c" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv mo lt lu lv bi translated">阻止访问WordPress作用域之外的插件——第10行</li><li id="82f8" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv mo lt lu lv bi translated">获取我们生成的资产—第14行(更多信息见下文)</li><li id="132d" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv mo lt lu lv bi translated">用<code class="du mp mq mr ms b">wp_register_script</code> —第15-20行登记pt 4中的资产</li><li id="8647" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv mo lt lu lv bi translated">用<code class="du mp mq mr ms b">register_block_type</code>注册我们的古腾堡区块—第21–24行</li><li id="eb81" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv mo lt lu lv bi translated">钩住<code class="du mp mq mr ms b">init</code> —第26行</li></ol><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nj"><img src="../Images/3c076da63bf5788f0912079a818a0ae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uTAlIfukuTqkghRJObTuHw.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">All the PHP code we need for now</figcaption></figure><p id="6b3e" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">干得好！👏</p><p id="0342" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">顺便说一句。暂时不要启用你的插件！它可能会让你的WP安装崩溃。</p></div><div class="ab cl mt mu gp mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="hb hc hd he hf"><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/a8e869be704fd5229deb5e5787b0a01c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UXuGdBJrUBuuVfGirSwgZw.jpeg"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">React Components</figcaption></figure><h1 id="b103" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">反应组分</h1><p id="3235" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">首先，我们需要创建React组件和我们在未来的Gutenberg块中需要的任何功能，如事件、API获取、状态或模拟，以及所有其他东西。</p><h2 id="15f6" class="kx jj ht bd jk ky kz la jo lb lc ld js kj le lf ju kn lg lh jw kr li lj jy lk bi translated">反应组件生成</h2><p id="6127" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">启动React项目有很多方法，比如项目样板、框架等等。我们也可以直接在Next.js应用程序中创建组件。但是在古腾堡身上使用可能会有问题。我将在这个项目中使用众所周知的<a class="ae kw" href="https://reactjs.org/docs/create-a-new-react-app.html" rel="noopener ugc nofollow" target="_blank"><strong class="kc hu"/></a><strong class="kc hu"/>。我们将使用它来构建我们的组件，然后我们将使用它作为古腾堡区块的基础。</p><blockquote class="nk nl nm"><p id="42bc" class="ka kb nn kc b kd ln iu kf kg lo ix ki no mb kl km np mc kp kq nq md kt ku kv hb bi translated">为什么是CRA？😠</p></blockquote><p id="5c44" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">我必须说这是最省时的方法吗？</p><h2 id="5693" class="kx jj ht bd jk ky kz la jo lb lc ld js kj le lf ju kn lg lh jw kr li lj jy lk bi translated">出发点</h2><p id="0991" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">首先，进入插件的根目录，为我们的组件创建一个子文件夹。让我们和CRA一起创造它:</p><p id="b2c7" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated"><code class="du mp mq mr ms b">npx create-react-app components</code></p><p id="a185" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">接下来，我们需要创建我们的React组件。我不会在我的文章中涉及这一部分，因为它会花费太长时间。你可以在网上找到很多关于<a class="ae kw" href="https://reactjs.org" rel="noopener ugc nofollow" target="_blank"> React </a>的资源。这里有一些提示。</p><h2 id="0f23" class="kx jj ht bd jk ky kz la jo lb lc ld js kj le lf ju kn lg lh jw kr li lj jy lk bi translated">RFC或RCC</h2><p id="5816" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">您可以为Gutenberg创建<code class="du mp mq mr ms b">functional</code>或<code class="du mp mq mr ms b">class</code>组件。<strong class="kc hu">两者都可以工作</strong>并且…</p><ul class=""><li id="25ba" class="ll lm ht kc b kd ln kg lo kj lp kn lq kr lr kv ls lt lu lv bi translated">…是的！你将能够使用<a class="ae kw" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kc hu">反应钩子</strong> </a> <strong class="kc hu"> </strong>比如<strong class="kc hu"> </strong> <code class="du mp mq mr ms b">useEffect()</code>里面的功能组件和…</li><li id="40c8" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv ls lt lu lv bi translated">…是的！您将能够使用<a class="ae kw" href="https://reactjs.org/docs/react-component.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kc hu">生命周期方法</strong> </a>等<code class="du mp mq mr ms b">componentDidMount()</code>类内组件</li></ul><p id="d05c" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">…并在Gutenberg内部、WP前端和Next.js中使用它们。</p><h2 id="929f" class="kx jj ht bd jk ky kz la jo lb lc ld js kj le lf ju kn lg lh jw kr li lj jy lk bi translated">状态</h2><p id="7aaf" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">要管理组件的状态，可以使用任何种类的React状态管理，如Redux、React Context或任何其他方式，就像创建独立的React应用程序一样。你也可以像我一样嘲笑你的API。</p><p id="58b9" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">更多关于反应状态和生命周期的信息请点击。</p><h2 id="e6ca" class="kx jj ht bd jk ky kz la jo lb lc ld js kj le lf ju kn lg lh jw kr li lj jy lk bi translated">示例组件</h2><p id="8984" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">我做了一个组件，在一个小盒子里显示用户的数据。此外，还有一个模式/手风琴，它可以在点击按钮时打开和关闭。</p><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nr"><img src="../Images/0b2dc9a5be2dc2a0f5ba4cd427ee3992.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u5uB5sBnG6uSBYVkKyfb-Q.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">An example of React Functional Component (UserCardWrapper) I made for this article</figcaption></figure><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ns"><img src="../Images/a12f54a7f33958d7614d59fb3095d05c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bbd0rb0609GV0JNPjkTvMg.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">An example of component (UserCard) which will be imported to parent</figcaption></figure><p id="3a08" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">注意和<a class="ae kw" href="https://reactjs.org/docs/hooks-reference.html#useeffect" rel="noopener ugc nofollow" target="_blank"> React挂钩的用法(例如</a> <code class="du mp mq mr ms b"><a class="ae kw" href="https://reactjs.org/docs/hooks-reference.html#useeffect" rel="noopener ugc nofollow" target="_blank">useState()</a></code> <a class="ae kw" href="https://reactjs.org/docs/hooks-reference.html#useeffect" rel="noopener ugc nofollow" target="_blank"> ) </a>只在父组件中使用。稍后我会解释为什么它只在顶层组件中。</p><p id="d993" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">这就是组件的样子:</p><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nt"><img src="../Images/74660c3d79d0c2d4193bd664af9c4d68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nsxArSju8xnZRHGI2CD5Fg.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">The component itself (isModalOpen = false) (please don’t dislike me for taste! 😂)</figcaption></figure><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nu"><img src="../Images/9eb176fdf8308c59fe3348048793bd28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yrSCxzrDZSYRjtpF4FgzzQ.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">The component itself (isModalOpen = true)</figcaption></figure><p id="d651" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">这将是足够的纯反应了。我们用WordPress混合一下吧！</p></div><div class="ab cl mt mu gp mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="hb hc hd he hf"><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nv"><img src="../Images/de4e2a57a1f336dc01629502a58f0b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xVz0-Yb53FSinDp6gagF5A.jpeg"/></div></div></figure><h1 id="55ef" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated"><code class="du mp mq mr ms b">registerBlockType: "WordPressify" React component</code></h1><p id="ef83" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">这是我们将结合JavaScript和WordPress的部分。</p><p id="d67a" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">你可能知道，JavaScript的生态系统允许我们使用NPM来管理包，就像PHP中的Composer一样。<code class="du mp mq mr ms b">@wordpress/*</code>上面提到的当然都有。我们要用它。</p><p id="8627" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated"><strong class="kc hu">从</strong>开始，在你的插件根目录下创建一个<code class="du mp mq mr ms b">package.json</code>文件(在<code class="du mp mq mr ms b">index.php</code>旁边)。要做到这一点，打开终端，进入插件根目录，键入<code class="du mp mq mr ms b">npm init</code>并通过所有步骤来配置软件包。</p><p id="12b8" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">然后，通过键入<code class="du mp mq mr ms b">npm install @wordpress/scripts --save-dev</code>来安装<code class="du mp mq mr ms b">@wordpress/scripts</code>。您肯定知道，React需要编译才能在浏览器中运行。这就是为什么我们需要导入官方的<code class="du mp mq mr ms b">scripts</code> <a class="ae kw" href="https://developer.wordpress.org/block-editor/packages/packages-scripts/" rel="noopener ugc nofollow" target="_blank">包</a>。然后，为了利用它，给<code class="du mp mq mr ms b">package.json</code>加两个<code class="du mp mq mr ms b">scripts</code>:</p><ol class=""><li id="c0c8" class="ll lm ht kc b kd ln kg lo kj lp kn lq kr lr kv mo lt lu lv bi translated"><code class="du mp mq mr ms b">build</code> — <code class="du mp mq mr ms b">wp-scripts build ./src/index.js</code></li><li id="4fda" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv mo lt lu lv bi translated"><code class="du mp mq mr ms b">start</code>——<code class="du mp mq mr ms b">wp-scripts start ./src/index.js</code></li></ol><p id="f546" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">现在，您的package.json应该如下所示:</p><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nw"><img src="../Images/7866bcd3b31989bf424cf6a738c9b127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MwLAGd7d2H1XRvyxxGo54A.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">package.json with @wordpress/blocks and scripts</figcaption></figure><p id="3a31" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">为了运行脚本，让我们创建之前在<code class="du mp mq mr ms b">package.json</code>中链接过的<code class="du mp mq mr ms b">./src/index.js</code>文件:</p><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nx"><img src="../Images/1b83b7a6333487645859da4ecf72ad8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oL1TwPPNYaRrRq7UgrmNnQ.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">./src/index.js</figcaption></figure><p id="e20c" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">如你所见，我已经安装、导入并使用了来自<code class="du mp mq mr ms b">@wordpress/blocks</code>的<code class="du mp mq mr ms b">registerBlockType</code>函数，并提供了一些数据，如标题、图标、类别和空属性对象。我还导入了React，因为它强制使用JSX。</p><p id="2597" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">下面是上面使用的例子:</p><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ny"><img src="../Images/f9883343d1209e530a2517b204508742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3zBX5z7bRgntvxWDHxRorQ.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">You can already add your block to any of your posts</figcaption></figure><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nz"><img src="../Images/b39b56307dac5d0cc43def3c30351322.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kpfQQqfz6EkOxlXVREAYbw.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">Here’s the live example of block we created</figcaption></figure><h2 id="128b" class="kx jj ht bd jk ky kz la jo lb lc ld js kj le lf ju kn lg lh jw kr li lj jy lk bi translated">两个不错的函数——edit()和save()</h2><p id="d646" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">根据官方WordPress文档，我们可以在<code class="du mp mq mr ms b">registerBlockType()</code>中使用两个方便的功能。</p><p id="f57e" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">其中一个是<code class="du mp mq mr ms b">edit()</code>，在<code class="du mp mq mr ms b">wp-admin</code> post edit screen内渲染块时会用到。</p><p id="3068" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">另一个是<code class="du mp mq mr ms b">save()</code>。将块作为静态HTML保存到数据库时将使用它(因为所有块都作为静态HTML保存到数据库！).</p><p id="a357" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">请记住，向两者传递相同的组件是可能的，但在我看来这没有多大意义。通常<code class="du mp mq mr ms b">edit()</code>比<code class="du mp mq mr ms b">save()</code>复杂得多，因为我们可以在这里使用<code class="du mp mq mr ms b">InspectorControls</code>和WordPress的其他好东西。我们还管理<code class="du mp mq mr ms b">edit()</code>中的侧边栏“元框”。</p><p id="16b0" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated"><strong class="kc hu">注意</strong>:不幸的是，像CSS-in-JS或React hooks这样更复杂的功能在<code class="du mp mq mr ms b">save()</code>中无法使用。这就是为什么我首先将组件分为子组件和父组件。</p><p id="c6f6" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">让我们利用之前创建的React组件。</p><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es oa"><img src="../Images/161fff1ec9e302ba60148f64714817fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YB2WmP-pO4NxjrlnuMFqSg.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">Our React Component inside Gutenberg</figcaption></figure><p id="dc71" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">我在这里补充的是:</p><ul class=""><li id="ab64" class="ll lm ht kc b kd ln kg lo kj lp kn lq kr lr kv ls lt lu lv bi translated">我已经将我们的React组件传递到古腾堡内部进行渲染了</li><li id="5f00" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv ls lt lu lv bi translated">我已经为block分配了一些默认属性(就像我之前模仿组件内部的API一样)</li><li id="50ea" class="ll lm ht kc b kd lw kg lx kj ly kn lz kr ma kv ls lt lu lv bi translated">我在<code class="du mp mq mr ms b">edit()</code>和<code class="du mp mq mr ms b">save()</code>里面都添加了一些包装<code class="du mp mq mr ms b">&lt;divs&gt;</code>——以便在<code class="du mp mq mr ms b">edit()</code>中使用React钩子</li></ul><p id="ed23" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">这是古腾堡内部街区的样子:</p><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ob"><img src="../Images/0805f2d08f47f3201bef2d36d993ff72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdRahIJL1ix14czyUiDubQ.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">WordPress Gutenberg block made from React Functional Component</figcaption></figure><p id="bf8a" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">这就是它在前端的样子:</p><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es oc"><img src="../Images/4c66d5bbe24afd1fb5cc6bd81075c22d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lqEZT0JaWZOqqUN8oqOXWg.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">React-built Gutenberg block</figcaption></figure><h2 id="efd8" class="kx jj ht bd jk ky kz la jo lb lc ld js kj le lf ju kn lg lh jw kr li lj jy lk bi translated">试试看，玩玩吧！</h2><p id="6f4c" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">当然风格不同，JavaScript也不行。这些问题将在下一集讨论。</p></div><div class="ab cl mt mu gp mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="hb hc hd he hf"><h1 id="ded2" class="ji jj ht bd jk jl na jn jo jp nb jr js iz nc ja ju jc nd jd jw jf ne jg jy jz bi translated">摘要</h1><p id="4d75" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">如果你觉得缺少或者卡在某个地方，我还做了一个演示块，这里:<a class="ae kw" href="https://github.com/trykoszko/gutenberg-block-hydration-example" rel="noopener ugc nofollow" target="_blank">https://github . com/trykoszko/Gutenberg-block-hydration-example</a>。如果你愿意，你可以使用它或贡献它。</p><p id="efd5" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">大约一年前，我还发布了一个关于古腾堡块状水化的视频:</p><figure class="me mf mg mh fd hk"><div class="bz dy l di"><div class="od mj l"/></div><figcaption class="mk ml et er es mm mn bd b be z dx">Make your React Gutenberg block interactive</figcaption></figure></div><div class="ab cl mt mu gp mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="hb hc hd he hf"><p id="ed0b" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">BTW！关于WordPress JavaScript API，我有一个提示给你。进入文章编辑界面，打开控制台，输入<code class="du mp mq mr ms b">wp</code>。你会看到很多很酷的东西！</p><figure class="me mf mg mh fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es oe"><img src="../Images/eb9d3c5f5750af1abb9d5d0bf0994f08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*veeSgsjNXv-TE244JoGMpQ.png"/></div></div><figcaption class="mk ml et er es mm mn bd b be z dx">wp object inside WordPress post edit screen</figcaption></figure></div><div class="ab cl mt mu gp mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="hb hc hd he hf"><p id="c590" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">今天到此为止。在这篇文章的下一部分，我们将涵盖更高级和更深入的主题，如<strong class="kc hu">古腾堡块水合</strong>和<strong class="kc hu">无头WordPress Gutenberg + Next.js </strong>。他们很快就会出来。</p><p id="ed12" class="pw-post-body-paragraph ka kb ht kc b kd ln iu kf kg lo ix ki kj mb kl km kn mc kp kq kr md kt ku kv hb bi translated">随时让我知道你的任何想法！这是WordPress的未来吗？你有什么看法？</p></div></div>    
</body>
</html>