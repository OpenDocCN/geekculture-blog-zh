<html>
<head>
<title>Using Lottie Animations in watchOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在watchOS中使用洛蒂动画</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/using-lottie-animations-in-watchos-b896760f14ab?source=collection_archive---------13-----------------------#2021-03-25">https://medium.com/geekculture/using-lottie-animations-in-watchos-b896760f14ab?source=collection_archive---------13-----------------------#2021-03-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e10e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">洛蒂动画已经改变了你的生活，对开发者来说，添加魔法让你的用户眼花缭乱变得轻而易举。为此，你、你的团队、你的朋友、你的伙伴、孩子甚至你的狗都在到处使用很酷的动画！太美了！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/ec9d71a883cfb11754c58358c759d1d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*r8KZJD0fBVdmNss2rQ4QyQ.gif"/></div></figure><p id="c72a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">洛蒂<a class="ae jl" href="https://github.com/LottieFiles/awesome-lottie" rel="noopener ugc nofollow" target="_blank">支持</a> Web、Android、iOS、桌面甚至多平台。所以基本上一切，对不对？😁</p><p id="231f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你一直在使用Airbnb的Lottie Library，生活一直对你很好，嗯，直到你需要在你的Apple Watch应用程序中添加一些这种魔力，并且你意识到它不被支持。这就是你的反应:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jm"><img src="../Images/75ee78d2e00ebb15edfe5cae8d1d08a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/1*vtluS2pH9xQeYIApu8o0Rg.gif"/></div></figure><p id="fd8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文旨在让您安心，并向您展示如何在watchOS应用程序中支持Lottie动画。😁</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jn"><img src="../Images/355aac86df837379be8ce5fce2f35c8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/1*1vLE9rHtfb5OZYzlGqYf-w.gif"/></div></figure><h1 id="ad97" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">入门指南</h1><p id="64f3" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">好吧，首先，我们需要了解Airbnb的Lottie library不支持watchOS，原因是它需要CoreGraphics来渲染动画，而该框架不是watchOS捆绑包的一部分。</p><p id="83c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是不要担心，我们有替代方案，这就是我们今天要讨论的。首先，为watchOS创建一个新的Xcode项目(如果它是一个独立的应用程序或iOS应用程序的扩展，您实际上并不决定如何做)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es kr"><img src="../Images/987e90dda57dfb502cd5ff89f729ce7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qt1XQnxJRsJkU12D9_X_Qg.png"/></div></div></figure><p id="646f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建项目后，关闭它，并在“终端”中导航到项目的根文件夹。然后，使用以下内容启动项目的cocoapods:</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="8919" class="lb jp hi kx b fi lc ld l le lf">pod init</span></pre><p id="88ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后使用您选择的编辑器打开Podfile。在这里，我们将把所需的pod添加到我们的<strong class="ih hj"> watchOS扩展目标</strong>。</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="4710" class="lb jp hi kx b fi lc ld l le lf">target 'LottieTutorialWatchOS WatchKit <strong class="kx hj">Extension</strong>' do<br/>  platform :watchos, '6.0'<br/>  use_frameworks!</span><span id="63cf" class="lb jp hi kx b fi lg ld l le lf">  pod 'SDWebImageLottieCoder', '~&gt; 0.1.0'<br/>end</span></pre><p id="4d82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后回到终端，安装吊舱，包括:</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="ee50" class="lb jp hi kx b fi lc ld l le lf">pod install</span></pre><p id="a9e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装完依赖项后，使用xcworkspace文件打开您的项目。</p><p id="dd69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个阶段，您应该尝试使用<strong class="ih hj"> CMD+B </strong>来构建项目，以确保一切正常。</p></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><p id="ea27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可能会遇到编译窗格的问题，如下图所示。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lo"><img src="../Images/0ea0b757e257a37867cc9d0100d04cee.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*-t62ESHAxt5-NlWLeE9lXg.png"/></div></figure><p id="fdbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果是这样，只需导航到<code class="du lp lq lr kx b">rlottie_capi.h</code>文件并替换下面一行。</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="5f2c" class="lb jp hi kx b fi lc ld l le lf">// from<br/>#include &lt;rlottiecommon.h&gt;</span><span id="69b3" class="lb jp hi kx b fi lg ld l le lf">// to<br/>#include "rlottiecommon.h"</span></pre><p id="6083" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">试着重新建造，一切都会好的。😊</p></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="1ec3" class="jo jp hi bd jq jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl bi translated">在带有故事板的watchOS上实现</h1><p id="f81c" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">在这个阶段，你已经做好了一切准备，是时候享受一下乐趣了！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jn"><img src="../Images/a6f9a99ee7b04915505a17a9dbeb3982.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/1*I8gDZbnTYZSt0w7KNSwJgg.gif"/></div></figure><p id="0725" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先打开故事板，添加一个InterfaceImage，并将其连接到您的InterfaceController类。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lx"><img src="../Images/871147e4b2f626ee59bcbd75d7b48c7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*8jp7zsRprbV8-8QXr87oIA.gif"/></div></figure><p id="3473" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，导航到InterfaceController.swift，通过导入<strong class="ih hj"> SDWebImageLottieCoder开始。</strong></p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="af17" class="lb jp hi kx b fi lc ld l le lf">import SDWebImageLottieCoder</span></pre><p id="77f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们将开始添加我们的动画配置。第一步是添加变量来支持我们的实现。在<strong class="ih hj">唤醒功能</strong>关闭后立即添加。</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="3f0e" class="lb jp hi kx b fi lc ld l le lf">// MARK:<strong class="kx hj"> - Animation</strong></span><span id="2e68" class="lb jp hi kx b fi lg ld l le lf"><strong class="kx hj">private</strong> <strong class="kx hj">var</strong> coder: SDImageLottieCoder?<br/><strong class="kx hj">private</strong> <strong class="kx hj">var</strong> animationTimer: Timer?<br/><strong class="kx hj">private</strong> <strong class="kx hj">var</strong> currentFrame: UInt = 0<br/><strong class="kx hj">private</strong> <strong class="kx hj">var</strong> playing: Bool = <strong class="kx hj">false<br/>private</strong> <strong class="kx hj">var</strong> speed: Double = 1.0</span></pre><p id="2e9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置好之后，让我们加载动画数据。</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="208e" class="lb jp hi kx b fi lc ld l le lf">/// Loads animation data<br/>/// - <strong class="kx hj">Parameter</strong> url: url of animation JSON<br/><strong class="kx hj">private</strong> <strong class="kx hj">func</strong> loadAnimation(url: URL) {<br/><strong class="kx hj">  let</strong> session = URLSession.shared<br/>  <strong class="kx hj">let</strong> dataTask = session.dataTask(with: URLRequest(url: url)) { (data, response, error) <strong class="kx hj">in<br/>    guard</strong> <strong class="kx hj">let</strong> data = data <strong class="kx hj">else</strong> { <strong class="kx hj">return</strong> }<br/>    DispatchQueue.main.async {<br/>      <strong class="kx hj">self</strong>.setupAnimation(with: data)<br/>    }<br/>  }<br/>  dataTask.resume()<br/>}</span></pre><p id="6404" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们用加载的数据配置动画:</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="ce36" class="lb jp hi kx b fi lc ld l le lf">/// Decodify animation with given data<br/>/// - <strong class="kx hj">Parameter</strong> data: data of animation<br/><strong class="kx hj">private</strong> <strong class="kx hj">func</strong> setupAnimation(with data: Data) {<br/>  coder = SDImageLottieCoder(animatedImageData: data, options: [SDImageCoderOption.decodeLottieResourcePath: Bundle.main.resourcePath!])</span><span id="d314" class="lb jp hi kx b fi lg ld l le lf">  // resets to first frame<br/>  currentFrame = 0<br/>  setImage(frame: currentFrame)<br/>  play()<br/>}</span></pre><p id="2c1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，我们将当前帧设置到WKInterfaceImage中:</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="08fe" class="lb jp hi kx b fi lc ld l le lf">/// Set current animation<br/>/// - <strong class="kx hj">Parameter</strong> frame: Set image for given frame<br/><strong class="kx hj">private</strong> <strong class="kx hj">func</strong> setImage(frame: UInt) {<br/>  <strong class="kx hj">guard</strong> <strong class="kx hj">let</strong> coder = coder <strong class="kx hj">else</strong> { <strong class="kx hj">return</strong> }<br/>  imageView.setImage(coder.animatedImageFrame(at: frame))<br/>}</span></pre><p id="46c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是我们播放/暂停动画的方法:</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="9699" class="lb jp hi kx b fi lc ld l le lf">/// Start playing animation<br/><strong class="kx hj">private</strong> <strong class="kx hj">func</strong> play() {<br/>  playing = <strong class="kx hj">true<br/>  <br/>  </strong>animationTimer?.invalidate()<br/>  animationTimer = Timer.scheduledTimer(withTimeInterval: 0.05/speed, repeats: <strong class="kx hj">true</strong>, block: { (timer) <strong class="kx hj">in<br/>    guard</strong> <strong class="kx hj">self</strong>.playing <strong class="kx hj">else</strong> {<br/>      timer.invalidate()<br/>      <strong class="kx hj">return<br/>    </strong>}<br/>    <strong class="kx hj">self</strong>.nextFrame()<br/>  })<br/>}</span><span id="882b" class="lb jp hi kx b fi lg ld l le lf">/// Pauses animation<br/><strong class="kx hj">private</strong> <strong class="kx hj">func</strong> pause() {<br/>  playing = <strong class="kx hj">false<br/>  </strong>animationTimer?.invalidate()<br/>}</span></pre><p id="9d0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们设置循环和下一帧配置:</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="4262" class="lb jp hi kx b fi lc ld l le lf">/// Replace current frame with next one<br/><strong class="kx hj">private</strong> <strong class="kx hj">func</strong> nextFrame() {<br/>  <strong class="kx hj">guard</strong> <strong class="kx hj">let</strong> coder = coder <strong class="kx hj">else</strong> { <strong class="kx hj">return</strong> }<br/>  <br/>  currentFrame += 1</span><span id="e91d" class="lb jp hi kx b fi lg ld l le lf">  // make sure that current frame is within frame count<br/>  // if reaches the end, we set it back to 0 so it loops<br/>  <strong class="kx hj">if</strong> currentFrame &gt;= coder.animatedImageFrameCount {<br/>    currentFrame = 0<br/>  }</span><span id="04f0" class="lb jp hi kx b fi lg ld l le lf">  setImage(frame: currentFrame)<br/>}</span></pre><p id="6d32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们从唤醒功能中请求动画:</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="0ee1" class="lb jp hi kx b fi lc ld l le lf"><strong class="kx hj">override</strong> <strong class="kx hj">func</strong> awake(withContext context: <strong class="kx hj">Any</strong>?) {<br/>  <strong class="kx hj">super</strong>.awake(withContext: context)<br/>  loadAnimation(url: URL(string: "https://assets8.lottiefiles.com/packages/lf20_Zz37yH.json")!)<br/>}</span></pre><p id="5010" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你遵循了上面的所有说明(当然，如果你也没有决定在你自己的实现上半途而废🤓)这是你应该看到的:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lx"><img src="../Images/2a4f63465613d4e3add674c360f83abb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*vYo05WqOPkaiayIslMr90g.gif"/></div></figure><p id="24a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太棒了，对吧？现在，你的watchOS应用程序已经准备好了，让我们发挥创意吧！🤩你可以在这里找到完整的代码。如果你想更多地了解洛蒂，<a class="ae jl" href="https://lottiefiles.com/blog" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</p><h1 id="b386" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">PS。</h1><p id="3f3c" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">这个实现使用的是<a class="ae jl" href="https://github.com/Samsung/rlottie" rel="noopener ugc nofollow" target="_blank"> rlottie </a>框架(三星)，而不是<a class="ae jl" href="https://github.com/airbnb/lottie-ios" rel="noopener ugc nofollow" target="_blank">Lottie</a>(Airbnb)，这意味着我们不是渲染矢量，而是将动画渲染成光栅化位图，一帧一帧。这意味着有些动画可能不会像使用向量那样加载。</p></div></div>    
</body>
</html>