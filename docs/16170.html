<html>
<head>
<title>How to switch Oracle EBR editions with your JPA datasource</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用JPA数据源切换Oracle EBR版本</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-switch-editions-with-oracle-ebr-with-your-jpa-datasource-1a414061dfde?source=collection_archive---------11-----------------------#2022-12-14">https://medium.com/geekculture/how-to-switch-editions-with-oracle-ebr-with-your-jpa-datasource-1a414061dfde?source=collection_archive---------11-----------------------#2022-12-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/2145b6374882a54af6593b37319b2c85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C5E8IxL3ohDqMv1jKJ6cTA.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Versioning your data access with editions is important for achieving a decoupled release cycle for your database. 📸 Photo by <a class="ae hv" href="https://unsplash.com/@rocinante_11?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Mick Haupt</a> on <a class="ae hv" href="https://unsplash.com/s/photos/numbers?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><div class=""><h2 id="45c5" class="pw-subtitle-paragraph iv hx hy bd b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm dx translated">分离允许应用程序和数据库有不同的发布周期。将Java应用程序从Oracle数据库中分离出来的一种方法是使用Oracle的基于版本的重定义(EBR)特性。本文展示了在使用JPA时如何使用EBR和切换版本。</h2></div><h2 id="573d" class="jn jo hy bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak"> EBR基础知识</strong></h2><p id="f59c" class="pw-post-body-paragraph kl km hy kn b ko kp iz kq kr ks jc kt jy ku kv kw kc kx ky kz kg la lb lc ld hb bi translated">升级数据库应用程序可能要求很高。一个重大挑战是不能经常或在办公时间安排长时间停机。因此，此类应用程序需要在线升级，以便在工作日推出和监控更改。在线升级要求数据库和相关的应用程序支持在线升级。</p><p id="f035" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated">Oracle基于版本的重新定义(EBR)允许在运行时更新数据库对象，而不会造成中断。EBR使用版本化Oracle数据库对象(所谓的版本)的可能性。</p><p id="39c8" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated">每次更改数据库对象时，都会创建一个新版本，然后由应用程序使用。如果你想了解更多关于EBR的知识，请前往<a class="ae hv" href="https://db-oriented.com/my-ebr-blog-post-series/" rel="noopener ugc nofollow" target="_blank">柳文欢的EBR博客文章系列</a>。</p><h2 id="6137" class="jn jo hy bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">分离的发布周期</h2><p id="43d3" class="pw-post-body-paragraph kl km hy kn b ko kp iz kq kr ks jc kt jy ku kv kw kc kx ky kz kg la lb lc ld hb bi translated">将数据库从应用程序中分离出来，可以在不同时重新部署的情况下推出数据库更改。因此，我们有了一个版本化的API，它由应用程序使用，并且可以升级到新的API版本。</p><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lj"><img src="../Images/5a3e2cb90c07fa5d5b504e2a2ed971c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aZHw7HDyLDvzl4jSLPLekA.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">With a versioned API on the database side, applications can switch to newer versions on their own release cycle and thus aren’t coupled to database changes.</figcaption></figure><p id="b32f" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated">这种分离创建了独立的发布周期，并允许两个团队独立地实现特性，而不必协调调整。</p><h2 id="f338" class="jn jo hy bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">切换版本</h2><p id="e679" class="pw-post-body-paragraph kl km hy kn b ko kp iz kq kr ks jc kt jy ku kv kw kc kx ky kz kg la lb lc ld hb bi translated">使用Oracles的EBR，在访问数据库时有不同的方式来定义版本。我在这里介绍了四种可以单独使用或组合使用的方法。</p><p id="4525" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated">在可以访问某个版本之前，该版本必须对用户可用— <a class="ae hv" href="https://docs.oracle.com/en/database/oracle/oracle-database/19/adfns/editions.html#GUID-B9A89ED5-7DC8-4B49-A38D-5B8CA94E7459" rel="noopener ugc nofollow" target="_blank">在Oracle文档中了解有关该版本的更多信息</a>。</p><p id="8595" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated"><strong class="kn hz"> 1️⃣默认数据库版本</strong></p><p id="7864" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated">一旦在数据库中创建了一个版本，让所有应用程序都使用它的最简单的方法就是使它成为默认版本。默认版本用于所有未明确指定要访问的版本的传入数据库连接。</p><pre class="lk ll lm ln fd lo lp lq bn lr ls bi"><span id="46d3" class="lt jo hy lp b be lu lv l lw lx">ALTER DATABASE DEFAULT EDITION = myEditionName</span></pre><p id="a0ed" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated"><strong class="kn hz"> 2️⃣数据库服务</strong></p><p id="4e38" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated">如果需要同时访问几个版本，一种可能是用预设的版本创建不同的数据库服务。这可以通过Oracles的<code class="du ly lz ma lp b">DBMS_SERVICE.CREATE_SERVICE</code>过程<code class="du ly lz ma lp b">edition</code>参数来完成。</p><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mb"><img src="../Images/6e4fc8cab0ee7fbf3277e67607552d8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*ntbc1qtfriZiUVG7j9lByg.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Oracle 19c Documentation — DBMS_SERVICE.CREATE_SERVICE package definition—🔗 <a class="ae hv" href="https://docs.oracle.com/en/database/oracle/oracle-database/19/arpls/DBMS_SERVICE.html" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="fb86" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated">如果新的数据库服务是使用版本创建的，则应用程序可以使用它来建立与数据库的连接。默认情况下，它总是连接到set edition。</p><p id="4454" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated"><strong class="kn hz">版本为</strong>的3️⃣ JPA数据源</p><p id="508f" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated">应用程序端也可以通过JPA数据源设置版本。版本的名称可以在属性<code class="du ly lz ma lp b">oracle.jdbc.editionName</code>中指定。这个版本将在通过JPA数据源建立连接时使用。</p><pre class="lk ll lm ln fd lo lp lq bn lr ls bi"><span id="0335" class="lt jo hy lp b be lu lv l lw lx">properties.setProperty("oracle.jdbc.editionName", "myEditionName");</span></pre><p id="b1f0" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated">具有editionName属性的数据源示例如下所示。</p><pre class="lk ll lm ln fd lo lp lq bn lr ls bi"><span id="f236" class="lt jo hy lp b be lu lv l lw lx">@Bean<br/>       @Primary<br/>       protected DataSource dataSource() {<br/>             DriverManagerDataSource dataSource = new DriverManagerDataSource();<br/> <br/>             dataSource.setDriverClassName(driver);<br/>             dataSource.setUsername(user);<br/>             dataSource.setPassword(pwd);<br/>             dataSource.setUrl(url);<br/> <br/>             Properties properties = new Properties();<br/>             properties.setProperty("oracle.jdbc.editionName", edition);<br/>             dataSource.setConnectionProperties(properties);<br/> <br/>             log.debug("dataSource:{}", dataSource);<br/>             return dataSource;<br/>       }</span></pre><p id="c0c5" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated">该应用程序可以同时使用多个版本和多个设置了不同版本的JPA数据源。</p><p id="7604" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated"><strong class="kn hz"> 4️⃣手动设置版本</strong></p><p id="cbc3" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated">也可以在会话期间手动设置版本。为此，在会话中发出一个<code class="du ly lz ma lp b">ALTER SESSION</code>命令。</p><pre class="lk ll lm ln fd lo lp lq bn lr ls bi"><span id="4014" class="lt jo hy lp b be lu lv l lw lx">ALTER SESSION SET EDITION = myEditionName</span></pre><p id="8240" class="pw-post-body-paragraph kl km hy kn b ko le iz kq kr lf jc kt jy lg kv kw kc lh ky kz kg li lb lc ld hb bi translated">在alter session命令之后，不需要提交；新版马上就可以买到了。</p><h2 id="5a12" class="jn jo hy bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">结论</h2><p id="9a40" class="pw-post-body-paragraph kl km hy kn b ko kp iz kq kr ks jc kt jy ku kv kw kc kx ky kz kg la lb lc ld hb bi translated">版本的应用和使用可以用许多不同的方式来设计。因此，使用与您的发布周期和工作方法最协调的方法来避免可能的障碍是很重要的。</p><h1 id="50a0" class="mc jo hy bd jp md me mf jt mg mh mi jx je mj jf kb jh mk ji kf jk ml jl kj mm bi translated">资源</h1><div class="hh hi ez fb hj mn"><a href="https://docs.oracle.com/en/database/oracle/oracle-database/19/arpls/DBMS_SERVICE.html" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab dw"><div class="mp ab mq cl cj mr"><h2 class="bd hz fi z dy ms ea eb mt ed ef hx bi translated">PL/SQL程序包和类型参考</h2><div class="mu l"><h3 class="bd b fi z dy ms ea eb mt ed ef dx translated">DBMS_SERVICE包允许您为单个实例创建、删除、激活和停用服务。这一章…</h3></div><div class="mv l"><p class="bd b fp z dy ms ea eb mt ed ef dx translated">docs.oracle.com</p></div></div></div></a></div><div class="hh hi ez fb hj mn"><a href="https://db-oriented.com/my-ebr-blog-post-series/" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab dw"><div class="mp ab mq cl cj mr"><h2 class="bd hz fi z dy ms ea eb mt ed ef hx bi translated">我的EBR博文系列- @DBoriented</h2><div class="mu l"><h3 class="bd b fi z dy ms ea eb mt ed ef dx translated">这是我写的关于基于版本的重定义的一系列文章的索引。将添加新条目…</h3></div><div class="mv l"><p class="bd b fp z dy ms ea eb mt ed ef dx translated">db-oriented.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb hp mn"/></div></div></a></div><div class="hh hi ez fb hj mn"><a href="https://docs.oracle.com/en/database/oracle/oracle-database/19/adfns/editions.html#GUID-58DE05A0-5DEF-4791-8FA8-F04D11964906" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab dw"><div class="mp ab mq cl cj mr"><h2 class="bd hz fi z dy ms ea eb mt ed ef hx bi translated">数据库开发指南</h2><div class="mu l"><h3 class="bd b fi z dy ms ea eb mt ed ef dx translated">数据库开发指南应用程序开发人员使用基于版本的重新定义基于版本的高级主题…</h3></div><div class="mv l"><p class="bd b fp z dy ms ea eb mt ed ef dx translated">docs.oracle.com</p></div></div></div></a></div><div class="hh hi ez fb hj mn"><a href="https://download.oracle.com/otn_hosted_doc/jdeveloper/905/jdbc-javadoc/oracle/jdbc/OracleConnection.html#CONNECTION_PROPERTY_EDITION_NAME" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab dw"><div class="mp ab mq cl cj mr"><h2 class="bd hz fi z dy ms ea eb mt ed ef hx bi translated">OracleConnection (Oracle JDBC API参考)</h2><div class="mu l"><h3 class="bd b fi z dy ms ea eb mt ed ef dx translated">所有超级接口:java.sql.Connection所有已知的实现类:OracleConnectionWrapper public…</h3></div><div class="mv l"><p class="bd b fp z dy ms ea eb mt ed ef dx translated">download.oracle.com</p></div></div></div></a></div></div></div>    
</body>
</html>