<html>
<head>
<title>Build Simple Attendance App in Kotlin — Part 3— Save Student Record Into Database Using Room</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kotlin中构建简单的考勤应用程序—第3部分—使用Room将学生记录保存到数据库中</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/build-simple-attendance-app-in-kotlin-part-3-save-student-record-into-database-using-room-4800d4f9af2a?source=collection_archive---------30-----------------------#2021-07-04">https://medium.com/geekculture/build-simple-attendance-app-in-kotlin-part-3-save-student-record-into-database-using-room-4800d4f9af2a?source=collection_archive---------30-----------------------#2021-07-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2768" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你学习如何构建一个应用程序时，最有趣的部分是什么？对我来说，这是我可以在数据库中存储数据的时候。虽然它有一些困难的概念，但当你能实现它们时，你会感到自豪。</p><p id="ac0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在最后一部分中，您将学习如何从主屏幕导航到学生表单。但是，您仍然没有持久化您的记录，所以您不能再次访问您的数据。</p><p id="4822" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一部分，您将学习如何做到这一点。您将学习如何使用房间数据库持久性。最后，您还将学习一些关于RxJava的概念。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="ffe2" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">章节:</h1><ul class=""><li id="2afb" class="ki kj hi ih b ii kk im kl iq km iu kn iy ko jc kp kq kr ks bi translated"><a class="ae kt" rel="noopener" href="/geekculture/build-simple-attendance-app-in-kotlin-part-1-dashboard-layout-c111b84ea9cf">使用ConstraintLayout的简单仪表板</a></li><li id="aa7d" class="ki kj hi ih b ii ku im kv iq kw iu kx iy ky jc kp kq kr ks bi translated"><a class="ae kt" rel="noopener" href="/geekculture/build-simple-attendance-app-in-kotlin-part-2-navigate-to-student-form-a9f519a1098c?source=---------0----------------------------">喷气背包导航—学生表单</a></li><li id="b39e" class="ki kj hi ih b ii ku im kv iq kw iu kx iy ky jc kp kq kr ks bi translated">房间，RxJava学生插入[您在这里]</li></ul><p id="2f93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于每一章，我将提供三个链接:</p><ul class=""><li id="df9f" class="ki kj hi ih b ii ij im in iq kz iu la iy lb jc kp kq kr ks bi translated">拉链。你可以下载。</li><li id="2734" class="ki kj hi ih b ii ku im kv iq kw iu kx iy ky jc kp kq kr ks bi translated">差异。您可以显示章节之间的差异。</li><li id="a0b9" class="ki kj hi ih b ii ku im kv iq kw iu kx iy ky jc kp kq kr ks bi translated">每个章节的标记存储库</li></ul><p id="039c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kt" href="https://github.com/ihfazhillah/Simple-Attendance-Example/archive/refs/tags/part3.zip" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> zip </strong> </a>，<a class="ae kt" href="https://github.com/ihfazhillah/Simple-Attendance-Example/compare/part2...part3" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> diff </strong> </a>，<a class="ae kt" href="https://github.com/ihfazhillah/Simple-Attendance-Example/tree/part3" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> repo </strong> </a></p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h2 id="000e" class="lc jl hi bd jm ld le lf jq lg lh li ju iq lj lk jy iu ll lm kc iy ln lo kg lp bi translated">实体、Dao和数据库</h2><p id="92d8" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">要实现房间，你必须知道它的3个最重要的部分。<strong class="ih hj">实体，道，数据库。</strong></p><p id="6f01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将从最小的部分开始，即<strong class="ih hj">实体</strong>。该实体基本上类似于数据库的表定义。它将用于将数据库中的一条记录数据映射到一个Kotlin对象中。</p><p id="469e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该实体将如下所示:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="23b4" class="lc jl hi ly b fi mc md l me mf">@Entity &lt;-- this data class is an entity<br/>data class SomeObject(<br/>    @PrimaryKey <br/>    val theId: Int,<br/>    <br/>    @ColumnInfo<br/>    val someColumn: String,</span><span id="f0ea" class="lc jl hi ly b fi mg md l me mf">    @ColumnInfo(name="hello")<br/>    val anotherColumn: String?<br/>)</span></pre><p id="5d7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您想要创建一个实体时，您应该使用<code class="du mh mi mj ly b">@Entity</code>注释一个数据类对象。如果没有指定任何参数，表名将与类名匹配。</p><p id="b464" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想使用另一个名称，您可以提供一个名为<code class="du mh mi mj ly b">tableName</code>的参数。假设你要将这个类映射到对象表，你应该使用<code class="du mh mi mj ly b">@Entity(tableName = "object")</code>。</p><p id="e7cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该为一个实体定义至少一个主键。您可以使用<code class="du mh mi mj ly b">@PrimaryKey</code>注释定义一个主键。您也可以通过提供autoGenerated=true作为其参数来使其自动递增。</p><p id="7649" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，要定义其他列，可以使用<code class="du mh mi mj ly b">@ColumnInfo</code>注释。列名将与变量名相同，除了您添加了一个<code class="du mh mi mj ly b">name</code>参数作为它的参数。</p><p id="9f3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想使列可为空，你可以在变量类型后面加上<code class="du mh mi mj ly b">?</code>符号。</p><p id="3f6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好，那<strong class="ih hj">刀</strong>呢？<strong class="ih hj"> D </strong>数据库<strong class="ih hj"> A </strong>访问<strong class="ih hj"> O </strong>对象。由Room提供的接口，用于抽象任何数据库操作。您可以使用它来查询、插入、更新或删除数据库中的对象，而不是编写SQL脚本来生成数据并手动映射它。</p><p id="892a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有趣的是，你不能从dao函数返回任何东西，一个实体，一个实体列表。此外，当你想与RxJava集成时，你可以返回Completable，for，Single。使用它的另一个好处是与Jetpack的正式集成——分页。</p><p id="46f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Dao对象将如下所示:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="3887" class="lc jl hi ly b fi mc md l me mf">@Dao<br/>interface HelloDao{<br/> @Query("select * from hello")<br/> fun list(): List&lt;HelloEntity&gt;<br/>}</span></pre><p id="5335" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要创建一个DAO对象，可以用<code class="du mh mi mj ly b">@Dao</code>注释来注释一个接口。然后对于查询，您可以使用<code class="du mh mi mj ly b">@Query</code>注释来注释一个方法。您也可以使用<code class="du mh mi mj ly b">@Insert</code>进行插入。<code class="du mh mi mj ly b">@Update</code>用于更新，<code class="du mh mi mj ly b">@Delete</code>用于删除。</p><p id="e6f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后是<code class="du mh mi mj ly b">Database</code>。这是这两者之间的粘合剂。</p><p id="10a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该数据库将看起来像这样</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="48d7" class="lc jl hi ly b fi mc md l me mf">@Database(entities = [Entity::class], version)<br/>abstract class AppDatabase: RoomDatabase(){<br/>     abstract fun entityDao(): EntityDao<br/>}</span></pre><p id="284b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，您的数据库类是<code class="du mh mi mj ly b">RoomDatabase</code>类的子类。您将使用<code class="du mh mi mj ly b">Room.databaseBuilder</code>来构建它。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h2 id="9070" class="lc jl hi bd jm ld le lf jq lg lh li ju iq lj lk jy iu ll lm kc iy ln lo kg lp bi translated">让我们建立你自己的</h2><p id="d483" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">从最小的部分开始，实现它，你会得到全貌。后续的实现对你来说就容易了。</p><p id="81fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你已经做了一些关于学生形式的工作，让我们从它开始。</p><p id="748d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将房间版本添加到build.gradle</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="4855" class="lc jl hi ly b fi mc md l me mf">ext.room_version = "2.3.0"</span></pre><p id="a674" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，在应用程序的build.gradle中添加依赖项</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="31fc" class="lc jl hi ly b fi mc md l me mf"><em class="mk">// room database<br/>    </em>implementation "androidx.room:room-runtime:$room_version"<br/>    kapt "androidx.room:room-compiler:$room_version"</span></pre><p id="5d8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du mh mi mj ly b">kapt</code>用于注释处理，在kotlin语言中使用。你应该启用<code class="du mh mi mj ly b">kotlin-kapt</code>插件。</p><p id="3ef1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您的插件将如下所示:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="7910" class="lc jl hi ly b fi mc md l me mf">plugins {<br/>    id 'com.android.application'<br/>    id 'kotlin-android'<br/>    id 'kotlin-kapt'<br/>    id 'androidx.navigation.safeargs.kotlin'<br/>}</span></pre></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h2 id="4b39" class="lc jl hi bd jm ld le lf jq lg lh li ju iq lj lk jy iu ll lm kc iy ln lo kg lp bi translated">启动学生数据库</h2><p id="b45f" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">创建一个类似这样的项目结构</p><figure class="lt lu lv lw fd mm er es paragraph-image"><div class="er es ml"><img src="../Images/f63b71f73ef17eedcf1332ae5565fce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*tcnUaA1nHD1X_plFvQEgOQ.png"/></div></figure><ul class=""><li id="0e39" class="ki kj hi ih b ii ij im in iq kz iu la iy lb jc kp kq kr ks bi translated">学生岛</li><li id="422f" class="ki kj hi ih b ii ku im kv iq kw iu kx iy ky jc kp kq kr ks bi translated">学生身份</li><li id="1a3d" class="ki kj hi ih b ii ku im kv iq kw iu kx iy ky jc kp kq kr ks bi translated">应用数据库</li></ul><p id="b6d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们实现您之前已经了解的关于实体、Dao和数据库的内容。</p><figure class="lt lu lv lw fd mm"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="a2f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将创建包含三列的表<strong class="ih hj">学生</strong>:</p><ul class=""><li id="6652" class="ki kj hi ih b ii ij im in iq kz iu la iy lb jc kp kq kr ks bi translated">studentId作为主键</li><li id="32e8" class="ki kj hi ih b ii ku im kv iq kw iu kx iy ky jc kp kq kr ks bi translated">名字</li><li id="11bc" class="ki kj hi ih b ii ku im kv iq kw iu kx iy ky jc kp kq kr ks bi translated">姓</li></ul><p id="9bc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有列都是varchar类型的不可空列。</p><figure class="lt lu lv lw fd mm"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="500d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将用于将学生记录插入数据库。只要数据库找到具有相同主键的记录，onConflict参数就会替换它。您不需要首先检查是否找到了记录，也不会出现唯一约束错误。</p><p id="a35b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，应用数据库</p><figure class="lt lu lv lw fd mm"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="c4de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实际上，如果你使用依赖注入这样的东西，你会摆脱<code class="du mh mi mj ly b">companion object</code>块。现在，你可以跳过它。如果你对这个名字感到好奇，它被命名为Singleton设计模式。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h2 id="f1ad" class="lc jl hi bd jm ld le lf jq lg lh li ju iq lj lk jy iu ll lm kc iy ln lo kg lp bi translated">保存您的学生记录</h2><p id="1dd8" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">更改您的按钮点击监听器</p><figure class="lt lu lv lw fd mm"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="4dea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，您首先获得数据库对象。然后创建一个外部执行器，并将流程记录插入传递给它。</p><p id="68c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为什么我们需要使用外部执行器？因为数据库插入是一个庞大的操作，可能会使您的UI滞后。所以你应该把它从android主线程中传递出去。</p><p id="0f64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在最后一部分中，您将屏幕导航到主屏幕。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h2 id="5b13" class="lc jl hi bd jm ld le lf jq lg lh li ju iq lj lk jy iu ll lm kc iy ln lo kg lp bi translated">将RxJava添加到应用程序中</h2><p id="929f" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">RxJava帮助您处理事件驱动类型的应用程序。先装吧。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="4295" class="lc jl hi ly b fi mc md l me mf"><em class="mk">// room rxjava support<br/></em>implementation "androidx.room:room-rxjava2:$room_version"<br/><br/><em class="mk">// rxjava<br/></em>implementation "io.reactivex.rxjava2:rxjava:$rxjava_version"</span><span id="0baa" class="lc jl hi ly b fi mg md l me mf">implementation "io.reactivex.rxjava2:rxandroid:$rxjava_android_version"</span></pre><p id="29a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这些版本</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="b5a1" class="lc jl hi ly b fi mc md l me mf">ext.rxjava_version = "2.2.21"<br/>ext.rxjava_android_version = "2.1.1"</span></pre><p id="9800" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Rx-java世界中，我们有许多类型的可观察对象(可以用来观察的东西，一旦某种类型的事件发生，你可以做一些动作)。其中一个是可完成的T2。</p><p id="4aa5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Completable </strong>将被发送，除了“嘿，你做的操作已经完成”事件之外，不包含任何数据。</p><p id="c0d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将在这里使用它来观察插入操作是否已经完成。如果已经完成，你将向上导航，而不是向上导航你的屏幕，你不知道操作是否完成。</p><p id="200d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新您的插入函数以返回Completable类型，这样您的StudentDao将看起来像</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="a14b" class="lc jl hi ly b fi mc md l me mf">fun insert(student: StudentEntity): Completable</span></pre><p id="3bdb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您的插入操作将返回一个Completable。您不需要像以前一样手动将函数扔进外部线程，让RxJava来处理。</p><p id="7470" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看实际情况。</p><p id="b6fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新btnSave click操作，如下所示</p><figure class="lt lu lv lw fd mm"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="075a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它只是简单地说:将函数调用扔进<strong class="ih hj"> Schedulers.io() </strong>并在<strong class="ih hj"> Android.mainThread()中等待它。</strong>调用成功后，导航至主屏幕。</p><p id="31bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你用<strong class="ih hj">订阅</strong>的<strong class="ih hj">抛出调用函数</strong>，用<strong class="ih hj">观察</strong>的<strong class="ih hj">等待</strong>。最后，当调用成功时，您使用<strong class="ih hj"> subscribe </strong>函数来调用下一步要做的事情。</p><h2 id="9bd4" class="lc jl hi bd jm ld le lf jq lg lh li ju iq lj lk jy iu ll lm kc iy ln lo kg lp bi translated">可任意处理的</h2><p id="7d6e" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">现在，在db.insert函数中，您将得到一个警告，提示“该变量未被使用”</p><p id="925a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">completable对象的subscribe方法返回一个可释放的对象。这个对象使您能够控制对函数调用的观察。</p><p id="5c8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将使用CompositeDisposable来处理这个问题。它只是一个一次性物品的容器，你可以同时处理/清除它们。</p><p id="93cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将私有属性添加到片段中</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="37a3" class="lc jl hi ly b fi mc md l me mf">private val compositeDisposable = CompositeDisposable()</span></pre><p id="fac7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后将插入调用保存到一个变量中，并将其添加到compositeDisposable中</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="d1c3" class="lc jl hi ly b fi mc md l me mf">var disposable = db.studentDao().... <br/>compositeDisposable.add(disposable)</span></pre><p id="cbf6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，当片段生命周期进入onDestroyView时处理它</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="a63b" class="lc jl hi ly b fi mc md l me mf">override fun onDestroyView(){<br/>    super.onDestroyView()<br/>    _binding = null<br/>    compositeDisposable.dispose()<br/>}</span></pre><h2 id="4e5b" class="lc jl hi bd jm ld le lf jq lg lh li ju iq lj lk jy iu ll lm kc iy ln lo kg lp bi translated">视图模型</h2><p id="a0ec" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">让我们将您的插入逻辑移到一个视图模型中。</p><figure class="lt lu lv lw fd mm"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="f3be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后在你的片段中</p><figure class="lt lu lv lw fd mm"><div class="bz dy l di"><div class="mp mq l"/></div></figure><h2 id="8c28" class="lc jl hi bd jm ld le lf jq lg lh li ju iq lj lk jy iu ll lm kc iy ln lo kg lp bi translated">使用委托启动视图模型</h2><p id="6099" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">你可以稍微清理一下你的代码。您可以使用kotlin提供的delegate函数来处理ViewModel初始化重复任务。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="ae3a" class="lc jl hi ly b fi mc md l me mf">private val viewModel: StudentFormViewModel by <em class="mk">viewModels</em>()</span></pre><p id="8867" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并在btnSave click listener之前删除viewModel变量。</p><h2 id="cea5" class="lc jl hi bd jm ld le lf jq lg lh li ju iq lj lk jy iu ll lm kc iy ln lo kg lp bi translated">添加禁用状态</h2><p id="a11a" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">当您多次单击save按钮时，您会在数据库检查器中注意到插入记录出现了多次。为了防止这种情况，您可以在点击按钮后禁用它。</p><p id="50b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将它添加到btnSave的onClick侦听器中</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="46b3" class="lc jl hi ly b fi mc md l me mf"><strong class="ly hj">it</strong>.<em class="mk">isEnabled </em>= false</span></pre></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="6b90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，你做得很好！</p><p id="1022" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您已经在这里学习了一些概念:</p><ul class=""><li id="1d81" class="ki kj hi ih b ii ij im in iq kz iu la iy lb jc kp kq kr ks bi translated">房间数据库</li><li id="baae" class="ki kj hi ih b ii ku im kv iq kw iu kx iy ky jc kp kq kr ks bi translated">一些RxJava的东西</li><li id="d60a" class="ki kj hi ih b ii ku im kv iq kw iu kx iy ky jc kp kq kr ks bi translated">视图模型</li></ul></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="d837" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">资源</h1><ul class=""><li id="2885" class="ki kj hi ih b ii kk im kl iq km iu kn iy ko jc kp kq kr ks bi translated"><a class="ae kt" href="https://developer.android.com/training/data-storage/room" rel="noopener ugc nofollow" target="_blank">https://developer.android.com/training/data-storage/room</a></li><li id="8890" class="ki kj hi ih b ii ku im kv iq kw iu kx iy ky jc kp kq kr ks bi translated">【https://guides.codepath.com/android/RxJava T2】号</li><li id="99c8" class="ki kj hi ih b ii ku im kv iq kw iu kx iy ky jc kp kq kr ks bi translated">【https://kotlinlang.org/docs/delegation.html T4】</li></ul></div></div>    
</body>
</html>