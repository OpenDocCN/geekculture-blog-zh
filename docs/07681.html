<html>
<head>
<title>From Terralith to Terraservice with Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Terralith到Terraservice与Terraform</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/from-terralith-to-terraservice-with-terraform-acf990e65578?source=collection_archive---------8-----------------------#2021-09-27">https://medium.com/geekculture/from-terralith-to-terraservice-with-terraform-acf990e65578?source=collection_archive---------8-----------------------#2021-09-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/ec77c2c68952edb65a3e840f69964a36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mqEyztYk8uwcTAb8"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Photo by <a class="ae hv" href="https://unsplash.com/@imlst?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Valery Fedotov</a> on <a class="ae hv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="e54f" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是关于Terragrunt和Terraspace的三集系列的第一篇文章。</p><blockquote class="jt ju jv"><p id="44ce" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated">第一集:<a class="ae hv" rel="noopener" href="/geekculture/from-terralith-to-terraservice-with-terraform-acf990e65578">从Terralith到Terraservice用Terraform </a> <br/>第二集:<a class="ae hv" href="https://bit.ly/2YfWRED" rel="noopener ugc nofollow" target="_blank"> Terragrunt小抄</a> <br/>第三集:<a class="ae hv" href="http://bit.ly/3o2DrMV" rel="noopener ugc nofollow" target="_blank"> Terraspace小抄</a></p></blockquote><p id="306b" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所有这些工具都可以用来将你的基础设施定义为一个试图应用<a class="ae hv" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="noopener ugc nofollow" target="_blank"> DRY </a>模式的代码(IaaC)。</p><p id="2155" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jw">先决条件:对主要地形概念的基本理解。</em></p></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><figure class="ki kj kk kl fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kh"><img src="../Images/4e61ef07de46c61d72f91451abc94993.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pE-dsniUPMQswELvHzDxzg.jpeg"/></div></div></figure><h1 id="83a2" class="km kn hy bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">哪个是症状？</h1><p id="b6a7" class="pw-post-body-paragraph iv iw hy ix b iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated">基础设施变得更加复杂，您需要<br/>从这些需求中找出:</p><ul class=""><li id="a1a7" class="lp lq hy ix b iy iz jc jd jg lr jk ls jo lt js lu lv lw lx bi translated">多地区，</li><li id="dc9f" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">多环境，</li><li id="edf4" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">多账户。</li></ul><p id="7417" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">三“多”模式。</strong></p></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><p id="0905" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当复杂性增加时，有多种方法来管理IaaC。<br/>管理多种模式的Terraform项目的发展由步骤、新功能和经验组成，可以让您兴奋不已。</p><p id="4735" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就复杂性而言，一个典型的terraform项目通过这5种模式发展。既然我们想变得干巴巴[ <a class="ae hv" href="https://www.youtube.com/watch?v=wgzgVm7Sqlk" rel="noopener ugc nofollow" target="_blank">请看看这个伟大的演示文稿</a>，对它们进行深入的分析。</p><p id="7bf5" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里有一个简短的总结:</p><ol class=""><li id="54ac" class="lp lq hy ix b iy iz jc jd jg lr jk ls jo lt js md lv lw lx bi translated"><strong class="ix hz"> Terralith </strong>:单一状态文件，单一定义文件，硬编码配置，本地状态。两个字:都在一起！</li><li id="f188" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js md lv lw lx bi translated"><strong class="ix hz">多Terralith </strong>:远程状态，多terraform文件，更好的利用变量→1:1 tfState-environment。</li><li id="30c3" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js md lv lw lx bi translated"><strong class="ix hz"> Terramod </strong>:与Env变量互连的可重用模块，独立的Env管理→ 1:1 tfState-environment</li><li id="b642" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js md lv lw lx bi translated"><strong class="ix hz"> Power(Terramod，n) </strong>:嵌套模块(Base[infra]+系统特定)，专用模块repo → 1:1 tfState-environment</li><li id="418b" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js md lv lw lx bi translated"><strong class="ix hz">陆地服务</strong>:</li></ol><ul class=""><li id="ce95" class="lp lq hy ix b iy iz jc jd jg lr jk ls jo lt js lu lv lw lx bi translated">独立管理逻辑组件:隔离并降低风险</li><li id="e432" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">多团队设置</li><li id="0d8a" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">分布式(远程状态):<strong class="ix hz">N:1 = TF State:environment</strong></li><li id="d2f6" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">需要额外的编排工作</li><li id="4e50" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">环境之间的存储库隔离</li></ul><figure class="ki kj kk kl fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es me"><img src="../Images/f8a22dacdb67ec10220a85f0eef16a47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6I72KMS0HsAgbPKM"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Photo by <a class="ae hv" href="https://unsplash.com/@anniespratt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Annie Spratt</a> on <a class="ae hv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="44ff" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您至少有两种选择来管理“Terraservice”场景:</p><ol class=""><li id="080a" class="lp lq hy ix b iy iz jc jd jg lr jk ls jo lt js md lv lw lx bi translated">花一些时间在一个<strong class="ix hz">定制</strong>脚本和管道上，解决所有的需求。</li><li id="7457" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js md lv lw lx bi translated">开始学习<strong class="ix hz"> Terragrunt </strong>，<strong class="ix hz"> Terraspace </strong>和<strong class="ix hz">比较</strong>它们。</li></ol><blockquote class="mf"><p id="dc58" class="mg mh hy bd mi mj mk ml mm mn mo js dx translated">我要解释的是第二个选项</p></blockquote></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><p id="c630" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们列出<strong class="ix hz">关键需求</strong>以及我们希望在Terraservice场景中解决的原因:</p><ul class=""><li id="a3db" class="lp lq hy ix b iy iz jc jd jg lr jk ls jo lt js lu lv lw lx bi translated">干——但我更喜欢权衡利弊。<br/> <em class="jw">有时会重复自己介绍的一些清晰的东西。</em></li><li id="8cc5" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">客户、环境、区域和服务之间的组织结构。</li><li id="ef3e" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">同一个帐户中的多个状态文件，自动后端供应。与其拥有一个巨大的状态文件，不如分割它！</li><li id="2a56" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">在同一帐户中管理多个地区。</li><li id="0205" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">团队之间同时工作。<br/> <em class="jw">当团队增加时，你需要增加并行度来减少冲突。</em></li><li id="a319" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">在TFvars上分层(base.tfvars与特定的env staging.tfvars合并)。<br/> <em class="jw">不重复所有变量。复制-粘贴可能是一个</em> <strong class="ix hz"> <em class="jw">严重的</em> </strong> <em class="jw">问题！</em></li><li id="cb2d" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">模块间的依赖“管理”。<br/> <em class="jw">维持模块间的低互连可以减少令人头疼的数量。</em></li><li id="d18b" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">在命令前后运行的钩子。</li><li id="7175" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">规划/应用所有内容的单一命令。<br/> <em class="jw">注意两个框架提供的“应用全部”命令。</em></li><li id="26a4" class="lp lq hy ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">不会增加太多开销。<br/> <em class="jw">很少有人愿意为此学习一门新的编程语言。</em></li></ul><h1 id="5ef3" class="km kn hy bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">你觉得这个列表怎么样？</h1></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><p id="d75b" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在下一篇文章中，我将用一个真实的例子展示如何用Terragrunt和Terraspace解决这些需求的主要部分。</p><figure class="ki kj kk kl fd hk er es paragraph-image"><div class="er es mq"><img src="../Images/5e942234f579c9081df2fc372dab8480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*BOuMEt5xHDy0yZE6mtKsFA.png"/></div></figure><blockquote class="mf"><p id="34d5" class="mg mh hy bd mi mj mk ml mm mn mo js dx translated"><a class="ae hv" href="https://pie-r.medium.com/" rel="noopener">关注我</a>和<a class="ae hv" href="https://pie-r.medium.com/subscribe" rel="noopener">订阅</a>来获取这个系列和下一个系列的更新！</p></blockquote></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><figure class="ki kj kk kl fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mr"><img src="../Images/ea0b13a7e23bac4817a9b62b3a1e9cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kICXL0VV0KJYN7zM"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Photo by <a class="ae hv" href="https://unsplash.com/@__itsflores?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Omar Flores</a> on <a class="ae hv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e6b5" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">参考资料:</p><p id="7feb" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">[1]<a class="ae hv" href="https://www.hashicorp.com/resources" rel="noopener ugc nofollow" target="_blank">https://www.hashicorp.com/resources</a></p></div></div>    
</body>
</html>