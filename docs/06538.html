<html>
<head>
<title>Power your Cypress tests with CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用CircleCI为您的Cypress测试提供动力</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/power-your-cypress-tests-with-circleci-88e94507d25a?source=collection_archive---------17-----------------------#2021-08-23">https://medium.com/geekculture/power-your-cypress-tests-with-circleci-88e94507d25a?source=collection_archive---------17-----------------------#2021-08-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a498" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇博客将让你了解如何使用Cypress实现你的e2e测试，并为你的测试与CircleCI进行持续集成和交付。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/add63069a34b9c017dc740a3a51f8050.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hejhTWmH8jqMscCJE6X-CA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">cypress+circleci</figcaption></figure><h1 id="7edf" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">关于赛普拉斯</h1><p id="9272" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">Cypress是下一代前端测试工具，专为现代web应用程序而设计。Cypress完全具备以下特性:<br/> <br/> —时间旅行<br/> <br/> —可调试性<br/> <br/> —自动等待<br/> <br/> —截图和视频<br/> <br/> —跨浏览器测试</p><p id="6bf5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有更多…</p><p id="dc4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">柏树在建筑上是不同的。与大多数工具不同，它在应用程序的同一个运行循环中运行。它与节点进程同步，并管理通信、同步和代表彼此执行任务。</p><h1 id="b457" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">项目设置</h1><p id="57f4" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">让我们开始设置一个基本的Cypress项目<br/><br/>——创建一个名为<code class="du kw kx ky kz b">cypress-circleci</code>的文件夹并初始化您的节点项目</p><pre class="je jf jg jh fd la kz lb lc aw ld bi"><span id="2d94" class="le ju hi kz b fi lf lg l lh li">$ mkdir cypress-circleci<br/>$ npm init</span></pre><p id="8e42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-使用命令安装cypress</p><pre class="je jf jg jh fd la kz lb lc aw ld bi"><span id="8146" class="le ju hi kz b fi lf lg l lh li">npm install cypress --save</span></pre><p id="5b7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-打开项目中的柏树</p><pre class="je jf jg jh fd la kz lb lc aw ld bi"><span id="df97" class="le ju hi kz b fi lf lg l lh li">npx cypress open</span></pre><p id="e881" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-文件夹结构如下所示</p><blockquote class="lj lk ll"><p id="3ccd" class="if ig lm ih b ii ij ik il im in io ip ln ir is it lo iv iw ix lp iz ja jb jc hb bi translated"><code class="du kw kx ky kz b">circleci-cypress<br/>│<br/>└───fixtures<br/>│ │ sampleData.json<br/>│ │<br/>└───integration<br/>│ │ siteVerify.js<br/>│<br/>└───plugins<br/>│ │ index.js<br/>│<br/>└───screenshots<br/>│ │ img1.pmg<br/>│<br/>└───results<br/>│ │ test<br/>│<br/>└───supports<br/>│ │ commands.js<br/>│ │ index.js<br/>|<br/>└───cypress.json<br/>└───package.json</code></p></blockquote><p id="6181" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-创建一个基本测试来验证站点"<a class="ae lq" href="https://dikshitashirodkar.com%22" rel="noopener ugc nofollow" target="_blank">https://dikshitashirodkar . com "</a>。你可以在<code class="du kw kx ky kz b">cypress.json</code>里面配置你的站点的基本url</p><pre class="je jf jg jh fd la kz lb lc aw ld bi"><span id="4e95" class="le ju hi kz b fi lf lg l lh li">{<br/>  "baseUrl": "https://dikshitashirodkar.com/",<br/>  "video": false,<br/>  "reporterOptions": {<br/>    "mochaFile": "cypress/results/tests-[hash].xml",<br/>    "toConsole": true<br/>  }<br/>}</span></pre><p id="4260" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意</strong>:默认情况下，cypress提供了一个执行测试的视频记录，这里我们已经使用video标志明确地关闭了它。并为xml报告添加了配置。</p><p id="e015" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的测试文件使用了<code class="du kw kx ky kz b">fixtures</code>(用于存储和管理测试数据，不过是一个<code class="du kw kx ky kz b">json</code>文件)。<br/>一个名为<code class="du kw kx ky kz b">sample.json</code>的简单夹具文件</p><pre class="je jf jg jh fd la kz lb lc aw ld bi"><span id="cf10" class="le ju hi kz b fi lf lg l lh li">{<br/>  "imageName": "dikshita",<br/>  "heading": "QA Talking point"<br/>}</span></pre><p id="f758" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是基本测试<code class="du kw kx ky kz b">integration/test.js</code>。测试包含:<br/>T25】1。访问站点<br/>T27】2。验证站点的响应状态为200<br/>T29】3。验证博客标题为“QA谈话要点”<br/> <br/> 4。验证博客的图像图标为“dikshita”</p><pre class="je jf jg jh fd la kz lb lc aw ld bi"><span id="f8e8" class="le ju hi kz b fi lf lg l lh li">describe("Verify the website", function() {<br/>  before(function() {<br/>    cy.visit("/")<br/>  })</span><span id="3669" class="le ju hi kz b fi lr lg l lh li">  beforeEach(function() {<br/>    cy.fixture("sample").then(function(sample) {<br/>      this.sample = sample<br/>    })<br/>  })</span><span id="1f55" class="le ju hi kz b fi lr lg l lh li">  it("verify the status of the site", function() {<br/>    cy.request("/about").should(function(response) {<br/>      expect(response.status).to.eq(200)<br/>    })<br/>  })</span><span id="49f9" class="le ju hi kz b fi lr lg l lh li">  it("verify the heading of the blog", function() {<br/>    cy.get(".head-logo")<br/>      .children("a")<br/>      .should("have.text", this.sample.heading)<br/>  })</span><span id="21b5" class="le ju hi kz b fi lr lg l lh li">  it("verfiy the image icon on the site", function() {<br/>    console.log(this.sample, "printing data")<br/>    cy.get(".profile-img")<br/>      .should("have.attr", "src")<br/>      .and("include", this.sample.imageName)<br/>  })<br/>})</span></pre><p id="7e99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们使用命令来执行测试:</p><pre class="je jf jg jh fd la kz lb lc aw ld bi"><span id="4071" class="le ju hi kz b fi lf lg l lh li">npm run cypress run --browser chrome</span></pre><p id="9b36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果的输出类似于:</p><pre class="je jf jg jh fd la kz lb lc aw ld bi"><span id="253f" class="le ju hi kz b fi lf lg l lh li">Spec                                              Tests  Passing  Failing  Pending  Skipped<br/>  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐<br/>  │ ✔  tests/verifySite.js                      00:08        3        3        -        -        - │<br/>  └────────────────────────────────────────────────────────────────────────────────────────────────┘<br/>    ✔  All specs passed!                        00:08        3        3        -        -        -</span></pre><p id="2fe6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，您已经成功配置并执行了…🏅</p><h1 id="d063" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">用CircleCI运行柏树</h1><p id="8850" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">CircleCI是一个持续的集成和部署工具，它帮助团队在存储库中集成他们的代码，并在一天中“n”次构建测试。CircleCI使用的<code class="du kw kx ky kz b">Orbs</code>是开源的、可共享的可参数化可恢复配置元素包，包括作业、命令和执行器。<br/> CircleCI还提供了<code class="du kw kx ky kz b">Orb</code>供cypress进行测试，无需花费时间配置CircleCI。它还记录结果&amp;提供了一个GUI。</p><h1 id="d75f" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">让我们跳到配置CircleCI</h1><p id="6f66" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">-在你的项目<br/>的根目录下创建一个文件夹<code class="du kw kx ky kz b">.circleci</code>-在<code class="du kw kx ky kz b">.circleci</code>文件夹中添加一个文件作为<code class="du kw kx ky kz b">config.yml</code></p><pre class="je jf jg jh fd la kz lb lc aw ld bi"><span id="2858" class="le ju hi kz b fi lf lg l lh li">version: 2.1<br/>orbs:<br/>  cypress: cypress-io/cypress@1<br/>executors:<br/>  with-chrome:<br/>    resource_class: small<br/>    docker:<br/>      - image: "cypress/browsers:node14.16.0-chrome90-ff88"<br/>workflows:<br/>  build:<br/>    jobs:<br/>      - cypress/install<br/>      - cypress/run:<br/>          requires:<br/>            - cypress/install<br/>          executor: with-chrome<br/>          browser: chrome<br/>          post-steps:<br/>            - run: ls<br/>            - store_test_results:<br/>                path: cypress/results<br/>            - store_artifacts:<br/>                path: cypress/screenshots</span></pre><p id="5da7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意</strong>:把你的cypress项目放到一个版本控制系统中(github或者bitbucket)。在我们的例子中，我们会把它放在github上。</p><h1 id="0db7" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">设置您的CircleCI帐户</h1><p id="20eb" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">1.你可以通过github登录CircleCI portal，你可以在项目列表界面中访问你所有的gitHub库。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/64b081e2b4fa4997185c4623d98c2c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fp6WLZoPKNHPb5FC.png"/></div></div></figure><p id="e422" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.为了给git hub项目设置circleci，选择<code class="du kw kx ky kz b">Setup project</code>。这将要求您选择您想要执行测试的分支，并且它应该包含<code class="du kw kx ky kz b">.circleci</code>文件夹中的<code class="du kw kx ky kz b">config.yml</code>。或者另一种选择是创建一个新的配置文件。</p><p id="699b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意</strong> : <br/>对于这篇博文，我们是手动触发管道的。但是你绝对可以，自动化管道触发过程。</p><p id="9f23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.当您设置项目时，管道将被自动触发，并且可以看到构建进度</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/2df09d3f3fd61781fab3c3d28bca7fb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TkqRJEbMHTR2nOet.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Build progess</figcaption></figure><p id="b2af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.管道的成功看起来像是:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/569a7ee921e88300a61b58301d21715b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XYZZg_npLBOg3aa_.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Sucess status</figcaption></figure><p id="92e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.失败的管道看起来像这样</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/7aed92f2433e714acb21b862d7dc0741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MREG_KnBNo0rZatM.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Failure status</figcaption></figure><p id="0bf6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.我们已经添加了配置来存储测试结果和我们的<code class="du kw kx ky kz b">config.yml</code>文件中的工件。因此，我们也能够在测试部分和工件部分的测试截图链接中看到测试失败的细节</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/bba5674524b3d10e4a6244b5f5fae00c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cnPjbRx1zyl2GYt3.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Tests failed</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/b0e42741b63404ae4fb7f125af311afb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*59UaLOc2NWO4V3p6.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Artifacts</figcaption></figure><p id="bd0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个博客到此为止。希望你喜欢它。感谢阅读…！</p></div></div>    
</body>
</html>