<html>
<head>
<title>The Cost of useState Hook — React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用状态挂钩的成本—反应</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/the-cost-of-usestate-hook-react-f4139c3d3eda?source=collection_archive---------13-----------------------#2021-04-16">https://medium.com/geekculture/the-cost-of-usestate-hook-react-f4139c3d3eda?source=collection_archive---------13-----------------------#2021-04-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2481" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们常常想当然，从不注意细节，在这篇博客中，我们将看到如何正确使用useState钩子。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/c14e6484dcaa9b7b49796c73b5286856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UHDX2e4BlNbMfk5q1ozaRA.png"/></div></div></figure><p id="07bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在过去的四年里，我一直使用React来谋生。<br/>我一直很好奇React？和其他框架有什么不同？内部如何处理事情等…</p><p id="3318" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在满足好奇心的同时，我也学到了一些我认为值得分享的东西。</p><p id="b47e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们开始吧</p><h2 id="0665" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">国家</h2><p id="e7e3" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">基于类的组件消失了，没有人使用它们，这就是我们通常在功能组件中使用状态的方式。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kp"><img src="../Images/52909cf5e43507b25982065510796b16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dW2bRPon-yR_2Y7IInGTIQ.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx">State usage in a functional component.</figcaption></figure><p id="adca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中<code class="du ku kv kw kx b">state</code>是初始状态，<code class="du ku kv kw kx b">setState</code>是将用于在字母时间点更新<code class="du ku kv kw kx b">state</code>的函数。</p><p id="0efc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面用一个反例来了解一下<code class="du ku kv kw kx b">useState</code>钩子的典型用法。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ky kz l"/></div><figcaption class="kq kr et er es ks kt bd b be z dx">Simple counter example</figcaption></figure><p id="8aa0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是我们通常如何编写计数器组件</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es la"><img src="../Images/0881cfa73c29fff563be787cceff2be1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VXOz3EwxW5mSzzbX8Ph67Q.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx">A typical counter component in react.</figcaption></figure><p id="62a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里没什么问题，一切都如预期的那样正常。<br/>借助<code class="du ku kv kw kx b">setCount</code>方法，我们能够增加和减少计数<code class="du ku kv kw kx b">state</code>，一切工作顺利。</p><p id="c8e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们的组件需要管理一个以上的状态时，事情就变得棘手了。我们要么结束为组件中的每个<code class="du ku kv kw kx b">state</code>编写单独的<code class="du ku kv kw kx b">useState</code>,要么将它们放在一个大的<code class="du ku kv kw kx b">state</code>对象中。</p><p id="494b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们当前的例子中，count的初始值是0，这非常简单，但是让我们假设初始值是一个计算值，并且计算是在一个单独的函数中完成的。</p><p id="fe53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们的计数器组件将如下所示</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lb"><img src="../Images/b15d60441d16f1185c190f7345d801ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j22giaqhULnuMaBR7u7LTQ.png"/></div></div></figure><p id="fab6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尽管如此，一切工作顺利，如预期的那样，对不对？这是我们例子的代码沙箱版本。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ky kz l"/></div><figcaption class="kq kr et er es ks kt bd b be z dx">State as an object example</figcaption></figure><h2 id="d608" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">使用状态的问题</h2><p id="8c83" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">大多数人可能认为<code class="du ku kv kw kx b">state</code>初始化只会发生一次，即在安装组件时，但事实并非如此。</p><p id="cf0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如你所见，在上面的例子中，我有目的地调用了初始<code class="du ku kv kw kx b">state</code>对象<code class="du ku kv kw kx b">computeInitialValue</code>中的一个函数。</p><p id="751e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每次渲染时都会调用<code class="du ku kv kw kx b">computeInitialValue</code>，因为每次<code class="du ku kv kw kx b">re-render</code>时都会初始化<code class="du ku kv kw kx b">state</code>。</p><p id="9daf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只是，<code class="du ku kv kw kx b">state</code>变量将保存<code class="du ku kv kw kx b">state</code>的最新值</p><p id="197f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如你在上面的代码沙盒示例中看到的，每次渲染都会打印出<em class="lc">状态初始化</em>消息。</p><blockquote class="ld le lf"><p id="1b42" class="if ig lc ih b ii ij ik il im in io ip lg ir is it lh iv iw ix li iz ja jb jc hb bi translated">状态初始化将在每个<code class="du ku kv kw kx b">re-render</code>发生，如果我们在状态初始化阶段进行一些昂贵的操作，将会影响性能。</p></blockquote><p id="1f0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我意识到<code class="du ku kv kw kx b">state</code>初始化发生在每个<code class="du ku kv kw kx b">re-render</code>上时，我感到震惊。与你们大多数人不同，我以为它应该只发生一次，但由于<code class="du ku kv kw kx b">useState</code>在内部实现的方式，它在每个<code class="du ku kv kw kx b">re-render</code>上执行，而<code class="du ku kv kw kx b">react</code>分别跟踪每个<code class="du ku kv kw kx b">state</code>，在每个<code class="du ku kv kw kx b">re-render</code>上，它指向最新版本的<code class="du ku kv kw kx b">state.</code></p><p id="f45d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">幸运的是，我们有解决这个问题的方法</p><blockquote class="ld le lf"><p id="666a" class="if ig lc ih b ii ij ik il im in io ip lg ir is it lh iv iw ix li iz ja jb jc hb bi translated">将功能传递给<code class="du ku kv kw kx b">useState</code></p></blockquote><p id="34f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是的，我们可以传递一个函数给<code class="du ku kv kw kx b">useState</code>，它将返回初始状态。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lb"><img src="../Images/3476d83779e8f20acb53b76ef958fae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5ylSxgQ_0XEcowvUUPcnTw.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx">counter example</figcaption></figure><p id="4703" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，<code class="du ku kv kw kx b">initialiseState</code>将被调用，而<code class="du ku kv kw kx b">rendering</code>组件，<br/>将不会被调用<code class="du ku kv kw kx b">re-renders</code>。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="7c47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于我们已经将函数传递给了<code class="du ku kv kw kx b">useState</code>，react将计算出在<code class="du ku kv kw kx b">re-render</code>上它不需要调用函数，因为<code class="du ku kv kw kx b">state</code>初始化已经发生。</p><p id="2cbd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以在使用<code class="du ku kv kw kx b">useState</code>钩子时，请保持<code class="du ku kv kw kx b">state</code>同步，避免初始化时的昂贵操作，如果不可避免，将函数传递给<code class="du ku kv kw kx b">useState</code>钩子，这样你的组件性能不会受到影响</p></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><p id="44a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你今天学到了新东西，考虑与你的同事和技术朋友分享。</p><p id="99ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您有任何疑问、反馈或建议，请通过<a class="ae lq" href="https://twitter.com/suhas0101" rel="noopener ugc nofollow" target="_blank"> Twitter </a>联系我或在下面留下评论。</p><p id="19f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在那之前…</p></div></div>    
</body>
</html>