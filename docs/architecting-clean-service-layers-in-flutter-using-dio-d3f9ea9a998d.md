# 使用 Dio 在 Flutter 中构建干净的 API 提供者

> 原文：<https://medium.com/geekculture/architecting-clean-service-layers-in-flutter-using-dio-d3f9ea9a998d?source=collection_archive---------0----------------------->

## 如何在 Flutter 中构建服务层的指南。

如果没有实现好的设计模式，开发大型的颤振应用程序可能会很痛苦。然而，有许多设计模式可以解决这个问题。其中一种模式是业务逻辑组件模式，简称 BLoC。

但是今天，我们不讨论应用程序的状态管理部分。相反，我们将讨论服务层。使用 BLoC 只是简化了我们的状态管理，并没有解决我们应该如何处理服务层。我们的目标是使 API 调用尽可能干净。

# 干净的服务层

你如何定义一个“干净”的服务层？我认为它是一个术语，意思是服务层组件的适当结构化，使其易于阅读和维护。

我的解决方案背后的主要哲学是干原则或“不要重复自己”。第二项原则是单一责任原则。有了简单明了的职责，我们就有了一个很好的基础，知道如何继续编写服务层。当然，这两个原则听起来可能相似，但它们是相辅相成的。

# 主要思想

首先，我们需要创建一个文件夹来存放我们的服务层。文件夹需要与 UI 甚至 BLoC 组件分开。接下来，我们需要创建一个基础 API 客户端。这将是有益的，因为我们不需要为每种服务类型重复调用。

最后，我们需要分离每个端点，因此每个端点需要不同的文件。为了帮助您形象化，文件夹结构如下所示:

```
-lib/
  |--providers/
  |   |--endpoint1.dart
  |   |--endpoint2.dart
  |--api_client.dart
-service.dart
-pubspec.yaml
```

我们可以使用 Dart 团队的 [HTTP 库，但是我认为这有点太乏味了。所以，我选择了](https://pub.dev/packages/http) [Dio](https://pub.dev/packages/dio) ！

![](img/f7ac3cc726745dcd6d46607825c2edbd.png)

It is Dio!

# 为什么选择 Dio？

Dio 非常类似于我最喜欢的另一个 Javascript 库， [Axios](https://github.com/axios/axios) 。你以前听过/用过 [Axios](https://github.com/axios/axios) 吗？这是一个非常流行的用于发出 HTTP 请求的 Javascript 库。

它有许多 Dio 共有的特性。主要是 Dio 和 Axios 都实现了拦截器和默认参数。这一特点与干燥原理完全吻合。我们可以只制作一个 API 客户端，从我们的整个服务代码库中引用。

现在，Dart 团队在主 HTTP 库上使用 Dio 有什么好处？Dio 比 Dart 的 HTTP 库更有特色。它实现了拦截器、默认选项等特性，并且是可读的。Dio 提供了简单性，它有一个非常直观的编程 API。

使用 Dio 的唯一缺点是它是第三方库。如果对它进行维护，这不会是一个问题，但是如果您在一个大型项目中使用 Dio，您可能需要关注它。

# 安装 Dio

要安装 Dio，我们只需要引用 pubspec.yaml 文件上的依赖关系。

Dependencies

然后打开命令提示符并运行:

```
flutter pub get
```

那应该安装 Dio！

# 制作 Dio 客户端

我们需要创建一个函数来返回一个 Dio 客户端。

Dio API client.

我们将用一个基本 URL 和每个相应的请求、响应和错误拦截器来初始化客户端。拦截器是干什么用的？拦截器将在发送请求之前处理每个请求，并在接收响应和错误之前处理每个响应和错误。拦截器最常用于身份验证。

例如，当我们访问的 API 需要某种 cookie 认证时，我们可以使用响应拦截器在登录后保存 cookie，并使用错误拦截器来认证错误。然而，在这种情况下，请求拦截器可以用来将 cookies 附加到请求的头部。

> 如果您不需要拦截器，那么您可能首先就不需要这个复杂的设置。

但是，如果您决定分离您的 API 客户端，您会发现添加新的全局 API 客户端逻辑会更容易。本质上，将来实现复杂的特性会更容易。

如果你对拦截器还能做什么感兴趣，你可以看看 [冈萨洛·帕尔马](https://medium.com/u/24577a902b47?source=post_page-----d3f9ea9a998d--------------------------------)的博客

# 制作端点提供者

在下一步中，我们将使端点提供者:

Service provider

注意，我们仍然需要一个 Dio 客户端，并且我们没有直接引用`init()`函数。这将有助于测试。我们不想要一个不可测试的供应商。

现在，每个端点的逻辑应该在这个文件中定义。在这个例子中，我返回了一个地图，但是你最好返回一个模型类。这将减少业务逻辑组件中的代码，因为转换都是在服务层完成的。

# 导出文件

最后一步是导出相应的文件。

Export everything!

而且，大概就是这样。您已经编写了与 UI 和业务逻辑层完全分离的服务层。您需要做的就是在 UI 或业务逻辑项目中引用这个库。

# 摘要

在本教程中，您已经学习了如何使用 Dio 在 Flutter 中构建干净的服务层。要使用这些实现，您只需要定义客户端和提供者。我给你举个例子:

Example

使用提供者就这么简单。希望这篇教程对你有所帮助，祝你有美好的一天！