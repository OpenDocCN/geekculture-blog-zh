<html>
<head>
<title>ADX Data Explorer and semi structured IoT data.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ADX数据浏览器和半结构化物联网数据。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/adx-data-explorer-and-semi-structured-iot-data-ab3358ff38bd?source=collection_archive---------38-----------------------#2021-08-18">https://medium.com/geekculture/adx-data-explorer-and-semi-structured-iot-data-ab3358ff38bd?source=collection_archive---------38-----------------------#2021-08-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="992e" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">在每个物联网项目中，都有一个称为“数据分析”的初步阶段，在这个阶段中，必须使用日志记录系统已经收集的原始数据，以展示使用工业物联网解决方案可以从半结构化数据中提取的真正价值。不允许编码时间，只能使用数据探索或数据操作。</h2><div class=""/><div class=""><h2 id="2e0a" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">一个使用真实数据集演示Kusto强大功能的数据挖掘的真实分步示例。</h2></div><h2 id="7be4" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ho bi translated">初始上下文</h2><p id="2ed4" class="pw-post-body-paragraph kd ke hi kf b kg kh is ki kj kk iv kl jr km kn ko jv kp kq kr jz ks kt ku kv hb bi translated">在工厂数字化项目中，最困难的事情是说服客户，机器数据的数字化实际上可以带来可观的价值，并使人们感知到用经验工具或“传统”工业数据管理无法看到的东西。能够引发兴趣的行为是立即向客户展示生产线以某种方式产生的数据，以及可能只是被归类为“原始数据”(但从未真正使用过)的数据隐藏了什么。</p><p id="0354" class="pw-post-body-paragraph kd ke hi kf b kg kw is ki kj kx iv kl jr ky kn ko jv kz kq kr jz la kt ku kv hb bi translated">这种类型的方法基于以下几点:<br/> 1。机器数据到达并可读<br/> 2。数据可以传输到工厂外，通过云服务进行清理、重新整合和过滤<br/> 3。数据有话要说(这是基本的，因为客户通常不知道在他们的数据中寻找什么)。</p><p id="a516" class="pw-post-body-paragraph kd ke hi kf b kg kw is ki kj kx iv kl jr ky kn ko jv kz kq kr jz la kt ku kv hb bi translated">我们正在谈论一个基于数据探索的项目阶段，称为“售前/预分析/数据POC”(假设您有一个包含一些样本文件的u盘，并且您必须突出数据价值)。<br/>在这种情况下，Azure上使用的服务当然是ADX Data Explorer，因为它是一个集成了数据库存储、数据操作引擎和使用dashboarding元素的数据可视化的工具。<br/>在这些情况下，数据工程师面临着一项艰巨的任务:必须从一个乍一看完全没有意思的文件开始创造奇迹。<br/>但是，如果有的话，开展这类项目的正确方法是什么？<br/>真正的方法并不存在，相反，有许多工具和教程可以教你如何在使用ADX Data Explorer时使用KUSTO操作数据。</p><p id="79b2" class="pw-post-body-paragraph kd ke hi kf b kg kw is ki kj kx iv kl jr ky kn ko jv kz kq kr jz la kt ku kv hb bi translated">下面不是关于如何使用KUSTO的学校教程，而是一个“实践测试”,一步一步地，故意与一个不鼓励的数据集的使用相关联:一个单一的日志文件，其中组成一行的不同机器的日志已经被写入，格式和标准并不总是相同，当然也没有被封装在具有定义的列的表模型中。该数据不包含精确的时间参考，而仅包含循环的每小时时间。没有代码记录，但都可以找到。<br/>本文还包含数据集的链接，您可以下载该链接来亲自测试指定的查询。记住:这个数据集，因此这个体验，是真实的。</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="bb9a" class="jg jh hi lg b fi lk ll l lm ln">File_test<br/>| take 1000</span></pre><figure class="lb lc ld le fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lo"><img src="../Images/b9444d083f369a7cab6d3162822827a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p2j6A5uG5bIcJ_4ZVG0pcg.png"/></div></div></figure><h2 id="100d" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ho bi translated">没什么有趣的..但是您会看到有一个源字段，您可以在其中看到源机器。所以首先，用解析操作符来提取其他信息。</h2><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="d686" class="jg jh hi lg b fi lk ll l lm ln">File_test</span><span id="0a19" class="jg jh hi lg b fi lw ll l lm ln">| where Source contains "/RT02/Silver/M2/"</span><span id="f09e" class="jg jh hi lg b fi lw ll l lm ln">| parse kind = regex flags = Ui Text with * "VeloForceFree: " VeloForceFree ',' *</span><span id="ed68" class="jg jh hi lg b fi lw ll l lm ln">| parse kind = regex flags = Ui Text with * "VeloForceFree: " VeloForceFree ',' *</span><span id="3833" class="jg jh hi lg b fi lw ll l lm ln">| parse kind = regex flags = Ui Source with * "/RT02/Silver/" MachineName '/' *</span></pre><figure class="lb lc ld le fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lx"><img src="../Images/1d255d6cb493b6d79f994aadfd1b5735.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_RLoU8Dh8ITlnPGN1LQH1A.png"/></div></div></figure><h2 id="9401" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ho bi translated">好吧，听起来好多了。所以是时候找出机器了。</h2><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="8d14" class="jg jh hi lg b fi lk ll l lm ln">File_test</span><span id="8495" class="jg jh hi lg b fi lw ll l lm ln">| parse kind = regex flags = Ui Source with "AT/" MachineName '/' *</span><span id="92f9" class="jg jh hi lg b fi lw ll l lm ln">| distinct MachineName</span><span id="6670" class="jg jh hi lg b fi lw ll l lm ln">| order by MachineName</span></pre><figure class="lb lc ld le fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es ly"><img src="../Images/02466c24070c120bc9a3cb031225404f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UDE3TPNxosvfVPXY35fy-g.png"/></div></div></figure><p id="ae62" class="pw-post-body-paragraph kd ke hi kf b kg kw is ki kj kx iv kl jr ky kn ko jv kz kq kr jz la kt ku kv hb bi translated"><strong class="kf hs">第一个惊喜:有些消息来自另一个通信层，而不是基于机器的</strong>。是时候更深入了，所以是时候用“HASPREFIX”清理掉不重要的行，放一个真正的datetime(看流程:先计算时间增量，然后加上Now())。</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="28cc" class="jg jh hi lg b fi lk ll l lm ln">File_test</span><span id="07d7" class="jg jh hi lg b fi lw ll l lm ln">| parse kind = regex flags = Ui Source with "AT/" MachineName '/' *</span><span id="1496" class="jg jh hi lg b fi lw ll l lm ln">| where MachineName == ''</span><span id="c3d4" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "E10"</span><span id="79b5" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "User"</span><span id="3010" class="jg jh hi lg b fi lw ll l lm ln">| serialize rn = row_number()</span><span id="0f2f" class="jg jh hi lg b fi lw ll l lm ln">| extend _temp_timeslots = split(translate('.', ':', CreationTime), ':')</span><span id="6027" class="jg jh hi lg b fi lw ll l lm ln">| serialize _temp_millis = (_temp_timeslots[0]*60)+(_temp_timeslots[1])</span><span id="4bfe" class="jg jh hi lg b fi lw ll l lm ln">| extend prev_millis = prev(_temp_millis)</span><span id="fb94" class="jg jh hi lg b fi lw ll l lm ln">| extend _temp_millis_offset = iff( (prev(_temp_millis) &gt; 0) and (_temp_millis &gt;= 0) and (prev(_temp_millis) &lt; _temp_millis), _temp_millis - prev(_temp_millis), (3600 - prev(_temp_millis))+_temp_millis)</span><span id="a5f7" class="jg jh hi lg b fi lw ll l lm ln">| extend _progressive_offsset = row_cumsum(_temp_millis_offset)</span><span id="d0fa" class="jg jh hi lg b fi lw ll l lm ln">| extend relativedatetime = datetime_add('second',_progressive_offsset,now())</span><span id="d1c9" class="jg jh hi lg b fi lw ll l lm ln">| project-away MachineName, rn, _temp_millis, _temp_timeslots, prev_millis, _temp_millis_offset, _progressive_offsset</span></pre><figure class="lb lc ld le fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lz"><img src="../Images/6416a1c384858358948441c1a22ff27b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JIde9K7ZDqM9YRtSZ5531g.png"/></div></div></figure><p id="9742" class="pw-post-body-paragraph kd ke hi kf b kg kw is ki kj kx iv kl jr ky kn ko jv kz kq kr jz la kt ku kv hb bi translated">我发现有两个配方更改和一个验证。<em class="ma">提示:您可以了解每个配方变化的时间段，并在其他数据中查看零件/不合格品或问题/不合格品的搜索进度。</em></p><h2 id="1885" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ho bi translated">现在怎么办？</h2><p id="bf0c" class="pw-post-body-paragraph kd ke hi kf b kg kh is ki kj kk iv kl jr km kn ko jv kp kq kr jz ks kt ku kv hb bi translated">我停下来一分钟，试图探索一台机器的数据，以了解消息格式有多么不同。仔细阅读数据，我注意到每条消息代表一个州，所以有一条完全匹配的消息“关闭了以前的”。我明白了，因为一半的信息包含相同的描述，但前缀是“CLEARED —”。<br/>这让我想到用时隙来研究现象(开门维护，自动化故障持续时间，开/关警报)。</p><p id="e25e" class="pw-post-body-paragraph kd ke hi kf b kg kw is ki kj kx iv kl jr ky kn ko jv kz kq kr jz la kt ku kv hb bi translated">我拿了一台机器，在清理了故障(持续时间不到一秒的事件)和通知消息(具有信息级别的日志)之后，我开始理解数据，例如，发现了开门和关门动作(典型的维护事件或修复某些情况下产生的问题)</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="f702" class="jg jh hi lg b fi lk ll l lm ln">File_test</span><span id="0362" class="jg jh hi lg b fi lw ll l lm ln">| parse kind = regex flags = Ui Source with "AT/" MachineName '/' *</span><span id="76fe" class="jg jh hi lg b fi lw ll l lm ln">| where MachineName == "RT02"</span><span id="c88c" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Source(500)" and Text !hasprefix "Cleared - Source(500)"</span><span id="f928" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Enable Axis" and Text !hasprefix "Cleared - Enable Axis"</span><span id="ac0a" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Next MODULE" and Text !hasprefix "Cleared - Next MODULE"</span><span id="eb8d" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Warning, Wafer" and Text !hasprefix "Cleared - Warning, Wafer"</span><span id="7258" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Buffer" and Text !hasprefix "Cleared - Buffer"</span><span id="9828" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Previous" and Text !hasprefix "Cleared - Previous"</span><span id="8b0a" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Next" and Text !hasprefix "Cleared - Next"</span></pre><figure class="lb lc ld le fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mb"><img src="../Images/7490f64627fb46d56b8532a1d2c7ed16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yln8yVrwF-gIoaDVtrUg5A.png"/></div></div></figure><p id="42dc" class="pw-post-body-paragraph kd ke hi kf b kg kw is ki kj kx iv kl jr ky kn ko jv kz kq kr jz la kt ku kv hb bi translated">我进一步清理了数据，删除了“通信/确认”消息，该消息指的是生产线内正在加工的产品在上下一台机器之间传递。</p><p id="0a55" class="pw-post-body-paragraph kd ke hi kf b kg kw is ki kj kx iv kl jr ky kn ko jv kz kq kr jz la kt ku kv hb bi translated">我开始看到数据的价值。然而，在进一步探索之前，需要解决一些共同的特征，即:<br/> 1。参数化非结构化日志的严重性级别<br/> 2。清除上一次-下一次故障/自动化通知/产品通道中的数据</p><p id="ae8b" class="pw-post-body-paragraph kd ke hi kf b kg kw is ki kj kx iv kl jr ky kn ko jv kz kq kr jz la kt ku kv hb bi translated">还需要从循环时间格式转换成日期时间格式。显然，这个规范化操作带来了两个假设:<br/> # 1。如果T2 &lt; T1，那么时间已经被隐含地改变了(例如:T2 =第11分钟，而T1 =第59分钟)<br/> #2。事件顺序必须通过选择单个设备来完成</p><p id="47a9" class="pw-post-body-paragraph kd ke hi kf b kg kw is ki kj kx iv kl jr ky kn ko jv kz kq kr jz la kt ku kv hb bi translated">所以我决定通过使用函数来存储基本查询。开始时，将结果放入一个<strong class="kf hs"> let </strong>变量中，硬编码MachineId和BaseDateTime。</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="61e4" class="jg jh hi lg b fi lk ll l lm ln">let startdate = now();</span><span id="2c92" class="jg jh hi lg b fi lw ll l lm ln">let data = File_test</span><span id="72ca" class="jg jh hi lg b fi lw ll l lm ln">| where Severity != "Info"</span><span id="6d48" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "AmatPMon"</span><span id="3efa" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Source(500)" and Text !hasprefix "Cleared - Source(500)"</span><span id="18a8" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Enable Axis" and Text !hasprefix "Cleared - Enable Axis"</span><span id="0d8a" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Next MODULE" and Text !hasprefix "Cleared - Next MODULE"</span><span id="1d1d" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Warning, Wafer" and Text !hasprefix "Cleared - Warning, Wafer"</span><span id="181f" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Buffer" and Text !hasprefix "Cleared - Buffer"</span><span id="a078" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Previous" and Text !hasprefix "Cleared - Previous"</span><span id="fc3b" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Next" and Text !hasprefix "Cleared - Next"</span><span id="5a1b" class="jg jh hi lg b fi lw ll l lm ln">| parse kind = regex flags = Ui Source with "AT/" MachineName '/' *</span><span id="0145" class="jg jh hi lg b fi lw ll l lm ln">| parse Text with "Cleared - " Cleared:string</span><span id="61ba" class="jg jh hi lg b fi lw ll l lm ln">| where MachineName == "RT02"</span><span id="c6ce" class="jg jh hi lg b fi lw ll l lm ln">| serialize rn = row_number()</span><span id="23e4" class="jg jh hi lg b fi lw ll l lm ln">| extend _temp_timeslots = split(translate('.', ':', CreationTime), ':')</span><span id="d32a" class="jg jh hi lg b fi lw ll l lm ln">| serialize _temp_millis = (_temp_timeslots[0]*60)+(_temp_timeslots[1])</span><span id="5385" class="jg jh hi lg b fi lw ll l lm ln">| extend prev_millis = prev(_temp_millis)</span><span id="d774" class="jg jh hi lg b fi lw ll l lm ln">| extend _temp_millis_offset = iff( (prev(_temp_millis) &gt; 0) and (_temp_millis &gt;= 0) and (prev(_temp_millis) &lt; _temp_millis), _temp_millis - prev(_temp_millis), (3600 - prev(_temp_millis))+_temp_millis)</span><span id="9788" class="jg jh hi lg b fi lw ll l lm ln">| extend _progressive_osset = row_cumsum(_temp_millis_offset)</span><span id="0ea4" class="jg jh hi lg b fi lw ll l lm ln">| extend relativedatetime = datetime_add('second',_progressive_osset,startdate)</span><span id="0678" class="jg jh hi lg b fi lw ll l lm ln">| project-away _temp_timeslots, _temp_millis, prev_millis, _temp_millis_offset, _progressive_osset;</span><span id="6450" class="jg jh hi lg b fi lw ll l lm ln">let pairedevents = data</span><span id="1521" class="jg jh hi lg b fi lw ll l lm ln">| project EventID, Severity, Source, Text, Cleared, Start=relativedatetime, relativedatetime</span><span id="a8c4" class="jg jh hi lg b fi lw ll l lm ln">| join kind=innerunique</span><span id="f698" class="jg jh hi lg b fi lw ll l lm ln">(</span><span id="bbcf" class="jg jh hi lg b fi lw ll l lm ln">data</span><span id="4084" class="jg jh hi lg b fi lw ll l lm ln">| project EventID, Severity, Source, Text, Cleared, Stop=relativedatetime, relativedatetime</span><span id="7410" class="jg jh hi lg b fi lw ll l lm ln">) on $left.Text == $right.Cleared</span><span id="1888" class="jg jh hi lg b fi lw ll l lm ln">| where datetime_diff('second', Stop, Start) &gt; 0</span><span id="218e" class="jg jh hi lg b fi lw ll l lm ln">| project EventID, Severity, Source, Text, Start, Stop</span><span id="6b27" class="jg jh hi lg b fi lw ll l lm ln">| order by Start asc, Stop asc ;</span><span id="f727" class="jg jh hi lg b fi lw ll l lm ln">let pairedevents2 = pairedevents</span><span id="99ac" class="jg jh hi lg b fi lw ll l lm ln">| summarize make_list(Stop) by EventID, Severity, Source, Start, Text</span><span id="7d56" class="jg jh hi lg b fi lw ll l lm ln">| project EventID, Severity, Source, Text, Start, Stop = todatetime(list_Stop[0])</span><span id="a638" class="jg jh hi lg b fi lw ll l lm ln">| extend Duration= Stop - Start;</span><span id="0cd4" class="jg jh hi lg b fi lw ll l lm ln">pairedevents2</span></pre><figure class="lb lc ld le fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mb"><img src="../Images/124ee64af8f81dc36418782e60cf1b5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*16qSQJFUTe1_8RvpBUOKWQ.png"/></div></div></figure><p id="a43f" class="pw-post-body-paragraph kd ke hi kf b kg kw is ki kj kx iv kl jr ky kn ko jv kz kq kr jz la kt ku kv hb bi translated">关于这个困难的查询的一些注释:</p><ol class=""><li id="80cc" class="mc md hi kf b kg kw kj kx jr me jv mf jz mg kv mh mi mj mk bi translated">您必须学会对同一个表进行内部连接</li><li id="9e3c" class="mc md hi kf b kg ml kj mm jr mn jv mo jz mp kv mh mi mj mk bi translated">没有一个correlationID来耦合开始和停止事件，我做了一个“快速而肮脏”的把戏:一个停止事件的列表，并选择第一个结果作为“最近”的结果。</li></ol><h2 id="46ce" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ho bi translated">如今，现在..一个功能？</h2><p id="a223" class="pw-post-body-paragraph kd ke hi kf b kg kh is ki kj kk iv kl jr km kn ko jv kp kq kr jz ks kt ku kv hb bi translated">现在函数时间到了，为了重用基本查询，参数化DateTime和MachineID:</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="701c" class="jg jh hi lg b fi lk ll l lm ln">.create-or-alter function with (docstring = "BaseQuery",folder = "Query") getDataByMachineId(mid:string, startdate:datetime) {</span><span id="d651" class="jg jh hi lg b fi lw ll l lm ln">let data = File_test</span><span id="0a1b" class="jg jh hi lg b fi lw ll l lm ln">| where Severity != "Info"</span><span id="758e" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "AmatPMon"</span><span id="7c87" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Source(500)" and Text !hasprefix "Cleared - Source(500)"</span><span id="f9f5" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Enable Axis" and Text !hasprefix "Cleared - Enable Axis"</span><span id="b2f6" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Next MODULE" and Text !hasprefix "Cleared - Next MODULE"</span><span id="4242" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Warning, Wafer" and Text !hasprefix "Cleared - Warning, Wafer"</span><span id="9caf" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Buffer" and Text !hasprefix "Cleared - Buffer"</span><span id="ff2e" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Previous" and Text !hasprefix "Cleared - Previous"</span><span id="93d0" class="jg jh hi lg b fi lw ll l lm ln">| where Text !hasprefix "Next" and Text !hasprefix "Cleared - Next"</span><span id="3dc8" class="jg jh hi lg b fi lw ll l lm ln">| parse kind = regex flags = Ui Source with "AT/" MachineName '/' *</span><span id="f3c0" class="jg jh hi lg b fi lw ll l lm ln">| parse Text with "Cleared - " Cleared:string</span><span id="8912" class="jg jh hi lg b fi lw ll l lm ln">| where MachineName == mid</span><span id="9e16" class="jg jh hi lg b fi lw ll l lm ln">| serialize rn = row_number()</span><span id="d370" class="jg jh hi lg b fi lw ll l lm ln">| extend _temp_timeslots = split(translate('.', ':', CreationTime), ':')</span><span id="22dd" class="jg jh hi lg b fi lw ll l lm ln">| serialize _temp_millis = (_temp_timeslots[0]*60)+(_temp_timeslots[1])</span><span id="2b03" class="jg jh hi lg b fi lw ll l lm ln">| extend prev_millis = prev(_temp_millis)</span><span id="7800" class="jg jh hi lg b fi lw ll l lm ln">| extend _temp_millis_offset = iff( (prev(_temp_millis) &gt; 0) and (_temp_millis &gt;= 0) and (prev(_temp_millis) &lt; _temp_millis), _temp_millis - prev(_temp_millis), (3600 - prev(_temp_millis))+_temp_millis)</span><span id="1a7e" class="jg jh hi lg b fi lw ll l lm ln">| extend _progressive_osset = row_cumsum(_temp_millis_offset)</span><span id="d00f" class="jg jh hi lg b fi lw ll l lm ln">| extend relativedatetime = datetime_add('second',_progressive_osset,startdate)</span><span id="8855" class="jg jh hi lg b fi lw ll l lm ln">| project-away _temp_timeslots, _temp_millis, prev_millis, _temp_millis_offset, _progressive_osset;</span><span id="1e51" class="jg jh hi lg b fi lw ll l lm ln">let pairedevents = data</span><span id="f3cd" class="jg jh hi lg b fi lw ll l lm ln">| project EventID, Severity, Source, Text, Cleared, Start=relativedatetime, relativedatetime</span><span id="d983" class="jg jh hi lg b fi lw ll l lm ln">| join kind=innerunique</span><span id="bce3" class="jg jh hi lg b fi lw ll l lm ln">(</span><span id="b9bc" class="jg jh hi lg b fi lw ll l lm ln">data</span><span id="3d53" class="jg jh hi lg b fi lw ll l lm ln">| project EventID, Severity, Source, Text, Cleared, Stop=relativedatetime, relativedatetime</span><span id="a5bf" class="jg jh hi lg b fi lw ll l lm ln">) on $left.Text == $right.Cleared</span><span id="bec1" class="jg jh hi lg b fi lw ll l lm ln">| where datetime_diff('second', Stop, Start) &gt; 0</span><span id="fd45" class="jg jh hi lg b fi lw ll l lm ln">| project EventID, Severity, Source, Text, Start, Stop</span><span id="7406" class="jg jh hi lg b fi lw ll l lm ln">| order by Start asc, Stop asc ;</span><span id="999d" class="jg jh hi lg b fi lw ll l lm ln">let pairedevents2 = pairedevents</span><span id="84ee" class="jg jh hi lg b fi lw ll l lm ln">| summarize make_list(Stop) by EventID, Severity, Source, Start, Text</span><span id="7180" class="jg jh hi lg b fi lw ll l lm ln">| project EventID, Severity, Source, Text, Start, Stop = todatetime(list_Stop[0])</span><span id="e48b" class="jg jh hi lg b fi lw ll l lm ln">| extend Duration= Stop - Start;</span><span id="2bf8" class="jg jh hi lg b fi lw ll l lm ln">pairedevents2</span><span id="95c6" class="jg jh hi lg b fi lw ll l lm ln">}</span></pre><p id="d17d" class="pw-post-body-paragraph kd ke hi kf b kg kw is ki kj kx iv kl jr ky kn ko jv kz kq kr jz la kt ku kv hb bi translated">现在我的生活更简单了:<strong class="kf hs"> getDataByMachineId("RT02 "，now()) </strong></p><figure class="lb lc ld le fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mq"><img src="../Images/58a43130736cfa74992392804f4fffdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ho5nuuLGTkE8zlzY-DxpQg.png"/></div></div></figure><h2 id="0620" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ho bi translated"><strong class="ak">模式声明</strong></h2><p id="6806" class="pw-post-body-paragraph kd ke hi kf b kg kh is ki kj kk iv kl jr km kn ko jv kp kq kr jz ks kt ku kv hb bi translated">一旦构建了基本功能，我拒绝了外部应用程序可以做的无参数中间层操作。<br/>使用模式语句，我构建了正确的查询，易于检索。</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="0ef2" class="jg jh hi lg b fi lk ll l lm ln">declare pattern app = (applicationId:string)[eventType:string]</span><span id="eb0a" class="jg jh hi lg b fi lw ll l lm ln">{</span><span id="61c4" class="jg jh hi lg b fi lw ll l lm ln">("RT02").["Doors"] = {</span><span id="36f6" class="jg jh hi lg b fi lw ll l lm ln">database("deltalake_example").getDataByMachineId("RT02", now())</span><span id="f6bd" class="jg jh hi lg b fi lw ll l lm ln">| where Text startswith "Doors"</span><span id="4052" class="jg jh hi lg b fi lw ll l lm ln">};</span><span id="3869" class="jg jh hi lg b fi lw ll l lm ln">("RT02").["GenericErrors"] = { database("deltalake_example").getDataByMachineId("RT02", now()) | where Text startswith "Error" };</span><span id="9ce0" class="jg jh hi lg b fi lw ll l lm ln">("RT02").["OperatorAlarms"] = {</span><span id="b0fa" class="jg jh hi lg b fi lw ll l lm ln">database("deltalake_example").getDataByMachineId("RT02", now())</span><span id="89d7" class="jg jh hi lg b fi lw ll l lm ln">| where Text startswith "Operator alarm"</span><span id="791e" class="jg jh hi lg b fi lw ll l lm ln">| extend Source2 = strcat(Source, "/A/")</span><span id="c5cb" class="jg jh hi lg b fi lw ll l lm ln">| parse kind = regex flags = Ui Source2 with "AT/" MachineCode:string "/Silver/" MachineId:string "/Sides/" Side:string "/OpAlarms/" Alarm:string "/A/" *</span><span id="1b95" class="jg jh hi lg b fi lw ll l lm ln">| extend description = strcat(Alarm, replace("Operator alarm", "", Text) )</span><span id="a38d" class="jg jh hi lg b fi lw ll l lm ln">| extend replaced=replace(@'Operator alarm', @'', Text)</span><span id="34ea" class="jg jh hi lg b fi lw ll l lm ln">| project EventID, Severity, Source, Text, Start, Stop, Duration, MachineCode, MachineId, Side, Alarm, description</span><span id="a612" class="jg jh hi lg b fi lw ll l lm ln">};</span><span id="0aeb" class="jg jh hi lg b fi lw ll l lm ln">("RT02").["ProductTransitionErrors"] = { database("deltalake_example").getDataByMachineId("RT02", now()) | where Text startswith "wafer transition" };</span><span id="6021" class="jg jh hi lg b fi lw ll l lm ln">("RT02").["AxisErrors"] = { database("deltalake_example").getDataByMachineId("RT02", now()) | where Text hasprefix "Axis" and Text hasprefix "Error" };</span><span id="f717" class="jg jh hi lg b fi lw ll l lm ln">};</span></pre><p id="976e" class="pw-post-body-paragraph kd ke hi kf b kg kw is ki kj kx iv kl jr ky kn ko jv kz kq kr jz la kt ku kv hb bi translated"><strong class="kf hs">现在，我能够从数据</strong>中检索有用的信息，例如发生率最高的操作员警报(&gt;错误校准导致的36k剔除):</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="51fb" class="jg jh hi lg b fi lk ll l lm ln">app("RT02").["OperatorAlarms"]</span><span id="4584" class="jg jh hi lg b fi lw ll l lm ln">| summarize AlarmAmount = sum(Duration) by Alarm, description</span><span id="b489" class="jg jh hi lg b fi lw ll l lm ln">| order by AlarmAmount desc</span><span id="d776" class="jg jh hi lg b fi lw ll l lm ln">| render columnchart</span></pre><figure class="lb lc ld le fd lp er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mr"><img src="../Images/01b88fead9c5e8879ded33da92cde882.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5OJrlzhYRl80XrzprhofkA.png"/></div></div></figure><h2 id="ffb7" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ho bi translated">后续步骤</h2><p id="901e" class="pw-post-body-paragraph kd ke hi kf b kg kh is ki kj kk iv kl jr km kn ko jv kp kq kr jz ks kt ku kv hb bi translated">下一步可能是:<br/> 1。根据参考表对事件类型进行分类，分配一个代码，以便在模式声明阶段简单地搜索和查询组合<br/> 2。生成一个多折线图仪表板，用户可以在其中选择机器、事件类型、时间片、事件类型/报警代码</p><h2 id="f954" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ho bi translated">结果呢</h2><p id="6cab" class="pw-post-body-paragraph kd ke hi kf b kg kh is ki kj kk iv kl jr km kn ko jv kp kq kr jz ks kt ku kv hb bi translated">一般结果是，您可以简单地使用日志文件来展示有价值的信息。<br/>使用这种方法很容易事半功倍地增加更多价值:例如，通过同样的方法，可以以互动的数据驱动方式增加与客户逐班讨论的KPI数量(记住，他知道流程，所以他可以将“原因”和“结果”联系起来)。</p><h2 id="351f" class="jg jh hi bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ho bi translated">概述</h2><p id="b035" class="pw-post-body-paragraph kd ke hi kf b kg kh is ki kj kk iv kl jr km kn ko jv kp kq kr jz ks kt ku kv hb bi translated">在这篇文章中，我解释了如何使用KUSTO和Data Explorer first功能进行数据分析:<strong class="kf hs">探索数据</strong>。我发现，当您的客户想要对工厂进行数字化，而不知道在数据中搜索什么是有用的时，这种方法是一种快速的胜利。</p></div><div class="ab cl ms mt gp mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="hb hc hd he hf"><p id="e931" class="pw-post-body-paragraph kd ke hi kf b kg kw is ki kj kx iv kl jr ky kn ko jv kz kq kr jz la kt ku kv hb bi translated">注意:这里是数据集<a class="ae mz" href="http://www.filedropper.com/line3-temp-2020-05-1817-51-13-163" rel="noopener ugc nofollow" target="_blank">链接</a>来测试所有的查询。</p></div></div>    
</body>
</html>