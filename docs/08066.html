<html>
<head>
<title>Extracting Daily YouTube Trending Video Statistics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">提取每日YouTube趋势视频统计数据</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/extracting-daily-youtube-trending-video-statistics-5de5f9fdc1b7?source=collection_archive---------5-----------------------#2021-10-13">https://medium.com/geekculture/extracting-daily-youtube-trending-video-statistics-5de5f9fdc1b7?source=collection_archive---------5-----------------------#2021-10-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="0d33" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在Deepnote中使用YouTube数据API和预定的笔记本</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/fa97dbb2bc3de3aa2e9ea9c57c47f512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cvAhMjXkXsehPFW1"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@christianw?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Christian Wiediger</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><blockquote class="jo"><p id="5e82" class="jp jq hi bd jr js jt ju jv jw jx jy dx translated">“YouTube不仅仅是电视”</p></blockquote><p id="5d34" class="pw-post-body-paragraph jz ka hi kb b kc kd ij ke kf kg im kh ki kj kk kl km kn ko kp kq kr ks kt jy hb bi translated">我们可能在某个地方听到有人说过这句话。好吧，至少，在印度尼西亚，这种说法是被人听到的。我个人认为是的…在我查看趋势列表之前。</p><p id="9d44" class="pw-post-body-paragraph jz ka hi kb b kc ku ij ke kf kv im kh ki kw kk kl km kx ko kp kq ky ks kt jy hb bi translated">我想，大多数上流行榜的视频基本上都来自电视。那么，我为什么不自己跟踪名单呢？</p><h2 id="44a9" class="kz la hi bd lb lc ld le lf lg lh li lj ki lk ll lm km ln lo lp kq lq lr ls lt bi translated">关于文章</h2><p id="e62b" class="pw-post-body-paragraph jz ka hi kb b kc lu ij ke kf lv im kh ki lw kk kl km lx ko kp kq ly ks kt jy hb bi translated">受其他人的<a class="ae jn" href="https://www.kaggle.com/datasnaek/youtube-new" rel="noopener ugc nofollow" target="_blank">类似工作的启发，我想分享一下我是如何构建一个python脚本来使用YouTube数据API自动提取趋势视频并从Deepnote中托管的笔记本上安排运行的。</a></p><h1 id="a857" class="lz la hi bd lb ma mb mc lf md me mf lj io mg ip lm ir mh is lp iu mi iv ls mj bi translated">你需要什么</h1><p id="46b6" class="pw-post-body-paragraph jz ka hi kb b kc lu ij ke kf lv im kh ki lw kk kl km lx ko kp kq ly ks kt jy hb bi translated">首先，由于我们想要检索YouTube视频统计数据，我们需要遵循一些“入门”步骤来获取与YouTube数据API交互所需的<strong class="kb hj"> API键</strong>。基本上，我们需要在Google Developer Console中创建一个项目，获得一个访问YouTube数据API的凭据，并获得一个API密钥。查看文档<a class="ae jn" href="https://developers.google.com/youtube/v3/getting-started#before-you-start" rel="noopener ugc nofollow" target="_blank">此处</a>了解更多详情。</p><p id="66bd" class="pw-post-body-paragraph jz ka hi kb b kc ku ij ke kf kv im kh ki kw kk kl km kx ko kp kq ky ks kt jy hb bi translated">接下来，确保安装了Python和<strong class="kb hj"> 2个主库</strong>、<code class="du mk ml mm mn b">requests</code>和<code class="du mk ml mm mn b">Pandas</code>。数据收集后我没有做花哨的分析，所以只安装了那2个库。另外，<code class="du mk ml mm mn b">kaggle</code>自从我把所有收集到的数据存储到Kaggle Dataset。</p><h1 id="485b" class="lz la hi bd lb ma mb mc lf md me mf lj io mg ip lm ir mh is lp iu mi iv ls mj bi translated">了解YouTube的资源</h1><p id="2b3f" class="pw-post-body-paragraph jz ka hi kb b kc lu ij ke kf lv im kh ki lw kk kl km lx ko kp kq ly ks kt jy hb bi translated">YouTube有很多资源和资源类型。引用<a class="ae jn" href="https://developers.google.com/youtube/v3/getting-started#resources" rel="noopener ugc nofollow" target="_blank">文档</a>，“资源是具有唯一标识符的单个数据实体”。在这种情况下，我们只关心视频资源，它代表一个单独的YouTube视频。</p><p id="21ec" class="pw-post-body-paragraph jz ka hi kb b kc ku ij ke kf kv im kh ki kw kk kl km kx ko kp kq ky ks kt jy hb bi translated">在每种资源中，都有一些我们可以用来做我们想做的事情的方法。视频资源本身有<code class="du mk ml mm mn b">getRating</code>、<code class="du mk ml mm mn b">reportAbuse</code>、<code class="du mk ml mm mn b">list</code>等方法。在我们的例子中，因为我们想要提取<strong class="kb hj">一个趋势视频列表</strong>，所以我们使用<code class="du mk ml mm mn b">list</code>方法。</p><p id="7362" class="pw-post-body-paragraph jz ka hi kb b kc ku ij ke kf kv im kh ki kw kk kl km kx ko kp kq ky ks kt jy hb bi translated"><code class="du mk ml mm mn b">list</code>方法将返回一个匹配我们请求的视频列表。因此，<strong class="kb hj">我们需要告诉API我们正在请求什么样的视频</strong>。产生的资源表示被分成几个部分，称为<code class="du mk ml mm mn b">part</code>，每个部分都有自己的属性，包装成JSON格式。</p><p id="e3b9" class="pw-post-body-paragraph jz ka hi kb b kc ku ij ke kf kv im kh ki kw kk kl km kx ko kp kq ky ks kt jy hb bi translated">例如，<code class="du mk ml mm mn b">snippet</code>零件由<code class="du mk ml mm mn b">publishedAt</code>、<code class="du mk ml mm mn b">channelId</code>、<code class="du mk ml mm mn b">title</code>、<code class="du mk ml mm mn b">description</code>等属性组成。而<code class="du mk ml mm mn b">statistics</code>部分由<code class="du mk ml mm mn b">viewCount</code>、<code class="du mk ml mm mn b">likeCount</code>、<code class="du mk ml mm mn b">dislikeCount</code>等属性组成。</p><h1 id="402b" class="lz la hi bd lb ma mb mc lf md me mf lj io mg ip lm ir mh is lp iu mi iv ls mj bi translated">剧本</h1><p id="a558" class="pw-post-body-paragraph jz ka hi kb b kc lu ij ke kf lv im kh ki lw kk kl km lx ko kp kq ly ks kt jy hb bi translated">我创建的脚本遵循模块化代码，这意味着我没有在一个大文件<code class="du mk ml mm mn b">main.py</code>中编写所有代码。相反，我把它分成了几个部分:</p><ul class=""><li id="dc81" class="mp mq hi kb b kc ku kf kv ki mr km ms kq mt jy mu mv mw mx bi translated">在<code class="du mk ml mm mn b">YouTube</code>类中定义的存储库代码</li><li id="808e" class="mp mq hi kb b kc my kf mz ki na km nb kq nc jy mu mv mw mx bi translated"><code class="du mk ml mm mn b">common</code>目录中的一些实用功能</li><li id="f887" class="mp mq hi kb b kc my kf mz ki na km nb kq nc jy mu mv mw mx bi translated">其他杂务，如日志设置、异常处理程序等。</li></ul><p id="6b4a" class="pw-post-body-paragraph jz ka hi kb b kc ku ij ke kf kv im kh ki kw kk kl km kx ko kp kq ky ks kt jy hb bi translated">所有这些模块都在主脚本<code class="du mk ml mm mn b">main.py</code>中使用。完整的目录结构如下所示。</p><blockquote class="nd ne nf"><p id="7482" class="jz ka mo kb b kc ku ij ke kf kv im kh ng kw kk kl nh kx ko kp ni ky ks kt jy hb bi translated">我用<a class="ae jn" href="https://github.com/pypa/pipenv" rel="noopener ugc nofollow" target="_blank"> pipenv </a>和<a class="ae jn" href="https://github.com/pyenv/pyenv" rel="noopener ugc nofollow" target="_blank"> pyenv </a>来管理python版本和虚拟环境，因此有Pipfile文件。</p></blockquote><pre class="iy iz ja jb fd nj mn nk nl aw nm bi"><span id="6a43" class="kz la hi mn b fi nn no l np nq">.<br/>├── Pipfile<br/>├── Pipfile.lock<br/>├── README.md<br/>├── common<br/>│   ├── __init__.py<br/>│   ├── utils.py<br/>│   └── video.py<br/>├── data<br/>├── last_retrieved_trending.py<br/>├── main.py<br/>├── storage<br/>│   └── trending.csv<br/>└── ytid<br/>    ├── __init__.py<br/>    ├── config.py<br/>    ├── exceptions.py<br/>    └── logger.py</span></pre><h2 id="3c4d" class="kz la hi bd lb lc ld le lf lg lh li lj ki lk ll lm km ln lo lp kq lq lr ls lt bi translated">YouTube API类</h2><p id="a50a" class="pw-post-body-paragraph jz ka hi kb b kc lu ij ke kf lv im kh ki lw kk kl km lx ko kp kq ly ks kt jy hb bi translated">我定义了一个用于与YouTube API交互的<code class="du mk ml mm mn b">YouTube</code>类。我们可以认为这是我们为YouTube开发的python API。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nr ns l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">ytid/__init__.py</figcaption></figure><p id="f65c" class="pw-post-body-paragraph jz ka hi kb b kc ku ij ke kf kv im kh ki kw kk kl km kx ko kp kq ky ks kt jy hb bi translated">正如我们看到的，方法<code class="du mk ml mm mn b">get_trendings</code>将遍历响应项，直到没有找到光标。这是我们的主要方法。</p><p id="c11b" class="pw-post-body-paragraph jz ka hi kb b kc ku ij ke kf kv im kh ki kw kk kl km kx ko kp kq ky ks kt jy hb bi translated">在<code class="du mk ml mm mn b">main.py</code>中，我们可以导入类并编写</p><pre class="iy iz ja jb fd nj mn nk nl aw nm bi"><span id="8422" class="kz la hi mn b fi nn no l np nq">youtube = YouTube(url=config.URL, api_key=config.API_KEY)<br/>videos = youtube.get_trendings()</span></pre><h2 id="0cd8" class="kz la hi bd lb lc ld le lf lg lh li lj ki lk ll lm km ln lo lp kq lq lr ls lt bi translated">录像</h2><p id="5a24" class="pw-post-body-paragraph jz ka hi kb b kc lu ij ke kf lv im kh ki lw kk kl km lx ko kp kq ly ks kt jy hb bi translated">对于从响应项中收集的每个视频，我们将其定义为<code class="du mk ml mm mn b">Video</code>，它代表一个YouTube <a class="ae jn" href="https://developers.google.com/youtube/v3/docs/videos" rel="noopener ugc nofollow" target="_blank">视频资源</a>。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nr ns l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">common/video.py</figcaption></figure><p id="50ef" class="pw-post-body-paragraph jz ka hi kb b kc ku ij ke kf kv im kh ki kw kk kl km kx ko kp kq ky ks kt jy hb bi translated">由于我们要求YouTube返回<code class="du mk ml mm mn b">snippet</code>、<code class="du mk ml mm mn b">contentDetails</code>和<code class="du mk ml mm mn b">statistics</code>资源，我们首先为每个部分提供必要的属性。你可以在<a class="ae jn" href="https://developers.google.com/youtube/v3/docs/videos#properties" rel="noopener ugc nofollow" target="_blank"> YouTube数据API文档</a>上查看其他零件资源。</p><h2 id="e1b9" class="kz la hi bd lb lc ld le lf lg lh li lj ki lk ll lm km ln lo lp kq lq lr ls lt bi translated">家务模块</h2><p id="1ec5" class="pw-post-body-paragraph jz ka hi kb b kc lu ij ke kf lv im kh ki lw kk kl km lx ko kp kq ly ks kt jy hb bi translated">还有一些杂务模块。一些像API Key这样的秘密被存储为环境变量，通过使用pipenv，我们可以使用位于<code class="du mk ml mm mn b">config.py</code>的<code class="du mk ml mm mn b">os.getenv</code>函数来访问和读取它们。我们还定义了一些自定义异常和日志格式。</p><h1 id="8780" class="lz la hi bd lb ma mb mc lf md me mf lj io mg ip lm ir mh is lp iu mi iv ls mj bi translated">日程笔记本</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nt"><img src="../Images/0e011a2b18bc84373056b436e1d958c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hB8bvkEqxMjkTcm9DZDlTg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Pict from <a class="ae jn" href="https://analyticsdrift.com/data-science-real-time-collaboration-tool-deepnote-is-now-open-for-all/" rel="noopener ugc nofollow" target="_blank">https://analyticsdrift.com/data-science-real-time-collaboration-tool-deepnote-is-now-open-for-all/</a></figcaption></figure><p id="7573" class="pw-post-body-paragraph jz ka hi kb b kc ku ij ke kf kv im kh ki kw kk kl km kx ko kp kq ky ks kt jy hb bi translated">代码准备好之后，就该运行并获取趋势数据了。因为我想收集每日趋势数据，所以它需要每天运行。我的第一次尝试是每天手动运行。直到我在某些时候忘记运行它，因此一些趋势数据没有被正确收集。</p><p id="9001" class="pw-post-body-paragraph jz ka hi kb b kc ku ij ke kf kv im kh ki kw kk kl km kx ko kp kq ky ks kt jy hb bi translated">2021年5月，我通过邮件收到了产品更新，宣布Deepnote现在支持预定笔记本！当时，我知道这是我可以自动和按计划运行YouTube趋势代码的地方。</p><blockquote class="jo"><p id="422a" class="jp jq hi bd jr js nu nv nw nx ny jy dx translated">引用<a class="ae jn" href="https://deepnote.com/" rel="noopener ugc nofollow" target="_blank">deepnote.com</a>的话，“Deepnote是一种新型的数据科学笔记本。jupyter-兼容实时协作，运行在云中。”</p></blockquote><p id="9bc9" class="pw-post-body-paragraph jz ka hi kb b kc kd ij ke kf kg im kh ki kj kk kl km kn ko kp kq kr ks kt jy hb bi translated">下面是已发布文章的快照，其中代码计划在UTC+7每天下午1点运行。如果你很好奇，可以在这里查看文章<a class="ae jn" href="https://deepnote.com/@syahrulhamdani/Indonesia-YouTube-Trending-Video-Statistics-pcmUcnRkQB-WGzIcdWQ8_g" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nz"><img src="../Images/b191bc665a2fc989f90a5106ac8f6448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jO6ksnbyWUOwAHshR3hRlw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Pict by author</figcaption></figure><p id="bf4f" class="pw-post-body-paragraph jz ka hi kb b kc ku ij ke kf kv im kh ki kw kk kl km kx ko kp kq ky ks kt jy hb bi translated">如果你想使用Deepnote上的日程安排功能，请阅读这里的文档<a class="ae jn" href="https://docs.deepnote.com/features/scheduling" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="1b51" class="kz la hi bd lb lc ld le lf lg lh li lj ki lk ll lm km ln lo lp kq lq lr ls lt bi translated">推送至Kaggle数据集</h2><p id="57d1" class="pw-post-body-paragraph jz ka hi kb b kc lu ij ke kf lv im kh ki lw kk kl km lx ko kp kq ly ks kt jy hb bi translated">检索趋势数据后，下一步是将其上传到Kaggle数据集。同样，因为我想在预定的笔记本中自动嵌入上传/更新步骤，所以我使用<code class="du mk ml mm mn b">kaggle</code> API并在笔记本单元中作为bash命令运行它，就像代码一样。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nz"><img src="../Images/6c84346403cbcbb549034560e4f2e96a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dunFJN_Gw7rlJxXjq1XvbQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Pict by author</figcaption></figure><h1 id="4a86" class="lz la hi bd lb ma mb mc lf md me mf lj io mg ip lm ir mh is lp iu mi iv ls mj bi translated">要关闭此…</h1><p id="9723" class="pw-post-body-paragraph jz ka hi kb b kc lu ij ke kf lv im kh ki lw kk kl km lx ko kp kq ly ks kt jy hb bi translated">谢谢你一直读到这里的最后一节。到目前为止，您已经了解了我检索YouTube趋势数据的方法，包括代码和“部署”。我鼓励你看看下面的代码库，了解全部细节。</p><div class="oa ob ez fb oc od"><a href="https://github.com/syahrulhamdani/ytid-trends" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab dw"><div class="of ab og cl cj oh"><h2 class="bd hj fi z dy oi ea eb oj ed ef hh bi translated">GitHub-syahrulhamdani/ytid-趋势:印度尼西亚YouTube趋势视频统计</h2><div class="ok l"><h3 class="bd b fi z dy oi ea eb oj ed ef dx translated">提取YouTube印度尼西亚趋势数据。受提供趋势YouTube视频统计数据的datasnaek的启发，我…</h3></div><div class="ol l"><p class="bd b fp z dy oi ea eb oj ed ef dx translated">github.com</p></div></div><div class="om l"><div class="on l oo op oq om or jh od"/></div></div></a></div><p id="5eab" class="pw-post-body-paragraph jz ka hi kb b kc ku ij ke kf kv im kh ki kw kk kl km kx ko kp kq ky ks kt jy hb bi translated">谢谢，注意安全！</p></div></div>    
</body>
</html>