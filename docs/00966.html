<html>
<head>
<title>Running Windows Containers on Compute Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在计算引擎上运行Windows容器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/running-windows-containers-on-compute-engine-e58300446b59?source=collection_archive---------8-----------------------#2021-03-22">https://medium.com/geekculture/running-windows-containers-on-compute-engine-e58300446b59?source=collection_archive---------8-----------------------#2021-03-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3df3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将带您了解如何在计算引擎上运行Windows容器。在进入实现部分之前，您应该熟悉容器、VM和Docker。</p><p id="e1d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我已经写了一篇博客，你可以在这里查看<a class="ae jd" href="https://mayankchourasia2.medium.com/what-is-kubernetes-and-how-is-it-related-to-containers-76d6d07d0fd5" rel="noopener">容器相关的</a>和<a class="ae jd" rel="noopener" href="/faun/engines-in-google-cloud-platform-1d57a39192fe">计算引擎</a>。</p><p id="302d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当人们讨论容器时，他们通常指的是基于Linux的容器。但是<a class="ae jd" href="https://blog.docker.com/2016/09/build-your-first-docker-windows-server-container/" rel="noopener ugc nofollow" target="_blank">微软</a>已经在Windows Server 2016和Windows 10中引入了对基于Windows的容器的支持。以现有的Windows应用程序为例，使用Docker将它们容器化，并作为一个隔离的容器在Windows上运行。有两种风格的Windows容器:Hyper-V和Windows Server。您可以在<a class="ae jd" href="https://hub.docker.com/r/microsoft/windowsservercore/" rel="noopener ugc nofollow" target="_blank">Microsoft/Windows server core</a>或<a class="ae jd" href="https://hub.docker.com/r/microsoft/nanoserver/" rel="noopener ugc nofollow" target="_blank"> microsoft/nanoserver </a>基础映像上构建Windows容器。</p><h1 id="4d86" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">为容器创建Windows VM实例。</h1><ul class=""><li id="117d" class="kc kd hi ih b ii ke im kf iq kg iu kh iy ki jc kj kk kl km bi translated">在GCP控制台中，转到导航菜单&gt;计算引擎。</li><li id="ade9" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">配置以下设置:</li></ul><p id="b408" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">名称:windows实例</p><p id="9c70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">启动盘:Windows Server 1809 data center Core for Containers</p><p id="e7a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">身份和API访问&gt;访问范围:允许对所有云API的完全访问</p><p id="59dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">防火墙:检查HTTP和HTTPS</p><ul class=""><li id="3508" class="kc kd hi ih b ii ij im in iq ks iu kt iy ku jc kj kk kl km bi translated">点击RDP设置windows密码。</li><li id="694c" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">单击设置并复制新的Windows密码。</li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/287b2c10b2422fe0af9554a658269957.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AMnGjMlI3NGr-Kw6V-Ecjg.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx">Set Windows Password</figcaption></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es ll"><img src="../Images/786e36da09bc76d6f7e0f60c7bf6afbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*ybdFErk3Mtax5DzyCGjVpQ.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx">Windows Server</figcaption></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lm"><img src="../Images/a042d481c2cc4959c127dbc6029b848d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxwFPxGfxGdBBnqW6hT3ag.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx">Virtual Machine</figcaption></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es ln"><img src="../Images/1f7474bc03147549d9072b0434736947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FNZ6Vk0f5U1OdDYEkGkodA.png"/></div></div></figure><h1 id="1340" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">RDP到Windows虚拟机</h1><p id="61a0" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq lo is it iu lp iw ix iy lq ja jb jc hb bi translated">RDP:远程桌面协议RDP软件提供对远程主机上托管的桌面或应用程序的访问。它允许您像在本地一样连接、访问和控制远程主机上的数据和资源。</p><ul class=""><li id="2985" class="kc kd hi ih b ii ij im in iq ks iu kt iy ku jc kj kk kl km bi translated">在Windows命令提示符(<code class="du lr ls lt lu b">C:\Users\Mayank_file</code>)下运行以下docker命令，查看默认安装的镜像。</li></ul><pre class="kw kx ky kz fd lv lu lw lx aw ly bi"><span id="2e4a" class="lz jf hi lu b fi ma mb l mc md">docker images</span></pre><ul class=""><li id="6439" class="kc kd hi ih b ii ij im in iq ks iu kt iy ku jc kj kk kl km bi translated">输出</li></ul><pre class="kw kx ky kz fd lv lu lw lx aw ly bi"><span id="cca3" class="lz jf hi lu b fi ma mb l mc md">mcr.microsoft.com/windows/servercore ltsc2019 32fecabef723 4 months ago 5.12GB</span></pre><h1 id="dc64" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">创建Windows容器应用程序</h1><p id="afaa" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq lo is it iu lp iw ix iy lq ja jb jc hb bi translated">我们在Windows容器中使用IIS Web服务器。IIS有一个Windows Server 2019的映像。我们按原样使用图像，它服务于默认的IIS页面。</p><ul class=""><li id="061a" class="kc kd hi ih b ii ij im in iq ks iu kt iy ku jc kj kk kl km bi translated">创建一个名为<code class="du lr ls lt lu b">my-windows-app</code>的文件夹，并将其输入到目录中。</li></ul><pre class="kw kx ky kz fd lv lu lw lx aw ly bi"><span id="c3fc" class="lz jf hi lu b fi ma mb l mc md">mkdir my-windows-app</span><span id="573d" class="lz jf hi lu b fi me mb l mc md">cd my-windows-app</span></pre><ul class=""><li id="5e10" class="kc kd hi ih b ii ij im in iq ks iu kt iy ku jc kj kk kl km bi translated">创建文件夹名为<code class="du lr ls lt lu b">content</code>，里面有一个名为<code class="du lr ls lt lu b">index.html</code>的文件。</li></ul><pre class="kw kx ky kz fd lv lu lw lx aw ly bi"><span id="dc6b" class="lz jf hi lu b fi ma mb l mc md">mkdir content</span><span id="60a1" class="lz jf hi lu b fi me mb l mc md">call &gt; content\index.html</span></pre><ul class=""><li id="f0dc" class="kc kd hi ih b ii ij im in iq ks iu kt iy ku jc kj kk kl km bi translated">mkdir命令创建目录，而“call”命令创建文件。</li><li id="79a1" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">编辑docker文件。</li></ul><pre class="kw kx ky kz fd lv lu lw lx aw ly bi"><span id="b75b" class="lz jf hi lu b fi ma mb l mc md">notepad content\index.html</span></pre><ul class=""><li id="3c62" class="kc kd hi ih b ii ij im in iq ks iu kt iy ku jc kj kk kl km bi translated">将<code class="du lr ls lt lu b">index.html</code>替换为以下内容:</li></ul><pre class="kw kx ky kz fd lv lu lw lx aw ly bi"><span id="b27b" class="lz jf hi lu b fi ma mb l mc md">&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;Windows containers&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;p&gt;Mayank Chourasia&lt;/p&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><ul class=""><li id="110b" class="kc kd hi ih b ii ij im in iq ks iu kt iy ku jc kj kk kl km bi translated">保存<code class="du lr ls lt lu b">index.html</code></li></ul><h1 id="1feb" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">建立码头形象</h1><ul class=""><li id="506e" class="kc kd hi ih b ii ke im kf iq kg iu kh iy ki jc kj kk kl km bi translated">为Docker映像创建一个Docker文件。</li></ul><pre class="kw kx ky kz fd lv lu lw lx aw ly bi"><span id="f74b" class="lz jf hi lu b fi ma mb l mc md">call &gt; Dockerfile<br/></span></pre><ul class=""><li id="244c" class="kc kd hi ih b ii ij im in iq ks iu kt iy ku jc kj kk kl km bi translated">编辑dockerfile文件。</li></ul><pre class="kw kx ky kz fd lv lu lw lx aw ly bi"><span id="912c" class="lz jf hi lu b fi ma mb l mc md">notepad Dockerfile</span></pre><ul class=""><li id="2281" class="kc kd hi ih b ii ij im in iq ks iu kt iy ku jc kj kk kl km bi translated">将以下内容复制到该文件中。</li></ul><pre class="kw kx ky kz fd lv lu lw lx aw ly bi"><span id="d5a7" class="lz jf hi lu b fi ma mb l mc md"><br/>FROM mcr.microsoft.com/windows/servercore/iis:windowsservercore-ltsc2019<br/><br/>RUN powershell -NoProfile -Command Remove-Item -Recurse C:\inetpub\wwwroot\*<br/><br/><br/>WORKDIR /inetpub/wwwroot<br/><br/><br/>COPY content/ .</span></pre><ul class=""><li id="a0ce" class="kc kd hi ih b ii ij im in iq ks iu kt iy ku jc kj kk kl km bi translated">保存dockerfile文件。</li><li id="cd43" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">现在，我们必须构建Docker图像并用Google容器注册中心(GCR)标记它。用<project-id>替换您的项目ID。</project-id></li></ul><pre class="kw kx ky kz fd lv lu lw lx aw ly bi"><span id="1e40" class="lz jf hi lu b fi ma mb l mc md">docker build -t gcr.io/&lt;Project-ID&gt;/iis-site-windows .</span></pre><ul class=""><li id="4fe2" class="kc kd hi ih b ii ij im in iq ks iu kt iy ku jc kj kk kl km bi translated">构建docker映像后，获得具有IIS依赖项的输出。</li></ul><pre class="kw kx ky kz fd lv lu lw lx aw ly bi"><span id="8c3d" class="lz jf hi lu b fi ma mb l mc md">docker images</span></pre><h1 id="70af" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">运行Windows容器</h1><ul class=""><li id="c6fb" class="kc kd hi ih b ii ke im kf iq kg iu kh iy ki jc kj kk kl km bi translated">构建docker映像后，我们就可以运行Windows容器了。在命令提示符下，运行容器并在端口80上公开它。</li></ul><pre class="kw kx ky kz fd lv lu lw lx aw ly bi"><span id="5449" class="lz jf hi lu b fi ma mb l mc md">docker run -d -p 80:80 gcr.io/&lt;Project-ID&gt;/iis-site-windows</span></pre><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es mf"><img src="../Images/0255e1c5280eced2a950a64e57e147f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V32by0iQ760I5fHd4l_lng.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx">Windows Instance-1</figcaption></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es mg"><img src="../Images/1fab228d95466a8de0a751f3af8071bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TEPPF4We5xazKVOMMU9yTQ.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx">Windows Instance-2</figcaption></figure><ul class=""><li id="d73e" class="kc kd hi ih b ii ij im in iq ks iu kt iy ku jc kj kk kl km bi translated">使用下面的命令，我们可以检查容器状态。</li></ul><pre class="kw kx ky kz fd lv lu lw lx aw ly bi"><span id="4b79" class="lz jf hi lu b fi ma mb l mc md">docker ps</span></pre><ul class=""><li id="5c81" class="kc kd hi ih b ii ij im in iq ks iu kt iy ku jc kj kk kl km bi translated">复制计算引擎实例的外部IP，并使用http:// <external-ip>在新浏览器中打开它</external-ip></li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es mh"><img src="../Images/1f10c7e77329a2d7e0e852e93032cb40.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*slh9ep6eLf6-fNUg2uE9dA.png"/></div><figcaption class="lh li et er es lj lk bd b be z dx">Output</figcaption></figure><p id="5c98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望本文突出了计算引擎上运行的Windows容器。</p><p id="3905" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读。</p><p id="7ba4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">敬请期待下一篇博客。</p><p id="106d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想和我联系:</p><p id="dfd9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">【领英:】<a class="ae jd" href="https://www.linkedin.com/in/mayank-chourasia-38421a134/" rel="noopener ugc nofollow" target="_blank"><em class="mi"/>https://www.linkedin.com/in/mayank-chourasia-38421a134/</a></p><p id="1007" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mi">推特:</em><a class="ae jd" href="https://twitter.com/ChourasiaMayank" rel="noopener ugc nofollow" target="_blank"><em class="mi"/>https://twitter.com/ChourasiaMayank</a>。</p><p id="f535" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢你保持安全，保持健康。</p><p id="19a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="mj mk ge" href="https://medium.com/u/991272e72e68?source=post_page-----e58300446b59--------------------------------" rel="noopener" target="_blank">谷歌开发者</a> <a class="mj mk ge" href="https://medium.com/u/4f3f4ee0f977?source=post_page-----e58300446b59--------------------------------" rel="noopener" target="_blank">谷歌云</a> <a class="mj mk ge" href="https://medium.com/u/f226348241d4?source=post_page-----e58300446b59--------------------------------" rel="noopener" target="_blank">谷歌新闻实验室</a><a class="mj mk ge" href="https://medium.com/u/fc35885def18?source=post_page-----e58300446b59--------------------------------" rel="noopener" target="_blank">qwikilabs</a><a class="mj mk ge" href="https://medium.com/u/940e606ec51a?source=post_page-----e58300446b59--------------------------------" rel="noopener" target="_blank">微软+开源</a></p></div></div>    
</body>
</html>