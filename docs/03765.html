<html>
<head>
<title>Flutter Authentication Flow with Supabase (Opensource Firebase Alternative)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Supabase(开源Firebase替代方案)的Flutter认证流程</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/flutter-authentication-flow-with-supabase-opensource-firebase-alternative-438646c5703a?source=collection_archive---------14-----------------------#2021-06-15">https://medium.com/geekculture/flutter-authentication-flow-with-supabase-opensource-firebase-alternative-438646c5703a?source=collection_archive---------14-----------------------#2021-06-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1f28975708c08c4b335ff522f734a5db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j-D37Evzd-LuvmtCo7WLUQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Supabase + Flutter</figcaption></figure><h1 id="9541" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">介绍</h1><p id="51fb" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated"><a class="ae kq" href="https://supabase.io/" rel="noopener ugc nofollow" target="_blank"> Supabase </a>是一个开源的Firebase替代方案，它提供了身份验证、与API/实时API集成的关系(Postgres)数据库、文件存储以及更多即将推出的功能。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/0940f944c5a3107ba19b7bf0133e248a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bfgj4Z6TvF6DfH0nYGVw9A.png"/></div></div></figure><p id="983b" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">在这篇文章中，我们将建立一个简单的用户注册/登录应用程序(从零开始！)使用Supabase认证和Flutter。</p><p id="bf27" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">本指南结束时，您将拥有一款允许用户注册并登录supabase的应用程序:</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/02a02633b6e76424576a6a3b5aa0e2d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*6Az75sss0oB039FTOywJXQ.gif"/></div></figure><p id="d93a" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">无论何时你在任何一点被卡住，看看<a class="ae kq" href="https://github.com/fabiojansenbr/supabase_flutter" rel="noopener ugc nofollow" target="_blank">这个回购</a>。</p><h1 id="16cf" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">项目设置</h1><p id="b388" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">在我们开始建设之前，我们要建立我们的Supabase帐户。</p><ol class=""><li id="3f1a" class="lc ld hi ju b jv kw jz kx kd le kh lf kl lg kp lh li lj lk bi translated">转到<a class="ae kq" href="https://app.supabase.io" rel="noopener ugc nofollow" target="_blank"> app.supabase.io </a>。</li><li id="2821" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated">使用您的Github帐户登录。</li><li id="4799" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated">点击“新建项目”。</li><li id="afbb" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated">输入您的项目详细信息。</li><li id="a7e8" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp lh li lj lk bi translated">等待新数据库启动。</li></ol><p id="0049" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">为了简化流程，让我们取消supabase门户网站上的电子邮件确认限制。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/734fb947c0499dc6c80348bf85246794.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*acc2fiXeHHsC_Zf9jpysjQ.png"/></div></div></figure><p id="ce35" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">现在你已经设置了你的Supabase帐号，你可以登录并注册你的用户了。我们只需要从API设置中获取<code class="du lt lu lv lw b">URL</code>和<code class="du lt lu lv lw b">anon</code>键。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/e4a7c697e652633b6d8db172f087231d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gZ1hqztcCB1c9LMbbOR7Zg.png"/></div></div></figure><h1 id="917e" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">构建Flutter应用</h1><p id="381c" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">让我们从头开始构建Flutter应用程序。</p><p id="f896" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">在终端上:</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="9374" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">然后在你喜欢的编辑器上打开supabase_flutter文件夹。</p><h2 id="f568" class="ly iv hi bd iw lz ma mb ja mc md me je kd mf mg ji kh mh mi jm kl mj mk jq ml bi translated"><strong class="ak">项目设置:</strong></h2><p id="664e" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">在开始之前，让我们创建项目文件夹结构和视图文件</p><ul class=""><li id="b765" class="lc ld hi ju b jv kw jz kx kd le kh lf kl lg kp mm li lj lk bi translated">在lib文件夹中，创建一个名为“views”的文件夹</li><li id="1c3c" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp mm li lj lk bi translated">在“views”文件夹中，创建4个文件(home_view.dart、login_view.dart、register_view.dart和splash_view.dart)</li></ul><p id="0141" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">这是我们最终的文件/文件夹结构:</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es mn"><img src="../Images/a67d5ad6e1aa4a096b9692166051f50f.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*nVzHM1_dc9LRTn7KCTLZSw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">folder strucutre</figcaption></figure><p id="7990" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">现在，在我们的终端上，让我们安装一些依赖项来帮助我们:</p><ul class=""><li id="5d92" class="lc ld hi ju b jv kw jz kx kd le kh lf kl lg kp mm li lj lk bi translated"><a class="ae kq" href="https://pub.dev/packages/supabase" rel="noopener ugc nofollow" target="_blank"> Supabase —用于颤振的Supabase客户端</a></li><li id="8c91" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp mm li lj lk bi translated"><a class="ae kq" href="https://pub.dev/packages/get_it" rel="noopener ugc nofollow" target="_blank"> get_it —帮助我们在页面上注入Supabase客户端的服务定位器</a></li><li id="3107" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp mm li lj lk bi translated"><a class="ae kq" href="https://pub.dev/packages/shared_preferences" rel="noopener ugc nofollow" target="_blank"> shared_preferences —在我们的应用程序上保留用户会话</a></li></ul><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="984b" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">并检查pubspec.yaml文件(软件包版本可能与我的不同):</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es mo"><img src="../Images/f655b9bf897c9f26933da71d1575a3aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*l0TLSLpI3xuh41aGpJzDOQ.png"/></div></figure><p id="d5c6" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">让我们打开<strong class="ju hj"> main.dart </strong>文件，将Supabase客户端设置为单例实例，并配置应用程序路由:</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><ul class=""><li id="1c07" class="lc ld hi ju b jv kw jz kx kd le kh lf kl lg kp mm li lj lk bi translated">别忘了把<strong class="ju hj"> SUPABASE_URL </strong>和<strong class="ju hj"> SUPABASE_ANON_KEY </strong>改成之前生成的URL和KEY。</li></ul><p id="a6cf" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">在main()方法中，我们创建了supabaseClient的单例实例，使用supabase_url和supabase_anon_key将该项目与我们的Supabase帐户链接起来。在MyApp方法中，我们定义了应用程序的路径。</p><h2 id="1f83" class="ly iv hi bd iw lz ma mb ja mc md me je kd mf mg ji kh mh mi jm kl mj mk jq ml bi translated">注册视图:</h2><p id="cb3b" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">打开register_view.dart文件并放置以下代码:</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="8023" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">在这个视图中，我们定义了树TextFormField()、email、password和password confirm，以及一个_register()方法，该方法将在按下register按钮时被调用。</p><p id="f0c0" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">当按下Register按钮时，将调用SupabaseClient的一个实例，并使用提供的电子邮件和密码字段调用方法. auth.signup。</p><p id="133f" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">如果result.data不同于null，我们将被重定向到登录视图，并显示一个对话框。如果我们在注册时遇到一些问题，比如重复的电子邮件字段，就会出现一个错误对话框，显示注册错误消息。</p><h2 id="7831" class="ly iv hi bd iw lz ma mb ja mc md me je kd mf mg ji kh mh mi jm kl mj mk jq ml bi translated">登录视图:</h2><p id="1579" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">打开login_view.dart文件并放置以下代码:</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="b9af" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">在这个视图中，我们定义了两个TextFormField()、email和password以及一个_login()方法，当按下login按钮时将调用这个方法。</p><p id="838e" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">当单击登录按钮时，将调用SupabaseClient的一个实例，并使用提供的电子邮件和密码字段调用方法. auth.signin。</p><p id="b9d6" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">如果result.data不同于null，我们将使用shared_preferences用signin方法返回的persistSessionString的值设置一个字符串“user”键。</p><p id="76ed" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">该密钥将在SplashView上使用(我们将在接下来的步骤中创建该密钥),以检查用户是否已经登录到应用程序，并将用户重定向到HomeView并更新Supabase凭据(令牌),而无需再次登录。</p><h2 id="b9b0" class="ly iv hi bd iw lz ma mb ja mc md me je kd mf mg ji kh mh mi jm kl mj mk jq ml bi translated">主页视图:</h2><p id="9060" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">这个观点很简单。只有一个Text()小部件显示登录用户的电子邮件和一个注销按钮。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="8d1d" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">在build()方法中，我们使用<code class="du lt lu lv lw b">final currentUser = GetIt.instance&lt;SupabaseClient&gt;().auth.user();</code>获取当前登录的用户，并使用currentUser.email属性在屏幕上显示用户的电子邮件。</p><p id="0241" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">_logout()方法负责将用户从Supabase服务器注销，并清除shared_preferences，以便用户需要再次登录。</p><h2 id="b625" class="ly iv hi bd iw lz ma mb ja mc md me je kd mf mg ji kh mh mi jm kl mj mk jq ml bi translated">飞溅视图:</h2><p id="0506" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">正如我之前提到的，Splash视图将是我们应用程序的入口点路径('/')。它将检查用户是否已经在应用程序上有一个会话。如果有一个会话，用户将被重定向到主视图，他们的凭证将在Supabase服务器上更新。如果会话不存在，用户将被重定向到登录视图。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="afe7" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">在这个阶段，您已经有了一个功能齐全的应用程序！让我们在仿真器/设备上运行应用程序:</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/02a02633b6e76424576a6a3b5aa0e2d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*6Az75sss0oB039FTOywJXQ.gif"/></div></figure><p id="744c" class="pw-post-body-paragraph js jt hi ju b jv kw jx jy jz kx kb kc kd ky kf kg kh kz kj kk kl la kn ko kp hb bi translated">* *一些设计模式可以用来使代码更好，但是它们会增加本文的难度。</p><h1 id="f715" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">后续步骤</h1><ul class=""><li id="2c80" class="lc ld hi ju b jv jw jz ka kd mp kh mq kl mr kp mm li lj lk bi translated">有问题吗？<a class="ae kq" href="https://github.com/supabase/supabase/discussions" rel="noopener ugc nofollow" target="_blank">问这里</a>或者回复本文。</li><li id="b646" class="lc ld hi ju b jv ll jz lm kd ln kh lo kl lp kp mm li lj lk bi translated">登录:app.supabase.io</li></ul></div></div>    
</body>
</html>