<html>
<head>
<title>How to Use ElasticSearch With Django</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Django的ElasticSearch</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-use-elasticsearch-with-django-ff49fe02b58d?source=collection_archive---------0-----------------------#2021-02-13">https://medium.com/geekculture/how-to-use-elasticsearch-with-django-ff49fe02b58d?source=collection_archive---------0-----------------------#2021-02-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/975cd8ad1a62243a1b0c1ff8d4998d28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x88CTnHtkIMYBKoopmojvA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">ElasticSearch with Django</figcaption></figure><h1 id="2a0b" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">什么是Elasticsearch？</h1><p id="9068" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">Elasticsearch是一个基于Lucene库的搜索引擎。它提供了一个分布式的、支持多租户的全文搜索引擎，带有HTTP web接口和无模式的JSON文档。Elasticsearch是用Java开发的。</p><h1 id="5b36" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">Elasticsearch是用来做什么的？</h1><p id="5cdd" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated"><strong class="ju hj"> Elasticsearch </strong>允许您快速、近乎实时地存储、搜索和分析海量数据，并在几毫秒内给出答案。它能够实现快速搜索响应，因为它不是直接搜索文本，而是搜索索引。</p><h1 id="e4ff" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">弹性搜索—一些基本概念</h1><ul class=""><li id="dacb" class="kq kr hi ju b jv jw jz ka kd ks kh kt kl ku kp kv kw kx ky bi translated">索引—不同类型的文档和文档属性的集合。例如，文档集可以包含社交网络应用的数据。</li><li id="f282" class="kq kr hi ju b jv kz jz la kd lb kh lc kl ld kp kv kw kx ky bi translated">类型/映射——共享同一索引中一组公共字段的文档集合。例如，索引包含社交网络应用的数据；可以有一种特定类型的用户简档数据、另一种类型的消息数据以及另一种类型的评论数据。</li><li id="2609" class="kq kr hi ju b jv kz jz la kd lb kh lc kl ld kp kv kw kx ky bi translated">文档——以特定方式在JSON格式中定义的字段集合。每个文档都属于一种类型，并驻留在索引中。每个文档都有一个唯一的标识符，称为UID。</li><li id="d7d5" class="kq kr hi ju b jv kz jz la kd lb kh lc kl ld kp kv kw kx ky bi translated">字段-弹性搜索字段可以包含多个相同类型的值(本质上是一个列表)。另一方面，在SQL中，一列只能包含一个上述类型的值。</li></ul><h1 id="5f53" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">使用Django的Elasticsearch</h1><p id="5fa2" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated"><strong class="ju hj">安装和配置:</strong></p><ul class=""><li id="8bb4" class="kq kr hi ju b jv le jz lf kd lg kh lh kl li kp kv kw kx ky bi translated">安装Django Elasticsearch DSL: $pip安装django-elasticsearch-dsl</li><li id="9712" class="kq kr hi ju b jv kz jz la kd lb kh lc kl ld kp kv kw kx ky bi translated">然后将<code class="du lj lk ll lm b">django_elasticsearch_dsl</code>添加到INSTALLED_APPS中</li><li id="6df3" class="kq kr hi ju b jv kz jz la kd lb kh lc kl ld kp kv kw kx ky bi translated">您必须在django设置中定义<code class="du lj lk ll lm b">ELASTICSEARCH_DSL</code>。</li><li id="b8d9" class="kq kr hi ju b jv kz jz la kd lb kh lc kl ld kp kv kw kx ky bi translated">例如:</li></ul><pre class="ln lo lp lq fd lr lm ls lt aw lu bi"><span id="9cfd" class="lv iv hi lm b fi lw lx l ly lz">ELASTICSEARCH_DSL={<br/>    'default': {<br/>        'hosts': 'localhost:9200'<br/>    },<br/>}</span></pre><p id="08ba" class="pw-post-body-paragraph js jt hi ju b jv le jx jy jz lf kb kc kd ma kf kg kh mb kj kk kl mc kn ko kp hb bi translated"><strong class="ju hj">向索引申报数据:</strong></p><ul class=""><li id="1469" class="kq kr hi ju b jv le jz lf kd lg kh lh kl li kp kv kw kx ky bi translated">然后对于一个模型:</li></ul><pre class="ln lo lp lq fd lr lm ls lt aw lu bi"><span id="47fa" class="lv iv hi lm b fi lw lx l ly lz"><em class="md"># models.py</em><br/><br/>class Category(models.Model):<br/>    name = models.CharField(max_length=30)<br/>    desc = models.CharField(max_length=100, blank=True)</span><span id="46d9" class="lv iv hi lm b fi me lx l ly lz">def __str__(self):<br/>    return '%s' % (self.name)</span></pre><ul class=""><li id="3520" class="kq kr hi ju b jv le jz lf kd lg kh lh kl li kp kv kw kx ky bi translated">为了让这个模型与Elasticsearch一起工作，创建一个<code class="du lj lk ll lm b">django_elasticsearch_dsl.Document</code>的子类，在<code class="du lj lk ll lm b">Document</code>类中创建一个<code class="du lj lk ll lm b">class Index</code>来定义你的Elasticsearch索引、名称、设置等，最后使用<code class="du lj lk ll lm b">registry.register_document</code>装饰器注册这个类。需要在你的app目录的<code class="du lj lk ll lm b">documents.py</code>中定义<code class="du lj lk ll lm b">Document</code>类。</li></ul><pre class="ln lo lp lq fd lr lm ls lt aw lu bi"><span id="24c0" class="lv iv hi lm b fi lw lx l ly lz"><em class="md"># documents.py</em><br/><br/><strong class="lm hj">from</strong> <strong class="lm hj">django_elasticsearch_dsl</strong> <strong class="lm hj">import</strong> Document<br/><strong class="lm hj">from</strong> <strong class="lm hj">django_elasticsearch_dsl.registries</strong> <strong class="lm hj">import</strong> registry<br/><strong class="lm hj">from</strong> <strong class="lm hj">.models</strong> <strong class="lm hj">import</strong> Category<br/><br/>@registry.register_document<br/>class CategoryDocument(Document):<br/>    class Index:<br/>        name = 'category'</span><span id="a9ad" class="lv iv hi lm b fi me lx l ly lz">    settings = {<br/>        'number_of_shards': 1,<br/>        'number_of_replicas': 0<br/>    }</span><span id="ef16" class="lv iv hi lm b fi me lx l ly lz">    class Django:<br/>         model = Category</span><span id="1f2e" class="lv iv hi lm b fi me lx l ly lz">         fields = [<br/>             'name',<br/>             'desc',<br/>         ]</span></pre><p id="7154" class="pw-post-body-paragraph js jt hi ju b jv le jx jy jz lf kb kc kd ma kf kg kh mb kj kk kl mc kn ko kp hb bi translated"><strong class="ju hj">填充:</strong></p><ul class=""><li id="6ae6" class="kq kr hi ju b jv le jz lf kd lg kh lh kl li kp kv kw kx ky bi translated">要创建和填充Elasticsearch索引和映射，请使用search_index命令:$ python manage . py search _ index-rebuild</li><li id="6ecb" class="kq kr hi ju b jv kz jz la kd lb kh lc kl ld kp kv kw kx ky bi translated">有关更多帮助，请使用$ python manage . py search _ index-help命令</li><li id="9b94" class="kq kr hi ju b jv kz jz la kd lb kh lc kl ld kp kv kw kx ky bi translated">现在，当你做这样的事情时:</li></ul><pre class="ln lo lp lq fd lr lm ls lt aw lu bi"><span id="edd5" class="lv iv hi lm b fi lw lx l ly lz">category = Category(<br/>    name="Computer and Accessories",<br/>    desc="abc desc"<br/>)<br/>category.save()</span></pre><ul class=""><li id="acb8" class="kq kr hi ju b jv le jz lf kd lg kh lh kl li kp kv kw kx ky bi translated">该对象也将保存在Elasticsearch中(使用信号处理器)。</li></ul><p id="2982" class="pw-post-body-paragraph js jt hi ju b jv le jx jy jz lf kb kc kd ma kf kg kh mb kj kk kl mc kn ko kp hb bi translated"><strong class="ju hj">搜索:</strong></p><ul class=""><li id="9a6a" class="kq kr hi ju b jv le jz lf kd lg kh lh kl li kp kv kw kx ky bi translated">要获得elasticsearch-dsl-py搜索实例，请使用:</li></ul><pre class="ln lo lp lq fd lr lm ls lt aw lu bi"><span id="d336" class="lv iv hi lm b fi lw lx l ly lz">s = CategoryDocument.search().filter("term", name="computer")<br/><br/><em class="md"># or</em><br/><br/>s = CategoryDocument.search().query("match", description="abc")<br/><br/><strong class="lm hj">for</strong> hit <strong class="lm hj">in</strong> s:<br/>    <strong class="lm hj">print</strong>(<br/>        "Category name : {}, description {}".format(hit.name, hit.desc)<br/>    )</span></pre><ul class=""><li id="cecf" class="kq kr hi ju b jv le jz lf kd lg kh lh kl li kp kv kw kx ky bi translated">要将elastic search结果转换成一个真正的django queryset，只需注意这需要一个SQL请求来检索带有elastic search查询返回的id的模型实例。</li></ul><pre class="ln lo lp lq fd lr lm ls lt aw lu bi"><span id="d861" class="lv iv hi lm b fi lw lx l ly lz">s = CategoryDocument.search().filter("term", name="computer")[:30]<br/>qs = s.to_queryset()<br/><em class="md"># qs is just a django queryset and it is called with order_by to keep</em><br/><em class="md"># the same order as the elasticsearch result.</em><br/><strong class="lm hj">for</strong> cat <strong class="lm hj">in</strong> qs:<br/>    <strong class="lm hj">print</strong>(cat.name)</span></pre><h1 id="ce4b" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">谁用Elasticsearch？</h1><ul class=""><li id="b2a9" class="kq kr hi ju b jv jw jz ka kd ks kh kt kl ku kp kv kw kx ky bi translated">易贝——凭借无数利用Elasticsearch作为主干的业务关键型文本搜索和分析用例，易贝创建了一个定制的“Elasticsearch即服务”平台，允许在其内部基于OpenStack的云平台上轻松配置Elasticsearch集群。</li><li id="dd60" class="kq kr hi ju b jv kz jz la kd lb kh lc kl ld kp kv kw kx ky bi translated">脸书使用Elasticsearch已经3年多了，已经从一个简单的企业搜索发展到跨多个集群的40多种工具，每天有6000多万次查询，并且还在增长。</li><li id="e4d6" class="kq kr hi ju b jv kz jz la kd lb kh lc kl ld kp kv kw kx ky bi translated">优步——elastic search在优步的Marketplace Dynamics核心数据系统中发挥着关键作用，它可以实时汇总业务指标以控制关键的市场行为，如动态(激增)定价、供应定位和评估整体市场诊断。</li><li id="a068" class="kq kr hi ju b jv kz jz la kd lb kh lc kl ld kp kv kw kx ky bi translated">Github使用Elasticsearch索引超过800万个代码库，以及关键事件数据。</li><li id="6544" class="kq kr hi ju b jv kz jz la kd lb kh lc kl ld kp kv kw kx ky bi translated">微软——使用Elasticsearch支持各种产品的搜索和分析，包括MSN、微软社交监听和Azure Search。</li><li id="29c8" class="kq kr hi ju b jv kz jz la kd lb kh lc kl ld kp kv kw kx ky bi translated">just Eat-elastic search提高了配送半径的准确性，因为它可以用于定义更复杂的配送路线，并在餐厅做出改变时提供实时更新。</li></ul><p id="7b13" class="pw-post-body-paragraph js jt hi ju b jv le jx jy jz lf kb kc kd ma kf kg kh mb kj kk kl mc kn ko kp hb bi translated">感谢阅读。如果你发现这篇文章有用，别忘了<strong class="ju hj">鼓掌</strong>和<strong class="ju hj">T3】与你的朋友和同事分享。:)如果你有任何问题，请随时联系我。<br/> <strong class="ju hj">与我接通👉</strong><a class="ae mf" href="https://linkedin.com/in/hiteshmishra708" rel="noopener ugc nofollow" target="_blank"><strong class="ju hj">LinkedIn</strong></a><strong class="ju hj">，</strong><a class="ae mf" href="https://github.com/hiteshmishra708" rel="noopener ugc nofollow" target="_blank"><strong class="ju hj">Github</strong></a><strong class="ju hj">:)</strong></strong></p></div></div>    
</body>
</html>