<html>
<head>
<title>How to dockerise your fastapi application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何对接fastapi应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-dockerise-your-fastapi-application-43fb4a106ae?source=collection_archive---------3-----------------------#2022-10-15">https://medium.com/geekculture/how-to-dockerise-your-fastapi-application-43fb4a106ae?source=collection_archive---------3-----------------------#2022-10-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="020e" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">记录您的fastapi应用程序</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/f30f15e390ea3cc6b69eba939200753c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*Gsvtd4B4dBoJDlfV.png"/></div></figure><h1 id="9259" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">简介:</h1><p id="e9af" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">这篇文章的目的是记录一个极简的应用程序。让我们以一个简单的fastapi程序为例，对它进行dockerise。</p><h1 id="d9d4" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">一个简单的Fastapi应用程序:</h1><p id="f604" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">下面的代码是一个简单的fastapi应用程序，只有一个端点<code class="du kt ku kv kw b">/hello</code>。假设模块名为<code class="du kt ku kv kw b">my_fastapi.py</code>。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="kx ky l"/></div></figure><h1 id="e51f" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">运行fastapi应用程序:</h1><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="kx ky l"/></div></figure><h1 id="bd62" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">输出:</h1><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="afbf" class="pw-post-body-paragraph jx jy hi jz b ka kz ij kc kd la im kf kg lb ki kj kk lc km kn ko ld kq kr ks hb bi translated">现在，我们的fastapi应用程序正在运行，并给出了预期的输出，让我们来对接它。</p><h1 id="57f7" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">码头工人——什么？</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es le"><img src="../Images/bc25514e4d65a651c2c54d3ec1fdcf27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*U2Jr6II8yJbVaWIP"/></div></figure><p id="6e2f" class="pw-post-body-paragraph jx jy hi jz b ka kz ij kc kd la im kf kg lb ki kj kk lc km kn ko ld kq kr ks hb bi translated">从文件上看，</p><blockquote class="lf lg lh"><p id="511c" class="jx jy li jz b ka kz ij kc kd la im kf lj lb ki kj lk lc km kn ll ld kq kr ks hb bi translated"><em class="hi">容器是一个标准的软件单元，它将代码及其所有依赖项打包，以便应用程序能够快速可靠地从一个计算环境运行到另一个计算环境。Docker容器映像是一个轻量级的、独立的、可执行的软件包，包括运行应用程序所需的一切</em></p><p id="9be4" class="jx jy li jz b ka kz ij kc kd la im kf lj lb ki kj lk lc km kn ll ld kq kr ks hb bi translated"><a class="ae lm" href="https://www.docker.com/resources/what-container/" rel="noopener ugc nofollow" target="_blank"><em class="hi">https://www.docker.com/resources/what-container/</em></a></p></blockquote><p id="46d8" class="pw-post-body-paragraph jx jy hi jz b ka kz ij kc kd la im kf kg lb ki kj kk lc km kn ko ld kq kr ks hb bi translated">从技术上讲，docker容器是应用程序之上的一个抽象层。在我们的例子中是fastapi应用程序。那么，要在不同的环境下运行fastapi应用程序而不出错，我们需要做些什么呢？让我们把它们列出来。</p><ol class=""><li id="8c2f" class="ln lo hi jz b ka kz kd la kg lp kk lq ko lr ks ls lt lu lv bi translated">首先，我们需要<code class="du kt ku kv kw b">python</code>。</li><li id="01ff" class="ln lo hi jz b ka lw kd lx kg ly kk lz ko ma ks ls lt lu lv bi translated"><code class="du kt ku kv kw b">fastapi</code>和uvicorn库应该安装。</li></ol><p id="928b" class="pw-post-body-paragraph jx jy hi jz b ka kz ij kc kd la im kf kg lb ki kj kk lc km kn ko ld kq kr ks hb bi translated">这就是我们所需要的。假设您希望您的fastapi应用程序被发布并运行在您的对等机器上的其他地方，我们所需要的就是一个安装了<code class="du kt ku kv kw b">fastapi</code>的<code class="du kt ku kv kw b">python</code>环境。这正是Docker解决的问题。</p><p id="f958" class="pw-post-body-paragraph jx jy hi jz b ka kz ij kc kd la im kf kg lb ki kj kk lc km kn ko ld kq kr ks hb bi translated">您不必向您的同行提供您的依赖库或README文档来开始使用fastapi应用程序。他/她只需要一个docker环境来运行你的应用程序，并访问你的应用程序所在的存储库。我们将使用<code class="du kt ku kv kw b">dockerhub</code>来托管fastapi应用程序。然而，大多数组织也使用<code class="du kt ku kv kw b">JFrog artifactory</code>来托管他们的内部docker映像。</p><h1 id="00f6" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">Dockerhub:</h1><blockquote class="lf lg lh"><p id="6fdd" class="jx jy li jz b ka kz ij kc kd la im kf lj lb ki kj lk lc km kn ll ld kq kr ks hb bi translated"><em class="hi"> Docker Hub是由Docker提供的托管存储库服务，用于与您的团队查找和共享容器映像</em></p></blockquote><h1 id="f6ed" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">Requirements.txt:</h1><p id="7a04" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">一个<code class="du kt ku kv kw b">requirements.txt</code>文件列出了运行项目所需的所有依赖库。我们的小工作室只需要<code class="du kt ku kv kw b">fastapi</code>模块。</p><pre class="iy iz ja jb fd mb kw mc md aw me bi"><span id="3794" class="mf jg hi kw b fi mg mh l mi mj">fastapi==0.85.0</span></pre><p id="2a31" class="pw-post-body-paragraph jx jy hi jz b ka kz ij kc kd la im kf kg lb ki kj kk lc km kn ko ld kq kr ks hb bi translated">让我们编写Docker文件。</p><h1 id="772c" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">Docker文件:</h1><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="kx ky l"/></div></figure><ol class=""><li id="8b17" class="ln lo hi jz b ka kz kd la kg lp kk lq ko lr ks ls lt lu lv bi translated">从dockerhub导入python。</li><li id="a18e" class="ln lo hi jz b ka lw kd lx kg ly kk lz ko ma ks ls lt lu lv bi translated">创建一个工作目录fastapiapp。</li><li id="b4ea" class="ln lo hi jz b ka lw kd lx kg ly kk lz ko ma ks ls lt lu lv bi translated">将<code class="du kt ku kv kw b">requirements.txt</code>文件复制到app目录下。</li><li id="a4df" class="ln lo hi jz b ka lw kd lx kg ly kk lz ko ma ks ls lt lu lv bi translated">安装requirements.txt文件中的所有依赖项。</li><li id="937e" class="ln lo hi jz b ka lw kd lx kg ly kk lz ko ma ks ls lt lu lv bi translated">将整个项目复制到fastapiapp目录中。</li><li id="4c5e" class="ln lo hi jz b ka lw kd lx kg ly kk lz ko ma ks ls lt lu lv bi translated">我们公开端口8000，因为应用程序将在端口8000上运行。</li><li id="ad55" class="ln lo hi jz b ka lw kd lx kg ly kk lz ko ma ks ls lt lu lv bi translated">定义<code class="du kt ku kv kw b">FASTAPI_APP</code>环境变量。否则解释器可能会抱怨找不到变量</li><li id="5252" class="ln lo hi jz b ka lw kd lx kg ly kk lz ko ma ks ls lt lu lv bi translated">最后，输入运行命令<code class="du kt ku kv kw b">uvicorn fastapiapp.docker_fastapi:app --reload --host 0.0.0.0</code>。这是为了确保服务器接受来自所有主机的请求。请注意，我们在这里包含了源目录fastapiapp。不包括这个可能会导致<code class="du kt ku kv kw b">Error loading ASGI app.Could not import module</code>错误。</li></ol><h1 id="f8ed" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">构建docker图像:</h1><p id="c57c" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">既然我们已经准备好了<code class="du kt ku kv kw b">Dockerfile</code>，我们将构建docker映像。请确保您的<code class="du kt ku kv kw b">docker desktop</code>正在运行。否则你可能会得到这个错误。</p><pre class="iy iz ja jb fd mb kw mc md aw me bi"><span id="f19b" class="mf jg hi kw b fi mg mh l mi mj">Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</span><span id="9b33" class="mf jg hi kw b fi mk mh l mi mj">(docker-env) dinesh@dinesh % docker build -t myfastapiapp .</span></pre><p id="92ad" class="pw-post-body-paragraph jx jy hi jz b ka kz ij kc kd la im kf kg lb ki kj kk lc km kn ko ld kq kr ks hb bi translated">请注意命令末尾的句点。</p><pre class="iy iz ja jb fd mb kw mc md aw me bi"><span id="7b31" class="mf jg hi kw b fi mg mh l mi mj">[+] Building 7.5s (9/9) FINISHED                                                                                                                                                                                        <br/> =&gt; [internal] load build definition from Dockerfile                                                                                                                                                               0.0s<br/> =&gt; =&gt; transferring dockerfile: 201B                                                                                                                                                                               0.0s<br/> =&gt; [internal] load .dockerignore                                                                                                                                                                                  0.0s<br/> =&gt; =&gt; transferring context: 2B                                                                                                                                                                                    0.0s<br/> =&gt; [internal] load metadata for docker.io/library/python:3.9-bullseye                                                                                                                                             2.1s<br/> =&gt; [internal] load build context                                                                                                                                                                                  0.0s<br/> =&gt; =&gt; transferring context: 3.35kB                                                                                                                                                                                0.0s<br/> =&gt; [1/4] FROM docker.io/library/python:3.9-bullseye@sha256:dd19baa7cbbf06a32808bb4d6dd63595010dc7da422ac332b789ee6ff08cc7c9                                                                                       0.0s<br/> =&gt; CACHED [2/4] WORKDIR /fastapiapp                                                                                                                                                                               0.0s<br/> =&gt; [3/4] COPY ./ ./fastapiapp                                                                                                                                                                                     0.0s<br/> =&gt; [4/4] RUN pip install -r fastapiapp/requirements.txt                                                                                                                                                           5.0s<br/> =&gt; exporting to image                                                                                                                                                                                             0.3s<br/> =&gt; =&gt; exporting layers                                                                                                                                                                                            0.3s<br/> =&gt; =&gt; writing image sha256:3f67d3fc43a32cecce470cd2878786c37018ff7fa07ed2e3a64a9f7e183f564d</span></pre><p id="aff0" class="pw-post-body-paragraph jx jy hi jz b ka kz ij kc kd la im kf kg lb ki kj kk lc km kn ko ld kq kr ks hb bi translated">一旦成功构建了映像，这些映像应该作为docker映像的一部分列出。</p><pre class="iy iz ja jb fd mb kw mc md aw me bi"><span id="ed37" class="mf jg hi kw b fi mg mh l mi mj">(docker-env) dinesh@dinesh % docker images</span><span id="1e48" class="mf jg hi kw b fi mk mh l mi mj"><br/>REPOSITORY     TAG       IMAGE ID          CREATED          SIZE<br/>myfastapiapp   latest    6b1ab29f10db   10 minutes ago   133MB</span></pre><h1 id="558b" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">运行Docker映像:</h1><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="4b73" class="pw-post-body-paragraph jx jy hi jz b ka kz ij kc kd la im kf kg lb ki kj kk lc km kn ko ld kq kr ks hb bi translated">现在，访问端点应该给出与直接运行fastapi应用程序相同的结果。</p><h1 id="926b" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">将Docker映像推送到Docker hub:</h1><p id="73ba" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">Docker图像通过<code class="du kt ku kv kw b"><a class="ae lm" href="https://docs.docker.com/engine/reference/commandline/push/" rel="noopener ugc nofollow" target="_blank">docker push</a></code>命令被推送到Docker Hub。单个Docker Hub存储库可以保存许多Docker图像(存储为<strong class="jz hj">标签</strong>)。要将图像推送到Docker Hub，您的帐户中应该有一个存储库。假设我的存储库名称是<code class="du kt ku kv kw b">myfastapi</code>，docker push命令看起来像这样，</p><pre class="iy iz ja jb fd mb kw mc md aw me bi"><span id="fde6" class="mf jg hi kw b fi mg mh l mi mj">docker push &lt;username&gt;/&lt;reponame&gt;:tagname<br/><br/>docker push dinesh/myfastapiapp:mytag</span></pre><h1 id="80e7" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">总结:</h1><p id="c408" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">如果你读到这一行，感谢你的耐心和时间。请继续访问这个空间，了解更多的技术内容。😊</p></div><div class="ab cl ml mm gp mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="hb hc hd he hf"><p id="0a57" class="pw-post-body-paragraph jx jy hi jz b ka kz ij kc kd la im kf kg lb ki kj kk lc km kn ko ld kq kr ks hb bi translated"><em class="li">原载于2022年10月15日https://dock2learn.com</em><a class="ae lm" href="https://dock2learn.com/tech/how-to-dockerise-your-fastapi-application/" rel="noopener ugc nofollow" target="_blank"><em class="li"/></a><em class="li">。</em></p></div></div>    
</body>
</html>