<html>
<head>
<title>Anatomy of a Webhook HTTP Request</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解析Webhook HTTP请求</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/anatomy-of-a-webhook-http-request-55d51c1098a8?source=collection_archive---------15-----------------------#2022-06-20">https://medium.com/geekculture/anatomy-of-a-webhook-http-request-55d51c1098a8?source=collection_archive---------15-----------------------#2022-06-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/196ad5a4f23d615befda74850c4af16c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35OP8R6IyYwyow5nmmGERA.png"/></div></div></figure><p id="72ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">HTTP <em class="jo">消息</em>是两个系统(通常是服务器和客户端)交换数据的常用方式。我们通常将每个HTTP消息称为HTTP <em class="jo">请求</em>或HTTP <em class="jo">响应</em>。</p><p id="f7d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">HTTP请求是HTTP请求的一个特定子集，它基于系统中的事件在系统之间传输数据。Webhooks与许多事件驱动的集成一起使用。</p><p id="3e70" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在与我们的客户合作时，我们发现有些人对webhooks不熟悉，他们想了解更多关于webhook HTTP请求的内容。如果你属于这一类，这篇文章会有所帮助。</p><h1 id="8514" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">webhook HTTP请求由哪些部分组成？</h1><p id="8288" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">webhook HTTP请求通常包含以下内容:</p><ul class=""><li id="e553" class="ks kt hi is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated">开始行</li><li id="c08e" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">标题</li><li id="c2a7" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">车身(有效负载)</li></ul><p id="a58a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">起跑线</strong>。每个请求都有一个单独的起始行。它出现在请求的开始，包括方法、URL和版本。这是一个开始行的例子:</p><p id="c11e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lg lh li lj b">POST /webhook/E474BA38/58E1/4544 HTTP/2</code></p><p id="af70" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">标题</strong>。每个请求可以有零个或多个头。头通常描述请求的一些信息(例如数据类型或HTTP客户端)，但是您可以为几乎任何目的创建自定义头。以下是标题示例:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="8c73" class="ls jq hi lj b fi lt lu l lv lw">Host: example.com<br/>user-agent: curl/7.79.1<br/>accept: */*<br/>myapp-hmac-sha1: f237e4a4062590a674b0adc1e84614196aae79f4<br/>myapp-api-key: 90B649F2-70F2-4180-95BC-951F5D832F0D<br/>content-type: application/json<br/>content-length: 188</span></pre><p id="8f2c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">车身(有效载荷)。</strong>每个请求(除了GET和DELETE之外)都有一个单独的主体，可以是JSON、XML或一些二进制文件，尽管多部分请求可以将多种类型的数据编码到一个请求中。这是一个身体的例子:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="e272" class="ls jq hi lj b fi lt lu l lv lw">{<br/>  <em class="jo">"orderId"</em>: <em class="jo">"abc-123"</em>,<br/>  <em class="jo">"state"</em>: <em class="jo">"update"</em>,<br/>  <em class="jo">"updates"</em>: [<br/>    { <em class="jo">"action"</em>: <em class="jo">"remove"</em>, <em class="jo">"item"</em>: <em class="jo">"widgets"</em>, <em class="jo">"quantity"</em>: 5 },<br/>    { <em class="jo">"action"</em>: <em class="jo">"add"</em>, <em class="jo">"item"</em>: <em class="jo">"gadgets"</em>, <em class="jo">"quantity"</em>: 20 }<br/>  ]<br/>}</span></pre><p id="8a36" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我们把所有的部分放在一起时，一个webhook HTTP请求(和相应的响应)可能看起来像这样:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="81d7" class="ls jq hi lj b fi lt lu l lv lw">curl https://example.com/ \<br/> --verbose \<br/> --request POST \<br/> --header 'myapp-hmac-sha1: f237e4a4062590a674b0adc1e84614196aae79f4' \<br/> --header 'myapp-api-key: 90B649F2-70F2-4180-95BC-951F5D832F0D' \<br/> --header 'content-type: application/json' \<br/> --data '{<br/>  "orderId": "abc-123",<br/>  "state": "update",<br/>  "updates": [<br/>    { "action": "remove", "item": "widgets", "quantity": 5 },<br/>    { "action": "add", "item": "gadgets", "quantity": 20 }<br/>  ]<br/>}'</span><span id="2bbe" class="ls jq hi lj b fi lx lu l lv lw">&gt; POST / HTTP/2<br/>&gt; Host: example.com<br/>&gt; user-agent: curl/7.79.1<br/>&gt; accept: */*<br/>&gt; myapp-hmac-sha1: f237e4a4062590a674b0adc1e84614196aae79f4<br/>&gt; myapp-api-key: 90B649F2-70F2-4180-95BC-951F5D832F0D<br/>&gt; content-type: application/json<br/>&gt; content-length: 188<br/>&gt;<br/>* We are completely uploaded and fine<br/>&lt; HTTP/2 200<br/>&lt; accept-ranges: bytes<br/>&lt; cache-control: max-age=604800<br/>&lt; content-type: text/html; charset=UTF-8<br/>&lt; date: Thu, 02 Jun 2022 20:26:44 GMT<br/>&lt; etag: "3147526947"<br/>&lt; expires: Thu, 09 Jun 2022 20:26:44 GMT<br/>&lt; last-modified: Thu, 17 Oct 2019 07:18:26 GMT<br/>&lt; server: EOS (vny/044E)<br/>&lt; content-length: 1256</span></pre><h1 id="cdc5" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">检查起跑线</h1><p id="d1fa" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">每个起始行由以下内容组成:</p><ul class=""><li id="c2e6" class="ks kt hi is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated">方法</li><li id="719c" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">统一资源定位器</li><li id="f1af" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">版本</li></ul><h1 id="2bb7" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">方法</h1><p id="f654" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">请求方法(动词)定义了HTTP请求执行的操作。目前，HTTP支持八种方法:</p><ul class=""><li id="58f8" class="ks kt hi is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated">删除</li><li id="acb1" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">得到</li><li id="10ac" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">头</li><li id="4395" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">选择</li><li id="06d1" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">修补</li><li id="282c" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">邮政</li><li id="bdaf" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">放</li><li id="70ba" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">找到；查出</li></ul><p id="bdc1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，webhooks只使用了其中的一部分。大多数情况下使用POST，即使是在更新或删除数据而不是创建数据时。有时，我们可能会看到webhook使用GET来验证webhook端点是否存在。不太常见的是，PUT和PATCH用于修改/替换数据。可能最不常见的是，一些webhooks使用DELETE。</p><h1 id="7047" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">统一资源定位器</h1><p id="8a72" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">webhook最常见的URL类似于<code class="du lg lh li lj b"><a class="ae ly" href="https://example.com/my-webhook." rel="noopener ugc nofollow" target="_blank">https://example.com/my-webhook</a></code> <a class="ae ly" href="https://example.com/my-webhook." rel="noopener ugc nofollow" target="_blank">。</a></p><p id="6195" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一些应用程序在URL后面附加了一个绝对路径，让你知道请求的记录类型:例如，当订单被确认时，<code class="du lg lh li lj b">https://example.com/my-webhook/order-confirmation</code>。</p><p id="b6b1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">带有查询字符串的URL是web页面请求(如搜索引擎)的一种普遍模式，其中一些值被附加到标准URL <code class="du lg lh li lj b">https://example.com/my-webhook?param1=Param-Value1&amp;param2=Param-Value2</code>的末尾。虽然不常见，但一些应用程序使用查询字符串通过URL而不是在自定义头中发送元数据。</p><h1 id="ff36" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">版本</h1><p id="56f0" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">版本就是用于请求的HTTP协议的版本。一般会是<code class="du lg lh li lj b">HTTP/1.1</code>或者<code class="du lg lh li lj b">HTTP/2</code>。虽然webhook HTTP请求包含版本，但它通常没有影响，并确保HTTP请求是有效的。</p><h1 id="c963" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">检查标题</h1><p id="7ada" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">webhook HTTP请求的头可以是默认(标准)头，也可以是自定义头。</p><h1 id="1901" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">默认标题</h1><p id="c876" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">许多标题是默认的，由源系统自动生成。以下是一些webhooks常用的默认头:</p><ul class=""><li id="044f" class="ks kt hi is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated"><code class="du lg lh li lj b">Content-Type</code>:描述正文中发送的数据(例如:<code class="du lg lh li lj b">application/json</code>)</li><li id="63bf" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated"><code class="du lg lh li lj b">User-Agent</code>:描述用于请求的HTTP客户端(例如:<code class="du lg lh li lj b">Mozilla/5.0</code>)</li><li id="f313" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated"><code class="du lg lh li lj b">Content-Length</code>:以字节为单位定义请求的大小。</li><li id="822e" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated"><code class="du lg lh li lj b">Accept</code>或<code class="du lg lh li lj b">Accept-Encoding</code>:定义预期的响应类型。</li></ul><h1 id="76c2" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">自定义标题</h1><p id="b645" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">webhook HTTP请求的自定义头可以有很大的不同，但经常用于签署主体、发送一些其他类型的认证(如API密钥)或发送其他数据(如<code class="du lg lh li lj b">Customer-ID</code>)，无论出于什么原因，这些数据都没有包含在请求主体中。自定义标头也可用于HMAC签名，以保护webhook端点。</p><p id="f443" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是一个webhook HTTP请求的两个自定义头的示例:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="74e4" class="ls jq hi lj b fi lt lu l lv lw">myapp-hmac-sha1: f237e4a4062590a674b0adc1e84614196aae79f4<br/>myapp-api-key: 90B649F2-70F2-4180-95BC-951F5D832F0D</span></pre><h1 id="28d8" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">检查尸体</h1><p id="e732" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">webhook HTTP请求的主体包含通过POST(大多数情况下)或者有时通过PUT或PATCH发送的数据。</p><p id="f0e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些数据通常是JSON格式的，但也可以是XML、CSV、PDF或您想使用的任何其他格式。如果需要一次发送几种类型的数据，可以将正文设置为多部分正文。这样做允许像PDF或MP3这样的文件通过HTTP请求和JSON等一起传输。请注意，多部分正文需要相应的多部分<code class="du lg lh li lj b">Content-Type</code>头。</p><p id="b3f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是一个简单几何体的例子:</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="cb9e" class="ls jq hi lj b fi lt lu l lv lw">{<em class="jo">"renderId"</em>:51266,<em class="jo">"s3Bucket"</em>:<em class="jo">"test-customer-renders"</em>,<em class="jo">"status"</em>:<em class="jo">"complete"</em>}</span></pre><p id="8959" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下是多部分正文的示例(带有多部分标题):</p><pre class="lk ll lm ln fd lo lj lp lq aw lr bi"><span id="e555" class="ls jq hi lj b fi lt lu l lv lw">curl 'https://example.io/webhook/' \<br/>  --request POST \<br/>  --header "Content-Type: multipart/form-data" \<br/>  --form person='{"firstname":"Sam","lastname":"McElhaney"};type=application/json' \<br/>  --form photo=@sam.jpeg \<br/>  --form resume=@resume.pdf</span><span id="7190" class="ls jq hi lj b fi lx lu l lv lw">&gt; POST /webhook HTTP/2<br/>&gt; Host: example.com<br/>&gt; user-agent: curl/7.79.1<br/>&gt; accept: */*<br/>&gt; content-length: 73686<br/>&gt; content-type: multipart/form-data; boundary=------------------------0c985f7380ec6342</span><span id="7003" class="ls jq hi lj b fi lx lu l lv lw">--------------------------0c985f7380ec6342<br/>Content-Disposition: form-data; name="person"<br/>Content-Type: application/json</span><span id="0360" class="ls jq hi lj b fi lx lu l lv lw">{"firstname":"Sam","lastname":"McElhaney"}<br/>--------------------------0c985f7380ec6342<br/>Content-Disposition: form-data; name="photo"; filename="sam.jpeg"<br/>Content-Type: image/jpeg</span><span id="f20c" class="ls jq hi lj b fi lx lu l lv lw">SOME BINARY DATA...<br/>--------------------------0c985f7380ec6342<br/>Content-Disposition: form-data; name="resume"; filename="resume.pdf"<br/>Content-Type: application/pdf</span><span id="1213" class="ls jq hi lj b fi lx lu l lv lw">%PDF-1.3<br/>MORE BINARY DATA<br/>%%EOF<br/>--------------------------0c985f7380ec6342--</span></pre><h1 id="a399" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="31b8" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">随着越来越多的公司(从Salesforce到Shopify)实施webhooks，这项技术正迅速成为SaaS集成的标准。Webhooks易于理解和实现，并且高度灵活——允许您根据数据的需要将它们变得简单或复杂。</p></div></div>    
</body>
</html>