<html>
<head>
<title>Load testing using k6 by Grafana Labs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Grafana Labs使用k6进行负载测试</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/exploring-k6-io-by-grafana-labs-6470a982835a?source=collection_archive---------4-----------------------#2022-10-22">https://medium.com/geekculture/exploring-k6-io-by-grafana-labs-6470a982835a?source=collection_archive---------4-----------------------#2022-10-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="daac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇简短的文章中，我们将探索如何使用k6.io在本地和通过k6 Cloud运行一些基本的负载测试。我们开始吧！！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/fa5f54e0b3dc407ad5f9f4a4ae4e3b4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*B09psWayqXFiniVt.gif"/></div></div></figure><h1 id="34e3" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">k6简介</h1><blockquote class="kn ko kp"><p id="265f" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated">Grafana k6是一个开源的负载测试工具，它让工程团队的性能测试变得简单而高效。k6是免费的、以开发者为中心的、可扩展的。</p><p id="1dec" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated"><em class="hi">使用k6，您可以测试系统的可靠性和性能，并更早地捕捉性能退化和问题。k6将帮助您构建可伸缩的弹性和高性能的应用程序。</em></p></blockquote><p id="2215" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以上几段摘自他们的官方文档，简单总结一下k6基本上是一个很牛逼的负载测试工具，是工程师为工程师开发的，可以让工程师以轻松得多的方式进行负载测试和混沌实验测试。它主要使用Javascript作为脚本语言，所以如果你的技术栈是基于JS的，那么它真的会很有帮助，其中开发工程师也可以在特性开发的早期阶段对负载测试做出贡献。它提供了良好的文档和社区支持，并且可以轻松地与各种监控工具(如Grafana、Datadog、Prometheus)和流行的CI解决方案(如Jenkins、Gitlab、TeamCity和GitHub Actions)集成，这样您的负载测试就可以轻松地集成，以便在构建/发布管道中每天运行或按需运行。</p><p id="2531" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它有两个版本，一个是OSS版本，另一个是位于SaaS的k6 Cloud。</p><blockquote class="kn ko kp"><p id="7326" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated">一定要看看他们的<a class="ae ku" href="https://k6.io/our-beliefs/#developer-experience-is-super-important" rel="noopener ugc nofollow" target="_blank">宣言</a></p></blockquote><h1 id="7b70" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">k6怎么安装？</h1><blockquote class="kn ko kp"><p id="08fd" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated"><em class="hi">在Windows或macOS上，只需几个命令，就可以使用Chocolatey或Homebrew等包管理器轻松安装k6。</em></p></blockquote><p id="0353" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查看他们的<a class="ae ku" href="https://k6.io/docs/getting-started/installation/" rel="noopener ugc nofollow" target="_blank">安装</a>页面了解更多信息。它们在Visual Studio代码中也有一个有用的扩展。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kv"><img src="../Images/a935c745fa5b675b987ac6540f0dea95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ddp5sEw7-VdumB8HehTfng.png"/></div></div></figure><h1 id="f16a" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">在本地环境中使用k6运行负载测试</h1><p id="69c5" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">让我们看看如何创建一个脚本，并在我们安装了k6的本地环境中使用k6执行它。</p><p id="dbc7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我将使用他们的文档部分中可用的示例代码和例子，打开VS代码，并创建一个新的。js文件。我们可以将其命名为sample.js，并将下面的代码片段粘贴到其中。</p><pre class="je jf jg jh fd lb lc ld le aw lf bi"><span id="6cd8" class="lg jq hi lc b fi lh li l lj lk">import http from 'k6/http';<br/>import { sleep } from 'k6';</span><span id="4e0d" class="lg jq hi lc b fi ll li l lj lk">export default function () {</span><span id="5e51" class="lg jq hi lc b fi ll li l lj lk">  http.get('https://test.k6.io');</span><span id="33c1" class="lg jq hi lc b fi ll li l lj lk">  sleep(1);</span><span id="44df" class="lg jq hi lc b fi ll li l lj lk">}</span></pre><p id="90b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基本上，上面的脚本将使用1个用户执行GET请求，要使用k6运行上面的脚本，只需在终端中执行下面的命令。</p><pre class="je jf jg jh fd lb lc ld le aw lf bi"><span id="866b" class="lg jq hi lc b fi lh li l lj lk">k6 run script.js</span></pre><p id="8d8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行后，您将在您的终端窗口中看到结果摘要，正如您在下面看到的，该脚本是使用1VU(虚拟用户)运行的。在http_req_duration下，您还将看到其他重要的详细信息，如平均时间、90%百分比、95%百分比、最小/最大时间等。此外，需要注意的重要一点是，执行模式是本地的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/73cbd9307bc09f689056c3e105a00366.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*41zQVAhiSrLJYC8qcHwhgg.png"/></div></div></figure><p id="319f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们可以再添加几个vu，比如:10个vu，持续时间为60秒，然后运行脚本，为此，我们只需在options部分指定细节，然后使用上面的命令运行这个更新的脚本。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ln"><img src="../Images/04f3524e08f85f017ac762de84b38c80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s3SzNLO_Kvx7objYzoRQJw.png"/></div></div></figure><p id="2aad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用options中的stages，我们可以在指定的持续时间内为几个用户执行负载测试。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lo"><img src="../Images/29e8083e395cdee8d55c684ee07f7dd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2yUK59cuHs2UEV6O_mRj6w.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/7b765df84512233678b6a272b95d2818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zaWEVsKUADsfYxGDpo45rQ.png"/></div></div></figure><h1 id="72c5" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">在k6云中运行负载测试</h1><p id="45fc" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">除了OSS，k6还提供了一个基于云的SaaS解决方案，称为k6 Cloud，可以用来构建和运行测试，分析结果等。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lq"><img src="../Images/0bc7dacdf2d1e4a53a1b35b48f4b51eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NyunmGXIMh7S_DTlxNns4Q.png"/></div></div></figure><p id="cb56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要注册，请前往此<a class="ae ku" href="https://app.k6.io/account/register" rel="noopener ugc nofollow" target="_blank">页面</a>并创建一个帐户，对于免费层，它提供了在云版本中运行50个测试的选项，当您使用您的新帐户详细信息登录时，您将被重定向到您的k6云仪表板，在那里您可以使用测试生成器创建您的第一个测试。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lr"><img src="../Images/32bb6627ad7517f857badad1acd3bf4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u7IcR4tCHODy2FnECg3JnQ.png"/></div></div></figure><p id="bb99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以手动创建一个场景，也可以根据需要记录一个场景，还可以选择导入任何场景。har文件，您可能手边就有。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/0a0f53bcc94fa556c0ac562e1930a195.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oyZ5G8Qm8Ay7SJLB8BT-bw.png"/></div></div></figure><blockquote class="kn ko kp"><p id="4699" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated"><em class="hi">我将点击请求选项，并为我个人最喜欢的网站创建一个简单的GET请求:亚马逊</em></p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/1e049127cc0dff0666c21b8600f521db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ymIKzepIQCo158NfYG5whA.png"/></div></div></figure><blockquote class="kn ko kp"><p id="e2a0" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated"><em class="hi">接下来，我将添加一些选项，10个用户在30秒内保持负载60秒，然后在5秒内执行斜坡下降。</em></p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lu"><img src="../Images/6ab7180b0309b8736a94139fee8cb4b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DZ7MYQdi6O2XZ9P9KdT8Fg.png"/></div></div></figure><blockquote class="kn ko kp"><p id="09a8" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated"><em class="hi">让我们为响应持续时间添加一个阈值，然后保存详细信息。</em></p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lv"><img src="../Images/be02eb516bbdf4fae8960e2ee2cd4236.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mAXxipe0rBgb2-XaA8uLTQ.png"/></div></div></figure><blockquote class="kn ko kp"><p id="0507" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated"><em class="hi">保存后，我还可以通过选择页面上的脚本选项，获得基于已完成配置的完整脚本。</em></p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lv"><img src="../Images/7b6d383d9a4ea86fe1c8b038946c6f88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2pwd-sRfzAuBl6YmLZHf4A.png"/></div></div></figure><blockquote class="kn ko kp"><p id="4aa7" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated"><em class="hi">要运行此脚本，请单击页面上的run按钮，发布后您将看到一些非常好的指标和图表来总结您上次运行的详细信息，这些信息可用于进一步分析。</em></p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/88d328d56cee1449a95b7230716c40ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t6yBqCuVUvu4CldlZb1RlA.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lx"><img src="../Images/f665eea63e22dd90bf5ead5e93b074cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zPA_zgXPC9Pnu4v2FBwkgg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/efb4c2a1fd308f3927fbcc5d8dccd6a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ET1dPqafrU6TlmS3PLcZow.png"/></div></div></figure><blockquote class="kn ko kp"><p id="227a" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated">此外，您还有额外的选项来导出结果，与您的团队成员共享，并将此测试设置为未来测试的基线，这真的很棒。</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lz"><img src="../Images/77178b23b8d4afd1e0c9beab18784953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*SK893ULGVqFtOda8BufJBw.png"/></div></figure><p id="da4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有一个在VS代码中运行负载测试的选项，但是使用CLI选项让它们在k6 Cloud中运行，为此您必须首先使用下面的命令配置您的令牌或登录详细信息。</p><pre class="je jf jg jh fd lb lc ld le aw lf bi"><span id="f8c7" class="lg jq hi lc b fi lh li l lj lk">k6 cloud login</span></pre><p id="6bc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，要执行测试，只需从您的终端运行以下命令。</p><pre class="je jf jg jh fd lb lc ld le aw lf bi"><span id="5e5d" class="lg jq hi lc b fi lh li l lj lk">k6 cloud script.js</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ma"><img src="../Images/404f9be7b52df9c51fed104cc9e08fa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*seJcwS96DqM3TFgLqYNInQ.png"/></div></div></figure><p id="a6ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如上图所示，执行模式为cloud，输出数据/指标将导出到您的k6 cloud账户。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mb"><img src="../Images/ad2bdfdceb2c50c9641f20ea8652baf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*44ZwQ_RyY6HBfgCpodF0TA.png"/></div></div></figure><h1 id="c19b" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">使用Github动作运行k6s负载测试</h1><p id="d8ab" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">k6s还提供了在CI管道中运行测试的选项，并可以轻松地与流行的解决方案集成，如GitHub Actions、Jenkins、TeamCity、Gitlab等。</p><p id="95c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们将需要一个如下所述的操作工作流文件，在主分支上将触发器用作push和pull_requests。</p><pre class="je jf jg jh fd lb lc ld le aw lf bi"><span id="f58d" class="lg jq hi lc b fi lh li l lj lk">on: <br/>  push:<br/>    branches:<br/>      - master<br/>  pull_request:<br/>    branches:<br/>      - master<br/>  <br/>name: k6 Load Test<br/>jobs:<br/>  k6_ubuntu_load_test:<br/>    name: k6 Ubuntu Load Test<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - name: Checkout<br/>        uses: actions/checkout@v1</span><span id="ee5d" class="lg jq hi lc b fi ll li l lj lk">      - name: Run local k6 test<br/>        uses: grafana/k6-action@v0.2.0<br/>        with:<br/>          filename: script.js</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mc"><img src="../Images/dbe4b5a9390158fa0b820f7159d2b0e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xdqO4HXVMCsQRMNhsJENhg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/7801385087c71bbb652f55d5ebd88553.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dH6GF5uDaDrTWn9ILhJNkw.png"/></div></div></figure><p id="dd55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到此，我将结束这篇文章，我个人喜欢玩k6，并相信它是一个用于负载测试需求的神奇工具。</p><p id="ef89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一定要在Youtube/Twitter上探索和关注它们！！</p></div></div>    
</body>
</html>