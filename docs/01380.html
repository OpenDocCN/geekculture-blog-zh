<html>
<head>
<title>Work with S3 Object Lambda in Typescript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Typescript中使用S3对象Lambda</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/s3-object-lambda-in-typescript-e27c1bd6cc95?source=collection_archive---------5-----------------------#2021-04-08">https://medium.com/geekculture/s3-object-lambda-in-typescript-e27c1bd6cc95?source=collection_archive---------5-----------------------#2021-04-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="eaa2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最近AWS宣布了S3对象Lambda，它支持从S3检索数据时的数据处理。通过使用S3对象Lambda，您可以轻松地呈现来自同一个数据集的多个视图，并且可以随时更新Lambda函数来修改这些视图。</p><p id="eee5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，我们有一个存储在S3的用户数据集，该数据集包含用户的电子邮件、姓名和地址。当电子邮件营销应用程序通过S3接入点请求数据时，我们不想公开地址数据，而当上市后应用程序请求数据时，我们不想公开电子邮件数据。让我们用Typescript编写一些代码来实现它。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h2 id="f312" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated">希腊字母的第11个</h2><p id="e6df" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">lambda函数很简单，它从S3检索对象，修改它，然后覆盖响应。</p><figure class="kk kl km kn fd ko"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="c0f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有几个关键点。</p><ol class=""><li id="1f08" class="kr ks hi ih b ii ij im in iq kt iu ku iy kv jc kw kx ky kz bi translated"><code class="du la lb lc ld b">event.configuration.payload</code>这是我们在对象Lambda接入点配置中创建的值，您可以使用它来添加额外的业务逻辑条件，因为您可以将多个接入点链接到同一个Lambda函数。</li><li id="fd79" class="kr ks hi ih b ii le im lf iq lg iu lh iy li jc kw kx ky kz bi translated"><code class="du la lb lc ld b">writeGetObjectResponse</code>它基本上覆盖了对GetObject请求的响应，只是要注意响应体的类型，在设置响应体的时候可能需要一些数据转换。在我的例子中，我需要转换成字符串，因为<code class="du la lb lc ld b">modifiedData</code>是一个JavaScript对象。</li><li id="9117" class="kr ks hi ih b ii le im lf iq lg iu lh iy li jc kw kx ky kz bi translated"><strong class="ih hj">我是角色权限。</strong>你至少需要两份保单。第一个是托管的<strong class="ih hj">awslambdabasiceexecutionrole。</strong>第二个是给函数调用<code class="du la lb lc ld b">writeGetObjectResponse</code>的权限</li></ol><figure class="kk kl km kn fd ko"><div class="bz dy l di"><div class="kp kq l"/></div></figure><h2 id="69b4" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated">对象λ访问点</h2><p id="deb5" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">创建一个对象lambda访问点非常简单，它只是将我们上面创建的Lambda函数连接到S3访问点。</p><figure class="kk kl km kn fd ko er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es lj"><img src="../Images/88e05bf66e1fb66ddd8fd4b6bb83919f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*46TEarESPGrdx0dgFRx0rQ.png"/></div></div></figure><figure class="kk kl km kn fd ko er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es lq"><img src="../Images/91499609936a70809c36ee300ef0c606.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kk12Rns6PNOIrHKoUfMqtw.png"/></div></div></figure><p id="c3de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注。</strong>一旦对象进入λ访问点，就应该使用对象λ访问点ARN来访问数据以便触发对象λ，而不是原来的访问点ARN。似乎</p><pre class="kk kl km kn fd lr ld ls lt aw lu bi"><span id="6a2b" class="jk jl hi ld b fi lv lw l lx ly">arn:aws:s3-object-lambda:ap-southeast-2:123456789:accesspoint/s2k</span></pre><h2 id="1f24" class="jk jl hi bd jm jn jo jp jq jr js jt ju iq jv jw jx iu jy jz ka iy kb kc kd ke bi translated"><strong class="ak">测试</strong></h2><p id="f282" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">有许多方法可以测试它的工作，最简单的是使用AWS CLI。</p><pre class="kk kl km kn fd lr ld ls lt aw lu bi"><span id="fb36" class="jk jl hi ld b fi lv lw l lx ly">aws s3api get-object --bucket arn:aws:s3-object-lambda:ap-southeast-2:123456789:accesspoint/s2k --key data.json outfile</span></pre><p id="137f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">J <strong class="ih hj">必须注意你的AWS CLI是最新的</strong>，否则，你会看到这个错误，这是因为旧版本不支持对象Lambda访问点ARN。</p><figure class="kk kl km kn fd ko er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es lz"><img src="../Images/13ee788a265a289611ce29c8eb0b2dff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vHGcPThz7qrCUOEI5_TUsw.png"/></div></div></figure><p id="be62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者，如果你喜欢你的脚本做同样的工作。</p><figure class="kk kl km kn fd ko"><div class="bz dy l di"><div class="kp kq l"/></div></figure></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="906c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">亚马逊S3对象Lambda仍然非常年轻，有许多用例将受益于这种新的无服务器武器。与此同时，这样的例子并不多。如果您有任何问题，请随时联系我们！</p><p id="4f7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和往常一样，演示代码在https://github.com/crespowang/s3-object-lambda/tree/master的<a class="ae ma" href="https://github.com/crespowang/s3-object-lambda/tree/master" rel="noopener ugc nofollow" target="_blank">处。快乐云！</a></p></div></div>    
</body>
</html>