<html>
<head>
<title>Deploy PENN Stack Web App in Azure Linux Virtual Machine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Azure Linux虚拟机中部署PENN Stack Web App</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/deploy-penn-web-app-in-azure-linux-virtual-machine-bd790b1bc487?source=collection_archive---------17-----------------------#2021-04-05">https://medium.com/geekculture/deploy-penn-web-app-in-azure-linux-virtual-machine-bd790b1bc487?source=collection_archive---------17-----------------------#2021-04-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="a7a1" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">PENN是其组成部分的缩写:Postgres、Express、Next js和Nodejs。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/e86ff49a9c8d34e569e1b47cfceebdca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fr0GBclPfOhRzOwctro1BA.jpeg"/></div></div></figure><p id="58b1" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">PENN由以下技术组成:</p><p id="b190" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">Postgres : 它是对象关系数据库，提供创建函数、触发器、继承和函数重载等功能。</p><p id="d1e8" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">Express</strong>:Nodejs的后端web应用框架。</p><p id="9966" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj"> Next JS : </strong>一个构建图形用户界面的前端java脚本库，构建在React JS之上。</p><p id="f210" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj"> Nodejs: </strong>用于执行java脚本源代码的java脚本运行时环境。</p><p id="2da9" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">初始设置:</strong></p><p id="d6b1" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">找到<a class="ae kf" href="https://github.com/Manasamahesh/PERN" rel="noopener ugc nofollow" target="_blank"> <strong class="jl hj"> PENN stack </strong> </a>的完整代码，这是PENN stack的示例项目。</p><p id="90ea" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在开始使用PENN stack之前安装一些需求。检查节点是否已安装</p><blockquote class="kg kh ki"><p id="80ba" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated"><code class="du kn ko kp kq b">$ node -v</code></p></blockquote><p id="7650" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这将显示我们系统中已安装的节点版本。如果不存在，则安装<a class="ae kf" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">节点js </a>。</p><p id="e381" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">现在，我们将使用create-next-app创建基本的next js-project，npx或yarn命令可用于创建它。</p><blockquote class="kg kh ki"><p id="2f78" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated"><code class="du kn ko kp kq b">$ npx create-next-app project name or yarn create-next-app project name</code></p></blockquote><p id="36ab" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">上面的命令用给定的项目名创建文件夹，模板是basic nextjs和所有安装的依赖项。</p><p id="54d4" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">转到这个目录。</p><blockquote class="kg kh ki"><p id="4637" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated"><code class="du kn ko kp kq b">$ cd project name</code></p></blockquote><p id="6874" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">通过运行以下命令启动开发web服务器:</p><blockquote class="kg kh ki"><p id="d224" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated"><code class="du kn ko kp kq b">$ npm start</code></p></blockquote><p id="550f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">后端文件夹:</strong></p><p id="563c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">创建新的文件夹后端并更改为后端文件夹:</p><blockquote class="kg kh ki"><p id="acb6" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated"><code class="du kn ko kp kq b">$ mkdir backend</code></p><p id="d341" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated"><code class="du kn ko kp kq b">$ cd backend</code></p></blockquote><p id="2455" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我们创建package.json并安装依赖项。</p><blockquote class="kg kh ki"><p id="b461" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated"><code class="du kn ko kp kq b">$ npm init -y</code></p><p id="c802" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated"><code class="du kn ko kp kq b">$ npm install express cors pg</code></p><p id="e7c7" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated"><code class="du kn ko kp kq b">$ npm install -g nodemon</code></p></blockquote><p id="d57d" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">CORS允许远程主机访问资源，pg使Nodejs与postgres数据库交互。nodemon工具，通过在节点文件发生更改时重新启动服务器来帮助基于Nodejs的应用程序。</p><p id="8036" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在后端目录中创建index.js作为服务器，将拥有CORS、express、端点并创建端口5000进行监听。</p><p id="8848" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">现在我们可以通过在index.js中添加下面一行来连接到我们的数据库</p><blockquote class="kg kh ki"><p id="898f" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated"><code class="du kn ko kp kq b">const pool = require (“pg”).pool;</code></p></blockquote><p id="2313" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">配置数据库连接:</strong></p><blockquote class="kg kh ki"><p id="910a" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated"><code class="du kn ko kp kq b">const pool = new pool({ user:”postgres”, password:”WE1", host:”localhost”, port: 5432, database:”pernStack” });</code></p></blockquote><p id="355d" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">创建基础数据库:</strong></p><p id="1785" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">创建数据库PERN堆栈以保存从用户界面接收的数据。</p><blockquote class="kg kh ki"><p id="cb13" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated"><code class="du kn ko kp kq b">create Database pernStack;</code></p><p id="c032" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated"><code class="du kn ko kp kq b">create Table pernTable( pern_id SERIAL primary key description VARCHAR(255));</code></p></blockquote><p id="5b83" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">前端:</strong></p><p id="27f0" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">Next js为React js的<a class="ae kf" href="https://nextjs.org/learn/basics/create-nextjs-app" rel="noopener ugc nofollow" target="_blank">缺点</a>提供解决方案。下一个js页面是从<code class="du kn ko kp kq b">.js</code>、<code class="du kn ko kp kq b">.jsx</code>、<code class="du kn ko kp kq b">.ts</code>或<code class="du kn ko kp kq b">.tsx</code>导出的React组件。文件名映射到目录中页面的路由路径。例如，如果我们创建的page/intro.js导出了一个如下所示的React组件，那么它在endpoint /intro中是可用的。</p><pre class="iy iz ja jb fd kr kq ks kt aw ku bi"><span id="50b3" class="kv kw hi kq b fi kx ky l kz la">function intro() {<br/>  return &lt;div&gt;Hello World&lt;/div&gt;<br/>}<br/><br/>export default intro</span></pre><p id="bf58" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">React组件显示从数据库中获取的详细信息，还显示了一个用户界面，从中可以获取详细信息并保存到数据库中。发生变化时，React将重新渲染。</p><pre class="iy iz ja jb fd kr kq ks kt aw ku bi"><span id="bec6" class="kv kw hi kq b fi kx ky l kz la">$ npm start</span></pre><p id="81cc" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">通过Azure管道部署到Azure Linux机器:</strong></p><p id="0fbf" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">Azure Devops提供完整的项目生命周期—从规划到测试。</p><p id="bf86" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">Azure Devops由以下项目服务组成:</p><ol class=""><li id="e7d1" class="lb lc hi jl b jm jn jp jq js ld jw le ka lf ke lg lh li lj bi translated">Azure Board- 它是一个用于跟踪项目中任务的服务，同时也为scrum和看板提供支持。</li><li id="3306" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">Azure Repos - 是Azure提供的版本控制服务</li><li id="0bf4" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated"><strong class="jl hj"> Azure pipeline- </strong>它是用于构建和部署项目的管道服务</li><li id="274a" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">Azure测试计划- 它提供了测试已部署项目的详细计划</li><li id="cceb" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated"><strong class="jl hj">工件- </strong>它存储用于管道部署的包。</li></ol><p id="e8f9" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">创建Linux Web应用:</strong></p><ol class=""><li id="c27c" class="lb lc hi jl b jm jn jp jq js ld jw le ka lf ke lg lh li lj bi translated">从azure dashboard创建资源。</li><li id="bbc4" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">选择web应用程序并选择Linux服务器，然后选择发布为代码。</li><li id="2206" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">选择运行时作为节点。</li><li id="2131" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">操作系统为Linux，检查并创建它。</li><li id="6014" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">现在在Linux服务器内部配置<a class="ae kf" href="https://www.postgresqltutorial.com/install-postgresql-linux/" rel="noopener ugc nofollow" target="_blank"> postgres数据库</a>。</li><li id="ea85" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">创建数据库和创建表。</li></ol><blockquote class="kg kh ki"><p id="bffb" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated"><code class="du kn ko kp kq b"><em class="hi">create Database pernStack;</em></code></p><p id="74a0" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated"><code class="du kn ko kp kq b"><em class="hi">create Table pernTable( pern_id SERIAL primary key description VARCHAR(255));</em></code></p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lp"><img src="../Images/63f4bb2694ea1f166b05095d6d49d7b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*feF8Yc0jc3inJK1pAMgD3Q.png"/></div></div></figure><p id="ca68" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">Azure devo PS的初始设置:</strong></p><ol class=""><li id="c435" class="lb lc hi jl b jm jn jp jq js ld jw le ka lf ke lg lh li lj bi translated">登录<a class="ae kf" href="https://azure.microsoft.com/en-in/services/devops/" rel="noopener ugc nofollow" target="_blank"> Azure Devops </a>。</li><li id="9036" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">创建新项目。</li></ol><p id="babf" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">选择Azure管道并创建新管道，选择GitHub。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lq"><img src="../Images/9de60ace1003128ab0de903cd88be397.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AS3KUpRJc8jAtnIRqNiI1Q.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">repository selection</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lv"><img src="../Images/106b48cd758e49f2598f3bfac37cc3ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S82i6j01GQtW9XZ1CJgCNQ.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">configure pipeline type</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lw"><img src="../Images/acf0d33caade5ee3e12b64556a5194a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j-eS_csj1pg0w3Mxy0KRdA.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">review pipeline save and run</figcaption></figure><p id="3ebf" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">后端部署管道:</strong></p><ol class=""><li id="5f94" class="lb lc hi jl b jm jn jp jq js ld jw le ka lf ke lg lh li lj bi translated">为Azure管道提供访问存储库的授权。</li><li id="2aae" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">现在选择的资源库已经从GitHub中列出。</li><li id="8432" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">配置您的管道以构建Node JS App并将其部署到Azure Linux web app中。</li><li id="66c0" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">选择订购详情并登录帐户。</li><li id="2ae0" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">选择您的帐户中已有的Linux服务器，如果没有创建Linux服务器，则按照步骤创建服务器。</li></ol><blockquote class="kg kh ki"><p id="9624" class="jj jk kj jl b jm jn ij jo jp jq im jr kk jt ju jv kl jx jy jz km kb kc kd ke hb bi translated">转到仪表板并创建资源，选择web应用程序，然后提供带有节点的Linux服务器的详细信息，单击查看并创建。</p></blockquote><p id="5f47" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">9.现在在回顾阶段，你会发现azure管道配置的yaml代码，在这里我们可以添加或删除要在Linux服务器中执行的内联脚本的行。</p><p id="09ee" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">10 .单击保存并运行，它会将yaml提交到GitHub存储库中。</p><p id="b34c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">11.现在开始构建后端，并成功部署。</p><p id="d421" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">前端部署管道:</strong></p><ol class=""><li id="c54d" class="lb lc hi jl b jm jn jp jq js ld jw le ka lf ke lg lh li lj bi translated">为Azure管道提供访问存储库的授权。</li><li id="e55a" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">现在选择的资源库已经从GitHub中列出。</li><li id="36a5" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">配置您的管道以构建React JS应用程序，并将其部署到Azure Linux web应用程序中。</li><li id="4320" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">选择订购详情并登录帐户。</li><li id="a082" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">选择部署了后端服务的Linux服务器。</li><li id="3153" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">现在在回顾阶段，你会发现azure管道配置的yaml代码，在这里我们可以添加或删除要在Linux服务器中执行的内联脚本的行。</li><li id="fabe" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">点击保存并运行，它会将yaml提交到GitHub库。</li><li id="eea2" class="lb lc hi jl b jm lk jp ll js lm jw ln ka lo ke lg lh li lj bi translated">现在开始构建后端，并成功部署。</li></ol><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lx"><img src="../Images/f7b149342e5ac7fdc6b834b5e8237e40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*snm8S9-tPtW7atmFxh7bIg.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">pipeline build</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ly"><img src="../Images/f6220f0f825d385809c30da5c88f424f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tgg7sZarCBMivzXZE0Zpeg.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">pipeline deployment</figcaption></figure></div></div>    
</body>
</html>