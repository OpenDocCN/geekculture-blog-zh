<html>
<head>
<title>Re: dash — Python Data Source</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">回复:破折号Python数据源</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/re-dash-python-data-source-e5200a863cb2?source=collection_archive---------12-----------------------#2021-08-18">https://medium.com/geekculture/re-dash-python-data-source-e5200a863cb2?source=collection_archive---------12-----------------------#2021-08-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8046" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Redash是一个开源的免费BI工具，用户可以使用docker在他们的机器上轻松设置。它是非常轻量级的，易于用于跨多个数据源分析数据。Redash <em class="jd"> v10-preview </em>版本出来了，你可以用下面的教程试试。</p><div class="je jf ez fb jg jh"><a rel="noopener follow" target="_blank" href="/@Iqbalkhattra85/re-dash-open-source-bi-tool-a27fb26b3072"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">回复:dash——开源BI工具</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">过去在黑色终端上查询数据或者将数据导入Excel表格进行分析的日子已经一去不复返了。数据…</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">medium.com</p></div></div><div class="jq l"><div class="jr l js jt ju jq jv jw jh"/></div></div></a></div><p id="ea5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Redash自带20多个数据源，它可以通过使用数据源UI轻松连接到任何开源或云数据库。然而，在Redash中还有一些其他数据源可以用来从URL或API中提取数据。这些数据源在默认情况下是不启用的，出于安全原因，建议仅在个人系统上使用。</p><p id="8f3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将在本文中讨论如何使用Python作为数据源来实现。</p><div class="je jf ez fb jg jh"><a href="https://redash.io/help/data-sources/querying/supported-data-sources" rel="noopener  ugc nofollow" target="_blank"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">支持的数据源</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">编辑描述</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">redash.io</p></div></div><div class="jq l"><div class="jx l js jt ju jq jv jw jh"/></div></div></a></div></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="36b7" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">用例</h1><p id="3016" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">作为专门进行数据分析的工程师或分析师，我们通常需要在数据之上添加一个解码层，然后才能在最终用户仪表板上共享或呈现数据。例如，<code class="du li lj lk ll b">city_id = 1</code>对于查看仪表板或复杂可视化的任何人来说都没有意义。在这种情况下，将映射或维度数据集添加到后端数据源并不是一个好的设计选项，因为在分析后不再需要数据集。</p><p id="f4b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其次，在生产系统中添加和删除数据集会产生额外的开销，这可能需要几天到几周的时间，这取决于您的数据团队的日程安排，他们最希望避免一次性请求:)</p><h1 id="87c0" class="kf kg hi bd kh ki lm kk kl km ln ko kp kq lo ks kt ku lp kw kx ky lq la lb lc bi translated">Python数据源</h1><p id="eef7" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">在这样的场景中，我们需要一个数据源，它可以从外部数据源读取数据，还可以灵活地操作结果集，以便与其他数据查询相结合。</p><p id="b3cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">redash中的Python数据源为用户提供了查询外部URL/API和提取一次性解码文件进行专门分析的灵活性。当前数据源不支持全局python函数，但它通过一些预定义的函数提供了广泛的功能，默认打印函数也可用于脚本的简单调试。</p><h2 id="9e4d" class="lr kg hi bd kh ls lt lu kl lv lw lx kp iq ly lz kt iu ma mb kx iy mc md lb me bi translated"><strong class="ak">如何启用？</strong></h2><p id="0ea8" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated"><strong class="ih hj">默认情况下</strong> python不能作为数据源，用户需要在设置Redash实例时更新<code class="du li lj lk ll b">redash.env</code>文件并添加下面一行。该选项仅在<code class="du li lj lk ll b">self-hosted</code>实例中可用，或者用户可以咨询他们的Redash管理团队来启用它。</p><pre class="mf mg mh mi fd mj ll mk ml aw mm bi"><span id="61a0" class="lr kg hi ll b fi mn mo l mp mq">REDASH_ADDITIONAL_QUERY_RUNNERS=redash.query_runner.python</span></pre><blockquote class="mr ms mt"><p id="9148" class="if ig jd ih b ii ij ik il im in io ip mu ir is it mv iv iw ix mw iz ja jb jc hb bi translated">如果您已经有一个redash实例在运行，请在设置参数后重新启动您的celery workers。</p></blockquote><h2 id="da7b" class="lr kg hi bd kh ls lt lu kl lv lw lx kp iq ly lz kt iu ma mb kx iy mc md lb me bi translated">怎么用？</h2><p id="b59f" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">Redash要求每个查询都返回一个python中的<code class="du li lj lk ll b">dict</code>类型<code class="du li lj lk ll b">result</code>对象，用于以表格或图形格式可视化记录。数据库的所有内置查询运行器类为每个查询返回一个dictionary对象，格式如下。</p><p id="3f96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结果对象格式:</strong></p><pre class="mf mg mh mi fd mj ll mk ml aw mm bi"><span id="d806" class="lr kg hi ll b fi mn mo l mp mq">result = {<br/>    "rows": [<br/>        {"id": 1, "value": "s2f1"},<br/>    ],<br/>    "columns": [<br/>        {<br/>            "name": "id",<br/>            "friendly_name": "id",<br/>            "type": TYPE_INTEGER,<br/>        },<br/>        {<br/>            "name": "value",<br/>            "friendly_name": "value",<br/>            "type": TYPE_STRING,<br/>        }<br/>    ]<br/>}</span></pre><p id="9f82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个结果对象包含两个键</p><ul class=""><li id="fa0b" class="mx my hi ih b ii ij im in iq mz iu na iy nb jc nc nd ne nf bi translated"><code class="du li lj lk ll b">rows</code>键包含用于查询的n条输出记录的列表。在输出中，每个行元素可以包含n个列。每个行元素都必须是JSON格式。</li><li id="b697" class="mx my hi ih b ii ng im nh iq ni iu nj iy nk jc nc nd ne nf bi translated"><code class="du li lj lk ll b">columns</code>键包含记录的模式。每个模式字段必须有两个字段值<code class="du li lj lk ll b">name</code> &amp; <code class="du li lj lk ll b">type</code>。Python query runner为结果对象提供了预定义的数据类型，如下所述</li></ul><pre class="mf mg mh mi fd mj ll mk ml aw mm bi"><span id="16a5" class="lr kg hi ll b fi mn mo l mp mq"># Supported data types<br/>- TYPE_DATETIME                                   <br/>- TYPE_BOOLEAN                                  <br/>- TYPE_INTEGER                                   <br/>- TYPE_STRING                                   <br/>- TYPE_DATE                                   <br/>- TYPE_FLOAT</span></pre><p id="a37d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以在python数据源的情况下，用户必须格式化他们的<code class="du li lj lk ll b">python script</code>的输出并返回一个格式化的结果对象。</p><p id="4840" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">功能:</strong></p><p id="037c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Python查询运行器还支持一组函数，用于读取和更新来自其他查询的结果对象。用户可以读取其他查询的输出，并可以使用python连接多个查询的输出。</p><pre class="mf mg mh mi fd mj ll mk ml aw mm bi"><span id="8b0e" class="lr kg hi ll b fi mn mo l mp mq">## Return the result Object for a predefined query<br/>get_query_result(&lt;Redash Query ID&gt;):                               </span><span id="369f" class="lr kg hi ll b fi nl mo l mp mq">## Print Table Schema Information for a data source  <br/>get_source_schema(&lt;Redash Data Source Name or ID&gt;)  <br/>                                <br/>## Execute a query and return result object against a data source in ## python<br/>execute_query(&lt;Redash Data Source Name or ID&gt;, &lt;SQL QUERY&gt;)                                  </span><span id="41c5" class="lr kg hi ll b fi nl mo l mp mq">## Add new column to the result object<br/>add_result_column(&lt;result object&gt;, &lt;field_name&gt;, &lt;field_name_for_displauy&gt;, &lt;field_datatype&gt;)</span><span id="4189" class="lr kg hi ll b fi nl mo l mp mq">## Add a new row to the result object<br/>add_result_row(&lt;result object&gt;, &lt;values&gt;)</span></pre></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="7971" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">例子</h1><p id="92fb" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">我们将从URL中提取一个文件，并将在redash中创建一个数据集，以将该文件用作映射文件。</p><ul class=""><li id="5621" class="mx my hi ih b ii ij im in iq mz iu na iy nb jc nc nd ne nf bi translated">创建Python数据源并添加脚本所需的所有模块。</li></ul><figure class="mf mg mh mi fd nn er es paragraph-image"><div class="er es nm"><img src="../Images/2d898ee8e2061b216a1c771167aed4ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*ny2m5p4ElaYBBLD2gEQXPA.png"/></div><figcaption class="np nq et er es nr ns bd b be z dx">Python Data Source Configuration</figcaption></figure><ul class=""><li id="e032" class="mx my hi ih b ii ij im in iq mz iu na iy nb jc nc nd ne nf bi translated">创建一个Python脚本，并从git hub中提取文件。</li></ul><figure class="mf mg mh mi fd nn er es paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="er es nt"><img src="../Images/9af3222c289548883eddf8d4af1a5233.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*--vYw20eI3UrFJJTJVBCqg.png"/></div></div><figcaption class="np nq et er es nr ns bd b be z dx">Python Snippet for URL file</figcaption></figure><ul class=""><li id="3826" class="mx my hi ih b ii ij im in iq mz iu na iy nb jc nc nd ne nf bi translated">执行脚本并获得输出。它将打印我们使用带有时间戳的<code class="du li lj lk ll b">print</code>函数添加的所有日志记录信息，并且它可以帮助您捕获每一步花费的时间。</li></ul><figure class="mf mg mh mi fd nn er es paragraph-image"><div class="er es ny"><img src="../Images/0e7f2e24985e7e856b29f5aa92aaa3a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*DIud0KECfg0Ma0oPB8Qogw.png"/></div><figcaption class="np nq et er es nr ns bd b be z dx">Output.</figcaption></figure><p id="c9e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">功能示例</strong></p><ul class=""><li id="0e95" class="mx my hi ih b ii ij im in iq mz iu na iy nb jc nc nd ne nf bi translated">获取旧查询的结果并将新记录添加到结果集中。</li></ul><figure class="mf mg mh mi fd nn er es paragraph-image"><div class="er es nz"><img src="../Images/59ca24d0054dc80de2e0390cdb7b17df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*Ov2SsBXLaQ_Nbs6o2djMgQ.png"/></div></figure></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="6280" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Python数据源不仅限于从URL或API中提取数据，它可以有多种用途。将它们全部列在本文的范围内是不可行的。请尝试所有内置功能，如果您遇到任何问题，请告诉我。你可以在下面的链接中找到例子的代码，我会在未来尝试添加更多的东西。</p><h1 id="316d" class="kf kg hi bd kh ki lm kk kl km ln ko kp kq lo ks kt ku lp kw kx ky lq la lb lc bi translated">感谢您的阅读，祝您愉快！！</h1></div></div>    
</body>
</html>