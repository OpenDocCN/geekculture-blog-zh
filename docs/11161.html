<html>
<head>
<title>How to avoid file name collisions in pytest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何避免pytest中的文件名冲突</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-avoid-file-name-collisions-in-pytest-295f770bdec3?source=collection_archive---------6-----------------------#2022-03-08">https://medium.com/geekculture/how-to-avoid-file-name-collisions-in-pytest-295f770bdec3?source=collection_archive---------6-----------------------#2022-03-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3ce6" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">__init__的意义。py测试中的py</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/1967986775ff4de9bbacfdd316f403a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lYcH5ccXMc_5M-vJWZmxqA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx"><a class="ae jn" href="https://dock2learn.com/tech/how-to-avoid-file-name-collisions-in-pytest/" rel="noopener ugc nofollow" target="_blank">https://dock2learn.com/tech/how-to-avoid-file-name-collisions-in-pytest/</a></figcaption></figure><h1 id="2ad2" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">简介:</h1><p id="6203" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">在使用<code class="du lc ld le lf b">pytest</code>为具有多个目录的项目编写单元测试时，您是否尝试过用相同的名称命名不同目录中的两个测试文件？让我们用一个小例子来尝试一下。</p><h1 id="9eef" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">命名测试文件:</h1><p id="a95b" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">假设我们有一个如下所示的目录结构。</p><pre class="iy iz ja jb fd lg lf lh li aw lj bi"><span id="6ecd" class="lk jp hi lf b fi ll lm l ln lo">-- tests<br/>   |__unit<br/>      |__dir1<br/>         |__test_file.py<br/>      |__dir2<br/>         |__test_file.py</span></pre><h2 id="ea8b" class="lk jp hi bd jq lp lq lr ju ls lt lu jy kp lv lw ka kt lx ly kc kx lz ma ke mb bi translated">目录1/测试文件. py</h2><pre class="iy iz ja jb fd lg lf lh li aw lj bi"><span id="4b17" class="lk jp hi lf b fi ll lm l ln lo">def test_my_function_dir1():<br/>    print(f" Inside test_my_function_dir1 ")</span></pre><h2 id="043f" class="lk jp hi bd jq lp lq lr ju ls lt lu jy kp lv lw ka kt lx ly kc kx lz ma ke mb bi translated">目录1/测试文件. py</h2><pre class="iy iz ja jb fd lg lf lh li aw lj bi"><span id="160b" class="lk jp hi lf b fi ll lm l ln lo">def test_my_function_dir2():<br/>    print(f" Inside test_my_function_dir2 ")</span></pre><p id="fa56" class="pw-post-body-paragraph kg kh hi ki b kj mc ij kl km md im ko kp me kr ks kt mf kv kw kx mg kz la lb hb bi translated">尝试执行来自<code class="du lc ld le lf b">dir1</code>的<code class="du lc ld le lf b">test_file.py</code>文件和来自<code class="du lc ld le lf b">dir2</code>的<code class="du lc ld le lf b">test_file.py</code>文件。</p><pre class="iy iz ja jb fd lg lf lh li aw lj bi"><span id="1105" class="lk jp hi lf b fi ll lm l ln lo">(practo-env)dir1 % pytest<br/>===================== test session starts ===================<br/>platform darwin -- Python 3.9.9, pytest-7.0.1, pluggy-1.0.0<br/>rootdir: /Users/tests/unit/dir1<br/>collected 1 item                                                                                                                                                                                                                                             <br/><br/>test_file.py .                                                                                                                                                                                                                                         [100%]<br/><br/>====================== 1 passed in 0.00s ======================</span><span id="8593" class="lk jp hi lf b fi mh lm l ln lo">(practo-env)dir2 % pytest<br/>===================== test session starts ===================<br/>platform darwin -- Python 3.9.9, pytest-7.0.1, pluggy-1.0.0<br/>rootdir: /Users/tests/unit/dir2<br/>collected 1 item                                                                                                                                                                                                                                             <br/><br/>test_file.py .                                                                                                                                                                                                                                         [100%]<br/><br/>====================== 1 passed in 0.00s ======================</span></pre><p id="7e08" class="pw-post-body-paragraph kg kh hi ki b kj mc ij kl km md im ko kp me kr ks kt mf kv kw kx mg kz la lb hb bi translated">在这两种情况下，测试都通过了，没有任何失败或警告。现在，让我们试着从<code class="du lc ld le lf b">unit</code>目录运行测试。</p><pre class="iy iz ja jb fd lg lf lh li aw lj bi"><span id="afc1" class="lk jp hi lf b fi ll lm l ln lo">(practo-env) unit % pytest<br/>======================== test session starts ==============<br/>platform darwin -- Python 3.9.9, pytest-7.0.1, pluggy-1.0.0<br/>rootdir: /Users/tests/unit<br/>collected 1 item / 1 error                                                     <br/><br/>========================= ERRORS ===========================<br/>______________ ERROR collecting dir2/test_file.py ______<br/>import file mismatch:<br/>imported module 'test_file' has this __file__ attribute:<br/>  /Users/tests/unit/dir1/test_file.py<br/>which is not the same as the test file we want to collect:<br/>  /Users/tests/unit/dir2/test_file.py<br/>HINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules<br/>======================= short test summary info ===============<br/>ERROR dir2/test_file.py<br/>!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!<br/>========================== 1 error in 0.06s ===================</span></pre><p id="5d2d" class="pw-post-body-paragraph kg kh hi ki b kj mc ij kl km md im ko kp me kr ks kt mf kv kw kx mg kz la lb hb bi translated">尽管这些文件有不同的测试，但是当它们从根目录作为一组完整的测试运行时，仍然会失败。</p><h1 id="2121" class="jo jp hi bd jq jr js jt ju jv jw jx jy io jz ip ka ir kb is kc iu kd iv ke kf bi translated">解决方案是:</h1><p id="b012" class="pw-post-body-paragraph kg kh hi ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">向所有测试子目录添加一个空的<code class="du lc ld le lf b">__init__.py</code>文件可以避免这个问题。在我们的例子中，<code class="du lc ld le lf b">dir1</code>和<code class="du lc ld le lf b">dir2</code>都应该有一个<code class="du lc ld le lf b">__init__.py</code>文件。</p><pre class="iy iz ja jb fd lg lf lh li aw lj bi"><span id="f5db" class="lk jp hi lf b fi ll lm l ln lo">-- tests<br/>   |__unit<br/>      |__dir1<br/>         |__test_file.py<br/>         |__ __init__.py<br/>      |__dir2<br/>         |__test_file.py<br/>         |__ __init__.py</span></pre><p id="4c51" class="pw-post-body-paragraph kg kh hi ki b kj mc ij kl km md im ko kp me kr ks kt mf kv kw kx mg kz la lb hb bi translated">现在我们已经在<code class="du lc ld le lf b">dir1</code>和<code class="du lc ld le lf b">dir2</code>中添加了<code class="du lc ld le lf b">__init__.py</code>文件。让我们尝试从<code class="du lc ld le lf b">unit</code>目录重新运行测试。</p><pre class="iy iz ja jb fd lg lf lh li aw lj bi"><span id="5d69" class="lk jp hi lf b fi ll lm l ln lo">(practo-env) dkb@dkb-a01 unit % pytest<br/>============== test session starts ========================<br/>platform darwin -- Python 3.9.9, pytest-7.0.1, pluggy-1.0.0<br/>rootdir: /Users/tests/unit<br/>collected 2 items                                                                                                                                                                                                                                            <br/><br/>dir1/test_file.py .                                                                                                                                                                                                                                    [ 50%]<br/>dir2/test_file.py .                                                                                                                                                                                                                                    [100%]<br/><br/>=========================== 2 passed in 0.01s ==============</span></pre><p id="3aea" class="pw-post-body-paragraph kg kh hi ki b kj mc ij kl km md im ko kp me kr ks kt mf kv kw kx mg kz la lb hb bi translated">拥有一个<code class="du lc ld le lf b">__init__.py</code>文件的好处是我们可以在多个测试子目录中拥有相同的测试文件名。现在，最大的问题是为什么我们会有这样的场景？我们会遇到吗？</p><p id="7392" class="pw-post-body-paragraph kg kh hi ki b kj mc ij kl km md im ko kp me kr ks kt mf kv kw kx mg kz la lb hb bi translated">我们可能不得不将我们的测试分成单元测试和组件测试，并且我们可能以相同的名字命名相同的测试文件而告终。这只是我能想到的一个用例。</p><p id="a466" class="pw-post-body-paragraph kg kh hi ki b kj mc ij kl km md im ko kp me kr ks kt mf kv kw kx mg kz la lb hb bi translated">嗯，我们可能会遇到这种情况..可能不是..添加该文件作为预先警告并无大碍。是吗？</p><p id="29da" class="pw-post-body-paragraph kg kh hi ki b kj mc ij kl km md im ko kp me kr ks kt mf kv kw kx mg kz la lb hb bi translated">快乐学习！！</p></div></div>    
</body>
</html>