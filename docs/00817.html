<html>
<head>
<title>OnBoarding Animation at HealthifyMe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HealthifyMe上的入职动画</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/onboarding-animation-at-healthifyme-2b7cef661408?source=collection_archive---------11-----------------------#2021-03-14">https://medium.com/geekculture/onboarding-animation-at-healthifyme-2b7cef661408?source=collection_archive---------11-----------------------#2021-03-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/d05e0c98e247f1179c10805072f15211.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/1*ks4Okdt4J8qi1QILDqcbqA.gif"/></div><figcaption class="im in et er es io ip bd b be z dx">Onboarding completion animation in HealthifyMe app</figcaption></figure><p id="68b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们healthify专注于提供最适合用户的计划。为了做到这一点，在入职时，我们会问用户几个问题，涉及他们的年龄、体重，以及他们是否进行任何体育锻炼或是否受过任何伤害？完成所有回答后，我们会显示一个入职完成屏幕，其中有一些动画，如您在上面的视频中所见。我们专注于用户互动，让我们的应用程序更加用户友好。</p><p id="44ac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">今天在这篇文章中，我们将学习如何实现这一点。</p><p id="0099" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤1: </strong>在你的项目中添加一些基本的库和Glide来加载图标图像。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="0140" class="jx jy hi jt b fi jz ka l kb kc">implementation 'com.github.bumptech.glide:glide:4.11.0'<br/>implementation 'com.google.code.gson:gson:2.8.6'</span></pre><p id="0bbd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第二步:</strong>设计屏幕。</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div class="er es kd"><img src="../Images/5c977e15014a3d7fa846d18d5c39cde3.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/1*4AtWVmykpYKaxd6OaNHSJg.png"/></div></figure><p id="ff29" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里是初始屏幕，我们有一个标题文本，然后是设置用户计划的3个步骤。</p><p id="c07a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以通过在一个新文件中创建图标来使它们可重复使用。图像周围有一个进度条。进度条有三个阶段。</p><p id="cacb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">a)违约。<br/> b)中间。<br/> c)完成。</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="7bea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是图标布局的代码。</p><p id="e1b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du kg kh ki jt b"><em class="kj">#layout_loading_progress_with_icon_ and_text.xml</em></code></p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="83f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du kg kh ki jt b"><em class="kj">#activity_main.xml</em></code></p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="b963" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第三步:</strong>在图标内部初始设置1，2，3，取数据。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="62bd" class="jx jy hi jt b fi jz ka l kb kc">fl_progress_1.tv_ob_loading.<em class="kj">text </em>= 1.toString()<br/>fl_progress_2.tv_ob_loading.<em class="kj">text </em>= 2.toString()<br/>fl_progress_3.tv_ob_loading.<em class="kj">text </em>= 3.toString()</span></pre><p id="9631" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从API中获取我们想要在屏幕上显示的数据。例如，我正在获取一个样本JSON。</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="776a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将Json转换成gson并存储在类名<code class="du kg kh ki jt b">OnboardingUiDataModel</code>中</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="44f7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在setUpUi方法中传递json数据。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="abca" class="jx jy hi jt b fi jz ka l kb kc">private fun setupUi(data: OnboardingUiDataModel?, animate: Boolean = true) {<br/>}</span></pre><p id="7b3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从JSON数据设置屏幕标题。</p><p id="116c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤4 </strong>:设置加载状态</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div class="er es kk"><img src="../Images/c17c4be04b764d7954c819eb62183d39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*_v3r6gfWSkkFKNGojkHG8g.gif"/></div></figure><ol class=""><li id="3573" class="kl km hi is b it iu ix iy jb kn jf ko jj kp jn kq kr ks kt bi translated">这里，我们首先将文本视图隐藏在显示步数的图标内。</li></ol><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="de48" class="jx jy hi jt b fi jz ka l kb kc">view.tv_ob_loading.<em class="kj">text </em>= ""</span></pre><p id="54bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.然后通过<code class="du kg kh ki jt b">AccelerateDecelerateInterpolator</code>改变进度条可绘制并旋转。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="6898" class="jx jy hi jt b fi jz ka l kb kc">private val interpolator = AccelerateDecelerateInterpolator()</span><span id="9ff5" class="jx jy hi jt b fi ku ka l kb kc">view.iv_ob_loading.animate().alpha(1f).setDuration(if (animate) 1000 else 0)<br/>    .setInterpolator(interpolator).start()</span></pre><p id="3bfa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.通过任何图像库设置imageView。我们在这里使用Glide。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="119d" class="jx jy hi jt b fi jz ka l kb kc">val iconRes = icon?.iconRes ?: 0<br/>if (iconRes != 0)<br/>    view.iv_ob_loading.setImageResource(iconRes)<br/>else<br/>    BaseImageLoader.loadImage(this, icon?.icon, view.iv_ob_loading)</span></pre><p id="21cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du kg kh ki jt b">loadImage()</code>是通过glide在传递的imageView中加载imageUrl的方法。</p><p id="1cb5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.通过<em class="kj">不确定的可绘制改变进度条的可绘制状态。</em></p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="ee05" class="jx jy hi jt b fi jz ka l kb kc">val pbObLoading = view.pb_ob_loading<br/>val bounds = pbObLoading.<em class="kj">indeterminateDrawable</em>.copyBounds()<br/>progressDrawable?.<em class="kj">bounds </em>= bounds<br/>progressFinalDrawable?.<em class="kj">bounds </em>= bounds<br/>pbObLoading.<em class="kj">indeterminateDrawable </em>= progressDrawable</span></pre><p id="1376" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.动画文本，设置文本内容和动画，同时显示在屏幕上。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="83fe" class="jx jy hi jt b fi jz ka l kb kc">text1.<em class="kj">visibility </em>= View.<em class="kj">VISIBLE<br/></em>text1.<em class="kj">text </em>= icon?.loadingText<br/>text1.animate().alpha(1f).setDuration(if (animate) 1100 else 0)<br/>    .setInterpolator(interpolator).start()<br/>text2.<em class="kj">visibility </em>= View.<em class="kj">VISIBLE<br/></em>text2.<em class="kj">text </em>= icon?.finalText<br/>text2.animate().alpha(1f).setDuration(if (animate) 1100 else 0)<br/>    .setInterpolator(interpolator).start()</span></pre><p id="6112" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个文本布局包含两个textView。一是加载文本，二是最终文本。600毫秒后，我们将删除加载文本，并在加载图标旁边移动最终文本，并将进度条更改为最终可绘制。</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="37fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">动画结束后，我们将第一个动画和第二个动画结合起来，所以一切都按顺序进行。</p><p id="dd90" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击查看setupLoadingStart()方法<a class="ae kv" href="https://gist.github.com/karishmaagr/40d59f40837e92394cbd7a39f249a72b" rel="noopener ugc nofollow" target="_blank">的完整代码。</a></p><p id="0c66" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第五步:</strong>设置所有三种状态的加载动画。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="75eb" class="jx jy hi jt b fi jz ka l kb kc">private fun setupLoadingStart(<br/>    view: View, //included progress bar view in main xml<br/>    icon: Icon?, //icon  data<br/>    text1: TextView,<br/>    text2: TextView,<br/>    animate: Boolean = true,<br/>    combine: (() -&gt; Unit)? = null // next animation<br/>)</span></pre><p id="576b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以对于<code class="du kg kh ki jt b">combine</code>参数，我们将在第一个动画参数中传递第二个加载动画，在第二个动画结束中传递第三个加载动画。</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="3719" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，当第三个动画结束时，我们将展示您可以在下面看到的结束动画。</p><p id="fc04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第六步:</strong>结束动画，水平向上移动图标，隐藏标题。</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div class="er es kk"><img src="../Images/91801852b173f2a15bcb98929d72c752.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*lEjALS2gL8LdHwsQ2fAUgw.gif"/></div></figure><p id="32b0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">隐藏现有布局中的文本。</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="2350" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">克隆一个包含新结尾布局的新布局。</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="c529" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用新布局更改<code class="du kg kh ki jt b">cl_ob_loading</code>约束集，并使用以下代码显示过渡。</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="9850" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击查看主活动<a class="ae kv" href="https://gist.github.com/karishmaagr/3951280e309f1b06595ab1c09fee97e8" rel="noopener ugc nofollow" target="_blank">的完整代码。</a></p><p id="3f0a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">太棒了。我们做到了。</p><p id="6994" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">制作酷炫动画的基本就是把它分成块，一步一步实现。总是阅读市场上的新东西，所以也许你试图用旧方法实现的东西很复杂，但是新东西用更少的代码就更容易。</p><h1 id="9532" class="kw jy hi bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">提高代码质量的事情</h1><ol class=""><li id="40d4" class="kl km hi is b it lt ix lu jb lv jf lw jj lx jn kq kr ks kt bi translated">我用XML对值进行了硬编码，只是为了把它写在一个文件中。但是你从来不这样做，总是使用diff资源文件来访问它，所以你可以在多个地方重用它，也可以很容易地进行更改。</li><li id="7990" class="kl km hi is b it ly ix lz jb ma jf mb jj mc jn kq kr ks kt bi translated">基本的业务逻辑可以有测试。</li><li id="43b0" class="kl km hi is b it ly ix lz jb ma jf mb jj mc jn kq kr ks kt bi translated">您也可以编写UI测试。</li><li id="7bf5" class="kl km hi is b it ly ix lz jb ma jf mb jj mc jn kq kr ks kt bi translated">不要把所有的动画代码都放在主活动中，而是使用抽象。我们做到了。</li></ol><p id="655c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有没有其他想法实现同一个动画哪个更好？除此之外，你还能如何解决UI组件可重用性和代码优化的问题？如果有，请在评论区与我们分享。你也可以在karishma.agr1996@gmail.com给我回信。如果您有任何疑问，同样的 也适用。</p></div><div class="ab cl md me gp mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="hb hc hd he hf"><p id="5360" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢您的阅读。👏我希望这篇文章对你有所帮助。非常感谢你的鼓掌帮助其他人找到这篇文章😃。</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div class="er es kk"><img src="../Images/93f276c8639ee62785ca59eabf786703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*7FznL4GA-l-RZgAM.gif"/></div></figure></div></div>    
</body>
</html>