<html>
<head>
<title>Helm — Advanced Commands</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Helm —高级命令</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/helm-advanced-commands-9365097475b?source=collection_archive---------3-----------------------#2022-10-13">https://medium.com/geekculture/helm-advanced-commands-9365097475b?source=collection_archive---------3-----------------------#2022-10-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="34c0" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">舵的一些高级命令</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/ef6ea51e3acac0795795b7822a88465c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wzqjRqAlMOjlwt7x"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@mattartz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Matt Artz</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4635" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">上一篇:</strong> <a class="ae jn" href="https://faun.pub/helm-in-action-652abc10aa1c" rel="noopener ugc nofollow" target="_blank">掌舵——在行动</a></p><h2 id="9ff6" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">头盔-生成-名称</h2><p id="83fb" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">我们可以使用<strong class="jq hj"> —生成名称</strong>标志在舵图安装过程中自动生成发布名称</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="d473" class="kk kl hi ll b fi lp lq l lr ls"><strong class="ll hj">&gt;&gt;</strong> helm install bitnami/tomcat <strong class="ll hj">--generate-name</strong></span></pre><p id="cbc7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们还可以提供一个名称模板，用于在安装过程中生成发布名称</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="5c16" class="kk kl hi ll b fi lp lq l lr ls"><strong class="ll hj">&gt;&gt;</strong> helm install bitnami/tomcat --generate-name \<br/>  <strong class="ll hj"> --name-template=</strong>"myserver-{{randNumeric 3}}"</span></pre><p id="41d2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">演示:</strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><h2 id="999c" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">舵-演习</h2><p id="c5ab" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">在使用helm chart创建Kubernetes对象之前，我们可以使用<strong class="jq hj"> <br/> —试运行</strong>命令来检查是否一切正常。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="2aff" class="kk kl hi ll b fi lp lq l lr ls"><strong class="ll hj">&gt;&gt;</strong> helm install tomcat bitnami/tomcat \<br/> --values values_tomcat.yaml<strong class="ll hj"> --dry-run</strong></span></pre><p id="fe41" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">执行上述命令后，它将返回发行说明和helm将发送到kube-API服务器用于创建k8s对象的所有清单文件。在此 查看<a class="ae jn" href="https://gist.github.com/shamimice03/2cd5d60db59a28c0fa0e277ddc43a180" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">的输出。</strong></a></p><h2 id="28b4" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">头盔—模板</h2><p id="a3d3" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">当我们使用— <strong class="jq hj">模拟运行</strong>命令时，我们必须能够访问k8s集群。— <strong class="jq hj">预演</strong>命令将在与k8s集群通信后生成发行说明和模板文件。并且生成的安装和升级的清单文件会完全不同。<strong class="jq hj">试运行</strong>命令的主要目的是在执行之前验证所有必要的配置。但是，如果我们无法访问k8s集群，我们仍然希望生成k8s对象的所有模板文件，这些模板文件将作为helm版本的一部分创建。在那种情况下，我们可以使用<strong class="jq hj">舵模板</strong>命令。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="c488" class="kk kl hi ll b fi lp lq l lr ls">   <strong class="ll hj">helm template [NAME]   [CHART]      [flags]</strong><br/><strong class="ll hj">&gt;&gt;</strong> helm template tomcat bitnami/tomcat --values values_tomcat.yaml</span></pre><p id="42f7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">执行上述命令后，它将生成k8s对象的所有模板文件，这些文件将作为helm版本的一部分创建。在 处查看<a class="ae jn" href="https://gist.github.com/shamimice03/db074769324de0735efcd289c65b8607" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">的输出。</strong></a></p><h2 id="d27e" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">头盔—拿</h2><p id="ae8d" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated"><strong class="jq hj"> helm get </strong>命令由多个子命令组成，可用于获取发布的扩展信息，包括:</p><p id="fffc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">-用于生成发布的值<br/> -生成的清单文件<br/> -发布期间图表生成的注释<br/> -与发布相关联的挂钩</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><h2 id="252f" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">赫尔姆—历史</h2><p id="281a" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated"><strong class="jq hj"> helm history </strong>命令将打印给定版本的所有<strong class="jq hj">历史版本</strong>。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="4ce5" class="kk kl hi ll b fi lp lq l lr ls"><strong class="ll hj">   helm history [RELEASE_NAME]</strong><br/><strong class="ll hj">&gt;&gt;</strong> helm history  tomcat</span></pre><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><h2 id="af0b" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">舵-回滚</h2><p id="e8cb" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">helm的主要优势之一是能够<strong class="jq hj">回滚</strong>到以前的版本。</p><blockquote class="lv lw lx"><p id="31c3" class="jo jp ly jq b jr js ij jt ju jv im jw lz jy jz ka ma kc kd ke mb kg kh ki kj hb bi translated">要查看给定版本的所有历史修订，我们可以使用<strong class="jq hj"> helm history </strong>命令。</p></blockquote><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="e717" class="kk kl hi ll b fi lp lq l lr ls"><strong class="ll hj">   helm rollback &lt;RELEASE&gt; [REVISION]<br/>&gt;&gt;</strong> helm rollback  tomcat    2<br/>--------------------------------------------------------------------<br/>  Rollback was a success! Happy Helming!</span></pre><p id="7ff7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">rollback命令的第一个参数是发布版本的名称，第二个参数是修订(版本)号。如果省略revision参数，它将回滚到以前的版本。例如，如果我们有4个版本，我们忽略了版本号。然后发布将<strong class="jq hj">回滚</strong>到版本3。</p><p id="2d44" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了更好地理解，请参见下面的演示。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><h2 id="7b3c" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">头盔—安装或升级</h2><p id="df12" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">我们可以使用<strong class="jq hj">头盔升级</strong>命令以及<strong class="jq hj">安装</strong>选项。如果给定的版本已经存在于系统中，那么<strong class="jq hj">升级</strong>命令将发生。相反，如果给定的版本不存在，helm <strong class="jq hj"> install </strong>命令将安装该版本。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lt lu l"/></div></figure><h2 id="e3d0" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">头盔—等待和超时</h2><p id="1cc2" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">在舵图的安装过程中，我们可以使用<strong class="jq hj">等待</strong>选项。如果我们在安装/升级过程中指定了<strong class="jq hj"> wait </strong>选项，helm将在将发布标记为成功之前等待，直到部署、状态集或复制集的所有pod、PVC、服务和最小数量的pod都处于<strong class="jq hj">就绪状态</strong>。Helm将等待—超时(默认为5分钟)</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="6681" class="kk kl hi ll b fi lp lq l lr ls"><strong class="ll hj">&gt;&gt;</strong> helm install myserver bitnami/tomcat <strong class="ll hj">--wait</strong></span></pre><p id="f3b8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">除此之外，如果我们想覆盖默认值<strong class="jq hj">(5min)</strong>；我们可以使用<strong class="jq hj">超时</strong>选项和<strong class="jq hj">等待</strong>选项。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="ff20" class="kk kl hi ll b fi lp lq l lr ls"><strong class="ll hj">&gt;&gt;</strong> helm install myserver bitnami/tomcat <strong class="ll hj">--wait</strong> <strong class="ll hj">--timeout 3m30s</strong></span></pre><h2 id="e6a1" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">Helm —原子和超时</h2><p id="83aa" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">之前，我们已经讨论过<strong class="jq hj">等待</strong>选项，如果我们设置<strong class="jq hj">等待</strong>选项，helm将<strong class="jq hj">等待</strong>k8s对象在定义的时间内准备就绪。如果所有相关k8s对象在规定时间内<strong class="jq hj">未处于就绪状态</strong>，安装将被声明为<strong class="jq hj">失败</strong>。为了避免这种情况，我们可以使用— <strong class="jq hj">原子</strong>选项。</p><p id="6996" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果我们在安装时设置了<strong class="jq hj">原子</strong>选项，安装过程会在失败时删除安装。如果使用<strong class="jq hj"> —原子</strong>，将自动设置<strong class="jq hj"> —等待</strong>标志。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="6c67" class="kk kl hi ll b fi lp lq l lr ls"><strong class="ll hj">&gt;&gt;</strong> helm <strong class="ll hj">install </strong>mysvr bitnami/tomcat -f values_tomcat.yaml <strong class="ll hj">-- atomic</strong></span></pre><p id="881f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果我们在升级时设置了— <strong class="jq hj">原子</strong>选项，那么在<strong class="jq hj">升级失败</strong>的情况下，升级过程将<strong class="jq hj">回滚</strong>所做的更改。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="5c8e" class="kk kl hi ll b fi lp lq l lr ls"><strong class="ll hj">&gt;&gt;</strong> helm <strong class="ll hj">upgrade </strong>mysvr bitnami/tomcat -f values_tomcat.yaml <strong class="ll hj">--atomic</strong></span></pre><p id="37cf" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">除此之外，我们可以通过使用— <strong class="jq hj">超时</strong>选项来覆盖默认的<strong class="jq hj">超时</strong>(5分钟)。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="6e1f" class="kk kl hi ll b fi lp lq l lr ls"><strong class="ll hj">&gt;&gt;</strong> helm install mysvr bitnami/tomcat -f values_tomcat.yaml \<br/>  <strong class="ll hj">--atomic</strong> <strong class="ll hj">--timeout 3m30s</strong></span></pre><h2 id="4eec" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">舵-失败时清理</h2><p id="e2ca" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated"><strong class="jq hj">失败时清理</strong>允许在<strong class="jq hj">升级失败</strong>时删除相应升级中创建的新资源。</p><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="e7a9" class="kk kl hi ll b fi lp lq l lr ls"><strong class="ll hj">&gt;&gt;</strong> helm <strong class="ll hj">upgrade </strong>mysvr bitnami/tomcat -f values_tomcat.yaml \<br/><strong class="ll hj">  --cleanup-on-fail</strong></span></pre><h2 id="0d69" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">舵力</h2><p id="0d25" class="pw-post-body-paragraph jo jp hi jq b jr lf ij jt ju lg im jw jx lh jz ka kb li kd ke kf lj kh ki kj hb bi translated">当我们发送一个请求给<strong class="jq hj">升级</strong>一个特定舵图的Kubernetes对象时。Kubernetes将重新启动那些值已更改的pod，而不是所有的pod。但是如果我们想要强制重启某个图表的所有窗格，那么我们可以使用<strong class="jq hj"> — force </strong>命令。Helm将删除当前部署，而不是修改部署，并且将重新创建部署。因此，Kubernetes将删除旧的pod并创建新的pod。</p><blockquote class="lv lw lx"><p id="8e9c" class="jo jp ly jq b jr js ij jt ju jv im jw lz jy jz ka ma kc kd ke mb kg kh ki kj hb bi translated"><strong class="jq hj"> <em class="hi">注意:</em> </strong> <em class="hi">使用</em><strong class="jq hj"><em class="hi">—force</em></strong><em class="hi">标志连同</em> <strong class="jq hj"> <em class="hi">升级</em> </strong> <em class="hi">命令会有一些停机时间。</em></p></blockquote><pre class="iy iz ja jb fd lk ll lm ln aw lo bi"><span id="e86e" class="kk kl hi ll b fi lp lq l lr ls"><strong class="ll hj">&gt;&gt;</strong> helm <strong class="ll hj">upgrade </strong>mysvr bitnami/tomcat -f values_tomcat.yaml <strong class="ll hj">--force</strong></span></pre></div><div class="ab cl mc md gp me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hb hc hd he hf"><h2 id="8144" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">接下来—</h2><div class="mj mk ez fb ml mm"><a href="https://faun.pub/helm-create-your-first-chart-f3aa304c3544" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab dw"><div class="mo ab mp cl cj mq"><h2 class="bd hj fi z dy mr ea eb ms ed ef hh bi translated">Helm —创建您的第一个图表</h2><div class="mt l"><h3 class="bd b fi z dy mr ea eb ms ed ef dx translated">创建新图表</h3></div><div class="mu l"><p class="bd b fp z dy mr ea eb ms ed ef dx translated">faun.pub</p></div></div><div class="mv l"><div class="mw l mx my mz mv na jh mm"/></div></div></a></div></div><div class="ab cl mc md gp me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hb hc hd he hf"><blockquote class="lv lw lx"><p id="7db6" class="jo jp ly jq b jr js ij jt ju jv im jw lz jy jz ka ma kc kd ke mb kg kh ki kj hb bi translated">如果你觉得这篇文章有帮助，请不要忘记点击<strong class="jq hj">按钮</strong>和<strong class="jq hj">按钮</strong>来帮助我写更多这样的文章。<br/> <strong class="jq hj"> <em class="hi">谢谢🖤 </em> </strong></p></blockquote></div><div class="ab cl mc md gp me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hb hc hd he hf"><h2 id="9f67" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated"><strong class="ak">参考文献</strong></h2><div class="mj mk ez fb ml mm"><a href="https://helm.sh/docs/helm/helm/" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab dw"><div class="mo ab mp cl cj mq"><h2 class="bd hj fi z dy mr ea eb ms ed ef hh bi translated">舵</h2><div class="mt l"><h3 class="bd b fi z dy mr ea eb ms ed ef dx translated">Kubernetes的头盔包装经理。Kubernetes软件包管理器对头盔的常见操作:头盔搜索:搜索…</h3></div><div class="mu l"><p class="bd b fp z dy mr ea eb ms ed ef dx translated">helm.sh</p></div></div><div class="mv l"><div class="nb l mx my mz mv na jh mm"/></div></div></a></div></div></div>    
</body>
</html>