<html>
<head>
<title>How to (Part 1 — Revised): Swap Registration Flow to a Live View with Phoenix 1.6+</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">How to(第1部分—修订版):使用Phoenix 1.6+将注册流程切换到实时视图</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-part-1-revised-swap-registration-flow-to-a-live-view-with-phoenix-1-6-47c24d7d671a?source=collection_archive---------24-----------------------#2021-09-27">https://medium.com/geekculture/how-to-part-1-revised-swap-registration-flow-to-a-live-view-with-phoenix-1-6-47c24d7d671a?source=collection_archive---------24-----------------------#2021-09-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/aa4aa2acb030d1ce1e833c7e4013c049.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*byGolAkzKQaP6SjleDdcAQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Metamorphic Built to Code screen grab. © 2021 Moss Piglet. All rights reserved.</figcaption></figure><h1 id="04c9" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">背景</h1><p id="f9f3" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">另一个快速更新给所有关注我们系列<a class="ae kq" href="https://coretheory.medium.com" rel="noopener">帖子</a>的人。</p><p id="50a5" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">在<a class="ae kq" rel="noopener" href="/swlh/how-to-swap-registration-flow-to-a-live-view-with-phx-gen-auth-4966f80b412e">的原始帖子</a>中，我们快速地将我们的“死”注册流程更新为“活”注册流程，使用的是Phoenix 1.5+应用程序。</p><p id="6d64" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">嗯，现在<a class="ae kq" href="https://hexdocs.pm/phoenix/Phoenix.html" rel="noopener ugc nofollow" target="_blank">凤凰1.6 </a>正式发布了<a class="ae kq" href="https://hex.pm/packages/phoenix" rel="noopener ugc nofollow" target="_blank">可用</a>(太棒了)，所以我想把这个帖子和我们的<a class="ae kq" rel="noopener" href="/geekculture/how-to-part-2-revised-swap-registration-flow-to-a-live-view-with-phx-gen-auth-multi-step-47172904b00a">第二部分修订后的</a>帖子一起更新。</p><p id="8b0f" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">如果你没有使用Phoenix 1.6+，那么跳到我的<a class="ae kq" rel="noopener" href="/swlh/how-to-swap-registration-flow-to-a-live-view-with-phx-gen-auth-4966f80b412e">原始帖子</a>来看看如何轻松地将你的注册流程切换到实时视图流程。</p><p id="a73b" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated"><strong class="ju hj">请注意:如果你已经熟悉了</strong> <a class="ae kq" rel="noopener" href="/swlh/how-to-swap-registration-flow-to-a-live-view-with-phx-gen-auth-4966f80b412e"> <strong class="ju hj">原文</strong> </a> <strong class="ju hj">，那么这篇文章将会发挥最大的作用。</strong></p><p id="2542" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">说到这里，让我们开始吧:</p><h1 id="3076" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">先决条件</h1><p id="0f24" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">在这个快速教程中，我们假设如下:</p><ul class=""><li id="b85e" class="kw kx hi ju b jv kr jz ks kd ky kh kz kl la kp lb lc ld le bi translated">你已经阅读/跟随了<a class="ae kq" rel="noopener" href="/swlh/how-to-swap-registration-flow-to-a-live-view-with-phx-gen-auth-4966f80b412e">的原帖</a></li><li id="adf5" class="kw kx hi ju b jv lf jz lg kd lh kh li kl lj kp lb lc ld le bi translated">你已经有了一个带有<em class="lk"> live </em>生成器的工作Elixir/Phoenix应用程序设置(或者添加适当的代码——参见<a class="ae kq" href="https://hexdocs.pm/phoenix_live_view/installation.html#content" rel="noopener ugc nofollow" target="_blank">文档</a>)。</li><li id="d1d1" class="kw kx hi ju b jv lf jz lg kd lh kh li kl lj kp lb lc ld le bi translated">你跑过<code class="du ll lm ln lo b">mix phx.gen.auth Accounts Person people</code>(可以用其他名字代替，我只是更愿意把<a class="ae kq" href="https://metamorphic.app" rel="noopener ugc nofollow" target="_blank">变态</a>上的客户当人看)。</li><li id="c0e7" class="kw kx hi ju b jv lf jz lg kd lh kh li kl lj kp lb lc ld le bi translated">可选:您已经用<a class="ae kq" href="https://github.com/thoughtbot/bamboo" rel="noopener ugc nofollow" target="_blank"> Bamboo </a>设置了电子邮件确认(Phoenix 1.6+实际上开箱时内置了<a class="ae kq" href="https://github.com/swoosh/swoosh" rel="noopener ugc nofollow" target="_blank"> Swoosh </a>，因此如果您想使用Bamboo，您可能需要运行<code class="du ll lm ln lo b">--no-mailer</code> <a class="ae kq" href="https://hexdocs.pm/phoenix/Mix.Tasks.Phx.New.html" rel="noopener ugc nofollow" target="_blank">标志</a>并单独配置)</li></ul><p id="f658" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">好的，我们将在我们的<a class="ae kq" rel="noopener" href="/swlh/how-to-swap-registration-flow-to-a-live-view-with-phx-gen-auth-4966f80b412e">原始帖子</a>的结尾开始，将我们已经工作的实时视图注册流程过渡到新的<code class="du ll lm ln lo b">~H</code> sigil，并简化一切。</p><p id="2212" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">我们走吧！</p><h1 id="61a3" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">第一步</h1><p id="2ad6" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">我们最后一次离开我们的<code class="du ll lm ln lo b">your_app_web/person_registration_live/new.ex</code>文件是这样的:</p><figure class="lp lq lr ls fd ij"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="4652" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">目前，这个文件正在调用<code class="du ll lm ln lo b">render/1</code>函数并渲染我们位于<code class="du ll lm ln lo b">your_app_web/templates/person_registration/new.html.leex</code>的单独的<code class="du ll lm ln lo b">.leex</code>文件。</p><p id="a161" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">我们将更新这个<code class="du ll lm ln lo b">render/1</code>函数，这样我们就不再需要单独的模板文件(让它与新的<code class="du ll lm ln lo b">.heex </code>语法一起工作)，然后一旦我们确信一切都正常工作，就删除那个文件。</p><p id="b791" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">让我们继续:</p><figure class="lp lq lr ls fd ij"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="139a" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">就是这样！这里值得注意的是我们更新的<code class="du ll lm ln lo b">render/1</code>功能:</p><ul class=""><li id="ea45" class="kw kx hi ju b jv kr jz ks kd ky kh kz kl la kp lb lc ld le bi translated"><code class="du ll lm ln lo b">~H</code>符号格式化(取代旧版本Phoenix和实时视图中的<code class="du ll lm ln lo b">~L</code>符号)</li><li id="37fe" class="kw kx hi ju b jv lf jz lg kd lh kh li kl lj kp lb lc ld le bi translated">根据上面的注释，在我们的模板中调用表单函数的语法现在是<code class="du ll lm ln lo b">&lt;.form let={f} for={@changeset} url="#" phx_change="validate" phx_save="submit"&gt;</code>并用<code class="du ll lm ln lo b">&lt;/.form&gt;</code>语法关闭表单。这种语法更清楚地表明，您实际上是在调用一个名为“form”的函数。</li><li id="cca6" class="kw kx hi ju b jv lf jz lg kd lh kh li kl lj kp lb lc ld le bi translated"><code class="du ll lm ln lo b">phx_hook="SavedForm"</code>是一个可选的例子，如果你不打算通过<a class="ae kq" href="https://hexdocs.pm/phoenix_live_view/js-interop.html#client-hooks" rel="noopener ugc nofollow" target="_blank"> JavaScript互用性文档</a>实现任何JavaScript挂钩，你可以删除它。</li></ul><p id="79a7" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">一旦你确信一切都如你所愿，你就可以删除你的旧模板文件<code class="du ll lm ln lo b">your_app_web/templates/person_registration/new.html.leex</code>。</p><h1 id="be9d" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">结论</h1><p id="2351" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">你做到了！</p><p id="bc15" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">如果你已经关注了我们的<a class="ae kq" rel="noopener" href="/swlh/how-to-swap-registration-flow-to-a-live-view-with-phx-gen-auth-4966f80b412e">原始帖子</a>和现在的这篇，那么你已经成功地将你的注册流程切换到了Phoenix 1.6+或Live View 0.16+的实时视图流程。</p><p id="35fe" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">现在，当你继续在<a class="ae kq" rel="noopener" href="/geekculture/how-to-part-2-revised-swap-registration-flow-to-a-live-view-with-phx-gen-auth-multi-step-47172904b00a">第二部分修订版</a>中实现多步表单时，你可以加快速度，因为你已经熟悉了大多数<code class="du ll lm ln lo b">~H</code> sigil语法。</p><p id="9925" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">同样，如果您仍然需要对<code class="du ll lm ln lo b">~L </code>符号的支持(旧的Phoenix或Live View版本)，或者对此感到好奇，那么您仍然可以使用我们的<a class="ae kq" rel="noopener" href="/p/how-to-part-2-swap-registration-flow-to-a-live-view-with-phx-gen-auth-multi-step-form-25371540fce1">原始第2部分</a>实现多步表单。</p><p id="0cdd" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">感谢跟随，我希望你享受你的凤凰1.6+和药剂之旅。</p><p id="2f73" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">永远接受改进和想法。</p><h1 id="91b3" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">插头</h1><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/5bdf344d879a15b8d389bfe559b66bf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qAxIkJKh29rFPnwX2Vwb2w.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Switch to Metamorphic! © 2021 Moss Piglet. All rights reserved.</figcaption></figure><p id="ad3d" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">如果你还没看的话，<a class="ae kq" href="https://metamorphic.app" rel="noopener ugc nofollow" target="_blank">变形</a>现已上线，并接受我们早期接入发布的注册。</p><p id="32d0" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">谢谢大家，敬请期待！</p><p id="2c53" class="pw-post-body-paragraph js jt hi ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp hb bi translated">❤·马克</p></div></div>    
</body>
</html>