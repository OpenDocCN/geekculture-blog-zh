<html>
<head>
<title>Build Your Own Flutter Plugin Using Android Native Kotlin — Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Android原生Kotlin构建你自己的Flutter插件——第一部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/build-your-own-flutter-plugin-for-android-native-kotlin-part-i-daed88eb706e?source=collection_archive---------25-----------------------#2021-05-27">https://medium.com/geekculture/build-your-own-flutter-plugin-for-android-native-kotlin-part-i-daed88eb706e?source=collection_archive---------25-----------------------#2021-05-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9658" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本教程是本教程的<strong class="ih hj"> Kotlin </strong>版本:<a class="ae jd" href="https://codelabs.developers.google.com/codelabs/write-flutter-plugin#0" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">如何编写一个颤振插件</strong> </a>来自<a class="ae jd" href="https://codelabs.developers.google.com/" rel="noopener ugc nofollow" target="_blank"> Google开发者Colabs </a>。(原教程是用JAVA写的。)</p><p id="9848" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本教程的G <strong class="ih hj"> <em class="je"> oal </em> </strong>是通过:</p><ul class=""><li id="5652" class="jf jg hi ih b ii ij im in iq jh iu ji iy jj jc jk jl jm jn bi translated">什么时候需要一个<strong class="ih hj"> Flutter插件</strong>项目。</li><li id="423b" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc jk jl jm jn bi translated">Flutter如何与Kotlin 中的<strong class="ih hj"> Android原生代码/库进行通信。(iOS替代方案阅读原教程)。</strong></li><li id="f759" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc jk jl jm jn bi translated">如何用<strong class="ih hj"> IntelliJ IDEA </strong>从头开始配置一个Flutter插件项目？</li><li id="d39d" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc jk jl jm jn bi translated">遵循原教程构建一个使用Android原生库的<strong class="ih hj"> MIDI键盘</strong>(带<em class="je"> Flutter前端</em>)的示例app:<strong class="ih hj">Android . media</strong>(带<em class="je"> Kotlin </em>)通过<strong class="ih hj"> Flutter插件API </strong>(带<em class="je"> Dart </em>)你将构建。</li></ul><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/0c71245b914cd4e908b9a4506bdb4330.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GSvmUSd2eRXYDxZvaxFBIg.png"/></div></div></figure></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="eea3" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">什么时候需要一个Flutter插件项目？</h1><p id="0938" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated"><strong class="ih hj">颤振插件</strong>是颤振开发中的高级课题。很多开发者在他们的Flutter开发中并不需要构建Flutter插件。但是，如果您想要执行以下任务，您可能需要一个:</p><ul class=""><li id="66a1" class="jf jg hi ih b ii ij im in iq jh iu ji iy jj jc jk jl jm jn bi translated">如果你想构建一个Flutter <strong class="ih hj"> API </strong>供其他Flutter项目使用，</li><li id="f380" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc jk jl jm jn bi translated">和/或通过这样的API，你使Flutter能够与<strong class="ih hj"> <em class="je">平台特定的</em> </strong> <strong class="ih hj">原生</strong>代码(例如Android的JAVA或Kotlin，iOS的Objective-C或Swift)进行通信。</li></ul><h1 id="85bb" class="km kn hi bd ko kp lp kr ks kt lq kv kw kx lr kz la lb ls ld le lf lt lh li lj bi translated">Flutter是如何工作的？</h1><p id="550e" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">在我们开始教程之前，我们需要一个关于Flutter一般是如何工作的介绍。Flutter是一个<strong class="ih hj">跨平台</strong>开发框架，它允许你用一个代码库为不同的平台，即Android、iOS或Web(另见<a class="ae jd" href="https://flutter.dev/docs/development/tools/sdk/release-notes/supported-platforms" rel="noopener ugc nofollow" target="_blank">支持的平台</a>)构建UI。Flutter是用<a class="ae jd" href="https://dart.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Dart </strong> </a>语言编写的，它负责不同平台的底层集成，因此您不需要为同一个应用程序构建单独的开发，例如，为iOS使用Swift，为Android使用Kotlin/JAVA。</p><p id="3f98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">听起来很棒，不是吗？由于<strong class="ih hj"> Flutter </strong>是一个框架，<strong class="ih hj"> <em class="je">包装</em> </strong>原生Android和iOS平台特定代码，使这种集成成为可能，因此有一个<strong class="ih hj"> <em class="je">中间Dart层</em> </strong>处理&lt; Flutter与Android原生&gt;或&lt; Flutter与iOS原生&gt;之间的通信。换句话说，如果你不需要Android或者iOS <strong class="ih hj"> <em class="je">的原生库</em> </strong>来实现你的任务，那么你甚至不需要担心这个。</p><p id="7a76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">颤振框架的<strong class="ih hj">架构如图<a class="ae jd" href="https://flutter.dev/docs/resources/architectural-overview" rel="noopener ugc nofollow" target="_blank">所示</a>:</strong></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lu"><img src="../Images/63fb5c4dd6213a3f4f83a0d68d7906ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aEfb6EN-v9LmtuHflcs0-Q.png"/></div></div></figure><p id="7fdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">顶层</strong>(绿色)是<em class="je"> Dart </em>中的通用UI/UX框架，<strong class="ih hj">底层</strong>(黄色)是特定于平台的嵌入层，包括<em class="je">原生插件</em>，可以用Android的Kotlin/JAVA或iOS的Swift/Objective-C等导入。然后，<strong class="ih hj"> <em class="je">平台通道</em> </strong>，位于<strong class="ih hj">中间层次</strong>(蓝色)，负责<strong class="ih hj"><em class="je"/></strong>顶层(Dart)和底层(平台特定的本机代码)之间的通信。</p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="ebc2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">平台通道的<strong class="ih hj">架构如图所示:</strong></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lv"><img src="../Images/f6d145bf728917a38f4ce66332bf0e5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hLU0owMHrpBIhfkQhJ0HgA.png"/></div></div></figure><p id="33ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="je">方法通道</em> </strong>管理Flutter应用客户端和iOS /Android主机之间特定于平台的通信，因此用户可以编写<strong class="ih hj"> AppDelegate </strong> (iOS)或<strong class="ih hj"> Activity </strong> (Android)类来与本机API进行交互。</p><p id="79c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于一个Flutter插件项目，我们将<strong class="ih hj">用我们自己的类</strong>替换绿框，以便:(1)处理方法调用，以及(2)定义每个方法的行为。</p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="70b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本教程将从头到脚指导你构建这样一个<strong class="ih hj"> Flutter插件</strong>，它将具有:</p><ol class=""><li id="fd05" class="jf jg hi ih b ii ij im in iq jh iu ji iy jj jc lw jl jm jn bi translated"><strong class="ih hj"> PianoPlugin类</strong>(用Kotlin编写):<br/>作为<strong class="ih hj"> <em class="je">工厂</em> </strong>，即MethodChannel，处理来自Flutter的方法调用，然后调用Synth类中相应的方法，并将结果返回给Flutter。</li><li id="8194" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc lw jl jm jn bi translated"><strong class="ih hj"> Synth类</strong>(用Kotlin编写):<br/>有调用<strong class="ih hj"> <em class="je"> Android原生API</em></strong>生成MIDI声音的实际实现。</li><li id="ce20" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc lw jl jm jn bi translated"><strong class="ih hj">Flutter API</strong>(Dart编写):<br/>提供<strong class="ih hj"> <em class="je"> Flutter接口</em> </strong>供你的客户端调用插件方法。</li><li id="2653" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc lw jl jm jn bi translated"><strong class="ih hj"> Demo app ( </strong>用Dart编写):<br/>最后我们会用<strong class="ih hj"> <em class="je"> Flutter UI </em> </strong>构建键盘布局，每次按键都会<strong class="ih hj"> <em class="je">调用Flutter API中的</em> </strong>方法来创建声音。换句话说，这是一个展示如何使用你的API的<strong class="ih hj"> <em class="je"> Flutter客户端</em> </strong>。</li></ol><p id="7fdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们开始吧！</p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="925c" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">在IntelliJ IDEA中创建一个Flutter插件项目</h1><p id="bce8" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">在IntelliJ中，单击文件&gt;新建&gt;项目&gt;颤动:</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lx"><img src="../Images/b35862e24bb0e7fda55e18092850a890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0NoZYTF4idlC4422WfD0Nw.png"/></div></div></figure><p id="9cbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，选择您的<code class="du ly lz ma mb b">project name</code>，在<code class="du ly lz ma mb b">Project type</code>下拉列表中，选择<code class="du ly lz ma mb b">Plugin</code>。在这个演示中，<code class="du ly lz ma mb b">Kotlin</code>将被用作Android语言，并且只展示<code class="du ly lz ma mb b">Android</code>平台。</p><p id="0ce4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您也可以将<code class="du ly lz ma mb b">Organization</code>更改为您喜欢的域名，例如，您可以将其更改为“magicmidi.com”。请注意，它必须是一个点分割的形式，这将成为你的原生插件包的前缀名称。这里，我们就让它保持原样吧。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mc"><img src="../Images/4568737b1313297684606a88e90882e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q7PHMGYhOTNwhRTDXaEQYQ.png"/></div></div></figure><p id="5c9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击“完成”，Flutter会为你创建一个模板插件项目。</p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="b8cf" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">项目结构解释</h1><p id="5fad" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">在您刚刚创建的新插件项目中，您将看到3个高级包:<code class="du ly lz ma mb b">android</code>、<code class="du ly lz ma mb b">example</code>、<code class="du ly lz ma mb b">lib</code></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es md"><img src="../Images/694d86998461c6b059cdab354e71ea77.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*z2l-2K7cS1iwGXbBNTOvzQ.png"/></div></figure><p id="f256" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">安卓</strong></p><p id="eccb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有的<strong class="ih hj"> <em class="je">原生Android代码</em> </strong>(即Kotlin)都到这个模块中，因此我们的<strong class="ih hj"> PianoPlugin </strong>类和<strong class="ih hj"> Synth </strong>类将位于<code class="du ly lz ma mb b">android &gt; src.main &gt; $your-native-package-name &gt;</code>下</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es me"><img src="../Images/7b6c4c45df4e9e02c24767c2b9aad1d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*zEGsrT43V0InauDckLhAMA.png"/></div></figure><p id="cfa5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> lib </strong></p><p id="3063" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在常规的颤振项目中，<code class="du ly lz ma mb b">lib</code>是<code class="du ly lz ma mb b">main.dart</code>所在的位置(即应用程序开始的位置)。但是因为现在我们正在构建一个“插件”而不是一个实际的应用程序，所以<code class="du ly lz ma mb b">piano.dart</code>是一个<strong class="ih hj"> Flutter API </strong>，它可以被一个Flutter应用程序调用。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es mf"><img src="../Images/bb72a27e6bdb3d6833f069644666343f.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*kkHnb65hBqjf6JqDQCt0ZQ.png"/></div></figure><p id="a78d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">示例</strong></p><p id="97d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个功能完整的演示程序<strong class="ih hj"> Flutter app </strong>，它包括UI，以及展示如何在<code class="du ly lz ma mb b">piano.dart</code>中调用Flutter API的相关函数。你会发现一个<code class="du ly lz ma mb b">main.dart</code>作为演示app的切入点。当您运行模拟器时，这是虚拟手机上显示的实际应用程序。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es mg"><img src="../Images/8a506cd8ebabd3d14939f541526867b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*SN5OYE2zPhZ8o2IH9kHvzA.png"/></div></figure></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="039d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本教程的第二部分中，我将把实际的Kotlin和Dart代码共享到上述文件中，以实现这个API。</p></div></div>    
</body>
</html>