<html>
<head>
<title>SignUp/Login Application With NodeJs, Express, and MongoDB (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用NodeJs、Express和MongoDB注册/登录应用程序(第1部分)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/signup-login-application-with-nodejs-express-and-mongodb-658498e580cf?source=collection_archive---------0-----------------------#2021-03-25">https://medium.com/geekculture/signup-login-application-with-nodejs-express-and-mongodb-658498e580cf?source=collection_archive---------0-----------------------#2021-03-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4d3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将讲述如何用NodeJs和MongoDB创建一个注册项目。我们开始吧。</p><p id="ec4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将使用Visual Studio代码作为编译器。在这个项目中，我们需要一个package.json文件。为此，在终端中，我们将编写</p><p id="5085" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> npm初始化</strong></p><p id="3777" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">命令。在这个命令之后，为了填充我们的package.json，它需要一些信息。我让它保持原样，然后按回车。我只需要在package.json文件中，将“main”:“index . js”文件改为“server.js”。</p><p id="e2d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">比用<strong class="ih hj"> npm安装Express dotenv </strong>命令将构建Express和dotenv模块。所以这个命令创建node_modules和包锁. json文件。</p><p id="db78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，我编写<strong class="ih hj"> npm install -D nodemon </strong>并安装nodemon。</p><p id="bfd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的模块，见package.json文件的“依赖”部分。我需要对这个文件做一些修改。在文件的“脚本”部分，我将“测试”改为“启动”，并编写<strong class="ih hj">:“节点服务器”</strong>。因此，当我写npm start时，我们的服务器启动。我这样写<strong class="ih hj">“dev”:“nodemon server”</strong>。</p><p id="511e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在主文件夹中，我将创建server.js文件。这个文件将是我们后端部分的主文件。比我要求的还要快。之后，我将创建Config文件夹，并在这个文件夹Config . env . Config . env中，只写PORT=5000，因为这个端口是我们服务器的运行端口。</p><p id="297d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以我们可以转到server.js文件。我将需要带有<strong class="ih hj"> dotenv.config({path:')的env变量。/config/config.env'}) </strong>。</p><p id="183e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我创建名为app的变量，并使用Express方法，然后用另一个名为PORT的变量写服务器的运行端口。</p><p id="2962" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，在app.listen()中，我将给出端口信息，并在console.log中写入“服务器在${PORT}上运行”。它动态地获取端口信息。</p><p id="2d4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的server.js文件如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/154000245a588c5935e1b7e89088dbf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*9fu2-S_35hG9nxyCYF5dbw.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">server.js</figcaption></figure><p id="7466" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我会写<strong class="ih hj"> npm run dev </strong>并且服务器正在运行。</p><p id="f72b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们需要邮递员。在Postman中，我将创建一个请求并写入服务器的运行地址。在本教程中，我将使用<a class="ae jp" href="http://localhost/5000" rel="noopener ugc nofollow" target="_blank"> http://localhost/5000 </a>。</p><p id="0294" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将转到server.js文件并在Express中使用get方法。用app变量我来写</p><p id="5dee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">app.get('/'，(req，res) =&gt; {</p><p id="618e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">研究现状(200)。json({success: true，msg:“显示所有用户”})；</p><p id="e4e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">});</p><p id="d71c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">。我将使用npm运行服务器，运行dev并转到Postman。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/7a20a196eb097535395c55ae2bff7880.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*6bPRHbaO5QTlQUfvQS4MiQ.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">Postman</figcaption></figure><p id="8db3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这意味着，我们的代码就是成功。就像那样，我们也要写另一个方法。所有方法看起来都像:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/b07c074bf0fd2135cc0264fc46c658eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*-pywifc4dZrdsEMtdQMEKw.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">server.js</figcaption></figure><p id="0463" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">带有/:id的方法的工作方式类似于<a class="ae jp" href="http://localhost:5000/1" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/1</a>，其他类似于<a class="ae jp" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000 </a>。</p><p id="1446" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我运行了server.js中的每一个方法，但都不是真的。因此，我在这个user.js文件中创建了controllers文件夹，并移动了所有方法，做了一些更改。user.js文件如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/2f21a365870518a3cc47a88857cc9507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*9uuFhXzJaeUFtSpaWnD6lw.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">routers/user.js</figcaption></figure><p id="c546" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了更新我们的项目，我们必须将routes/user.js中的代码移动到controllers/user.js文件中，并在第一个文件中做一些更改。你可以在server.js中运行任何东西，但是如果你的项目比这个项目更复杂，你必须做些改变。</p><p id="2d03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">controllers/user.js文件如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/f3663f8e63b4d7d152f3d74ae8bad281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*Mr2Pg9v-yRZtNS2pYjSl2A.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">controllers/user.js</figcaption></figure><p id="f62a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，我们将如何处理routes/users.js文件呢？首先，我们删除这个文件中的方法。我们需要controllers/users.js文件，第一个users.js文件包含这些方法。</p><p id="031f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">常数{</p><p id="4faf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">getUser，</p><p id="fc61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">获取用户，</p><p id="4ded" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建用户，</p><p id="f464" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新用户，</p><p id="8b4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除用户</p><p id="397b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">} =要求('../控制器/用户’)</p><p id="009b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">routes/users.js文件如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/962757def6eb616f74a5d46ac85f59be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*INTPfRUDw6jzgaJ9-mUxmA.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">routes/users.js</figcaption></figure><p id="98c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们回到server.js文件，因为我们的发送请求似乎在控制台中。为此，我们创建了一个名为middlewares的文件夹，其中包含一个名为logger.js的文件。该文件包含以下代码:</p><p id="bd77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Const logger = (req，res，next) =&gt; {</p><p id="8b15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">console . log(`$ { req . method } $ { req . protocol }://$ { req . get(' host ')} $ { req . priginalurl } `)</p><p id="e2ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">next()；</p><p id="a993" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="7414" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">req.methods是(get，put..)，req.protocol是http，req.get('host ')是localhost，req.originalUrl是/ part。在server.js文件中，我们编写app.use(logger)并使用这个中间件。如果你回到邮递员身边</p><p id="e0c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">，发送请求，您可以在终端中看到方法和url。</p><p id="038f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以我们必须连接数据库。在本教程中，我们将使用MongoDB。为此，我们将在MongoDB中创建一个帐户，生成一个数据库，安装MongoDB Compass，复制连接字符串。连接字符串是这样的:</p><p id="aa20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">MongoDB+SRV://<username>:<password>@ cluster 0 . fxdx . MongoDB . net/test</password></username></p><p id="eea1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们更换<username>、<password>和测试零件。Test将是我们数据库的名称，所以您可以根据需要给它起一个名字。</password></username></p><p id="26e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成这些设置后，我们就可以连接数据库了。</p><p id="bf05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">NPM install mongose命令将安装整个软件包。我们将创建config文件夹，并在其中创建db.js文件。我们将转到config.env文件，创建MONGO_URI变量，复制连接字符串。db.js文件类似于:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/aae6ccdaa58f4388d8b1470e1e941499.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*Ly9CYEMOy8xq36jH1k9QuA.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">config/config.env</figcaption></figure><p id="5254" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个文件之后，我们将转到server.js，因为我们需要db.js文件。</p><p id="96c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const connectDB = require('。/config/db ')</p><p id="c13b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">connectDB()将连接到数据库。在终端中，您可以看到MongoDB已连接。</p><p id="aae8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们可以生成我们的模型。我们将创建一个名为models的文件夹，并在其中包含User.js文件。你可以随心所欲地改变。我是这样创作的:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jq"><img src="../Images/a98a4c2e22f40adc52261bb0629842b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*5L_M65UPx4zDycEt9ZU-PQ.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">models/User.js</figcaption></figure><p id="c596" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们必须创建用户。对于这个方法，我们将在Postman中做一些修改。首先，我们将转到Headers部分，在预置里面点击JSON内容类型。我们将单击身体部位的原始选项。所以我们可以向数据库请求数据。在此之前，MongoDB罗盘看起来是这样的:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jr"><img src="../Images/eafe81a74db310bb883fbca12afc6fad.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*TMOQyg-1supxdg1INhR0sQ.png"/></div></figure><p id="aa6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将转到controllers/user.js，将createUser函数更改为:</p><p id="1b83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">exports.createUser = async (req，res，next) =&gt; {</p><p id="b14a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const user = await user . create(req . body)</p><p id="7a0b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据现状(201)。json({</p><p id="e6cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">成功:真的，</p><p id="4cb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据:用户</p><p id="ad01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">})</p><p id="5313" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="2487" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将去找邮递员并张贴一个用户。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/0e8da31644b4463bf4da0f02093e4d02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*ugPznkBqRo--lg8foTo7PQ.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es js"><img src="../Images/f9f8b60e11b0612067a478a4ea2e2ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*LJHIkDT1EbB-PaxjKXtotQ.png"/></div></figure><p id="4ae4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经创建了用户，但我想加密密码。为此，<strong class="ih hj"> npm install bcryptjs </strong>将安装bcryptjs包并需要它。然后，我们将在我们的模型下编写以下代码。</p><p id="3e38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">UserSchema.pre('save '，异步函数(next) {</p><p id="dd0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果(！this . is modified(' password '){</p><p id="631d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">next()；</p><p id="5fd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="5675" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const salt = await bcrypt . gen salt(10)；</p><p id="0b13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">this . password = await bcrypt . hash(this . password，salt)；</p><p id="2430" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">)};</p><p id="3d2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，让我们看看如何能得到数据库中的所有记录。</p><p id="3ed7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">exports.getUsers = async (req，res，next) =&gt; {</p><p id="ba37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尝试{</p><p id="8afb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const users = await user . find()；</p><p id="9afb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">研究现状(200)。JSON({成功:真，数据:用户})</p><p id="2ccf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">}catch(err){</p><p id="a715" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">研究现状(400)。json({success: false})</p><p id="c70a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="9625" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="aa87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">getUser函数:</p><p id="cca0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">exports.getUser = async (req，res，next) =&gt; {</p><p id="19bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尝试{</p><p id="fd76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const user = await user . find byid(req . params . id)；</p><p id="7931" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">研究现状(200)。JSON({成功:真，数据:用户})</p><p id="7534" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">} catch (err) {</p><p id="5694" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">研究现状(400)。JSON({ success:false })；</p><p id="f3eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="41bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="bf4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">getUser和getUsers函数的区别在于find()和findById()方法。</p><p id="2936" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了更新用户，我们这样编码:</p><p id="c78d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">exports.updateUser = async (req，res，next) =&gt; {</p><p id="d20b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const user = await user . findbyidandupdate(req . params . id，req.body，{</p><p id="80c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">新:真的，</p><p id="db15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行验证器:真</p><p id="03a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">})</p><p id="03f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果(！用户){</p><p id="bb36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">返回资源状态(400)。json({success: false})</p><p id="f5f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="1acd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">研究现状(200)。JSON({成功:真，数据:用户})</p><p id="db8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="081a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和deleteUser函数:</p><p id="e728" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">exports.deleteUser = async (req，res，next) =&gt; {</p><p id="e8e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尝试{</p><p id="c7d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const user = await user . findbyidanddelete(req . params . id)</p><p id="9cf4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果(！用户){</p><p id="caa0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">返回资源状态(400)。JSON({ success:false })；</p><p id="949f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="37a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">研究现状(200)。json({ success: true，data: {} })</p><p id="b764" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">} catch (err) {</p><p id="6123" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">研究现状(400)。JSON({ success:false })；</p><p id="14f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="e542" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="13d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，让我们看看如何进行验证。首先，我们将创建routes文件夹，并在其中创建一个auth.js文件。像这样，controller/auth.js文件将被创建，我们将转到这个文件。</p><p id="9666" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要文件中的用户模型，如下所示:</p><p id="af06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const User = require('../型号/用户’)</p><p id="09ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，</p><p id="abe6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">exports.register = async (req，res，next) =&gt; {</p><p id="97b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const {名字，姓氏，电子邮件，密码} = req.body</p><p id="e8ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">//创建用户</p><p id="1148" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const user = await User.create({</p><p id="f7cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">名字，</p><p id="3e30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">姓氏，</p><p id="7436" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">电子邮件，</p><p id="2f20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">密码</p><p id="c5bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">})</p><p id="0c0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">研究现状(200)。JSON({成功:真，令牌，id})</p><p id="5ee5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="6bd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将保存该文件，并转到routes/auth.js文件并写入:</p><p id="62f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const express = require('express ')</p><p id="4adb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const { register，login } = require('../控制器/授权’)</p><p id="e8b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将转到server.js文件，并在那里使用。</p><p id="ea8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const auth = require('。/routes/auth ')；</p><p id="d935" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">app.use('/'，auth)；</p><p id="d762" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们去Postman，发布<a class="ae jp" href="http://localhost:5000/register" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/register</a>请求。结果就是成功:没错，这意味着成功了。</p><p id="aa17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用jsonwebtoken进行数据连接。</p><p id="11c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> npm安装jsonwebtoken </strong></p><p id="42a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将安装软件包。在controller/auth.js文件中，在用户要求下，我们将编写</p><p id="0802" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const jwt = require('jsonwebtoken ')</p><p id="ee66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const getSignedJwtToken = id =&gt; {</p><p id="e458" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">返回jwt.sign({id}，process.env.JWT_SECRET，{</p><p id="8fef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">EXPIRE resin:process . env . jwt _ EXPIRE</p><p id="7695" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">})</p><p id="6c89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="420b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们去config.env文件，写JST _秘密=任何东西，JST_EXPIRE= 30d。</p><p id="f6a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同样在controller/auth.js文件中，我们将编写</p><p id="14c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const token = getSignedJwtToken(用户。_ id)；</p><p id="909c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和</p><p id="0633" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">研究现状(200)。json({success: true，token })</p><p id="2c67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，当我们去邮递员那里发送请求时，我们可以看到令牌。复制该令牌并粘贴<a class="ae jp" href="https://jwt.io" rel="noopener ugc nofollow" target="_blank"> https://jwt.io </a>站点，您将在Payload:Data part id下看到。如果你把它与数据库中的进行比较，你会发现它们是一样的。</p><p id="00e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后我们将登录。为了比较密码，我们将再次使用bcryptjs。我们将转到用户模型，并添加新方法:</p><p id="b82b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">user schema . methods . match password = async function(entered password){</p><p id="6f9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">return await bcrypt . compare(entered password，this . password)；</p><p id="4352" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">};</p><p id="f90e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们将转到controllers/auth.js并创建登录。创建名为utils的文件夹和名为ErrorResponse.js的文件，并将以下代码粘贴到其中。</p><p id="ed5d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">类错误响应扩展错误{</p><p id="b115" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">构造函数(消息，状态代码){</p><p id="cffd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">超级(消息)；</p><p id="911d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">this . status code = status code；</p><p id="4acf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Error.captureStackTrace(this，this . constructor)；</p><p id="0a6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="3a56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="511f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">module.exports = ErrorResponse</p><p id="95b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将要求这个文件进入controllers/auth.js并返回登录。</p><p id="1c45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">exports.login = async (req，res，next) =&gt; {</p><p id="76ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const { email，password } = req.body</p><p id="03d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">//验证emil和密码</p><p id="ad48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果(！邮箱||！密码){</p><p id="0a6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">返回next(new ErrorResponse('请提供电子邮件和密码'，400))；</p><p id="9f57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="665e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">//检查用户</p><p id="b014" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const user = await user . find one({ email })。选择('+密码')；</p><p id="e3e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果(！用户){</p><p id="7f6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">返回next(新的ErrorResponse('无效凭据'，401))；</p><p id="0cd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="0318" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">//检查密码是否匹配</p><p id="4c96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const is match = await user . match password(密码)；</p><p id="a7ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果(！isMatch) {</p><p id="1bda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">返回next(新的ErrorResponse('无效凭据'，401))；</p><p id="151c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="5ae5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const token = user . getsignedjwttoken()；</p><p id="9065" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">const id = user . getid()；</p><p id="c5c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">研究现状(200)。JSON({成功:真，令牌，id})</p><p id="0c92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">}</p><p id="5af0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们向Postman发送登录请求时，我们可以看到成功:true、token和id。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/347e4fa3eda16dc5f3404c9b26a0d9f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*389Df5VTdiBJeLhSjX3IaQ.png"/></div></figure><p id="7216" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是本教程的最后一点。感谢阅读！</p></div></div>    
</body>
</html>