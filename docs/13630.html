<html>
<head>
<title>Scraping a Dynamic Website, Without Selenium, Part-I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">抓取动态网站，没有硒，第一部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/scraping-a-dynamic-website-without-selenium-part-i-c1fec0d302bd?source=collection_archive---------1-----------------------#2022-07-20">https://medium.com/geekculture/scraping-a-dynamic-website-without-selenium-part-i-c1fec0d302bd?source=collection_archive---------1-----------------------#2022-07-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6d25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们，网页抓取者，知道使用Selenium抓取动态网站。但是，经过一些经验和探索，我们发现硒并不总是必要的。</p><p id="dcc8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这很容易理解。毕竟，所有的网站都使用一些API或网页挂钩。用户通过GET、POST或任何此类请求与网站进行交互。作为网页抓取者，我们只想从网站上获取数据。并且，网站从/向一些数据库加载/发送数据。为了使用/呈现这些数据，网站使用API。我们只需要找到这些请求，模仿它们并保存数据。</p><p id="ddbc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">几天前，我尝试了同样的方法。我必须从<a class="ae jd" href="https://www2.reservebar.com/" rel="noopener ugc nofollow" target="_blank"> Reservebar </a>收集产品数据。但是挑战在于我必须为一个特定的地点收集所有的东西。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><p id="9224" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在主页上，我们可以看到标题中的类别和标题下方的“输入送货地址”字段。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jl"><img src="../Images/fa71b9a4a33574ea00ad98fe78cdb773.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jSFCJezJqqw4olFoc0DZwQ.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx">www2.reservebar.com home page</figcaption></figure><p id="2d39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们有4个类别，精神到礼物和配件。要查找特定位置的产品，我们必须单击位置字段并输入地址，然后它会显示一个地址列表，我们必须单击一个地址来填写字段，然后单击“保存”。这保存了位置，我们能够获得该位置的产品。这样做可以向产品添加一个标签，显示产品在该位置是否可用。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jl"><img src="../Images/e3b5a3998674867911bb30e5a84e7781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ENsjwHtuoZT1cduk45Q5Q.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx">www2.reservebar.com category page showing show more button</figcaption></figure><p id="597e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们打开一个类别时，它不会显示所有的产品，而是显示它的一些产品和一个“显示更多”按钮。要获得更多的产品，我们必须点击这个按钮，直到我们得到所有的产品。</p><p id="a8d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，这可以用硒很容易地做到。</p><p id="0f55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，我没有硒。</p><h1 id="3854" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">无硒溶液</h1><p id="77b4" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">以下是我在没有硒的情况下是如何做到的。</p><p id="7788" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于我们的目的来说，在标题中获得四个类别的所有产品就足够了。所以，我刚刚创建了一个包含四个类别的列表。</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="e74d" class="lj kc hi lf b fi lk ll l lm ln">collections = ['spirits', 'wine', 'discover', 'gifts-accessories']</span></pre><p id="ed4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于每个类别的URL，我只是将名称附加到我们的主链接上</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="d607" class="lj kc hi lf b fi lk ll l lm ln">https://www2.reservebar.com/collections/{category}</span></pre><p id="5109" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将搜索每个链接，而不是单击主页上的每个链接。</p><p id="9423" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用开发工具，我能够找到点击“显示更多”按钮时触发的请求。所以，我复制了那个请求及其标题和cookies。饼干帮助确定了位置。</p><h2 id="b98e" class="lj kc hi bd kd lo lp lq kh lr ls lt kl iq lu lv kp iu lw lx kt iy ly lz kx ma bi translated">使用请求</h2><p id="d929" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">所以，这里是我如何点击“显示更多”按钮，而不是真正打开浏览器。让我把整个剧本分成几部分。</p><p id="e732" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1-以下代码行包含请求的cookies</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="b272" class="lj kc hi lf b fi lk ll l lm ln">import requestsfrom bs4 <br/>import BeautifulSoup as bs<br/>import pandas as pd</span><span id="c488" class="lj kc hi lf b fi mb ll l lm ln">root_url = "https://www2.reservebar.com" # products' addresses will be appended to this root URL</span><span id="9ced" class="lj kc hi lf b fi mb ll l lm ln">payload={} # an empty data payload</span><span id="6d70" class="lj kc hi lf b fi mb ll l lm ln"><br/># headers for our request</span><span id="b6b7" class="lj kc hi lf b fi mb ll l lm ln">headers = {  'authority': 'www2.reservebar.com',  'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',  'accept-language': 'en-US,en;q=0.9',  'cache-control': 'max-age=0',  'sec-ch-ua': '"Chromium";v="103", ".Not/A)Brand";v="99"',  'sec-ch-ua-mobile': '?0',  'sec-ch-ua-platform': '"Linux"',  'sec-fetch-dest': 'document',  'sec-fetch-mode': 'navigate',  'sec-fetch-site': 'none',  'sec-fetch-user': '?1',  'upgrade-insecure-requests': '1',  'user-agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.53 Safari/537.36',  'Cookie': '__cq_dnt=1; dw_dnt=1; dwanonymous_a40f731d0711af5eb64499a73962349d=acufdphn0DuqzTqpqehaZp0DTc; dwsid=__EYAfXIo7BoEcYW1pQyOh0NcUmbp9wkncr3rR5ZPH6TknOGh6nHxPMEspRdXYKdgSkuZdsQqkrhWpEOf8P0NA==; sid=P67PVuk3mQcAmmYLM16Xkt1Sph6HWOaT9UE'}</span></pre><p id="31f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些标题中的Cookies起到了设置位置的作用。</p><p id="8d61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2-下面给出的这些行是用于存储数据的列表</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="9b62" class="lj kc hi lf b fi lk ll l lm ln"># list of categories<br/>collections = ['spirits', 'wine', 'discover', 'gifts-accessories'] </span><span id="1e61" class="lj kc hi lf b fi mb ll l lm ln"># list to store products' links<br/>products_links = []</span></pre><p id="ac8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3-下面的所有行都在for循环中</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="7fa5" class="lj kc hi lf b fi lk ll l lm ln"># for each category in the categories' list<br/>for cat in collections:</span><span id="c699" class="lj kc hi lf b fi mb ll l lm ln">    # set its URL<br/>    cat_url = f"https://www2.reservebar.com/collections/{cat}"<br/>    # send a GET request to the URL<br/>    cat_res = requests.request("GET", cat_url, headers=headers, data=payload)<br/>    # find the total number of results/products in that category<br/>    soup = bs(cat_res.text, 'html.parser')<br/>    more_results = soup.find('span', class_='results-span').get_text().strip().split(' ')[0].split(',')<br/>    results = int(''.join(more_results))</span><span id="122f" class="lj kc hi lf b fi mb ll l lm ln">    # print the total number of products in that category<br/>    print(f"link: {cat_url}", " results: ",results)</span></pre><p id="3705" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我使用下面的代码行一次性获得所有产品。</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="140f" class="lj kc hi lf b fi lk ll l lm ln">show_more_link = f"https://www2.reservebar.com/on/demandware.store/Sites-reservebarus-Site/default/Search-UpdateGrid?cgid={cat}&amp;start={start}&amp;sz={size}&amp;selectedUrl=https%3A%2F%2Fwww2.reservebar.com%2Fon%2Fdemandware.store%2FSites-reservebarus-Site%2Fdefault%2FSearch-UpdateGrid%3Fcgid%3D{cat}%{results}start%3D{1}%{results}sz%3D{results}"</span></pre><p id="f77d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但它仍然无法加载全部源代码。所以我把这个请求分成几部分发送，也就是说，我没有一次加载所有的产品，而是加载了比实际脚本更多的产品。我加载了100个产品，直到所有产品都加载完毕。为此，我在父“for loop”中使用了嵌套的“while loop”。</p><p id="330e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下几行在主“For循环”中</p><pre class="jm jn jo jp fd le lf lg lh aw li bi"><span id="9b24" class="lj kc hi lf b fi lk ll l lm ln">    # counter for the number of product to start from, to load from the API<br/>    start = 1<br/>    # number of products to load in a single request<br/>    size = 100</span><span id="7bfa" class="lj kc hi lf b fi mb ll l lm ln">    # the while loop<br/>    while True:</span><span id="fd6b" class="lj kc hi lf b fi mb ll l lm ln">        # if start position becomes equal to greater than the total number of products, break the while loop and move forward to next category<br/>        if start&gt;=results:<br/>            break<br/>        # the request to show more products, with variable paramaters indicated inside curly brackets<br/>        show_more_link = f"https://www2.reservebar.com/on/demandware.store/Sites-reservebarus-Site/default/Search-UpdateGrid?cgid={cat}&amp;start={start}&amp;sz={size}&amp;selectedUrl=https%3A%2F%2Fwww2.reservebar.com%2Fon%2Fdemandware.store%2FSites-reservebarus-Site%2Fdefault%2FSearch-UpdateGrid%3Fcgid%3D{cat}%{size}start%3D{start}%{size}sz%3D{size}"<br/>        </span><span id="c58e" class="lj kc hi lf b fi mb ll l lm ln">        # send the GET request to load more products<br/>        response = requests.request("GET", show_more_link, headers=headers, data=payload)</span><span id="5f0d" class="lj kc hi lf b fi mb ll l lm ln">        # from the response get all the products found which do not have a tag indicating not available at the location<br/>        soup = bs(response.text, 'html.parser')<br/>        all_products = soup.find_all('div', class_="product-tile")<br/>        <br/>        for prod in all_products:<br/>            if "Not available in IL" in prod.get_text():<br/>                ...<br/>            else:<br/>                a = prod.find('a')<br/>                products_links.append(root_url+a['href'])<br/>                # print(a['href'])</span><span id="d96b" class="lj kc hi lf b fi mb ll l lm ln">        # increment start number by 1<br/>        start += 100<br/>     print("number of products' links: ", len(products_links))</span></pre><p id="e627" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“for循环”和“产品”链接抓取到此结束。</p><p id="3462" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用这种方法，我收集了几乎所有类别的产品，然后将它们保存在一个. CSV文件中，以供记录和以后使用。</p><p id="77d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是这个应用程序的完整代码。</p><figure class="jm jn jo jp fd jq"><div class="bz dy l di"><div class="mc md l"/></div><figcaption class="jx jy et er es jz ka bd b be z dx">script to perform click events and to scrap reservebar products without using selenium, by Irfan Ahmad</figcaption></figure><p id="c835" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">后来，我没有时间检查更多的请求。所以我只是用Selenium删除了每个产品的位置信息。因为这些链接使用了一些不同类型的请求和组合。这就是为什么为了节省我的时间，我只是实现了我已经知道的东西。</p><h1 id="b5db" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">结论</h1><p id="09a8" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">我们可以监控网站对来自开发者工具的一些事件的请求，并可以将它们复制到以获取数据，而不是使用Selenium进行点击或其他此类基于请求的事件。但是，它并不总是适用的。</p><p id="b673" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">学习永无止境，所以我会继续学习，尝试和分享。</p><p id="b1c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你是新来的，我也写过关于用selenium Part-1，Part-II，Part-III，Part-IV和Part-V刮动态网站的文章。</p></div></div>    
</body>
</html>