<html>
<head>
<title>Automating Python scripts locally using crontab.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用crontab在本地自动化Python脚本。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/automating-python-scripts-locally-using-crontab-2031151b559f?source=collection_archive---------19-----------------------#2021-07-18">https://medium.com/geekculture/automating-python-scripts-locally-using-crontab-2031151b559f?source=collection_archive---------19-----------------------#2021-07-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="6fca" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">终极省时器。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/aaf7a181afe179544f5a114c3566552c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2VEo77PbWxV5buv5FqrKRw.jpeg"/></div></div></figure><h2 id="7514" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">介绍</h2><p id="d334" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">在本文中，我将展示如何在您的个人机器上轻松地自动执行任何python脚本。</p><p id="04e8" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">让我分享一个简短的故事来说明为什么这是有用的。</p><p id="e7cc" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">在疫情期间，我的大学实施了一项协议，要求学生每天早上在可以使用校园设施之前，在大学网络上填写一份在线调查。在这项调查中，一个人必须手动否定前一天经历的症状，或与可能有传染性接触的人接触过。虽然这样做的目的无疑是高度合法的，结果非常有效，但在通常的“没什么可报告的”情况下，它需要积极的否定，这一事实使它有点费力和烦人。当任务既费力又烦人时，它们是自动化的完美目标。因此，我在寻找一种方法来扭转对行动的需求，并编写一个脚本来填充我的在线调查，这样我只需要在我有症状或接触报告的情况下进行干预(幸运的是，这从未发生)。声明:尽管有很多人感兴趣，但出于安全考虑，我故意不与任何人分享实际的脚本。</p><p id="da24" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">然而，让我分享一下<strong class="kj hj">我是如何</strong>做到的。</p></div><div class="ab cl lf lg gp lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hb hc hd he hf"><p id="f2c9" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">为了使任务自动化，需要两个步骤:</p><ul class=""><li id="229f" class="lm ln hi kj b kk la kn lb ju lo jy lp kc lq kz lr ls lt lu bi translated">首先，您需要编写一个Python脚本来完成这个动作。根据您的应用程序，这可能包括几个不同的步骤。在我的例子中，这相对简单，因为它只需要导航到正确的web地址，定位特定的HTML元素，并与它们进行交互。</li><li id="85d8" class="lm ln hi kj b kk lv kn lw ju lx jy ly kc lz kz lr ls lt lu bi translated">其次，您需要一种在正确的时间(和正确的环境)自动执行这个脚本的方法。</li></ul></div><div class="ab cl lf lg gp lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hb hc hd he hf"><p id="e696" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">首先，让我们考虑一个类似于我用来自动填写每日Covid症状调查的web抓取脚本的例子。</p><h2 id="fd91" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">示例脚本</h2><p id="e1ed" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">在继续之前，确保您已经安装了<a class="ae ma" href="https://selenium-python.readthedocs.io" rel="noopener ugc nofollow" target="_blank"> selenium </a>，这可以使用pip或conda install轻松实现。它是使用Python进行网络抓取的主流包。</p><p id="d58d" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated"><code class="du mb mc md me b">pip install selenium</code></p><p id="eb6d" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">Selenium提供了一个简单的API，允许您的Python脚本访问WebDriver的全部功能，web driver是一个自动化的软件，它控制您的浏览器，并允许您以与人类用户相同的方式与任何网页进行交互。为谷歌Chrome安装Chrome驱动程序是一个显而易见的选择。安装后，将脚本定向到WebDriver，如下所示:</p><pre class="iy iz ja jb fd mf me mg mh aw mi bi"><span id="e13e" class="jj jk hi me b fi mj mk l ml mm">from selenium import webdriver</span><span id="501a" class="jj jk hi me b fi mn mk l ml mm">driver = webdriver.Chrome("/Applications/chromedriver")</span></pre><p id="e277" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">其中cromedriver.exe的位置作为参数传递。</p><p id="bacb" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">driver对象有大量有用的方法，允许脚本访问网页并与其HTML元素交互。举个例子，</p><pre class="iy iz ja jb fd mf me mg mh aw mi bi"><span id="7ebc" class="jj jk hi me b fi mj mk l ml mm">driver.get("https://some-url")</span><span id="342e" class="jj jk hi me b fi mn mk l ml mm">login = driver.get_element_by_id("Login")<br/>login.click()</span></pre><p id="10e4" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">运行后，将打开Chrome，转到指定的URL，找到ID =“log in”的HTML元素，然后单击它，模仿人类的动作。您还可以通过名称或类别轻松定位网页元素，您可以通过检查源代码轻松查找一次(在Chrome中，只需右键单击并“检查”)。</p><p id="c26d" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">在我的例子中，在从一个单独的配置文件中加载我的网站特定的凭证之后，我继续像这样登录我的帐户:</p><pre class="iy iz ja jb fd mf me mg mh aw mi bi"><span id="053e" class="jj jk hi me b fi mj mk l ml mm">from config import username, password</span><span id="5d2a" class="jj jk hi me b fi mn mk l ml mm">username_field = driver.find_element_by_id("username")<br/>username_field.send_keys(username)</span><span id="d7ba" class="jj jk hi me b fi mn mk l ml mm">pw_field = driver.find_element_by_id("password")<br/>pw_field.send_keys(password)</span><span id="ad4b" class="jj jk hi me b fi mn mk l ml mm">submit_button = driver.find_element_by_name("Submit")<br/>submit_button.click()</span></pre><p id="d532" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">提交调查是相应完成的…关于与页面交互的更多详细信息和selenium提供的许多功能，请查看<a class="ae ma" href="https://selenium-python.readthedocs.io/locating-elements.html" rel="noopener ugc nofollow" target="_blank">这个</a>页面。</p></div><div class="ab cl lf lg gp lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hb hc hd he hf"><p id="b015" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">现在让我们考虑第二步。假设我们有一个工作的Python脚本，我们如何自动化它的执行？当然，每当我们想要执行脚本和处理任务时，我们可以去我们的机器并运行它，但是如果我们甚至根本不需要担心手动初始化执行，那将会更整洁(和更有用)。与将脚本部署到提供定时执行的在线云服务(这是另一种可能性)不同，有一种非常简单的方法可以在本地调度任何脚本的执行。</p><h2 id="b646" class="jj jk hi bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">Crontab</h2><p id="1c98" class="pw-post-body-paragraph kh ki hi kj b kk kl ij km kn ko im kp ju kq kr ks jy kt ku kv kc kw kx ky kz hb bi translated">对于任何一个macOS上的人来说，这种简单的方式叫做crontab。它基于默认的软件实用程序cron，这是一个基于时间的作业调度程序，适用于类似Unix的计算机操作系统，包括macOS。对我来说，它被证明是必须有用且易于使用的开发工具之一，它节省了我数小时的时间和内存。</p><p id="4ffc" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">因此，让我们来看看如何将脚本添加到Mac的内部时间表中。在终端中，输入:</p><pre class="iy iz ja jb fd mf me mg mh aw mi bi"><span id="c1c0" class="jj jk hi me b fi mj mk l ml mm">env EDITOR=nano crontab -e</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mo"><img src="../Images/30e2c53e245aa47801ef9613bb3304f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*5dmNRIV4ZwRLJvkJoznBVw.png"/></div><figcaption class="mp mq et er es mr ms bd b be z dx">Crontab Nano Editor with menu bar.</figcaption></figure><p id="f420" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">这将打开nano编辑器，应该是这样的。现在，您可以通过使用以下语法指定第一行来将cron作业添加到列表中:</p><pre class="iy iz ja jb fd mf me mg mh aw mi bi"><span id="6678" class="jj jk hi me b fi mj mk l ml mm">* * * * *  command to execute<br/>│ │ │ │ │<br/>│ │ │ │ └─── day of week (0 - 6) (0 to 6 are Sunday to Saturday, or use names; 7 is Sunday, the same as 0)<br/>│ │ │ └──────── month (1 - 12)<br/>│ │ └───────────── day of month (1 - 31)<br/>│ └────────────────── hour (0 - 23)<br/>└─────────────────────── min (0 - 59)</span></pre><p id="0380" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">其中星形选择所有值。因此，如果我的web抓取脚本应该在每天中午12点运行，我应该输入:</p><pre class="iy iz ja jb fd mf me mg mh aw mi bi"><span id="fed5" class="jj jk hi me b fi mj mk l ml mm">00 12 * * * cd User/PythonScripts/folder &amp;&amp; OnlineSurveyScript.py</span></pre><p id="cb1b" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">其中<em class="mt"> cd </em>导航到右边的文件夹，<em class="mt"> &amp; &amp; </em>后面的文件是Python脚本。玩一玩，熟悉一下这里的语法<a class="ae ma" href="https://crontab.guru" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="db17" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">此外，通过在crontab文件的顶部插入<code class="du mb mc md me b">MAILTO="&lt;email adress&gt;"</code>,您可以将脚本文件的输出或最终的错误消息发送到您的电子邮件地址。我建议你这样做，这样你就能及时了解工作的最新情况。如果您喜欢安静地运行作业，只需离开<code class="du mb mc md me b">MAILTO=""</code>。</p><p id="141b" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">保存并退出。就是这样。</p></div><div class="ab cl lf lg gp lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hb hc hd he hf"><p id="6cbc" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">所有这一切的吸引力在于，这两个工具结合起来，可以让您轻松实现无数有趣任务的自动化。想象一下，例如，一个脚本，每天早上开市前从雅虎财经(或Reddit…)下载最新的金融数据，执行一些你选择的计算，然后将结果发送到你的手机，或直接发送到你的交易算法。或者，它可以唤醒并扫描某一类别的亚马逊产品，寻找当天的最佳销售优惠，等等。对于其中的大多数产品，您甚至不必自己进行网络搜索，因为有许多API包装程序。</p><p id="80f7" class="pw-post-body-paragraph kh ki hi kj b kk la ij km kn lb im kp ju lc kr ks jy ld ku kv kc le kx ky kz hb bi translated">对于更高级的目的，您可能想考虑更复杂的基础设施。然而，对于小的个人任务，这会节省你很多时间和精力，甚至可能给别人留下深刻印象。</p></div></div>    
</body>
</html>