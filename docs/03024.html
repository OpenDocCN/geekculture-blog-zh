<html>
<head>
<title>Learning Three.js: #1 How to Create a Bouncing Ball</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习Three.js: #1如何制作弹跳球</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/learning-three-js-1-how-to-create-a-bouncing-ball-5f423a629e59?source=collection_archive---------9-----------------------#2021-05-30">https://medium.com/geekculture/learning-three-js-1-how-to-create-a-bouncing-ball-5f423a629e59?source=collection_archive---------9-----------------------#2021-05-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ae86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是<strong class="ih hj">“学三. js”</strong>系列的第一篇教程！这个系列是关于<strong class="ih hj">学习Three.js，和你一起</strong>。虽然Three.js已经存在了一段时间，但我在这个领域绝对是个初学者。我之所以想学这个是因为我真的想为我的网站制作很酷的3D动画，就像那些在<a class="ae jd" href="https://www.awwwards.com/" rel="noopener ugc nofollow" target="_blank">awwwards.com</a>上很酷的网站一样。</p><p id="af3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和往常一样，这个演示的完整代码将会在Github的<a class="ae jd" href="https://github.com/franky-adl/bouncing-ball" rel="noopener ugc nofollow" target="_blank">这个链接</a>上。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="3143" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">设置Webpack</h1><p id="d869" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">我们需要的最重要的包当然是Three.js包。从npm安装它:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="9c7d" class="kx jm hi kt b fi ky kz l la lb">npm install --save three</span></pre><p id="8678" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看一下我的<code class="du lc ld le kt b">package.json</code>文件，看看我们构建这个项目还需要哪些开发依赖项。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="59fe" class="kx jm hi kt b fi ky kz l la lb">  "devDependencies": {<br/>    "<a class="ae jd" href="http://twitter.com/babel/core" rel="noopener ugc nofollow" target="_blank">@babel/core</a>": "^7.14.3",<br/>    "<a class="ae jd" href="http://twitter.com/babel/preset-env" rel="noopener ugc nofollow" target="_blank">@babel/preset-env</a>": "^7.14.4",<br/>    "autoprefixer": "^10.2.6",<br/>    "babel-loader": "^8.2.2",<br/>    "css-loader": "^5.2.6",<br/>    "html-webpack-plugin": "^5.3.1",<br/>    "postcss": "^8.3.0",<br/>    "postcss-loader": "^5.3.0",<br/>    "postcss-preset-env": "^6.7.0",<br/>    "sass": "^1.34.0",<br/>    "sass-loader": "^11.1.1",<br/>    "style-loader": "^2.0.0",<br/>    "webpack": "^5.38.1",<br/>    "webpack-cli": "^4.7.0",<br/>    "webpack-dev-server": "^3.11.2"<br/>  }</span></pre><p id="b39a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然我们没有太多的SCSS来定义这个简单的例子，但它只是一个样板设置，我用在网站上。<code class="du lc ld le kt b">HtmlWebpackPlugin</code>将帮助我们获取一个html模板，并将我们的主脚本插入其中。使用<code class="du lc ld le kt b">webpack-dev-server</code>，我们可以让Webpack在每次添加变更和保存文件时重新捆绑项目。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="579e" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">让我们深入研究代码</h1><p id="b82b" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">我们将所有与Three.js相关的代码放在主脚本index.js中。</p><p id="3110" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了导入我们的<code class="du lc ld le kt b">style.scss</code>，为了简单起见，我们从‘three’导入所有的模块作为<code class="du lc ld le kt b">THREE</code>，还有<code class="du lc ld le kt b"><a class="ae jd" href="https://threejs.org/docs/#examples/en/controls/OrbitControls" rel="noopener ugc nofollow" target="_blank">OrbitControls</a></code>模块允许用户通过拖动屏幕来‘环绕’我们的对象。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="c1eb" class="kx jm hi kt b fi ky kz l la lb">import * as THREE from 'three';<br/>import {OrbitControls} from 'three/examples/jsm/controls/OrbitControls';</span></pre><p id="7dcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们来设置一下Three.js场景。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="045e" class="kx jm hi kt b fi ky kz l la lb">const scene = new THREE.Scene();<br/>const canvas = document.querySelector("#canvas");<br/>const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );<br/>camera.position.set(0, 20, 50);<br/>camera.lookAt(0, 0, 0);<br/>const controls = new OrbitControls(camera, canvas);</span><span id="d9ff" class="kx jm hi kt b fi lf kz l la lb">// Set up the renderer<br/>const renderer = new THREE.WebGLRenderer({canvas});<br/>renderer.setSize( window.innerWidth, window.innerHeight );</span></pre><p id="9722" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个<code class="du lc ld le kt b"><a class="ae jd" href="https://threejs.org/docs/#api/en/scenes/Scene" rel="noopener ugc nofollow" target="_blank">Scene</a></code>对象包含了你想要通过<code class="du lc ld le kt b"><a class="ae jd" href="https://threejs.org/docs/?q=WebGL#api/en/renderers/WebGLRenderer" rel="noopener ugc nofollow" target="_blank">WebGLRenderer</a></code>渲染的所有可视对象。画布是显示渲染结果的html元素。</p><p id="5f1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lc ld le kt b"><a class="ae jd" href="https://threejs.org/docs/#api/en/cameras/PerspectiveCamera" rel="noopener ugc nofollow" target="_blank">PerspectiveCamera</a></code>构造函数的参数基本意思是:创建一个75度视野的透视相机，与浏览器窗口具有相同的纵横比，并且仅使0.1单位和1000单位距离内的所有对象可见。</p><p id="7131" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lc ld le kt b">OrbitControls</code>对象的实例化允许用户改变默认情况下环绕原点的场景的摄像机角度。</p><p id="2dcc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lc ld le kt b">setSize</code>方法允许你以不同于浏览器窗口的分辨率来呈现你的应用。通常你会喜欢一样的。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="717e" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">要有光！</h1><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="5860" class="kx jm hi kt b fi ky kz l la lb">function addLighting(scene) {<br/>  let color = 0xFFFFFF;<br/>  let intensity = 1;<br/>  let light = new THREE.DirectionalLight(color, intensity);<br/>  light.position.set(0, 10, 0);<br/>  light.target.position.set(-5, -2, -5);<br/>  scene.add(light);<br/>  scene.add(light.target);<br/>}<br/>addLighting(scene);</span></pre><p id="9597" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Three.js中有许多类型的照明，如<code class="du lc ld le kt b"><a class="ae jd" href="https://threejs.org/docs/?q=Scene#api/en/lights/AmbientLight" rel="noopener ugc nofollow" target="_blank">AmbientLight</a></code>、<code class="du lc ld le kt b"><a class="ae jd" href="https://threejs.org/docs/?q=PointLi#api/en/lights/PointLight" rel="noopener ugc nofollow" target="_blank">PointLight</a></code>等。我们在这里使用的<code class="du lc ld le kt b"><a class="ae jd" href="https://threejs.org/docs/#api/en/lights/DirectionalLight" rel="noopener ugc nofollow" target="_blank">DirectionalLight</a></code>就像太阳一样，场景中的光线都是相互平行的，指向灯光位置画出的特定方向。请注意，使用<code class="du lc ld le kt b">DirectionalLighting</code>时，您需要将灯光对象和灯光目标都添加到场景中。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="3b15" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">球需要从一个表面上弹开</h1><p id="ed20" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">让我们为弹跳球添加一个“地板”！</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="7787" class="kx jm hi kt b fi ky kz l la lb">function addFloor(scene) {<br/>  let geometry = new THREE.BoxGeometry(50, 1, 50);<br/>  let material = new THREE.MeshStandardMaterial({color: 0xDDDDDD, roughness: 0});<br/>  const floor = new THREE.Mesh( geometry, material );<br/>  floor.position.set(0, -10, 0);<br/>  floor.name = 'my-floor';<br/>  scene.add(floor);<br/>}<br/>addFloor(scene);</span></pre><p id="ddab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们创建一个<code class="du lc ld le kt b"><a class="ae jd" href="https://threejs.org/docs/?q=BoxGeo#api/en/geometries/BoxGeometry" rel="noopener ugc nofollow" target="_blank">BoxGeometry</a></code>对象，然后为它应用浅灰色<code class="du lc ld le kt b"><a class="ae jd" href="https://threejs.org/docs/#api/en/materials/MeshStandardMaterial" rel="noopener ugc nofollow" target="_blank">MeshStandardMaterial</a></code>。如果稍后需要通过名称从场景中查询对象，为对象设置名称会很有帮助。</p><p id="f13b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lc ld le kt b">MeshStandardMaterial</code>是一种神奇的材料，可以让你的物体在所有照明场景下做出“正确”的反应。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="7f01" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">让我们添加球</h1><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="f175" class="kx jm hi kt b fi ky kz l la lb">function addSphere(scene) {<br/>  let geometry = new THREE.SphereGeometry( 5, 32, 32 );<br/>  let material = new THREE.MeshStandardMaterial({color: 0x0000ff, roughness: 0});<br/>  let sphere = new THREE.Mesh( geometry, material );<br/>  sphere.position.set(0, 5, 0);<br/>  sphere.name = 'my-sphere';<br/>  scene.add( sphere );<br/>}<br/>addSphere(scene);</span></pre><p id="dcb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用<code class="du lc ld le kt b"><a class="ae jd" href="https://threejs.org/docs/#api/en/geometries/SphereGeometry" rel="noopener ugc nofollow" target="_blank">SphereGeometry</a></code>创建一个半径为5个单位、32个宽和高分段的球体。你的球体的宽度/高度分段越多，它看起来就越像一个完美的球体。这是一个蓝色的球。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="9317" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">开拍。</h1><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="2291" class="kx jm hi kt b fi ky kz l la lb">// setting initial values for required parameters <br/>let acceleration = 9.8;<br/>let bounce_distance = 9;<br/>let bottom_position_y = -4;<br/>let time_step = 0.02;<br/>// time_counter is calculated to be the time the ball just reached the top position<br/>// this is simply calculated with the s = (1/2)gt*t formula, which is the case when ball is dropped from the top position<br/>let time_counter = Math.sqrt(bounce_distance * 2 / acceleration);<br/>let initial_speed = acceleration * time_counter;<br/>let sphere = scene.getObjectByName("my-sphere");</span><span id="b6b3" class="kx jm hi kt b fi lf kz l la lb">// Animate the scene<br/>const animate = () =&gt; {<br/>  requestAnimationFrame( animate );</span><span id="c687" class="kx jm hi kt b fi lf kz l la lb">  // reset time_counter back to the start of the bouncing sequence when sphere hits through the bottom position<br/>  if (sphere.position.y &lt; bottom_position_y) {<br/>    time_counter = 0;<br/>  }<br/>  // calculate sphere position with the s2 = s1 + ut + (1/2)gt*t formula<br/>  // this formula assumes the ball to be bouncing off from the bottom position when time_counter is zero<br/>  sphere.position.y = bottom_position_y + initial_speed * time_counter - 0.5 * acceleration * time_counter * time_counter;<br/>  // advance time<br/>  time_counter += time_step;</span><span id="be13" class="kx jm hi kt b fi lf kz l la lb">renderer.render( scene, camera );<br/>};<br/>animate();</span></pre><p id="e985" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这部分对你来说可能有点复杂，因为这涉及到一些使用物理定律的计算。基本的想法是，每当球落地，我就简单地重置弹跳序列，让它再次重复。所以实际上，如果你保持浏览器标签打开，球将永远反弹！</p><p id="8e70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你需要理解的重要部分是动画循环是如何工作的。最简单的动画循环是这样的:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="afa6" class="kx jm hi kt b fi ky kz l la lb">function animate() {<br/> requestAnimationFrame( animate );<br/> renderer.render( scene, camera );<br/>}<br/>animate();</span></pre><p id="cd02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">引自<a class="ae jd" href="https://threejs.org/docs/?q=Sphere#manual/en/introduction/Creating-a-scene" rel="noopener ugc nofollow" target="_blank">官方教程</a>:</p><blockquote class="lg lh li"><p id="5b07" class="if ig lj ih b ii ij ik il im in io ip lk ir is it ll iv iw ix lm iz ja jb jc hb bi translated">这将创建一个循环，使渲染器在每次屏幕刷新时绘制场景(在典型的屏幕上，这意味着每秒60次)。如果你是在浏览器中编写游戏的新手，你可能会说<em class="hi">“我们为什么不创建一个setInterval呢？”</em>事实是——我们可以，但是requestAnimationFrame有很多优点。也许最重要的一点是，当用户导航到另一个浏览器标签时，它会暂停，因此不会浪费他们宝贵的处理能力和电池寿命。</p></blockquote><p id="7181" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，您可以在<code class="du lc ld le kt b">requestAnimationFrame</code>调用和<code class="du lc ld le kt b">render</code>调用之间放置任何代码来改变对象的位置/方向/任何其他属性，以便为对象制作动画。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="e864" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">给你，一个永远弹跳的球:</h1><figure class="ko kp kq kr fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es ln"><img src="../Images/a04b2de7eb758f379b85fdb1ead99373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9rBP8heV3M0zR0Bwe_wtvA.gif"/></div></div></figure></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="61bb" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">参考</h1><ol class=""><li id="59de" class="lv lw hi ih b ii kj im kk iq lx iu ly iy lz jc ma mb mc md bi translated"><a class="ae jd" href="https://threejs.org/docs/" rel="noopener ugc nofollow" target="_blank">https://threejs.org/docs/</a></li><li id="47d6" class="lv lw hi ih b ii me im mf iq mg iu mh iy mi jc ma mb mc md bi translated"><a class="ae jd" href="https://threejsfundamentals.org/threejs/lessons/threejs-lights.html" rel="noopener ugc nofollow" target="_blank">https://three js fundamentals . org/three js/lessons/three js-lights . html</a></li></ol></div></div>    
</body>
</html>