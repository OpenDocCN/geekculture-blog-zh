<html>
<head>
<title>15 days of learning SQL : HackerRank</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">15天学习SQL : HackerRank</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/15-days-of-learning-sql-hackerrank-a40ab17ae462?source=collection_archive---------1-----------------------#2022-01-23">https://medium.com/geekculture/15-days-of-learning-sql-hackerrank-a40ab17ae462?source=collection_archive---------1-----------------------#2022-01-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9800" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">硬连接:高级SQL连接</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/e2371604d6ac1f8af162297228295d19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uT1D0cOPm0bdvJQyYWjO-A.jpeg"/></div></div></figure><p id="9084" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jp">问题陈述:</em> </strong> Julia进行了一天的学习SQL大赛。大赛开始日期为2016年3月1日，结束日期为2016年3月15日。<br/>编写一个查询来打印每天至少提交了一次的独特黑客的总数(从比赛的第一天开始)，并找到每天提交次数最多的黑客的hacker_id和名称。如果不止一个这样的黑客有最大数量的提交，打印最小的hacker_id。该查询应该打印比赛每一天的信息，按日期排序。</p><p id="020c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">输入格式:</strong>以下表格保存比赛数据:</p><ul class=""><li id="6204" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">黑客:hacker_id是黑客的id，name是黑客的名字。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jz"><img src="../Images/a6aa13099c1ac9ed895490e00e1ad150.png" data-original-src="https://miro.medium.com/v2/resize:fit:342/format:webp/0*NSxZBcMMDgf4PSbM.png"/></div></figure><ul class=""><li id="a9c1" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">提交:submission_date是提交的日期，submission_id是提交的id，hacker_id是提交的黑客的id，score是提交的分数。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ka"><img src="../Images/516aea979cddcd65ba366a9906b40260.png" data-original-src="https://miro.medium.com/v2/resize:fit:434/format:webp/0*yUMult5C3C_8dJKv.png"/></div></figure><p id="8ddd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是<a class="ae kb" href="https://www.hackerrank.com/challenges/15-days-of-learning-sql/problem" rel="noopener ugc nofollow" target="_blank">链接</a>到原HackerRank问题。</p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h2 id="0234" class="kj kk hi bd kl km kn ko kp kq kr ks kt iq ku kv kw iu kx ky kz iy la lb lc ld bi translated">让我们把这个问题分成两部分</h2><p id="bea7" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">第1部分:找到每天提交数量最多的黑客的hacker_id。</p><p id="8ad5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第2部分:获得每天至少提交一次的独特黑客的列表(从比赛的第一天开始)</p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="2ab2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">对于第1部分:</strong>首先，我们将查询以获得submission_date和hacker_id的唯一组合，从而给出每个黑客在某一天提交的数量。</p><p id="b33b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查询:-</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="bda8" class="kj kk hi lk b fi lo lp l lq lr">select submission_date, hacker_id, count(1) as SubCount<br/>from submissions<br/>group by submission_date, hacker_id</span></pre><p id="fff7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，我们希望获得每天提交数量最多的Hacker_id。所以我们将使用RANK()窗口函数添加一个名为<strong class="ih hj">‘Rn’的列。</strong></p><p id="b287" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> OVER(按SubCount desc，hacker_id排序):</strong>提交次数最多的hacker_id，在不止一个Hacker提交次数最多的情况下，将给出最低的hacker_id。</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="7597" class="kj kk hi lk b fi lo lp l lq lr">with MaxSubEachDay as (<br/>    select submission_date,<br/>           hacker_id,<br/>           RANK() OVER(partition by submission_date order by SubCount desc, hacker_id) as Rn<br/>    FROM<br/>    (select submission_date, hacker_id, count(1) as SubCount <br/>     from submissions<br/>     group by submission_date, hacker_id<br/>     ) subQuery<br/>)</span></pre><p id="afde" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">对于第二部分:</strong>获得每天至少提交一份文件的独特黑客的名单(从比赛的第一天开始)</p><p id="c5cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这部分相当棘手和复杂。我们需要一步一步钻过去。</p><p id="ca04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，让我们为我们的提交采取以下输入。这里只有Rohit制造的..</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ls"><img src="../Images/e7aa80db856f42a5e290988ef047a576.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*vmSA-QisaZ1qRXIYvA_z9g.png"/></div></figure><p id="b8b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤1 : </strong>创建一个cte来添加一个新列，该列将跟踪日期序列。也就是说，所有“2016-03-01”的提交将具有dayRn = 1，“2016-03-02”的提交将具有dayRn = 2，“2016-03-03”的提交将具有dayRn = 3，以此类推..</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="c4ad" class="kj kk hi lk b fi lo lp l lq lr">DayWiseRank as (<br/>    select submission_date,<br/>           hacker_id,<br/>           DENSE_RANK() OVER(order by submission_date) as dayRn<br/>    from submissions<br/>)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lt"><img src="../Images/3ce01679ba07fa178db0ba1ad7d44fb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*R0Yp1sfuvezjoZ3U9jMPSw.png"/></div></figure><p id="cb37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤2 : </strong>现在我们将逐行迭代，并将检查是否有任何hacker_id在前几天有提交。<br/>例如，如果一条记录的submission_date是“2016–03–03”，我们将检查黑客是否在所有早于“2016–03–03”的日期中至少有一次提交。即“2016年3月2日”和“2016年3月1日”</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="4119" class="kj kk hi lk b fi lo lp l lq lr">HackerCntTillDate as (<br/>select outtr.submission_date,<br/>       outtr.hacker_id,<br/>       case when outtr.submission_date='2016-03-01' then 1<br/>            else 1+(select count(distinct a.submission_date)                         from submissions a where a.hacker_id = outtr.hacker_id and                              a.submission_date&lt;outtr.submission_date)<br/>        end as PrevCnt,<br/>        outtr.dayRn<br/>from DayWiseRank outtr<br/>)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lu"><img src="../Images/4ca671940300850c67394bab972167d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*gxzzdPafcfqidHFg2yuWtQ.png"/></div></figure><p id="6bff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当submission _ date = ' 2016–03–01 '或dayRn = 1时，我们将设置默认值PrevCnt=1，因为第一天至少提交一次的所有黑客都将被计算在内。</p><p id="64a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第三步:</strong>现在我们将计算每天唯一的hacker_id。<br/>注意:我们使用了一个where条件‘where prev CNT = day rn’。<br/>原因是，要将黑客视为“每天至少提交一份文件的黑客”，不同“提交日期”的计数应与当前提交日期相匹配。<br/>在我们的示例中，对于日期“2016–03–03”，“Mira”已经提交了一份材料。虽然她也在2016-03-02年提交了，但她在2016-03-01年没有提交。因此，她不具备“每天至少提交一份文件的黑客”的资格。</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="9ff9" class="kj kk hi lk b fi lo lp l lq lr">HackerSubEachDay as (<br/>    select submission_date,<br/>    count(distinct hacker_id) HackerCnt<br/>from HackerCntTillDate<br/>  where PrevCnt = dayRn<br/>group by submission_date<br/>)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/584bb41cc6e00dacf1d13c543980f2fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*lZqOclHY9tUa2azP4P3TUg.png"/></div></figure></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h1 id="9966" class="lw kk hi bd kl lx ly lz kp ma mb mc kt md me mf kw mg mh mi kz mj mk ml lc mm bi translated">是时候把第一部分和第二部分结合起来了(Phewwww！！)</h1><p id="219e" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">我们将把所有的cte放在一起，并将HackerSubEachDay、MaxSubEachDay与Hackers表连接起来，以获得相应的名称。</p><blockquote class="mn mo mp"><p id="ca66" class="if ig jp ih b ii ij ik il im in io ip mq ir is it mr iv iw ix ms iz ja jb jc hb bi translated">记住:我们必须应用' where MaxSubEachDay。“Rn=1 ”,因为我们只想要排名=1的黑客，即在特定的一天提交数量最多的黑客。</p></blockquote><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="9719" class="kj kk hi lk b fi lo lp l lq lr">with MaxSubEachDay as (<br/>    select submission_date,<br/>           hacker_id,<br/>           RANK() OVER(partition by submission_date order by SubCount desc, hacker_id) as Rn<br/>    FROM<br/>    (select submission_date, hacker_id, count(1) as SubCount <br/>     from submissions<br/>     group by submission_date, hacker_id<br/>     ) subQuery<br/>), DayWiseRank as (<br/>    select submission_date,<br/>           hacker_id,<br/>           DENSE_RANK() OVER(order by submission_date) as dayRn<br/>    from submissions<br/>), HackerCntTillDate as (<br/>select outtr.submission_date,<br/>       outtr.hacker_id,<br/>       case when outtr.submission_date='2016-03-01' then 1<br/>            else 1+(select count(distinct a.submission_date)                         from submissions a where a.hacker_id = outtr.hacker_id and                              a.submission_date&lt;outtr.submission_date)<br/>        end as PrevCnt,<br/>        outtr.dayRn<br/>from DayWiseRank outtr<br/>), HackerSubEachDay as (<br/>    select submission_date,<br/>    count(distinct hacker_id) HackerCnt<br/>from HackerCntTillDate<br/>  where PrevCnt = dayRn<br/>group by submission_date<br/>)<br/>select HackerSubEachDay.submission_date,<br/>       HackerSubEachDay.HackerCnt,<br/>       MaxSubEachDay.hacker_id,<br/>       Hackers.name<br/>from HackerSubEachDay<br/>inner join MaxSubEachDay<br/> on HackerSubEachDay.submission_date = MaxSubEachDay.submission_date<br/>inner join Hackers<br/> on Hackers.hacker_id = MaxSubEachDay.hacker_id<br/>where MaxSubEachDay.Rn=1</span></pre><p id="92ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们期待已久的时刻终于到来了…..</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mt"><img src="../Images/b8f6609189b1138d9484322979763c03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GCBpEwAGSpFnsCNnBZomAw.png"/></div></div></figure></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="3107" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你觉得这篇文章有帮助，请与你的朋友和同事分享。如果还有其他问题，可以在<a class="ae kb" href="https://www.linkedin.com/in/shefali-bisht/" rel="noopener ugc nofollow" target="_blank"><em class="jp">Linkedin</em></a><em class="jp">上找我。</em></p></div></div>    
</body>
</html>