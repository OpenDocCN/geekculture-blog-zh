<html>
<head>
<title>Classifying spiders of Kentucky with fastAi. Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用fastAi分类肯塔基蜘蛛。第一部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/building-a-state-of-the-art-fastai-app-to-identify-the-strange-and-dangerous-spiders-of-kentucky-4817183ef604?source=collection_archive---------22-----------------------#2021-08-01">https://medium.com/geekculture/building-a-state-of-the-art-fastai-app-to-identify-the-strange-and-dangerous-spiders-of-kentucky-4817183ef604?source=collection_archive---------22-----------------------#2021-08-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="93f8" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">第一部分:获取数据</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/4d69a90d536f517b150d856be05c49b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rrfXl52LiAR2JWiUZ8EkHg.jpeg"/></div></div></figure><p id="515f" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">所以，大约六个月前，我搬到了肯塔基州一个叫布兰登堡的小镇。在我工作的六个月里，我见过一些奇怪而可怕的蜘蛛种类。然而，我不是蜘蛛专家，除了黑寡妇和棕色隐士之外，我对蜘蛛并不太了解。然而，在我做研究的时候，我不知道有一只南北黑寡妇和一只狼蛛生活在我的区域。这个地区也有生活在枯木下的蝎子。要查看代码，请导航到github库<a class="ae kn" href="https://github.com/chris-kehl/Spider_Classifier" rel="noopener ugc nofollow" target="_blank">这里。</a></p><p id="93e0" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">这个项目的目标是建立一个应用程序，使用人工智能来快速识别不易识别的蜘蛛。如果你觉得你有棕色隐士蜘蛛的侵扰，这是肯塔基州常见的蜘蛛侵扰，你可以拍下蜘蛛的快照，并将照片上传到应用程序。我们的第一个目标是使用一个名为binder的简单程序上传应用程序进行测试。在这篇文章的另一个系列的后面，我们将把我们的应用程序转换成一个IOS和android应用程序，我们可以把它放在我们的手机上。当我们看到一只蜘蛛而不知道它是否危险时，在我们的手机上建立一个应用程序将会非常方便。大多数人会把棕色隐士蜘蛛和狼蛛搞混。</p><p id="a5e4" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">现在开始构建我们应用程序的第一部分。首先，我们必须从应用程序的人工智能部分开始。为此，我将使用fastAi库。我选择这个库是因为它的简单性和易于遵循的步骤。</p><p id="e6ad" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">从我们最先进的模型开始，我们首先必须得到所有蜘蛛的图像。我使用Google Colab作为我的首选IDE。我用Google Colab做GPU。到目前为止，我已经使用Google Colab大约一年了，对于我需要做的任何数据科学工作，它都是我的头号工具。为了获取图像，我将使用bing，但在此之前，让我们在colab中设置所有的导入和库。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="3d5a" class="kt ig hi kp b fi ku kv l kw kx"># import all the needed starter packages</span><span id="5ff4" class="kt ig hi kp b fi ky kv l kw kx">!pip install -Uqq fastbook</span><span id="faf0" class="kt ig hi kp b fi ky kv l kw kx">import fastbook<br/>import warnings<br/>import os</span><span id="f51e" class="kt ig hi kp b fi ky kv l kw kx">fastbook.setup_book()<br/>from fastai.vision.all import *<br/>from fastbook import *</span></pre><p id="0bd1" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">pip安装将确保为您设置了fastbooks和fastai库。如果你在jupyter labs上使用自己的电脑，一定要研究如何开始使用pytorch和fastai，以防有额外的设置步骤。我发现Google Colab对初学者来说很棒，因为它设置简单，配置方便。</p><p id="3018" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">对于我们的第一个代码块，我们导入fastbook并设置所有的导入和库。我导入os(操作系统),这样我们就可以管理我们的文件和目录。我的google drive文件夹里有我所有的文件夹。您可能已经注意到，当您运行上面的代码时，系统可能会提示您安装google drive。现在，如果你不想保存文件，你不必保存到你的谷歌硬盘，你可以使用操作系统把你的文件放在你想放的地方。</p><p id="5012" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">我喜欢利用Google Colab提供的GPU。因此，在我们继续之前，让我们确保我们使用的是GPU。对于Colab，您可以通过单击主菜单中的运行时来启用GPU。然后单击运行时类型，更改并选择GPU。您还可以选择TPU，但我们将把它留到以后的主题中。您还可以选择高内存，当我们在培训中要使用许多纪元时，我们可以选择这个选项。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="b281" class="kt ig hi kp b fi ku kv l kw kx"># setup for the use of the GPU vs CPU</span><span id="03a4" class="kt ig hi kp b fi ky kv l kw kx">if torch.cuda.is_available():<br/>    device = torch.device("cuda")<br/>else:<br/>    device = torch.device("gpu")</span><span id="42c7" class="kt ig hi kp b fi ky kv l kw kx">!nvidia-smi</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kz"><img src="../Images/2bb1796a4a6f7afdef0453b539f2fed3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dyw5_hRLP0xsknIBR8LmfA.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx">Showing our GPU connectivity</figcaption></figure><p id="72e7" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">你可以看到我连接到一个特斯拉P100图形处理器。这就是我喜欢谷歌Colab的地方，我查看了特斯拉P100 GPU的价格，发现现行价格约为3000.00美元，上下浮动几百美元。现在是时候开始建立我们的数据文件了。首先，我想看看我目前所在的目录。然后，我们将导航到我们希望设置数据文件的文件夹。您可能需要在驱动器中创建目录。我在Google MyDrive里做了一个目录，名字叫spider。你点击我的硬盘旁边的我的硬盘，你会看到…，选择它，应该会出现一个下拉菜单，您可以选择添加文件夹。新文件夹将被标记为无标题，所以您只需重命名它，您可以选择无标题旁边的…并选择重命名(如果需要)。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="09d4" class="kt ig hi kp b fi ku kv l kw kx"># current working directory<br/>os.getcwd()</span></pre><p id="2e3b" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">/content/是os.getcwd()带我去的地方。因此，我将更改当前目录，以包含MyDrive目录。这是我的所有数据将去的地方，并在几分钟内为我们建立一个蜘蛛文件夹。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="7c64" class="kt ig hi kp b fi ku kv l kw kx"># change to google drive<br/>os.chdir('/content/gdrive/MyDrive/')</span><span id="2dc6" class="kt ig hi kp b fi ky kv l kw kx">os.getcwd()</span></pre><p id="4e40" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">我们的目录现在位于/content/gdrive/MyDrive目录中。你的也应该如此，除非你的google drive设置与我的略有不同，或者你希望使用另一个目录。接下来，我们设置如何检索数据。我将使用微软Azure帐户，并使用阿炳API来抓取网页。因此，如果你没有Azure搜索关键字，你需要点击这个<a class="ae kn" href="https://carldesouza.com/bing-custom-search-api-key-azure/" rel="noopener ugc nofollow" target="_blank">链接</a>【https://carldesouza.com/bing-custom-search-api-key-azure/】T2来获得你的Azure搜索关键字。一旦你拿到钥匙，回来我们继续我们的旅程。我们上传最好的八眼爬虫的照片只是时间问题。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="3326" class="kt ig hi kp b fi ku kv l kw kx">key = os.environ.get('AZURE_SEARCH_KEY','Add your key here')</span></pre><p id="4188" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">我们将测试我们的密钥以确保它工作正常</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="8523" class="kt ig hi kp b fi ku kv l kw kx">search_images_bing</span></pre><p id="c144" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">上面的代码应该返回这个<function fastbook.search_images_bing="">，让我们知道它正在识别我们的键。</function></p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="e576" class="kt ig hi kp b fi ku kv l kw kx">results = search_images_bing(key, 'Brown Recluse')<br/>ims = results.attrgot('content_url')<br/>len(ims)</span></pre><p id="b80e" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">上面的代码进一步测试了我们的bing，以确保它可以下拉图像，所以当这段代码运行len(ims)时，ims的长度应该是150。这意味着我们已经下载了150张棕色隐居蜘蛛的图片。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="aed0" class="kt ig hi kp b fi ku kv l kw kx">results</span></pre><p id="2925" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">我们查看结果，它会给出一长串内容url，(# 150)[{ ' webSearchUrl ':'<a class="ae kn" href="https://www.bing.com/images/search?view=detailv2&amp;FORM=OIIRPO&amp;q=Brown+Recluse&amp;id=6916BAEEB9697FD81D3A5A97DDC3CB24B5D87F3B&amp;simid=608024003232360099" rel="noopener ugc nofollow" target="_blank">https://www.bing.com/images/search?view=detailv2&amp;FORM = OIIRPO&amp;q = Brown+Recluse&amp;id = 6916 baeeb 9697 FD 81 d3a 5a 97 DDC 3 CB 24 b5 d87 F3 b&amp;simid = 60802400323232360099</a>'，' name ':id = OIP . y 6 mgbeniupw 5 eojwnq 5 cwhae 8&amp;PID = Api，' date published ':' 2018–02–04t 12:00:00:00.0000000 z '，' isFamilyFriendly': True，' content URL ':'<a class="ae kn" href="https://www.hopperenvironmentalservices.com/images/blog/brown-recluse.jpg" rel="noopener ugc nofollow" target="_blank">https://www . hopperenvironmentalservices . com/images/blog/brown-recluse . jpg</a>。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="0e4d" class="kt ig hi kp b fi ku kv l kw kx">ims = ['https://scx2.bcdn.net/gfx/news/hires/2018/brownrecluse.jpg']</span></pre><p id="7518" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">使用url设置即时消息，这样我们就可以查看刚刚下载的图像。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="d326" class="kt ig hi kp b fi ku kv l kw kx">dest = 'brownrecluse.jpg'<br/>download_url(ims[0], dest)</span></pre><p id="bfbd" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">我们的dest = brownrecluse.jpg，我们的download_url(ims[0]，dest)将指向我们下载的第一个图像。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="36fd" class="kt ig hi kp b fi ku kv l kw kx">im = Image.open(dest)<br/>im.to_thumb(128,128)</span></pre><p id="8250" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">上面的代码允许我们打开图像。我们将所有的像素设置为128 x 128。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es le"><img src="../Images/c71df1ac3cbfeb3f8a1b5a8e8246a289.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*svzpHAx5B76gqpUTMEQqwA.png"/></div><figcaption class="la lb et er es lc ld bd b be z dx">image of the url</figcaption></figure><p id="62ed" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">接下来的几个代码块将让我们设置文件夹来下载应用程序所需的所有数据文件。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="f415" class="kt ig hi kp b fi ku kv l kw kx">spider_types = 'Southern Black Widow', 'Northern Black Widow', 'Brown Recluse', 'Star-bellied Orb-weaver', 'Red-spotted Orb-weaver', 'Arabesque Orb-weaver', 'Arrowhead Orb-weaver','Yellow Garden', 'Banded Garden', 'Arrow-shaped Micrathena', 'Araneus miniatus', 'Bold Jumper', 'Canopy Jumping', 'Tan Jumping', 'Dimorphic Jumper','Emerald Jumping Spider', 'Marpissa lineata', 'Phidippus putnami','Dark Fishing', 'Six-spotted Fishing', 'Striped Fishing', 'Dolomedes vittatus','White-banded Crab', 'Southeastern Wandering', 'Subsocial Tangle Web', 'Twospotted Cobweb', 'Triangulate Cobweb', 'Common House', 'Rhomphaea fictilium', 'Spintharus flavidus', 'Ariadna bicolor', 'Castianeira amoena', 'Castianeira longipalpa', 'Meriola decepta', 'Cesonia bilineata', 'Sergiolus capulatus', 'Thanatus formicinus', 'Tiger Wolf (Tigrosa aspersa)', 'Tigrosa georgicola', 'Tigrosa helluo', 'KENTUCKY PURSEWEB'</span><span id="c981" class="kt ig hi kp b fi ky kv l kw kx">path = Path('spider')</span></pre><p id="1acd" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">蜘蛛类型是我在一个列出肯塔基州所有蜘蛛的网站上找到的所有蜘蛛类型。可能有更多的物种，但这是我所拥有的。我们将为列出的每个生物建立所有的训练、验证和测试文件夹。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="3eea" class="kt ig hi kp b fi ku kv l kw kx">if not path.exists():<br/>    path.mkdir()<br/>    for o in spider_types:<br/>        dest = (path/o)<br/>        dest.mkdir(exist_ok=True) <br/>        results = search_images_bing(key, f'{o} spider')<br/>        download_images(dest, urls=results.attrgot('contentUrl'))</span></pre><p id="7f42" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">这是我们创建蜘蛛目录的地方，在这个目录中，我们为每个蜘蛛类型创建文件夹。当你打开文件夹时，你会看到大约150张图片被下载到每个文件夹中。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="811a" class="kt ig hi kp b fi ku kv l kw kx">fns = get_image_files(path)<br/>fns</span></pre><p id="e5ed" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">fns将所有下载的映像放入正确的映像路径。我们使用failed = verify_images(fns)来查找任何损坏的文件。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="7d78" class="kt ig hi kp b fi ku kv l kw kx">failed.map(Path.unlink)</span></pre><p id="7023" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">然后，我们使用failed.map(Path.unlink)来取消链接，并忽略可能已经下载的任何损坏的图像。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="ebb3" class="kt ig hi kp b fi ku kv l kw kx">#remove failed files<br/>failed.map(Path.unlink);</span></pre><p id="7a6a" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">这是它当谈到建立和下载我们的图像。第二部分将包括设置我们的数据加载器，并完成我们的初始基线。第三部分将继续使用迁移学习对我们的spider预测器进行改进。第四部分将构建一个原型，第五部分将把我们的模型投入生产。我最有可能使用SWIFT和ios将我的第一个工作模型部署到苹果商店。在后面的系列中，我们可能会考虑使用flutter来部署一个ios和android应用程序。</p><p id="3add" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">同时，请留意第二部。请务必在medium和以下社交媒体网站上关注我:</p><p id="ef28" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">@ckehl_chris</p><p id="93ed" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">@linked-in_ <a class="ae kn" href="https://www.linkedin.com/in/chris-kehl-552017109/" rel="noopener ugc nofollow" target="_blank"> chriskehl </a></p><p id="c9a2" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">感谢预览，我希望你会喜欢所有即将到来的职位。</p><p id="de5e" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">参考:</p><p id="5bb4" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">霍华德，杰里米；古格，西尔万。利用fastai和PyTorch为编码人员提供深度学习。奥莱利媒体。Kindle版。</p></div></div>    
</body>
</html>