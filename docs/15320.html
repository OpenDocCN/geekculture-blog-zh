<html>
<head>
<title>SerpApi Demo Project: Walmart Coffee Exploratory Data Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SerpApi演示项目:沃尔玛咖啡探索性数据分析</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/serpapi-demo-project-walmart-coffee-exploratory-data-analysis-315908eb1003?source=collection_archive---------13-----------------------#2022-10-25">https://medium.com/geekculture/serpapi-demo-project-walmart-coffee-exploratory-data-analysis-315908eb1003?source=collection_archive---------13-----------------------#2022-10-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/538e29b5a20bdfdf7ad5e9695726efa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CUxkTh0hoSdig-PuFuusNQ.png"/></div></div></figure><div class=""/><h1 id="48aa" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">介绍</h1><p id="eb3c" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">这个Python演示项目实际展示了如何使用SerpApi的<a class="ae km" href="https://serpapi.com/walmart-search-api" rel="noopener ugc nofollow" target="_blank">沃尔玛搜索引擎结果API </a>以及如何将提取的数据用于探索性数据分析。</p><p id="7798" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">SerpApi 是一个Api，让你从<a class="ae km" href="https://serpapi.com/search-api" rel="noopener ugc nofollow" target="_blank"> 26个搜索引擎</a>以<a class="ae km" href="https://serpapi.com/integrations" rel="noopener ugc nofollow" target="_blank"> 10种语言</a>接收结构化的JSON数据。</p><p id="6ef9" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">你可以在GitHub上自己探索这个项目:<code class="du ks kt ku kv b"><a class="ae km" href="https://github.com/dimitryzub/walmart-stores-coffee-analysis" rel="noopener ugc nofollow" target="_blank">dimitryzub/walmart-stores-coffee-analysis</a></code></p><p id="259f" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">我们将涵盖:</p><ol class=""><li id="e392" class="kw kx ht jq b jr kn jv ko jz ky kd kz kh la kl lb lc ld le bi translated">从沃尔玛有机结果中提取数据。</li><li id="39d6" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lb lc ld le bi translated">使用SerpApi分页从所有商店页面提取数据。</li><li id="58e0" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lb lc ld le bi translated">从500家沃尔玛商店提取数据。<a class="ae km" href="https://serpapi.com/walmart-stores" rel="noopener ugc nofollow" target="_blank"> SerpApi向JSON Walmart商店位置</a>提供总共4.460家商店。</li><li id="f998" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lb lc ld le bi translated">我探索性数据分析的全过程。</li></ol><p id="b671" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">📌注意:下面的脚本以一种<code class="du ks kt ku kv b">sync</code>的方式提取数据，这种方式比较慢。</p><p id="33d5" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">SerpApi提供了<code class="du ks kt ku kv b"><a class="ae km" href="https://github.com/serpapi/google-search-results-python#batch-asynchronous-searches" rel="noopener ugc nofollow" target="_blank">async</a></code> <a class="ae km" href="https://github.com/serpapi/google-search-results-python#batch-asynchronous-searches" rel="noopener ugc nofollow" target="_blank">参数</a>，允许处理更多的结果，而无需等待SerpApi响应。这些结果将在SerpApi后端进行处理，并且可以在31天内检索到<a class="ae km" href="https://serpapi.com/search-archive-api" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="7a10" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">如果你对提取不到5小时的大量数据(10.000多个请求)感兴趣，<a class="ae km" href="https://serpapi.com/blog/#/portal/signup/free" rel="noopener ugc nofollow" target="_blank">注册我们的博客</a>，这样你就不会错过了。</p><h1 id="6d7c" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">提取沃尔玛数据</h1><h1 id="da6a" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">说明</h1><p id="05b9" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">首先，我们需要安装库:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="23c2" class="ls ir ht kv b fi lt lu l lv lw">$ pip install pandas matplotlib seaborn jinja2 google-search-results</span></pre><ul class=""><li id="54d7" class="kw kx ht jq b jr kn jv ko jz ky kd kz kh la kl lx lc ld le bi translated"><code class="du ks kt ku kv b"><a class="ae km" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">pandas</a></code>强大的数据分析操纵工具。</li><li id="08ce" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated"><code class="du ks kt ku kv b"><a class="ae km" href="https://matplotlib.org/stable/" rel="noopener ugc nofollow" target="_blank">matplotlib</a>Matplotlib</code>是一个用于可视化数据的综合Python库。</li><li id="81a5" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated"><code class="du ks kt ku kv b"><a class="ae km" href="https://seaborn.pydata.org/" rel="noopener ugc nofollow" target="_blank">seaborn</a></code>一个建立在<code class="du ks kt ku kv b">matplotlib</code>之上的高级界面，用于绘制有吸引力和信息丰富的统计图形。</li><li id="19f2" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated"><code class="du ks kt ku kv b"><a class="ae km" href="https://jinja.palletsprojects.com/en/3.1.x/" rel="noopener ugc nofollow" target="_blank">jinja2</a></code> Python模板引擎。用于<code class="du ks kt ku kv b">pandas</code>工作台即。</li><li id="945c" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated"><code class="du ks kt ku kv b"><a class="ae km" href="https://github.com/serpapi/google-search-results-python" rel="noopener ugc nofollow" target="_blank">google-search-results</a></code> SerpApi Python API包装器。</li></ul><p id="bf2d" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">其次，我们需要导入库</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="e234" class="ls ir ht kv b fi lt lu l lv lw">from serpapi import WalmartSearch<br/>from urllib.parse import (parse_qsl, urlsplit)<br/>import pandas as pd<br/>import os, re, json</span></pre><ul class=""><li id="0447" class="kw kx ht jq b jr kn jv ko jz ky kd kz kh la kl lx lc ld le bi translated"><code class="du ks kt ku kv b"><a class="ae km" href="https://docs.python.org/3/library/urllib.parse.html" rel="noopener ugc nofollow" target="_blank">urllib.parse</a></code>用于SerpApi分页目的。</li><li id="78ba" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated"><code class="du ks kt ku kv b"><a class="ae km" href="https://docs.python.org/3/library/os.html" rel="noopener ugc nofollow" target="_blank">os</a></code>读取秘密API密钥。不要公开展示你的API密匙。</li><li id="05c1" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated"><code class="du ks kt ku kv b"><a class="ae km" href="https://docs.python.org/3/library/re.html" rel="noopener ugc nofollow" target="_blank">re</a></code>从<code class="du ks kt ku kv b">string</code>中提取部分数据。</li><li id="8627" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated"><code class="du ks kt ku kv b"><a class="ae km" href="https://docs.python.org/3/library/json.html" rel="noopener ugc nofollow" target="_blank">json</a></code>大部分用于漂亮印刷。</li></ul><p id="6e9b" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">接下来，我们读取沃尔玛商店的JSON文件:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="a7b5" class="ls ir ht kv b fi lt lu l lv lw"># to get store ID<br/>store_ids = pd.read_json('&lt;path_to&gt;/walmart-stores.json')</span></pre><p id="112c" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">接下来，我们创建一个咖啡类型的常量变量。这将用于稍后从列表的标题中检查咖啡类型:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="3f6c" class="ls ir ht kv b fi lt lu l lv lw">COFFEE_TYPES = [<br/>    'Espresso',<br/>    '...',<br/>    'Black Ivory Coffee'<br/>]</span></pre><p id="4492" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">之后，我们迭代<code class="du ks kt ku kv b">store_ids</code>并将商店id传递给<code class="du ks kt ku kv b"><a class="ae km" href="https://serpapi.com/walmart-search-api#api-parameters-advanced-filters-store-id" rel="noopener ugc nofollow" target="_blank">store_id</a></code> <a class="ae km" href="https://serpapi.com/walmart-search-api#api-parameters-advanced-filters-store-id" rel="noopener ugc nofollow" target="_blank"> SerpApi查询参数</a>:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="8ae5" class="ls ir ht kv b fi lt lu l lv lw">for store_id in store_ids['store_id']:<br/>    params = {<br/>        'api_key': os.getenv('API_KEY'),  # serpapi api key<br/>        'engine': 'walmart',              # search engine<br/>        'device': 'desktop',              # device type<br/>        'query': 'coffee',                # search query<br/>        'store_id': store_id<br/>    }</span><span id="f1e3" class="ls ir ht kv b fi ly lu l lv lw">    search = WalmartSearch(params)       # where data extraction happens</span></pre><p id="2250" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">在下一步中，我们需要创建一个<code class="du ks kt ku kv b">list</code>来临时存储提取的数据，并创建一个仅用于演示的页码计数器:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="ee14" class="ls ir ht kv b fi lt lu l lv lw">data = []<br/>page_num = 0</span></pre><p id="2ca7" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">下一步是创建一个<code class="du ks kt ku kv b">while</code>循环，它将遍历所有商店页面:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="dd3f" class="ls ir ht kv b fi lt lu l lv lw">while True:<br/>    results = search.get_json()      # JSON -&gt; Python dict</span></pre><p id="5db7" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">之后，我们需要检查SerpApi是否返回了任何错误，如果有，则检查<code class="du ks kt ku kv b">break</code>:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="2abf" class="ls ir ht kv b fi lt lu l lv lw">if results['search_information']['organic_results_state'] == 'Fully empty':<br/>    print(results['error'])<br/>    break</span></pre><p id="1d57" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">增加一个页面计数器并打印出来:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="80b0" class="ls ir ht kv b fi lt lu l lv lw">page_num += 1<br/>print(f'Current page: {page_num}')</span></pre><p id="1591" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">之后，我们需要提取数据，并尽可能将其标准化:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="e9cf" class="ls ir ht kv b fi lt lu l lv lw">for result in results.get('organic_results', []):<br/>    title = result.get('title').lower()</span><span id="9e10" class="ls ir ht kv b fi ly lu l lv lw">    # https://regex101.com/r/h0jTPG/1<br/>    try:<br/>        weight = re.search(r'(\d+-[Ounce|ounce]+|\d{1,3}\.?\d{1,2}[\s|-]?[ounce|oz]+)', title).group(1)<br/>    except: weight = 'not mentioned'</span><span id="1228" class="ls ir ht kv b fi ly lu l lv lw">    # ounce -&gt; grams<br/>    # formula: https://www.omnicalculator.com/conversion/g-to-oz#how-to-convert-grams-to-ounces<br/>    # https://regex101.com/r/wWMUQd/1<br/>    if weight != 'not mentioned':<br/>        weight_formatted_to_gramms = round(float(re.sub(r'[^\d.]+', '', weight)) * 28.34952/1, 1)</span><span id="5074" class="ls ir ht kv b fi ly lu l lv lw">    # loop through COFFEE_TYPES and checks if result.title has coffee type<br/>    # found match or matches will be stored as a list with ',' separator<br/>    coffee_type = ','.join([i for i in COFFEE_TYPES if i.lower() in title])</span></pre><p id="3b56" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">之后，我们需要将数据追加到临时的<code class="du ks kt ku kv b">list</code>:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="5219" class="ls ir ht kv b fi lt lu l lv lw">data.append({<br/>    'title': title,<br/>    'coffee_type': coffee_type.lower(),<br/>    'rating': result.get('rating'),<br/>    'reviews': result.get('reviews'),<br/>    'seller_name': result.get('seller_name').lower() if result.get('seller_name') else result.get('seller_name'),<br/>    'thumbnail': result.get('thumbnail'),<br/>    'price': result.get('primary_offer').get('offer_price'),<br/>    'weight': weight,<br/>    'weight_formatted_to_gramms': weight_formatted_to_gramms<br/>})</span></pre><p id="f7e8" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">然后检查<code class="du ks kt ku kv b">serpapi_pagination</code>哈希键中是否有<code class="du ks kt ku kv b">next</code>页并分页，否则<code class="du ks kt ku kv b">break</code><code class="du ks kt ku kv b">while</code>循环:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="e860" class="ls ir ht kv b fi lt lu l lv lw"># check if the next page key is present in the JSON<br/># if present -&gt; split URL in parts and update to the next page<br/>if 'next' in results.get('serpapi_pagination', {}):<br/>    search.params_dict.update(dict(parse_qsl(urlsplit(results.get('serpapi_pagination', {}).get('next')).query)))<br/>else:<br/>    break</span></pre><p id="db01" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">最后，在所有循环完成后，我们需要保存数据。我用<code class="du ks kt ku kv b">pandas</code> <code class="du ks kt ku kv b"><a class="ae km" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_csv.html" rel="noopener ugc nofollow" target="_blank">to_csv</a></code>和<code class="du ks kt ku kv b"><a class="ae km" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_json.html" rel="noopener ugc nofollow" target="_blank">to_json</a></code>方法选择JSON和CSV:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="6aad" class="ls ir ht kv b fi lt lu l lv lw">pd.DataFrame(data=data).to_json('coffee-listings-from-all-walmart-stores.json', orient='records')<br/>pd.DataFrame(data=data).to_csv('coffee-listings-from-all-walmart-stores.csv', index=False)</span></pre><h1 id="e5f9" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">完整代码</h1><p id="bc69" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在线IDE  (Replit)中也有一个<a class="ae km" href="https://replit.com/@DimitryZub1/Scrape-Walmart-Listings-from-Walmart-Stores-with-Pagination#main.py" rel="noopener ugc nofollow" target="_blank">代码示例，您可以随意使用:</a></p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="03dd" class="ls ir ht kv b fi lt lu l lv lw">from serpapi import WalmartSearch<br/>from urllib.parse import (parse_qsl, urlsplit)<br/>import pandas as pd<br/>import os, re, json<br/></span><span id="3023" class="ls ir ht kv b fi ly lu l lv lw">store_ids = pd.read_json('&lt;path_to&gt;/walmart-stores.json')</span><span id="5311" class="ls ir ht kv b fi ly lu l lv lw">COFFEE_TYPES = [<br/>    'Espresso',<br/>    'Double Espresso',<br/>    'Red Eye',<br/>    'caramel flavored',<br/>    'caramel',<br/>    'colombian',<br/>    'french',<br/>    'italian',<br/>    'Black Eye',<br/>    'Americano',<br/>    'Long Black',<br/>    'Macchiato',<br/>    'Long Macchiato',<br/>    'Cortado',<br/>    'Breve',<br/>    'Cappuccino',<br/>    'Flat White',<br/>    'Cafe Latte',<br/>    'Mocha',<br/>    'Vienna',<br/>    'Affogato',<br/>    'gourmet coffee',<br/>    'Cafe au Lait',<br/>    'Iced Coffee',<br/>    'Drip Coffee',<br/>    'French Press',<br/>    'Cold Brew Coffee',<br/>    'Pour Over Coffee',<br/>    'Cowboy Coffee',<br/>    'Turkish Coffee',<br/>    'Percolated Coffee',<br/>    'Infused Coffee',<br/>    'Vacuum Coffee',<br/>    'Moka Pot Coffee',<br/>    'Espresso Coffee',<br/>    'Antoccino',<br/>    'Cafe Bombon',<br/>    'Latte',<br/>    'City roast',<br/>    'American roast',<br/>    'Half City roast',<br/>    'New England roast',<br/>    'Light City roast',<br/>    'Blonde roast',<br/>    'Cinnamon roast',<br/>    'Breakfast roast',<br/>    'Full City roast',<br/>    'Continental roast',<br/>    'High roast',<br/>    'New Orleans roast',<br/>    'Espresso roast',<br/>    'Viennese roast',<br/>    'European roast',<br/>    'French roast',<br/>    'Italian roast',<br/>    'Galao',<br/>    'Caffe Americano',<br/>    'Cafe Cubano',<br/>    'Cafe Zorro',<br/>    'Doppio',<br/>    'Espresso Romano',<br/>    'Guillermo',<br/>    'Ristretto',<br/>    'Cafe au lait ',<br/>    'Coffee with Espresso',<br/>    'Dead eye',<br/>    'Botz',<br/>    'Nitro Coffee',<br/>    'Bulletproof Coffee',<br/>    'Black tie',<br/>    'Red tie',<br/>    'Dirty chai latte',<br/>    'Yuenyeung',<br/>    "Bailey's Irish Cream and Coffee",<br/>    'Caffè Corretto',<br/>    'Rüdesheimer Kaffee',<br/>    'Pharisee',<br/>    'Barraquito',<br/>    'Carajillo',<br/>    'Irish coffee',<br/>    'Melya',<br/>    'Espressino',<br/>    'Caffè Marocchino',<br/>    'Café miel',<br/>    'Cafe Borgia',<br/>    'Café de olla',<br/>    'Café Rápido y Sucio',<br/>    'Coffee with a flavor shot',<br/>    'Caffè Medici',<br/>    'Egg coffee',<br/>    'Kopi susu',<br/>    'Vienna Coffee',<br/>    'Iced lattes',<br/>    'Iced mochas',<br/>    'Ca phe sua da',<br/>    'Eiskaffee',<br/>    'Frappé',<br/>    'Freddo Espresso',<br/>    'Freddo Cappuccino',<br/>    'Mazagran',<br/>    'Palazzo',<br/>    'Ice Shot',<br/>    'Shakerato',<br/>    'Instant Coffee',<br/>    'Canned Coffee',<br/>    'Coffee Milk',<br/>    'South Indian Coffee',<br/>    'Pocillo',<br/>    'Arabica',<br/>    'Robusta Beans',<br/>    'Liberica Beans',<br/>    'Excelsa Beans',<br/>    'White Roast Coffee',<br/>    'Light Roast',<br/>    'Medium Roast',<br/>    'Medium-Dark Roast',<br/>    'medium dark',<br/>    'medium dark roast',<br/>    'Classic Roast',<br/>    'black silk ground coffee',<br/>    'black rifle coffee',<br/>    'Dark Roast',<br/>    'Kopi Luwak Coffee',<br/>    'Jacu Bird Coffee',<br/>    'Black Ivory Coffee'<br/>]</span><span id="43e2" class="ls ir ht kv b fi ly lu l lv lw">for store_id in store_ids['store_id']:<br/>    params = {<br/>        'api_key': os.getenv('API_KEY'),  # serpapi api key<br/>        'engine': 'walmart',              # search engine<br/>        'device': 'desktop',              # device type<br/>        'query': 'coffee',                # search query<br/>        'store_id': store_id<br/>    }</span><span id="de93" class="ls ir ht kv b fi ly lu l lv lw">    search = WalmartSearch(params)       # where data extraction happens<br/>    print(params)                        # just to show the progress</span><span id="6416" class="ls ir ht kv b fi ly lu l lv lw">    data = []<br/>    page_num = 0</span><span id="5416" class="ls ir ht kv b fi ly lu l lv lw">    while True:<br/>        results = search.get_json()      # JSON -&gt; Python dict</span><span id="193a" class="ls ir ht kv b fi ly lu l lv lw">        if results['search_information']['organic_results_state'] == 'Fully empty':<br/>            print(results['error'])<br/>            break</span><span id="cb2b" class="ls ir ht kv b fi ly lu l lv lw">        page_num += 1<br/>        print(f'Current page: {page_num}')</span><span id="38d2" class="ls ir ht kv b fi ly lu l lv lw">        for result in results.get('organic_results', []):<br/>            title = result.get('title').lower() if result.get('title') else result.get('title')</span><span id="b38b" class="ls ir ht kv b fi ly lu l lv lw">            # https://regex101.com/r/h0jTPG/1<br/>            try:<br/>                weight = re.search(r'(\d+-[Ounce|ounce]+|\d{1,3}\.?\d{1,2}[\s|-]?[ounce|oz]+)', title).group(1)<br/>            except: weight = 'not mentioned'</span><span id="d1da" class="ls ir ht kv b fi ly lu l lv lw">            # ounce -&gt; grams<br/>            # formula: https://www.omnicalculator.com/conversion/g-to-oz#how-to-convert-grams-to-ounces<br/>            # https://regex101.com/r/wWMUQd/1<br/>            if weight != 'not mentioned':<br/>                weight_formatted_to_gramms = round(float(re.sub(r'[^\d.]+', "", weight)) * 28.34952/1, 1)</span><span id="2b77" class="ls ir ht kv b fi ly lu l lv lw">            coffee_type = ",".join([i for i in COFFEE_TYPES if i.lower() in title])</span><span id="d334" class="ls ir ht kv b fi ly lu l lv lw">            data.append({<br/>                'title': title,<br/>                'coffee_type': coffee_type.lower(),<br/>                'rating': result.get('rating'),<br/>                'reviews': result.get('reviews'),<br/>                'seller_name': result.get('seller_name').lower() if result.get('seller_name') else result.get('seller_name'),<br/>                'thumbnail': result.get('thumbnail'),<br/>                'price': result.get('primary_offer').get('offer_price'),<br/>                'weight': weight,<br/>                'weight_formatted_to_gramms': weight_formatted_to_gramms<br/>            })</span><span id="8f53" class="ls ir ht kv b fi ly lu l lv lw">        # check if the next page key is present in the JSON<br/>        # if present -&gt; split URL in parts and update to the next page<br/>        if 'next' in results.get('serpapi_pagination', {}):<br/>            search.params_dict.update(dict(parse_qsl(urlsplit(results.get('serpapi_pagination', {}).get('next')).query)))<br/>        else:<br/>            break</span><span id="23a9" class="ls ir ht kv b fi ly lu l lv lw">pd.DataFrame(data=data).to_json('coffee-listings-from-all-walmart-stores.json', orient='records')<br/>pd.DataFrame(data=data).to_csv('coffee-listings-from-all-walmart-stores.csv', index=False)</span></pre><h1 id="e7c8" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">探索性分析</h1><h1 id="b9d9" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">关键要点</h1><ol class=""><li id="77d2" class="kw kx ht jq b jr js jv jw jz lz kd ma kh mb kl lb lc ld le bi translated">最受欢迎的咖啡销售商是沃尔玛。</li><li id="f1f5" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lb lc ld le bi translated">最受欢迎的咖啡类型是中度烘焙。</li><li id="897e" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lb lc ld le bi translated">更多的重量(克)并不等于更高的价格。</li></ol><ul class=""><li id="1c26" class="kw kx ht jq b jr kn jv ko jz ky kd kz kh la kl lx lc ld le bi translated">低克咖啡可能比高克咖啡贵。</li></ul><ol class=""><li id="4e46" class="kw kx ht jq b jr kn jv ko jz ky kd kz kh la kl lb lc ld le bi translated">最高的咖啡重量是2835克(2.8公斤)。</li><li id="4f57" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lb lc ld le bi translated">“Folgers classic roast ground coffee”有15k+评论，这是数据集的最大值。</li><li id="8e12" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lb lc ld le bi translated">大约300-500克是最常见的重量。</li><li id="a70a" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lb lc ld le bi translated">最高的咖啡价格是77美元(Lavazza perfetto单杯k杯)</li></ol><h1 id="c487" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">要回答的问题</h1><p id="1ab5" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我在探索之初就写下了那些问题，以跟踪他们的进展。请记住，这些问题只反映了我的个人兴趣。</p><ul class=""><li id="9e53" class="kw kx ht jq b jr kn jv ko jz ky kd kz kh la kl lx lc ld le bi translated">什么咖啡标题评论最多？</li><li id="bf5e" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">什么咖啡名最有收视率？</li><li id="0a01" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">最受欢迎的畅销书是什么？</li><li id="b729" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">什么咖啡名的价格最高/最低？</li><li id="08f5" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">总重量是多少克？</li><li id="df68" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">什么咖啡的重量最高/最低(克)？</li><li id="8998" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">最受欢迎的咖啡类型是什么？</li><li id="07d0" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">最常喝的咖啡克数？</li><li id="4993" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">总重量是多少克？</li><li id="3885" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">更高的重量(克)=更高的价格？</li><li id="c92f" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">更低的重量(克)=更低的价格？</li></ul><h1 id="b2b8" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">过程</h1><p id="faec" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">安装库并告诉<code class="du ks kt ku kv b"><a class="ae km" href="https://matplotlib.org/stable/" rel="noopener ugc nofollow" target="_blank">matplotlib</a></code>在<code class="du ks kt ku kv b"><a class="ae km" href="https://ipython.readthedocs.io/en/stable/interactive/tutorial.html#magics-explained" rel="noopener ugc nofollow" target="_blank">%</a></code> <a class="ae km" href="https://ipython.readthedocs.io/en/stable/interactive/tutorial.html#magics-explained" rel="noopener ugc nofollow" target="_blank">神奇函数</a>的帮助下内联绘图(在笔记本内部)，该函数将<code class="du ks kt ku kv b">matplotlib</code>的后端设置为<code class="du ks kt ku kv b">inline</code>后端:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="5609" class="ls ir ht kv b fi lt lu l lv lw">%pip install pandas matplotlib seaborn jinja2 # install libraries<br/>%matplotlib inline</span></pre><p id="9fed" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">接下来，我们导入之前使用<a class="ae km" href="https://serpapi.com/walmart-search-api" rel="noopener ugc nofollow" target="_blank">沃尔玛搜索引擎结果API </a>从SerpApi中提取的<code class="du ks kt ku kv b"><a class="ae km" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">pandas</a></code>和<code class="du ks kt ku kv b"><a class="ae km" href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html" rel="noopener ugc nofollow" target="_blank">read_csv()</a></code>:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="fec8" class="ls ir ht kv b fi lt lu l lv lw">import pandas as pd</span><span id="4712" class="ls ir ht kv b fi ly lu l lv lw">coffee_df = pd.read_csv('/workspace/serpapi-demo-projects/walmart-coffee-analysis/data/coffee-listings-from-all-walmart-stores.csv')<br/>coffee_df.head()</span></pre><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mc"><img src="../Images/dfe9e18edef186ed7d5e794bbe738013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SAIZsnbK4Mg8RsHt.png"/></div></div></figure><p id="36f0" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">现在我想检查一下关于<code class="du ks kt ku kv b"><a class="ae km" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank">DataFrame</a></code>的全部信息。在这里，我正在查看每一列的<code class="du ks kt ku kv b">Dtype</code>，如果它是正确的:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="5121" class="ls ir ht kv b fi lt lu l lv lw">coffee_df.info()</span></pre><p id="da54" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">产出:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="b015" class="ls ir ht kv b fi lt lu l lv lw">&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>RangeIndex: 1400 entries, 0 to 1399<br/>Data columns (total 9 columns):<br/>  #   Column                      Non-Null Count  Dtype  <br/>---  ------                      --------------  -----  <br/>  0   title                       1400 non-null   object <br/>  1   coffee_type                 1121 non-null   object <br/>  2   rating                      1400 non-null   float64<br/>  3   reviews                     1400 non-null   int64  <br/>  4   seller_name                 1400 non-null   object <br/>  5   thumbnail                   1400 non-null   object <br/>  6   price                       1400 non-null   float64<br/>  7   weight                      1400 non-null   object <br/>  8   weight_formatted_to_gramms  1400 non-null   float64<br/>dtypes: float64(3), int64(1), object(5)<br/>memory usage: 98.6+ KB</span></pre><p id="1f63" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">接下来，我希望看到整体数字信息，如平均值、最小值、最大值，以及它们是否有意义:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="224c" class="ls ir ht kv b fi lt lu l lv lw">coffee_df.describe()</span></pre><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es md"><img src="../Images/965744e6b605ba879791b47746e728d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Im-o-60Vr8pSSio1.png"/></div></div></figure><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="9da3" class="ls ir ht kv b fi lt lu l lv lw">coffee_df.shape</span><span id="65e7" class="ls ir ht kv b fi ly lu l lv lw"># (1400, 9)</span></pre><p id="40d4" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">这里我想使用<code class="du ks kt ku kv b"><a class="ae km" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.corr.html" rel="noopener ugc nofollow" target="_blank">DataFrame.corr()</a></code>快速浏览一下数字列之间的相关性:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="c6c4" class="ls ir ht kv b fi lt lu l lv lw">import seaborn as sns<br/>import matplotlib as plt</span><span id="ff39" class="ls ir ht kv b fi ly lu l lv lw">ax = sns.heatmap(coffee_df.corr(numeric_only=True), annot=True, cmap='Blues')<br/>ax.set_title('Correlation between variables')</span></pre><p id="178a" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">在这里，我们可以看到咖啡的重量和价格之间有很小的关联，这很符合逻辑:</p><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es me"><img src="../Images/81dff28159eefb357e57c851aaa7f3ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9SgRCRQ-JtL7Lgkz.png"/></div></div></figure><h2 id="e884" class="ls ir ht bd is mf mg mh iw mi mj mk ja jz ml mm je kd mn mo ji kh mp mq jm mr bi translated">什么咖啡标题评论最多？</h2><p id="8aae" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">答案:福尔杰经典烘焙研磨咖啡，中等ro… / 15148评论</p><h2 id="e61b" class="ls ir ht bd is mf mg mh iw mi mj mk ja jz ml mm je kd mn mo ji kh mp mq jm mr bi translated">什么咖啡名最有收视率？</h2><p id="1811" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">答案:社区咖啡馆特殊脱咖啡因中深烘焙咖啡单杯36 ct盒装兼容keurig 2.0 k杯啤酒/5级和108级评论</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="a440" class="ls ir ht kv b fi lt lu l lv lw">coffee_df.query('reviews == reviews.max()')[['title', 'reviews']]</span></pre><figure class="lk ll lm ln fd hk er es paragraph-image"><div class="er es ms"><img src="../Images/c818b5c142552d590d89be1ae1a89892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/0*FYaJas0efEg7pc4h.png"/></div></figure><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="b697" class="ls ir ht kv b fi lt lu l lv lw">coffee_df.query('rating == rating.max()')[['title', 'rating', 'reviews']].sort_values(<br/>    by='reviews', ascending=False<br/>).style.hide(axis='index').background_gradient(cmap='Blues')</span></pre><h2 id="da82" class="ls ir ht bd is mf mg mh iw mi mj mk ja jz ml mm je kd mn mo ji kh mp mq jm mr bi translated">最受欢迎的畅销书是什么？</h2><p id="7f4d" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">答案:沃尔玛</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="256e" class="ls ir ht kv b fi lt lu l lv lw">plt.title('Most Popular Coffee Seller on Walmart')</span><span id="93a5" class="ls ir ht kv b fi ly lu l lv lw"># value_counts() to count how many times each seller is repeated<br/># head() display only top 10<br/># sort_values() to sort from highest to lowest<br/># and plot the data</span><span id="aafa" class="ls ir ht kv b fi ly lu l lv lw">ax = coffee_df['seller_name'].value_counts().head(10).sort_values().plot(kind='barh', figsize=(13,5))<br/>ax.bar_label(ax.containers[0])</span><span id="b588" class="ls ir ht kv b fi ly lu l lv lw">plt.xlabel('Number of listings')<br/>plt.show()</span></pre><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mc"><img src="../Images/c4a4a27cf0c5c9459d8dc8f2b287765c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2RA3Gpl0opknxbkM.png"/></div></div></figure><h2 id="84b4" class="ls ir ht bd is mf mg mh iw mi mj mk ja jz ml mm je kd mn mo ji kh mp mq jm mr bi translated">总重量是多少克？</h2><p id="d758" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">答案:869948.5克，也就是870公斤🤓</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="40f1" class="ls ir ht kv b fi lt lu l lv lw"># sum of the all grams<br/>grams = coffee_df['weight_formatted_to_gramms'].sum()<br/>kilorgrams = round(coffee_df['weight_formatted_to_gramms'].sum() / 1000)</span><span id="e976" class="ls ir ht kv b fi ly lu l lv lw">print(f'Grams: {grams}\nKilograms: {kilorgrams}')</span><span id="d8dc" class="ls ir ht kv b fi ly lu l lv lw">Grams: 869948.5<br/>Kilograms: 870</span></pre><h2 id="9077" class="ls ir ht bd is mf mg mh iw mi mj mk ja jz ml mm je kd mn mo ji kh mp mq jm mr bi translated">什么咖啡名的价格最高/最低？</h2><p id="fd2f" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">回答最高:lavazza perfetto keurig brewer单杯k杯咖啡盒，深色烘焙，10盒(每盒6个)/价格77.09美元</p><p id="01ca" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">回答最低:</p><ul class=""><li id="a67f" class="kw kx ht jq b jr kn jv ko jz ky kd kz kh la kl lx lc ld le bi translated">folgers经典烘焙速溶咖啡，单份包装/价格1美元</li><li id="675c" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">经典无咖啡因速溶咖啡水晶包，6支/价格1美元</li></ul><p id="03e0" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">最高价格</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="690e" class="ls ir ht kv b fi lt lu l lv lw"># https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.query.html<br/>coffee_df.query('price == price.max()')[['title', 'price']]</span></pre><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mt"><img src="../Images/451cbef894f1d8b91fbe6cbc36136c25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WaI7owrhSYxHlTF-b2UG6w.png"/></div></div></figure><p id="6f52" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">最低价格</p><ul class=""><li id="1e38" class="kw kx ht jq b jr kn jv ko jz ky kd kz kh la kl lx lc ld le bi translated">folgers经典烘焙速溶咖啡，单份包装/价格1美元</li><li id="be59" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">folgers经典无咖啡因速溶咖啡水晶包，6支/价格1美元</li></ul><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="4762" class="ls ir ht kv b fi lt lu l lv lw"># condition with .min() won't work: coffee_df.loc[(coffee_df['price'] != 0) &amp; (coffee_df['price'].min()), ['price']]</span><span id="4158" class="ls ir ht kv b fi ly lu l lv lw"># != 0 to exclude 0 values<br/>coffee_df.loc[(coffee_df['price'] != 0) &amp; (coffee_df['price'] &lt; 1.1), ['title', 'price']]</span></pre><figure class="lk ll lm ln fd hk er es paragraph-image"><div class="er es mu"><img src="../Images/30d8315427c7a7e188a473059de74d2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*l875PUBcG20oXbIC5DNeAQ.png"/></div></figure><h2 id="9612" class="ls ir ht bd is mf mg mh iw mi mj mk ja jz ml mm je kd mn mo ji kh mp mq jm mr bi translated">什么咖啡的重量最高/最低(克)？</h2><p id="b1ad" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">回答最高:</p><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mv"><img src="../Images/6cfb62c73ae53859ad0f59b69feb4e04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AupY1x_tezWS4mdzcpw3dw.png"/></div></div></figure><p id="8f70" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">回答最低:</p><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mw"><img src="../Images/9e9aecdad121cc97d7eee9a48d9699ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2OsWrZ4Q7GM_UsiS9CyJlQ.png"/></div></div></figure><p id="4776" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">最高重量</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="1e1e" class="ls ir ht kv b fi lt lu l lv lw">coffee_df.query('weight_formatted_to_gramms == weight_formatted_to_gramms.max()')[<br/>    ['title', 'weight_formatted_to_gramms']<br/>]</span></pre><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mx"><img src="../Images/e3a7e61428c21771151428f12a618bbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N0Ahkl5-LdU3MKwW7YATcg.png"/></div></div></figure><p id="bff2" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">最低重量</p><p id="21e6" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">由于未正确提取数据，有7个指数的值为0.0。</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="37f9" class="ls ir ht kv b fi lt lu l lv lw">coffee_df.query('weight_formatted_to_gramms == weight_formatted_to_gramms.min()')[<br/>    'weight_formatted_to_gramms'<br/>]</span></pre><p id="72f9" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">产出:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="226e" class="ls ir ht kv b fi lt lu l lv lw">305     0.0<br/>425     0.0<br/>703     0.0<br/>890     0.0<br/>957     0.0<br/>991     0.0<br/>1188    0.0<br/>Name: weight_formatted_to_gramms, dtype: float64</span></pre><p id="bf83" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">我决定检查重量不等于<code class="du ks kt ku kv b">0</code> <code class="du ks kt ku kv b">and</code>重量不高于<code class="du ks kt ku kv b">10</code>克:</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="2ddb" class="ls ir ht kv b fi lt lu l lv lw">coffee_df.loc[<br/>    (coffee_df['weight_formatted_to_gramms'] != 0.0)<br/>    &amp; (coffee_df['weight_formatted_to_gramms'] &lt; 10),<br/>    ['title', 'weight_formatted_to_gramms'],<br/>]</span></pre><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es my"><img src="../Images/83c50db6264dc4b17cdfc68ab14b1806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OqSwZJyuRDHOYZQdnkSdJg.png"/></div></div></figure><h2 id="5910" class="ls ir ht bd is mf mg mh iw mi mj mk ja jz ml mm je kd mn mo ji kh mp mq jm mr bi translated">最受欢迎的咖啡类型是什么？</h2><p id="0890" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">答案(前3名):</p><ol class=""><li id="7cc0" class="kw kx ht jq b jr kn jv ko jz ky kd kz kh la kl lb lc ld le bi translated">中度烘焙</li><li id="4f8c" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lb lc ld le bi translated">深色烤肉</li><li id="2c3b" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lb lc ld le bi translated">阿拉伯咖啡</li></ol><p id="b543" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">📌注意:有125种不同的咖啡，其中一些可能会丢失。</p><p id="482e" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">看看<code class="du ks kt ku kv b">extraction.py</code>下的<code class="du ks kt ku kv b">COFFEE_TYPES</code>和<code class="du ks kt ku kv b">list</code></p><p id="f443" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">拆分咖啡类型并扩展到一个新的列表中</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="d11c" class="ls ir ht kv b fi lt lu l lv lw"># https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.fillna.html<br/>coffee_types = coffee_df['coffee_type'].fillna(method='ffill') # fill with None</span><span id="e727" class="ls ir ht kv b fi ly lu l lv lw">coffee_types_new = []</span><span id="e034" class="ls ir ht kv b fi ly lu l lv lw"># split by comma and extend the new list with split values<br/># https://stackoverflow.com/a/27886807/15164646<br/>for coffee_type in coffee_types:<br/>    coffee_types_new.extend(coffee_type.split(','))</span></pre><p id="67ae" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">获取最常见的咖啡类型</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="b82b" class="ls ir ht kv b fi lt lu l lv lw">coffee_types_new_series = pd.Series(coffee_types_new).dropna()</span><span id="ba3e" class="ls ir ht kv b fi ly lu l lv lw">plt.title('Most Popular Coffee Types')</span><span id="ea86" class="ls ir ht kv b fi ly lu l lv lw">ax = coffee_types_new_series.value_counts().sort_values(ascending=True).plot(kind='barh', figsize=(15,10))<br/>ax.bar_label(ax.containers[0]) # bar annotation</span><span id="252c" class="ls ir ht kv b fi ly lu l lv lw">plt.ylabel('Coffee Type')<br/>plt.xlabel('Number of Occurrences')</span><span id="1469" class="ls ir ht kv b fi ly lu l lv lw">plt.show()</span></pre><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mc"><img src="../Images/abd6ef6bede7024992ec29626ee7926a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sYqCR3pjQHXciQxe.png"/></div></div></figure><h2 id="df47" class="ls ir ht bd is mf mg mh iw mi mj mk ja jz ml mm je kd mn mo ji kh mp mq jm mr bi translated">最常喝的咖啡重量？</h2><p id="5087" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">答案:~ 300–500克</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="31f0" class="ls ir ht kv b fi lt lu l lv lw">sns.jointplot(data=coffee_df, x='price', y='weight_formatted_to_gramms', kind='hex')</span></pre><figure class="lk ll lm ln fd hk er es paragraph-image"><div class="er es mz"><img src="../Images/49f70f233c1a9c392876957c3c693c4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/0*OFZ5Phmhs9wGz2Gn.png"/></div></figure><p id="29e2" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">附加图</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="0d4a" class="ls ir ht kv b fi lt lu l lv lw">g = sns.PairGrid(coffee_df[['price', 'weight_formatted_to_gramms']], height=4)<br/>g.map_upper(sns.histplot)<br/>g.map_lower(sns.kdeplot, fill=True)<br/>g.map_diag(sns.histplot, kde=True)</span></pre><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es na"><img src="../Images/fae52b60785788035d3ec6e25f332147.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sK3z7nw90uyT-GM1.png"/></div></div></figure><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="cb0b" class="ls ir ht kv b fi lt lu l lv lw">sns.displot(<br/>    coffee_df,<br/>    x='price',<br/>    y='weight_formatted_to_gramms',<br/>    kind='kde',<br/>    fill=True,<br/>    thresh=0,<br/>    levels=100,<br/>    cmap='mako',<br/>)</span></pre><figure class="lk ll lm ln fd hk er es paragraph-image"><div class="er es nb"><img src="../Images/c752a3c4d38e882c59b63e32bb7c389f.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/0*NVr4wDEH7FCgw3Fv.png"/></div></figure><h2 id="1c46" class="ls ir ht bd is mf mg mh iw mi mj mk ja jz ml mm je kd mn mo ji kh mp mq jm mr bi translated">更高的重量(克)=更高的价格？</h2><p id="d398" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">答:这取决于数据集。</p><h2 id="428a" class="ls ir ht bd is mf mg mh iw mi mj mk ja jz ml mm je kd mn mo ji kh mp mq jm mr bi translated">更低的重量(克)=更低的价格？</h2><p id="18f0" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">答:这取决于数据集。</p><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="2414" class="ls ir ht kv b fi lt lu l lv lw">sns.jointplot(data=coffee_df, x='price', y='weight_formatted_to_gramms', kind='reg')</span></pre><figure class="lk ll lm ln fd hk er es paragraph-image"><div class="er es mz"><img src="../Images/2d8888aff67fac643b128ffc5ba9a744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/0*8coKgvOUR3JnAOlN.png"/></div></figure><pre class="lk ll lm ln fd lo kv lp lq aw lr bi"><span id="e926" class="ls ir ht kv b fi lt lu l lv lw">ax = sns.scatterplot(<br/>    data=coffee_df,<br/>    x='price',<br/>    y='weight_formatted_to_gramms',<br/>    hue='price',<br/>    size='price',<br/>    sizes=(40, 300),<br/>)</span><span id="66ac" class="ls ir ht kv b fi ly lu l lv lw"># https://stackoverflow.com/a/34579525/15164646<br/>sns.move_legend(ax, 'upper left', bbox_to_anchor=(1, 1.02)) # 1 = X axis, 1.02 = Y axis of the legend.</span></pre><figure class="lk ll lm ln fd hk er es paragraph-image"><div class="er es nc"><img src="../Images/36ce7e2449a66e251b526109d8a1db51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/0*_ZgnUcV5OD76oZhi.png"/></div></figure><h1 id="d5c9" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">结论</h1><p id="0fe0" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在这篇博文中，我们介绍了:</p><ul class=""><li id="5a4b" class="kw kx ht jq b jr kn jv ko jz ky kd kz kh la kl lx lc ld le bi translated"><a class="ae km" href="https://serpapi.com/walmart-search-api" rel="noopener ugc nofollow" target="_blank">沃尔玛引擎结果API </a>。</li><li id="ecc0" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated"><a class="ae km" href="https://serpapi.com/walmart-stores" rel="noopener ugc nofollow" target="_blank">沃尔玛门店位置的JSON</a>。</li><li id="ab79" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">SerpApi分页。</li><li id="66cc" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">用<code class="du ks kt ku kv b">pandas</code>、<code class="du ks kt ku kv b">matplotlib</code>和<code class="du ks kt ku kv b">seaborn</code>进行探索性数据分析。</li><li id="5c14" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">分组</li><li id="6966" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">整理</li><li id="3ae7" class="kw kx ht jq b jr lf jv lg jz lh kd li kh lj kl lx lc ld le bi translated">测绘</li></ul><p id="81bd" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">加入我们的<a class="ae km" href="https://twitter.com/serp_api" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae km" href="https://www.youtube.com/channel/UCUgIHlYBOD3yA3yDIRhg_mg" rel="noopener ugc nofollow" target="_blank">YouTube</a></p><p id="c0ab" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">添加一个<a class="ae km" href="https://github.com/serpapi/public-roadmap/issues" rel="noopener ugc nofollow" target="_blank">特征请求</a>💫还是一个<a class="ae km" href="https://github.com/serpapi/public-roadmap/issues" rel="noopener ugc nofollow" target="_blank"> Bug </a>🐞</p></div></div>    
</body>
</html>