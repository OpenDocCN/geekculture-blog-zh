<html>
<head>
<title>How to Create a Pinterest Clone Part I: Upload Photos</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建Pinterest克隆第一部分:上传照片</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-create-a-pinterest-clone-part-i-upload-photos-a1f385812729?source=collection_archive---------8-----------------------#2022-06-30">https://medium.com/geekculture/how-to-create-a-pinterest-clone-part-i-upload-photos-a1f385812729?source=collection_archive---------8-----------------------#2022-06-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="a815" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">由TigerGraph提供图片分类和搜索的图片托管服务</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/f16dd55d327d434721cae8691114be28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ACKxT22YyjEN1xbaZx32Q.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">The preview of the final product</figcaption></figure><p id="a33c" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj">概述及目标</strong></p><p id="90af" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">Pinterest是一家价值十亿美元的公司，用户数量不断增长。Pinterest与众不同的技术之一是由Pinterest的首席科学家兼斯坦福大学教授Jure Leskovec在<a class="ae kj" href="https://info.tigergraph.com/graph-ai-summit-spring-2021-jure-leskovec" rel="noopener ugc nofollow" target="_blank">的视频</a>中介绍的，他在视频中讲述了Pinterest如何使用数十亿个引脚和电路板的图形信息来增强人工智能，并提供更多相关的推荐和搜索结果。光是大头针就可以生成一个图表，其中照片与公共元数据相关联。这个图形信息也可以用来获得更好的搜索结果。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kk"><img src="../Images/a6ddab99eb42fbc3ebfdd4ed837abd44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t4BDcdK4cx3hwBYm3etzZw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Example of the metadata in a picture (Image from <a class="ae kj" href="https://pixabay.com/illustrations/cat-cat-and-mouse-cute-cute-cat-3552048/" rel="noopener ugc nofollow" target="_blank">Pixabay</a>)</figcaption></figure><p id="25f4" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">本博客系列将一步步向您展示如何构建Pinterest克隆，该克隆使用基本的图像分类算法识别用户上传照片的元数据，并使用TigerGraph的元数据来支持搜索。我们将使用Quasar作为前端，FastAPI作为后端，MongoDB存储照片文件，TigerGraph存储照片元数据和empower搜索。到本博客(第一部分)结束时，您将已经构建了一个支持照片上传和预览的web应用程序。在每一步之后，请随意参考为前端和后端发布的代码！</p><p id="2478" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj">先决条件:</strong></p><p id="bc31" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">建议基本熟悉Typescript、Python和MongoDB，但这不是必需的！请随意探索您感兴趣的部分，并复制其他部分的代码！</p><p id="13e1" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj">第一部分:创建前端、后端和数据库</strong></p><p id="390e" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">让我们首先创建一个名为<code class="du kl km kn ko b">photo_library</code>的目录，它将包含这个项目的所有内容。我们将首先使用<a class="ae kj" href="https://quasar.dev/start/quasar-cli" rel="noopener ugc nofollow" target="_blank"> Quasar-CLI </a>创建我们的前端目录。在<code class="du kl km kn ko b">photo_library</code> <em class="kp"> </em>打开一个终端，输入:</p><pre class="iy iz ja jb fd kq ko kr ks aw kt bi"><span id="e217" class="ku kv hi ko b fi kw kx l ky kz">$ yarn global add @quasar/cli <br/>$ yarn create quasar</span><span id="cffa" class="ku kv hi ko b fi la kx l ky kz"># or:  </span><span id="6f67" class="ku kv hi ko b fi la kx l ky kz">$ npm i -g @quasar/cli <br/>$ npm init quasar</span></pre><p id="b22e" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果你还没有安装yarn和npm，建议安装npm。请参考<a class="ae kj" href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm" rel="noopener ugc nofollow" target="_blank">这里的文档</a>！</p><p id="7026" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">它将安装Quasar-CLI与纱或npm，并开始创建一个Quasar应用程序。当提示输入配置时，请参考:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lb"><img src="../Images/9e207188c27b93e08029314801cca09a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6OpTbja7W8v-xfz72Ugr2Q.png"/></div></div></figure><p id="9ebf" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">酷！它将创建目录<code class="du kl km kn ko b">photo_library/frontend</code>。现在让我们在VSCode(或者您最喜欢的代码编辑器)中打开它。如果我们运行<code class="du kl km kn ko b">$ quasar dev</code>，我们将看到默认的Quasar页面显示在<a class="ae kj" href="http://localhost:8080/#/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/#/</a>上。让我们把它改成这个项目的模板页面。我们可以把下面的代码分别放在<code class="du kl km kn ko b">src/pages/IndexPage.vue</code>和<code class="du kl km kn ko b">src/layouts/MainLayout.vue</code>中。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="635c" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果我们现在运行<code class="du kl km kn ko b">$ quasar dev</code>，我们会看到如下页面:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es le"><img src="../Images/1b09030d052b262e0ce16f890a87261b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jZFczjefIJ0d4JiCYL0nGA.png"/></div></div></figure><p id="1805" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">干得好！它看起来已经(有点)接近我们的最终产品了。</p><p id="0e3f" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们将使用“axios”包向后端发送API请求。让我们导航到<code class="du kl km kn ko b">photo_library/frontend</code>并将<code class="du kl km kn ko b">"axios": "0.27.2"</code>添加到<code class="du kl km kn ko b">package.json</code>的<code class="du kl km kn ko b">"dependencies"</code>中。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lf"><img src="../Images/f897f400b1ddcc7fc3e2f608420f43d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5NtSWhr1XWZnzfE-ouoYMA.png"/></div></div></figure><p id="8fff" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">然后，我们可以跑了</p><pre class="iy iz ja jb fd kq ko kr ks aw kt bi"><span id="f88d" class="ku kv hi ko b fi kw kx l ky kz">$ yarn<br/># or:<br/>$ npm install</span></pre><p id="2ffe" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">安装“axios”软件包。</p><p id="4ab9" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj">所有后续的代码更改将在</strong> <code class="du kl km kn ko b"><strong class="jp hj">src/pages/IndexPage.vue</strong></code> <strong class="jp hj"> </strong>中进行，我们将迭代地接近我们的最终产品。</p></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><p id="bbed" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">让我们继续我们的后端。如果你还没有安装python3，在Mac上请参考<a class="ae kj" href="https://docs.python-guide.org/starting/install3/osx/" rel="noopener ugc nofollow" target="_blank">这个</a>，在Windows上请参考<a class="ae kj" href="https://docs.python.org/3/using/windows.html" rel="noopener ugc nofollow" target="_blank">这个</a>。</p><p id="ffa9" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们将从创建目录<code class="du kl km kn ko b">photo_library/backend</code>和其中的两个文件<code class="du kl km kn ko b">main.py</code>和<code class="du kl km kn ko b">requirements.txt</code>开始。然后，我们在其中放入一些初始代码:</p><pre class="iy iz ja jb fd kq ko kr ks aw kt bi"><span id="ec0b" class="ku kv hi ko b fi kw kx l ky kz"># main.py<br/>import uvicorn<br/>from fastapi import FastAPI</span><span id="36f5" class="ku kv hi ko b fi la kx l ky kz">app = FastAPI()</span><span id="bc7f" class="ku kv hi ko b fi la kx l ky kz">@app.get("/")<br/>async def root():<br/>    return {"message": "Hello World"}</span><span id="6d1c" class="ku kv hi ko b fi la kx l ky kz">if __name__ == '__main__':<br/>    uvicorn.run('main:app', reload=True)</span></pre><p id="849d" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">和</p><pre class="iy iz ja jb fd kq ko kr ks aw kt bi"><span id="3fd6" class="ku kv hi ko b fi kw kx l ky kz"># requirements.txt<br/>fastapi==0.75.2<br/>uvicorn==0.15.0<br/>pyTigerGraph==0.0.9.9.2<br/>motor==2.5.1<br/>python-multipart==0.0.5<br/>matplotlib==3.5.2</span></pre><p id="20e9" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">为了简单起见，需求文件中包含了本项目中<code class="du kl km kn ko b">pip3</code>将要安装的所有模块(只剩下<code class="du kl km kn ko b">tensorflow</code>，我们稍后会用<code class="du kl km kn ko b">pip</code>安装)。为了不破坏本地环境，我们将使用虚拟环境来安装模块。在<code class="du kl km kn ko b">photo_library/backend</code>的一个终端，让我们运行:</p><pre class="iy iz ja jb fd kq ko kr ks aw kt bi"><span id="58fb" class="ku kv hi ko b fi kw kx l ky kz">$ python3 -m venv venv<br/>$ source venv/bin/activate</span></pre><p id="aec0" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们将看到<code class="du kl km kn ko b">(venv)</code>出现在终端提示行的开头。这意味着我们的终端运行在虚拟环境中。请记住每次关闭和重新打开终端时运行<code class="du kl km kn ko b">$ source venv/bin/activate</code>。</p><p id="a005" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">然后，我们可以跑了</p><pre class="iy iz ja jb fd kq ko kr ks aw kt bi"><span id="3dbf" class="ku kv hi ko b fi kw kx l ky kz">$ pip3 install -r requirements.txt</span></pre><p id="db98" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">安装模块，这将需要不到一分钟的时间。在那之后，我们跑</p><pre class="iy iz ja jb fd kq ko kr ks aw kt bi"><span id="0786" class="ku kv hi ko b fi kw kx l ky kz">$ python3 main.py</span></pre><p id="a504" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">它将启动我们的后端，第一个API端点监听<a class="ae kj" href="http://localhost:8000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000/ </a>:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ln"><img src="../Images/c4687f16d00ac55b1cc070a220fe36b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O5MbTBvRhgz7gFqgtaVRMA.png"/></div></div></figure><p id="af2d" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">太好了！我们现在有一个工作的FastAPI后端服务器。</p></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><p id="0391" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们将使用MongoDB和TigerGraph来存储数据。</p><p id="6b2d" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">对于MongoDB，我们可以参考<a class="ae kj" href="https://www.mongodb.com/docs/manual/administration/install-community/" rel="noopener ugc nofollow" target="_blank">本指南</a>进行MongoDB社区版的安装设置，还可以安装<a class="ae kj" href="https://www.mongodb.com/try/download/compass" rel="noopener ugc nofollow" target="_blank">指南针</a>，这是MongoDB的图形用户界面(GUI)。之后，打开Compass并点击按钮<strong class="jp hj"> Connect </strong>创建一个到MongoDB的连接。在出现的页面上，点击<strong class="jp hj">数据库</strong>选项卡，点击<strong class="jp hj">创建数据库</strong>，然后输入<strong class="jp hj"> photo_library </strong>作为数据库名称，输入<strong class="jp hj"> photos </strong>作为收藏名称。然后，我们就用MongoDB好了！</p><p id="09b1" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">对于TigerGraph，我们可以参考<a class="ae kj" href="https://docs.tigergraph.com/cloud/solutions/create" rel="noopener ugc nofollow" target="_blank">该文档</a>来创建我们的TigerGraph云解决方案。它是一个具有人性化GUI的云图数据库，并且可以免费使用！在设置过程中，记得<strong class="jp hj">记下你的初始密码和子域！</strong>我们将使用<code class="du kl km kn ko b">photo-library.i.tgcloud.io</code>作为我们的子域，使用<code class="du kl km kn ko b">tigergraph</code>作为我们的密码。本博客使用的解决方案在发布时已经终止。请使用更安全的密码创建解决方案。</p><p id="affb" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">创建解决方案后，我们将单击开始按钮:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lo"><img src="../Images/0a513b2f2c635f3306ea8ac55304218a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nqpapoHgnXC4gSFnjvH-Yw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Please notice that the solution will automatically stop after 1 hour of inactivity, but you can restart it anytime</figcaption></figure><p id="0600" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">一旦启动，我们就可以打开GraphStudio来创建图形和编写查询！</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lo"><img src="../Images/5b0dba9c99173c2bcc3d319c30a964a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UnLNW8G_Yq_8NRjPHpT1rA.png"/></div></div></figure><p id="3a1f" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">输入用户名(默认值:tigergraph)和密码(您刚刚为您的解决方案设置的初始密码)来登录GraphStudio。然后点击左上角的全局视图，创建一个名为“照片”的图表。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lp"><img src="../Images/cf82d513305b74ea12f8d8ae734e799e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9CL5FNT2hf9f2ujpG9US1w.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Click on ‘Create a Graph’ (The graph ‘photos’ is already created in this example solution)</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lo"><img src="../Images/bb9ce66aaa9196e575e2622f01121850.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9lzUscuyHX0pH6xOu16Dcw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Enter the name of the graph</figcaption></figure><p id="daa6" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">然后点击“全局视图”,然后点击下拉列表中的“照片”,切换到图表“照片”。单击“设计模式”选项卡，为我们的图表创建一个顶点。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lq"><img src="../Images/edec6214065776204dadb4bac163662d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-7RxHxpt3ozO3XykYijqRA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Click on the button marked red in the upper left corner to add a local vertex type, then edit the vertex type as shown in the image. (You will not see the warning. It is a spoiler for a later part of this blog.)</figcaption></figure><p id="ab3a" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们将创建一个顶点类型“Photo ”,其属性为“id ”,用于存储MongoDB中照片的对象ID。虽然在TigerGraph中单独存储对象ID目前没有用，但当它与我们将在后面部分中使用图像分类算法生成的标签结合使用时，它将支持搜索。</p><p id="0ba0" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">更改后，点击“添加本地顶点类型”按钮左侧的“发布模式”按钮，等待更改被提交，我们的TigerGraph解决方案就可以使用了！</p><p id="850e" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">祝贺您建立了开发环境！让我们休息一下，然后继续实现照片托管服务！</p><p id="a9f0" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj">第二节:实施照片托管服务</strong></p><p id="a9c4" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">先说后端。我们需要一个API端点，它将表单数据中的照片作为输入，将照片字节存储在MongoDB的一个文档中，并将文档的对象ID存储在TigerGraph中。</p><p id="ddbe" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">API端点将如下所示:</p><pre class="iy iz ja jb fd kq ko kr ks aw kt bi"><span id="5f1e" class="ku kv hi ko b fi kw kx l ky kz"># from fastapi import UploadFile<br/>@app.post("/uploadPhoto/")<br/>async def upload_photo(file: UploadFile):<br/>    contents = await file.read()<br/>    # add photo to MongoDB<br/>    data = { "photo": contents }<br/>    photoID = await <strong class="ko hj">add_photo_to_MongoDB</strong>(data)<br/>    # add photoID TigerGraph<br/>    success = await <strong class="ko hj">add_photo_id_to_TigerGraph</strong>(photoID)<br/>    if success:<br/>        return { "code": 200, "message": "Photo uploaded"}<br/>    else:<br/>        return { "code": 401, "message": "Failed to add photo"}</span></pre><p id="623f" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">然后，我们实现与数据库交互的大胆函数。我们使用<a class="ae kj" href="https://motor.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">马达</a>与MongoDB交互:</p><pre class="iy iz ja jb fd kq ko kr ks aw kt bi"><span id="4ed0" class="ku kv hi ko b fi kw kx l ky kz"># import motor.motor_asyncio<br/>####################<br/># Connection to MongoDB<br/>client = motor.motor_asyncio.AsyncIOMotorClient("mongodb://localhost:27017")<br/>database = client.<strong class="ko hj">photo_library</strong><br/>photo_collection = database.get_collection("<strong class="ko hj">photos</strong>")</span><span id="f5b8" class="ku kv hi ko b fi la kx l ky kz"># Add a new photo to MongoDB<br/>async def add_photo_to_MongoDB(photo_data:dict):<br/>    try:<br/>        entry = await photo_collection.insert_one(photo_data)<br/>        return str(entry.inserted_id) <br/>    except:<br/>        return False</span></pre><p id="0f09" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">注意，粗体变量指的是我们前面使用的数据库名称和集合名称。如果您使用不同的名称，您可以更改它们。</p><p id="4156" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们将使用pyTigerGraph与TigerGraph进行交互。请将主机和密码更改为您自己的。</p><pre class="iy iz ja jb fd kq ko kr ks aw kt bi"><span id="cc41" class="ku kv hi ko b fi kw kx l ky kz"># import pyTigerGraph as tg<br/>####################<br/># Connection to TigerGraph<br/>conn = tg.TigerGraphConnection(<br/>    host="<a class="ae kj" href="https://photo-manager.i.tgcloud.io" rel="noopener ugc nofollow" target="_blank">https://photo-library.i.tgcloud.io</a>",<br/>    graphname="photos",<br/>    username="tigergraph",<br/>    password="tigergraph", )<br/>conn.apiToken = conn.getToken(conn.createSecret())<br/>#conn.apiToken = ('...', ..., '...')<br/>async def add_photo_id_to_TigerGraph(id: str):<br/>    try:<br/>        conn.upsertVertex("Photo", id, {})<br/>        return True<br/>    except:<br/>        return False</span></pre><p id="60d6" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">有一个用PyTigerGraph开发的小技巧:apiToken的生成可能需要几秒钟，这会使FastAPI重载的响应性降低。如果我们经常更改代码，打印出apiToken一次并将其设置为值会很有帮助。</p><p id="e43b" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">把它们放在一起，<code class="du kl km kn ko b">main.py</code>现在看起来是这样的:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="7753" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们可以从<code class="du kl km kn ko b">python3 main.py</code>开始(记得用<code class="du kl km kn ko b">source venv/bin/activate</code>激活虚拟环境)并访问<a class="ae kj" href="http://localhost:8000/docs" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/docs</a>上的文档页面</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lr"><img src="../Images/52ca04cb01560c476962790fe6042959.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M6RgsCjyXe8ERYE5Wlp6Lg.png"/></div></div></figure><p id="0de7" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">展开我们刚刚构建的端点的选项卡，然后单击“试用”。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ls"><img src="../Images/a0f08e8ee24b932edf81362491af147f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*biYztx1ubY39S-loK2qvIg.png"/></div></div></figure><p id="5f7c" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">然后，我们可以选择一个文件(小于16MB)并单击“执行”。如果MongoDB社区版和TigerGraph解决方案运行正常，我们可以看到在MongoDB中添加了一个新文档，在TigerGraph中添加了一个具有相同对象ID的顶点。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lt"><img src="../Images/27c527bafb8dd6c035cdb8d424289d30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jQm8QiZE3xf90c2-Li9Nlg.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lp"><img src="../Images/cf32e91d06f6b1acbdfd9bd983525aa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rM8ILEytu8Gov4zbfepUdw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">In GraphStudio, you can switch to the graph ‘photos’, click on ‘Explore Graph’, and search for the vertex</figcaption></figure><p id="0324" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们已经建立了一个工作的API端点来上传和存储照片！让我们完成这一部分，建立一个简单的前端与一些风格。我们可以把下面的代码放在<code class="du kl km kn ko b">photo_library/frontend/src/pages/IndexPage.vue</code>里。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="e108" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">结果页面将如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lu"><img src="../Images/d45d68aec21767588309cd262d8881d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7T4-VK-Y3_XNuv1GqSLiAw.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lv"><img src="../Images/0daf8ca4174e0d0965a22a80adc12d5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O3Q--_biInKxXQwdbxh78g.png"/></div></div></figure><p id="9b5a" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">您可以单击“选择照片”选择一张照片，然后单击“上传”将所选照片发送到后端。您可以随意使用它，并检查数据库中是否反映了更改。</p><p id="b97e" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">祝贺您完成第1部分！所有的代码都上传到<a class="ae kj" href="https://github.com/JimChen2002/photo-library-part1" rel="noopener ugc nofollow" target="_blank">这里</a>带有运行它的指令。</p><p id="be95" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们将在后面的部分中结合图像分类和搜索。同时，如果你有任何问题，一定要加入<a class="ae kj" href="https://discord.com/invite/tigergraph" rel="noopener ugc nofollow" target="_blank"> TigerGraph Discord </a>和<a class="ae kj" href="https://dev.tigergraph.com/forum/" rel="noopener ugc nofollow" target="_blank">开发者论坛</a>！</p></div></div>    
</body>
</html>