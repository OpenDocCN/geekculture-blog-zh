<html>
<head>
<title>AWS CloudFormation 101- How to Use !Ref to Assemble the relationship between Each AWS Resource (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS CloudFormation 101-如何使用！参考组装每个AWS资源之间的关系(第2部分)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/aws-cloudformation-101-how-to-use-ref-to-assemble-relationship-between-each-aws-resource-part2-9142a9d626e3?source=collection_archive---------24-----------------------#2021-06-20">https://medium.com/geekculture/aws-cloudformation-101-how-to-use-ref-to-assemble-relationship-between-each-aws-resource-part2-9142a9d626e3?source=collection_archive---------24-----------------------#2021-06-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/058a27e287d2bfe3fa5f908d7bddeaed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1-ONlMV5tpkPBcNf"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@z734923105?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jerry Zhang</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="9d2f" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">介绍</h1><p id="43f3" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">在之前的<a class="ae iu" rel="noopener" href="/geekculture/aws-cloudformation-101-what-is-cloudformation-and-do-i-need-to-know-about-it-part-1-b56e3d7a4294">帖子</a>中，我分享了什么是云的形成，以及我们是否应该了解它。如果你来自前一篇文章，我很高兴你“找到你的原因”来学习AWS CloudFormation。</p><p id="2563" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">然而，如果你仍然不知道你是否需要学习它，看看这个帖子并“找到你的原因”。</p><p id="3543" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">此外，我还分享了云形成的模板结构以及如何使用云形成模板启动EC2实例。所以在这篇文章中，我将采取另一个最小的步骤——在现有的EC2实例中添加一个安全组。</p><p id="98e8" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">事不宜迟，我们开始吧。</p></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><h1 id="d2d4" class="iv iw hi bd ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js bi translated">教程—向EC2实例添加安全组</h1><p id="4080" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">在上一篇文章中，我们使用云形成模板创建了一个EC2实例。模板代码请参考下面的要点。</p><figure class="li lj lk ll fd ij"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="d8b1" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">在本教程中，我们将向<strong class="jv hj"> TestInstance (EC2实例)添加一个安全组。</strong>以下是本教程的<strong class="jv hj">要求</strong>。</p><ul class=""><li id="345a" class="lo lp hi jv b jw kr ka ks ke lq ki lr km ls kq lt lu lv lw bi translated">允许端口80的安全组</li><li id="0219" class="lo lp hi jv b jw lx ka ly ke lz ki ma km mb kq lt lu lv lw bi translated">允许端口443的安全组</li><li id="bfaa" class="lo lp hi jv b jw lx ka ly ke lz ki ma km mb kq lt lu lv lw bi translated">将上述安全组分配给<strong class="jv hj"> EC2实例</strong></li></ul><h2 id="cf4e" class="mc iw hi bd ix md me mf jb mg mh mi jf ke mj mk jj ki ml mm jn km mn mo jr mp bi translated">AWS安全组的云形成模板</h2><p id="7d65" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">下面是我们将用于安全组的结构。以下是对配置中每个字段的解释。</p><ul class=""><li id="9538" class="lo lp hi jv b jw kr ka ks ke lq ki lr km ls kq lt lu lv lw bi translated"><strong class="jv hj">组描述</strong> : —必填字段，用于描述该安全组正在做什么。(简单但<strong class="jv hj">重要</strong></li><li id="e90d" class="lo lp hi jv b jw lx ka ly ke lz ki ma km mb kq lt lu lv lw bi translated"><strong class="jv hj">security grouping press</strong>:—我们在其中定义所有传入网络流量规则的部分。默认情况下，如果没有为EC2实例定义任何内容，EC2实例将无法接收任何传入流量。</li><li id="18b5" class="lo lp hi jv b jw lx ka ly ke lz ki ma km mb kq lt lu lv lw bi translated"><strong class="jv hj"> CidrIp </strong> : —传入Ip地址—例如，您可以设置接受来自IP<strong class="jv hj">220.16.116.228</strong>的流量</li><li id="ad00" class="lo lp hi jv b jw lx ka ly ke lz ki ma km mb kq lt lu lv lw bi translated"><strong class="jv hj">从端口</strong> : —进入端口</li><li id="2a46" class="lo lp hi jv b jw lx ka ly ke lz ki ma km mb kq lt lu lv lw bi translated"><strong class="jv hj"> IpProtocol </strong> : —什么互联网协议，常见的有<code class="du mq mr ms mt b">TCP</code>和<code class="du mq mr ms mt b">UDP</code></li><li id="4c96" class="lo lp hi jv b jw lx ka ly ke lz ki ma km mb kq lt lu lv lw bi translated"><strong class="jv hj"> ToPort </strong> : —到EC2实例的哪个端口</li></ul><figure class="li lj lk ll fd ij"><div class="bz dy l di"><div class="lm ln l"/></div></figure><h2 id="8e57" class="mc iw hi bd ix md me mf jb mg mh mi jf ke mj mk jj ki ml mm jn km mn mo jr mp bi translated">利用！参考分配安全组功能简写</h2><p id="26b3" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">此时，您可能已经编写了创建安全组资源的部分。接下来，我们需要将安全组分配给EC2实例。</p><p id="d677" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">您可以使用yaml中的简写语法<code class="du mq mr ms mt b">!Ref</code>将安全组分配给EC2实例。下面是一个如何使用<code class="du mq mr ms mt b">!Ref.</code>的例子</p><blockquote class="mu"><p id="c7a6" class="mv mw hi bd mx my mz na nb nc nd kq dx translated"><em class="ne">！ref logicalidforteresource</em></p></blockquote><p id="b2a8" class="pw-post-body-paragraph jt ju hi jv b jw nf jy jz ka ng kc kd ke nh kg kh ki ni kk kl km nj ko kp kq hb bi translated">我们将获取我们在模板中命名的资源的LogicalID。所以在这个场景中，会是<code class="du mq mr ms mt b">!Ref HTTPSecurityGroup</code>。</p></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><h1 id="f489" class="iv iw hi bd ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js bi translated">动手时间👨‍💻👩‍💻</h1><p id="4f40" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">这是我们应该动手实践和加强学习的时候了。</p><p id="e4d8" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">您可以在这里找到现有的CloudFormation代码<a class="ae iu" href="https://www.notion.so/c00d27a8d7318d4608a78a037a8ee475" rel="noopener ugc nofollow" target="_blank">，添加安全组资源并继续本教程。</a></p><p id="1544" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">如果你卡住了，你可以参考最后的答案<a class="ae iu" href="https://www.notion.so/b88b5a65dcaaa57e4303c082fc4c3f35" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><h1 id="f3c4" class="iv iw hi bd ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js bi translated">预期产出</h1><p id="65ca" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">这是预期的输出。根据下面的截图，我们创建了一个安全组，它允许<strong class="jv hj">端口80 (HTTP) </strong>和<strong class="jv hj">端口443 (HTTPS) </strong>。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nk"><img src="../Images/a04b1544a5c85148ec13948705c56f60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D-62DwEOSgYUyaBzyGJCtg.png"/></div></div></figure><p id="613f" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">最后但同样重要的是，您还必须确保分配给EC2实例的安全组。您可以从您的EC2实例仪表板中找到它。参考下面的截图。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nl"><img src="../Images/286bbd360539f7f868523d3994fc35a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GPRFgqgKHmD7iOnrfEaduw.png"/></div></div></figure></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><h1 id="acd3" class="iv iw hi bd ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js bi translated">结论</h1><p id="bfa2" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">在这篇文章中，我分享了如何通过CloudFormation提供安全组，最重要的是如何使用<code class="du mq mr ms mt b">!Ref</code>来组装资源之间的关系，例如</p><ul class=""><li id="10f8" class="lo lp hi jv b jw kr ka ks ke lq ki lr km ls kq lt lu lv lw bi translated">！在EC2实例中引用安全组。</li></ul><p id="6e6b" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">这就是本文的全部内容</p><h2 id="7164" class="mc iw hi bd ix md me mf jb mg mh mi jf ke mj mk jj ki ml mm jn km mn mo jr mp bi translated">支持我</h2><p id="48b3" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">你现在可以给我买一杯咖啡来支持我，这样我就可以在没有付费墙的情况下保留这篇文章。感谢您的支持！</p></div></div>    
</body>
</html>