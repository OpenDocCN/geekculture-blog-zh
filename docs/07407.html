<html>
<head>
<title>Docker Compose for Amazon DynamoDB with Migration, Seeding, and Admin UI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Docker Compose for Amazon DynamoDB带有迁移、播种和管理UI</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/docker-compose-for-amazon-dynamodb-with-migration-seeding-and-admin-ui-db11a348cc6a?source=collection_archive---------9-----------------------#2021-09-17">https://medium.com/geekculture/docker-compose-for-amazon-dynamodb-with-migration-seeding-and-admin-ui-db11a348cc6a?source=collection_archive---------9-----------------------#2021-09-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d09f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">初学者指南，介绍如何在不创建自定义程序的情况下，使用迁移和播种机为Amazon DynamoDB设置本地开发。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/00b7227eb62681ade7871f7ae25aa22d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/0*jx2y392h8EIDaemU.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx"><em class="jp">Amazon DynamoDB</em></figcaption></figure><h1 id="c9a0" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">为什么<em class="jp">亚马逊DynamoDB </em>？</h1><p id="ef52" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated"><em class="kt"> Amazon DynamoDB </em>是一个键值和文档数据库，在任何规模下都能提供一位数的毫秒级性能。这是一个全面管理、多区域、多活动、耐用的数据库，具有内置的安全性、备份和恢复功能，以及适用于互联网规模应用程序的内存缓存。</p><h1 id="699b" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">问题是</h1><p id="c958" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">由于<em class="kt"> Amazon DynamoDB </em>是一个完全托管的服务，在过去，即使在本地开发过程中，我们也必须连接到一个真实的实例。如今，有了<em class="kt"> Docker </em>，我们可以在本地机器中为本地开发生成一个容器。</p><p id="942f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们需要创建某个程序来创建表或在本地容器中植入数据库时，问题就出现了。我们不想创建一个自定义程序来创建表或播种表。更重要的是，当我们可以只用Docker做任何事情的时候，为什么要浪费时间呢？不管我们精通哪种编程语言，我们实际上都可以做到这一点。</p><h1 id="9a70" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">先决条件</h1><ul class=""><li id="b081" class="ku kv hi ih b ii ko im kp iq kw iu kx iy ky jc kz la lb lc bi translated"><em class="kt"> Docker </em> ≥ 20.10.8</li><li id="ad39" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><em class="kt">码头工人组成</em> ≥ 1.27.4</li></ul><h1 id="8baa" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">步伐</h1><p id="c491" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">创建具有以下结构的项目:</p><pre class="je jf jg jh fd li lj lk ll aw lm bi"><span id="0126" class="ln jr hi lj b fi lo lp l lq lr">{21-09-15 22:28}arwego:~/go/src/github.com/rizalgowandy/docker-sample/dynamodb@main% tree                           <br/><strong class="lj hj">.</strong> <br/>├── docker-compose.yaml <br/>└── <strong class="lj hj">schema</strong> <br/>    ├── product.json <br/>    └── product_seeder.json</span></pre><p id="5b24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<em class="kt"> /schema </em>中创建一个名为<em class="kt"> product.json </em>的迁移文件，以创建<em class="kt"> product </em>表:</p><pre class="je jf jg jh fd li lj lk ll aw lm bi"><span id="5bdc" class="ln jr hi lj b fi lo lp l lq lr">{<br/>  "TableName": "product",<br/>  "KeySchema": [<br/>    { "AttributeName": "id", "KeyType": "HASH" },<br/>    { "AttributeName": "created_at", "KeyType": "RANGE" }<br/>  ],<br/>  "AttributeDefinitions": [<br/>    { "AttributeName": "id", "AttributeType": "S" },<br/>    { "AttributeName": "created_at", "AttributeType": "S" }<br/>  ],<br/>  "ProvisionedThroughput": {<br/>    "ReadCapacityUnits": 10,<br/>    "WriteCapacityUnits": 5<br/>  }<br/>}</span></pre><p id="a2a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<em class="kt"> /schema </em>中创建一个名为<em class="kt"> product_seeder.json </em>的播种文件，用两个数据播种该表:</p><pre class="je jf jg jh fd li lj lk ll aw lm bi"><span id="7569" class="ln jr hi lj b fi lo lp l lq lr">{<br/>  "product": [<br/>    {<br/>      "PutRequest": {<br/>        "Item": {<br/>          "id": {<br/>            "S": "1"<br/>          },<br/>          "created_at": {<br/>            "S": "20210101"<br/>          },<br/>          "name": {<br/>            "S": "gold"<br/>          },<br/>          "is_deleted": {<br/>            "BOOL": <strong class="lj hj">false<br/>          </strong>}<br/>        }<br/>      }<br/>    },<br/>    {<br/>      "PutRequest": {<br/>        "Item": {<br/>          "id": {<br/>            "S": "2"<br/>          },<br/>          "created_at": {<br/>            "S": "20210101"<br/>          },<br/>          "name": {<br/>            "S": "copper"<br/>          },<br/>          "is_deleted": {<br/>            "BOOL": <strong class="lj hj">false<br/>          </strong>}<br/>        }<br/>      }<br/>    }<br/>  ]<br/>}</span></pre><p id="c8c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建一个<em class="kt"> docker-compose </em>文件:</p><pre class="je jf jg jh fd li lj lk ll aw lm bi"><span id="0fad" class="ln jr hi lj b fi lo lp l lq lr"><strong class="lj hj">version</strong>: "3"<br/><strong class="lj hj">services</strong>:<br/>  <strong class="lj hj">dynamodb</strong>:<br/>    <strong class="lj hj">image</strong>: amazon/dynamodb-local:1.16.0<br/>    <strong class="lj hj">container_name</strong>: app-dynamodb<br/>    <strong class="lj hj">hostname</strong>: app-dynamodb<br/>    <strong class="lj hj">volumes</strong>:<br/>      - app_dynamodb:/home/dynamodblocal<br/>    <strong class="lj hj">working_dir</strong>: /home/dynamodblocal<br/>    <strong class="lj hj">ports</strong>:<br/>      - "8000:8000"<br/>    <strong class="lj hj">command</strong>: "-jar DynamoDBLocal.jar -sharedDb -dbPath ."<br/>    <strong class="lj hj">restart</strong>: unless-stopped<br/><br/>  <strong class="lj hj">dynamodb_admin</strong>:<br/>    <strong class="lj hj">image</strong>: aaronshaf/dynamodb-admin:dependabot_npm_and_yarn_aws-sdk-2.952.0<br/>    <strong class="lj hj">container_name</strong>: app-dynamodb_admin<br/>    <strong class="lj hj">ports</strong>:<br/>      - "8001:8001"<br/>    <strong class="lj hj">environment</strong>:<br/>      - DYNAMO_ENDPOINT=http://dynamodb:8000<br/>    <strong class="lj hj">depends_on</strong>:<br/>      - dynamodb<br/>    <strong class="lj hj">restart</strong>: unless-stopped<br/><br/>  <strong class="lj hj">dynamodb_migrator</strong>:<br/>    <strong class="lj hj">image</strong>: banst/awscli:1.18.76<br/>    <strong class="lj hj">container_name</strong>: app-dynamodb_migrator<br/>    <strong class="lj hj">working_dir</strong>: /home/dynamodblocal<br/>    <strong class="lj hj">command</strong>: dynamodb create-table --cli-input-json file://product.json --endpoint-url http://dynamodb:8000<br/>    <strong class="lj hj">volumes</strong>:<br/>      - ./schema:/home/dynamodblocal<br/>    <strong class="lj hj">environment</strong>:<br/>      - AWS_ACCESS_KEY_ID=unicorn_user<br/>      - AWS_SECRET_ACCESS_KEY=magical_password<br/>      - AWS_DEFAULT_REGION=ap-southeast-1<br/>    <strong class="lj hj">depends_on</strong>:<br/>      - dynamodb<br/><br/>  <strong class="lj hj">dynamodb_seeder</strong>:<br/>    <strong class="lj hj">image</strong>: banst/awscli:1.18.76<br/>    <strong class="lj hj">container_name</strong>: app-dynamodb_seeder<br/>    <strong class="lj hj">working_dir</strong>: /home/dynamodblocal<br/>    <strong class="lj hj">command</strong>: dynamodb batch-write-item --request-items file://product_seeder.json --endpoint-url http://dynamodb:8000<br/>    <strong class="lj hj">volumes</strong>:<br/>      - ./schema:/home/dynamodblocal<br/>    <strong class="lj hj">environment</strong>:<br/>      - AWS_ACCESS_KEY_ID=unicorn_user<br/>      - AWS_SECRET_ACCESS_KEY=magical_password<br/>      - AWS_DEFAULT_REGION=ap-southeast-1<br/>    <strong class="lj hj">depends_on</strong>:<br/>      - dynamodb_migrator<br/>      - dynamodb<br/>    <strong class="lj hj">restart</strong>: on-failure<br/><br/><strong class="lj hj">volumes</strong>:<br/>  <strong class="lj hj">app_dynamodb</strong>:<br/>    <strong class="lj hj">driver</strong>: local</span></pre><p id="322b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">来自<em class="kt"> docker-compose </em>文件的重要信息:</p><ul class=""><li id="7f76" class="ku kv hi ih b ii ij im in iq ls iu lt iy lu jc kz la lb lc bi translated">Amazon DynamoDB运行在端口8000。</li><li id="68dd" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">管理UI正在端口8001上运行。</li><li id="bdab" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">用于迁移和播种的AWS CLI指向端口8000，也就是我们的Amazon DynamoDB端口。</li><li id="898e" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">迁移将创建一个产品表，并使用<em class="kt"> /schema/product.json </em>和<em class="kt">/schema/product _ seeder . JSON .</em>为其植入两个数据</li></ul><p id="1a40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后执行:</p><pre class="je jf jg jh fd li lj lk ll aw lm bi"><span id="a777" class="ln jr hi lj b fi lo lp l lq lr">$ docker-compose up</span></pre><p id="d4c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到<a class="ae lv" href="http://localhost:8001/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8001/ </a>查看管理UI。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es lw"><img src="../Images/9fe5a29bdfc4ebab0e8afe130b5ad5f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JO4wHSGiuTNLyWC5UFURiQ.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Admin UI</figcaption></figure><p id="8edc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该表已经创建，您可以看到其中已经填充了我们的播种数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es mb"><img src="../Images/ba7d726a35a9bc607897a5c197cf4898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UPeq9XQM0-HA9_9elxgt-A.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Product Table Data</figcaption></figure><p id="8dd9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧，我们完成了。现在，您使用<em class="kt"> Amazon DynamoDB </em>的本地开发变得简单多了。您可以创建一个表，播种该表，甚至可以使用管理UI控制一切。</p><h1 id="4142" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">参考资料:</h1><ul class=""><li id="a3a0" class="ku kv hi ih b ii ko im kp iq kw iu kx iy ky jc kz la lb lc bi translated"><strong class="ih hj">来源</strong>:<a class="ae lv" href="https://github.com/rizalgowandy/docker-sample" rel="noopener ugc nofollow" target="_blank">https://github.com/rizalgowandy/docker-sample</a></li><li id="f2a1" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">亚马逊DynamoDB本地</strong>:【https://registry.hub.docker.com/r/amazon/dynamodb-local T42】</li><li id="caf2" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">UI</strong>:【https://registry.hub.docker.com/r/aaronshaf/dynamodb-admin T2】</li><li id="5245" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">用于迁移和播种的<strong class="ih hj">AWS CLI</strong>:<a class="ae lv" href="https://registry.hub.docker.com/r/banst/awscli" rel="noopener ugc nofollow" target="_blank">https://registry.hub.docker.com/r/banst/awscli</a></li></ul></div></div>    
</body>
</html>