<html>
<head>
<title>Push Notification In Flutter in Background as well as in Foreground Using Firebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Firebase在后台和前台推送通知</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/push-notification-in-flutter-in-background-as-well-as-foreground-using-firebase-1e6e7ecad292?source=collection_archive---------0-----------------------#2021-06-22">https://medium.com/geekculture/push-notification-in-flutter-in-background-as-well-as-foreground-using-firebase-1e6e7ecad292?source=collection_archive---------0-----------------------#2021-06-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9bf5c72264433e2727a98baa3e95f6d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MGJZBD7LjMVUT58kvMSe0g.png"/></div></div></figure><p id="3d63" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在Flutter应用中，我们需要集成<strong class="is hj">推送通知</strong>。虽然我们成功地集成了它，但有时当应用程序不运行或在后台打开时，我们在发送推送通知时会遇到问题或应用程序崩溃。因此，我们将在flutter中集成使用firebase的推送通知，它可以在所有状态下工作:前台、后台，甚至是应用程序关闭时(不运行)。此外，如果您想在点击推送通知后将通知重定向到应用程序中某个页面，这里的<a class="ae jo" href="https://lakshydeep-14.medium.com/on-tap-push-notification-redirect-to-corresponding-screen-in-flutter-9f184068e4f8" rel="noopener">是</a>链接。</p><p id="1459" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">开始吧:)</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es jp"><img src="../Images/b83cf34c2708cd7b7f3630ede8dc20f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/1*YLvwY2b60iupI7NJreRiXg.gif"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Notification in Foreground as well as in Background.</figcaption></figure><blockquote class="jy jz ka"><p id="9478" class="iq ir kb is b it iu iv iw ix iy iz ja kc jc jd je kd jg jh ji ke jk jl jm jn hb bi translated"><strong class="is hj">消防基地和推送通知设置</strong></p></blockquote><h1 id="c525" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">第一步</h1><ul class=""><li id="e9e3" class="ld le hi is b it lf ix lg jb lh jf li jj lj jn lk ll lm ln bi translated">为您的应用程序创建firebase项目，并在android/app文件夹中添加<strong class="is hj"> googleservices.json </strong>文件。</li><li id="c061" class="ld le hi is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated">在你的flutter项目中安装<a class="ae jo" href="https://pub.dev/packages/firebase_messaging" rel="noopener ugc nofollow" target="_blank"> firebase_messaging </a>和<a class="ae jo" href="https://pub.dev/packages/firebase_core" rel="noopener ugc nofollow" target="_blank"> firebase_core </a>。</li></ul><pre class="jq jr js jt fd lt lu lv lw aw lx bi"><span id="29c0" class="ly kg hi lu b fi lz ma l mb mc">firebase_messaging: ^8.0.0-dev.14<br/>firebase_core: any</span></pre><ul class=""><li id="89f3" class="ld le hi is b it iu ix iy jb md jf me jj mf jn lk ll lm ln bi translated">像往常一样，在<strong class="is hj"> build.gradle </strong>(应用级和android级)文件中设置firebase初始化。</li><li id="3bf8" class="ld le hi is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated">对于推送通知，在应用程序级build.gradle文件中的依赖项下添加下面一行(<em class="kb">有时我们会面临多索引问题，因此最好在defaultConfig{} </em> ) <br/> <strong class="is hj">下的defaultConfig: </strong></li></ul><pre class="jq jr js jt fd lt lu lv lw aw lx bi"><span id="2a2f" class="ly kg hi lu b fi lz ma l mb mc">multiDexEnabled true</span></pre><p id="a8d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">依赖关系下:</strong></p><pre class="jq jr js jt fd lt lu lv lw aw lx bi"><span id="ea6c" class="ly kg hi lu b fi lz ma l mb mc">...<br/>dependencies{<br/>...<br/><strong class="lu hj">implementation ‘com.google.firebase:firebase-inappmessaging-display:19.1.5’<br/>implementation 'com.android.support:multidex:1.0.3'</strong><br/>...<br/>}</span></pre><h1 id="5912" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">步骤二(在当前版本中不需要。请跳过这一步。)</h1><p id="0ada" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb mg jd je jf mh jh ji jj mi jl jm jn hb bi translated"><strong class="is hj">在Android/app/src/main/kotlin(<em class="kb">简单说就是你看到MainActivity.kt文件的地方在那个文件夹</em>里创建Application.kt文件，复制粘贴下面的代码:</strong></p><pre class="jq jr js jt fd lt lu lv lw aw lx bi"><span id="a778" class="ly kg hi lu b fi lz ma l mb mc">package <strong class="lu hj">&lt;your_package_name&gt;</strong></span><span id="3061" class="ly kg hi lu b fi mj ma l mb mc">import io.flutter.app.FlutterApplication<br/>import io.flutter.plugin.common.PluginRegistry<br/>import io.flutter.plugins.firebase.messaging.FlutterFirebaseMessagingBackgroundService<br/>import io.flutter.plugins.firebase.messaging.FlutterFirebaseMessagingPlugin</span><span id="751e" class="ly kg hi lu b fi mj ma l mb mc">class Application: FlutterApplication(), PluginRegistry.PluginRegistrantCallback {<br/> override fun onCreate() {<br/>super.onCreate()FlutterFirebaseMessagingBackgroundService.setPluginRegistrant(this)<br/>}<br/>override fun registerWith(registry:PluginRegistry) {<br/>FlutterFirebaseMessagingPlugin.registerWith(registry?.registrarFor(“io.flutter.plugins.firebasemessaging.FirebaseMessagingPlugin”))<br/>}<br/>}</span></pre><h1 id="74eb" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">第三步</h1><p id="2d44" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb mg jd je jf mh jh ji jj mi jl jm jn hb bi translated">在您的pubspec.yaml文件中添加<a class="ae jo" href="https://pub.dev/packages/flutter_local_notifications" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">flutter _ local _ notifications</strong></a><strong class="is hj"/>包</p><pre class="jq jr js jt fd lt lu lv lw aw lx bi"><span id="36f0" class="ly kg hi lu b fi lz ma l mb mc">flutter_local_notifications:</span></pre><h1 id="4847" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">第四步</h1><p id="8915" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb mg jd je jf mh jh ji jj mi jl jm jn hb bi translated">在Android/app/src/main/RES/Android manifest . XML中添加以下行</p><pre class="jq jr js jt fd lt lu lv lw aw lx bi"><span id="cd5a" class="ly kg hi lu b fi lz ma l mb mc">&lt;application<br/>  android:name=".Application"<br/>  ...&gt;<br/>  &lt;activity<br/>     ....&gt;<br/>       .....<br/>       &lt;intent-filter&gt;<br/>         &lt;action android:name="FLUTTER_NOTIFICATION_CLICK"/&gt;<br/>         &lt;category android:name="android.intent.category.DEFAULT"/&gt;<br/>       &lt;/intent-filter&gt;<br/>  &lt;/activity&gt;<br/>...<br/>&lt;/application&gt;</span></pre><blockquote class="jy jz ka"><p id="1c4a" class="iq ir kb is b it iu iv iw ix iy iz ja kc jc jd je kd jg jh ji ke jk jl jm jn hb bi translated"><strong class="is hj">到目前为止，推送通知已完成，现在我们将转到<br/>编码部分。</strong></p></blockquote><h1 id="6940" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">步骤五</h1><p id="d30b" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb mg jd je jf mh jh ji jj mi jl jm jn hb bi translated">在main.dart文件的main函数中添加这几行。</p><pre class="jq jr js jt fd lt lu lv lw aw lx bi"><span id="6250" class="ly kg hi lu b fi lz ma l mb mc">WidgetsFlutterBinding.ensureInitialized();<br/>await Firebase.initializeApp();</span></pre><h1 id="8bb7" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">第六步</h1><p id="defb" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb mg jd je jf mh jh ji jj mi jl jm jn hb bi translated">创建一个页面，并通过分别导入这些包来初始化firebase_messaging和flutter_local_notifications。</p><pre class="jq jr js jt fd lt lu lv lw aw lx bi"><span id="ba86" class="ly kg hi lu b fi lz ma l mb mc">import ‘package:firebase_messaging/firebase_messaging.dart’;</span><span id="5c35" class="ly kg hi lu b fi mj ma l mb mc">import ‘package:flutter_local_notifications/flutter_local_notifications.dart’;</span><span id="3700" class="ly kg hi lu b fi mj ma l mb mc">// create an instance <br/>FirebaseMessaging messaging = FirebaseMessaging.instance;<br/>FlutterLocalNotificationsPlugin fltNotification;</span></pre><h1 id="4f7f" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">步骤七</h1><p id="0cb8" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb mg jd je jf mh jh ji jj mi jl jm jn hb bi translated">在这里，我们编写了在终端中获取fcm_token的代码，这样我们就可以在firebase项目中的云消息下使用这些令牌，我们已经在第一步中创建了这个项目。</p><pre class="jq jr js jt fd lt lu lv lw aw lx bi"><span id="c52f" class="ly kg hi lu b fi lz ma l mb mc">void pushFCMtoken() async {<br/>  String token=await messaging.getToken();<br/>  print(token);<br/>}</span></pre><h1 id="0a84" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">第八步</h1><p id="77c9" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb mg jd je jf mh jh ji jj mi jl jm jn hb bi translated">在这一步中，我们编写代码来接收通知格式和设置。</p><pre class="jq jr js jt fd lt lu lv lw aw lx bi"><span id="91a5" class="ly kg hi lu b fi lz ma l mb mc">void initMessaging() {</span><span id="d0c7" class="ly kg hi lu b fi mj ma l mb mc">  var androiInit = AndroidInitializationSettings(‘@mipmap/ic_launcher’);//for logo</span><span id="2241" class="ly kg hi lu b fi mj ma l mb mc">  var iosInit = IOSInitializationSettings();</span><span id="aaca" class="ly kg hi lu b fi mj ma l mb mc">  var initSetting=InitializationSettings(android: androiInit,iOS:<br/>   iosInit);</span><span id="0462" class="ly kg hi lu b fi mj ma l mb mc">  fltNotification = FlutterLocalNotificationsPlugin();</span><span id="8b04" class="ly kg hi lu b fi mj ma l mb mc">  fltNotification.initialize(initSetting);</span><span id="8a9e" class="ly kg hi lu b fi mj ma l mb mc">  var androidDetails =<br/>   AndroidNotificationDetails(‘1’, ‘channelName’, ‘channel <br/>    Description’);</span><span id="8f00" class="ly kg hi lu b fi mj ma l mb mc">  var iosDetails = IOSNotificationDetails();</span><span id="116c" class="ly kg hi lu b fi mj ma l mb mc">  var generalNotificationDetails =<br/>   NotificationDetails(android: androidDetails, iOS: iosDetails);</span><span id="a6b7" class="ly kg hi lu b fi mj ma l mb mc">FirebaseMessaging.onMessage.listen((RemoteMessage message) {     RemoteNotification notification=message.notification;<br/>   AndroidNotification android=message.notification?.android;<br/>   if(notification!=null &amp;&amp; android!=null){<br/>     fltNotification.show(<br/>       notification.hashCode, notification.title, notification.<br/>       body, generalNotificationDetails);<br/>}<br/>});<br/>}</span></pre><h1 id="3b32" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">步骤九</h1><p id="2175" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb mg jd je jf mh jh ji jj mi jl jm jn hb bi translated">最终代码将是:</p><pre class="jq jr js jt fd lt lu lv lw aw lx bi"><span id="40fa" class="ly kg hi lu b fi lz ma l mb mc">import ‘package:firebase_messaging/firebase_messaging.dart’;</span><span id="7ec2" class="ly kg hi lu b fi mj ma l mb mc">import ‘package:flutter/material.dart’;</span><span id="fdc0" class="ly kg hi lu b fi mj ma l mb mc">import ‘package:flutter_local_notifications/flutter_local_notifications.dart’;</span><span id="6f17" class="ly kg hi lu b fi mj ma l mb mc">class Demo extends StatefulWidget {<br/>@override<br/>_DemoState createState() =&gt; _DemoState();<br/>}</span><span id="cbe2" class="ly kg hi lu b fi mj ma l mb mc">class _DemoState extends State&lt;Demo&gt; {<br/>FirebaseMessaging messaging = FirebaseMessaging.instance;<br/>FlutterLocalNotificationsPlugin fltNotification;</span><span id="0610" class="ly kg hi lu b fi mj ma l mb mc">void pushFCMtoken() async {<br/>String token=await messaging.getToken();<br/>print(token);<br/>//you will get token here in the console<br/>}<br/>@override</span><span id="bf45" class="ly kg hi lu b fi mj ma l mb mc">void initState() {<br/> super.initState();<br/> pushFCMtoken();<br/> initMessaging();<br/>}<br/>@override</span><span id="e54b" class="ly kg hi lu b fi mj ma l mb mc">Widget build(BuildContext context) {<br/>return Scaffold(<br/> backgroundColor: Colors.white,<br/> body: Center(child: Text(“Flutter Push Notifiction”),),);<br/>}</span><span id="7cbc" class="ly kg hi lu b fi mj ma l mb mc">void initMessaging() {</span><span id="32f6" class="ly kg hi lu b fi mj ma l mb mc">var androiInit = AndroidInitializationSettings(‘@mipmap/ic_launcher’);</span><span id="b658" class="ly kg hi lu b fi mj ma l mb mc">var iosInit = IOSInitializationSettings();</span><span id="287e" class="ly kg hi lu b fi mj ma l mb mc">var initSetting = InitializationSettings(android: androiInit, iOS: iosInit);</span><span id="8425" class="ly kg hi lu b fi mj ma l mb mc">fltNotification = FlutterLocalNotificationsPlugin();</span><span id="534d" class="ly kg hi lu b fi mj ma l mb mc">fltNotification.initialize(initSetting);</span><span id="f334" class="ly kg hi lu b fi mj ma l mb mc">var androidDetails =</span><span id="d76a" class="ly kg hi lu b fi mj ma l mb mc">AndroidNotificationDetails(‘1’, ‘channelName’, ‘channel Description’);</span><span id="a7fe" class="ly kg hi lu b fi mj ma l mb mc">var iosDetails = IOSNotificationDetails();</span><span id="b8a6" class="ly kg hi lu b fi mj ma l mb mc">var generalNotificationDetails =</span><span id="93b7" class="ly kg hi lu b fi mj ma l mb mc">NotificationDetails(android: androidDetails, iOS: iosDetails);</span><span id="511b" class="ly kg hi lu b fi mj ma l mb mc">FirebaseMessaging.onMessage.listen((RemoteMessage message) {</span><span id="95c4" class="ly kg hi lu b fi mj ma l mb mc">RemoteNotification notification=message.notification;</span><span id="bec6" class="ly kg hi lu b fi mj ma l mb mc">AndroidNotification android=message.notification?.android;</span><span id="bf1a" class="ly kg hi lu b fi mj ma l mb mc">if(notification!=null &amp;&amp; android!=null){</span><span id="6750" class="ly kg hi lu b fi mj ma l mb mc">fltNotification.show(</span><span id="32a5" class="ly kg hi lu b fi mj ma l mb mc">notification.hashCode, notification.title, notification.body, generalNotificationDetails);</span><span id="bdcb" class="ly kg hi lu b fi mj ma l mb mc">}});}</span><span id="0edc" class="ly kg hi lu b fi mj ma l mb mc">}</span></pre><p id="d59e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您运行此代码时，您将在控制台中获得fcm_token，然后复制该令牌并执行以下步骤:</p><h1 id="cdfd" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">步骤十</h1><p id="df9f" class="pw-post-body-paragraph iq ir hi is b it lf iv iw ix lg iz ja jb mg jd je jf mh jh ji jj mi jl jm jn hb bi translated">打开firebase项目，转到云消息部分，编写通知标题和正文，如下所示:</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/9a579d7cbb4086cc5d4fe77e705b3bf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G9obYmNZK_25dMVwgaGNHw.png"/></div></div></figure><p id="fb3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如上图，点击<strong class="is hj">发送短信，</strong>你会得到如下图:</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/c842a4bdd01e009f2f6610e391cf7ed8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Czoz2XJGNBzFqh0tjexq8w.png"/></div></div></figure><p id="1bf9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里粘贴fcm_token(您在前面的步骤中从终端复制的内容)并点击<strong class="is hj">测试</strong>按钮。<br/>因此，在所有这些步骤之后，你会在手机中收到通知，要么应用程序处于运行状态，要么在后台运行，要么被关闭。如果你想打开那个通知，那么<a class="ae jo" href="https://lakshydeep-14.medium.com/on-tap-push-notification-redirect-to-corresponding-screen-in-flutter-9f184068e4f8" rel="noopener">这里的</a>就是所有的步骤。</p></div><div class="ab cl ml mm gp mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="hb hc hd he hf"><p id="7240" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，推送通知起作用了，你可以在未来的应用中使用这个功能。<br/>谢谢:)</p><p id="3eee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">关注我<a class="ae jo" href="https://www.facebook.com/Flutter-Motivation-with-Lakshydeep-104972618552227/" rel="noopener ugc nofollow" target="_blank">这里</a>了解更多更新。</p><p id="7d65" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">欲了解更多信息，请购买书籍"<strong class="is hj">让自己成为软件开发人员:让我们深入了解Flutter &amp; MNCs </strong> " <a class="ae jo" href="https://www.amazon.com/dp/B09NNXNT6X/ref=sr_1_1?keywords=make+yourself+the+software&amp;qid=1639582180&amp;sr=8-1" rel="noopener ugc nofollow" target="_blank">购买</a>。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ms"><img src="../Images/2847826b574dbee05a043fa6b53f06e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N6sXnVytdB7P7g2gqXYlFg.jpeg"/></div></div></figure><p id="948b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">继续编码，继续学习，然后继续赚钱<br/>给予反馈</p></div></div>    
</body>
</html>