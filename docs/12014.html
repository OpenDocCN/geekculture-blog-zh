<html>
<head>
<title>Create an Emergency Broadcast System With Vonage, Node, and MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Vonage、Node和MongoDB创建一个紧急广播系统</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/create-an-emergency-broadcast-system-with-vonage-node-and-mongodb-acc222e4ad9f?source=collection_archive---------16-----------------------#2022-04-20">https://medium.com/geekculture/create-an-emergency-broadcast-system-with-vonage-node-and-mongodb-acc222e4ad9f?source=collection_archive---------16-----------------------#2022-04-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ba65a374475a4db06e34326b4f9ceb9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RT9WV8ujhTJGT04WBxp_xA.png"/></div></div></figure><p id="4f24" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在紧急情况下很难做对任何事情，尤其是当你惊慌失措的时候！如果你遇到紧急情况，像让正确的人知道你需要帮助这样简单的事情可能会被证明是不可能的。今天，我们将通过构建一个web应用程序来解决这一问题，该应用程序允许您单击一个按钮，通过文本通知您的家人您正处于紧急情况中，并发送您的位置。我们将使用Node.js、Express、MongoDB和Vonage Messages API创建这个网站。Node是一个流行的web服务器，Express是开发人员经常使用的框架。MongoDB是一个NoSQL数据库，Vonage Messages API允许您以编程方式快速发送消息(比如SMS消息)。</p><p id="f387" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您的web应用程序将如下所示。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jo"><img src="../Images/bb7add6ab08dfe439e66fd8a96b37ff2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GWZRf3Hv1muxq6FN.png"/></div></div></figure><p id="59da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以添加联系人，查看他们，当您按下提醒按钮时，它会向您的所有联系人发送短信，让他们知道您的位置和您的紧急情况。</p><p id="a002" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">随着您的跟进，您可以在这个GitHub库中找到这个项目的所有代码。</p><p id="7224" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">准备好开始了吗？我们来搭建一个紧急播报app吧！</p><h1 id="a24b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">先决条件</h1><p id="a6e8" class="pw-post-body-paragraph iq ir hi is b it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn hb bi translated">要跟随这个教程，你需要Node(你可以<a class="ae jt" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">在这里</a>下载)。你还需要一个Vonage账户，你可以<a class="ae jt" href="https://www.vonage.com/communications-apis/" rel="noopener ugc nofollow" target="_blank">在这里</a>注册。你还需要一个<a class="ae jt" href="https://account.mongodb.com/account/register" rel="noopener ugc nofollow" target="_blank"> MongoDB账户</a>。</p><p id="0df1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在你注册了你的MongoDB账号之后，你需要建立一个MongoDB Atlas数据库，你可以在MongoDB的文档中学习<a class="ae jt" href="https://docs.mongodb.com/manual/tutorial/getting-started/" rel="noopener ugc nofollow" target="_blank">做这个。</a></p><p id="7905" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦你创建了你的Vonage帐户，你需要做一些初始设置。</p><p id="fff3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用以下命令全局安装Vonage CLI:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="6d22" class="lc jv hi ky b fi ld le l lf lg">npm install @vonage/cli -g</span></pre><p id="201d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="5f3c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，使用您的Vonage API密钥和密码配置CLI。您可以在开发人员仪表板中找到此信息。</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="534b" class="lc jv hi ky b fi ld le l lf lg">vonage config:set --apiKey=VONAGE_API_KEY --apiSecret=VONAGE_API_SECRET</span></pre><p id="5f36" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="fe56" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为您的项目创建一个新目录，并放入CD:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="505c" class="lc jv hi ky b fi ld le l lf lg">mkdir my_project<br/>cd my_project</span></pre><p id="c0e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="4a69" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，使用CLI通过以下命令创建一个Vonage应用程序:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="98b7" class="lc jv hi ky b fi ld le l lf lg">vonage apps:create</span></pre><p id="eeeb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="f071" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">滚动到消息，点击空格键，并点击回车。现在你需要一个号码来接听电话。您可以使用以下命令租用一个(用您的代码替换国家代码)。例如，如果你在英国，用GB替换我们:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="3954" class="lc jv hi ky b fi ld le l lf lg">vonage numbers:search US<br/>vonage numbers:buy [NUMBER] [COUNTRYCODE]</span></pre><p id="744f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="9f7f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在将该号码链接到您的应用程序:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="b1b1" class="lc jv hi ky b fi ld le l lf lg">vonage apps:link --number=VONAGE_NUMBER APP_ID</span></pre><p id="5887" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><h1 id="a375" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">构建广播系统</h1><p id="849b" class="pw-post-body-paragraph iq ir hi is b it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn hb bi translated">首先，您需要安装将用于这个项目的JavaScript库，如下所示:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="9146" class="lc jv hi ky b fi ld le l lf lg">npm install express body-parser dotenv firebase mongodb mongoose @vonage/server-sdk</span></pre><p id="95c9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="1105" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，在项目中创建一个. env文件，并添加以下变量:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="8045" class="lc jv hi ky b fi ld le l lf lg">API_KEY=your_vonage_api_key<br/>API_SECRET=your_vonage_secret<br/>APPLICATION_ID=your_vonage_application_id<br/>PRIVATE_KEY=your_vonage_private_key<br/>FROM_NUMBER=your_vonage_number<br/>PORT=5000<br/>MONGO_URL=your_mongodb_url</span></pre><p id="135d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="7ae5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">确保用您的Vonage和MongoDB帐户的信息替换每个变量的每个等号后面的所有内容。</p><p id="0868" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，创建一个名为<code class="du lh li lj ky b">app.js</code>的文件并导入这些库:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="5a48" class="lc jv hi ky b fi ld le l lf lg">require('dotenv/config')<br/>require('mongodb')<br/>const express = require('express')<br/>const Vonage = require('@vonage/server-sdk')<br/>const bodyParser = require('body-parser')<br/>const mongoose = require('mongoose')</span></pre><p id="c37a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="6258" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们从创建一个<code class="du lh li lj ky b">"Hello, World!"</code> Express应用程序开始。以下是方法:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="9060" class="lc jv hi ky b fi ld le l lf lg">const app = express()</span><span id="13c9" class="lc jv hi ky b fi lk le l lf lg">app.get('/', function(req, res) {<br/>    res.send('Hello World!')<br/>})</span><span id="afc7" class="lc jv hi ky b fi lk le l lf lg">app.listen(process.env.PORT)</span></pre><p id="5cbc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="ccc8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，像这样运行您的代码:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="09d2" class="lc jv hi ky b fi ld le l lf lg">node app.js</span></pre><p id="a898" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="8336" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当你运行这段代码并进入你的本地服务器(http://127.0.0.1:5000)时，它应该显示<code class="du lh li lj ky b">Hello, World!</code></p><p id="8245" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，将这段代码添加到<code class="du lh li lj ky b">const app = express()</code>下面:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="5926" class="lc jv hi ky b fi ld le l lf lg">app.use(bodyParser.json())<br/>app.use(bodyParser.urlencoded({<br/>    extended: true<br/>}))<br/>app.use(express.static('public'))</span></pre><p id="ffa4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="285f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这段代码帮助您使用Express接受POST请求，并告诉Express从一个名为<code class="du lh li lj ky b">public</code>的目录中提供静态文件。</p><p id="7d91" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">是时候添加代码来连接到您的MongoDB数据库了！将这段代码添加到您的应用程序中，并更新您的<code class="du lh li lj ky b">.env</code>文件，以包含一个名为<code class="du lh li lj ky b">MONGO_URL</code>的环境变量，该变量包含到您的MongoDB数据库的链接。</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="9889" class="lc jv hi ky b fi ld le l lf lg">mongoose.connect(process.env.MONGO_URL, {<br/>    useNewUrlParser: true,<br/>    useUnifiedTopology: true<br/>})<br/>const contactsSchema = new mongoose.Schema({<br/>    name: String,<br/>    number: Number<br/>})<br/>const Contacts = mongoose.model('Contacts', contactsSchema)</span></pre><p id="db4e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="2072" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面的代码使用Mongoose连接到您的MongoDB数据库，为您的联系人(您将向其发送SMS消息的人)创建一个模式，并创建一个名为<code class="du lh li lj ky b">Contacts</code>的新模型来从您的数据库添加和获取联系人。</p><p id="3673" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，添加这段代码来帮助使用Vonage messages API发送SMS消息。</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="bff5" class="lc jv hi ky b fi ld le l lf lg">const vonage = new Vonage({<br/>    apiKey: process.env.API_KEY,<br/>    apiSecret: process.env.API_SECRET,<br/>    applicationId: process.env.APPLICATION_ID,<br/>    privateKey: process.env.PRIVATE_KEY<br/>})</span></pre><p id="111f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="ce13" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面的代码创建了一个新的Vonage对象，并将您的API密钥、秘密、应用程序ID和私钥传递给您的应用程序。</p><p id="1f14" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，让我们创建几个端点。将以下代码添加到<code class="du lh li lj ky b">app.js</code>:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="8ce3" class="lc jv hi ky b fi ld le l lf lg">app.post('/contacts', function(req, res) {<br/>    const contact = new Contacts({<br/>        name: req.body.name<br/>    })<br/>    contact.save()<br/>    res.redirect('/')<br/>})</span></pre><p id="550e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="ec34" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，当您向<code class="du lh li lj ky b">/contacts</code>发送POST请求时，这段代码会在MongoDB中创建一个新的联系人，并将用户重定向到主页。</p><p id="0c6e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们创建一个端点，从数据库中获取所有联系人。将以下代码添加到<code class="du lh li lj ky b">app.js</code>:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="28e7" class="lc jv hi ky b fi ld le l lf lg">app.get('/contacts', function(req, res) {<br/>    Contacts.find({}, function(err, contacts) {<br/>        if(err){<br/>            console.log(err)<br/>       }<br/>       else {<br/>           res.json(contacts)<br/>       }<br/>   })<br/>})</span></pre><p id="11c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="fb0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您向<code class="du lh li lj ky b">/contacts</code>发送GET请求时，这段代码获取数据库中的所有联系人，并将其作为JSON返回。</p><p id="5d2b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，让我们定义一个发送SMS消息的端点。将此代码添加到<code class="du lh li lj ky b">app.js</code>:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="e123" class="lc jv hi ky b fi ld le l lf lg">app.post('/alert', function(req, res) {<br/>    let long = req.body['coordinates']['long']<br/>    let lat = req.body['coordinates']['lat']<br/>    let contacts = req.body['contacts']<br/>    for (let i = 0; i &lt;= contacts.length; i++) {<br/>        vonage.channel.send({<br/>                'type': 'sms',<br/>                "number": contacts[i].number<br/>            }, {<br/>                'type': 'sms',<br/>                "number": process.env.FROM_NUMBER<br/>            }, {<br/>                'content': {<br/>                    'type': 'text',<br/>                    'text': `SOS! Your friend is in an emergency! Their latitude is ${lat} and` +<br/>                        `their longitude is ${long}!`<br/>                }<br/>            },<br/>            (err, data) =&gt; {<br/>                if (err) {<br/>                    console.error(err)<br/>                } else {<br/>                    console.log(data.message_uuid)<br/>                }<br/>            }<br/>        )<br/>    }<br/>})</span></pre><p id="cf60" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="9f2d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个端点用JSON接受POST请求，其中包含用户的纬度、经度和要发送SMS消息的号码列表。</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="95cb" class="lc jv hi ky b fi ld le l lf lg">let long = req.body['coordinates']['long']<br/>let lat = req.body['coordinates']['lat']<br/>let contacts = req.body['contacts']</span></pre><p id="bc48" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="4c4d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，它遍历联系人，并使用Vonage Messages API向每个号码发送一条消息。</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="dac9" class="lc jv hi ky b fi ld le l lf lg">for (let i = 0; i &lt;= contacts.length; i++) {<br/>    vonage.channel.send({<br/>                'type': 'sms',<br/>                'number': contacts[i].number<br/>            }, {<br/>                'type': 'sms',<br/>                'number': process.env.FROM_NUMBER<br/>            }, {<br/>                'content': {<br/>                    'type': 'text',<br/>                    'text': `SOS! Your friend is in an emergency! Their latitude is ${lat} and` +<br/>                        `their longitude is ${long}!`<br/>                }<br/>            },</span></pre><p id="b9ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="31b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，让我们更新我们的主页端点，以便在用户访问我们的web应用程序主页时进行处理。更改以前的代码:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="f341" class="lc jv hi ky b fi ld le l lf lg">app.get('/', function(req, res) {<br/>    res.send('Hello World!')<br/>})</span></pre><p id="c53c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="57f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对此:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="a565" class="lc jv hi ky b fi ld le l lf lg">app.get('/', function(req, res) {<br/>    res.sendFile('index.html')<br/>})</span></pre><p id="7a50" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="02cd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您的主页将为您将要创建的文件index.html提供服务。</p><p id="e3d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">继续创建一个名为index.html的新文件，并添加以下代码:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="993f" class="lc jv hi ky b fi ld le l lf lg">&lt;!DOCTYPE html&gt;<br/>&lt;html lang='en'&gt;<br/>   &lt;head&gt;<br/>      &lt;meta charset='UTF-8'&gt;<br/>      &lt;title&gt;Emergency Broadcast&lt;/title&gt;<br/>      &lt;link rel='stylesheet' href='style.css'&gt;<br/>   &lt;/head&gt;<br/>   &lt;body&gt;<br/>      &lt;h1 id='top'&gt;Add Contact&lt;/h1&gt;<br/>      &lt;form action='/contacts' method='POST'&gt;<br/>         &lt;div&gt;<br/>            &lt;input id='name' class='forms' type='text' name='name' placeholder='name'&gt; &lt;br&gt;<br/>            &lt;input id='number' class='forms' type='text' name='number' placeholder='number'&gt;<br/>         &lt;/div&gt;<br/>         &lt;div&gt;<br/>            &lt;input type='submit' value='Add' class='tons' id='add'&gt;<br/>         &lt;/div&gt;<br/>      &lt;/form&gt;<br/>      &lt;br&gt; &lt;br&gt;<br/>      &lt;h1&gt;Your Contacts&lt;/h1&gt;<br/>      &lt;div&gt;&lt;/div&gt;<br/>      &lt;div id='contacts'&gt;&lt;/div&gt;<br/>      &lt;button onclick='alert_them()' class='tons' id='alert'&gt;ALERT&lt;/button&gt;<br/>   &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="088f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="db7b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面的HTML创建了一个表单，允许您输入一个人的姓名和号码，并按下Add按钮。当您按下Add时，表单向<code class="du lh li lj ky b">/contacts</code>发送一个POST请求，这将在您的数据库中创建一个新的联系人。这个HTML也有一个警告按钮。当你按下它时，它向<code class="du lh li lj ky b">/alert</code>发送POST请求，向你数据库中的所有联系人发送SMS消息。</p><p id="18d6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，您需要在这个HTML中添加一些JavaScript来显示用户的联系人列表，并准备发送给<code class="du lh li lj ky b">/alert</code>的数据。</p><p id="1f4f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在HTML中的ALERT按钮之后，添加一个脚本标记并定义一个名为data的对象。</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="e30d" class="lc jv hi ky b fi ld le l lf lg">&lt;script&gt;<br/>    let data = {}<br/>&lt;/script&gt;</span></pre><p id="2879" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="f1d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用<code class="du lh li lj ky b">data</code>来存储发送到<code class="du lh li lj ky b">/alert</code>的数据。</p><p id="1fd4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，调用一个名为<code class="du lh li lj ky b">httpPostAsync</code>的函数，并传入<code class="du lh li lj ky b">‘/contacts’</code>和<code class="du lh li lj ky b">create_contacts</code>:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="04ac" class="lc jv hi ky b fi ld le l lf lg">&lt;script&gt;<br/>    let data = {}<br/>    httpPostAsync('/contacts', create_contacts)<br/>&lt;/script&gt;</span></pre><p id="5a2e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="bfea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，定义<code class="du lh li lj ky b">create_contacts</code>:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="35c6" class="lc jv hi ky b fi ld le l lf lg">function create_contacts(contacts) {<br/>    data['contacts'] = []<br/>    for (let i = 0; i &lt; contacts.length; i++) {<br/>        let contact = contacts[i]<br/>        data['contacts'].push(contact)<br/>        const newDiv = document.createElement('div')<br/>        newDiv.className = 'left'<br/>        const newContent = document.createTextNode(contact.name)<br/>        newDiv.appendChild(newContent)<br/>        const currentDiv = document.getElementById('contacts')<br/>        document.body.insertBefore(newDiv, currentDiv)<br/>    }<br/>}</span></pre><p id="f7b0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="41fc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是一个回调函数<code class="du lh li lj ky b">httpPostAsync</code>在从服务器获取联系数据时会调用。它接受联系人作为参数(联系人数据)。首先，这个函数向<code class="du lh li lj ky b">data['contacts']</code>添加一个数组。然后，它遍历来自服务器的联系人，将每个联系人添加到数组中，并用每个联系人的名字创建一个新的HTML <code class="du lh li lj ky b">div</code>。</p><p id="a76c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您需要定义<code class="du lh li lj ky b">httpPostAsync</code>:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="1826" class="lc jv hi ky b fi ld le l lf lg">function httpPostAsync(theUrl, callback) {<br/>    let xmlHttp = new XMLHttpRequest()<br/>    xmlHttp.onreadystatechange = function() {<br/>        if (xmlHttp.readyState == 4 &amp;&amp; xmlHttp.status == 200)<br/>            callback(JSON.parse(xmlHttp.responseText))<br/>    }<br/>    xmlHttp.open('GET', theUrl, true)<br/>    xmlHttp.send()<br/>}</span></pre><p id="30de" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="3974" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这段代码向一个URL发送一个GET请求，并传入它在对回调函数的响应中收到的JSON。</p><p id="e1d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，您需要定义一个当用户单击警告按钮时做出响应的函数。</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="91b1" class="lc jv hi ky b fi ld le l lf lg">function alert_them() {<br/>    function success(position) {<br/>        data['coordinates'] = {}<br/>        data['coordinates'] = position.coords.latitude<br/>        data['coordinates'] = position.coords.longitude<br/>        let xmlHttp = new XMLHttpRequest()<br/>        xmlHttp.open('POST', '/alert', true)<br/>        xmlHttp.setRequestHeader('Content-Type', 'application/json')<br/>        xmlHttp.send(JSON.stringify(data))<br/>        alert('Message Sent!')<br/>    }</span><span id="20ce" class="lc jv hi ky b fi lk le l lf lg">    function error() {<br/>        console.log('error')<br/>    }<br/>    if (!navigator.geolocation) {<br/>        console.log('Geolocation is not supported by your browser')<br/>    } else {<br/>        navigator.geolocation.getCurrentPosition(success, error)<br/>    }<br/>}</span></pre><p id="6a0a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="f3d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该功能检查<code class="du lh li lj ky b">navigator.geolocation</code>是否为<code class="du lh li lj ky b">true</code>。<code class="du lh li lj ky b">Navigator.geolocation</code>让你获得用户的位置。你得检查一下是不是真的，因为有些浏览器版本不支持。如果为真，上面的函数调用<code class="du lh li lj ky b">navigator.geolocation.getCurrentPosition(success, error)</code>并传入两个函数:一个处理浏览器成功获取用户位置时发生的情况，另一个处理错误。</p><p id="0e70" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lh li lj ky b">success</code>函数将用户的坐标添加到<code class="du lh li lj ky b">data['coordinates']</code>中，然后向<code class="du lh li lj ky b">/alert</code>发送一个包含数据的POST请求。</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="9d85" class="lc jv hi ky b fi ld le l lf lg">function success(position) {<br/>    data['coordinates'] = {}<br/>    data['coordinates'] = position.coords.latitude<br/>    data['coordinates'] = position.coords.longitude<br/>    let xmlHttp = new XMLHttpRequest()<br/>    xmlHttp.open('POST', '/alert', true)<br/>    xmlHttp.setRequestHeader('Content-Type', 'application/json')<br/>    xmlHttp.send(JSON.stringify(data))<br/>}</span></pre><p id="e12b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="b64e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，您的<code class="du lh li lj ky b">/alert</code>端点向数据库中的所有联系人发送一条SMS消息，让他们知道发送者有麻烦，以及发送者的纬度和经度。现在你只需要用一些CSS来设计你的应用程序。在public中创建一个名为<code class="du lh li lj ky b">style.css</code>的新文件，并添加以下代码:</p><pre class="jp jq jr js fd kx ky kz la aw lb bi"><span id="c148" class="lc jv hi ky b fi ld le l lf lg">body {<br/>    background-color: lavenderblush;<br/>    text-align: center<br/>}</span><span id="8542" class="lc jv hi ky b fi lk le l lf lg">h1 {<br/>    color: #111;<br/>    font-family: 'Helvetica Neue', sans-serif;<br/>    font-size: 30px;<br/>    font-weight: bold;<br/>    letter-spacing: -1px;<br/>    line-height: 1;<br/>    text-align: center; <br/>}</span><span id="3fcf" class="lc jv hi ky b fi lk le l lf lg">.forms {<br/>    height: 2.5em;<br/>    width: 30%;<br/>}</span><span id="2d84" class="lc jv hi ky b fi lk le l lf lg">.tons {<br/>    margin-top: 1em;<br/>    background-color: #4CAF50; /* Green */<br/>    border: none;<br/>    color: #f8f8ff;<br/>    padding: 15px 32px;<br/>    text-align: center;<br/>    text-decoration: none;<br/>    display: inline-block;<br/>    font-size: 22px;<br/>    font-family: Arial, serif;<br/>}</span><span id="0cfb" class="lc jv hi ky b fi lk le l lf lg">.custom-field input {<br/>    border: none;<br/>    -webkit-appearance: none;<br/>    -ms-appearance: none;<br/>    -moz-appearance: none;<br/>    appearance: none;<br/>    background: #f2f2f2;<br/>    padding: 12px;<br/>    border-radius: 3px;<br/>    width: 250px;<br/>    font-size: 14px;<br/>}</span><span id="18fe" class="lc jv hi ky b fi lk le l lf lg">#alert {<br/>    margin-bottom: 5em;<br/>    margin-top:1em;<br/>    background-color:red;<br/>}</span><span id="9e12" class="lc jv hi ky b fi lk le l lf lg">#alert:hover {<br/>    background-color: black;<br/>}</span><span id="11a8" class="lc jv hi ky b fi lk le l lf lg">#add {<br/>    background-color:black;<br/>}</span><span id="c80f" class="lc jv hi ky b fi lk le l lf lg">#add:hover {<br/>    background-color: pink;<br/>}</span><span id="27da" class="lc jv hi ky b fi lk le l lf lg">#top {<br/>    margin-top: 5em;<br/>    margin-bottom: 1.5em;<br/>}</span><span id="8897" class="lc jv hi ky b fi lk le l lf lg">.cons{<br/>    font-size: 22px;<br/>}</span><span id="e777" class="lc jv hi ky b fi lk le l lf lg">#number {<br/>    margin-top: 1em;<br/>}</span></pre><p id="2c13" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制</p><p id="2f0d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在当你进入你的网站主页时，你应该会看到一个类似本文开头图片的网站。</p><p id="9607" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将您自己添加为联系人，然后按提醒。</p><p id="3aee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你应该会收到一条包含你的经度和纬度的短信，让你知道你处于紧急状态。</p><h1 id="8ab3" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">最后的想法</h1><p id="d476" class="pw-post-body-paragraph iq ir hi is b it ks iv iw ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn hb bi translated">此演示只是一个起点！你可以给它添加很多功能。例如，如果您在生产中使用它，您会想要创建一个特性来处理不同的用户(使用用户名和密码登录，等等。).你还可以添加一些功能，比如编辑联系人，为正在发生的紧急情况添加选项。如果你决定在这个演示的基础上进行构建，我很想看看你会怎么做:确保<a class="ae jt" href="https://twitter.com/VonageDev" rel="noopener ugc nofollow" target="_blank">把你在Twitter上构建的东西</a>发送给我们。另外，一定要加入Vonage开发者社区，获取更多精彩的内容和教程。你可以点击<a class="ae jt" href="https://twitter.com/VonageDev" rel="noopener ugc nofollow" target="_blank">推特</a>关注Vonage，点击加入我们的<a class="ae jt" href="https://developer.vonage.com/community/slack" rel="noopener ugc nofollow" target="_blank"> Slack频道。我希望你喜欢这个教程！感谢阅读！</a></p><p id="667b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ll">最初发布于</em><a class="ae jt" href="https://developer.vonage.com/blog/2022/02/10/create-an-emergency-broadcast-system-with-vonage-node-and-mongodb" rel="noopener ugc nofollow" target="_blank"><em class="ll">https://developer . vonage . com/blog/2022/02/10/create-an-emergency-broadcast-system-with-vonage-node-and-MongoDB</em></a></p></div></div>    
</body>
</html>