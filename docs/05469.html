<html>
<head>
<title>Let’s build YouI StackView</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们构建您的堆栈视图</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-stackview-works-861035c72e83?source=collection_archive---------30-----------------------#2021-07-21">https://medium.com/geekculture/how-stackview-works-861035c72e83?source=collection_archive---------30-----------------------#2021-07-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/75e5515f9323f23f00feabf6e1e049b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-1SDO6u6j4XjSz85.jpg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Credits: <a class="ae iu" href="https://www.venetian.com" rel="noopener ugc nofollow" target="_blank">The Venetian</a></figcaption></figure><blockquote class="iv"><p id="650d" class="iw ix hi bd iy iz ja jb jc jd je jf dx translated">当形势对你不利时，使用StackView和chill。</p><p id="9c18" class="iw ix hi bd iy iz jg jh ji jj jk jf dx translated">-菠萝</p></blockquote><p id="774a" class="pw-post-body-paragraph jl jm hi jn b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh jf hb bi translated">你知道吗，一场扑克比赛曾经持续了将近八年半！<br/> 既然我拥有最珍贵的礼物；请注意，让我们直接进入这篇文章的主题:</p><p id="a5af" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated"><strong class="jn hj">观众<br/> </strong>初级、中级<br/> <strong class="jn hj">我们在构建什么<br/></strong>ui view中垂直堆叠的两个标签应使用纯自动布局根据较大标签的内容宽度自动调整大小:</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/8c66ebd065154c0b116c55e4e3d7fc95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TjNZuLedeu_TdSSo22dc8A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Fig 1</figcaption></figure><p id="7d64" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated"><strong class="jn hj">我们没有构建什么<br/> </strong>从零开始构建StackView实现，这更像是对自动布局如何工作的理解，这在StackView中得到了利用</p><h1 id="4801" class="ks kt hi bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">迭代0</h1><p id="7e55" class="pw-post-body-paragraph jl jm hi jn b jo lq jq jr js lr ju jv jw ls jy jz ka lt kc kd ke lu kg kh jf hb bi translated">让我们试着做我们大多数人第一次尝试会做的事情:</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/53df95672b85a0230944fb249502f4dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GgMfN5_VZzGTLHc_xzPdjQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Fig 2</figcaption></figure><ol class=""><li id="2dcb" class="lw lx hi jn b jo ki js kj jw ly ka lz ke ma jf mb mc md me bi translated">红色标签。领先=超级查看。领先+ 20</li><li id="f036" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated">红色标签。Top = Superview。Top + 20</li><li id="ff86" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated"><em class="mk">红色标签。尾随+ 20 =超级视图。尾随</em></li><li id="2270" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated">蓝色标签。顶部=红色标签。Top + 20</li><li id="5a03" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated">蓝色标签。领先=超级查看。领先+ 20</li><li id="683a" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated"><em class="mk">蓝色标签。尾随+ 20 =超级视图。尾随</em></li><li id="111c" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated">蓝色标签。底部=超级视图。底部+ 20</li></ol><p id="9157" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated">这些约束有一个问题，等式(3)和(6)不能同时满足，这在查看图2 时很明显</p><p id="d758" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated">但是，有趣的是，大多数时候我们都侥幸逃脱了:</p><ul class=""><li id="6216" class="lw lx hi jn b jo ki js kj jw ly ka lz ke ma jf ml mc md me bi translated">如果你使用Storyboard，它会显示错误&amp;建议通过碰撞标签水平内容拥抱和抗压优先级(CHCR优先级)中的任何一个来修复。<br/>尽管它消除了错误，但可能不是正确的解决方案。Storyboard非常聪明，但还不足以了解人类的需求，在这种情况下，我们不希望任何一个标签增长或收缩。</li><li id="e498" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf ml mc md me bi translated">如果您以编程方式创建视图，那么在模拟器上看起来可能没问题，因为较小的标签会被拉伸&amp;可能没有设置背景颜色。但是我们会在控制台上看到违反约束的日志，老实说，我们有时会方便地忽略它。</li></ul><h1 id="ba10" class="ks kt hi bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">迭代1</h1><p id="4add" class="pw-post-body-paragraph jl jm hi jn b jo lq jq jr js lr ju jv jw ls jy jz ka lt kc kd ke lu kg kh jf hb bi translated">现在我们知道约束只在尾部冲突，让我们只关注它，记住我们的需求。</p><p id="d8c1" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated">但是，在我们这样做之前，在图2 的<em class="mk">中有一个捕捉，两组约束(对于宽度<em class="mk"/>&amp;<em class="mk">高度</em>)对我们来说是不可见的，这是由布局引擎为所有具有固有内容大小的视图自动添加的。我们将关注<em class="mk">宽度</em>的约束集，因为它将帮助我们解决尾部的冲突约束。</em></p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/5542df50b85e1ec8f1a999c9ef91bd65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Vksmd2ZlfhTsdTtS.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Fig 3: Content Hugging &amp; Compression | Credits: <a class="ae iu" href="https://developer.apple.com/" rel="noopener ugc nofollow" target="_blank">Apple</a></figcaption></figure><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/aa30f7604e8956c0251670dd7ef39774.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OdoDcYGPCPvwe7_lBCFHeg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Fig 4</figcaption></figure><p id="e109" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated">布局引擎为标签的<em class="mk">宽度</em>添加了以下约束:</p><p id="b037" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated"><em class="mk">对于内容拥抱:</em><br/>label . width≤0.0 * NotAnAttribute+intrinsic width<strong class="jn hj"><em class="mk">(优先级:250) </em> </strong></p><p id="f8ea" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated"><em class="mk">抗压:</em><br/>label . width≥0.0 * NotAnAttribute+intrinsic width<strong class="jn hj"><em class="mk">(优先级:750) </em> </strong></p><p id="c28d" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated">如果你想知道为什么优先考虑抗压性，那是因为iOS不希望我们的内容被剪切，如果它被扩展，对用户来说是没问题的。</p><p id="f400" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi mn translated">现在，我们知道了布局引擎隐藏的约束，我们可以回到只在尾部修正冲突约束。让我们退一步&amp;想清楚我们想要什么或者我们的要求是什么:</p><ul class=""><li id="bda6" class="lw lx hi jn b jo ki js kj jw ly ka lz ke ma jf ml mc md me bi translated">如果我们只考虑较小的标签，我们需要尾部间距大于20</li><li id="8ec6" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf ml mc md me bi translated">如果我们只考虑较大的标签，我们需要尾部间距等于20</li></ul><p id="ca41" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated">如果我们能把这两个条件结合起来，我们最终会得到:</p><ul class=""><li id="8f68" class="lw lx hi jn b jo ki js kj jw ly ka lz ke ma jf ml mc md me bi translated">两个标签都需要大于或等于20的尾部间距</li><li id="5c9f" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf ml mc md me bi translated">如果能够满足布局引擎对<em class="mk">宽度</em>的约束，两个标签可能都需要等于20的尾部间距。基本上，我们可以给它设置一个比图4 中<em class="mk">宽度</em>约束集的最低优先级<strong class="jn hj"> (250) </strong>更低的优先级<strong class="jn hj">(比如249) </strong>。</li></ul><p id="7872" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated"><strong class="jn hj">注:</strong> <br/>在计算约束方程的解时:</p><ul class=""><li id="a1d2" class="lw lx hi jn b jo ki js kj jw ly ka lz ke ma jf ml mc md me bi translated">自动布局试图按照从高到低的优先级顺序满足所有约束。</li><li id="d7d7" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf ml mc md me bi translated">如果它不能满足可选约束<em class="mk">(一个不需要的约束；非1000优先级)</em>，跳过该约束，继续下一个约束。</li></ul><p id="92cd" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated">因此，自动布局还会考虑到两个标签可能都需要等于20的尾部间距，但它会更倾向于布局引擎对<em class="mk">宽度</em>的约束集。如果它满足其他约束，它将保留它，在我们的情况下，只有更大的标签将满足。</p><p id="29a8" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated">焦点中的尾随约束看起来是这样的:</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/2c8a977d97c0728107f12071ab0c9d58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uKMlwkbSKqjP879N_4P2dg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Fig 5</figcaption></figure><ol class=""><li id="310a" class="lw lx hi jn b jo ki js kj jw ly ka lz ke ma jf mb mc md me bi translated">红色标签。尾随+ 20 =超级视图。尾随<em class="mk"> </em> <strong class="jn hj"> <em class="mk">(优先级:249) </em> </strong></li><li id="8a00" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated">超级视角。尾随<em class="mk"> </em> ≥红色标签。尾随+ 20</li><li id="a546" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated">蓝色标签。尾随+ 20 =超级视图。尾随<em class="mk"> </em> <strong class="jn hj"> <em class="mk">(优先级:249) </em> </strong></li><li id="5641" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated">超级视角。尾随<em class="mk"> </em> ≥蓝色标签。尾随+ 20</li></ol><p id="fb2d" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated">图1 中<strong class="jn hj">案例1 </strong>，上面的(1)不能满足，但(3)可以满足。反之，对于<strong class="jn hj">情况2 </strong>，(3)不能满足，但(1)可以。</p><p id="240c" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated">因此，完整的工作约束将如下所示:</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/7f8d2686450ce19ffceed0a7a9d2d94e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xHfxb3FeY5xILz-aESy4Tw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Fig 6</figcaption></figure><ol class=""><li id="9596" class="lw lx hi jn b jo ki js kj jw ly ka lz ke ma jf mb mc md me bi translated">红色标签。领先=超级查看。领先+ 20</li><li id="4727" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated">红色标签。Top = Superview。Top + 20</li><li id="edd7" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated">红色标签。尾随+ 20 =超级视图。尾随<em class="mk"> </em> <strong class="jn hj"> <em class="mk">(优先级:249) </em> </strong></li><li id="c809" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated">超级视角。拖尾<em class="mk"> </em> ≥红色标签。尾随+ 20</li><li id="1faa" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated">蓝色标签。顶部=红色标签。Top + 20</li><li id="2777" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated">蓝色标签。领先=超级查看。领先+ 20</li><li id="c597" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated">蓝色标签。尾随+ 20 =超级视图。尾随<em class="mk"> </em> <strong class="jn hj"> <em class="mk">(优先级:249) </em> </strong></li><li id="a44c" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated">超级视角。尾随<em class="mk"> </em> ≥蓝标。尾随+ 20</li><li id="97fd" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf mb mc md me bi translated">蓝色标签。底部=超级视图。底部+ 20</li></ol><h1 id="2b87" class="ks kt hi bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">编码时间到了</h1><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="mw mx l"/></div></figure><p id="8106" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated">我将它设置为IBDesignable，这样我们只需设置IBInspectable属性就可以在故事板上看到预览。图1 中的两种情况看起来都是这样的:</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/51519e6b80d4adbbf92e8994184bd6d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*orkcrJXHEd9j8Pe3rBst3Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Fig 7</figcaption></figure><p id="0b3f" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated">上面的<em class="mk"> VerticalStack </em>代码也适用于2个按钮或1个标签&amp; 1个按钮，基本上适用于任何具有固有内容大小的视图。</p><p id="b627" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated"><strong class="jn hj">注意:</strong> <br/>它只完美地处理了<em class="mk">宽度</em>方面，因为为了简单起见，我故意不考虑<em class="mk">高度</em>。但是，处理高度的概念仍然相似。</p><h1 id="8c46" class="ks kt hi bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">收场白</h1><p id="3003" class="pw-post-body-paragraph jl jm hi jn b jo lq jq jr js lr ju jv jw ls jy jz ka lt kc kd ke lu kg kh jf hb bi translated">在本文中，借助两个标签的垂直堆叠的简单用例，我们讨论了:</p><ul class=""><li id="5061" class="lw lx hi jn b jo ki js kj jw ly ka lz ke ma jf ml mc md me bi translated">约束如何转化为简单的数学方程</li><li id="ee17" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf ml mc md me bi translated">冲突约束是如何发生的</li><li id="5884" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf ml mc md me bi translated">布局引擎如何为具有内在内容大小的视图自动生成约束</li><li id="ccba" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf ml mc md me bi translated">什么是约束优先级</li><li id="da46" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf ml mc md me bi translated">什么是内容拥抱和抵抗优先</li><li id="bc9f" class="lw lx hi jn b jo mf js mg jw mh ka mi ke mj jf ml mc md me bi translated">自动布局如何解决具有不同优先级的约束</li></ul><p id="3c79" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated">我希望你知道自动布局是如何思考的&amp;你应该如何在布局视图时思考。</p><p id="f5a4" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated">暂时就这样吧，下次见…</p><p id="2e5f" class="pw-post-body-paragraph jl jm hi jn b jo ki jq jr js kj ju jv jw kk jy jz ka kl kc kd ke km kg kh jf hb bi translated">快乐编码和分享😍<br/>干杯🍺<br/> <a class="ae iu" href="https://www.linkedin.com/in/alamshahrukh/" rel="noopener ugc nofollow" target="_blank">沙鲁克阿拉姆</a></p></div></div>    
</body>
</html>