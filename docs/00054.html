<html>
<head>
<title>Securing Your CentOS Linux Server with Rootkit Hunter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Rootkit Hunter保护您的CentOS Linux服务器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/securing-your-centos-linux-server-with-rootkit-hunter-9232ae966a2f?source=collection_archive---------4-----------------------#2020-01-01">https://medium.com/geekculture/securing-your-centos-linux-server-with-rootkit-hunter-9232ae966a2f?source=collection_archive---------4-----------------------#2020-01-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/159ec7c8c87a809b5a95d9609db4c780.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9eTHpXUB5CISQmImphcbXg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Image by <a class="ae iu" href="https://www.cybersecurity360.it/giornalisti/paolo-tarsitano/" rel="noopener ugc nofollow" target="_blank">Paolo Tarsitano</a> from <a class="ae iu" href="https://www.cybersecurity360.it/nuove-minacce/scranos-lo-spyware-invisibile-che-estorce-denaro-alle-vittime-dettagli-e-consigli-per-difendersi/" rel="noopener ugc nofollow" target="_blank">Cyber Security 360</a></figcaption></figure><p id="c2ec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated"><span class="l ju jv jw bm jx jy jz ka kb di"/><a class="ae iu" href="https://en.wikipedia.org/wiki/Rootkit" rel="noopener ugc nofollow" target="_blank">rootkit</a>是一个软件集合，通常是恶意的，被设计成允许访问计算机或其软件的一个区域，该区域本来是不被允许的，例如，未授权的用户，并且经常掩盖其存在或其他软件的存在。它是黑客用来获得对计算机或网络的持续管理员级别访问的软件。如今，rootkits通常与特洛伊木马、蠕虫、病毒等恶意软件相关联，这些恶意软件对用户和其他系统进程隐藏了它们的存在和行为。</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es kc"><img src="../Images/810d37d2e23e7ac1c2a0901910d8155a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*cAMJ94uh_7Dc3j8ilelZhQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Image by <a class="ae iu" href="https://www.servernoobs.com/author/admin/" rel="noopener ugc nofollow" target="_blank">admin</a> from <a class="ae iu" href="https://www.servernoobs.com/install-rkhunter/" rel="noopener ugc nofollow" target="_blank">ServerNoobs</a></figcaption></figure><p id="3d91" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated"><span class="l ju jv jw bm jx jy jz ka kb di">R</span>khunter(<a class="ae iu" href="http://rkhunter.sourceforge.net/" rel="noopener ugc nofollow" target="_blank">Rootkit Hunter</a>)是一款基于Unix的工具，可以扫描Rootkit、后门和可能的本地漏洞。它通过将重要文件的SHA-1哈希与在线数据库中已知的良好哈希进行比较，搜索rootkits的默认目录，错误的权限，隐藏文件，内核模块中的可疑字符串，以及对<a class="ae iu" href="https://www.linux.org/" rel="noopener ugc nofollow" target="_blank"> Linux </a>和<a class="ae iu" href="https://www.freebsd.org/" rel="noopener ugc nofollow" target="_blank"> FreeBSD </a>的特殊测试来实现这一点。rkhunter因包含在流行的操作系统中而引人注目。</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es kh"><img src="../Images/8dfeecde79d992d6a30d64ebb95618f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*j2sJerOMjM4LXiKHCTIoJg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Image by <a class="ae iu" href="https://fedoraproject.org/wiki/Artwork" rel="noopener ugc nofollow" target="_blank">Design Team</a> from <a class="ae iu" href="https://fedoraproject.org/wiki/EPEL" rel="noopener ugc nofollow" target="_blank">Fedora</a></figcaption></figure><p id="e0fe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated"><span class="l ju jv jw bm jx jy jz ka kb di">安装rkhunter所需的所有文件都包含在<a class="ae iu" href="https://fedoraproject.org/wiki/EPEL" rel="noopener ugc nofollow" target="_blank">Enterprise Linux</a>存储库中。EPEL库为常用的<a class="ae iu" href="https://www.centos.org/" rel="noopener ugc nofollow" target="_blank"> CentOS </a>企业软件提供了易于安装的软件包。安装EPEL存储库:</span></p><pre class="kd ke kf kg fd ki kj kk kl aw km bi"><span id="8a9c" class="kn ko hi kj b fi kp kq l kr ks">yum install epel-release</span></pre><p id="5d51" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦安装了EPEL存储库，以root用户身份发出以下命令来启动安装例程。</p><pre class="kd ke kf kg fd ki kj kk kl aw km bi"><span id="1342" class="kn ko hi kj b fi kp kq l kr ks">yum -y install rkhunter</span></pre><p id="ccb5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">更新rkhunter数据库以获取最新的定义:</p><pre class="kd ke kf kg fd ki kj kk kl aw km bi"><span id="cf9f" class="kn ko hi kj b fi kp kq l kr ks">rkhunter --update</span></pre><p id="f417" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，您需要更新系统文件属性。这是建立基础数据库文件以比较扫描的必要步骤。全新安装时，第一次运行propupd会创建一个新的数据库文件。在以后的扫描中，运行propupd命令会更新数据库文件。因此，要更新数据库文件，如果您满意，您只需信任源系统文件的更改，请使用以下命令:</p><pre class="kd ke kf kg fd ki kj kk kl aw km bi"><span id="6e01" class="kn ko hi kj b fi kp kq l kr ks">rkhunter --propupd</span></pre><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/b74585e50bf158c3619d065993486989.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rs28R2xYsMckBLNnRdN4gA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Image by <a class="ae iu" href="https://www.youtube.com/channel/UCuKGmfWD41mmefYYI62pfsQ" rel="noopener ugc nofollow" target="_blank">Geotab</a> from <a class="ae iu" href="https://www.youtube.com/watch?v=Bb0jABb24Oc" rel="noopener ugc nofollow" target="_blank">YouTube</a></figcaption></figure><p id="371c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated"><span class="l ju jv jw bm jx jy jz ka kb di"> O </span>打开rkhunter的配置文件进行编辑，并设置电子邮件通知，可通过编辑如下<code class="du ku kv kw kj b">MAIL-ON-WARNING</code>值来启用。当rkhunter发出警告时，您会收到一条消息。请注意，必须正确设置本地邮件，邮件通知才能正常工作。</p><pre class="kd ke kf kg fd ki kj kk kl aw km bi"><span id="0bf5" class="kn ko hi kj b fi kp kq l kr ks">vi /etc/rkhunter.conf</span><span id="dfa9" class="kn ko hi kj b fi kx kq l kr ks">MAIL-ON-WARNING=username@domainname.com</span></pre><p id="2456" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">参数<code class="du ku kv kw kj b">ALLOW_SSH_ROOT_USER</code>告诉rkhunter是否允许root用户通过ssh进入系统。这在文件中默认是未设置的。Rkhunter每次运行都会抱怨这个。如果您禁用了root登录，您应该将该参数设置为“否”。</p><pre class="kd ke kf kg fd ki kj kk kl aw km bi"><span id="64d1" class="kn ko hi kj b fi kp kq l kr ks">ALLOW_SSH_ROOT_USER=no</span></pre><p id="5cd8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于不使用模块的系统，您应该在禁用检查列表中禁用特定于操作系统的检查，否则，您可能会在扫描过程中遇到误报。特定于Linux的测试与模块相关，因此它们都与不使用模块的系统无关:</p><pre class="kd ke kf kg fd ki kj kk kl aw km bi"><span id="9ad3" class="kn ko hi kj b fi kp kq l kr ks">DISABLE_TESTS=suspscan hidden_procs deleted_files packet_cap_apps apps os_specific</span></pre><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ky"><img src="../Images/329bd522edf2846c172178b9661d9455.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kGbwlNhhGGeb-h5GBmiwPA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Image by <a class="ae iu" href="https://creativapixel.com/author/andres/" rel="noopener ugc nofollow" target="_blank">Andrés Sosa</a> from <a class="ae iu" href="https://creativapixel.com/eliminar-automaticamente-copias-backup-cronjob-cpanel-hosting/" rel="noopener ugc nofollow" target="_blank">Creativa Pixel</a></figcaption></figure><p id="f072" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated">rkhunter的当前版本在<code class="du ku kv kw kj b">/etc/cron.daily</code>下预装了一个cronjob。如果您希望将每日报告发送到默认情况下本地根邮件帐户<code class="du ku kv kw kj b">/var/spool/mail/root</code>之外的其他地方(如果发现警告，已经发送到上面指定的地址)，您可以编辑cronjob的配置文件:</p><pre class="kd ke kf kg fd ki kj kk kl aw km bi"><span id="6c81" class="kn ko hi kj b fi kp kq l kr ks">vi /etc/sysconfig/rkhunter</span><span id="edbe" class="kn ko hi kj b fi kx kq l kr ks">MAILTO=username@domainname.com</span></pre><figure class="kd ke kf kg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kz"><img src="../Images/bcf83e0e6d34d27d8352ab9b6855e172.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*XsrfSvRLX5oCWk1YyjTFBg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Image by <a class="ae iu" href="https://www.pickaweb.co.uk/" rel="noopener ugc nofollow" target="_blank">Pickaweb</a> from <a class="ae iu" href="https://www.pickaweb.co.uk/kb/setup-and-configure-rkhunter-malware-scanner/" rel="noopener ugc nofollow" target="_blank">Pickaweb</a></figcaption></figure><p id="85e9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated"><span class="l ju jv jw bm jx jy jz ka kb di"> Y </span>您可以使用自动跳过功能启动手动扫描，即您不必在每次扫描结束时按enter键，通过发出以下命令来测试设置:</p><pre class="kd ke kf kg fd ki kj kk kl aw km bi"><span id="9c4c" class="kn ko hi kj b fi kp kq l kr ks">rkhunter -c -sk</span></pre><p id="24de" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果发现任何警告，您应该会收到以下邮件:</p><blockquote class="la lb lc"><p id="012c" class="iv iw ld ix b iy iz ja jb jc jd je jf le jh ji jj lf jl jm jn lg jp jq jr js hb bi translated">请检查这台机器，因为它可能被感染了。</p></blockquote><p id="de89" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要查看日志以了解更多详细信息，请使用以下命令:</p><pre class="kd ke kf kg fd ki kj kk kl aw km bi"><span id="bf9c" class="kn ko hi kj b fi kp kq l kr ks">grep “Warning” /var/log/rkhunter/rkhunter.log</span></pre></div></div>    
</body>
</html>