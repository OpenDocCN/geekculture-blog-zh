<html>
<head>
<title>Browser Push Notification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">浏览器推送通知</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/browser-push-notification-426695a14701?source=collection_archive---------22-----------------------#2021-05-05">https://medium.com/geekculture/browser-push-notification-426695a14701?source=collection_archive---------22-----------------------#2021-05-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="28be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你有没有想过脸书或Gmail是如何让他们的网站向你的电脑推送通知的？当您开发一个不断汇集数据并需要通知用户网站上有新内容的web应用程序时，这是一个很好的特性。我们将使用本指南创建这种推送通知。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/9c69818baab6be53b4bd6bc4f50968a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7m2XSCZgONibGn9C"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="ed9b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">先决条件</h1><ul class=""><li id="6a89" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">Visual Studio代码</li><li id="da5e" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">Visual Studio代码扩展— <a class="ae jt" href="https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer" rel="noopener ugc nofollow" target="_blank"> Live Server </a></li></ul><h1 id="c908" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">在开始之前</h1><p id="837d" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">推送通知只有一个问题，它不支持IE。所有其他主要浏览器，如Chrome、Firefox、Edge、Opera和Safari都兼容，应该可以正常工作。并不是所有的功能都可以在移动浏览器上使用，所以我认为这只对桌面推送通知有用。</p><p id="9709" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要理解通知API如何工作，请阅读<a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/API/notification" rel="noopener ugc nofollow" target="_blank">通知API </a>文档。</p><p id="1a35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在指南的后面，我将解释为什么需要Visual Studio代码扩展Live服务器。</p><p id="481b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有了这个方法。</p></div><div class="ab cl ll lm gp ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hb hc hd he hf"><h1 id="87a9" class="ju jv hi bd jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr bi translated">让我们开始编码吧</h1><h2 id="1568" class="lx jv hi bd jw ly lz ma ka mb mc md ke iq me mf ki iu mg mh km iy mi mj kq mk bi translated">HTML</h2><p id="5003" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">这将是一个简单明了的HTML，因为本指南的重点只是推送通知。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="2021" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的HTML不需要解释。</p><h2 id="8368" class="lx jv hi bd jw ly lz ma ka mb mc md ke iq me mf ki iu mg mh km iy mi mj kq mk bi translated">JavaScript</h2><p id="7327" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我们将把下面的JavaScript添加到HTML的head部分</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="81a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的脚本有两个部分。第一部分是检查您的用户是否为您的站点启用了通知。是的，在推送通知之前，您的用户必须首先允许它。一旦他们允许，就会推送通知。</p><p id="1ecc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基本上是告诉你的浏览器在所有的DOM都被加载时监听事件。这有点类似于Jquery的<code class="du mn mo mp mq b">$(document).ready(function(){.....</code>，更多细节请访问这个<a class="ae jt" href="https://api.jquery.com/ready/" rel="noopener ugc nofollow" target="_blank">链接</a>。权限检查有3种可能的结果，它们是</p><ul class=""><li id="dd60" class="ks kt hi ih b ii ij im in iq mr iu ms iy mt jc kz la lb lc bi translated"><code class="du mn mo mp mq b">denied</code> —用户拒绝显示通知</li><li id="6ad5" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><code class="du mn mo mp mq b">granted</code> —用户接受显示通知。</li><li id="4325" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><code class="du mn mo mp mq b">default</code> —用户的选择是未知的，因此浏览器会将该值视为被拒绝。</li></ul><p id="b5c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以上摘自<a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/API/notification" rel="noopener ugc nofollow" target="_blank"> Mozilla开发者指南关于通知API </a></p><p id="4ceb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上述情况下，当许可不是<code class="du mn mo mp mq b">granted</code>时，API将请求许可，因此调用函数<code class="du mn mo mp mq b">Notification.requestPermission()</code>，这将触发许可警报。</p><p id="f544" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是一个来自Chrome浏览器的通知示例。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mu"><img src="../Images/764bdb7bfee614f99695a74433ce1fa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*o0xs9bbJ4jFCArvkFo6Xpg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx">Chrome Permission</figcaption></figure><p id="466f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">脚本的第二部分是通知本身。正如我前面提到的，IE不支持推送通知，因此我们需要让我们的用户知道。这就是上面第6行到第11行试图做的事情。当<code class="du mn mo mp mq b">Notification</code> API不可用时，我们简单地提醒用户。在真正实施时，Alert可能不是最好的方式，这只是出于教育目的的一个示例。</p><p id="6ec7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第13行是为了防止由于任何原因事件侦听器没有被触发，当我们尝试推送通知时，将确保并检查通知是否被允许。</p><p id="1297" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当通知被允许时，我们可以配置通知本身，即第15行到第18行。创建和推送通知的语法和<code class="du mn mo mp mq b">new Notification(title, options)</code>一样简单。在这里，我们给我们的通知标题“新消息”。有几个选项可用，您可以参考此<a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/API/Notification/Notification" rel="noopener ugc nofollow" target="_blank">链接</a>了解每个选项的详细信息。在本例中，我们只是为通知提供了一个图标和一条正文消息。</p><p id="ca82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通知API支持4个事件处理程序<code class="du mn mo mp mq b">onclick</code>、<code class="du mn mo mp mq b">onclose</code>、<code class="du mn mo mp mq b">onerror</code>和<code class="du mn mo mp mq b">onshow</code>。在第20行的例子中，我们想在用户点击通知时触发一些功能，API将关注浏览器和触发通知的标签，然后关闭通知。</p><p id="3eb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在每个通知事件期间，您可以决定用许多创造性的方法来处理您的网站，例如，您可以触发页面在用户单击它或导航到另一个页面时重新加载。您将可以访问<code class="du mn mo mp mq b">window</code>对象来执行各种操作。</p><h2 id="4e87" class="lx jv hi bd jw ly lz ma ka mb mc md ke iq me mf ki iu mg mh km iy mi mj kq mk bi translated">身体</h2><p id="6fcd" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">对于这个例子，我们将添加一个按钮来触发通知。给车身加上<code class="du mn mo mp mq b">&lt;button onclick="notifyMe()"&gt;Notify me!&lt;/button&gt;</code>。点击按钮时，将执行功能<code class="du mn mo mp mq b">notifyMe()</code>。</p><h2 id="015a" class="lx jv hi bd jw ly lz ma ka mb mc md ke iq me mf ki iu mg mh km iy mi mj kq mk bi translated">最终的HTML</h2><p id="fa29" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">最终的HTML将如下所示</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h2 id="6156" class="lx jv hi bd jw ly lz ma ka mb mc md ke iq me mf ki iu mg mh km iy mi mj kq mk bi translated">是时候测试一下了</h2><p id="1dd7" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">确保您已经保存了HTML文件，让我们来查看我们创建的HTML文件。</p><p id="cd78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Windows机器或Mac Chrome上，当你点击允许并点击“通知我”时，你会看到如下的权限提示按钮。它会一次又一次地提示同一个框。这里出了什么问题？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mv"><img src="../Images/a670f501323de903418ee0840b9703a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*n0qOYhq4bjv6YQhWFmgSMw.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx">Windows Chrome</figcaption></figure><p id="ea6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Mac机Safari上，什么都不会发生。权限框不会显示，当您单击该按钮时，没有任何反应。这里出了什么问题？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mw"><img src="../Images/dcf88d852ce6b40df8d1f1580e6c7b55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BhodxNGgwu6HIPe9Bsce2Q.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Mac Safari</figcaption></figure><p id="2093" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你想通了吗？答案是，推送通知对文件不起作用。它必须是托管的，或者至少是一个站点或本地主机。这就是visual studio Live服务器扩展派上用场的地方。当然，有很多方法可以在本地托管你的文件，比如xampp或者Inetpub。为了简单起见，我们将只使用<a class="ae jt" href="https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer" rel="noopener ugc nofollow" target="_blank">直播服务器</a>扩展。</p><p id="c6b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们首先创建一个文件夹，并将我们的HTML文件移动到该文件夹中。启动Visual Studio代码并打开包含HTML文件的文件夹。加载后，在“资源管理器”窗口中右键单击该文件，然后选择“用实时服务器打开”。您的默认浏览器应该打开本地主机和一个端口，并且您的站点是可用的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mx"><img src="../Images/efe70048b1ca4d3c2001cb27b5d556a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*NujdTLmv7yRt8moUychiFw.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx">Open with Live Server Windows</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es my"><img src="../Images/6b3903ba67986b7d6b7410850254dcfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eQJ9iqfa8Sp-kGw-A6u0Xw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Open with Live Server Mac</figcaption></figure><p id="9a09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一次，您可以单击权限框中的允许，然后点击“通知我”按钮。恭喜你！，你的第一条推送通知。通知示例如下</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mz"><img src="../Images/671ee55f53a6eb625acc432f73bf0512.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*CC-GcRyxJhT682lrnOFx7A.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx">Window Notification</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es na"><img src="../Images/e6bd0d36d6706cd7f5c2aa6754ba80f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*L8TZDU8o3LvEg0h__2Y3Pw.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx">Mac Notification</figcaption></figure><p id="0c38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通知出现后，在它消失前，最小化或聚焦于另一个应用程序，然后单击通知。您的浏览器将变为活动状态，并且该选项卡将成为焦点</p></div><div class="ab cl ll lm gp ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hb hc hd he hf"><p id="c68f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是当你的网站需要推送通知的时候，发挥创意，实现推送通知。祝你好运！</p></div></div>    
</body>
</html>