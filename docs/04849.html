<html>
<head>
<title>Build a Camera App : Flutter In-App Camera</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建立一个相机应用程序:在应用程序中抖动相机</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/build-a-camera-app-flutter-in-app-camera-825b829fe138?source=collection_archive---------0-----------------------#2021-07-05">https://medium.com/geekculture/build-a-camera-app-flutter-in-app-camera-825b829fe138?source=collection_archive---------0-----------------------#2021-07-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/d4e1c4706e9b43f215d6a0366dd16558.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6g14PAVR1TokPz_utADABQ.png"/></div></div></figure><div class=""/><p id="5d12" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在许多应用程序中，我们需要用户通过点击图片来上传图片。为此，我们可以使用设备的默认相机应用程序，但如果我们需要集成一个应用内相机呢？颤振也是可能的。flutter团队开发了一个名为<code class="du jo jp jq jr b">camera</code>(<a class="ae js" href="https://pub.dev/packages/camera" rel="noopener ugc nofollow" target="_blank">https://pub.dev/packages/camera</a>)的软件包，可以让我们做到这一点。</p><p id="653c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们通过一个简单的例子来看看如何实现这一点。</p><h1 id="f322" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">设置项目</h1><p id="3f27" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">首先，通过将下面一行添加到<code class="du jo jp jq jr b">pubspec.yaml</code>文件中，将<code class="du jo jp jq jr b">camera</code>包安装到您的项目中。</p><pre class="kw kx ky kz fd la jr lb lc aw ld bi"><span id="eff6" class="le ju ht jr b fi lf lg l lh li">camera: ^0.8.1+3</span></pre><p id="1625" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> — IOS设置</strong></p><p id="eeea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此插件需要IOS 10.0或更高版本。<br/>在<code class="du jo jp jq jr b">Info.plist</code>文件中添加以下行进行设置。</p><pre class="kw kx ky kz fd la jr lb lc aw ld bi"><span id="99f0" class="le ju ht jr b fi lf lg l lh li">&lt;key&gt;NSCameraUsageDescription&lt;/key&gt;<br/>&lt;string&gt;Can I use the camera please?&lt;/string&gt;<br/>&lt;key&gt;NSMicrophoneUsageDescription&lt;/key&gt;<br/>&lt;string&gt;Can I use the mic please?&lt;/string&gt;</span></pre><p id="afd2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">— <strong class="is hu">安卓设置</strong></p><p id="b26d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在您的<code class="du jo jp jq jr b">android/app/build.gradle</code>文件中，将最低Android sdk版本更改为21(或更高)。</p><pre class="kw kx ky kz fd la jr lb lc aw ld bi"><span id="d230" class="le ju ht jr b fi lf lg l lh li">minSdkVersion 21</span></pre></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><p id="ead3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们的项目设置已经完成，我们可以开始编写应用程序了。</p><p id="87fa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将在应用程序中创建两个屏幕。<br/> 1。<code class="du jo jp jq jr b">CameraScreen </code> —该屏幕将显示相机输出并拍照<br/> 2。<code class="du jo jp jq jr b">GalleryScreen </code> —该屏幕将在gridview中显示捕获的图片。</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lq"><img src="../Images/906649ced316d4e46bce4514cef6a893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L23qS1umNxjK_qgKGR1naQ.png"/></div></div></figure><h1 id="b3a8" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">加载摄像机</h1><p id="8c95" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">要显示相机预览，我们需要先加载相机。为此，转到<code class="du jo jp jq jr b">main.dart</code>文件中的<code class="du jo jp jq jr b">main</code>函数和<code class="du jo jp jq jr b">runApp</code>上面的这些行。</p><pre class="kw kx ky kz fd la jr lb lc aw ld bi"><span id="ea3e" class="le ju ht jr b fi lf lg l lh li">WidgetsFlutterBinding.ensureInitialized(); //Ensure plugin services are initialized</span><span id="afad" class="le ju ht jr b fi lr lg l lh li">final cameras = await availableCameras(); //Get list of available cameras</span></pre><p id="156f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们有了相机列表，我们需要将它们传递给我们的<code class="du jo jp jq jr b">CameraScreen</code>。</p><p id="6bf4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以，摄像机会像这样通过</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div class="er es ls"><img src="../Images/2e171d4df2078b974773611adcfe2a6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*YKslBKrhqoKuK1BgJZdhJw.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx">Passing cameras list</figcaption></figure><p id="96ca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">做完这些，这就是<code class="du jo jp jq jr b">main.dart</code>的样子。</p><figure class="kw kx ky kz fd hk"><div class="bz dy l di"><div class="lx ly l"/></div></figure><h1 id="ea88" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">照相机屏幕</h1><p id="556b" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">这个屏幕的布局很简单。在顶部，我们将显示实时相机预览，在底部将有三个按钮(切换相机，捕捉和显示画廊)。</p><p id="f4c5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建一个名为<code class="du jo jp jq jr b">CameraScreen</code>的有状态小部件。</p><p id="7ecb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将创建四个变量，</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lz"><img src="../Images/5bf176747e8e0cb1b4cc6819bdbb3aea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E-jz-cMviS4sUzQrPQZntw.png"/></div></div></figure><p id="c114" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们必须设置<code class="du jo jp jq jr b">selectedCamera = 0</code>，从后置摄像头开始。如果设备有一个以上的摄像头，那么我们可以通过更改此索引来切换到它。</p></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><p id="3bbc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们创建一个方法来初始化选定的相机。</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div class="er es ma"><img src="../Images/b5ca01f3707a43512d2e7fc88ba334bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*JZtNER-tiGlhBb1O34gS1Q.png"/></div></figure><p id="bd5f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个方法中，我们将传递想要初始化的摄像机索引。使用传递的摄像机列表，我们将加载具有我们选择的分辨率的特定摄像机。</p><p id="d9b1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用这种方法，我们将在<code class="du jo jp jq jr b">initState</code>中初始化后置摄像头。</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div class="er es mb"><img src="../Images/0be6c08a1c3190c1b502e3605c80eabf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oWxm0p_gCn9R1S6MnoPE7g.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx">initState</figcaption></figure><p id="f9c8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不要忘记处理相机控制器。</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div class="er es mc"><img src="../Images/cdb981350970dddc0ddd32028e97b93c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*VYmzVrA-t5YFoagfBw7nGg.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx">dispose</figcaption></figure><p id="7055" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们来构建用户界面。</p><p id="0dca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了显示CameraPreview，我们将使用以下代码。在摄像头加载之前，我们会显示<code class="du jo jp jq jr b">CircularProgressIndicator</code>。</p><pre class="kw kx ky kz fd la jr lb lc aw ld bi"><span id="dcb2" class="le ju ht jr b fi lf lg l lh li">FutureBuilder&lt;void&gt;(<br/>  future: <strong class="jr hu">_initializeControllerFuture</strong>,<br/>  builder: (context, snapshot) {<br/>    if (snapshot.connectionState == ConnectionState.done) {<br/>      // If the Future is complete, display the preview.<br/>      return <strong class="jr hu">CameraPreview(_controller)</strong>;<br/>    } else {<br/>      // Otherwise, display a loading indicator.<br/>      return const Center(child: CircularProgressIndicator());<br/>    }<br/>  },<br/>),</span></pre><p id="74b9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好了，现在我们必须在一个<code class="du jo jp jq jr b">row</code>中显示三个按钮。</p><h1 id="156a" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">切换相机按钮</h1><p id="0cfd" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">首先是切换相机图标按钮。点击这个按钮，相机会在前后之间切换。</p><p id="ab9d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为此，我们将使用同样的<code class="du jo jp jq jr b">initializeCamera</code>方法，但是这次<code class="du jo jp jq jr b">cameraIndex</code>将是动态的。<code class="du jo jp jq jr b">cameraIndex</code>将为<code class="du jo jp jq jr b">0</code>后置摄像头<code class="du jo jp jq jr b">1</code>前置摄像头(如果有前置摄像头)。</p><p id="4329" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">单击时，我们将检查设备是否有多个摄像头，如果没有，我们将显示一个带有消息的snackbar。</p><pre class="kw kx ky kz fd la jr lb lc aw ld bi"><span id="4560" class="le ju ht jr b fi lf lg l lh li">IconButton(<br/>  onPressed: () {<br/>    if (widget.cameras.length &gt; 1) {<br/>      setState(() {<br/>        <strong class="jr hu">selectedCamera = selectedCamera == 0 ? 1 : 0;</strong>//Switch camera<strong class="jr hu"><br/>        initializeCamera(selectedCamera);</strong><br/>      });<br/>    } else {<br/>      ScaffoldMessenger.of(context).showSnackBar(SnackBar(<br/>        content: Text('No secondary camera found'),<br/>        duration: const Duration(seconds: 2),<br/>      ));<br/>    }<br/>  },<br/>  icon: Icon(Icons.switch_camera_rounded, color: Colors.white),<br/>),</span></pre><h1 id="6751" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">捕获按钮</h1><p id="d4c0" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">为了显示一个捕获按钮，我使用了一个简单的半径为60的白色圆圈。点击时，我们将使用相机控制器拍摄一张照片，并将其添加到<code class="du jo jp jq jr b">captureImages</code>数组中。</p><pre class="kw kx ky kz fd la jr lb lc aw ld bi"><span id="9e87" class="le ju ht jr b fi lf lg l lh li">GestureDetector(<br/>  onTap: () async {<br/>    await _initializeControllerFuture; //To make sure camera is initialized<br/>    var xFile = await <strong class="jr hu">_controller.takePicture()</strong>;<br/>    setState(() {<br/>      <strong class="jr hu">capturedImages.add(File(xFile.path));</strong><br/>    });<br/>  },<br/>  child: Container(<br/>    height: 60,<br/>    width: 60,<br/>    decoration: BoxDecoration(<br/>      shape: BoxShape.circle,<br/>      color: Colors.white,<br/>    ),<br/>  ),<br/>),</span></pre><h1 id="fdea" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">显示图库按钮</h1><p id="ef8f" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">这个按钮非常简单，我们将显示从<code class="du jo jp jq jr b">capturedImages</code>数组中获取的<strong class="is hu">最后一个</strong>图像，单击它将导航到<code class="du jo jp jq jr b">GalleryScreen</code>。</p><pre class="kw kx ky kz fd la jr lb lc aw ld bi"><span id="ce97" class="le ju ht jr b fi lf lg l lh li">GestureDetector(<br/>  onTap: () {<br/>    if (capturedImages.isEmpty) return; //Return if no image<br/>      Navigator.push(context,<br/>        MaterialPageRoute(<br/>          builder: (context) =&gt; GalleryScreen(<br/>            images: <strong class="jr hu">capturedImages.reversed.toList()</strong>)));<br/>  },<br/>  child: Container(<br/>    height: 60,<br/>    width: 60,<br/>    decoration: BoxDecoration(<br/>      border: Border.all(color: Colors.white),<br/>      image: capturedImages.isNotEmpty<br/>      ? DecorationImage(image: FileImage(<strong class="jr hu">capturedImages.last</strong>), fit: BoxFit.cover)<br/>      : null,<br/>    ),<br/>  ),<br/>),</span></pre><p id="b2e6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如您所见，<code class="du jo jp jq jr b">GalleryScreen</code>接受捕获的图像列表，以便我们可以在gridview中显示它们。让我们完成这一部分，看看应用程序的运行。</p><h1 id="de88" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">画廊屏幕</h1><p id="4aba" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">这个屏幕非常直。获取图像列表并在<code class="du jo jp jq jr b">GridView</code>中显示。</p><figure class="kw kx ky kz fd hk"><div class="bz dy l di"><div class="lx ly l"/></div></figure><h1 id="3b07" class="jt ju ht bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">最终产品</h1><p id="69ca" class="pw-post-body-paragraph iq ir ht is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">构建好app后，这里是最终的结果。</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es md"><img src="../Images/2b581c5ad3bb8b48f64490b7764a93ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qlKAcT6rfNIL2L9Gg80VOw.png"/></div></div></figure></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><p id="dd43" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">相机包(<a class="ae js" href="https://pub.dev/packages/camera" rel="noopener ugc nofollow" target="_blank">https://pub.dev/packages/camera</a>)也能够捕捉视频。为此，您可以使用<code class="du jo jp jq jr b">startVideoRecording</code>、<code class="du jo jp jq jr b">pauseVideoRecording</code>和<code class="du jo jp jq jr b">stopVideoRecording</code>方法。</p><p id="9d73" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是该项目的Github链接。希望对你有帮助。</p><div class="hh hi ez fb hj me"><a href="https://github.com/jagrut-18/flutter_camera_app.git" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab dw"><div class="mg ab mh cl cj mi"><h2 class="bd hu fi z dy mj ea eb mk ed ef hs bi translated">jagrut-18/flutter_camera_app</h2><div class="ml l"><h3 class="bd b fi z dy mj ea eb mk ed ef dx translated">一个新的颤振项目。这个项目是颤振应用的起点。一些帮助您入门的资源…</h3></div><div class="mm l"><p class="bd b fp z dy mj ea eb mk ed ef dx translated">github.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms hp me"/></div></div></a></div><p id="f839" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这一次到此为止。希望你喜欢。</p><p id="e3e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢您阅读至此。请务必留下任何建议和评论👏为了这个故事。</p></div></div>    
</body>
</html>