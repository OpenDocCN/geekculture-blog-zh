<html>
<head>
<title>How to Installing Magento 2 on AWS Cloud using Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Terraform在AWS云上安装Magento 2</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-installing-magento-2-on-aws-cloud-using-terraform-fdba062297e9?source=collection_archive---------10-----------------------#2021-04-28">https://medium.com/geekculture/how-to-installing-magento-2-on-aws-cloud-using-terraform-fdba062297e9?source=collection_archive---------10-----------------------#2021-04-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="fefb" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在本文中，我将展示如何使用Terraform在AWS上安装Magento 2。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/50c6f3948e21e17de394933dc5060644.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kNHCPxXL7KCDmCQVEjF8eg.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Magento 2 Cloud Terraform</figcaption></figure><h1 id="66c9" class="jn jo hi bd jp jq jr js jt ju jv jw jx io jy ip jz ir ka is kb iu kc iv kd ke bi translated">Magento需要哪些AWS资源:</h1><p id="fd66" class="pw-post-body-paragraph kf kg hi kh b ki kj ij kk kl km im kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">首先，我们需要一个Magento负载平衡器来在实例之间分配流量:</p><h1 id="9c24" class="jn jo hi bd jp jq jr js jt ju jv jw jx io jy ip jz ir ka is kb iu kc iv kd ke bi translated">Magento负载平衡器组件</h1><p id="99af" class="pw-post-body-paragraph kf kg hi kh b ki kj ij kk kl km im kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">一个<em class="lb">负载平衡器</em>充当客户端的单点联系。负载平衡器将传入的应用程序流量分布在多个目标上，比如Magento EC2实例。这增加了应用程序的可用性。您可以向负载平衡器添加一个或多个侦听器。</p><p id="1d60" class="pw-post-body-paragraph kf kg hi kh b ki lc ij kk kl ld im kn ko le kq kr ks lf ku kv kw lg ky kz la hb bi translated">应用负载平衡器在应用层运行，即开放系统互连(OSI)模型的第七层。负载平衡器收到请求后，会按优先级顺序评估侦听器规则，以确定要应用的规则，然后从规则操作的目标组(Web/Admin)中选择一个目标。您可以配置侦听器规则，根据应用程序流量的内容将请求路由到不同的目标组。即使一个目标向多个目标组注册，路由也是为每个目标组独立执行的。您可以配置在目标组级别使用的路由算法。默认的路由算法是循环法；或者，您可以指定最少未完成请求路由算法。</p><p id="9cfb" class="pw-post-body-paragraph kf kg hi kh b ki lc ij kk kl ld im kn ko le kq kr ks lf ku kv kw lg ky kz la hb bi translated">您可以根据需求的变化在负载平衡器中添加和删除目标，而不会中断应用程序的整体请求流。AWS弹性负载平衡随着应用程序流量的变化而扩展负载平衡器。弹性负载平衡可以自动扩展到绝大多数工作负载。</p><p id="6572" class="pw-post-body-paragraph kf kg hi kh b ki lc ij kk kl ld im kn ko le kq kr ks lf ku kv kw lg ky kz la hb bi translated">您可以配置运行状况检查，它用于监视已注册目标的运行状况，以便负载平衡器可以仅向运行状况良好的目标发送请求。</p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="33c4" class="lm jo hi li b fi ln lo l lp lq">terraform {<br/>  source = "git::<a class="ae lr" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:terraform-aws-modules/terraform-aws-alb.git?ref=v5.1.0"<br/>}</span><span id="25ed" class="lm jo hi li b fi ls lo l lp lq">include {<br/>  path = find_in_parent_folders()<br/>}</span><span id="0e0a" class="lm jo hi li b fi ls lo l lp lq">dependencies {<br/>  paths = ["../magento-cloud", "../loadbalancer-internal-securitygroup"]<br/>}</span><span id="066c" class="lm jo hi li b fi ls lo l lp lq">dependency "magento-cloud" {<br/>  config_path = "../magento-cloud"<br/>}</span><span id="5b36" class="lm jo hi li b fi ls lo l lp lq">dependency "loadbalancer-internal-securitygroup" {<br/>  config_path = "../loadbalancer-internal-securitygroup"<br/>}</span><span id="c8fe" class="lm jo hi li b fi ls lo l lp lq">###########################################################<br/># View all available inputs for this module:<br/># <a class="ae lr" href="https://registry.terraform.io/modules/terraform-aws-modules/alb/aws/5.1.0?tab=inputs" rel="noopener ugc nofollow" target="_blank">https://registry.terraform.io/modules/terraform-aws-modules/alb/aws/5.1.0?tab=inputs</a><br/>###########################################################<br/>inputs = {<br/>  # The resource name and Name tag of the load balancer.<br/>  # type: string<br/>  name = "WebNodes-ELB"</span><span id="5e37" class="lm jo hi li b fi ls lo l lp lq"># Controls if the ALB will log requests to S3.<br/>  # type: bool<br/>  logging_enabled = false</span><span id="bebd" class="lm jo hi li b fi ls lo l lp lq"># The security groups to attach to the load balancer. e.g. ["sg-edcd9784","sg-edcd9785"]<br/>  # type: list(string)<br/>  security_groups = [dependency.loadbalancer-internal-securitygroup.outputs.this_security_group_id]</span><span id="dbc8" class="lm jo hi li b fi ls lo l lp lq"># A list of subnets to associate with the load balancer. e.g. ['subnet-1a2b3c4d','subnet-1a2b3c4e','subnet-1a2b3c4f']<br/>  # type: list(string)<br/>  subnets = dependency.magento-cloud.outputs.public_subnets</span><span id="f380" class="lm jo hi li b fi ls lo l lp lq"># VPC id where the load balancer and other resources will be deployed.<br/>  # type: string<br/>  vpc_id = dependency.magento-cloud.outputs.vpc_id<br/>  <br/>}</span></pre><p id="9a31" class="pw-post-body-paragraph kf kg hi kh b ki lc ij kk kl ld im kn ko le kq kr ks lf ku kv kw lg ky kz la hb bi translated"><strong class="kh hj">用Magento实例自动缩放组。</strong></p><p id="3315" class="pw-post-body-paragraph kf kg hi kh b ki lc ij kk kl ld im kn ko le kq kr ks lf ku kv kw lg ky kz la hb bi translated">Amazon EC2 Auto Scaling帮助您确保有正确数量的Magento实例来处理负载。您可以指定每个自动缩放组中Magento实例的最小数量，Amazon EC2自动缩放确保您的组永远不会低于这个大小。您可以指定每个自动缩放组中实例的最大数量，Amazon EC2自动缩放确保您的组永远不会超过这个大小。如果您在创建组时或之后的任何时候指定了所需的容量，Amazon EC2 Auto Scaling会确保您的组有这么多实例。如果您指定缩放策略，那么Amazon EC2 Auto Scaling可以根据应用程序需求的增加或减少启动或终止实例。</p><p id="750f" class="pw-post-body-paragraph kf kg hi kh b ki lc ij kk kl ld im kn ko le kq kr ks lf ku kv kw lg ky kz la hb bi translated">例如，以下自动缩放组的最小大小为一个实例，所需容量为两个实例，最大大小为四个实例。您定义的扩展策略根据您指定的标准，在最小和最大实例数范围内调整实例数。</p><p id="5963" class="pw-post-body-paragraph kf kg hi kh b ki lc ij kk kl ld im kn ko le kq kr ks lf ku kv kw lg ky kz la hb bi translated"><strong class="kh hj">我们将使用EC2实例(服务器)和</strong> c6g .中型实例类型和<strong class="kh hj"> EBS (SSD磁盘)卷和</strong>通用3</p><p id="4f60" class="pw-post-body-paragraph kf kg hi kh b ki lc ij kk kl ld im kn ko le kq kr ks lf ku kv kw lg ky kz la hb bi translated">如何使用terraform创建Magento 2自动缩放:</p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="ae18" class="lm jo hi li b fi ln lo l lp lq">terraform {<br/>  source = "git::<a class="ae lr" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:terraform-aws-modules/terraform-aws-autoscaling.git?ref=v3.4.0"<br/>}</span><span id="e329" class="lm jo hi li b fi ls lo l lp lq">include {<br/>  path = find_in_parent_folders()<br/>}</span><span id="d730" class="lm jo hi li b fi ls lo l lp lq">dependencies {<br/>  paths = ["../aws-data", "../magento-cloud", "../webnode-securitygroup", "../webnode-loadbalancer"]<br/>}</span><span id="8bd1" class="lm jo hi li b fi ls lo l lp lq">dependency "aws-data" {<br/>  config_path = "../aws-data"<br/>}</span><span id="a883" class="lm jo hi li b fi ls lo l lp lq">dependency "magento-cloud" {<br/>  config_path = "../magento-cloud"<br/>}</span><span id="cfdf" class="lm jo hi li b fi ls lo l lp lq">dependency "webnode-securitygroup" {<br/>  config_path = "../webnode-securitygroup"<br/>}</span><span id="b2b0" class="lm jo hi li b fi ls lo l lp lq">dependency "webnode-loadbalancer" {<br/>  config_path = "../webnode-loadbalancer"<br/>}</span><span id="8ece" class="lm jo hi li b fi ls lo l lp lq">###########################################################<br/># View all available inputs for this module:<br/># <a class="ae lr" href="https://registry.terraform.io/modules/terraform-aws-modules/autoscaling/aws/3.4.0?tab=inputs" rel="noopener ugc nofollow" target="_blank">https://registry.terraform.io/modules/terraform-aws-modules/autoscaling/aws/3.4.0?tab=inputs</a><br/>###########################################################<br/>inputs = {<br/>  # The number of Amazon EC2 instances that should be running in the group<br/>  # type: string<br/>  desired_capacity = "1"</span><span id="6f45" class="lm jo hi li b fi ls lo l lp lq"># Controls how health checking is done. Values are - EC2 and ELB<br/>  # type: string<br/>  health_check_type = "EC2"</span><span id="dc8a" class="lm jo hi li b fi ls lo l lp lq"># The EC2 image ID to launch<br/>  # type: strin<br/>  image_id = dependency.aws-data.outputs.amazon_linux2_aws_ami_id # magento image for test "ami-04937aae676c8b679"</span><span id="f37a" class="lm jo hi li b fi ls lo l lp lq"># The size of instance to launch<br/>  # type: string<br/>  instance_type = "c6g.large"</span><span id="3847" class="lm jo hi li b fi ls lo l lp lq"># The maximum size of the auto scale group<br/>  # type: string<br/>  max_size = "20"</span><span id="8d15" class="lm jo hi li b fi ls lo l lp lq"># The minimum size of the auto scale group<br/>  # type: string<br/>  min_size = "10"</span><span id="e86f" class="lm jo hi li b fi ls lo l lp lq"># Creates a unique name beginning with the specified prefix<br/>  # type: string<br/>  name = "WebNode-ASG"</span><span id="51b8" class="lm jo hi li b fi ls lo l lp lq"># A list of security group IDs to assign to the launch configuration<br/>  # type: list(string)<br/>  security_groups = [dependency.webnode-securitygroup.outputs.this_security_group_id]</span><span id="5840" class="lm jo hi li b fi ls lo l lp lq"># A list of aws_alb_target_group ARNs, for use with Application Load Balancing<br/>  # type: list(string)<br/>  target_group_arns = dependency.webnode-loadbalancer.outputs.target_group_arns</span><span id="dec7" class="lm jo hi li b fi ls lo l lp lq"># A list of subnet IDs to launch resources in<br/>  # type: list(string)<br/>  vpc_zone_identifier = dependency.magento-cloud.outputs.public_subnets</span><span id="1271" class="lm jo hi li b fi ls lo l lp lq">}</span></pre><h1 id="6ec6" class="jn jo hi bd jp jq jr js jt ju jv jw jx io jy ip jz ir ka is kb iu kc iv kd ke bi translated">存储Magento持久数据的数据库。</h1><p id="0032" class="pw-post-body-paragraph kf kg hi kh b ki kj ij kk kl km im kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">作为Magento数据库，我们将使用AWS RDS AURORA DB。</p><p id="6ca8" class="pw-post-body-paragraph kf kg hi kh b ki lc ij kk kl ld im kn ko le kq kr ks lf ku kv kw lg ky kz la hb bi translated">Amazon Aurora (Aurora)是一个完全托管的关系数据库引擎，与MySQL兼容。您已经知道MySQL和PostgreSQL如何将高端商业数据库的速度和可靠性与开源数据库的简单性和成本效益相结合。您目前在现有MySQL数据库中使用的代码、工具和应用程序也可以在Aurora中使用。对于某些工作负载，Aurora可以提供高达MySQL五倍的<strong class="kh hj">吞吐量，而无需更改您现有的大多数应用程序。</strong></p><p id="1306" class="pw-post-body-paragraph kf kg hi kh b ki lc ij kk kl ld im kn ko le kq kr ks lf ku kv kw lg ky kz la hb bi translated">Aurora包括一个高性能存储子系统。它的兼容MySQL的数据库引擎被定制来利用这种快速的分布式存储。底层存储会根据需要自动增长。Aurora群集卷的最大容量可以增长到128。Aurora还自动化和标准化了数据库集群和复制，这通常是数据库配置和管理中最具挑战性的方面。</p><p id="13b2" class="pw-post-body-paragraph kf kg hi kh b ki lc ij kk kl ld im kn ko le kq kr ks lf ku kv kw lg ky kz la hb bi translated">Aurora是托管数据库服务Amazon关系数据库服务(Amazon RDS)的一部分。Amazon RDS是一个web服务，它使得在云中设置、操作和扩展关系数据库变得更加容易。如果你还不熟悉亚马逊RDS。</p><p id="5ead" class="pw-post-body-paragraph kf kg hi kh b ki lc ij kk kl ld im kn ko le kq kr ks lf ku kv kw lg ky kz la hb bi translated">以下几点说明了Aurora与Amazon RDS中可用的标准MySQL引擎的关系:</p><ul class=""><li id="cd7a" class="lt lu hi kh b ki lc kl ld ko lv ks lw kw lx la ly lz ma mb bi translated">Aurora利用熟悉的Amazon关系数据库服务(Amazon RDS)特性进行管理。Aurora使用Amazon RDS AWS管理控制台界面、AWS CLI命令和API操作来处理日常数据库任务，如供应、修补、备份、恢复、故障检测和修复。</li><li id="dd61" class="lt lu hi kh b ki mc kl md ko me ks mf kw mg la ly lz ma mb bi translated">Aurora管理操作通常涉及通过复制同步的整个数据库服务器集群，而不是单个数据库实例。自动集群、复制和存储分配使得设置、操作和扩展最大规模的MySQL和PostgreSQL部署变得简单且经济高效。</li><li id="98af" class="lt lu hi kh b ki mc kl md ko me ks mf kw mg la ly lz ma mb bi translated">您可以通过创建和恢复快照，或者通过设置单向复制，将数据从Amazon RDS for MySQL和Amazon RDS for PostgreSQL引入Aurora。您可以使用按钮式迁移工具将现有的Amazon RDS for MySQL和Amazon RDS for PostgreSQL应用程序转换为Aurora。</li></ul><p id="4b31" class="pw-post-body-paragraph kf kg hi kh b ki lc ij kk kl ld im kn ko le kq kr ks lf ku kv kw lg ky kz la hb bi translated"><strong class="kh hj">我们将使用RDS Aurora DB实例和</strong> 20 GB存储db.r6g.micro实例类，并启用备份和维护模式。</p><p id="b2f1" class="pw-post-body-paragraph kf kg hi kh b ki lc ij kk kl ld im kn ko le kq kr ks lf ku kv kw lg ky kz la hb bi translated">Terraform代码将是这样的:</p><pre class="iy iz ja jb fd lh li lj lk aw ll bi"><span id="c97b" class="lm jo hi li b fi ln lo l lp lq">terraform {<br/>  source = "git::<a class="ae lr" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:terraform-aws-modules/terraform-aws-rds.git?ref=v2.14.0"<br/>}</span><span id="21fb" class="lm jo hi li b fi ls lo l lp lq">include {<br/>  path = find_in_parent_folders()<br/>}</span><span id="fcbd" class="lm jo hi li b fi ls lo l lp lq">dependencies {<br/>  paths = ["../magento-cloud", "../mysql-rds-securitygroup"]<br/>}</span><span id="41ac" class="lm jo hi li b fi ls lo l lp lq">dependency "magento-cloud" {<br/>  config_path = "../magento-cloud"<br/>}</span><span id="3385" class="lm jo hi li b fi ls lo l lp lq">dependency "mysql-rds-securitygroup" {<br/>  config_path = "../mysql-rds-securitygroup"<br/>}</span><span id="960c" class="lm jo hi li b fi ls lo l lp lq">###########################################################<br/># View all available inputs for this module:<br/># <a class="ae lr" href="https://registry.terraform.io/modules/terraform-aws-modules/rds/aws/2.14.0?tab=inputs" rel="noopener ugc nofollow" target="_blank">https://registry.terraform.io/modules/terraform-aws-modules/rds/aws/2.14.0?tab=inputs</a><br/>###########################################################<br/>inputs = {<br/>  # The allocated storage in gigabytes<br/>  # type: string<br/>  allocated_storage = "5"</span><span id="0f56" class="lm jo hi li b fi ls lo l lp lq"># The days to retain backups for<br/>  # type: number<br/>  backup_retention_period = 0</span><span id="c10b" class="lm jo hi li b fi ls lo l lp lq"># The daily time range (in UTC) during which automated backups are created if they are enabled. Example: '09:46-10:16'. Must not overlap with maintenance_window<br/>  # type: string<br/>  backup_window = ""</span><span id="c43d" class="lm jo hi li b fi ls lo l lp lq"># Name of DB subnet group. DB instance will be created in the VPC associated with the DB subnet group. If unspecified, will be created in the default VPC<br/>  # type: string<br/>  db_subnet_group_name = dependency.magento-cloud.outputs.database_subnet_group</span><span id="bd0e" class="lm jo hi li b fi ls lo l lp lq"># Aurora database engine type, currently aurora, aurora-mysql or aurora-postgresql<br/>  # type: string<br/>  engine = "aurora-mysql"</span><span id="aacd" class="lm jo hi li b fi ls lo l lp lq"># Aurora database engine version.<br/>  # type: string<br/>  engine_version = "5.7.12"</span><span id="a67e" class="lm jo hi li b fi ls lo l lp lq"># The name of the RDS instance, if omitted, Terraform will assign a random, unique identifier<br/>  # type: string<br/>  identifier = "mysql"</span><span id="f256" class="lm jo hi li b fi ls lo l lp lq"># The instance type of the RDS instance<br/>  # type: string<br/>  instance_class = "db.r6g.large"</span><span id="0990" class="lm jo hi li b fi ls lo l lp lq"># The window to perform maintenance in. Syntax: 'ddd:hh24:mi-ddd:hh24:mi'. Eg: 'Mon:00:00-Mon:03:00'<br/>  # type: string<br/>  maintenance_window = ""</span><span id="3d6c" class="lm jo hi li b fi ls lo l lp lq"># Specifies the major version of the engine that this option group should be associated with<br/>  # type: string<br/>  major_engine_version = "5.7"</span><span id="fc2d" class="lm jo hi li b fi ls lo l lp lq"># Specifies if the RDS instance is multi-AZ<br/>  # type: bool<br/>  multi_az = false</span><span id="81b1" class="lm jo hi li b fi ls lo l lp lq"># Password for the master DB user. Note that this may show up in logs, and it will be stored in the state file<br/>  # type: string<br/>  password = "kjj2flgyM0Ml"</span><span id="8848" class="lm jo hi li b fi ls lo l lp lq"># The port on which the DB accepts connections<br/>  # type: string<br/>  port = "3306"</span><span id="7b26" class="lm jo hi li b fi ls lo l lp lq"># Username for the master DB user<br/>  # type: string<br/>  username = "bass"</span><span id="5a53" class="lm jo hi li b fi ls lo l lp lq"># List of VPC security groups to associate<br/>  # type: list(string)<br/>  vpc_security_group_ids = [dependency.mysql-rds-securitygroup.outputs.this_security_group_id]</span><span id="5eb3" class="lm jo hi li b fi ls lo l lp lq">}</span></pre><p id="1481" class="pw-post-body-paragraph kf kg hi kh b ki lc ij kk kl ld im kn ko le kq kr ks lf ku kv kw lg ky kz la hb bi translated">您可以在此查看完整代码:</p><div class="mh mi ez fb mj mk"><a href="https://github.com/Genaker/TerraformMagentoCloud" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab dw"><div class="mm ab mn cl cj mo"><h2 class="bd hj fi z dy mp ea eb mq ed ef hh bi translated">Genaker/TerraformMagentoCloud</h2><div class="mr l"><h3 class="bd b fi z dy mp ea eb mq ed ef dx translated">该存储库包含Magento 2 Cloud Terraform基础架构，作为AWS公共云的代码。这种基础设施是…</h3></div><div class="ms l"><p class="bd b fp z dy mp ea eb mq ed ef dx translated">github.com</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my jh mk"/></div></div></a></div><h2 id="07e1" class="lm jo hi bd jp mz na nb jt nc nd ne jx ko nf ng jz ks nh ni kb kw nj nk kd nl bi translated">有一个小视频介绍了如何为Magento配置Terraform:</h2><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nm nn l"/></div></figure><h1 id="57a6" class="jn jo hi bd jp jq jr js jt ju jv jw jx io jy ip jz ir ka is kb iu kc iv kd ke bi translated">在Centos和AWS Linux上安装Magento:</h1><p id="8695" class="pw-post-body-paragraph kf kg hi kh b ki kj ij kk kl km im kn ko kp kq kr ks kt ku kv kw kx ky kz la hb bi translated">使用此回购:</p><div class="mh mi ez fb mj mk"><a href="https://github.com/Genaker/Magento-AWS-Linux-2-Installation" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab dw"><div class="mm ab mn cl cj mo"><h2 class="bd hj fi z dy mp ea eb mq ed ef hh bi translated">ge naker/Magento-AWS-Linux-2-安装</h2><div class="mr l"><h3 class="bd b fi z dy mp ea eb mq ed ef dx translated">如果你有任何问题，随时给我发电子邮件-yegorshytikov@gmail.com每个商人都想…</h3></div><div class="ms l"><p class="bd b fp z dy mp ea eb mq ed ef dx translated">github.com</p></div></div><div class="mt l"><div class="no l mv mw mx mt my jh mk"/></div></div></a></div></div></div>    
</body>
</html>