<html>
<head>
<title>Quickly Convert a Console App Into a Single-Point Web App in C#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用C#将控制台应用程序快速转换成单点Web应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/quickly-convert-a-console-app-into-a-single-point-web-app-in-c-29187d555823?source=collection_archive---------2-----------------------#2021-04-02">https://medium.com/geekculture/quickly-convert-a-console-app-into-a-single-point-web-app-in-c-29187d555823?source=collection_archive---------2-----------------------#2021-04-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7f7ccb191cf63ee8a158c4eff926e390.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ql_-pHxkHG7jXq_W3cYagw.png"/></div></div></figure><p id="d5bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我发现自己需要快速地将我的C#控制台应用程序转换成Web应用程序，主要是，我被要求通过API公开我们的控制台应用程序的逻辑，而管理它的时间很少。</p><p id="a294" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本文将介绍我最终如何在本地主机(我们的内部网络)的端口5005上公开我们的控制台应用程序，为了奖励，我还将附上应用程序的容器Docker版本！</p><p id="eb9f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们从一个简单的控制台应用程序开始:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="9a4c" class="jx jy hi jt b fi jz ka l kb kc">mkdir ConsoleToWeb<br/>cd ConsoleToWeb<br/>dotnet new console<br/>dotnet run</span></pre><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/24af09a7d32830fa4c4f7904893dcf7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*T2FC0JPaylw1zPeSMva_bA.gif"/></div></div></figure><p id="6b15" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个应用程序的源代码看起来会像这样:</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="7ce2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要将它转换成ASP.NET网络应用，我们需要做3件事:</p><ul class=""><li id="e601" class="kg kh hi is b it iu ix iy jb ki jf kj jj kk jn kl km kn ko bi translated">将控制台项目转换为web项目(csproj)</li><li id="9c18" class="kg kh hi is b it kp ix kq jb kr jf ks jj kt jn kl km kn ko bi translated">引入一个<a class="ae ku" href="https://docs.microsoft.com/en-us/dotnet/core/extensions/generic-host" rel="noopener ugc nofollow" target="_blank">通用主机</a>来托管我们的Web应用</li><li id="7970" class="kg kh hi is b it kp ix kq jb kr jf ks jj kt jn kl km kn ko bi translated">重写Main方法来运行我们的WebHost</li></ul><h2 id="3716" class="jx jy hi bd kv kw kx ky kz la lb lc ld jb le lf lg jf lh li lj jj lk ll lm ln bi translated">将控制台csproj转换为Web csproj</h2><p id="ee11" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">我们最初的控制台csproj如下所示:</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="51ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于一个Web项目，我们需要针对不同的<strong class="is hj">SDK</strong>；<a class="ae ku" href="https://docs.microsoft.com/en-us/dotnet/core/project-sdk/overview" rel="noopener ugc nofollow" target="_blank">微软。NET.Sdk.Web </a></p><p id="492d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另外，<strong class="is hj">输出类型</strong>不需要是<strong class="is hj"> Exe。</strong></p><p id="3549" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">修改<strong class="is hj"> csproj </strong>文件，如下所示:</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><h2 id="a8fe" class="jx jy hi bd kv kw kx ky kz la lb lc ld jb le lf lg jf lh li lj jj lk ll lm ln bi translated">引入一个通用主机来托管我们的Web应用</h2><p id="f131" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">IHost类是为. NET的新应用程序托管系统设计的一个类。它处理核心功能，如依赖注入、配置、日志记录等</p><p id="0c35" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用HostBuilder创建一个<strong class="is hj">普通Web主机</strong>，它将有一个Run方法，该方法将从我们的控制台应用程序调用代码。</p><p id="e387" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将以下代码添加到Program.cs文件中:</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="2db6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不要忘记必要的using语句:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="def0" class="jx jy hi jt b fi jz ka l kb kc">using Microsoft.Extensions.Hosting;</span><span id="de32" class="jx jy hi jt b fi lt ka l kb kc">using Microsoft.AspNetCore.Builder;</span><span id="e687" class="jx jy hi jt b fi lt ka l kb kc">using Microsoft.AspNetCore.Hosting;</span><span id="34e3" class="jx jy hi jt b fi lt ka l kb kc">using Microsoft.AspNetCore.Http;</span></pre><h2 id="ac5a" class="jx jy hi bd kv kw kx ky kz la lb lc ld jb le lf lg jf lh li lj jj lk ll lm ln bi translated">重写Main方法来运行我们的WebHost</h2><p id="8515" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">我们就快成功了，我们只需要把它绑定到程序的主方法中。cs:</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="cd11" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们检查完整的工作示例:</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="1874" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就是这样！现在，您可以使用<code class="du lu lv lw jt b">dotnet run</code>运行应用程序，并在浏览器中查看结果，网址为<a class="ae ku" href="http://localhost:5005" rel="noopener ugc nofollow" target="_blank"> http://localhost:5005 </a></p><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/b87bd3e9b5b010bf048d8c44abea39d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*xXnGyL0w8EkKJ4sxpHcCTQ.gif"/></div></div></figure><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/d154042cb059be17138cb3537175046a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9DEH2jSoyW6_rRrESRDtPw.png"/></div></div></figure><h1 id="ab85" class="ly jy hi bd kv lz ma mb kz mc md me ld mf mg mh lg mi mj mk lj ml mm mn lm mo bi translated">把它归档！</h1><p id="6a6a" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">既然我们已经开始了，让我们快速地将这个应用程序归档，这样我们就可以打包并发货了。</p><p id="6516" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将一个<strong class="is hj"> Dockerfile </strong>添加到ConsoleToWeb目录的根目录。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="9a67" class="jx jy hi jt b fi jz ka l kb kc">touch Dockerfile</span></pre><p id="df37" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">docker文件的内容应该类似于:</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="a577" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在已经完成了，我们可以在本地构建我们的映像并标记它:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="f21e" class="jx jy hi jt b fi jz ka l kb kc">docker build . -t consoletoweb</span></pre><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/34e14dd27023a0f6480a5bb15f289e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*UDnCWnq-bwALJk2OuFjmjg.gif"/></div></div></figure><p id="0e82" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">构建Docker映像后，我们可以使用<code class="du lu lv lw jt b">docker run -p 5005:5005 consoletoweb</code>在容器中运行该映像</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/12da2926ccc99e5dbff868ec81877fc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Yse3TF3biW6lXmDoANjekw.gif"/></div></div></figure><p id="6b47" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">而且在<a class="ae ku" href="http://localhost:5005" rel="noopener ugc nofollow" target="_blank"> http://localhost:5005 </a>上效果应该是一样的</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/d154042cb059be17138cb3537175046a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9DEH2jSoyW6_rRrESRDtPw.png"/></div></div></figure><h1 id="592c" class="ly jy hi bd kv lz ma mb kz mc md me ld mf mg mh lg mi mj mk lj ml mm mn lm mo bi translated"><strong class="ak">使用FuncR快速添加服务</strong></h1><p id="401a" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">现在仍然很强大，让我们引入一个服务，添加一些小的实现，并使用依赖注入将该服务注入到我们的Web应用程序中！</p><p id="74cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">介绍<strong class="is hj"> IFooService </strong>:</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="729d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们可以使用一个新的类来实现这个服务，或者我们可以编写<strong class="is hj">我们需要的代码</strong>让<em class="mp">string Foo(int number of foos)</em>方法使用带有<a class="ae ku" rel="noopener" href="/geekculture/c-interfaces-to-functions-with-funcr-e7ea897ce39"> <strong class="is hj"> FuncR </strong> </a>的<strong class="is hj">函数</strong>工作。</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div class="er es mq"><img src="../Images/72bd347b687bac63242c27ad632427e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/0*AGv65HTMyuluOC3n"/></div></figure><p id="2b2a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">FuncR是一个小的。NET标准库，使您能够在C#中针对<strong class="is hj">接口</strong>注册<strong class="is hj">函数</strong>。</p><p id="4732" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们需要将FuncR添加到项目中</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="6242" class="jx jy hi jt b fi jz ka l kb kc">dotnet add package FuncR</span></pre><p id="c6c0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">若要使用FuncR，请将ConfigureServices方法添加到Program.cs文件中:</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="8aa5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个<strong class="is hj"> ConfigureServices </strong>方法中，你可以针对ASP.NET的DI容器注册任何服务，更具体地说，上面的代码为<strong class="is hj"> <em class="mp"> IFooService </em> </strong>注册了一个<strong class="is hj">代理</strong>，并将<em class="mp">字符串Foo(int numberOfFoos) </em>方法与第<strong class="is hj"> 7行和第</strong>8行提供的<strong class="is hj">函数</strong>挂钩，酷吧！？</p><p id="d23e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们只需要告诉<strong class="is hj"> HostBuilder </strong>使用这个方法来配置它的服务，我们已经准备好注入这个服务了:</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="4a9f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们现在<code class="du lu lv lw jt b">dotnet run</code>并导航到<a class="ae ku" href="http://localhost:5005" rel="noopener ugc nofollow" target="_blank"> http://localhost:5005 </a>，我们最终会看到一些不同的输出:</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/0d9d6ffffd1934f10ccc31501c67a34c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iJ0LSpVpVljRt_ONqkYA-g.png"/></div></div></figure><p id="0dd3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那是一大堆傻瓜。</p><p id="f75c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当然，Docker示例在重新构建并运行后仍然有效:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="5821" class="jx jy hi jt b fi jz ka l kb kc"><br/>docker build . --no-cache -t consoletoweb<br/>docker run -p 5005:5005 consoletoweb</span></pre><h1 id="79cf" class="ly jy hi bd kv lz ma mb kz mc md me ld mf mg mh lg mi mj mk lj ml mm mn lm mo bi translated">包扎</h1><p id="52bd" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">在本文中，我们看到了如何简单快速地将一个控制台应用程序转换成一个ASP.NET web应用程序，并介绍了FuncR来加速我们的服务实现。完整的代码以及更多内容可通过GitHub获得:</p><p id="34c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae ku" href="https://github.com/merken/ConsoleToWeb" rel="noopener ugc nofollow" target="_blank">https://github.com/merken/ConsoleToWeb</a></p></div></div>    
</body>
</html>