<html>
<head>
<title>How to Kafka Your Microservices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何Kafka你的微服务</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-kafka-your-microservices-9ef45a9e882a?source=collection_archive---------1-----------------------#2021-04-21">https://medium.com/geekculture/how-to-kafka-your-microservices-9ef45a9e882a?source=collection_archive---------1-----------------------#2021-04-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f6b544d3dc0aa4a77ce3dad756192bc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cR--XAchGCjYWmGI"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@mathyaskurmann?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Mathyas Kurmann</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6eec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated">应用程序工作流最吸引人和最具挑战性的话题之一是<em class="kc">消息/事件驱动的设计</em>。从长远来看，这甚至可能是成败的关键。</p><p id="d313" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所有提交的代码都可以在<em class="kc"> Github上获得。Y </em>你可以通过文末的“<strong class="ix hj">有用资源”</strong>一节轻松获取。</p><h1 id="f7ab" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">#索引</h1><ol class=""><li id="e608" class="lb lc hi ix b iy ld jc le jg lf jk lg jo lh js li lj lk ll bi translated">建筑说明</li><li id="c8b7" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">卡夫卡是什么？</li><li id="93c6" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">实际例子</li><li id="3f69" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">结论</li><li id="bfcc" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js li lj lk ll bi translated">有用的资源</li></ol></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><h1 id="c9c8" class="kd ke hi bd kf kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la bi translated">#架构解释</h1><figure class="me mf mg mh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/1625d0740ba8f374c694ee6b2f2fc95b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l3zvsG92HajYfC4e"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@andersjilden?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Anders Jildén</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c1ed" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可能已经知道，服务耦合是我们应该始终避免的。否则，应用的任何更改都会对其他服务产生重大影响。</p><p id="2386" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了解决紧密架构的问题，我们倾向于依赖两种不同的架构:</p><ul class=""><li id="56ae" class="lb lc hi ix b iy iz jc jd jg mi jk mj jo mk js ml lj lk ll bi translated">事件驱动架构(EDA)</li><li id="f74c" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated">消息驱动架构(MDA)</li></ul><p id="876c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些模式有什么新的地方？使用消息传递表示状态变化的事件的概念。</p><p id="01ab" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要快速向应用程序添加新功能，您的服务只需开始监听另一个服务发出的事件/消息流。</p><p id="85f0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我经常想到的最好的例子是内存缓存更新。</p><p id="f960" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设您创建了<strong class="ix hj"> <em class="kc">客户端</em> </strong>和<strong class="ix hj"> <em class="kc">地址</em> </strong> <em class="kc">服务</em>。每当有人请求客户端时，您将需要从<strong class="ix hj">地址</strong>服务中获取剩余的数据。不幸的是，这个服务需要花费大量的时间来获取这样的数据，而且数据只是偶尔更新一次，所以您还是决定缓存它。</p><p id="fb64" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用耦合架构，每次地址更新时，都必须撤销缓存的数据。所以在每次更新时，<strong class="ix hj"> <em class="kc">地址</em> </strong>服务必须联系<strong class="ix hj"> <em class="kc">客户端</em> </strong>服务进行缓存撤销。不仅需要更新新服务，还需要更新<strong class="ix hj"> <em class="kc">地址</em> </strong>服务本身<strong class="ix hj"> <em class="kc">。</em> </strong></p><p id="5c7f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有了<strong class="ix hj"> EDA/MDA </strong>架构，你只需要<strong class="ix hj"> <em class="kc">地址</em> </strong>服务来传达已经发生了变化。所有相关方都会收到消息并撤销缓存的数据。</p><p id="e3c2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">重要概念:</p><ul class=""><li id="c373" class="lb lc hi ix b iy iz jc jd jg mi jk mj jo mk js ml lj lk ll bi translated"><strong class="ix hj"> <em class="kc">主题</em> </strong> —服务可以放置或读取消息的一个<strong class="ix hj">消息桶</strong>。</li><li id="0ffe" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated"><strong class="ix hj"> <em class="kc">消费者</em> </strong> —正在收听特定<strong class="ix hj">话题</strong>的服务。每当有新消息到达时，它将从<strong class="ix hj">桶</strong>中移除并处理它。</li><li id="2e7c" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated"><strong class="ix hj"> <em class="kc">制作者</em> </strong> —向<strong class="ix hj">主题</strong>添加消息，以便相关方可以据此行事。</li></ul><p id="d301" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">优势:</p><ul class=""><li id="97ce" class="lb lc hi ix b iy iz jc jd jg mi jk mj jo mk js ml lj lk ll bi translated"><strong class="ix hj"> <em class="kc">松耦合</em> </strong> —两个服务都不知道对方的数据更新事宜。</li><li id="cdeb" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated"><strong class="ix hj"> <em class="kc">持久性</em> </strong> —保证即使消费者服务关闭，消息也将被传递。每当消费者再次起身时，所有消息都将出现在那里。</li><li id="3422" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated"><strong class="ix hj"> <em class="kc">可伸缩性</em> </strong> —因为消息存储在桶中，所以不需要等待响应。我们在所有服务之间创建异步通信。</li><li id="d1a2" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated"><strong class="ix hj"> <em class="kc">灵活性</em></strong>——消息的发送者不知道谁会消费它。这意味着您可以用更少的工作轻松地添加新消费者(新功能)。</li></ul><p id="a2ec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">缺点:</p><ul class=""><li id="d30e" class="lb lc hi ix b iy iz jc jd jg mi jk mj jo mk js ml lj lk ll bi translated"><strong class="ix hj"> <em class="kc">语义— </em> </strong>开发者需要对消息流有深刻的理解作为其严格要求。可能会出现复杂的回退方法。</li><li id="8bd5" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated"><strong class="ix hj"> <em class="kc">消息可见性— </em> </strong>您必须<strong class="ix hj"> <em class="kc"> </em> </strong>跟踪所有这些消息，以便在出现问题时进行调试。相关id可能是一个选项。</li></ul><blockquote class="mm mn mo"><p id="69ca" class="iv iw kc ix b iy iz ja jb jc jd je jf mp jh ji jj mq jl jm jn mr jp jq jr js hb bi translated">信息传递可能很复杂，但同时也很强大。</p></blockquote></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><h1 id="488f" class="kd ke hi bd kf kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la bi translated">#卡夫卡是什么？</h1><figure class="me mf mg mh fd ij er es paragraph-image"><div class="er es ms"><img src="../Images/228dd9f23f5b38ba2bb0659aebc40df4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*vmH5qoAjl1_qzswg.jpg"/></div><figcaption class="iq ir et er es is it bd b be z dx">What’s kafka</figcaption></figure><p id="162a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Kafka是一个开源的发布/订阅系统，最初由LinkedIn开发，于2011年开源。也称为分布式事件系统。</p><p id="fbf7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">信息会在磁盘上保留一段时间，这段时间由<a class="ae iu" href="https://www.cloudkarafka.com/blog/what-is-kafka-retention-period.html#:~:text=A%20message%20sent%20to%20a,of%20one%20of%20the%20logs.&amp;text=The%20message%20stays%20in%20the,days%20after%20it%20is%20published." rel="noopener ugc nofollow" target="_blank">保留策略</a>确定。</p><p id="cb5d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Kafka的主要目标是为处理实时数据流和构建数据管道提供一个可靠的高吞吐量平台。它允许创建现代化的可扩展系统，例如:</p><ul class=""><li id="377a" class="lb lc hi ix b iy iz jc jd jg mi jk mj jo mk js ml lj lk ll bi translated"><strong class="ix hj"> ETL </strong>(提取、转换、加载)</li><li id="79a7" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated"><strong class="ix hj"> CDC </strong>(变更数据捕获)</li><li id="612f" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated"><strong class="ix hj"> BDI </strong>(大数据摄取)</li></ul><p id="4482" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从体系结构的角度来看，我们有一个规模确定的组件，称为集群。在一个集群中，我们有几个服务器，也称为代理。我们通常至少有三个经纪人来提供足够的冗余。</p><figure class="me mf mg mh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/7a279d7302936e25f2f80f77fb00de5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NTLdQc26DySUIzf8j9uwzQ.jpeg"/></div></div></figure><p id="eb54" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">每个代理负责接收来自生产者的消息，并将这些消息提交到磁盘。代理还负责回答消费者的获取请求并为他们提供服务。</p><p id="23cd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在Kafka中，当一个消息被发送到一个代理时，它被发送到一个特定的主题。正如上一节提到的，主题允许我们对数据进行分类。数据最终会被分成几个分区。</p><p id="d96c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过将主题分成多个分区，我们提高了可伸缩性，因为每个分区都可以由单独的消费者读取。</p><p id="1f22" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">卡夫卡是一个系统中所有事件的中枢。</p></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><h1 id="2e42" class="kd ke hi bd kf kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la bi translated">#实际例子</h1><figure class="me mf mg mh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/ae1105bbb1c79ce4cb45e4e099552aac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vZlfgCvCdm2e_8LF.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Spring boot with kafka</figcaption></figure><p id="5b98" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于这个实际的例子，在架构部分使用的内存缓存例子是被选中的。</p><p id="2f2d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将有两个服务，消费者和生产者。</p><p id="8d88" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">生产者将负责接收HTTP请求。在每个请求中，我们将生成几个数据更新。这些数据更新应该通过缓存这些数据的服务进行传播。通过消息系统，所有感兴趣的团体将通过主题消息得到通知。</p><p id="0441" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">消费者将会听到这个话题，每当它收到一条新消息时，就会相应地撤销数据。</p><p id="ff30" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要求:</p><ul class=""><li id="f5ee" class="lb lc hi ix b iy iz jc jd jg mi jk mj jo mk js ml lj lk ll bi translated"><strong class="ix hj"> <em class="kc">弹簧启动</em> </strong> →这样我们就可以很容易地有一个工作的、可配置的例子。</li><li id="40f3" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated"><strong class="ix hj"> <em class="kc"> Docker </em> </strong> →所以你可以在任何环境下运行任何东西。</li><li id="e7b5" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated"><strong class="ix hj"> <em class="kc"> Apache Kafka → </em> </strong>基于消息的服务器。</li></ul><ol class=""><li id="6eba" class="lb lc hi ix b iy iz jc jd jg mi jk mj jo mk js li lj lk ll bi translated">使用以下<a class="ae iu" href="https://docs.docker.com/compose/install/" rel="noopener ugc nofollow" target="_blank">连杆</a>安装docker-compose。</li></ol><p id="675d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.进入<a class="ae iu" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj"><em class="kc">Spring Initializer</em></strong></a><strong class="ix hj"><em class="kc"/></strong>，用以下属性创建Spring项目，然后点击<strong class="ix hj"> ' <em class="kc">生成'。</em> </strong></p><figure class="me mf mg mh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/735ae39554a82d92170f9177d1d19218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WvbjvErs1c1lDqnoNUN3dA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Producer project initializer</figcaption></figure><p id="d3cb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.重复步骤1，但针对消费者。</p><figure class="me mf mg mh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mw"><img src="../Images/7dfd4d9185f60f9a4776fa0c63587601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-oNa3s8x_BL8tY1ZYDfIsw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Consumer project initializer</figcaption></figure><p id="6d41" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">4.创建一个文件夹，提取两个下载的压缩文件。</p><p id="c094" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">5.创建一个名为<strong class="ix hj"><em class="kc">docker-compose . yml</em></strong>的文件，添加下面的内容。通过这样做，我们定义了将连接到我们的应用程序的Kafka集群</p><ul class=""><li id="c09d" class="lb lc hi ix b iy iz jc jd jg mi jk mj jo mk js ml lj lk ll bi translated"><strong class="ix hj"> <em class="kc">版本→ </em> </strong> Docker版本。</li><li id="b609" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated"><strong class="ix hj"> <em class="kc">服务→ </em> </strong>同一个docker-compose内的所有服务都可以互相看到。出于通信目的，您可以使用服务名，因为docker将解析相应的位置。</li></ul><p id="4263" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> <em class="kc">注:</em> </strong>通过禁用自动创建主题，我们指定我们将创建自己的主题。</p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mx my l"/></div></figure><p id="f3ad" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">6.要启动这两个服务，只需运行下面的docker命令。</p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mx my l"/></div></figure><p id="1b66" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以下容器应该可用:</p><figure class="me mf mg mh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mz"><img src="../Images/cb3e4ee332dcac540f952d2617450b71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Jt1fIJfPoq09Nrk5j3AUA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Command: docker ps</figcaption></figure><p id="6cd8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">7.是时候编写我们的业务逻辑了。对于每个微服务，我们将有一个“两个包”结构。</p><ul class=""><li id="f84b" class="lb lc hi ix b iy iz jc jd jg mi jk mj jo mk js ml lj lk ll bi translated">配置→生产者/消费者配置。</li><li id="f6bf" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated">控制器→ REST或消息控制器。</li></ul><p id="b5cc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">8.从配置我们的生产者开始。在其依赖项文件中，插入下面的配置。</p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mx my l"/></div></figure><p id="fcbe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> <em class="kc">注意:</em> </strong> Lombok是一个依赖项，它允许我们删除一些由构造函数、设置函数和获取函数创建的样板文件。</p><p id="b051" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">9.在应用程序配置文件中，让我们添加下面的属性。</p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mx my l"/></div></figure><p id="c002" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">10.我们离完成生产者配置又近了两步。创建属性读取器类。</p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mx my l"/></div></figure><p id="ef9f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> <em class="kc">注:</em> </strong>龙目<strong class="ix hj"> <em class="kc"> @Data </em> </strong>注释会生成，在构建时，对应的构造函数、getters和setters。</p><p id="359e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">11.最后但同样重要的是，介绍我们的生产者配置组件。</p><ul class=""><li id="5db0" class="lb lc hi ix b iy iz jc jd jg mi jk mj jo mk js ml lj lk ll bi translated">我们首先通过映射注入我们的生产者配置。在本例中，我们添加了默认的。对于键，我们将使用Kafka的字符串序列化程序，而对于值，我们将使用JSON。</li><li id="043a" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated">定义生产者工厂。主要是因为我们正在定制我们的生产者配置。</li><li id="696a" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated">我们将使用Kafka模板向Kafka服务器发送消息。我们有一个对象值，因为我们希望最终支持多种类型的对象。</li><li id="a9c1" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated">通过注入新的主题，我们告诉卡夫卡去创造它。</li></ul><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mx my l"/></div></figure><p id="0d0e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">12.有了我们的配置集，我们只需要定义将通过消息和相应控制器的对象。</p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mx my l"/></div></figure><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mx my l"/></div></figure><p id="b5dd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">每次调用HTTP <em class="kc"> produce </em>端点时，<em class="kc"> x </em>消息将被创建并发送到Kafka服务器，其中包含我们想要从缓存中删除的实体。</p><p id="5870" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">每当您调用<a class="ae iu" href="http://localhost:8002/produce." rel="noopener ugc nofollow" target="_blank">http://localhost:8002/produce时，您应该能够看到下面的结果。</a></p><figure class="me mf mg mh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es na"><img src="../Images/bd0fba80952df3d4e06319ef8a28a250.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P7XySz5jidl7ee5Vglkasg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Web browser</figcaption></figure><figure class="me mf mg mh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nb"><img src="../Images/4fe2a39414bf04edaf2d9ed5b17a145d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iixJgo7Xpu0rtzN6v0PEjw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Log information</figcaption></figure><p id="fecd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">13.定义了生产者之后，再定义消费者。步骤和上面的步骤类似。用下面的配置设置<strong class="ix hj"><em class="kc">application . yml</em></strong>。</p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mx my l"/></div></figure><p id="3bb4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> <em class="kc">注:</em> </strong>各梯度依赖关系相同。</p><p id="0e4f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">14.添加以下配置类:</p><ul class=""><li id="e961" class="lb lc hi ix b iy iz jc jd jg mi jk mj jo mk js ml lj lk ll bi translated">与上面对新主题Bean的解释相同。</li><li id="d360" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated">我们定义我们的消费者反序列化器。</li><li id="958e" class="lb lc hi ix b iy lm jc ln jg lo jk lp jo lq js ml lj lk ll bi translated">我们设定工厂定义。</li></ul><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mx my l"/></div></figure><p id="9d7b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">15.将相同的PropertiesReader和CachedEntity实体添加到您的基本代码中。</p><p id="4e91" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">16.添加以下消息控制器。</p><ul class=""><li id="bad3" class="lb lc hi ix b iy iz jc jd jg mi jk mj jo mk js ml lj lk ll bi translated">我们定义一个用<strong class="ix hj"><em class="kc">KafkaListener</em></strong>注释注释的消费者方法。这样做可以让你研究一个特定的主题。</li></ul><p id="c4e9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">目前，我们只是记录收到的有效载荷。</p><figure class="me mf mg mh fd ij"><div class="bz dy l di"><div class="mx my l"/></div></figure><p id="8c27" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">启动消费者应用程序后，您应该能够看到以下结果:</p><figure class="me mf mg mh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nc"><img src="../Images/717d62b0fc0cd1bf451ba66382001aa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zjHpL96cDOb9-pzjcxZifQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Consumer logging information</figcaption></figure><p id="85ff" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在所有这些步骤之后，我们将MDA嵌入到了微服务架构中。恭喜你。</p></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><h1 id="d1b2" class="kd ke hi bd kf kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la bi translated">#结论</h1><p id="dbed" class="pw-post-body-paragraph iv iw hi ix b iy ld ja jb jc le je jf jg nd ji jj jk ne jm jn jo nf jq jr js hb bi translated">实践和时间是理解这种有影响力的架构的必要条件。继续努力，你会到达那里的。</p><p id="460b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有了这样一个实际的例子，我希望你离将这个架构扩展到你的项目更近了一步。</p><p id="d49a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">欢迎在评论中分享这篇文章对你的帮助！</p><h1 id="d911" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">#有用的资源</h1><div class="ng nh ez fb ni nj"><a rel="noopener follow" target="_blank" href="/swlh/integrate-your-spring-boot-with-a-redis-cache-system-ff707e61e75e"><div class="nk ab dw"><div class="nl ab nm cl cj nn"><h2 class="bd hj fi z dy no ea eb np ed ef hh bi translated">将您的Spring Boot与Redis缓存系统集成</h2><div class="nq l"><h3 class="bd b fi z dy no ea eb np ed ef dx translated">你上一次需要从网站上提交或提取数据，并且花费了很长时间是什么时候？</h3></div><div class="nr l"><p class="bd b fp z dy no ea eb np ed ef dx translated">medium.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx io nj"/></div></div></a></div><div class="ng nh ez fb ni nj"><a rel="noopener follow" target="_blank" href="/swlh/using-correlation-ids-with-spring-cloud-gateway-and-eureka-f00145c579ab"><div class="nk ab dw"><div class="nl ab nm cl cj nn"><h2 class="bd hj fi z dy no ea eb np ed ef hh bi translated">通过Spring Cloud Gateway和Eureka使用关联id</h2><div class="nq l"><h3 class="bd b fi z dy no ea eb np ed ef dx translated">在微服务架构中，有时我们希望确保所有服务的行为，例如:请求跟踪…</h3></div><div class="nr l"><p class="bd b fp z dy no ea eb np ed ef dx translated">medium.com</p></div></div><div class="ns l"><div class="ny l nu nv nw ns nx io nj"/></div></div></a></div><div class="ng nh ez fb ni nj"><a href="https://github.com/rafael-as-martins/medium/tree/kafka" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab dw"><div class="nl ab nm cl cj nn"><h2 class="bd hj fi z dy no ea eb np ed ef hh bi translated">拉斐尔·马丁斯/中等</h2><div class="nq l"><h3 class="bd b fi z dy no ea eb np ed ef dx translated">此分支是1提交在前，2提交在主后。在这个分支机构，你将…</h3></div><div class="nr l"><p class="bd b fp z dy no ea eb np ed ef dx translated">github.com</p></div></div><div class="ns l"><div class="nz l nu nv nw ns nx io nj"/></div></div></a></div></div></div>    
</body>
</html>