<html>
<head>
<title>How to make a string formatting server-driven in kotlin- Android?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在kotlin- Android中做一个字符串格式化服务器驱动？</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-make-server-driven-string-in-kotlin-android-9ddd18b3d88d?source=collection_archive---------24-----------------------#2021-07-27">https://medium.com/geekculture/how-to-make-server-driven-string-in-kotlin-android-9ddd18b3d88d?source=collection_archive---------24-----------------------#2021-07-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="accf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们假设我们想在kotlin后端响应的基础上改变一个字符串的颜色，并想制作一个字符串URL的一些单词，单击它将重定向到一个网页。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/c5c32cac2c6f9f9658f947193071f279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EGnm2PVgSLZYfmMKA9ttfw.jpeg"/></div></div></figure><p id="e47c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们假设我们想要实现像这样的^，你可以看到一些文本有链接和一些粗体字(如:-细节)，现在这整个字符串也来自后端，<br/>让我们假设我们的响应是这样的:-</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="a441" class="ju jv hi jq b fi jw jx l jy jz">{<br/>  "string": "Read more about %s and %s in $",<br/>  "text": [<br/>    {<br/>      "title": "TnC",<br/>      "href": "<a class="ae ka" href="https://www.google.com" rel="noopener ugc nofollow" target="_blank">https://www.google.com</a>"<br/>    },<br/>    {<br/>      "title": "Product Information",<br/>      "href": "<a class="ae ka" href="https://www.linkedin.com" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com</a>"<br/>    },<br/>    {<br/>      "title": "Detail",<br/>      "href": null<br/>    }<br/>  ]<br/>}</span></pre><p id="4fb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你看到我们的后端响应，我们已经给了字符串一些特殊的字符，我们希望在本地更改或格式化这些字符串，我们还创建了一个包含标题和链接的href的文本数组，这样我们就可以在字符串中点击一些单词，并在点击后打开一个网页，如果href为空，我们将假设我们必须在字符串中以粗体显示该单词。你们可以根据你们的要求做出回应，我刚刚给出了一个例子，我们如何在字符串中使用特殊字符来实现这一点。</p><p id="9521" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是时候写前端科特林代码✌️了</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="5a46" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">val </strong>footerString = SpannableStringBuilder(<strong class="jq hj">"Read more about %s and %s in $"</strong>)<br/>addFormattingToFooterString(footerString, footer)<br/><br/><em class="kb">with</em>(<strong class="jq hj">binding</strong>.contentView.tvTermsAndConditions) <strong class="jq hj">{<br/>    </strong><em class="kb">text </em>= footerString<br/>    <em class="kb">linksClickable </em>= <strong class="jq hj">true<br/>    </strong><em class="kb">movementMethod </em>= LinkMovementMethod.getInstance()<br/><strong class="jq hj">}</strong></span></pre><p id="8b0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如你在上面的代码中看到的，我们已经创建了一个spannable字符串，当我们想给字符串中的一些特定单词添加一些样式或跨度时，spannable字符串非常有用。<br/>之后我们调用了给字符串添加格式的方法来给字符串添加样式和链接。<br/>下面，我们使我们的整个文本视图可点击，并添加了链接移动，所以每当我们添加任何href(url)到我们的字符串中的任何单词，点击它后，将打开相应的网页。</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="1a34" class="ju jv hi jq b fi jw jx l jy jz"><strong class="jq hj">private fun </strong>addFormattingToFooterString(<br/>    footerString: SpannableStringBuilder,<br/>    footer: Footer<br/>) {<br/>    <strong class="jq hj">var </strong>linkListIndex = 0<br/>    footerString.<em class="kb">forEachIndexed </em><strong class="jq hj">{ </strong>index, char <strong class="jq hj">-&gt;<br/>        if</strong>(char == <strong class="jq hj">'$'</strong>){<br/>            footerString.setSpan(<br/>                StyleSpan(Typeface.<em class="kb">BOLD</em>),<br/>                index, index+1, Spannable.<em class="kb">SPAN_INCLUSIVE_INCLUSIVE<br/>            </em>)<br/>            footerString.replace(index, index+1, <strong class="jq hj">"Detail"</strong>)<br/>            linkListIndex++</span><span id="289e" class="ju jv hi jq b fi kc jx l jy jz">        }<br/>        <strong class="jq hj">if </strong>(char == <strong class="jq hj">'%'</strong>) {<br/>            footerString.setSpan(<br/>                StyleSpan(Typeface.<em class="kb">BOLD</em>),<br/>                index,<br/>                index + 2,<br/>                Spannable.<em class="kb">SPAN_INCLUSIVE_INCLUSIVE<br/>            </em>)<br/>            <strong class="jq hj">val </strong>footerTermsAndConditionString = footer.<strong class="jq hj">link</strong>[linkListIndex].<strong class="jq hj">text<br/>            val </strong>replaceableString =<br/>                <strong class="jq hj">"&lt;a href='" </strong>+ footer.<strong class="jq hj">link</strong>[linkListIndex].<strong class="jq hj">url </strong>+ <strong class="jq hj">"'&gt;&lt;u&gt;$</strong>footerTermsAndConditionString<strong class="jq hj">&lt;/u&gt;&lt;/a&gt;"<br/>            </strong>footerString.replace(<br/>                index,<br/>                index + 2,<br/>                <strong class="jq hj">if </strong>(Build.VERSION.<em class="kb">SDK_INT </em>&gt;= Build.VERSION_CODES.<em class="kb">N</em>) {<br/>                    Html.fromHtml(replaceableString, Html.<em class="kb">FROM_HTML_MODE_LEGACY</em>)<br/>                } <strong class="jq hj">else </strong>{<br/>                    Html.fromHtml(replaceableString)<br/>                }<br/>            )<br/>            linkListIndex++<br/>        }<br/>    <strong class="jq hj">}<br/></strong>}</span></pre><p id="dfab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的方法中，我们做了很多事情，让我们一个一个地理解所有这些事情。<br/> 1。首先，我们创建了一个listIndex变量，用于获取上面创建的文本数组中标题的索引(在后端响应中)。</p><p id="f123" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.让我们遍历我们的footerString，并使用<code class="du kd ke kf jq b">$</code>字符检查粗体字符串，如果它出现在响应字符串中，我们将使用后端字符串替换它，并将其设为粗体。首先，我们将为此设置跨度，并将当前索引和当前索引+1之间的字符串设为粗体(因为我们现在只想替换长度为1的单词(当前索引+1-currentIndex，` $ `)。</p><p id="dbbd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.现在，在这之后，我们用我们想要使用后端响应加粗的单词替换字符。现在，因为我们在这里使用了<strong class="ih hj"> SPAN_INCLUSIVE_INCLUSIVE </strong>，所以这个SPAN将扩展到包括字符串中任何新插入的字符，并将它们加粗，根据文档，它的定义是:-</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="d088" class="ju jv hi jq b fi jw jx l jy jz"><em class="kb">/**<br/> * Spans of type SPAN_INCLUSIVE_INCLUSIVE expand<br/> * to include text inserted at either their starting or ending point.<br/> */</em></span></pre><p id="3ce9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.现在下一步是我们添加网址的话与%s和取代%s的文字来在后端的反应，并添加网址给他们。因为我们已经维护了一个列表索引变量来查找文本数组中被替换字符串的索引，所以我们将把它用作被替换的字符串。</p><p id="1daa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.现在我们使用href的anchor标签将URL添加到特定的单词中。</p><p id="7c73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.最后，我们将用Html字符串替换我们的%s，这样就完成了。</p><p id="3a83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，正如你们可以看到我们如何设计我们的后端合同，使像样式，字符串后端驱动的单词的URL这样的事情。这有很多好处，将来我们可以在前端改变尽可能多的单词(改变它们的样式，给一些单词添加URL)，而无需任何应用程序发布。对于我们的用例，我们也可以使用<a class="ae ka" href="https://developer.android.com/reference/android/text/style/ClickableSpan" rel="noopener ugc nofollow" target="_blank">clickables span</a>，但是它创建了一些额外的类和一些额外的代码，所以我用了这个。</p><p id="e2c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您阅读这篇文章，如果您有任何疑问或反馈，可以通过<a class="ae ka" href="https://www.linkedin.com/in/vikas-bajpayee-4a17aa106/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>联系我。</p></div></div>    
</body>
</html>