<html>
<head>
<title>Sending Webflow Form Submissions Through to a Discord Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Webflow表单提交发送到Discord服务器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/sending-webflow-form-submissions-through-to-a-discord-server-33c1464bc7d9?source=collection_archive---------20-----------------------#2021-05-02">https://medium.com/geekculture/sending-webflow-form-submissions-through-to-a-discord-server-33c1464bc7d9?source=collection_archive---------20-----------------------#2021-05-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e3ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你有没有想过，你是否可以将所有通过你的Webflow站点提交的表单发送到一个Discord服务器上，让每个人都可以看到？我也不知道。</p><p id="dc92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但后来我想，如果你是某个机构的一员。想象一下一些年轻的、面向未来的开发人员，他们一直将不和谐作为他们主要的交流方式。</p><p id="e798" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为什么你不能和每个人分享每个新的表单查询呢？</p><p id="5a5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这样做，你就可以避免转发邮件和用不必要的交流打扰对方。我是芬兰人。我不喜欢不必要的交流。</p><p id="81a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这正是我们今天要做的。免费的。</p><p id="a8a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Webflow的本地webhooks、Node &amp; Express服务器、Heroku上的免费dyno以及模块“Discord.js”，我们将自动化整个过程。</p><p id="d5a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这听起来可能很复杂，但是相信我，如果你有一些基本的Javascript知识和学习的意愿，这并不难。</p><p id="950a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能会问:“但是扎皮尔呢?”。</p><p id="c146" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以用扎皮尔。</p><p id="87d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但那一点都不好玩。而且也有点贵。尤其是如果您一个月要为各种应用程序执行大量任务。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/2e2ffcdc065845f76a2c37584f1ca16d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b3X4MwXf9sbZp0UALTODlw.png"/></div></div></figure><h1 id="fbbb" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">先决条件</h1><p id="5dea" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">为了遵循本指南，您需要以下物品:</p><ul class=""><li id="c5ac" class="ks kt hi ih b ii ij im in iq ku iu kv iy kw jc kx ky kz la bi translated">一个<a class="ae lb" href="https://webflow.com/?rfsn=2938651.0684dd&amp;utm_medium=affiliate" rel="noopener ugc nofollow" target="_blank"> Webflow账户</a>(这是一个附属链接)</li><li id="d027" class="ks kt hi ih b ii lc im ld iq le iu lf iy lg jc kx ky kz la bi translated">一个免费的<a class="ae lb" href="https://heroku.com" rel="noopener ugc nofollow" target="_blank"> Heroku账号</a></li><li id="acdc" class="ks kt hi ih b ii lc im ld iq le iu lf iy lg jc kx ky kz la bi translated">一个<a class="ae lb" href="https://support.discord.com/hc/en-us/categories/200404378-Server-Setup" rel="noopener ugc nofollow" target="_blank">不和服务器</a></li><li id="a8d9" class="ks kt hi ih b ii lc im ld iq le iu lf iy lg jc kx ky kz la bi translated">一些基本的<a class="ae lb" href="https://www.codecademy.com/" rel="noopener ugc nofollow" target="_blank"> Javascript知识</a></li><li id="6bc3" class="ks kt hi ih b ii lc im ld iq le iu lf iy lg jc kx ky kz la bi translated">某种代码编辑器&amp;一个终端。我很喜欢两者兼而有之的<a class="ae lb" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VSCode </a>。</li></ul><p id="2f25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你还需要在你的电脑上安装<a class="ae lb" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> node.js </a>。只需下载安装程序，运行向导，你就可以开始了。</p><h2 id="84e0" class="lh jq hi bd jr li lj lk jv ll lm ln jz iq lo lp kd iu lq lr kh iy ls lt kl lu bi translated">Webflow</h2><p id="21b5" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">让我们从创建一个新的Webflow项目开始。如果你正在阅读本指南，你可能已经知道如何使用Webflow。</p><p id="6556" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个Webflow项目应该在站点的某个地方有一个表单。我已经创建了一个简单的联系人表单，其中包含<em class="lv">姓名</em>、<em class="lv">电子邮件</em> &amp; <em class="lv">消息</em>字段。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/b47513279adbc9c416913c39733357da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dBabBpqYi7F9b5jVFospzA.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx">My really simple form</figcaption></figure><p id="3dd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以使用你想要的任何类型的字段(除了文件上传，我还没有测试过它是如何工作的),但是确保你记住你为每个字段输入的名字。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mb"><img src="../Images/fdda8ecacb5f837453ddd46edf57f84b.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*j28VQ0aR6FjNbwCVzaQLqw.png"/></div><figcaption class="lx ly et er es lz ma bd b be z dx">Name entry for my message input field</figcaption></figure><p id="9541" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，现在我们有表格了。我们稍后会回来设置我们的webhooks，但是现在，让我们为我们的服务器编程。</p><h1 id="861c" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">服务器</h1><p id="b8f4" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">好吧，让我们想想我们要做什么。</p><p id="d48c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们有一个表单，以及一个webhook，可以在每个表单子消息的某个地方发送数据。</p><p id="39b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种情况下，我们希望建立自己的服务器，它应该能够接受来自Webflow的请求，处理表单数据并将其发送到我们的Discord服务器。</p><p id="d3b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以把我们的服务器想象成某种形式的妖精，每当Webflow想说话的时候就醒来，尖叫着他们说的任何不和谐的话，然后回去睡觉。小妖精会一周7天，一天24小时这样做。免费的。</p><p id="587b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好妖精。</p><h2 id="424e" class="lh jq hi bd jr li lj lk jv ll lm ln jz iq lo lp kd iu lq lr kh iy ls lt kl lu bi translated">我们走吧</h2><p id="05da" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">无论如何，在你的电脑上创建一个新的文件夹。这个文件夹将是你的小洞穴，包含你的服务器运行所需的一切。</p><p id="5586" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在您喜欢的代码编辑器中打开这个文件夹，并打开一个新的终端。在终端中，您希望运行<strong class="ih hj"> npm init -y </strong>。</p><p id="b201" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将初始化一个新的npm包，并创建一个package.json文件，其中包含运行服务器所需的所有依赖项。</p><p id="deb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“-y”标志将允许您运行整个向导，而无需输入任何信息。我们现在不关心这个。</p><p id="3668" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在package.json文件中，您希望添加一个命令，让Heroku知道应该如何启动您的服务器。只需在“脚本”下添加一个<strong class="ih hj">“开始”:“node index . js”</strong>。它应该是这样的:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mc"><img src="../Images/8f5dcfb462ab3a7dfadfbdd64044ab30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*wKEGIamkHCbG-WUHG79v4Q.png"/></div></figure><p id="bfb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在你的文件夹中，创建一个名为<strong class="ih hj"> index.js </strong>的文件。这将是你的唯一一个包含精灵(服务器)的文件。</p><h2 id="71ed" class="lh jq hi bd jr li lj lk jv ll lm ln jz iq lo lp kd iu lq lr kh iy ls lt kl lu bi translated">安装模块</h2><p id="690d" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">如上所述，我们需要安装几个模块:</p><p id="14f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Express.js  —主节点服务器框架，大大简化了设置服务器的过程。</p><p id="a01d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">Discord . js</strong>—Discord API包装器，简化了与Discord机器人的通信。</p><p id="d53c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Dotenv </strong> —一个让你在. env文件中存储环境变量的包。</p><p id="3674" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以通过在您的终端中运行命令<strong class="ih hj">NPM install express discord . js dotenv</strong>来安装它们。</p><p id="e15c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，现在我们可以在代码中访问这些库了。通过编写以下代码将它们全部导入。</p><pre class="je jf jg jh fd md me mf mg aw mh bi"><span id="77df" class="lh jq hi me b fi mi mj l mk ml">const express = require('express');</span><span id="a178" class="lh jq hi me b fi mm mj l mk ml">const Discord = require('discord.js');</span><span id="9cf3" class="lh jq hi me b fi mm mj l mk ml">require('dotenv').config()</span></pre><p id="365b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们从设置我们的express服务器开始。我们需要一个简单的POST路由，Webflow可以将它的数据发送到这个路由。</p><p id="e43e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我只是要粘贴一些代码，但是你可以通过点击<a class="ae lb" href="https://expressjs.com/en/guide/routing.html" rel="noopener ugc nofollow" target="_blank">这里</a>阅读更多关于express和它的路线是如何工作的。</p><pre class="je jf jg jh fd md me mf mg aw mh bi"><span id="0394" class="lh jq hi me b fi mi mj l mk ml">const app = express();</span><span id="0336" class="lh jq hi me b fi mm mj l mk ml">const PORT = process.env.PORT || 3000;</span><span id="40d3" class="lh jq hi me b fi mm mj l mk ml">app.use(express.json());</span><span id="030d" class="lh jq hi me b fi mm mj l mk ml">app.post('/form', (req, res) =&gt; {</span><span id="64a6" class="lh jq hi me b fi mm mj l mk ml">});</span><span id="ac08" class="lh jq hi me b fi mm mj l mk ml">app.listen(PORT, () =&gt; { console.log("We're up and running!") });</span></pre><p id="2abd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是做什么的？</p><p id="181e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个常量:<strong class="ih hj"> app </strong>只是将Express模块的一个对象存储在其中，使我们能够在剩下的代码中使用它。</p><p id="4e04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> PORT </strong>正在设置服务器运行的端口。如你所见，我们使用了<strong class="ih hj"> process.env.PORT </strong>，Heroku在服务器上运行时需要它来设置自己的端口。在本地运行服务器时，<strong class="ih hj"> || 3000 </strong>是默认端口(如果您想在部署之前尝试在您的机器上本地运行它)。</p><p id="cc2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面我们将设置<strong class="ih hj"> express.json() </strong>为中间件。这将确保我们可以处理JSON数据，这正是Webflow通过其webhook发送的数据格式类型。</p><p id="f967" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们设置一个路由:<strong class="ih hj"> '/form' </strong>，指定它将通过<strong class="ih hj"> app.post()接收POST请求。</strong></p><p id="fe67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个方法将让我们使用参数<strong class="ih hj"> req </strong>和<strong class="ih hj"> res </strong>，它们是<em class="lv">请求</em>和<em class="lv">响应</em>的常见简短关键字。正是在这个方法中，我们将接收、处理并向Discord发送数据。</p><p id="a3a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们有一个app.listen()方法。该方法接受端口作为参数，监听任何请求，并简单地在控制台记录一条短消息，让我们知道服务器已经启动并正在运行。</p><p id="069e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们一会儿会回到这个话题，但是让我们先来设置一下所有与不和谐有关的东西。</p><h2 id="0749" class="lh jq hi bd jr li lj lk jv ll lm ln jz iq lo lp kd iu lq lr kh iy ls lt kl lu bi translated">不调和</h2><p id="9b17" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">将以下代码放在app.post()路径上方的某个位置。</p><pre class="je jf jg jh fd md me mf mg aw mh bi"><span id="a93b" class="lh jq hi me b fi mi mj l mk ml">const Discord = require('discord.js');</span><span id="bd2e" class="lh jq hi me b fi mm mj l mk ml">const d_token = process.env.TOKEN;</span><span id="a627" class="lh jq hi me b fi mm mj l mk ml">const d_channel = process.env.CHANNEL;</span><span id="3a22" class="lh jq hi me b fi mm mj l mk ml">const client = new Discord.Client();</span><span id="61ee" class="lh jq hi me b fi mm mj l mk ml">client.login(d_token);</span></pre><p id="ba9e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们将导入<strong class="ih hj"> discord.js </strong>包，并将其存储在一个discord常量中。然后，我们将把我们的<strong class="ih hj">令牌</strong> &amp; <strong class="ih hj">通道id </strong>(前面提到过)存储在几个常量中，从我们的。env文件通过<strong class="ih hj"> process.env. &lt;关键字&gt;T27】。</strong></p><p id="8ffc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们会制造新的不和。常量<strong class="ih hj">客户端</strong>中的Client() 对象，我们将使用它来运行它的登录方法，将我们的令牌作为参数发送进来。</p><pre class="je jf jg jh fd md me mf mg aw mh bi"><span id="2e2d" class="lh jq hi me b fi mi mj l mk ml">client.on("ready", () =&gt; {</span><span id="c9fc" class="lh jq hi me b fi mm mj l mk ml">client.user</span><span id="b590" class="lh jq hi me b fi mm mj l mk ml">.setPresence({ activity: { name: "🥳" }, status: "online" })</span><span id="6073" class="lh jq hi me b fi mm mj l mk ml">.catch((e) =&gt; console.log(e));</span><span id="7ffe" class="lh jq hi me b fi mm mj l mk ml">});</span></pre><p id="995e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面，我们会让我们的机器人运行起来。客户端有一个<strong class="ih hj"> on() </strong>方法，让我们通过它的。setPresence()方法。</p><p id="e49a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为最后一点小奖励，我们将通过catch语句处理任何可能发生的错误，将它们记录下来，以便稍后在Heroku日志中看到它们。</p><p id="cec2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，现在我们的机器人可以开始运行了。所以让我们继续使用它向我们的<strong class="ih hj"> /form </strong>路由发送关于任何请求的消息。</p><h2 id="d290" class="lh jq hi bd jr li lj lk jv ll lm ln jz iq lo lp kd iu lq lr kh iy ls lt kl lu bi translated">前一条路线</h2><p id="a6fe" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">从这里开始编写的所有代码都在我们的app.post('/form ')路径中。</p><pre class="je jf jg jh fd md me mf mg aw mh bi"><span id="f101" class="lh jq hi me b fi mi mj l mk ml">let form_name = req.body.data.name;</span><span id="adc4" class="lh jq hi me b fi mm mj l mk ml">let form_email = req.body.data.email;</span><span id="2784" class="lh jq hi me b fi mm mj l mk ml">let form_message = req.body.data.message;</span></pre><p id="393a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这些变量中，我们将存储Webflow通过请求发送的数据。根据表单中的字段，这些可能会有所不同。</p><p id="84a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能还记得，我只有三个名为<em class="lv">姓名</em>、<em class="lv">电子邮件</em>和<em class="lv">消息</em>的字段。这些都存储在通过webhook发送的数据对象中。</p><p id="315e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了访问这个对象，我们使用我们的<strong class="ih hj"> req </strong> (request)参数，进入它的主体，将我们自己推到Webflow发送给我们的数据对象。最后，我们取出通过表单发送的每个参数。</p><p id="5adf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你的形式和我的不同会怎么样？嗯，很简单。</p><p id="bfa9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设您的表单也有一个名为budget的budget字段。那么你只需要把它存储在另一个变量中，比如:</p><pre class="je jf jg jh fd md me mf mg aw mh bi"><span id="c240" class="lh jq hi me b fi mi mj l mk ml">let form_budget = req.body.data.budget;</span></pre><p id="15bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">等等等等第四个。</p><pre class="je jf jg jh fd md me mf mg aw mh bi"><span id="1fa1" class="lh jq hi me b fi mi mj l mk ml">const form_data = new Discord.MessageEmbed()</span><span id="8232" class="lh jq hi me b fi mm mj l mk ml">.setColor('#0099ff')</span><span id="5946" class="lh jq hi me b fi mm mj l mk ml">.setTitle('New form submission')</span><span id="360d" class="lh jq hi me b fi mm mj l mk ml">.setURL(process.env.SITE)</span><span id="70bc" class="lh jq hi me b fi mm mj l mk ml">.setAuthor(form_name)</span><span id="f659" class="lh jq hi me b fi mm mj l mk ml">.setDescription(form_message)</span><span id="fb27" class="lh jq hi me b fi mm mj l mk ml">.setThumbnail('https://cdn.theorg.com/49515591-1fdb-45b7-8816-b490414a41ad_thumb.png')</span><span id="0873" class="lh jq hi me b fi mm mj l mk ml">.addField('Email', form_email, true)</span><span id="ff5f" class="lh jq hi me b fi mm mj l mk ml">.setTimestamp()</span><span id="0c00" class="lh jq hi me b fi mm mj l mk ml">.setFooter('Sent through successfully!');</span></pre><p id="09cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在这可能看起来有点复杂，但这只是<em class="lv"> Discord.js </em>对发送到Discord服务器的消息进行格式化的方式。</p><p id="1e3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如你所见，我将数据存储在一个名为<strong class="ih hj"> form_data </strong>的常量中，并通过Discord.js为我们创建的一些集成方法放置请求数据变量(form_name、form_email、form_message)。<a class="ae lb" href="https://discordjs.guide/popular-topics/embeds.html#embed-preview" rel="noopener ugc nofollow" target="_blank">点击此处，了解更多关于不和谐信息的格式。</a></p><p id="747f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我甚至为消息设置了蓝色，并将Webflow徽标作为缩略图。</p><p id="83d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，现在我们准备好将消息发送到我们的Discord服务器。最后。</p><pre class="je jf jg jh fd md me mf mg aw mh bi"><span id="7c95" class="lh jq hi me b fi mi mj l mk ml">client.channels.cache.get(d_channel).send(form_data)</span><span id="d0d0" class="lh jq hi me b fi mm mj l mk ml">.catch((e) =&gt; console.log(e));</span></pre><p id="6a2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Discord.js在其文档中指定了一系列方法，让您可以向特定的服务器发送消息。</p><p id="b5bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本例中，它是<strong class="ih hj"> client.channels.cache.get(服务器id)。</strong>发送(数据)。</p><p id="6a81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以看到我正在从我的。env文件，并发送我之前提到的<strong class="ih hj"> form_data </strong>变量作为要发送的数据。</p><p id="d209" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我捕捉可能发生的任何错误，将它们记录在Heroku日志中(或者，如果您在本地运行服务器，则记录在本地终端日志中)。</p><p id="471d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们差不多完成了。</p><p id="2340" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在做这个项目的时候，我注意到Heroku真的不喜欢我只是接受请求而不回应任何事情。它使请求超时，并在尝试重新建立连接时开始发送消息循环。</p><p id="3005" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，我们有一个非常简单的方法来解决这个问题。只需将以下代码放在app.post() route的底部。</p><pre class="je jf jg jh fd md me mf mg aw mh bi"><span id="9390" class="lh jq hi me b fi mi mj l mk ml">res.set("Connection", "close");</span><span id="c572" class="lh jq hi me b fi mm mj l mk ml">res.status(200).json({ data: 'Form submitted successfully' });</span></pre><p id="47f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太美了。</p><p id="bb27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将关闭连接，并返回一条没有人会看到的消息。但如果成功了，就成功了！</p><p id="8aa0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们结束了。以下是我们的goblin服务器的完整index.js代码:</p><p id="5fde" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lb" href="https://gist.github.com/robingranqvist/5cf61bf51f1809b488963dc8ad5954c3" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/robingranqvist/5cf 61 BF 51 f 1809 b 488963 DC 8 ad 5954 c 3</a></p><h2 id="179e" class="lh jq hi bd jr li lj lk jv ll lm ln jz iq lo lp kd iu lq lr kh iy ls lt kl lu bi translated">将我们的服务器部署到Heroku</h2><p id="3e55" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">我们正处于流程的最后一步:部署。</p><p id="dcb9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这相当简单，可以通过几种方式实现:</p><ul class=""><li id="cdff" class="ks kt hi ih b ii ij im in iq ku iu kv iy kw jc kx ky kz la bi translated">通过Heroku CLI</li><li id="c35a" class="ks kt hi ih b ii lc im ld iq le iu lf iy lg jc kx ky kz la bi translated">通过Github回购</li></ul><p id="1c4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我选择第二种方法，因为我想把我的代码保存在Github上，让任何想进一步开发这个项目的人都可以使用它。</p><p id="11ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在将回购文件推送到Github之前，一个极其重要的部分是添加一个. gitignore文件，其中包含您的。env文件以及node_modules。你不想在Github上公开你的令牌。它只是一个简单的文件，名为。gitignore ”,在单独的一行上有每个被忽略的文件或文件夹。大概是这样:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mn"><img src="../Images/da48e7b7d2cb262979817426b8734dcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*3uM4iCsgg3rVD3rGezCT8w.png"/></div></figure><p id="f296" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建文件并将其推送到Github repo非常简单。我就不细说了。相反，你可以通过<a class="ae lb" href="https://docs.github.com/en/github/importing-your-projects-to-github/adding-an-existing-project-to-github-using-the-command-line" rel="noopener ugc nofollow" target="_blank">点击这里</a>来阅读。</p><p id="d8df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您的回购被推送并准备好时，登录Heroku并创建一个新的应用程序。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mo"><img src="../Images/d9c48e3b35841d40ab7e90f9549c8a88.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*WJe5w-cAMfvDEl17W5M9bQ.png"/></div></figure><p id="02f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你想取什么名字就取什么名字，选择它的位置。我要去欧洲，因为我在那里。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mp"><img src="../Images/5cf5c2ecb8501991244934d98300a02e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d7spMiiXvaB3ht8xTkvDrg.png"/></div></div></figure><p id="c9e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在您可以选择您的部署方法了。</p><p id="cbea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如前所述，我将直接通过Github进行部署。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mq"><img src="../Images/d6ded2bc252becf4d9f7ad22971beeb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fzwCg0dQVa57gq6mkMbV-g.png"/></div></div></figure><p id="15aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Heroku上授权您的Github帐户后，您将能够选择您想要使用的回购。只需按“搜索”，找到你的回购，点击<strong class="ih hj">连接</strong>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mr"><img src="../Images/93da9292d42a7f91838cf3097cd9e34f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Ag5_IexXpP3SEAAjSTBPw.png"/></div></div></figure><p id="807a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们连在一起了。我们想确保Heroku监听新的推送并自动部署新代码，所以我们启用了自动部署。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/4060d970790c6523aca6b866f97885ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7KCz2jDU2-Dl4dXy_DBNPQ.png"/></div></div></figure><p id="4650" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只需选择您的分支(可能是主分支)，然后按下<strong class="ih hj">启用自动部署</strong>。完成后，您应该会看到类似于以下内容的日志:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mt"><img src="../Images/340bd32bbeaa569093a37890505194af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yaao-g2StbNcykkWp490MA.png"/></div></div></figure><p id="080d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果一切正常，您应该在几秒钟后看到成功部署的消息。这意味着我们的服务器已经部署完毕，正在运行。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mu"><img src="../Images/4988aab2de27ca4b75638133b9ed1850.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dCDCySEdMcH05mSziVgs1g.png"/></div></div></figure><p id="602a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">部署后，导航到Heroku项目设置并向下滚动到<strong class="ih hj">配置变量</strong>。</p><p id="f907" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，您希望从您的。环境文件。完成后，它应该看起来像这样:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mv"><img src="../Images/24af81b10a3295033afc6a1f4fc3dc49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ViFT6iP3MXn89LSkc86-Xw.png"/></div></div></figure><p id="50ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果一切都设置正确，你现在应该在你的不和谐服务器上看到你的机器人在线。不要担心它过一会儿就下线了。我们只需要它在每个发送的webhook上唤醒。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mw"><img src="../Images/ea38c71f8176b705e0913520a4e97df0.png" data-original-src="https://miro.medium.com/v2/resize:fit:568/format:webp/1*SO5b2Q9i1wsafUjTuvOspg.png"/></div></figure><p id="f04a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们准备在Webflow中设置我们的webhook。</p><h2 id="0c0e" class="lh jq hi bd jr li lj lk jv ll lm ln jz iq lo lp kd iu lq lr kh iy ls lt kl lu bi translated">Webflow webhooks</h2><p id="7226" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">webhook就是每当一件事情被另一件事情触发时发生的一件事情。</p><p id="30b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个相当奇怪的解释，所以让我们用官方的解释:“由某个事件触发的用户定义的HTTP回调”。</p><p id="c047" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的例子中，每次Webflow注意到一个表单被发送，它就会触发一个包含表单数据的webhook，将表单数据发送到我们的服务器。</p><p id="e099" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到您的Webflow项目设置，然后按“集成”。滚动到底部，你会看到网页挂钩设置。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mx"><img src="../Images/e0d4ed23056e8ffe231c4ee2af3e030f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a24H8ToNzNHytACnJHq9Mg.png"/></div></div></figure><p id="7e88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按下<strong class="ih hj">添加webhook </strong>，你就可以选择你的触发类型了。我们将选择表单提交。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es my"><img src="../Images/2e778b2aea0e1cd73ce80f0da99b99c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ivCxKYN6daLdTSDi8-D0bg.png"/></div></div></figure><p id="176a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在url输入中，只需复制并粘贴Heroku在部署您的app后给您的URL。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mz"><img src="../Images/4721c4b8140a010797b6e326d5b81d1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2zUOyZossPjEs64l4-Ai2g.png"/></div></div></figure><p id="1303" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们要确保指定我们的路线。在我的例子中，它被命名为'/form '。我就补充一下。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es na"><img src="../Images/289d959a298beb986c3277ef41151b4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*erPr4OYsUQiadetbiDdH8Q.png"/></div></div></figure><p id="1a5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，现在只需添加网页挂钩，保存您的设置并发布您的网站。让我们来测试一下。</p><p id="05b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到您的站点，通过您的表单发送一条消息，您会在您的服务器上看到类似这样的内容。干得好！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nb"><img src="../Images/f1b4d6b46f8f9d1a4d05efaa4dc783f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Zo74iiEzZAY2Lp2jV2o5A.png"/></div></div></figure><p id="13a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您现在已经成功设置了一个服务器小精灵，它可以唤醒Webflow和Discord并在它们之间进行通信。</p><p id="639e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅此而已。</p><p id="faad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是为什么要在这里停下来呢？你可以做很多事情。</p><p id="bdd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为什么不在每次你或你的团队发布你的站点时发布一条消息呢？它可能看起来像这样:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nc"><img src="../Images/0004bd1f8f0b810b9632be87dfb34a6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9unQdiM9CCaPZ7ZiPnIa4g.png"/></div></div></figure><p id="0a16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者，您可以通过更改站点的名称并将unix时间码格式化为可读格式，使其更加格式化。</p><p id="bc39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你喜欢的话，你也可以在网上商店出售产品时发送一条通知消息。</p><p id="94c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Webflow还允许您使用几个webhooks。在他们的<a class="ae lb" href="https://developers.webflow.com/#webhooks" rel="noopener ugc nofollow" target="_blank"> API文档中阅读更多关于他们的内容。</a></p><p id="c8de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好的，玩得开心:)/Robin</p></div></div>    
</body>
</html>