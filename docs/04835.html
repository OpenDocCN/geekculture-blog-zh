<html>
<head>
<title>Table Tennis Practice Tracking Dashboard</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">乒乓球练习跟踪仪表板</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/table-tennis-practice-tracking-dashboard-3c2535037f2b?source=collection_archive---------42-----------------------#2021-07-04">https://medium.com/geekculture/table-tennis-practice-tracking-dashboard-3c2535037f2b?source=collection_archive---------42-----------------------#2021-07-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="df75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于最近在家工作的政策，我需要一种在家锻炼的方式。我买了一个1/4大小的乒乓球台，和一个练习板(视频中的红色矩形)来帮助将球反弹回来。虽然这是一种出汗的方式，但它并没有显示练习表现如何，以及我花了多少时间。我希望有一种方法可以跟踪每次练习的所有信息，作为后期改进的参考。而且，人类喜欢读数字。数字是激励人们做更多事情的魔法。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div></figure><p id="b23a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经过反复试验，我建立了一个系统来显示我实习期间最重要的数字:</p><ul class=""><li id="760b" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc jp jq jr js bi translated"><strong class="ih hj">过了多少时间，</strong></li><li id="099e" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc jp jq jr js bi translated"><strong class="ih hj">我用了多少球，</strong></li><li id="1b82" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc jp jq jr js bi translated"><strong class="ih hj">我点击了多少次，</strong></li><li id="24b7" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc jp jq jr js bi translated"><strong class="ih hj">当前连续点击量，</strong></li><li id="8c89" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc jp jq jr js bi translated"><strong class="ih hj">还有最大连续命中。</strong></li></ul><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="jy jj l"/></div></figure><p id="9e9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我将解释该系统是如何建立的。</p><h1 id="0878" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">体系结构</h1><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es kx"><img src="../Images/4b9a53d4c5e56b1d84915aba2e27c254.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nrLYi_jP5EYFTTFJjaqVQg.png"/></div></div></figure><p id="381b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该系统由三部分组成:</p><ol class=""><li id="dd62" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc le jq jr js bi translated"><strong class="ih hj">一部手机</strong>记录练习场景，作为RTSP流媒体服务器；</li><li id="9bf8" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc le jq jr js bi translated"><strong class="ih hj">一台台式电脑</strong>(我用的是iMac)用于处理流媒体内容，同时也充当网络服务器；</li><li id="b351" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc le jq jr js bi translated"><strong class="ih hj">和一个平板电脑</strong>，或者另一个手机来显示当前的统计数据。</li></ol><p id="42d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用手机记录练习场景，并将视频传输到iMac机器，在iMac机器上运行python脚本来处理图像信息，然后在iMac上设置web服务器，将当前统计数据显示到靠近乒乓球台的远程Android平板电脑上。</p><h1 id="205a" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">RTSP流媒体</h1><p id="5f16" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">第一部分是最容易的部分；我从Fdroid网站下载了Spydroid。这是一个移动应用程序，可以录制视频，并通过RTSP协议进行流传输，有几种灵活的配置。由于我计划将所有繁重的工作都放在电脑上完成，所以我只需要一个设备来连续捕捉练习图像并将它们发送到电脑上。Spydroid正好完全符合我的需求。</p><div class="lk ll ez fb lm ln"><a href="https://f-droid.org/packages/net.majorkernelpanic.spydroid/" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hj fi z dy ls ea eb lt ed ef hh bi translated">免费和开源的Android应用程序库</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">VLC可以直接读取流*您可以启用/禁用声音或视频流*分辨率，比特率…</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">f-droid.org</p></div></div><div class="lw l"><div class="lx l ly lz ma lw mb lc ln"/></div></div></a></div><div class="lk ll ez fb lm ln"><a href="https://github.com/fyhertz/spydroid-ipcamera" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hj fi z dy ls ea eb lt ed ef hh bi translated">fyhertz/spydroid-ipcamera</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">Spydroid是一个小app。将你手机的摄像头和麦克风传到你的浏览器或VLC！这很有趣…</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">github.com</p></div></div><div class="lw l"><div class="mc l ly lz ma lw mb lc ln"/></div></div></a></div><h1 id="8080" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">图像处理</h1><p id="450a" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">图像处理由python脚本在OpenCV库的帮助下完成。OpenCV库是一个非常成熟和流行的处理图像的解决方案。很多资源也可以在互联网上找到。</p><p id="4973" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用OpenCV来检测图像左侧是否有任何图像差异(与球还没有进入屏幕的第一个图像相比)。平时我站在桌子右边，练习板放在左边。这就是为什么我只检测到图像的左侧。如果是这样，在图像差没了之后再算一击(也就是球又离开屏幕了)。</p><p id="7cb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该算法引用自以下链接:</p><div class="lk ll ez fb lm ln"><a href="https://www.pyimagesearch.com/2015/05/25/basic-motion-detection-and-tracking-with-python-and-opencv/" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hj fi z dy ls ea eb lt ed ef hh bi translated">用Python和OpenCV - PyImageSearch实现基本的运动检测和跟踪</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">那个狗娘养的。我知道他拿走了我最后一瓶啤酒。这些话是一个男人永远不应该说的。但是我喃喃自语…</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">www.pyimagesearch.com</p></div></div><div class="lw l"><div class="md l ly lz ma lw mb lc ln"/></div></div></a></div><p id="2c6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图像处理的主要实现在<code class="du me mf mg mh b">detact_area_change.py</code>。</p><div class="lk ll ez fb lm ln"><a href="https://github.com/plateaukao/pingpongpad/blob/main/detect_area_change.py" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hj fi z dy ls ea eb lt ed ef hh bi translated">plateaukao/pingpongpad</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">在GitHub上创建一个帐户，为plateaukao/pingpongpad的发展做出贡献。</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">github.com</p></div></div><div class="lw l"><div class="mi l ly lz ma lw mb lc ln"/></div></div></a></div><p id="5033" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有一个视频演示图像处理是如何进行的:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="jy jj l"/></div></figure><p id="14e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个过程的简单解释是:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es mj"><img src="../Images/3f2f156a964a39901425d0065022b98c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vWH3eAwqzzP-S5gJ0QPxxQ.png"/></div></div></figure><h2 id="a84c" class="mk ka hi bd kb ml mm mn kf mo mp mq kj iq mr ms kn iu mt mu kr iy mv mw kv mx bi translated">代码解释</h2><p id="34a3" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">在开始时，由于视频录制不稳定，跳过了几帧，对比度将在1到2秒后变得稳定，我在第79 ~ 82行跳过了这些帧。在第96~ 98行，每一帧都被调整到一个更小的尺寸，并转换成一个灰度图像(因为颜色是不相关的)，并应用高斯模糊来减少小噪声。</p><p id="4a3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当所有这些都完成后，第一帧将被记住(在第101行)作为比较后面变化的背景。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es my"><img src="../Images/ac7b8288d82692a719483bb36d0336d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IVC790vmndjRSt_y__bfuw.png"/></div></div></figure><p id="d670" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在第106到108行，图像被比较并过滤一些阈值以确保结果是我想要的。然后，<code class="du me mf mg mh b">callfindContours</code>进行后续动作。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es mz"><img src="../Images/43cb9fb46bda19e67346d7ef526ec752.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zUDGGvOoDehNCwv-5z6tzw.png"/></div></div></figure><p id="cd12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">测量每个轮廓数据以过滤掉太小的变化(在第116行)。仅考虑图像的左侧(第121行)。为该区域绘制一个矩形。然后125 ~ 148行是在计算是新球，新的安打，还是新的最大连续安打记录。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es na"><img src="../Images/99f653097b3e4a6ab1bfb0eb512e2975.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P62K1lEI1orI7zrJNo8YlA.png"/></div></div></figure><p id="c677" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果两次击中之间的时间差足够接近，比如说在1或2秒内，我假设它们是同一个球的连续击中(在第132 ~ 134行)。这就是我如何计算当前连续命中和最大连续命中。</p><p id="9264" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当图像数据被处理时，结果应该被发送到某个地方，以便我在练习乒乓球时可以看到它(在第148行)。</p><h1 id="9ce5" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">基于Python和Flask的Web服务器</h1><p id="fd67" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">我决定在iMac上写一个web服务器，而不是为平板电脑或移动电话写一个应用程序，因为这样更容易。web服务器是用Python和Flask写的。我还使用了<code class="du me mf mg mh b">SocketIO</code>库来加快速度。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es nb"><img src="../Images/55c0d35a9e1c9b8bcc103e4852aec316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xmbcmlabvtNbyxaHAx4Tvg.png"/></div></div><figcaption class="nc nd et er es ne nf bd b be z dx">Sequence diagram for iMac and Tablet</figcaption></figure><p id="8e0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当Web服务器通过SocketIO接收到来自<code class="du me mf mg mh b">detect_area_change.py</code>的<code class="du me mf mg mh b">hit_status</code>事件时，会向网页发出一个<code class="du me mf mg mh b">status_response</code>事件来更新用户现在可以看到的内容。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es ng"><img src="../Images/e9d328be3fced2cbbb5e55e56a927c4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ZNfHXBqpPLtMybOiAlftg.png"/></div></div></figure><h1 id="9cf4" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">在Web上显示统计数据</h1><p id="140b" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">当从web服务器获取<code class="du me mf mg mh b">status_response</code>时，网页会相应地更新内容。下面是代码片段:在网页上，有我需要的信息的专用元素。我只是在新值出现时修改文本。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es nh"><img src="../Images/45366ac57d85abe76be8fc657388f1c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ys2BJCFJare3l-LiaDLUkg.png"/></div></div></figure><p id="8dca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是示例web内容演示:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es ni"><img src="../Images/88b6a37568133e8575e29472ac3083f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8K7ayLAepgh_N-7DfkNE1w.png"/></div></div></figure><h1 id="44e1" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">开始和停止跟踪</h1><p id="8a6a" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">网页底部会添加一个跟踪按钮。如果点击它，它将触发网络服务器开始从手机读取RTSP流数据，并开始整个过程。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es nj"><img src="../Images/e041abffd9f31872fe98146da3219742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NuNIkHlM9hYwqHA4v-6xBw.png"/></div></div></figure><p id="0ea6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">再次单击同一按钮时，将停止图像处理，并将当前统计数据保存到本地文件。这些数据然后可以用于呈现训练趋势和努力。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es nk"><img src="../Images/900e26ff6faa4995e0eb539be5993b00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Nd3CHKy6gs_kYu_WnfJKg.png"/></div></div></figure><p id="5f8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码写得不好，因为它只是一个概念验证的解决方案，用于个人使用。然而，我认为这个概念也可以很容易地应用到其他可能的场景中。希望这篇文章对你在家的体育锻炼有所帮助。</p><h1 id="6e01" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">项目的源代码</h1><div class="lk ll ez fb lm ln"><a href="https://github.com/plateaukao/pingpongpad" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hj fi z dy ls ea eb lt ed ef hh bi translated">plateaukao/pingpongpad</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">在GitHub上创建一个帐户，为plateaukao/pingpongpad的发展做出贡献。</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">github.com</p></div></div><div class="lw l"><div class="nl l ly lz ma lw mb lc ln"/></div></div></a></div></div></div>    
</body>
</html>