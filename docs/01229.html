<html>
<head>
<title>Hermetic Unit Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">密封单元测试</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/hermetic-unit-testing-8c49276e3acd?source=collection_archive---------11-----------------------#2021-04-02">https://medium.com/geekculture/hermetic-unit-testing-8c49276e3acd?source=collection_archive---------11-----------------------#2021-04-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/37258156e5bdfa8f3ae764e830228988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UeVPlBxeOnEIQveQ"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@cdc?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">CDC</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3e6e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">编程的很大一部分是编写测试，以确保您的代码按预期工作。在较小的项目中，编写测试可能看起来很麻烦，但是随着功能的增加、模块的重构和团队的成长，它们将显示出它们的价值。大多数软件工程师都熟悉基本的测试类型，例如<a class="ae iu" href="https://en.wikipedia.org/wiki/Unit_testing" rel="noopener ugc nofollow" target="_blank">单元测试</a>、<a class="ae iu" href="https://en.wikipedia.org/wiki/Integration_testing" rel="noopener ugc nofollow" target="_blank">集成测试</a>和<a class="ae iu" href="https://en.wikipedia.org/wiki/Acceptance_testing" rel="noopener ugc nofollow" target="_blank">验收测试</a>。今天我想谈谈保持单元测试的封闭性，以确保它们仍然是单元测试，而不是集成测试。</p><p id="a7d2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">密封通常与洁净室实验室联系在一起，但在软件领域，它指的是与外界隔绝或不受外界影响的测试。这些影响可能是依赖关系，比如数据库、库、API，或者不是被测试的特定代码集的任何东西。通过设计进行的单元测试应该有一个狭窄的范围，集中于测试系统的单个目标。例如，只测试一个类的单个方法。这种狭窄的范围使得单元测试易于理解和故障排除，并保持快速和可靠。</p><p id="33ba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，考虑图1，它接受来自外部API的散列作为参数。这个散列包含一个摄氏温度，这个温度被转换成华氏温度。</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="a9e3" class="kf kg hi jw b fi kh ki l kj kk">def to_fahrenheit(api_return)<br/>  (api_return[:temperature] * 9/5) +32<br/>end</span><span id="07a3" class="kf kg hi jw b fi kl ki l kj kk"><strong class="jw hj">Figure 1: Arbitrary Ruby method to coverting Celsius to Fahrenheit</strong></span></pre><p id="3a45" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因为这段代码期望从外部API返回，所以很自然地认为单元测试应该在将它传递给<code class="du jt ju jv jw b">to_fahrenheit</code>之前调用外部API。尽管这是可行的，但它并不是真正的单元测试，而是由于外部API调用而产生的集成测试。外部调用将增加测试的时间和复杂性，这可能会使这种直接的方法变得不可靠。相反，外部API的返回应该用<a class="ae iu" href="https://en.wikipedia.org/wiki/Method_stub" rel="noopener ugc nofollow" target="_blank">替换</a>，如图2所示，以保持单元测试的密封。</p><pre class="jx jy jz ka fd kb jw kc kd aw ke bi"><span id="2a7e" class="kf kg hi jw b fi kh ki l kj kk">class TestMeme &lt; Minitest::Test<br/>  def setup<br/>    @fake_api_return = {temperature: 100}<br/>  end<br/><br/>  def test_to_fahrenheit<br/>    assert_equal 212, to_fahrenheit(@fake_api_return)<br/>  end<br/>end</span><span id="7ee3" class="kf kg hi jw b fi kl ki l kj kk"><strong class="jw hj">Figure 2: Hermetic Unit Test of to_fahrenheit using </strong><a class="ae iu" href="https://github.com/seattlerb/minitest" rel="noopener ugc nofollow" target="_blank"><strong class="jw hj">Ruby minitest</strong></a></span></pre><p id="c278" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是一个简单的例子，但是在编写单元测试时，你应该记住这个概念。您是否对数据库或库进行了不必要的调用来测试方法？这个测试失败是因为你写的代码还是你使用的服务宕机了？也就是说，单元测试不会覆盖你所有的测试需求，一些集成测试和验收测试可能是必需的。在上面的例子中，应该添加一个集成测试来检查外部API的返回，以确保它是您期望的形状。总的来说，你正在编写测试，让它们为你工作，而不是与你作对。</p></div></div>    
</body>
</html>