<html>
<head>
<title>Run Background Program with Screen</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用屏幕运行后台程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/run-background-program-with-screen-a7eb301a9284?source=collection_archive---------0-----------------------#2021-01-07">https://medium.com/geekculture/run-background-program-with-screen-a7eb301a9284?source=collection_archive---------0-----------------------#2021-01-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/fce78ac63161c6d0a3c278630b60b01e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*S6U3GUvMxtmMT7YQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">screen image is taken from google</figcaption></figure><p id="10bf" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi js translated"><span class="l jt ju jv bm jw jx jy jz ka di">我们</span>经常需要SSH或者telnet远程登录Linux服务器，经常会运行一些需要很长时间才能完成的任务。在此期间，我们不能关闭窗口或断开连接，否则，任务将被杀死，一切都将中止或，网络将突然中断，任务没有完成。这时候我们可以打开屏幕会话来解决。</p><p id="16c2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">screen命令可以将当前窗口与任务分开。即使我们离线，服务器仍然在后台运行任务。当我们再次登录到服务器时，我们可以读取窗口线程并重新连接到任务窗口。</p><p id="fed2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">屏幕是一个全屏窗口管理器，可以在多个线程之间复用一个物理终端。屏幕上有一个会话的概念。用户可以在一个屏幕会话中创建多个屏幕窗口。每个屏幕窗口就像操作一个真正的SSH连接窗口。</p></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><p id="4174" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">安装GNU屏幕</strong></p><p id="151c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">GNU Screen在大多数Linux操作系统的默认存储库中都有。</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="8e36" class="kr ks hi kn b fi kt ku l kv kw"># To install GNU Screen on Arch Linux, run:</span><span id="a427" class="kr ks hi kn b fi kx ku l kv kw">$ sudo pacman -S screen</span><span id="9b26" class="kr ks hi kn b fi kx ku l kv kw"># On Debian, Ubuntu, Linux Mint:</span><span id="25d2" class="kr ks hi kn b fi kx ku l kv kw">$ sudo apt-get install screen</span><span id="eabb" class="kr ks hi kn b fi kx ku l kv kw"># On Fedora:</span><span id="fcc0" class="kr ks hi kn b fi kx ku l kv kw">$ sudo dnf install screen</span><span id="9368" class="kr ks hi kn b fi kx ku l kv kw"># On RHEL, CentOS:</span><span id="9550" class="kr ks hi kn b fi kx ku l kv kw">$ sudo yum install screen</span><span id="39d9" class="kr ks hi kn b fi kx ku l kv kw"># On SUSE/openSUSE:</span><span id="c652" class="kr ks hi kn b fi kx ku l kv kw">$ sudo zypper install screen</span></pre><h1 id="ffd0" class="ky ks hi bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">主要功能</h1><ul class=""><li id="62ef" class="lv lw hi iw b ix lx jb ly jf lz jj ma jn mb jr mc md me mf bi translated"><strong class="iw hj">会话恢复:</strong>只要屏幕本身没有终止，就可以恢复在其中运行的会话。这对远程登录的用户特别有用——即使网络连接中断，用户也不会失去对已经打开的命令行会话的控制。只需再次登录主机并执行<strong class="iw hj"> screen -r </strong>即可恢复会话。同样，在暂时离开的时候，也可以执行detach命令来暂停屏幕(切换到后台)，同时保证里面程序的正常运行。这非常类似于图形界面下的VNC。</li></ul><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="7b55" class="kr ks hi kn b fi kt ku l kv kw"># To start the session<br/>$ screen -S screen_name</span><span id="fd1e" class="kr ks hi kn b fi kx ku l kv kw"># To resume the session or Reattach session enters a screen process<br/>$ screen -r</span><span id="2e24" class="kr ks hi kn b fi kx ku l kv kw"># If there will be multiple screen running then <br/>$ screen -r screen_name</span><span id="2806" class="kr ks hi kn b fi kx ku l kv kw"># To detach the session<br/>$ screen –d screen_name</span><span id="2b05" class="kr ks hi kn b fi kx ku l kv kw"># View all screen sessions<br/>$ screen -ls</span></pre><p id="cbd6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">进入屏幕会话后，您可以在会话中创建多个窗口并管理这些窗口。管理命令以<strong class="iw hj"> ctrl+ a </strong>开始</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="60f0" class="kr ks hi kn b fi kt ku l kv kw">ctrl + a + c: create a new window (create)</span><span id="2b95" class="kr ks hi kn b fi kx ku l kv kw">ctrl + a + n: switch to the next window (next)</span><span id="4e90" class="kr ks hi kn b fi kx ku l kv kw">ctrl + a + p: switch to the previous window (previous)</span><span id="d0b8" class="kr ks hi kn b fi kx ku l kv kw">ctrl + a + w: list all windows</span><span id="af38" class="kr ks hi kn b fi kx ku l kv kw">ctrl + a + A: Rename window</span><span id="1928" class="kr ks hi kn b fi kx ku l kv kw">ctrl + a + d: detach the current session</span><span id="bb26" class="kr ks hi kn b fi kx ku l kv kw">ctrl + a + [1-9]: switch to the specified window (1-9 is the window number)</span><span id="4268" class="kr ks hi kn b fi kx ku l kv kw">ctrl + d: Exit (close) the current window</span></pre><ul class=""><li id="15ac" class="lv lw hi iw b ix iy jb jc jf mg jj mh jn mi jr mc md me mf bi translated"><strong class="iw hj">多窗口:</strong>在屏幕环境下，所有的会话都是独立运行的，都有自己的编号、输入、输出和窗口缓存。用户可以通过快捷键在不同窗口之间切换，可以自由重定向每个窗口的输入输出。Screen实现基本的文本操作，如复制和粘贴等。它还提供了类似滚动条的功能来查看窗口状态的历史记录。还可以对窗口进行分区和命名，并且可以监视后台窗口的活动。</li><li id="2d31" class="lv lw hi iw b ix mj jb mk jf ml jj mm jn mn jr mc md me mf bi translated"><strong class="iw hj">会话共享:</strong>屏幕允许一个或多个用户从不同的终端多次登录一个会话，并共享该会话的所有特征(例如，您可以看到完全相同的输出)。它还提供了一种窗口访问权限机制，可以对窗口进行密码保护。</li></ul><h1 id="986f" class="ky ks hi bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">新窗口</h1><p id="c80c" class="pw-post-body-paragraph iu iv hi iw b ix lx iz ja jb ly jd je jf mo jh ji jj mp jl jm jn mq jp jq jr hb bi translated">创建新窗口有三种方式:</p><p id="c9d1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">$ screen</strong>#这样，你可以创建一个新的窗口并进入一个窗口，但是这样一来这个窗口就没有名字了，并且无法区分它们</p><p id="16f6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">$ screen-S name</strong>#这将创建一个名为name的新窗口，并将其合并到窗口中</p><blockquote class="mr ms mt"><p id="f28f" class="iu iv mu iw b ix iy iz ja jb jc jd je mv jg jh ji mw jk jl jm mx jo jp jq jr hb bi translated">例如，screen -S count创建了一个名为count的新窗口，并输入</p></blockquote><p id="55b0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> $ screen命令</strong>#创建一个新窗口并在窗口中执行命令，同样没有名字</p><blockquote class="mr ms mt"><p id="e832" class="iu iv mu iw b ix iy iz ja jb jc jd je mv jg jh ji mw jk jl jm mx jo jp jq jr hb bi translated">例如screen python。/sample.py创建并执行sample.py程序</p></blockquote><h1 id="845d" class="ky ks hi bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">其他有用的屏幕命令</h1><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="87c2" class="kr ks hi kn b fi kt ku l kv kw"># Terminate Screen session, If the session is no longer needed, just kill it. To kill the disconnected session named senthil:</span><span id="642d" class="kr ks hi kn b fi kx ku l kv kw">screen -r sample -X quit</span><span id="fae7" class="kr ks hi kn b fi kx ku l kv kw">or:</span><span id="3cc4" class="kr ks hi kn b fi kx ku l kv kw">screen -X -S sample quit</span><span id="09b1" class="kr ks hi kn b fi kx ku l kv kw">or:</span><span id="ac41" class="kr ks hi kn b fi kx ku l kv kw">screen -X -S 29415 quit<br/>********************************************************************</span><span id="c9c8" class="kr ks hi kn b fi kx ku l kv kw">Ctrl + a :list all conversations</span><span id="f609" class="kr ks hi kn b fi kx ku l kv kw">Ctrl + a 0 :switch to session number 0</span><span id="641a" class="kr ks hi kn b fi kx ku l kv kw">Ctrl + an :switch to the next session</span><span id="ba13" class="kr ks hi kn b fi kx ku l kv kw">Ctrl + ap :switch to the previous session</span><span id="1151" class="kr ks hi kn b fi kx ku l kv kw">Ctrl + a S :Split the current area into two areas horizontally</span><span id="f64d" class="kr ks hi kn b fi kx ku l kv kw">Ctrl + al :Split the current area into two areas vertically</span><span id="ad16" class="kr ks hi kn b fi kx ku l kv kw">Ctrl + a Q :Close all sessions except the current session</span><span id="c5d4" class="kr ks hi kn b fi kx ku l kv kw">Ctrl + a X :close the current session</span><span id="4fc7" class="kr ks hi kn b fi kx ku l kv kw">Ctrl + a \ :Terminate all sessions and terminate Screen</span><span id="ecbc" class="kr ks hi kn b fi kx ku l kv kw">Ctrl + a? :Show key bindings. To log out, press enter #### Lock session<br/>******************************************************************</span><span id="4938" class="kr ks hi kn b fi kx ku l kv kw"># Screen has an option to lock the session. To do this, press Ctrl + a and x. Enter your Linux password to lock it.</span><span id="2d6b" class="kr ks hi kn b fi kx ku l kv kw">Screen used by sk on ubuntuserver.</span><span id="53ab" class="kr ks hi kn b fi kx ku l kv kw">Password:</span><span id="48d2" class="kr ks hi kn b fi kx ku l kv kw"># Record session</span><span id="8077" class="kr ks hi kn b fi kx ku l kv kw">You may want to record everything in the Screen session. To do this, just press Ctrl + a and H.</span><span id="160e" class="kr ks hi kn b fi kx ku l kv kw"># Alternatively, you can use the -L parameter to start a new session to enable logging.</span><span id="ffb1" class="kr ks hi kn b fi kx ku l kv kw">screen -L</span><span id="ab8f" class="kr ks hi kn b fi kx ku l kv kw">From now on, all the activities you do in the session will be recorded and stored in a file named screenlog.x in the $HOME directory. Here, x is a number.</span><span id="dc49" class="kr ks hi kn b fi kx ku l kv kw">You can use the cat command or any text viewer to view the contents of the log file.</span></pre><h2 id="2532" class="kr ks hi bd kz my mz na ld nb nc nd lh jf ne nf ll jj ng nh lp jn ni nj lt nk bi translated"><strong class="ak">关闭会话窗口</strong></h2><p id="4fd8" class="pw-post-body-paragraph iu iv hi iw b ix lx iz ja jb ly jd je jf mo jh ji jj mp jl jm jn mq jp jq jr hb bi translated">如果你想关闭一个额外的窗口，有三种方法:</p><blockquote class="mr ms mt"><p id="612a" class="iu iv mu iw b ix iy iz ja jb jc jd je mv jg jh ji mw jk jl jm mx jo jp jq jr hb bi translated"><strong class="iw hj"> kill -9 threadnum </strong>比如上面的2637，kill -9 2637可以杀死线程，当然也杀死了窗口</p><p id="304e" class="iu iv mu iw b ix iy iz ja jb jc jd je mv jg jh ji mw jk jl jm mx jo jp jq jr hb bi translated">使用<strong class="iw hj"> Ctrl a +k </strong>终止当前窗口和窗口中运行的程序</p><p id="f59e" class="iu iv mu iw b ix iy iz ja jb jc jd je mv jg jh ji mw jk jl jm mx jo jp jq jr hb bi translated">使用<strong class="iw hj"> Ctrl a并输入退出命令</strong>退出屏幕会话。需要注意的是，这个退出会杀死所有的窗口，并退出所有正在运行的程序</p></blockquote><h2 id="a368" class="kr ks hi bd kz my mz na ld nb nc nd lh jf ne nf ll jj ng nh lp jn ni nj lt nk bi translated">清理死窗</h2><p id="3189" class="pw-post-body-paragraph iu iv hi iw b ix lx iz ja jb ly jd je jf mo jh ji jj mp jl jm jn mq jp jq jr hb bi translated">当窗口被杀死时，可以使用<strong class="iw hj"> screen -ls </strong>查看(？？？dead)在窗户后面，表示窗户是死的，但是仍然占用空间。这时你需要清理窗户</p><blockquote class="mr ms mt"><p id="7a9d" class="iu iv mu iw b ix iy iz ja jb jc jd je mv jg jh ji mw jk jl jm mx jo jp jq jr hb bi translated">$ screen-wipe #自动清除死窗口</p></blockquote><p id="1fec" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这种窗明几净~</p></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><p id="354a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果没有打开的会话，您将看到以下输出:</p><blockquote class="mr ms mt"><p id="a41d" class="iu iv mu iw b ix iy iz ja jb jc jd je mv jg jh ji mw jk jl jm mx jo jp jq jr hb bi translated">$ screen -ls</p><p id="a27c" class="iu iv mu iw b ix iy iz ja jb jc jd je mv jg jh ji mw jk jl jm mx jo jp jq jr hb bi translated">在/run/screens/S-sk中没有找到套接字。</p></blockquote><p id="98cd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有关更多详细信息，请参考手册页:</p><blockquote class="mr ms mt"><p id="5b67" class="iu iv mu iw b ix iy iz ja jb jc jd je mv jg jh ji mw jk jl jm mx jo jp jq jr hb bi translated">$ man屏幕</p></blockquote></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><p id="96ce" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我希望你喜欢这个小会议。如果您有任何意见或问题或建议，请加入下面的论坛讨论！</p><p id="f7f5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">感谢支持(<a class="ae nl" rel="noopener" href="/@budhdisharma"> <strong class="iw hj"> <em class="mu">跟着</em> </strong> </a>或者<a class="ae nl" href="https://medium.com/p/761e6da812b8/edit" rel="noopener"><strong class="iw hj"><em class="mu">Clapp</em></strong></a>)！！！！！</p><div class="nm nn ez fb no np"><a href="https://budhdisharma.medium.com/" rel="noopener follow" target="_blank"><div class="nq ab dw"><div class="nr ab ns cl cj nt"><h2 class="bd hj fi z dy nu ea eb nv ed ef hh bi translated">布迪夏尔马-中等</h2><div class="nw l"><h3 class="bd b fi z dy nu ea eb nv ed ef dx translated">在这个博客中，我们将讨论Android的MVP设计模式，它是一个更好的和改进的替代方案…</h3></div><div class="nx l"><p class="bd b fp z dy nu ea eb nv ed ef dx translated">budhdisharma.medium.com</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od io np"/></div></div></a></div></div></div>    
</body>
</html>