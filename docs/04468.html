<html>
<head>
<title>Java TS Video Downloader</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java TS视频下载程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/java-ts-video-downloader-a0fcf23ab84a?source=collection_archive---------8-----------------------#2021-06-28">https://medium.com/geekculture/java-ts-video-downloader-a0fcf23ab84a?source=collection_archive---------8-----------------------#2021-06-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/eb614e60ffb6dd595ab7ffb4825e52e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X5_9C9wLci1mpWUR03n97A.png"/></div></div></figure><p id="996a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你是否遇到过一个网站，上面有你想下载的视频，但是因为视频格式是<strong class="is hj">传输流</strong> ( <strong class="is hj"> TS </strong>)文件而无法下载？</p><p id="16b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">与MP4或MOV多媒体格式不同，大多数ts文件格式不在单个文件中包含完整的视频；相反，每个单独的TS文件代表完整视频的一个片段。在本文中，我将详细描述如何成功下载和组装TS视频文件，以制作一个完整的视频。</p><p id="6276" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但如果你宁愿不去细说，这里是直接的<a class="ae jo" href="https://github.com/Jet-C/java-video-downloader-util" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> GitHub项目源代码:</strong> </a></p><div class="jp jq ez fb jr js"><a href="https://github.com/Jet-C/java-video-downloader-util" rel="noopener  ugc nofollow" target="_blank"><div class="jt ab dw"><div class="ju ab jv cl cj jw"><h2 class="bd hj fi z dy jx ea eb jy ed ef hh bi translated">jet-C/Java-视频下载器-util</h2><div class="jz l"><h3 class="bd b fi z dy jx ea eb jy ed ef dx translated">视频文件下载工具。适用于*。ts和*.mp4文件-Jet-C/Java-video-downloader-util</h3></div><div class="ka l"><p class="bd b fp z dy jx ea eb jy ed ef dx translated">github.com</p></div></div><div class="kb l"><div class="kc l kd ke kf kb kg io js"/></div></div></a></div></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="98b3" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated"><strong class="ak"> TS文件以及在哪里可以找到它们</strong></h1><p id="45ad" class="pw-post-body-paragraph iq ir hi is b it lm iv iw ix ln iz ja jb lo jd je jf lp jh ji jj lq jl jm jn hb bi translated">MPEG传输流(TS)是一种用于传输和存储音频和视频的格式化数据文件。大多数互联网流和数字广播都是通过TS完成的，因为它允许接收客户端在传输开始时读取数据。因为分数<strong class="is hj">，接收客户端不会被迫等待下载完整的数据文件。ts </strong>文件通过网络连续发送。</p><p id="4be1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">变速器由多个<strong class="is hj">组成。ts </strong>文件碎片。要拼接完整的视频，必须先下载各个片段，然后再进行组装。视频的<strong class="is hj">。ts </strong>文件碎片可以通过获取网络日志中注册的HTTP请求获得。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/20b2c2a490f128d7ed56facbd48c2969.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*alIZe5YoLQm7Q4vLtQ076g.png"/></div></div><figcaption class="lw lx et er es ly lz bd b be z dx">Using the network logs, we can observe the website’s multiple HTTP requests for .ts files</figcaption></figure><p id="3e16" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您的浏览器如何知道如何恰当地组合所请求的大量文件？这就是<strong class="is hj"> M3U8 </strong>文件发挥作用的地方。在<strong class="is hj">旁边。ts </strong>文件的HTTP请求，一个或多个对<strong class="is hj"> .m3u8 </strong>文件的请求应该出现在网络日志中。</p><h1 id="decb" class="ko kp hi bd kq kr ma kt ku kv mb kx ky kz mc lb lc ld md lf lg lh me lj lk ll bi translated">MP3 URL (M3U8)和Master M3U8文件是什么？</h1><p id="2c3b" class="pw-post-body-paragraph iq ir hi is b it lm iv iw ix ln iz ja jb lo jd je jf lp jh ji jj lq jl jm jn hb bi translated">M3U8 文件是简单的纯文本文件，包含<strong class="is hj">的元数据。ts </strong>文件片段或<strong class="is hj"> .m3u8 </strong>文件。元数据包括几个数据指令标签和文件位置的映射。文件位置表示为完整的相对路径URL或系统目录。</p><p id="8320" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">主M3U8文件特别列出了可用的<strong class="is hj"> .m3u8 </strong>文件变量的位置。这些变量代表不同的视频质量比特率，并映射<strong class="is hj">。ts </strong>与特定速率相关的片段。</p><p id="5d6e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">拥有不同的比特率使客户端能够像浏览器一样选择产生较少缓冲的速率。根据您的网络连接，浏览器可以主动从较低的比特率切换到较高的比特率，反之亦然。在大多数情况下，较高的速率会产生质量较好的视频。</p><p id="5dbd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="mf">注:</em> </strong> <strong class="is hj"> <em class="mf"> M3U8 </em> </strong> <em class="mf">为</em> <strong class="is hj"> <em class="mf"> M3U </em> </strong> <em class="mf">文件，明确说明UTF-8字符编码，但M3U文件可能使用其他字符编码标准。M3U文件中描述的数据可能涉及许多类型的多媒体，而不仅仅是视频。</em></p><p id="bdfd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下主M3U8文件示例列出了可用的<strong class="is hj"> .m3u8 </strong>文件变量的完整路径位置URL。不同的比特率可以通过<em class="mf">“带宽”</em>标签来识别。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/10cf631334decb4ea77a96489bf4fc6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TxqDzZBKXisAsfeR0N_rXg.png"/></div></div><figcaption class="lw lx et er es ly lz bd b be z dx">Master M3U8 files are distinguishable via their “EXT-X-STREAM-INF” directive tags</figcaption></figure><p id="8b92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在示例<strong class="is hj"> .m3u8 </strong>文件的变体下面，<strong class="is hj">。ts </strong>片段URL按照正确视频组装所需的顺序列出。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es mh"><img src="../Images/56642030a013d6aa227da5f93b97357e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*2siuQHwRMcxT6oAYAM3v9A.jpeg"/></div><figcaption class="lw lx et er es ly lz bd b be z dx">*.ts fragments are listed in the sequential order required for assembly</figcaption></figure><p id="31c9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击<a class="ae jo" href="https://developer.apple.com/documentation/http_live_streaming/example_playlists_for_http_live_streaming/creating_a_master_playlist" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">此处</strong> </a> <strong class="is hj"> </strong>和/或查看<a class="ae jo" href="https://en.wikipedia.org/wiki/M3U" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">此</strong> </a> wiki <strong class="is hj"> </strong>页面，访问主播放列表和M3U指令标签描述的深入文档。</p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="c151" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">视频下载工具</h1><p id="2903" class="pw-post-body-paragraph iq ir hi is b it lm iv iw ix ln iz ja jb lo jd je jf lp jh ji jj lq jl jm jn hb bi translated">让我们深入了解下载器实用程序是如何工作的。</p><p id="5e42" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用<a class="ae jo" href="https://www.ffmpeg.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> FFmpeg </strong> </a>命令行程序来汇编所有的<strong class="is hj">。ts </strong>文件碎片。在运行该实用程序之前，必须在您的计算机上安装该程序。</p><p id="7631" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了活捉<strong class="is hj">。ts </strong>文件片段我们将使用<a class="ae jo" href="https://www.selenium.dev/documentation/en/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Selenium </strong> </a>，一个浏览器自动化工具和网络实用程序<a class="ae jo" href="https://bmp.lightbody.net/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> BrowserMob代理</strong> </a> (BMP)。它们的依赖项包含在项目的pom.xml文件中。</p><figure class="ls lt lu lv fd ij"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="lw lx et er es ly lz bd b be z dx">Project “java-video-downloader-util” Maven dependencies</figcaption></figure><h2 id="ec88" class="mk kp hi bd kq ml mm mn ku mo mp mq ky jb mr ms lc jf mt mu lg jj mv mw lk mx bi translated">步伐</h2><ol class=""><li id="e1d0" class="my mz hi is b it lm ix ln jb na jf nb jj nc jn nd ne nf ng bi translated">使用Selenium的Chrome WebDriver，自动启动一个Chrome浏览器实例，并将其定向到托管TS视频的网站。</li><li id="fbc5" class="my mz hi is b it nh ix ni jb nj jf nk jj nl jn nd ne nf ng bi translated">BrowserMob代理拦截来自网站的所有网络请求，并将它们记录到HTTP归档(HAR)文件中。</li><li id="5151" class="my mz hi is b it nh ix ni jb nj jf nk jj nl jn nd ne nf ng bi translated">过滤HAR文件中的<strong class="is hj"> .m3u8 </strong>文件请求，并通过其“<em class="mf"> EXT-X-STREAM-INF </em>标签识别主m3u8文件。</li><li id="1252" class="my mz hi is b it nh ix ni jb nj jf nk jj nl jn nd ne nf ng bi translated">从主M3U8文件中，检索与最高比特率<strong class="is hj"> .m3u8 </strong>变量相关的URL。比特率通过“带宽”指示标签来表示。</li><li id="ff90" class="my mz hi is b it nh ix ni jb nj jf nk jj nl jn nd ne nf ng bi translated">下载每个单独的<strong class="is hj">。使用在<strong class="is hj"> .m3u8 </strong>文件变量中列出的URL的ts </strong>文件片段。片段的比特率将与变体的速率相匹配。</li><li id="182c" class="my mz hi is b it nh ix ni jb nj jf nk jj nl jn nd ne nf ng bi translated">一次全<strong class="is hj">。下载ts </strong>文件片段，准备它们作为命令行参数，并将它们传递给FFmpeg程序。</li><li id="8e02" class="my mz hi is b it nh ix ni jb nj jf nk jj nl jn nd ne nf ng bi translated">使用FFmpeg，连接所有<strong class="is hj">。ts </strong>片段成一个完整的视频。</li></ol><figure class="ls lt lu lv fd ij"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="lw lx et er es ly lz bd b be z dx">Requests are captured in a HAR file to facilitate filtering m3u8 files.</figcaption></figure><figure class="ls lt lu lv fd ij"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="lw lx et er es ly lz bd b be z dx">Concatenation of *.ts video files using FFmpeg command line</figcaption></figure></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h2 id="c7bb" class="mk kp hi bd kq ml mm mn ku mo mp mq ky jb mr ms lc jf mt mu lg jj mv mw lk mx bi translated">实用程序用法</h2><p id="50f0" class="pw-post-body-paragraph iq ir hi is b it lm iv iw ix ln iz ja jb lo jd je jf lp jh ji jj lq jl jm jn hb bi translated">您可以从<a class="ae jo" href="https://github.com/Jet-C/java-video-downloader-util" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Github </strong> </a>下载该实用程序项目。</p><figure class="ls lt lu lv fd ij"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="lw lx et er es ly lz bd b be z dx">README.md</figcaption></figure><p id="78a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">其他注意事项</strong></p><p id="6776" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每当视频托管网站涉及身份验证Cookies、JWT或其他必填字段时，浏览器Mob代理请求配置必须包括必要的标题参数。建议使用Selenium WebDriver来自动登录网站并检索任何所需的凭证。</p><p id="893d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果网站使用倾斜的相对路径来识别视频的资源文件，可能需要进行特定的修改来自动下载视频。</p></div></div>    
</body>
</html>