<html>
<head>
<title>Chaos Mesh Remake: One Step Closer toward Chaos as a Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">混沌网格翻拍:向混沌即服务更近一步</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/chaos-mesh-remake-one-step-closer-toward-chaos-as-a-service-791069f3f838?source=collection_archive---------46-----------------------#2021-08-18">https://medium.com/geekculture/chaos-mesh-remake-one-step-closer-toward-chaos-as-a-service-791069f3f838?source=collection_archive---------46-----------------------#2021-08-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b972a7f1462cd99913cdd6d44dcb8181.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*twJrmKoy6dodz0qM.jpg"/></div></div></figure><p id="78c8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">作者:</strong></p><ul class=""><li id="a06b" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">常宇(奇虎360工程师)</li><li id="9df7" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><a class="ae kc" href="https://github.com/WangXiangUSTC" rel="noopener ugc nofollow" target="_blank">王祥</a>(混沌网委员，平盖工程师)</li></ul><p id="db78" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Transcreator: </strong> <a class="ae kc" href="https://github.com/ran-huang" rel="noopener ugc nofollow" target="_blank">黄然</a>；编辑:汤姆·万德</p><p id="482a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae kc" href="https://chaos-mesh.org/" rel="noopener ugc nofollow" target="_blank"> Chaos Mesh </a>是一个云原生的混沌工程平台，在Kubernetes环境中编排混沌。使用Chaos Mesh，您可以在Kubernetes上通过将所有类型的故障注入到Pods、网络、文件系统甚至内核来测试您的系统的弹性和健壮性。</p><p id="d088" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由于它是开源的，并被云本地计算基金会(CNCF)作为沙盒项目接受，Chaos Mesh吸引了世界各地的贡献者，并帮助用户测试他们的系统。然而，它仍有很大的改进空间:</p><ul class=""><li id="9ea1" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">它需要提高可用性。有些功能使用起来很复杂。例如，当您应用一个混沌实验时，您经常需要手动检查实验是否已经开始。</li><li id="d534" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">它主要用于Kubernetes环境。因为Chaos Mesh不能管理多个Kubernetes集群，所以需要为每个Kubernetes集群部署Chaos Mesh。虽然<a class="ae kc" href="https://github.com/chaos-mesh/chaosd" rel="noopener ugc nofollow" target="_blank"> chaosd </a>支持在物理机器上运行chaos实验，但是其功能非常有限，而且命令行的使用也不方便。</li><li id="224e" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">它不允许插件。要应用定制的混沌实验，你必须修改源代码。而且混沌网格只支持Golang。</li></ul><p id="35b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">诚然，Chaos Mesh是一流的混沌工程平台，但距离提供混沌即服务(CaaS)还有很长的路要走。因此，在<a class="ae kc" href="https://pingcap.com/community/events/hackathon2020/" rel="noopener ugc nofollow" target="_blank"> TiDB Hackathon 2020 </a>，<strong class="is hj">上，我们对Chaos Mesh的架构进行了修改，使其向CaaS </strong>更近了一步。</p><p id="c94a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我将谈论CaaS是什么，我们如何用混沌网格实现它，以及我们的计划和经验教训。我希望我们的经验对你建立自己的混沌工程系统有所帮助。</p><h1 id="180f" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">什么是混沌即服务？</h1><p id="2321" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">正如Gremlin的联合创始人Matt Fornaciari所说的那样，CaaS“意味着你将在几分钟内获得直观的用户界面、客户支持、开箱即用的集成和你需要的一切。”</p><p id="49b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从我们的角度来看，CaaS应该提供:</p><ul class=""><li id="0a01" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">用于管理的统一控制台，您可以在其中编辑配置和创建混沌实验。</li><li id="01c7" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">可视化指标，让您看到实验状态。</li><li id="63f4" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">暂停或存档实验的操作。</li><li id="d748" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">简单的互动。您可以轻松地拖放对象来协调您的实验。</li></ul><p id="2052" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一些公司已经采用混沌网格来满足自己的需求，如<a class="ae kc" href="https://pingcap.com/blog/how-a-top-game-company-uses-chaos-engineering-to-improve-testing" rel="noopener ugc nofollow" target="_blank">网易伏羲人工智能实验室</a>和FreeWheel，使其成为CaaS的模型。</p><h1 id="c5a2" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">向CaaS发展混沌网格</h1><p id="99cb" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">基于我们对CaaS的理解，我们在Hackathon期间改进了Chaos Mesh的架构，包括改进了对不同系统的支持和更好的可观察性。你可以在<a class="ae kc" href="https://github.com/wuntun/chaos-mesh/tree/caas" rel="noopener ugc nofollow" target="_blank"> wuntun/chaos-mesh </a>和<a class="ae kc" href="https://github.com/wuntun/chaosd/tree/caas" rel="noopener ugc nofollow" target="_blank"> wuntun/chaosd </a>中查看我们的代码。</p><h2 id="5b00" class="lg ke hi bd kf lh li lj kj lk ll lm kn jb ln lo kr jf lp lq kv jj lr ls kz lt bi translated">重构混沌仪表板</h2><p id="4906" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">当前的混沌网状结构适合于单个的Kubernetes集群。Chaos Dashboard，web UI，被绑定到一个特定的Kubernetes环境:</p><figure class="lv lw lx ly fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/bc7017cdd430a71b2c98a51eda3660da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HCazE5epCcMmubGc.jpg"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">The current Chaos Mesh architecture</figcaption></figure><p id="a56a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个重构过程中，为了允许Chaos Dashboard管理多个Kubernetes集群，我们将Chaos Dashboard从主架构中分离出来。现在，如果您在Kubernetes集群之外部署Chaos Dashboard，您可以通过web UI将集群添加到Chaos Dashboard。如果在集群内部部署Chaos Dashboard，它会通过环境变量自动获取集群信息。</p><p id="12d1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以在Chaos Dashboard中注册Chaos Mesh(技术上来说是Kubernetes配置)或者让<code class="du md me mf mg b">chaos-controller-manager</code>通过配置向Chaos Dashboard报告。Chaos Dashboard和<code class="du md me mf mg b">chaos-controller-manager</code>通过CustomResourceDefinitions (CRDs)进行交互。当<code class="du md me mf mg b">chaos-controller-manager</code>发现一个混沌网状CRD事件时，它调用<code class="du md me mf mg b">chaos-daemon</code>进行相关的混沌实验。因此，Chaos Dashboard可以通过在CRD上操作来管理实验。</p><h2 id="1f09" class="lg ke hi bd kf lh li lj kj lk ll lm kn jb ln lo kr jf lp lq kv jj lr ls kz lt bi translated">重构混沌d</h2><p id="92a5" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">chaosd是一个在物理机器上运行混沌实验的工具包。以前，它只是一个命令行工具，功能有限。</p><figure class="lv lw lx ly fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/348f476cfe7ca5e542c1f4c7523b887b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YA-WnDw_XcvHNyiI.jpg"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">Previously, chaosd was a command line tool</figcaption></figure><p id="0bd3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在重构过程中，<strong class="is hj">我们让chaosd支持RESTful API并增强了它的服务，这样它就可以通过解析CRD格式的JSON或YAML文件来配置混沌实验。</strong></p><p id="900f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，chaosd可以通过配置将自己注册到Chaos Dashboard，并向Chaos Dashboard发送定期心跳。通过心跳信号，Chaos Dashboard可以管理chaosd节点状态。您还可以通过web UI向Chaos Dashboard添加chaosd节点。</p><p id="0093" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，<strong class="is hj"> chaosd现在可以在指定时间安排混沌实验并管理实验生命周期，这统一了Kubernetes和物理机上的用户体验。</strong></p><p id="4caf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">借助新的Chaos Dashboard和chaosd，Chaos Mesh的优化架构如下:</p><figure class="lv lw lx ly fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/cad4494696e7aa294af8c4a78388b13c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oSjJRiJFL8rF-yVS.jpg"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">Chaos Mesh’s optimized architecture</figcaption></figure><h2 id="8561" class="lg ke hi bd kf lh li lj kj lk ll lm kn jb ln lo kr jf lp lq kv jj lr ls kz lt bi translated">提高可观察性</h2><p id="3fac" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">另一个改进是可观察性，即如何判断实验是否成功进行。</p><p id="9cd2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在改进之前，您必须手动检查实验指标。如果您将<a class="ae kc" href="https://chaos-mesh.org/docs/simulate-heavy-stress-on-kubernetes/" rel="noopener ugc nofollow" target="_blank"> StressChaos </a>注入到Pod中，您必须进入Pod来查看是否有<code class="du md me mf mg b">stress-ng</code>进程，然后使用<code class="du md me mf mg b">top</code>命令来检查CPU和内存利用率。这些指标告诉你你的StressChaos实验是否成功创建。</p><p id="722f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了简化流程，我们现在将<code class="du md me mf mg b">node_exporter</code>集成到<code class="du md me mf mg b">chaos-daemon</code>和chaosd中来收集节点指标。我们还在Kubernetes集群中部署了<code class="du md me mf mg b">kube-state-metrics</code>,结合cadvisor来收集Kubernetes指标。收集的指标由Prometheus和Grafana保存和可视化，这为您检查实验状态提供了一种简单的方法。</p><p id="7272" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">需要进一步改进</strong></p><p id="baad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">总体而言，指标旨在帮助您:</p><ul class=""><li id="1e20" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">确认混沌注入。</li><li id="c330" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">观察混沌对服务的影响，并进行定期分析。</li><li id="6f3d" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">应对异常混乱事件。</li></ul><p id="5c9e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了实现这些目标，系统需要监控实验数据指标、普通指标和实验事件。混沌网格仍需改进:</p><ul class=""><li id="6014" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">实验数据指标，例如注入网络延迟的确切延迟持续时间和模拟工作负载的特定负载。</li><li id="4fb6" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">实验事件；即创建、删除和运行实验的Kubernetes事件。</li></ul><p id="f9d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是一个来自<a class="ae kc" href="https://github.com/litmuschaos/chaos-exporter#example-metrics" rel="noopener ugc nofollow" target="_blank">石蕊</a>的度量标准的好例子。</p><h1 id="9bfc" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">混沌网格的其他提议</h1><p id="c1ec" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">由于黑客马拉松的时间有限，我们没有完成所有的计划。以下是我们的一些建议，供混沌网格社区在未来考虑。</p><h2 id="d65b" class="lg ke hi bd kf lh li lj kj lk ll lm kn jb ln lo kr jf lp lq kv jj lr ls kz lt bi translated">管弦乐编曲</h2><p id="9c49" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">一个混沌工程的闭环包括四个步骤:探索混沌，发现系统中的不足，分析根本原因，发送反馈以进行改进。</p><figure class="lv lw lx ly fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/a2593c0e1814cd22da16a1972c3ca568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4XnrxnL1likwefyh.jpg"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">A closed loop of Chaos Engineering</figcaption></figure><p id="1d5a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而<strong class="is hj">目前大多数开源混沌工程工具只注重探索，不提供务实的反馈</strong>。基于改进的可观测性组件，我们可以实时监控混沌实验，并对实验结果进行比较和分析。</p><p id="8c56" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有了这些结果，我们将能够通过添加另一个重要的组件:编排来实现一个闭环。Chaos Mesh社区已经提出了一个<a class="ae kc" href="https://github.com/chaos-mesh/rfcs/pull/10/files" rel="noopener ugc nofollow" target="_blank">工作流</a>特性，它使你能够轻松地编排和调用Chaos实验，或者方便地将Chaos Mesh与其他系统集成。你可以在CI/CD阶段或者canary发布之后运行混沌实验。</p><p id="c426" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">将可观察性和编排结合起来，为混沌工程创造了一个闭环反馈回路</strong>。如果您要在Pod上启动100毫秒的网络延迟测试，您可以使用observability组件来观察延迟变化，并使用PromQL或其他基于编排的DSL来检查Pod服务是否仍然可用。如果服务不可用，当延迟时间为&gt; = 100毫秒时，您可以得出服务不可用的结论。</p><p id="6335" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是100 ms不是你服务的门槛；您需要知道您的服务可以处理的最大延迟是多少。通过编排混沌实验的值，您将知道要满足服务级别目标，您必须确保的阈值是多少。此外，您将了解不同网络条件下的服务性能，以及它们是否符合您的预期。</p><h2 id="b330" class="lg ke hi bd kf lh li lj kj lk ll lm kn jb ln lo kr jf lp lq kv jj lr ls kz lt bi translated">数据格式</h2><p id="3f2d" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">混沌网格使用CRDs来定义它的混沌对象。如果能把CRDs转换成JSON文件，就能实现组件之间的通信。</p><p id="2295" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在数据格式方面，chaosd只是以JSON格式消费和注册CRD数据。如果一个混沌工具可以消耗CRD数据并注册自己，它就可以在不同的场景下运行混沌实验。</p><h2 id="bf4d" class="lg ke hi bd kf lh li lj kj lk ll lm kn jb ln lo kr jf lp lq kv jj lr ls kz lt bi translated">插件</h2><p id="dd95" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">混沌网格对插件的支持有限。你只能通过在Kubernetes API中注册一个CRD<a class="ae kc" href="https://chaos-mesh.org/docs/add-new-chaos-experiment-type/" rel="noopener ugc nofollow" target="_blank">来添加一个新的混乱</a>。这带来了两个问题:</p><ul class=""><li id="1f79" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">你必须使用Golang开发插件，这是编写混沌网格的同一种语言。</li><li id="60c1" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">您必须将扩展代码合并到混沌网格项目中。因为Chaos Mesh没有像BPF(Berkeley Packet Filter)那样的安全机制，合并插件代码可能会带来额外的风险。</li></ul><p id="0d63" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了实现完整的插件支持，我们需要探索一种新的方法来添加插件。由于混沌网格本质上是基于CRD进行混沌实验的，所以混沌实验只需要生成、监听和删除CRD。在这方面，我们有几个想法值得尝试:</p><ul class=""><li id="5d01" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">开发一个控制器或操作员来管理CRDs。</li><li id="990f" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">统一处理CRD事件，并通过HTTP回调对CRD进行操作。这个方法只使用HTTP APIs，对Golang没有要求。例如，参见<a class="ae kc" href="https://github.com/summerwind/whitebox-controller" rel="noopener ugc nofollow" target="_blank">白盒控制器</a>。</li><li id="51b8" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">使用WebAssembly (Wasm)。当需要调用混沌实验逻辑时，只需调用Wasm程序即可。参见矢量的<a class="ae kc" href="https://vector.dev/docs/reference/transforms/wasm/" rel="noopener ugc nofollow" target="_blank"> WASM变换</a>。</li><li id="87b5" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">使用SQL查询混沌实验状态。因为Chaos Mesh是基于CRDs的，所以可以用SQL在Kubernetes上操作。例子包括<a class="ae kc" href="https://github.com/xuxinkun/kubesql" rel="noopener ugc nofollow" target="_blank"> Presto连接器</a>和<a class="ae kc" href="https://github.com/aquasecurity/kube-query" rel="noopener ugc nofollow" target="_blank"> osquery扩展</a>。</li><li id="52c4" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">使用基于SDK的扩展，比如<a class="ae kc" href="https://docs.chaostoolkit.org/reference/api/experiment/" rel="noopener ugc nofollow" target="_blank"> Chaos Toolkit </a>。</li></ul><h2 id="d051" class="lg ke hi bd kf lh li lj kj lk ll lm kn jb ln lo kr jf lp lq kv jj lr ls kz lt bi translated">与其他混沌工具的集成</h2><p id="92be" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">对于现实世界的系统，单一的混沌工程工具很难穷尽所有可能的用例。这就是为什么与其他混沌工具集成可以使混沌工程生态系统更加强大。</p><p id="0ac9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">市场上有许多混沌工程工具。Litmus的<a class="ae kc" href="https://github.com/litmuschaos/litmus-go/tree/master/chaoslib/powerfulseal" rel="noopener ugc nofollow" target="_blank"> Kubernetes实现</a>基于<a class="ae kc" href="https://github.com/powerfulseal/powerfulseal" rel="noopener ugc nofollow" target="_blank"> PowerfulSeal </a>，而其<a class="ae kc" href="https://github.com/litmuschaos/litmus-go/tree/master/chaoslib/pumba" rel="noopener ugc nofollow" target="_blank">容器实现</a>基于<a class="ae kc" href="https://github.com/alexei-led/pumba" rel="noopener ugc nofollow" target="_blank"> Pumba </a>。<a class="ae kc" href="https://github.com/cloud-bulldozer/kraken" rel="noopener ugc nofollow" target="_blank">北海巨妖</a>专注Kubernetes，<a class="ae kc" href="https://github.com/amzn/awsssmchaosrunner" rel="noopener ugc nofollow" target="_blank"> AWSSSMChaosRunner </a>专注AWS，<a class="ae kc" href="https://github.com/shopify/toxiproxy" rel="noopener ugc nofollow" target="_blank"> Toxiproxy </a>针对TCP。也有基于<a class="ae kc" href="https://docs.google.com/presentation/d/1gMlmXqH6ufnb8eNO10WqVjqrPRGAO5-1S1zjcGo1Zr4/edit#slide=id.g58453c664c_2_75" rel="noopener ugc nofollow" target="_blank">特使</a>和Istio的合并项目。</p><p id="918a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了管理各种各样的混乱工具，我们可能需要一个统一的模式，比如<a class="ae kc" href="https://hub.litmuschaos.io/" rel="noopener ugc nofollow" target="_blank">混乱中心</a>。</p><h1 id="bf7e" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">来自社区的声音</h1><p id="e5aa" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">在这里，我们想分享中国一家领先的网络安全公司以及混沌网格用户如何调整混沌网格以满足他们的需求。它们的适应有三个方面:物理节点、容器和应用程序。</p><h2 id="4bca" class="lg ke hi bd kf lh li lj kj lk ll lm kn jb ln lo kr jf lp lq kv jj lr ls kz lt bi translated">物理节点</h2><ul class=""><li id="eb6c" class="jo jp hi is b it lb ix lc jb mk jf ml jj mm jn jt ju jv jw bi translated">支持在物理服务器上执行脚本。您可以在CRDs中配置脚本目录，并使用<code class="du md me mf mg b">chaos-daemon</code>运行您的脚本。</li><li id="e26e" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">使用自定义脚本模拟重启、关机和内核崩溃。</li><li id="edc1" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">使用自定义脚本关闭节点的网卡。</li><li id="13b1" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">使用sysbench创建频繁的上下文切换，以模拟“噪音邻居”效应。</li><li id="3271" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">使用BPF的<code class="du md me mf mg b">seccomp</code>拦截容器的系统调用。这是通过传递和过滤PID实现的。</li></ul><h2 id="40d7" class="lg ke hi bd kf lh li lj kj lk ll lm kn jb ln lo kr jf lp lq kv jj lr ls kz lt bi translated">容器</h2><ul class=""><li id="6630" class="jo jp hi is b it lb ix lc jb mk jf ml jj mm jn jt ju jv jw bi translated">随机更改部署副本的数量，以测试应用程序的流量是否异常。</li><li id="a6c6" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">基于CRD对象的嵌入:在混沌CRDs中填充入口对象以模拟接口的速度限制。</li><li id="2264" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">基于CRD对象的嵌入:在混沌CRD中填充纤毛网络策略对象以模拟波动的网络条件。</li></ul><h2 id="20b2" class="lg ke hi bd kf lh li lj kj lk ll lm kn jb ln lo kr jf lp lq kv jj lr ls kz lt bi translated">应用</h2><ul class=""><li id="9efc" class="jo jp hi is b it lb ix lc jb mk jf ml jj mm jn jt ju jv jw bi translated">支持运行自定义作业。目前，混沌网格使用<code class="du md me mf mg b">chaos-daemon</code>注入混沌，不能保证调度的公平性和亲和性。为了解决这个问题，我们可以使用<code class="du md me mf mg b">chaos-controller-manager</code>直接为不同的CRD创建工作。</li><li id="2a44" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">支持在自定义作业中运行<a class="ae kc" href="https://github.com/postmanlabs/newman" rel="noopener ugc nofollow" target="_blank">纽曼</a>随机更改HTTP参数。这是为了在HTTP接口上实现混沌实验，当用户执行异常行为时会发生这种情况。</li></ul><h1 id="ef0b" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">摘要</h1><p id="2ee7" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">传统的故障测试针对系统中预期易受攻击的特定点。往往是一个断言:特定的条件产生特定的结果。</p><p id="cfd2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">混沌工程更强大，因为它帮助你发现“未知的未知”通过在更广阔的领域探索，混沌工程加深了你对被测系统的了解，并挖掘出新的信息。</p><p id="1dce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">综上，以上是我们个人对混沌工程和混沌网格的一些思考和实践。我们的Hackathon项目还没有为生产做好准备，但我们希望对CaaS有所启发，并为Chaos Mesh起草一份有前途的路线图。如果你对构建混沌服务感兴趣，加入我们的Slack  (#project-chaos-mesh)！</p></div><div class="ab cl mn mo gp mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="hb hc hd he hf"><p id="e260" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mu">原载于2021年6月24日</em><a class="ae kc" href="https://pingcap.com/blog/chaos-mesh-remake-one-step-closer-toward-chaos-as-a-service" rel="noopener ugc nofollow" target="_blank"><em class="mu">www.pingcap.com</em></a><em class="mu"/></p></div></div>    
</body>
</html>