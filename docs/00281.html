<html>
<head>
<title>MongoDB Multi-tenant/tenancy with Spring Boot Spring MVC implementation.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Spring Boot Spring MVC实现的MongoDB多租户/租用。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/full-featured-multi-tenant-tenancy-with-spring-boot-mongodb-spring-mvc-f00c98a9df70?source=collection_archive---------0-----------------------#2021-01-03">https://medium.com/geekculture/full-featured-multi-tenant-tenancy-with-spring-boot-mongodb-spring-mvc-f00c98a9df70?source=collection_archive---------0-----------------------#2021-01-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/1bd1c8b9b916ea5a7347311214a35e88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*11vtZTviBPlwIhdripB4CQ.png"/></div></div></figure><h2 id="809e" class="hr hs ht bd b fp hu hv hw hx hy hz dx ia translated" aria-label="kicker paragraph">MongoDB多租户。</h2><div class=""/><div class=""><h2 id="6b35" class="pw-subtitle-paragraph iz ic ht bd b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq dx translated">MongoDB和Spring Boot，Spring MVC多租户数据库和在www.github.com的实现。</h2></div><blockquote class="jr js jt"><p id="3001" class="ju jv jw jx b jy jz jd ka kb kc jg kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated"><a class="ae kr" href="https://github.com/arun2pratap/multitenant-spring-mongodb" rel="noopener ugc nofollow" target="_blank">https://github.com/arun2pratap/multitenant-spring-mongodb</a></p></blockquote><h2 id="00fd" class="ks kt ht bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo hz bi translated">为什么是多租户数据库？</h2><p id="57b4" class="pw-post-body-paragraph ju jv ht jx b jy lp jd ka kb lq jg kd ld lr kg kh lh ls kk kl ll lt ko kp kq hb bi translated">我们对多租户数据库进行的推理很少。</p><ul class=""><li id="4e3b" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated">嘈杂的邻居—如果数据的性质存在明显的分离(在这种情况下，您不会将两种数据聚合/操作在一起),例如火星(公民)、地球(公民),那么即使是公民数据收集也会将其保存在自己的数据库中。</li></ul><blockquote class="jr js jt"><p id="70a7" class="ju jv jw jx b jy jz jd ka kb kc jg kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">是的，使用<strong class="jx id">分片</strong>的水平扩展是一个选项，但这也带来了自身的复杂性/查询/维护/迁移/备份/事务…开销。如果可能的话，避免使用，尽管在某些时候你可能不得不分片，但是范围会缩小。</p></blockquote><ul class=""><li id="2c93" class="lu lv ht jx b jy jz kb kc ld lw lh lx ll ly kq lz ma mb mc bi translated">维护—备份/恢复/查询/调试/分析将使用更小的数据集。</li><li id="ecbd" class="lu lv ht jx b jy md kb me ld mf lh mg ll mh kq lz ma mb mc bi translated">迁移—我们可以轻松地分离出一个客户端数据库，并拥有自己的部署。</li><li id="3fda" class="lu lv ht jx b jy md kb me ld mf lh mg ll mh kq lz ma mb mc bi translated">灵活性—我们可以根据每个数据库的性质来决定它们的行为，例如，客户端-地球[db-100 TB]，客户端-火星[db-1mb]将只共享数据库“地球”而不是“火星”。</li></ul><h2 id="10a2" class="ks kt ht bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo hz bi translated">应用设计:</h2><p id="4f24" class="pw-post-body-paragraph ju jv ht jx b jy lp jd ka kb lq jg kd ld lr kg kh lh ls kk kl ll lt ko kp kq hb bi translated">对于所有执行的API请求/操作，我们需要拦截“执行线程”,在该线程上执行操作之前设置租户数据库。</p><figure class="mj mk ml mm fd hk er es paragraph-image"><div class="er es mi"><img src="../Images/801a3643e020baebac5a3ad24d777312.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*HGjmgl-peeDh3uhjq0pFTg.png"/></div></figure><h2 id="66f6" class="ks kt ht bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo hz bi translated"><a class="ae kr" href="https://github.com/arun2pratap/spring-cloud-training-config" rel="noopener ugc nofollow" target="_blank">实现</a>:</h2><p id="9531" class="pw-post-body-paragraph ju jv ht jx b jy lp jd ka kb lq jg kd ld lr kg kh lh ls kk kl ll lt ko kp kq hb bi translated">同一集群上的多租户数据库。</p><p id="742e" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">试图模拟一个API请求是如何处理的。[单线程执行] <br/>显示流/类/配置/bean的图表，带有必要的描述。参考github上的签入代码。</p><blockquote class="jr js jt"><p id="40b3" class="ju jv jw jx b jy jz jd ka kb kc jg kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated"><a class="ae kr" href="https://github.com/arun2pratap/multitenant-spring-mongodb" rel="noopener ugc nofollow" target="_blank"><strong class="jx id">https://github.com/arun2pratap/spring-cloud-training-config</strong></a></p></blockquote><figure class="mj mk ml mm fd hk er es paragraph-image"><div class="er es mn"><img src="../Images/930c9145e970b9d8a1e8bceabfc34195.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*wddLL3d_Zt9iSUWL3i6liQ.png"/></div></figure><p id="153c" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">示例:-(创建名为“shared”的db和db . planet . insert({ _ id:“mars”})；)<br/>帖子:<a class="ae kr" href="http://localhost:8080/api/earth/save" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/API/mars/save</a><br/>请求正文:{ "name":"NEO"}</p><figure class="mj mk ml mm fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mo"><img src="../Images/dad87034c86dd66bbdcdc9ffd3de35d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s24MZoc4tyJg9i7JloB1iQ.jpeg"/></div></div></figure><p id="7e58" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">将在各自的租户数据库上执行操作。</p><p id="0b09" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">注意:这个例子由单个集群上的多租户组成，如果多租户使用不同的集群，那么我们还需要在运行时更改mongoClient()。</p></div><div class="ab cl mp mq gp mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="hb hc hd he hf"><p id="8cc5" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">希望这对希望实现多租户数据库的人有所帮助，如果您发现缺少什么或希望我添加什么，请发表评论。</p><p id="0f6a" class="pw-post-body-paragraph ju jv ht jx b jy jz jd ka kb kc jg kd ld kf kg kh lh kj kk kl ll kn ko kp kq hb bi translated">编码愉快，谢谢:)</p></div></div>    
</body>
</html>