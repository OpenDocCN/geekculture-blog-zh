<html>
<head>
<title>Working with Vue and Apollo GraphQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Vue和Apollo GraphQL</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/working-with-vue-and-apollo-graphql-ae32cbec81af?source=collection_archive---------25-----------------------#2021-07-04">https://medium.com/geekculture/working-with-vue-and-apollo-graphql-ae32cbec81af?source=collection_archive---------25-----------------------#2021-07-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/50f10d48945132e42d91afde17eada94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pkFjP8tmQRvlcyOd.jpg"/></div></div></figure><h1 id="2b06" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是GraphQL</h1><p id="49aa" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">GraphQL是传统RESTFul API获取数据的替代方法。许多公司开始将它作为他们技术堆栈的一部分，这已经成为行业趋势，包括<a class="ae km" href="https://www.article.com/" rel="noopener ugc nofollow" target="_blank">文章</a>。它提供的好处包括指定您想要获取的响应，代码是文档，并允许您轻松地连接不同的服务来为前端提供数据。你可以从我的文章<a class="ae km" href="https://sdust.dev/content-posts-2020-07-19-moving-to-graph-ql/" rel="noopener ugc nofollow" target="_blank">迁移到GraphQL </a>中了解更多关于它和我们迁移到GraphQL的计划。</p><h1 id="1213" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">Vue和Apollo GraphQL</h1><p id="a3e1" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">为了与GraphQL后端对话，通常我们会使用一个专门用来做这些事情的GraphQL客户端。将查询手写到POST或GET请求中并不是开发人员乐意做的事情，所以这些客户端可以让这变得更容易。有很多可用的客户端，我选择使用<a class="ae km" href="https://www.apollographql.com/" rel="noopener ugc nofollow" target="_blank"> Apollo </a>来为它的生态系统和社区服务。</p><p id="57f2" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">为了这篇博文的目的，我假设GraphQL查询看起来像这样:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="6381" class="lb ir hi kx b fi lc ld l le lf">query Product($id: ID!) {<br/>  product(id: $id) {<br/>    title<br/>    skuNo<br/>    price<br/>  }<br/>}</span></pre><p id="d780" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">Vue 3的最终稳定版本即将发布，因此将在Vue 3中使用的代码示例。然而，如果您已经在Vue 2中使用了Composition API，那么语法基本上是相同的。本文也不包括使用流行的库<a class="ae km" href="https://github.com/vuejs/vue-apollo" rel="noopener ugc nofollow" target="_blank"> vue-apollo </a>或@vue/apollo-composable，因为它们还没有正式使用Vue 3。因此，我将直接使用Apollo客户端，这实际上是我们团队在文章中的做法。我个人喜欢这种方法，因为它可以更好地理解底层模块的工作方式，并且当我们引入新的层时，我们可以更好地理解哪个模块负责什么。</p><h1 id="2a91" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">给我看看代码</h1><p id="3660" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">让我们首先通过运行以下命令来安装Apollo客户端模块:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="c80a" class="lb ir hi kx b fi lc ld l le lf"># if you are using yarn<br/>yarn add @apollo/client<br/><br/>#if you are using npm<br/>npm install @apollo/client</span></pre><p id="e61e" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">我首先创建一个JavaScript文件，它负责创建一个Apollo客户机。每当您需要在组件中发送一个GraphQL查询时，您将使用这个<code class="du lg lh li kx b">createApolloClient</code>方法来获取一个Apollo客户机实例。如果您继续创建一个新的Apollo客户机实例，您将丢失以前积累的查询缓存。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="5c8d" class="lb ir hi kx b fi lc ld l le lf">import { ApolloClient, HttpLink } from '@apollo/client/core';<br/>import { InMemoryCache } from '@apollo/client/cache';<br/><br/>let apolloClient = null;<br/><br/>export function createApolloClient() {<br/>  if (apolloClient) {<br/>    return apolloClient;<br/>  }<br/><br/>  return apolloClient = new ApolloClient({<br/>    link: new HttpLink({<br/>      uri: "http://localhost:4001/graphql",<br/>    }),<br/>    cache: new InMemoryCache(),<br/>  });<br/>}</span></pre><p id="f9ae" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated"><code class="du lg lh li kx b">link</code>属性基本上告诉Apollo客户机应该将查询或变化发送到哪里。通过利用<code class="du lg lh li kx b">setContext</code>方法，您还可以将定制头作为查询的一部分，比如授权令牌。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="dd09" class="lb ir hi kx b fi lc ld l le lf">import { ref } from "vue";<br/>import { createApolloClient } from '../apollo.js';<br/>import { gql } from '@apollo/client/core';<br/><br/>export default {<br/>  name: "PageQuery",<br/>  setup() {<br/>    const apolloClient = createApolloClient();<br/>    const result = ref(null);<br/><br/>    async function query() {<br/>      try {<br/>        const queryResult = await apolloClient.query({<br/>          query: gql`<br/>            query product($productId: ID!) {<br/>              product(id: $productId) {<br/>                title<br/>                skuNo<br/>              }<br/>            }<br/>          `,<br/>          variables: {<br/>            productId: 123,<br/>          }<br/>        });<br/><br/>        result.value = queryResult.data;<br/>      } catch(error) {<br/>        console.error(error);<br/>      }<br/>    }<br/><br/>    return {<br/>      result,<br/>      query,<br/>    };<br/>  }<br/>}<br/>&lt;/script&gt;</span></pre><p id="6931" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">Composition API是Vue中当前选项API的一个替代，旨在将您的逻辑与您的UI分离，并让我们以更具功能性的方式编写代码。我的<a class="ae km" href="https://sdust.dev/content-posts-2019-12-02-vue-3-and-composition-api/" rel="noopener ugc nofollow" target="_blank">多伦多Vue会议之旅</a>应该会帮助你了解更多。我在这里使用的<code class="du lg lh li kx b">ref</code>是Composition API的一部分，基本上使它具有反应性。<code class="du lg lh li kx b">gql</code>允许我们像在操场上一样编写GraphQL查询。我们引入了<code class="du lg lh li kx b">createApolloClient</code>方法来创建一个客户端实例，并基本上实现了模板可以使用的查询功能。在这种情况下，我设置在点击事件时发送查询:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="ed97" class="lb ir hi kx b fi lc ld l le lf">&lt;template&gt;<br/>  &lt;div class="page-query"&gt;<br/>    &lt;button @click="query"&gt;Send Query&lt;/button&gt;<br/>    &lt;div&gt;{{ result }}&lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="ac2d" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">响应返回并保存到<code class="du lg lh li kx b">result</code>变量，Vue更新模板。</p><h1 id="ede0" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">笔记</h1><p id="0cba" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">当我们创建Apollo客户机时，我们给了它一个InMemoryCache实例，这意味着默认情况下，它将开始缓存所有以前请求的响应，因此如果UI请求相同的查询，它不需要发送另一个网络请求并给你即时反馈。然而，如果你每次都需要刷新响应，那么你可以传递一个值给<code class="du lg lh li kx b">fetch-policy</code>。你可以在<a class="ae km" href="https://www.apollographql.com/docs/react/api/core/ApolloClient/" rel="noopener ugc nofollow" target="_blank">阿波罗文档</a>中读到更多关于其他可接受值的信息。请注意，官方的Apollo客户端使用React方式做事情，但在本文中我使用的是底层的Apollo客户端。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="d373" class="lb ir hi kx b fi lc ld l le lf">await apolloClient.query({<br/>  query: gql`<br/>    query product($productId: ID!) {<br/>      product(id: $productId) {<br/>        title<br/>        skuNo<br/>      }<br/>    }<br/>  `,<br/>  variables: {<br/>    productId: 123,<br/>  },<br/>  fetchPolicy: 'network-only'<br/>});</span></pre><p id="95d0" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">如果你觉得有用，请分享给其他人，让他们知道如何将GraphQL整合到他们的Vue应用中。</p></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><p id="7052" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated"><em class="lq">原发布于</em><a class="ae km" href="https://sdust.dev/content-posts-2020-09-11-working-with-vue-and-apollo-graph-ql/" rel="noopener ugc nofollow" target="_blank"><em class="lq">https://sdust . dev</em></a><em class="lq">。</em></p></div></div>    
</body>
</html>