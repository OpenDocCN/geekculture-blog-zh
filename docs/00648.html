<html>
<head>
<title>Scraping A Dynamic Website, Selenium Part-III</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">刮一个动态网站，硒第三部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/scraping-a-dynamic-website-selenium-part-iii-7138d2a3131?source=collection_archive---------30-----------------------#2021-03-08">https://medium.com/geekculture/scraping-a-dynamic-website-selenium-part-iii-7138d2a3131?source=collection_archive---------30-----------------------#2021-03-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7038" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我在<a class="ae jd" rel="noopener" href="/swlh/scraping-a-dynamic-web-page-its-selenium-da161999c975">第一部分</a>和<a class="ae jd" rel="noopener" href="/swlh/scraping-a-dynamic-web-page-its-selenium-da161999c975">第二部分</a>中提到了两种从doordash.com抓取菜单的方法。这是第三部分，也是另一种抓取网页的方法。</p><h1 id="19ad" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak">第三次进场</strong></h1><p id="e0fc" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在这种方法中，我没有使用BeautifulSoup和Pandas库。这个脚本从任意位置的商店中抓取菜单，并将数据保存为JSON文件。JSON文件包含“Menu”的主标题，一些带有“食品商店”名称的子标题，以及每个商店中“食品类别”的内部节点。然后，每个类别包含作为“键”的产品名称，以及作为“值”的价格。以下是输出:</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/3a0cd088c07fa9871571fd461911e61f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*16qgm1Kw_COmLVqy2mQGXA.jpeg"/></div></div></figure><blockquote class="kt"><p id="2598" class="ku kv hi bd kw kx ky kz la lb lc jc dx translated">现在，让我们看看代码。</p></blockquote><pre class="ld le lf lg lh li lj lk ll aw lm bi"><span id="613e" class="ln jf hi lj b fi lo lp l lq lr"># importing libraries<br/>import ctypes<br/>import json<br/>import sys<br/>import time<br/>from typing import List<br/>import selenium.webdriver<br/>from selenium.webdriver import ActionChains<br/>from selenium.webdriver.common.keys import Keys<br/>from selenium.webdriver.remote.webelement import WebElement<br/>from selenium.webdriver.support.wait import WebDriverWait<br/>from selenium_move_cursor.MouseActions import move_to_element_chrome</span></pre><p id="4b5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1-导入必要的库</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="4da0" class="ln jf hi lj b fi lo lp l lq lr"># The URL<br/><br/>url = <strong class="lj hj">'https://www.doordash.com/en-US'<br/><br/></strong># # this will open the "doordash.com"<br/>    # defining driver and adding the “ — headless” argument<br/>    # opts = Options()<br/>    # opts.add_argument('— headless')<br/>driver = selenium.webdriver.Chrome (<strong class="lj hj">'chromedriver'</strong>)<br/>    # open the URL<br/>driver.maximize_window()<br/>driver.get(url)<br/>driver.implicitly_wait(220)<br/><br/>time.sleep(5)<br/>    # to focus the current window<br/>driver.switch_to.window(driver.window_handles[0])<br/><br/>time.sleep(10)</span></pre><p id="25aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2-定义并打开URL</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="099e" class="ln jf hi lj b fi lo lp l lq lr"># enter location and search<br/><br/>    # Default Search string for location<br/>search_query: str = <strong class="lj hj">"New York"<br/><br/>    </strong># (Manual Search String, sys.argv will interact with the terminal, 2nd argument will is<br/>    # the search string of location<br/>if len(sys.argv) &gt;= 2:<br/>    search_query = sys.argv[1]<br/>    print(search_query)<br/><br/>    # send location to search element<br/>driver.find_element_by_css_selector(<strong class="lj hj">"input[class='sc-OqFzE kdYTND']"</strong>).send_keys(search_query)<br/>time.sleep(3)<br/>    # click on search button<br/>driver.find_element_by_css_selector(<strong class="lj hj">"button[class='sc-cRULEh fMiRie']"</strong>).click()<br/>driver.implicitly_wait(120)</span></pre><p id="0f32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3-搜索特定位置</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="5bef" class="ln jf hi lj b fi lo lp l lq lr"># get the total number of stores on the page<br/>time.sleep(5)<br/>stores=driver.find_element_by_xpath (<strong class="lj hj">"//div[@class='sc-fQfKYo cUcAcc']</strong>\<br/><strong class="lj hj">                                      //div[@class='sc-cOoQYZ eQkiJd']</strong>\<br/><strong class="lj hj">                                      //span[@class='sc-bdVaJa hQDtnE']"</strong>)<br/>number=stores.text<br/>strNo=[int (s) for s in number.split () if s.isdigit ()]<br/>for i in strNo :<br/>    i=i<br/>print(i)</span></pre><p id="18bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4-获取该位置的商店总数</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="ab20" class="ln jf hi lj b fi lo lp l lq lr"># scroll to each store and open, one-by-one, for scraping<br/>    #the 'for loop' starts<br/>time.sleep (5)<br/><br/>    # loop through the menus of each store on a page<br/><br/>    #dictionay for jason file<br/>Menus = {}<br/>x: int<br/>for x in range (0 , i , 1) :<br/>    div2=driver.find_element_by_xpath (<strong class="lj hj">"//div[@class='sc-jrOYZv bgfxZq']"</strong>)<br/>    element: List [WebElement]=div2.find_elements_by_xpath (<strong class="lj hj">"//div[@class='sc-EHOje eOpoWF']</strong>\<br/><strong class="lj hj">                                    //span[@class = 'sc-bdVaJa bTYYIJ']|//div[@class='sc-EHOje eOpoWF']</strong>\<br/><strong class="lj hj">                                    //span[@class = 'sc-bdVaJa lncAvd']"</strong>)<br/><br/>    time.sleep (10)<br/>    WebDriverWait (driver , 60)<br/>    strnm: WebElement=element [x]<br/>    pos=strnm.location<br/>    y=pos.get (<strong class="lj hj">'y'</strong>)-70<br/>    driver.execute_script (<strong class="lj hj">f"window.scrollTo(0, </strong>{y}<strong class="lj hj">)"</strong>)<br/>    store_name = str(strnm.text)<br/>    print (<strong class="lj hj">f'</strong>{x}<strong class="lj hj">- ' </strong>, store_name)</span></pre><p id="821f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5-逐个滚动到每个商店，并打印名称</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="eab5" class="ln jf hi lj b fi lo lp l lq lr"># write the "store_name" in a JSON node<br/>    # sub-nodes of stores<br/>    sub_node = Menus [<strong class="lj hj">f'</strong>{store_name}<strong class="lj hj">'</strong>]= {}</span></pre><p id="601f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6-在每次迭代中，用商店的名称在JSON中创建子节点</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="7575" class="ln jf hi lj b fi lo lp l lq lr"># lists to store all names and check the length of results<br/>    names = []<br/>    # open the store<br/>    time.sleep (4)<br/>    move_to_element_chrome (driver , strnm , display_scaling=100)<br/>    actions=ActionChains (driver)<br/>    actions.send_keys_to_element (strnm , Keys.ENTER).perform ()<br/># create sub-node of each food category in the store under the "store_name" node<br/># scrape the menus of related food category<br/>    #look for the categories of food<br/>    categories = driver.find_element_by_xpath(<strong class="lj hj">"//div[@class='sc-jrOYZv iAfIGO']"</strong>)\<br/>                        .find_elements_by_xpath(<strong class="lj hj">"//div[@class='sc-ddcOto bPbXPf']"</strong>)<br/>    no_of_categories = len(categories)</span></pre><p id="9fe2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7-打开商店，获取食物类别</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="269b" class="ln jf hi lj b fi lo lp l lq lr">for n in range(0,no_of_categories, 1):<br/>#           create a list for each category<br/>        cet = categories[n]<br/>        category = str(cet.text)<br/>        sub_node[<strong class="lj hj">f'</strong>{category}<strong class="lj hj">'</strong>] = []<br/>#           scrape menus' name and prices<br/>        actions.send_keys_to_element(cet, Keys.ENTER)<br/>        itm = driver.find_elements_by_xpath(<strong class="lj hj">"//div[@class='sc-BOulX imSnGi']//div[@class='sc-bscRGj CaBXz']"</strong>)<br/>        itms = itm[n]<br/>        item = itms.find_elements_by_xpath(<strong class="lj hj">"//div[@class='sc-iBfVdv dWPDtB']//span[@class='sc-bdVaJa gImhEG']"</strong>)<br/>        prcs = itms.find_elements_by_xpath(<strong class="lj hj">"//div[@class='sc-eomEcv cVLFKN']//span[@class='sc-bdVaJa eEdxFA']"</strong>)<br/>        price = []<br/>        foods = []<br/>        for food in item:<br/>            foods.append(food.text)<br/>        if prcs is not None:<br/>            for value in prcs:<br/>                price.append(value.text)<br/>        else:<br/>            for food in item:<br/>                price.append(<strong class="lj hj">'NaN'</strong>)<br/>        for m, p in zip(foods , price) :<br/>#           append "item" and "Price list" in food category list<br/>            sub_node[<strong class="lj hj">f"</strong>{category}<strong class="lj hj">"</strong>].append ({m:p})<br/>#   scrape all menu names</span></pre><p id="fffd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8-逐个点击每个类别，并抓取相关菜单。每个类别的名称将作为“store name”节点的子节点添加到JSON文件中。</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="5c0f" class="ln jf hi lj b fi lo lp l lq lr">#   scrape all menu names<br/>    target = driver.find_elements_by_xpath(<strong class="lj hj">"//div[@class='sc-iBfVdv dWPDtB']//span[@class='sc-bdVaJa gImhEG']"</strong>)<br/>    for nm in target:<br/>        names.append(nm)<br/># check if the target is reached</span></pre><p id="453a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9-将菜单存储在单独的列表中以设定目标</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="34af" class="ln jf hi lj b fi lo lp l lq lr">if len(names) &gt;= 200:<br/># if target is reached, save the file as JSON,<br/><br/>               with open(<strong class="lj hj">'menus.json'</strong>, <strong class="lj hj">'w'</strong>) as outfile:<br/>                   json.dump (Menus , outfile)<br/>               driver.close ()<br/>    #give a completion msg<br/>               ctypes.windll.user32.MessageBoxW (0 ,<br/>                                                        <strong class="lj hj">f'Congratulations! We have successfully scraped </strong>{len(names)}<strong class="lj hj"> menus.' </strong>,<br/>                                                        <strong class="lj hj">'Project Completion' </strong>, 1)<br/>    #and exit the script<br/>               break<br/>               sys.exit()</span></pre><p id="2156" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">10-设定目标。如果达到了目标，将数据保存为JSON文件。它还会产生一条完成消息。因此，脚本退出。</p><pre class="ki kj kk kl fd li lj lk ll aw lm bi"><span id="57ec" class="ln jf hi lj b fi lo lp l lq lr">if len(names) &gt;= 200:<br/># if target is reached, save the file as JSON,<br/><br/>               with open(<strong class="lj hj">'menus.json'</strong>, <strong class="lj hj">'w'</strong>) as outfile:<br/>                   json.dump (Menus , outfile)<br/>               driver.close ()<br/>    #give a completion msg<br/>               ctypes.windll.user32.MessageBoxW (0 ,<br/>                                                        <strong class="lj hj">f'Congratulations! We have successfully scraped </strong>{len(names)}<strong class="lj hj"> menus.' </strong>,<br/>                                                        <strong class="lj hj">'Project Completion' </strong>, 1)<br/>    #and exit the script<br/>               break<br/>               sys.exit()</span></pre><p id="d7e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">11-否则，对每个商店重复该循环，直到达到目标。</p><p id="5b40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是的，它可以变得更有效率。</p><p id="af07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">快乐脚本！</p></div></div>    
</body>
</html>