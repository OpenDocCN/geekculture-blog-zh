<html>
<head>
<title>Deploying Intent Classifier on Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Heroku上部署意图分类器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/deploying-intent-classifier-on-heroku-a784c22a29fe?source=collection_archive---------1-----------------------#2020-10-24">https://medium.com/geekculture/deploying-intent-classifier-on-heroku-a784c22a29fe?source=collection_archive---------1-----------------------#2020-10-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1e88c137f2ee2de7aed528122d7c622a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JhIvANmCl0p6EpOkyzFfag.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Image by Author</figcaption></figure><p id="4016" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">欢迎来到我博客的续篇，在这里我谈到了<a class="ae js" rel="noopener" href="/analytics-vidhya/creating-your-own-intent-classifier-b86e000a4926">训练意图分类器</a>。现在我们已经有了训练好的意图分类器..下一步什么？我们如何使用它。它必须部署在某个地方才能使用，对吗？我们将选择Heroku作为我们的平台来实时查看意图分类器。</p><p id="7f53" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在我们开始之前，如果你愿意和我一起走，你可以在我的<a class="ae js" href="https://github.com/thehetpandya/heroku-intent-classifier-deployment" rel="noopener ugc nofollow" target="_blank"> github repo </a>上找到所有代码。</p><h1 id="79c8" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">文件夹结构</h1><p id="6739" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">为方便起见，我们将保留以下文件夹结构:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="e6bf" class="lf ju hi lb b fi lg lh l li lj">/your-folder<br/>├───models<br/>│   └───intents.h5<br/>├───templates<br/>│   └───index.html<br/>├───utils<br/>│   ├───classes.txt<br/>│   ├───label_encoder.pkl<br/>│   └───tokenizer.pkl<br/>├───index.html<br/>├───app.py<br/>├───requirements.txt<br/>└───Procfile</span></pre><h1 id="c970" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">第一步</h1><p id="6307" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">正如之前<a class="ae js" rel="noopener" href="/analytics-vidhya/deploying-bert-on-heroku-7df1d23f9c43">所说，Heroku需要<em class="lk"> "requirements.txt" </em>来安装所有需要的依赖项。在同一中添加以下库:</a></p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="267a" class="lf ju hi lb b fi lg lh l li lj">tensorflow==1.5<br/>h5py<br/>scikit-learn<br/>numpy<br/>flask</span></pre><h1 id="f37c" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">第二步</h1><p id="b421" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">现在我们已经安装了库，是时候编写一个神奇的文件了😉</p><p id="c006" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">创建一个名为<em class="lk"> "app.py" </em>的文件，放入下面的代码code:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="7750" class="lf ju hi lb b fi lg lh l li lj">import os<br/>from flask import Flask, render_template<br/>from flask import request<br/><br/>import pickle<br/>from tensorflow.python.keras.models import load_model<br/>from tensorflow.python.keras.preprocessing.sequence import pad_sequences<br/>import numpy as np<br/>import tensorflow as tf<br/><br/>global graph<br/><br/>model = load_model('models/intents.h5')<br/>graph = tf.get_default_graph()<br/><br/>with open('utils/tokenizer.pkl','rb') as file:<br/>    tokenizer = pickle.load(file)<br/><br/>with open('utils/label_encoder.pkl','rb') as file:<br/>    label_encoder = pickle.load(file)<br/><br/>class IntentClassifier:<br/>    def __init__(self,model,tokenizer,label_encoder):<br/>        self.classifier = model<br/>        self.tokenizer = tokenizer<br/>        self.label_encoder = label_encoder<br/><br/>    def get_intent(self,text):<br/>        self.text = [text]<br/>        self.test_keras = self.tokenizer.texts_to_sequences(self.text)<br/>        self.test_keras_sequence = pad_sequences(self.test_keras, maxlen=16, padding='post')<br/>        with graph.as_default():<br/>            self.pred = self.classifier.predict(self.test_keras_sequence)<br/>        return self.label_encoder.inverse_transform(np.argmax(self.pred,1))[0]<br/><br/>app = Flask(__name__)<br/><br/>nlu = IntentClassifier(model,tokenizer,label_encoder) <br/><br/><br/>@app.route('/', methods=['GET', 'POST'])<br/>def index():<br/>  <br/>    if request.method == 'POST':<br/>      form = request.form <br/>        <br/>      result = []<br/>      sentence = form['sentence']<br/>      prediction = nlu.get_intent(sentence)<br/><br/>      result.append(form['sentence'])<br/>      result.append(prediction)<br/><br/>      return render_template("index.html",result = result)<br/><br/>    return render_template("index.html")<br/><br/>if __name__ == '__main__':<br/>    port = int(os.environ.get("PORT", 5000))<br/>    app.run(host='0.0.0.0', port=port)</span></pre><p id="22f1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这将创建一个解析器类，以便根据它所接受的训练对给定的意图进行分类。接下来，我们创建了一个flask服务器来接收输入并将它们传递给解析器类。</p><p id="e7ec" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，创建一个名为<em class="lk"> "index.html" </em>的文件，并将其放在<em class="lk"> "templates" </em>文件夹下。在文件中添加以下代码:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="72f1" class="lf ju hi lb b fi lg lh l li lj">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;Intent Classifier&lt;/title&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;<br/>    &lt;link href="//netdna.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" media="screen"&gt;<br/>    &lt;style&gt;<br/>      .container {<br/>        max-width: 1000px;<br/>      }<br/>    &lt;/style&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div class="container"&gt;<br/>      &lt;div class="row-sm-5 row-sm-offset-1"&gt;<br/>          &lt;h4&gt;Enter a sentence to test Intent Classifier&lt;/h4&gt;<br/>            &lt;form role="form" method='POST' action='/'&gt;<br/>              &lt;div class="form-group"&gt;<br/>                &lt;input type="text" name="sentence" class="form-control" id="url-box" placeholder="Enter a sentence" style="max-width: 300px;" autofocus required&gt;<br/>              &lt;/div&gt;<br/>              &lt;button type="submit" class="btn btn-default"&gt;Predict&lt;/button&gt;<br/>            &lt;/form&gt;<br/>          &lt;br&gt;<br/>      &lt;/div&gt;<br/>      <br/><br/>      &lt;div class="row-sm-5 row-sm-offset-1"&gt;<br/>          &lt;p&gt;Find the list of all classes &lt;a href='https://github.com/horizons-ml/heroku-intent-classifier-deployment/blob/main/utils/classes.txt' target="_blank"&gt;here&lt;/a&gt;.&lt;/p&gt;<br/>          {% if result %}<br/>          &lt;h4&gt;Sentence : {{ result[0] }}&lt;/h4&gt;<br/>          &lt;h4&gt;Predicted Intent : {{ result[1] }}&lt;/h4&gt;<br/>          {% endif %}<br/>      &lt;/div&gt;<br/><br/>    &lt;/div&gt;<br/>    <br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><h1 id="c52d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">第三步</h1><p id="887e" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">创建<em class="lk"> "Procfile" </em>并添加以下代码:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="3ae5" class="lf ju hi lb b fi lg lh l li lj">web: python app.py</span></pre><h1 id="b16a" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">第四步</h1><p id="1208" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">确保你已经安装了Heroku CLI和git。完成后，在您的终端中运行以下命令，将您的机器与Heroku连接起来。：</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="72d0" class="lf ju hi lb b fi lg lh l li lj">heroku login</span></pre><p id="a864" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，转到<a class="ae js" href="https://dashboard.heroku.com/new-app?org=personal-apps" rel="noopener ugc nofollow" target="_blank">这个页面</a>，用你想要的名字创建一个heroku应用程序。成功创建应用程序后，键入以下命令将应用程序部署到Heroku:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="e6ca" class="lf ju hi lb b fi lg lh l li lj">git init<br/>git add .<br/>git commit -m 'initial commit'<br/>git push heroku master</span></pre><p id="2859" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们的app已经部署好了！是时候看看它的运行了。</p><p id="f9a9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在浏览器窗口中输入以下地址:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="50d5" class="lf ju hi lb b fi lg lh l li lj">https://your_app_name.herokuapp.com</span></pre><p id="c450" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您应该会看到类似这样的内容:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/527ac939b9a69c33560db065cc37fc7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*Xfa5Ky5zhNgPUPORvVTwNg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Deployed Intent Classifier</figcaption></figure><p id="a96b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们给它一个测试句子。你可以在这里找到<a class="ae js" href="https://github.com/thehetpandya/heroku-intent-classifier-deployment/blob/main/utils/classes.txt" rel="noopener ugc nofollow" target="_blank">的职业列表，作为测试模型的参考。</a></p><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/add453d1174a115d0dffdfcac1b51f4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*h_pNTCHzuPzAhfgcRsVzxw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx">Intent Classifier Prediction</figcaption></figure><p id="8d62" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Yaaayy！我们的分类器工作了！如果你想试试，我已经在这里部署了我的分类器<a class="ae js" href="https://intentclassifier.herokuapp.com" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="ff38" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">暂时就这样了。感谢您的阅读😄</p></div></div>    
</body>
</html>