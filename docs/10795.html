<html>
<head>
<title>Optimizing a Portfolio of Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">优化模型组合</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/optimizing-a-portfolio-of-models-f1ed432d728b?source=collection_archive---------0-----------------------#2022-02-16">https://medium.com/geekculture/optimizing-a-portfolio-of-models-f1ed432d728b?source=collection_archive---------0-----------------------#2022-02-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="703b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个<a class="ae jd" href="https://github.com/microprediction/precise/blob/main/examples_colab_notebooks/lazypredict_model_portfolio.ipynb" rel="noopener ugc nofollow" target="_blank"> colab笔记本</a>中，我提供了一个使用<a class="ae jd" href="https://github.com/microprediction/precise" rel="noopener ugc nofollow" target="_blank"> precise </a> Python包(和<a class="ae jd" href="https://github.com/robertmartin8/PyPortfolioOpt" rel="noopener ugc nofollow" target="_blank"> PyPortfolioOpt </a>)创建一个多样化的scikit-learn模型组合的例子，这些模型使用<a class="ae jd" href="https://github.com/shankarpandala/lazypredict" rel="noopener ugc nofollow" target="_blank"> LazyPredict </a>。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/241716e953417186eeeed63754f4abdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OWikqFJIUP6AyyNtCNka-g.png"/></div></div></figure><h1 id="9203" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">背景</h1><p id="d31f" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">目前，我满足于将读者的注意力吸引到金融投资组合构建和模型集合之间的密切相似之处。模型的线性组合当然类似于资产组合，因为评估在数学上是相似的，有时甚至是相同的。</p><p id="9cca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在假设模型是无偏的情况下，我们对组合模型的平方误差(或一些类似的度量)感兴趣。同样，在金融领域，我们有时会对最小化线性证券组合(或者类似的目标)的方差感兴趣。</p><p id="862b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有趣的是，预测文献和金融文献都用不同的术语提出了同样严厉的实证警告。过度集中会损害投资组合的长期回报，就像过度依赖单一模型会损害样本外表现一样。</p><p id="0cda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还在文献中发现了关于投资组合构建过于花哨的实证警告(类似地，专家意见、预测模型或模型输出的组合)。你会经常听到这样一句话:在一个看似很低的标准(同等重量)上取得进步有着惊人的困难。</p><p id="7324" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个合理的担忧，作为一个例子，协方差的点估计的危险得到了很好的理解——如果你愿意，你可以花几个小时阅读这个主题(这里有一个论文列表<a class="ae jd" href="https://github.com/microprediction/precise/blob/main/LITERATURE.md" rel="noopener ugc nofollow" target="_blank"/>)。</p><p id="59a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，理论和实践都在进步，所以在我看来，聪明弊大于利的观点可能有些过头了，当然也不应该阻止人们在数据丰富的领域工作。我的意图是，通过创建precise包以及与AutoML的一些互操作性，温和地反击这种看法。</p><p id="87d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">特别是，我怀疑自动机器学习的“混合”阶段将开始更多地借鉴金融。</p><h1 id="9212" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">这个计划</h1><p id="2139" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">我在这里的适度目标是从货架上取下一个标准的sklearn数据集，看看我们是否可以轻松地构建一个“相当好的”自主创建的模型组合，比选择最佳模型更好地为您服务。对各种交叉验证进行更仔细的比较还需要等待，但是如果你选择这样做的话，我将为你提供继续进行的要素。</p><p id="375b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们将把数据分成三个部分，称为“训练”、“测试”和“验证”。这里的“测试”有点用词不当，因为我们将执行以下操作:</p><ol class=""><li id="9bbd" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated">X列车，y列车上的列车</li><li id="4d54" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">基于样本性能的X_test，y_test选择最佳模型</li><li id="8e7c" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">同时使用X_test、y_test和标准投资组合构建技术的模型残差来估计<em class="lh">模型投资组合权重</em>。</li><li id="f03d" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">在X_train+X_test上重新训练模型</li><li id="0e8d" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">使用步骤3中的权重，将最佳模型的性能与加权组合进行比较。</li></ol><p id="b078" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(撇开语义不谈，我们注意到，选择上面确定的“<em class="lh">最佳”模型</em>当然是投资组合的一个特例——所有的质量都在一个模型上。我可能应该把它加到精确包装里！)</p><h1 id="a011" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">预赛</h1><p id="2399" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">开始具体工作，我们需要精确的包装。如果你使用colab或者一个预先提供熊猫的环境，省掉你自己可能的烦恼。例如在colab上:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es li"><img src="../Images/f5dacacc99ef90383c4fed88e24fa1e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*VpczHB2ufDUK3JYLuHrfXg.png"/></div></figure><p id="d4ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后重新启动环境。我们将使用:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lj"><img src="../Images/3925e62824a0c3ad7622e8e1af00f0ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OmNXUay78hXmL0VppvOPMw.png"/></div></div></figure><p id="61ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同样的<em class="lh"> sklearn </em>例子，你会在LazyPredict <a class="ae jd" href="https://github.com/shankarpandala/lazypredict" rel="noopener ugc nofollow" target="_blank">自述文件</a>、波士顿数据集<a class="ae jd" href="http://lib.stat.cmu.edu/datasets/boston" rel="noopener ugc nofollow" target="_blank">中找到。</a></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lk"><img src="../Images/35d19edb5957ed61be68185a83510a38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*7L2jszqRXa7qkA54TOqViw.png"/></div></figure><p id="88c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仔细阅读sklearn文档提醒我们，这个数据集有<em class="lh">伦理问题</em>并且不应该使用，除非目的是教育人们关于数据伦理。当然，当然，那是我的意图。你们都应该购买和阅读我即将出版的精彩书籍“<em class="lh">微预测:建立一个开放的人工智能网络”</em>将于秋季由麻省理工学院出版社出版。在那里你会发现一个关于模型公平性的长时间讨论，以及为什么它只能通过一个预测网络来解决。</p><p id="cc2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不管怎样，回到我们花了半天时间来打败企业号的事情上来...</p><h1 id="f364" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">lazy预测包</h1><p id="1f36" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">我猜它被称为LazyPredict是有原因的。这个漂亮的小软件包为您节省了相当多的代码行，这些代码用于编组scikit-learn模型和它们的预测。例如，使用下面的LazyRegressor为在X_train上训练和在X_test上测试的模型创建了一个性能表:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ll"><img src="../Images/0aeeebc2f14a8f12ef09c16061cab6d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gEejBFWxo3INrCuMoXNKAQ.png"/></div></div></figure><p id="274a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(你可以用<a class="ae jd" href="https://github.com/pycaret/pycaret" rel="noopener ugc nofollow" target="_blank"> pycaret </a>或<a class="ae jd" href="https://github.com/AutoViML/AutoViz" rel="noopener ugc nofollow" target="_blank"> autoviml </a>或类似的包做同样的事情，我开始走这条路。然而，pycaret的交互性假设减慢了我的速度，足以切换到这个特定实验的目的。我将很快为流行的选择写一些改编本)。</p><p id="f742" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lh">预测1 </em>输出给了我们需要的数据，现在我们将转向<strong class="ih hj">精确</strong>包来推断模型的组合。</p><h1 id="6f5a" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">精确的包装</h1><p id="79be" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">确切地说，这个包包括一个“经理”的集合。经理是接收向量(可能是几只股票同期收益的集合，但这里包括模型残差)并更新投资组合权重的人。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lm"><img src="../Images/8877d0a467d49083ad75d382af51b1ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*3qN9YhpNHDVOA7gcFGeP3g.png"/></div><figcaption class="ln lo et er es lp lq bd b be z dx">Using a “manager” to update weights</figcaption></figure><p id="bda6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个包包含了一些完成这个任务的新方法，并且调用了优秀的<a class="ae jd" href="https://pyportfolioopt.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> PyPortfolioOpt </a>和<a class="ae jd" href="https://riskfolio-lib.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> Riskfolio-Lib </a>包。在文件<a class="ae jd" href="https://github.com/microprediction/precise/blob/main/LISTING_OF_MANAGERS.md" rel="noopener ugc nofollow" target="_blank">中有一个经理的完整列表，你相信吗？</a></p><p id="ae32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在波士顿数据集中，我假设这些行是非时态的。precise包主要针对实时时态问题，但这在这里并不重要。</p><p id="69c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于一些经理，我们让<a class="ae jd" href="https://riskfolio-lib.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> Riskfolio-Lib </a>做所有的工作，从历史数据的累积缓冲开始。对其他人来说，投资组合经理可能是两种选择的组合:</p><ol class=""><li id="eea0" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated">一种在线估计协方差的方法，结合</li><li id="2c41" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">根据协方差预测确定投资组合的方法(有时使用<a class="ae jd" href="https://pyportfolioopt.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> PyPortfolioOpt </a>)。</li></ol><p id="2424" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">恐怕，可能性的爆炸会导致完全自主的管理者的名字变得相当长。如果您仔细阅读下面的导入，然后参考精确的<a class="ae jd" href="https://github.com/microprediction/precise" rel="noopener ugc nofollow" target="_blank">自述文件</a>，您可能会推断我正在使用PyPortfolioOpt的最小波动率投资组合和图形套索的实现，并对协方差估计进行交叉验证。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lr"><img src="../Images/292726efdb3b797cb41d6d84f3e27d73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ydUWLXRigsyf29oFmoigw.png"/></div></div></figure><p id="c6c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我把字体变大…</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ls"><img src="../Images/83e5b8fb768fc6c399f67608e3136136.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-KRYiLZoE0DB67yR4W3RUg.png"/></div></div></figure><p id="dbe8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你也可以观察给经理打电话的方式。我一次给它一个模型残差向量，并且从一次调用到下一次调用，我代表它保存状态s。一旦你明白了笑话的那部分，精确包装的使用就变得微不足道了。</p><p id="873f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(这里不用担心<strong class="ih hj"> e </strong>的使用。这是一个小的性能黑客。它告诉投资组合经理，我们只关心最后的<strong class="ih hj"> w. </strong>我建议你参考<a class="ae jd" href="https://github.com/microprediction/precise" rel="noopener ugc nofollow" target="_blank">文档</a>，因为它是关于“滑冰”的更多解释。)</p><h1 id="0ba6" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">投资组合和组合模型</h1><p id="172f" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">测试数据集上模型残差的协方差向经理建议多样化的投资组合如下:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lt"><img src="../Images/ad69e789db5eda438b4b06da3960e508.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H-9uVaR1Y3FvcQiQ_ZzVIg.png"/></div></div></figure><p id="6599" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们为这些模型生成了样本外预测，我们只需使用线性组合。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lu"><img src="../Images/0f0d2bd6831c4d1fb312d22514133131.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*9ZNABzR4e46yjKEoVZ0sDw.png"/></div><figcaption class="ln lo et er es lp lq bd b be z dx">Linear combination of models</figcaption></figure><p id="848d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另外，用金融术语来说，为了稳定，我使用了一个“只做多”的经理。在某些情况下，人们可能希望适当放松这一限制。</p><h1 id="bcb0" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">样本外性能</h1><p id="f007" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">显然，我们没有水晶球来告诉我们哪个模型在样本中表现最好，但我还是制作了事后误差平方和排行榜作为参考。</p><p id="9015" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经在不可能排行榜中插入了我们的加权模型组合，以及最佳模型(在本例中为正交匹配追踪)。如你所见，这种情况下投资组合更好。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lv"><img src="../Images/a7339e7ed1900dbe60c22a71990bf5a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o58Z8UfGGrn0F-wnO-4S4A.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">Out of sample performance of a portfolio of sklearn models, set against the selected “best” model</figcaption></figure><p id="6dfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你看一下<a class="ae jd" href="https://github.com/microprediction/precise/tree/main/examples_ensembles_lazypredict" rel="noopener ugc nofollow" target="_blank">precise/examples _ ensembles _ lazy predict</a>中的脚本版本，有一点蒙特卡洛研究。它强烈表明，使用模型组合优于选择最佳模型，至少对于波士顿数据集来说是这样。(我还包括了没有在测试集上重新训练的最佳模型，以预测该评论。)</p><h1 id="6b48" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">选择模型投资组合:一个开放性问题？</h1><p id="e989" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">有一个健康的堆积，专家的混合，和集合文献，然而我认为在这种情况下最好的使用金融投资组合理论的问题是一个开放的问题。</p><p id="2c10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有人可能会反驳说，实证金融文献可能无法很好地回答这一问题，因为投资组合方法及其样本外表现在很大程度上取决于数据生成过程的性质，而且金融投资组合的一些特征不一定适用于残差模型。</p><p id="c1f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，我们很快就会知道了。你可以期待在精确的GitHub repo中看到更多的Elo评级类别。这些将试图弄清在不同的模型组合环境中，哪种类型的投资组合结构更受青睐。</p><p id="f51c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想合作，在这里找到我。例如，如果你有剩余的模型(你会分析你的剩余，不是吗？).与流行的AutoML软件包的集成也可能取得成果。</p></div></div>    
</body>
</html>