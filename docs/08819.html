<html>
<head>
<title>Danny’s Diner: Exploring SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">丹尼的晚餐:探索SQL</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/dannys-diner-exploring-sql-c853b8ffd3f7?source=collection_archive---------16-----------------------#2021-11-15">https://medium.com/geekculture/dannys-diner-exploring-sql-c853b8ffd3f7?source=collection_archive---------16-----------------------#2021-11-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f03e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">这是Danny ma为期8周的SQL挑战的一部分。</em></p><p id="7779" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果，你很好奇，想自己解决。你可以自己解决<a class="ae je" href="https://8weeksqlchallenge.com/case-study-1/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="fb10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这真的很有挑战性，我真的很喜欢解决这些问题。让我们马上开始吧。</p><h2 id="77d7" class="jf jg hi bd jh ji jj jk jl jm jn jo jp iq jq jr js iu jt ju jv iy jw jx jy jz bi translated"><strong class="ak">信息</strong></h2><p id="4cad" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq kc is it iu kd iw ix iy ke ja jb jc hb bi translated">丹尼正试图开一家小餐馆，经营他最喜欢的三种食物:寿司、咖喱、拉面(我都流口水了！).餐馆收集了一些非常基本的数据，但不知道如何使用这些数据来帮助他们经营业务。</p><h2 id="7917" class="jf jg hi bd jh ji jj jk jl jm jn jo jp iq jq jr js iu jt ju jv iy jw jx jy jz bi translated">问题陈述</h2><p id="c863" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq kc is it iu kd iw ix iy ke ja jb jc hb bi translated">丹尼有兴趣回答顾客的一些基本问题，例如:</p><ul class=""><li id="37c2" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc kk kl km kn bi translated">顾客参观了多少次？</li><li id="6713" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">他们在餐馆总共花了多少钱？</li><li id="2444" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">顾客最喜欢的菜单项目是什么？</li></ul><p id="dd2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Danny希望为他的忠诚客户创造个性化的体验，以便他可以决定是否应该扩大客户忠诚度计划的现有成员。</p><p id="bea7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">他还想生成一些基本的数据集，这样他的团队就可以在不使用SQL的情况下轻松检查数据。</p><h2 id="3b9d" class="jf jg hi bd jh ji jj jk jl jm jn jo jp iq jq jr js iu jt ju jv iy jw jx jy jz bi translated">实体关系图(ERD)</h2><p id="f262" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq kc is it iu kd iw ix iy ke ja jb jc hb bi translated">它包括3个数据集:销售，菜单，会员。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es kt"><img src="../Images/32ca852fc5fe267a6dc6e29a6f53627f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*LsNFTSislOuhUYjknC3Deg.jpeg"/></div><figcaption class="lb lc et er es ld le bd b be z dx">Image from Danny ma <a class="ae je" href="https://8weeksqlchallenge.com/case-study-1/" rel="noopener ugc nofollow" target="_blank">challenge</a></figcaption></figure><ol class=""><li id="da3b" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc lf kl km kn bi translated">销售数据集:它包含每个客户(customer_id)和他们订购的时间(order_date)以及他们订购的内容(product_id)</li><li id="32f9" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc lf kl km kn bi translated">菜单:它包含产品详细信息，如名称(产品名称)、单价(价格)和唯一标识(产品标识)</li><li id="7d0c" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc lf kl km kn bi translated">Members:它包含忠诚度计划中的客户(customer_id)的详细信息以及他们加入忠诚度计划的时间(join_date)。</li></ol><p id="937b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">以上给出的所有细节和后面的问题在这里</em>  <em class="jd">已经详细解释过了</em> <a class="ae je" href="https://8weeksqlchallenge.com/case-study-1/" rel="noopener ugc nofollow" target="_blank"> <em class="jd">。我已经按照我理解方式写了。</em></a></p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es lg"><img src="../Images/0ad9a630a16bcfc0687b1e64061e75ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*CQyy5AuqTc1AzSoeTlRdLw.jpeg"/></div><figcaption class="lb lc et er es ld le bd b be z dx">Lets Start Slurpping! Image from <a class="ae je" href="https://www.alamy.com/stock-photo-ramen-and-sushi-kawaii-cartoon-175830809.html" rel="noopener ugc nofollow" target="_blank">alamy</a></figcaption></figure><h2 id="c1c9" class="jf jg hi bd jh ji jj jk jl jm jn jo jp iq jq jr js iu jt ju jv iy jw jx jy jz bi translated">数据集探索</h2><ol class=""><li id="e2e0" class="kf kg hi ih b ii ka im kb iq lh iu li iy lj jc lf kl km kn bi translated">销售数据集</li></ol><p id="ef23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是这家餐馆的总销售额。</p><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="bb62" class="jf jg hi ll b fi lp lq l lr ls">SELECT * FROM dannys_diner.sales;</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es lt"><img src="../Images/56cd14a72ef2e9af8c5bbe39891706d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*TdZw3aCMysJqk1HCY3Oh8A.jpeg"/></div><figcaption class="lb lc et er es ld le bd b be z dx">Snnipet of the result</figcaption></figure><p id="a968" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到，销售数据集由访问过的客户、他们订购了什么以及他们订购的时间组成。</p><p id="88e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.菜单数据集</p><p id="6b36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为菜单上只有三个项目。该数据集包含商品价格及其详细信息。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es lu"><img src="../Images/6a8b3f71d68b83e560fcf6ce6ab64028.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*0yjMKe9vbqAnhOuT9ubs5A.jpeg"/></div></figure><p id="c210" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.成员数据集</p><p id="e682" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将看到忠诚计划中的会员/客户。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es lv"><img src="../Images/746d61c5a139b66197bebb99a021f63f.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*U27-uP4rniIxntmqhFbtEA.jpeg"/></div></figure><p id="e1eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">挑战已经包括了需要解决的问题，所以让我们详细看看每个问题。</p><h2 id="51b0" class="jf jg hi bd jh ji jj jk jl jm jn jo jp iq jq jr js iu jt ju jv iy jw jx jy jz bi translated">案例研究问题</h2><ol class=""><li id="6ecb" class="kf kg hi ih b ii ka im kb iq lh iu li iy lj jc lf kl km kn bi translated">每位顾客在餐厅消费的总额是多少？</li><li id="97df" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc lf kl km kn bi translated">每位顾客光顾餐厅有多少天了？</li><li id="de15" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc lf kl km kn bi translated">每位顾客从菜单上购买的第一个项目是什么？</li><li id="d513" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc lf kl km kn bi translated">菜单上购买最多的项目是什么？所有顾客购买了多少次？</li><li id="1320" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc lf kl km kn bi translated">每位顾客最喜欢的商品是什么？</li><li id="a0bd" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc lf kl km kn bi translated">顾客成为会员后最先购买的物品是什么？</li><li id="c4ac" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc lf kl km kn bi translated">顾客在成为会员之前购买了哪件商品？</li><li id="2e2d" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc lf kl km kn bi translated">每位会员在成为会员前的总物品和消费金额是多少？</li><li id="f53c" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc lf kl km kn bi translated">如果每消费1美元相当于10个积分，寿司有2倍的积分乘数——每个顾客会有多少个积分？</li><li id="66a0" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc lf kl km kn bi translated">在客户加入计划后的第一周(包括他们的加入日期),他们在所有项目上都获得了2x积分，不仅仅是寿司——客户A和B在1月底获得了多少积分？</li></ol><p id="e598" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们帮助丹尼更好地了解他的顾客。这将是令人兴奋的。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es lw"><img src="../Images/90a33cc7891a7c5b967f53074a69bf6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*M_82Ro9WrfwyvE_WoDDAZQ.gif"/></div><figcaption class="lb lc et er es ld le bd b be z dx">Let’s get coding!</figcaption></figure><p id="116d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">代码是用Postgre SQL写的。</em></p><ol class=""><li id="3dfb" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc lf kl km kn bi translated">每位顾客的消费总额是多少？</li></ol><p id="f5fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从这个问题中，很明显每个顾客一共花了多少钱。从ERD图可以看出，产品的价格在菜单基表中给出，而客户在销售表中。我们需要连接这两个表，以便我们可以按每个客户分组，并给出他们购买商品的总和。</p><p id="7e8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，在进入解决方案之前，看到每个问题我都需要一次又一次地加入表格可能会很累。如果我有一个已经连接的表怎么办？然后，我可以从连接的表中聚合所需的数据。</p><p id="af0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在回答每个问题之前，让我们连接所需的表，以便提取本案例研究的数据输出。</p><h2 id="bbe4" class="jf jg hi bd jh ji jj jk jl jm jn jo jp iq jq jr js iu jt ju jv iy jw jx jy jz bi translated">连接表(实现)</h2><p id="2ff5" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq kc is it iu kd iw ix iy ke ja jb jc hb bi translated">我们有3个基础表，我们将创建2个单独的表。为什么？因为观察这些问题，我们可以发现2类/一组问题。</p><ol class=""><li id="ee9d" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc lf kl km kn bi translated">一组集中于购买的物品和购买者。这将需要连接销售和菜单表以获得以下各列:</li></ol><ul class=""><li id="5ff5" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc kk kl km kn bi translated">客户标识</li><li id="ff19" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">订单日期</li><li id="61b7" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">产品标识</li><li id="cee3" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">产品名称</li><li id="bd7f" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">价格</li></ul><p id="2829" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.类似地，这些问题涉及检查他们的忠诚顾客购买的物品、经常购买的物品等。我们需要连接所有3个表。这将导致获得以下列:</p><ul class=""><li id="28f7" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc kk kl km kn bi translated">客户标识</li><li id="aefa" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">订单日期</li><li id="7b04" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">加入日期</li><li id="49be" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">产品标识</li><li id="cdd0" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">产品名称</li><li id="636e" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">价格</li></ul><p id="e85d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，一旦我们决定了要连接哪些表，我就知道决定哪种类型的表连接起着至关重要的作用！为了不重复，我将详细解释如何连接两个表(第一类连接)，同样的过程也用于第二类。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es lx"><img src="../Images/b5dc980b46052297e3ea14bd7c576c3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*78BdlRoBrN8gvkfAI1jvHA.jpeg"/></div><figcaption class="lb lc et er es ld le bd b be z dx">Joining these 2 tables.</figcaption></figure><p id="51c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在决定使用哪种类型的表连接之前，我们需要回答3个重要问题。</p><ol class=""><li id="9a85" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc lf kl km kn bi translated">连接这两个表的目的是什么？</li></ol><p id="5804" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了知道每个客户购买了什么产品，我们需要将销售中的product_id与菜单中的product_id进行匹配。</p><p id="eac1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.外键在每个表中的分布是怎样的？</p><p id="db30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">要了解什么是外键和其他键请看这里的</em><a class="ae je" href="https://towardsdatascience.com/the-difference-between-primary-and-foreign-keys-accbfb7815d3" rel="noopener" target="_blank"><em class="jd"/></a><em class="jd">。</em></p><p id="2d51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要了解外键在每个表中的分布，因为这有助于决定要使用的表连接的类型。</p><blockquote class="ly lz ma"><p id="f076" class="if ig jd ih b ii ij ik il im in io ip mb ir is it mc iv iw ix md iz ja jb jc hb bi translated">a.sales表中每个product_id是否有多条记录？</p></blockquote><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="b04b" class="jf jg hi ll b fi lp lq l lr ls">WITH product_base AS(<br/>SELECT <br/> product_id,<br/> COUNT(product_id) AS product_counts<br/>FROM dannys_diner.sales<br/>GROUP BY product_id<br/>)</span><span id="9706" class="jf jg hi ll b fi me lq l lr ls">SELECT <br/> product_counts,<br/> COUNT(DISTINCT product_id) AS unique_product_id<br/>FROM product_base<br/>GROUP BY product_counts<br/>ORDER BY product_counts;</span></pre><p id="9060" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个查询是对sales表中的每个product_id及其订购次数进行分组。然后查看每个product_id有多少个product_counts。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es mf"><img src="../Images/f59f1254fd34435bde931c01126f700b.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*SOo2reo6ptOTSWxDP_K2yQ.jpeg"/></div></figure><p id="8b77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">sales表中每个product_id值有多行。</p><blockquote class="ly lz ma"><p id="981a" class="if ig jd ih b ii ij ik il im in io ip mb ir is it mc iv iw ix md iz ja jb jc hb bi translated">b.很明显，每个product_id都有唯一的一行，如果有任何重复的值(一对一的关系)就没有任何意义了</p></blockquote><p id="94b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了验证这一点，我们按照上面菜单表中的相同步骤。</p><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="d803" class="jf jg hi ll b fi lp lq l lr ls">WITH product_base AS(<br/>SELECT <br/> product_id,<br/> COUNT(product_id) AS product_counts<br/>FROM dannys_diner.menu<br/>GROUP BY product_id<br/>)</span><span id="38c0" class="jf jg hi ll b fi me lq l lr ls">SELECT <br/> product_counts,<br/> COUNT(DISTINCT product_id) AS unique_product_id<br/>FROM product_base<br/>GROUP BY product_counts<br/>ORDER BY product_counts;</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es mg"><img src="../Images/3fe550bd84d48aa18dc89d7198995f1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*kYdsLhsxWMEYVvosvt4IPQ.jpeg"/></div></figure><p id="6a03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们发现，在菜单表中，有3个唯一的product_id值具有单行，或者product_id存在一对一的关系。</p><p id="e636" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.两个表之间有多少重叠和缺失的唯一外键值？</p><p id="6e6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要找出在销售中是否有任何唯一的product_id值是菜单表中没有的。我们将使用反连接来检查它。</p><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="5dd0" class="jf jg hi ll b fi lp lq l lr ls">SELECT<br/> COUNT(product_id)<br/>FROM dannys_diner.sales<br/>WHERE NOT EXISTS (SELECT product_id<br/>                  FROM dannys_diner.menu<br/>                  WHERE menu.product_id = sales.product_id);</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es mh"><img src="../Images/9e7f5787ec10a2276d28e58695946bcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:358/format:webp/1*ys0jTgs8e_RmcuOI1RZ_ng.jpeg"/></div></figure><p id="fd2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">没有唯一的值。</p><p id="9ec6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在换一种方式，检查菜单中是否有任何唯一的product_id值是sales表中没有的。</p><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="c175" class="jf jg hi ll b fi lp lq l lr ls">SELECT<br/> COUNT(product_id)<br/>FROM dannys_diner.menu<br/>WHERE NOT EXISTS (SELECT product_id<br/>                  FROM dannys_diner.sales<br/>                  WHERE menu.product_id = sales.product_id);</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es mh"><img src="../Images/9e7f5787ec10a2276d28e58695946bcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:358/format:webp/1*ys0jTgs8e_RmcuOI1RZ_ng.jpeg"/></div></figure><p id="dc12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">没有唯一值或缺少值。</p><p id="d356" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由此可见，我们可以使用inner或left join，但是最好用一个证明来结束。</p><p id="e156" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">左连接还是内连接？</strong></p><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="c991" class="jf jg hi ll b fi lp lq l lr ls">DROP TABLE IF EXISTS inner_join_table;<br/>CREATE TEMP TABLE inner_join_table AS (<br/>SELECT<br/> sales.customer_id,<br/> sales.order_date,<br/> sales.product_id,<br/> menu.product_name,<br/> menu.price<br/>FROM dannys_diner.sales<br/>JOIN dannys_diner.menu<br/>ON sales.product_id =menu.product_id<br/>);</span><span id="b3a8" class="jf jg hi ll b fi me lq l lr ls">DROP TABLE IF EXISTS left_join_table;<br/>CREATE TEMP TABLE left_join_table AS (<br/>SELECT<br/> sales.customer_id,<br/> sales.order_date,<br/> sales.product_id,<br/> menu.product_name,<br/> menu.price<br/>FROM dannys_diner.sales<br/>LEFT JOIN dannys_diner.menu<br/>ON sales.product_id =menu.product_id<br/>);</span><span id="f104" class="jf jg hi ll b fi me lq l lr ls">(<br/>SELECT<br/> 'left_join' AS join_type,<br/> COUNT(*) as row_count,<br/> COUNT(DISTINCT product_id) AS unique_product_id<br/>FROM left_join_table<br/>)<br/>UNION <br/>(<br/>SELECT<br/> 'inner_join' AS join_type,<br/> COUNT(*) as row_count,<br/> COUNT(DISTINCT product_id) AS unique_product_id<br/>FROM inner_join_table<br/>);</span></pre><p id="e0a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，我们首先创建单独连接的表，然后计算每个表中的行数进行比较。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es mi"><img src="../Images/7cb45066ef37a88a76daa5c494a3536a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*5_XxZkVqXHS7I33HT0ukKg.jpeg"/></div></figure><p id="f9d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们可以看到，对于这两个表，使用哪种类型的连接都没有关系。</p><p id="24c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总结一下，</p><ul class=""><li id="3f92" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc kk kl km kn bi translated">我们首先想了解连接这两个表的目的。</li><li id="d2ea" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">然后我们了解了外键(product_id)在每个表中的分布。</li><li id="22e0" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">然后我们检查这两个表中是否有任何唯一的外键值。</li><li id="6073" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">最后，我们比较了两种连接类型，并决定我们可以使用任何一种连接类型。</li></ul><blockquote class="ly lz ma"><p id="b568" class="if ig jd ih b ii ij ik il im in io ip mb ir is it mc iv iw ix md iz ja jb jc hb bi translated">这个过程可能很乏味，但我认为，使用大数据会很有用。</p></blockquote><p id="1d24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以连接这两个表的结果是:</p><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="3d79" class="jf jg hi ll b fi lp lq l lr ls">DROP TABLE IF EXISTS customer_menu_table;<br/>CREATE TEMP TABLE customer_menu_table AS (<br/>SELECT<br/> sales.customer_id,<br/> sales.order_date,<br/> sales.product_id,<br/> menu.product_name,<br/> menu.price<br/>FROM dannys_diner.sales<br/>INNER JOIN dannys_diner.menu<br/>ON sales.product_id =menu.product_id<br/>);</span><span id="29bc" class="jf jg hi ll b fi me lq l lr ls">SELECT * FROM customer_menu_table;</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mj"><img src="../Images/77ba2e2d4e2dac49acb5a36809aa9a60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hQzEHr9NrIXAWELZ0e73OQ.jpeg"/></div></div></figure><p id="50cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">类似地，按照上述过程连接所有3个表。它可以分为两部分。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mo"><img src="../Images/8a8dab75958b5136aa823dd774554961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XioiUEM-WjpqjmpNdVih8Q.jpeg"/></div></div></figure><p id="93e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面已经解释了第一部分，第二部分也类似。</p><p id="d9c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">连接3个表，我们得到</p><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="1336" class="jf jg hi ll b fi lp lq l lr ls">DROP TABLE IF EXISTS member_menu_table;<br/>CREATE TEMP TABLE member_menu_table AS (<br/>SELECT<br/> sales.customer_id,<br/> sales.order_date,<br/> sales.product_id,<br/> menu.product_name,<br/> menu.price,<br/> members.join_date<br/>FROM dannys_diner.sales<br/>INNER JOIN dannys_diner.menu<br/>ON sales.product_id =menu.product_id<br/>LEFT JOIN dannys_diner.members<br/>ON sales.customer_id = members.customer_id<br/>);</span><span id="6b34" class="jf jg hi ll b fi me lq l lr ls">SELECT * FROM member_menu_table;</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mp"><img src="../Images/d7e661cc8b1429d3f0cbf5f70e806467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kg6QhW1ISmoWQgz218ySkQ.jpeg"/></div></div></figure><p id="35f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，回到案例研究问题。有了上面获得的表格，我们就可以开始帮助danny了。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mq"><img src="../Images/90a90b440272b93b6cf034fb42ba7620.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x0r8BtBJ70pAjmBLrQeyZg.jpeg"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">Let’s Start <a class="ae je" href="https://www.dreamstime.com/stock-photo-cook-sushi-japanese-land-restaurant-image33475180" rel="noopener ugc nofollow" target="_blank">Serving</a>!</figcaption></figure><ol class=""><li id="00e0" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc lf kl km kn bi translated"><strong class="ih hj">每位顾客的消费总额是多少？</strong></li></ol><p id="ea99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从customer_menu表中，我们可以按customer_id分组，以获得每位客户在餐馆总共消费了多少钱。</p><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="a0fb" class="jf jg hi ll b fi lp lq l lr ls">SELECT <br/> customer_id,<br/> SUM(price) AS Total_amount<br/>FROM customer_menu_table<br/>GROUP BY customer_id<br/>ORDER BY customer_id;</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es mr"><img src="../Images/22b22bff44ab9e6b399e61bcb02f46bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*RensnieA3AMhq8nr1a1H9A.jpeg"/></div></figure><p id="ca9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">甲花了76，乙花了74，丙一共花了36。</p><p id="82d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。</strong> <strong class="ih hj">每位顾客光顾餐厅多少天了？</strong></p><p id="1c10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以通过统计order_date来统计他/她点餐的次数来得到。</p><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="38c8" class="jf jg hi ll b fi lp lq l lr ls">SELECT<br/> customer_id,<br/> COUNT(DISTINCT order_date) as Visited_total<br/>FROM dannys_diner.sales <br/>GROUP BY customer_id;</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es ms"><img src="../Images/8708a9138d9cfbfc987b527421977988.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*19QoF_71t7uKkj9Jhrh-8Q.jpeg"/></div></figure><p id="14a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a去过丹尼餐馆4次，B去过6次，C去过2次。</p><p id="91a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。</strong> <strong class="ih hj">每位顾客购买的菜单上的第一个项目是什么？</strong></p><p id="0c7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很明显我们必须使用customer_menu_table。</p><ul class=""><li id="223c" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc kk kl km kn bi translated">首先，我们必须根据order_date找到每个客户的第一个商品。</li><li id="21fd" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">我们需要根据order_date对它们进行排名，然后提取排名为1的数据。</li></ul><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="bf96" class="jf jg hi ll b fi lp lq l lr ls">WITH ranking As (<br/>SELECT<br/> customer_id,<br/> product_name,<br/> order_date,<br/> DENSE_RANK() OVER (PARTITION BY customer_id<br/>                    ORDER BY order_date)<br/>                    AS dense_ranking<br/>FROM customer_menu_table<br/>)</span><span id="cab2" class="jf jg hi ll b fi me lq l lr ls">SELECT <br/> customer_id,<br/> product_name<br/>FROM ranking<br/>WHERE dense_ranking = 1<br/>GROUP BY customer_id, product_name;</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es mt"><img src="../Images/5f57e7329b4efe47b8840d93d7544411.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*xz_Oc-8lV_LDTJs3zKa9hg.jpeg"/></div></figure><p id="7da6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a点了咖喱和寿司，B点了咖喱，C点了拉面作为他们的第一道菜。</p><p id="6f0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 4。</strong> <strong class="ih hj">菜单上购买最多的菜是什么，所有顾客购买了多少次？</strong></p><p id="67c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这有两个问题，即</p><ul class=""><li id="2e98" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc kk kl km kn bi translated">所有顾客购买最多的商品</li><li id="e046" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">这一著名项目被所有客户</li></ul><p id="dd7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这可以从customer_menu表中获得。通过对表中的每个product_id进行计数，我们可以找到product_name以及它被购买的总次数。</p><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="222b" class="jf jg hi ll b fi lp lq l lr ls">SELECT<br/> product_name,<br/> COUNT(product_id) as total<br/>FROM customer_menu_table<br/>GROUP BY product_id, product_name<br/>ORDER BY total DESC<br/>LIMIT 1;</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es mu"><img src="../Images/7e237027f8225745f1db825f64314272.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*dmV0JAe7YqjO8cW0IlTElw.jpeg"/></div></figure><p id="6645" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看来拉面在丹尼餐馆很受欢迎。(好奇，拉面味道怎么样？)</p><p id="c11e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 5。每位顾客最喜欢的商品是什么？</strong></p><p id="e40d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这可以通过每个窗口函数获得。</p><ul class=""><li id="e53f" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc kk kl km kn bi translated">首先统计每位顾客购买每件产品的次数</li><li id="207b" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">然后根据每个客户对他们进行排名</li><li id="88b7" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">提取我们想要的。</li></ul><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="f524" class="jf jg hi ll b fi lp lq l lr ls">WITH ranking AS(<br/>SELECT<br/> customer_id,<br/> product_name,<br/> COUNT(product_id) AS times,<br/> DENSE_RANK() OVER (PARTITION BY customer_id<br/>                    ORDER BY COUNT(product_id) DESC)<br/>                    AS ranks<br/>FROM customer_menu_table <br/>GROUP BY customer_id, product_name<br/>)</span><span id="031f" class="jf jg hi ll b fi me lq l lr ls">SELECT <br/> customer_id,<br/> times,<br/> product_name<br/>FROM ranking <br/>WHERE ranks  = 1;</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es mv"><img src="../Images/901425dacaf3502af32f836703a826bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*duwMs0w2UsGFmrHPUETSZw.jpeg"/></div></figure><p id="88aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">A &amp; C经常点拉面，而B经常点菜单上的所有项目。看起来B真的很喜欢丹尼餐馆。</p><p id="9bfc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 6。顾客成为会员后最先购买的物品是什么？</strong></p><p id="df91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种洞察力可以从member_menu表中获得。</p><ul class=""><li id="f753" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc kk kl km kn bi translated">首先，我们必须将加入日期与订单日期进行比较，并提取忠诚计划每个成员加入日期之后的所有日期。</li><li id="e666" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">然后根据订购日期对它们进行排序，并提取每位顾客购买的第一件商品。</li></ul><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="2045" class="jf jg hi ll b fi lp lq l lr ls">WITH ranking AS (<br/>SELECT<br/> customer_id,<br/> order_date,<br/> join_date,<br/> product_name,<br/> DENSE_RANK() OVER(PARTITION BY customer_id<br/>                   ORDER BY order_date) AS ranks<br/>FROM member_menu_table<br/>WHERE order_date &gt;= join_date<br/>)</span><span id="0b72" class="jf jg hi ll b fi me lq l lr ls">SELECT <br/> customer_id,<br/> product_name<br/>FROM ranking<br/>WHERE ranks = 1;</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es mw"><img src="../Images/98ad759ee93251066fc769d0c34812c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*Ifb9LmMY1zDU5fgZ87wSog.jpeg"/></div></figure><p id="218e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在成为丹尼餐馆的会员之前，a点了咖喱，B点了寿司。</p><p id="b70a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 7。顾客在成为会员之前购买了哪件商品？</strong></p><p id="2033" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和上面一样，只有几处改动。</p><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="8781" class="jf jg hi ll b fi lp lq l lr ls">WITH ranking AS (<br/>SELECT<br/> customer_id,<br/> order_date,<br/> join_date,<br/> product_name,<br/> DENSE_RANK() OVER(PARTITION BY customer_id<br/>                   ORDER BY order_date DESC) AS ranks<br/>FROM member_menu_table<br/>WHERE order_date &lt; join_date<br/>)</span><span id="10a3" class="jf jg hi ll b fi me lq l lr ls">SELECT <br/> customer_id,<br/> product_name<br/>FROM ranking<br/>WHERE ranks = 1;</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es mx"><img src="../Images/be4ebf58ddbe82d5e9e6f6a125631642.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*UJWXLjfneC5PiMSymKjJqw.jpeg"/></div></figure><p id="3252" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a点了寿司和咖喱，而B在成为会员前点了寿司。</p><p id="a84e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 8。每位会员在成为会员前的总物品和消费金额是多少？</strong></p><p id="e366" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从members_menu_table中，我们可以对在成为会员之前订购的客户进行分组。</p><ul class=""><li id="5e72" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc kk kl km kn bi translated">过滤order_date &lt; join_date</li><li id="1ae4" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">Group By customers</li><li id="d592" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">Count unique items</li><li id="5374" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">Total the price.</li></ul><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="d28d" class="jf jg hi ll b fi lp lq l lr ls">SELECT<br/> customer_id,<br/> COUNT( DISTINCT product_name) AS total_items,<br/> SUM(price) AS total_amount<br/>FROM member_menu_table<br/>WHERE order_date &lt; join_date<br/>GROUP BY customer_id;</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es my"><img src="../Images/4f64afd88a41ddefbc3ee067014b28b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*Yx4T2hNsSyCWgfX33AlXXQ.jpeg"/></div></figure><p id="bc97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">A has spent 25 £ on 2 unique items and B has spent 40£ on 2 unique items on the menu from danny’s diner.</p><p id="bc0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 9的数据。如果每消费1英镑相当于10个积分，寿司有一个2 *积分乘数-每个顾客会有多少个积分？</strong></p><p id="2e92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">问题很清楚</p><ul class=""><li id="c693" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc kk kl km kn bi translated">对于每个顾客来说，他们花的钱就是他们的积分</li><li id="d919" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">如果他们点了寿司，那么他们的分数会因为寿司的价格而翻倍。</li></ul><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="0b10" class="jf jg hi ll b fi lp lq l lr ls">SELECT <br/> customer_id,<br/> SUM(CASE when product_name = 'sushi' THEN 2*10*price ELSE 10*price END) AS total_points<br/>FROM customer_menu_table<br/>GROUP BY customer_id<br/>ORDER BY customer_id;</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es mz"><img src="../Images/c79f9c07df1ff1491e5779e18b062d77.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*eHOVcY1H7di0tgi8h184MQ.jpeg"/></div></figure><p id="424c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">客户A会有860分，B会有940分，C会有360分。</p><p id="3b09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 10。在客户加入计划后的第一周(包括他们的加入日期),他们在所有项目上都获得了2x积分，不仅仅是寿司——客户A和B在1月底获得了多少积分？</strong></p><ul class=""><li id="3d18" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc kk kl km kn bi translated">按客户分组和排序</li><li id="4e55" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">筛选数据，使其仅包含不晚于01–02–2021的日期。</li><li id="9049" class="kf kg hi ih b ii ko im kp iq kq iu kr iy ks jc kk kl km kn bi translated">根据问题中解释的条件选择总和</li></ul><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="d975" class="jf jg hi ll b fi lp lq l lr ls">SELECT<br/> customer_id,<br/> SUM (<br/>  CASE <br/>   WHEN order_date BETWEEN join_date AND ((join_date + INTERVAL '6 DAYS')::DATE)<br/>   THEN 2*10*price<br/>   WHEN product_name = 'sushi'<br/>   THEN 2*10*price <br/>   ELSE 10*price<br/>  END<br/>  ) AS total_points<br/>FROM member_menu_table<br/>WHERE order_date &lt; '2021-02-01'<br/>GROUP BY customer_id<br/>ORDER BY customer_id;</span></pre><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es mt"><img src="../Images/b0c7b7b5be3b7aaf9b7d0397a015f27c.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*mkKwHMhCITHUBinsfGI2Ww.jpeg"/></div></figure><p id="65d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">截止到一月份的入学考试，a有1370分，B有820分。</p><p id="1e52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，最后一个问题是生成一些basuc数据集，以便团队可以获得洞察力。</p><p id="dbf3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 11。使用可用数据重新创建下表:</strong></p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es na"><img src="../Images/e3d35a210b9f38b36d17cdd089ef4f34.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*g0rGnq9onHrhRtaThR3vxA.jpeg"/></div></figure><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="dd0e" class="jf jg hi ll b fi lp lq l lr ls">SELECT <br/> customer_id,<br/> order_date,<br/> product_name,<br/> price,<br/> (CASE WHEN order_date &gt;= join_date THEN 'Y'<br/>  ELSE 'N' END) AS member<br/>FROM member_menu_table<br/>ORDER BY customer_id,order_date;</span></pre><ul class=""><li id="f751" class="kf kg hi ih b ii ij im in iq kh iu ki iy kj jc kk kl km kn bi translated">因此，当我们根据order_date在join_date之后的时间对数据进行分组时，它们就会成为成员。</li></ul><p id="2ec6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 12。Danny还需要关于客户产品排名的进一步信息，但是他故意不需要非会员购买的排名，因此他希望当客户还不是忠诚度计划的一部分时记录的排名值为空</strong></p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es nb"><img src="../Images/43b93d1db2501195fa5b02edb62e93be.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*UuaaZ6maOxXpFfbOiQMpKA.jpeg"/></div></div></figure><pre class="ku kv kw kx fd lk ll lm ln aw lo bi"><span id="a429" class="jf jg hi ll b fi lp lq l lr ls">WITH members_list AS (<br/>SELECT <br/> customer_id,<br/> order_date,<br/> product_name,<br/> price,<br/> CASE WHEN order_date &gt;= join_date THEN 'Y'<br/>  ELSE 'N' END AS member<br/>FROM member_menu_table<br/>ORDER BY customer_id,order_date; <br/>)</span><span id="b30a" class="jf jg hi ll b fi me lq l lr ls">SELECT *, <br/>CASE<br/> WHEN member = 'Y' THEN DENSE_RANK () OVER(PARTITION BY customer_id, member ORDER BY order_date) <br/> ELSE NULL<br/> END AS ranking<br/>FROM members_list;</span></pre><p id="1d8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是前面的延续，danny想对成员进行排序，所以我们可以根据order_date对成员进行排序。</p><p id="01f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对我来说，这真是一个有趣的项目，整个旅途都很愉快。如果你有任何反馈，一定要让我知道，因为这将非常有帮助。</p><p id="dcd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每天学习和探索新事物。</p></div></div>    
</body>
</html>