<html>
<head>
<title>React + Redux: Higher-order reducers with combineReducers()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React + Redux:带有组合减速器的高阶减速器()</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/react-redux-higher-order-reducers-with-combinereducers-3ffd151b1060?source=collection_archive---------43-----------------------#2021-05-25">https://medium.com/geekculture/react-redux-higher-order-reducers-with-combinereducers-3ffd151b1060?source=collection_archive---------43-----------------------#2021-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8ea1c1336429e73ed105a6baac995965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*meCFnZ5MK_7Fu1ogYfBvNQ.png"/></div></div></figure><p id="2fc1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在React应用程序中使用Redux进行全局状态管理是一个彻底的游戏改变者——您不再需要有策略地在一个不断扩大(并且令人困惑)的本地状态网络中导航，以将正确的数据提供给正确的组件。但是伴随着强大的力量而来的是巨大的责任……比如坚持单一责任原则(也就是<a class="ae jo" href="https://en.wikipedia.org/wiki/SOLID" rel="noopener ugc nofollow" target="_blank">中的S固体</a>)！在本文中，我们将介绍如何确保您的应用程序符合<a class="ae jo" href="https://en.wikipedia.org/wiki/Separation_of_concerns" rel="noopener ugc nofollow" target="_blank"> SoC </a>，同时仍然利用Redux的强大功能。</p><p id="f817" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将用来演示这一点的示例应用程序是我最近为<a class="jp jq ge" href="https://medium.com/u/973c5cbfb09b?source=post_page-----3ffd151b1060--------------------------------" rel="noopener" target="_blank">熨斗学校</a>的软件工程课程模块5完成的一个<a class="ae jo" href="https://github.com/bfirestone23/gif-library" rel="noopener ugc nofollow" target="_blank"> GIF库应用程序</a>。该应用程序允许用户创建帐户/登录，搜索GIPHY的API，并在他们创建的集合中添加/删除gif。然后，用户可以复制该GIF的链接，与朋友分享，或者“喜欢”吸引他们眼球的收藏。基本上，这是一种用户友好的方式来组织你最喜欢的GIF并与朋友分享(因为我们总是在寻找任何给定时刻的完美GIF，对吗？).</p><h2 id="2833" class="jr js hi bd jt ju jv jw jx jy jz ka kb jb kc kd ke jf kf kg kh jj ki kj kk kl bi translated">设置场景</h2><p id="1342" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">当务之急是决定如何让你的减压器发挥作用。本质上，您应该问问自己——哪些Redux操作操纵了我的全局状态的哪一部分？以我的用户缩减器为例，让我们来看看你的目标是什么:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="3932" class="jr js hi kw b fi la lb l lc ld">const user = (state = { status: 'pending' }, action) =&gt; {<br/>    switch (action.type) {<br/>        case 'setStatus':<br/>            return { ...state, status: action.payload }<br/>        case 'setUser':<br/>            return { ...action.payload, status: 'resolved' }<br/>        case 'noUser':<br/>            return { status: 'idle' };<br/>        case 'logout':<br/>            return { status: 'idle' }<br/>        default:<br/>            return state;<br/>    }<br/>}</span><span id="5743" class="jr js hi kw b fi le lb l lc ld">export default user;</span></pre><p id="82ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您会注意到，这个缩减器只影响它可以访问的Redux状态部分，反之亦然。足球之神很高兴！</p><p id="176d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，冲洗并重复其余的Redux动作。我的应用程序利用了收藏、gifSearch和用户缩减器——注意这些是如何与单个应用程序功能保持一致的，从而使应用程序保持坚实和直观的结构。</p><h2 id="5b84" class="jr js hi bd jt ju jv jw jx jy jz ka kb jb kc kd ke jf kf kg kh jj ki kj kk kl bi translated">减少减速器</h2><p id="faa0" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">所以你已经把你的reducer分开了(理想的是在“reducer”文件夹中，duh)并且问你自己，“好的，那么我们如何把这些和Redux存储连接起来？”。</p><p id="1bfb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，在reducers文件夹中创建一个新的<code class="du lf lg lh kw b">index.js</code>文件。在这里，您需要导入每个单独的缩减器，加上Redux库中的combineReducers函数，就像这样:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="4315" class="jr js hi kw b fi la lb l lc ld">import gifSearch from './gifSearch';</span><span id="0363" class="jr js hi kw b fi le lb l lc ld">import collection from './collection';</span><span id="535d" class="jr js hi kw b fi le lb l lc ld">import user from './user';</span><span id="15fc" class="jr js hi kw b fi le lb l lc ld">import { combineReducers } from 'redux';</span></pre><p id="631d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们将定义一个变量<code class="du lf lg lh kw b">rootReducer</code>(确保它被导出，这样我们就可以在我们的<code class="du lf lg lh kw b">store.js</code>文件中访问它)并将它设置为<code class="du lf lg lh kw b">combineReducers</code>的值，每个单独的缩减器都被传入:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="14bb" class="jr js hi kw b fi la lb l lc ld">export const rootReducer = combineReducers({ collection, gifSearch, user })</span></pre><h2 id="b372" class="jr js hi bd jt ju jv jw jx jy jz ka kb jb kc kd ke jf kf kg kh jj ki kj kk kl bi translated">把所有的放在一起</h2><p id="53f8" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">现在是时候把我们的<code class="du lf lg lh kw b">rootReducer</code>挂在我们的商店了——最后一程。你的<code class="du lf lg lh kw b">store.js</code>文件应该看起来像这样，一旦说了和做了(我使用的是Redux devtools Chrome扩展，它是<code class="du lf lg lh kw b">compose()</code>函数的可选的第二个参数):</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="8176" class="jr js hi kw b fi la lb l lc ld">import { createStore, compose, applyMiddleware } from 'redux';</span><span id="4a8d" class="jr js hi kw b fi le lb l lc ld">import thunk from 'redux-thunk';</span><span id="13c1" class="jr js hi kw b fi le lb l lc ld">import { rootReducer } from './reducers/index';</span><span id="18ac" class="jr js hi kw b fi le lb l lc ld">export function configureStore() {</span><span id="d391" class="jr js hi kw b fi le lb l lc ld">    return createStore(</span><span id="7892" class="jr js hi kw b fi le lb l lc ld">        rootReducer,</span><span id="2224" class="jr js hi kw b fi le lb l lc ld">        compose(</span><span id="bc7c" class="jr js hi kw b fi le lb l lc ld">            applyMiddleware(thunk),</span><span id="80f8" class="jr js hi kw b fi le lb l lc ld">            window.__REDUX_DEVTOOLS_EXTENSION__ &amp;&amp;</span><span id="d404" class="jr js hi kw b fi le lb l lc ld">                window.__REDUX_DEVTOOLS_EXTENSION__()</span><span id="8288" class="jr js hi kw b fi le lb l lc ld">        )</span><span id="8c18" class="jr js hi kw b fi le lb l lc ld">    );</span><span id="4114" class="jr js hi kw b fi le lb l lc ld">}</span><span id="b365" class="jr js hi kw b fi le lb l lc ld">export const store = configureStore();</span></pre><p id="c75e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，假设您的存储被传递到您的<code class="du lf lg lh kw b">&lt;Provider&gt;</code>组件中，您已经准备好了！</p><p id="69f6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不过，在退出之前还有最后一点需要注意——无论您在哪里通过mapStateToProps访问状态，您现在都需要指定您正在访问哪个缩减器，如下所示:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="381c" class="jr js hi kw b fi la lb l lc ld">const mapStateToProps = state =&gt; {<br/>  return { <br/>    collections: state.collection.collections,<br/>    activeCollection: state.collection.activeCollection,<br/>    status: state.user.status,<br/>    username: state.user.username <br/>  }<br/>}</span></pre><p id="c08b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有了它，你的Redux状态不再是由几十行代码组成的令人费解的混乱——随着你的应用不断增长，你的应用、你的同事和你的大脑都会为此感谢你。这篇文章只是触及了表面，为了更深入地理解像<code class="du lf lg lh kw b">combineReducers</code>这样的功能在做什么，一定要查看一下<a class="ae jo" href="https://redux.js.org/recipes/structuring-reducers/using-combinereducers" rel="noopener ugc nofollow" target="_blank"> Redux文档</a>。</p></div></div>    
</body>
</html>