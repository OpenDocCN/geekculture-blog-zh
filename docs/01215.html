<html>
<head>
<title>Lock Your Dependencies With Docker: How This Saved My Old Project React Native Android Build</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">锁定你的依赖Docker:这如何拯救我的旧项目反应原生Android构建</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-docker-saved-my-old-project-react-native-android-build-1edf3fe02f4b?source=collection_archive---------23-----------------------#2021-04-01">https://medium.com/geekculture/how-docker-saved-my-old-project-react-native-android-build-1edf3fe02f4b?source=collection_archive---------23-----------------------#2021-04-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d540e90969cf92cf6ae13b92552168d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ylMIjWlTuLByoVyZ"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@kellysikkema?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kelly Sikkema</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><blockquote class="iv iw ix"><p id="1044" class="iy iz ja jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">“编程是关于管理复杂性的:问题的复杂性，取决于机器的复杂性。由于这种复杂性，我们的大多数编程项目都失败了。”~ <a class="ae iu" href="https://www.goodreads.com/author/quotes/40523.Bruce_Eckel" rel="noopener ugc nofollow" target="_blank">布鲁斯·埃凯尔</a></p></blockquote><p id="beb9" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">我们都有这样的噩梦，一个老项目因为某种原因从坟墓里回来了。</p><p id="a4df" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">几天前，我接到一个从未支付过维护费用的客户的电话，要求“<em class="ja">做一个简单的编辑</em>”。这很简单，我只需要编辑一个正则表达式并触发一个构建。</p><p id="c24f" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">在这个简单的编辑之后，等待的是Android Studio版本。一旦我按下那个按钮，我所有的问题就开始了。</p><p id="5acf" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">上一次提交项目是在一年多以前，即19年9月。根据npm资料库，该项目有:20个主要更新，12个次要更新和6个补丁。</p><p id="263d" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">更新所有东西不是一个选项:客户不想为此付费。所以我必须想办法以最快的方式完成这个项目。</p><h1 id="349b" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">重建919环境</h1><p id="ae7e" class="pw-post-body-paragraph iy iz hi jb b jc ky je jf jg kz ji jj jx la jm jn jy lb jq jr jz lc ju jv jw hb bi translated">这是一个挑战，在不破坏现有设置的情况下重建我在19年9月的设置。</p><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es ld"><img src="../Images/cec4338305527405a41bd6311a6ba42e.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*S4fD1k553G_GZFp2PDqBcw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx"><a class="ae iu" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank">Docker</a>: Package Software into Standardized Units for Development, Shipment and Deployment</figcaption></figure><p id="82fe" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">最近不到3个月，开始用docker。我真的很想学习Docker和容器化是如何工作的，但是我没有足够的时间，所以我接受了“先使用，后学习”的理念。</p><p id="dfb0" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">我从来没有考虑过用它来做Android开发，但是…为什么不呢？</p><p id="e112" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">我不是一个码头工人，所以我开始在谷歌上搜索，我发现了一个有趣的Github库，来自react-native-community。</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="61a4" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">我从存储库中抓取了<code class="du lk ll lm ln b">Dockerfile</code>并把它放在我的项目中。</p><p id="f00b" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">这是一个起点。现在我需要调整:</p><ul class=""><li id="46e5" class="lo lp hi jb b jc jd jg jh jx lq jy lr jz ls jw lt lu lv lw bi translated">我不需要巴克，所以我把它拿掉了。</li><li id="c4b2" class="lo lp hi jb b jc lx jg ly jx lz jy ma jz mb jw lt lu lv lw bi translated">我不需要NDK，也扔掉了。</li><li id="eedd" class="lo lp hi jb b jc lx jg ly jx lz jy ma jz mb jw lt lu lv lw bi translated">依赖版本不是我需要的，所以我改变了它们。</li></ul><p id="d242" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">经过这些调整，我没有改变任何东西。</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="mc lj l"/></div></figure><p id="3b82" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">现在构建容器并运行它！</p><pre class="le lf lg lh fd md ln me mf aw mg bi"><span id="bc9f" class="mh kb hi ln b fi mi mj l mk ml"><strong class="ln hj">docker build -t</strong> <em class="ja">project-android-build .</em></span></pre><p id="d7a2" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">在我的环境中，WSL2上有4个内核和2048MB内存，需要816.3秒。</p><pre class="le lf lg lh fd md ln me mf aw mg bi"><span id="2756" class="mh kb hi ln b fi mi mj l mk ml"><strong class="ln hj">docker run</strong> <strong class="ln hj">--name=</strong><em class="ja">running_container</em> <strong class="ln hj">-v</strong> <em class="ja">F:\Projects\my-app:/app</em> <strong class="ln hj">-it</strong> <em class="ja">project-android-build</em></span></pre><p id="44d2" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">我有我的919环境！</p><h1 id="1919" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">是时候建造了</h1><p id="98c4" class="pw-post-body-paragraph iy iz hi jb b jc ky je jf jg kz ji jj jx la jm jn jy lb jq jr jz lc ju jv jw hb bi translated">一切都准备好了。我需要安装与<code class="du lk ll lm ln b">yarn install</code>的依赖关系，并触发我的项目的构建</p><pre class="le lf lg lh fd md ln me mf aw mg bi"><span id="308b" class="mh kb hi ln b fi mi mj l mk ml"><strong class="ln hj">cd </strong><em class="ja">android </em><strong class="ln hj">&amp;&amp; ./gradlew</strong> <em class="ja">clean </em>&amp;&amp; <strong class="ln hj">cd ..</strong> &amp;&amp; <strong class="ln hj">npx jetify</strong> &amp;&amp; <strong class="ln hj">cd </strong><em class="ja">android </em>&amp;&amp; <strong class="ln hj">./gradlew</strong> <em class="ja">bundleRelease</em></span></pre><p id="8b8f" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">如果你像我一样幸运，你最终会准备好你的包裹。</p><h1 id="f2a9" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">关于码头工人的最后一点思考</h1><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/9b4ce73bf93abb59f08f329a9b074f35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eZU-8jDro0l54486"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@ugurpeker?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ugur Peker</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="01ba" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">嗯，如果我必须用几句话来总结我的想法，我会说“<em class="ja">太棒了</em>”。</p><p id="fefd" class="pw-post-body-paragraph iy iz hi jb b jc jd je jf jg jh ji jj jx jl jm jn jy jp jq jr jz jt ju jv jw hb bi translated">Docker提供了一个简单的一次性开发环境，你可以在任何需要的时候使用它，最后，在需要的时候反复使用。这很神奇，因为即使这个项目暂时被搁置，下次我需要编辑另一个正则表达式时，我可以再次旋转容器并重新构建。如果每面镜子都保持不动，我甚至可以删除图像并重建它。这就是，在我看来，docker的真正力量，设置你的环境，改变你的项目！</p></div></div>    
</body>
</html>