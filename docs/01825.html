<html>
<head>
<title>Python - Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">蟒蛇皮烧瓶</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/python-flask-d06ca67be51b?source=collection_archive---------11-----------------------#2021-04-25">https://medium.com/geekculture/python-flask-d06ca67be51b?source=collection_archive---------11-----------------------#2021-04-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="71d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">托管自己的API。</p><p id="121f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Flask </strong>是一个web应用框架。它有时也被称为微框架，因为它保持API核心非常简单。</p><p id="d4b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章将主要关注Flask框架的应用。如果你想了解更多，这里是烧瓶文档的<a class="ae jd" href="https://flask.palletsprojects.com/en/1.1.x/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="je">链接</em> </strong> </a>。</p><p id="9427" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将使用<strong class="ih hj"> Postman </strong>来测试API。了解更多<strong class="ih hj">邮差</strong>点击<a class="ae jd" href="https://learning.postman.com/docs/getting-started/introduction/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="je">这里</em> </strong> </a>。</p><ol class=""><li id="cbd7" class="jf jg hi ih b ii ij im in iq jh iu ji iy jj jc jk jl jm jn bi translated">让我们从Python中一个函数的“hello world”示例开始:</li></ol><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="b2d7" class="jx jy hi jt b fi jz ka l kb kc">def hello_world():<br/>   return "Hello World"</span></pre><p id="d79a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以使用Flask通过网络访问该功能:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="785c" class="jx jy hi jt b fi jz ka l kb kc">from flask import Flask<br/>app = Flask(__name__)<br/><br/>@app.route('/')<br/>def hello_world():<br/>   return "Hello World"<br/><br/>if __name__ == '__main__':<br/>   app.run()</span></pre><ul class=""><li id="5d4a" class="jf jg hi ih b ii ij im in iq jh iu ji iy jj jc kd jl jm jn bi translated">在上面的代码中，我们创建了一个Flask对象“app”。“__name__”是Flask所需的输入，它只是编写代码的python脚本的名称。示例:如果脚本的名称是“app.py”，那么我们也可以将Flask对象初始化为:<br/><strong class="ih hj"><em class="je">app = Flask(" app ")</em></strong></li><li id="8f67" class="jf jg hi ih b ii ke im kf iq kg iu kh iy ki jc kd jl jm jn bi translated">@app.route('/')是decorator，它将函数绑定到服务器URL。参数“/”规定了服务器上函数的路径，即根目录。“<strong class="ih hj">方法</strong>”参数可以限制对特定方法的请求。我们可以通过将代码从@app.route('/')更改为@app.route('/'，methods=["GET "，" POST"])来做到这一点</li><li id="81aa" class="jf jg hi ih b ii ke im kf iq kg iu kh iy ki jc kd jl jm jn bi translated">app.run()该方法在本地开发服务器上运行应用程序。它有“<strong class="ih hj"> <em class="je">主机</em> </strong>”和“<strong class="ih hj"> <em class="je">端口</em> </strong>”作为其参数，分别默认为“127.0.0.1”和5000。</li><li id="89d0" class="jf jg hi ih b ii ke im kf iq kg iu kh iy ki jc kd jl jm jn bi translated">如果我们运行这个python脚本，我们将能够通过URL "<strong class="ih hj"><em class="je">http://127 . 0 . 0 . 1:5000/</em></strong>"访问这个函数，这是Flask中的默认设置。(如果希望将功能暴露给外部网络“<strong class="ih hj"> <em class="je">”主机</em> </strong>”应改为“0.0.0.0”，反映外部网络上的机器IP)</li></ul><figure class="jo jp jq jr fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kj"><img src="../Images/35edf7615715e44d35c3eac265cf441c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kqgdMimMUt2LQ1NAU5F8Gg.png"/></div></div></figure><p id="50c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到Flask服务器已经启动并正在运行。现在让我们试着从<strong class="ih hj">邮递员</strong>那里ping服务器。</p><figure class="jo jp jq jr fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kr"><img src="../Images/27d5d841ae5b50e61727a7a6eaa6f576.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mh7iVJfNPPxeKqpW7CHwbQ.png"/></div></div></figure><p id="68f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到，在ping到服务器URL后，我们得到了“Hello World”作为我们的响应。这意味着我们的API运行良好。</p><p id="62a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.让我们检查另一个用例，例如，如果用户ping URL“http://127 . 0 . 0 . 1:5000/Chuck”，它应该返回“Hello Chuck”。URL应该只接受“POST”方法，函数应该通过网络对外公开。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="418a" class="jx jy hi jt b fi jz ka l kb kc">from flask import Flask<br/>app = Flask("app")<br/><br/>@app.route('/&lt;name&gt;',methods=['POST'])<br/>def hello_name(name):<br/>   return "Hello {}".format(name)<br/><br/>if __name__ == '__main__':<br/>   app.run(host="0.0.0.0",port=5586)</span></pre><figure class="jo jp jq jr fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es ks"><img src="../Images/d77ec3616e30db3df0fd2d311b2948d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lokkp3SChQfmeii16Vjs5Q.png"/></div></div></figure><ul class=""><li id="ea43" class="jf jg hi ih b ii ij im in iq jh iu ji iy jj jc kd jl jm jn bi translated">我们可以看到'<strong class="ih hj"> GET </strong>方法对于这个API是被阻塞的，因为我们已经特别提到“<strong class="ih hj"> POST </strong>方法是唯一有效的方法。</li></ul><figure class="jo jp jq jr fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kt"><img src="../Images/1efafea7eb6af70edaa0ddc77bb706ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y3WYeGsdd0kFwqrsS3yOLg.png"/></div></div></figure><ul class=""><li id="7cee" class="jf jg hi ih b ii ij im in iq jh iu ji iy jj jc kd jl jm jn bi translated">在<strong class="ih hj">邮递员<em class="je"> </em> </strong>中，将方法改为<strong class="ih hj"> POST </strong>，我们就可以访问这个函数，它会按照预期返回一个响应<strong class="ih hj"> <em class="je">。</em>T9】</strong></li><li id="9ec4" class="jf jg hi ih b ii ke im kf iq kg iu kh iy ki jc kd jl jm jn bi translated">这段代码是动态URL的经典例子。@app.route("/ <name>")中的"<name>"表示代替"<name>"的字符串成为" hello_name "函数的参数" name "的值。</name></name></name></li></ul><p id="a07c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.我们现在将创建一个API来上传一个图像，并得到调整大小的图像作为回报。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="7a0e" class="jx jy hi jt b fi jz ka l kb kc">from flask import Flask,request,send_file<br/>import numpy as np<br/>import cv2<br/>app = Flask("app")<br/><br/>@app.route('/',methods=['GET','POST'])<br/>def resize():<br/>    if 'image' in request.files:<br/>        img = request.files['image']<br/>        img = img.read()<br/>        img = np.fromstring(img,np.uint16)<br/>        img = cv2.imdecode(img,cv2.IMREAD_COLOR)<br/>        img = cv2.resize(img,(200,200))<br/>        cv2.imwrite('tmp.jpg',img)<br/>        return send_file('tmp.jpg')<br/>    else:<br/>        return {'error':'image not found'}<br/><br/><br/>if __name__ == '__main__':<br/>   app.run(host="0.0.0.0",port=5586)</span></pre><ul class=""><li id="737a" class="jf jg hi ih b ii ij im in iq jh iu ji iy jj jc kd jl jm jn bi translated">为了完成这个任务，我们从flask模块中导入"<strong class="ih hj"> <em class="je"> request" </em> </strong>，"<strong class="ih hj"> send_file </strong>"对象。<strong class="ih hj"> request </strong>对象帮助我们读取输入文件，“<strong class="ih hj"> send_file </strong>对象用于返回一个<strong class="ih hj">文件</strong>作为响应。</li><li id="8d38" class="jf jg hi ih b ii ke im kf iq kg iu kh iy ki jc kd jl jm jn bi translated">当我们从对服务器的请求中接收到一个文件时，它的类型是:"<strong class="ih hj"> <em class="je"> &lt;文件存储:'例如。“‘JPG’(‘图片/JPEG’)&gt;</em></strong>”</li><li id="62d1" class="jf jg hi ih b ii ke im kf iq kg iu kh iy ki jc kd jl jm jn bi translated">”<strong class="ih hj">。read() </strong>"方法将文件类型改为bytes:"<strong class="ih hj">b ' \ xff \ xd8 \ xff \ xe0 \ x00 \ X10 jfif \ x00 \ x01 \ x00 \ x00x \ x00 \ xff \ xe1 \ X10 \ xf4 EXIF \ x00 \ x00 mm \ x00 * \ x00 \ x00 \ x08 \ x00 \ x04 \ x01；\ x00 \ x02 \ x00 \ x00 \ x00 \ x0e \ x00 \ x08J \ x87i \ x00 \ x04 \ x00 ' "</strong></li><li id="c6d8" class="jf jg hi ih b ii ke im kf iq kg iu kh iy ki jc kd jl jm jn bi translated">"<strong class="ih hj"> np.fromstring() </strong>"将字节更改为一维numpy数组:"<strong class="ih hj">[5551 57599 4096 17994 17993 256 257 30720 30720 0 0 57855 62480，30789 26217 0 19789 10752 0 2048 1024 15105 512 0 3580 </strong>“</li><li id="3feb" class="jf jg hi ih b ii ke im kf iq kg iu kh iy ki jc kd jl jm jn bi translated">"<strong class="ih hj">cv2 . im decode()</strong>"(opencv)从一维numpy数组中解码原始图像。</li><li id="3fd3" class="jf jg hi ih b ii ke im kf iq kg iu kh iy ki jc kd jl jm jn bi translated">当我们将一幅图像转换成合适的格式时，我们可以对它应用“<strong class="ih hj">resize”</strong>功能或任何其他图像功能。</li><li id="cae4" class="jf jg hi ih b ii ke im kf iq kg iu kh iy ki jc kd jl jm jn bi translated">调整图像大小后，我们将它保存为一个临时文件，然后将该文件作为API响应发送。</li></ul><p id="cb00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的输入图像:</p><figure class="jo jp jq jr fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es ku"><img src="../Images/bf4cac644d4cd5e04b2378d21a7d27e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fDauy82Cnfw98v7VMRY8jQ.png"/></div></div></figure><p id="00d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出响应:</p><figure class="jo jp jq jr fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kv"><img src="../Images/d2fe4215be1656d8125541c127b3d2eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jg3bToXPYgvVtr6786zTEQ.png"/></div></div></figure><p id="5edb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.让我们探索另一个用例，我们有一个输入csv文件，输出应该是它的维度。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="bd9b" class="jx jy hi jt b fi jz ka l kb kc">from flask import Flask,request,send_file<br/>import pandas as pd<br/>app = Flask("app")<br/><br/>@app.route('/shape',methods=['GET','POST'])<br/>def shape():<br/>    if 'csv' in request.files:<br/>        csv = request.files['csv']<br/>        csv = pd.read_csv(csv)<br/>        return "shape: {}".format(csv.shape)<br/>    else:<br/>        return {'error':'csv not found'}<br/><br/><br/>if __name__ == '__main__':<br/>   app.run(host="0.0.0.0",port=5586)</span></pre><ul class=""><li id="8906" class="jf jg hi ih b ii ij im in iq jh iu ji iy jj jc kd jl jm jn bi translated">pandas库的“read_csv”方法管理csv文件从“<strong class="ih hj"> <em class="je">【文件存储】</em> </strong>类型到数据帧的转换。</li><li id="1501" class="jf jg hi ih b ii ke im kf iq kg iu kh iy ki jc kd jl jm jn bi translated">我在装饰路径中添加了“<strong class="ih hj"> shape </strong>”，所以现在要向这个API发送请求，URL 应该是“<strong class="ih hj">http://0 . 0 . 0:5586/shape</strong>”。</li></ul><figure class="jo jp jq jr fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kw"><img src="../Images/d248a79600a0cc5481849d71d029eae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PB9f6nbtVhhRkDwe1zSUFg.png"/></div></div></figure><p id="fd80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这篇文章能帮助你学习<strong class="ih hj"> Flask web应用框架</strong>的基本概念。</p><p id="3990" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是所有的乡亲。</p></div></div>    
</body>
</html>