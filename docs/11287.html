<html>
<head>
<title>Filtering Some Methods on Swagger By PermissionID on .Net 6.0</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">按上的PermissionID筛选Swagger上的一些方法。Net 6.0</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/filtering-some-methods-on-swagger-by-permissionid-on-net-6-0-ea6b4b2b6f55?source=collection_archive---------1-----------------------#2022-03-15">https://medium.com/geekculture/filtering-some-methods-on-swagger-by-permissionid-on-net-6-0-ea6b4b2b6f55?source=collection_archive---------1-----------------------#2022-03-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/927509984d18dad299dfaa522cad1235.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HXHsf0eyhG7btmwKUlMmTA.jpeg"/></div></div></figure><p id="1a59" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">今天我们将讨论如何过滤狂妄自大。如下所示，我们的swagger文档是公开的，每个人都可以看到。但是，如果我们不希望一些方法被一些客户用于安全或业务决策，该怎么办呢？</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jo"><img src="../Images/e6ce0d868e1fbc8d84b92fd464e16b4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0xXAF9PTiAgp8_j1p4etMw.png"/></div></div></figure><blockquote class="jt ju jv"><p id="153d" class="iq ir jw is b it iu iv iw ix iy iz ja jx jc jd je jy jg jh ji jz jk jl jm jn hb bi translated">Swashbuckle。application . swaggerdocsconfig . document filter()</p></blockquote><p id="3518" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Swagger方法可以被过滤，通过使用“<strong class="is hj"> <em class="jw">【文档过滤器】</em> </strong>”。<strong class="is hj">的关键是<em class="jw"> swaggerDoc。路径</em> </strong>”。Swagger通过路径识别方法。我们称之为路由。在下面，我们看到“GetAllUsersByTable()”方法的路由。所以swagger知道这个方法为"<strong class="is hj">/user/getallusersbytable/{ tablename }</strong>"</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ka"><img src="../Images/1f035ab57de20803392104a48b93e1c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ADdL8EsDk-xrENfyshHyUQ.png"/></div></div></figure><p id="1587" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们想对一些用户隐藏这个方法，我们必须对swagger说不要通过它的路径带来这个方法。</p><pre class="jp jq jr js fd kb kc kd ke aw kf bi"><span id="c8a3" class="kg kh hi kc b fi ki kj l kk kl">swaggerDoc.Paths.Remove("<strong class="kc hj">/user/getallusersbytable/{tablename}</strong>")</span></pre><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es km"><img src="../Images/c840ad5cb1e40f2446f965148fd348e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*xVJ0w1T_1FUlPEOfLa8o5w.gif"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Swagger Filter By UrlID</figcaption></figure><h1 id="62b3" class="kr kh hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">通过Swagger文档(键)方法的路径填充SQL表:</h1><p id="9e78" class="pw-post-body-paragraph iq ir hi is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">首先，我们需要收集所有这些swagger文档键，并在SQL表中使用uniqueID。如下创建Swagger_Service表。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/044c0146d75d911bfec53f63f31e87ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*u7TtdxKDjClRRxzGvNzhgQ.png"/></div></figure><pre class="jp jq jr js fd kb kc kd ke aw kf bi"><span id="55bf" class="kg kh hi kc b fi ki kj l kk kl">CREATE TABLE [dbo].[SWAGGER_SERVICE](<br/>[Id] [int] IDENTITY(1,1) NOT NULL,<br/>[ServiceKey] [nvarchar](500) NOT NULL,<br/>[CreDate] [datetime] NOT NULL,<br/>[IsDeleted] [bit] NOT NULL,<br/>CONSTRAINT [PK_SwaggerService] PRIMARY KEY CLUSTERED<br/>(<br/>   [Id] ASC<br/>)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]<br/>) ON [PRIMARY]<br/>GO</span><span id="8595" class="kg kh hi kc b fi lu kj l kk kl">ALTER TABLE [dbo].[SWAGGER_SERVICE] ADD  CONSTRAINT [DF_SwaggerService_CreDate]  DEFAULT (getdate()) FOR [CreDate]<br/>GO</span><span id="1a8d" class="kg kh hi kc b fi lu kj l kk kl">ALTER TABLE [dbo].[SWAGGER_SERVICE] ADD  CONSTRAINT [DF_SwaggerService_IsDeleted]  DEFAULT ((0)) FOR [IsDeleted]<br/>GO</span></pre><p id="103c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">是时候自动填充这个Swagger_Service表了。</p><p id="fa67" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di"> D </span>我们将创建一个空的文档过滤器，如下所示。它继承了“<strong class="is hj"><em class="jw">IDocumentFilter</em></strong>”接口，实现了“<strong class="is hj"> <em class="jw"> Apply() </em> </strong>”方法。</p><p id="4ea4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">infra structure/customswaggerfilter . cs/Apply()(1):</strong></p><pre class="jp jq jr js fd kb kc kd ke aw kf bi"><span id="e38c" class="kg kh hi kc b fi ki kj l kk kl">public class CustomSwaggerFilter : IDocumentFilter<br/>{<br/>     public void Apply(OpenApiDocument swaggerDoc,  DocumentFilterContext context)<br/>{<br/>   //DO YOUR FILTERS<br/>}</span></pre><p id="4ac0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们必须将这个文件过滤器添加到Swagger中的"<strong class="is hj"><em class="jw">【startup . cs】</em></strong>"上的"<strong class="is hj"><em class="jw">【AddSwaggerGen()</em></strong>"方法中以保证安全。为了格外小心，我更喜欢在“<strong class="is hj"><em class="jw">【UseSwaggerUI()</em></strong>”方法上移除swagger文档末尾的所有方法方案，如下所示:</p><p id="83e5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Startup.cs: </strong></p><pre class="jp jq jr js fd kb kc kd ke aw kf bi"><span id="29b5" class="kg kh hi kc b fi ki kj l kk kl">services.AddSwaggerGen(c =&gt;<br/>{<br/>   c.DocumentFilter&lt;CustomSwaggerFilter&gt;();//For Swagger CustomFilter<br/>.<br/>.<br/>}</span><span id="970f" class="kg kh hi kc b fi lu kj l kk kl">app.UseSwagger()<br/>.UseSwaggerUI(c =&gt;<br/>{<br/>   c.DefaultModelsExpandDepth(-1);//Remove Schema on Swagger UI<br/>   .<br/>   .<br/>});</span></pre><p id="104c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">infra structure/customswaggerfilter . cs/Apply()(2):</strong></p><p id="2bdb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们创建了Swagger_Service表，它保存了所有方法的路径。我们创建了文档过滤器。现在是将所有数据一次性填充到MsSqlDB的时候了:)这个代码块必须只工作一次</p><ul class=""><li id="009c" class="me mf hi is b it iu ix iy jb mg jf mh jj mi jn mj mk ml mm bi translated">首先，我们从=&gt; " <strong class="is hj"> <em class="jw"> swaggerDoc中获取所有方法的路径。路径</em> </strong></li><li id="f99c" class="me mf hi is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm bi translated">我们将实体DBContext用于DB工具。我们通过使用"<em class="jw"> GetVbtContext() </em>"方法得到了DBContext，我将在下一章展示它。</li><li id="8674" class="me mf hi is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm bi translated">我们得到了所有的键，删除了“/api/”标签，并将所有的字符转换成小写以获得更可读的数据。</li><li id="cc3a" class="me mf hi is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm bi translated">SwaggerService是我们的实体模型。我们把它装满了，还有所有的钥匙。</li><li id="ee99" class="me mf hi is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm bi translated">add range(swagger list)= &gt; If(swagger list。Count &gt; 3)那么所有数据都将被批量插入到DB中，如果长度小于3，每个数据都将被逐个插入。Net 6.0 EntityFramework。</li></ul><p id="49d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">infra structure/customswaggerfilter . cs/Apply()(2):</strong></p><pre class="jp jq jr js fd kb kc kd ke aw kf bi"><span id="531b" class="kg kh hi kc b fi ki kj l kk kl">public void Apply(OpenApiDocument swaggerDoc, DocumentFilterContext context)<br/>{<br/>   //WORK ONCE! INSERT DB.SwaggerService<br/>   using (var dbContext = GetVbtContext("DefaultConnection"))<br/>   {<br/>      var swaggerList = (from keyPath in swaggerDoc.Paths<br/>                        select new SwaggerService<br/>                        {<br/>                            ServiceKey = keyPath.Key.Replace("/api/", "").ToLower()<br/>   }).ToList();</span><span id="c5d4" class="kg kh hi kc b fi lu kj l kk kl">      dbContext.SwaggerService.AddRange(swaggerList);<br/>      dbContext.SaveChanges();<br/>   }<br/>}<br/>//--------------------------------------------------</span></pre><p id="9afc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">基础设施/customswaggerfilter . cs/GetVbtContext():</strong></p><p id="35c0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是我们如何使用MsSqlDB操作创建实体VbtContext的方法。</p><pre class="jp jq jr js fd kb kc kd ke aw kf bi"><span id="983c" class="kg kh hi kc b fi ki kj l kk kl">public VbtContext GetVbtContext(string connection)<br/>{<br/>   string connectionString = new ConfigurationBuilder().AddJsonFile("appsettings.json").Build().GetConnectionString(connection);</span><span id="5cf7" class="kg kh hi kc b fi lu kj l kk kl">   var optionsBuilder = new DbContextOptionsBuilder&lt;DashboardContext&gt;();</span><span id="88d0" class="kg kh hi kc b fi lu kj l kk kl">   optionsBuilder.UseSqlServer(connectionString);<br/>   return new VbtContext(optionsBuilder.Options);<br/>}</span></pre><p id="3816" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们将所有键插入SWAGGER_SERVICE表之后，它们看起来如下。这些键都是我们在方法顶部声明的WebService路径。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ms"><img src="../Images/d7bef2e492b53ac7749b10f819635dc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DICCFj4B3hjwBRVzQxjczA.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">SWAGGER_SERVICE TABLE</figcaption></figure><p id="1e38" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di">C</span>T6】为用户允许的路径创建虚拟数据</p><p id="34c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在是时候创建虚拟数据了，谁能看到一些方法，谁不能。</p><p id="e081" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建"<strong class="is hj"> User_Swagger" </strong>表格如下:</p><ul class=""><li id="eeb4" class="me mf hi is b it iu ix iy jb mg jf mh jj mi jn mj mk ml mm bi translated">“UrlId”是每个用户的唯一Id。我们也可以使用“IdUser”。但是为了安全起见，我更喜欢每个用户至少6位数的唯一号码。我们将使用它，为每个用户过滤大摇大摆的路径。</li><li id="3048" class="me mf hi is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm bi translated">“IdUser”是用户的唯一ID。它与[数据库用户]表相关。</li><li id="dde5" class="me mf hi is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm bi translated">“IdSwagger”与“[SWAGGER_SERVICE]”表相关。</li></ul><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es mt"><img src="../Images/4f09471930d78e182cf197972f6019ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*LuMtw4sBPSA0W7IAtV0nSg.png"/></div></figure><pre class="jp jq jr js fd kb kc kd ke aw kf bi"><span id="a4df" class="kg kh hi kc b fi ki kj l kk kl">CREATE TABLE [dbo].[USER_SWAGGER](</span><span id="a086" class="kg kh hi kc b fi lu kj l kk kl">[Id] [int] IDENTITY(1,1) NOT NULL,<br/>[UrlId] [int] NULL,<br/>[IdUser] [int] NOT NULL,<br/>[IdSwagger] [int] NOT NULL,<br/>[CreDate] [datetime] NOT NULL,<br/>[IsDeleted] [bit] NOT NULL,</span><span id="0a7f" class="kg kh hi kc b fi lu kj l kk kl">CONSTRAINT [PK_USER_SWAGGER] PRIMARY KEY CLUSTERED<br/>(<br/>  [Id] ASC<br/>)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]<br/>) ON [PRIMARY]</span><span id="0e52" class="kg kh hi kc b fi lu kj l kk kl">GO<br/>ALTER TABLE [dbo].[USER_SWAGGER] ADD  CONSTRAINT [DF_USER_SWAGGER_CreDate]  DEFAULT (getdate()) FOR [CreDate]</span><span id="6b15" class="kg kh hi kc b fi lu kj l kk kl">GO<br/>ALTER TABLE [dbo].[USER_SWAGGER] ADD  CONSTRAINT [DF_USER_SWAGGER_IsDeleted]  DEFAULT ((0)) FOR [IsDeleted]</span><span id="e405" class="kg kh hi kc b fi lu kj l kk kl">GO<br/>ALTER TABLE [dbo].[USER_SWAGGER]  WITH CHECK ADD  CONSTRAINT [FK_USER_SWAGGER_DB_USER] FOREIGN KEY([IdUser]) REFERENCES [dbo].[DB_USER] ([IdUser])</span><span id="5b0c" class="kg kh hi kc b fi lu kj l kk kl">GO<br/>ALTER TABLE [dbo].[USER_SWAGGER] CHECK CONSTRAINT [FK_USER_SWAGGER_DB_USER]</span><span id="254d" class="kg kh hi kc b fi lu kj l kk kl">GO<br/>ALTER TABLE [dbo].[USER_SWAGGER]  WITH CHECK ADD  CONSTRAINT [FK_USER_SWAGGER_SWAGGER_SERVICE] FOREIGN KEY([IdSwagger]) REFERENCES [dbo].[SWAGGER_SERVICE] ([Id])</span><span id="f977" class="kg kh hi kc b fi lu kj l kk kl">GO<br/>ALTER TABLE [dbo].[USER_SWAGGER] CHECK CONSTRAINT [FK_USER_SWAGGER_SWAGGER_SERVICE]</span><span id="3679" class="kg kh hi kc b fi lu kj l kk kl">GO</span></pre><p id="8ac6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在是用虚拟数据填充“<strong class="is hj">User _ Swagger”</strong>表的时候了</p><p id="5c82" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> SqlServer(Row SQL): </strong>我们将执行这些查询来创建3个用户权限的虚拟数据，如下所示。</p><pre class="jp jq jr js fd kb kc kd ke aw kf bi"><span id="85d5" class="kg kh hi kc b fi ki kj l kk kl">INSERT INTO USER_SWAGGER (UrlId,IdUser,IdSwagger)<br/>SELECT LEFT(CAST(RAND()*1000000000+999999 AS INT),6) as UrlId,<br/>U.Id as IdUser,<br/>SS.Id as IdSwagger<br/>from [dbo].[SWAGGER_SERVICE] AS SS,Users as U<br/>WHERE SS.Id%2=0 and U.Id=1</span><span id="c2c9" class="kg kh hi kc b fi lu kj l kk kl">INSERT INTO USER_SWAGGER (UrlId,IdUser,IdSwagger)<br/>SELECT LEFT(CAST(RAND()*1000000000+999999 AS INT),6) as UrlId,<br/>U.Id as IdUser,<br/>SS.Id as IdSwagger<br/>from [dbo].[SWAGGER_SERVICE] AS SS,Users as U<br/>WHERE SS.Id%3=0 and U.Id=2</span><span id="875c" class="kg kh hi kc b fi lu kj l kk kl">INSERT INTO USER_SWAGGER (UrlId,IdUser,IdSwagger)<br/>SELECT LEFT(CAST(RAND()*1000000000+999999 AS INT),6) as UrlId,<br/>U.Id as IdUser,<br/>SS.Id as IdSwagger<br/>from [dbo].[SWAGGER_SERVICE] AS SS,Users as U<br/>WHERE SS.Id%10=0 and U.Id=3</span></pre><p id="f268" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们将所有数据插入USER_SWAGGER表之后，它们看起来如下。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/c23e5427520d674c902b8a29ad91ea62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*slwcZ7V1dm_q_aiwgJW73Q.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">USER_SWAGGER TABLE</figcaption></figure><p id="1bd1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di">F</span>T16】过滤招摇文件:</p><p id="0ba2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Startup.cs: </strong>首先，我们必须允许从Startup.cs上的项目的任何地方访问HttpContext，如下所示。</p><pre class="jp jq jr js fd kb kc kd ke aw kf bi"><span id="13f2" class="kg kh hi kc b fi ki kj l kk kl">services.AddHttpContextAccessor();</span></pre><p id="798b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">customswaggerfilter . cs:</strong></p><p id="c198" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们从URL中获取参数“<strong class="is hj"> <em class="jw"> Id </em> </strong>”，过滤掉霸气。</p><ul class=""><li id="3cec" class="me mf hi is b it iu ix iy jb mg jf mh jj mi jn mj mk ml mm bi translated">我们将通过使用HttpContextAccessor来获取当前的HttpContect。我们将使用它来获取URL路径。</li></ul><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/62ff8e65785f7440d1e33b5f75c35568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3aQHuTd9e3n2j1ANHzzD3Q.png"/></div></div></figure><ul class=""><li id="cc1b" class="me mf hi is b it iu ix iy jb mg jf mh jj mi jn mj mk ml mm bi translated">我们将通过使用“<strong class="is hj"> <em class="jw"> _httpContext </em> </strong>”来获取Url。并使用“<strong class="is hj"><em class="jw">PareQueryString()</em></strong>”方法解析URL中的ID。最后，我们将检查“<strong class="is hj"> id </strong>”是否为空。</li></ul><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mw"><img src="../Images/9921fc315c232313e36022babf51d05e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VtxsfCwMFpxcttSHy4fk4Q.png"/></div></div></figure><ul class=""><li id="ae8c" class="me mf hi is b it iu ix iy jb mg jf mh jj mi jn mj mk ml mm bi translated">我们将使用Entity 6.0进行数据库操作。于是我们就用“<strong class="is hj">使用{} </strong>创建了“<strong class="is hj"><em class="jw">”db context</em></strong>”。我们将使用唯一的Url参数Id从“<strong class="is hj"> <em class="jw"> UserSawagger </em> </strong>”表中获取所有用户可访问方法的路径。这是唯一的6位数[用户_招摇] UrlId。我们将它设置为swaggerKeys变量。</li></ul><p id="7f0b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">不:</strong>不要忘记使用"<strong class="is hj">asnottracking()</strong>"方法来提高实体性能，当只读取数据时。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/b61aba59ea6602673d1b7b78fbe9dc52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eOdoHNZIhzD77M5EgczURw.png"/></div></div></figure><ul class=""><li id="1325" class="me mf hi is b it iu ix iy jb mg jf mh jj mi jn mj mk ml mm bi translated">我们将从项目中排除所有不包含在用户允许的路径中的方法路径。长话短说，我们将获得这个用户的禁止路径。并且我们将从"<strong class="is hj"> <em class="jw"> swaggerDoc中移除这些被排除的路径。路径</em> </strong>“通过使用<strong class="is hj"> <em class="jw">【移除()</em> </strong>”的方法。最后，该用户将看不到一些不允许他或她访问的路径。</li></ul><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/9165e03cdcc32d1d794ebbf6f7d18818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bmS3QJSNJtFgcbf3iPKHMg.png"/></div></div></figure><p id="45ea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> CustomSwaggerFilter.cs: </strong></p><pre class="jp jq jr js fd kb kc kd ke aw kf bi"><span id="c9ff" class="kg kh hi kc b fi ki kj l kk kl">public class CustomSwaggerFilter : IDocumentFilter<br/>{<br/>   public HttpContext _httpContext =&gt; new HttpContextAccessor().HttpContext;</span><span id="59ed" class="kg kh hi kc b fi lu kj l kk kl">   public void Apply(OpenApiDocument swaggerDoc, DocumentFilterContext context)<br/>   {<br/>      //http://localhost:1923/swagger/index.html?id=12345</span><span id="474a" class="kg kh hi kc b fi lu kj l kk kl">      Uri url = new Uri(_httpContext.Request.Headers.Referer[0]);<br/>      string id = HttpUtility.ParseQueryString(url.Query).Get("id");<br/>      if (id != null)<br/>      {<br/>         using (var dbContext = GetVbtContext("DefaultConnection"))<br/>         {<br/>            var swaggerKeys = dbContext.UserSwagger.Where(us =&gt; us.UrlId == int.Parse(id)).Select(u =&gt; u.IdSwaggerNavigation.ServiceKey.Replace("/api/", "").ToLower()).AsNoTracking().ToList();<br/>        <br/>            var unPermittedMethods = swaggerDoc.Paths.Where(x =&gt; !swaggerKeys.Contains(x.Key.Replace("/api/", "").ToLower())).ToList();</span><span id="b00d" class="kg kh hi kc b fi lu kj l kk kl">            unPermittedMethods.ForEach(x =&gt; { swaggerDoc.Paths.Remove(x.Key); });<br/>         }<br/>      }<br/>   }<br/>}</span></pre><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="mz na l"/></div></figure><p id="00a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">结论:</strong></p><p id="1473" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Swagger是一份公开文件。但是在某些情况下，我们可能希望为特定的角色或用户隐藏一些路由。其中一件重要的事情是，保持对“USER_SWAGGER”表的更新。在工作过程中，可以删除或更新控制器。在开发期间，可以添加新的控制器。所以也许用微服务或者日常作业自动更新“USER_SWAGGER”表更好。</p><p id="bb73" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">出于安全原因，如果加密UrlID并在读取时解密，可能会更安全。因为一个可读的6位数容易记忆。</p><p id="b26f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我希望这篇文章能帮助您理解如何在swagger文档中过滤方法。下一篇文章再见。再见。</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="nb na l"/></div></figure><p id="a609" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jw">“如果你读到现在，首先感谢你的耐心和支持。欢迎大家来我的博客</em><a class="ae nc" href="http://www.borakasmer.com/" rel="noopener ugc nofollow" target="_blank"><em class="jw"/><strong class="is hj"><em class="jw"/></strong></a><strong class="is hj"><em class="jw"/></strong><em class="jw">了解更多！”</em></p><p id="76d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">来源:</strong></p><ul class=""><li id="2101" class="me mf hi is b it iu ix iy jb mg jf mh jj mi jn mj mk ml mm bi translated"><a class="ae nc" href="https://github.com/mattfrear/Swashbuckle.AspNetCore.Filters" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">https://github.com/mattfrear/Swashbuckle.AspNetCore.Filters</strong></a></li><li id="7b77" class="me mf hi is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm bi translated"><a class="ae nc" href="https://stackoverflow.com/questions/62858580/net-core-3-1-remove-schema-on-swagger-ui" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">https://stack overflow . com/questions/62858580/net-core-3-1-remove-schema-on-swagger-ui</strong></a></li><li id="8d44" class="me mf hi is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm bi translated"><a class="ae nc" href="https://stackoverflow.com/questions/29701573/how-to-omit-methods-from-swagger-documentation-on-webapi-using-swashbuckle" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">https://stack overflow . com/questions/29701573/how-to-omit-methods-from-swagger-documentation-on-webapi-using-swash buckle</strong></a></li><li id="6a43" class="me mf hi is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm bi translated"><a class="ae nc" href="https://corespider.com/blog/how-to-show-only-specific-apis-on-swagger-in-asp-net-core/" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">https://corespider . com/blog/how-to-show-only-specific-APIs-on-swagger-in-ASP-net-core/</strong></a></li></ul></div></div>    
</body>
</html>