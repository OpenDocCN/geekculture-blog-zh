<html>
<head>
<title>My First Attempt of Implementing Cryptocurrency Trading Bot using LSTM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我用LSTM实现加密货币交易机器人的第一次尝试</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/my-first-attempt-of-implementing-cryptocurrency-trading-bot-using-lstm-5eb108ebd545?source=collection_archive---------5-----------------------#2021-12-20">https://medium.com/geekculture/my-first-attempt-of-implementing-cryptocurrency-trading-bot-using-lstm-5eb108ebd545?source=collection_archive---------5-----------------------#2021-12-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="8073" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">当机器学习遇到加密货币</h2></div><p id="0280" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated">本文的目的是分享我使用python实现的纯监督机器学习技术实现简单加密货币交易机器人的方法。由于我不是加密货币和交易方面的专家，任何评论或建议都将非常感谢！</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es kc"><img src="../Images/3b2da8caebf05c5fcf4fc7c660348cc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iUM1yJYDIF_3-Hbs-ytRrA.jpeg"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx">Photo by <a class="ae ks" href="https://unsplash.com/@rocknrollmonkey?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Rock’n Roll Monkey</a> on <a class="ae ks" href="https://unsplash.com/s/photos/cryptocurrency-robot?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="874a" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">目标</h1><p id="dddf" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">目标是在仅给定历史价格输入的情况下，通过确定最佳买入时间和最佳卖出时间，最大化买入和卖出加密货币前后法定货币的平均百分比收益。</p><h1 id="7e65" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">限制</h1><ol class=""><li id="d06d" class="lq lr hi iz b ja ll jd lm jg ls jk lt jo lu js lv lw lx ly bi translated">如果当前操作是买入，下一个操作可以是卖出或者什么都不做。而如果当前动作是卖出，则下一个动作可以是买入或者什么都不做。</li><li id="83c2" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">每次我们购买加密货币时，我们花费相同数量的法定货币，每次我们出售加密货币时，我们出售我们手头的所有加密货币。</li><li id="199b" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">每当执行购买或出售动作时，有0.25%交易费。</li></ol><h1 id="66a4" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">实验设置和评估标准</h1><p id="a9a1" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">性能评估是通过回测各种加密货币(如BTC、BNB、瑞士法郎和长期货币)交易中法定货币的平均百分比收益来完成的。</p><p id="c9dd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我使用的分辨率是1分钟。20000次观察(1次观察= 1行= 1分钟)被分割成80:20的比例。80%即16000分钟(约11天)用于训练模型，而另外20%即4000分钟(约3天)用于测试模型性能。</p><p id="7037" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于每笔交易，记录买价和卖价，以便计算2个评估指标，包括:</p><p id="d248" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> 1。销售价格相对于购买价格的平均百分比增长</strong></p><ul class=""><li id="bbd4" class="lq lr hi iz b ja jb jd je jg me jk mf jo mg js mh lw lx ly bi translated">这是为了检查机器人是否以较低的价格买进，以较高的价格卖出</li><li id="0ce3" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js mh lw lx ly bi translated">如果该值为正值，则意味着机器人通常以更高的价格出售。但是如果价值是负的，意味着机器人通常以较低的价格出售。</li></ul><p id="130d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> 2。考虑交易费用的平均百分比收益</strong></p><ul class=""><li id="d5ad" class="lq lr hi iz b ja jb jd je jg me jk mf jo mg js mh lw lx ly bi translated">这是为了检查平均来说机器人是赢还是输</li><li id="1edd" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js mh lw lx ly bi translated">收益是我们在每次交易后相对于初始金额获得的额外法定货币</li><li id="d7d0" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js mh lw lx ly bi translated">百分比收益和百分比增长之间的唯一区别是收益考虑了每一笔买卖的交易费用。</li><li id="3ebe" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js mh lw lx ly bi translated">如果平均百分比收益值为正，这意味着机器人通常从交易中获利。</li></ul><h1 id="379d" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">实施加密货币交易机器人的第一阶段</h1><p id="7c73" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">实现交易机器人的第一阶段只是使用单个LSTM(长短期记忆)层，然后是单个全连接层来预测加密货币的未来价格。如果对未来价格的预测高于当前价格，我们买入。但是如果对未来价格的预测低于当前价格，我们就卖出。</p><pre class="kd ke kf kg fd mi mj mk ml aw mm bi"><span id="00c5" class="mn ku hi mj b fi mo mp l mq mr">#predict future price using trained LSTM<br/>pred_price = model.predict(historical_price)</span><span id="d5e6" class="mn ku hi mj b fi ms mp l mq mr">#get current price<br/>current_price = get_current_price()</span><span id="178c" class="mn ku hi mj b fi ms mp l mq mr">#determine action<br/>if pred_price &gt; current_price:<br/>    #buy<br/>elif pred_price &lt; current_price:<br/>    #sell<br/>else:<br/>    #do nothing</span></pre><p id="40b6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">LSTM属于深度学习的范畴，因为它使用专门用于处理时间序列数据(按时间顺序排列的每个观察序列)的ANN(人工神经网络)机制进行学习。LSTM的起源是RNN(递归神经网络),其与原始前馈神经网络的不同之处在于其信号流，其中t时刻的输出将被用作t+1时刻的输入，这就是它被称为“递归”神经网络的原因。鉴于这种机制，RNN可以比正常的前馈神经网络更好地理解序列数据。LSTM修改了RNN，在RNN结构中增加了4个组件:1 .输入门2。别管3号门了。输出门4。记忆。输入门决定哪些新数据应该被记录到存储器中。遗忘日期决定了哪些数据应该从存储器中删除。并且输出门将决定存储器中的哪些数据应该影响预测结果。由于加密货币的价格是具有时间顺序的序列数据，这种类型的数据可以由LSTM处理。</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es mt"><img src="../Images/e9bb3ef3deff217078b2857364e89ef6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7pK9bZKbef6L3HFkUvJtLA.png"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx">performance of trading bot phase 1</figcaption></figure><p id="f0de" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">显然，结果表明，机器人通常以较低的价格购买，以较高的价格出售，因为硬币的销售价格相对于购买价格的平均百分比增长为正。例如，BTC交易机器人的平均售价通常比买入价高出0.1325%。然而，通过查看平均百分比收益，没有一个机器人从交易中获得收益，因为所有值都是负的。例如，BTC交易机器人通常在每笔交易中损失0.3675%的法定投资额。这是因为交易费。即使在我们买硬币的那一刻，我们已经输了。</p><p id="72aa" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">即使交易机器人的当前方法在确定价格在未来是上升还是下降方面表现良好，因为每个硬币从购买到销售价格的平均百分比增加都是正的，但是确定价格变化的幅度是不够的。从购买价格到销售价格的增加需要足够高，在扣除购买和销售加密货币时收取的交易费用后，我们仍然有利润。</p><h1 id="6676" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">实施加密货币交易机器人的第二阶段</h1><p id="7b31" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">为了改进第一阶段的交易机器人，购买条件修改了一点点。目前的情况是，如果未来的预测价格高于当前价格，我们就买入。我们对此进行了修改，增加了一些考虑交易费用的阈值，即预测的未来价格应该至少比当前价格高出一些阈值，然后我们买入。使用下面的函数，我们可以用3个输入来计算法定货币的收益:买价、卖价和法定支出。</p><pre class="kd ke kf kg fd mi mj mk ml aw mm bi"><span id="eaca" class="mn ku hi mj b fi mo mp l mq mr">def gain_calculator(fiat_amount,price_at_buy,price_at_sell):</span><span id="0afd" class="mn ku hi mj b fi ms mp l mq mr">crypto_amount = (fiat_amount- (fiat_amount*0.25/100))/price_at_buy<br/>    gain_from_sell = (price_at_sell * crypto_amount) - (price_at_sell * crypto_amount * 0.25/100)</span><span id="0027" class="mn ku hi mj b fi ms mp l mq mr">return gain_from_sell - fiat_amount</span></pre><p id="5b00" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，目前的加密货币价格是每单位密码20单位法币，交易费是0.25%，我们花了100单位法币购买这枚硬币。在不考虑费用的情况下，我们应该得到的硬币数量是5个加密单位。然而，由于交易费用，我们只能得到4.9875单位密码。这就是为什么仅仅购买加密货币，我们已经输了。然后，如果我们决定在价格上涨到每单位密码20.01单位菲亚特时出售，由于交易费，我们出售所有股票得到的菲亚特数量是99.550单位菲亚特，而不是99.799875单位菲亚特。即使我们以较低的价格买进，以较高的价格卖出，我们还是会亏损。</p><p id="38e6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是如果价格涨到每单位密码21单位，我们决定出售。我们最终得到的菲亚特数量是104.4756单位菲亚特，现在我们获得了！因此，价格的增长应该足够高，以便有利润来支付费用。</p><p id="d3e8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是多高才算够高呢？</p><p id="a0fc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过使用下面的函数‘required _ magnitude ’,我们可以通过不断提高价格直到收益第一次高于零(这是阈值或幅度)来找到利润所需的最低价格涨幅。该函数将回答在考虑买卖交易费用后，我们需要的价格相对于当前价格的涨幅仍将导致收益。</p><pre class="kd ke kf kg fd mi mj mk ml aw mm bi"><span id="f6c6" class="mn ku hi mj b fi mo mp l mq mr">def required_magnitude(current_price,fiat_amount):<br/>    x = 0 <br/>    while True:<br/>        gain = gain_calculator(fiat_amount,current_price,current_price+x)<br/>        if gain&gt;0:<br/>            break<br/>        else:<br/>            x += 0.01<br/>    return x</span></pre><p id="845b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这种情况下，为了从以每单位密码20单位法币的价格购买加密货币中获利，该价格应该至少高0.109，即每单位密码20.109单位法币，以便在包括交易费的出售后获利。</p><p id="ce43" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，我们将交易机器人的购买信号修改为…</p><pre class="kd ke kf kg fd mi mj mk ml aw mm bi"><span id="f95e" class="mn ku hi mj b fi mo mp l mq mr">#predict future price using trained LSTM<br/>pred_price = model.predict(historical_price)</span><span id="22d6" class="mn ku hi mj b fi ms mp l mq mr">#get current price<br/>current_price = get_current_price()</span><span id="2570" class="mn ku hi mj b fi ms mp l mq mr">#calcualet required magnitude of increase in price<br/>mag = required_magnitude(current_price,fiat_amount)</span><span id="9c60" class="mn ku hi mj b fi ms mp l mq mr">#determine action<br/>if pred_pricec - urrent_price &gt;= mag:<br/>    #buy</span><span id="cd3f" class="mn ku hi mj b fi ms mp l mq mr">elif pred_price &lt; current_price:<br/>    #sell</span><span id="7696" class="mn ku hi mj b fi ms mp l mq mr">else:<br/>    #do nothing</span></pre><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es mu"><img src="../Images/8e6ee595aeb5ef8810aa1e900ba3187a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cx6b5cFsSKXPT6lkolsMjQ.png"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx">performance of trading bot phase 2</figcaption></figure><p id="1446" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过修改购买条件，bot在从购买价格到销售价格的平均百分比增长以及平均百分比收益方面表现更好，如下图所示。</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es mv"><img src="../Images/89d8fa78249ea03423ee3f6dda0b3725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SMqROskzUgA1SgFw66uhMw.png"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx">compare average percent increase from buying price to selling price between 2 approaches</figcaption></figure><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es mw"><img src="../Images/195955ad35cfce3c507e4b94ff02dafe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MHpm2z4kaKECB-_KSI7xNA.png"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx">compare average percent gain in fiat currency between 2 approaches</figcaption></figure><h1 id="4640" class="kt ku hi bd kv kw kx ky kz la lb lc ld io le ip lf ir lg is lh iu li iv lj lk bi translated">摘要</h1><p id="9fd7" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">我的方法使用基于序列的监督机器学习模型来预测加密货币的未来价格。当预测的未来价格高于当前价格时触发买入信号，而当预测的未来价格低于当前价格时触发卖出信号。使用最小阈值来确定价格的增加是否足够高以获得利润确实有助于提高模型性能。尽管bot只能提供低于0.5%的法定货币平均收益，但这仍是一个良好的开端。</p></div></div>    
</body>
</html>