<html>
<head>
<title>Amazon Virtual Private Cloud (VPC)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">亚马逊虚拟私有云(VPC)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/amazon-virtual-private-cloud-vpc-a096402d5d58?source=collection_archive---------69-----------------------#2021-06-15">https://medium.com/geekculture/amazon-virtual-private-cloud-vpc-a096402d5d58?source=collection_archive---------69-----------------------#2021-06-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="f519" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">介绍</h1><p id="e110" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">亚马逊VPC(亚马逊虚拟私有云)用于将AWS资源启动到虚拟网络中。亚马逊VPC内部的各种组件定义了流量、安全性、路由配置等。</p><h1 id="c595" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">区域和可用性区域</h1><p id="715b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">高层次的AWS全球基础设施按区域分布。区域是世界上的一个物理位置，如爱尔兰、伦敦、新加坡等。每个区域进一步由可用性区域(AZ)组成。可用性区域(AZ)只不过是离散的数据中心。例如，如果新加坡是一个地区，那么在该地区内，AWS可能有3个不同的数据中心，分别位于新加坡的东部、西部和南部，它们相互隔离。因此，如果一个数据中心停电或发生意外火灾，另一个数据中心将继续运行，不会造成任何中断。</p><h1 id="93c3" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">亚马逊虚拟私有云</h1><p id="780d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">定义了区域和可用性区域后，下图有助于将VPC纳入全球基础架构。亚马逊VPC是一个虚拟网络，跨越一个地区的多个可用性区域。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kb"><img src="../Images/a0dd3974c28b94919ca9ff3062475bc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VOP0HWxGaqtE7CfWuAN1bA.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Amazon VPC — Overview</figcaption></figure><p id="ad18" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated">亚马逊VPC是在区域级别定义的，它跨越多个可用性区域。因此，当必须在VPC内创建实例时，可以选择在该区域内的任何可用性区域中托管它们。实例是具有IP地址的物理服务器，物理上位于数据中心(可用性区域)内。</p><p id="b409" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated">为了形象化它，想象将您的笔记本电脑(实例)放在您的办公场所中的位置A(可用性区域A)。第二天，您将访问位于办公室位置B(可用性区域-B)的另一个分支机构，您必须继续工作。您无法实际访问放置在位置A的实例。但是，如果您在位置A的笔记本电脑(实例)中的数据可以复制到位置B的另一台笔记本电脑，那么您就可以继续工作。您通常不关心物理位置，只要我们能够像您在a使用笔记本电脑(实例)一样执行相同的功能。</p><p id="efa9" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated">虽然可用性区域可能看起来是多余的，但通常大多数真实世界的应用程序都托管在多个可用性区域中，以便在发生中断时具有弹性。因此，当我们定义虚拟网络(VPC)时，它可以选择跨同一区域内的多个可用性区域。</p></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><h1 id="6607" class="if ig hi bd ih ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc bi translated">CIDR街区</h1><p id="baa0" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">要创建VPC，我们需要定义<a class="ae li" href="https://www.pradheepa.com/posts/networking-cidr" rel="noopener ugc nofollow" target="_blank"> CIDR数据块IP </a>范围。这定义了VPC可以拥有的实例数量。同样，由于这是在VPC级别配置的，因此IP地址可以跨越多个AZ。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es lj"><img src="../Images/dc8c0402682af30bb9580dbbfbf0a59f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*gergO63uQo72pTX8A7Fgdg.png"/></div></figure><p id="1760" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated">让我们考虑默认的VPC的<code class="du lk ll lm ln b">IP CIDR Block</code>，也就是<code class="du lk ll lm ln b">172.31.0.0/16</code>。<code class="du lk ll lm ln b">/16</code>意味着前16位(172.31段)必须保持不变，因此前两个IP段不能取任何其他值。这为我们提供了将最后两个IP段更改为(0-255)之间任何值的空间。因此默认VPC可以接受65536个IP地址。</p></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><h1 id="5576" class="if ig hi bd ih ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc bi translated">子网</h1><p id="625a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们可以在AZ级别进一步划分IP地址(子网)。让我们考虑一下两个az<code class="du lk ll lm ln b">172.31.0.0/24</code>和<code class="du lk ll lm ln b">172.31.1.0/24</code>的CIDR值。这可能意味着IP地址的范围被分组为<code class="du lk ll lm ln b">(172.31.0.0 - 172.31.0.255)</code>、<code class="du lk ll lm ln b">(172.31.1.0 - 172.31.1.255)</code>，每个有256个IP地址。现在，我将这两个IP范围分配给两个不同的可用性区域。第一个AZ将范围作为<code class="du lk ll lm ln b">(172.31.0.0 - 172.31.0.255)</code>，第二个作为<code class="du lk ll lm ln b">(172.31.1.0 - 172.31.1.255)</code>。让我们只考虑一个可用性区域，因为另一个将是一个精确的副本。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lo"><img src="../Images/db43cc2bf648e75b63c5b48920e7a672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OpdSjZCtPq2Oa-J-HrpupQ.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Subnets in a VPC</figcaption></figure><p id="bda3" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated">我可以将整个256系列作为一个逻辑组使用，也可以进一步将它们分成多个组。这些逻辑组称为子网(子网络)。为了说明，让我们考虑AZ中的两个子网，那么子网的CIDR范围可以是<code class="du lk ll lm ln b">172.31.0.0/24</code>和<code class="du lk ll lm ln b">172.31.128.0/24</code>，每个子网有128个IP地址。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lp"><img src="../Images/df579d7085f505a20021c8d37d8d1946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BYceIUX82RrUUdougbFyeg.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Subnets and their IP range</figcaption></figure></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><h1 id="39ad" class="if ig hi bd ih ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc bi translated">安全组</h1><p id="1e86" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">下图显示，在一个可用性分区中，我们创建了两个子网(私有和公共)，一个子网允许互联网访问，另一个不允许。必须定义流量配置，使其成为公共和私有的。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lq"><img src="../Images/9145568993d76b784936152a5112d2c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uy-0apP_z9Qhuxet5EYuXg.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Security Groups in a VPC</figcaption></figure><p id="3503" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated">安全组用于控制入站和出站流量。在VPC中,<code class="du lk ll lm ln b">Security Groups</code>在实例级起作用。下面是创建安全组的向导。我们需要定义允许的入站流量和出站流量，并将其与该安全组所属的VPC相关联。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lr"><img src="../Images/9e6e158bf337aa7c151b2dabd7e3092f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sgeVItmtynfLbLbbfqKMNA.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Create Security Group Wizard</figcaption></figure><h2 id="7a21" class="ls ig hi bd ih lt lu lv il lw lx ly ip jo lz ma it js mb mc ix jw md me jb mf bi translated">摘要</h2><ul class=""><li id="6ce0" class="mg mh hi jf b jg jh jk jl jo mi js mj jw mk ka ml mm mn mo bi translated">在实例级别采取行动。</li><li id="a357" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka ml mm mn mo bi translated">安全组规则使我们能够根据协议和端口号过滤流量。</li><li id="f8b0" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka ml mm mn mo bi translated">规则是有状态的。例如，如果端口443被启用用于入站，那么无论出站规则如何，443也被启用用于出站。</li><li id="aaab" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka ml mm mn mo bi translated">没有否认规则。只允许。</li><li id="7940" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka ml mm mn mo bi translated">除非添加了允许流量的规则，否则与安全组相关联的实例不能相互通信。</li></ul></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><h1 id="55ab" class="if ig hi bd ih ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc bi translated">NACL(网络访问控制列表)</h1><p id="0d9b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">它类似于定义VPC内部网络访问的安全组，但它在子网级别运行。如果我们要定义跨子网的通用流量规则，我们在NACL定义。以下是在默认VPC中创建的默认NACL的配置。在这里，我们可以在第三个选项卡中看到子网关联。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mu"><img src="../Images/5d1b0253cab574cfe20d712ac6f53dae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7usj5RJTMcKa8_U52NaPwQ.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Default NACL</figcaption></figure><p id="7d61" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated">此向导显示这些是所有允许的入站和出站规则，并且这些是与此NACL规则相关联的子网。这与安全组不同，在安全组中，我们只定义入站和出站规则。我们不必在创建安全组时定义与它相关联的实例。安全组仅在实例创建向导中与实例相关联。但是对于NACL，它必须定义与之相关的子网。</p><h2 id="ee56" class="ls ig hi bd ih lt lu lv il lw lx ly ip jo lz ma it js mb mc ix jw md me jb mf bi translated">NACL摘要</h2><ul class=""><li id="310a" class="mg mh hi jf b jg jh jk jl jo mi js mj jw mk ka ml mm mn mo bi translated">在子网级别运行。</li><li id="4eb3" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka ml mm mn mo bi translated">必须明确定义入站和出站规则。例如，在NACL，端口80允许入站规则并不意味着端口80出站规则，如安全组。如果没有定义，它将被自动拒绝。</li><li id="b9b8" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka ml mm mn mo bi translated">我们可以定义允许和拒绝的规则。</li></ul></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><h1 id="25cb" class="if ig hi bd ih ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc bi translated">路由表</h1><p id="3111" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">路由表就像VPC中子网的流量控制器，包含哪些数据包去往何处的规则。它更像是子网内可能发生的所有可能路由的目录。我经常把路由表和NACL混淆，因为它们都与子网相关联。</p><p id="459e" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated">公共子网的示例路由表如下所示。如果VPC被设置为具有地址空间<code class="du lk ll lm ln b">172.16.0.0/16</code>，那么被定义为<code class="du lk ll lm ln b">172.16.0.0/16</code>的<code class="du lk ll lm ln b">local</code>路由允许在VPC内创建的所有资源相互通信，而无需任何额外的配置。下一个配置是VPC内部的IPv6配置，用于相互通信。创建一个配置<code class="du lk ll lm ln b">0.0.0.0/0</code>并将目标连接到互联网网关(这是在路由表中配置它之前创建的)使连接到该路由表的任何子网成为公共的，因为它可以访问互联网。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mv"><img src="../Images/1b4b8826587e38f560826fe02f9a7a52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qwN48sdPlr41_q_xGHhO0g.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Public Route Table (Internet Gateway attached)</figcaption></figure><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mw"><img src="../Images/f503a53b67a74d2dd3a5f1f8312231f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oebqV1pqlAmv8tNU-iIeDA.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Private Route Table (No Internet Gateway and only local route)</figcaption></figure><h2 id="09f8" class="ls ig hi bd ih lt lu lv il lw lx ly ip jo lz ma it js mb mc ix jw md me jb mf bi translated">摘要</h2><ul class=""><li id="a661" class="mg mh hi jf b jg jh jk jl jo mi js mj jw mk ka ml mm mn mo bi translated">每个子网只能有一个路由表。</li><li id="674c" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka ml mm mn mo bi translated">路由表可以在子网间共享。</li><li id="438a" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka ml mm mn mo bi translated">基于该路由表的子网的所有路由。</li><li id="414c" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka ml mm mn mo bi translated">NACL和安全组旨在保护在VPC创建向导的<code class="du lk ll lm ln b">SECURITY</code>部分找到的实例，而不是主要用于路由。</li><li id="219b" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka ml mm mn mo bi translated">如果我们看下图，我们可以看到任何流量的第一个接触点是连接到子网的路由表，然后是NACL和安全组。</li></ul><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mx"><img src="../Images/8c3a4bce00c727c4a5f9b24fcdd31077.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*ZBzIMqBSwRoP5YuMQhP0WA.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx">Route Table Information Arch</figcaption></figure><h1 id="f6c0" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">互联网网关</h1><p id="8814" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">顾名思义，这是公众上网的门户。如果我们托管一个web应用程序，web服务器通常是面向公众的，并且可以通过互联网访问。为了实现这一点，我们应该首先创建一个Internet网关，并在路由表中定义路由。这允许进出实例的internet流量。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es my"><img src="../Images/30a5a20d341d6bc5a1fd64fa194afb7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*_1_mQ7I7Rsx6pSSj1k9JjA.png"/></div><figcaption class="kn ko et er es kp kq bd b be z dx">Internet Gateway</figcaption></figure><h1 id="de03" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">网络地址转换(NAT)网关</h1><p id="8d0c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">NAT网关是一种网络地址转换(NAT)服务。可以使用NAT网关，以便私有子网中的实例可以连接到VPC外部的服务，但外部服务无法启动与这些实例的连接。例如，为了在实例上进行补丁安全更新，它可能必须连接到internet，但不一定需要允许入站访问。</p><p id="27cc" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated">NAT网关有两种类型，公有和私有。顾名思义，公共网关将连接到互联网(单向)，私有网关用于连接其他VPC。公共NAT网关在公共子网中创建，并将与弹性IP地址相关联。</p><h1 id="9764" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">你能回答以下问题吗？</h1><ol class=""><li id="1084" class="mg mh hi jf b jg jh jk jl jo mi js mj jw mk ka mz mm mn mo bi translated">没有路由表，子网还能存在吗？</li><li id="8a1b" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka mz mm mn mo bi translated">NACL和路由表有什么区别？</li><li id="a092" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka mz mm mn mo bi translated">什么是CIDR数据块IP范围？</li><li id="5d63" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka mz mm mn mo bi translated">如果路由表与子网相关联，为什么它会作为VPC配置的一部分显示在VPC控制台中？</li><li id="0844" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka mz mm mn mo bi translated">一个VPC可以有多少个路由表？</li><li id="32c6" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka mz mm mn mo bi translated">什么是VPC的主路由表，您能编辑主路由表吗？</li><li id="1028" class="mg mh hi jf b jg mp jk mq jo mr js ms jw mt ka mz mm mn mo bi translated">是否可以创建另一个路由表并将其作为主路由表？</li></ol><h1 id="2ef5" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">参考</h1><ol class=""><li id="4299" class="mg mh hi jf b jg jh jk jl jo mi js mj jw mk ka mz mm mn mo bi translated"><a class="ae li" href="https://d1.awsstatic.com/events/reinvent/2019/REPEAT_2_AWS_networking_fundamentals_NET201-R2.pdf" rel="noopener ugc nofollow" target="_blank">https://D1 . AWS static . com/events/reinvent/2019/REPEAT _ 2 _ AWS _ networking _ fundamentals _ net 201-R2 . pdf</a></li></ol></div></div>    
</body>
</html>