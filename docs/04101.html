<html>
<head>
<title>How to Deploy a Machine Learning API and App using Flask on Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Heroku上使用Flask部署机器学习API和App</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-deploy-a-machine-learning-api-and-app-using-flask-on-heroku-dc8dcd4317f?source=collection_archive---------42-----------------------#2021-06-21">https://medium.com/geekculture/how-to-deploy-a-machine-learning-api-and-app-using-flask-on-heroku-dc8dcd4317f?source=collection_archive---------42-----------------------#2021-06-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/886ca2caa645d8a06211174bae29d582.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BP3sI5mcB8DM2btpspuJjg.jpeg"/></div></div></figure><p id="6fc3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本文将教你如何在Heroku上使用Flask部署一个机器学习API和app。机器学习API将使用三个值来预测森林火灾的概率:温度、氧气和湿度。请记住，概率可能不完全准确，在现实生活中不应该依赖它。</p><h1 id="3ea7" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">蜜蜂</h1><p id="8b87" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">什么是API？从技术上讲，API代表应用程序编程接口。API用于访问应用程序的特定功能或数据，并且可以在不同的应用程序中使用。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/8c588e84c7d45c57f780700ff2646778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*msdvxk7ZLMA0n6rY.png"/></div></div></figure><p id="89bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">比方说，你想做一个机器学习模型，评估过去的股票价格，并给出一只股票的未来价格。你需要过去的股票数据。这就是API的用途。您可以请求Google Finance API接收您需要的所有股票的数据。</p><p id="f008" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有不同类型的API架构和协议。一些包括REST、JSON-RPC &amp; XML-RPC和SOAP。每个API架构都有不同的特定需求。我们将用来创建API的API架构是REST。REST有六种不同的需求:无状态、客户机-服务器、统一接口、可缓存、分层系统和按需编码。要了解更多关于REST API架构及其需求的信息，您可以<a class="ae kw" rel="noopener" href="/edureka/what-is-rest-api-d26ea9000ee6">阅读这篇</a>。</p><p id="b3b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们正在创建的应用程序中的API不是完全必要的，因为该API只在一个应用程序中使用，但它可能在未来有用。该应用程序中的API接收这三个值，应用机器学习模型，并以小数形式返回概率。现在我们对API有了更多的了解，让我们开始构建一个API。</p><h1 id="db80" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤1 -上传API和App到GitHub</h1><p id="6e4d" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">让我们从API开始。你可以在https://github.com/Coder-bot21/forest-fire-probability-api<a class="ae kw" href="https://github.com/Coder-bot21/forest-fire-probability-api" rel="noopener ugc nofollow" target="_blank">的</a>获得API的代码。</p><p id="d0c8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">API中有两个主要文件。第一个是评估数字的机器学习模型，第二个是应用程序，它是API的一部分，接收输入并返回输出。</p><p id="9ef2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是API的app部分。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/d62fb3cb39e6a935816f4a82c7cd24d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CYDn5z_Z_z1DIYrmh0anhg.jpeg"/></div></div></figure><p id="f5e1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该应用程序首先导入必要的库。然后它创建了一个flask应用程序。然后，存储在pickle文件中的机器学习模型被加载到变量模型中。</p><p id="42be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦初始化API所需的所有代码都写好了，接下来就是API了。API使用GET方法。此方法用于检索资源信息。其他API方法包括POST、PUT、PATCH和DELETE。每种方法都有不同的用途，可用于各种应用。首先，定义一个名为“home”的函数。该函数创建三个整数形式的参数温度、氧气和湿度。这些是API将从应用程序接收的值。然后，API应用程序将参数中获得的值设置为“int_features”。使用numpy将“int_features”变成数组，然后使用机器学习模型运行。</p><p id="dfb0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦机器学习模型计算出一个概率，它就被格式化并使用API作为字符串返回给应用程序。</p><p id="31d4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们知道了API框架，让我们更仔细地看看机器学习模型。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/6ebf1de936952a4db74e4f2ef3f957a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XcPoQ5XFOC_SeTGBVtEPNw.png"/></div></div></figure><p id="d50b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">机器学习模型从导入必要的库开始，类似于API应用程序。然后，模型提取将用于测试和训练模型的数据。因为这个数据是一个CSV，所以它被转换成一个numpy数组。</p><p id="c854" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，模型会对数据进行一些格式化，以便可以在模型中使用。X和Y值被定义并转换成整数。训练和测试数据被分成70%和30%。然后使用逻辑回归对模型进行训练和测试。存在几种不同类型的机器学习模型。逻辑回归通常用于预测特定类别或事件存在的概率。由于模型将预测森林火灾的可能性，逻辑回归是一个完美的拟合。</p><p id="f2e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">既然模型已经过训练和测试，它就被加载到pickle文件中。该文件用于存储模型，以便在API应用程序中使用。</p><p id="a997" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过输入文件并使用下面的命令，您可以克隆GIT存储库或下载它并在您的计算机上运行代码。</p><pre class="ks kt ku kv fd ky kz la lb aw lc bi"><span id="5421" class="ld jp hi kz b fi le lf l lg lh">python app.py</span></pre><p id="529e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们继续应用程序。API和app是两个不同的部分。该应用程序将API集成到自身中。该应用程序的代码可在https://github.com/Coder-bot21/forest-fire-probability-app获得。</p><p id="6c3f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">应用程序中有两个主要文件。实际的应用程序文件，它发送参数值并接收整数形式的概率，以及HTML文件，它显示用户看到的内容。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/0a3767898514fd4d462a186414d0d3f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J0ymaROg3MsjWtAHl5CrDA.png"/></div></div></figure><p id="0c58" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面的文件是app.py文件的图像。该文件从导入库开始，然后启动flask应用程序。然后，文件呈现一个HTML模板(稍后我会详细解释这个模板)，用户可以看到这个模板。</p><p id="7f50" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个文件也使用GET方法接收信息。定义了一个名为“预测”的函数。这个函数从用户提交的表单中获取值，将它们作为参数，然后发送给API。API接收这些值并返回一个输出。</p><p id="9962" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后将输出从字符串转换成整数，并转换成JSON。如果输出概率超过50%，那么应用程序会告诉用户他们的森林处于危险之中，并告诉他们发生森林火灾的可能性。</p><p id="1fdf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">app.py文件占了应用程序的很大一部分，但是forest_fire.html文件也很重要。</p><p id="bf6b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由于HTML文件非常简单，我将只做一个快速概述。该文件包含负责用户所见内容的代码。它还创建用户可以输入值的表单。用户输入他们的值后，app.py将预测发送到HTML文件，该文件显示预测。</p><p id="aeb0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想在你的计算机上运行这段代码，你可能需要编辑几行，你可以在这里停下来，但是如果你要在线部署这段代码，你可以继续阅读。</p><h1 id="e4bc" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤2 -将代码部署到Heroku</h1><p id="c1e7" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">现在你应该在不同的Github仓库中有API和app了，如果你还没有的话，现在就做吧，因为有必要继续前进。</p><p id="cfef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建一个Heroku帐户开始。</p><p id="243e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在右上角，应该有一个写着“新建”的按钮。如果你点击它，你会看到两个选项:新应用或新渠道。由于我们将部署一个应用程序和一个API，您应该选择新的应用程序选项。您可以随意命名该应用程序，但与GitHub存储库同名会更容易找到。</p><p id="e628" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建应用程序后，您可以选择您的部署方法。由于您的代码已经上传到Github存储库，您可以将Heroku连接到GitHub并选择您想要的存储库。</p><p id="82ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以通过选择部署方法下的部署分支选项来部署代码。app部署完成后，按右上角的打开app即可在线访问。</p><p id="1c59" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以对API和app重复这个过程来部署这两者。你可以在<a class="ae kw" href="https://forest-fire-probability-api.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://forest-fire-probability-api.herokuapp.com</a>访问一个工作API，在<a class="ae kw" href="https://forest-fire-probability-app.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://forest-fire-probability-app.herokuapp.com</a>访问一个功能app。</p><p id="09c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在部署应用程序之前，应该将app.py的第14行改为使用自己的API。</p><p id="9b02" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">API和app的一些代码来自GitHub 上的<a class="ae kw" href="https://github.com/nachi-hebbar/Forest-Fire-Prediction-Website" rel="noopener ugc nofollow" target="_blank">森林火灾预测网站，所以要感谢Nachiketa Hebbar。</a></p><p id="a552" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi li translated">我是尼耶尔，13岁，对人工智能、基因编辑、区块链等新兴技术感兴趣。我现在是TKS的学生，这是一个人体加速器项目。我很好奇，总是对新事物感兴趣。<br/><a class="ae kw" href="https://www.linkedin.com/in/niyelhassan/" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">LinkedIn</strong></a><strong class="is hj">|</strong><a class="ae kw" href="https://www.youtube.com/channel/UCm3l2-pEmhWqKMH5atYNsyw" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">Youtube</strong></a><strong class="is hj">|</strong><a class="ae kw" href="https://niyelhassan.ml/" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">网站</strong> </a></p></div></div>    
</body>
</html>