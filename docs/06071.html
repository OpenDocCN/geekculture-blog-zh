<html>
<head>
<title>How to create scheduled jobs in rails using the sidekiq-cron gem</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用sidekiq-cron gem在rails中创建调度作业</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-create-scheduled-jobs-in-rails-using-sidekiq-cron-dc5dee27eae5?source=collection_archive---------5-----------------------#2021-08-05">https://medium.com/geekculture/how-to-create-scheduled-jobs-in-rails-using-sidekiq-cron-dc5dee27eae5?source=collection_archive---------5-----------------------#2021-08-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="d8e4" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">权威指南</h2><div class=""/><figure class="ev ex ip iq ir is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es io"><img src="../Images/44ac69f75996257c14a06e6a99c9204c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VoP0eWrC2CdiDihxN8RKZw.jpeg"/></div></div></figure><p id="4239" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">首先，我们需要了解什么是计划作业。计划作业是那些被编写为在特定时间、日期或特定间隔定期运行的作业。他们也被称为克朗乔布斯。根据维基百科，cron是类Unix计算机操作系统中基于时间的作业调度程序。</p><p id="b894" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">现在我们知道了什么是计划作业或cron作业。让我们继续讨论<a class="ae jx" href="https://github.com/ondrejbartas/sidekiq-cron" rel="noopener ugc nofollow" target="_blank"> <em class="jy"> sidekiq-cron </em> </a>。它是sidekiq的一个调度附件。这不是一个正式的sidekiq宝石。sidekiq中的调度是一个企业级特性。如果你不想在那上面花钱，这个宝石是给你的。</p><figure class="ka kb kc kd fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es jz"><img src="../Images/bc00c148f816024e47c197027fc4c4aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j0LhRn6QPghunkhtwXhu0g.jpeg"/></div></div></figure><p id="307c" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">所以，让我们开始吧。</p><p id="8db9" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">首先，我们需要将gem添加到rails应用程序的<code class="du ke kf kg kh b">Gemfile</code>中。</p><figure class="ka kb kc kd fd is"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="e6c0" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">每次添加新的gem时运行捆绑安装。</p><p id="d58b" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">然后在<em class="jy">配置</em>目录下创建一个名为<code class="du ke kf kg kh b"><em class="jy">schedule.yml</em></code>的文件。在该文件中，添加以下内容:</p><figure class="ka kb kc kd fd is"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="521c" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">这里写着5。这意味着它将每隔5分钟执行一次工作。您还必须将名为<strong class="jb hs"> <em class="jy"> WorkerName </em> </strong>的类改为对您的上下文有意义的类。</p><p id="bba7" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">现在在你的应用程序<code class="du ke kf kg kh b"><em class="jy">config/initializers</em></code>中创建另一个名为<code class="du ke kf kg kh b"><em class="jy">sidekiq.rb</em></code> <em class="jy"> </em>的文件。将以下代码添加到该文件中:</p><figure class="ka kb kc kd fd is"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="0eab" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">现在是时候创建真正的工人了。为此，请转到终端并键入</p><pre class="ka kb kc kd fd kk kh kl km aw kn bi"><span id="f798" class="ko kp hi kh b fi kq kr l ks kt">rails g sidekiq:worker WorkerName</span></pre><p id="a655" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">这将在应用程序的app目录中创建一个<code class="du ke kf kg kh b"><em class="jy">workers/worker_name.rb</em></code>。注意，这里我使用<strong class="jb hs"> <em class="jy"> WorkerName </em> </strong>作为工人的名字。如果您之前修改过它，那么您现在也需要更改它。打开它，添加一些定期运行的代码。例如，它可以是对特定端点的调用，以检查是否有任何新值可用，如果有，则将其保存到数据库。(别担心，这只是个例子)</p><p id="455f" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><code class="du ke kf kg kh b"><em class="jy">worker_name.rb</em></code>文件如下所示:</p><figure class="ka kb kc kd fd is"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="b0ff" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">最后一件事。拿着终端打字</p><pre class="ka kb kc kd fd kk kh kl km aw kn bi"><span id="8c03" class="ko kp hi kh b fi kq kr l ks kt">sidekiq</span></pre><p id="6de6" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">这将在终端的一个选项卡中运行worker。如果您想运行rails server或其他任何东西，请确保移动到另一个选项卡。因为工作人员需要在app运行的同时一直运行。</p><p id="6c99" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">就是这样。您已经创建了您的第一个sidekiq-cron作业。呜哇！！</p></div></div>    
</body>
</html>