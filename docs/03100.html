<html>
<head>
<title>Django+MySQL CI/CD with GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django+MySQL CI/CD和GitHub操作</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/django-mysql-ci-cd-with-github-actions-303605697653?source=collection_archive---------29-----------------------#2021-05-31">https://medium.com/geekculture/django-mysql-ci-cd-with-github-actions-303605697653?source=collection_archive---------29-----------------------#2021-05-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="a7b1" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">边吃薯片边给你的Django项目添加GitHub动作。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/837d057f95a462eccff90a8c22a9561f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*E9A8UuOS_E42ZSjT.png"/></div></figure><h1 id="6041" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">介绍</h1><p id="b82c" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">如今，当我们开发一个web应用程序时，我们通常使用CI(持续集成)和CD(持续部署)来自动化测试和部署过程。</p><p id="5155" class="pw-post-body-paragraph jx jy hi jz b ka kt ij kc kd ku im kf kg kv ki kj kk kw km kn ko kx kq kr ks hb bi translated">为了运行这样的自动化，我们过去使用Jenkins [ ]和Travis [ ]。然而，在这十年中，有很多工具满足了我们的需求，其中之一就是GitHub Actions。作为一名web开发人员和GitHub爱好者，我希望使用GitHub Actions，因为它不仅可以轻松地与GitHub项目集成，还可以展示我根据需要定制GitHub Actions [ ]的能力。因此，我想分享我在一个使用MySQL作为数据库的Django项目中应用GitHub操作(尤其是CI)的笔记。</p><h1 id="19c1" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">GitHub操作简介</h1><p id="3724" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">就像其他CI/CD平台一样，GitHub Actions是CI/CD的另一个平台。但是，它具有以下特性:</p><ol class=""><li id="f530" class="ky kz hi jz b ka kt kd ku kg la kk lb ko lc ks ld le lf lg bi translated"><strong class="jz hj">与GitHub服务高度集成。</strong> GitHub动作可以被任意的GitHub事件调用。因此，如果您将repos托管在GitHub上，您可以考虑使用GitHub操作来获得更好的开发体验。</li><li id="a556" class="ky kz hi jz b ka lh kd li kg lj kk lk ko ll ks ld le lf lg bi translated"><strong class="jz hj">社区驱动的工作流程。</strong> GitHub Actions允许你创建自己的工作流程，并发布到市场上与他人分享。例如，当我将一个水晶项目从Travis切换到GitHub Actions时。该项目需要与自定义域和不同的回购名称设置建成网站的光盘。GitHub Pages action [⁴]的工作在无痛工作流切换方面给了我很大帮助。</li><li id="aaa6" class="ky kz hi jz b ka lh kd li kg lj kk lk ko ll ks ld le lf lg bi translated"><strong class="jz hj">允许自托管机器。您不仅可以在GitHub上运行GitHub操作，而且您的自托管机器也有更灵活的配置和更好的价格！官方文件[⁵]有很好的解释教你如何做到这一点。</strong></li></ol><p id="ae6c" class="pw-post-body-paragraph jx jy hi jz b ka kt ij kc kd ku im kf kg kv ki kj kk kw km kn ko kx kq kr ks hb bi translated">因此，有很多社区，如Julia Language [⁶]将其CI/CD工作流切换到GitHub Actions上。更重要的是，这些社区发明了大量的定制工作流，以方便他们自己和开发人员将来使用他们的项目。</p><h1 id="75f0" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">用MySQL在Django上应用GitHub动作</h1><p id="e8ec" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">在这一段中，我列出了如何将GitHub动作应用到Django项目中的步骤。</p><blockquote class="lm ln lo"><p id="a281" class="jx jy lp jz b ka kt ij kc kd ku im kf lq kv ki kj lr kw km kn ls kx kq kr ks hb bi translated"><em class="hi">你可以在</em> <a class="ae lt" href="https://github.com/Cuda-Chen/django-mysql-github-actions-demo" rel="noopener ugc nofollow" target="_blank"> <em class="hi">这里</em> </a> <em class="hi">看到完整的示例项目。</em></p></blockquote><h1 id="d38d" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">1.创建Django项目</h1><p id="2e39" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">首先，通过键入以下命令创建Django项目，即<code class="du lu lv lw lx b">example</code>:</p><pre class="iy iz ja jb fd ly lx lz ma aw mb bi"><span id="b71b" class="mc jg hi lx b fi md me l mf mg">$ django-admin startproject example</span></pre><p id="2913" class="pw-post-body-paragraph jx jy hi jz b ka kt ij kc kd ku im kf kg kv ki kj kk kw km kn ko kx kq kr ks hb bi translated">然后将MySQL设置添加到<code class="du lu lv lw lx b">example/settings.py</code>的<code class="du lu lv lw lx b">DATABASES</code>变量中:</p><pre class="iy iz ja jb fd ly lx lz ma aw mb bi"><span id="93a3" class="mc jg hi lx b fi md me l mf mg">DATABASES <strong class="lx hj">=</strong> {<br/>    'default': {<br/>        'ENGINE': os.environ.get('DBENGINE', ''),<br/>        'NAME': os.environ.get('DBNAME', ''),<br/>        'USER': os.environ.get('DBUSER', ''),<br/>        'PASSWORD': os.environ.get('DBPASSWORD', ''),<br/>        'HOST': os.environ.get('DBHOST', ''),<br/>        'PORT': os.environ.get('DBPORT', ''),<br/>    }<br/>}</span></pre><p id="e9bb" class="pw-post-body-paragraph jx jy hi jz b ka kt ij kc kd ku im kf kg kv ki kj kk kw km kn ko kx kq kr ks hb bi translated">出于演示的目的，我使用环境变量来存储数据库的设置。</p><h1 id="96e5" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">2.创建Django应用:<code class="du lu lv lw lx b">users</code></h1><p id="5874" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">通过键入以下命令创建一个名为<code class="du lu lv lw lx b">users</code>的Django应用程序:</p><pre class="iy iz ja jb fd ly lx lz ma aw mb bi"><span id="d370" class="mc jg hi lx b fi md me l mf mg">$ django-admin startapp users</span></pre><h1 id="0fc3" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">3.在<code class="du lu lv lw lx b">users</code>中添加单元测试</h1><p id="c457" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">因为我们要运行CI，所以我们应该添加一些单元测试代码。</p><p id="0d6b" class="pw-post-body-paragraph jx jy hi jz b ka kt ij kc kd ku im kf kg kv ki kj kk kw km kn ko kx kq kr ks hb bi translated">在<code class="du lu lv lw lx b">users/tests.py</code>用以下代码替换现有代码:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mh mi l"/></div><figcaption class="mj mk et er es ml mm bd b be z dx">users/tests.py</figcaption></figure><h1 id="e24c" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">4.添加GitHub操作配置项</h1><p id="ea8f" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">主菜来了！但在添加GitHub Actions的配置之前，这里有一些我遇到的常见错误，作为对你的善意提醒:</p><ul class=""><li id="5c92" class="ky kz hi jz b ka kt kd ku kg la kk lb ko lc ks mn le lf lg bi translated">分支:一定要确定你想触发GitHub动作的分支，否则你会搞不清楚为什么GitHub动作不起作用。在这种情况下，我想在pull请求或push到<code class="du lu lv lw lx b">main</code>分支时触发GitHub动作。</li><li id="7db6" class="ky kz hi jz b ka lh kd li kg lj kk lk ko ll ks mn le lf lg bi translated"><strong class="jz hj"> env </strong>:当我使用环境变量进行数据库设置时，请确保在您将要使用数据库的每个步骤中都设置环境变量，例如数据库迁移和运行单元测试。</li><li id="7da2" class="ky kz hi jz b ka lh kd li kg lj kk lk ko ll ks mn le lf lg bi translated"><strong class="jz hj"> DB端口</strong>:如【⁷】所示，GitHub Actions为您定义的每个GitHub Actions服务分配随机端口。为了无故障地访问这些服务(例如数据库)端口，您必须使用<code class="du lu lv lw lx b">jobs.&lt;job_id&gt;.services.&lt;service_id&gt;.ports</code>语法。</li></ul><p id="6402" class="pw-post-body-paragraph jx jy hi jz b ka kt ij kc kd ku im kf kg kv ki kj kk kw km kn ko kx kq kr ks hb bi translated">然后，下面是添加GitHub动作配置的步骤:</p><ol class=""><li id="8157" class="ky kz hi jz b ka kt kd ku kg la kk lb ko lc ks ld le lf lg bi translated">创建名为<code class="du lu lv lw lx b">.github/workflows</code>的目录。</li><li id="290e" class="ky kz hi jz b ka lh kd li kg lj kk lk ko ll ks ld le lf lg bi translated">在<code class="du lu lv lw lx b">.github/workflows</code>目录中，添加<code class="du lu lv lw lx b">django-ci.yml</code>(我们的GitHub动作配置)，如下:</li></ol><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mh mi l"/></div><figcaption class="mj mk et er es ml mm bd b be z dx">.github/worflows/django-ci.yml</figcaption></figure><h1 id="28b7" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">5.推送至GitHub，尽情享受！</h1><p id="903f" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">完成以上步骤后，将我们的项目推送到GitHub，GitHub Actions就开始工作了！</p><h1 id="b4eb" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">琐事:添加GitHub动作徽章来显示CI状态</h1><p id="f2d1" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">GitHub Actions提供了状态徽章，用于轻松显示CI状态。通常，您可以像这样在<code class="du lu lv lw lx b">README.md</code>中添加徽章:</p><pre class="iy iz ja jb fd ly lx lz ma aw mb bi"><span id="981d" class="mc jg hi lx b fi md me l mf mg">[![&lt;your-github-actions-name&gt;](https://github.com/&lt;your-user-name&gt;/&lt;your-project-name&gt;/actions/workflows/django-ci.yml/badge.svg)](https://github.com/&lt;your-user-name&gt;/&lt;your-project-name&gt;/actions/workflows/django-ci.yml)</span></pre><h1 id="a38d" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">结论</h1><p id="2eeb" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">在这篇文章中，我将介绍如何应用CI/CD管道。我还介绍了什么是GitHub Actions及其特点。然后，我使用MySQL制作了一个Django演示项目，以展示运行GitHub动作的进程，并留下一些标记以避免常见的陷阱。</p><h1 id="0662" class="jf jg hi bd jh ji jj jk jl jm jn jo jp io jq ip jr ir js is jt iu ju iv jv jw bi translated">参考</h1><p id="bb0e" class="pw-post-body-paragraph jx jy hi jz b ka kb ij kc kd ke im kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">【<a class="ae lt" href="https://www.jenkins.io/" rel="noopener ugc nofollow" target="_blank">https://www.jenkins.io/</a></p><p id="8709" class="pw-post-body-paragraph jx jy hi jz b ka kt ij kc kd ku im kf kg kv ki kj kk kw km kn ko kx kq kr ks hb bi translated">【<a class="ae lt" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank">https://travis-ci.org/</a></p><p id="d3b5" class="pw-post-body-paragraph jx jy hi jz b ka kt ij kc kd ku im kf kg kv ki kj kk kw km kn ko kx kq kr ks hb bi translated">【<a class="ae lt" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank">https://github.com/features/actions</a></p><p id="bd09" class="pw-post-body-paragraph jx jy hi jz b ka kt ij kc kd ku im kf kg kv ki kj kk kw km kn ko kx kq kr ks hb bi translated">https://github.com/marketplace/actions/github-pages-action<a class="ae lt" href="https://github.com/marketplace/actions/github-pages-action" rel="noopener ugc nofollow" target="_blank">⁴</a></p><p id="29ed" class="pw-post-body-paragraph jx jy hi jz b ka kt ij kc kd ku im kf kg kv ki kj kk kw km kn ko kx kq kr ks hb bi translated">[⁵]<a class="ae lt" href="https://docs.github.com/en/actions/hosting-your-own-runners/about-self-hosted-runners" rel="noopener ugc nofollow" target="_blank">https://docs . github . com/en/actions/hosting-your-own-runners/about-self-hosted-runners</a></p><p id="30c1" class="pw-post-body-paragraph jx jy hi jz b ka kt ij kc kd ku im kf kg kv ki kj kk kw km kn ko kx kq kr ks hb bi translated">https://julialang.org/<a class="ae lt" href="https://julialang.org/" rel="noopener ugc nofollow" target="_blank">⁶</a></p><p id="f551" class="pw-post-body-paragraph jx jy hi jz b ka kt ij kc kd ku im kf kg kv ki kj kk kw km kn ko kx kq kr ks hb bi translated">【⁷】<a class="ae lt" href="https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#example-using-localhost" rel="noopener ugc nofollow" target="_blank">https://docs . github . com/en/actions/reference/workflow-syntax-for-github-actions # example-using-localhost</a></p></div><div class="ab cl mo mp gp mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hb hc hd he hf"><p id="ead3" class="pw-post-body-paragraph jx jy hi jz b ka kt ij kc kd ku im kf kg kv ki kj kk kw km kn ko kx kq kr ks hb bi translated"><em class="lp">原载于2021年5月31日</em><a class="ae lt" href="https://cuda-chen.github.io/devops/2021/05/31/django-mysql-github-actions.html" rel="noopener ugc nofollow" target="_blank"><em class="lp">https://cuda-Chen . github . io</em></a><em class="lp">。</em></p></div></div>    
</body>
</html>