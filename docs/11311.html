<html>
<head>
<title>JavaScript Proxy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript代理</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/javascript-proxy-45efdd1f50f7?source=collection_archive---------9-----------------------#2022-03-16">https://medium.com/geekculture/javascript-proxy-45efdd1f50f7?source=collection_archive---------9-----------------------#2022-03-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/b7835aa313f54224c386499bf50e07d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OAwcABpcKryB6XbUucB-FA.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Javascript Proxy</figcaption></figure><div class=""/><p id="79c5" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">JavaScript代理是包装另一个对象并拦截目标对象的基本操作的对象。</p><p id="8be1" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> <em class="js">语法</em> </strong> <em class="js"> : </em></p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="f2cd" class="kc kd hx jy b fi ke kf l kg kh">let proxy = new Proxy(target, handler);</span></pre><ul class=""><li id="9402" class="ki kj hx iw b ix iy jb jc jf kk jj kl jn km jr kn ko kp kq bi translated"><code class="du kr ks kt jy b">target</code>–是要包装的对象，可以是任何东西，包括函数。</li><li id="1131" class="ki kj hx iw b ix ku jb kv jf kw jj kx jn ky jr kn ko kp kq bi translated"><code class="du kr ks kt jy b">handler</code>–代理配置:带有“陷阱”的对象，拦截操作的方法。–例如用于读取<code class="du kr ks kt jy b">target</code>属性的<code class="du kr ks kt jy b">get</code>陷阱，用于将属性写入<code class="du kr ks kt jy b">target</code>的<code class="du kr ks kt jy b">set</code>陷阱，等等。</li></ul><p id="7fb6" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们通过定义一个名为user的对象来看一个简单的例子:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="15d2" class="kc kd hx jy b fi ke kf l kg kh">const user = {<br/>    firstName: 'suprabha',<br/>    lastName: 'supi',<br/>}</span><span id="62b3" class="kc kd hx jy b fi kz kf l kg kh">// defining a handler function<br/>const handler = {}</span><span id="4d93" class="kc kd hx jy b fi kz kf l kg kh">// now, create a proxy<br/>const userProxy = new Proxy(user, handler);</span></pre><p id="19dd" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du kr ks kt jy b">userProxy</code>对象使用<code class="du kr ks kt jy b">user</code>对象存储数据。<code class="du kr ks kt jy b">userProxy</code>可以访问<code class="du kr ks kt jy b">user</code>对象的所有属性。</p><p id="c776" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们看看输出:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="3f6e" class="kc kd hx jy b fi ke kf l kg kh">console.log(userProxy.firstName); // suprabha<br/>console.log(userProxy.lastName); // supi</span></pre><p id="009c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你修改了原来的对象<code class="du kr ks kt jy b">user</code>，这种改变会反映在<code class="du kr ks kt jy b">userProxy</code>中</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="8bc6" class="kc kd hx jy b fi ke kf l kg kh">user.firstName = 'sam';<br/>console.log(userProxy.firstName); // sam</span></pre><p id="eed1" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">类似地，<code class="du kr ks kt jy b">userProxy</code>对象的变化将反映在原始对象<code class="du kr ks kt jy b">user</code>中:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="780a" class="kc kd hx jy b fi ke kf l kg kh">proxyUser.lastName = 's';<br/>console.log(user.lastName); // s</span></pre><p id="7ca8" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">代理中有方法，这里我们将介绍最重要的<strong class="iw hy">方法</strong>:</p><ol class=""><li id="c679" class="ki kj hx iw b ix iy jb jc jf kk jj kl jn km jr la ko kp kq bi translated">得到</li><li id="5bf2" class="ki kj hx iw b ix ku jb kv jf kw jj kx jn ky jr la ko kp kq bi translated">设置</li><li id="f687" class="ki kj hx iw b ix ku jb kv jf kw jj kx jn ky jr la ko kp kq bi translated">应用</li></ol><h1 id="938c" class="lb kd hx bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">1️.获取:</h1><p id="de78" class="pw-post-body-paragraph iu iv hx iw b ix ly iz ja jb lz jd je jf ma jh ji jj mb jl jm jn mc jp jq jr hb bi translated"><code class="du kr ks kt jy b"><strong class="iw hy">handler.get()</strong></code>方法是获取属性值的陷阱。</p><p id="59da" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您也可以使用<code class="du kr ks kt jy b">get</code>进行更改:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="6a8b" class="kc kd hx jy b fi ke kf l kg kh">const user = {<br/>    firstName: 'suprabha',<br/>    lastName: 'supi',<br/>}</span><span id="3af7" class="kc kd hx jy b fi kz kf l kg kh">// defining a handler function<br/>const handler = {<br/>    get(target, prop, receiver) {<br/>    return "sumi";<br/>  }<br/>}</span><span id="81d9" class="kc kd hx jy b fi kz kf l kg kh">// now, create a proxy<br/>const userProxy = new Proxy(user, handler);</span><span id="b7f6" class="kc kd hx jy b fi kz kf l kg kh">console.log(userProxy.firstName) // sumi<br/>console.log(userProxy.lastName)  // sumi</span></pre><p id="fa19" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">到目前为止，我们在用户对象中还没有<code class="du kr ks kt jy b">fullUserName</code>，所以让我们使用<code class="du kr ks kt jy b">get</code>陷阱在代理中创建它:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="63b4" class="kc kd hx jy b fi ke kf l kg kh">const user = {<br/>    firstName: 'suprabha',<br/>    lastName: 'supi',<br/>}</span><span id="6302" class="kc kd hx jy b fi kz kf l kg kh">const handler = {<br/>    get(target, property) {<br/>        return property === 'fullUserName' ?<br/>            `${target.firstName} ${target.lastName}` :<br/>            target[property]<br/>    }<br/>};</span><span id="ad48" class="kc kd hx jy b fi kz kf l kg kh">const userProxy = new Proxy(user, handler)</span><span id="758e" class="kc kd hx jy b fi kz kf l kg kh">console.log(userProxy.fullUserName) // suprabha supi</span></pre><h1 id="ee84" class="lb kd hx bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">2️.设置:</h1><p id="37e9" class="pw-post-body-paragraph iu iv hx iw b ix ly iz ja jb lz jd je jf ma jh ji jj mb jl jm jn mc jp jq jr hb bi translated"><code class="du kr ks kt jy b">set</code> trap控制设置<code class="du kr ks kt jy b">target</code>对象属性时的行为。</p><p id="ad64" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以，假设你必须添加一些条件，这样你就可以在<code class="du kr ks kt jy b">set</code>陷阱中完成。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="ddab" class="kc kd hx jy b fi ke kf l kg kh">const user = {<br/>    firstName: 'suprabha',<br/>    lastName: 'supi',<br/>        age: 15<br/>}</span><span id="aab3" class="kc kd hx jy b fi kz kf l kg kh">const handler = {<br/>    set(target, property, value) {<br/>        if (property === 'age') {<br/>            if (typeof value !== 'number') {<br/>                throw new Error('Age should be in number!');<br/>            }<br/>            if (value &lt; 18) {<br/>                throw new Error('The user must be 18 or older!')<br/>            }<br/>        }<br/>        target[property] = value;<br/>    }<br/>};</span><span id="be15" class="kc kd hx jy b fi kz kf l kg kh">const userProxy = new Proxy(user, handler);</span><span id="a9fe" class="kc kd hx jy b fi kz kf l kg kh">// if you try to set age to bool, you will get error<br/>userProxy.age = true;<br/>// Error: Age must be a number.</span><span id="3941" class="kc kd hx jy b fi kz kf l kg kh">userProxy.age = '16';<br/>// The user must be 18 or older.</span><span id="7b12" class="kc kd hx jy b fi kz kf l kg kh">userProxy.age = '20'<br/>// no errors would be found</span></pre><h1 id="10e5" class="lb kd hx bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">3️.应用</h1><p id="3d69" class="pw-post-body-paragraph iu iv hx iw b ix ly iz ja jb lz jd je jf ma jh ji jj mb jl jm jn mc jp jq jr hb bi translated"><code class="du kr ks kt jy b">handler.apply()</code>方法是函数调用的陷阱。下面是语法:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="0a64" class="kc kd hx jy b fi ke kf l kg kh">let proxy = new Proxy(target, {<br/>    apply: function(target, thisArg, args) {<br/>        //...<br/>    }<br/>});</span></pre><p id="aa69" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，让我们按照上面的例子，将名字和姓氏大写。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="80ad" class="kc kd hx jy b fi ke kf l kg kh">const user = {<br/>    firstName: 'suprabha',<br/>    lastName: 'supi'<br/>}</span><span id="0003" class="kc kd hx jy b fi kz kf l kg kh">const getFullName = function (user) {<br/>    return `${user.firstName} ${user.lastName}`;<br/>}</span><span id="1b80" class="kc kd hx jy b fi kz kf l kg kh">const getFullNameProxy = new Proxy(getFullName, {<br/>    apply(target, thisArg, args) {<br/>        return target(...args).toUpperCase();<br/>    }<br/>});</span><span id="6595" class="kc kd hx jy b fi kz kf l kg kh">console.log(getFullNameProxy(user)); // SUPRABHA SUPI</span></pre><h1 id="de47" class="lb kd hx bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">参考🧐</h1><ul class=""><li id="911b" class="ki kj hx iw b ix ly jb lz jf md jj me jn mf jr kn ko kp kq bi translated"><a class="ae mg" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" rel="noopener ugc nofollow" target="_blank">代理MDN </a></li></ul><p id="ca1a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">🌟<a class="ae mg" href="https://twitter.com/suprabhasupi" rel="noopener ugc nofollow" target="_blank">推特</a> |📚<a class="ae mg" href="https://gum.co/css-pseudo-class-elements" rel="noopener ugc nofollow" target="_blank">电子书</a> |🌟<a class="ae mg" href="https://www.instagram.com/suprabhasupi/" rel="noopener ugc nofollow" target="_blank"> Instagram </a></p></div></div>    
</body>
</html>