<html>
<head>
<title>Astronomer — Managed Airflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">天文学家管理的气流</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/astronomer-managed-airflow-bf283bd4054a?source=collection_archive---------7-----------------------#2022-04-10">https://medium.com/geekculture/astronomer-managed-airflow-bf283bd4054a?source=collection_archive---------7-----------------------#2022-04-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/0dd7b6fc9028e304f4c1658c32db63c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0hrSxPzxxiAV0-fA9ASTbw.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Image source — Google</figcaption></figure><div class=""/><p id="019d" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">天文学家平台概述</p><p id="30f3" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">天文学家提供气流管理服务。它允许单击一下即可提供气流实例。此外，它还为日志记录、监控和身份验证提供辅助服务。在生产中，它通常会部署在Kubernetes集群上。</p><figure class="jt ju jv jw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es js"><img src="../Images/6e938f4bb9a70020b1973e4075ae0790.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jpEfK9HfzsdZuskhKQxVww.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Astronomer Platform K8s components</figcaption></figure><h2 id="7d0c" class="jx jy hx bd jz ka kb kc kd ke kf kg kh jf ki kj kk jj kl km kn jn ko kp kq kr bi translated">平台</h2><p id="76ee" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">天文学家平台主要由以下组件组成:</p><p id="83cf" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> Astro UI </strong> — Web界面(react) <br/> <strong class="iw hy"> Astro CLI </strong> —与平台交互的命令行界面<br/> <strong class="iw hy"> Commander </strong> —休斯顿&amp;K8/赫尔姆(gRPC on 50051) <br/> <strong class="iw hy">休斯顿</strong> —控制平面，为graphql API供电，也有workers<br/><strong class="iw hy">Prisma</strong>—ORM for back end database(Postgres)<br/><strong class="iw hy">nginjx</strong></p><figure class="jt ju jv jw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kx"><img src="../Images/bb5645bb6151b1478008cb2b87fdd25e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jtKoJ8goCRzAXVnrIkjCGQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Communication between platform major components</figcaption></figure><h2 id="3653" class="jx jy hx bd jz ka kb kc kd ke kf kg kh jf ki kj kk jj kl km kn jn ko kp kq kr bi translated">记录</h2><p id="3e87" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">天文学家提供开箱即用的测井工具，包括以下组件:</p><p id="501b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> FluentD </strong> —日志收集守护进程(to ES)<br/><strong class="iw hy">elastic Search</strong>—客户端、导出器、数据、主机，它使用EBS卷进行存储<br/> <strong class="iw hy"> Kibana </strong> —搜索仪表板以查找ES</p><h2 id="1594" class="jx jy hx bd jz ka kb kc kd ke kf kg kh jf ki kj kk jj kl km kn jn ko kp kq kr bi translated">监视</h2><p id="ed6b" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">天文学家平台配有以下监控组件:</p><p id="643e" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> Grafana </strong> —指标仪表板<br/> <strong class="iw hy"> Prometheus </strong> —带有时间序列的中央指标<br/> <strong class="iw hy"> StatsD </strong> —将气流&amp;系统指标推送到Prometheus <br/> <strong class="iw hy">警报管理器</strong> —发送健康通知</p><figure class="jt ju jv jw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ky"><img src="../Images/24aa3a7e68820b7097156da1bca3e2df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*thw9WhiL00RyatSm-t_EOg.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Logging &amp; Monitoring In Astronomer</figcaption></figure><h2 id="516b" class="jx jy hx bd jz ka kb kc kd ke kf kg kh jf ki kj kk jj kl km kn jn ko kp kq kr bi translated">气流部件</h2><p id="06d7" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">在与Kubernetes executor一起运行时，天文学家中的每个部署主要有以下组件。</p><p id="eae9" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> webserver </strong> —为airflow UI <br/> <strong class="iw hy">调度器</strong> —运行airflow调度器和执行器电池<br/> <strong class="iw hy"> statsd </strong> —将日志从airflow &amp; K8s推送到Prometheus<br/><strong class="iw hy">pg bouncer</strong>—充当airflow后端数据库<br/> <strong class="iw hy">执行器</strong> — Pod的Db连接池，用于每个airflow任务。自动缩放&amp;归零</p><h2 id="a448" class="jx jy hx bd jz ka kb kc kd ke kf kg kh jf ki kj kk jj kl km kn jn ko kp kq kr bi translated">授权和认证:</h2><p id="279b" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">天文学家平台有三类角色。此外，该访问角色适用于系统、工作区和部署级别。</p><blockquote class="kz la lb"><p id="3f95" class="iu iv lc iw b ix iy iz ja jb jc jd je ld jg jh ji le jk jl jm lf jo jp jq jr hb bi translated">管理员—完全访问<br/>编辑器—操作角色(一些CRUD，但不是IAM) <br/>查看器—只读无CRUD</p></blockquote><figure class="jt ju jv jw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lg"><img src="../Images/4b70b2ddc515843e2bba5cf32ee4d453.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vlSTmBdqcsaVm0IJD1-r0w.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Astronomer infra components used</figcaption></figure><p id="75eb" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在上图中，我们有外围AWS服务，它们有助于建立强大的生产设置。</p><p id="7c21" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> S3 </strong> —日志存储&amp; Docker注册表后端<br/> <strong class="iw hy">代码神器</strong> — Python私有repo for airflow插件&amp;包<br/> <strong class="iw hy"> SSM </strong> — Airflow变量&amp;机密存储<br/> <strong class="iw hy"> CloudWatch </strong> —日志for K8s<br/><strong class="iw hy">route 53</strong>—DNS for the platform<br/><strong class="iw hy">IAM</strong>—控制K8s集群对其他资源的访问</p><h2 id="e69e" class="jx jy hx bd jz ka kb kc kd ke kf kg kh jf ki kj kk jj kl km kn jn ko kp kq kr bi translated">工作空间</h2><p id="459e" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">它是部署的逻辑集合。它也可以是业务或组织级别的分组。</p><h2 id="98e0" class="jx jy hx bd jz ka kb kc kd ke kf kg kh jf ki kj kk jj kl km kn jn ko kp kq kr bi translated">部署</h2><p id="f52e" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">这是气流环境的单一实例。每个部署都可以有单独的设置，并且可以容纳独立的Dag。</p><figure class="jt ju jv jw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lh"><img src="../Images/384c8b50e8d7b13a34b00b1b856198d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l-URaupJwSWIpfabTYcHug.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Workspace-deployment-namespace-database mapping</figcaption></figure><p id="101c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">每个部署都有额外容量(执行器)、调度程序和web服务器容量的资源配额。</p><h2 id="3fb2" class="jx jy hx bd jz ka kb kc kd ke kf kg kh jf ki kj kk jj kl km kn jn ko kp kq kr bi translated">用户</h2><p id="a368" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">在天文学家中，您创建/附加用户。为此，您可以邀请他们或从IdP导入用户。对于不同的天文学家构造，如工作空间、部署或平台，每个用户可以被授予不同的权限。部署角色被映射到RBAC航空公司。</p><p id="4c9c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">天文学家部署角色到气流角色映射</p><blockquote class="kz la lb"><p id="a495" class="iu iv lc iw b ix iy iz ja jb jc jd je ld jg jh ji le jk jl jm lf jo jp jq jr hb bi translated">管理员→管理员、编辑者→用户、查看者→查看者</p></blockquote><h2 id="7f12" class="jx jy hx bd jz ka kb kc kd ke kf kg kh jf ki kj kk jj kl km kn jn ko kp kq kr bi translated">服务帐户</h2><p id="c6be" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">对于CICD或自动化，您可以使用具有给定角色的服务帐户。它可以在工作区级别或部署级别。工作空间管理或部署管理服务帐户将能够通过天文学家CLI或Graphql APIs采取管理措施。</p><h2 id="dd3f" class="jx jy hx bd jz ka kb kc kd ke kf kg kh jf ki kj kk jj kl km kn jn ko kp kq kr bi translated">韵律学</h2><p id="0246" class="pw-post-body-paragraph iu iv hx iw b ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr hb bi translated">天文学家提供平台和部署级别的指标。一些在UI中可用，而另一些在Grafana中可用。</p><p id="4eb0" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在天文学家用户界面显示使用配额。</p><p id="0240" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在Grafana中，我们有关于平台和部署的每个组件的指标。</p><figure class="jt ju jv jw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es li"><img src="../Images/c6d12c5fcbce4fcd4849170e36cb5089.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2q5s4j194Y0YfAuU_DBpqw.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Grafana metrics</figcaption></figure><p id="0095" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这篇博客中，我试图给出一个平台的概述。希望这是有帮助的！！</p><p id="1152" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="lc">免责声明:天文学家的内部工作没有公开记录。这是我对平台版本v0.25的理解.</em></p></div></div>    
</body>
</html>