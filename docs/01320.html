<html>
<head>
<title>Essential Angular Form APIs You Should Know</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你应该知道的基本角形API</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/essential-angular-form-apis-you-should-know-5b0c12be0569?source=collection_archive---------3-----------------------#2021-04-06">https://medium.com/geekculture/essential-angular-form-apis-you-should-know-5b0c12be0569?source=collection_archive---------3-----------------------#2021-04-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/311faa035ad6750a97160726f76b28b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wi6nV6RsonI6KesuiF25wQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">The more frustrating problem you face in development, the more amazing solution you end up with.</figcaption></figure><p id="5282" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Angular reactive forms是一个强大的模块，用于管理web应用程序中的表单，但有时为了解决特定问题，我们可能会实现一些不必要的代码，而没有意识到已经有内置的解决方案可用。在这篇文章中，我们将回顾其中的一些。</p><h1 id="d994" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">发射事件:</strong></h1><p id="ab33" class="pw-post-body-paragraph iu iv hi iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">当我们修补值，设置值，启用或禁用表单时，我们有附加选项emitEvent，onlySelf作为参数传递。</p><p id="c57a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">emitEvent是当我们的表单值或状态改变时触发的事件。因此在官方<a class="ae kv" href="https://angular.io/api/forms/FormControl" rel="noopener ugc nofollow" target="_blank">文件中</a>:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="86bf" class="lf jt hi lb b fi lg lh l li lj">*emitEvent: When true or not supplied (the default), both the `statusChanges` and `valueChanges` observables emit events with the latest status and value when the control value is updated</span></pre><blockquote class="lk ll lm"><p id="1e12" class="iu iv ln iw b ix iy iz ja jb jc jd je lo jg jh ji lp jk jl jm lq jo jp jq jr hb bi translated">附注:启用或禁用表单控件也会触发值更改。</p></blockquote><p id="dd63" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，基本上当我们调用setValue、patchValue、disable、enable控件时，默认情况下它会触发值更改。</p><p id="d9f5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="ln">用例:</em></p><p id="bb31" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">假设您有一个实现ControlValueAccessor的自定义窗体控件。每当表单值改变时，父级上有监听器，触发更新数据api。当您从父控件更改表单值时，为了在自定义控件上反映此更改，您需要实现以下方法:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="d73a" class="lf jt hi lb b fi lg lh l li lj">public writeValue(newValue: number): void {<br/> this.value = newValue;<br/> this.streetControl.patchValue(newValue, { emitEvent: false });<br/>}</span></pre><p id="ac42" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果我们没有将emitEvent设置为false，它将触发valueChange，因此父窗体将触发不必要的api，这是我们在这里要避免的。</p><h1 id="1913" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">更新值和有效性:</h1><p id="8468" class="pw-post-body-paragraph iu iv hi iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">在我们深入研究另一个选项onlySelf之前，让我们先了解官方<a class="ae kv" href="https://github.com/angular/angular/blob/4a68e13d1b9dc2665679bb2b7c215f69a6ac8f98/packages/forms/src/model.ts#L715" rel="noopener ugc nofollow" target="_blank">文档</a>中的updateValueAndValidatity方法:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="209d" class="lf jt hi lb b fi lg lh l li lj">/**</span><span id="d156" class="lf jt hi lb b fi lr lh l li lj">* Recalculates the value and validation status of the control.</span><span id="82ed" class="lf jt hi lb b fi lr lh l li lj">* By default, it also updates the value and validity of its ancestors.</span><span id="e777" class="lf jt hi lb b fi lr lh l li lj">* @param opts Configuration options determine how the control propagates changes and emits events  after updates and validity checks are applied.</span><span id="d9e8" class="lf jt hi lb b fi lr lh l li lj">* `onlySelf`: When true, only update this control. When false or not supplied, update all direct ancestors. Default is false.</span><span id="d88d" class="lf jt hi lb b fi lr lh l li lj">* `emitEvent`: When true or not supplied (the default), both the `statusChanges` and `valueChanges` observables emit events with the latest status and value when the control is updated. When false, no events are emitted.</span><span id="f0e1" class="lf jt hi lb b fi lr lh l li lj">*/</span><span id="eef3" class="lf jt hi lb b fi lr lh l li lj">updateValueAndValidity(opts: {onlySelf?: boolean, emitEvent?: boolean} = {}): void {<br/>....</span></pre><p id="fea1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">简而言之，它重新计算控件的值和验证状态。当控件第一次初始化时，或者当我们调用窗体控件的patchValue、setValue、addControl、setControl或removeControl方法时，会触发该事件。</p><p id="59c7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用案例:</p><p id="846a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当我们更新表单控件的验证器时，这很有用。因为当我们更新验证器时，默认情况下它不会重新计算验证状态，所以您需要额外调用它。例如，假设我们有一个名为postalCode的表单，它具有动态验证器(这里依赖于国家字段)。当国家是美国时，我们设置验证器最大长度为5，在所有其他情况下最大长度为7。为了实现这一点，我们将编写如下代码<a class="ae kv" href="https://stackblitz.com/edit/angular-essential-form-apis" rel="noopener ugc nofollow" target="_blank">演示</a>:</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="ec6c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当国家值改变时，我们添加并重新验证邮政编码的状态。但是这里有一个小问题，updateValueAndValidity也会触发父窗体上的updateValueAndValidity方法。参见下面的代码</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="db11" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果我们在父节点上有异步验证器会怎么样？所以我们需要防止这种不必要的检查。这就是唯一自我选择的来源。</p><h1 id="83e8" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">仅自己:</h1><p id="2ffb" class="pw-post-body-paragraph iu iv hi iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">根据官方<a class="ae kv" href="https://angular.io/api/forms/FormControl" rel="noopener ugc nofollow" target="_blank">文件</a>:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="2b42" class="lf jt hi lb b fi lg lh l li lj">* `onlySelf`: When true, each change only affects this control, and not its parent. Default is false.</span></pre><p id="deff" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">简单地说，当我们调用updateValueAndValidity时，这也会触发父节点上的这种变化。为了解决前面例子中的问题，我们只需要添加新的参数:<a class="ae kv" href="https://stackblitz.com/edit/angular-essential-form-apis" rel="noopener ugc nofollow" target="_blank"> DEMO </a></p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="7b02" class="lf jt hi lb b fi lg lh l li lj">this.addressForm.get("postalCode").updateValueAndValidity({emitEvent: false, onlySelf: true});</span></pre><p id="0fdc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">还有其他一些基本的方法可用，比如markAsTouched、markAsDirty，但是因为它们很简单，所以我没有去碰它们。你可以看到下面的定义截图。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/83ccea4555dc4dcf2c41b7208374bdbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BpATPzrs4TNVtJuL3mbRAQ.png"/></div></div></figure><p id="f7d1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">仅此而已。希望对你有帮助。另外，请不要犹豫，通过文章回复或我的<a class="ae kv" href="https://twitter.com/Vugar005" rel="noopener ugc nofollow" target="_blank">推特</a>联系我！干杯！</p></div></div>    
</body>
</html>