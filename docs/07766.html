<html>
<head>
<title>Backend Design— Actix-web Project Hierarchy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">后端设计— Actix-web项目层次结构</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/backend-design-actix-web-project-hierarchy-7fc229bd830c?source=collection_archive---------0-----------------------#2021-09-30">https://medium.com/geekculture/backend-design-actix-web-project-hierarchy-7fc229bd830c?source=collection_archive---------0-----------------------#2021-09-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1608" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用Actix-web作为我的后端web框架。借用Django的想法，我认为在实现一个稍微中等规模的后端应用程序时，分享一些我对源代码层次的想法是一个好主意。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="d9b3" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">介绍</h1><p id="65d6" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">目前，我有机会帮助实现一个名为<a class="ae kn" href="https://www-staging.healyou.io/" rel="noopener ugc nofollow" target="_blank"> healyou </a>的后端服务。</p><p id="e3b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kn" href="https://www-staging.healyou.io/" rel="noopener ugc nofollow" target="_blank"> Healyou </a>是一项帮助人们轻松安排与心理咨询师远程会面的服务。</p><p id="6a6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的职责是实现一系列REST APIs，以便服务可以记录顾问、患者和预约状态。</p><h2 id="cad8" class="ko jl hi bd jm kp kq kr jq ks kt ku ju iq kv kw jy iu kx ky kc iy kz la kg lb bi translated">我们将在这篇文章中讨论什么</h2><p id="4970" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">在这篇文章中，我将尝试浏览以下主题</p><ul class=""><li id="58ea" class="lc ld hi ih b ii ij im in iq le iu lf iy lg jc lh li lj lk bi translated">源代码层次的重要性</li><li id="153d" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">模型/控制器</li></ul></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="fb5d" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">源代码层次的重要性</h1><p id="9b70" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">在开发项目时，源代码层次扮演着非常重要的角色。</p><p id="e3fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当项目越来越大，其他人试图理解你的代码时，首先要做的是(1)阅读文档，(2)追踪你的源代码。</p><p id="c594" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在跟踪代码时，良好的源代码层次结构可以帮助其他开发人员更快地赶上您的代码。</p><p id="bd98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Django，有一个<a class="ae kn" href="https://docs.djangoproject.com/en/3.2/ref/django-admin/" rel="noopener ugc nofollow" target="_blank"> manage.py </a>可以帮助你在你的项目中创建项目和应用。</p><p id="b9ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">Just like<a class="ae kn" href="https://en.wikipedia.org/wiki/Fuseki" rel="noopener ugc nofollow" target="_blank"> fuseki (布局)</a> in go, based on the experiences of other developer, the source code files are well organized and for other people familiar with Django, it surely improve the time to understand the entire project.</p><figure class="lr ls lt lu fd lv er es paragraph-image"><div class="er es lq"><img src="../Images/e9a82f173d0d4f3401fe239e053de374.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/0*lQmy2I0xrujYmHmT.png"/></div></figure><p id="8297" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一方面，Actix-web没有这样的工具来帮助你组织你的项目和应用。</p><p id="2596" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，没有官方的指导方针来讨论如何正确地放置你的代码。</p><p id="266a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我决定借鉴Django的思想，设计源代码层次结构以获得更好的可维护性。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="6d7c" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">设计的目标</h1><p id="1a29" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">我想要实现的是，当添加或修改一个端点(/api/v1/consultant)时，唯一要更改的代码将是与该端点相关的代码。</p><p id="583c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像Python一样，在Rust中，我们可以将代码组织成一个模块。</p><p id="264a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是源代码层次结构的一个片段。</p><pre class="lr ls lt lu fd ly lz ma mb aw mc bi"><span id="b323" class="ko jl hi lz b fi md me l mf mg">src/<br/>├── app<br/>│   ├── mod.rs<br/>│   ├── consultant<br/>│   │   ├── errors.rs<br/>│   │   ├── mod.rs<br/>│   │   ├── models.rs<br/>│   │   ├── tests.rs<br/>│   │   ├── urls.rs<br/>│   │   └── views.rs<br/>│   ├── patient<br/>│   │   ├── errors.rs<br/>│   │   ├── mod.rs<br/>│   │   ├── models.rs<br/>│   │   ├── tests.rs<br/>│   │   ├── urls.rs<br/>│   │   └── views.rs<br/>│   └── utils.rs<br/>├── db.rs<br/>└── main.rs</span></pre><p id="47a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在源文件夹中，有</p><ul class=""><li id="dd72" class="lc ld hi ih b ii ij im in iq le iu lf iy lg jc lh li lj lk bi translated">主模块</li><li id="b4cc" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">数据库模块</li><li id="bfd6" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">app::顾问模块</li><li id="7a1c" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">app::患者模块</li><li id="b4f6" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">app::utils模块</li></ul><h2 id="b734" class="ko jl hi bd jm kp kq kr jq ks kt ku ju iq kv kw jy iu kx ky kc iy kz la kg lb bi translated">1.主模块</h2><p id="a6cb" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">主模块负责设置actix_web:app并初始化整个服务的主循环。</p><figure class="lr ls lt lu fd lv"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="aee7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在修改API实现内容时，main.rs不太可能改变。</p><h2 id="1dff" class="ko jl hi bd jm kp kq kr jq ks kt ku ju iq kv kw jy iu kx ky kc iy kz la kg lb bi translated">2.数据库模块</h2><p id="43f2" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">数据库模块负责为需要访问数据库的API模型建立数据库连接池。</p><figure class="lr ls lt lu fd lv"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="a845" class="ko jl hi bd jm kp kq kr jq ks kt ku ju iq kv kw jy iu kx ky kc iy kz la kg lb bi translated">3.应用模块</h2><p id="8467" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">对于app::mod.rs文件，我需要提到的一点是register_urls函数。</p><p id="291f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将url注册逻辑分离到应用程序模块中，这样无论何时修改路由，main.rs都不需要更改。</p><figure class="lr ls lt lu fd lv"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="49b8" class="ko jl hi bd jm kp kq kr jq ks kt ku ju iq kv kw jy iu kx ky kc iy kz la kg lb bi translated">4.app::utils模块</h2><p id="0fe7" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">utils模块是一组实用函数和结构，将被其他API实现使用。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="4a54" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">模型/控制器</h1><p id="3898" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">因为服务是REST API服务器，这意味着这个项目没有视图。</p><p id="8db2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在设计源代码层次结构时，我只考虑以下指标。</p><ul class=""><li id="b57d" class="lc ld hi ih b ii ij im in iq le iu lf iy lg jc lh li lj lk bi translated">途径</li><li id="929d" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">控制器</li><li id="d04a" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">模型</li><li id="ce77" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">错误代码</li><li id="f367" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">试验</li></ul><p id="bb1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个app::$function模块代表一个独立的服务功能。</p><p id="d747" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如app::顾问负责处理顾问CRUD。</p><pre class="lr ls lt lu fd ly lz ma mb aw mc bi"><span id="21a9" class="ko jl hi lz b fi md me l mf mg">│   ├── consultant<br/>│   │   ├── errors.rs<br/>│   │   ├── mod.rs<br/>│   │   ├── models.rs<br/>│   │   ├── tests.rs<br/>│   │   ├── urls.rs<br/>│   │   └── views.rs</span></pre><h2 id="e302" class="ko jl hi bd jm kp kq kr jq ks kt ku ju iq kv kw jy iu kx ky kc iy kz la kg lb bi translated">1.途径</h2><p id="d41c" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated"><strong class="ih hj"> urls.rs </strong>负责定义API端点的路由。</p><h2 id="0921" class="ko jl hi bd jm kp kq kr jq ks kt ku ju iq kv kw jy iu kx ky kc iy kz la kg lb bi translated">2.控制器</h2><p id="7804" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated"><strong class="ih hj"> views.rs </strong>是服务端点的核心控制器业务逻辑。</p><h2 id="b6f3" class="ko jl hi bd jm kp kq kr jq ks kt ku ju iq kv kw jy iu kx ky kc iy kz la kg lb bi translated">3.模型</h2><p id="61dd" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated"><strong class="ih hj"> models.rs </strong>负责实现db相关的操作和结构。</p><p id="df68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Django中，它使用ORM来表示数据库数据。</p><p id="9231" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是在我当前的实现中，我使用了trait 中的<a class="ae kn" href="https://github.com/launchbadge/sqlx" rel="noopener ugc nofollow" target="_blank"> sqlx </a>和一些自定义struct with Rust <a class="ae kn" href="https://doc.rust-lang.org/std/convert/trait.From.html" rel="noopener ugc nofollow" target="_blank">来尝试实现相同的效果。</a></p><h2 id="5d36" class="ko jl hi bd jm kp kq kr jq ks kt ku ju iq kv kw jy iu kx ky kc iy kz la kg lb bi translated">4.错误</h2><p id="8e20" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">当试图缩小问题的根本原因时，错误代码非常重要。</p><p id="3205" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> errors.rs </strong>负责定义当前端点的错误代码，由控制器本身使用。</p><figure class="lr ls lt lu fd lv"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="6532" class="ko jl hi bd jm kp kq kr jq ks kt ku ju iq kv kw jy iu kx ky kc iy kz la kg lb bi translated">5.试验</h2><p id="444a" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">最后是测试部分。</p><p id="5c52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">测试。rs </strong>负责验证控制器和模型是否工作正常。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="b355" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">结论</h1><p id="fa96" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">这篇文章简要分享了我在使用actix-web开发REST API服务时的一些想法和经验。</p><p id="ac47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过使用这一理念，整个项目可以更具可读性和可维护性。</p></div></div>    
</body>
</html>