<html>
<head>
<title>Serverless Slack app architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器Slack应用架构</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/serverless-slack-app-architecture-d1f310338eba?source=collection_archive---------14-----------------------#2021-11-17">https://medium.com/geekculture/serverless-slack-app-architecture-d1f310338eba?source=collection_archive---------14-----------------------#2021-11-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8d66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章是我关于使用Slack优化手工实体解析的文章<a class="ae jd" rel="noopener" href="/geekculture/using-slack-to-optimize-manual-entity-resolution-f159b3745a5e">的后续文章</a>。在那篇文章中，我分享了我如何使用一个定制的Slack应用程序来促进一个人在回路中的过程，以验证具有相似但不精确匹配名称的合资企业之间的自动匹配。总之，该应用程序向用户呈现了两个风险匹配，并让他们选择将这两个匹配标记为“相同”、“不同”或“不确定”。一旦他们选择了一个选项，下一个潜在的匹配就会显示出来，并重复这个过程。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/a842538f233dc47104c4c01af8d86454.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*03ynbKc5I8onCJmSbE3zQg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">The app’s Home tab interface</figcaption></figure><p id="97cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我决定用无服务器的方式实现Slack应用。由于数据存储(合资企业)已经为我们的分析需要而设置，我只是用它来记录任何相关的应用程序活动(例如，谁审查了每场比赛，他们选择了哪个选项，等等)。).这意味着该应用程序不需要在其他任何地方存储持久数据，因此该架构的其余部分可以完全无服务器。</p><p id="57a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">没有什么比无服务器框架更容易进行无服务器开发了(<a class="ae jd" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">serverless.com</a>)。它(主要)是一个开源的基础设施即代码(IaC)框架，允许您使用单个YAML文件来配置和部署整个应用程序堆栈。它最适合不需要任何持久存储的应用程序，但无服务器应用程序也可以包括像S3桶和DynamoDB实例这样的资源。</p><p id="9483" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不能与您共享我的serverless.yml文件内容，但是当我编写了将检索和发布匹配项并执行所有其他与应用程序相关的工作的函数时，我的项目目录如下所示:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ju"><img src="../Images/4b5975b1504f8a2a267d2e19668c86bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*m2tm4NKq_VmJIk1Xtb3o1g.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx">A typical serverless project directory structure</figcaption></figure><p id="1b1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用无服务器CLI工具命令<code class="du jv jw jx jy b">sls deploy.</code>部署了应用后端</p><p id="b215" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总的来说，最终的应用架构如下所示:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jz"><img src="../Images/a9df1132acc55a066d60c601b1102622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OZiLwLjpIgG9J8kMuzmGww.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Serverless Slack app architecture</figcaption></figure><p id="5975" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Slack应用程序在Slack管理设置中进行配置，以便每当Slack应用程序主页选项卡打开时，发送一个有效负载到应用程序部署到AWS后生成的API网关URL。使用POST方法将有效负载发送到Amazon API Gateway，后者又将有效负载转发到“入口”Lambda函数，后者验证请求并触发工作流的其余部分。使用无服务器框架建立这种连接非常容易。该连接的整个配置如下所示:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ka"><img src="../Images/71998e69956e7f48c3ee9101070e68ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*UTUDpzXqEw_mxT5IC5P1rw.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx">An http events entry means the function can be executed via API Gateway</figcaption></figure><p id="08ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从那里，多个Python Lambda函数将消息发布到SNS主题，其他Python Lambda函数订阅这些主题。这意味着当新消息发布到SNS主题时，订阅的Lambda函数将被激活，它们将可以访问发布到SNS主题的任何消息。同样，使用serverless.yml配置很容易实现这种设置:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kb"><img src="../Images/3f56f45f5e22ffb4ae73a005d2da6a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vt5U0UJV6GUwllviMKLEjA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">The function publish_home_tab is now set up to fire whenever a message is published to the HomeTabPublish topic</figcaption></figure><p id="a1c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您在serverless.yml文件的<code class="du jv jw jx jy b">resources</code>部分进行配置，Serverless甚至会为您设置SNS主题:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kc"><img src="../Images/14ad5df9e8f2207faf4ab7a45a44203a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h5PNLP3stlXXuKJjOtLmCA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">!Ref in the previous image points to the resource being created here, specifically HomeTabPublishTopic</figcaption></figure><p id="2891" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">鉴于该应用的用户都是内部员工，整个堆栈的运行成本为0美元。这使得向我们的it部门销售变得相当容易！</p><p id="d5f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你知道了:无服务器和定制Slack应用是一个强有力的组合。对于小型工作负载，这种架构可以自由运行，几乎不需要维护。请留下您的想法或问题的评论；我很乐意分享更多！</p></div></div>    
</body>
</html>