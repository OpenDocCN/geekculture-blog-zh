<html>
<head>
<title>Kotlin — Null safe calls and why you should be cautious when using it</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">kot Lin——空安全调用以及为什么在使用它时要小心</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/kotlin-null-safe-calls-and-why-you-should-be-cautious-when-using-it-500cc362578a?source=collection_archive---------11-----------------------#2021-10-02">https://medium.com/geekculture/kotlin-null-safe-calls-and-why-you-should-be-cautious-when-using-it-500cc362578a?source=collection_archive---------11-----------------------#2021-10-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bfef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">不仅仅是消除IDE中的错误</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/68803a19f5c685ca98ba4dffbaf3c158.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H1-LLlPnWDgtXdQCNzuj8A.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Photo by <a class="ae ju" href="https://unsplash.com/@mikeyharris?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Mikey Harris</a> on <a class="ae ju" href="https://unsplash.com/s/photos/home-office?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f0c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我现在已经在一家软件代理公司工作了一段时间，有30多个android开发者。在进行代码审查时，我无数次遇到了Kotlin的空安全调用的错误或“危险”用法，如下所示…</p><pre class="jf jg jh ji fd jv jw jx jy aw jz bi"><span id="33ac" class="ka kb hi jw b fi kc kd l ke kf">account?.let {<br/>    imageView.loadImage(it.imageUrl)<br/>}</span></pre><p id="2deb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很少有人关注这种方法…</p><h2 id="7d9b" class="ka kb hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated">这将隐藏错误</h2><p id="05e9" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">如果这个特定的方法或屏幕需要<strong class="ih hj">帐户</strong>对象<strong class="ih hj"> </strong>，这样做将会隐藏错误并且很难调试。当<strong class="ih hj">账户</strong>对象<strong class="ih hj"> </strong>在运行app时意外为空时，将不会向用户显示任何有用的信息。</p><p id="4cd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">避免这种情况的一种方法是当<strong class="ih hj">帐户</strong>对象为空时，优雅地处理。</p><pre class="jf jg jh ji fd jv jw jx jy aw jz bi"><span id="eeb8" class="ka kb hi jw b fi kc kd l ke kf">account?.let {<br/>    imageView.loadImage(it.imageUrl)<br/>} ?: showErrorMessage("some helpful message here")</span></pre><p id="ed48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过这种方式，最终用户可以清楚地看到应用程序出现了问题，而不仅仅是显示一个空白屏幕。</p><h2 id="44df" class="ka kb hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated">这使得调试变得困难</h2><p id="b6c1" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">假设您正与两个或更多的开发人员一起开发这个特定的应用程序。当他们对类进行修改时，意外地发现<strong class="ih hj">帐户</strong>为空。其他开发人员将被晾在一边，不得不花时间调试代码，看看哪里出错了。</p><p id="cd35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">避免这种情况的一种方法是抛出一个异常，清楚地声明一条消息。</p><pre class="jf jg jh ji fd jv jw jx jy aw jz bi"><span id="868a" class="ka kb hi jw b fi kc kd l ke kf">fun displayAccount(): {<br/>    if (account == null) {<br/>        throw IllegalStateException(<br/>            "Account is unexpectedly null. Make sure to call init() before calling this method."<br/>        )<br/>    }<br/>    ...<br/>    // display account <br/>}</span></pre><p id="5bd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过这种方式，您将使其他开发人员更容易看到是什么导致了错误。</p><h1 id="bb6e" class="le kb hi bd kg lf lg lh kk li lj lk ko ll lm ln kr lo lp lq ku lr ls lt kx lu bi translated">结论</h1><p id="22ea" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">我们在使用Kotlin的空安全调用时需要小心，我们不能只是为了消除IDE中显示的错误而使用它们。</p><p id="7576" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我并没有放弃使用科特林的无效安全呼叫的想法。其实这些都是很有用的，我们只需要知道什么时候适当的使用它们。</p><p id="7a02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我能想到的一件事就是在ViewModel中清理资源。</p><pre class="jf jg jh ji fd jv jw jx jy aw jz bi"><span id="7e8f" class="ka kb hi jw b fi kc kd l ke kf">// ViewModel.kt</span><span id="3a1b" class="ka kb hi jw b fi lv kd l ke kf">fun onCleared() {<br/>   ...<br/>   account?.removeListeners()<br/>}</span></pre><p id="aca7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有可能<strong class="ih hj">帐户</strong>对象尚未初始化，用户立即关闭了屏幕——这时空安全调用就派上了用场。在这种情况下，没有必要显示用户友好的错误或抛出异常。</p></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><h1 id="1d25" class="le kb hi bd kg lf md lh kk li me lk ko ll mf ln kr lo mg lq ku lr mh lt kx lu bi translated">就是这样！</h1><p id="a6ad" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">我希望我能通过这篇文章帮助一些人。感谢您的阅读和快乐编码！</p></div></div>    
</body>
</html>