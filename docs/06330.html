<html>
<head>
<title>Using the new Unity input system with MLAPI in a multiplayer game (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在多人游戏中使用新的Unity输入系统和MLAPI(第1部分)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/using-the-new-unity-input-system-with-mlapi-in-a-multiplayer-game-part-1-eabd244b47e?source=collection_archive---------11-----------------------#2021-08-17">https://medium.com/geekculture/using-the-new-unity-input-system-with-mlapi-in-a-multiplayer-game-part-1-eabd244b47e?source=collection_archive---------11-----------------------#2021-08-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3090cd0cac616704aa544797fa23161a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vQXh5Ify6d6MjlEc"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@hellolightbulb?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Hello Lightbulb</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="5fb6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">MLAPI是unity的新中级网络库。这减少了网络代码，并通过提供网络的高级抽象消除了重复的网络任务，让我们专注于游戏开发。MLAPI是开源的，没有附加成本或限制，全部免费提供。</p><p id="f7a7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该输入系统实现了一种使用任何输入设备来控制统一内容的新方法。它旨在成为Unity经典输入管理器的更强大、更灵活、更可配置的替代品。</p><p id="c07a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本指南中，我将展示使用新的Unity输入系统为使用MLAPI的多人游戏开发一个有效的多平台控件的每个步骤。</p><p id="9580" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本指南分为2个部分，第一部分展示了如何配置Unity新输入系统，第二部分展示了通过MLAPI实现多人游戏和网络玩家的移动，这第二部分可在以下链接中找到:</p><div class="jt ju ez fb jv jw"><a href="https://brandres.medium.com/using-the-new-unity-input-system-with-mlapi-in-a-multiplayer-game-part-2-c4e455933532" rel="noopener follow" target="_blank"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hj fi z dy kb ea eb kc ed ef hh bi translated">在多人游戏中使用新的Unity输入系统和MLAPI(第二部分)</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">再次你好，这是指南的第二部分(也是最后一部分)来实现使用Unity新…</h3></div><div class="ke l"><p class="bd b fp z dy kb ea eb kc ed ef dx translated">brandres.medium.com</p></div></div><div class="kf l"><div class="kg l kh ki kj kf kk io jw"/></div></div></a></div><p id="3f1b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">您可以在下面看到指南各部分的详细内容:</strong></p><h1 id="b2cc" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">第1部分的内容:</h1><ul class=""><li id="74ba" class="lj lk hi ix b iy ll jc lm jg ln jk lo jo lp js lq lr ls lt bi translated"><strong class="ix hj">安装输入系统包。</strong></li><li id="de9e" class="lj lk hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated"><strong class="ix hj">创建输入动作。</strong></li><li id="f886" class="lj lk hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated">创建玩家预设。</li><li id="7932" class="lj lk hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated"><strong class="ix hj">创建玩家动作脚本。</strong></li></ul><h1 id="a207" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated"><strong class="ak">第二部分内容:</strong></h1><ul class=""><li id="703d" class="lj lk hi ix b iy ll jc lm jg ln jk lo jo lp js lq lr ls lt bi translated"><strong class="ix hj">安装MLAPI包。</strong></li><li id="0359" class="lj lk hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated"><strong class="ix hj">创建网络管理器对象。</strong></li><li id="bdc9" class="lj lk hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated"><strong class="ix hj">创建世界管理器对象和脚本。</strong></li><li id="fa22" class="lj lk hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated"><strong class="ix hj">实施网络化运动。</strong></li><li id="85e0" class="lj lk hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated"><strong class="ix hj">测试游戏</strong></li></ul><p id="8c37" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，您可以通过以下链接查看本指南的整个Unity项目:</p><div class="jt ju ez fb jv jw"><a href="https://github.com/brandres/MLAPI-InputSystem-Example" rel="noopener  ugc nofollow" target="_blank"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hj fi z dy kb ea eb kc ed ef hh bi translated">GitHub-brand RES/ml API-input system-示例</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">通过在GitHub上创建帐户，为brand RES/ml API-input system-Example开发做出贡献。</h3></div><div class="ke l"><p class="bd b fp z dy kb ea eb kc ed ef dx translated">github.com</p></div></div><div class="kf l"><div class="lz l kh ki kj kf kk io jw"/></div></div></a></div></div><div class="ab cl ma mb gp mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hb hc hd he hf"><h2 id="c1c3" class="mh km hi bd kn mi mj mk kr ml mm mn kv jg mo mp kz jk mq mr ld jo ms mt lh mu bi translated"><strong class="ak">安装输入系统包</strong></h2><p id="0a67" class="pw-post-body-paragraph iv iw hi ix b iy ll ja jb jc lm je jf jg mv ji jj jk mw jm jn jo mx jq jr js hb bi translated">首先我们要通过Unity的包管理器来安装新的输入系统包，包管理器是从菜单:<strong class="ix hj">窗口&gt;包管理器打开的。</strong>我们需要在顶部的Packages菜单中选择Unity Registry中的<strong class="ix hj"> </strong>包，从列表中选择输入的<strong class="ix hj">系统</strong>包，点击<strong class="ix hj">安装</strong>。</p><figure class="mz na nb nc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/995a6b6839d910fa71a25257fc92feaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*malJnXqcvgcQl_Gpl-0hfg.png"/></div></div></figure><h2 id="5301" class="mh km hi bd kn mi mj mk kr ml mm mn kv jg mo mp kz jk mq mr ld jo ms mt lh mu bi translated">创建输入操作</h2><p id="1978" class="pw-post-body-paragraph iv iw hi ix b iy ll ja jb jc lm je jf jg mv ji jj jk mw jm jn jo mx jq jr js hb bi translated">安装输入系统包后，我们必须通过右击资产窗口并在菜单中选择<strong class="ix hj">创建&gt;输入动作</strong>来创建输入动作资产:</p><figure class="mz na nb nc fd ij er es paragraph-image"><div class="er es nd"><img src="../Images/e0c617e79e260a5456285337966ce290.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*Gb5DbDq4o2-mBWq8EA7qNw.png"/></div></figure><p id="c1b1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将创建输入操作资产，并让我们选择资产的名称。在项目浏览器中双击该资源，或者在该资源的检查器中选择<strong class="ix hj">编辑资源</strong>按钮，打开动作编辑器，您可以在其中编辑动作设置以满足项目的需要。</p><blockquote class="ne nf ng"><p id="61f6" class="iv iw nh ix b iy iz ja jb jc jd je jf ni jh ji jj nj jl jm jn nk jp jq jr js hb bi translated">默认情况下，当您存储项目时，Unity不会存储您在“动作资源”窗口中所做的编辑。要保存您的更改，在窗口的工具栏中选择<strong class="ix hj">保存资产</strong>。要放弃您的更改，请关闭窗口并在出现提示时选择<strong class="ix hj">不要保存</strong>。或者，您可以通过启用工具栏中的<strong class="ix hj">自动保存</strong>复选框来打开自动保存。这将保存对该资产的任何更改。</p></blockquote><p id="8f73" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">以本指南</strong>为例，使用两个键(A和D)在X轴上从左向右移动角色。为了实现这个特定的例子，在<strong class="ix hj">动作编辑器</strong>中，我将配置播放器的动作和绑定，以便“A”键返回正值,“D”键总是返回负值。这样，我们可以知道在任何给定的时刻哪个键被按下，并相应地移动角色。</p><figure class="mz na nb nc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nl"><img src="../Images/9fedc958f32aafeea35dab1c7e6e03a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CaKfRmqdshrMZSJPlkVD7A.png"/></div></div></figure><p id="d790" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如你所见，我使用左窗格<em class="nh">、</em>上的+按钮创建了一个名为<em class="nh">玩家</em>的<strong class="ix hj">动作图</strong>，这个动作图只是可以批量启用或禁用的动作集合。然后我使用中间窗格上的+按钮添加了一个名为<em class="nh">移动</em>的<strong class="ix hj">动作</strong>，这个名称反映了将要对关联的<em class="nh">绑定做什么动作。</em>在这种情况下，此操作有一个关联的1D轴组合，它有两个绑定，A键绑定返回负值，D键绑定返回正值。</p><p id="6907" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是一个设备(键盘)的所有绑定配置，但如果你想让它成为多设备，你必须为你想在游戏中使用的每个设备添加一个控制方案。这可以在顶部菜单中完成:<strong class="ix hj">所有控制方案&gt;添加新的控制方案。</strong></p><p id="8214" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我建议只使用一种控制方案，因为当你在多人游戏中有多个设备时，它会有问题。这个问题包括当网络管理器实例化每个玩家预置时错误的设备分配，因为每个克隆具有分配给它的不同设备，而当克隆具有分配给它们的相同设备是正确的，并且对所有克隆进行设备改变，使得它们总是具有分配给它们的相同设备。</p><h2 id="8655" class="mh km hi bd kn mi mj mk kr ml mm mn kv jg mo mp kz jk mq mr ld jo ms mt lh mu bi translated">创建玩家预设</h2><p id="6375" class="pw-post-body-paragraph iv iw hi ix b iy ll ja jb jc lm je jf jg mv ji jj jk mw jm jn jo mx jq jr js hb bi translated">接下来，如果尚未创建播放器，则需要创建播放器。在我的例子中，我将作为玩家创建一个2D广场。</p><figure class="mz na nb nc fd ij er es paragraph-image"><div class="er es nm"><img src="../Images/fe7f4027b63e2fc7603025e26ea26edc.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*t2LPJHjKYN9b88idyIcuGw.png"/></div></figure><p id="7d75" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们必须将玩家输入组件添加到玩家预设中，然后将之前创建的输入动作资产添加到玩家输入组件的动作属性中，如下所示:</p><figure class="mz na nb nc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nn"><img src="../Images/d2ed78d79d6f6b583aab35a2bff46223.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HmDxviI9Mvu7cW4zuHbFPg.png"/></div></div></figure><p id="33e1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，我们必须在玩家输入组件中建立behavior属性，在这里您可以选择最方便的方式，在我的例子中，我将选择invoke unity events behaviour。这意味着组件的某些事件将执行我们稍后分配的回调。这些事件取决于我们如何设计输入动作资产，但是其他默认事件总是会出现。</p><h2 id="8db0" class="mh km hi bd kn mi mj mk kr ml mm mn kv jg mo mp kz jk mq mr ld jo ms mt lh mu bi translated">创建玩家运动脚本</h2><p id="30b5" class="pw-post-body-paragraph iv iw hi ix b iy ll ja jb jc lm je jf jg mv ji jj jk mw jm jn jo mx jq jr js hb bi translated">下一步取决于你如何实现玩家的移动，你需要为你在动作编辑器中创建的每个动作准备一个函数，每个动作必须被路由到一个目标方法，通过它的参数你可以获得触发动作的控件的值。</p><p id="88c0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如我们已经知道的，在我的例子中，我只有一个称为移动的动作，它有一个1D轴合成，其中A键向负方向拉动(最小值:-1)，D键向正方向拉动(最大值:1)。这意味着当A或D键被按下时，移动动作回调方法将被触发，当A键被按下时，从参数it获得的值将为-1，当D键被按下时，为1。</p><p id="e45b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">考虑到所有这些，我创建了名为<strong class="ix hj"> Player.cs </strong>的玩家移动脚本资产，在其中我实现了OnMovement方法来处理移动动作。</p><figure class="mz na nb nc fd ij er es paragraph-image"><div class="er es no"><img src="../Images/d6f49038c6e9381a13053aff3c6b16fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*8oce8WUBF6TSENpBQJP-lw.png"/></div></figure><p id="dba0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="nh">一旦我们创建了动作脚本和动作方法处理程序，</em> <strong class="ix hj"> <em class="nh">我们必须将脚本作为组件添加到玩家预设</em> </strong> <em class="nh">。</em></p><p id="d094" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我将OnMovement方法分配给玩家预置的玩家输入组件中的移动玩家事件:</p><figure class="mz na nb nc fd ij er es paragraph-image"><div class="er es np"><img src="../Images/a4593115062aea0db5f8f0e4aa7a23c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*26M5vrInUTZrGIAV0eCNiQ.png"/></div></figure><p id="cb1e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，OnMovement方法将在我每次按下A或D键时执行，通过参数-1指示A键是否被按下，或1指示D键是否被按下。</p><p id="17d7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">这是第一部分的全部内容，现在我们必须使用MLAPI完成所有必要的多人游戏配置，并使用Unity的新输入系统创建网络移动逻辑，我将在本指南的第二部分介绍所有这些内容，您可以通过以下链接访问:</strong></p><div class="jt ju ez fb jv jw"><a href="https://brandres.medium.com/using-the-new-unity-input-system-with-mlapi-in-a-multiplayer-game-part-1-eabd244b47e" rel="noopener follow" target="_blank"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hj fi z dy kb ea eb kc ed ef hh bi translated">在多人游戏中使用新的Unity输入系统和MLAPI(第1部分)</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">MLAPI是unity的新中级网络库。这减少了网络代码并消除了重复的…</h3></div><div class="ke l"><p class="bd b fp z dy kb ea eb kc ed ef dx translated">brandres.medium.com</p></div></div><div class="kf l"><div class="nq l kh ki kj kf kk io jw"/></div></div></a></div><p id="5c8f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你对这一部分有任何疑问或建议，你可以毫无问题地向我提出意见😉。</p><p id="8752" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望这有所帮助👍</p><p id="e9a3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">干杯。</p><h2 id="1aa6" class="mh km hi bd kn mi mj mk kr ml mm mn kv jg mo mp kz jk mq mr ld jo ms mt lh mu bi translated">有关本指南主题的更多信息，请访问以下链接:</h2><ul class=""><li id="4b92" class="lj lk hi ix b iy ll jc lm jg ln jk lo jo lp js lq lr ls lt bi translated"><a class="ae iu" href="https://unity.com/features/input-system" rel="noopener ugc nofollow" target="_blank">https://unity.com/features/input-system</a></li><li id="7cb4" class="lj lk hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated"><a class="ae iu" href="http://docs.unity3d.com/Packages/com.unity.inputsystem@1.1/manual/index.html" rel="noopener ugc nofollow" target="_blank">http://docs . unity 3d . com/Packages/com . unity . input system @ 1.1/manual/index . html</a></li><li id="a7be" class="lj lk hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated"><a class="ae iu" href="http://docs.unity3d.com/Packages/com.unity.inputsystem@1.1/manual/Installation.html" rel="noopener ugc nofollow" target="_blank">http://docs . unity 3d . com/Packages/com . unity . input system @ 1.1/manual/installation . html</a></li><li id="444a" class="lj lk hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated"><a class="ae iu" href="http://docs.unity3d.com/Packages/com.unity.inputsystem@1.1/manual/QuickStartGuide.html" rel="noopener ugc nofollow" target="_blank">http://docs . unity 3d . com/Packages/com . unity . input system @ 1.1/manual/quick start guide . html</a></li><li id="67f7" class="lj lk hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated"><a class="ae iu" href="http://docs.unity3d.com/Packages/com.unity.inputsystem@1.1/manual/ActionAssets.html#editing-input-action-assets" rel="noopener ugc nofollow" target="_blank">http://docs . unity 3d . com/Packages/com . unity . input system @ 1.1/manual/action assets . html # editing-input-action-assets</a></li><li id="d3cf" class="lj lk hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated"><a class="ae iu" href="http://docs.unity3d.com/Packages/com.unity.inputsystem@1.1/manual/ActionBindings.html" rel="noopener ugc nofollow" target="_blank">http://docs . unity 3d . com/Packages/com . unity . input system @ 1.1/manual/action bindings . html</a></li><li id="0005" class="lj lk hi ix b iy lu jc lv jg lw jk lx jo ly js lq lr ls lt bi translated"><a class="ae iu" href="http://docs.unity3d.com/Packages/com.unity.inputsystem@1.1/manual/Components.html" rel="noopener ugc nofollow" target="_blank">http://docs . unity 3d . com/Packages/com . unity . input system @ 1.1/manual/components . html</a></li></ul><h2 id="ddd2" class="mh km hi bd kn mi mj mk kr ml mm mn kv jg mo mp kz jk mq mr ld jo ms mt lh mu bi translated">此外，下面的视频教程非常好，也非常有趣，因为它与指南的第一部分非常相关:</h2><figure class="mz na nb nc fd ij"><div class="bz dy l di"><div class="nr ns l"/></div></figure></div></div>    
</body>
</html>