<html>
<head>
<title>How to extract Reddit posts using python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用python提取Reddit帖子</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-extract-reddit-posts-for-an-nlp-project-56d121b260b4?source=collection_archive---------0-----------------------#2021-12-31">https://medium.com/geekculture/how-to-extract-reddit-posts-for-an-nlp-project-56d121b260b4?source=collection_archive---------0-----------------------#2021-12-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="fadd" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">并将其用于您的自然语言处理相关项目</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/8f57f4cf6cba4b90fef429d9d575c77c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*n5eR5dHvyQ1EH-tn"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@brett_jordan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Brett Jordan</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="224f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi kk translated">年底到了，我们又带着另一篇数据摘录文章回来了。我很高兴今年以一个<strong class="jq hj"> </strong> <a class="ae jn" rel="noopener" href="/geekculture/how-to-build-a-simple-web-scraper-using-beautifulsoup-2f2f0f97dc47"> <strong class="jq hj">数据刮贴</strong> </a>开始在介质上写作，以另一个结束一年。</p><p id="c07c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这一次，我们将从Reddit帖子中提取数据。所以，事不宜迟，我们开始吧。</p><p id="f2d0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，您应该具备以下要求，才能成功完成本次动手练习。</p><ol class=""><li id="8a69" class="kt ku hi jq b jr js ju jv jx kv kb kw kf kx kj ky kz la lb bi translated"><strong class="jq hj">您的系统中安装了Python 3.6 </strong>或以上版本。</li><li id="a3fa" class="kt ku hi jq b jr lc ju ld jx le kb lf kf lg kj ky kz la lb bi translated">一个<strong class="jq hj"> Reddit账户</strong></li><li id="b192" class="kt ku hi jq b jr lc ju ld jx le kb lf kf lg kj ky kz la lb bi translated">Reddit帐户<strong class="jq hj">客户id </strong>和<strong class="jq hj">客户机密</strong></li><li id="5744" class="kt ku hi jq b jr lc ju ld jx le kb lf kf lg kj ky kz la lb bi translated">一个Reddit账户<strong class="jq hj">用户代理。</strong></li></ol><p id="9f07" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">前两个是不言自明的。但是对于客户机id、客户机机密和用户代理，请跟我来。</p><h1 id="326a" class="lh li hi bd lj lk ll lm ln lo lp lq lr io ls ip lt ir lu is lv iu lw iv lx ly bi translated">获取您的客户ID和密码</h1><p id="c0e7" class="pw-post-body-paragraph jo jp hi jq b jr lz ij jt ju ma im jw jx mb jz ka kb mc kd ke kf md kh ki kj hb bi translated">一旦你在你的系统中安装了Python3.6或更高版本，并为你自己创建了一个Reddit帐户，然后登录你的Reddit帐户。然后，去<a class="ae jn" href="https://www.reddit.com/prefs/apps" rel="noopener ugc nofollow" target="_blank">reddit.com/prefs/apps</a></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="ab fe cl me"><img src="../Images/2699a17f8d6eb15f0789801c320d62cc.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Ftj6KgkJxQ-Nkmtb1PsHAA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Image by Author(<a class="ae jn" rel="noopener" href="/@retinpkumar">https://medium.com/@retinpkumar</a>)</figcaption></figure><p id="c3b2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，正如你在图中看到的，点击<strong class="jq hj">“创建应用程序”</strong>按钮。在创建应用程序时，选择<strong class="jq hj">“脚本”</strong>，然后给你的应用程序起一个你自己选择的名字。你可以避免填写描述和关于网址，因为它不是强制性的。</p><p id="2d71" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，你要在重定向uri处输入<strong class="jq hj">“http://localhost:8080”</strong>或<strong class="jq hj">“http://localhost:[你选择的端口号]”</strong>，按<strong class="jq hj">“创建app”</strong>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="ab fe cl me"><img src="../Images/7738eea48e321e9fd53cda08bb0c2871.png" data-original-src="https://miro.medium.com/v2/format:webp/1*E2L0uF_eu6KbDt6InkPEcw.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Image by Author(<a class="ae jn" rel="noopener" href="/@retinpkumar">https://medium.com/@retinpkumar</a>)</figcaption></figure><p id="3bc1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，您已经创建了您的应用程序，您可以在左上角的<strong class="jq hj">“个人使用脚本”</strong>下找到您的客户端id。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="ab fe cl me"><img src="../Images/04f9349abbbb010e60504f9e2b7c9474.png" data-original-src="https://miro.medium.com/v2/format:webp/1*AO5fqYsntdgddDq0DdbATA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Image by Author(<a class="ae jn" rel="noopener" href="/@retinpkumar">https://medium.com/@retinpkumar</a>)</figcaption></figure><p id="d214" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">同样，你可以看到你的<strong class="jq hj">【秘密】</strong>也就是你的客户秘密。</p></div><div class="ab cl mf mg gp mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hb hc hd he hf"><h1 id="230a" class="lh li hi bd lj lk mm lm ln lo mn lq lr io mo ip lt ir mp is lv iu mq iv lx ly bi translated">创建刮刀</h1><p id="451a" class="pw-post-body-paragraph jo jp hi jq b jr lz ij jt ju ma im jw jx mb jz ka kb mc kd ke kf md kh ki kj hb bi translated">现在，是时候穿上我们的开发者外衣，运行终端了。</p><p id="4fc7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">首先要做的是安装一个名为<strong class="jq hj">‘PRAW’</strong>(Python Reddit API Wrapper)的库。您可以通过在终端中运行以下命令来做到这一点。</p><pre class="iy iz ja jb fd mr ms mt mu aw mv bi"><span id="4bf8" class="mw li hi ms b fi mx my l mz na">pip install praw</span></pre><p id="a012" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦你完成了PRAW的安装，是时候把它导入到你的脚本中了。</p><pre class="iy iz ja jb fd mr ms mt mu aw mv bi"><span id="1d66" class="mw li hi ms b fi mx my l mz na">import praw</span></pre><p id="c096" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，我们将使用“praw”库中的Reddit类创建scraper实例。</p><p id="9c7e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为此，让我们首先<strong class="jq hj">定义将为我们访问数据的user_agent </strong>。你可以给任何你喜欢的名字。在这里，我决定用<strong class="jq hj">“praw _ scraper _ 1.0”。</strong></p><p id="fbca" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后，使用您的Reddit帐户凭证创建一个Reddit实例，如下所示。</p><p id="401f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">请注意，如果您希望收集超过100篇帖子，您只需指定您的用户名和密码。</p><pre class="iy iz ja jb fd mr ms mt mu aw mv bi"><span id="f737" class="mw li hi ms b fi mx my l mz na"># Define user agent<br/>user_agent = "praw_scraper_1.0"<br/><br/># Create an instance of reddit class<br/>reddit = praw.Reddit(username="username",<br/>                     password="password",<br/>                     client_id="client id",<br/>                     client_secret="client secret",<br/>                     user_agent=user_agent<br/>)</span></pre><p id="1cdf" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，指定需要从中抓取数据的子编辑。</p><pre class="iy iz ja jb fd mr ms mt mu aw mv bi"><span id="a54f" class="mw li hi ms b fi mx my l mz na"># Create sub-reddit instance<br/>subreddit_name = "deeplearning"<br/>subreddit = reddit.subreddit(subreddit_name)</span></pre><p id="7fff" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">通过显示来确认您的子编辑是否正确。</p><pre class="iy iz ja jb fd mr ms mt mu aw mv bi"><span id="f231" class="mw li hi ms b fi mx my l mz na"># Printing subreddit info<br/>print(subreddit.display_name)</span></pre><p id="a59a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，我们将使用subreddit对象来提取数据</p><p id="ed81" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们导入pandas库并创建一个数据框。</p><pre class="iy iz ja jb fd mr ms mt mu aw mv bi"><span id="670b" class="mw li hi ms b fi mx my l mz na">import pandas as pd<br/><br/>df = pd.DataFrame()</span></pre><p id="cf73" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果您的系统中没有安装pandas，您可以使用下面的代码来这样做。</p><pre class="iy iz ja jb fd mr ms mt mu aw mv bi"><span id="9a78" class="mw li hi ms b fi mx my l mz na">pip install pandas</span></pre><p id="0ab3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，我们需要知道你能在Reddit上找到的各种类型的帖子。这些可以分为<strong class="jq hj">新的，顶级的，热门的，有争议的，上升的，镀金的。</strong></p><p id="c4b8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果您不知道可以抓取哪些项目，请运行下面的代码并传入subreddit对象。它将列出所有可能的属性，你可以使用这个对象。</p><pre class="iy iz ja jb fd mr ms mt mu aw mv bi"><span id="a5a2" class="mw li hi ms b fi mx my l mz na">vars(submission)</span></pre><p id="9d91" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">对于这篇文章，我将收集<strong class="jq hj">‘新’</strong>类别下的21篇文章的标题、id和投票。为此，让我们创建3个列表来存储每个帖子的详细信息。</p><pre class="iy iz ja jb fd mr ms mt mu aw mv bi"><span id="50e1" class="mw li hi ms b fi mx my l mz na">titles=[]<br/>scores=[]<br/>ids=[]</span></pre><p id="615f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，为了访问新的帖子，我们应该使用subreddit实例创建一个generator对象，并循环遍历我们希望抓取的所有帖子。</p><p id="0b36" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">创建对象时，我们可以传入一个名为<strong class="jq hj">“limit”</strong>的参数，该参数将限制我们希望抓取的帖子的数量。</p><p id="63c3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">但是，有一个警告。</p><p id="254e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">请记住，当我们创建scraper应用程序时，我们提到了我们的用户id和密码，以便根据需要抓取尽可能多的帖子。</p><p id="2689" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以通过设置参数<strong class="jq hj">“limit = None”来实现。</strong></p><p id="2e80" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">默认情况下，如果您不提及limit参数，scraper将获取100篇帖子的详细信息。因为我们将我们的帖子限制为21个，所以我们将在我们的对象中传递<strong class="jq hj"> "limit=21" </strong>。</p><pre class="iy iz ja jb fd mr ms mt mu aw mv bi"><span id="dfb8" class="mw li hi ms b fi mx my l mz na">for submission in subreddit.new(limit=21):<br/>    titles.append(submission.title)<br/>    scores.append(submission.score) #upvotes<br/>    ids.append(submission.id)</span></pre><p id="4e35" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，我们已经将所需的详细信息提取到列表中，我们将创建一个数据框并查看我们收集的数据。</p><pre class="iy iz ja jb fd mr ms mt mu aw mv bi"><span id="2d18" class="mw li hi ms b fi mx my l mz na">df['Title'] = titles<br/>df['Id'] = ids<br/>df['Upvotes'] = scores #upvotes<br/><br/>print(df.shape)<br/>df.head(10)</span></pre><p id="0ddf" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">综上所述，我们有…</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nb nc l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="ab fe cl me"><img src="../Images/ddc2f561cd87a9f5e9421f7b7954f0e2.png" data-original-src="https://miro.medium.com/v2/format:webp/1*qkPTMTYlBF2uZberHR5Nvw.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Image by Author(<a class="ae jn" rel="noopener" href="/@retinpkumar">https://medium.com/@retinpkumar</a>)</figcaption></figure><p id="9812" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">给你。这个动手贴到此为止。</p><p id="58d5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">但是等等，还有更多… </strong></p><p id="b28f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果你想从一篇文章的网址中提取细节怎么办？让我们看看它是怎么做的。</p></div><div class="ab cl mf mg gp mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hb hc hd he hf"><h1 id="526a" class="lh li hi bd lj lk mm lm ln lo mn lq lr io mo ip lt ir mp is lv iu mq iv lx ly bi translated">从URL提取数据</h1><p id="a24b" class="pw-post-body-paragraph jo jp hi jq b jr lz ij jt ju ma im jw jx mb jz ka kb mc kd ke kf md kh ki kj hb bi translated">为您希望从中抓取数据的url创建一个url变量。</p><pre class="iy iz ja jb fd mr ms mt mu aw mv bi"><span id="4ffd" class="mw li hi ms b fi mx my l mz na">input_url = "https://www.reddit.com/r/europe/comments/r0hthg/sweden_is_taking_the_lead_to_persuade_the_rest_of/"</span></pre><p id="33fa" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是我从Reddit上抓取的一个随机网址。</p><p id="d65a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果你查看任何Reddit URL的结构，它看起来像这样:</p><pre class="iy iz ja jb fd mr ms mt mu aw mv bi"><span id="a399" class="mw li hi ms b fi mx my l mz na">https://www.reddit.com/r/ &lt;subreddit name&gt; / comments / &lt;user id&gt; / &lt;title&gt; /</span></pre><p id="5876" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以使用字符串分割，从URL中提取子编辑名称、用户id和标题。</p><p id="2eba" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一旦你有了这些，你可以在我们的scraper中使用subreddit名称，并将标题附加到我们的最终数据框中。</p><p id="7c13" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">但是用户id呢？</strong></p><p id="94f8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以使用用户id，通过以下代码提取更多详细信息:</p><pre class="iy iz ja jb fd mr ms mt mu aw mv bi"><span id="9565" class="mw li hi ms b fi mx my l mz na">userid_from_url = input_url.split("/")[6]<br/>more_details = reddit.submission(id=userid_from_url)</span></pre><p id="6ced" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<strong class="jq hj"> vars() </strong>函数中传递该对象，您将获得包含与您的用户id对应的属性和值的dictionary对象。您也可以将此信息追加到最终的数据框中。</p><p id="0f05" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">所以，这篇帖子到此结束。希望你喜欢。</p><p id="c56d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">祝你和你的家人有一个美好、繁荣和快乐的新年，并祝你再攀高峰，心想事成。T3】</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ne"><img src="../Images/110601631bbc16d6c695c918f6de45e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KrFYBY9u1u-Y3TBq"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/@sincerelymedia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Sincerely Media</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div></div>    
</body>
</html>