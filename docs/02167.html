<html>
<head>
<title>Import Pandas in AWS Lambda in 3 Simple Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过3个简单的步骤在AWS Lambda中导入熊猫</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/import-pandas-in-aws-lambda-in-3-simple-steps-4ea5f1775eb8?source=collection_archive---------7-----------------------#2021-05-06">https://medium.com/geekculture/import-pandas-in-aws-lambda-in-3-simple-steps-4ea5f1775eb8?source=collection_archive---------7-----------------------#2021-05-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="59a7" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如果您在AWS Lambda实例中遇到了可怕的pandas导入错误，那么您就来对地方了。</h2></div><div class="ix iy iz ja fd ab cb"><figure class="jb jc jd je jf jg jh paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><img src="../Images/e9420166cc19241fcb75ba7ead050e44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*wzWUZ05IBI5eEWF3uBAoUA.jpeg"/></div></figure><figure class="jb jc jo je jf jg jh paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><img src="../Images/dab43dcba10d851b6679d8dd2063fb7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*fSh1bCV7hXZBWXKm6_Ranw.jpeg"/></div></figure></div><blockquote class="jp jq jr"><p id="e59d" class="js jt ju jv b jw jx ij jy jz ka im kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">[错误]运行时。ImportModuleError:无法导入模块“lambda_function”:没有名为“pandas”的模块</p></blockquote><p id="c14f" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">您可能知道，AWS Lambda中的默认python运行时附带了一组有限的标准库。因此，我们有责任将任何不支持的库导入lambda运行时，以避免<em class="ju">"运行时。ImportModuleError”。</em></p><p id="767d" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">已经有一些方法可以解决这个问题，比如用依赖关系创建一个代码的zip文件。然后，将这个zip文件作为源代码上传到Lambda函数中。然而，这在少数情况下肯定会失败，因为您的lambda实例运行在不同的Linux版本上，并且当您在lambda实例上运行时，您编译的库可能不兼容。</p><figure class="ix iy iz ja fd jc er es paragraph-image"><div class="er es ks"><img src="../Images/dd2150d096d5f45e793cf9cc233d40f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*LUHdy_vhghU7D060I9bh6g.jpeg"/></div></figure></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><p id="3825" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">因此，我将采取一种不同的方法，在我看来，这是一种更专业的方法来解决这个问题。这个想法是用依赖关系将你的代码dockerize，并把它作为一个映像部署到你的lambda函数中。教程的其余部分如下:</p><ol class=""><li id="1f7a" class="la lb hi jv b jw jx jz ka kp lc kq ld kr le ko lf lg lh li bi translated">用您的代码和依赖项构建docker映像。</li><li id="0317" class="la lb hi jv b jw lj jz lk kp ll kq lm kr ln ko lf lg lh li bi translated">通过AWS CLI将docker映像推送到AWS ECR。</li><li id="99d4" class="la lb hi jv b jw lj jz lk kp ll kq lm kr ln ko lf lg lh li bi translated">以上面的容器图像为源创建一个Lambda函数。</li></ol><blockquote class="jp jq jr"><p id="eaa0" class="js jt ju jv b jw jx ij jy jz ka im kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">虽然本教程是关于导入pandas的，但它实际上可以应用于导入任何其他python库。</p></blockquote><h1 id="fa1d" class="lo lp hi bd lq lr ls lt lu lv lw lx ly io lz ip ma ir mb is mc iu md iv me mf bi translated">用您的代码和依赖项构建一个docker映像</h1><p id="822c" class="pw-post-body-paragraph js jt hi jv b jw mg ij jy jz mh im kb kp mi ke kf kq mj ki kj kr mk km kn ko hb bi translated">AWS Lambda运行在具有不同风格的Linux操作系统的实例上。因此，以Amazon Linux为基础来构建我们的形象是有意义的。这也有助于我们在运行时克服已安装库的不兼容性。你可以在docker hub中找到亚马逊官方<a class="ae ml" href="https://hub.docker.com/r/amazon/aws-lambda-python" rel="noopener ugc nofollow" target="_blank"> AWS-lambda-python </a>的基本图片。</p><figure class="ix iy iz ja fd jc"><div class="bz dy l di"><div class="mm mn l"/></div><figcaption class="mo mp et er es mq mr bd b be z dx">Directory structure</figcaption></figure><p id="2b20" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">在您的本地机器上，您可以创建一个具有上面所示结构的目录。app.py的内容可能很简单:</p><figure class="ix iy iz ja fd jc"><div class="bz dy l di"><div class="mm mn l"/></div><figcaption class="mo mp et er es mq mr bd b be z dx"><a class="ae ml" href="https://gist.github.com/sathviksathu/6601acff844670323416d78462fa27d6" rel="noopener ugc nofollow" target="_blank">app code with handler</a></figcaption></figure><p id="a625" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">docker文件是构建图像的核心，应该包含以下内容。你可能需要一点时间来理解这里发生的奇迹:</p><figure class="ix iy iz ja fd jc"><div class="bz dy l di"><div class="mm mn l"/></div><figcaption class="mo mp et er es mq mr bd b be z dx"><a class="ae ml" href="https://gist.github.com/sathviksathu/86387cc2fea456b9bbdf64ecd3f56b27" rel="noopener ugc nofollow" target="_blank">Dockerfile contents</a></figcaption></figure><ol class=""><li id="81cc" class="la lb hi jv b jw jx jz ka kp lc kq ld kr le ko lf lg lh li bi translated">来自指令的<strong class="jv hj">初始化新的构建阶段，并为后续指令设置基础映像。执行这条指令后，您可能会认为您实际上是在Amazon Linux实例中。</strong></li><li id="e7d9" class="la lb hi jv b jw lj jz lk kp ll kq lm kr ln ko lf lg lh li bi translated"><strong class="jv hj"> COPY </strong>指令将您的应用程序代码和处理程序一起复制到Lambda环境中。</li><li id="a310" class="la lb hi jv b jw lj jz lk kp ll kq lm kr ln ko lf lg lh li bi translated"><strong class="jv hj">运行</strong>指令运行您一直在等待的pip安装命令。这确保了安装的库对于您所在的操作系统是本机的，从而减少了任何兼容性问题。</li></ol><h1 id="72a1" class="lo lp hi bd lq lr ls lt lu lv lw lx ly io lz ip ma ir mb is mc iu md iv me mf bi translated"><strong class="ak">将您的Docker图像推送到AWS ECR </strong></h1><p id="5d17" class="pw-post-body-paragraph js jt hi jv b jw mg ij jy jz mh im kb kp mi ke kf kq mj ki kj kr mk km kn ko hb bi translated">您需要将构建的Docker映像推送到AWS ECR，以便在创建AWS Lambda函数时可以访问它。为此，首先，您需要创建一个AWS ECR存储库来保存您的图像。</p><ol class=""><li id="fd47" class="la lb hi jv b jw jx jz ka kp lc kq ld kr le ko lf lg lh li bi translated">向您的注册表验证您的docker客户端。</li></ol><p id="96ce" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">2.标记您本地构建的图像，以便能够推送它。</p><p id="0436" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">3.将您的标记图像放入您创建的ECR repo中。</p><figure class="ix iy iz ja fd jc er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ms"><img src="../Images/0551f86e19bcd5cb0c4c44f6301762f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wzSnlTd5g2EGBFqm-kL0pw.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx">Commands to push docker image to ECR</figcaption></figure><p id="10b8" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated"><strong class="jv hj">注意:</strong>您可能需要配置您的AWS CLI以避免任何授权错误。<a class="ae ml" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html" rel="noopener ugc nofollow" target="_blank">在这里查看如何配置你的AWS CLI</a>。</p><h1 id="d6bd" class="lo lp hi bd lq lr ls lt lu lv lw lx ly io lz ip ma ir mb is mc iu md iv me mf bi translated">创建Lambda函数</h1><p id="9d94" class="pw-post-body-paragraph js jt hi jv b jw mg ij jy jz mh im kb kp mi ke kf kq mj ki kj kr mk km kn ko hb bi translated">现在，您可以使用容器图像作为源来创建lambda函数。然后，您可以点击<em class="ju">“浏览图像”</em>选项，选择您在上一步中推送到ECR存储库中的图像。</p><figure class="ix iy iz ja fd jc er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mt"><img src="../Images/d933e4a7fdaf4cecd88f0cc2427b4e27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3sVMU5lOMeFaWGPKMNxCwQ.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx">Create Lambda function with Container image</figcaption></figure><p id="4f4b" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">一旦使用您的映像创建了函数，您就可以在日志输出中测试您的函数并验证pandas版本。</p><figure class="ix iy iz ja fd jc er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mu"><img src="../Images/fbb84315a17c3765e6f01b049e1f5b57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H-GV6bO3Kg_Xa1JXTUrUOw.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx">The function was executed successfully.</figcaption></figure></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><p id="8e01" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated"><strong class="jv hj"> <em class="ju">欢呼。感谢阅读。我希望你今天学到了新东西。</em>T9】</strong></p></div></div>    
</body>
</html>