<html>
<head>
<title>Compositional SwiftUI List</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">合成SwiftUI列表</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/compositional-swiftui-list-266bff7844af?source=collection_archive---------3-----------------------#2021-01-27">https://medium.com/geekculture/compositional-swiftui-list-266bff7844af?source=collection_archive---------3-----------------------#2021-01-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/94af087bbb72ce10caef6eaa16b5a40f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aV8Eod3G9BCCWD08"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Photo by <a class="ae hv" href="https://unsplash.com/@mbaumi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Mika Baumeister</a> on <a class="ae hv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="cd1b" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇文章中，我想和你分享一个如何在你的项目中混合使用<code class="du jt ju jv jw b">UIKit</code>和<code class="du jt ju jv jw b">SwiftUI</code>的例子。为此，我创建了一个名为<code class="du jt ju jv jw b">CompositionalList.</code> 🧩的小图书馆</p><p id="eb38" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae hv" href="https://github.com/jamesrochabrun/CompositionalList" rel="noopener ugc nofollow" target="_blank">组合列表</a>是由<code class="du jt ju jv jw b">UIKit DiffableDataSource</code>和<code class="du jt ju jv jw b">Compositional Layout</code>驱动的SwiftUI <code class="du jt ju jv jw b">UIViewControllerRepresentable</code>包装器。🥸 <br/>它是可定制的和灵活的，支持多部分、单元格选择，并且可以使用<code class="du jt ju jv jw b">UIHostingController</code>在<code class="du jt ju jv jw b">UIKit</code>中使用或者在<code class="du jt ju jv jw b">SwiftUI</code>应用中使用。</p><p id="66a2" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">可以在<code class="du jt ju jv jw b">Xcode: Click File</code>-&gt;-<code class="du jt ju jv jw b">Swift Packages</code>-&gt;-<code class="du jt ju jv jw b">Add Package Dependency</code>中直接将其作为swift包添加到您的项目中，并添加此<a class="ae hv" href="https://github.com/jamesrochabrun/CompositionalList" rel="noopener ugc nofollow" target="_blank"> URL。</a></p><p id="10d1" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于这个例子，我们将使用<a class="ae hv" href="https://rss.itunes.apple.com/en-us" rel="noopener ugc nofollow" target="_blank"> RSS Itunes提要生成器</a>来显示苹果音乐提要，如下所示…</p><figure class="jy jz ka kb fd hk er es paragraph-image"><div class="er es jx"><img src="../Images/84922f7bae8b7519bbd247d0fd18f57e.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*K5BTCLa7wCd5mRH3.gif"/></div><figcaption class="hr hs et er es ht hu bd b be z dx"><a class="ae hv" href="https://github.com/jamesrochabrun/CompositionalList/tree/main/Example/CompositionalListExample" rel="noopener ugc nofollow" target="_blank">https://github.com/jamesrochabrun/CompositionalList/tree/main/Example/CompositionalListExample</a></figcaption></figure><p id="ec9b" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Itunes Feed API很棒，但遗憾的是它不返回分段数据，所以为了这个例子的目的，我不得不将结果分块。所有的块代码、网络层、<a class="ae hv" href="https://github.com/jamesrochabrun/CompositionalList/blob/main/Example/CompositionalListExample/CompositionalListExample/Helpers/CustomLayout.swift" rel="noopener ugc nofollow" target="_blank">自定义组合布局</a>和发布结果的<code class="du jt ju jv jw b">ObservableObject</code>模型都可以在<a class="ae hv" href="https://github.com/jamesrochabrun/CompositionalList/tree/main/Example/CompositionalListExample" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="900a" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将只关注如何在我们的<code class="du jt ju jv jw b">CompositionalList</code>中显示结果…</p><figure class="jy jz ka kb fd hk"><div class="bz dy l di"><div class="kc kd l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">Apple Music Feed in a Compositional List.</figcaption></figure><p id="8a92" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们一步一步来…</p><blockquote class="ke kf kg"><p id="76a8" class="iv iw kh ix b iy iz ja jb jc jd je jf ki jh ji jj kj jl jm jn kk jp jq jr js hb bi translated"><em class="hy">别忘了</em> <code class="du jt ju jv jw b"><em class="hy">import CompositionalList</em></code> <em class="hy">😬</em></p></blockquote><ol class=""><li id="1559" class="kl km hy ix b iy iz jc jd jg kn jk ko jo kp js kq kr ks kt bi translated">定制每行的项目，这个闭包提供了一个<code class="du jt ju jv jw b">model</code>和一个<code class="du jt ju jv jw b">indexpath</code>，并期望一个<code class="du jt ju jv jw b">View</code>作为返回值。在这里，您可以为每个部分返回不同的<code class="du jt ju jv jw b">SwiftUI</code>视图。如果您使用类似于<code class="du jt ju jv jw b">Switch</code>的条件语句，在这种情况下，您必须使用<code class="du jt ju jv jw b">Group</code>作为返回值。例如，在这种情况下，编译器会将其推断为返回值:</li></ol><pre class="jy jz ka kb fd ku jw kv kw aw kx bi"><span id="f92a" class="ky kz hy jw b fi la lb l lc ld">Group&lt;_ConditionalContent&lt;_ConditionalContent&lt;TileInfo, ListItem&gt;, ArtWork&gt;&gt;</span></pre><p id="5cc6" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.定制每个部分的页眉或页脚，这个闭包提供了部分标识符、相应部分的索引路径以及可以是<code class="du jt ju jv jw b">UICollectionView.elementKindSectionHeader</code>或<code class="du jt ju jv jw b">UICollectionView.elementKindSectionFooter</code>的<code class="du jt ju jv jw b">kind</code>(这将由您的布局定义)。它期望一个<code class="du jt ju jv jw b">View</code>作为返回值，你可以根据节或者是页眉还是页脚来定制你的返回值。与第1点相同，如果使用了条件语句，请确保将其放在<code class="du jt ju jv jw b">Group</code>中。</p><p id="b7b6" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为页眉或页脚返回的<code class="du jt ju jv jw b">SwiftUI</code>视图将动态调整其内容，您可以从<code class="du jt ju jv jw b">Text</code>甚至一个全新的水平列表中返回！</p><p id="0083" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">实现这个闭包是<strong class="ix hz">必需的</strong>即使你没有在布局中定义页眉或页脚，你仍然需要返回一个<code class="du jt ju jv jw b">View.</code>在这种情况下，你可以返回一个高度为0的<code class="du jt ju jv jw b">Spacer</code>。(现在正在寻找更好的解决方案🤷🏽‍♂️).</p><p id="932f" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.<code class="du jt ju jv jw b">SelectionProvider</code>内部使用<code class="du jt ju jv jw b">UICollectionViewDelegate</code>单元格did select方法提供选中项的闭包，实现这个闭包是<strong class="ix hz">可选的</strong>。</p><p id="6cee" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">4.<code class="du jt ju jv jw b">customLayout</code>环境对象，这里可以返回任何一种布局，只要是<code class="du jt ju jv jw b">UICollectionViewLayout</code>。这个库还包含一些定义好的<code class="du jt ju jv jw b">NSCollectionLayouSection</code>扩展方法，你可以用它们来组成你的布局，<code class="du jt ju jv jw b">.composed()</code>的定义可以在这里找到<a class="ae hv" href="https://github.com/jamesrochabrun/CompositionalList/blob/main/Example/CompositionalListExample/CompositionalListExample/Helpers/CustomLayout.swift" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="f0b3" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">5.让我百思不得其解的是，我们需要使用一个条件语句来验证数组不是空的，这样才能工作。<em class="kh">然而</em>，<em class="kh">这对于这种情况很方便，因为我们可以在这里处理加载或错误状态</em>。😬</p><p id="a81b" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就是这样，将<code class="du jt ju jv jw b">UIKit</code>工具与<code class="du jt ju jv jw b">SwiftUI</code>混合在一起得到了很好的支持，让你可以解除目前在<code class="du jt ju jv jw b">SwiftUI</code>框架中可以找到的某些限制。</p><p id="8f96" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">完整的回购是可用的和开源的<a class="ae hv" href="https://github.com/jamesrochabrun/CompositionalList" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div></div>    
</body>
</html>