<html>
<head>
<title>The Custom Parser: A key to a good data harvest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自定义解析器:获得良好数据的关键</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/the-custom-parser-a-key-to-a-good-data-harvest-10e24d0d8a71?source=collection_archive---------20-----------------------#2021-08-31">https://medium.com/geekculture/the-custom-parser-a-key-to-a-good-data-harvest-10e24d0d8a71?source=collection_archive---------20-----------------------#2021-08-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="ad11" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">IceVision框架中的PlantDoc数据集</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/47b40b5bebfebc46a3add8aee2bc9073.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*GsTMnYCYcKJBQGRleHcqIA.png"/></div></figure><p id="73d0" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">目标检测处理目标和背景(非目标)的分类和定位。为此，数据科学家需要知道要寻找什么样的数据，以及如何正确指导数据识别。在这篇博客中，我们将讨论数据格式、加载和定制解析。这些见解来自于<a class="ae kb" href="https://airctic.com/0.8.1/custom_parser/" rel="noopener ugc nofollow" target="_blank"> IceVision文档</a>、<a class="ae kb" href="https://github.com/airctic/icedata" rel="noopener ugc nofollow" target="_blank"> github代码</a>和<a class="ae kb" href="https://discord.com/invite/JDBeZYK" rel="noopener ugc nofollow" target="_blank">论坛</a>的讨论。</p><p id="0611" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">有关物体检测的介绍/复习，请<a class="ae kb" rel="noopener" href="/@yrodriguezmd/object-detection-using-a-deep-neural-network-213ec8ac2da8">参考此处</a>。</p><p id="caba" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们将按照这个<strong class="jh hj"> <em class="kc">大纲</em> </strong>:</p><p id="42ce" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">A.设置</p><p id="d66b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">B.收集数据</p><p id="7fc7" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">B.1 .数据来源和格式</p><p id="05e0" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Github</p><p id="dc0b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">B.1.b. Roboflow</p><p id="a038" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">C.数据加载</p><p id="4f2a" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">C.1本地计算机</p><p id="b672" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">C.2. Git克隆</p><p id="a12d" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">D.数据浏览和路由</p><p id="ef50" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">D.1 .主目录</p><p id="38ed" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">D.2 .注释</p><p id="d39c" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">D.3 .类别映射</p><p id="b826" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">E.自定义解析</p><p id="7fcb" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">F.形象化</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es kd"><img src="../Images/7081ed114f32ba0a8ed691bdcb148ea8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pR4kn_6zU4e6A5kgRj4RCQ.png"/></div></div></figure><p id="7285" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">打开笔记本，我们来种点代码吧！</p><p id="952a" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> A .设置</strong></p><p id="fba4" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我在基于GPU设置和标准RAM的Colab Pro上使用了IceVision框架。</p><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="3975" class="kn ko hi kj b fi kp kq l kr ks">!wget <a class="ae kb" href="https://raw.githubusercontent.com/airctic/icevision/master/install_colab.sh" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/airctic/icevision/master/install_colab.sh</a><br/>!bash install_colab.sh</span></pre><p id="5dca" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">等待以上安装完成，然后运行下一个。</p><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="108b" class="kn ko hi kj b fi kp kq l kr ks">from icevision.all import *<br/># import icevision</span></pre><p id="9a56" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> B .收集数据</strong></p><p id="8640" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> <em class="kc"> B.1 .数据来源及格式</em> </strong></p><p id="b493" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们将使用生成的PlantDoc数据集来帮助改进植物疾病的早期检测。这有各种各样的来源。我们将重点关注两个源选项:Github和Roboflow。</p><p id="38f6" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><em class="kc">b . 1 . a Github来源</em></p><p id="1366" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在<a class="ae kb" href="https://github.com/pratikkayal/PlantDoc-Object-Detection-Dataset" rel="noopener ugc nofollow" target="_blank"> Github存储库</a>中，TRAIN文件夹包含jpg格式的图像，以及xml格式的单独注释文件。还有一个单独的train_labels.csv文件，其中包含已编译的注释(包含有关文件名、图像大小、类和边界框坐标的信息)。出于我们的目的，我们将处理CSV文件中的注释，而不是XML文件。</p><div class="iy iz ja jb fd ab cb"><figure class="kt jc ku kv kw kx ky paragraph-image"><img src="../Images/e6b467ecb56474e7ddd9e3cac3334bd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:410/format:webp/1*PynGclLcSYiTsD0kzk9Cbg.png"/></figure><figure class="kt jc kz kv kw kx ky paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><img src="../Images/b4b8b271f061bc98638d9cf6660b5b4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*qDimFKkFQAjYsk0RlJaxUA.png"/></div></figure></div><p id="fbe1" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果您更喜欢使用该来源，请转到C.2节。</p><p id="eea8" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><em class="kc"> B.1.b. Roboflow来源</em></p><p id="fcd6" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae kb" href="https://public.roboflow.com/object-detection/plantdoc/1" rel="noopener ugc nofollow" target="_blank"> Roboflow </a>网站为同一数据集提供不同的下载格式，导致文件排列和文件类型多种多样。</p><p id="35d6" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们将利用张量流对象检测CSV格式。它有一个train和一个test文件夹，每个文件夹中的注释都是一个CSV文件。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es la"><img src="../Images/f1fab81acc1654b70b6563418cc92ed1.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/1*fM3yxCvW7xNgwA0w6E75qQ.png"/></div></figure><p id="cc92" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">最好了解文件位置和格式，因为这将有助于定义D和e部分中的路由和解析。</p><p id="a3c3" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> C .数据加载</strong></p><p id="bc55" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> <em class="kc"> C.1 .本地计算机加载数据的步骤</em> </strong></p><ul class=""><li id="b030" class="lb lc hi jh b ji jj jl jm jo ld js le jw lf ka lg lh li lj bi translated">进入Roboflow网站，</li><li id="ae52" class="lb lc hi jh b ji lk jl ll jo lm js ln jw lo ka lg lh li lj bi translated">选择PlantDoc数据集，</li><li id="775a" class="lb lc hi jh b ji lk jl ll jo lm js ln jw lo ka lg lh li lj bi translated">点击下载尺寸为-416x416，</li><li id="1621" class="lb lc hi jh b ji lk jl ll jo lm js ln jw lo ka lg lh li lj bi translated">选择Tensorflow对象检测CSV格式，</li><li id="5732" class="lb lc hi jh b ji lk jl ll jo lm js ln jw lo ka lg lh li lj bi translated">通过下载zip文件导出到计算机，</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lp"><img src="../Images/018fb6f06e7bb2468d83da4e060a050a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*_KgZv8-_10T92mC5wnT8yw.png"/></div><figcaption class="lq lr et er es ls lt bd b be z dx">* This will download the zip file to your local computer.</figcaption></figure><ul class=""><li id="d276" class="lb lc hi jh b ji jj jl jm jo ld js le jw lf ka lg lh li lj bi translated">把压缩文件上传到Colab。</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lu"><img src="../Images/3c7d9e1c051fab6272af13cf4751009d.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*p0i0j7HMj934NPFdg9020g.png"/></div></figure><p id="d21b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">zip文件的Colab存储是临时的，但是如果您遵循这段代码，通常不需要重新加载。</p><p id="0fef" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果您对这种手动方式满意，请继续D节，否则，请参见C.2。了解另一种装载方式。</p><p id="8020" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> <em class="kc"> C.2 .使用Git克隆方法加载数据</em> </strong></p><p id="3686" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">使用git克隆加载数据与上面描述的手动加载有一些不同。优点是直接路由到源，没有中间的下载和上传。使用Github PlantDoc repo和通过<a class="ae kb" href="https://github.com/yrodriguezmd/IceVision_miniprojects/blob/main/IV_plant_git%2C_csv%2C_custom_2021_8_30_11am.ipynb" rel="noopener ugc nofollow" target="_blank"> Git Clone加载数据的步骤在这里</a>详述。</p><p id="69d2" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> D .数据浏览和路由</strong></p><p id="7bdf" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> <em class="kc"> D.1 .建立主目录</em> </strong></p><p id="d9f2" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">使用Colab单元，我们可以检查我们的目录，以便跟踪数据路径。</p><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="dfab" class="kn ko hi kj b fi kp kq l kr ks">%pwd  # present working directory, output: '/content'  <br/>!ls</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lv"><img src="../Images/29063d136c9bc3d8b9a1bf2ddeb671ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*zooG6EgFn7WqqIvxWLvizA.png"/></div></figure><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="9cfa" class="kn ko hi kj b fi kp kq l kr ks">!unzip \*.zip  &amp;&amp; rm *.zip</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es lw"><img src="../Images/35cd50b20def76055bc58f51a9d20765.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NvqpNwKBGTUk33p4o-z-Yg.png"/></div></div></figure><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="3356" class="kn ko hi kj b fi kp kq l kr ks">!ls</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es lx"><img src="../Images/bb1a5b0ae7f655a8251c922211219597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*k47kmp7skVhbnGbDz32Jeg.png"/></div></div></figure><p id="334b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">解压文件后，主目录现在显示包含我们的数据的train文件夹。</p><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="2cee" class="kn ko hi kj b fi kp kq l kr ks">data_dir = Path('./train') </span></pre><ul class=""><li id="1350" class="lb lc hi jh b ji jj jl jm jo ld js le jw lf ka lg lh li lj bi translated">这将是我们的信息高速公路，并且是为后面的解析步骤识别的重要路径。</li></ul><p id="2bbe" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> <em class="kc"> D.2 .注解</em> </strong></p><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="2c60" class="kn ko hi kj b fi kp kq l kr ks">import pandas as pd<br/>train_labels = pd.read_csv('/content/train/_annotations.csv', sep = ',', error_bad_lines=False)</span></pre><p id="4187" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在查看了目录和文件的位置之后，我们现在可以给出如何找到注释数据的指导:</p><ul class=""><li id="461a" class="lb lc hi jh b ji jj jl jm jo ld js le jw lf ka lg lh li lj bi translated">主目录的/content/train</li><li id="2dfb" class="lb lc hi jh b ji lk jl ll jo lm js ln jw lo ka lg lh li lj bi translated">/_annotations.csv在train文件夹中</li><li id="88b1" class="lb lc hi jh b ji lk jl ll jo lm js ln jw lo ka lg lh li lj bi translated">一些注释偏离了正常的数据输入，导致了标记化的错误。error_bad_lines=False参数将跳过这些偏差，以便您可以使用其余的数据。</li></ul><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="fe1b" class="kn ko hi kj b fi kp kq l kr ks">train_labels.rename(columns={'class':'label'}, inplace=True)</span></pre><ul class=""><li id="fdd1" class="lb lc hi jh b ji jj jl jm jo ld js le jw lf ka lg lh li lj bi translated">列名“class”被重命名为“label ”,以避免与“class”方法混淆。</li></ul><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="5f63" class="kn ko hi kj b fi kp kq l kr ks">train_labels.sample(3)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es ly"><img src="../Images/77d7e2170c6bb2d1a74136ae84827ebe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LR3sKUYgHJkOHDj4Hn6JvA.png"/></div></div></figure><p id="4b68" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">CSV文件包含对象检测的所有相关信息:</p><ul class=""><li id="f804" class="lb lc hi jh b ji jj jl jm jo ld js le jw lf ka lg lh li lj bi translated">图像文件名</li><li id="549a" class="lb lc hi jh b ji lk jl ll jo lm js ln jw lo ka lg lh li lj bi translated">图像宽度和高度(此处为416，由Roboflow调整大小)</li><li id="831b" class="lb lc hi jh b ji lk jl ll jo lm js ln jw lo ka lg lh li lj bi translated">标签或“类别”</li><li id="44f6" class="lb lc hi jh b ji lk jl ll jo lm js ln jw lo ka lg lh li lj bi translated">坐标:xmin属于边界框的x轴的最小值，即在左下角。</li></ul><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="b050" class="kn ko hi kj b fi kp kq l kr ks">train_labels.info()             # 8,329 observations, no null values<br/>train_labels.filename.nunique() # 2,315 unique filenames<br/>train_labels.label.nunique()    # 30 labels (13 species, 17diseases)</span></pre><ul class=""><li id="fe90" class="lb lc hi jh b ji jj jl jm jo ld js le jw lf ka lg lh li lj bi translated">在2000多张图片中发现了30种不同种类的植物叶子。有超过8000个边界框被分类。</li></ul><p id="06d0" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> <em class="kc"> D.3 .类映射</em> </strong></p><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="fde3" class="kn ko hi kj b fi kp kq l kr ks">_CLASSES = train_labels.label.unique().tolist()<br/>class_map = ClassMap(_CLASSES)<br/>class_map.get_by_name('Apple leaf') # 25; code to be used in parser</span></pre><ul class=""><li id="f05f" class="lb lc hi jh b ji jj jl jm jo ld js le jw lf ka lg lh li lj bi translated">标签的例子有“蓝莓叶”、“玉米锈叶”和“番茄双斑叶螨叶”。</li><li id="d7af" class="lb lc hi jh b ji lk jl ll jo lm js ln jw lo ka lg lh li lj bi translated">类别映射创建与特定标签相关的编号id。这有助于模型的数字标注。</li></ul><p id="e99b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> E .自定义解析</strong></p><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="e5eb" class="kn ko hi kj b fi kp kq l kr ks">template_record = ObjectDetectionRecord()</span></pre><ul class=""><li id="b594" class="lb lc hi jh b ji jj jl jm jo ld js le jw lf ka lg lh li lj bi translated"><a class="ae kb" href="https://github.com/airctic/icevision/blob/b6c750f2ca5acfafd0e46e172a817af7a6892f18/icevision/core/record_defaults.py" rel="noopener ugc nofollow" target="_blank"> ObjectDetectionRecord </a>收集路径、边界框和标签的信息。</li><li id="d8e7" class="lb lc hi jh b ji lk jl ll jo lm js ln jw lo ka lg lh li lj bi translated">该功能的一个重要特点是<a class="ae kb" href="https://github.com/airctic/icevision/blob/b6c750f2ca5acfafd0e46e172a817af7a6892f18/icevision/core/bbox.py#L54" rel="noopener ugc nofollow" target="_blank">自动修复</a>，不合逻辑的坐标被修复为更符合逻辑的值。例如，如果ymax指示高于图像高度的位置，则该值改为对应于图像高度。</li></ul><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="cba8" class="kn ko hi kj b fi kp kq l kr ks">class PlantParser(Parser):<br/>  def __init__(self, template_record, data_dir):<br/>    super().__init__(template_record = template_record)</span><span id="1035" class="kn ko hi kj b fi lz kq l kr ks">    self.data_dir = data_dir # Path('./train')<br/>    self.df = train_labels # pd.read_csv('./train/_annotations.csv')<br/>    self.class_map = class_map # ClassMap(_CLASSES)</span></pre><ul class=""><li id="e13e" class="lb lc hi jh b ji jj jl jm jo ld js le jw lf ka lg lh li lj bi translated"><a class="ae kb" href="https://github.com/airctic/icevision/blob/b6c750f2ca5acfafd0e46e172a817af7a6892f18/icevision/parsers/parser.py" rel="noopener ugc nofollow" target="_blank">解析器</a>类给出了安排数据的方向。</li><li id="af4b" class="lb lc hi jh b ji lk jl ll jo lm js ln jw lo ka lg lh li lj bi translated">我们已经在D1–3部分建立了数据高速公路、注释路径和课堂作业。</li></ul><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="6993" class="kn ko hi kj b fi kp kq l kr ks">  def __iter__(self) -&gt; Any:<br/>    for o in self.df.itertuples():<br/>      yield o</span><span id="5ae5" class="kn ko hi kj b fi lz kq l kr ks">  def __len__(self) -&gt; int:<br/>    return len(self.df)</span></pre><ul class=""><li id="a966" class="lb lc hi jh b ji jj jl jm jo ld js le jw lf ka lg lh li lj bi translated">对于整个数据集，数据按行进行处理。</li></ul><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="075d" class="kn ko hi kj b fi kp kq l kr ks">  def record_id(self, o) -&gt; Hashable:<br/>    return o.filename</span></pre><ul class=""><li id="8c4a" class="lb lc hi jh b ji jj jl jm jo ld js le jw lf ka lg lh li lj bi translated">具有相同文件名的观察结果被收集到一个记录中。</li></ul><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="e64b" class="kn ko hi kj b fi kp kq l kr ks">def parse_fields(self, o, record, is_new):<br/>    if is_new:<br/>      record.set_filepath(self.data_dir / o.filename)<br/>      record.set_img_size(ImgSize(width= o.width, height= o.height))<br/>      record.detection.set_class_map(self.class_map)</span><span id="3205" class="kn ko hi kj b fi lz kq l kr ks">    record.detection.add_bboxes(<br/>                [BBox.from_xyxy(o.xmin, o.ymin, o.xmax, o.ymax)])<br/>    record.detection.add_labels([o.label])</span></pre><ul class=""><li id="a9fa" class="lb lc hi jh b ji jj jl jm jo ld js le jw lf ka lg lh li lj bi translated">由__iter__确定的每一行都被传递给parse_fields。记录是在这一步收集的。</li><li id="a8a4" class="lb lc hi jh b ji lk jl ll jo lm js ln jw lo ka lg lh li lj bi translated">图像大小是根据每行的宽度和高度值确定的。</li><li id="05b8" class="lb lc hi jh b ji lk jl ll jo lm js ln jw lo ka lg lh li lj bi translated">边界框是基于给定的每行坐标构建的。</li><li id="ea25" class="lb lc hi jh b ji lk jl ll jo lm js ln jw lo ka lg lh li lj bi translated">相应的标签被附加到记录内的每个边界框。</li></ul><p id="17b9" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">将自定义解析器放在一起:</p><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="9c6a" class="kn ko hi kj b fi kp kq l kr ks">class PlantParser(Parser):<br/>  def __init__(self, template_record, data_dir):<br/>    super().__init__(template_record = template_record)</span><span id="caa5" class="kn ko hi kj b fi lz kq l kr ks">    self.data_dir = data_dir <br/>    self.df = train_labels <br/>    self.class_map = class_map </span><span id="44ff" class="kn ko hi kj b fi lz kq l kr ks">  def __iter__(self) -&gt; Any:<br/>    for o in self.df.itertuples():<br/>      yield o</span><span id="e25c" class="kn ko hi kj b fi lz kq l kr ks">  def __len__(self) -&gt; int:<br/>    return len(self.df)</span><span id="2153" class="kn ko hi kj b fi lz kq l kr ks">  def record_id(self, o) -&gt; Hashable:<br/>    return o.filename</span><span id="57b5" class="kn ko hi kj b fi lz kq l kr ks">  def parse_fields(self, o, record, is_new):<br/>    if is_new:<br/>      record.set_filepath(self.data_dir / o.filename)#<br/>      record.set_img_size(ImgSize(width= o.width, height= o.height))<br/>      record.detection.set_class_map(self.class_map)</span><span id="20a5" class="kn ko hi kj b fi lz kq l kr ks">    record.detection.add_bboxes(<br/>                   [BBox.from_xyxy(o.xmin, o.ymin, o.xmax, o.ymax)])<br/>    record.detection.add_labels([o.label])</span></pre><p id="4daa" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们将使用自定义解析器来排列数据集中的信息，以构建可用于建模的记录。</p><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="6a06" class="kn ko hi kj b fi kp kq l kr ks">parser = PlantParser(template_record, data_dir)</span><span id="43fc" class="kn ko hi kj b fi lz kq l kr ks">train_records, valid_records = parser.parse()</span></pre><p id="fd6f" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">默认情况下，<a class="ae kb" href="https://github.com/airctic/icevision/blob/master/icevision/parsers/parser.py" rel="noopener ugc nofollow" target="_blank"> parse </a>函数以80/20的比率随机分割数据。</p><p id="abc9" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj"> F .可视化</strong></p><pre class="iy iz ja jb fd ki kj kk kl aw km bi"><span id="2cb4" class="kn ko hi kj b fi kp kq l kr ks">show_record(train_records[0], class_map= class_map, font_size= 25,<br/>            label_color= '#ffff00')<br/>train_records[0]</span></pre><div class="iy iz ja jb fd ab cb"><figure class="kt jc ma kv kw kx ky paragraph-image"><img src="../Images/22462a01141584f35622c29b0d988a4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*261VLbxSFreleMVr693bUw.png"/></figure><figure class="kt jc mb kv kw kx ky paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><img src="../Images/189acee4cf70b578aa6a2830dd8757da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*aQXFcMWXS0-dJ1U32L1JKg.png"/></div></figure></div><p id="d546" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">每条记录都包含一个带有图像路径的文件名、每个框的坐标以及框内对象的标签。我们有一个可视化的输出，显示了叶子的身份和边界框。</p><p id="b77e" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj">总结:</strong></p><p id="8a6d" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">识别并上传了包含图像和聚合注释信息的外部数据集。自定义解析使我们能够排列数据以创建可用于建模的记录。</p><p id="2855" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jh hj">未来玩法:</strong></p><p id="49d4" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">对解析的数据建模！</p><p id="9bb6" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我希望你喜欢种植代码:)</p><p id="3326" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><em class="kc">玛丽亚</em></p><p id="96f9" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">领英:<a class="ae kb" href="https://www.linkedin.com/in/rodriguez-maria/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/rodriguez-maria/</a></p><p id="5f98" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">github:<a class="ae kb" href="https://github.com/yrodriguezmd/IceVision_miniprojects/blob/main/IV_plant_local_upload%2C_csv%2C_custom_parser_2021_8_31.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/yrodriguezmd/ice vision _ mini projects/blob/main/IV _ plant _ local _ upload % 2C _ CSV % 2C _ custom _ parser _ 2021 _ 8 _ 31 . ipynb</a></p><p id="bee2" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">推特:【https://twitter.com/Maria_Rod_Data T2】</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mc"><img src="../Images/65efa0b5d467f7f6a527e772872b0808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*mxhZYwKHYIjgXh9UTfBiEg.png"/></div></figure></div></div>    
</body>
</html>