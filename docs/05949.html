<html>
<head>
<title>RabbitMQ Shovel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">兔子铁锹</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/rabbitmq-shovel-8e6ccdf309b?source=collection_archive---------10-----------------------#2021-08-03">https://medium.com/geekculture/rabbitmq-shovel-8e6ccdf309b?source=collection_archive---------10-----------------------#2021-08-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="0005" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">"这样一把铲子，不使用似乎是一种浪费."<br/> ― <strong class="il hj">丹尼尔·克劳斯，</strong> <a class="ae jh" href="https://www.goodreads.com/work/quotes/13440919" rel="noopener ugc nofollow" target="_blank"> <strong class="il hj">罗特</strong> </a></p></blockquote><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es ji"><img src="../Images/7c081df44144c4137b29c0b72bd6a445.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tL8_6ymYRdO76ybb"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx">Photo by <a class="ae jh" href="https://unsplash.com/@metelevan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Andrey Metelev</a> on <a class="ae jh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="28b7" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">在消息代理<a class="ae jh" href="https://www.rabbitmq.com/" rel="noopener ugc nofollow" target="_blank"> <em class="ik"> RabbitMQ </em> </a>中，典型的设置是部署驻留在一个盒子中的单个RMQ实例。RMQ的工作是处理传入的消息，并确保这些消息被转发到正确的目的地。</p><p id="8741" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">发布者将消息发送到作为消息路由代理的交换机。交换基于路由关键字将消息路由到不同的队列。每个队列都有附加的消费者，他们将消费和处理消息。</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es kb"><img src="../Images/68a307387df3ab8468595ff8c636385e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tfkc_dSDqf57j5VcAbSYsg@2x.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx">RabbitMQ Broker</figcaption></figure><p id="2f74" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">现在，如果我们需要一个基于队列的系统，在这个系统中，我们在一个代理中有多个队列，并且每个RMQ实例可以相互发送和接收消息，那该怎么办呢？第二个用例可能是在不同的RMQ代理中将消息从一个队列卸载到另一个队列。<strong class="il hj"> <em class="ik">这就是铲子发挥作用的地方。</em> </strong></p><p id="3263" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">R️abbitMQ铁铲不断地将信息从一个来源移动到一个目的地。源和目标可以位于具有不同虚拟主机的同一集群中，也可以位于不同的地理和管理域中。它可以在同一个代理的队列和交换之间移动消息，也可以充当两个不同代理之间的桥梁。</p><p id="a3f8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">铲子可以用来平衡队列的负载，或者当我们需要从一个RabbitMQ代理中取出消息并插入到另一个代理中时。本质上，铲<strong class="il hj">将</strong>连接到源和目的地代理，<strong class="il hj">从队列中消费</strong>消息，<strong class="il hj">将每个消息重新发布</strong>到目的地代理。</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es kc"><img src="../Images/22ad417a518ce0f6a455b583157600f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QUf5ax4wm1iErN5_HkD2XA@2x.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx">RabbitMQ Shovel</figcaption></figure><h1 id="c841" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">为什么我们需要铲子</h1><ul class=""><li id="9342" class="lb lc hi il b im ld iq le jy lf jz lg ka lh jg li lj lk ll bi translated"><strong class="il hj">松耦合<br/> </strong>铲子可以在不同的RMQ集群之间移动消息，这些集群可能有不同的用户、RMQ版本、vhosts和消息协议(AMQP 0.9.1和AMQP 1.0)。</li><li id="2fab" class="lb lc hi il b im lm iq ln jy lo jz lp ka lq jg li lj lk ll bi translated"><strong class="il hj">万友善<br/> </strong>铲罩下采用客户端连接。它通过执行<a class="ae jh" href="https://www.rabbitmq.com/confirms.html" rel="noopener ugc nofollow" target="_blank">消费者确认</a>来容忍间歇性连接而不丢失消息。</li><li id="eb89" class="lb lc hi il b im lm iq ln jy lo jz lp ka lq jg li lj lk ll bi translated"><strong class="il hj">可配置参数<br/> </strong>铲子是高度可定制的，可以配置成执行任意数量的显式方法。</li></ul><h1 id="f102" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">铲子的类型</h1><p id="9a9e" class="pw-post-body-paragraph ii ij hi il b im ld io ip iq le is it jy lr iw ix jz ls ja jb ka lt je jf jg hb bi translated">有两种类型的铲-静态铲和动态铲。</p><p id="efb6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated"><strong class="il hj">静态铲</strong>在配置文件中定义，需要节点重启才能应用任何更新。这在本质上更为普遍，因为队列、交换和绑定需要在启动时手动声明。如果集群中存在多个RMQ节点，那么应该在配置文件中为所有节点定义一个静态铲。每一铲只会在一个节点上开始，如果这个节点出故障，它会移动到另一个健康的节点。</p><p id="1a9d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated"><strong class="il hj">动态铲</strong>在运行时参数中定义。它们可以随时创建和删除，不需要重新启动节点。这些更加自动化友好，因为铲子使用的队列和交换是自动声明的。在动态铲中，我们不需要为所有节点手动定义它。这是自动完成的，每个铲将只在一个节点上启动，并在需要时故障转移到另一个节点。</p><h1 id="0385" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">架起铲子</h1><h2 id="8e2a" class="lu ke hi bd kf lv lw lx kj ly lz ma kn jy mb mc kr jz md me kv ka mf mg kz mh bi translated">启用铲子插件</h2><p id="1df5" class="pw-post-body-paragraph ii ij hi il b im ld io ip iq le is it jy lr iw ix jz ls ja jb ka lt je jf jg hb bi translated">安装铲子是一帆风顺的。这可以通过使用<a class="ae jh" href="https://www.rabbitmq.com/cli.html" rel="noopener ugc nofollow" target="_blank"> RMQ命令行界面</a>来完成。</p><pre class="jj jk jl jm fd mi mj mk ml aw mm bi"><span id="afae" class="lu ke hi mj b fi mn mo l mp mq">rabbitmq-plugins enable rabbitmq_shovel <br/>rabbitmq-plugins enable rabbitmq_shovel_management</span></pre><h2 id="393b" class="lu ke hi bd kf lv lw lx kj ly lz ma kn jy mb mc kr jz md me kv ka mf mg kz mh bi translated">铲子测绘</h2><p id="1b5a" class="pw-post-body-paragraph ii ij hi il b im ld io ip iq le is it jy lr iw ix jz ls ja jb ka lt je jf jg hb bi translated">铲映射可以从RMQ管理仪表板创建。转到<em class="ik">管理</em>部分，点击<em class="ik">铲管理</em>。</p><p id="873f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated"><a class="ae jh" href="https://www.rabbitmq.com/uri-spec.html" rel="noopener ugc nofollow" target="_blank"> RMQ URI </a>的语法是<code class="du mr ms mt mj b">amqp://username:password@host:port/vhost</code></p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es mu"><img src="../Images/966b28ec00f891073e034d1b44c24344.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JsFuwEbQPMbtjlHM7XwJ0A.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx">RabbitMQ — Shovel Management</figcaption></figure><p id="fd42" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated"><strong class="il hj">铲参数:</strong></p><ol class=""><li id="d72f" class="lb lc hi il b im in iq ir jy mv jz mw ka mx jg my lj lk ll bi translated">虚拟主机:从下拉列表中选择vhost。</li><li id="826e" class="lb lc hi il b im lm iq ln jy lo jz lp ka lq jg my lj lk ll bi translated">铲子的名称。</li><li id="f9af" class="lb lc hi il b im lm iq ln jy lo jz lp ka lq jg my lj lk ll bi translated">来源:输入RMQ URI和来源队列/交换。</li><li id="3445" class="lb lc hi il b im lm iq ln jy lo jz lp ka lq jg my lj lk ll bi translated">目的地:目的地实例和队列/交换的RMQ·URI。</li></ol><p id="9ef8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">一旦所有细节就绪，点击<em class="ik">添加铲子</em>按钮。</p><p id="0da1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">铲的<strong class="il hj">状态</strong>可以从<em class="ik">管理</em> &gt; <em class="ik">铲状态</em>标签中看到。状态值可以是:</p><ul class=""><li id="3515" class="lb lc hi il b im in iq ir jy mv jz mw ka mx jg li lj lk ll bi translated"><em class="ik">启动</em>:铲子正在启动并创建资源，尝试连接端点。</li><li id="c72d" class="lb lc hi il b im lm iq ln jy lo jz lp ka lq jg li lj lk ll bi translated"><em class="ik">运行</em>:铲子成功连接到两个端点，从源消费，重新发布到目的地。</li><li id="6f6d" class="lb lc hi il b im lm iq ln jy lo jz lp ka lq jg li lj lk ll bi translated"><em class="ik">终止</em>:铲已经终止或出现异常。原因可以在日志中看到。</li></ul></div></div>    
</body>
</html>