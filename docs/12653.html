<html>
<head>
<title>Codeigniter 3 tutorial ~ Using Multiple select2 and saving with json format</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Codeigniter 3教程~使用多重选择2并以json格式保存</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/codeigniter-3-tutorial-using-multiple-select2-and-saving-with-json-format-a0da18abeea7?source=collection_archive---------5-----------------------#2022-05-25">https://medium.com/geekculture/codeigniter-3-tutorial-using-multiple-select2-and-saving-with-json-format-a0da18abeea7?source=collection_archive---------5-----------------------#2022-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a107157442b7d98288518b2f66acfbc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vn4m6JBBNYF8T3HFwbjbiA.png"/></div></div></figure><p id="1a50" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">大家好，朋友们好，这次我们讨论的是codeigniter 3和select2。在某些数据之后创建搜索数据时，Select2对我们来说非常有用。在构建基于web的应用程序时，Select2对开发人员非常有帮助。在我们继续之前，请<a class="ae jo" href="https://temanngoding.com/category/tutorial/codeigniter/" rel="noopener ugc nofollow" target="_blank">学习Codeigniter 3的基础知识。</a></p><p id="ccad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们直接进入介绍，如何在Codeigniter 3中使用select2。</p><h1 id="1409" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">1.数据库ˌ资料库</h1><p id="ec48" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">用sql做一个用户和爱好的表格，朋友。表格结构如下所示。</p><p id="161e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">表用户</strong></p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="7b66" class="lb jq hi kx b fi lc ld l le lf">CREATE TABLE `users` (<br/>  `id` varchar(25) NOT NULL,<br/>  `name` varchar(255) NOT NULL,<br/>  `data_pro_hobby` text DEFAULT NULL COMMENT 'Data Format JSON',<br/>) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span></pre><p id="24ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个users表只是以json格式存储爱好数据的一个例子。</p><p id="f0b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">爱好表</strong></p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="5e00" class="lb jq hi kx b fi lc ld l le lf">CREATE TABLE `hobbies` (<br/>  `id` varchar(25) NOT NULL,<br/>  `data_name` varchar(255) NOT NULL,<br/>) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span></pre><p id="9888" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">爱好表用于插入爱好数据。</p><h1 id="0cd9" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">2.控制器索引</h1><p id="de23" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">这次，朋友们，制作一个控制器作为显示数据的功能。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="fb59" class="lb jq hi kx b fi lc ld l le lf">public <em class="lg">function</em> index()<br/>    {<br/>        $data['name'] = $this-&gt;security-&gt;get_csrf_token_name();<br/>        $data['hash'] = $this-&gt;security-&gt;get_csrf_hash();<br/>        $data["hobby"] = $this-&gt;db-&gt;get_where('hobbies',array('status'=&gt;1))-&gt;result();<br/>        $this-&gt;display('index', $data);<br/>        }<br/><br/>    }</span></pre><h1 id="dfac" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">3.查看爱好</h1><p id="e446" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">接下来，我们为我们的爱好数据输入添加一个视图。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="59f8" class="lb jq hi kx b fi lc ld l le lf">&lt;div class="modal fade" id="modalHobby" role="dialog" aria-labelledby="Label" aria-hidden="true"&gt;<br/>        &lt;div class="modal-dialog modal-sm"&gt;<br/>            &lt;div class="modal-content"&gt;<br/>            &lt;div class="modal-header"&gt;<br/>                &lt;h5 class="modal-title" id="Lable"&gt;Add Hobby&lt;/h5&gt;<br/>                &lt;button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"&gt;<br/>                &lt;/button&gt;<br/>            &lt;/div&gt;<br/>            &lt;form action="&lt;?php echo base_url('user/profile/add_hobby/) ?&gt;" method="post" role="form" enctype="multipart/form-data"&gt;<br/>            &lt;input type="hidden" name="&lt;?php echo $CSRF['name']; ?&gt;" value="&lt;?php echo $CSRF['hash']; ?&gt;"/&gt;<br/>            &lt;input type="hidden" name="id" value="&lt;?php echo $users-&gt;id ?&gt;" /&gt;<br/>            &lt;input type="hidden" name="form" value="profile/setting" /&gt;<br/>            &lt;div class="modal-body"&gt;<br/>                &lt;div class="mb-3"&gt;<br/>                &lt;input type="text" name="name" class="form-controll"&gt;<br/>                &lt;/div&gt;<br/>                &lt;div class="mb-3"&gt;<br/>                &lt;select class="hobby w-100 form-select" name="hobbies[]" multiple="multiple" require&gt;<br/>                    &lt;?php<br/>					           if(!empty($hobby)){<br/>					              foreach($hobby as $value){<br/>						              echo "&lt;option value='$value-&gt;id'&gt;$value-&gt;data_name&lt;/option&gt;";<br/>					          }}<br/>                    ?&gt;<br/>                &lt;/select&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>            &lt;div class="modal-footer border-top"&gt;<br/>                &lt;button type="button" class="btn btn-muted" data-bs-dismiss="modal"&gt;Cancel&lt;/button&gt;<br/>                &lt;input type="submit" class="btn btn-danger" value="Save"&gt;<br/>            &lt;/div&gt;<br/>            &lt;/form&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;</span></pre><p id="623a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以下一步我们添加代码select2。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="9a4d" class="lb jq hi kx b fi lc ld l le lf">&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha256-aAr2Zpq8MZ+YA/D6JtRD3xtrwpEz2IqOS+pWD/7XKIw=" crossorigin="anonymous" /&gt;<br/>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha256-OFRAJNoaD8L3Br5lglV7VyLRf0itmoBzWUoM+Sji4/8=" crossorigin="anonymous"&gt;&lt;/script&gt;<br/>&lt;script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js"&gt;&lt;/script&gt;<br/>&lt;link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet" /&gt;<br/>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"&gt;&lt;/script&gt;<br/>&lt;script&gt;	<br/>$(this).find('.hobby').each(function() {<br/>				var dropdownParent = $(document.body);<br/>				if ($(this).parents('.modal.show').length !== 0)<br/>					dropdownParent = $(this).parents('.modal.show');<br/>				$(this).select2({<br/>                    theme: "bootstrap5",<br/>                    placeholder: '-Select Hobby-',<br/>					dropdownParent: dropdownParent,<br/>                    ajax: {<br/>                        url: '&lt;?php echo base_url();?&gt;user/setting/searchhobby',<br/>                        dataType: 'json',<br/>                        delay: 250,<br/>                        processResults: function (data) {<br/>                            return {<br/>                                results: data<br/>                            };<br/>                        },<br/>                        cache: true<br/>                    },<br/>                    tags: true<br/>                });<br/>			});<br/>&lt;/script&gt;</span></pre><p id="d559" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面代码的结果:</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es lh"><img src="../Images/ee94b036513c21d455ab82484982699e.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/0*Qfmgu6Crgkhf3wxb.png"/></div></figure><h1 id="b3f6" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">4.途径</h1><p id="993d" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">添加运行select2和我们的数据存储的路由。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="8120" class="lb jq hi kx b fi lc ld l le lf">// Hobby<br/>$route['user/setting/searchhobby'] = 'users_setting/searchHobby';<br/>$route['user/profile/add_hobby/(:any)'] = 'users_profile/hobby_add';</span></pre><h1 id="5105" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">5.控制器搜索数据爱好</h1><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="d445" class="lb jq hi kx b fi lc ld l le lf">function searchHobby()<br/>    {<br/>        $q = $this-&gt;input-&gt;get('q');<br/>        $this-&gt;load-&gt;model('M_hobby');<br/>        echo json_encode($this-&gt;M_setting-&gt;getHobby($q));<br/>    }</span></pre><h1 id="6a95" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">6.模特爱好</h1><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="f3dc" class="lb jq hi kx b fi lc ld l le lf">&lt;?php<br/>class M_hobby extends CI_Model<br/>{<br/>    function __construct()<br/>    {<br/>        parent::__construct();<br/>    }<br/>    <br/>    function getHobby($str)<br/>    {<br/>        $this-&gt;db-&gt;select('id, data_name as text');<br/>        $this-&gt;db-&gt;like('data_name', $str);<br/>        $query = $this-&gt;db-&gt;get('mst_hobbies');<br/>        return $query-&gt;result();<br/>    }<br/>}<br/>?&gt;</span></pre><h1 id="ab11" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">7.控制器爱好</h1><p id="24ee" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">这次我们将创建一个函数来将我们的爱好数据保存到users表中。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="082c" class="lb jq hi kx b fi lc ld l le lf">/** add hobby */<br/>    public function hobby_add()<br/>    {<br/>        $this-&gt;form_validation-&gt;set_rules('hobbies[]', 'hobby', 'trim|required');<br/>        $name    = $this-&gt;input-&gt;post('name');<br/>        $hobbies    = $this-&gt;input-&gt;post('hobbies');<br/>		    if(!empty($hobbies)){<br/>                $result = [];<br/>                foreach($hobbies AS $key =&gt; $val){<br/>                $hobby = $this-&gt;db-&gt;get_where('hobbies', array('id'=&gt;$hobbies[$key]))-&gt;row();<br/>                $result[] = array(<br/>                    'hobby_id'          =&gt; $hobby-&gt;id,<br/>                );<br/>                }<br/>        $contact['hobby'] = json_encode($result, true);<br/>        $update = $this-&gt;db-&gt;update('users', $contact);<br/>        }<br/>        if($update == true){<br/>            $this-&gt;session-&gt;set_flashdata('success', 'Account has been saved');<br/>        }<br/>        redirect('index');<br/>    }</span></pre><p id="2b9e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将json数据输出到用户表:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="789c" class="lb jq hi kx b fi lc ld l le lf">[{"hobby_id":"21090861384371A7E59"},{"hobby_id":"210908613842CA630B1"},{"hobby_id":"210908613842D26118E"},{"hobby_id":"210908613842D8F29B9"}]</span></pre><p id="d538" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是我可以传达的指南，希望它对我所有的朋友都有用。</p><p id="94d6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另请阅读其他教程:</p><p id="086a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://temanngoding.com/tutorial-codeigniter-4-load-more-menggunakan-ajax/" rel="noopener ugc nofollow" target="_blank"> Codeigniter 4教程~使用ajax加载更多内容</a></p><p id="9860" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://temanngoding.com/tutorial-codeigniter-4-restful-api-jwt-authentication/" rel="noopener ugc nofollow" target="_blank"> CodeIgniter 4教程~ RESTful API JWT认证</a> <br/> <br/> <a class="ae jo" href="https://temanngoding.com/menghilangkan-public-dan-index-php-dari-url-codeigniter-4/" rel="noopener ugc nofollow" target="_blank">从Codeigniter URL 4中移除Public和Index.php</a></p></div></div>    
</body>
</html>