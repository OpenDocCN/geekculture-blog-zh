<html>
<head>
<title>Headless WooCommerce &amp; Next.js: Create a Cart</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Headless WooCommerce &amp; Next.js:创建一个购物车</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/headless-woocommerce-next-js-create-a-cart-8a3e49b90076?source=collection_archive---------18-----------------------#2021-08-03">https://medium.com/geekculture/headless-woocommerce-next-js-create-a-cart-8a3e49b90076?source=collection_archive---------18-----------------------#2021-08-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/833b96ed99c9c46e67c410b11151c47d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R_ff5x4A8Vx9-UD1"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@jblesly?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Lesly Juarez</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="757b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你已经阅读了这一系列文章，你会知道我们可以在WooCommerce中创建订单，而不需要购物车。尽管如此，用户在结账前管理他们的购物车还是很有帮助的，这也是我们为什么要建立一个购物车的原因。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="d59a" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">选择您的购物车方法</h1><p id="52fc" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">我们需要决定如何处理这个问题，因为WooCommerce REST API不包含端点来帮助您管理购物车。</p><p id="b2ba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一种选择是创建一个新的WooCommerce订单，并调用API来更新行项目。然后，购物车页面将从WooCommerce订单中提取行项目进行显示。</p><p id="e22c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">另一种选择是我们自己管理购物车，然后在用户准备结账时提交行项目来创建WooCommerce订单。这是我选择的选项，因为我们想知道的只是产品id和数量，我们应该能够跟踪这些信息。</p><p id="f7f0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当然，事情从来没有这么简单，因为即使这就是我们对WooCommerce订单的全部需求，我们还需要更多的数据来创建我们自己的购物车UI。例如，我们需要显示价格，而WooCommerce将根据产品ID和数量自行计算，我们需要在前端进行计算。</p><p id="78d1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这两种选择都有一个权衡，但我宁愿在前端进行一些计算，而不是进行更多的API调用。</p><h1 id="2ea9" class="ka kb hi bd kc kd ld kf kg kh le kj kk kl lf kn ko kp lg kr ks kt lh kv kw kx bi translated">将数据扩展到Redux</h1><p id="0f6d" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">在我们当前的代码中，用户点击<code class="du li lj lk ll b">Add to Cart</code>，所发生的只是一个行项目的有限版本被添加到Redux。我们跟踪产品ID和数量，因为这是我们创建WooCommerce订单所需的全部内容。</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="07ad" class="lu kb hi ll b fi lv lw l lx ly">const lineItem = {<br/>  product_id: product.id,<br/>  quantity: 1,<br/>};</span></pre><p id="42cb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，现在我们正在处理我们自己的购物车，我想将我们保存的内容扩展到Redux，这样我们至少有名称和价格作为附加数据字段。</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="33c0" class="lu kb hi ll b fi lv lw l lx ly">const lineItem = {<br/>  product_id: product.id,<br/>  quantity: 1,<br/>  name: product.name,<br/>  price: product.regular_price,<br/>};</span></pre><h1 id="6d3b" class="ka kb hi bd kc kd ld kf kg kh le kj kk kl lf kn ko kp lg kr ks kt lh kv kw kx bi translated">创建购物车</h1><p id="a7f9" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">最简单的是，我们有一个存储在Redux中的行项目数组，我们希望在一个购物车页面中显示这些行项目。我们需要一个函数来计算每个行项目的总数，就像数量和价格相乘一样简单。</p><p id="5dc3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，我们需要添加一些功能，以便我们可以增加/减少数量，并完全删除该项目。在前一篇文章中，我已经创建了Redux动作函数来允许我们管理它。</p><p id="8e54" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于每个行项目，我包括一个<code class="du li lj lk ll b">X</code>按钮来删除该行项目，以及数量两侧的<code class="du li lj lk ll b">-</code>和<code class="du li lj lk ll b">+</code>按钮来减少和增加数量。这很简单，只需将Redux动作函数连接到适当的按钮上。</p><figure class="lm ln lo lp fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="14c7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du li lj lk ll b">CartQty</code>是显示数量的独立组件，两侧有<code class="du li lj lk ll b">-</code>和<code class="du li lj lk ll b">+</code>按钮来减少或增加数量。</p><p id="b7e6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面的<code class="du li lj lk ll b">CartItem.tsx</code>组件用于显示每个行项目，剩下要做的就是在Redux中映射行项目并显示每个<code class="du li lj lk ll b">CartItem</code>。</p><p id="cf95" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我还创建了一个组件来显示购物车的总额，我认为这是一个不需要我的代码就可以处理的事情。</p><h1 id="8b09" class="ka kb hi bd kc kd ld kf kg kh le kj kk kl lf kn ko kp lg kr ks kt lh kv kw kx bi translated">更进一步</h1><p id="53cc" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">这里创建的购物车几乎是您的基本版本。如果您想在将来的会话中检索购物车，该怎么办？目前，在这种结构下这是不可能的。</p><p id="db98" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了检索您的购物车，首先您需要一些跨会话持久化的数据。与其保存到Redux，不如直接保存到本地存储/cookies。或者将WooCommerce订单ID保存到本地存储/cookie中，并在用户返回时根据订单ID获取该订单。</p><p id="e96b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可能希望在购物车摘要中显示任何折扣和/或税收信息。既然如此，您需要将保存的内容扩展到Redux，并进行必要的计算。</p><p id="dc9a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最终，它可以像您需要的那样复杂，但是请记住，您需要传递给WooCommerce订单的只是产品ID和数量。</p><h1 id="0357" class="ka kb hi bd kc kd ld kf kg kh le kj kk kl lf kn ko kp lg kr ks kt lh kv kw kx bi translated">更新WooCommerce行项目的问题</h1><p id="453b" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">这个很烦。假设您创建了一个只有一个行项目的WooCommerce订单(它同样适用于多个行项目，但我们将以一个为例)。我们传入<code class="du li lj lk ll b">product_id</code>和<code class="du li lj lk ll b">quantity</code>，行项目被成功添加到订单中，我们可以在返回的JSON对象中看到行项目及其所有属性。这是行项目的一个简化示例:</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="707c" class="lu kb hi ll b fi lv lw l lx ly">{<br/>  id: 5, <br/>  name: Doughnut,<br/>  product_id: 17,<br/>  quantity: 1,<br/>  subtotal: "8.00",<br/>  total: "8.00",<br/>  price: 8<br/>}</span></pre><p id="3d1e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以，如果我想为这个特定的WooCommerce订单更新相同的行项目，我可以使用带有<code class="du li lj lk ll b">/orders/&lt;id&gt;</code>端点的PUT请求，对吗？我知道我要更新的行项目的ID，所以我可以在请求数据中传递如下内容:</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="43a1" class="lu kb hi ll b fi lv lw l lx ly">{<br/>  id: 5,<br/>  product_id: 17,<br/>  quantity: 2<br/>} </span></pre><p id="2664" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">PUT请求将会成功，但是subtotal、total和price会发生一些奇怪的事情。通过将数量增加到2，我们将会看到<code class="du li lj lk ll b">subtotal: "16.00"</code>和<code class="du li lj lk ll b">price: 8</code>。然而，我们得到的却是:</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="5bfc" class="lu kb hi ll b fi lv lw l lx ly">{<br/>  id: 5, <br/>  name: Doughnut,<br/>  product_id: 17,<br/>  quantity: 2,<br/>  subtotal: "8.00",<br/>  total: "8.00",<br/>  price: 4<br/>}</span></pre><p id="2181" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">小计不更新。相反，价格通过用旧的小计除以新的数量来更新。这对我来说是最奇怪的。</p><p id="22f5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您想要更新现有的行项目，那么您必须自己进行小计和总计计算，并将其包含(作为字符串)。类似这样的事情会起作用:</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="d7fc" class="lu kb hi ll b fi lv lw l lx ly">{<br/>  id: 5, <br/>  product_id: 17,<br/>  quantity: 2,<br/>  subtotal: "16.00",<br/>  total: "16.00"<br/>}</span></pre><p id="806c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">提醒一下<code class="du li lj lk ll b">subtotal</code>是折扣前的明细行小计。<code class="du li lj lk ll b">total</code>是折扣后的行总数。<a class="ae iu" href="https://woocommerce.github.io/woocommerce-rest-api-docs/?javascript#order-line-items-properties" rel="noopener ugc nofollow" target="_blank">这里是开发者文档</a>的链接，了解更多信息。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="02c9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第1部分:用WooCommerce创建一个本地WordPress</p><p id="f895" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-set-up-woocommerce-test-with-postman-5e7859c65626" rel="noopener">第2部分:设置WooCommerce &amp;测试与邮递员</a></p><p id="ad3a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-set-up-next-js-b8d2193b2688" rel="noopener">第三部分:设置Next.js </a></p><p id="b99d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-set-up-styled-components-with-typescript-and-next-js-18cc047ccd79" rel="noopener">第4部分:用TypeScript和Next.js设置样式组件</a></p><p id="9883" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-display-products-and-create-orders-593a6c5aee86" rel="noopener">第5部分:展示产品并创建订单</a></p><p id="e794" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-set-up-redux-toolkit-for-state-management-c605adda58fe" rel="noopener">第6部分:为状态管理建立Redux工具包</a></p><p id="907f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-create-a-cart-8a3e49b90076" rel="noopener">第7部分:创建购物车</a></p><p id="2f9c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://leojbchan.medium.com/headless-woocommerce-next-js-set-up-stripe-and-create-checkout-d01333607a66" rel="noopener">第8部分:设置条带并创建检验</a></p></div></div>    
</body>
</html>