<html>
<head>
<title>Reactive State Management with Apollo Client React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Apollo客户端React进行反应式状态管理</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/reactive-state-management-with-apollo-client-react-51c6467a8a49?source=collection_archive---------5-----------------------#2021-04-14">https://medium.com/geekculture/reactive-state-management-with-apollo-client-react-51c6467a8a49?source=collection_archive---------5-----------------------#2021-04-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7e09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">谁是观众？</strong></p><p id="836b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">任何与React应用程序组件地狱和prop drilling作斗争的人都会发现这篇文章很有帮助。</p><p id="5694" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">你应该事先知道什么？</strong></p><p id="02c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应该熟悉<strong class="ih hj"> React </strong>和<strong class="ih hj"> Redux </strong>或者<strong class="ih hj"> Ngrx </strong>如果你来自一个棱角分明的背景。</p><p id="bae6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">什么问题？</strong></p><p id="7c2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Apollo的状态管理有很多问题，angular和React都有，感觉只是缓存API并不意味着你已经完成了状态管理。您应该能够使用任何状态管理库轻松地使用数据。Apollo非常不擅长客户端状态管理。</p><p id="3159" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">什么是客户端状态？</strong></p><p id="e9c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据并不存在于服务器上，只是在前端对视图进行操作时需要。</p><p id="60bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你试图设置一个全局模式，并希望在某种情况下显示或隐藏它时，你不需要在服务器上保留这个标志，而是在客户端进行管理。</p><p id="4a43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">阿波罗客户端无功Var来救援？</strong></p><p id="7d5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你和阿波罗一起工作过，它说一切都是神奇的，相信我，它不是。如果你来自Redux背景，你已经可以理解我的意思了。</p><h1 id="d53e" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">说教讲够了，让我们把手弄脏吧</h1><p id="ab1b" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">让我们试着做一个货币搜索组件，我们可以通过名字的首字母来过滤货币。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/135a3ffe69f2eb6064fc8b7e6a405a0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1HmKLeo2-TyZ2hLf4I4bFg.png"/></div></div></figure><p id="6153" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">文件夹结构</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es ks"><img src="../Images/0d08e59115e77c4b86b444e62f1255cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*CyB4wMkmJJxPlEKlCx2XCg.png"/></div></figure><p id="26eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看示例容器</p><pre class="kh ki kj kk fd kt ku kv kw aw kx bi"><span id="243b" class="ky je hi ku b fi kz la l lb lc">// inteligent container to do all the data interaction like a controller</span><span id="3167" class="ky je hi ku b fi ld la l lb lc">import React, { Fragment, useEffect } from "react";<br/>import { Col, Container, Row } from "react-bootstrap";<br/>import { exampleState } from "../localstate/example";<br/>import { SearchExample } from "./search";<br/>import { useApolloClient, useQuery, useReactiveVar } from "<a class="ae le" href="http://twitter.com/apollo/client" rel="noopener ugc nofollow" target="_blank">@apollo/client</a>";<br/>import { GET_RATES, GET_RATES_PLUS_CLIENT } from "./queries/queries";<br/>import { Item } from "./item";</span><span id="3c6a" class="ky je hi ku b fi ld la l lb lc">export function ExampleContainer(props) {<br/>  const state = useReactiveVar(exampleState);</span><span id="f889" class="ky je hi ku b fi ld la l lb lc">const client = useApolloClient();</span><span id="fe14" class="ky je hi ku b fi ld la l lb lc">const { loading, error, data } = useQuery(GET_RATES);</span><span id="3de4" class="ky je hi ku b fi ld la l lb lc">useEffect(() =&gt; {<br/>    console.log(state, " state changed");</span><span id="575b" class="ky je hi ku b fi ld la l lb lc">client.query({ query: GET_RATES_PLUS_CLIENT }).then((data) =&gt; {<br/>      console.log(data, " got this data using query");<br/>    });<br/>  }, [state.searchString]);</span><span id="22d5" class="ky je hi ku b fi ld la l lb lc">if (loading) return &lt;p&gt; loading&lt;/p&gt;;<br/>  if (error) return &lt;p&gt; error&lt;/p&gt;;</span><span id="d298" class="ky je hi ku b fi ld la l lb lc">return (<br/>    &lt;Fragment&gt;<br/>      &lt;Container&gt;<br/>        &lt;Row&gt;<br/>          &lt;Col xs={12}&gt;<br/>            {state.searchString}<br/>            &lt;SearchExample /&gt;<br/>          &lt;/Col&gt;<br/>        &lt;/Row&gt;<br/>        &lt;Row&gt;<br/>          {data.rates<br/>            .filter((f) =&gt;<br/>              f.currency.includes(state.searchString.toUpperCase())<br/>            )<br/>            .map((item) =&gt; {<br/>              return &lt;Item currency={item.currency} /&gt;;<br/>            })}<br/>        &lt;/Row&gt;<br/>      &lt;/Container&gt;<br/>    &lt;/Fragment&gt;<br/>  );<br/>}</span></pre><p id="dbdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你仔细看看上面的组件，你会发现传递的道具更少了，我们使用的是一个来自Apollo客户端的反应式Var来在组件之间共享客户端状态。</p><p id="dd13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以不再打电话回地狱了。</p><p id="616d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">让我们看看客户端反应文件</strong></p><pre class="kh ki kj kk fd kt ku kv kw aw kx bi"><span id="57bb" class="ky je hi ku b fi kz la l lb lc">import { makeVar } from "<a class="ae le" href="http://twitter.com/apollo/client" rel="noopener ugc nofollow" target="_blank">@apollo/client</a>";</span><span id="2431" class="ky je hi ku b fi ld la l lb lc">// shape of your local state<br/>export interface ExampleState {<br/>  searchString: string;<br/>  items: Number[];<br/>  orgid: Number;<br/>  SelectAll: Boolean;<br/>}</span><span id="3ac5" class="ky je hi ku b fi ld la l lb lc">const initialState = {<br/>  searchString: "",<br/>  items: [],<br/>  orgid: null,<br/>  SelectAll: false<br/>};</span><span id="d927" class="ky je hi ku b fi ld la l lb lc">export const exampleState = makeVar&lt;ExampleState&gt;(initialState);</span></pre><p id="f033" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我知道你在想什么，它看起来像一个行为主题，它非常相似，它是基于禅宗观察，Rxjs的小兄弟。</p><p id="a3c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如何消耗无功Var，阿波罗给你<strong class="ih hj"> useReactiveVar钩子</strong></p><pre class="kh ki kj kk fd kt ku kv kw aw kx bi"><span id="ead8" class="ky je hi ku b fi kz la l lb lc">const state = useReactiveVar(exampleState);</span></pre><p id="b145" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，任何具有这种状态的组件都可以很容易地监听状态的变化，并产生效果。</p><p id="4480" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的容器组件可以监听搜索字符串的变化，并过滤货币列表</p><pre class="kh ki kj kk fd kt ku kv kw aw kx bi"><span id="fbe2" class="ky je hi ku b fi kz la l lb lc">useEffect(() =&gt; {<br/>    console.log(state, " state changed");</span><span id="0bda" class="ky je hi ku b fi ld la l lb lc">client.query({ query: GET_RATES_PLUS_CLIENT }).then((data) =&gt; {<br/>      console.log(data, " got this data suing query");<br/>    });<br/>  }, [state.searchString]);</span></pre><p id="eed9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对<strong class="ih hj"> state.searchString </strong>的任何改变都将触发新的搜索。</p><p id="8fd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就这样没有回调，快乐编码。可以在查看工作示例</p><p id="e8ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae le" href="https://codesandbox.io/s/cranky-pascal-d98jq" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">此处</strong> </a></p><p id="0548" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你喜欢这个例子，请鼓掌:)</p></div></div>    
</body>
</html>