<html>
<head>
<title>Introduction to Infrastructure as Code with Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Terraform介绍基础设施代码</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/introduction-to-infrastructure-as-code-with-terraform-15d23abe12d?source=collection_archive---------37-----------------------#2021-06-24">https://medium.com/geekculture/introduction-to-infrastructure-as-code-with-terraform-15d23abe12d?source=collection_archive---------37-----------------------#2021-06-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b3c01f50361d7b18b0d70258f68a1f48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFwJxnAFI_fstXKqIzW8QA.jpeg"/></div></div></figure><p id="35d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">想象一下，几年前，在一家IT公司工作，当时虚拟机或云计算的概念还不存在。如果让您的团队负责提供推出贵公司最新产品所需的基础架构，您认为需要什么来实现这一目标？</p><p id="a52b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">嗯，这并不容易。您的团队将不得不经历整个硬件购买周期，并等待数天来准确配置服务器，以满足公司的期望。还有网络配置、存储配置等。落在你团队的肩上。</p><p id="fa72" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">幸运的是，今天我们拥有虚拟化和云计算的力量。我们不再需要安装和堆叠服务器，或者购买不动产来设置数据中心。</p><p id="18f0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">随着IT部门的快速发展，如今的公司正在转向云来满足其基础架构需求。虽然这解决了早期存在的许多问题，但配置一致性的问题很快就出现了。</p><h2 id="bb13" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">这就是代码为的<strong class="ak">基础设施是如何诞生的。</strong></h2><p id="f2b6" class="pw-post-body-paragraph iq ir hi is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hb bi translated">顾名思义，<strong class="is hj">基础设施即代码(IaC) </strong>允许开发人员通过简单地编写代码来提供IT环境。这样做的动机是为了实现<strong class="is hj">自动化</strong>、<strong class="is hj">速度</strong>和<strong class="is hj">一致性</strong>。对于大型项目的大型团队来说，手动管理基础架构本身就是一项任务，并且容易出现不一致和差异。</p><p id="58f7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">IaC系统允许我们将网络设备、存储设备或计算设备视为软件，并通过以人类可读语言编写代码来提供，这些代码对指定的资源提供者进行API调用，以满足基础架构的需求。</p><p id="75ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi ko translated">erraform是一个很好的IaC工具的例子。Terraform使用声明性语言编写易于理解的代码，并有效地帮助供应和管理基础设施的生命周期。它支持1000多家提供商，包括AWS、Azure、GCP等云提供商，Kubernetes等编排工具，以及许多其他提供商。</p><p id="b7c0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">提供者只不过是允许Terraform在特定提供者上提供和管理资源的插件。</p><p id="f56a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，如果您要使用AWS，并在那里使用Terraform启动EC2实例，您可能首先要加载提供者AWS——包括关于访问您的AWS帐户的信息。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="5fc0" class="jo jp hi lc b fi lg lh l li lj"><strong class="lc hj">provider “aws” {</strong></span><span id="65f4" class="jo jp hi lc b fi lk lh l li lj"><strong class="lc hj">region=”ap-south-1"</strong></span><span id="7ea3" class="jo jp hi lc b fi lk lh l li lj"><strong class="lc hj">profile = “default”</strong></span><span id="191e" class="jo jp hi lc b fi lk lh l li lj"><strong class="lc hj">}</strong></span></pre><p id="c0d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面几行指定了一个提供者，而'<strong class="is hj"> <em class="ll">概要文件</em> </strong>'关键字告诉我们使用什么AWS概要文件来访问资源。</p><p id="3713" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ll">注意:如果你是云的新手，在进一步阅读之前了解云计算的基本概念会有所帮助</em></p><p id="ca7b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae lm" href="https://registry.terraform.io/" rel="noopener ugc nofollow" target="_blank"> terraform registry </a>帮助您轻松快速地为各种提供商定义资源，最好开始学习并使用该文档实现用例。</p><p id="1515" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，我们将在后面的博客中更多地讨论供应资源和编写代码，下面是用于供应资源的一般语法。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="b1ca" class="jo jp hi lc b fi lg lh l li lj"><strong class="lc hj">resource “&lt;type_of_resource&gt;” “&lt;name_of_resouce&gt;” {</strong></span><span id="e4b1" class="jo jp hi lc b fi lk lh l li lj"><strong class="lc hj">&lt;resource_parameters&gt;</strong></span><span id="dba4" class="jo jp hi lc b fi lk lh l li lj"><strong class="lc hj">}</strong></span></pre><p id="7230" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Terraform使用<strong class="is hj">声明性语言</strong>，因此始终保持一致性。此外，当使用terraform执行特定配置文件时，它会将所述环境的当前状态与代码文件中指定的要求进行比较。一个扩展名为<em class="ll">的文件。tfstate </em>存储关于基础设施当前状态的所有信息。如果没有检测到任何变化，terraform会自动认为基础设施是最新的。terraform就是这样展示<strong class="is hj">幂等</strong>性质和<strong class="is hj">一致性</strong>的。</p><p id="71a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">基本入门命令:</strong></p><p id="f6eb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"><em class="ll">terraform init</em></strong>—用于加载和下载terra form配置文件中使用的提供程序</p><p id="7a13" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="ll">地形图</em> </strong> —用于查看执行配置文件时将发生的变化。</p><p id="ba2b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"><em class="ll">terra form apply</em></strong>—用于运行代码文件。</p><p id="95eb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ll">注意:我们用terraform编写的每个代码文件都有一个. tf扩展名。</em></p><p id="89be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">浏览此<a class="ae lm" href="https://learn.hashicorp.com/tutorials/terraform/install-cli" rel="noopener ugc nofollow" target="_blank"> URL </a>在您的系统中安装Terraform</p><p id="765d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了开始一些真实的例子，创建一个AWS帐户。使用IAM服务创建一个用户，并记下access_key和secret_key。</p><p id="9a9f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你还没有这样做，你可以按照下面的步骤来做，一旦你安装了terraform。</p><p id="c29d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">配置AWS CLI</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="b5d5" class="jo jp hi lc b fi lg lh l li lj"><strong class="lc hj">aws configure</strong></span></pre><p id="f8c0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">系统将提示您输入之前记录的区域和IAM凭据。输入这些内容，并将最后一个选项保留为默认值。这将创建一个'<strong class="is hj"> default </strong> ' aws配置文件，我们可以使用它来验证我们的帐户，同时使用Terraform与aws通信。</p><p id="5855" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要列出创建的配置文件，</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="6c0c" class="jo jp hi lc b fi lg lh l li lj"><strong class="lc hj">aws configure list-profiles</strong></span></pre><p id="d66c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，单击此处的<a class="ae lm" href="https://github.com/InshiyaNalawala/terraform" rel="noopener ugc nofollow" target="_blank">按钮</a>将基本的terraform代码下载到您的工作区，并运行以下命令:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="f9d0" class="jo jp hi lc b fi lg lh l li lj"><strong class="lc hj">terraform init </strong></span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es ln"><img src="../Images/86f1a24c94bf505fcf5f8978093b5ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*MnvTvFdPdMCv4fjQpkbJ8Q.png"/></div></figure><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="1742" class="jo jp hi lc b fi lg lh l li lj"><strong class="lc hj">terraform plan</strong></span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es ln"><img src="../Images/3de4ceb2e8e22eb15e64fe6869a68ae3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*5wX63avmTdm8l4ipcNtUmQ.png"/></div></figure><p id="be92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您将看到类似如下的输出。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="c618" class="jo jp hi lc b fi lg lh l li lj"><strong class="lc hj">terraform apply</strong></span></pre><p id="b861" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">出现提示时，键入'<strong class="is hj">是</strong>'。这个基本示例在您的AWS帐户中启动一个类型为<em class="ll"> t2.micro </em>的EC2实例。检查AWS控制台以确认这一点。</p><p id="57ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果一切顺利，您将会收到与此类似的输出。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es ln"><img src="../Images/a74fa4be389bb965a40e912b8372c86d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*U_NGgibjWeDfFOL1YYT5ag.png"/></div></figure><p id="6caa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">若要撤消更改并删除实例，请运行以下命令</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="aa69" class="jo jp hi lc b fi lg lh l li lj"><strong class="lc hj">terraform destroy</strong></span></pre><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es ln"><img src="../Images/64d9b2b782ec0a349cd01dc4abb3f626.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*3fELqDC_TWPDCWa8ozJG9A.png"/></div></figure><p id="77fb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我很快会带着另一个演示回来。</p><p id="0aa8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">谢谢你。</p></div></div>    
</body>
</html>