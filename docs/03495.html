<html>
<head>
<title>How to host your website on an old Mac mini with SSL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用SSL在旧的Mac mini上托管您的网站</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-host-your-website-on-an-old-mac-mini-with-ssl-4f7c8125cc8c?source=collection_archive---------5-----------------------#2021-06-09">https://medium.com/geekculture/how-to-host-your-website-on-an-old-mac-mini-with-ssl-4f7c8125cc8c?source=collection_archive---------5-----------------------#2021-06-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/4c28523509b8c39d9228ee1349e52217.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZD1MOq7NZLNNZjNb-L3qXw.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Set up your own web server and host your sites virtually for free</figcaption></figure><div class=""/><p id="8441" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你好。有一段时间，我考虑在我的家庭服务器上托管我的网站。原因包括好奇心、在环境设置中容易做出改变、完全访问和学习体验。</p></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><h1 id="5356" class="jz ka hx bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated"><strong class="ak">硬件</strong></h1><p id="1afc" class="pw-post-body-paragraph iu iv hx iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">在这个实验中，我用了一台旧的Mac mini来向你展示它不需要尖端技术。我在Facebook Marketplace上花了高达30(！)考虑到规格，这可能是我迄今为止最幸运的一次购买。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lc"><img src="../Images/af18053f741703cc5229d4e6a57c4333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bLgFhexvQu1XlVxwI8-TqQ.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">2009 Mac Mini with SSD, 2.66Ghz Core 2 Duo cpu and 16Gb of ram for £30</figcaption></figure><p id="7102" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是一台2009年的机器，有256Gb的SSD和16gb的ram，以及2.66Ghz的Core 2 Duo处理器。运行Apache和服务一个简单的React单页面应用程序绰绰有余！</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lh"><img src="../Images/c191136a92f1c243ade9722ac4ff1a1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_cSjWpytZzKoepgkKaRxHA.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">2009 mac mini from Facebook Marketplace… Perfect!</figcaption></figure></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><h1 id="c422" class="jz ka hx bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated"><strong class="ak">关于网站需要考虑的事情</strong></h1><p id="3912" class="pw-post-body-paragraph iu iv hx iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">因此，在这一点上，我准备创建网站。虽然不是每个网站都是平等的。值得一提的是，高流量和资源密集型网站可能不是这种类型的托管解决方案的最佳候选。</p><h2 id="b663" class="li ka hx bd kb lj lk ll kf lm ln lo kj jf lp lq kn jj lr ls kr jn lt lu kv lv bi translated">另一方面，它非常适合以下任何情况:</h2><ul class=""><li id="f8ee" class="lw lx hx iw b ix kx jb ky jf ly jj lz jn ma jr mb mc md me bi translated">个人网站或作品集</li><li id="2204" class="lw lx hx iw b ix mf jb mg jf mh jj mi jn mj jr mb mc md me bi translated">促销网站</li><li id="09ee" class="lw lx hx iw b ix mf jb mg jf mh jj mi jn mj jr mb mc md me bi translated">调查</li><li id="14bc" class="lw lx hx iw b ix mf jb mg jf mh jj mi jn mj jr mb mc md me bi translated">封闭访问web应用程序</li></ul><p id="37ec" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="mk">也就是说，我已经决定以这种方式托管我自己的个人网站。</em></p><h1 id="d128" class="jz ka hx bd kb kc ml ke kf kg mm ki kj kk mn km kn ko mo kq kr ks mp ku kv kw bi translated">原因是:</h1><ul class=""><li id="5e91" class="lw lx hx iw b ix kx jb ky jf ly jj lz jn ma jr mb mc md me bi translated">我预计交通流量适中</li><li id="b468" class="lw lx hx iw b ix mf jb mg jf mh jj mi jn mj jr mb mc md me bi translated">这是一个静态的React应用程序</li></ul><p id="e887" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要在我客厅的旧Mac Mini上直接访问我的网站，请浏览:<a class="ae mq" href="https://thecaringdeveloper.com" rel="noopener ugc nofollow" target="_blank">https://thecaringdeveloper.com</a></p><h1 id="6fc3" class="jz ka hx bd kb kc ml ke kf kg mm ki kj kk mn km kn ko mo kq kr ks mp ku kv kw bi translated">准备</h1><h2 id="6156" class="li ka hx bd kb lj lk ll kf lm ln lo kj jf lp lq kn jj lr ls kr jn lt lu kv lv bi translated">创建网站</h2><p id="cb25" class="pw-post-body-paragraph iu iv hx iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">首先，我建议不要在家里托管WordPress网站，然而这是完全可能的。Wordpress有一种混合的方式来存储页面数据。尽管您可以创建静态模板部件，其中硬编码的部分几乎不会改变，但仍有大量数据是从数据库中加载的。因此，在页面加载之前，每个浏览器请求都会触发大量昂贵的php逻辑和数据库查询。这种类型的web应用程序需要一些能量才能快速工作。这并不可怕，但你可以获得更好的结果去廉价的共享主机。</p><p id="a1a8" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以我的网站是静态的。这意味着页面是自包含的，因此不从数据库加载数据。它实际上没有任何数据库连接。如果你不熟悉React:它的工作方式是在你的机器上创建你的站点，然后构建它。在构建阶段，代码会被大量缩减和优化，所以你的代码已经准备好投入使用了。</p><h2 id="0435" class="li ka hx bd kb lj lk ll kf lm ln lo kj jf lp lq kn jj lr ls kr jn lt lu kv lv bi translated">设计</h2><p id="1e91" class="pw-post-body-paragraph iu iv hx iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">这项工作从实际规划和设计网站内容开始。这个我用的是Adobe XD。对于有设计背景的人来说，这是一个相对容易的任务。我只花了一个早上。为了准备好你的网站设计，我建议从内容开始。拿一张空白的(谷歌文档)纸，把你要对访问你网站的人说的话倒在上面。当然，说起来容易做起来难，但是你能做到的容易程度是你的信息有多清晰的一个强有力的指标。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mr"><img src="../Images/8f792ebfb922e9f842e25e69471ea01c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7At2K1cFO_Ez26chjqFBzQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">I used Adobe XD to create the website design</figcaption></figure><h2 id="be08" class="li ka hx bd kb lj lk ll kf lm ln lo kj jf lp lq kn jj lr ls kr jn lt lu kv lv bi translated">编码</h2><p id="9606" class="pw-post-body-paragraph iu iv hx iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">正如我提到的，我使用React进行编码。过多地谈论如何做到这一点超出了范围，所以我尽量简短:</p><p id="8d80" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">编码并编译它:)</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ms"><img src="../Images/e3a49e0005b457fde4b5eaa0f5d0d3bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G-Et9tzfv6t9Uf9xqyvqTw.png"/></div></div></figure><p id="239a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">此时，您已经准备好了应用程序。我强烈建议将代码库存储在Github中，但这并不是绝对必要的。你可以简单地把它复制到你的服务器上。</p><p id="3657" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">就我而言，我建立了一个回购协议，以便更容易跟踪变化。</p><h2 id="4378" class="li ka hx bd kb lj lk ll kf lm ln lo kj jf lp lq kn jj lr ls kr jn lt lu kv lv bi translated">回到你的服务器</h2><p id="89eb" class="pw-post-body-paragraph iu iv hx iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">此时，我已经准备好了站点代码，等待部署。让我们来看看在您的浏览器中为站点提供服务需要哪些步骤。</p><p id="6fe4" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在下面几节中，我将详细介绍以下步骤:</p><ul class=""><li id="ef38" class="lw lx hx iw b ix iy jb jc jf mt jj mu jn mv jr mb mc md me bi translated">在路由器设置中打开端口80和443</li><li id="8165" class="lw lx hx iw b ix mf jb mg jf mh jj mi jn mj jr mb mc md me bi translated">安装brew</li><li id="1204" class="lw lx hx iw b ix mf jb mg jf mh jj mi jn mj jr mb mc md me bi translated">安装Apache</li><li id="efe6" class="lw lx hx iw b ix mf jb mg jf mh jj mi jn mj jr mb mc md me bi translated">配置域DNS</li><li id="be25" class="lw lx hx iw b ix mf jb mg jf mh jj mi jn mj jr mb mc md me bi translated">设置由Apache提供服务的站点</li><li id="e4cd" class="lw lx hx iw b ix mf jb mg jf mh jj mi jn mj jr mb mc md me bi translated">获取SSL证书</li><li id="b521" class="lw lx hx iw b ix mf jb mg jf mh jj mi jn mj jr mb mc md me bi translated">正在为站点安装SSL证书</li><li id="c72c" class="lw lx hx iw b ix mf jb mg jf mh jj mi jn mj jr mb mc md me bi translated">优化</li></ul><h2 id="0ae0" class="li ka hx bd kb lj lk ll kf lm ln lo kj jf lp lq kn jj lr ls kr jn lt lu kv lv bi translated">在路由器设置中打开端口80和443</h2><p id="b308" class="pw-post-body-paragraph iu iv hx iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">我是维珍媒体的客户，所以我的路由器可以在本地网络的192.168.0.1上访问。检查您的路由器使用什么ip。如果是由您的ISP提供的，可以在他们的网站上找到这些信息。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mw"><img src="../Images/de2f1d9ad5ed74fab6c3c8264a45f129.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vqs9LZhasNqcRpErDRvyGQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Access your router settings (most common ip-s are 192.168.0.1 or 192.168.1.1)</figcaption></figure><blockquote class="mx my mz"><p id="8ef6" class="iu iv mk iw b ix iy iz ja jb jc jd je na jg jh ji nb jk jl jm nc jo jp jq jr hb bi translated">我们感兴趣的是<strong class="iw hy">港的货代</strong>。</p></blockquote><p id="c926" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当您在浏览器的地址栏中键入url时，您可以通过端口80或443访问域后面的服务器，而无需指定端口。(http为80，https为443)</p><p id="9046" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您尝试任何其他端口，服务器很可能根本没有响应。【http://thecaringdeveloper.com:412】这将挂起并最终超时:<a class="ae mq" href="http://thecaringdeveloper.com:412/" rel="noopener ugc nofollow" target="_blank"/></p><p id="7b77" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在您的浏览器中键入您自己的公共ip地址将试图访问您的路由器或调制解调器的80端口。这取决于设置会发生什么。默认情况下，不多。</p><p id="fc35" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当您的路由器被配置为将一个端口转发给在您机器上监听的任何设备时，奇迹就开始了。</p><p id="cd2a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们详细说明一下现阶段到底发生了什么:</p><ul class=""><li id="5205" class="lw lx hx iw b ix iy jb jc jf mt jj mu jn mv jr mb mc md me bi translated">一个请求从端口80传入</li><li id="f017" class="lw lx hx iw b ix mf jb mg jf mh jj mi jn mj jr mb mc md me bi translated">你的路由器说:好的，所以任何从端口80进来的东西都应该被转发到本地网络的端口80。</li><li id="d26b" class="lw lx hx iw b ix mf jb mg jf mh jj mi jn mj jr mb mc md me bi translated">有人在听吗？阿帕奇？Nginx？你们是来拿起电话回应的吗？好吧，那好吧。—&gt;错误</li></ul><h2 id="5aa0" class="li ka hx bd kb lj lk ll kf lm ln lo kj jf lp lq kn jj lr ls kr jn lt lu kv lv bi translated">让我们安装Apache(但在此之前，让我们安装homebrew)</h2><p id="5b88" class="pw-post-body-paragraph iu iv hx iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">由于我的机器是擦写的，没有用于任何其他用途(除了连接到投影仪和偶尔网飞)，它还没有完成这项工作所需的软件包。</p><p id="8591" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你在Mac上，你的软件包管理工具是<a class="ae mq" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">家酿</a>。</p><p id="e62a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这需要一段时间，完成后，我就可以安装Apache了。</p><p id="0293" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用此命令:</p><pre class="ld le lf lg fd nd ne nf ng aw nh bi"><span id="96d0" class="li ka hx ne b fi ni nj l nk nl">brew install httpd</span></pre><p id="84e2" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你可以阅读<a class="ae mq" href="https://tecadmin.net/install-apache-macos-homebrew/" rel="noopener ugc nofollow" target="_blank">这篇文章</a>来排除故障，如果你的系统有缺省的apache安装，就去激活它。</p><p id="76d8" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一旦它完成，你可以确认它正在工作，你可以通过在地址栏输入你的公共ip地址来测试它。你应该看到“它工作了！”(或除500错误之外的类似内容)</p><p id="446a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在还不是庆祝的时候，但是确实端口80正在被转发，Apache在另一端响应ok。半路上:)</p><h2 id="c47d" class="li ka hx bd kb lj lk ll kf lm ln lo kj jf lp lq kn jj lr ls kr jn lt lu kv lv bi translated">配置域DNS</h2><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nm"><img src="../Images/913290184520bc145e5604ec57d392a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6k0SIwVBvPk1AL2qgvPkRg.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Point your domain to your public ip</figcaption></figure><p id="e2d9" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您的公共ip是您的计算机在互联网上可以联系到的地方。它很像一个电话号码。为了使用户更容易理解，它可以被替换为人类可读的地址，如google.com。它会把你的电话转到合适的ip地址。</p><p id="919a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，在这种情况下，我的下一个逻辑步骤是购买域名。你可以在很多网站上购买域名。为了简单起见，我选择了<a class="ae mq" href="https://godaddy.com" rel="noopener ugc nofollow" target="_blank"> Godaddy </a>。</p><p id="c5f0" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一旦我的域名购买完成，我就把它所指向的ip地址改成了我的公共ip地址，这样当有人输入这个url时，它就会出现在我路由器的80端口上，并被转发给Apache进行响应。</p><p id="70af" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">DNS设置更新需要一些时间，所以这是我和家人一起喝咖啡吃早餐的绝佳机会。当我吃完烤面包和鸡蛋时，我可以看到“它起作用了！”在任何网络或设备上的浏览器中输入http://thecaringdeveloper.com时。</p><h2 id="6607" class="li ka hx bd kb lj lk ll kf lm ln lo kj jf lp lq kn jj lr ls kr jn lt lu kv lv bi translated">设置由Apache提供服务的站点</h2><p id="35f2" class="pw-post-body-paragraph iu iv hx iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">好的，到目前为止很容易，不是吗？事实上，在网上找到合适的机器花了我最大的努力。设计和编码很有趣，其他的就是安装软件和调整设置。:)</p><p id="4430" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Apache的工作方式是，您需要通过配置文件指定所有内容。</p><p id="10d1" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们现在感兴趣的是让它监听端口80(不安全的连接)并为它被告知的网站提供服务。</p><p id="ed02" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我不得不看的第一个文件是:<br/> <code class="du nn no np ne b">/private/etc/apache2/https-vhosts.conf</code>。这些文件的位置可能因您的系统和版本而异。</p><p id="c414" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">顾名思义，这个文件是vhosts(虚拟主机)的home，所以是时候添加一个了。</p><pre class="ld le lf lg fd nd ne nf ng aw nh bi"><span id="9fc9" class="li ka hx ne b fi ni nj l nk nl">&lt;VirtualHost *:80&gt;<br/>    ServerName thecaringdeveloper.com<br/>    ProxyPreserveHost On<br/>    ProxyRequests Off<br/>    ProxyPass / <a class="ae mq" href="http://localhost:8082/" rel="noopener ugc nofollow" target="_blank">http://localhost:8082/</a><br/>    ProxyPassReverse / <a class="ae mq" href="http://localhost:8082/" rel="noopener ugc nofollow" target="_blank">http://localhost:8082/</a><br/>    ErrorLog "/private/var/log/apache2/[YOUR SITE]-error_log"<br/>    CustomLog "/private/var/log/apache2/[YOUR SITE]-access_log" <br/>&lt;/VirtualHost&gt;</span></pre><p id="db1b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy">关于反向代理的说明</strong></p><p id="3a90" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因为我希望在同一台机器上托管其他网站(或者至少保持开放的可能性)，所以我需要一种方式让Apache知道不同的文件应该基于域提供服务。</p><p id="9580" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了解决这个问题，我们有反向代理。简单地说，它保留请求主机并将调用转发到您指定的任何端口上的本地主机。</p><p id="2659" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">由于这发生在内部，这个港口不需要对世界开放。</p><p id="c6e4" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此需要一些额外的配置，以便我的站点在本地主机的端口8082上提供服务。</p><p id="0f4b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为此，我创建了以下配置文件:</p><pre class="ld le lf lg fd nd ne nf ng aw nh bi"><span id="9bf7" class="li ka hx ne b fi ni nj l nk nl">$ /private/etc/apache2/extra/thecaringdeveloper.conf</span></pre><p id="3520" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要使用这个文件，我必须通过添加下面一行将它包含在<code class="du nn no np ne b">https.conf</code>文件中:</p><pre class="ld le lf lg fd nd ne nf ng aw nh bi"><span id="8715" class="li ka hx ne b fi ni nj l nk nl">Include /private/etc/apache2/extra/thecaringdeveloper.conf</span></pre><p id="5155" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">实际的配置包含了在浏览器中提供什么的细节。在我的例子中，它看起来像这样:</p><pre class="ld le lf lg fd nd ne nf ng aw nh bi"><span id="833f" class="li ka hx ne b fi ni nj l nk nl">Listen 8082<br/>&lt;VirtualHost *:8082&gt;<br/>    DocumentRoot "[YOUR SITE DIRECTORY]"</span><span id="27c8" class="li ka hx ne b fi nq nj l nk nl">    &lt;Directory [YOUR SITE DIRECTORY]&gt;<br/>      Options Indexes FollowSymLinks MultiViews<br/>      AllowOverride All<br/>      Require all granted<br/>    &lt;/Directory&gt;<br/>&lt;/VirtualHost&gt;</span></pre><p id="f139" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要观察变化，需要重新启动Apache。</p><p id="e37a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了确认我的配置工作正常，我尝试在本地机器的端口8082上访问站点。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nr"><img src="../Images/bc8a00ad54893884e4edabc2e9b9b8d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gSByHQIhMLFgW4cKoNVb7Q.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Once the files are on the server, having the virtual host in place, I could access the site locally on port 8082</figcaption></figure><p id="82ee" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">更好的是，有了指向我的ip地址的域名，我也可以访问这个域名上的站点了！</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ns"><img src="../Images/2e595c390dc5e528f5d460b9122b3370.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SAYkeOpUfgtk9VWyVZLcvw.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">It is available but not secure :(</figcaption></figure><h1 id="65df" class="jz ka hx bd kb kc ml ke kf kg mm ki kj kk mn km kn ko mo kq kr ks mp ku kv kw bi translated">获取SSL证书</h1><p id="9da7" class="pw-post-body-paragraph iu iv hx iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">正如你所看到的，这个网站有一个问题:缺少挂锁或缺少锁或缺少锁…好吧好吧，这是一个笑话滑坡，所以让我们就此打住。:)</p><h2 id="33ae" class="li ka hx bd kb lj lk ll kf lm ln lo kj jf lp lq kn jj lr ls kr jn lt lu kv lv bi translated">生成CSR</h2><pre class="ld le lf lg fd nd ne nf ng aw nh bi"><span id="d03f" class="li ka hx ne b fi ni nj l nk nl">openssl req -newkey rsa:2048 -keyout thecaringdeveloper.key -out thecaringdeveloper.csr</span></pre><p id="5c8d" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我已经使用上面的命令生成了一个证书签名请求(CSR)和一个密钥文件。它会问几个问题。你应该准确回答。</p><p id="c45a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果一切顺利，它将在您的系统中以指定的名称保存一个新文件。</p><h2 id="013a" class="li ka hx bd kb lj lk ll kf lm ln lo kj jf lp lq kn jj lr ls kr jn lt lu kv lv bi translated">购买SSL证书</h2><p id="bad6" class="pw-post-body-paragraph iu iv hx iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">在我的情况下，我永远不会通过我的小册子网站处理付款，所以我感兴趣的是挂锁。因此我选择了最便宜最简单的方案，在我看来就是<a class="ae mq" href="https://www.gogetssl.com/" rel="noopener ugc nofollow" target="_blank"> GoGetSSL </a>。</p><p id="927f" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一旦您完成了购买证书的步骤，将要求您通过输入CSR来完成您的证书。</p><p id="8b31" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">将您在上一步中创建的<code class="du nn no np ne b">.csr</code>文件的内容复制到适当的框中。</p><p id="03a7" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后需要验证证书。有几个选项可以做到这一点。我选择了http，因为我知道该网站通过http工作，我可以很容易地复制文件夹中的文件。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nt"><img src="../Images/0e60338519cd41426c4730457771b34c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J98mv9VHXDGq8sGT5jOzbg.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">The http validation is simply checking that a file they give you can be accessed on the server.</figcaption></figure><p id="9ca5" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在我的例子中，这就是验证的样子。对你来说可能不一样。</p><p id="f481" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">验证成功后，我收到了一封电子邮件，所以我准备安装证书。</p><p id="8d26" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">完成该任务需要3个文件:</p><ul class=""><li id="605b" class="lw lx hx iw b ix iy jb jc jf mt jj mu jn mv jr mb mc md me bi translated">密钥文件</li><li id="f74a" class="lw lx hx iw b ix mf jb mg jf mh jj mi jn mj jr mb mc md me bi translated">证书</li><li id="47a8" class="lw lx hx iw b ix mf jb mg jf mh jj mi jn mj jr mb mc md me bi translated">CA包文件</li></ul><p id="00b0" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这个密钥文件是在CSR的同时生成的，所以你可以在它旁边找到它。它的扩展名是<code class="du nn no np ne b">.key</code>。另外两个在邮件里。</p><h1 id="08be" class="jz ka hx bd kb kc ml ke kf kg mm ki kj kk mn km kn ko mo kq kr ks mp ku kv kw bi translated">正在为站点安装SSL证书</h1><p id="3318" class="pw-post-body-paragraph iu iv hx iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">我已经创建了3个空文件来开始。地点完全由你决定。我喜欢把它们保存在我的项目文件夹中。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nu"><img src="../Images/1c960ac5f56f64f83b08e18ad9068811.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KpTHvlhS_r54QY0-5CDSVQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">The files I needed to install the certificate.</figcaption></figure><p id="67c3" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在下一步中，我从适当的文件中复制了内容。</p><h2 id="8086" class="li ka hx bd kb lj lk ll kf lm ln lo kj jf lp lq kn jj lr ls kr jn lt lu kv lv bi translated">SSL Apache配置</h2><p id="333b" class="pw-post-body-paragraph iu iv hx iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">到目前为止，我的网站在http上服务得很好，所以我对端口80的配置肯定是有效的。</p><p id="0976" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在需要的是另一个配置，它可以做基本相同的事情，但是也使用Apache的SSL引擎和我的证书文件。</p><p id="2560" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以我在<code class="du nn no np ne b">/etc/apache2/extra</code>文件夹中添加了一个名为<code class="du nn no np ne b">httpd-ssl.conf</code>的新虚拟主机。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div class="er es nv"><img src="../Images/bd66fad98e56a2f2ba4dfa45ff377ff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*U870qSx5Y2wQQw48UwVb_A.jpeg"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">There are predefined config files for a range of use cases. You can also create your own ones.</figcaption></figure><p id="87f4" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我的配置文件如下所示:</p><pre class="ld le lf lg fd nd ne nf ng aw nh bi"><span id="8ae1" class="li ka hx ne b fi ni nj l nk nl">&lt;VirtualHost *:443&gt;<br/>ServerName <a class="ae mq" href="https://portal.thecaringdeveloper.com" rel="noopener ugc nofollow" target="_blank">https://thecaringdeveloper.com</a><br/>DocumentRoot "[LOCATION OF THE WEBSITE]"</span><span id="44d6" class="li ka hx ne b fi nq nj l nk nl">&lt;Proxy *&gt;<br/>  Order deny,allow<br/>  Allow from all<br/>&lt;/Proxy&gt;</span><span id="e5a8" class="li ka hx ne b fi nq nj l nk nl">SSLEngine on<br/>SSLProxyEngine On<br/>ProxyPreserveHost On<br/>SSLProxyVerify none<br/>ProxyRequests Off</span><span id="67e8" class="li ka hx ne b fi nq nj l nk nl">SSLCertificateFile [PATH TO THE CERTIFICATE FILE]<br/>SSLCertificateKeyFile  [PATH TO THE CERTIFICATE KEY FILE]<br/>SSLCertificateChainFile [PATH TO THE CA BUNDLE FILE]</span><span id="e79f" class="li ka hx ne b fi nq nj l nk nl">ProxyPass / <a class="ae mq" href="http://localhost:8083/" rel="noopener ugc nofollow" target="_blank">http://localhost:8082/</a><br/>ProxyPassReverse / <a class="ae mq" href="http://localhost:8083/" rel="noopener ugc nofollow" target="_blank">http://localhost:8082/</a><br/>RequestHeader set X-Forwarded-Proto "https"<br/>RequestHeader set X-Forwarded-Port "443"</span><span id="936c" class="li ka hx ne b fi nq nj l nk nl">ErrorLog "/private/var/log/apache2/thecaringdeveloper-ssl-error_log"<br/>CustomLog "/private/var/log/apache2/thecaringdeveloper-ssl-access_log" common</span><span id="5c89" class="li ka hx ne b fi nq nj l nk nl">&lt;Directory [LOCATION OF THE WEBSITE]&gt;<br/>  Options Indexes FollowSymLinks MultiViews<br/>  AllowOverride All<br/>  Require all granted<br/>&lt;/Directory&gt;</span></pre><p id="f504" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">重启Apache后，我可以通过https观察站点加载了！耶，庆祝的时间到了吗？嗯差不多，但是没有:)</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nw"><img src="../Images/68f8fadd6f64e0181dbfc02b0ccb8615.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CBbKCj_0ldZxXvQ1r56NZg.png"/></div></div></figure><h1 id="5dce" class="jz ka hx bd kb kc ml ke kf kg mm ki kj kk mn km kn ko mo kq kr ks mp ku kv kw bi translated">优化</h1><p id="66f7" class="pw-post-body-paragraph iu iv hx iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">该网站实际上也是通过http和https加载的。我认为这不是很专业，所以让我们确保它总是通过https加载，这样就不会向用户显示“不安全”。</p><p id="522f" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy">不可编辑。htaccess！</strong></p><p id="3ca9" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我犯了一个错误，在做适当的研究之前就进入了这一点，所以我希望在这里可以节省你一些时间。</p><p id="3b7b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您试图在您的。htaccess文件，它将导致重定向循环。为什么？因为在我的例子中，站点请求被内部重定向到<a class="ae mq" href="http://localhost:8082" rel="noopener ugc nofollow" target="_blank"> http://localhost:8082 </a>。注意这里的<strong class="iw hy"> http </strong>。ssl证书适用于特定的域，因此不能安装到本地主机。的。htaccess是在命中目录中的实际文件时触发的，所以它会尝试重定向到<a class="ae mq" href="https://localhost:8082" rel="noopener ugc nofollow" target="_blank"> https://localhost:8082 </a>而失败。(我不能100%确定这就是发生的事情，如果我错了，请纠正我。这是我通过症状和日志了解到的。如果失败的方式有所不同，那也没什么区别，因为失败就是失败。)</p><p id="1e6b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，解决方案是在<code class="du nn no np ne b">httpd.conf</code>文件中添加到虚拟主机的重定向，因为它是第一个联系点。一旦Apache收到请求，它就应该知道需要重定向到https。</p><p id="469c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在<code class="du nn no np ne b">DocumentRoot</code>之后添加的额外行:</p><pre class="ld le lf lg fd nd ne nf ng aw nh bi"><span id="a0a5" class="li ka hx ne b fi ni nj l nk nl">RewriteEngine On<br/>RewriteCond %{SERVER_PORT} !443<br/>RewriteRule ^/(.*) https://%{HTTP_HOST}/$1 [R=301,L]</span></pre><p id="33ac" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你也可以删除它后面的内容，但我建议不要这样做。如果您出于某种原因需要临时再次通过http服务站点(最常见的是一个新的证书需要通过http进行验证)，您只需将这3行注释掉就可以了。</p><h1 id="920d" class="jz ka hx bd kb kc ml ke kf kg mm ki kj kk mn km kn ko mo kq kr ks mp ku kv kw bi translated">结论</h1><p id="d75f" class="pw-post-body-paragraph iu iv hx iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">这就对了。你拿到了！这就是如何在一台旧的Mac Mini上用SSL证书建立一个简单的宣传册网站。</p><p id="b6a9" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要在linux机器或raspberry pi(！)差不太多。试试看！我真的很满意这个设置，因为我可以添加更多的网站，我想，以及机器本身是安静的，并融入室内的其余部分。</p><p id="da1c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您有任何问题，请随时联系hello@thecaringdeveloper.com</p><p id="a1dc" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">祝您愉快，并与您自己的家庭网络服务器玩得开心！</p></div></div>    
</body>
</html>