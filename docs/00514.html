<html>
<head>
<title>Migrate Travis CI to GitHub Actions for Ruby</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Travis CI迁移到GitHub Actions for Ruby</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/migrate-travis-ci-to-github-actions-for-ruby-9c2601778a4f?source=collection_archive---------7-----------------------#2021-02-23">https://medium.com/geekculture/migrate-travis-ci-to-github-actions-for-ruby-9c2601778a4f?source=collection_archive---------7-----------------------#2021-02-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/5bfd67b89692778532ca0e2bc5ebb040.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*ZlggGUpmAk_1kbu9yVF6Aw.png"/></div><figcaption class="im in et er es io ip bd b be z dx"><a class="ae iq" href="https://b.remarkabl.org/github-actions" rel="noopener ugc nofollow" target="_blank">GitHub Actions</a> + <a class="ae iq" href="https://b.remarkabl.org/ruby" rel="noopener ugc nofollow" target="_blank">Ruby</a></figcaption></figure><p id="5659" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">这篇文章讲述了如何为GitHub 上的<a class="ae iq" href="https://b.remarkabl.org/ruby" rel="noopener ugc nofollow" target="_blank"> Ruby </a>项目从<a class="ae iq" href="https://b.remarkabl.org/travis-ci" rel="noopener ugc nofollow" target="_blank"> Travis CI </a>迁移到<a class="ae iq" href="https://b.remarkabl.org/github-actions" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>。</p><p id="334b" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">观看<a class="ae iq" href="https://youtu.be/QE9mk9Ww7oM?list=PLVgOtoUBG2mdLpj6qT5DXfg5_pGPTDrJZ" rel="noopener ugc nofollow" target="_blank"> YouTube视频</a>:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="jt ju l"/></div></figure><h1 id="474b" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">特拉维斯·CI</h1><p id="6202" class="pw-post-body-paragraph ir is hi it b iu kt iw ix iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo hb bi translated">鉴于<code class="du ky kz la lb b">.travis.yml</code>:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lc ju l"/></div></figure><h1 id="9388" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">GitHub操作</h1><p id="db07" class="pw-post-body-paragraph ir is hi it b iu kt iw ix iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo hb bi translated">首先制作目录<code class="du ky kz la lb b">.github/workflows/</code>:</p><pre class="jp jq jr js fd ld lb le lf aw lg bi"><span id="1d7f" class="lh jw hi lb b fi li lj l lk ll">mkdir -p .github/workflows/</span></pre><p id="8b30" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">创造<code class="du ky kz la lb b">.github/workflows/build.yml</code>:</p><pre class="jp jq jr js fd ld lb le lf aw lg bi"><span id="619d" class="lh jw hi lb b fi li lj l lk ll">touch .github/workflows/build.yml</span></pre><p id="57e5" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">添加运行单个作业的工作流:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lc ju l"/></div></figure><p id="612f" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">要测试多个版本的Ruby，请更新工作流程:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lc ju l"/></div></figure><p id="e695" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">Ruby工作流程的灵感来自于<a class="ae iq" href="https://github.com/actions/starter-workflows/blob/master/ci/ruby.yml" rel="noopener ugc nofollow" target="_blank">模板</a>。</p><h1 id="e69f" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">工作流程</h1><p id="ecca" class="pw-post-body-paragraph ir is hi it b iu kt iw ix iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo hb bi translated">下面是每个YAML场的作用分析。</p><h2 id="5162" class="lh jw hi bd jx lm ln lo kb lp lq lr kf jc ls lt kj jg lu lv kn jk lw lx kr ly bi translated">名字</h2><p id="6bd2" class="pw-post-body-paragraph ir is hi it b iu kt iw ix iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo hb bi translated"><code class="du ky kz la lb b"><a class="ae iq" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#name" rel="noopener ugc nofollow" target="_blank">name</a></code>是工作流名称。这是可选的，您可以随意命名:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lc ju l"/></div></figure><h2 id="c017" class="lh jw hi bd jx lm ln lo kb lp lq lr kf jc ls lt kj jg lu lv kn jk lw lx kr ly bi translated">在</h2><p id="48a2" class="pw-post-body-paragraph ir is hi it b iu kt iw ix iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo hb bi translated"><code class="du ky kz la lb b"><a class="ae iq" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#on" rel="noopener ugc nofollow" target="_blank">on</a></code>是触发工作流的事件。在我们的例子中，git <code class="du ky kz la lb b">push</code>触发了我们的工作流。</p><p id="a5fc" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">添加<code class="du ky kz la lb b">pull_request</code>事件:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lc ju l"/></div></figure><p id="b3b9" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">这和:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lc ju l"/></div></figure><h2 id="6242" class="lh jw hi bd jx lm ln lo kb lp lq lr kf jc ls lt kj jg lu lv kn jk lw lx kr ly bi translated">工作</h2><p id="d209" class="pw-post-body-paragraph ir is hi it b iu kt iw ix iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo hb bi translated"><code class="du ky kz la lb b"><a class="ae iq" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobs" rel="noopener ugc nofollow" target="_blank">jobs</a></code>是工作流运行的作业。在我们的示例中，我们有一个名为<code class="du ky kz la lb b">build</code>的作业:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lc ju l"/></div></figure><h2 id="c9a1" class="lh jw hi bd jx lm ln lo kb lp lq lr kf jc ls lt kj jg lu lv kn jk lw lx kr ly bi translated">连续运行</h2><p id="8b6e" class="pw-post-body-paragraph ir is hi it b iu kt iw ix iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo hb bi translated"><code class="du ky kz la lb b"><a class="ae iq" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobsjob_idruns-on" rel="noopener ugc nofollow" target="_blank">runs-on</a></code>是工作流运行的环境。要指定操作系统版本:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lc ju l"/></div></figure><h2 id="3660" class="lh jw hi bd jx lm ln lo kb lp lq lr kf jc ls lt kj jg lu lv kn jk lw lx kr ly bi translated">战略矩阵</h2><p id="d726" class="pw-post-body-paragraph ir is hi it b iu kt iw ix iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo hb bi translated"><code class="du ky kz la lb b"><a class="ae iq" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstrategymatrix" rel="noopener ugc nofollow" target="_blank">strategy.matrix</a></code>是构建矩阵。在我们的例子中，我们为一个单一的ruby版本运行一个作业。要为多个ruby版本定义作业:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lc ju l"/></div></figure><h2 id="9ef7" class="lh jw hi bd jx lm ln lo kb lp lq lr kf jc ls lt kj jg lu lv kn jk lw lx kr ly bi translated">步伐</h2><p id="d3d5" class="pw-post-body-paragraph ir is hi it b iu kt iw ix iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo hb bi translated"><code class="du ky kz la lb b"><a class="ae iq" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobsjob_idsteps" rel="noopener ugc nofollow" target="_blank">steps</a></code>是一项工作的任务。在我们的例子中，我们使用GitHub动作:</p><ul class=""><li id="14c9" class="lz ma hi it b iu iv iy iz jc mb jg mc jk md jo me mf mg mh bi translated"><a class="ae iq" href="https://github.com/marketplace/actions/checkout" rel="noopener ugc nofollow" target="_blank">结账</a></li><li id="a39c" class="lz ma hi it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh bi translated"><a class="ae iq" href="https://github.com/marketplace/actions/setup-ruby-jruby-and-truffleruby" rel="noopener ugc nofollow" target="_blank">设置Ruby </a></li></ul><p id="25bc" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><code class="du ky kz la lb b">actions/checkout</code>签出存储库，<code class="du ky kz la lb b">ruby/setup-ruby</code>设置Ruby环境:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lc ju l"/></div></figure><h2 id="0af5" class="lh jw hi bd jx lm ln lo kb lp lq lr kf jc ls lt kj jg lu lv kn jk lw lx kr ly bi translated">步骤.运行</h2><p id="999e" class="pw-post-body-paragraph ir is hi it b iu kt iw ix iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo hb bi translated"><code class="du ky kz la lb b"><a class="ae iq" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstepsrun" rel="noopener ugc nofollow" target="_blank">steps.run</a></code>运行命令。由于<a class="ae iq" href="https://github.com/ruby/setup-ruby" rel="noopener ugc nofollow" target="_blank"> setup-ruby </a>安装了<a class="ae iq" href="https://bundler.io/" rel="noopener ugc nofollow" target="_blank"> bundler </a>，它可以用来执行命令:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lc ju l"/></div></figure><h2 id="bf24" class="lh jw hi bd jx lm ln lo kb lp lq lr kf jc ls lt kj jg lu lv kn jk lw lx kr ly bi translated">包封/包围（动词envelop的简写）</h2><p id="5506" class="pw-post-body-paragraph ir is hi it b iu kt iw ix iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo hb bi translated"><code class="du ky kz la lb b"><a class="ae iq" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobsjob_idenv" rel="noopener ugc nofollow" target="_blank">env</a></code>为整个工作流程或单个步骤设置环境变量。参见<code class="du ky kz la lb b"><a class="ae iq" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#env" rel="noopener ugc nofollow" target="_blank">env</a></code>和<code class="du ky kz la lb b"><a class="ae iq" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstepsenv" rel="noopener ugc nofollow" target="_blank">jobs.&lt;job_id&gt;.steps.env</a></code>。</p><p id="370a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">虽然<a class="ae iq" href="https://docs.travis-ci.com/user/environment-variables/#default-environment-variables" rel="noopener ugc nofollow" target="_blank"> Travis CI设置了默认的环境变量</a>，但是我们不必为我们的工作设置<code class="du ky kz la lb b">CI=true</code>，因为<code class="du ky kz la lb b">actions/checkout@v2</code>已经为我们做了:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="lc ju l"/></div></figure><h1 id="cda8" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">资源</h1><ul class=""><li id="4624" class="lz ma hi it b iu kt iy ku jc mn jg mo jk mp jo me mf mg mh bi translated"><a class="ae iq" href="https://docs.github.com/en/free-pro-team@latest/actions/learn-github-actions/migrating-from-travis-ci-to-github-actions" rel="noopener ugc nofollow" target="_blank">从Travis CI迁移到GitHub动作</a></li><li id="16dd" class="lz ma hi it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh bi translated"><a class="ae iq" href="https://docs.github.com/en/actions/guides/building-and-testing-ruby" rel="noopener ugc nofollow" target="_blank">构建和测试Ruby </a></li><li id="d068" class="lz ma hi it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh bi translated"><a class="ae iq" href="https://github.com/remarkablegames/remarkablegames.github.io/pull/2" rel="noopener ugc nofollow" target="_blank">拉式请求(PR)示例</a></li></ul></div><div class="ab cl mq mr gp ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hb hc hd he hf"><p id="107e" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><a class="ae iq" href="https://b.remarkabl.org/2NIuc5s" rel="noopener ugc nofollow" target="_blank"> <em class="mx">本文原载于2021年2月20日《remarkablemark.org》。</em>T9】</a></p></div></div>    
</body>
</html>