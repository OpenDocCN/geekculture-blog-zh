<html>
<head>
<title>Security Analysis of Docker Containers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">码头集装箱的安全性分析</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/security-analysis-of-docker-containers-a686cebf6405?source=collection_archive---------13-----------------------#2021-04-08">https://medium.com/geekculture/security-analysis-of-docker-containers-a686cebf6405?source=collection_archive---------13-----------------------#2021-04-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="1da2" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">Docker安全挑战和最佳实践。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/4fd6d9e958154e8665239fd92092e266.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E0ZU6farUk54xDLMnnGULA.png"/></div></div></figure><p id="fc65" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">Docker被广泛接受，超过25%的公司已经采用了Docker。到2024年，Docker的市场规模预计将增长9.93亿美元。尽管如此，Docker面临着许多已知的安全威胁，本文将揭示一些众所周知的、常见的和可避免的安全威胁及其可能的解决方案。</p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="24fe" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在继续学习之前，您应该熟悉容器化技术、Docker容器、其框架以及Docker中现有的安全机制。</p><div class="kn ko ez fb kp kq"><a href="https://mayankpatel99.medium.com/understanding-the-docker-containers-d5ee422bfd9d" rel="noopener follow" target="_blank"><div class="kr ab dw"><div class="ks ab kt cl cj ku"><h2 class="bd hj fi z dy kv ea eb kw ed ef hh bi translated">了解Docker容器。</h2><div class="kx l"><h3 class="bd b fi z dy kv ea eb kw ed ef dx translated">深入了解Docker容器的框架和工作方式。</h3></div><div class="ky l"><p class="bd b fp z dy kv ea eb kw ed ef dx translated">mayankpatel99.medium.com</p></div></div><div class="kz l"><div class="la l lb lc ld kz le jh kq"/></div></div></a></div><p id="c4d7" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><em class="km">先决条件包含在上述文章</em>中😄<em class="km">，我强烈推荐你先阅读一下，以便正确理解。</em></p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><p id="9548" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">尽管Docker容器提供了比其他虚拟化技术更高的效率和更高的可伸缩性，但它仍然是一种不成熟的技术，正在寻找解决其缺陷的方法。</p><h1 id="c7ac" class="lf lg hi bd lh li lj lk ll lm ln lo lp io lq ip lr ir ls is lt iu lu iv lv lw bi translated">1.易受攻击的Docker图像</h1><p id="427c" class="pw-post-body-paragraph jj jk hi jl b jm lx ij jo jp ly im jr js lz ju jv jw ma jy jz ka mb kc kd ke hb bi translated">Docker有3个独立工作的模块，但在协作中，这些模块中的暴露会直接影响Docker容器甚至主机的安全性。这些曝光的主要来源是上传到<a class="ae mc" href="https://hub.docker.com" rel="noopener ugc nofollow" target="_blank"> Docker hub </a>储存库的图像。大多数docker映像都带有预安装的应用程序，这些应用程序可能没有正确配置，从而在系统中留下漏洞，可被利用来发起对Docker容器或主机本身的攻击，从而导致劫持主机本身的重大数据泄漏。</p><h1 id="7333" class="lf lg hi bd lh li lj lk ll lm ln lo lp io lq ip lr ir ls is lt iu lu iv lv lw bi translated">2.恶意Docker图像</h1><p id="a4ce" class="pw-post-body-paragraph jj jk hi jl b jm lx ij jo jp ly im jr js lz ju jv jw ma jy jz ka mb kc kd ke hb bi translated">Docker Image developer可能会使用加密货币挖掘程序或特洛伊木马、后门程序、web shell、勒索软件等病毒程序故意将恶意图像上传到Docker Hub。运行这些容器会自动触发这些程序，你甚至不会注意到它们的存在。一个加密货币矿工可能会继续在你的容器的后台工作，吃掉所有的系统资源，如CPU周期和带宽，攻击者最终会因为你而赚很多钱😢。</p><div class="kn ko ez fb kp kq"><a href="https://threatpost.com/malicious-docker-cryptomining-images/165120/" rel="noopener  ugc nofollow" target="_blank"><div class="kr ab dw"><div class="ks ab kt cl cj ku"><h2 class="bd hj fi z dy kv ea eb kw ed ef hh bi translated">恶意Docker密码挖掘图片的下载量高达2000万次</h2><div class="kx l"><h3 class="bd b fi z dy kv ea eb kw ed ef dx translated">公开的云图像正在向不知情的云开发者传播恶意软件。至少30…</h3></div><div class="ky l"><p class="bd b fp z dy kv ea eb kw ed ef dx translated">threatpost.com</p></div></div><div class="kz l"><div class="md l lb lc ld kz le jh kq"/></div></div></a></div><h1 id="e37b" class="lf lg hi bd lh li lj lk ll lm ln lo lp io lq ip lr ir ls is lt iu lu iv lv lw bi translated">3.集装箱逃逸攻击</h1><p id="e9ac" class="pw-post-body-paragraph jj jk hi jl b jm lx ij jo jp ly im jr js lz ju jv jw ma jy jz ka mb kc kd ke hb bi translated">docker容器使用内核共享来降低虚拟化的性能成本。利用映像中存在的一些暴露，在容器中运行的进程可以逃逸到主机计算机系统，实现权限提升。这被称为'<em class="km">逃逸攻击'，</em>以根用户权限运行容器会助长这种攻击。一旦该进程以根用户权限逃到主机，它就可以控制整个文件系统，从而关闭主机或泄露所有有价值的信息。</p><h1 id="857f" class="lf lg hi bd lh li lj lk ll lm ln lo lp io lq ip lr ir ls is lt iu lu iv lv lw bi translated">4.敏感信息泄露</h1><p id="c6a7" class="pw-post-body-paragraph jj jk hi jl b jm lx ij jo jp ly im jr js lz ju jv jw ma jy jz ka mb kc kd ke hb bi translated">敏感信息泄漏对于Docker容器来说是一个非常严重的问题，如果身份验证API或数据库密码以某种方式从容器中泄漏，那么它将影响整个系统。在有些情况下，不必要的凭证会留在映像中，这些凭证对于容器的工作是不需要的，但是用于构建映像。</p><h1 id="d050" class="lf lg hi bd lh li lj lk ll lm ln lo lp io lq ip lr ir ls is lt iu lu iv lv lw bi translated">5.网络模式安全性</h1><p id="a864" class="pw-post-body-paragraph jj jk hi jl b jm lx ij jo jp ly im jr js lz ju jv jw ma jy jz ka mb kc kd ke hb bi translated">Docker有4种网络模式——无、主机、容器和网桥。</p><p id="f763" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">无:</strong>在无模式下，Docker容器有自己独立的网络名称空间，并且没有指定任何网络设置。</p><p id="f28b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">主机:</strong>在主机模式下，容器和主机共享网络名称空间，使用相同的IP和端口。容器具有修改主机计算机的网络堆栈信息的特权，因此通信不需要NAT。但是，不知不觉中，我们可能最终允许一个不可信的容器恶意修改网络堆栈信息。</p><p id="8829" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">容器模式:</strong>在容器模式下，容器可以被分配给其他容器的特定网络名称空间。但是，当名称空间被共享时，不可信容器对网络堆栈的修改仍然存在。</p><p id="cb55" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl hj">桥接模式:</strong>在桥接模式下，Docker容器使用主机的端口进行通信，这是常用的做法。在主机上建立一个虚拟网络，完成不同网络接口之间的包转发。在默认设置中，虚拟网桥不会检查或过滤转发的数据包，因此ARP欺骗或MAC泛洪攻击很容易成功。</p><blockquote class="me mf mg"><p id="d081" class="jj jk km jl b jm jn ij jo jp jq im jr mh jt ju jv mi jx jy jz mj kb kc kd ke hb bi translated">如果部署的映像是恶意的，那么它可能会为攻击者打开一个端口来发起对容器的攻击，或者可能会耗尽带宽并泄漏敏感信息，限制不可信或恶意已知的域和IP地址与我们的容器进行通信是很重要的。</p></blockquote></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="12bd" class="lf lg hi bd lh li mk lk ll lm ml lo lp io mm ip lr ir mn is lt iu mo iv lv lw bi translated">解决方案和良好做法😺！！</h1><p id="c070" class="pw-post-body-paragraph jj jk hi jl b jm lx ij jo jp ly im jr js lz ju jv jw ma jy jz ka mb kc kd ke hb bi translated">作为一项不成熟的技术，它包含一些需要克服的问题，以充分发挥docker技术的潜力。因此，要解决这个问题，需要遵循一些最佳实践，还需要一些外部应用和服务来提高集装箱的安全性。</p><ul class=""><li id="d868" class="mp mq hi jl b jm jn jp jq js mr jw ms ka mt ke mu mv mw mx bi translated">总是尝试去寻找官方的DOCKER图片，官方图片是由技术维护者或开发者自己发布的经过验证的图片。</li><li id="3f84" class="mp mq hi jl b jm my jp mz js na jw nb ka nc ke mu mv mw mx bi translated">Docker甚至有一个“可信内容”功能，可以让你只下载签名图像。这不能保证100%的安全性，但有了这一层额外的安全保障还是有好处的。</li><li id="0d01" class="mp mq hi jl b jm my jp mz js na jw nb ka nc ke mu mv mw mx bi translated">切勿在具有root权限的系统上部署容器，始终为容器分配其运行所需的最低权限。通过运行container，您可以创建一个具有最低权限的非root用户来执行分配的任务。这将减少<strong class="jl hj">集装箱逃脱</strong>袭击的几率【3】。</li><li id="79a1" class="mp mq hi jl b jm my jp mz js na jw nb ka nc ke mu mv mw mx bi translated">避免<strong class="jl hj">将敏感信息</strong>【4】泄露到Docker映像本身，有时需要SSH密钥来提取代码或启动创建映像本身所需的一些中间过程，这些凭证对于最终开发的映像本身是不必要的。但是可能发生的情况是，这些凭证仍然隐藏在图像中的某个地方，并且可能被利用。必须使用<a class="ae mc" href="https://docs.docker.com/develop/develop-images/multistage-build/" rel="noopener ugc nofollow" target="_blank"> <strong class="jl hj">多阶段</strong> </a>构建，而不是直接在Dockerfile中添加。通过利用Docker对多阶段构建的支持，可以在中间映像层管理这些凭证，并在以后处理时不留痕迹。还要声明<code class="du nd ne nf ng b">.dockerignore</code>中的所有敏感文件忽略它们。</li><li id="352b" class="mp mq hi jl b jm my jp mz js na jw nb ka nc ke mu mv mw mx bi translated">必须在docker容器中正确管理秘密，以避免敏感数据泄露。T12】</li></ul><blockquote class="me mf mg"><p id="2614" class="jj jk km jl b jm jn ij jo jp jq im jr mh jt ju jv mi jx jy jz mj kb kc kd ke hb bi translated">参见<strong class="jl hj"> </strong> <a class="ae mc" href="https://docs.docker.com/engine/swarm/secrets/" rel="noopener ugc nofollow" target="_blank">这份</a>官方文件，了解处理机密的最佳做法。</p></blockquote><ul class=""><li id="3334" class="mp mq hi jl b jm jn jp jq js mr jw ms ka mt ke mu mv mw mx bi translated">使用对系统构成严重威胁的<strong class="jl hj">易受攻击的docker映像</strong> [1]可以通过了解Docker映像中的潜在暴露来避免<a class="ae mc" href="https://cve.mitre.org/cve/" rel="noopener ugc nofollow" target="_blank">可以使用CVE(常见漏洞和暴露)</a>数据库。这是一个非常著名的、定期更新的数据库，包含广为人知的风险敞口，具有唯一的ID和详细的描述。</li></ul><blockquote class="me mf mg"><p id="8ec7" class="jj jk km jl b jm jn ij jo jp jq im jr mh jt ju jv mi jx jy jz mj kb kc kd ke hb bi translated">参考<a class="ae mc" href="https://docs.docker.com/engine/scan/" rel="noopener ugc nofollow" target="_blank">这份</a>官方文件对你的图像进行漏洞扫描。</p></blockquote><ul class=""><li id="fea4" class="mp mq hi jl b jm jn jp jq js mr jw ms ka mt ke mu mv mw mx bi translated">部署前检查<strong class="jl hj">恶意Docker映像</strong>【2】通过扫描映像查找恶意文件或程序，<a class="ae mc" href="https://www.clamav.net/" rel="noopener ugc nofollow" target="_blank"> <strong class="jl hj"> ClamAV恶意库</strong> </a> <strong class="jl hj"> </strong>它是最受欢迎的恶意数据库之一，及时更新，超过600万种恶意文件可用于扫描您的映像。</li><li id="6f55" class="mp mq hi jl b jm my jp mz js na jw nb ka nc ke mu mv mw mx bi translated">监控您的网络活动，查看来自恶意IP地址或域的呼叫，以防止<strong class="jl hj">网络相关攻击</strong>【5】。如果域名或IP地址，容器将通信是已知的，然后您可以设置防火墙服务，这将阻止所有其他领域的容器。</li></ul><blockquote class="me mf mg"><p id="e74b" class="jj jk km jl b jm jn ij jo jp jq im jr mh jt ju jv mi jx jy jz mj kb kc kd ke hb bi translated"><em class="hi">参照</em> <a class="ae mc" href="https://docs.docker.com/network/iptables/" rel="noopener ugc nofollow" target="_blank"> <em class="hi">本</em> </a> <em class="hi">正式文件执行IP表。</em></p></blockquote><ul class=""><li id="f1dd" class="mp mq hi jl b jm jn jp jq js mr jw ms ka mt ke mu mv mw mx bi translated">监控每个已部署容器的资源使用情况，如果有任何容器正在利用所提供的资源，则必须关闭该容器，否则将导致<strong class="jl hj"> DoS(拒绝服务)攻击</strong>。利用cgroups可以有效控制DoS攻击。</li></ul><blockquote class="me mf mg"><p id="6166" class="jj jk km jl b jm jn ij jo jp jq im jr mh jt ju jv mi jx jy jz mj kb kc kd ke hb bi translated">参考<a class="ae mc" href="https://docs.docker.com/config/containers/resource_constraints/" rel="noopener ugc nofollow" target="_blank">本</a>正式文件实施资源约束。</p></blockquote><h2 id="baf6" class="nh lg hi bd lh ni nj nk ll nl nm nn lp js no np lr jw nq nr lt ka ns nt lv nu bi translated">DoS是什么？</h2><blockquote class="me mf mg"><p id="b0cf" class="jj jk km jl b jm jn ij jo jp jq im jr mh jt ju jv mi jx jy jz mj kb kc kd ke hb bi translated">拒绝服务(<em class="hi"> DoS </em> ) <em class="hi">攻击</em>意在关闭机器或网络，使其目标用户无法访问。有多种方式使带宽被多个系统淹没，从而使真正的用户受苦，或者通过消耗大量系统资源使系统窒息并自行关闭。</p></blockquote></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="acc7" class="lf lg hi bd lh li mk lk ll lm ml lo lp io mm ip lr ir mn is lt iu mo iv lv lw bi translated">结论</h1><p id="9366" class="pw-post-body-paragraph jj jk hi jl b jm lx ij jo jp ly im jr js lz ju jv jw ma jy jz ka mb kc kd ke hb bi translated">这些是docker容器最常见的威胁，也有许多方法可以用来检测威胁。同样，检测到的威胁也可以通过多种方式解决。</p><h2 id="9595" class="nh lg hi bd lh ni nj nk ll nl nm nn lp js no np lr jw nq nr lt ka ns nt lv nu bi translated">留下掌声👏，关注更多🔥不断学习🤓</h2></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="4f74" class="lf lg hi bd lh li mk lk ll lm ml lo lp io mm ip lr ir mn is lt iu mo iv lv lw bi translated">参考资料:</h1><ul class=""><li id="7640" class="mp mq hi jl b jm lx jp ly js nv jw nw ka nx ke mu mv mw mx bi translated">Docker上关于安全分析和威胁检测技术的技术论文—<a class="ae mc" href="https://ieeexplore.ieee.org/document/9064441" rel="noopener ugc nofollow" target="_blank">https://ieeexplore.ieee.org/document/9064441</a></li><li id="5ebe" class="mp mq hi jl b jm my jp mz js na jw nb ka nc ke mu mv mw mx bi translated"><em class="km"> Docker官方安全页面—</em><a class="ae mc" href="https://docs.docker.com/engine/security/" rel="noopener ugc nofollow" target="_blank"><em class="km">https://docs.docker.com/engine/security/</em></a></li></ul></div></div>    
</body>
</html>