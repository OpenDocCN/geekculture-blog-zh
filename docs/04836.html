<html>
<head>
<title>How To Perform Map Reduce In Mongo DB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Mongo DB中执行Map Reduce</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-perform-map-reduce-in-mongo-db-abe35dc0ef78?source=collection_archive---------43-----------------------#2021-07-04">https://medium.com/geekculture/how-to-perform-map-reduce-in-mongo-db-abe35dc0ef78?source=collection_archive---------43-----------------------#2021-07-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/292d024a743c523d6a41133f6625b449.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lIrkCPt-eniN53H0"/></div></div></figure><p id="e84f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">嘿，伙计们，希望你们在今天的文章中所做的事情。我们将对mongo数据库集群中的数据进行排序，因此我们可以通过多种方式来完成这项工作，但今天我们将使用map-reduce对mongo数据库集群中的数据进行排序。</p><p id="5596" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在map-reduce中，我们创建了两个函数，一个用于映射数据，无处映射是指假设您有1000个文档(在mongo文档中是指我们从用户那里获得的每个数据) 假设在该文档中，我们有许多具有相同客户id的客户，但他们每次都购买新产品，并且每次客户购买客户时都会创建一个新条目。现在，我们希望制作一个以客户id命名的列表，其中包含该客户id花费的所有价格，一旦我们获得每个客户的价格列表，我们希望执行加法运算(这取决于您想要做什么 有了这个函数，我们只需编写函数)所以我们在这里编写reduce函数，它处理我们地图数据并给出我们想要的最终输出。</p><p id="cc58" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我希望你能了解什么是map-reduce程序，现在让我们开始实践，以便更好地理解。</p><p id="d3a2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，让我们使用下面的命令创建一个示例集合，它包含您想要的任何数据库中的名称顺序。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="1522" class="jx jy hi jt b fi jz ka l kb kc">use [database name]<br/>db.orders.insertMany([ { _id: 1, cust_id: “Ant O. Knee”, ord_date: new Date(“2020–03–01”), price: 25, items: [ { sku: “oranges”, qty: 5, price: 2.5 }, { sku: “apples”, qty: 5, price: 2.5 } ], status: “A” }, { _id: 2, cust_id: “Ant O. Knee”, ord_date: new Date(“2020–03–08”), price: 70, items: [ { sku: “oranges”, qty: 8, price: 2.5 }, { sku: “chocolates”, qty: 5, price: 10 } ], status: “A” }, { _id: 3, cust_id: “Busby Bee”, ord_date: new Date(“2020–03–08”), price: 50, items: [ { sku: “oranges”, qty: 10, price: 2.5 }, { sku: “pears”, qty: 10, price: 2.5 } ], status: “A” }, { _id: 4, cust_id: “Busby Bee”, ord_date: new Date(“2020–03–18”), price: 25, items: [ { sku: “oranges”, qty: 10, price: 2.5 } ], status: “A” }, { _id: 5, cust_id: “Busby Bee”, ord_date: new Date(“2020–03–19”), price: 50, items: [ { sku: “chocolates”, qty: 5, price: 10 } ], status: “A”}, { _id: 6, cust_id: “Cam Elot”, ord_date: new Date(“2020–03–19”), price: 35, items: [ { sku: “carrots”, qty: 10, price: 1.0 }, { sku: “apples”, qty: 10, price: 2.5 } ], status: “A” }, { _id: 7, cust_id: “Cam Elot”, ord_date: new Date(“2020–03–20”), price: 25, items: [ { sku: “oranges”, qty: 10, price: 2.5 } ], status: “A” }, { _id: 8, cust_id: “Don Quis”, ord_date: new Date(“2020–03–20”), price: 75, items: [ { sku: “chocolates”, qty: 5, price: 10 }, { sku: “apples”, qty: 10, price: 2.5 } ], status: “A” }, { _id: 9, cust_id: “Don Quis”, ord_date: new Date(“2020–03–20”), price: 55, items: [ { sku: “carrots”, qty: 5, price: 1.0 }, { sku: “apples”, qty: 10, price: 2.5 }, { sku: “oranges”, qty: 10, price: 2.5 } ], status: “A” }, { _id: 10, cust_id: “Don Quis”, ord_date: new Date(“2020–03–23”), price: 25, items: [ { sku: “oranges”, qty: 10, price: 2.5 } ], status: “A” }])</span></pre><p id="4af1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的命令中，顺序只是一个集合名称，你可以把它改成你想要的任何名称。</p><p id="6dce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Mongo DB中一些有助于一般操作的命令。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="af3e" class="jx jy hi jt b fi jz ka l kb kc">use dbname to change dbname<br/>show collections to get collection in db<br/>db.collectionnaame.find()=&gt; To see all data of collection</span></pre><p id="bc55" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们准备制作映射器函数来映射数据。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="5002" class="jx jy hi jt b fi jz ka l kb kc">var mapFunction1 = function() {</span><span id="18f9" class="jx jy hi jt b fi kd ka l kb kc">emit(this.cust_id, this.price);</span><span id="30d3" class="jx jy hi jt b fi kd ka l kb kc">};<br/></span></pre><p id="a147" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的映射器函数中，这是指特定文档的地址，并发出take key: value对，以在上面的命令中对集合中的项目进行分组，cust_id是我们的键，price是值。在后端运行该命令后，每个客户的数据将类似于{"cust_id":[price1，price 2，etc]}。</p><p id="385e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们可以创建我们的reducer函数了，我们创建了一个函数，它带有两个参数cust_id和price，这是我们在mapper函数中创建的，并返回数组中的一些元素。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="c0ae" class="jx jy hi jt b fi jz ka l kb kc">var reduceFunction1 = function(keyCustId, valuesPrices) {</span><span id="de1b" class="jx jy hi jt b fi kd ka l kb kc">return Array.sum(valuesPrices);</span><span id="ed44" class="jx jy hi jt b fi kd ka l kb kc">};</span></pre><p id="e4a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们可以从下面的命令中调用这个函数。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="d002" class="jx jy hi jt b fi jz ka l kb kc">db.[collection name].mapReduce(</span><span id="fe55" class="jx jy hi jt b fi kd ka l kb kc">[mapfunction name],</span><span id="3160" class="jx jy hi jt b fi kd ka l kb kc">[mapfunction name],</span><span id="e96d" class="jx jy hi jt b fi kd ka l kb kc">{ out: <strong class="jt hj">[any collection name you want output want to be save]</strong> }</span><span id="8adc" class="jx jy hi jt b fi kd ka l kb kc">)</span><span id="e4e9" class="jx jy hi jt b fi kd ka l kb kc">Eg:-db.orders.mapReduce(</span><span id="86fa" class="jx jy hi jt b fi kd ka l kb kc">mapFunction1,</span><span id="f7bd" class="jx jy hi jt b fi kd ka l kb kc">reduceFunction1,</span><span id="ea2e" class="jx jy hi jt b fi kd ka l kb kc">{ out: <strong class="jt hj">“map_reduce_example”</strong> }</span><span id="483e" class="jx jy hi jt b fi kd ka l kb kc">)</span></pre><p id="3567" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果想知道更多关于上面的例子可以看看下面的mongo官方网站链接。</p><div class="ke kf ez fb kg kh"><a href="https://docs.mongodb.com/manual/tutorial/map-reduce-examples/" rel="noopener  ugc nofollow" target="_blank"><div class="ki ab dw"><div class="kj ab kk cl cj kl"><h2 class="bd hj fi z dy km ea eb kn ed ef hh bi translated">地图缩小示例</h2><div class="ko l"><h3 class="bd b fi z dy km ea eb kn ed ef dx translated">聚合管道作为外壳中Map-Reduce的替代。收藏。MapReduce()方法是一个包装器…</h3></div><div class="kp l"><p class="bd b fp z dy km ea eb kn ed ef dx translated">docs.mongodb.com</p></div></div><div class="kq l"><div class="kr l ks kt ku kq kv io kh"/></div></div></a></div><p id="cf16" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">伙计们，这个博客到此结束，我希望你们都喜欢它，并发现它内容丰富。如果有任何疑问，请随时联系我:)</p><blockquote class="kw kx ky"><p id="c159" class="iq ir kz is b it iu iv iw ix iy iz ja la jc jd je lb jg jh ji lc jk jl jm jn hb bi translated">伙计们关注我的博客，如果有任何评论，请告诉我，下次写博客时我会记住这些观点。如果想阅读更多这样的博客来了解我，这里是我的网站链接<a class="ae ld" href="https://sites.google.com/view/adityvgupta/home" rel="noopener ugc nofollow" target="_blank"><strong class="is hj"><em class="hi"/></strong></a><strong class="is hj"><em class="hi">。伙计们，请不要犹豫👏👏👏👏👏对于它(一个公开的秘密:你可以为一个帖子鼓掌50次，最棒的是，它不会花费你任何东西)，也可以随意分享。这对我真的很重要。</em>T13】</strong></p></blockquote></div></div>    
</body>
</html>