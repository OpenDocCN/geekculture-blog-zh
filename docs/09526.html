<html>
<head>
<title>RealityKit 911 — Swift Playgrounds, or how to create and debug AR apps on iPad Pro</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RealityKit 911 — Swift Playgrounds，或如何在iPad Pro上创建和调试AR应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/realitykit-911-swift-playgrounds-or-how-to-create-and-debug-ar-apps-on-ipad-pro-190a6d2e03bb?source=collection_archive---------3-----------------------#2021-12-15">https://medium.com/geekculture/realitykit-911-swift-playgrounds-or-how-to-create-and-debug-ar-apps-on-ipad-pro-190a6d2e03bb?source=collection_archive---------3-----------------------#2021-12-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/68efd21ee28e66bea556958616504499.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*og5SBhRAxBlIIxtnl4Y-Gw.png"/></div></div></figure><h1 id="b2dc" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">关于在iPad上编码的几句话</h1><p id="028f" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated"><a class="ae km" href="https://apps.apple.com/app/swift-playgrounds/id908519492" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj"><em class="kn">Swift Playgrounds 4.0</em></strong></a>适用于iPad，或者更年轻的Xcode兄弟，是开始尝试AR项目的理想AR app。许多尝试过它的开发者表示，这是一个很好的选择，还有另一个现象——<a class="ae km" href="https://apps.apple.com/app/reality-composer/id1462358802" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj"><em class="kn">Reality Composer</em></strong></a>应用。是什么让斯威夫特游乐场如此吸引人？嗯，一些不明显但积极的原因。以下是其中至少七种:</p><ul class=""><li id="53a5" class="ko kp hi jq b jr kq jv kr jz ks kd kt kh ku kl kv kw kx ky bi translated">Swift Playgrounds是一款免费应用，具有完整的AR功能</li><li id="7485" class="ko kp hi jq b jr kz jv la jz lb kd lc kh ld kl kv kw kx ky bi translated">你可以在iPad上模拟SwiftUI和UIKit项目</li><li id="ec00" class="ko kp hi jq b jr kz jv la jz lb kd lc kh ld kl kv kw kx ky bi translated">AR应用程序的编译时间惊人，几乎是瞬间完成的</li><li id="f6b3" class="ko kp hi jq b jr kz jv la jz lb kd lc kh ld kl kv kw kx ky bi translated">不需要iOS开发者账户</li><li id="e17e" class="ko kp hi jq b jr kz jv la jz lb kd lc kh ld kl kv kw kx ky bi translated">免费帐户没有限制，如在7天内编译10个应用程序</li><li id="f004" class="ko kp hi jq b jr kz jv la jz lb kd lc kh ld kl kv kw kx ky bi translated">没有<em class="kn"> info.plist </em>的键，像<em class="kn">NSCameraUsageDescription</em></li><li id="831f" class="ko kp hi jq b jr kz jv la jz lb kd lc kh ld kl kv kw kx ky bi translated">不需要互联网连接来验证应用的签名</li><li id="6686" class="ko kp hi jq b jr kz jv la jz lb kd lc kh ld kl kv kw kx ky bi translated">Connect integration允许您将完成的应用程序上传到App Store</li></ul><p id="e42d" class="pw-post-body-paragraph jo jp hi jq b jr kq jt ju jv kr jx jy jz le kb kc kd lf kf kg kh lg kj kk kl hb bi translated">不过说实话，Swift Playgrounds也有一个恼人的缺点——当我实现<strong class="jq hj"> <em class="kn">手势</em> </strong>或<strong class="jq hj"> <em class="kn">人物遮挡</em> </strong>功能时，经常会崩溃。我还不知道它在装有M1的iPad上如何工作(我用的是装有A12Z芯片组的iPad Pro ),但我希望这个烦人的错误会在未来的版本中得到修复。</p><h1 id="e10c" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">现实工具包实现</h1><p id="46b5" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">对于这个应用程序，我在离iPad摄像头500米的地方创建了一个锚点。请记住，RealityKit 2.0中的<strong class="jq hj"> <em class="kn">远裁剪平面</em> </strong>仍被限制在1000米内——因此请确保您的3D模型不会超出相机的<strong class="jq hj"> <em class="kn">截锥</em> </strong>。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/6d0fc60332be11c4f7c8ddfc8b260672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ye7mduVqNsNGGBhjqOKRiw.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx">Antananarivo</figcaption></figure><p id="040d" class="pw-post-body-paragraph jo jp hi jq b jr kq jt ju jv kr jx jy jz le kb kc kd lf kf kg kh lg kj kk kl hb bi translated">类似的ar应用程序的代码可能如下所示:</p><pre class="li lj lk ll fd lq lr ls lt aw lu bi"><span id="c37f" class="lv ir hi lr b fi lw lx l ly lz"><strong class="lr hj">import</strong> SwiftUI<br/><strong class="lr hj">import</strong> RealityKit<br/><strong class="lr hj">import</strong> PlaygroundSupport</span><span id="c1ed" class="lv ir hi lr b fi ma lx l ly lz"><strong class="lr hj">struct</strong> ContentView: View {<br/>    <strong class="lr hj">var</strong> body: <strong class="lr hj">some</strong> View {<br/>        <strong class="lr hj">return</strong> ARContainer()<br/>    }<br/>}</span><span id="effb" class="lv ir hi lr b fi ma lx l ly lz"><strong class="lr hj">struct</strong> ARContainer: UIViewRepresentable {</span><span id="02be" class="lv ir hi lr b fi ma lx l ly lz">    <strong class="lr hj">func</strong> makeUIView(context: Context) -&gt; ARView {</span><span id="2e08" class="lv ir hi lr b fi ma lx l ly lz">        <strong class="lr hj">let</strong> arView = ARView(frame: .zero)</span><span id="da45" class="lv ir hi lr b fi ma lx l ly lz">        arView.cameraMode = .ar                  // <strong class="lr hj">IMPORTANT</strong></span><span id="c0d2" class="lv ir hi lr b fi ma lx l ly lz">        <strong class="lr hj">let</strong> text: MeshResource = .generateText(<em class="kn">"Madagascar"</em>,<br/>                       extrusionDepth: 15,<br/>                                 font: .boldSystemFont(ofSize: 100),<br/>                       containerFrame: .zero,<br/>                            alignment: .center,<br/>                        lineBreakMode: .byWordWrapping)</span><span id="d1bd" class="lv ir hi lr b fi ma lx l ly lz">        <strong class="lr hj">let</strong> material = SimpleMaterial(color: .red, <br/>                                 isMetallic: <strong class="lr hj">true</strong>)</span><span id="2d9d" class="lv ir hi lr b fi ma lx l ly lz">        <strong class="lr hj">let</strong> entity = ModelEntity(mesh: text, materials: [material])</span><span id="19b8" class="lv ir hi lr b fi ma lx l ly lz">        entity.orientation = simd_quatf(angle: .pi / 8, <br/>                                         axis: [0, 1, 0])<br/>        <br/>        // 500 meters North (-Z)<br/>        <strong class="lr hj">let</strong> anchor = AnchorEntity(world: [0, 0,-500])</span><span id="9be8" class="lv ir hi lr b fi ma lx l ly lz">        anchor.addChild(entity)</span><span id="1f15" class="lv ir hi lr b fi ma lx l ly lz">        arView.scene.anchors.append(anchor)</span><span id="4360" class="lv ir hi lr b fi ma lx l ly lz">        <strong class="lr hj">return</strong> arView<br/>    }</span><span id="926d" class="lv ir hi lr b fi ma lx l ly lz">    <strong class="lr hj">func</strong> updateUIView(_ uiView: ARView, context: Context) { }<br/>}</span><span id="520b" class="lv ir hi lr b fi ma lx l ly lz">PlaygroundPage.current.needsIndefiniteExecution = <strong class="lr hj">true</strong><br/>PlaygroundPage.current.<strong class="lr hj">setLiveView</strong>(ContentView())</span></pre><p id="66ea" class="pw-post-body-paragraph jo jp hi jq b jr kq jt ju jv kr jx jy jz le kb kc kd lf kf kg kh lg kj kk kl hb bi translated">注意，这里我用了一个<strong class="jq hj"><em class="kn">setLiveView(_:)</em></strong>的泛型实例方法。它显示了一个视图，该视图显示了运行当前页面上的代码的结果。</p><pre class="li lj lk ll fd lq lr ls lt aw lu bi"><span id="114c" class="lv ir hi lr b fi lw lx l ly lz"><strong class="lr hj">func</strong> setLiveView&lt;IncomingView&gt;(_ newLiveView: IncomingView) <strong class="lr hj">where</strong> <br/>                               IncomingView : <!-- -->PlaygroundLiveViewable</span></pre><p id="af73" class="pw-post-body-paragraph jo jp hi jq b jr kq jt ju jv kr jx jy jz le kb kc kd lf kf kg kh lg kj kk kl hb bi translated">您不能在Swift Playgrounds中使用<strong class="jq hj"> <em class="kn"> liveView </em> </strong>实例属性启动SwiftUI应用程序，就像您之前对UIKit应用程序所做的那样，因为<strong class="jq hj"> <em class="kn"> liveView </em> </strong>是一个符合<strong class="jq hj"><em class="kn">playgroundlivevisible</em></strong>协议的对象:</p><pre class="li lj lk ll fd lq lr ls lt aw lu bi"><span id="cafa" class="lv ir hi lr b fi lw lx l ly lz"><strong class="lr hj">var</strong> liveView: PlaygroundLiveViewable? { <strong class="lr hj">get</strong> <strong class="lr hj">set</strong> }</span></pre><h1 id="fada" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">ARKit + SceneKit实现</h1><p id="9637" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">很高兴知道我们仍然能够在Swift Playgrounds中为UIKit和SwiftUI项目使用SceneKit模块。这里给你一个如何基于<strong class="jq hj"> <em class="kn"> ARSCNView </em> </strong>创建SceneKit的场景的指导(甚至还有一个锚点)。</p><pre class="li lj lk ll fd lq lr ls lt aw lu bi"><span id="da6b" class="lv ir hi lr b fi lw lx l ly lz"><strong class="lr hj">import</strong> ARKit<br/><strong class="lr hj">import</strong> PlaygroundSupport</span><span id="cc7d" class="lv ir hi lr b fi ma lx l ly lz"><strong class="lr hj">class</strong> ARController: UIViewController {</span><span id="95a8" class="lv ir hi lr b fi ma lx l ly lz">    <strong class="lr hj">let</strong> arView = ARSCNView(frame: .zero)<br/>    <strong class="lr hj">var</strong> anchor: ARAnchor!</span><span id="04bb" class="lv ir hi lr b fi ma lx l ly lz">    <strong class="lr hj">override</strong> <strong class="lr hj">func</strong> viewDidLoad() {<br/>        <strong class="lr hj">super</strong>.viewDidLoad()</span><span id="bc33" class="lv ir hi lr b fi ma lx l ly lz">        <strong class="lr hj">self</strong>.view = arView           // <strong class="lr hj">IMPORTANT</strong></span><span id="c846" class="lv ir hi lr b fi ma lx l ly lz">        arView.scene = SCNScene()<br/>        arView.autoenablesDefaultLighting = <strong class="lr hj">true</strong></span><span id="f744" class="lv ir hi lr b fi ma lx l ly lz">        // anchor is 2 meters away<br/>        <strong class="lr hj">self</strong>.anchor = ARAnchor(name: "special", <br/>                          transform: .<strong class="lr hj">init</strong>([1, 0, 0, 0], <br/>                                           [0, 1, 0, 0], <br/>                                           [0, 0, 1, 0], <br/>                                           [0, 0,-2, 1] ) )</span><span id="e052" class="lv ir hi lr b fi ma lx l ly lz">        <strong class="lr hj">let</strong> model = SCNNode(geometry: SCNBox(width: 0.1, <br/>                                            height: 0.25, <br/>                                            length: 0.1, <br/>                                     chamferRadius: 0.02))</span><span id="8c1f" class="lv ir hi lr b fi ma lx l ly lz">        model.geometry?.firstMaterial?.diffuse.contents = <br/>                                                        UIColor.red</span><span id="91e6" class="lv ir hi lr b fi ma lx l ly lz">        model.simdTransform = <strong class="lr hj">self</strong>.anchor.transform   <br/>        arView.session.add(anchor: <strong class="lr hj">self</strong>.anchor)</span><span id="a427" class="lv ir hi lr b fi ma lx l ly lz">        arView.scene.rootNode.addChildNode(model)</span><span id="d735" class="lv ir hi lr b fi ma lx l ly lz">        // ARKit config<br/>        <strong class="lr hj">let</strong> config = ARWorldTrackingConfiguration()  <br/>        arView.session.run(config)<br/>    }<br/>}</span><span id="6f19" class="lv ir hi lr b fi ma lx l ly lz">PlaygroundPage.current.needsIndefiniteExecution = <strong class="lr hj">true<br/></strong>PlaygroundPage.current.<strong class="lr hj">liveView</strong> = ARController()</span></pre><p id="497a" class="pw-post-body-paragraph jo jp hi jq b jr kq jt ju jv kr jx jy jz le kb kc kd lf kf kg kh lg kj kk kl hb bi translated">如你所见，我使用了<strong class="jq hj"><em class="kn">needsindefinitiexecution</em></strong>实例属性，它是一个布尔值，指示是否启用无限执行。</p><pre class="li lj lk ll fd lq lr ls lt aw lu bi"><span id="1514" class="lv ir hi lr b fi lw lx l ly lz"><strong class="lr hj">var</strong> needsIndefiniteExecution: <!-- -->Bool<!-- --> { <strong class="lr hj">get</strong> <strong class="lr hj">set</strong> }</span></pre><p id="b095" class="pw-post-body-paragraph jo jp hi jq b jr kq jt ju jv kr jx jy jz le kb kc kd lf kf kg kh lg kj kk kl hb bi translated"><strong class="jq hj"> <em class="kn">开发者文档中的定义</em> </strong>:</p><blockquote class="mb mc md"><p id="3adf" class="jo jp kn jq b jr kq jt ju jv kr jx jy me le kb kc mf lf kf kg mg lg kj kk kl hb bi translated">默认情况下，执行所有顶级代码，然后终止执行。当使用异步代码时，启用无限执行以允许在到达游戏场的顶级代码结尾后继续执行。这反过来又给了线程和回调执行的时间。</p><p id="7f9f" class="jo jp kn jq b jr kq jt ju jv kr jx jy me le kb kc mf lf kf kg mg lg kj kk kl hb bi translated">使用传统的实时视图，编辑操场会自动停止执行，即使启用了无限执行。使用始终在线实时视图时，无论是否启用无限期执行，执行都会继续。</p><p id="555e" class="jo jp kn jq b jr kq jt ju jv kr jx jy me le kb kc mf lf kf kg mg lg kj kk kl hb bi translated">设置<strong class="jq hj"><em class="hi">needsindefinitiexecution</em></strong>为<strong class="jq hj"> <em class="hi"> true </em> </strong>在顶层代码结束后继续执行。<strong class="jq hj">设为<em class="hi">假</em> </strong>停止执行，此时默认值为<strong class="jq hj"> <em class="hi">假</em> </strong>。当<strong class="jq hj"> <em class="hi"> liveView </em> </strong>设置为非<strong class="jq hj"> <em class="hi"> nil </em> </strong>值时，设置为<strong class="jq hj"> <em class="hi"> true </em> </strong>。</p></blockquote><h1 id="46f2" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">捐赠给作者</h1><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/c0650a189c6fb3281d999d5e2342f8a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*79QZO5t3vV-z7yeDjw2dvQ.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx">Click on the picture to make the QR code bigger</figcaption></figure><pre class="li lj lk ll fd lq lr ls lt aw lu bi"><span id="59c2" class="lv ir hi lr b fi lw lx l ly lz">addr1q9w70n62nu8p7f9ukfn66gzumm9d9uxwppkx7gk7vd7gy0ehfavj97gkncwm8t8l8l8x9e4adzmw2djh4y5gd9rmtewqr99zr3</span></pre><p id="d8f8" class="pw-post-body-paragraph jo jp hi jq b jr kq jt ju jv kr jx jy jz le kb kc kd lf kf kg kh lg kj kk kl hb bi translated">目前就这些。</p><p id="a8f1" class="pw-post-body-paragraph jo jp hi jq b jr kq jt ju jv kr jx jy jz le kb kc kd lf kf kg kh lg kj kk kl hb bi translated">如果这篇帖子对你有用，请按下<strong class="jq hj"> <em class="kn">拍下</em> </strong>按钮，按住<strong class="jq hj"><em class="kn"/></strong>即可。在Medium上，每个帖子最多可以拍50次<strong class="jq hj"><em class="kn"/></strong>。</p><p id="8dc7" class="pw-post-body-paragraph jo jp hi jq b jr kq jt ju jv kr jx jy jz le kb kc kd lf kf kg kh lg kj kk kl hb bi translated">你可以在我在<a class="ae km" href="https://stackoverflow.com/users/6599590/andy-fedoroff" rel="noopener ugc nofollow" target="_blank"> StackOverflow </a>上的帖子中找到更多关于ARKit、RealityKit和SceneKit的信息。</p><p id="60d0" class="pw-post-body-paragraph jo jp hi jq b jr kq jt ju jv kr jx jy jz le kb kc kd lf kf kg kh lg kj kk kl hb bi translated">后会有期！</p></div></div>    
</body>
</html>