# 您应该避免的 5 种最常见的代码味道

> 原文：<https://medium.com/geekculture/5-most-common-code-smells-that-you-should-avoid-86ae41cb1dc7?source=collection_archive---------7----------------------->

![](img/78dd77b71f1e6eddb2ec10cff88465df.png)

Photo by [Danny Meneses](https://www.pexels.com/@danny-meneses-340146?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) from [Pexels](https://www.pexels.com/photo/photo-of-turned-on-laptop-computer-943096/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)

时间紧迫、缺乏经验、错过代码审查……这些只是导致我们编写糟糕的代码的一些原因。这一事实的后果是，我们最终会在开发过程中犯错误，产生所谓的**代码味道**。

代码气味是代码中可能表明更深层次问题的任何特征。确定什么是代码味道，什么不是代码味道是主观的，并且随着语言和开发方法的不同而不同。

在本文中，我们将讨论我认为你应该避免的五种最常见的代码味道。我将解释每一个，给出例子，以及重构这种味道的方法。当然，还有其他方法来重构每种气味，您可以从我在本文结尾留下的参考资料中了解其他方法。

# 👬1 -代码复制

当在多个位置有相同或非常相似的代码段时，就会出现这种代码味道。当代码的特定部分看起来不同但执行相同的工作时，也有更微妙的重复。

在下面的例子中，我们有一个脚本，它对两个数字数组进行平均，并根据结果显示一条消息。请注意，我们在平均和结果分析中有代码重复:

Duplicated Code example

## 解决办法

解决这种气味通常很简单。我们只需要将重复的代码提取到一个单独的方法中，并在代码重复的地方调用它。

在我们的例子中，我们可以通过提取两个新闻方法来删除重复的代码。第一个负责计算数组中数字的平均值。第二个负责分析平均值并显示结果。

> 我们可以创建一个负责计算平均值并对其进行分析的单一方法，但是它会打破在 **SOLID** 中描述的**单一责任原则**

Duplicated Code Fix Example

然而，有一些不可能提取方法的极端情况，比如当重复代码相似但不完全相同时。在这些情况下，我们需要针对每种情况使用特定的技术。我将在以后的文章中解释每种情况。

> 现在，请注意，在接下来的几个主题中，所有代码味道解决方案都有助于我们消除整个代码中的代码重复

## 利益

合并重复的代码简化了代码的结构，使代码更短，换句话说，代码变得更容易简化和维护。

通过消除代码重复，我们还消除了代码中可能的不一致和业务规则失败，因为我们将重构功能的所有业务逻辑集中在应用程序的单个点上。

# 📏双长法

方法包含太多代码行。一般来说，任何超过十行的方法都应该重新评估。

> 通常，一些东西总是被添加到一个方法中，但是没有东西被取出。因此，这种气味一直没有被注意到，直到方法变成一个丑陋的，超大的野兽

作为一个经验法则，如果你觉得有必要在一个方法中注释一些东西，你应该把这段代码放到一个新的方法中。给新方法起一个描述性的名字，你的代码会更整洁。

> 此外，长方法通常会打破**单一负责原则**和**实体**，并可能导致**代码重复**

在下面的例子中，我们有一个类 *User* ，它有一个方法 *printDetails。*注意，这个方法有多重职责:计算用户年龄，形成用户全名，并显示它们。这最终会导致一个有太多代码行的方法。

Long Method Example

## 解决办法

就像前面的代码味道一样，我们可以只从重构目标方法中提取新方法。不要忘记给新方法起一个描述性的名字，以使代码更具可读性。

在我们的示例中，我们只需要将年龄计算和全名形成责任转移到两个新方法中:

Long Method Fix Example

## 利益

请记住:使用短方法的类寿命更长。方法或函数越长，维护起来就越困难。

此外，短方法有助于我们避免整个代码中的代码重复，并允许代码重用。

# 🤖3 -大班

就像方法一样，类通常从小开始。但是随着时间的推移，它们会随着程序的增长而变得臃肿。这个代码味道的定义很明确:一个类包含很多字段/方法/代码行/职责，换句话说，它做的太多了。

大的类，比如长方法，表明设计中的弱点，这些弱点可能会减慢开发或者增加将来失败的机会。此外，它使系统更难理解、阅读和开发。

> 此外，大类打破了**单一负责原则**和**实体**并可能导致**代码重复**

在下面的例子中，我们有一个类 *Student* ，它有多个属性:名字、姓氏、年龄、铅笔、钢笔和尺子。这里的问题是，也许这个类承担了比它应该承担的更多的责任。

这个结论是有问题的，但是如果我们有另一个叫做*老师*的类，它也有铅笔、钢笔和尺子，会怎么样呢？在这种情况下，我们需要将所有的*学生*的类逻辑复制到新的类中。

Large Class Example

## 解决办法

为了修复这种代码味道，我们必须确定这个大类的所有职责。然后，对于每个责任，我们提取出一个新的类，移动相关的字段和方法。

在我们的例子中，我们可以将与材料相关的属性从*学生*类提取到一个新的类*材料*中。通过这种方式，我们减少了学生班级的规模，另外，我们创建了一个新的组件材料，可以在未来的实现中重用，而无需重复代码。

Large Class Fix Example

## 利益

重构大型类的最大好处是避免代码和功能重复。

# 📜4 长参数表

方法调用中的长参数列表是一种代码味道。这表明实现可能有问题。这可能发生在几个算法合并成一个方法之后。

对于多少个参数是太多的，没有单一的规则。通常，超过三个或四个被认为太多了。

在下面的例子中，我们有一个*用户*类，它在构造函数中接收了太多的参数。问题是很难理解这个长长的列表，随着它变得越来越长，也变得难以使用。

一个方法可以使用自己对象的数据，而不是一长串的参数。如果当前对象不包含所有必需的数据，可以将另一个对象作为方法参数传递。

Long Parameter List Example

## 解决办法

一个方法可以使用自己对象的数据，而不是一长串的参数。如果当前对象不包含所有必需的数据，另一个对象(它将获得必需的数据)可以作为方法参数传递。

在我们的例子中，我们提取了另一个名为 *Address* 的类，它包含了与用户地址相关的所有数据。因此，我们用一个唯一的对象替换三个用户参数。此外，在未来的实现中，*地址*对象可以用在除*用户*之外的类中。

Long Parameter List Fix Example

## 利益

使代码更易读、更简短。此外，还可能暴露以前没有注意到的重复代码。

# 🌀5 -原始痴迷

当我们的代码在简单的任务中使用原语而不是小对象时，比如货币、电话号码的特殊字符串、范围等等，就会有一种代码的味道

换句话说，原始痴迷就是当你有一个使用原始类型来表示一个域中的对象的坏习惯时。

当这些原语的数量随着它们的行为特征增长时，真正的问题就开始出现了。当开发人员通过代码复制在不同的地方定义相同的原语时，情况会变得更糟。

代码重复会导致实用程序类的创建，这是一种反模式，在 OOP 环境中没有意义。

在下面的例子中，我们有一个名为 *Site* 的类，具有名称和 URL 属性。但是，在定义 URL 属性值之前，我们必须检查传递的值是否有效。此外，我们可能有其他方法来处理 URL 数据，例如 *getUrlParts* 方法。

如果我们看一下 *Site* 类，我们可能会得出这样的结论:这个类不应该负责 URL 验证和操作。

此外，如果我们必须实现一个也具有 URL 属性的新类，我们需要将所有的验证器和处理程序从*站点*类复制到新类中。

Primitive Obsession Example

## 解决办法

如果您有各种各样的基本字段，可以将其中一些逻辑分组到它们自己的类中。更好的是，将与该数据相关的行为也移入类中。

回到我们的例子，我们已经知道原始的痴迷可能导致代码重复。在这种情况下，URL 验证和操作会导致重复。

因此，我们可以将 URL 本身解释为一种类型。它有自己的自我验证和处理程序。因此，我们可以用它自己的方法和属性将它提取到一个新的类 *URL* 。这样，我们可以在其他类中使用 *URL* 类作为属性，而无需代码重复，使代码更加灵活。

Primitive Obsession Fix Example

## 利益

由于使用对象而不是原语，重构这种味道使代码更加灵活。此外，它为代码带来了可理解性和组织性。

# ✅结论

纵观我们作为开发人员的职业生涯，我们经常需要在没有计划的情况下编写代码。这一事实的结果是，我们最终产生了代码气味。

代码气味是代码中可能表明更深层次问题的任何特征。

在本文中，我展示了我认为最常见的 5 种代码味道，以及如何重构这些味道和重构的好处。我希望你们喜欢这篇文章，如果你们喜欢，请留下掌声和评论。如果你不喜欢它，让我知道为什么，建设性的批评总是受欢迎的！

# 📚参考

[《重构大类代码味道》来自 Makolyte](https://makolyte.com/refactoring-the-large-class-code-smell/)

[《长参数表》Arho Huttunen](https://www.arhohuttunen.com/long-parameter-list/)

[《代码的味道》来自维基百科](https://en.wikipedia.org/wiki/Code_smell)

[《重构教程》来自重构大师](https://refactoring.guru/refactoring/course)