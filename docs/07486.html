<html>
<head>
<title>Clio: extremely fast, multi-threaded code on the browser</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Clio:浏览器上速度极快的多线程代码</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/clio-extremely-fast-multi-threaded-code-on-the-browser-e78b4ad77220?source=collection_archive---------1-----------------------#2021-09-20">https://medium.com/geekculture/clio-extremely-fast-multi-threaded-code-on-the-browser-e78b4ad77220?source=collection_archive---------1-----------------------#2021-09-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/97a01e01b9aee3f4282c98fa721ef5b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*seX074yLh6l4lAqkdFfaqw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Clio lets you run multi-threaded code on the browser</figcaption></figure><p id="4ffe" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Clio是一种编译成JavaScript的函数式编程语言。它既可以在Node.js上运行，也可以在浏览器中运行，并且是多线程的。Clio使并行或分布式编程变得非常容易，您可以轻松地使用本地设备上的CPU内核，或者使用网络上另一台设备上的资源。Clio可以无限扩展。它有一个清晰的语法，速度非常快。您可以在medium 上阅读Clio <a class="ae js" href="https://pouyae.medium.com/re-introducing-the-clio-programming-language-cfdb3ce9fc49" rel="noopener">的介绍，访问我们的</a><a class="ae js" href="https://github.com/clio-lang/clio" rel="noopener ugc nofollow" target="_blank"> GitHub </a>资源库或<a class="ae js" href="https://clio-lang.org/" rel="noopener ugc nofollow" target="_blank">网站</a>，或者您可以直接前往我们的<a class="ae js" href="https://playground.clio-lang.org/" rel="noopener ugc nofollow" target="_blank">游乐场</a>查看并尝试几个示例。</p><p id="08ca" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">但是，让我向您展示一个Clio的快速演示，以及如何使用它来实现多线程。要在浏览器或Node.js上执行多线程，您需要做的就是定义您的函数，并使用<code class="du jt ju jv jw b">|sandwich|</code>语法调用它们，Clio会处理剩下的事情:</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jx"><img src="../Images/262d370a9632ef9651606a760c367e2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*07UAtBXDviQNyYOo3cuPog.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Fib function written in Clio</figcaption></figure><p id="70d8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你愿意，可以直接在<a class="ae js" href="https://playground.clio-lang.org/" rel="noopener ugc nofollow" target="_blank">操场</a>上运行这个例子。</p><p id="cca5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这个例子中，有几个小细节需要解释。在上面示例代码的第8行，您可以看到Clio三明治语法<code class="du jt ju jv jw b">|fib|</code>的演示，它在一个单独的线程中运行fib函数。在同一行中，您可以看到<code class="du jt ju jv jw b">-&gt; *</code>用于将数据映射到<code class="du jt ju jv jw b">|fib|</code>函数。在第9行，<code class="du jt ju jv jw b">(console.log @it)</code>是一个匿名函数，它接受<code class="du jt ju jv jw b">it</code>作为它的第一个参数。</p><p id="d3db" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用Clio，还可以通过网络导入函数，并像使用任何其他常规函数一样使用它们。有了Clio，你不用制作和实现API端点，只需托管你的函数并把它们导入到别处，Clio免费为你提供<a class="ae js" href="https://en.wikipedia.org/wiki/Function_as_a_service" rel="noopener ugc nofollow" target="_blank"> FaaS </a>和微服务架构，没有任何额外的麻烦。例如</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kc"><img src="../Images/feba986de2ccb32cf678b797fcfa4a59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Pd7X6UU7eNcCvnFBC0vog.png"/></div></div></figure><p id="b3a0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">是有效的Clio代码。要查看远程函数的演示，您可以在这里查看我们的todo示例<a class="ae js" href="https://github.com/clio-lang/examples/tree/master/todo" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="362c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最近发布的Clio v0.11.0版本带来了一些重要的变化。这些变化主要是与性能相关的:它们提高了Clio代码的执行速度，也提高了整体RPC和多线程性能。在本文中，我将向您展示Clio有多快，我们将一起了解这些新的增强功能。先说性能吧！</p><h1 id="f4a7" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">Clio有多快？</h1><p id="d85f" class="pw-post-body-paragraph iu iv hi iw b ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn lf jp jq jr hb bi translated">既然Clio编译成JavaScript，大家的第一个假设就是Clio比较慢，或者和JavaScript一样慢。对于像<a class="ae js" href="https://benchmarksgame-team.pages.debian.net/benchmarksgame/fastest/node-typescript.html" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>这样的语言来说，这可能是真的，但是Clio实际上比JavaScript更快，并且在某些情况下，它比JavaScript快得多。我将在本文后面解释Clio如何实现这样的性能。但是现在，让我们看看我们所说的速度有多快。</p><figure class="jy jz ka kb fd ij"><div class="bz dy l di"><div class="lg lh l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Clio performance vs other languages</figcaption></figure><p id="d1a5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上图显示了在不同编程语言中计算第1000个斐波那契数的执行时间。正如您所看到的，Clio几乎和C一样快。当然，我不期望Clio总是或在任何其他情况下都这么快，我也不声称Clio和C一样快，我所声称的是Clio超级快，并且已经做了很多工作来使它更快。那么如果编译成JavaScript怎么会这么快呢？</p><p id="5a78" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，我应该提一下，与普遍的看法相反，JavaScript实际上是一种<a class="ae js" href="https://benchmarksgame-team.pages.debian.net/benchmarksgame/fastest/node-gpp.html" rel="noopener ugc nofollow" target="_blank">非常快的</a>编程语言。由于Clio <em class="li">将</em>编译成JavaScript，编译器可以对生成的JavaScript应用编译时优化。在上面的例子中，<a class="ae js" href="https://en.wikipedia.org/wiki/Tail_call" rel="noopener ugc nofollow" target="_blank">尾调用</a>优化被应用于Fibonacci函数。您可以在这里找到基准<a class="ae js" href="https://github.com/clio-lang/benchmark" rel="noopener ugc nofollow" target="_blank">的源代码。</a></p><p id="0b6e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Clio比JavaScript运行得更快的另一个原因是Clio代码的编写方式:使用管道，可以避免创建中间常量或变量。函数调用的输出可以直接通过管道传递给另一个函数，并从那里传递给另一个函数。当然，也可以在JavaScript中嵌套函数调用，避免使用中间变量，但是，Clio语法经过精心设计，在保持可读性的同时允许这样做。例如，下面的JavaScript代码:</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kc"><img src="../Images/23a223093791d0ced7d52a507757c62f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H7DJjSFllxYO4Nt_dLFjIw.png"/></div></div></figure><p id="9909" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在Clio中变成这样:</p><figure class="jy jz ka kb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kc"><img src="../Images/4157e857e15af0fdc0faff4955c2ddfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g3ckGGlCEsitT_nucv7aMA.png"/></div></div></figure><p id="11e4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在上面的JavaScript示例中，函数的执行顺序是从内到外，但是在Clio代码中，它是从左到右执行的，与您读取和编写代码的顺序完全相同。如果你仔细想想，这就更有道理了！</p><p id="5097" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了保持Clio的速度，我们花费了大量的时间和精力，为此，我们不得不牺牲掉相当多的特性。举个例子，我们不得不放弃懒惰，因为我们运行的V8引擎本身并不支持它。然而，我们确保Clio compatible与JavaScript保持兼容。</p><p id="020d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，您现在可以将任何JavaScript库导入Clio并使用它，而不会遇到任何问题。因此，您甚至可以从Clio的多线程特性中获益，使您的JavaScript库运行得更快:</p><figure class="jy jz ka kb fd ij"><div class="bz dy l di"><div class="lj lh l"/></div></figure><p id="8cdc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在上面的图表中，您可以看到使用Clio并行化任务是如何提高性能的！作为一个例子，Jimp，一个纯JavaScript图像操作库，被用来对一个充满图像的目录应用灰度效果。使用Clio，您可以在单独的线程中将效果应用到每个图像，这大大提高了性能。在Clio v 0 . 11 . 0版本中，做了大量的工作来使并行性比以前更快、更有效、更好！</p><h1 id="13f1" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">Clio中的并行</h1><p id="b36c" class="pw-post-body-paragraph iu iv hi iw b ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn lf jp jq jr hb bi translated">Clio有一个基于网络的并行模型。你可以称之为分布式计算模型。在启动时，Clio会创建一个中央集线器或消息代理，称为调度程序，并根据项目的配置监听不同协议上的连接。然后，它产生工作程序，并等待它们连接到调度程序。调度程序只是一个消息中心或代理，在主线程和工作线程之间传递消息。工作线程和主线程之间没有共享内存，因此Clio必须序列化每一条消息。</p><p id="7b54" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在v0.11.0版本之前，Clio使用JSON进行序列化。JSON随处可见，而且速度相当快，所以一开始，使用JSON听起来是个好主意。不幸的是，一旦我们开始用JSON序列化定制类型，它的性能就会下降到不再高效的地步。为了解决这个问题，我为JavaScript创建了一个名为<a class="ae js" href="https://github.com/pouya-eghbali/sia" rel="noopener ugc nofollow" target="_blank"> Sia </a>的序列化库，并将其序列化性能提升到一个新的水平，我还设计了一个新的文本编码，我称之为<a class="ae js" href="https://github.com/pouya-eghbali/utfz" rel="noopener ugc nofollow" target="_blank"> utfz </a>。我花了一年多的时间来优化这两个库，结果，成功地使Sia如此之快，以至于它的纯JavaScript版本甚至胜过了Node.js可用的本机序列化库的性能！</p><figure class="jy jz ka kb fd ij"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="fbe1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Sia是二进制序列化格式，从上图可以看出，Sia速度极快！要查看更多基准测试，或者了解更多关于Sia以及它是如何快速发展的，您可以参考<a class="ae js" href="https://pouyae.medium.com/sia-an-ultra-fast-serializer-in-pure-javascript-394a5c2166b8" rel="noopener">这篇中型文章</a>。使用Sia作为序列化库，Clio在多线程、远程函数调用和RPC协议方面获得了巨大的性能提升。</p><figure class="jy jz ka kb fd ij"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="79c9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上图显示了在我切换到Sia之后Clio的性能增益。不仅序列化数据更快，现在传输数据也更快。使用Sia，序列化的数据比JSON小得多，并且已经是二进制格式了！在浏览器上，性能也大大提高。为了快速演示，您可以查看下面的视频，与JSON相比，Clio Mandelbrot示例在Sia上的渲染速度有多快:</p><figure class="jy jz ka kb fd ij"><div class="bz dy l di"><div class="lk lh l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Clio Mandelbrot example</figcaption></figure><p id="85ac" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">该视频展示了用Clio编写的多线程Mandelbrot示例的渲染时间。你可以在动作<a class="ae js" href="https://clio-mandelbrot.vercel.app/" rel="noopener ugc nofollow" target="_blank">这里</a>查看，也可以在<a class="ae js" href="https://github.com/clio-lang/examples/tree/master/mandelbrot" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上查看源代码。正如您所看到的，Sia版本比JSON版本快得多，完成时间几乎是JSON版本的一半！</p><p id="c25b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有了Clio，在一个线程中运行函数变得超级简单，不需要自己设置任何东西，不需要处理web workers或worker线程，不需要实现通信协议或同步，一切都已经搞定了，只需运行<code class="du jt ju jv jw b">clio new</code>来搭建一个新项目，编写代码，然后运行<code class="du jt ju jv jw b">clio run</code>命令，你就可以在几秒钟内启动并运行你的应用程序。您可以在Clio示例库<a class="ae js" href="https://github.com/clio-lang/examples" rel="noopener ugc nofollow" target="_blank">上查看示例。</a></p><p id="163a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Clio仍然是一个非常年轻的语言，它还有很长的路要走，它还没有准备好投入生产，我也不急于推出一个稳定的版本。我想保持它的最小化，我想仔细地选择语言中应该包含或不包含的内容。它的设计考虑到了云和微服务，这也是主要的关注点。对于Clio，我的目标是开发一种通用语言，既可以在网上使用，也可以在网外使用，这种语言既适合制作网站，也适合处理数字和科学数据。</p><p id="ac83" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你有任何问题，请在本文下留言评论，在GitHub上发帖，如果你想聊聊，欢迎加入我们在<a class="ae js" href="https://t.me/clio_lang" rel="noopener ugc nofollow" target="_blank"> Telegram </a>上的公共聊天！</p></div></div>    
</body>
</html>