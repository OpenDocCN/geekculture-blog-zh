<html>
<head>
<title>Python Source Code Obfuscation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python源代码混淆</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/python-source-code-obfuscation-6b97f88a460d?source=collection_archive---------0-----------------------#2021-12-24">https://medium.com/geekculture/python-source-code-obfuscation-6b97f88a460d?source=collection_archive---------0-----------------------#2021-12-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="879b" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">加密你的Python代码以避免逆向工程。</h2></div></div><div class="ab cl ix iy gp iz" role="separator"><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc"/></div><div class="hb hc hd he hf"><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/caba8a88ec6299db33acf47061d61311.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VkS8agGt5schHU1KWRIlTw.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Photo by <a class="ae ju" href="https://unsplash.com/@maurosbicego?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Mauro Sbicego</a> on <a class="ae ju" href="https://unsplash.com/s/photos/encryption?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><blockquote class="jv jw jx"><p id="e22c" class="jy jz ka kb b kc kd ij ke kf kg im kh ki kj kk kl km kn ko kp kq kr ks kt ku hb bi translated">在软件开发中，<strong class="kb hj">模糊处理</strong>是指故意创建人类难以理解的源代码的行为。代码经常被混淆，以保护知识产权或商业秘密，并防止攻击者<em class="hi">逆向工程</em>一个专有软件程序。</p></blockquote><p id="7829" class="pw-post-body-paragraph jy jz hi kb b kc kd ij ke kf kg im kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><em class="ka">加密程序的部分或全部代码是一种混淆方法。</em></p><p id="ea23" class="pw-post-body-paragraph jy jz hi kb b kc kd ij ke kf kg im kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">在Python中，有多个可用的包，使用它们您可以混淆您的代码库并保护您的知识产权。</p><ul class=""><li id="de5a" class="ky kz hi kb b kc kd kf kg kv la kw lb kx lc ku ld le lf lg bi translated"><a class="ae ju" href="https://pypi.org/project/pyarmor/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb hj"> pyarmor </strong> </a> —十六进制编码的完全混淆；显然不允许只对变量/函数名进行部分模糊处理。</li><li id="64b8" class="ky kz hi kb b kc lh kf li kv lj kw lk kx ll ku ld le lf lg bi translated"><a class="ae ju" href="https://pypi.org/project/python-minifier/" rel="noopener ugc nofollow" target="_blank"><strong class="kb hj">python-minifier</strong></a>—缩小代码并混淆函数/变量名。</li><li id="da57" class="ky kz hi kb b kc lh kf li kv lj kw lk kx ll ku ld le lf lg bi translated"><a class="ae ju" href="https://pypi.org/project/pyminifier/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb hj"> pyminifier </strong> </a> —擅长混淆函数、变量、文字的名称；也可以像pyarmor一样执行十六进制编码(压缩)。问题:模糊处理后，代码可能包含语法错误，无法运行。</li></ul><p id="d1d1" class="pw-post-body-paragraph jy jz hi kb b kc kd ij ke kf kg im kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">在研究过程中，我发现了另一种使用<a class="ae ju" href="https://cython.org" rel="noopener ugc nofollow" target="_blank"> Cython </a>混淆我的Python代码的方法，这种方法非常有用，很难进行逆向工程。</p><p id="df3e" class="pw-post-body-paragraph jy jz hi kb b kc kd ij ke kf kg im kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><em class="ka">模糊处理</em> <em class="ka">是Cython软件包提供的众多特性之一</em>。Cython是一个<strong class="kb hj">优化静态编译器</strong>，它可以将你的<code class="du lm ln lo lp b">.py</code>模块转换成高性能的C文件。生成的C文件可以毫不费力地编译成本地二进制库。编译完成后，没有办法将编译后的库还原成可读的Python源代码。</p><p id="e60a" class="pw-post-body-paragraph jy jz hi kb b kc kd ij ke kf kg im kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">让我向您介绍使用Cython进行Python源代码模糊处理的步骤。我们将使用一个简单的项目来展示这一点。</p><h2 id="547f" class="lq lr hi bd ls lt lu lv lw lx ly lz ma kv mb mc md kw me mf mg kx mh mi mj mk bi translated">演示代码混淆的示例代码</h2><p id="7502" class="pw-post-body-paragraph jy jz hi kb b kc ml ij ke kf mm im kh kv mn kk kl kw mo ko kp kx mp ks kt ku hb bi translated">我已经编写了一个基于python Flask的小代码，它将数字方程作为输入，验证该方程，如果有效，就解析该方程。没有什么逻辑，只是为了教程的目的。这个想法是为了展示业务逻辑的代码混淆。</p><h2 id="a3d9" class="lq lr hi bd ls lt lu lv lw lx ly lz ma kv mb mc md kw me mf mg kx mh mi mj mk bi translated">码基数</h2><ul class=""><li id="d19a" class="ky kz hi kb b kc ml kf mm kv mq kw mr kx ms ku ld le lf lg bi translated"><a class="ae ju" href="https://github.com/mohammedvaghjipurwala/code_obfuscation" rel="noopener ugc nofollow" target="_blank">https://github.com/mohammedvaghjipurwala/code_obfuscation</a></li></ul><p id="a8f4" class="pw-post-body-paragraph jy jz hi kb b kc kd ij ke kf kg im kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">代码回购看起来像…</p><pre class="jf jg jh ji fd mt lp mu mv aw mw bi"><span id="8cf1" class="lq lr hi lp b fi mx my l mz na">.<br/>├── README.md<br/>├── __init__.py<br/>├── main.py<br/>├── routes.py<br/>├── swagger.yml<br/>├── src<br/>│   ├── __init__.py<br/>│   └── solver.py<br/>└── compile.py</span></pre><h2 id="cce1" class="lq lr hi bd ls lt lu lv lw lx ly lz ma kv mb mc md kw me mf mg kx mh mi mj mk bi translated">代码走查</h2><ul class=""><li id="6f88" class="ky kz hi kb b kc ml kf mm kv mq kw mr kx ms ku ld le lf lg bi translated"><code class="du lm ln lo lp b">main.py</code>:这个文件是flask引导文件，flask app通过这个文件启动。</li><li id="962c" class="ky kz hi kb b kc lh kf li kv lj kw lk kx ll ku ld le lf lg bi translated"><code class="du lm ln lo lp b">routes.py</code>:该文件托管应用程序提供的所有API路由</li><li id="5ff8" class="ky kz hi kb b kc lh kf li kv lj kw lk kx ll ku ld le lf lg bi translated"><code class="du lm ln lo lp b">swagger.yml</code>:这个文件存放API细节，可以通过浏览器以格式化文档的形式访问。</li><li id="3e0b" class="ky kz hi kb b kc lh kf li kv lj kw lk kx ll ku ld le lf lg bi translated"><code class="du lm ln lo lp b">src/solver.py</code>:这个文件承载了验证等式的业务逻辑，如果有效，就求解等式。</li><li id="f788" class="ky kz hi kb b kc lh kf li kv lj kw lk kx ll ku ld le lf lg bi translated"><code class="du lm ln lo lp b">compile.py</code>:这个文件托管了从<code class="du lm ln lo lp b">.py</code>文件构建<code class="du lm ln lo lp b">.so</code>文件的代码库。</li></ul><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nb nc l"/></div><figcaption class="jq jr et er es js jt bd b be z dx"><a class="ae ju" href="https://github.com/mohammedvaghjipurwala/code_obfuscation/blob/main/compile.py" rel="noopener ugc nofollow" target="_blank">https://github.com/mohammedvaghjipurwala/code_obfuscation/blob/main/compile.py</a></figcaption></figure><h2 id="c19d" class="lq lr hi bd ls lt lu lv lw lx ly lz ma kv mb mc md kw me mf mg kx mh mi mj mk bi translated">代码执行</h2><p id="63b0" class="pw-post-body-paragraph jy jz hi kb b kc ml ij ke kf mm im kh kv mn kk kl kw mo ko kp kx mp ks kt ku hb bi translated">要运行Flask应用程序，请在终端中执行以下命令</p><pre class="jf jg jh ji fd mt lp mu mv aw mw bi"><span id="b862" class="lq lr hi lp b fi mx my l mz na">python main.py</span></pre><p id="c2c2" class="pw-post-body-paragraph jy jz hi kb b kc kd ij ke kf kg im kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">现在，您可以使用URL访问Swagger API文档</p><pre class="jf jg jh ji fd mt lp mu mv aw mw bi"><span id="dd39" class="lq lr hi lp b fi mx my l mz na">http://&lt;public-ip&gt;/ui</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nd"><img src="../Images/7496cc668f0d85d9001191556041f85b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A7byH9M_seeBtTZPud8mkw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Swagger</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ne"><img src="../Images/3cfb9eacb38f0e48912199cc68b08e91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gj2ZSJSl12VLXA5_gnH-kA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Success Response</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nf"><img src="../Images/fa2c939574c0c96c626886c2a5fe17fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ji2nfRZla-T2oczXvzIUZA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Error Response</figcaption></figure><h2 id="51e7" class="lq lr hi bd ls lt lu lv lw lx ly lz ma kv mb mc md kw me mf mg kx mh mi mj mk bi translated">运行compile.py</h2><p id="3899" class="pw-post-body-paragraph jy jz hi kb b kc ml ij ke kf mm im kh kv mn kk kl kw mo ko kp kx mp ks kt ku hb bi translated">根据您使用的Python版本，运行:</p><pre class="jf jg jh ji fd mt lp mu mv aw mw bi"><span id="f053" class="lq lr hi lp b fi mx my l mz na">python compile.py build_ext --inplace</span></pre><p id="080f" class="pw-post-body-paragraph jy jz hi kb b kc kd ij ke kf kg im kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">…或者，对于Python 3:</p><pre class="jf jg jh ji fd mt lp mu mv aw mw bi"><span id="d130" class="lq lr hi lp b fi mx my l mz na">python3 compile.py build_ext --inplace</span></pre><p id="4e85" class="pw-post-body-paragraph jy jz hi kb b kc kd ij ke kf kg im kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">上述命令将在您的<code class="du lm ln lo lp b">.py</code>源文件旁边生成<code class="du lm ln lo lp b">.so</code>和<code class="du lm ln lo lp b">.c</code>文件:</p><pre class="jf jg jh ji fd mt lp mu mv aw mw bi"><span id="cc23" class="lq lr hi lp b fi mx my l mz na">.<br/>├── README.md<br/>├── __init__.py<br/>├── main.py<br/>├── routes.py<br/>├── swagger.yml<br/>├── src<br/>│   ├── __init__.py<br/>│   ├── solver.py<br/>│   ├── solver.c<br/>│   └── solver.cpython-37m-x86_64-linux-gnu.so<br/>└── compile.py</span></pre><p id="d849" class="pw-post-body-paragraph jy jz hi kb b kc kd ij ke kf kg im kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><code class="du lm ln lo lp b">.c</code>文件是用于生成<code class="du lm ln lo lp b">.so</code>文件的中间源，这些文件是您想要分发的二进制模块。在Windows上构建时，这些文件可能会有<code class="du lm ln lo lp b">.pyd</code>扩展名。</p><p id="a48a" class="pw-post-body-paragraph jy jz hi kb b kc kd ij ke kf kg im kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">成功构建后，您可以删除<code class="du lm ln lo lp b">.pyc,</code> <code class="du lm ln lo lp b">.c</code>和<code class="du lm ln lo lp b">.py</code>文件，只保留<code class="du lm ln lo lp b">.so</code>文件。为此添加了一个方法。</p><p id="75eb" class="pw-post-body-paragraph jy jz hi kb b kc kd ij ke kf kg im kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">请注意<code class="du lm ln lo lp b">.so</code>-文件在其名称中包含目标平台(例如，在我的MacOS上为<code class="du lm ln lo lp b">darwin</code>)。显然，编译的模块不是跨平台的。如果你把你的程序分发给Ubuntu Linux用户，你应该在Linux上编译它。否则你将无法加载这些二进制文件。因此，您必须为每个目标平台编译特定于平台的代码版本。</p><p id="963f" class="pw-post-body-paragraph jy jz hi kb b kc kd ij ke kf kg im kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">该脚本的触发器可以添加到支持构建应用程序包的安装文件或docker文件中。需要运输的最终包将具有模糊的知识产权，这真的很难反向工程。</p></div><div class="ab cl ix iy gp iz" role="separator"><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc"/></div><div class="hb hc hd he hf"><h2 id="1424" class="lq lr hi bd ls lt lu lv lw lx ly lz ma kv mb mc md kw me mf mg kx mh mi mj mk bi translated">参考</h2><ul class=""><li id="7e4d" class="ky kz hi kb b kc ml kf mm kv mq kw mr kx ms ku ld le lf lg bi translated"><a class="ae ju" href="https://www.techtarget.com/searchsecurity/definition/obfuscation" rel="noopener ugc nofollow" target="_blank">https://www . techtarget . com/search security/definition/obfuscation</a></li><li id="cc2d" class="ky kz hi kb b kc lh kf li kv lj kw lk kx ll ku ld le lf lg bi translated"><a class="ae ju" rel="noopener" href="/@xpl/protecting-python-sources-using-cython-dcd940bb188e">https://medium . com/@ xpl/protecting-python-sources-using-cy thon-DCD 940 bb 188 e</a></li><li id="b48f" class="ky kz hi kb b kc lh kf li kv lj kw lk kx ll ku ld le lf lg bi translated"><a class="ae ju" href="https://gist.github.com/ctokheim/6c34dc1d672afca0676a" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/ctokheim/6c34dc1d672afca0676a</a></li></ul></div><div class="ab cl ix iy gp iz" role="separator"><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc"/></div><div class="hb hc hd he hf"><p id="79b1" class="pw-post-body-paragraph jy jz hi kb b kc kd ij ke kf kg im kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">如果你觉得这个博客有用，请鼓掌👏或者评论💬。欢迎任何反馈或建设性的批评🙌。</p><p id="8d79" class="pw-post-body-paragraph jy jz hi kb b kc kd ij ke kf kg im kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">你可以在<a class="ae ju" href="https://in.linkedin.com/in/mohammed-vaghjipurwala-aab561b9" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或<a class="ae ju" href="https://twitter.com/mohammedhv" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或下面的评论区联系我。</p></div><div class="ab cl ix iy gp iz" role="separator"><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc"/></div><div class="hb hc hd he hf"><blockquote class="jv jw jx"><p id="7716" class="jy jz ka kb b kc kd ij ke kf kg im kh ki kj kk kl km kn ko kp kq kr ks kt ku hb bi translated">快乐编码..！！！<em class="hi">💻</em></p></blockquote></div></div>    
</body>
</html>