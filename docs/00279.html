<html>
<head>
<title>How to Calculate Server Max Requests per Second</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何计算服务器每秒最大请求数</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-calculate-server-max-requests-per-second-38a39bb96a85?source=collection_archive---------1-----------------------#2020-12-31">https://medium.com/geekculture/how-to-calculate-server-max-requests-per-second-38a39bb96a85?source=collection_archive---------1-----------------------#2020-12-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="03be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于如何计算服务器每秒可以处理的最大请求的初学者指南。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/65a65ca062f37dac202151e074456589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KI7PqZlL98w2zNLmLUELfg.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">A telephone booth can only handle one telephone call at a time.</figcaption></figure><p id="efbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建新服务之前的一个重要部分叫做容量规划。在此过程中，我们计算服务需要多少资源才能处理预计的流量。</p><p id="2bc4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通俗地说，这个计划就像为一群人计划一次旅行，知道有多少人要去，可以帮助你决定旅行需要多少辆车。比方说，有10个人，每辆车最多可以坐5个人，这意味着这次旅行你至少需要2辆车。</p><p id="0ef6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">服务器呢？假设您预计最多有10000个RPS，您如何计算服务器的大小？为此，您需要了解<em class="jt">“汽车”</em>或服务器，它能处理多少请求？</p><p id="d014" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在进行任何实际计算之前，我们有必要知道边界或服务器限制，因为服务器只有有限数量的资源，就像汽车一样。这些界限是什么？</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="d7d5" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">CPU限制</h1><p id="f33b" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">电脑可以做计算。这个计算需要CPU工作。处理图像和将字符串转换为字节是需要计算的过程的例子。因此，限制因素是机器的CPU能力。<strong class="ih hj"> <em class="jt">这里的限制是CPU的能力和内核数量。</em> </strong>基本上，更多的内核等于更多的工人。工人越多，意味着可以完成的任务越多，RPS越高。</p><p id="1825" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在CPU受限的系统中，我们可以使用以下公式计算RP的数量:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es le"><img src="../Images/2b5830ee8005dbaba670cf236dd52bfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Fv4M2cAfb2hYLTLxDjfmg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">RPS for CPU bound system</figcaption></figure><p id="f8fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，内核总数为4且任务持续时间为10ms的服务器可以处理400个RPS，而任务持续时间为100ms的同一服务器只能处理40个RPS。</p><h1 id="f62a" class="kb kc hi bd kd ke lf kg kh ki lg kk kl km lh ko kp kq li ks kt ku lj kw kx ky bi translated">受记忆限制</h1><p id="6235" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">计算机需要信息或数据才能工作。它从数据库中获取数据，读取文件，或者通过调用另一台计算机从网络上获取数据。在等待数据时，CPU大部分时间什么也不做。由于一台计算机可以有多个工作线程，因此当一个工作线程等待前一个进程完成时，其他工作线程仍然可以执行该任务。</p><p id="1e11" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上一部分中，我们知道计算机受工作人员数量的限制，但是在对数据本身进行任何操作之前，计算机需要将数据存储在内存中。<strong class="ih hj"> <em class="jt">这里的极限是RAM </em>。基本上，更多的内存意味着更多的工人。工人越多，意味着可以完成的任务越多，RPS越高。</strong></p><p id="222a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在内存受限的系统中，我们可以使用以下公式计算RP的数量:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lk"><img src="../Images/89af3d1b62012f703b0f759216b24d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vPEGUklMwb-W4iMCr5xHEQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">RPS for memory-bound system</figcaption></figure><p id="e5cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，总RAM为16Gb、任务内存使用量为40Mb、任务持续时间为100毫秒的服务器可以处理4000个RPS，而任务持续时间为50毫秒(是之前的一半)的服务器可以处理8000个RPS。</p><blockquote class="ll lm ln"><p id="57b5" class="if ig jt ih b ii ij ik il im in io ip lo ir is it lp iv iw ix lq iz ja jb jc hb bi translated">为了有更多的RPS，服务器需要有更多的RAM，更小的任务内存使用，和更快的任务持续时间。</p></blockquote><h1 id="4242" class="kb kc hi bd kd ke lf kg kh ki lg kk kl km lh ko kp kq li ks kt ku lj kw kx ky bi translated">输入输出绑定</h1><p id="4a5c" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">一台计算机可以和另一台计算机对话。要与另一台计算机对话，计算机需要创建一个请求，而接收计算机需要接受该请求。在基于UNIX的计算机中，创建和接受请求都会创建一个文件描述符。一台计算机的文件描述符数量有限。<strong class="ih hj"> <em class="jt">这里的限制是打开文件的限制</em> </strong>。打开文件限制有软限制和硬限制。</p><blockquote class="ll lm ln"><p id="54a6" class="if ig jt ih b ii ij ik il im in io ip lo ir is it lp iv iw ix lq iz ja jb jc hb bi translated"><strong class="ih hj">软限制</strong>是那些实际影响过程的软限制；<strong class="ih hj">硬限制</strong>是<strong class="ih hj">软限制</strong>的最大<strong class="ih hj">值。任何用户或过程都可以将<strong class="ih hj">软限制</strong>提高到<strong class="ih hj">硬限制</strong>的值。</strong></p></blockquote><p id="b6ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些限制高度依赖于操作系统。默认情况下，软限制为1024，硬限制为4096。打开文件限制是一个常见的限制，即使服务器仍然有CPU和内存使用空间，也不会出现RPS。打开文件限制越高，意味着可以接收和发出的请求越多，从而导致RPS越高。</p><p id="58db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一种不同的I/O限制是网络带宽。请记住，当一台计算机与另一台计算机对话时，它基本上是从一台计算机向另一台计算机发送数据。当服务器是数据密集型的，接收或发送Gb大小的数据，但只有Mb大小的网络带宽时，它只有在RPS非常低时才正常。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="f7fb" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">计算系统负载</h1><p id="f66c" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">通常情况下，服务器遵循一个起伏模式，晚上负载降低，白天负载增加到某个点，停留一段时间，然后再次降低。为了计算系统负载，我们需要知道在一段持续的时间内，每秒钟到达的最大请求数。</p><p id="a574" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">比方说，我们预计360万个传入请求将在1小时内到达，这意味着服务器需要处理1000个RPS，公式如下:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lr"><img src="../Images/b41d1b213badbf2f0b9a013c25290fc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nr46TElf8EHYntk_bMAIhQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">RPS is total requests divided by the duration to finish the task</figcaption></figure><p id="e421" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设一台服务器需要10ms来完成每个要求，而我们有一台4核服务器，这意味着我们的服务器只能处理400 RPS。在这种情况下，我们需要至少3个使用公式的实例:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/98526ff09220becb1499b6dcbdc025ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5S80KcgolUfNWIha_2fI9w.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Number of cores is RPS times the duration to finish the task</figcaption></figure><p id="cbd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们知道我们至少需要3个实例，每个实例只处理400个RPS，我们预计每个请求需要3.6Gb的内存，我们可以得出结论，我们需要一个4Gb RAM大小的服务器，使用公式:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/7f0ba6a0cc577a49cd8a63bb2b751f25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d5xp3raYfHbcsYdsW-u0sw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">RAM size is RPS times task memory usages times the duration to finish the task</figcaption></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="4323" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，如您所见，我们需要对请求总数、处理一个请求需要多长时间以及每个请求需要多少内存进行大量有根据的猜测。因此，这种计算应该仅用于容量规划。对于实际情况，最好还是做一些负载测试，以了解我们每台服务器的当前RPS限制，因为大多数时候一台服务器依赖于另一台服务器的性能，瓶颈本身可能不在您的服务内部，而是在底层服务上。</p><p id="9f02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧，我们完成了。现在，你们应该对服务器RPS有了更好的理解，界限是什么，如何计算处理一定数量的请求所需的服务器。</p></div></div>    
</body>
</html>