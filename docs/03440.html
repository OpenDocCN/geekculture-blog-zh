<html>
<head>
<title>Exploring DVC for machine learning pipelines in research</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索研究中机器学习管道的DVC</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/exploring-dvc-for-machine-learning-pipelines-in-research-part-1-3ebc2ca35a18?source=collection_archive---------18-----------------------#2021-06-08">https://medium.com/geekculture/exploring-dvc-for-machine-learning-pipelines-in-research-part-1-3ebc2ca35a18?source=collection_archive---------18-----------------------#2021-06-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c9e412d13a0c5384063f772d272c6919.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ybdJ3iFu2wR2KVBMg389wA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx"><strong class="bd iu">Cover:</strong> <a class="ae iv" href="http://www.isfdb.org/cgi-bin/title.cgi?2553372" rel="noopener ugc nofollow" target="_blank">The Robot Men of Bubble City</a> by <a class="ae iv" href="http://www.isfdb.org/cgi-bin/ea.cgi?24744" rel="noopener ugc nofollow" target="_blank">James B. Settles</a> (variant of <a class="ae iv" href="http://www.isfdb.org/cgi-bin/title.cgi?148260" rel="noopener ugc nofollow" target="_blank"><em class="iw">Fantastic Adventures, July 1949</em></a> 1949)</figcaption></figure><p id="86ec" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">这是我的dvc系列教程的第一部分。(正在进行中的工作)</p><p id="e6cc" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">在过去的几个月里，我工作的一部分变成了为我们在<a class="ae iv" href="https://www.helmholtz.ai" rel="noopener ugc nofollow" target="_blank"> HelmholtzAI </a>的团队查看不同的工具来管理机器学习工作流。在这个过程中积累了很多材料，因此我决定分享一些过程和我所学到的东西。</p><p id="dcf6" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">这个想法是分享比较过程本身，但也围绕具体的工具实践教程。我将从后者开始，因为它可以独立阅读，总体评估仍在进行中。</p><p id="ff25" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">让我们从探索<a class="ae iv" href="https://dvc.org" rel="noopener ugc nofollow" target="_blank"> DVC </a>开始，它成为了我们最终的候选之一。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><blockquote class="kd"><p id="b321" class="ke kf hi bd kg kh ki kj kk kl km ju dx translated">DVC(数据版本控制)基本上是扩展到机器学习(和类似管道)用例的版本控制</p></blockquote><p id="bfb0" class="pw-post-body-paragraph ix iy hi iz b ja kn jc jd je ko jg jh ji kp jk jl jm kq jo jp jq kr js jt ju hb bi translated">我们将深入学习一个教程，它解决了评估框架适用性的不同重要方面。在探索了基础知识之后，我希望能够分享一个真实的应用实例。</p><p id="a38a" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">你可以在我们的<a class="ae iv" href="https://github.com/hzdr/dvc_tutorial_series" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到代码并跟随。:)</p><p id="c3d2" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">我决定分享我的一般方法和为什么教程是这样设计的——如果你只对代码感兴趣，可以直接跳到<strong class="iz hj"> DVC教程部分。</strong></p><h2 id="7bc9" class="ks kt hi bd iu ku kv kw kx ky kz la lb ji lc ld le jm lf lg lh jq li lj lk ll bi translated"><strong class="ak">用例</strong></h2><p id="deaf" class="pw-post-body-paragraph ix iy hi iz b ja lm jc jd je ln jg jh ji lo jk jl jm lp jo jp jq lq js jt ju hb bi translated">选择工具的一个重要方面是始终牢记您的用例。我目前在一家研究机构工作，因此我们的用例包括大型科学数据集、定制基础架构(自有数据中心、HPC)以及对可再现性的特殊需求。基于此，工具必须勾选的框是:</p><p id="0d38" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj"> <em class="jv">重现性:</em> </strong> <em class="jv"> </em>可验证的结果对于研究来说至关重要。如果结果是通过在任何地方使用ML得到的，那么这一部分对于独立的研究者来说也必须是可重复的。一个典型的ML项目包含代码、(几个)数据集、各种参数、(几个)模型、进一步的不同实验等等..</p><p id="df00" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj"> <em class="jv">工作流集成:</em> </strong>由于该工具可能会被IT专业人员和科学家使用，因此它需要尽可能地无创——你不能指望一个拥有一些基本编码技能的科学家将特定于框架的代码从ML代码中分离出来。</p><p id="f084" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj"> <em class="jv">可交换后端:</em> </strong>我们有自己的数据中心和云基础设施，因此工具必须能够与定制存储解决方案配合使用。</p><p id="d80f" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj"> <em class="jv">框架不可知:</em> </strong>它不应该关心我们是使用pytorch、tensorflow还是自定义库。如果它也是语言不可知的，这将是首选。</p><p id="50e0" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj"> <em class="jv">开源:</em> </strong>我们认为应该做的事情，并支持。此外，通常更容易适应客户需求。</p><p id="d067" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj"> <em class="jv">其他:</em> </strong>我们更喜欢能够根据自己的需求进行调整的解决方案。此外，预算也很重要。</p><h1 id="6aea" class="lr kt hi bd iu ls lt lu kx lv lw lx lb ly lz ma le mb mc md lh me mf mg lk mh bi translated"><strong class="ak">教程设置</strong></h1><p id="5b2c" class="pw-post-body-paragraph ix iy hi iz b ja lm jc jd je ln jg jh ji lo jk jl jm lp jo jp jq lq js jt ju hb bi translated">当测试多个框架时，需要一个共同的基础。示例应该在不同的测试场景中保持一致，并在必要时进行调整——每个工具都以不同的方式集成到代码中。这是这个想法的大致框架:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="6ba2" class="ks kt hi mn b fi mr ms l mt mu"><strong class="mn hj">Pipeline: </strong><br/>- integrate $tool into workflow<br/>- run ml-pipeline with $tool<br/><strong class="mn hj">Parameters:</strong><br/>Test logging, altering and retrieving:<br/>- parameter 1 (val0, val1, val2)<br/>- parameter 2 (val0, val1, val2)<br/><strong class="mn hj">Metrics:</strong><br/>Test logging, exchanging and retrieving:<br/>- metric 1 .. metric n<br/><strong class="mn hj">Models:</strong><br/>Test exchangeability of models<br/>- model 1 (type, parameters, metrics)<br/>- model 2 (type, parameters, metrics)<br/><strong class="mn hj">Dataset:</strong><br/>Storing, altering, versioning and retrieving<br/>- small dataset (PoC)<br/>- large dataset</span></pre></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="ee27" class="lr kt hi bd iu ls mv lu kx lv mw lx lb ly mx ma le mb my md lh me mz mg lk mh bi translated"><strong class="ak">例子</strong></h1><p id="a761" class="pw-post-body-paragraph ix iy hi iz b ja lm jc jd je ln jg jh ji lo jk jl jm lp jo jp jq lq js jt ju hb bi translated">为了使用一些(相对)官方的和经过良好测试的东西，我决定利用在另一个工具<a class="ae iv" href="https://mlflow.org/" rel="noopener ugc nofollow" target="_blank"> MLflow </a>的教程部分找到的<a class="ae iv" href="https://www.mlflow.org/docs/latest/tutorials-and-examples/tutorial.html" rel="noopener ugc nofollow" target="_blank">示例</a>，它也是我们的热门候选工具之一。</p><p id="8c15" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">事实证明，这个例子需要更仔细的检查和调整。因为理解一个人在做什么总是很有趣的，你可以在这里找到一些关于例子本身的附加信息。</p><p id="2099" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">我们开始工作吧！</p><h2 id="2370" class="ks kt hi bd iu ku kv kw kx ky kz la lb ji lc ld le jm lf lg lh jq li lj lk ll bi translated"><strong class="ak"> DVC教程</strong></h2><p id="f8dd" class="pw-post-body-paragraph ix iy hi iz b ja lm jc jd je ln jg jh ji lo jk jl jm lp jo jp jq lq js jt ju hb bi translated">我目前使用OSX，用<a class="ae iv" href="https://docs.conda.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> conda </a>管理我的环境。你可以在资源库中找到一个非常基本的<strong class="iz hj">environment . yml</strong><em class="jv"/>，它列出了你需要的额外的包。</p><p id="dea0" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">开始之前，确保在您的工作环境中已经安装了DVC。</p><p id="1af5" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">有时我会在命令块中添加一个命令输出，以便更好地理解。</p><h2 id="3a6e" class="ks kt hi bd iu ku kv kw kx ky kz la lb ji lc ld le jm lf lg lh jq li lj lk ll bi translated"><strong class="ak">准备</strong></h2><p id="9a07" class="pw-post-body-paragraph ix iy hi iz b ja lm jc jd je ln jg jh ji lo jk jl jm lp jo jp jq lq js jt ju hb bi translated">转到您选择的项目目录并克隆存储库:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="9eaf" class="ks kt hi mn b fi mr ms l mt mu">git clone <a class="ae iv" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:hzdr/dvc_tutorial_series.git</span></pre><p id="1869" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">切换到源目录并初始化git和dvc:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="34d2" class="ks kt hi mn b fi mr ms l mt mu">cd dvc_tutorial_series/src</span><span id="38db" class="ks kt hi mn b fi na ms l mt mu">git init</span><span id="efe0" class="ks kt hi mn b fi na ms l mt mu">dvc init</span></pre><p id="a68a" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">添加要使用的远程存储(在这种情况下，我们将留在本地机器上):</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="4095" class="ks kt hi mn b fi mr ms l mt mu">mkdir /tmp/dvc_demo_test</span><span id="958a" class="ks kt hi mn b fi na ms l mt mu">dvc remote add -d localremote /tmp/dvc_demo_test</span><span id="08ed" class="ks kt hi mn b fi na ms l mt mu">dvc remote list</span></pre><blockquote class="kd"><p id="080a" class="ke kf hi bd kg kh nb nc nd ne nf ju dx translated">DVC将有关添加数据的信息存储在一个名为wine-quality.csv.dvc的特殊文件中，这是一个可读格式的小文本文件。我们可以用Git将这个文件版本化为源代码，作为原始数据(列在`. gitignore `中)的占位符</p></blockquote><p id="fd28" class="pw-post-body-paragraph ix iy hi iz b ja kn jc jd je ko jg jh ji kp jk jl jm kq jo jp jq kr js jt ju hb bi translated">查看内容:(<a class="ae iv" href="https://github.com/sharkdp/bat" rel="noopener ugc nofollow" target="_blank"> bat </a>只是我的首选^^)</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="b709" class="ks kt hi mn b fi mr ms l mt mu">bat .gitignore</span><span id="3af5" class="ks kt hi mn b fi na ms l mt mu">bat wine-quality.csv.dvc</span></pre><p id="37e3" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">将数据添加到dvc，将占位符文件添加到git:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="6f76" class="ks kt hi mn b fi mr ms l mt mu">dvc add wine-quality.csv</span><span id="e6f5" class="ks kt hi mn b fi na ms l mt mu">git add wine-quality.csv.dvc</span></pre><p id="cf9b" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">将我们的示例代码添加到git中(健全性检查总是一个好主意):</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="a1f2" class="ks kt hi mn b fi mr ms l mt mu">git status</span><span id="6c8c" class="ks kt hi mn b fi na ms l mt mu">git add .</span><span id="15cb" class="ks kt hi mn b fi na ms l mt mu">git commit -m “fresh experiment started”</span></pre><p id="7efa" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">将数据推送到dvc(本地)存储器:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="6304" class="ks kt hi mn b fi mr ms l mt mu">dvc push</span><span id="5df8" class="ks kt hi mn b fi na ms l mt mu">~Output:<br/>  1 file pushed</span></pre><p id="eda5" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">检查输出:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="4310" class="ks kt hi mn b fi mr ms l mt mu">ls -R /tmp/dvc_demo_test</span><span id="b186" class="ks kt hi mn b fi na ms l mt mu">~Output:<br/>  17<br/>  /tmp/dvc_demo_test/17:<br/>  fbffe83c746612cc247b182e9f7278</span></pre></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h2 id="9166" class="ks kt hi bd iu ku kv kw kx ky kz la lb ji lc ld le jm lf lg lh jq li lj lk ll bi translated"><strong class="ak">测试管道</strong></h2><p id="0fc1" class="pw-post-body-paragraph ix iy hi iz b ja lm jc jd je ln jg jh ji lo jk jl jm lp jo jp jq lq js jt ju hb bi translated">执行<a class="ae iv" href="https://dvc.org/doc/command-reference/run" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj"> dvc运行</strong> </a> <strong class="iz hj"> </strong>创建阶段。阶段是管道的独特步骤，可以通过git进行跟踪。</p><p id="db80" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">阶段还将代码连接到其数据输入和输出(类似于<a class="ae iv" href="https://snakemake.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> Snakemake </a>)。</p><p id="b788" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">具有所有相关依赖关系和参数的阶段被写入一个名为<em class="jv">DVC . YAML</em>T15】的特殊<a class="ae iv" href="https://dvc.org/doc/user-guide/project-structure/pipelines-files" rel="noopener ugc nofollow" target="_blank">管道文件。</a></p><p id="7f18" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">我将代码分成不同的脚本来演示分段和流水线过程。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="2273" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">创建数据集</strong></p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="7f4c" class="ks kt hi mn b fi mr ms l mt mu">dvc run -f -n prepare\</span><span id="1e5a" class="ks kt hi mn b fi na ms l mt mu">-d create_dataset.py \</span><span id="7751" class="ks kt hi mn b fi na ms l mt mu">-o assets/data \</span><span id="67bc" class="ks kt hi mn b fi na ms l mt mu">python create_dataset.py</span></pre><p id="e70b" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj"> -n </strong>舞台的名称</p><p id="6604" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj"> -d </strong>这个阶段的附属国</p><p id="6136" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj"> -o </strong>结果输出</p><p id="a029" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">特征化</strong></p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="a188" class="ks kt hi mn b fi mr ms l mt mu">dvc run -f -n featurize \</span><span id="3611" class="ks kt hi mn b fi na ms l mt mu">-d create_features.py \</span><span id="4c37" class="ks kt hi mn b fi na ms l mt mu">-d assets/data \</span><span id="d85f" class="ks kt hi mn b fi na ms l mt mu">-o assets/features \</span><span id="4df0" class="ks kt hi mn b fi na ms l mt mu">python create_features.py</span></pre><p id="2bf8" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">..如我们所见，我们现在有两个依赖项，特征创建脚本和上一步的输出。</p><p id="2f97" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">列车型号</strong></p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="2b7b" class="ks kt hi mn b fi mr ms l mt mu">dvc run -f -n train \</span><span id="8e42" class="ks kt hi mn b fi na ms l mt mu">-d train_model.py \</span><span id="6834" class="ks kt hi mn b fi na ms l mt mu">-d assets/features \</span><span id="04ea" class="ks kt hi mn b fi na ms l mt mu">-o assets/models \</span><span id="cdc3" class="ks kt hi mn b fi na ms l mt mu">-p model_type,random_state,train \</span><span id="52a1" class="ks kt hi mn b fi na ms l mt mu">python train_model.py</span></pre><p id="e606" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj"> -p </strong>使用<em class="jv"> parameters.yaml </em>文件中指定的<strong class="iz hj"> </strong>参数</p><p id="7625" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">快速浏览<em class="jv">参数. yaml: </em></p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="8c2b" class="ks kt hi mn b fi mr ms l mt mu">model_type: ElasticNet<br/>lr: 0.0041<br/>random_state: 42</span><span id="4ee9" class="ks kt hi mn b fi na ms l mt mu">train:<br/>  epochs: 70<br/>  alpha: 0.01<br/>  l1_rate: 0.5</span></pre><p id="926a" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">评估模型</strong></p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="bcb3" class="ks kt hi mn b fi mr ms l mt mu">dvc run -f -n evaluate \</span><span id="3026" class="ks kt hi mn b fi na ms l mt mu">-d evaluate_model.py \</span><span id="bf52" class="ks kt hi mn b fi na ms l mt mu">-d assets/features \</span><span id="dbf9" class="ks kt hi mn b fi na ms l mt mu">-d assets/models \</span><span id="2aac" class="ks kt hi mn b fi na ms l mt mu">-p model_type \</span><span id="13ba" class="ks kt hi mn b fi na ms l mt mu">-M assets/metrics.json \</span><span id="bd14" class="ks kt hi mn b fi na ms l mt mu">python evaluate_model.py</span></pre><p id="ae95" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj"> -M </strong>将指标写入指定的输出目的地，在我们的示例中为mean_squared_error、mean_absolute_error、r2_score</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="cad9" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">现在，让我们跟踪我们的变化:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="b9d8" class="ks kt hi mn b fi mr ms l mt mu">git add assets/.gitignore dvc.yaml dvc.lock</span><span id="1598" class="ks kt hi mn b fi na ms l mt mu">git commit -m “added stages to demo_test”</span></pre><p id="0116" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><em class="jv"> dvc.yaml </em>现在<em class="jv"> </em>包含了关于我们运行的命令、其依赖项和输出的信息。</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="ba0c" class="ks kt hi mn b fi mr ms l mt mu">bat dvc.yaml</span><span id="5887" class="ks kt hi mn b fi na ms l mt mu">~Output:<br/>stages:<br/>  prepare:<br/>    cmd: python create_dataset.py<br/>    deps:<br/>    - create_dataset.py<br/>    outs:<br/>    - assets/data<br/>  featurize:<br/>    cmd: python create_features.py<br/>    deps:<br/>    - assets/data<br/>    - create_features.py<br/>    outs:<br/>    - assets/features<br/>  train:<br/>    cmd: python train_model.py<br/>    deps:<br/>    - assets/features<br/>    - train_model.py<br/>    params:<br/>    - model_type<br/>    - random_state<br/>    - train<br/>    outs:<br/>    - assets/models<br/>  evaluate:<br/>    cmd: python evaluate_model.py<br/>    deps:<br/>    - assets/features<br/>    - assets/models<br/>    - evaluate_model.py<br/>    params:<br/>    - model_type<br/>    metrics:<br/>    - assets/metrics.json:<br/>        cache: false</span></pre><p id="5481" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">没有必要使用<a class="ae iv" href="https://dvc.org/doc/command-reference/add" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj"> dvc为dvc添加</strong> </a>来跟踪阶段输出，<a class="ae iv" href="https://dvc.org/doc/command-reference/run#run" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj"> dvc运行</strong> </a>已经解决了这个问题。</p><p id="8fde" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">你只需要运行<a class="ae iv" href="https://dvc.org/doc/command-reference/push" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj"> dvc推送</strong> </a>就可以把它们保存到远程存储。(在我们的例子中，我们寻址我们的本地存储)</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="06dd" class="ks kt hi mn b fi mr ms l mt mu">dvc push</span><span id="e36b" class="ks kt hi mn b fi na ms l mt mu">~Output:<br/>  8 files pushed</span></pre><p id="68dc" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">检查dvc推送:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="48d8" class="ks kt hi mn b fi mr ms l mt mu">ls -R /tmp/dvc_demo_test</span></pre><h2 id="3eac" class="ks kt hi bd iu ku kv kw kx ky kz la lb ji lc ld le jm lf lg lh jq li lj lk ll bi translated"><strong class="ak">测试参数变化</strong></h2><p id="b86a" class="pw-post-body-paragraph ix iy hi iz b ja lm jc jd je ln jg jh ji lo jk jl jm lp jo jp jq lq js jt ju hb bi translated">创建阶段和dvc.yaml文件的全部目的是为了在发生变化时能够重现和轻松运行管道。</p><p id="bfce" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">当执行<a class="ae iv" href="https://dvc.org/doc/command-reference/repro" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj"> dvc再现</strong> </a> <strong class="iz hj"> </strong>而不改变代码库或参数时:</p><p id="27d9" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">..什么都没发生</p><p id="6d37" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">现在让我们打开<em class="jv"> params.yaml </em>并更改一些参数(例如alpha从0.01到0.1)并重新运行管道。</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="46ec" class="ks kt hi mn b fi mr ms l mt mu">dvc repro</span><span id="fd3f" class="ks kt hi mn b fi na ms l mt mu">~ Output:<br/> Stage ‘prepare’ didn’t change, skipping<br/> Stage ‘featurize’ didn’t change, skipping<br/> Running stage ‘train’:<br/>   &gt; python train_model.py</span><span id="b14b" class="ks kt hi mn b fi na ms l mt mu"> Updating lock file ‘dvc.lock’<br/> <br/> To track the changes with git, run:<br/>  git add dvc.lock</span><span id="01d4" class="ks kt hi mn b fi na ms l mt mu"> Use `dvc push` to send your updates to the remote storage.</span></pre><p id="da9a" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">看看我们上次提交和当前运行之间的变化:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="c927" class="ks kt hi mn b fi mr ms l mt mu">dvc params diff — all</span><span id="c582" class="ks kt hi mn b fi na ms l mt mu">~Output:<br/> Path Param Old New<br/> params.yaml lr 0.0041 0.0041<br/> params.yaml model_type ElasticNet ElasticNet<br/> params.yaml random_state 42 42<br/> params.yaml train.alpha 0.01 0.1<br/> params.yaml train.epochs 70 70<br/> params.yaml train.l1_rate 0.5 0.5</span></pre><p id="73c6" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">让我们跟踪我们的变化:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="75bf" class="ks kt hi mn b fi mr ms l mt mu">git add dvc.lock params.yaml</span><span id="57e3" class="ks kt hi mn b fi na ms l mt mu">git commit -m “changed alpha parameter”</span></pre><p id="f595" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">为了方便起见，我们可以通过执行<a class="ae iv" href="https://dvc.org/doc/command-reference/dag#dag" rel="noopener ugc nofollow" target="_blank"><strong class="iz hj">DVC Dag</strong></a><strong class="iz hj">:</strong>将阶段打印成图形</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="96a8" class="ks kt hi mn b fi mr ms l mt mu">+---------+<br/>         | prepare |<br/>         +---------+<br/>              *<br/>              *<br/>              *<br/>        +-----------+<br/>        | featurize |<br/>        +-----------+<br/>         **        **<br/>       **            *<br/>      *               **<br/>+-------+               *<br/>| train |             **<br/>+-------+            *<br/>         **        **<br/>           **    **<br/>             *  *<br/>        +----------+<br/>        | evaluate |<br/>        +----------+<br/>+----------------------+<br/>| wine-quality.csv.dvc |</span></pre><p id="e10f" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">当给定适当的结构时，DVC自动确定项目的哪些部分需要重新运行。运行及其结果被缓存，以避免不必要的阶段重新运行。(自动化)</p><p id="f1fd" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><a class="ae iv" href="https://dvc.org/doc/user-guide/project-structure/pipelines-files" rel="noopener ugc nofollow" target="_blank"><em class="jv">DVC . YAML</em></a><em class="jv"/>和<a class="ae iv" href="https://dvc.org/doc/user-guide/project-structure/pipelines-files#dvclock-file" rel="noopener ugc nofollow" target="_blank"> <em class="jv"> dvc.lock </em> </a>文件描述了使用什么数据以及哪些命令将生成流水线结果。这些文件可以通过git进行版本控制和共享。(再现性)</p><h2 id="1b10" class="ks kt hi bd iu ku kv kw kx ky kz la lb ji lc ld le jm lf lg lh jq li lj lk ll bi translated"><strong class="ak">测试指标变化</strong></h2><p id="d3e8" class="pw-post-body-paragraph ix iy hi iz b ja lm jc jd je ln jg jh ji lo jk jl jm lp jo jp jq lq js jt ju hb bi translated">我们目前使用均方误差(RMSE)和平均绝对误差(MAE)作为度量</p><p id="5e79" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">运行评估管道后<em class="jv"> assets/metrics.json </em>的内容:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="68a9" class="ks kt hi mn b fi mr ms l mt mu">{“rmse”: 0.10888875839569741, “mae”: 0.08314237592519587}</span></pre><p id="f69a" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">现在，让我们将r2_score (R2)添加到我们的<a class="ae iv" href="https://github.com/hzdr/dvc_tutorial_series/blob/master/src/evaluate_model.py" rel="noopener ugc nofollow" target="_blank"><strong class="iz hj">evaluate _ model . py</strong></a>脚本中，并重新运行这些阶段。Dvc意识到脚本被修改过，只重新运行了一个阶段:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="b9a8" class="ks kt hi mn b fi mr ms l mt mu">dvc repro</span><span id="7428" class="ks kt hi mn b fi na ms l mt mu">~Output:<br/> Stage ‘prepare’ didn’t change, skipping<br/> Stage ‘featurize’ didn’t change, skipping<br/> Stage ‘train’ didn’t change, skipping<br/> Running stage ‘evaluate’:<br/>  &gt; python evaluate_model.py<br/> <br/>Updating lock file ‘dvc.lock’</span></pre><p id="537c" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">这次，<em class="jv"> assets/metrics.json </em>看起来是这样的:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="57f8" class="ks kt hi mn b fi mr ms l mt mu">{“rmse”: 0.10888875839569741, “mae”: 0.08314237592519587, “r2”: 0.9829560472003764}</span></pre><h2 id="0740" class="ks kt hi bd iu ku kv kw kx ky kz la lb ji lc ld le jm lf lg lh jq li lj lk ll bi translated"><strong class="ak">测试数据集变化</strong></h2><p id="9e19" class="pw-post-body-paragraph ix iy hi iz b ja lm jc jd je ln jg jh ji lo jk jl jm lp jo jp jq lq js jt ju hb bi translated">一开始，我们创建了一个(本地)远程存储，并执行<a class="ae iv" href="https://dvc.org/doc/command-reference/push#push" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj"> dvc push </strong> </a>将本地缓存的数据复制到那个存储。</p><p id="06ca" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">让我们检查一下它是否在那里:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="8e17" class="ks kt hi mn b fi mr ms l mt mu">ls -R /tmp/dvc_demo_test</span><span id="177a" class="ks kt hi mn b fi na ms l mt mu">~Output:<br/> /tmp/dvc_demo_test/17:<br/> fbffe83c746612cc247b182e9f7278</span><span id="6cdb" class="ks kt hi mn b fi na ms l mt mu"> /tmp/dvc_demo_test/1a:<br/> 240023ddb507d979001525a8ec2669<br/>..</span></pre><p id="2dbe" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">我们在这里可以看到几个哈希，那么哪个是我们实际的数据呢？</p><p id="d0ce" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">查看<em class="jv"> wine-quality.csv.dvc </em>可以发现:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="a176" class="ks kt hi mn b fi mr ms l mt mu">- md5: <strong class="mn hj">17</strong>fbffe83c746612cc247b182e9f7278</span></pre><p id="62ad" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">因此，第一个条目包含我们的数据。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="a5ba" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">现在让我们测试一下检索的效果..</p><p id="8ed6" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">首先，删除缓存和原始数据:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="717b" class="ks kt hi mn b fi mr ms l mt mu">rm -rf .dvc/cache</span><span id="5de1" class="ks kt hi mn b fi na ms l mt mu">rm -f wine-quality.csv</span></pre><p id="132a" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">然后，从存储器中获取数据:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="2114" class="ks kt hi mn b fi mr ms l mt mu">dvc pull</span><span id="2352" class="ks kt hi mn b fi na ms l mt mu">~Output:<br/> A wine-quality.csv<br/> 1 file added and 6 files fetched</span></pre><p id="49e5" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">现在让我们通过在<em class="jv"> wine-quality.csv </em>的开头添加一个额外的虚拟瓶子来改变数据集..</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="ad92" class="ks kt hi mn b fi mr ms l mt mu">“fixed acidity”,”volatile acidity”,”citric acid”,”residual sugar”,”chlorides”,”free sulfur dioxide”,”total sulfur dioxide”,”density”,”pH”,”sulphates”,”alcohol”,”quality”</span><span id="e01e" class="ks kt hi mn b fi na ms l mt mu"><strong class="mn hj">7.1,0.28,0.33,19.7,0.046,45,170,1.001,3,0.45,8.8,6 #our fake bottle</strong></span><span id="b7a6" class="ks kt hi mn b fi na ms l mt mu">7,0.27,0.36,20.7,0.045,45,170,1.001,3,0.45,8.8,6</span></pre><p id="099f" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">..并将实际版本添加到存储中:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="8126" class="ks kt hi mn b fi mr ms l mt mu">dvc add wine-quality.csv</span><span id="413e" class="ks kt hi mn b fi na ms l mt mu">~Output:<br/> 100% Add|  ████████████████████████████████████████████████████████████████████████████████████████████████████|1/1 [00:08, 8.27s/file]</span></pre><p id="8b29" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">用git跟踪变更..</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="1b4e" class="ks kt hi mn b fi mr ms l mt mu">git add wine-quality.csv.dvc</span><span id="5552" class="ks kt hi mn b fi na ms l mt mu">git commit -m “updated dataset with fake bottle”</span></pre><p id="8256" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">..并将实际版本推送到存储器:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="2a61" class="ks kt hi mn b fi mr ms l mt mu">dvc push</span><span id="bcf8" class="ks kt hi mn b fi na ms l mt mu">~Output:<br/> 1 file pushed</span></pre></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="ba1d" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">哎呀，我们刚刚得知我们的假瓶子原来是醋。让我们回滚到数据集的前一个版本。</p><p id="ee03" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">首先，用<a class="ae iv" href="https://git-scm.com/docs/git-log" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj"> git log </strong> </a>理智地检查你当前的状态，看看我们当前的头脑在哪里。然后，退一步回到先前的<em class="jv">状态。dvc </em>文件:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="84b8" class="ks kt hi mn b fi mr ms l mt mu">git checkout HEAD~1 wine-quality.csv.dvc</span><span id="1001" class="ks kt hi mn b fi na ms l mt mu">~Output:<br/> Updated 1 path from cb50800</span><span id="6a45" class="ks kt hi mn b fi na ms l mt mu">dvc checkout</span><span id="0b67" class="ks kt hi mn b fi na ms l mt mu">~Output:<br/> M wine-quality.csv</span></pre><p id="844c" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">查wine-quality.csv，我们的假酒瓶没了。:)</p><p id="db39" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">不要忘记提交您的更改:</p><pre class="mi mj mk ml fd mm mn mo mp aw mq bi"><span id="ad4f" class="ks kt hi mn b fi mr ms l mt mu">git commit -m “reverting dataset update"</span></pre></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="d633" class="lr kt hi bd iu ls mv lu kx lv mw lx lb ly mx ma le mb my md lh me mz mg lk mh bi translated"><strong class="ak">展望</strong></h1><p id="a085" class="pw-post-body-paragraph ix iy hi iz b ja lm jc jd je ln jg jh ji lo jk jl jm lp jo jp jq lq js jt ju hb bi translated">这是系列的第一部分，我们学习了DVC的一些基本用法。在接下来的部分中(只要我有时间),将会涉及到像DVC非常简洁的实验能力、远程存储工作以及在HPC(高性能计算)环境中使用DVC这样的事情。*</p><p id="3a3c" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">希望这篇文章能对某人有所帮助:)随时欢迎反馈！</p><p id="94f8" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">* <em class="jv">来自未来的提示:随着it进入基础设施，工作情况发生了变化，因此本文暂时保持单篇博文。</em></p></div></div>    
</body>
</html>