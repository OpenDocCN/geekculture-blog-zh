<html>
<head>
<title>Scanning iBeacon and Eddystone Using Android BLE Scanner</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Android BLE扫描仪扫描iBeacon和Eddystone</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/android-ble-scanner-to-scan-for-ibeacon-and-eddystone-96a0c0610d3d?source=collection_archive---------1-----------------------#2020-08-31">https://medium.com/geekculture/android-ble-scanner-to-scan-for-ibeacon-and-eddystone-96a0c0610d3d?source=collection_archive---------1-----------------------#2020-08-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f7e3558e8c90a92e9117c8a6d8e70e3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4YZ-RgsuHeA975wnwYQ6og.png"/></div></div></figure><h1 id="46c8" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">介绍</h1><p id="a360" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">本博客将向您介绍蓝牙低能耗，并将涵盖使用它的所有终端应用领域。此外，博客还将带您了解不同种类的BLE信标和流行的信标协议。</p><p id="19a0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在本文的后半部分，我们将创建一个演示android应用程序来测试两个BLE信标协议，一个来自Apple，另一个来自Google。但是，在进入编码部分之前，让我们先看一下BLE和信标的一些基本定义和概述。</p><h1 id="8145" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">蓝牙低能耗</h1><p id="3869" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">蓝牙低能量是由蓝牙SIG设计的无线个人区域网技术。蓝牙SIG确定了低能耗技术的不同市场，尤其是在智能家居、健康、运动和健身领域。一些主要优势包括:</p><ul class=""><li id="7caf" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">纽扣电池的低功率需求可以运行数月/数年</li><li id="2fa3" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">体积小、成本低</li><li id="91a4" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">与手机、平板电脑和电脑的兼容性</li></ul><p id="d383" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">蓝牙低能耗(BLE)，可从Android API 18(4.3-Jelly Bean)获得，后来在设备之间创建短连接以传输数据突发。BLE当没有连接它保持在睡眠模式。这是因为与传统的蓝牙相比，它通过提供更低的带宽来利用更少的功率。它非常适合心率监测器或无线键盘等应用。要使用BLE，设备需要有支持BLE的芯片组。谈到BLE信标，蓝牙信标是物理发射器——一种在附近的电子设备上广播其标识符的BLE设备。</p><h1 id="9b42" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">BLE信标的使用案例</h1><p id="c8ae" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">这些信标可用于许多近距离相关的应用，例如</p><ul class=""><li id="e6a6" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><strong class="jq hj">邻近警报</strong>:当这些信标在附近时，它们可用于获取应用程序内的警报</li><li id="ec83" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj">室内导航/定位</strong>:通过在室内放置适当数量的信标，并适当利用所有信标的信号强度，我们可以创建一个室内导航或室内定位的工作解决方案。</li><li id="e967" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj">互动</strong>:这些信标可以放置在电影院的电影海报/横幅上，一旦设备靠近它，应用程序就可以启动它的预告片或预告，博物馆也可以这样做，这些可以放置在艺术品上，人们可以将这些绘画的细节作为通知，还可以获得艺术品的视频/音频/文本信息。</li><li id="0b6d" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj">医疗保健</strong>:可用于跟踪患者的运动和活动</li></ul><p id="4fd6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">它也可以用于许多其他用例。例如，你可以在你的钥匙里放一个BLE标签，然后用你的手机去寻找它，如果它在橱柜里或者就在沙发下面。</p><h1 id="76aa" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">信标协议</h1><ul class=""><li id="a986" class="kr ks hi jq b jr js jv jw jz lf kd lg kh lh kl kw kx ky kz bi translated"><strong class="jq hj"> iBeacon </strong>:苹果的蓝牙信标标准</li><li id="bab7" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">AltBeacon :它是由Radius Networks创建的iBeacon的开源替代方案</li><li id="064f" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj"> URIBeacon </strong>:直接广播网址，可以立即理解</li><li id="4f35" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj"> Eddystone </strong>:谷歌的蓝牙信标标准，支持三种类型的数据包，Eddystone-UID、Eddystone-URL和Eddystone-TLM。</li></ul><p id="3261" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，我们将看到如何通过创建一个演示android应用程序来扫描苹果的iBeacon和谷歌的Eddystone-UID。</p><h1 id="4005" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">入门指南</h1><p id="635d" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">创建一个新项目，并选择您所选择的模板。</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/fcb9f660c203427881c10352638a9157.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6jK36DQ8ji7-oNRvE9vB6A.png"/></div></div></figure><p id="a949" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我选择“空活动”。</p><h1 id="322b" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">BLE属地</h1><p id="d5c6" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">对于扫描BLE信标来说，没有额外的BLE库依赖性。</p><p id="6999" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">打开AndroidManifest.xml并在Manifest元素中添加以下内容。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="073d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><uses-feature>将“需要”标记为“真”意味着此应用程序需要ble硬件才能运行，因此Google play将确保此应用程序仅对具有BLE硬件的设备可见。</uses-feature></p><p id="9dc5" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><uses-permission>标签需要获得在低能耗模式下使用蓝牙硬件粗略定位的许可。</uses-permission></p><h1 id="8115" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">检查许可</h1><p id="2a91" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">蓝牙低能量扫描模式需要粗略定位许可。因此，我们应该确保我们拥有用户提供的所需权限。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="c35d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">检查是否获得权限，否则显示对话框让用户知道为什么我们需要这个权限。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><h1 id="cae3" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">设置蓝牙API</h1><p id="40b5" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">初始化<em class="lp"> BluetoothManager </em>以获取用于获取<em class="lp"> BluetoothLeScanner </em>的<em class="lp"> BluetoothAdapter </em>的实例，这是对蓝牙LE设备执行扫描相关操作所必需的。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><ul class=""><li id="5c48" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><strong class="jq hj"><em class="lp">Bluetooth manager</em></strong>:高层管理器，用于获取BluetoothAdapter的实例，并进行全面的蓝牙管理。</li><li id="6b7d" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj"> <em class="lp">蓝牙适配器</em> </strong>:代表本地设备蓝牙适配器。<em class="lp"> BluetoothAdapter </em>允许您执行基本的蓝牙任务，例如启动设备发现、查询绑定(配对)设备列表、使用已知MAC地址实例化一个<em class="lp"> BluetoothDevice </em>，以及创建<em class="lp"> BluetoothServerSocket </em>来侦听来自其他设备的连接请求并开始扫描蓝牙LE设备。</li><li id="b4e0" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj"><em class="lp">Bluetooth LE scanner</em></strong>:这个类为蓝牙LE设备提供了执行扫描相关操作的方法。</li></ul><h1 id="2d0c" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">BLE扫描回电</h1><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><h1 id="52b5" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">BLE启动/停止扫描仪</h1><p id="60c2" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我们可以用一个按钮来控制BLE扫描仪的启动和停止。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><h1 id="06ff" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">解析ScanResult以获取相关数据</h1><p id="2906" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我们应该创建一个信标类来保存我们将从onScanResult回调的ScanResult中解析的不同信息。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="e0f0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">正在提取Eddystone UID数据包信息(如果有)。</p><p id="cad6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Eddystone UID:唯一的静态ID，具有10字节的名称空间组件和6字节的实例组件。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><ul class=""><li id="ad12" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><strong class="jq hj"> <em class="lp"> scanRecord </em> </strong>:广告和扫描响应的组合</li><li id="5635" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj"> <em class="lp"> device.address </em> </strong>:该蓝牙设备的硬件地址。比如“00:11:22:AA:BB:CC”。</li><li id="052c" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj"> <em class="lp"> rssi </em> </strong>:接收信号强度，单位为dBm。有效范围是[-127，126]。</li><li id="4edc" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj"><em class="lp">service UUIDs</em></strong>:广告中用于标识蓝牙GATT服务的服务uuid列表。</li><li id="d598" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj"><em class="lp">eddystoneServiceId</em></strong>:Eddystone UID的服务UUID，为“0000 feaa-0000–1000–8000–00805 F9 b 34 FB”</li><li id="968a" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj"><em class="lp">service data</em></strong><em class="lp">:</em>与serviceUuid关联的服务数据字节数组，在我们的例子中是<em class="lp"> eddystoneServiceId </em></li><li id="a803" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj"> <em class="lp"> eddystoneUID </em> </strong>包信息在从索引2到18的serviceData中，我们需要使用实用程序方法将这个字节数组转换成十六进制字符串</li></ul><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><ul class=""><li id="07df" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><strong class="jq hj"> <em class="lp">命名空间</em> </strong>为10字节，从eddystoneUID的20个字符开始</li><li id="78a1" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj"> <em class="lp"> instanceId </em> </strong>为6个字节，为eddystoneUID的剩余12个字符</li></ul><p id="2382" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">提取iBeacon数据包信息(如果有)。</p><p id="6b28" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj"> iBeacon </strong>:唯一的静态ID，具有16字节的邻近UUID成分、2字节的主要成分和2字节的次要成分。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><ul class=""><li id="ce1a" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><strong class="jq hj"><em class="lp">iBeaconManufactureData</em></strong>:与制造商id相关联的特定于制造商的数据，对于iBeacon制造商id为“0X004c”(苹果)。</li><li id="ee0b" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj"/></li><li id="9383" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj"/></li><li id="2ecb" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj"/></li></ul><p id="2cd7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">让我们看看实际运行的代码</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/9f718577a41fbc083e740a8d58c1acb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ww343_i91vgL-TXPMIIA-Q.jpeg"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">start screen</figcaption></figure><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/20bcae5b8453715908a27809d7031335.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0xp-B8D2in4P0dzm9UagbA.jpeg"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">start screen with the options</figcaption></figure><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/38d731ecc158583e341e1f9fcad4e22b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IZSOM61JNRxL2d9grLqemA.jpeg"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">result screen with Eddystone UID, iBeacon, generic BLE devices</figcaption></figure><p id="2e6b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">BLE信标iBeacon和Eddystone-UID互不相同，但可用于任何与接近度相关的应用。这是因为，在应用层，它们都使用不同的蓝牙模式解决类似的问题。</p><p id="5498" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">埃迪斯通确实有不同类型的数据包来解决不同的问题，比如-</p><ul class=""><li id="395d" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><strong class="jq hj"> Eddystone-URL </strong>:用于广播URL</li><li id="b2b1" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">埃迪斯通-TLM :广播信标信息。这可以包括电池电量、传感器数据、电池电压、信标温度、自上次启动以来发送的数据包数量、信标正常运行时间或其他与信标管理员相关的信息</li></ul><p id="4c86" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">更多细节和更深入的观点，你可以在这里找到代码<a class="ae lv" href="https://github.com/dinkarkumardk/BLEScanner" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="afec" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">【https://www.talentica.com】也发表于<a class="ae lv" href="https://www.talentica.com/blogs/scanning-ibeacon-and-eddystone-using-android-ble-scanner/" rel="noopener ugc nofollow" target="_blank"><em class="lp"/></a><em class="lp">由我。</em></p></div></div>    
</body>
</html>