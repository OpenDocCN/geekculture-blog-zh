<html>
<head>
<title>Tesseract OCR: Understanding the Contents of Documents, Beyond Their Text</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Tesseract OCR:理解文档的内容，超越文本</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/tesseract-ocr-understanding-the-contents-of-documents-beyond-their-text-a98704b7c655?source=collection_archive---------1-----------------------#2021-05-30">https://medium.com/geekculture/tesseract-ocr-understanding-the-contents-of-documents-beyond-their-text-a98704b7c655?source=collection_archive---------1-----------------------#2021-05-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="fb0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前几天在Reddit上偶然发现一个问题。评论者想知道是否有可能从图像的粗略位置提取文本，所以基本上是截图或标准格式文档的图像。他们还想知道这是否可以通过Tesseract OCR(谷歌赞助的图像到文本工具包)来实现。</p><p id="b2f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个问题的主题与我目前的两个项目非常接近——也是我硕士论文的主题——以至于我只有<em class="jd">有</em>来写一个像样的答案。</p><p id="f6fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将介绍一个演示用例，介绍Tesseract的用法，介绍一些有用的启发方法，并展示一些代码示例。读完这篇文章后，你应该能够从简单文档(如表格、驾照等)的图像中提取一些基本的文本。).</p><p id="4e0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经用Python写了代码示例，但是我尽量保持简单。它不应该是漂亮的或“最佳实践”——只是每个人都可以理解，不管他们喜欢什么编程语言。在我们的分析中，我还使用了Tesseract的标准输出。对于实际的应用程序，您可能希望使用一个包装器，比如<a class="ae je" href="https://pypi.org/project/pytesseract/" rel="noopener ugc nofollow" target="_blank">pytesserac</a>(以及它的<em class="jd"> image_to_boxes() </em>方法)。</p><p id="57a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开始吧！</p></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><h1 id="84bd" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">问题:理解驾照的布局</h1><p id="5a4c" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">因此，让我们想象一下，我们正在构建一个移动应用程序，它知道用户的驾照何时到期，并在到期时提醒用户更新驾照。我们想象中的应用程序的用户界面很简单:用户拍下他们的驾照照片，应用程序完成剩下的工作！</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es kp"><img src="../Images/69e48c23a25c33aa42ab1919d212e9bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fVq4VOOTB4Ze0Z01syw5rg.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">Image 1: Visualization for our demo use case. (Derivative work from [1] and [2].)</figcaption></figure><p id="4b98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们应该如何着手构建这种应用程序呢？</p><p id="f844" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯，假设文档的布局/截图/等等。我们的照片或多或少是静态的(就像我们的驾照一样；假设他们来自同一个国家/州)，以下三个步骤就足够了:</p><ol class=""><li id="3133" class="lf lg hi ih b ii ij im in iq lh iu li iy lj jc lk ll lm ln bi translated">使用Tesseract OCR提取文本以及单词和段落的位置</li><li id="45c2" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">应用一些启发法来获得您需要的数据</li><li id="c7b8" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">建立应用程序的其余部分(逻辑等。，不在本文讨论范围之内)</li></ol><p id="c2dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们更详细地看一下每个步骤。</p></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><h1 id="cd90" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">用Tesseract OCR提取文本及其位置</h1><blockquote class="lt lu lv"><p id="b798" class="if ig jd ih b ii ij ik il im in io ip lw ir is it lx iv iw ix ly iz ja jb jc hb bi translated"><strong class="ih hj">先决条件:</strong></p><p id="7d82" class="if ig jd ih b ii ij ik il im in io ip lw ir is it lx iv iw ix ly iz ja jb jc hb bi translated">开始之前，请确保您已经安装了Tesseract OCR 4。由于网上有数不清的安装指南(例如这份关于<a class="ae je" rel="noopener" href="/quantrium-tech/installing-and-using-tesseract-4-on-windows-10-4f7930313f82"> Windows 10 </a>的指南)，我就不在这里赘述了。</p><p id="b62c" class="if ig jd ih b ii ij ik il im in io ip lw ir is it lx iv iw ix ly iz ja jb jc hb bi translated">我们还假设图像中的文本语言是英语，因为这是默认安装的。</p></blockquote><p id="58ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们想从驾照图像中获取文本。我们将使用这张图片进行演示:</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es lz"><img src="../Images/bd9fce664983167eb3163e0fcc467242.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RLWdDr_Pq01TtWfRwPDwgw.jpeg"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">Image 2: Image of a Malaysian driver’s license, by Wikipedia user hezery99. Increased brightness/contrast from the original. [2]</figcaption></figure><p id="e9f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">宇宙魔方对字母和背景有一定的容忍度。因此，您可能想试验一下，为您的输入图像找到正确的预处理步骤。我不得不提高亮度和对比度一点点(导致图像2)，以获得任何像样的结果。</p><p id="cda4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用Tesseract OCR的命令行界面。打开您的终端(或对于Windows，您的命令提示符)，并键入以下内容:</p><pre class="kq kr ks kt fd ma mb mc md aw me bi"><span id="0249" class="mf jn hi mb b fi mg mh l mi mj">tesseract -l eng FILENAME_OF_YOUR_IMAGE.jpg out tsv</span></pre><p id="fa3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是什么意思？让我们把它分成几块:</p><ul class=""><li id="69ee" class="lf lg hi ih b ii ij im in iq lh iu li iy lj jc mk ll lm ln bi translated"><strong class="ih hj">宇宙魔方</strong>:调用宇宙魔方OCR应用程序。</li><li id="3922" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc mk ll lm ln bi translated"><strong class="ih hj"> -l eng </strong>:这告诉宇宙魔方你正在尝试探测英语。</li><li id="63ec" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc mk ll lm ln bi translated"><strong class="ih hj">FILENAME _ OF _ YOUR _ image . jpg</strong>:你要分析的图像的路径。将此替换为图像路径。</li><li id="6908" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc mk ll lm ln bi translated"><strong class="ih hj"> out </strong>:输出的文件名。如果您希望只在终端中输出结果，请用破折号(“-”)替换它。</li><li id="dd5b" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc mk ll lm ln bi translated"><strong class="ih hj"> tsv </strong>:输出类型，表示<em class="jd">制表符分隔值。</em>与默认的纯文本不同，这个选项可以得到一个包含所有单词及其在图像中的像素位置的漂亮文件。</li></ul></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><p id="3079" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">请注意！</strong>如果你使用的是Windows，你需要调用<em class="jd">tesseract.exe</em>可执行文件。您需要将它添加到PATH环境变量中，或者直接调用可执行文件，所以:</p><pre class="kq kr ks kt fd ma mb mc md aw me bi"><span id="2055" class="mf jn hi mb b fi mg mh l mi mj">C:\some\path\tesseract.exe -l eng FILENAME_OF_YOUR_IMAGE.jpg out tsv</span></pre></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><p id="4395" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按Enter键后，输出应该如下所示:</p><pre class="kq kr ks kt fd ma mb mc md aw me bi"><span id="4341" class="mf jn hi mb b fi mg mh l mi mj">Tesseract Open Source OCR Engine v4.1.1 with Leptonica<br/>Estimating resolution as 231<br/>Detected 24 diacritics</span></pre><p id="be71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您打开保存在当前工作目录中的文件<em class="jd"> out.tsv </em>,其内容应该类似于此，但不太美观:</p><figure class="kq kr ks kt fd ku"><div class="bz dy l di"><div class="ml mm l"/></div><figcaption class="lb lc et er es ld le bd b be z dx">Table 1: Tesseract’s output for our example image.</figcaption></figure><p id="bf20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“那看起来阴森森的。这些数字是什么？！搞什么鬼？?"</p><p id="467f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不要担心。接下来，我会尽可能详尽地解释这些内容。</p></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><p id="b158" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Tesseract的TSV输出中的每一行都代表我们的输入文档中的一个单词或一个布局结构(比如一个页面或一个段落)。</p><p id="03fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从最简单也是最重要的部分开始:正文。最右边的一列<strong class="ih hj"> <em class="jd">文本</em> </strong>包含一个被宇宙魔方识别的单词。如果该行表示布局结构，则该列的值将为空。</p><p id="ae37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列<strong class="ih hj"><em class="jd">conf</em></strong><em class="jd"/>包含——以百分比表示——被正确识别的单词的宇宙魔方的置信度。百分比越高，宇宙魔方越有可能是正确的。例如，第20行上的值“96 ”(在上面的表1中)意味着宇宙魔方96%确定单词“MALAYSIA”被正确识别。置信度“-1”意味着该行不包含单词，而是前面提到的布局结构表示。</p><p id="18bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列<em class="jd">左</em>和<em class="jd">上</em>分别代表图像中单词的x和y坐标。列宽和列高的意思就是:图像中单词的宽度和高度。所有这些值的单位都是像素。</p><p id="aff6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们跳到第一列，<em class="jd">级</em>。它的值告诉我们输出中的行是否…</p><ol class=""><li id="16ec" class="lf lg hi ih b ii ij im in iq lh iu li iy lj jc lk ll lm ln bi translated">一页</li><li id="5182" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">一个街区</li><li id="f05f" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">一个段落</li><li id="16b7" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">一行</li><li id="b55c" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">一句话。</li></ol><p id="02b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列<em class="jd"> page_num </em>、<em class="jd"> block_num </em>、<em class="jd"> par_num </em>、<em class="jd"> line_num </em>和<em class="jd"> word_num </em>标识文档层次结构中这些布局结构的各个实例。让我们更详细地看一下这些。</p><ul class=""><li id="d403" class="lf lg hi ih b ii ij im in iq lh iu li iy lj jc mk ll lm ln bi translated"><strong class="ih hj"> <em class="jd"> page_num </em> </strong>是找到单词的页面。<strong class="ih hj">请注意！</strong>在这个演示中，我们不分析多页PDF文档，所以我们的<em class="jd"> page_num </em>只获取值<em class="jd"> 1 </em>。如果我们的文档中有多个页面(即我们没有分析单一的照片)，我们也会在这里看到更高的索引。</li><li id="96ad" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc mk ll lm ln bi translated"><strong class="ih hj"> <em class="jd"> block_num </em> </strong>告知当前页面内检测到的布局块。</li><li id="dfe0" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc mk ll lm ln bi translated"><strong class="ih hj"> <em class="jd"> par_num </em> </strong>告知版面块内的段落号。</li><li id="cb8f" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc mk ll lm ln bi translated"><strong class="ih hj"> <em class="jd"> line_num </em> </strong>告诉段落内的行号。</li><li id="7276" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc mk ll lm ln bi translated"><strong class="ih hj"> <em class="jd"> word_num </em> </strong>告诉行内的字数。</li></ul><p id="7b4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面的表2中，您可以看到输出文件(即表1)中的不同行根据行的“级别”用不同的颜色突出显示:</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es lz"><img src="../Images/61974e660c263a481b12a2bdfd27e302.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ucgPWqOOIhD5exYuxW-bw.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">Table 2: Visualizing the logic behind page_num, block_num, par_num, line_num and word_num.</figcaption></figure><p id="feb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在表2中，有三个块(1–3)，每个块有一个段落(1.1、2.1和3.1)。每个段落只包含一行(1.1.1、2.1.1和3.1.1)。前两段包含仅包含空格的单词(1.1.1.1，2.1.1.1)，而最后一段包含单词“LESEN”(3 . 1 . 1 . 1)、“MEMANDU”(3.1.1.2)和“Ee”(3 . 1 . 1 . 3)。</p><p id="f268" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在输入图像上，块、段落、行和单词看起来像这样:</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es lz"><img src="../Images/013fb7fea74ecc7216f51eb7f6bd02df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XDw0dYav6whz7tCkVasoYQ.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">Image 3: Blocks, paragraphs, lines and words in our driver’s license example. Derivative of [2].</figcaption></figure><p id="122d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如你所见，由Tesseract确定的布局结构远非完美。但是，这就是OCR的本质。</p></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><p id="d008" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回到我们的演示！下面是我们在分析中感兴趣的行。在演示中，我们将集中在最后一行，因为它包含了驾照的到期日期，这也是我们应用程序的重点！</p><figure class="kq kr ks kt fd ku"><div class="bz dy l di"><div class="ml mm l"/></div><figcaption class="lb lc et er es ld le bd b be z dx">Table 3: Output of our Tesseract OCR run, with irrelevant rows excluded.</figcaption></figure><p id="dcce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我听到你问:<em class="jd">“那么，我们能不能只取输入图像，运行Tesseract，选择page_num=1，block_num=7，par_num=2，line_num=2的行？会这么简单吗？!"</em></p><p id="526b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">可悲的是，号:(</em> </strong></p><p id="481a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如前所述，由宇宙魔方确定的布局结构并不完美。</p><p id="5150" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果被分析的图像发生非常微小的变化，那么块、段落、行甚至字数可能会发生很大的变化。不同的照明、不同的长宽比，或者对输入图像的许多其他改变中的任何一个都可以改变这些值很多。因此，这里的第1页和第7块可能是第1页和第3块，如果图像稍有改变的话。</p><p id="0be3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除非你正在分析一个绝对静态布局结构的非常简单的黑白截图，否则你根本不应该相信这些数字<em class="jd"/>。也许那时还没有。然而，它们多少有些逻辑性，所以在某些情况下会很有用。我们将在下一章讨论这个问题。</p><p id="2f4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，我们该怎么办？如何从文档的这个一般区域中提取这一段特定的文本呢？有数不清的可能性，但我们现在将讨论其中的几个。</p></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><h1 id="acb6" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">理解图像</h1><blockquote class="lt lu lv"><p id="9d06" class="if ig jd ih b ii ij ik il im in io ip lw ir is it lx iv iw ix ly iz ja jb jc hb bi translated"><strong class="ih hj">先决条件:</strong></p><p id="e2f3" class="if ig jd ih b ii ij ik il im in io ip lw ir is it lx iv iw ix ly iz ja jb jc hb bi translated">对于这些例子，我将使用Python。如果您想了解这些示例，请确保您也安装了该软件。</p><p id="2f94" class="if ig jd ih b ii ij ik il im in io ip lw ir is it lx iv iw ix ly iz ja jb jc hb bi translated">它应该很容易安装，所以只需前往<a class="ae je" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank">https://www.python.org/downloads/</a>并安装它。</p><p id="c5d9" class="if ig jd ih b ii ij ik il im in io ip lw ir is it lx iv iw ix ly iz ja jb jc hb bi translated">我们将使用Python包re(用于regex)和<a class="ae je" href="https://pypi.org/project/pandas/" rel="noopener ugc nofollow" target="_blank"> pandas </a>。</p></blockquote><p id="df13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，现在我们已经设法得到了宇宙魔方的输出。接下来，我们需要构建一些东西，让我们可以拍摄任何驾驶执照的图像，并从中提取有效日期。概括地说，有两种可能的方法:使用<strong class="ih hj">试探法</strong>，或者使用<strong class="ih hj">机器学习</strong>。</p><p id="3de0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<strong class="ih hj">试探法</strong>，也就是基本的经验法则，是你在没有大量训练数据的情况下需要做的事情。如果您的数据(因此，您的模型)足够简单，可以作为规则的基础，那么这也是首选。在没有大型数据集的情况下，简单的经验法则可能比机器学习模型更加稳健。</p><p id="205b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从数据中总结经验法则是一门艺术，而不是科学。你基本上只是从你的数据中做出假设，你需要测试和验证它们的程度取决于你的用例。</p><p id="3008" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">另一方面，机器学习模型</strong>可以更具体一些。一个适用于马来西亚驾照的模型可能会完全偏离主题，例如分析应用程序的截图，因此对ML模型的进一步讨论将是另一篇博客文章的前提。也许到那时我会想出一个比驾照更好的演示用例。</p><p id="d607" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于使用试探法，我们现在将通过以下方法:</p><ol class=""><li id="303e" class="lf lg hi ih b ii ij im in iq lh iu li iy lj jc lk ll lm ln bi translated">基于位置的文本识别</li><li id="6eb6" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">正则表达式</li><li id="5a32" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">信任宇宙魔方的层次检测</li></ol><h2 id="b4fd" class="mf jn hi bd jo mn mo mp js mq mr ms jw iq mt mu ka iu mv mw ke iy mx my ki mz bi translated">基于位置的识别</h2><p id="3677" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">对于基于位置的文本识别，我的意思是我们根据它们相对于图像的<em class="jd"> x </em>和<em class="jd"> y </em>坐标来识别文档中的相关单词。</p><p id="f02b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们想仅仅根据字符串在文档中的位置来识别字符串，我们需要确保文档的布局不会改变。根据我们建立的规则，我们也许可以改变图像的纵横比或分辨率，但除此之外，我们需要使用更多来自数据的提示。</p><p id="7293" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们假设驾照照片总是被整齐地裁剪(例如，由应用程序的用户手动裁剪，或使用一些简单的边缘检测算法)。这样，我们就可以浏览宇宙魔方识别的每一个单词</p><p id="027c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面我们可以看到与这个练习相关的坐标。</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es lz"><img src="../Images/68db1aea754da978aa5dcb5ed2ceb11d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hVD4Qb24XJDwp5LhDlTozQ.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">Image 4: Coordinates of the Tesseract-extracted word we’re interested in.</figcaption></figure><p id="1928" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基于这些值，我们可以计算出图像中每个单词的相对大小和位置。</p><pre class="kq kr ks kt fd ma mb mc md aw me bi"><span id="6ab0" class="mf jn hi mb b fi mg mh l mi mj"># Relative size of the word within the <br/>relative_width  = width_word / width_image<br/>relative_height = height_word / height_image</span><span id="48e9" class="mf jn hi mb b fi na mh l mi mj"># Relative position of the word within the image<br/>relative_x = x_word / width_image<br/>relative_y = y_word / height_image</span></pre><p id="ffd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是Python脚本的外观:</p><figure class="kq kr ks kt fd ku"><div class="bz dy l di"><div class="ml mm l"/></div><figcaption class="lb lc et er es ld le bd b be z dx">Script 1: Locating words based on rough location ranges.</figcaption></figure><p id="4dc4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于我们的驾照数据，我们得到以下输出:</p><pre class="kq kr ks kt fd ma mb mc md aw me bi"><span id="57cf" class="mf jn hi mb b fi mg mh l mi mj">19/07/2021</span></pre><p id="bdb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">而这正是我们想要的价值！不错！</p><p id="e341" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种检测方法完全依赖于列表<em class="jd">最小值</em>和<em class="jd">最大值</em>。它们的内容定义了我们的图像的<em class="jd"> X </em>和<em class="jd"> Y </em>坐标的允许范围，宽度和高度。</p><p id="ffba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是这些价值观从何而来呢？</p><p id="b8b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种情况下，它们被手动调整以覆盖图像中所需文本的粗略区域。所以，如果你的图像布局是超级静态的，并且你知道你要识别的文本在不同的图像之间可以移动多少，那么你就可以猜测这些值。</p><h2 id="a491" class="mf jn hi bd jo mn mo mp js mq mr ms jw iq mt mu ka iu mv mw ke iy mx my ki mz bi translated">锚词</h2><p id="74f7" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">但是如果我们感兴趣的文本的位置变化很大，但它总是靠近某个已知的关键字，怎么办？就像这种情况，“有效性”？</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div class="er es nb"><img src="../Images/3329e1bab036e5fb0468481c2bea1b65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*CplRpRZ3terstXa5HRkH-g.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx">Image 5: Distance between our anchor word (“Validity”) and the date. Derivative of [2]</figcaption></figure><p id="095e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们稍微修改一下前面提到的代码。假设我们已经遍历了Tesseract输出的所有单词，并且找到了锚词“Validity”。因此已知其<em class="jd"> X </em>和<em class="jd"> Y </em>坐标，并在下面用<em class="jd"> x_anchor </em>和<em class="jd"> y_anchor </em>表示。</p><pre class="kq kr ks kt fd ma mb mc md aw me bi"><span id="c626" class="mf jn hi mb b fi mg mh l mi mj"># Relative size of the word within the <br/>relative_width  = width_word / width_image<br/>relative_height = height_word / height_image</span><span id="decf" class="mf jn hi mb b fi na mh l mi mj"># Relative position of the word to the anchor word, within the image<br/>relative_x_distance = (x_word - x_anchor) / width_image<br/>relative_y_distance = (y_word - y_anchor) / height_image</span></pre><p id="f0d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经过这些更改后，代码将如下所示:</p><figure class="kq kr ks kt fd ku"><div class="bz dy l di"><div class="ml mm l"/></div><figcaption class="lb lc et er es ld le bd b be z dx">Script 2: Locating the correct word based on an anchor word.</figcaption></figure><p id="7433" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行代码后，我们得到了我们一直在等待的熟悉结果:</p><pre class="kq kr ks kt fd ma mb mc md aw me bi"><span id="2019" class="mf jn hi mb b fi mg mh l mi mj">19/07/2021</span></pre><p id="4198" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些是基于位置数据可以采取的方法。</p><h2 id="c3a5" class="mf jn hi bd jo mn mo mp js mq mr ms jw iq mt mu ka iu mv mw ke iy mx my ki mz bi translated">信任宇宙魔方的布局层次</h2><p id="4007" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">好吧。还记得我说过宇宙魔方输出的<em class="jd">级</em>信息不应该被信任吗？是的，我们正在解决。</p><p id="3a23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想介绍的最后一种方法假设Tesseract能够将锚词(“有效性”)和感兴趣的词(日期)一致地归类到同一个布局块中。对于某些用例，这种方法可能比前面的方法更好。</p><p id="f6aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在表4中，我们有以下pandas查询的结果:</p><pre class="kq kr ks kt fd ma mb mc md aw me bi"><span id="1276" class="mf jn hi mb b fi mg mh l mi mj">df[<br/>    (df["block_num"]==7)<br/>    &amp; (df["par_num"]==2)<br/>    &amp; (<br/>        (df["line_num"]==1)<br/>        | (df["line_num"]==2)<br/>    )<br/>]</span></pre><figure class="kq kr ks kt fd ku"><div class="bz dy l di"><div class="ml mm l"/></div><figcaption class="lb lc et er es ld le bd b be z dx">Table 4: Lines 1 and 2 of block_num=7, par_num=2.</figcaption></figure><p id="65e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于我们不能信任布局结构的确切id，我们需要再次找到我们的锚词(“Validity”)，并在同一段落中寻找其他词。然后，我们将遍历这些行，寻找看起来像日期的字符串(使用正则表达式)。</p><p id="3430" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的小脚本应该是这样的:</p><figure class="kq kr ks kt fd ku"><div class="bz dy l di"><div class="ml mm l"/></div><figcaption class="lb lc et er es ld le bd b be z dx">Script 3: Extracting information by trusting the layout logic of Tesseract</figcaption></figure><p id="7768" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行该程序，我们应该得到以下输出:</p><pre class="kq kr ks kt fd ma mb mc md aw me bi"><span id="4b46" class="mf jn hi mb b fi mg mh l mi mj">22/05/2017<br/>19/07/2021</span></pre><p id="8e67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是什么，那是两次约会？！</p><p id="7319" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯，我们知道驾照的有效期在这两个日期之间，所以我们可以有把握地假设到期日是后者。你知道，因为已经晚了。</p><p id="dd6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，现在你有了有效期！</p></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><p id="d9c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是理解图像布局的全部内容！现在，您应该能够处理带有位置元数据的文本了。</p><p id="80b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将简要讨论在构建生产应用程序之前您可能希望进一步研究的几个主题。</p></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><h1 id="c2e0" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">接下来去哪里？</h1><p id="34ca" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">这是对布局分析、OCR和机器学习领域的一个快速概述。演示应用程序本身显然不能用于99.7%的真实用例，但它是进一步探索的良好起点。</p><p id="89be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据您的使用情况，这里有一些事情您可能需要做更多的研究。</p><h2 id="c9e5" class="mf jn hi bd jo mn mo mp js mq mr ms jw iq mt mu ka iu mv mw ke iy mx my ki mz bi translated">检测图像操作</h2><p id="92e2" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">构建这样的系统需要考虑很多方面。如果我们正在构建我们的演示应用程序，例如用于识别我们的在线客户，并且我们计划只依赖Tesseract OCR，那么我们的驾照认证步骤可以在三分钟内被绕过，并在Microsoft Paint上添加一些艺术和工艺。见鬼，我们的应用程序不会想第二次，如果我们提出它:</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es lz"><img src="../Images/229d21de74af109a028cacc282168860.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*29kfSPa_Y4lklXYvlv8jHQ.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">Image 6: My name is Bond. James Bond. Derivative of [2]</figcaption></figure><p id="5dd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是对于一些用例来说，这无关紧要。但是如果<em class="jd">和</em>有关系，那么你可能需要训练一个更复杂的模型来从图像中识别潜在的操纵假象。</p><p id="6cdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您可以访问大量有效图像和被操纵图像的示例(即使是手动操纵的)，您可能能够训练一个图像分类器，它将输出图像被操纵的概率。</p><h2 id="b962" class="mf jn hi bd jo mn mo mp js mq mr ms jw iq mt mu ka iu mv mw ke iy mx my ki mz bi translated">文档布局分类</h2><p id="c99e" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">在驾驶执照的情况下，你将<em class="jd">绝对</em>比我们的演示有更多不同的布局。世界上每个国家都有自己的驾照，例如在美国，<em class="jd">每个州</em>都有自己的驾照！我们简单的试探法永远不会明白当你把它们应用到佛罗里达驾照时会发生什么。</p><p id="72ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本质上，为了能够在现实世界中使用我们的启发法，我们必须能够知道图像代表什么样的布局。是佛罗里达<em class="jd">驾照</em>，马来西亚<em class="jd">莱森·梅曼杜</em>，瑞典<em class="jd">科尔科特</em>，还是芬兰<em class="jd">阿约科特蒂</em>？</p><p id="b765" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于其他原因，该信息也可能极其重要。例如，我们如何解析和理解日期取决于语言环境，而这又取决于驾照的原籍国！因此，对于许多用例来说，这是重要的一步。</p><p id="6cd4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">没有一种正确的方法来识别正确的底层布局。您可以使用用户输入，或者在文档中找到的一些关键字(例如我们演示中的“LESEN MEMANDU”)。或者，再一次，有了足够的数据，你可以训练一个图像分类器来识别正确的布局。</p></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><h1 id="0676" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">总结</h1><p id="654e" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">如果您已经学了这么多，现在应该知道如何:</p><ol class=""><li id="eecb" class="lf lg hi ih b ii ij im in iq lh iu li iy lj jc lk ll lm ln bi translated"><strong class="ih hj">使用Tesseract OCR </strong>从基于图像的文档中提取文本</li><li id="1f9f" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated"><strong class="ih hj">解释宇宙魔方的输出</strong>并理解其布局结构背后的逻辑</li><li id="1001" class="lf lg hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated"><strong class="ih hj">构建简单的试探法</strong>，允许你进一步分析宇宙魔方的输出。</li></ol><p id="a9f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望你能从中得到一些东西，我希望你能在工作中用到这些。:)我也非常乐意就解决这些问题的一些企业OCR应用程序和云服务发表我的看法。</p><p id="ce3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如本文前面提到的，我已经为这个用例开发了几个工具。如果这是一个你觉得自己正在纠结的话题，请在这里关注我或者在推特上给我发消息(<a class="ae je" href="https://twitter.com/waltteri_v/" rel="noopener ugc nofollow" target="_blank">https://twitter.com/waltteri_v/</a>)。任何关于这篇博文的批评都是非常受欢迎的！</p></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><h1 id="98ef" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">来源</h1><p id="087d" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">参考资料、来源等。以完全非科学的形式和顺序:</p><p id="5f06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[1] <a class="ae je" href="https://commons.wikimedia.org/wiki/File:Hezery99-Malaysian_driver%27s_license.jpg" rel="noopener ugc nofollow" target="_blank">马来西亚驾照</a>，2017年5月22日，由维基百科用户<a class="ae je" href="https://commons.wikimedia.org/w/index.php?title=User:Hezery99&amp;action=edit&amp;redlink=1" rel="noopener ugc nofollow" target="_blank"> Hezery99 </a>，用作解释性图形的一部分，<a class="ae je" href="https://en.wikipedia.org/wiki/en:Creative_Commons" rel="noopener ugc nofollow" target="_blank">知识共享</a><a class="ae je" href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" rel="noopener ugc nofollow" target="_blank">Attribution-Share like 4.0 International</a></p><p id="b469" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[2] <a class="ae je" href="https://www.publicdomainpictures.net/en/view-image.php?image=228950&amp;picture=cell-phone-in-hand" rel="noopener ugc nofollow" target="_blank">手拿iPhone的照片</a>，由卡伦·阿诺德在<a class="ae je" href="https://www.publicdomainpictures.net/" rel="noopener ugc nofollow" target="_blank">PublicDomainPictures.net</a>拍摄</p><p id="0e9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(本帖中所有图片均授权为<a class="ae je" href="https://en.wikipedia.org/wiki/en:Creative_Commons" rel="noopener ugc nofollow" target="_blank">知识共享</a> <a class="ae je" href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" rel="noopener ugc nofollow" target="_blank">署名-分享4.0国际版</a>。)</p></div></div>    
</body>
</html>