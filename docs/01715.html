<html>
<head>
<title>Material Spinner (Combo Box) for Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android材质微调器(组合框)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/material-spinner-combo-box-for-android-b400bf8ab9d?source=collection_archive---------2-----------------------#2021-04-21">https://medium.com/geekculture/material-spinner-combo-box-for-android-b400bf8ab9d?source=collection_archive---------2-----------------------#2021-04-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/4834a70cf94d3f3a88a831493cabc26c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*r3Wz5aY9xTOFZ4J1"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@redaquamedia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Denny Müller</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7b9d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当有必要在一个Android应用程序中实现一个组合框时，大多数开发人员可能认为这应该是小菜一碟。不幸的是，情况并非如此，正如我们在实现Android应用时遇到的许多其他问题一样。在这篇文章中，我将展示如何实现一个带有材质主题的自定义旋转器。结果可能如下所示(取决于您的样式、属性和项目布局):</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jt"><img src="../Images/1b26c7a305fba55d15d7f457a794df81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ygl3MpjHKGjlLouu0X2RGw.jpeg"/></div></div></figure><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jy"><img src="../Images/074652e058815e5ea0a09e51cf9c1466.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XnDJQZ81rHOPYEl3MccrAw.png"/></div></div></figure><h1 id="7cc9" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">术语</h1><p id="6db6" class="pw-post-body-paragraph iv iw hi ix b iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo lb jq jr js hb bi translated">第一件有点令人惊讶的事情是没有组合框类。谷歌决定使用<em class="lc">微调器</em>关键字，而不是使用这个非常普通的术语。对于有编程桌面应用经验的人来说，这更加令人困惑，因为<a class="ae iu" href="https://en.wikipedia.org/wiki/Spinner_(computing)" rel="noopener ugc nofollow" target="_blank">微调器是一个选择数字</a>的UI元素。</p><p id="c855" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在最初的震惊之后，你可以认为<em class="lc">微调</em>类就可以了。在简单的应用程序中，外观并不重要，只有功能是必要的，这可能是一个快速有效的解决方案。然而，正如你在下面看到的，结果看起来并不太好。<em class="lc"> Spinner </em>不遵循材料指南，没有定制空间。</p><div class="ju jv jw jx fd ab cb"><figure class="ld ij le lf lg lh li paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/ef72ca074f1312df9ceb692024a787f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1664/format:webp/1*hzEPxscJSE1JBRt5tWyzQw.jpeg"/></div></figure><figure class="ld ij lj lf lg lh li paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><img src="../Images/1db112fc9765154b827ed2d4a2d50a46.png" data-original-src="https://miro.medium.com/v2/resize:fit:338/format:webp/1*lE5w8andIFeMzi3iR1Zg5A.jpeg"/></div><figcaption class="iq ir et er es is it bd b be z dx lk di ll lm">Spinner doesn’t look so nice. Switches are shown below the Spinner and are not its part, but it is difficult to distinguish.</figcaption></figure></div><p id="3cde" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你检查材料设计网站，它提到了一个叫做“<a class="ae iu" href="https://www.material.io/components/menus/android#exposed-dropdown-menus" rel="noopener ugc nofollow" target="_blank">暴露下拉菜单</a>的东西，它使用了<em class="lc"> TextInputLayout </em>和<em class="lc"> AutoCompleteTextView </em>，让一切更加混乱。我认为这真的很奇怪，实现带有Material主题的Spinner的唯一官方方式是滥用一个其原始目的完全不同的组件。我从这篇优秀的文章中了解了这些组件，我认为作者的研究是值得的。它还展示了关于手动设置组件样式的一些细节。然而，我使用定制绑定适配器、双向数据绑定和选择跟踪，以不同的、可重用的方式实现了Spinner。</p><h1 id="ba3d" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">材料旋转器</h1><p id="8eff" class="pw-post-body-paragraph iv iw hi ix b iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo lb jq jr js hb bi translated">首先，让我们创建名为<em class="lc"> MaterialSpinner </em>的新定制UI组件，它扩展了<em class="lc"> AutoCompleteTextView </em>。该组件通过监视用户点击来自动跟踪当前所选项的位置，并通知注册的侦听器。稍后，我们还将创建一个自定义适配器，当选择发生变化时，它会自动得到通知。如果以编程方式更新了<em class="lc"> selectedPosition </em>，组件会自动通知监听器并更新所选文本。最后，它还支持<em class="lc"> emptyText </em> XML属性，如果适配器中没有条目，该属性将用作默认文本。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="de4d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要启用自定义的<em class="lc"> emptyText </em>属性，必须将其声明为<em class="lc"> styleable </em>。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="87af" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，让我们创建一个定制的双向数据绑定适配器，以便能够自动更新所选项。它将根据给定的<em class="lc"> LiveData </em>中的值更新所选项目，并在用户选择另一个项目时更新<em class="lc"> LiveData </em>。实现双向数据绑定适配器需要三种方法:</p><ul class=""><li id="1ac7" class="lp lq hi ix b iy iz jc jd jg lr jk ls jo lt js lu lv lw lx bi translated">更新视图的绑定适配器方法</li><li id="6bcc" class="lp lq hi ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">反向绑定适配器方法，从视图中检索当前值</li><li id="ddc7" class="lp lq hi ix b iy ly jc lz jg ma jk mb jo mc js lu lv lw lx bi translated">绑定适配器方法，该方法监听视图中的更改并通知给定的<em class="lc">inversebindinsigner</em>，以便数据绑定知道发生了更改，并应调用反向绑定适配器来检索当前值</li></ul><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><h1 id="405d" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">材料旋转适配器</h1><p id="dc96" class="pw-post-body-paragraph iv iw hi ix b iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo lb jq jr js hb bi translated">第二，我们需要一个定制的适配器，它可以被<em class="lc"> MaterialSpinner </em>自动通知选择的改变，并调用<em class="lc">notifydatascethanged()</em>。它还实现了一些样板方法，即<em class="lc"> getFilter() </em>，因为<em class="lc"> AutocompleteTextView </em>要求适配器实现<em class="lc"> Filterable </em>，即使我们不想要任何过滤。不幸的是，扩展类必须手动处理视图持有者模式(如下例所示)。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><h1 id="86fe" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">例子</h1><p id="8a66" class="pw-post-body-paragraph iv iw hi ix b iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo lb jq jr js hb bi translated">现在我们所有的组件都准备好了。让我们来看一个如何使用它们的例子。</p><p id="7c94" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我们扩展了<em class="lc"> MaterialSpinnerAdapter </em>并实现了<em class="lc"> getView() </em>方法。虽然viewholder模式已经内置在<em class="lc">recycle view</em>中，但是我们必须使用旧的方式，通过使用标签。对于最近开始Android开发并且没有使用<em class="lc">列表视图</em>经验的人来说，这可能是新的。使用viewholder模式对于重用<em class="lc">视图</em>和避免膨胀新的<em class="lc">视图</em>影响性能是必要的。</p><p id="bf49" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果绑定对象还不存在(<em class="lc"> convertView </em>为空)，适配器会将其膨胀，并将其设置为<em class="lc">视图的</em>标签，以便以后可以访问。否则，它只是从标签中检索对象。最后，它用给定位置的项和该项是否被选中的信息更新绑定对象。绑定对象是从下面显示的XML布局中自动生成的。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="e7b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们还需要创建一个定制的绑定适配器，它将自动设置<em class="lc">ExampleSpinnerArrayAdapter</em>和给定的项目列表到<em class="lc"> MaterialSpinner </em>。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="b5d5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Spinner项目布局利用数据绑定方式更新UI。在本例中，我们只是根据项目更新文本和启用状态。如果该项被选中，它旁边会显示一个标记图标(<em class="lc"> isNotGone </em>是一个自定义绑定适配器，如果为真，它只是使该项可见，否则就消失)。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="9907" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，我们可以创建显示微调器的布局。正如你所看到的，<em class="lc"> MaterialSpinner </em>必须由<em class="lc"> TextInputLayout </em>包装，它设置诸如提示、图标或框模式等属性。如果需要，可以随意设置这些属性。</p><p id="add9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了传递数据，我们使用自定义项绑定适配器，以及<em class="lc"> selectedPosition </em>双向数据绑定适配器，这样数据和UI都可以双向更新。请注意，等号必须跟在at符号后面才能启用双向绑定，即<em class="lc">" @ = { viewmodel . selecteditemposition } "</em>。<em class="lc">选择编辑位置的</em>类型应为<em class="lc">可变数据&lt;整数&gt; </em>。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><h1 id="7ea0" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">结论</h1><p id="4049" class="pw-post-body-paragraph iv iw hi ix b iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo lb jq jr js hb bi translated">在Android中实现一个好看的旋转器比想象中要困难得多。希望读完这篇文章后，一旦采用了可重用组件，它会更容易理解，实现也会更容易。</p></div></div>    
</body>
</html>