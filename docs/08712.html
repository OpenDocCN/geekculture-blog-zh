<html>
<head>
<title>Testing URLs Express.js using Puppeteer and Portfinder with Jest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Puppeteer和带有Jest的Portfinder测试URLs Express.js</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/testing-urls-express-js-using-puppeteer-and-portfinder-with-jest-9ab6ad20292f?source=collection_archive---------6-----------------------#2021-11-11">https://medium.com/geekculture/testing-urls-express-js-using-puppeteer-and-portfinder-with-jest-9ab6ad20292f?source=collection_archive---------6-----------------------#2021-11-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div class="er es hg"><img src="../Images/d1891f5b79d3e8ba290ac7c436962e74.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/0*HMWzLrMy2gXbPec8.png"/></div></figure><div class=""/><p id="6eb7" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我正在学习如何使用Jest测试URL并模拟用户的按钮点击，我们可以使用Pupperteer启动一个浏览器进行测试，还可以使用Portfinder找到一个空闲端口，让我们从我的最后一篇文章和他的代码开始，立即开始测试！</p><p id="f305" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你与我的旧项目，这将有助于你，如果没有检查出来</p><p id="6fb8" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><a class="ae jk" rel="noopener" href="/geekculture/create-a-basic-server-with-express-js-really-basic-but-delicious-c5cceaca1c60"> Express.js基础服务器</a></p><p id="420a" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><a class="ae jk" rel="noopener" href="/geekculture/how-to-create-a-small-server-with-express-js-using-handlebars-aab529be375a"> Express.js和车把</a></p><p id="fb8e" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><a class="ae jk" rel="noopener" href="/geekculture/how-to-insert-dynamic-data-using-express-js-and-handlebars-8b82461d0c7">动态数据用Express.js </a>这才是重要的</p><p id="c08f" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">用Jest小项目测试Express.js】这是我的最后一篇文章</p><h1 id="66c8" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">操纵木偶的人</h1><p id="9327" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">就像他的<a class="ae jk" href="https://developers.google.com/web/tools/puppeteer/" rel="noopener ugc nofollow" target="_blank">官方网页上说的</a>:</p><blockquote class="ko kp kq"><p id="fb58" class="im in kr io b ip iq ir is it iu iv iw ks iy iz ja kt jc jd je ku jg jh ji jj hb bi translated">Puppeteer是一个节点库，它提供了一个高级API来控制<a class="ae jk" href="https://developers.google.com/web/updates/2017/04/headless-chrome" rel="noopener ugc nofollow" target="_blank"> headless </a> Chrome或通过<a class="ae jk" href="https://chromedevtools.github.io/devtools-protocol/" rel="noopener ugc nofollow" target="_blank"> DevTools协议</a>的Chrome</p></blockquote><p id="517b" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">换句话说，我们可以把Chrome和Node.js一起用，耶！当我们能开玩笑地使用它时，它是令人敬畏的。</p><p id="fbf2" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">记得也安装Jest<a class="ae jk" rel="noopener" href="/geekculture/testing-express-js-with-jest-8c6855945f03">如果没有，检查这个帖子</a></p><h1 id="3a40" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">端口查找器</h1><p id="7985" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">端口查找器是一个库，它搜索端口以找到一个空闲端口</p><h1 id="195f" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">让我们从视频开始</h1><p id="342f" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">如果你想看所有这些，这里有视频</p><figure class="kv kw kx ky fd hk"><div class="bz dy l di"><div class="kz la l"/></div></figure><h1 id="a5ba" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">让我们从代码开始</h1><p id="4aad" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">安装木偶师和端口查找器</p><pre class="kv kw kx ky fd lb lc ld le aw lf bi"><span id="277f" class="lg jm hp lc b fi lh li l lj lk">npm i --save-dev puppeteer portfinder</span></pre><figure class="kv kw kx ky fd hk er es paragraph-image"><div class="er es ll"><img src="../Images/f54e3485218bd8da3617625338060d02.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*XXzYbe_ws5WgXGgp9MId1w.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx">Example installing puppeteer and portfinder</figcaption></figure><p id="05c6" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">将a的标签添加到我们的项目或主页，并重定向到about，有趣的是，我们需要添加一些东西来链接a的标签，这就是为什么我添加了data-test="about "以方便搜索。</p><figure class="kv kw kx ky fd hk er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es et"><img src="../Images/dde1164c983b351fa5e17b4f056550f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*deGgn6zrnRcQq3SqBB13aQ.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx">Example adding a’s tag to our project with redirect to about</figcaption></figure><p id="cc3a" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">更改我们的服务器文件，添加一个条件，这是因为如果我们想用命令节点启动我们的服务器，它将启动服务器，如果不是，我们将导出并在测试等其他事情中使用它。</p><pre class="kv kw kx ky fd lb lc ld le aw lf bi"><span id="fb96" class="lg jm hp lc b fi lh li l lj lk">if( require.main === <em class="kr">module</em> ){<br/>app.listen( port, console.log(`Server is on http://127.0.0.1:${ port}` ))}else{<br/><em class="kr">module</em>.<em class="kr">exports</em> = app<br/>}</span></pre><figure class="kv kw kx ky fd hk er es paragraph-image"><div class="er es lu"><img src="../Images/2dff6bef9026c2698503cb9fc462ac52.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*F5nqPAEWcf3TRl4uB2xMMw.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx">Example adding conditional</figcaption></figure><p id="db6c" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">创建我们的测试目录和测试文件，我们将在其中进行测试</p><figure class="kv kw kx ky fd hk er es paragraph-image"><div class="er es lv"><img src="../Images/0951f86277df50e53850ccc18b888dbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:372/format:webp/1*1Gk7uJnAslH2vou3zpyQEw.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx">Example test directory and test file</figcaption></figure><p id="b11d" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">重要！因为Express-handlebar更新了它的库，所以您需要更改导入</p><pre class="kv kw kx ky fd lb lc ld le aw lf bi"><span id="987b" class="lg jm hp lc b fi lh li l lj lk">import { engine } from 'express-handlebars';</span></pre><p id="5e78" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">并为此更改handleExp</p><pre class="kv kw kx ky fd lb lc ld le aw lf bi"><span id="c4fc" class="lg jm hp lc b fi lh li l lj lk">app.engine( 'handlebars', engine({<br/>defaultLayout: 'main'<br/>}))</span></pre><p id="b162" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">向文件xD添加代码</p><pre class="kv kw kx ky fd lb lc ld le aw lf bi"><span id="bbcd" class="lg jm hp lc b fi lh li l lj lk">const puppeteer   = require( 'puppeteer' )<br/>const portfinder  = require( 'portfinder' )<br/>const app         = require( './../servidor2_' )<br/>let serv = null,<br/>port = null<br/>beforeEach( async () =&gt;{<br/>port = await portfinder.getPortPromise()<br/>serv = app.listen( port )<br/>})<br/>afterEach( () =&gt; {<br/>serv.close()<br/>})<br/>test( 'Testing click button and arrow page', async () =&gt; {<br/>const browser = await puppeteer.launch()const page    = await browser.newPage(); await page.goto( `http://127.0.0.1:${ port }` ); await <em class="kr">Promise</em>.all([page.waitForNavigation(),page.click( '[ data-test="about" ]' )])expect( page.url() ).toBe( `http://127.0.0.1:${ port }/about` )browser.close()<br/>})</span></pre><p id="bd91" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，我们需要puppeteer端口查找器和应用程序，这就是为什么我们需要每个部分的要求，然后服务器和端口，我们保存服务器和端口从端口查找器和应用程序启动。</p><p id="027b" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">第二，我们从beforeEach async await开始，因为portfinder与promises一起工作，我们用我们将拥有的空闲端口在服务器中保存我们的应用程序，我们用afterEach关闭服务器。</p><p id="c9c6" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">第三，我们打开了测试函数，并在里面添加了测试段落和异步等待函数，因为木偶师也与承诺一起工作，我们需要浏览器(木偶师)和一个新页面，就像我们已经做的那样，每次在我们的Chrome UI应用程序中，然后我们等待所有的承诺完成，一个是导航，另一个是单击我们a的标签以重定向到我们的关于页面。</p><p id="761a" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，我们使用页面URL方法编写expect，准确地说，如果页面是我们需要的页面，我们就关闭浏览器。</p><figure class="kv kw kx ky fd hk er es paragraph-image"><div class="er es lw"><img src="../Images/b8eafe901849f86151e41b4fd3f4f53a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*r9nXW7YR2PbfIIH1sYac5Q.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx">Example complete code for test our click and URL server</figcaption></figure><h1 id="2b11" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">运行测试</h1><p id="03ef" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">您需要在JSON包中包含这个脚本</p><figure class="kv kw kx ky fd hk er es paragraph-image"><div class="er es lx"><img src="../Images/1ed29d7cfbd42a57bb2138fb8bcfa69e.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*QuGhx1PYtrR08NGeErQB_g.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx">Example script package JSON</figcaption></figure><p id="191f" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后运行这个命令</p><pre class="kv kw kx ky fd lb lc ld le aw lf bi"><span id="bf50" class="lg jm hp lc b fi lh li l lj lk">npm run test</span></pre><p id="6726" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以看到测试进展顺利，这是检查所有测试:D</p><figure class="kv kw kx ky fd hk er es paragraph-image"><div class="er es ly"><img src="../Images/a779a471ced4b584444dba29d212c791.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*ZbG9P49ctLdIdIbqgWE0Jg.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx">Example testing our about URL with Jest, output from the console</figcaption></figure><h1 id="2a1e" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">结论</h1><p id="a462" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">总之，使用Node.js，Puppeteer是测试和检查其他东西的一个很好的工具，它与promises一起工作，如果我们在我们的服务器上使用一个特定的端口，portfinder是为我们的测试找到一个空闲端口的最简单的方法，Jest是保持项目高质量的最后一步，这是一个使用Express.js的小项目，这是保持良好测试的第一步！</p><h1 id="2ee2" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">来源</h1><div class="hh hi ez fb hj lz"><a href="https://developers.google.com/web/tools/puppeteer/" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hq fi z dy me ea eb mf ed ef ho bi translated">木偶师|网络开发者工具|谷歌开发者</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">Puppeteer是一个节点库，它提供了一个高级API来控制无头Chrome或DevTools上的Chrome</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">developers.google.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn hl lz"/></div></div></a></div><div class="hh hi ez fb hj lz"><a href="https://www.npmjs.com/package/portfinder" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hq fi z dy me ea eb mf ed ef ho bi translated">端口查找器</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">portfinder模块有一个简单的接口:或者带有promise(如果Promise被支持的话) :如果…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">www.npmjs.com</p></div></div><div class="mi l"><div class="mo l mk ml mm mi mn hl lz"/></div></div></a></div><div class="hh hi ez fb hj lz"><a href="https://www.amazon.com/Web-Development-Node-Express-Leveraging/dp/1492053511" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hq fi z dy me ea eb mf ed ef ho bi translated">使用Node和Express进行Web开发:利用JavaScript堆栈</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">使用Node和Express进行Web开发:利用Amazon.com的JavaScript堆栈。*免费*送货到…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">www.amazon.com</p></div></div><div class="mi l"><div class="mp l mk ml mm mi mn hl lz"/></div></div></a></div><div class="hh hi ez fb hj lz"><a href="https://jestjs.io/" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hq fi z dy me ea eb mf ed ef ho bi translated">玩笑</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">Jest是一个JavaScript测试框架，旨在确保任何JavaScript代码库的正确性。它允许您…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">jet js . io</p></div></div><div class="mi l"><div class="mq l mk ml mm mi mn hl lz"/></div></div></a></div></div></div>    
</body>
</html>