<html>
<head>
<title>Containerize a Django (rest framework with nginx) Application With Docker Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Docker Compose封装Django (rest框架和nginx)应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/containerize-a-django-rest-framework-with-nginx-application-with-docker-compose-a6f4378f7471?source=collection_archive---------0-----------------------#2020-09-22">https://medium.com/geekculture/containerize-a-django-rest-framework-with-nginx-application-with-docker-compose-a6f4378f7471?source=collection_archive---------0-----------------------#2020-09-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2f17b178f851eb7253d6f1e13aa32ee7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zZsN4Noy9prpYD-G"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@frankiefoto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">frank mckenna</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="e48c" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">介绍</h1><p id="7123" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">所以在我们开始实际实现之前，我想解释一下docker是什么，以及它是如何带来好处的。</p><p id="7c14" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">如果你在网上查过，你会发现docker有这些组件。</p><ul class=""><li id="31e5" class="kw kx hi jv b jw kr ka ks ke ky ki kz km la kq lb lc ld le bi translated"><strong class="jv hj"> <em class="lf">适用于Mac、Windows或Linux的Docker</em></strong><em class="lf">——它允许人们在各自的操作系统上运行Docker容器。</em></li><li id="3209" class="kw kx hi jv b jw lg ka lh ke li ki lj km lk kq lb lc ld le bi translated"><strong class="jv hj"> <em class="lf"> Docker引擎</em></strong><em class="lf">——用于构建Docker镜像和创建Docker容器。</em></li><li id="6853" class="kw kx hi jv b jw lg ka lh ke li ki lj km lk kq lb lc ld le bi translated"><strong class="jv hj"><em class="lf">Docker Hub</em></strong><em class="lf">——这是用来托管各种Docker图像的注册表。</em></li><li id="0621" class="kw kx hi jv b jw lg ka lh ke li ki lj km lk kq lb lc ld le bi translated"><strong class="jv hj"><em class="lf">Docker Compose</em></strong><em class="lf">——用于定义使用多个Docker容器的应用。</em></li></ul><p id="7098" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">使用docker，我们实际上实现的是一个可以在任何主机环境下工作的设置。因此，它可以消除我们面临的许多部署问题，比如在开发环境中工作的某些特定设置可能无法在生产环境中工作。</p><p id="8860" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">我们将只关注如何使用nginx作为反向代理将docker实现到Django restful应用程序中。django和docker的任何安装都超出了本文的范围。</p><h1 id="b9ab" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">说够了，让我们实际做吧！</h1><p id="0a06" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们将创建两个docker文件</p><ol class=""><li id="1dc3" class="kw kx hi jv b jw kr ka ks ke ky ki kz km la kq ll lc ld le bi translated">用于django应用程序配置。</li><li id="058b" class="kw kx hi jv b jw lg ka lh ke li ki lj km lk kq ll lc ld le bi translated">对于nginx配置。</li></ol><p id="ec3b" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">并将使用docker compose来创建两个可以相互协作的容器。</p><h2 id="ee69" class="lm iw hi bd ix ln lo lp jb lq lr ls jf ke lt lu jj ki lv lw jn km lx ly jr lz bi translated">1.Django Dockerfile</h2><p id="083d" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">这个文件需要放在django应用程序的根文件夹中。</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Dockerfile contents for the django applifcation.</figcaption></figure><p id="0448" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">我们从docker hub获得python:3.6.9-slim，并在/usr/src/app中创建一个临时工作目录。</p><p id="adb8" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">在我的例子中，它将安装所有像mariadb驱动程序这样的库，因为我在我的项目设置中使用mariadb mysql。</p><p id="6450" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">一旦完成，它将复制requirements.txt文件并安装它，然后将enire项目源代码复制到/usr/src/app/。</p><p id="a71b" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">现在我们实际上可以做<em class="lf"> docker build </em>来构建docker文件作为docker映像，但是我们将使用前面讨论过的docker compose来完成。</p><h2 id="681f" class="lm iw hi bd ix ln lo lp jb lq lr ls jf ke lt lu jj ki lv lw jn km lx ly jr lz bi translated">2.Nginx Dockerfile文件</h2><p id="a762" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">它被放在项目根目录下的nginx文件夹中，因为这样很容易区分它们。</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div><figcaption class="iq ir et er es is it bd b be z dx">Dockerfile contents for Nginx.</figcaption></figure><p id="2ff9" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">在这里，我们从docker hub获得nginx:1.17.4-alpine，删除default.conf文件并复制我们的conf文件。</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div><figcaption class="iq ir et er es is it bd b be z dx">nginx.conf file contents.</figcaption></figure><p id="8809" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">下面是我们如何将nginx作为一个反向代理。任何到达nginx容器的端口8000的流量都被提供给端口8001，因为我们将在端口8001上提供django应用程序，您将在docker compose文件中看到它。</p><h2 id="82d8" class="lm iw hi bd ix ln lo lp jb lq lr ls jf ke lt lu jj ki lv lw jn km lx ly jr lz bi translated">让我们把它们放在docker-compose.yml中</h2><p id="fc59" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们将在项目根目录下创建一个docker-compose.yml文件</p><figure class="ma mb mc md fd ij"><div class="bz dy l di"><div class="me mf l"/></div><figcaption class="iq ir et er es is it bd b be z dx">docker-compose.yml file contents</figcaption></figure><p id="5b86" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">在docker-compose.yml文件中有两个服务，如你所见，一个是web，即djanfo服务，另一个是nginx，顾名思义就是nginx服务。</p><p id="f6bc" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">我们将在根目录下构建Dockerfile，也就是django Dockerfile，正如您在上面的代码中看到的，我们使用gunicon作为django应用程序在端口8001上的应用程序服务器(直到我们使用expose命令公开该端口，nginx才能访问该端口)。您拥有的任何环境文件都可以在env_file部分中给出。</p><p id="c73c" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">现在，nginx服务将使用我们已经创建的nginx文件夹中的Dockerfile，并且容器端口8000被映射到我们将要部署的服务器的端口80。</p><h2 id="e578" class="lm iw hi bd ix ln lo lp jb lq lr ls jf ke lt lu jj ki lv lw jn km lx ly jr lz bi translated">现在让我们变魔术吧！</h2><p id="ed72" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">当你跑步的时候</p><blockquote class="mg mh mi"><p id="4bbc" class="jt ju lf jv b jw kr jy jz ka ks kc kd mj kt kg kh mk ku kk kl ml kv ko kp kq hb bi translated">docker-撰写构建</p></blockquote><p id="7e2a" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">它将构建容器并</p><blockquote class="mg mh mi"><p id="3e06" class="jt ju lf jv b jw kr jy jz ka ks kc kd mj kt kg kh mk ku kk kl ml kv ko kp kq hb bi translated">docker-排版</p></blockquote><p id="3559" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">将运行所有的容器，你现在可以检查你的api的工作。</p><p id="6e48" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">为了辟邪</p><blockquote class="mg mh mi"><p id="f7c2" class="jt ju lf jv b jw kr jy jz ka ks kc kd mj kt kg kh mk ku kk kl ml kv ko kp kq hb bi translated">docker-撰写向上-d</p></blockquote><p id="b575" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">对于日志来说</p><blockquote class="mg mh mi"><p id="ae7f" class="jt ju lf jv b jw kr jy jz ka ks kc kd mj kt kg kh mk ku kk kl ml kv ko kp kq hb bi translated">docker-编写日志</p></blockquote><p id="1b16" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">停止服务使用</p><blockquote class="mg mh mi"><p id="fef3" class="jt ju lf jv b jw kr jy jz ka ks kc kd mj kt kg kh mk ku kk kl ml kv ko kp kq hb bi translated">docker-向下合成</p></blockquote><h1 id="d201" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">结论</h1><p id="7ca7" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">万岁！我们终于完成了django restful应用程序的dockerized，现在是庆祝的时候了。</p></div></div>    
</body>
</html>