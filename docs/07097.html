<html>
<head>
<title>Keep AWS cost in check</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">控制AWS成本</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/keep-aws-cost-in-check-d31543d1d54e?source=collection_archive---------19-----------------------#2021-09-07">https://medium.com/geekculture/keep-aws-cost-in-check-d31543d1d54e?source=collection_archive---------19-----------------------#2021-09-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9e68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">AWS生态系统提供了丰富的服务，促进了云应用程序开发和操作的各个方面。然而，这些服务的成本很容易在一段时间后失控。它可能来自应用程序设计、基础设施设计中的错误，或者仅仅是因为事情发生了变化。控制成本对任何项目都至关重要。以下是我控制AWS成本的一些方法</p><h1 id="6251" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">监控成本</h1><p id="45fd" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">首先，应该有效地监控成本。可以使用Cost Explorer和AWS Budget来完成。</p><h2 id="bb19" class="kg je hi bd jf kh ki kj jj kk kl km jn iq kn ko jr iu kp kq jv iy kr ks jz kt bi translated">成本浏览器</h2><p id="f9c8" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">成本浏览器是一个很好的开始方式。它显示了客户/组织正在使用的每项AWS服务的成本。<em class="ku">过滤器</em>和<em class="ku">分组</em>非常有助于浏览每一个成本细节。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/2839b717f1d725adb782425e77897d23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iY5D9sR3a3HYhwr6yUltPA.png"/></div></div></figure><p id="22e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">比如我一般会去Group by: Service查看当月每项服务的费用。如果我发现一项服务产生了不寻常的费用，我将使用过滤器挑选出该服务，然后按关联帐户/地区/使用类型分组…以获得更多信息，并最终找到费用的原因。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lh"><img src="../Images/c3ba21a35a237e64678c807d2b534d74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HoVyDvvp1V4n2aFZ3jWKqg.png"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx">Group by and Filters tells me that the sudden surge in EC2 cost is from Nat Gateway data transfer</figcaption></figure><p id="4d24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上图取自我的EC2成本调查。它揭示了Nat网关数据传输是导致EC2成本异常高的罪魁祸首。进一步的调查表明，DMS实例每天通过Nat网关将RDS数据推送到S3进行分析是根本原因。添加一个VPC端点有效地解决了这个问题，避免了它可能被忽视的可怕错误。</p><h2 id="d0b2" class="kg je hi bd jf kh ki kj jj kk kl km jn iq kn ko jr iu kp kq jv iy kr ks jz kt bi translated">AWS预算</h2><p id="6f90" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">探索成本是第一步，下一步应该是应用预算，以便在成本超过阈值时发出警报。AWS Budget允许您按服务、帐户、使用类型…创建预算，并在警报触发时触发SNS或Lambda。设置闹钟向slack、sms发送消息，或者用Lambda对AWS资源做一些事情，只要通知在检查中，您就可以安心地知道成本在检查中。</p><h1 id="bbfe" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">降低成本</h1><p id="f76d" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">成本监控系统到位后，就可以开始优化成本了。对于每个特定的项目，有很多降低成本的方法。以下是我的一些想法:</p><h2 id="28d2" class="kg je hi bd jf kh ki kj jj kk kl km jn iq kn ko jr iu kp kq jv iy kr ks jz kt bi translated">购买保留实例或保存计划</h2><p id="f281" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">一个伟大而简单的方法来减少每月发生的费用是预先支付，以RI(保留实例)或储蓄计划的形式。基于您过去支付的金额，AWS将为您推荐合适的购买计划，如果您信任AWS计算。但是，由于算法不了解未来的使用计划，例如从现在起2个月后，该功能将被删除，并且不再需要该类型的实例，我发现自己计算并仅使用AWS建议作为参考会更好。</p><h2 id="97a4" class="kg je hi bd jf kh ki kj jj kk kl km jn iq kn ko jr iu kp kq jv iy kr ks jz kt bi translated">调整资源</h2><p id="343c" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">资源是用来实现某种预期目的的。唯一的问题是有时期望与现实不符，这导致资源要么计划不足，要么计划过度。两者都不好，但是人们倾向于安全行事，喜欢过度规划而不是规划不足。一段时间后，那些过度计划的资源会啃掉一大块钱。偶尔调优资源可能会让您免于这种情况。</p><p id="bb2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了优化任何资源，您必须有一种方法来监控该资源。在AWS上，通常是Cloudwatch指标，但任何其他工具也可以完成这项工作。调优候选可以是任何东西，从EC2实例规范到自动缩放组、lambda规范、RDS规范等等。这些步骤是</p><ul class=""><li id="4e7d" class="lm ln hi ih b ii ij im in iq lo iu lp iy lq jc lr ls lt lu bi translated">检查所需资源的指标</li><li id="905e" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc lr ls lt lu bi translated">如果未充分利用，调整资源(减少规格、规模或改变类型)</li><li id="0ef1" class="lm ln hi ih b ii lv im lw iq lx iu ly iy lz jc lr ls lt lu bi translated">监控调整后的资源，以确保其正常有效地工作</li></ul><p id="6b50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个微妙的过程，所以要小心不要引入任何不良影响。迭代地引入小调优而不是大调优是一个好主意。</p><h2 id="eefa" class="kg je hi bd jf kh ki kj jj kk kl km jn iq kn ko jr iu kp kq jv iy kr ks jz kt bi translated">添加VPC端点</h2><p id="848b" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">通常，实例安全地位于私有子网内，并通过NAT网关与外界通信。然而，与数据相关的任务，如将RDS同步或备份到S3，或将AWS日志推送到Cloudwatch日志，可能会在NAT网关上产生如此多的流量，以至于数据传输成本失控。</p><p id="bbca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">幸运的是，AWS提出了VPC端点，这是一种更有效的与AWS服务对话的方式。流量将通过AWS网络私下进行，从而提高安全性和数据传输成本。</p><p id="6f5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，VPC端点不能完全删除NAT网关，这对于互联网流量是必要的。除此之外，还需要两个或更多的接口端点来保持高可用性。因此，拥有终端的额外成本可能会超出节省的数据传输成本，最终您会支付更多费用。为了避免这种情况，您应该仔细选择使用VPC端点的服务。</p><h1 id="3c67" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">结论</h1><p id="2f15" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">成本监控和一些富有想象力的想法是你控制账单所需要的。</p></div></div>    
</body>
</html>