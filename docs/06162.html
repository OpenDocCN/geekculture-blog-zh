<html>
<head>
<title>Microcontroller Connection Protocols: W1, I2C, SPI, UART</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微控制器连接协议:W1、I2C、SPI、UART</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/microcontroller-connection-protocols-w1-i2c-spi-uart-7625ad013e60?source=collection_archive---------1-----------------------#2021-08-09">https://medium.com/geekculture/microcontroller-connection-protocols-w1-i2c-spi-uart-7625ad013e60?source=collection_archive---------1-----------------------#2021-08-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3929c584e499aedd30941853ffc83ad8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YBZOpQpasfzesHXg7J7gbA.jpeg"/></div></div></figure><p id="9ddf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">像Arduino这样的微控制器是包括机器人在内的DIY项目的重要组成部分。在上一篇文章中，我们看到了Arduino Uno、Raspberry Pi和Raspberry Pico的引脚布局和GPIO功能。GPIO引脚既可以读取或写入数字数据，即连续的高电压或低电压，也可以处理模拟数据，即在压缩时间帧内在高电压和低电压之间交替变化的PWM信号。我们还看到，这些微控制器和单板计算机支持不同的GPIO功能，包括与其他硬件进行数据通信的协议。</p><p id="c5b0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本文对所有这些连接协议进行了概述。为了明确起见，我将介绍需要设备直接连线的协议，因此不包括无线电、蓝牙和WLAN之类的协议。对于每个协议，我将解释基本的工作原理，详细说明如何设置和连接设备，并讨论数据传输范围和数据量等方面。我将使用客户机-服务器的通用术语<a class="ae jo" href="https://en.wikipedia.org/wiki/Master%2Fslave_(technology)" rel="noopener ugc nofollow" target="_blank">来区分参与节点的角色。</a></p><p id="6688" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在第一部分，我们将了解串行通信的基本知识。接下来的几节将详细介绍以下每个协议:</p><ul class=""><li id="33ec" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">W1(单线)</li><li id="7c9a" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">I2C (2线)</li><li id="a5cf" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">SPI (4线)</li><li id="28df" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">UART/RS232</li></ul><p id="1ea5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kd">本文原载于</em> <a class="ae jo" href="https://admantium.com/blog/micro05_wired_connection_protocols/" rel="noopener ugc nofollow" target="_blank"> <em class="kd">我的博客</em> </a>。</p><h1 id="cb62" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">串行通信</h1><p id="9673" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated"><em class="kd">来源:</em><a class="ae jo" href="https://en.wikipedia.org/wiki/Serial_communication" rel="noopener ugc nofollow" target="_blank"><em class="kd">wikipedia.org</em></a></p><p id="c002" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">串行通信形成了许多集成电路设备的基本数据传输方法。本质上，数据是以一种方式从发送者传输到接收者的，一次一位。为了防止传输错误，传输的数据可以包括错误校验码，通常为<a class="ae jo" href="https://en.wikipedia.org/wiki/Cyclic_redundancy_check" rel="noopener ugc nofollow" target="_blank"> CRC </a>。为了确保传输成功，接收器可以发送确认信息。</p><p id="215a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在具有多个连接(管线、电线、电缆等)的成本较高的情况下，串行通信优于并行通信。)由于距离或制造成本太高。直到今天，串行通信还被广泛用于连接不同类型的硬件，形成了非常不同的协议的基础。</p><h1 id="1522" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">单线</h1><p id="b93f" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated"><em class="kd">来源:</em><a class="ae jo" href="https://en.wikipedia.org/wiki/1-Wire#cite_note-1" rel="noopener ugc nofollow" target="_blank"><em class="kd">【wikipedia.org】</em></a><em class="kd">|</em><a class="ae jo" href="https://www.maximintegrated.com/en/design/technical-documents/app-notes/7/74.html" rel="noopener ugc nofollow" target="_blank"><em class="kd">【maximnintegrated.com】</em></a></p><p id="3e0c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用1-Wire协议，仅使用一条数据传输/电源线<a class="ae jo" href="https://dev.to/admantium/microcontroller-connection-protocols-w1-i2c-spi-uart-57kl-temp-slug-3191988?preview=795a605a3f2955072ef67ddee563a592769a70e54b098edf6f8531a4646df2a2db271e3135eb9400ee25b3054746063fff3349b48d61e583a5572a6c#fn1" rel="noopener ugc nofollow" target="_blank"> 1 </a>就可以在服务器和多个客户端之间建立一对多连接。该连接是半双工、双向的，传输速度为16.3Khz。</p><p id="6007" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通常，开漏<a class="ae jo" href="https://en.wikipedia.org/wiki/Open_collector#MOSFET" rel="noopener ugc nofollow" target="_blank"> MOSFET </a>用于连接器件。通过使用上拉电阻，服务器和客户端之间的连接处于高电压状态。为了传输数据，上拉电阻连接到地，然后在服务器和客户端之间建立低压连接用于数据传输。高电压状态用于给电容器充电，该电容器向连接的客户端供电。</p><p id="4b21" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">消息为8位<a class="ae jo" href="https://en.wikipedia.org/wiki/Bit_numbering#Most_significant_bit" rel="noopener ugc nofollow" target="_blank"> MSB </a>。一个典型的事务工作如下:</p><ul class=""><li id="40d7" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">服务器发送一个复位脉冲</li><li id="d19e" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">客户端发送确认消息</li><li id="d20c" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">服务器发送一个8位命令</li><li id="ee3f" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">服务器和客户端交换8位数据组</li><li id="1b15" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">为了防止传输错误，可以使用8位<a class="ae jo" href="https://en.wikipedia.org/wiki/Cyclic_redundancy_check" rel="noopener ugc nofollow" target="_blank">CRC</a></li></ul><h1 id="46d1" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">I2C</h1><p id="9e2e" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated"><em class="kd">来源:【wikipedia.org】<a class="ae jo" href="https://en.wikipedia.org/wiki/I%C2%B2C" rel="noopener ugc nofollow" target="_blank"><em class="kd"/></a></em></p><p id="fc4c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">集成电路间I2C是一种双线协议，支持客户端和服务器之间的多对多连接:两条线是串行数据(SDA)和串行时钟(SCL)。该连接是半双工、双向的，具有0.1、0.4、1.0、3.4或5.0 MBit的固定、可配置传输速度。</p><p id="4d12" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">SDA和SCL线始终保持在高电压级，其中SDA线使用上拉电阻。当服务器开始传输时，它会关闭MOSFET栅极，将SDA线拉低至低电平状态。然后，通过向SDA线和SCL线施加不同的电压，传输信息。SDA线路上的低电压也意味着一个主节点正在通信，使其它节点保持安静。SCL线上的低电压对客户意味着相同的信息。</p><p id="b00e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">I2C总线上的所有设备都有7位地址。为了寻址设备和接收配置，需要使用2位。因此，I2C的所有消息都是9位MSB。典型的交易是:</p><ul class=""><li id="67c9" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">服务器发送一个7位地址和一个读/写位</li><li id="25e6" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">被寻址的客户端用一个位进行确认(从而完成9位消息格式)</li><li id="769d" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">根据消息，服务器或者向客户端发送写入数据，以区分寄存器/缓冲区和要写入的数据，或者期望客户端将其数据写入服务器从中读取的指定寄存器/缓冲区</li><li id="7d11" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">当SDA和SCL再次处于高电平状态时，传输结束</li></ul><p id="f05c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">I2C系统有一组复杂的寄存器，用于捕获系统的全局状态，并协调不同设备如何交互。寄存器地址及其数据因供应商和器件而异。</p><h1 id="273b" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">精力</h1><p id="2202" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated"><em class="kd">来源:</em><a class="ae jo" href="https://en.wikipedia.org/wiki/Serial_Peripheral_Interface" rel="noopener ugc nofollow" target="_blank"><em class="kd">【wikipedia.org】</em></a><em class="kd">|</em><a class="ae jo" href="https://www.byteparadigm.com/applications/introduction-to-i2c-and-spi-protocols/?/article/AA-00255/22/Introduction-to-SPI-and-IC-protocols.html" rel="noopener ugc nofollow" target="_blank"><em class="kd">【byteparadigm.com】</em></a></p><p id="d72c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">SPI(串行外设接口)是一种多对一的连接协议，可将多个客户端连接到一台服务器。它需要4根线:SCL用于时钟，SCS用于选择客户端，SDTS用于服务器的数据传输，SDTC用于客户端的数据传输。该连接是全双工、双向的，并且对传输速度没有限制(可以达到10MB或更高)。</p><p id="3a57" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">位帧是可配置的，通常为8位，但也可使用12位或16位。数据以LSB发送。</p><p id="cfec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在基极状态，SCS为高(使用上拉电阻)，SCL、SDTS和SDTC为低。当服务器启动通信时，它使用MOSFET栅极将SCS拉低，并通过SCL发送数据。然后，服务器使用SDTS，选定的客户端使用SDTC进行全双工通信。</p><p id="1e71" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">典型的通信如下:</p><ul class=""><li id="2bc5" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">服务器确定连接到客户端的时钟速度</li><li id="bb8f" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">服务器将SCS设置为低电压，并通过SDTS发送数据</li><li id="532a" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">被寻址的客户端在SDTC线路上以选定的时钟速度响应</li><li id="a11a" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">服务器和客户端交换数据</li><li id="da99" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">服务器将SCS设置为高电压，将SCL设置为低电压</li></ul><p id="2bb6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">SPI要求每个连接的客户端都有一根专用的SDTC线，这对集成电路设计有很大影响。因此，<a class="ae jo" href="https://www.maximintegrated.com/en/design/technical-documents/app-notes/3/3947.html" rel="noopener ugc nofollow" target="_blank">菊花链</a>可用于设计一个只有SDTC线的电路，并对数据传输协议进行额外的修改。有趣的是，SPI协议没有固定的标准，但有几个供应商特定的实现遵循相同的准则。</p><h1 id="a426" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">UART和RS-232</h1><p id="ffa6" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated"><em class="kd">来源:UART</em><a class="ae jo" href="https://en.wikipedia.org/wiki/Universal_asynchronous_receiver-transmitter" rel="noopener ugc nofollow" target="_blank"><em class="kd">wikipedia.org</em></a><em class="kd">| RS-232</em><a class="ae jo" href="https://en.wikipedia.org/wiki/RS-232" rel="noopener ugc nofollow" target="_blank"><em class="kd">wikipedia.org</em></a></p><p id="291b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这两种协议管理两个设备之间的直接一对一连接。具体来说，RS-232定义了物理传输特性:电信号、它们的时序和含义，以及硬件引脚和连接器的物理尺寸。一个最小的RS-232连接只需要两根线就可以实现:TXD用于传输数据，RXC用于接收数据。在这个身体标准之上。UART定义了逻辑消息，这是非常可配置的:单工、半双工或全双工，具有至少115，2 KBit的可变通信速度。</p><p id="6d69" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在基准州，TXD和RXD线都很高。发送方将TXD切换到高电平，并立即开始传输数据，而接收方使用RXD来确认数据。发送者和接收者也使用这些线路来同步他们的时钟</p><p id="dd10" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">传输数据为7–11位LSB，包括起始位和停止位。</p><p id="b96c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">典型的消息交换如下:</p><ul class=""><li id="db8e" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">发送方发送起始位、5位或9位消息和停止位</li><li id="8167" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">接收者在他的移位寄存器中缓冲输入的信息</li><li id="5fcb" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">当不再接收到数据时——例如，一个完整的时钟周期处于逻辑低状态——来自移位发送器的数据被刷新到集成电路的其他部分</li></ul><p id="a8b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">UART标准的历史意义很有趣。虽然RS-232-COM端口的早期物理表现形式几乎从今天的终端消费者计算机中消失，但该标准在许多微控制器中被模仿，以允许usb上的串行连接。</p><h1 id="d5c8" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">比较</h1><p id="4d75" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">下表总结了每种协议的特征:</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/81878b33bcf8b09fe997f31f4e98ab44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GMtTJKdjNyNSYh_1jYFvkQ.png"/></div></div></figure><p id="9d87" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意:SPI系统的特性取决于整体设置:微处理器的时钟速度、电阻总数等。</p><h1 id="aceb" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">结论</h1><p id="1493" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">在微控制器和传感器之间形成有线连接以交换数据是您在项目中会遇到的一项任务。本文解释了单线、I2C、SPI和UART/RS232连接协议的基础知识。我们解释了消息同步性、比特率和帧结构等方面，以及物理方面，如有多少客户端可以连接以及所有线路的总距离有多长。您将在项目中使用哪种协议？</p><h1 id="14e9" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">脚注</h1><ol class=""><li id="7d8b" class="jp jq hi is b it lc ix ld jb lm jf ln jj lo jn lp jv jw jx bi translated">集成电路中的所有器件都需要接地，所以从技术上来说，需要两根导线。<a class="ae jo" href="https://dev.to/admantium/microcontroller-connection-protocols-w1-i2c-spi-uart-57kl-temp-slug-3191988?preview=795a605a3f2955072ef67ddee563a592769a70e54b098edf6f8531a4646df2a2db271e3135eb9400ee25b3054746063fff3349b48d61e583a5572a6c#fnref1" rel="noopener ugc nofollow" target="_blank"> ↩ </a></li></ol></div></div>    
</body>
</html>