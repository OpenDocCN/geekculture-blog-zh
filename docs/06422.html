<html>
<head>
<title>Yourkit Remote Java Application Profiling with Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Docker进行远程Java应用程序剖析</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/yourkit-remote-java-application-profiling-with-docker-b2667eb88082?source=collection_archive---------14-----------------------#2021-08-19">https://medium.com/geekculture/yourkit-remote-java-application-profiling-with-docker-b2667eb88082?source=collection_archive---------14-----------------------#2021-08-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/1e633551f96d5f3b097a4c5ced6b57f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PcVV-Stq79lbp4y8tYcdqA.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Photo by <a class="ae hv" href="https://unsplash.com/@casparrubin?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Caspar Camille Rubin</a> on <a class="ae hv" href="https://unsplash.com/s/photos/java-memory-profiling?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="75ca" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对我来说，剖析java应用程序一直很棘手。与分析远程java应用程序相比，分析本地java应用程序更容易。</p><p id="8abe" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">几天前，我在寻找分析远程java应用程序的方法，并花了相当多的时间来找出如何在不增加公司额外成本的情况下做到这一点。在寻找解决方案的过程中，我尝试使用了您的工具包工具，该工具允许您下载并免费使用15天，用于工具评估目的(我认为15天足以识别您的应用程序的问题😆).所以让我们开门见山，不要再浪费你的时间了。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="7c8e" class="ka kb hy bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">要遵循的步骤。</h2><ul class=""><li id="5837" class="kv kw hy ix b iy kx jc ky jg kz jk la jo lb js lc ld le lf bi translated">使用命令<br/><strong class="ix hz">ssh到您的docker容器主机，例如ssh &lt; docker主机域或IP &gt; </strong></li><li id="7a93" class="kv kw hy ix b iy lg jc lh jg li jk lj jo lk js lc ld le lf bi translated">然后运行以下命令，列出docker主机上的docker容器<br/>，例如docker ps</li><li id="aef4" class="kv kw hy ix b iy lg jc lh jg li jk lj jo lk js lc ld le lf bi translated">然后ssh进入你的docker容器，用下面的命令<br/>访问docker bash，比如docker exec -it &lt;容器id用docker ps &gt; bash标识</li><li id="2bb0" class="kv kw hy ix b iy lg jc lh jg li jk lj jo lk js lc ld le lf bi translated">然后，您需要在docker容器中下载您的工具包工具。运行以下命令下载并提取该工具。<br/> 1。yum安装wget <br/> 2。yum安装unzip <br/> 3。wget<a class="ae hv" href="https://www.yourkit.com/download/YourKit-JavaProfiler-2021.3-b231.zip" rel="noopener ugc nofollow" target="_blank">https://www . your kit . com/download/your kit-Java profiler-2021.3-b231 . zip</a><br/>4 .解压<a class="ae hv" href="https://www.yourkit.com/download/YourKit-JavaProfiler-2021.3-b231.zip" rel="noopener ugc nofollow" target="_blank">your kit-Java profiler-2021.3-b231 . zip</a><br/>5 RM<a class="ae hv" href="https://www.yourkit.com/download/YourKit-JavaProfiler-2021.3-b231.zip" rel="noopener ugc nofollow" target="_blank">your kit-Java profiler-2021.3-b231 . zip</a></li></ul><p id="68be" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦下载了您的kit工具和提取的内容，下一步就是识别您的java应用程序进程id，并将其附加到您的kit profiler代理。要执行“在下面运行”命令</p><p id="0381" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">sh your kit-java Profiler-2021.3/bin/attach . sh<br/></strong>该命令将列出docker容器中运行的所有Java进程id，并要求您选择要附加到profiler代理的进程id。该命令的输出如下所示</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="1e60" class="ka kb hy lq b fi lu lv l lw lx">Enumerating running JVMs with /home/YourKit-JavaProfiler-2021.3/jre64<br/>[YourKit Java Profiler 2021.3-b231] Log file: /root/.yjp/log/profiler-ui-3035.log<br/>Running JVMs:</span><span id="64c9" class="ka kb hy lq b fi ly lv l lw lx">Name                             |   PID| Profiler Agent                  <br/>-------------------------------- |------|--------------------------------<br/>MyApplicationTwo                 |    82| Not loaded                          <br/>Myapplication-19.3-fat.          |    13| Not loaded</span><span id="08ec" class="ka kb hy lq b fi ly lv l lw lx">Enter PID of the application you want to attach (0 to exit) and press Enter:</span></pre><p id="5c63" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在输入要附加到探查器代理的进程Id。一旦你输入了进程id并按下回车键，它将会要求你输入更多的内容，但是我建议你使用默认选项并按下回车键。</p><p id="8fbb" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，您的kit profiler代理将开始在<strong class="ix hz"> localhost:10001上列出。</strong></p><p id="a9a4" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以下是您可以在Yourkit profiler中使用的命令列表。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="1bdf" class="ka kb hy lq b fi lu lv l lw lx">Usage: <br/>java -jar yjp-controller-api-redist.jar &lt;host&gt; &lt;port&gt; &lt;command&gt;</span><span id="d018" class="ka kb hy lq b fi ly lv l lw lx">where &lt;command&gt; is one of:</span><span id="72e3" class="ka kb hy lq b fi ly lv l lw lx">status<br/>capture-memory-snapshot<br/>capture-hprof-snapshot<br/>capture-performance-snapshot<br/>start-sampling<br/>start-async-sampling-cpu<br/>start-tracing<br/>start-call-counting<br/>stop-cpu-profiling<br/>clear-cpu-data<br/>start-alloc-recording-all [alloc-sampled] <br/>  // record all objects<br/>start-alloc-recording-adaptive [alloc-sampled] <br/>  // record all objects with size &gt;= 4 KB, and only each 10th smaller object<br/>start-alloc-recording=&lt;N&gt;,&lt;B&gt; [alloc-sampled] <br/>  // record all objects with size &gt;= &lt;B&gt; bytes, and only each &lt;N&gt;-th smaller object<br/>stop-alloc-recording<br/>clear-alloc-data<br/>print-alloc-object-count<br/>  // get total count of all objects created during object allocation recording<br/>print-alloc-object-size<br/>  // get total size in bytes of all objects created during object allocation recording in full mode<br/>start-monitor-profiling<br/>stop-monitor-profiling<br/>clear-monitor-data<br/>start-stack-telemetry<br/>stop-stack-telemetry<br/>force-gc<br/>clear-charts</span><span id="22e4" class="ka kb hy lq b fi ly lv l lw lx">Examples:<br/>java -jar yjp-controller-api-redist.jar localhost 10001 capture-memory-snapshot<br/>java -jar yjp-controller-api-redist.jar localhost 10001 start-sampling<br/>java -jar yjp-controller-api-redist.jar localhost 10001 capture-performance-snapshot</span></pre><p id="216a" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，下一步是运行您认为有问题的用例，并捕获快照以使用您的套件应用程序进行分析。</p><blockquote class="lz ma mb"><p id="b02e" class="iv iw mc ix b iy iz ja jb jc jd je jf md jh ji jj me jl jm jn mf jp jq jr js hb bi translated">运行你的用例并捕获快照，捕获快照的命令是<br/><strong class="ix hz">Java-jar your kit-JavaProfiler-2021.3/lib/yjp-controller-API-redist . jar localhost 10001 Capture-performance-Snapshot</strong></p></blockquote><p id="7173" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您的工具包将快照存储在/root/Snapshots/文件夹中。在您的工具包完成以下格式的快照后，您还将获得关于您的工具包存储快照的位置的信息。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="8433" class="ka kb hy lq b fi lu lv l lw lx"> Snapshot captured: /root/Snapshots/MyApplicationOne-19.3-fat-2021-08-18.snapshot</span></pre><p id="40da" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您已经准备好了快照，您需要使用Yourkit应用程序对其进行分析。为此，您需要在本地机器上下载快照，并将其导入到您的kit应用程序中。</p><p id="c3c6" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">按照以下步骤在本地计算机上下载快照。请注意“.”(句号)在命令结束时，这将在当前目录下复制快照。</p><blockquote class="lz ma mb"><p id="c377" class="iv iw mc ix b iy iz ja jb jc jd je jf md jh ji jj me jl jm jn mf jp jq jr js hb bi translated">1)将快照复制到您的docker主机<br/>docker CP&lt;container _ id&gt;:/root/Snapshot s/my application one-19.3-fat-2021–08–18 . Snapshot。</p><p id="9e1b" class="iv iw mc ix b iy iz ja jb jc jd je jf md jh ji jj me jl jm jn mf jp jq jr js hb bi translated">2)将快照从docker主机复制到本地机器<br/> scp &lt;主机IP&gt;:/home/nchinchore/my application one-19.3-fat-2021–08–18 . Snapshot。</p></blockquote><p id="4b52" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在您在本地机器上有了快照，现在您将需要您的工具包应用程序来分析快照。根据你的操作系统从这里下载。</p><div class="hh hi ez fb hj mg"><a href="https://www.yourkit.com/java/profiler/download/" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab dw"><div class="mi ab mj cl cj mk"><h2 class="bd hz fi z dy ml ea eb mm ed ef hx bi translated">下载您的套件Java Profiler</h2><div class="mn l"><h3 class="bd b fi z dy ml ea eb mm ed ef dx translated">面向Java EE和Java SE平台的全功能低开销分析器。易于使用的性能和内存。网络…</h3></div><div class="mo l"><p class="bd b fp z dy ml ea eb mm ed ef dx translated">www.yourkit.com</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu hp mg"/></div></div></a></div><p id="58f4" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦你打开你的套件档案，它会问你激活密钥。您需要填写评估表，您将在提供的邮件中获得15天免费使用的评估密钥。</p><p id="cd0c" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">获得评估密钥后，添加该密钥并通过点击<strong class="ix hz">打开快照导入快照…并开始分析。</strong></p><p id="2846" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可能会重复执行这些步骤，直到你发现问题。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="1b09" class="ka kb hy lq b fi lu lv l lw lx">1) <strong class="lq hz">java -jar YourKit-JavaProfiler-2021.3/lib/yjp-controller-api-redist.jar localhost 10001</strong> <strong class="lq hz">clear-cpu-data</strong></span><span id="529b" class="ka kb hy lq b fi ly lv l lw lx">2) <strong class="lq hz">Run your use case </strong></span><span id="a81d" class="ka kb hy lq b fi ly lv l lw lx">3) <strong class="lq hz">java -jar YourKit-JavaProfiler-2021.3/lib/yjp-controller-api-redist.jar localhost 10001</strong> capture-memory-snapshot</span><span id="330c" class="ka kb hy lq b fi ly lv l lw lx">4) <strong class="lq hz">java -jar YourKit-JavaProfiler-2021.3/lib/yjp-controller-api-redist.jar localhost 10001 </strong>capture-performance-snapshot</span></pre><p id="1189" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">调试愉快…😆！！</p></div></div>    
</body>
</html>