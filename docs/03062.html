<html>
<head>
<title>Using JavaScript to translate crypto trade records from CSV to JSON</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用JavaScript将加密交易记录从CSV转换为JSON</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/using-javascript-to-translate-crypto-trade-records-from-csv-to-json-6800917adba6?source=collection_archive---------47-----------------------#2021-05-30">https://medium.com/geekculture/using-javascript-to-translate-crypto-trade-records-from-csv-to-json-6800917adba6?source=collection_archive---------47-----------------------#2021-05-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="1338" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">解释本地加密货币交易所#Foxbit的交易记录时面临的挑战</h2></div><p id="5613" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本文假设您了解使用加密货币交易所进行交易的基础知识。当用户进行多项交易时，购买和出售，交易所将存储记录。一般来说，这些记录是供下载的，对会计或税务用途很有用。</p><p id="70ce" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些记录的格式没有标准化。因此，由交易所决定其格式和结构。在接下来的几节中，您将按照步骤来理解一个特定的交易所是如何使用CSV文件组织其交易历史的。</p><p id="9ec9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的目标是理解文件结构，然后我们将解析数据并生成JSON输出，这是一种更灵活的文件格式，便于软件操作。</p><h1 id="7a11" class="jt ju hi bd jv jw jx jy jz ka kb kc kd io ke ip kf ir kg is kh iu ki iv kj kk bi translated">了解CSV文件和结构化格式</h1><p id="b325" class="pw-post-body-paragraph ix iy hi iz b ja kl ij jc jd km im jf jg kn ji jj jk ko jm jn jo kp jq jr js hb bi translated">接下来的部分，以及伴随的例子，是Foxbit——一个巴西的加密货币交易所所特有的。</p><p id="3559" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我没有问他们为什么是CSV，但我可以假设他们这么做了，因为a) <strong class="iz hj"> CSV是基于文本的，</strong>和b) <strong class="iz hj">每行可以显示多个值，用逗号分隔</strong>。这种格式的简单性允许任何人将其导入流行的电子表格系统。Foxbit发表了一篇<a class="ae kq" href="https://foxbit.com.br/blog/como-utilizar-arquivo-em-csv/" rel="noopener ugc nofollow" target="_blank">操作文章，解释了如何在电子表格</a>中导入CSV文件。让我们来庆祝一下如果您将CSV导入电子表格，它会是什么样子:</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kr"><img src="../Images/7d49030c3c693a68fcda96da071cb0e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RSsFlSGaMpvxnb9jGC8xqg.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">Example of a CSV file CSV-Foxbit-version1 imported using Google Spreadsheets</figcaption></figure><h2 id="8576" class="lh ju hi bd jv li lj lk jz ll lm ln kd jg lo lp kf jk lq lr kh jo ls lt kj lu bi translated">识别每笔交易(用三元组描述)</h2><p id="af8d" class="pw-post-body-paragraph ix iy hi iz b ja kl ij jc jd km im jf jg kn ji jj jk ko jm jn jo kp jq jr js hb bi translated">下面是从参考资料部分找到的CSV文件中截取的一小部分。考虑前五行，它指的是标题行、存款和一笔交易(用<strong class="iz hj">粗体</strong>表示)，由三行描述:</p><pre class="ks kt ku kv fd lv lw lx ly aw lz bi"><span id="9ac2" class="lh ju hi lw b fi ma mb l mc md">data,descricao,moeda,valor,taxa,saldo,dados</span><span id="d354" class="lh ju hi lw b fi me mb l mc md">03/09/2020 16:41:28,Depósito,BRL,"5000,00000000","0,00000000","5006,46000000",BRASIL PLURAL</span><span id="0a64" class="lh ju hi lw b fi me mb l mc md"><strong class="lw hj">03/09/2020 16:44:26,Trade,BTC,"0,08673929","0,00000000","0,08706877","Preço do Ativo: R$ 57625,57"</strong></span><span id="1170" class="lh ju hi lw b fi me mb l mc md"><strong class="lw hj">03/09/2020 16:44:26,Trade,BRL,"-4998,40000000","0,00000000","8,06000000","Preço do Ativo: R$ 57625,57"</strong></span><span id="6f37" class="lh ju hi lw b fi me mb l mc md"><strong class="lw hj">03/09/2020 16:44:26,Comissão no Trade,BTC,"0,00000000","-0,00043370","0,08663507",</strong></span></pre><p id="9185" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第一行只是一个标题，它试图解释每行的内容。<em class="mf">数据</em>为日期，<em class="mf"> descricao </em>为描述，<em class="mf"> moeda </em>为资产类型，<em class="mf"> valor </em>为价值，<em class="mf"> taxa </em>为费用，<em class="mf"> saldo </em>为余额，<em class="mf">数据</em>为附加备注字段。</p><pre class="ks kt ku kv fd lv lw lx ly aw lz bi"><span id="1258" class="lh ju hi lw b fi ma mb l mc md">data,descricao,moeda,valor,taxa,saldo,dados</span></pre><p id="d089" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">删除它，您将得到下面显示存款的行。在16:41，这意味着一笔钱，5000.00 BRL，被存入交易所，总余额上升到5006，46 BRL。因此，该数据显示用户帐户中已经有6.46 BRL。</p><pre class="ks kt ku kv fd lv lw lx ly aw lz bi"><span id="d520" class="lh ju hi lw b fi ma mb l mc md">03/09/2020 16:41:28,Depósito,BRL,"5000,00000000","0,00000000","5006,46000000",BRASIL PLURAL</span></pre><p id="6042" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面三行解释了一个交易——16:44处理的一个交易。“贸易”这个词可能会引起混淆。这更像是交易的一部分。</p><pre class="ks kt ku kv fd lv lw lx ly aw lz bi"><span id="f00f" class="lh ju hi lw b fi ma mb l mc md">03/09/2020 16:44:26,Trade,BTC,"0,08673929","0,00000000","0,08706877","Preço do Ativo: R$ 57625,57"</span><span id="94da" class="lh ju hi lw b fi me mb l mc md">03/09/2020 16:44:26,Trade,BRL,"-4998,40000000","0,00000000","8,06000000","Preço do Ativo: R$ 57625,57"</span><span id="2b3e" class="lh ju hi lw b fi me mb l mc md">03/09/2020 16:44:26,Comissão no Trade,BTC,"0,00000000","-0,00043370","0,08663507",</span></pre><p id="82a2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第一行意味着0.08673929 BTC被买入，新的余额变成0.08706877 BTC。因此，此用户帐户在此事件之前具有(0.08706877- 0.08673929) BTC。请注意，第5个属性，即fee属性，没有被使用。是的，它显示的是“0，00000000”的值，这很令人困惑。你可以忽略它。我更希望该字段类似于“NA”而不是“0，00000000”。你会看到第三行描述了佣金。</p><p id="2c96" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第二行是指在BRL的付款。它告诉我们-4998.40 BRL被从用户帐户中取走，这导致了8.06 BRL的余额。这个例子可能会令人困惑(为什么会把8.06放在那里)，但这是可能发生的事情。我不是在评判这篇文章中的数据。</p><p id="1ff0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第三行表示在该交易中应用的实际佣金0.0004337 BTC。该费用基于购买事件的总金额，即第一行的值0.08706877 BTC，因此余额为0.08663507 BTC。</p><h1 id="efc4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd io ke ip kf ir kg is kh iu ki iv kj kk bi translated">作为事件组织</h1><p id="51e0" class="pw-post-body-paragraph ix iy hi iz b ja kl ij jc jd km im jf jg kn ji jj jk ko jm jn jo kp jq jr js hb bi translated">从会计的角度来看，三个有意义的事件同时发生。为了更有意义地讲述故事，让我们调整一下顺序:</p><ul class=""><li id="4475" class="mg mh hi iz b ja jb jd je jg mi jk mj jo mk js ml mm mn mo bi translated"><strong class="iz hj">事件A，为了购买BTC，从账户中取走了4998.00 BRL，导致余额为8.06 BRL—</strong><em class="mf">03/09/2020 16:44:26，贸易，BRL，“-4998，400000000”，“0，0000000”，“8，06000000”，“preo do Ativo:R $ 57625，57”</em></li><li id="db94" class="mg mh hi iz b ja mp jd mq jg mr jk ms jo mt js ml mm mn mo bi translated"><strong class="iz hj">事件B，0.08673929 BTC被收购，导致0.08706877 BTC</strong>—<em class="mf">03/09/2020 16:44:26，贸易，BTC，" 0.08673929 "，" 0.000000000 "，" 0.08706877 "，" preo do Ativo:R $ 57625.57 "</em></li><li id="c154" class="mg mh hi iz b ja mp jd mq jg mr jk ms jo mt js ml mm mn mo bi translated"><strong class="iz hj">事件C，在BTC收取了一笔费用，该费用是根据获得的金额(0.08673929 BTC)计算的，导致从0.08706877 BTC的总余额中扣除0.00043370 BTC，这导致用户账户中的0.08663507 BTC</strong>—<em class="mf">03/09/2020 16:44:26，BTC科米索无贸易，“0</em></li></ul><h1 id="cd5f" class="jt ju hi bd jv jw jx jy jz ka kb kc kd io ke ip kf ir kg is kh iu ki iv kj kk bi translated">解析每笔交易的挑战(可选)</h1><p id="224d" class="pw-post-body-paragraph ix iy hi iz b ja kl ij jc jd km im jf jg kn ji jj jk ko jm jn jo kp jq jr js hb bi translated">你可以在这里选择退出，但是如果你好奇的话，我必须应对挑战来解析这些交易。我最初的假设是，订单严格用三行来描述一笔交易:交易操作、交易操作、佣金。我称这个订单为TTC订单。</p><p id="e425" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是在试图解析它的时候，我发现三元组会以不同的顺序出现，比如TTC或者TCT。下面的屏幕截图显示了这一挑战:</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kr"><img src="../Images/21aa64c06b0ba7014a9701661a141049.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZyKm1gnQHrutSL5BVqo5yg.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">The trade in green is BUY trade, described by two Trade lines followed by a Fee line. The trade in yellow is also a buy kind of trade, described in a different order, TFT.</figcaption></figure><h1 id="c5d6" class="jt ju hi bd jv jw jx jy jz ka kb kc kd io ke ip kf ir kg is kh iu ki iv kj kk bi translated">解决方案—缓冲线路，直到满足标准</h1><p id="0c5f" class="pw-post-body-paragraph ix iy hi iz b ja kl ij jc jd km im jf jg kn ji jj jk ko jm jn jo kp jq jr js hb bi translated">一种可能的解决方案是读取行，直到预期的行就位。找到两个交易操作和一个佣金后，当所有条件都具备时，就该准备交易数据了。</p><h2 id="3df8" class="lh ju hi bd jv li lj lk jz ll lm ln kd jg lo lp kf jk lq lr kh jo ls lt kj lu bi translated">朝着我们的目标前进</h2><p id="cb90" class="pw-post-body-paragraph ix iy hi iz b ja kl ij jc jd km im jf jg kn ji jj jk ko jm jn jo kp jq jr js hb bi translated">我们的目标是生成关于每笔交易的尽可能多的信息。因此，考虑以下主要描述符:</p><ul class=""><li id="9a13" class="mg mh hi iz b ja jb jd je jg mi jk mj jo mk js ml mm mn mo bi translated">“来自”——代表给定的资产。</li><li id="45ed" class="mg mh hi iz b ja mp jd mq jg mr jk ms jo mt js ml mm mn mo bi translated">“至”——代表被取走的资产。</li><li id="1c3d" class="mg mh hi iz b ja mp jd mq jg mr jk ms jo mt js ml mm mn mo bi translated">“费用”——代表手术完成后收取的佣金。</li></ul><p id="cf8a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要明白方向，买还是卖，我是在交易佣金适用的时候学的。佣金是在手术后收取的。因此，例如，如果您使用BRL购买BTC，费用将从BTC收取。同样，如果你卖出BTC，费用将从你的BRL账户中扣除。</p><p id="e7ba" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以关于方向的信息可以从佣金线来。在以下示例中，佣金行表明该操作使用BRL购买BTC:</p><ul class=""><li id="7fb7" class="mg mh hi iz b ja jb jd je jg mi jk mj jo mk js ml mm mn mo bi translated"><em class="mf"> 16:44:26，BTC贸易委员会，“0，000，000，000”，“-0，00043370”，“0，08663507”，</em></li></ul><p id="6a98" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此,“从”对象可以通过BRL工具的交易操作来形成。相反地,“到”对象是由其他操作形成的。换句话说，顺序不再重要，如代码所示:</p><pre class="ks kt ku kv fd lv lw lx ly aw lz bi"><span id="596f" class="lh ju hi lw b fi ma mb l mc md"><strong class="lw hj">if(tradeCurrent.out.fee.instrument == tradeCurrent.in.csvLineTradeTmp1Instrument) {</strong></span><span id="c97a" class="lh ju hi lw b fi me mb l mc md">tradeCurrent.out.from = parseInstrument(tradeCurrent.in.csvLineTradeTmp2);</span><span id="25c3" class="lh ju hi lw b fi me mb l mc md">tradeCurrent.out.to =  parseInstrument(tradeCurrent.in.csvLineTradeTmp1);</span><span id="089e" class="lh ju hi lw b fi me mb l mc md">} else {</span><span id="cc0f" class="lh ju hi lw b fi me mb l mc md">tradeCurrent.out.from = parseInstrument(tradeCurrent.in.csvLineTradeTmp1);</span><span id="611e" class="lh ju hi lw b fi me mb l mc md">tradeCurrent.out.to =  parseInstrument(tradeCurrent.in.csvLineTradeTmp2);</span><span id="62d5" class="lh ju hi lw b fi me mb l mc md">}</span></pre><h1 id="a725" class="jt ju hi bd jv jw jx jy jz ka kb kc kd io ke ip kf ir kg is kh iu ki iv kj kk bi translated">我们的JSON</h1><p id="3462" class="pw-post-body-paragraph ix iy hi iz b ja kl ij jc jd km im jf jg kn ji jj jk ko jm jn jo kp jq jr js hb bi translated">出于责任的考虑，我决定将原始数据保存在JSON对象中。对于每笔交易，我们的输出对象分为两部分。“进”和“出”。“in”保存从CSV收集的行。“out”对象是我们的结果结构的占位符。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es mu"><img src="../Images/114b168bcdd9d132b2cb795ea79ffd73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UMNXs42lOrwQq2SfEFCCiw.png"/></div></div></figure><h1 id="9e74" class="jt ju hi bd jv jw jx jy jz ka kb kc kd io ke ip kf ir kg is kh iu ki iv kj kk bi translated">结论</h1><p id="3469" class="pw-post-body-paragraph ix iy hi iz b ja kl ij jc jd km im jf jg kn ji jj jk ko jm jn jo kp jq jr js hb bi translated">假设您对处理与交易相关的记录文件感兴趣，我希望这篇概述能对您有所帮助。虽然这种转换不是一个复杂的项目，但我的目标是揭示一些想法，以帮助理解数据通常是如何被交换所构造和告知的。现在，从这里开始，开发商可以在数据的基础上进行计算，例如平均购买价格；并走向更复杂的解决方案。</p><h1 id="4cb3" class="jt ju hi bd jv jw jx jy jz ka kb kc kd io ke ip kf ir kg is kh iu ki iv kj kk bi translated">参考</h1><ul class=""><li id="f48d" class="mg mh hi iz b ja kl jd km jg mv jk mw jo mx js ml mm mn mo bi translated"><a class="ae kq" href="https://foxbit.com.br/blog/como-utilizar-arquivo-em-csv/" rel="noopener ugc nofollow" target="_blank">如何导入Foxbit CSV文件</a>(葡萄牙语-BR)。</li><li id="86a6" class="mg mh hi iz b ja mp jd mq jg mr jk ms jo mt js ml mm mn mo bi translated"><a class="ae kq" href="https://github.com/taboca/article-sample-code-parsing-csv-trades-record-foxbit-2020" rel="noopener ugc nofollow" target="_blank">示例代码—用于Foxbit CSV的CSV到JSON转换器。</a></li><li id="6668" class="mg mh hi iz b ja mp jd mq jg mr jk ms jo mt js ml mm mn mo bi translated"><a class="ae kq" href="https://github.com/taboca/article-sample-code-parsing-svg-trades-record-foxbit-2020/blob/main/src-tests/foxbit-v1/sample-01.csv" rel="noopener ugc nofollow" target="_blank"> CSV测试文件1——来自代码样本库。</a></li><li id="334d" class="mg mh hi iz b ja mp jd mq jg mr jk ms jo mt js ml mm mn mo bi translated"><a class="ae kq" href="https://github.com/taboca/article-sample-code-parsing-svg-trades-record-foxbit-2020/blob/main/src-tests/foxbit-v1/sample-02.csv" rel="noopener ugc nofollow" target="_blank"> CSV测试文件2——来自代码样本库。</a></li><li id="d868" class="mg mh hi iz b ja mp jd mq jg mr jk ms jo mt js ml mm mn mo bi translated"><a class="ae kq" href="https://github.com/taboca/article-sample-code-parsing-svg-trades-record-foxbit-2020/blob/main/src-tests/foxbit-v1/sample-03.csv" rel="noopener ugc nofollow" target="_blank"> CSV测试文件3——来自代码示例存储库。</a></li><li id="5488" class="mg mh hi iz b ja mp jd mq jg mr jk ms jo mt js ml mm mn mo bi translated"><a class="ae kq" href="https://github.com/taboca/article-sample-code-parsing-svg-trades-record-foxbit-2020/blob/main/src-tests/foxbit-v1/sample-04.csv" rel="noopener ugc nofollow" target="_blank"> CSV测试文件4——来自代码示例存储库。</a></li></ul><h1 id="a06c" class="jt ju hi bd jv jw jx jy jz ka kb kc kd io ke ip kf ir kg is kh iu ki iv kj kk bi translated">附录1 —主转换器样本代码</h1><p id="1180" class="pw-post-body-paragraph ix iy hi iz b ja kl ij jc jd km im jf jg kn ji jj jk ko jm jn jo kp jq jr js hb bi translated">请查看<a class="ae kq" href="https://github.com/taboca/article-sample-code-parsing-svg-trades-record-foxbit-2020" rel="noopener ugc nofollow" target="_blank">github . com/tabo ca/article-sample-code-parsing-SVG-trades-record-foxbit-2020</a>查看基于4个不同输入测试文件的完整源代码。这些输入测试文件是根据我发现的真实挑战创建的。</p><figure class="ks kt ku kv fd kw"><div class="bz dy l di"><div class="my mz l"/></div></figure><h1 id="7455" class="jt ju hi bd jv jw jx jy jz ka kb kc kd io ke ip kf ir kg is kh iu ki iv kj kk bi translated">结束语</h1><p id="698a" class="pw-post-body-paragraph ix iy hi iz b ja kl ij jc jd km im jf jg kn ji jj jk ko jm jn jo kp jq jr js hb bi translated"><em class="mf">这篇文章产生于学习和工作时间的活动，因为我正在学习如何使用他们的API访问交换。我知道这并不多，这是迈向会计工作的第一步。它应该有助于税收的计算。我的目标是捕捉挑战，并提供关于交易结构的见解。我和福克斯比特没有任何关系。私人注释:本文是根据我自己与id:c 09 cc 72e-71d 4–4e 33–8976–2d 6 EC 1825242、3799397 b-B1 B9–4a1c-9160-c0ff 8196 CB 45、BF 33 a 32 c-322 a-4000-bd4a-8 c 7 eccca 0 aa 4和</em>0 f60 D1 b-a6e 2–42e 3–9 fbb-97 b的会议编写的</p><p id="7181" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢<a class="ae kq" href="https://www.linkedin.com/in/caio-calderine-3b8956b7/" rel="noopener ugc nofollow" target="_blank">卡伊奥·卡尔德琳</a>，帮助理解CSV文件。感谢<a class="ae kq" href="https://www.linkedin.com/in/caio-calderine-3b8956b7/" rel="noopener ugc nofollow" target="_blank"> Fabricio Zuardi </a>的同行评审。</p></div></div>    
</body>
</html>