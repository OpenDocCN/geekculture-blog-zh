<html>
<head>
<title>Train a custom YOLOv4 object detector on Linux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Linux上训练一个定制的YOLOv4对象检测器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/train-a-custom-yolov4-object-detector-on-linux-49b9114b9dc8?source=collection_archive---------2-----------------------#2021-09-04">https://medium.com/geekculture/train-a-custom-yolov4-object-detector-on-linux-49b9114b9dc8?source=collection_archive---------2-----------------------#2021-09-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="2f0e" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">(初学者教程)</h2></div><h1 id="df0a" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">我在YouTube上的视频！</h1><figure class="jp jq jr js fd jt"><div class="bz dy l di"><div class="ju jv l"/></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="eaec" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">在本教程中，我们将在Linux(Ubuntu 18.04)系统上使用YOLOv4和Darknet训练一个自定义的对象检测器来进行遮罩检测</h1><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es ki"><img src="../Images/4ab269354456b023622c1379902ae8ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WP0bjpI3UoljXM_o.png"/></div></div></figure><h1 id="5165" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">按照这10个步骤使用YOLOv4训练一个物体检测器</h1><p id="3bb2" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">(但首先✅Subscribe到我的YouTube频道👉🏻<a class="ae ll" href="https://bit.ly/3Ap3sdi" rel="noopener ugc nofollow" target="_blank">https://bit.ly/3Ap3sdi</a>😁😜)</p><ol class=""><li id="02a1" class="lm ln hi kr b ks lo kv lp ky lq lc lr lg ls lk lt lu lv lw bi translated"><a class="ae ll" href="#c367" rel="noopener ugc nofollow">在桌面上创建<strong class="kr hj"> <em class="lx"> yolov4 </em> </strong>和<strong class="kr hj"> <em class="lx">训练</em> </strong>文件夹</a></li><li id="6f58" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk lt lu lv lw bi translated"><a class="ae ll" href="#be3a" rel="noopener ugc nofollow">打开命令提示符，导航到“<strong class="kr hj"> yolov4 </strong>”文件夹</a></li><li id="a370" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk lt lu lv lw bi translated"><a class="ae ll" href="#e8a4" rel="noopener ugc nofollow">创建并复制<strong class="kr hj">darknet.exe</strong>文件</a></li><li id="2cb9" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk lt lu lv lw bi translated"><a class="ae ll" href="#cc35" rel="noopener ugc nofollow">创建&amp;将我们训练需要的文件(即<strong class="kr hj"> obj </strong>数据集文件夹、<strong class="kr hj"> yolov4-custom.cfg </strong>、<strong class="kr hj"> obj.data </strong>、<strong class="kr hj"> obj.names </strong>、<strong class="kr hj"> process.py </strong>文件)复制到你的<strong class="kr hj"><em class="lx">yolov 4</em></strong>dir</a></li><li id="fbd1" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk lt lu lv lw bi translated"><a class="ae ll" href="#f775" rel="noopener ugc nofollow">将<strong class="kr hj"> <em class="lx"> yolov4 </em> </strong>目录下的“<strong class="kr hj"> yolov4-custom.cfg </strong>”、“<strong class="kr hj"> obj.data </strong>”、“<strong class="kr hj"> obj.names </strong>”、“<strong class="kr hj"> process.py </strong>”文件和“<strong class="kr hj">obj</strong>dataset”文件夹从<strong class="kr hj"><em class="lx">yolov 4</em></strong>目录下复制到<strong class="kr hj"> <em class="lx"> darknet </em> </strong>目录下</a></li><li id="9c0c" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk lt lu lv lw bi translated"><a class="ae ll" href="#5d4d" rel="noopener ugc nofollow">运行<strong class="kr hj"> process.py </strong> python脚本创建<strong class="kr hj">train . txt</strong>&amp;<strong class="kr hj">test . txt</strong>文件</a></li><li id="edbb" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk lt lu lv lw bi translated"><a class="ae ll" href="#fc1c" rel="noopener ugc nofollow">下载预先训练好的<strong class="kr hj"> YOLOv4 </strong>重量</a></li><li id="d85c" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk lt lu lv lw bi translated"><a class="ae ll" href="#ca18" rel="noopener ugc nofollow">训练探测器</a></li><li id="b91e" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk lt lu lv lw bi translated"><a class="ae ll" href="#f83b" rel="noopener ugc nofollow">检查性能</a></li><li id="977d" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk lt lu lv lw bi translated"><a class="ae ll" href="#fbe0" rel="noopener ugc nofollow">测试您的自定义对象检测器</a></li></ol><h1 id="70c8" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~开始吧！！~~~~~~~~~~~~~~</h1><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es md"><img src="../Images/01436089250122521bca4deeb428d3d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*iSztZfK0M91huCu1.gif"/></div></figure><h1 id="c367" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">1)创建“yolov4”和“training”文件夹</h1><p id="7efa" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">在桌面上创建一个名为<strong class="kr hj"> <em class="lx"> yolov4 </em> </strong>的文件夹。接下来，在 <strong class="kr hj"> <em class="lx"> yolov4 </em> </strong>文件夹内创建另一个名为<strong class="kr hj"> <em class="lx"> training </em> </strong> <em class="lx">的文件夹。这是我们将保存训练权重的地方(该路径在我们稍后将上传的<strong class="kr hj"> <em class="lx"> obj.data </em> </strong>文件中有提及)</em></p><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es me"><img src="../Images/74fe8a1f6e4601a4066fb6b0a61aad38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/0*mxAx6CoZsFqTe5eW.png"/></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="be3a" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">2)打开终端并导航到“yolov4”文件夹</h1><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="9af2" class="mk iy hi mg b fi ml mm l mn mo">#Navigate to /Desktop/yolov4 folder using the following command in terminal or just right-click and open it in terminal.</span><span id="2a1b" class="mk iy hi mg b fi mp mm l mn mo"><strong class="mg hj">cd Desktop/yolov4/</strong></span></pre><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es mq"><img src="../Images/ee54b26fee9cce961ecf643a9dde3a5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WVBr0ntoKmVh_GRD.png"/></div></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="e8a4" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">3)创建并复制暗网可执行文件</h1><p id="ccb0" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">创建包含<strong class="kr hj"> darknet </strong>可执行文件的<strong class="kr hj"> <em class="lx"> darknet </em> </strong>文件夹，并复制到<strong class="kr hj"> <em class="lx"> yolov4 </em> </strong>文件夹中。要了解如何使用make创建包含darknet可执行文件的darknet文件夹，请访问<a class="ae ll" href="https://techzizou007.medium.com/yolov4-darknet-installation-and-usage-on-your-system-windows-linux-8dec2cea6e81" rel="noopener"> <strong class="kr hj">本博客</strong> </a>。按照所有的步骤在Linux上安装YOLO-暗网。</p><p id="b9b5" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">这一步可能有点乏味，但这是整个过程中最困难的部分。下面剩下的训练过程相当简单。因此，请确保您仔细按照上面文章中的所有步骤来创建darknet，并在您的系统上安装和配置CUDA和cuDNN。你会在上面提到的博客的C部分找到所有详细解释的步骤。</p><p id="9327" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">以上过程完成后，将我们从中获取的<strong class="kr hj"> <em class="lx"> darknet </em> </strong>文件夹复制到你桌面上的<strong class="kr hj"> <em class="lx"> yolov4 </em> </strong>文件夹。</p><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es mu"><img src="../Images/51807ff0ee2c413afcd3f452474e11dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*TXHfN26_sQY0narW.png"/></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="cc35" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">4)创建并复制以下文件，我们需要这些文件来训练自定义检测器</h1><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="3901" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">a. Labeled Custom Dataset<br/>b. Custom cfg file<br/>c. obj.data and obj.names files<br/>d. process.py file (to create train.txt and test.txt files for training)</strong></span><span id="4d60" class="mk iy hi mg b fi mp mm l mn mo">I have uploaded my custom files for mask detection on my <a class="ae ll" href="https://github.com/techzizou/yolov4-custom-training_LOCAL" rel="noopener ugc nofollow" target="_blank"><strong class="mg hj">GitHub</strong></a><strong class="mg hj">. </strong>I am working with 2 classes i.e. “with_mask” and “without_mask”.</span></pre><h1 id="fa9c" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">标注数据集</h1><p id="1977" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">输入图像示例(<strong class="kr hj">Image1.jpg</strong>)</p><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es mv"><img src="../Images/d8f17d1e34d026f413833ceae2eab77b.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/0*pE1Js-whu6e-Rtih.jpeg"/></div></figure><p id="3d16" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">你可以使用任何软件来贴标签，比如<a class="ae ll" href="https://github.com/tzutalin/labelImg#labelimg" rel="noopener ugc nofollow" target="_blank"> <strong class="kr hj">标签</strong> </a>工具。</p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es ki"><img src="../Images/0fce106ff83424fa932ddec6172dc354.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BLztN1t4KNOgll5B.png"/></div></div></figure><p id="4576" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">我使用一个名为<strong class="kr hj"> OpenLabeling </strong>的开源标签工具，它有一个非常简单的UI。</p><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es md"><img src="../Images/14f8828b32ae6f1468484fd91a209f50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*JSVjrdKf7r2aCqL_.gif"/></div></figure><p id="005d" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">点击下面的链接，了解更多关于贴标过程和其他软件的信息:</p><p id="4c10" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated"><a class="ae ll" rel="noopener" href="/analytics-vidhya/image-dataset-labeling-annotation-bec3390eda2d"> <strong class="kr hj">影像数据集标注条</strong> </a></p><p id="bc77" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated"><strong class="kr hj">注:</strong>垃圾入=垃圾出。选择和标记图像是最重要的部分。尽量找质量好的图片。数据的质量在很大程度上决定了结果的质量。</p><p id="d16a" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">标有file的输出YOLO格式如下所示。</p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es mw"><img src="../Images/66ea54d32578eabda1c96be416c2d310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ox25jWndLvb97y0g.png"/></div></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="133b" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">4(a)创建带标签的自定义数据集“obj”文件夹，并将其复制到“yolov4”文件夹</h1><p id="50cf" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">把所有输入的图像”。jpg "文件及其对应的YOLO格式标注"。txt "文件夹中的文件名为<strong class="kr hj"> <em class="lx"> obj </em> </strong>。将其复制到<strong class="kr hj">T5】yolov 4T7】文件夹中。</strong></p><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es mx"><img src="../Images/aabf621c3bc027369c1605aaf78f119f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/0*HOIbEoWpTFjERp6x.png"/></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="ffa9" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">4(b)创建您的自定义配置文件，并将其复制到“yolov4”文件夹中</h1><p id="6ec9" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">从<strong class="kr hj"> <em class="lx"> darknet/cfg </em> </strong>目录<em class="lx">，</em>下载<strong class="kr hj"><em class="lx">yolov 4-custom . CFG</em></strong>文件，对其进行修改，并复制到<strong class="kr hj"> <em class="lx"> yolov4 </em> </strong>目录。</p><p id="eebd" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">你也可以从官方<a class="ae ll" href="https://www.github.com/AlexeyAB/darknet" rel="noopener ugc nofollow" target="_blank"> AlexeyAB Github </a>下载定制配置文件。</p><p id="b440" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated"><strong class="kr hj">您需要在您的自定义配置文件中进行以下更改:</strong></p><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es my"><img src="../Images/ce6effcf52a44f2d545ba41efbb9d15e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/0*A1zwsWdRqIetXDL5.png"/></div></figure><ul class=""><li id="c535" class="lm ln hi kr b ks lo kv lp ky lq lc lr lg ls lk mz lu lv lw bi translated">将行批更改为批=64</li><li id="612b" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">将线细分改为细分=16 <strong class="kr hj">或</strong>细分=32 <strong class="kr hj">或</strong>细分=64(阅读本节后的注释以了解关于这些值的更多信息)</li><li id="2fee" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">设置网络大小宽度=416高度=416或32的任意倍数</li><li id="13ad" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">将行max_batches更改为(类*2000，但不小于训练图像数，且不小于6000)，例如，如果训练3个类，max_batches=6000</li><li id="c8f8" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">将生产线步骤更改为max_batches的80%和90%，即步骤=4800，5400</li></ul></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es na"><img src="../Images/fc408c5dc98ed62f6fff1efbd90c5269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CAWMKodtS_p7noUr.png"/></div></div></figure><ul class=""><li id="17d9" class="lm ln hi kr b ks lo kv lp ky lq lc lr lg ls lk mz lu lv lw bi translated">在每个[yolo]层之前的<strong class="kr hj"> 3 </strong> <strong class="kr hj">【卷积】</strong>中，将[filters=255]更改为filters=(classes + 5)x3，请记住，它必须是每个[yolo]层之前的最后一个[卷积]。</li><li id="5c62" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">在每个<strong class="kr hj">3【yolo】</strong>层中，将线条类别=80改为你的对象数量。</li></ul><p id="cc3b" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">因此，如果classes=1，那么它应该是filters=18。如果classes=2，则编写filters=21。</p><p id="2a39" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">一旦你理解了训练过程的基本原理，你也可以调整其他参数值，如学习率、角度、饱和度、曝光和色调。对于新手来说，以上改动应该足够了。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h2 id="5622" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">注意:什么是细分？</h2><ul class=""><li id="cfed" class="lm ln hi kr b ks kt kv kw ky no lc np lg nq lk mz lu lv lw bi translated">这是我们分成的许多小批量的数量。</li><li id="99dc" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">Batch=64 -&gt;一次迭代加载64幅图像。</li><li id="5fc8" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">细分=8 -&gt;将批次分为8个小批次，因此每个小批次有64/8 = 8个图像，这8个图像被发送进行处理。该过程将被执行8次，直到该批完成，并且新的迭代将从64个新图像开始。</li><li id="95b8" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">如果您使用的是低内存的GPU，请为细分设置一个较高的值(32或64)。这显然需要更长的时间来训练，因为我们正在减少加载的图像数量以及小批量的数量。</li><li id="4ea3" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">如果您有一个高内存的GPU，设置一个较低的细分值(16或8)。这将加速训练过程，因为每次迭代加载更多的图像。</li></ul></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="4531" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">4(c)创建你的“obj.data”和“obj.names”文件，并将它们复制到yolov4文件夹中</h1><h2 id="286d" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">对象数据</h2><p id="01ee" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated"><strong class="kr hj"> <em class="lx"> obj.data </em> </strong>文件有:</p><ul class=""><li id="08c3" class="lm ln hi kr b ks lo kv lp ky lq lc lr lg ls lk mz lu lv lw bi translated">班级的数量。</li><li id="fc20" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">我们后面要创建的<strong class="kr hj"> <em class="lx"> train.txt </em> </strong>和<strong class="kr hj"> <em class="lx"> test.txt </em> </strong>文件的路径。</li><li id="72e1" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">包含类名的<strong class="kr hj"> <em class="lx"> obj.names </em> </strong>文件的路径。</li><li id="72da" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">保存训练权重的<strong class="kr hj"> <em class="lx">训练</em> </strong>文件夹的路径。</li></ul><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="c906" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">classes = 2<br/>train = data/train.txt<br/>valid = data/test.txt<br/>names = data/obj.names<br/>backup = ../training</strong></span></pre><h2 id="1b56" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">对象名称</h2><p id="d9c6" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">包含对象的名称，每个名称占一行。确保分类的顺序与标记图像时使用的class_list.txt文件中的顺序相同，以便每个分类的索引id与标记的YOLO文本文件中提到的相同。</p><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es nr"><img src="../Images/f8194ddac5065a63efedf2ca03fe71aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/0*1KA5kqaWaonHzUH_.png"/></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="5dad" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">4(d)将<process.py>脚本文件复制到你的yolov4文件夹中</process.py></h1><p id="d56e" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">(将所有图像文件分成2部分。90%用于训练，10%用于测试)</p><p id="5a09" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">这个<strong class="kr hj"> <em class="lx"> process.py </em> </strong>脚本创建了文件<strong class="kr hj"><em class="lx">train . txt</em>&amp;<strong class="kr hj"><em class="lx">test . txt</em></strong>，其中<strong class="kr hj"> <em class="lx"> train.txt </em> </strong>文件具有指向90%图像的路径，而<strong class="kr hj"> <em class="lx"> test.txt </em> </strong>具有指向10%图像的路径。</strong></p><p id="91ce" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">可以从我的<a class="ae ll" href="https://github.com/techzizou/yolov4-custom-training_LOCAL" rel="noopener ugc nofollow" target="_blank"> <strong class="kr hj"> GitHub </strong> </a> <strong class="kr hj">下载<strong class="kr hj"> <em class="lx"> process.py </em> </strong>脚本。</strong></p><p id="2288" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated"><strong class="kr hj">* *重要提示:“<em class="lx">process . py”</em>脚本只有。jpg "格式写在里面，所以其他格式如"。png“，”。jpeg”，甚至是”。JPG”(大写)不会被承认。如果您使用任何其他格式，请相应地在<em class="lx"> process.py </em>脚本中进行更改。</strong></p><figure class="jp jq jr js fd jt"><div class="bz dy l di"><div class="ns jv l"/></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="ed34" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">现在我们已经上传了所有的文件，我们桌面上的<strong class="kr hj"> <em class="lx"> yolov4 </em> </strong>文件夹应该是这样的:</p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es mu"><img src="../Images/820ff543f6b295db7bc93ec7667fde34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*RiKV9r-Zyd4bEnHW.png"/></div></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="f775" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">5)将所有文件从'<code class="du nt nu nv mg b">yolov4'</code>目录复制到' yolov4/darknet '目录</h1><p id="9039" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">你可以通过文件管理器手动完成所有这些步骤。</p><p id="91d1" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">首先，清理<strong class="kr hj"><em class="lx">CFG</em></strong>&amp;<strong class="kr hj"><em class="lx">data</em></strong>文件夹。删除<strong class="kr hj"> <em class="lx"> data </em> </strong>文件夹中的所有文件，除了<strong class="kr hj"> <em class="lx"> labels </em> </strong>文件夹，该文件夹是在检测框上写入标签名称所必需的，同时删除<strong class="kr hj"> <em class="lx"> cfg </em> </strong>文件夹中的所有文件，因为在<strong class="kr hj"> <em class="lx"> yolov4 </em> </strong>主文件夹中已经有了我们的自定义配置文件。</p><p id="bcf7" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">接下来，复制所有文件:</p><ul class=""><li id="283d" class="lm ln hi kr b ks lo kv lp ky lq lc lr lg ls lk mz lu lv lw bi translated">将<strong class="kr hj"> yolov4-custom.cfg </strong>复制到<strong class="kr hj"> <em class="lx"> darknet/cfg </em> </strong>目录下。</li><li id="d50a" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">将<strong class="kr hj"> obj.names </strong>、<strong class="kr hj"> obj.data </strong>和<strong class="kr hj"> obj </strong>文件夹复制到<strong class="kr hj"> <em class="lx"> darknet/data </em> </strong>目录下。</li><li id="c557" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">将<strong class="kr hj"> process.py </strong>复制到<strong class="kr hj"> <em class="lx"> darknet </em> </strong>目录下。</li></ul><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es ki"><img src="../Images/5a295c98943ae4ad1455cd60654a7b73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*55bU9YYZbi8shzEI.png"/></div></div></figure><p id="2880" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated"><strong class="kr hj">或</strong></p><p id="71ae" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">如果你是一个终端极客，使用终端完成上述步骤🤓。将当前工作目录更改为<strong class="kr hj">/Desktop/yolov 4</strong>/<strong class="kr hj">darknet</strong></p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="253a" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">cd darknet/</strong></span></pre><p id="c01d" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated"><strong class="kr hj">清理<em class="lx">数据</em>和<em class="lx"> cfg </em>文件夹。</strong></p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="a3e5" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">find ./data -mindepth 1 ! -regex '^./data/labels(/.*)?' -delete</strong></span><span id="acfa" class="mk iy hi mg b fi mp mm l mn mo"><strong class="mg hj">rm -rf cfg/<br/>mkdir cfg</strong></span></pre><p id="4cda" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">5(a)复制<strong class="kr hj"> <em class="lx"> obj </em> </strong>数据集文件夹，使其现在位于<strong class="kr hj"> /darknet/data/ </strong>文件夹中</p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="2657" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">cp -R ../obj data/</strong></span></pre><p id="b9a3" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">5(b)复制您的<strong class="kr hj"><em class="lx">yolov 4-custom . CFG</em></strong>文件，使其现在位于<strong class="kr hj"> /darknet/cfg/ </strong>文件夹中</p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="b3a8" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">cp ../yolov4-custom.cfg cfg</strong></span></pre><p id="52d5" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">5(c)复制<strong class="kr hj"> <em class="lx"> obj.names </em> </strong>和<em class="lx"> obj.data </em> 文件，使它们现在位于<strong class="kr hj"> /darknet/data/ </strong>文件夹中</p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="0164" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">cp ../obj.names data<br/>cp ../obj.data  data</strong></span></pre><p id="33ef" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">5(d)将<strong class="kr hj"> <em class="lx"> process.py </em> </strong>文件复制到当前<strong class="kr hj"> <em class="lx"> darknet </em> </strong>目录下</p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="0760" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">cp ../process.py .</strong></span></pre></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="5d4d" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">6)运行process.py python脚本，在数据文件夹中创建train.txt &amp; test.txt文件</h1><p id="c14a" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">当前工作目录为<strong class="kr hj">/Desktop/yolov 4/darknet</strong>。</p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="8a2d" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">python process.py</strong></span></pre><p id="b0ec" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">列出数据文件夹的内容，检查train.txt &amp; test.txt文件是否已创建。</p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="eb40" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">ls data/</strong></span></pre><p id="e869" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">上面的<strong class="kr hj"> process.py </strong>脚本创建了两个文件<strong class="kr hj"> train.txt </strong>和<strong class="kr hj"> test.txt </strong>，其中<strong class="kr hj"> train.txt </strong>的路径指向90%的图像，而<strong class="kr hj"> test.txt </strong>的路径指向10%的图像。这些文件如下所示。</p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es nw"><img src="../Images/18e9a6aa2d9a68131e6fc03e605ed723.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*daL4xwAFeeqqkoZe.png"/></div></div></figure><h1 id="fc1c" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">7)下载并复制预训练的YOLOv4重量到“yolov4/darknet”目录。</h1><p id="25b5" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">当前工作目录是<strong class="kr hj">/Desktop/yolov 4/darknet</strong></p><p id="ea7f" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">这里我们用迁移学习。我们没有从头开始训练模型，而是使用预先训练的YOLOv4权重，这些权重已经被训练到137个卷积层。从这里下载YOLOv4预训练重量文件<a class="ae ll" href="https://github.com/AlexeyAB/darknet/releases/download/darknet_yolo_v3_optimal/yolov4.conv.137" rel="noopener ugc nofollow" target="_blank">，并将其复制到您的<strong class="kr hj"> <em class="lx"> darknet </em> </strong>文件夹中。</a></p><p id="52ba" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated"><strong class="kr hj">或</strong></p><p id="dc3c" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">只需运行下面的命令。</p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="ec48" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">wget </strong><a class="ae ll" href="https://github.com/AlexeyAB/darknet/releases/download/darknet_yolo_v3_optimal/yolov4.conv.137" rel="noopener ugc nofollow" target="_blank"><strong class="mg hj">https://github.com/AlexeyAB/darknet/releases/download/darknet_yolo_v3_optimal/yolov4.conv.137</strong></a></span></pre></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="ca18" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">8)培训</h1><h2 id="4381" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">训练您的定制检测器</h2><p id="6894" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">当前工作目录是<strong class="kr hj">/Desktop/yolov 4/darknet</strong></p><p id="800b" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">为了获得最佳结果，如果可能的话，当平均损失小于0.05或者至少持续低于0.3时，应该停止训练，否则训练模型，直到平均损失暂时没有任何显著变化。</p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="38b9" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">./darknet detector train data/obj.data cfg/yolov4-custom.cfg yolov4.conv.137 -dont_show -map</strong></span><span id="1214" class="mk iy hi mg b fi mp mm l mn mo">#The <strong class="mg hj">map</strong> parameter here gives us the <strong class="mg hj">M</strong>ean <strong class="mg hj">A</strong>verage <strong class="mg hj">P</strong>recision. The higher the <strong class="mg hj">mAP</strong> the better it is for object detection. You can remove the <strong class="mg hj">-dont_show</strong> parameter to see the progress chart of mAP-loss against iterations.</span></pre><p id="5e39" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">你可以访问官方的AlexeyAB Github页面，它给出了关于何时停止训练的详细解释。点击下面的链接跳转到该部分。</p><p id="7540" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated"><a class="ae ll" href="https://github.com/AlexeyAB/darknet/#user-content-when-should-i-stop-training" rel="noopener ugc nofollow" target="_blank"> AlexeyAB GitHub什么时候停止训练？</a></p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h2 id="66bc" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">重新开始训练(以防训练没有结束，训练过程中断)</h2><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es nx"><img src="../Images/cecbe06752eebfdc202e5b63abcc531f.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/0*JIK0VTJAWYDLUcbS.jpeg"/></div></figure><p id="4705" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">如果训练过程因某种原因中断或停止，您不必再次从头开始训练您的模型。你可以从你停止的地方重新开始训练。使用上次保存的重量。在<strong class="kr hj"> <em class="lx"> yolov4 </em> </strong> dir内的 <strong class="kr hj"> training </strong>文件夹中，每100次迭代将权重保存为<strong class="kr hj">yolov 4-custom _ last . weights</strong><em class="lx">。(我们在“obj.data”文件中作为备份给出的路径)。</em></p><p id="d449" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated"><strong class="kr hj">因此，要重新开始训练，请运行以下命令:</strong></p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="1d66" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">./darknet detector train data/obj.data cfg/yolov4-custom.cfg ../training/yolov4-custom_last.weights -dont_show -map</strong></span></pre></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="f83b" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">9)检查性能</h1><h2 id="265e" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">查看培训图表</h2><p id="fa1b" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">您可以通过查看<strong class="kr hj"><em class="lx">chart.png</em></strong>文件来检查所有训练过的重量的性能。然而，<strong class="kr hj"><em class="lx">chart.png</em></strong>文件仅在训练没有中断的情况下显示结果，即，如果您没有断开连接或丢失会话。如果从保存的点重新开始训练，这将不起作用。</p><p id="da68" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">打开<strong class="kr hj"><em class="lx"/></strong>目录下的<strong class="kr hj">chart.png</strong>文件。</p><p id="94bb" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">如果这不起作用，还有其他方法来检查你的表现。其中之一是通过检查训练权重的地图。</p><h2 id="16c5" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">检查地图(平均精度)</h2><p id="4e1d" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">您可以检查每1000次迭代保存的所有权重的贴图，例如:- yolov4-custom_4000.weights、yolov4-custom_5000.weights、yolov4-custom_6000.weights等等。这样，您可以找出哪个权重文件给你最好的结果。地图越高越好。</p><p id="2918" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">运行以下命令来检查特定已保存权重文件的映射，其中<strong class="kr hj"> xxxx </strong>是其迭代编号。(例如:- 4000，5000，6000，…)</p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="5acd" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">./darknet detector map data/obj.data cfg/yolov4-custom.cfg ../training/yolov4-custom_xxxx.weights -points 0</strong></span></pre></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="fbe0" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">10)测试您的自定义对象检测器</h1><h2 id="3f69" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">对自定义配置文件进行更改，将其设置为测试模式</h2><ul class=""><li id="bfc6" class="lm ln hi kr b ks kt kv kw ky no lc np lg nq lk mz lu lv lw bi translated">将行批更改为批=1</li><li id="77dd" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">将线细分改为细分=1</li></ul><p id="ec09" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">您可以手动完成，也可以简单地运行下面的代码</p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="421b" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">cd cfg<br/>sed -i 's/batch=64/batch=1/' yolov4-custom.cfg<br/>sed -i 's/subdivisions=32/subdivisions=1/' yolov4-custom.cfg<br/>cd ..</strong></span></pre><p id="d5ed" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated"><strong class="kr hj">注意:</strong>根据您在cfg文件中的设置，在上面的命令中将细分的第一个值设置为16 / 32 / 64。</p><h2 id="5599" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">对图像运行检测器</h2><p id="dd92" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">将图像上传到桌面上名为<strong class="kr hj"> <em class="lx"> mask_test_images </em> </strong>的文件夹。</p><p id="5979" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">使用此命令对图像运行您的自定义检测器。(阈值标志设置对象检测所需的最低精度)</p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="8ba6" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">./darknet detector test data/obj.data cfg/yolov4-custom.cfg ../training/yolov4-custom_best.weights ../../mask_test_images/image1.jpg -thresh 0.3</strong></span></pre><p id="5325" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">这样的输出被保存为<strong class="kr hj"> <em class="lx"> darknet </em> </strong>文件夹中的【predictions.jpg】。您可以将其复制到任何输出文件夹，并用不同的名称保存。我将它作为<strong class="kr hj"> output_image.jpg </strong>保存在<strong class="kr hj"><em class="lx">mask _ test _ images</em></strong>文件夹本身中。</p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="5791" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">cp predictions.jpg ../../mask_test_images/output_image1.jpg</strong></span></pre><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es ny"><img src="../Images/cd759e018a4696cd24989dbae9cf63e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jkn1nMWbHIHb78y7.jpg"/></div></div></figure><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es nz"><img src="../Images/94e3e262c985843263a0194a93240ca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*4mYEcVTLi4vrtuW1EMkIKg.jpeg"/></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h2 id="ae5d" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">对视频运行检测器</h2><p id="bf4f" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">将视频上传到桌面上名为<strong class="kr hj"><em class="lx">mask _ test _ videos</em></strong>的文件夹中。</p><p id="197e" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">用这个命令在一个视频上运行你的自定义探测器(<strong class="kr hj">test.mp4</strong>)。(thresh标志设置对象检测所需的最低精度)。这会将输出视频保存在与“<strong class="kr hj"> output.avi </strong>”相同的文件夹中。</p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="d179" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">./darknet detector demo data/obj.data cfg/yolov4-custom.cfg ../training/yolov4-custom_best.weights ../../mask_test_videos/test.mp4 -thresh 0.5 -i 0 -out_filename ../../mask_test_videos/output.avi</strong></span></pre><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es md"><img src="../Images/9905263a55a6d5a7477272ef2e51b4b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*ipQObSNOQQ8vwbAn.gif"/></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h2 id="3f76" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">在实时网络摄像头上运行检测器</h2><p id="4cc6" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">运行下面的代码。</p><pre class="jp jq jr js fd mf mg mh mi aw mj bi"><span id="47da" class="mk iy hi mg b fi ml mm l mn mo"><strong class="mg hj">./darknet detector demo data/obj.data cfg/yolov4-custom.cfg ../training/yolov4-custom_best.weights -thresh 0.5</strong></span></pre><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es md"><img src="../Images/41fb7b45e42ef279ea8d1d97ebd5645f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*Q2n1woJZkbEJzFZq.gif"/></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="11f4" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">注意:</h1><p id="4242" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">我收集的用于遮罩检测的数据集主要包含特写图像。你可以在网上搜索更多的长镜头图片。有很多网站可以下载有标签和无标签的数据集。我在数据集来源下面给出了一些链接。我也给出了一些掩膜数据集的链接。其中一些有超过10，000张图片。</p><p id="399d" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">虽然我们可以对我们的训练配置文件进行某些调整和更改，或者通过增强为每种类型的对象类向数据集添加更多图像，但我们必须小心，以免导致影响模型准确性的过度拟合。</p><p id="3584" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated">对于初学者，你可以简单地使用我上传到GitHub上的配置文件。我还上传了我的掩模图像数据集以及YOLO格式的文本文件，虽然这可能不是最好的，但将为您提供一个良好的开端，让您了解如何使用YOLO训练您自己的定制检测机模型。你可以找到一个质量更好的带标签的数据集或者一个不带标签的数据集，以后自己标注。</p><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es md"><img src="../Images/b9cd6bb7d4730bf6df4da3e81386da65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*LwZjlYX6uyGvFBb_.gif"/></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="cc7b" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">GitHub链接</h1><p id="3411" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">我已经在下面的GitHub链接上上传了我的自定义掩膜数据集和在Windows中训练自定义YOLOv4检测器所需的所有其他文件。</p><p id="a86a" class="pw-post-body-paragraph kp kq hi kr b ks lo ij ku kv lp im kx ky mr la lb lc ms le lf lg mt li lj lk hb bi translated"><a class="ae ll" href="https://github.com/techzizou/yolov4-custom-training_LOCAL" rel="noopener ugc nofollow" target="_blank">yolov 4-custom-training _ LOCAL _ MACHINE</a></p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="edd7" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">带标签的数据集(obj.zip)</h1><p id="b841" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated"><a class="ae ll" href="https://www.kaggle.com/techzizou/labeled-mask-dataset-yolo-darknet" rel="noopener ugc nofollow" target="_blank">标记的屏蔽数据集</a></p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="0444" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">关于这个的YouTube视频！</h1><figure class="jp jq jr js fd jt"><div class="bz dy l di"><div class="ju jv l"/></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h1 id="09ca" class="ix iy hi bd iz ja kd jc jd je ke jg jh io kf ip jj ir kg is jl iu kh iv jn jo bi translated">信用</h1><h2 id="e919" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">参考</h2><ul class=""><li id="ca95" class="lm ln hi kr b ks kt kv kw ky no lc np lg nq lk mz lu lv lw bi translated"><a class="ae ll" href="https://github.com/AlexeyAB/darknet" rel="noopener ugc nofollow" target="_blank">阿列克谢AB GitHub </a></li><li id="0817" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated"><a class="ae ll" href="https://github.com/pjreddie/darknet" rel="noopener ugc nofollow" target="_blank"> pjreddie Github </a></li><li id="2372" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated"><a class="ae ll" href="https://github.com/theAIGuysCode/YOLOv4-Cloud-Tutorial" rel="noopener ugc nofollow" target="_blank">代码Github </a></li><li id="3a79" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated"><a class="ae ll" href="https://arxiv.org/abs/2004.10934" rel="noopener ugc nofollow" target="_blank">纸约洛夫4 </a></li><li id="39e7" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated"><a class="ae ll" href="https://pjreddie.com/darknet/yolo/" rel="noopener ugc nofollow" target="_blank"> pjreddie网站</a></li></ul><h2 id="16bf" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">数据集源</h2><p id="1608" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">您可以从下面提到的网站下载许多对象的数据集。这些网站还包含许多种类的对象的图像以及它们的多种格式的注释/标签，例如YOLO _黑暗网文本文件和帕斯卡_VOC XML文件。</p><ul class=""><li id="dc9b" class="lm ln hi kr b ks lo kv lp ky lq lc lr lg ls lk mz lu lv lw bi translated"><a class="ae ll" href="https://storage.googleapis.com/openimages/web/index.html" rel="noopener ugc nofollow" target="_blank">通过谷歌打开图像数据集</a></li><li id="57e0" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated"><a class="ae ll" href="https://www.kaggle.com/datasets" rel="noopener ugc nofollow" target="_blank"> Kaggle数据集</a></li><li id="01db" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated"><a class="ae ll" href="https://public.roboflow.com/" rel="noopener ugc nofollow" target="_blank"> Roboflow公共数据集</a></li><li id="c8bb" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated"><a class="ae ll" href="https://www.visualdata.io/discovery" rel="noopener ugc nofollow" target="_blank">可视化数据数据集</a></li></ul><h2 id="94ae" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">屏蔽数据集源</h2><p id="0b8f" class="pw-post-body-paragraph kp kq hi kr b ks kt ij ku kv kw im kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">我将这3个数据集用于我的标记数据集:</p><ul class=""><li id="483f" class="lm ln hi kr b ks lo kv lp ky lq lc lr lg ls lk mz lu lv lw bi translated"><a class="ae ll" href="https://github.com/prajnasb/observations" rel="noopener ugc nofollow" target="_blank">般若Github </a></li><li id="4996" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated">约瑟夫·纳尔逊·罗博弗洛</li><li id="ae82" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated"><a class="ae ll" href="https://github.com/X-zhangyang/Real-World-Masked-Face-Dataset" rel="noopener ugc nofollow" target="_blank">X-张洋Github </a></li></ul><h2 id="5fae" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">更多掩膜数据集</h2><ul class=""><li id="b11a" class="lm ln hi kr b ks kt kv kw ky no lc np lg nq lk mz lu lv lw bi translated">Prasoonkottarathil ka ggle(20000张图片)</li><li id="a9a4" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated"><a class="ae ll" href="https://www.kaggle.com/ashishjangra27/face-mask-12k-images-dataset?select=Face+Mask+Dataset" rel="noopener ugc nofollow" target="_blank">ashishjangra 27 ka ggle</a>(12000张图片)</li><li id="4965" class="lm ln hi kr b ks ly kv lz ky ma lc mb lg mc lk mz lu lv lw bi translated"><a class="ae ll" href="https://www.kaggle.com/andrewmvd/face-mask-detection" rel="noopener ugc nofollow" target="_blank">安德鲁·默德·卡格尔</a></li></ul><h2 id="3619" class="mk iy hi bd iz nb nc nd jd ne nf ng jh ky nh ni jj lc nj nk jl lg nl nm jn nn bi translated">视频源</h2><ul class=""><li id="dc35" class="lm ln hi kr b ks kt kv kw ky no lc np lg nq lk mz lu lv lw bi translated"><a class="ae ll" href="https://www.pexels.com/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/</a></li></ul><figure class="jp jq jr js fd jt er es paragraph-image"><div class="er es md"><img src="../Images/1fda33599be85032b98e68dbc7645718.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*v1eZ77k-Ny_viljm.gif"/></div></figure></div></div>    
</body>
</html>