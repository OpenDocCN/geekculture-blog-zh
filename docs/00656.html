<html>
<head>
<title>Building a Simple Football Prediction Model Using Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用机器学习构建简单的足球预测模型</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/building-a-simple-football-prediction-model-using-machine-learning-f061e607bec5?source=collection_archive---------3-----------------------#2021-03-09">https://medium.com/geekculture/building-a-simple-football-prediction-model-using-machine-learning-f061e607bec5?source=collection_archive---------3-----------------------#2021-03-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="e6fd" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">机器学习变得简单</h2><div class=""/><div class=""><h2 id="b3fe" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">在没有先验知识的情况下</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/0088cf3e0725acaf1186e8e2cb1714ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GIie0xSM2SK9HasE-PUuCQ.jpeg"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Image by <a class="ae jw" href="https://depositphotos.com/portfolio-1003153.html" rel="noopener ugc nofollow" target="_blank">burakowski</a> from depositphotos</figcaption></figure><h1 id="7e1a" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ix ki iy kj ja kk jb kl jd km je kn ko bi translated">介绍</h1><p id="b726" class="pw-post-body-paragraph kp kq hi kr b ks kt is ku kv kw iv kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">足球一直是一项具有挑战性的运动。最著名的模型是Dixon-Coles，它利用泊松分布作为模型目标得分的先验。基于成对比较和排名的评级模型已经成为进行预测的替代方法。例如，国际足联使用Elo rating⁴对国家队进行排名。在这篇文章中，我们提出了一个不同的方法，不需要足球知识或作出任何假设，因此可以推广到其他运动。我们将展示如何训练模型，并使用<strong class="kr hs">正则化逻辑回归</strong>和scikit-learn对相关概率进行预测。</p><p id="16cb" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">我们不会深入这个模型的细节，因为网上有很多<a class="ae jw" href="https://www.coursera.org/lecture/machine-learning/regularized-logistic-regression-4BHEy" rel="noopener ugc nofollow" target="_blank">非常好的资源</a>比我们做得更好。但是我们将介绍一些python代码的基础知识，这些代码可以在GitHub 上找到<a class="ae jw" href="https://github.com/octosport" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><h1 id="3a76" class="jx jy hi bd jz ka lx kc kd ke ly kg kh ix lz iy kj ja ma jb kl jd mb je kn ko bi translated">正则化逻辑回归</h1><p id="926a" class="pw-post-body-paragraph kp kq hi kr b ks kt is ku kv kw iv kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">逻辑回归是用于<strong class="kr hs">分类</strong>的统计模型。分类意味着你处理分类变量来预测。例如，您想预测谁将赢得一场比赛。以足球为例，你会有三个等级:主队赢，客队赢或者是平局。</p><blockquote class="mc md me"><p id="45a0" class="kp kq mf kr b ks ll is ku kv lm iv kx mg ln la lb mh lo le lf mi lp li lj lk hb bi translated">如果你曾经使用过逻辑回归，你就会知道它是两类的模型:0表示事件没有发生，1表示事件发生了。为了预测足球比赛的获胜者，我们将需要三个模型，除非你使用多项损失，否则每个模型都将预测不同的事件。一个是主队赢，一个是客场队赢，一个是平局。</p></blockquote><p id="f967" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">逻辑回归模型可以用概率来解释，但你也可以把它看作一个预测0和1的模型。事实上，预测并不完美，并且以这样的方式落入范围{0，1}，即它们可以被解释为事件实现(预测接近1)或事件不实现(预测接近0)的概率。如果你想知道这个想法<a class="ae jw" href="https://www.octosport.io/post/logistic-regression-revisited" rel="noopener ugc nofollow" target="_blank">背后的数学原理，看看这篇文章</a>，但是你也可以对最初的<a class="ae jw" href="https://en.wikipedia.org/wiki/Logistic_regression" rel="noopener ugc nofollow" target="_blank">概率模型</a>感兴趣。</p><h2 id="4f35" class="mj jy hi bd jz mk ml mm kd mn mo mp kh ky mq mr kj lc ms mt kl lg mu mv kn ho bi translated">处理数据</h2><p id="f440" class="pw-post-body-paragraph kp kq hi kr b ks kt is ku kv kw iv kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">我们已经知道<strong class="kr hs">我们需要用代表比赛结果的二进制目标<code class="du mw mx my mz b">y</code>来训练三个逻辑</strong>模型。例如，对于“平局模型”，如果比赛结果是平局，则目标为1，否则为0。幸运的是，我们不需要显式地将三个模型设置为<a class="ae jw" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html" rel="noopener ugc nofollow" target="_blank">scikit-learn</a><code class="du mw mx my mz b">LogisticRegression</code><strong class="kr hs"/>将通过指定<strong class="kr hs"> </strong>正确的选项来为我们完成这项工作。因此<code class="du mw mx my mz b">y</code>将根据结果分成三个等级。<strong class="kr hs"> </strong>为了表示团队，我们将使用<strong class="kr hs">一键编码器</strong>。</p><p id="0d78" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">假设我们有一个联赛，有20支球队主客场比赛。每个队被编码在长度为40的向量中，其中每个条目可以取值1或0。前20名代表主队，后20名代表客队。然后，要对两个队之间的比赛进行编码，我们只需将1放在正确的位置。使用sci kit-了解该步骤可以轻松完成:</p><pre class="jh ji jj jk fd na mz nb nc aw nd bi"><span id="9eb0" class="mj jy hi mz b fi ne nf l ng nh">from sklearn.preprocessing import OneHotEncoder<br/>team_encoding = OneHotEncoder(sparse=False).fit(team_names)</span></pre><p id="afe8" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">现在我们可以对过去的匹配列表进行编码来训练模型。例如，我们可以使用过去的三个赛季。有了主队和客场队的名字，我们就可以对它们进行编码，得到我们的虚拟特征。</p><pre class="jh ji jj jk fd na mz nb nc aw nd bi"><span id="73fc" class="mj jy hi mz b fi ne nf l ng nh">home_dummies = team_encoding.transform(home_team_names)<br/>away_dummies = team_encoding.transform(away_team_names)</span></pre><p id="8698" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">假设我们有100个过去的匹配，那么<code class="du mw mx my mz b">home_dummies</code> <strong class="kr hs"> </strong>和<strong class="kr hs"> </strong> <code class="du mw mx my mz b">away_dummies</code> <strong class="kr hs"> </strong>是100行20列的数组，分别为0和1。现在我们可以连接这两个数组来构建每个逻辑模型都将使用的特性<code class="du mw mx my mz b">X</code></p><pre class="jh ji jj jk fd na mz nb nc aw nd bi"><span id="6a86" class="mj jy hi mz b fi ne nf l ng nh">import numpy as np<br/>X = np.concatenate([home_dummies, away_dummies], 1)</span></pre><p id="3c40" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">目标可以直接设置在三个类中。有了主队和客场队的历史得分，我们将<code class="du mw mx my mz b">y</code>编码为三类:1代表主队获胜，0代表平局，1代表客场获胜</p><pre class="jh ji jj jk fd na mz nb nc aw nd bi"><span id="0334" class="mj jy hi mz b fi ne nf l ng nh">y = np.sign(home_score - away_score)</span></pre><p id="2e29" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated"><strong class="kr hs">模型的参数数量等于团队数量的两倍</strong>。每个团队都有一个参数来表示其主客场实力。我们所需要的就是训练模型的时间。</p></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><h2 id="6ef7" class="mj jy hi bd jz mk ml mm kd mn mo mp kh ky mq mr kj lc ms mt kl lg mu mv kn ho bi translated">训练模型</h2><p id="a035" class="pw-post-body-paragraph kp kq hi kr b ks kt is ku kv kw iv kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">我们已经提到我们正在使用scikit-learn <code class="du mw mx my mz b">LogisticRegression</code> <strong class="kr hs"> </strong>回归模型。与库中的许多其他模型一样，<strong class="kr hs">带有默认选项，我们可能不想使用</strong>。我们希望独立训练三个逻辑回归模型。我们没有一个常数项已经把主场优势编码在特征里了。我们想用岭(l2)惩罚来正则化模型。</p><blockquote class="mc md me"><p id="8d99" class="kp kq mf kr b ks ll is ku kv lm iv kx mg ln la lb mh lo le lf mi lp li lj lk hb bi translated">正规化将有助于减少强弱球队的强弱。例如，如果一个团队总是获胜，模型将倾向于将一个非常大的系数与该团队相关联，并导致过于乐观的预测。</p></blockquote><p id="cead" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">正则化参数<code class="du mw mx my mz b">C</code>可以使用交叉验证找到，但是默认值给出了不错的结果。我们想要的模型是</p><pre class="jh ji jj jk fd na mz nb nc aw nd bi"><span id="6cf8" class="mj jy hi mz b fi ne nf l ng nh">from sklearn.linear_model import LogisticRegression<br/>model = LogisticRegression(<br/>    penalty="l2", fit_intercept=False, multi_class="ovr", C=1<br/>)</span></pre><p id="4c82" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">最后是经典的<code class="du mw mx my mz b">model.fit(X, y)</code>模型。模型参数在<code class="du mw mx my mz b">model.coef_</code>中以3行多列的数组形式提供，等于团队数量的两倍。第一排对应的是客队获胜的模式，第二排对应的是平局的模式，第三排对应的是主队获胜的模式。我们将在下一个例子中给出这些参数的直觉。</p><p id="49fb" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">要做预测，我们有两个选择。我们可以获得<strong class="kr hs">每个结果的概率或预期赢家</strong></p><pre class="jh ji jj jk fd na mz nb nc aw nd bi"><span id="7eaa" class="mj jy hi mz b fi ne nf l ng nh">probablities = predict_proba(home_team_name, away_team_name)<br/>winner = predict_winner(home_team_name, away_team_name)</span></pre><p id="2cbe" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">从处理数据到做出预测的流水线在<code class="du mw mx my mz b">LogisticModel</code>可用<a class="ae jw" href="https://github.com/octosport/octopy/blob/master/octopy/logistic_model.py" rel="noopener ugc nofollow" target="_blank">这里</a>可用。</p><h2 id="3929" class="mj jy hi bd jz mk ml mm kd mn mo mp kh ky mq mr kj lc ms mt kl lg mu mv kn ho bi translated">模型解释:一个具体的例子</h2><p id="2cd2" class="pw-post-body-paragraph kp kq hi kr b ks kt is ku kv kw iv kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">让我们用一些英超联赛的真实数据。我们使用2018年3月至2021年3月的数据，按照上述步骤训练模型。其中有1110场比赛和27支队伍。</p><p id="decc" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">模型系数有助于解释模型如何理解数据。请记住，该模型试图使用我们为三种不同结果编码的团队信息来预测0和1。团队系数不是很有用，但它们的符号和大小与其他系数相比是有用的。例如，让我们看看主场获胜的模式。<strong class="kr hs">团队系数上的正号意味着团队增加了主场获胜的机会。团队系数上的负号意味着该团队减少了主队获胜的机会。</strong></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es ni"><img src="../Images/a916df2f4032ae92fb72bd85cec7c703.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*MlWKUuhZfRaiwha-Uh8M8w.png"/></div><figcaption class="js jt et er es ju jv bd b be z dx">Home wins model coefficients (EPL, 2018-2021)</figcaption></figure><p id="2b1d" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">我们观察到曼联客场作战的系数为负(-1.35)，这意味着<strong class="kr hs">曼联对主队赢得</strong>的机会有负面影响。换句话说，曼联在客场打得很好，但主场也很好，因为系数是1.63。</p><p id="e997" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">当哈德斯菲尔德镇主场比赛时，系数也是负的(-1.37)，这意味着他们对自己的获胜机会有负面影响。</p><p id="25f2" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">当诺维奇城客场比赛时，它增加了主队获胜的机会，因为它的系数是正的(1.0)。我们可以在亚足联伯恩茅斯得到同样的结论，但系数更小(0.75)，影响也更小。任何主场对阵诺维奇城或亚足联伯恩茅斯的球队，与对阵曼城或利物浦这样系数为负的球队相比，获胜的机会都会增加。</p></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><h1 id="c556" class="jx jy hi bd jz ka lx kc kd ke ly kg kh ix lz iy kj ja ma jb kl jd mb je kn ko bi translated"><strong class="ak">5大联赛表现</strong></h1><p id="28f2" class="pw-post-body-paragraph kp kq hi kr b ks kt is ku kv kw iv kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">现在我们有了一个模型，我们理解了它，是时候进行测试了。为此，我们使用欧洲的5大联赛，即英格兰超级联赛、法甲联赛、德甲联赛、意甲联赛和西甲联赛。数据由<a class="ae jw" href="https://www.sportmonks.com/" rel="noopener ugc nofollow" target="_blank"> Sportmonks </a>提供。</p><p id="db48" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">为了估计模型的样本外性能，我们使用3年的匹配来预测下一轮。预测最后5轮，总共产生500个样本外预测。所有数字都是截至2021年3月4日计算的。逻辑模型的性能将与【Octosport模型的实际性能进行比较。</p><p id="3c2a" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">在下表中，我们展示了两种不同的性能指标。</p><ul class=""><li id="ead7" class="nj nk hi kr b ks ll kv lm ky nl lc nm lg nn lk no np nq nr bi translated"><strong class="kr hs">准确率</strong>:正确预测的百分比，最接近100%最好</li><li id="7604" class="nj nk hi kr b ks ns kv nt ky nu lc nv lg nw lk no np nq nr bi translated"><strong class="kr hs">对数损失:</strong>它给出了概率质量的度量，最接近0。</li></ul><p id="23d6" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">我们还增加了主队获胜的百分比作为基准，500场比赛的41%。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ni"><img src="../Images/68fad3275ac611f7f6c61a84a08ae104.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*y4i0v0hmKzlNK_oEnKOq9Q.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Top 5 leagues performance comparison</figcaption></figure><p id="0a6a" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">逻辑模型将这一数字增加了7%，而Octosport模型将这一数字增加了14%。如对数损失所示，Octosport模型的概率也更好。总的来说，逻辑模型显示了一个合理的性能，但如果你想超越它是另一回事。</p><blockquote class="mc md me"><p id="9f83" class="kp kq mf kr b ks ll is ku kv lm iv kx mg ln la lb mh lo le lf mi lp li lj lk hb bi translated">像Dixon-Coles或Poisson回归等其他简单模型很有可能会产生相同的性能水平，因为它们都使用相同的信息，匹配结果。</p></blockquote><p id="f03f" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">这个结果中重要的是<strong class="kr hs"/><strong class="kr hs">要持续击败简单模型</strong>需要很大的努力，就像本文中介绍的模型一样。Octosport模型使用了复杂得多的机器学习模型和基础设施。它处理来自多个来源的大量数据，预测全球超过580场比赛。我们需要处理大量异构数据，监控性能，及时做出预测，处理<a class="ae jw" href="https://en.wikipedia.org/wiki/Overfitting" rel="noopener ugc nofollow" target="_blank">过度拟合风险</a>，理解数学，我们还没有提到基础设施。</p></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><h1 id="bb22" class="jx jy hi bd jz ka lx kc kd ke ly kg kh ix lz iy kj ja ma jb kl jd mb je kn ko bi translated">结论</h1><p id="5c26" class="pw-post-body-paragraph kp kq hi kr b ks kt is ku kv kw iv kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">在本文中，我们提出了一个简单而有效的模型来预测以足球为重点的体育赛事。没有进行任何假设，逻辑模型与简单的机器学习技巧结合使用，如一键编码和岭正则化。该模型可用于任何其他基于团队的运动。</p><p id="6a3f" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">利用统计学习进行足球预测是任何人都能做的事情。但是当你想改进这些模型时，困难就出现了。Octosport旨在通过我们的API向任何人提供这种改进，但我们也希望在足球和体育预测方面对人们进行教育。</p><p id="3535" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">预测在赌博中起着重要的作用，但是击败庄家不仅仅是一场预测游戏。</p><blockquote class="mc md me"><p id="2fb5" class="kp kq mf kr b ks ll is ku kv lm iv kx mg ln la lb mh lo le lf mi lp li lj lk hb bi translated">物流模型在<a class="ae jw" href="https://github.com/octosport/octopy" rel="noopener ugc nofollow" target="_blank"> Github </a>上有，玩得开心。</p></blockquote><h2 id="d04a" class="mj jy hi bd jz mk ml mm kd mn mo mp kh ky mq mr kj lc ms mt kl lg mu mv kn ho bi translated">参考</h2><p id="7dcc" class="pw-post-body-paragraph kp kq hi kr b ks kt is ku kv kw iv kx ky kz la lb lc ld le lf lg lh li lj lk hb bi translated">[1] M. J. Dixon和S. G. Coles (1997)，<a class="ae jw" href="https://www.jstor.org/stable/2986290?seq=1" rel="noopener ugc nofollow" target="_blank">模拟足球协会的足球比分和足球博彩市场的低效率</a>。皇家统计学会杂志:C辑(应用统计学)，46:265–280。</p><p id="b741" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">[2] L. Maystre，V. Kristof和M. Grossglauser，<a class="ae jw" href="https://arxiv.org/abs/1903.07746" rel="noopener ugc nofollow" target="_blank">与弹性时间动力学的成对比较</a>，KDD，2019</p><p id="e341" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">[3] R. A. Bradley和M. E. Terry (1952)，<a class="ae jw" href="https://www.jstor.org/stable/2334029?seq=1" rel="noopener ugc nofollow" target="_blank">不完全区组设计的秩分析:ⅰ.配对比较的方法。生物计量学，39(3–4)，502–537。</a></p><p id="a447" class="pw-post-body-paragraph kp kq hi kr b ks ll is ku kv lm iv kx ky ln la lb lc lo le lf lg lp li lj lk hb bi translated">[4]艾罗。1978.国际象棋选手的等级，过去和现在。阿科出版公司。</p></div></div>    
</body>
</html>