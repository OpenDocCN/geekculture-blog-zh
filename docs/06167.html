<html>
<head>
<title>Scrape Google Inline Images with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python抓取谷歌内嵌图片</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/scrape-google-inline-images-with-python-85837af2fe17?source=collection_archive---------6-----------------------#2021-08-09">https://medium.com/geekculture/scrape-google-inline-images-with-python-85837af2fe17?source=collection_archive---------6-----------------------#2021-08-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/143336d5611ed2d2362fb29cea574973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SiwRYDJ8CBSqP4Hb.jpg"/></div></div></figure><div class=""/><p id="7b27" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">内容:<a class="ae jo" href="#9ad2" rel="noopener ugc nofollow">简介</a>、<a class="ae jo" href="#7618" rel="noopener ugc nofollow">进口</a>、<a class="ae jo" href="#a829" rel="noopener ugc nofollow">什么会报废</a>、<a class="ae jo" href="#df82" rel="noopener ugc nofollow">流程</a>、<a class="ae jo" href="#5bef" rel="noopener ugc nofollow">编码</a>、<a class="ae jo" href="#8835" rel="noopener ugc nofollow">环节</a>、<a class="ae jo" href="#a3c0" rel="noopener ugc nofollow">输出</a>。</p><h1 id="9ad2" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">介绍</h1><p id="1793" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">这篇博文是谷歌网络抓取系列的延续。在这里，您将看到如何使用Python通过<code class="du ks kt ku kv b">beautifulsoup</code>、<code class="du ks kt ku kv b">requests</code>、<code class="du ks kt ku kv b">lxml</code>、<code class="du ks kt ku kv b">re</code>、<code class="du ks kt ku kv b">base64</code>、<code class="du ks kt ku kv b">BytesIO</code>、<code class="du ks kt ku kv b">PIL</code>库来抓取内联图像。将显示替代的API解决方案。</p><p id="a58f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kw">注意:这篇博文假设你熟悉</em> <code class="du ks kt ku kv b"><em class="kw">beautifulsoup</em></code> <em class="kw">、</em> <code class="du ks kt ku kv b"><em class="kw">requests</em></code> <em class="kw">库，并对正则表达式有基本的了解。</em></p><h1 id="7618" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">进口</h1><pre class="kx ky kz la fd lb kv lc ld aw le bi"><span id="9b19" class="lf jq ht kv b fi lg lh l li lj">import requests, lxml, re, base64<br/>from bs4 import BeautifulSoup <br/>from io import BytesIO # for decoding base64 image<br/>from PIL import Image # for saving decoded image<br/>from serpapi import GoogleSearch # alternative API solution</span></pre><h1 id="a829" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">会刮什么</h1><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lk"><img src="../Images/02576e6bbbd04c8f252dfd74b61d6658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5WqZpsU5Cud6eo1n.png"/></div></div></figure><h1 id="df82" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">过程</h1><p id="38d7" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">选择容器、链接和照片的使用位置。</p><figure class="kx ky kz la fd hk er es paragraph-image"><div class="er es ll"><img src="../Images/878cbb589eb526ac2ba9ea193ce18af3.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*C8rweo4K6MTxhCqs.gif"/></div></figure><p id="b051" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">提取缩略图</strong> <br/>提取缩略图，我们需要看<code class="du ks kt ku kv b">&lt;img&gt;</code>标签带<code class="du ks kt ku kv b">id</code> <code class="du ks kt ku kv b">dimg_XX</code> ( <em class="kw"> XX -某号</em>)。</p><p id="fa36" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你打开源代码(Ctrl + U)并试图找到<code class="du ks kt ku kv b">dimg_36</code> ( <em class="kw">或其他数字，取决于HTML代码</em>)你会看到有<strong class="is hu"> 2 </strong>出现，其中一个会在<code class="du ks kt ku kv b">&lt;script&gt;</code>标签的某个地方，这就是我们需要的。</p><p id="3c3f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了提取缩略图，我们需要使用<code class="du ks kt ku kv b">regex</code>从<code class="du ks kt ku kv b">&lt;script&gt;</code>标签中获取它们，因为如果您解析来自<code class="du ks kt ku kv b">src</code>属性的数据，您将得到这样的输出:<code class="du ks kt ku kv b">data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</code>这是一个编码的图片。</p><figure class="kx ky kz la fd hk er es paragraph-image"><div class="er es lm"><img src="../Images/ed05df8244f54853d83a837e6fb29f70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/0*TNLhM1X-D2F28ufr.png"/></div></figure><p id="fe6f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kw">关于这个话题的更多信息可以在</em> <a class="ae jo" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs" rel="noopener ugc nofollow" target="_blank"> <em class="kw">开发者Mozilla </em> </a>上找到</p><p id="11ef" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正则表达式非常简单:</p><pre class="kx ky kz la fd lb kv lc ld aw le bi"><span id="d905" class="lf jq ht kv b fi lg lh l li lj">s='data:image/jpeg;base64,(.*?)';</span></pre><p id="7515" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正则表达式解释:</p><ol class=""><li id="dd56" class="ln lo ht is b it iu ix iy jb lp jf lq jj lr jn ls lt lu lv bi translated">寻找<code class="du ks kt ku kv b">s='data:image/jpeg;base64,</code></li><li id="aa85" class="ln lo ht is b it lw ix lx jb ly jf lz jj ma jn ls lt lu lv bi translated">创建一个抓取组<code class="du ks kt ku kv b">(.*?)</code>，它将抓取所有东西，并以<code class="du ks kt ku kv b">';</code>符号结束。</li><li id="fb6f" class="ln lo ht is b it lw ix lx jb ly jf lz jj ma jn ls lt lu lv bi translated">将只提取捕获组，而不提取其他部分。</li></ol><p id="08d5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kw">截图说明正则表达式捕捉到了什么，你可以在这里找到</em><a class="ae jo" href="https://regex101.com/r/L3IZXe/4/" rel="noopener ugc nofollow" target="_blank"><em class="kw"/></a>:</p><p id="4adb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之后，可以使用<code class="du ks kt ku kv b">PIL</code>模块保存解码后的base64字符串。更多信息请见<a class="ae jo" href="https://stackoverflow.com/a/6966225/15164646" rel="noopener ugc nofollow" target="_blank"> StackOverFlow回答</a>。</p><h1 id="5bef" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">密码</h1><figure class="kx ky kz la fd hk"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="db12" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">后台保存的图像:</p><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lk"><img src="../Images/00661200e1e9959402089712df8005c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*INEUJx1Ka_qtxroM.png"/></div></div></figure><p id="f7cb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">GIF来说明输出:</p><figure class="kx ky kz la fd hk er es paragraph-image"><div class="er es ll"><img src="../Images/aa4e2ff4a96dd571dfcf9d2fb6a9c166.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*jCTrMfISOe1sGeeo.gif"/></div></figure><h1 id="7796" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">使用<a class="ae jo" href="https://serpapi.com/google-inline-images" rel="noopener ugc nofollow" target="_blank">谷歌内嵌图像API </a></h1><p id="5706" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">SerpApi是一个付费Api，可以免费试用5000次搜索。</p><p id="52fc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最大的区别在于，您不必为了获得合适的图像大小而去计算从哪里解析某些元素，因为这已经为最终用户完成了。除此之外，如果您的脚本请求被阻塞，就不需要维护解析器或寻找方法。</p><figure class="kx ky kz la fd hk"><div class="bz dy l di"><div class="mb mc l"/></div></figure><h1 id="8835" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">链接</h1><p id="edac" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated"><a class="ae jo" href="https://replit.com/@DimitryZub1/Scrape-Google-Inline-Images-python#bs4_result.py" rel="noopener ugc nofollow" target="_blank">在线IDE中的代码</a><strong class="is hu"/><a class="ae jo" href="https://serpapi.com/google-inline-images" rel="noopener ugc nofollow" target="_blank">Google Inline Images API</a></p><h1 id="a3c0" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结尾部分</h1><p id="3836" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">如果你发现有些东西不能正常工作，或者如果你想看看如何用Python/Ruby来解决一些我还没有写到的问题，请给我写封邮件。</p><p id="bd80" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你的，<br/> — D</p></div><div class="ab cl md me gp mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="hb hc hd he hf"><p id="16c6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kw">原载于2021年8月9日https://serpapi.com</em><em class="kw">的</em> <a class="ae jo" href="https://serpapi.com/blog/scrape-google-inline-images-with-python/" rel="noopener ugc nofollow" target="_blank"> <em class="kw">。</em></a></p></div></div>    
</body>
</html>