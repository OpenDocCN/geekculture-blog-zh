<html>
<head>
<title>Take Twitter’s temperature</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以Twitter的温度为例</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/take-twitters-temperature-1cf10c2c83fe?source=collection_archive---------21-----------------------#2022-01-13">https://medium.com/geekculture/take-twitters-temperature-1cf10c2c83fe?source=collection_archive---------21-----------------------#2022-01-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="4a92" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">使用Deephaven的情感分析教程</h2></div><p id="4053" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">阿曼达·马丁</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/7ced9baa5c0f86857ac9991804c3df86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*vjbzpVvowY-yelQV6bdrlw.gif"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Source: Image by author</figcaption></figure><p id="f065" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Twitter是社会情绪的数据宝库。在meme股票交易中赚到的钱是社区情感力量的一个惊人的例子。然而，你可能会花费数小时手动滚动社交媒体，却得不到有意义的见解。或者，你可以用自动化和ML来实时测量情绪，并产生有用的结果。</p><p id="c24f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Python和TensorFlow的自然语言处理库以及Deephaven的流和批处理表引擎共同应对这一挑战。下面，我分享我开发的一个应用程序的细节，这个应用程序对Twitter feed进行自然语言处理，并将其与股票价格信息结合起来——所有这些都是实时的。</p><p id="14fd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个启动程序查看关于加密货币的推文；然而，可能性是无限的，我们鼓励您根据自己的兴趣定制这些查询。</p><p id="6243" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里展示的<a class="ae kj" href="https://github.com/deephaven-examples/twitter-sentiment" rel="noopener ugc nofollow" target="_blank">程序</a>将<a class="ae kj" href="http://deephaven.io/" rel="noopener ugc nofollow" target="_blank"> Deephaven </a>与<a class="ae kj" href="https://twitter.com/" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和Python的<a class="ae kj" href="https://www.nltk.org/" rel="noopener ugc nofollow" target="_blank">自然语言工具包(NLTK) </a>集成在一起，以获取最近的推文并实时评估情绪。我们首先提取数据，并对每条推文运行一个<code class="du kk kl km kn b">SentimentIntensityAnalyzer</code>。然后，我们汇总这些帖子，看看随着时间的推移，这个词在Twitter上的总体积极或消极程度。</p><h1 id="5f4d" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated"><strong class="ak">先决条件</strong></h1><p id="6268" class="pw-post-body-paragraph ix iy hi iz b ja lg ij jc jd lh im jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">要开始，请转到我们的<a class="ae kj" href="https://github.com/deephaven-examples/twitter-sentiment" rel="noopener ugc nofollow" target="_blank">示例repo </a>或运行以下命令来下载所有代码和依赖项，以便使用<a class="ae kj" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>。</p><pre class="ju jv jw jx fd ll kn lm ln aw lo bi"><span id="aa7d" class="lp kp hi kn b fi lq lr l ls lt"><em class="lu">git</em> clone https://github.com/deephaven-examples/twitter-sentiment.git<br/>cd twitter-sentiment</span></pre><p id="15d0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一个启动脚本将安装所需的Python模块并启动Deephaven IDE。</p><p id="dd2d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要运行它，请执行:</p><pre class="ju jv jw jx fd ll kn lm ln aw lo bi"><span id="ebfc" class="lp kp hi kn b fi lq lr l ls lt">./twitter-sentiment.sh</span></pre><p id="1a2f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae kj" href="https://developer.twitter.com/en/docs/twitter-api" rel="noopener ugc nofollow" target="_blank"> Twitter </a>提供了一个API，使得拉取公共推文变得容易。为了按原样使用这些代码，您还需要有一个Twitter开发人员帐户，并复制您的不记名令牌。</p><p id="f207" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">导入适当的包以使用每个平台。我在深水港表演了一个<code class="du kk kl km kn b">pip install</code>。这确保了我的程序运行不需要任何额外的修改。</p><pre class="ju jv jw jx fd ll kn lm ln aw lo bi"><span id="db46" class="lp kp hi kn b fi lq lr l ls lt">import nltk<br/>nltk.download('punkt')<br/>nltk.download('vader_lexicon')</span><span id="067f" class="lp kp hi kn b fi lv lr l ls lt">from requests_oauthlib import OAuth1Session<br/>import requests<br/>from datetime import datetime</span><span id="e4a0" class="lp kp hi kn b fi lv lr l ls lt">import time<br/>import re<br/>import json<br/>from nltk.sentiment.vader import SentimentIntensityAnalyzer</span><span id="562e" class="lp kp hi kn b fi lv lr l ls lt">from deephaven.DateTimeUtils import convertDateTime, minus, convertPeriod, currentTime<br/>from deephaven import DynamicTableWriter<br/>import deephaven.Types as dht<br/>import threading</span></pre><h1 id="2a7c" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">运行程序</h1><p id="3175" class="pw-post-body-paragraph ix iy hi iz b ja lg ij jc jd lh im jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">该程序旨在进行微调，以满足您的数据需求。以下是您需要更改的值，以便为您的特定使用情形和信息定制该程序。</p><p id="d615" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个例子中，我在一周的时间里对Dogecoin的推文进行了情感分析。</p><ol class=""><li id="d00b" class="lw lx hi iz b ja jb jd je jg ly jk lz jo ma js mb mc md me bi translated">首先，你需要我上面提到的令牌。重要提示:不记名令牌是由Twitter提供的，每个开发者都有一个月限额，所以保持这个令牌的私密性。</li><li id="3586" class="lw lx hi iz b ja mf jd mg jg mh jk mi jo mj js mb mc md me bi translated">我搜索任何包含术语<code class="du kk kl km kn b">DOGE</code>的推文。</li><li id="87e4" class="lw lx hi iz b ja mf jd mg jg mh jk mi jo mj js mb mc md me bi translated">因为有推文速率限制，我想看最近七天的推文，所以我用<code class="du kk kl km kn b">max_results = 10</code>每次拉取只收集10条推文。我建议使用较低的数字进行测试。当您准备好生产时，根据需要增加，同时记住速率限制。</li><li id="6ba3" class="lw lx hi iz b ja mf jd mg jg mh jk mi jo mj js mb mc md me bi translated">接下来，为了看看推特上的情绪是如何随着时间变化的，我把这七天分成几个小部分<code class="du kk kl km kn b">time_bins</code>。更多的垃圾箱将使你能够看到社会情绪的更精细的变化，但也会吸引更多的推文，这意味着你更快达到你的速率限制。</li><li id="8b68" class="lw lx hi iz b ja mf jd mg jg mh jk mi jo mj js mb mc md me bi translated">我的<a class="ae kj" href="https://developer.twitter.com/en/docs/twitter-api/getting-started/about-twitter-api" rel="noopener ugc nofollow" target="_blank"> Twitter访问级别</a>限制了我在七天内可以获取的历史推文数量，所以我设置了<code class="du kk kl km kn b">time_history = 7</code>。这是非学术搜索的标准。</li></ol><pre class="ju jv jw jx fd ll kn lm ln aw lo bi"><span id="4ad7" class="lp kp hi kn b fi lq lr l ls lt"># Make sure you enter your token like this 'AAAD...JFH'<br/>bearer_token = '&lt;INPUT YOUR TOKEN HERE&gt;'</span><span id="0c11" class="lp kp hi kn b fi lv lr l ls lt"># Change this to search whatever term you want on Twitter<br/>search_term = 'DOGE'</span><span id="11c6" class="lp kp hi kn b fi lv lr l ls lt"># Max results per time bin<br/>max_results = 10</span><span id="3e07" class="lp kp hi kn b fi lv lr l ls lt"># Time intervals to split data<br/>time_bins = 10</span><span id="de77" class="lp kp hi kn b fi lv lr l ls lt"># How many days to go back. Max 7 for non-academic searches<br/>time_history = 7</span></pre><h1 id="884f" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">配置您的功能<a class="ae kj" href="https://docs-staging.deephaven.io/deploy-preview/413a2bb8d3b652dbfd4887a690328c4930e597e9/blog/2022/01/11/twitter-sentiment/#configure-your-functions" rel="noopener ugc nofollow" target="_blank"> </a></h1><p id="1dd7" class="pw-post-body-paragraph ix iy hi iz b ja lg ij jc jd lh im jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">在这段代码中，我们创建了从Twitter中提取数据所需的函数。</p><p id="8bd4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Twitter提供了很多带有v2 API的示例代码。这些函数来自Github Twitter-API-v2-sample-code repo,这样我们就可以通过适当的授权连接到所需的端点。</p><pre class="ju jv jw jx fd ll kn lm ln aw lo bi"><span id="8a69" class="lp kp hi kn b fi lq lr l ls lt">def create_headers(bearer_token):<br/>        headers = {<br/>            "Authorization": "Bearer {}".format(bearer_token),<br/>            "User-Agent": "v2FullArchiveSearchPython"}<br/>        return headers</span><span id="cab1" class="lp kp hi kn b fi lv lr l ls lt">search_url = "<a class="ae kj" href="https://api.twitter.com/2/tweets/search/recent" rel="noopener ugc nofollow" target="_blank">https://api.twitter.com/2/tweets/search/recent</a>"</span><span id="fa03" class="lp kp hi kn b fi lv lr l ls lt">def connect_to_endpoint(url, headers, params):<br/>    response = requests.request("GET", search_url, headers=headers, params=params)<br/>    if response.status_code != 200:<br/>        raise Exception(response.status_code, response.text)<br/>    return response.json()</span></pre><p id="801d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">推文包含大量有用的元数据。在这里，我设置了我喜欢使用的字段:只有<code class="du kk kl km kn b">tweet.fields</code>和<code class="du kk kl km kn b">user.fields</code>数据以保持简单。使用这些字段允许我根据推文或用户的受欢迎程度来衡量推文，而忽略位置信息。其余的留给您根据需要添加，如果您想将搜索限制在世界上的某些地方，这可能是有用的。</p><pre class="ju jv jw jx fd ll kn lm ln aw lo bi"><span id="fb3e" class="lp kp hi kn b fi lq lr l ls lt">def get_query_params(start_time, end_time):<br/>    return {'query': search_term,<br/>                    'start_time': start_time,<br/>                    'end_time': end_time,<br/>                    'max_results': max_results,<br/>    #                 'expansions': 'author_id,in_reply_to_user_id,geo.place_id',<br/>                    'tweet.fields': 'id,text,author_id,in_reply_to_user_id,geo,conversation_id,created_at,lang,public_metrics,referenced_tweets,reply_settings,source',<br/>                    'user.fields': 'id,name,username,created_at,description,public_metrics,verified',<br/>    #                 'place.fields': 'full_name,id,country,country_code,geo,name,place_type',<br/>                    'next_token': {}}</span></pre><p id="db3f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们有了拉推的功能。我将它与之前的代码分开，以便更容易将<code class="du kk kl km kn b">query_params</code>更改为您想要的日期区。</p><p id="cd33" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">默认情况下，如果给定一个7天前的开始时间范围，那么只会拉取最近的推文。由于我希望保证存储箱中的日期，所以我为每个请求提供了确切的开始和结束日期。</p><p id="5bd1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个函数为每个时间框调用，并返回所有以JSON格式请求的tweet数据。</p><pre class="ju jv jw jx fd ll kn lm ln aw lo bi"><span id="249a" class="lp kp hi kn b fi lq lr l ls lt">def get_tweets(query_params):<br/>    headers = create_headers(bearer_token)<br/>    json_response = connect_to_endpoint(search_url, headers, query_params)<br/>    return(json_response['data'])</span></pre><h1 id="4d08" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">清理推文<a class="ae kj" href="https://docs-staging.deephaven.io/deploy-preview/413a2bb8d3b652dbfd4887a690328c4930e597e9/blog/2022/01/11/twitter-sentiment/#clean-the-tweets" rel="noopener ugc nofollow" target="_blank"> </a></h1><p id="c064" class="pw-post-body-paragraph ix iy hi iz b ja lg ij jc jd lh im jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">因为我正在对推文的内容进行情感分析，所以我清理了每条推文。这是可选的，但是为表中的tweets提供了更统一的外观。</p><pre class="ju jv jw jx fd ll kn lm ln aw lo bi"><span id="c15c" class="lp kp hi kn b fi lq lr l ls lt">def cleanText(text):<br/>    #to lowercase<br/>    text = text.lower()<br/>    #correct spaces (e.g. "End sentence.Begin another" becomes "End sentence. Begin another")<br/>    text = re.sub(r'\.([a-zA-Z])', r'. \1', text)<br/>    text = re.sub(r'\?([a-zA-Z])', r'. \1', text)<br/>    text = re.sub(r'\!([a-zA-Z])', r'. \1', text)<br/>    #replace q1,2,3,4 with q<br/>    text = re.sub("q[1-4]", "q", text)<br/>    #replace 20xx with 2000<br/>    text = re.sub("20[0-2][0-9]", "2000", text)<br/>    return text</span></pre><h1 id="f6e1" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">评估情绪<a class="ae kj" href="https://docs-staging.deephaven.io/deploy-preview/413a2bb8d3b652dbfd4887a690328c4930e597e9/blog/2022/01/11/twitter-sentiment/#assess-sentiment" rel="noopener ugc nofollow" target="_blank"> </a></h1><p id="7a98" class="pw-post-body-paragraph ix iy hi iz b ja lg ij jc jd lh im jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">接下来，我通过NLTK <code class="du kk kl km kn b">SentimentIntensityAnalyzer</code>运行每条推文。这将返回推文的极性分数——即推文的积极、消极和中立程度，以及综合分数。通常，一条推文会充斥着杜撰的词语、首字母缩写词等等。这些通常被评为中性，不影响分析。</p><pre class="ju jv jw jx fd ll kn lm ln aw lo bi"><span id="b21e" class="lp kp hi kn b fi lq lr l ls lt">def analyze_line(text):<br/>    sid = SentimentIntensityAnalyzer()<br/>    return(sid.polarity_scores(text))</span></pre><h1 id="a816" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">把我们的数据放在一个表格里<a class="ae kj" href="https://docs-staging.deephaven.io/deploy-preview/413a2bb8d3b652dbfd4887a690328c4930e597e9/blog/2022/01/11/twitter-sentiment/#put-our-data-in-a-table" rel="noopener ugc nofollow" target="_blank"> </a></h1><p id="dd7e" class="pw-post-body-paragraph ix iy hi iz b ja lg ij jc jd lh im jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">最后一个函数需要创建一个表来存储我们的数据。</p><p id="7241" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们使用Deephaven的<a class="ae kj" href="https://deephaven.io/core/docs/reference/table-operations/create/DynamicTableWriter/" rel="noopener ugc nofollow" target="_blank"> DynamicTableWriter类</a>，它为动态表的每次迭代调用函数。</p><p id="25e8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们为每个<code class="du kk kl km kn b">time_bins</code>添加到表中。通过用<a class="ae kj" href="https://github.com/deephaven/deephaven-core/blob/main/Integrations/python/deephaven/Types.py" rel="noopener ugc nofollow" target="_blank"> Deephaven Types </a>格式化数据，我们使得在我们的表上连接、过滤、汇总、绘图和执行其他分析变得容易。</p><pre class="ju jv jw jx fd ll kn lm ln aw lo bi"><span id="0e96" class="lp kp hi kn b fi lq lr l ls lt">def thread_func():<br/>    for i in range(1, time_bins):<br/>        start_time = str(minus(currentTime(),convertPeriod("T"+str(int(i*(24*time_history)/time_bins))+"H")))[:-9]+'Z'<br/>        end_time = str(minus(currentTime(),convertPeriod("T"+str(int((i-1)*(24*time_history)/time_bins))+"H")))[:-9]+'Z'<br/>        query_params = get_query_params(start_time, end_time)<br/>        all_text = get_tweets(query_params)<br/>        for t in all_text:<br/>            id = float(t['id'])<br/>            combined = analyze_line(cleanText(t['text']))<br/>            negative = combined.get('neg')<br/>            neutral = combined.get('neu')<br/>            compound = combined.get('compound')<br/>            positive = combined.get('pos')<br/>            dateTime = t['created_at'][:-1]+" NY"<br/>            retweet_count = t['public_metrics']['retweet_count']<br/>            reply_count = t['public_metrics']['reply_count']<br/>            like_count = t['public_metrics']['like_count']<br/>            quote_count= t['public_metrics']['quote_count']<br/>            tableWriter_sia.logRow(t['text'], float(compound), float(negative), float(neutral), float(positive), float(id),convertDateTime(dateTime), int(retweet_count), int(reply_count), int(like_count), int(quote_count))</span></pre><p id="70ad" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，我创建了<code class="du kk kl km kn b">tableWriter_sia</code>并执行线程来运行上面的函数。这导致了<code class="du kk kl km kn b">sia_data</code>表，其中填充了推文及其元数据，以及每条推文的情感。</p><pre class="ju jv jw jx fd ll kn lm ln aw lo bi"><span id="62e5" class="lp kp hi kn b fi lq lr l ls lt">tableWriter_sia = DynamicTableWriter(<br/>    ["Text", "Compound", "Negative", "Neutral", "Positive", "ID", "DateTime", "Retweet_count", "Reply_count", "Like_count", "Quote_count"],<br/>    [dht.string, dht.double, dht.double, dht.double, dht.double, dht.double, dht.datetime, dht.int_, dht.int_, dht.int_, dht.int_])<br/>sia_data = tableWriter_sia.getTable()</span><span id="5c09" class="lp kp hi kn b fi lv lr l ls lt">thread_sia = threading.Thread(target = thread_func)<br/>thread_sia.start()</span></pre><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mk"><img src="../Images/e7d2a194fc357eecb6581244a5dc0a76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jv6qPRNjht_qhk6OEgwabg.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Deephaven table to store our results. Source: Image by author</figcaption></figure><h1 id="6847" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated"><a class="ae kj" href="https://docs-staging.deephaven.io/deploy-preview/413a2bb8d3b652dbfd4887a690328c4930e597e9/blog/2022/01/11/twitter-sentiment/#analyze-the-data" rel="noopener ugc nofollow" target="_blank">分析数据</a></h1><p id="faad" class="pw-post-body-paragraph ix iy hi iz b ja lg ij jc jd lh im jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">现在是有趣的部分。让我们对推文做一些分析，这样我们可以看到搜索词的积极和消极是如何随着时间而变化的。</p><p id="2757" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，让我们汇总这些推文，这样我们就可以在我们选择的时间段内获得每条推文的摘要。</p><p id="5f15" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此代码:</p><ol class=""><li id="0966" class="lw lx hi iz b ja jb jd je jg ly jk lz jo ma js mb mc md me bi translated">创建一系列平均值和加权平均值。</li><li id="012d" class="lw lx hi iz b ja mf jd mg jg mh jk mi jo mj js mb mc md me bi translated">创建<code class="du kk kl km kn b">combined_tweets</code>表，向我们显示时间仓中每分钟的总体情绪。</li></ol><pre class="ju jv jw jx fd ll kn lm ln aw lo bi"><span id="f5e4" class="lp kp hi kn b fi lq lr l ls lt">from deephaven import Aggregation as agg, as_list</span><span id="52f8" class="lp kp hi kn b fi lv lr l ls lt">agg_list = as_list([<br/>    agg.AggCount("Count"),<br/>    agg.AggAvg("Average_negative = Negative"),<br/>    agg.AggAvg("Average_neutral = Neutral"),<br/>    agg.AggAvg("Average_positive = Positive"),<br/>    agg.AggAvg("Average_compound = Compound"),<br/>    agg.AggWAvg("Retweet_count", "Weight_negative = Negative"),<br/>    agg.AggWAvg("Retweet_count","Weight_neutral = Neutral"),<br/>    agg.AggWAvg("Retweet_count","Weight_positive = Positive"),<br/>    agg.AggWAvg("Retweet_count","Weight_compound = Compound")<br/>])</span><span id="0f8c" class="lp kp hi kn b fi lv lr l ls lt">from deephaven.DateTimeUtils import expressionToNanos, convertDateTime, upperBin</span><span id="4ee0" class="lp kp hi kn b fi lv lr l ls lt">combined_tweets = sia_data.update("Time_bin = upperBin(DateTime, 10000)").sort("DateTime").aggBy(agg_list,"Time_bin").sort("Time_bin")</span></pre><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ml"><img src="../Images/c5dc06752b9adef5eff5486ef55673ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U3IDnn8CUowf3-A3T5qV5g.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">The combined_tweets table. Source: Image by author</figcaption></figure><p id="393c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">桌子很酷，但不如一个阴谋有用。我使用Deephaven的绘图方法来创建我的数据的可视化效果。</p><pre class="ju jv jw jx fd ll kn lm ln aw lo bi"><span id="3d8c" class="lp kp hi kn b fi lq lr l ls lt">from deephaven import Plot</span><span id="302e" class="lp kp hi kn b fi lv lr l ls lt">sia_averages = Plot.plot("AVG_Neg", combined_tweets, "Time_bin", "Average_negative")\<br/>    .lineColor(Plot.colorRGB(255,0,0,100))\<br/>    .plot("AVG_Pos", combined_tweets, "Time_bin", "Average_positive")\<br/>    .lineColor(Plot.colorRGB(0,255,0,100))\<br/>    .show()</span></pre><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mm"><img src="../Images/bd1e22b7a315042b6c59bb09149410cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8L0QyZfK4fk7FP_n3vpmnw.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">sia_averages plot. Source: Image by author</figcaption></figure><h1 id="aaa9" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">轮到你了<a class="ae kj" href="https://docs-staging.deephaven.io/deploy-preview/413a2bb8d3b652dbfd4887a690328c4930e597e9/blog/2022/01/11/twitter-sentiment/#your-turn" rel="noopener ugc nofollow" target="_blank"> </a></h1><p id="d0b6" class="pw-post-body-paragraph ix iy hi iz b ja lg ij jc jd lh im jf jg li ji jj jk lj jm jn jo lk jq jr js hb bi translated">这段代码提供了一个基本的入门。你可以用它来进行自己的搜索，绑定到其他程序，或者只是看看社交媒体做得怎么样。</p><p id="e55c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们希望这个<a class="ae kj" href="https://github.com/deephaven-examples/twitter-sentiment" rel="noopener ugc nofollow" target="_blank">节目</a>能激励你。如果你有自己的东西或者想法要分享，我们很乐意在<a class="ae kj" href="https://gitter.im/deephaven/deephaven" rel="noopener ugc nofollow" target="_blank"> Gitter </a>上听到！</p></div></div>    
</body>
</html>