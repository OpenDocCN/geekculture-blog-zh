<html>
<head>
<title>Using Bicep for Infrastructure as Code on Azure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Bicep用于基础设施作为Azure上的代码</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/using-bicep-for-infrastructure-as-code-on-azure-3bbc3845bc36?source=collection_archive---------26-----------------------#2021-08-24">https://medium.com/geekculture/using-bicep-for-infrastructure-as-code-on-azure-3bbc3845bc36?source=collection_archive---------26-----------------------#2021-08-24</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><div class=""><h2 id="6b17" class="pw-subtitle-paragraph ig hi hj bd b ih ii ij ik il im in io ip iq ir is it iu iv iw ix dy translated"><strong class="ak">使用Azure本地语言简化基础设施部署的平台工程</strong></h2></div><p id="8a9b" class="pw-post-body-paragraph iy iz hj ja b jb jc ik jd je jf in jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">我在这里写了些东西已经有一段时间了。事实上，自从我的上一篇文章以来，发生了很多事情。我于今年6月加入皇家FrieslandCampina，我必须说，我一直在忙于我们计划用Data和Azure做的令人敬畏的事情。我没有时间去尝试新事物或做一些实际工作。</p><p id="4e31" class="pw-post-body-paragraph iy iz hj ja b jb jc ik jd je jf in jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">那么，还有什么比把基础设施作为一种代码更好的话题呢？让我们看看我喜欢这门语言的哪些二头肌和一些特征。另外，请随时<a class="ae ju" href="https://github.com/iammayanksrivastava/azurebicep" rel="noopener ugc nofollow" target="_blank">点击这里</a>访问我的GitHub页面。</p><figure class="jw jx jy jz fe ka es et paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="es et jv"><img src="../Images/04fd7307570ecb7729e47f47573643d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GCh21VhbF8a0xT6v7wR9hA.jpeg"/></div></div><figcaption class="kh ki eu es et kj kk bd b be z dy">Photo by Photo by Anastase Maragos on <a class="ae ju" href="https://unsplash.com/photos/FP7cfYPPUKM" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="81b1" class="pw-post-body-paragraph iy iz hj ja b jb jc ik jd je jf in jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">请注意，这是我第一次尝试评估Azure Bicep，以帮助我决定是否要将该工具添加到我的堆栈中。我仍然在按照最佳实践为我的Azure栈构建基础设施作为代码。</p><h2 id="daf3" class="kl km hj bd kn ko kp kq kr ks kt ku kv jh kw kx ky jl kz la lb jp lc ld le lf bi translated">那么什么是二头肌呢？</h2><p id="0a6f" class="pw-post-body-paragraph iy iz hj ja b jb lg ik jd je lh in jg jh li jj jk jl lj jn jo jp lk jr js jt hc bi translated">Azure Bicep是一种特定于领域的语言。是的，它是一种语言，可以与Terraform语言相媲美，告诉Terraform如何管理给定的基础设施集合。Bicep是ARM模板之上的一个抽象层，它用一个非常简单、清晰的语法简化了整体开发体验，您可以按照模块化和重用的原则构建代码。</p><h2 id="d3c4" class="kl km hj bd kn ko kp kq kr ks kt ku kv jh kw kx ky jl kz la lb jp lc ld le lf bi translated">肱二头肌的一些优点</h2><ul class=""><li id="af17" class="ll lm hj ja b jb lg je lh jh ln jl lo jp lp jt lq lr ls lt bi translated">我一直喜欢Terraform的原因之一是因为它非常容易理解。与手臂不同，二头肌超级容易理解和编码。你可以按照<a class="ae ju" href="https://docs.microsoft.com/en-us/azure/templates/microsoft.storage/storageaccounts?tabs=json" rel="noopener ugc nofollow" target="_blank">文档</a>去做，非常详细清晰。与JSON的复杂性不同，Bicep易于编写和遵循。例如，使用bicep和JSON声明参数</li></ul><pre class="jw jx jy jz fe lu lv lw lx aw ly bi"><span id="3f95" class="kl km hj lv b fj lz ma l mb mc">## Declaring parameters in bicep <br/>param location string = 'london'</span><span id="27cb" class="kl km hj lv b fj md ma l mb mc">#Declaring parameters in json</span><span id="91c8" class="kl km hj lv b fj md ma l mb mc">"parameters": {<br/>  "location": {<br/>    "type": "string",<br/>    "defaultValue": "london"<br/>  }<br/>}</span></pre><ul class=""><li id="df2f" class="ll lm hj ja b jb jc je jf jh me jl mf jp mg jt lq lr ls lt bi translated">Bicep模块有助于降低基础设施代码的复杂性。Bicep模块是要一起部署的一个或多个资源的集合。模块也是使Bicep代码更加可重用的一种方式。你可以有一个单一的二头肌模块，许多二头肌模板使用。您可以按照标准集中Bicep模块，并且多个业务单元可以在其模板中使用相同的模块来部署组件。</li><li id="e9ea" class="ll lm hj ja b jb mh je mi jh mj jl mk jp ml jt lq lr ls lt bi translated">参数和变量的使用使得你的Bicep模板或模块变得非常容易重用和通用。</li><li id="c003" class="ll lm hj ja b jb mh je mi jh mj jl mk jp ml jt lq lr ls lt bi translated">Bicep模板与Azure DevOps集成。你可以很容易地编写一个YAML模板，并整合你的二头肌模板作为一项任务。</li><li id="cdc6" class="ll lm hj ja b jb mh je mi jh mj jl mk jp ml jt lq lr ls lt bi translated">我在Terraform上遇到的一个难题是Azure的新功能不可用。二头肌帮助你克服这一挑战。所有功能，无论是正式版还是预览版，都将从第一天开始提供。</li><li id="833b" class="ll lm hj ja b jb mh je mi jh mj jl mk jp ml jt lq lr ls lt bi translated">如果你已经有了一个使用ARM模板的设置，你仍然可以将ARM模板反编译成Bicep模板，然后切换到Azure Bicep。我还没有尝试这些功能，但是从我在这里读到的<a class="ae ju" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/decompile?tabs=azure-cli" rel="noopener ugc nofollow" target="_blank"/>来看，这似乎是一个简单的工作。</li></ul><p id="118f" class="pw-post-body-paragraph iy iz hj ja b jb jc ik jd je jf in jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">我们是否应该将Azure二头肌作为堆栈的一部分？从架构的角度来看，我建议使用Bicep作为Azure原生基础设施，作为技术堆栈中的代码工具。</p><h2 id="29ab" class="kl km hj bd kn ko kp kq kr ks kt ku kv jh kw kx ky jl kz la lb jp lc ld le lf bi translated">安装二头肌</h2><p id="0ee2" class="pw-post-body-paragraph iy iz hj ja b jb lg ik jd je lh in jg jh li jj jk jl lj jn jo jp lk jr js jt hc bi translated">安装二头肌非常容易。我不会花太多时间解释如何安装二头肌。请<a class="ae ju" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/install" rel="noopener ugc nofollow" target="_blank">点击</a>此链接了解安装该工具的详细步骤。简而言之，安装VS代码和Bicep CLI创建模板。我强烈建议在VSCode中安装Bicep扩展，以方便您创建模板。提供语言支持和资源自动完成。该扩展帮助您创建和验证Bicep文件。</p><p id="9adc" class="pw-post-body-paragraph iy iz hj ja b jb jc ik jd je jf in jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated"><strong class="ja hk">写一个模块存放账户</strong></p><figure class="jw jx jy jz fe ka es et paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="es et mm"><img src="../Images/361442c3edf7f9c9da83f68ffdc7c20b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HUNP_TgaudbmU8-zY0j9wA.png"/></div></div><figcaption class="kh ki eu es et kj kk bd b be z dy">Module in Bicep for Storage Account</figcaption></figure><p id="5566" class="pw-post-body-paragraph iy iz hj ja b jb jc ik jd je jf in jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated"><strong class="ja hk">使用二头肌模板中的模块</strong></p><figure class="jw jx jy jz fe ka es et paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="es et mn"><img src="../Images/aae60c6df3d1bfad52d725c5f744cd71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DHEl9Vk0Q7j6n1fM6o9SKw.png"/></div></div><figcaption class="kh ki eu es et kj kk bd b be z dy">Bicep template which uses the module</figcaption></figure><p id="a4eb" class="pw-post-body-paragraph iy iz hj ja b jb jc ik jd je jf in jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">请注意，您可以在模板中内联定义参数，也可以在单独的文件中创建参数并在代码中引用它。对于这个例子，我已经在模板文件中内嵌了所有的参数。</p><p id="b95c" class="pw-post-body-paragraph iy iz hj ja b jb jc ik jd je jf in jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated"><strong class="ja hk">将二头肌与Azure DevOps相结合</strong></p><p id="2fde" class="pw-post-body-paragraph iy iz hj ja b jb jc ik jd je jf in jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">您可以编写一个YAML文件来使用Azure CLI部署Bicep模板。您可以将部署定义为Yaml文件中的一个任务，并从Azure管道中执行它。</p><figure class="jw jx jy jz fe ka es et paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="es et mo"><img src="../Images/b5ed29c20e7f918aa4051407c318bdf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A3k0BhX_qFBqtbOdZsKS5Q.png"/></div></div><figcaption class="kh ki eu es et kj kk bd b be z dy">YAML file to create a DevOps pipeline</figcaption></figure><p id="2d84" class="pw-post-body-paragraph iy iz hj ja b jb jc ik jd je jf in jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">然后，您可以使用Azure DevOps管道执行Bicep模板，该管道将返回您的订阅的Azure资源组中部署的资源的详细信息。</p><figure class="jw jx jy jz fe ka es et paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="es et mp"><img src="../Images/0f2fbe245c12d1d662bb1a5d361946d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3APs114AGVkstT1qXo4X9w.png"/></div></div><figcaption class="kh ki eu es et kj kk bd b be z dy">Azure DevOps pipeline for Bicep</figcaption></figure><p id="a16b" class="pw-post-body-paragraph iy iz hj ja b jb jc ik jd je jf in jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">来自Terraform的世界，我错过的事情之一是生成随机密码的选项。在Terraform中，我们有random_password，它可以解决我在参数文件中或作为变量硬编码密码的问题。在Bicep中，我没有发现任何问题，而且项目团队也不打算在短期内添加该功能。我还没有找到一个替代方案，如果你有一个，请对这个选项的故事进行评论。</p><p id="4ba7" class="pw-post-body-paragraph iy iz hj ja b jb jc ik jd je jf in jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated">请注意，这是我为了测试Azure Bicep是否适合作为企业基础设施的代码而进行的一次快速而肮脏的尝试。我花了几个小时编写一个模块和一个模板来创建一个虚拟网络、一个子网，并在该子网内部署一个存储帐户，我设法使代码非常通用。我很想听听你对蓝色二头肌的看法。你认为你会在你的堆栈中使用它吗？我准备这样做。</p><p id="07d3" class="pw-post-body-paragraph iy iz hj ja b jb jc ik jd je jf in jg jh ji jj jk jl jm jn jo jp jq jr js jt hc bi translated"><strong class="ja hk">参考</strong></p><ol class=""><li id="e348" class="ll lm hj ja b jb jc je jf jh me jl mf jp mg jt mq lr ls lt bi translated">Azure Bicep文档:<a class="ae ju" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/azure-resource-manager/Bicep/</a></li><li id="f7eb" class="ll lm hj ja b jb mh je mi jh mj jl mk jp ml jt mq lr ls lt bi translated">GitHub项目Azure Bicep:【https://github.com/Azure/bicep T2】T3</li></ol></div></div>    
</body>
</html>