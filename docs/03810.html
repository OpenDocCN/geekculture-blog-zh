<html>
<head>
<title>Re-Seed Your Heroku Database Everyday With One-Off Dynos</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">每天用一次性的Dynos重新播种你的Heroku数据库</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/re-seed-your-heroku-database-everyday-with-one-off-dynos-a77822052086?source=collection_archive---------59-----------------------#2021-06-15">https://medium.com/geekculture/re-seed-your-heroku-database-everyday-with-one-off-dynos-a77822052086?source=collection_archive---------59-----------------------#2021-06-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7e45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的<a class="ae jd" href="https://teapuddles.medium.com/seeding-a-rails-backend-with-an-external-api-1eb192271005" rel="noopener">上一篇博客</a>中，我讨论了如何从外部API中植入数据库。这对于从除了你自己的后端之外的来源获取信息来说是非常棒的，并且是构建许多项目的非常重要的工具。然而，一旦你把你的新项目推到Heroku上，会发生什么呢？如果您植入的信息不断更新(股票、每周销售额等)，该怎么办？你是否计划每天重置你的数据库，使你的网站信息保持最新？我的意思是，你当然可以，但从全局来看，这会给你和你的项目带来麻烦。输入Heroku dynos和一次性dynos。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jj jk l"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">No, not those dinos…dynos…</figcaption></figure><blockquote class="jp jq jr"><p id="2b56" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">Dynos是隔离的虚拟化Linux容器，旨在根据用户指定的命令执行代码- <a class="ae jd" href="https://www.heroku.com/dynos#:~:text=Dynos%3A%20the%20heart%20of%20the,simplify%20development%20and%20enhance%20productivity.&amp;text=The%20containers%20used%20at%20Heroku,on%20a%20user%2Dspecified%20command." rel="noopener ugc nofollow" target="_blank"> Heroku </a></p></blockquote><p id="59e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如上面提到的，dynos是装满代码的容器，这些代码根据用户指定的命令执行。这意味着对于任何规模的代码库，您都可以存储简化工作流程和提高生产率的代码。</p><p id="ff85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一次性动态代码是可执行的代码，我们可以用它来管理我们所有的管理和维护任务。播种我们的数据库属于这一类，但还有什么呢？根据Heroku网站，一次性dynos可用于以下用途:</p><ul class=""><li id="9dfd" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated">初始化数据库或运行数据库迁移。(例如<code class="du kf kg kh ki b">rake db:migrate</code>或<code class="du kf kg kh ki b">node migrate.js migrate</code>)</li><li id="b104" class="jw jx hi ih b ii kj im kk iq kl iu km iy kn jc kb kc kd ke bi translated">运行控制台或REPL外壳来运行任意代码，或者对照实时数据库检查应用程序的模型。(例如<code class="du kf kg kh ki b">rails console</code>、<code class="du kf kg kh ki b">irb</code>或<code class="du kf kg kh ki b">node</code>)</li><li id="53a4" class="jw jx hi ih b ii kj im kk iq kl iu km iy kn jc kb kc kd ke bi translated">提交到应用程序回购中的一次性脚本(例如<code class="du kf kg kh ki b">ruby scripts/fix_bad_records.rb</code>或<code class="du kf kg kh ki b">node tally_results.js</code>)。</li></ul></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><p id="9e64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于本指南，我们将重新播种我们的数据库，这属于第一类。此外，和前面的指南一样，我将使用Ruby on Rails。在我们开始之前，首先确保您已经完成了以下工作。</p><ul class=""><li id="e2a0" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated">将你的后台连接到一个Heroku站点。</li><li id="c00d" class="jw jx hi ih b ii kj im kk iq kl iu km iy kn jc kb kc kd ke bi translated">安装了gem ' <a class="ae jd" href="https://github.com/DatabaseCleaner/database_cleaner" rel="noopener ugc nofollow" target="_blank">数据库清理器</a></li><li id="92a1" class="jw jx hi ih b ii kj im kk iq kl iu km iy kn jc kb kc kd ke bi translated">在你的应用程序上安装Heroku调度程序(非常容易做到！点击这里链接<a class="ae jd" href="https://devcenter.heroku.com/articles/scheduler" rel="noopener ugc nofollow" target="_blank">的文件即可。一旦你设置好了，不要担心添加任何东西，我们会去做的。)</a></li></ul></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><p id="881e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经把所有的部分都整合在一起了，是时候构建一个一次性的dyno了！我们需要做的就是创建一个rake任务。为此，在/app/db/lib/tasks中创建一个名为<code class="du kf kg kh ki b">scheduler.rake</code>的文件。到了那里，您可以看看下面的代码。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es kv"><img src="../Images/5b661a0945cb2082f8225648e2266a07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aYDo7OpaRkk5plBGrEKojA.png"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx">Using ‘datbase-cleaner’, building a rake task that cleans our database is easy!</figcaption></figure><p id="0cbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个例子中，我创建了一个名为<code class="du kf kg kh ki b">:scheduled_tasks</code>的名称空间，它将成为我们希望调度到我们的调度器中的所有任务的标题。这样做有利于可伸缩性和易读性。</p><p id="4ab5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在描述了我们的rake任务将做什么之后，我们将创建我们的任务<code class="du kf kg kh ki b">:update_data</code>，它调用我们的“数据库清理器”gem来清理我们的数据库。</p><p id="3ef4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦清理完成，我们需要重新播种我们的数据库。幸运的是，因为<code class="du kf kg kh ki b">db:seed</code>已经是一个已知的rake任务，我们可以用<code class="du kf kg kh ki b">Rake::Task[“db:seed”].invoke</code>行调用它</p><p id="1917" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在继续之前，请确保将您的更改上传到您的Heroku站点。</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lc"><img src="../Images/5938bdc34e5a778b72ebe30417d4fef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*LTynKrdLKB8RdafXlesfiQ.png"/></div></figure><p id="0406" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们的rake任务已经构建好了，我们需要做的就是将它连接到我们的调度程序。如果您在安装时正确地遵循了说明，您应该会在Heroku主页上看到您正在运行的网站的调度程序。单击您的调度程序，并找到添加作业的选项。将弹出一个作业编辑器窗口，如下所示。</p><p id="57fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，您可以将我们构建的rake任务添加到我们的应用程序中。我们在这里所做的基本上是告诉Heroku在每天的某个时间运行我们构建的rake任务。</p><p id="fbb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置好之后，在rake任务应该运行的时间之后检查您的调度程序。您将能够看到它最后一次执行的时间。</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><p id="0392" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我真的很惊讶Heroku在他们的网站功能中内置了这样的东西，而且我真的很高兴我的应用程序可以提供新的日常信息。</p><p id="1670" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想看看那个项目，新冠肺炎追踪器，你可以在这里查看。</p></div></div>    
</body>
</html>