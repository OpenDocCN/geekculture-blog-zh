<html>
<head>
<title>Effortlessly Implement Location Picker like Ola and Uber in Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">毫不费力地实现位置选择器，如安卓系统中的奥拉和优步</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/implement-location-picker-like-ola-and-uber-in-android-effortlessly-1c3f7728f49?source=collection_archive---------2-----------------------#2021-08-09">https://medium.com/geekculture/implement-location-picker-like-ola-and-uber-in-android-effortlessly-1c3f7728f49?source=collection_archive---------2-----------------------#2021-08-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ad09d7fadb82a9c39b73751bde0c9559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MFkAs99HSSelVnb3eCq39w.gif"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Preview Of Location Pickers</figcaption></figure><p id="c4c5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们都遇到过这样的应用或想法，我们可能希望用户从地图上选择他们的位置。从UX的角度来看，<strong class="iw hj">选择一个位置比手动输入给定的字段</strong>更方便。</p><p id="f1f9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">另外，<strong class="iw hj">从开发者的角度来看</strong>精确定位用户有助于更精确地完成定位工作。</p></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><h1 id="a580" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">那么，如何实施呢？</h1><p id="a90b" class="pw-post-body-paragraph iu iv hi iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">嗯，<strong class="iw hj">这很简单</strong>，你只需要调用几个谷歌地图API，精确设置位置权限，并为位置选择器创建你的布局就可以了！！！</p><p id="97fb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">但是阅读上面的要点可能看起来有点多，但是如果你简明地遵循下面的所有步骤，你的实现<strong class="iw hj">将会像魔咒</strong>一样工作。</p><p id="c7ed" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要将谷歌地图添加到我们的应用程序中，我们需要<strong class="iw hj"> API密钥</strong>，要获取您的密钥，请参考这篇关于<a class="ae lc" href="https://developers.google.com/maps/documentation/android-sdk/start#enable-api-sdk" rel="noopener ugc nofollow" target="_blank"> Android谷歌地图集成</a>的博客。</p><p id="4ed2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">虽然某些权限部分可能看起来更长，但每当我们处理位置时，我们必须考虑所有可能发生或发生的极限情况，并满足每个权限，因为<em class="ld">位置被视为敏感权限之一</em> ( <strong class="iw hj">所以你必须忍受☹ </strong>)。</p><h1 id="4b2e" class="jz ka hi bd kb kc le ke kf kg lf ki kj kk lg km kn ko lh kq kr ks li ku kv kw bi translated">第一步:</h1><p id="6786" class="pw-post-body-paragraph iu iv hi iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated"><strong class="iw hj">将API密钥</strong>添加到您的清单文件中。在这里，我将我的密钥存储为一个字符串资源，您可以选择自己存储API密钥的方法。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="6275" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后将下面的依赖关系添加到您的<strong class="iw hj">应用程序级渐变文件</strong>。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><h1 id="5f23" class="jz ka hi bd kb kc le ke kf kg lf ki kj kk lg km kn ko lh kq kr ks li ku kv kw bi translated">第二步:</h1><p id="9d5e" class="pw-post-body-paragraph iu iv hi iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">让我们<strong class="iw hj">创建我们的UI </strong>来显示我们的位置选择器。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><blockquote class="lp lq lr"><p id="5dbe" class="iu iv ld iw b ix iy iz ja jb jc jd je ls jg jh ji lt jk jl jm lu jo jp jq jr hb bi translated">我们将在一个对话框中展开这个布局，这样我们就不必将用户带到一个不同的活动或片段。</p></blockquote><h1 id="d51b" class="jz ka hi bd kb kc le ke kf kg lf ki kj kk lg km kn ko lh kq kr ks li ku kv kw bi translated">第三步:</h1><p id="d1ba" class="pw-post-body-paragraph iu iv hi iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">让我们从按钮的<strong class="iw hj"> onClick事件调用这个函数来选择位置。</strong></p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="b772" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在接下来的步骤中，我们将实现我们上面调用的所有功能，以协调一切。</p><h1 id="1930" class="jz ka hi bd kb kc le ke kf kg lf ki kj kk lg km kn ko lh kq kr ks li ku kv kw bi translated">步骤4:设置权限</h1><p id="23d9" class="pw-post-body-paragraph iu iv hi iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">为了方便读者，我们将在<strong class="iw hj">的三个部分</strong>中实现这一步。</p><h2 id="8dca" class="lv ka hi bd kb lw lx ly kf lz ma mb kj jf mc md kn jj me mf kr jn mg mh kv mi bi">4.1</h2><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/018ac42ee1e21e99b95a371ec12302fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GNY6PjHxShlRFO44z1LPQg.png"/></div></div></figure><p id="6d6e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要获取用户设备的位置，请检查GPS是否已启用，如果未启用,<strong class="iw hj">会显示一条提示消息以启用GPS。</strong></p><p id="c610" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">提示看起来像这样。</p><p id="ac8b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们为我们的应用程序实现这一点。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><h2 id="8f27" class="lv ka hi bd kb lw lx ly kf lz ma mb kj jf mc md kn jj me mf kr jn mg mh kv mi bi">4.2</h2><p id="8683" class="pw-post-body-paragraph iu iv hi iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">现在，我们有了位置访问权限<strong class="iw hj">，我们将检查设备是否已经存储了任何以前的位置</strong>，如果没有，我们将预先获取这些位置，并将其显示在我们的选取器中。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><h2 id="6032" class="lv ka hi bd kb lw lx ly kf lz ma mb kj jf mc md kn jj me mf kr jn mg mh kv mi bi">4.3</h2><p id="1f60" class="pw-post-body-paragraph iu iv hi iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">在这里，我们在继续之前检查是否启用了所有其他位置权限，即清单或设备。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><h1 id="94fb" class="jz ka hi bd kb kc le ke kf kg lf ki kj kk lg km kn ko lh kq kr ks li ku kv kw bi translated">第五步:</h1><p id="0894" class="pw-post-body-paragraph iu iv hi iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">我们将重写两个方法来获得权限的回调。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><h1 id="aa4e" class="jz ka hi bd kb kc le ke kf kg lf ki kj kk lg km kn ko lh kq kr ks li ku kv kw bi translated">第六步</h1><p id="d57c" class="pw-post-body-paragraph iu iv hi iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">让我们设置对话框来显示选取器和保存位置。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="56cb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">预览应该是这样的。</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/a98214df78bde4964df97fe87f9c38e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*n4DC4Cr4vdy-1OLIJZlPKA.gif"/></div></div></figure><p id="59a9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这里，您可以获得用户位置的纬度和经度，并且可以对它执行任何想要执行的操作。</p><blockquote class="ml"><p id="31a6" class="mm mn hi bd mo mp mq mr ms mt mu jr dx translated"><em class="mv">对话框已经使用</em> <code class="du mw mx my mz b"><strong class="ak"><em class="mv">View binding</em></strong></code> <em class="mv">一个Jetpack库进行了膨胀。在这里阅读</em> <a class="ae lc" rel="noopener" href="/androiddevelopers/use-view-binding-to-replace-findviewbyid-c83942471fc#:~:text=findViewById%20is%20the%20source%20of%20many%20user-facing%20bugs,easy%20to%20ship%20code%20that%20calls%20findViewById%3CTextView%3E%20%28R.id.image%29"> <em class="mv">了解更多</em> </a> <em class="mv">。</em></p><p id="5129" class="mm mn hi bd mo mp mq mr ms mt mu jr dx translated">在左边，我们有上面我们写的代码的演示。</p></blockquote></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><h1 id="d4e9" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">现在我们有了地理点，如何从中获取地址呢？</h1><p id="e8fb" class="pw-post-body-paragraph iu iv hi iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">从开发人员的角度来看，保存地理点更有效，并且使用它来跟踪或测量点的距离。</p><p id="8f7d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">但是用户永远不会明白这些数字意味着什么，或者他们是否在地图上选择了正确的位置。</p><p id="9250" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以，这是个问题！☹</p><p id="70ac" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">如何兼顾开发者和用户，又不产生数据冗余？</strong></p><p id="ac32" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">幸运的是，Google用它的地理编码API帮助我们解决了这个问题，它给我们提供了地理点的位置或地址，可以存储在一个字符串中并显示给用户。</p><h1 id="11d0" class="jz ka hi bd kb kc le ke kf kg lf ki kj kk lg km kn ko lh kq kr ks li ku kv kw bi translated">下面是实现:</h1><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="fb79" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">GeoCoder类有许多方法来获取道路、城市、国家、邮政编码等。你可以在这里  <strong class="iw hj">阅读更多关于它的方法<a class="ae lc" href="https://developers.google.com/maps/documentation/geocoding/overview" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj">。</strong></a></strong></p><blockquote class="lp lq lr"><p id="3fe1" class="iu iv ld iw b ix iy iz ja jb jc jd je ls jg jh ji lt jk jl jm lu jo jp jq jr hb bi translated">在这里，如果您在获取地址时选择了海洋、河流、湖泊中的某个位置，您可以获得一个<code class="du mw mx my mz b">NULLPOINTER</code>，并且您应该通过检查<code class="du mw mx my mz b">addresses</code>的<strong class="iw hj">大小</strong>是否小于1来分别处理这种情况。</p></blockquote><p id="ef72" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">希望有所帮助。快乐编码😀</p><p id="2db6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在<a class="ae lc" href="https://github.com/Iltwats" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> GitHub </strong> </a>和<a class="ae lc" href="https://www.linkedin.com/in/1220atul/" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> LinkedIn </strong> </a>上和我联系，如果你喜欢构建一些很酷的app。</p></div></div>    
</body>
</html>