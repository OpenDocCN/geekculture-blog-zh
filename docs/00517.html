<html>
<head>
<title>Front-end Form Validation in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React中的前端表单验证</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/front-end-form-validation-in-react-33595dec8d6f?source=collection_archive---------10-----------------------#2021-02-23">https://medium.com/geekculture/front-end-form-validation-in-react-33595dec8d6f?source=collection_archive---------10-----------------------#2021-02-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/98486cf950698cb79d8205203ea5b2a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VsDHpmli1ySbjH2OAYSjww.jpeg"/></div></div></figure><p id="9675" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您需要构建一个连接到您的Rails API的React应用程序，您可能应该首先开始构建一个后端。首先构建后端并让它呈现您的数据是有意义的。您将需要一个数据库、控制器和模型。确保数据库只接受有效数据是一个很好的实践，因此我们需要添加验证，在Rails中，验证被添加到模型中。在我的特殊情况下，我需要向我的视频模型添加验证。我想确保数据库中的每个视频记录都有name、URL、category_id和brand_id字段。此外，我想确保数据库中没有重复的名称或URL，所以我需要验证名称和URL的唯一性。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="6134" class="jx jy hi jt b fi jz ka l kb kc">validates :name,:url, :category_id,:brand_id, presence: true<br/>validates :name,:url, uniqueness: true</span></pre><p id="18e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将上面的代码添加到我的视频模型将不允许我提交任何没有这些指定值的新视频，也不允许任何名称或URL重复。</p><p id="f106" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步是让我的控制器加速处理验证。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="669d" class="jx jy hi jt b fi jz ka l kb kc">def create<br/>        if video = Video.create(video_params)<br/>            render json: video<br/>        else<br/>            render json: video.errors.full_messages<br/>        end<br/>end</span></pre><p id="c72f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在创建的控制器将呈现新创建的视频，如果它通过验证，否则它将呈现错误，并带有描述这些错误的完整消息。所以尽管我们的Rails验证，我还是选择了不同的方法来处理React应用程序中的表单验证。</p><p id="bf00" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我没有在服务器/数据库级别处理验证，而是决定使用客户端验证。客户端验证的主要好处是更快的表单验证，因为我们不需要向服务器获取任何数据并等待响应。</p><p id="67ae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了处理错误，我将组件状态更新如下:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="580c" class="jx jy hi jt b fi jz ka l kb kc">state = {<br/>        name:'',<br/>        description:'',<br/>        url:'',<br/>        brandId:null,<br/>        categoryId:null,<br/>        errors: {<br/>            name:"* Required",<br/>            url:"* Required",<br/>            brandId:"Please select Brand, if can't find specific brand choose other",<br/>            categoryId:"Please select Category",<br/>        }<br/>    };</span></pre><p id="f2a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我的状态中，我现在有了错误值，我将使用它来验证表单并显示错误。</p><p id="b45e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在React中，我们需要确保当我们更新表单信息时，我们的状态也被更新，因为它们是相互关联的。我们通常会创建一个handleChange函数，它负责在每次表单中的数据发生变化时更新状态，同时我们也会更新状态中的错误消息。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="3500" class="jx jy hi jt b fi jz ka l kb kc">handleChange = (e) =&gt; {<br/>        const {name, value} = e.target;<br/>        let errors = this.state.errors;</span><span id="276a" class="jx jy hi jt b fi kd ka l kb kc">        switch (name) {<br/>            <br/>            case 'name': <br/>              if (value==='') {<br/>                  errors.name = "Name can't be blank!"<br/>              } else if (this.props.videos.find(video=&gt;video.name===value)) {<br/>                errors.name = "Video with this name exist!"<br/>              } else {<br/>                errors.name = ''<br/>              }<br/>              break;<br/>            case 'url': <br/>              if (value==='') {<br/>                  errors.url = "URL can't be blank!"<br/>              } else if (this.props.videos.find(video=&gt;video.url===value)) {<br/>                errors.url = "Video with this url exist!"<br/>              } else {<br/>                errors.url = ''<br/>              }<br/>              break;<br/>            default:<br/>              break;<br/>          }<br/>        <br/>          this.setState({errors, [name]: value})  <br/>    };</span></pre><p id="2ba8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">handleChange函数中的case状态为每个特定值声明一条错误消息，或者删除一条错误消息。</p><p id="62e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在表单提交时，我们需要验证表单中的数据是否有效，让我们创建一个表单验证器。它将检查是否有任何错误消息，并返回表单是否有效。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="33ab" class="jx jy hi jt b fi jz ka l kb kc">validateForm = (errors) =&gt; {<br/>        let valid = true;<br/>        Object.values(errors).forEach(value =&gt; {<br/>            value.length &gt; 0 &amp;&amp; (valid = false)<br/>        });<br/>        return valid;<br/>    }</span></pre><p id="67c9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们只需要在handleSubmit中添加validateForm函数，并检查表单是否有效。如果表单无效，我们还可以发送警告。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="e304" class="jx jy hi jt b fi jz ka l kb kc">handleSubmit = (e) =&gt; {<br/>        e.preventDefault();<br/>        if (this.validateForm(this.state.errors)) {<br/>            this.createNewVideo(this.state);<br/>        } else {<br/>            alert("Please fill in required fields")<br/>        }<br/>    };</span></pre><p id="f18d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在React中设置前端验证非常容易。它的工作速度很快，你不需要担心获取太多。</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><p id="6495" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以观看下面的快速演示，并在这里查看这个项目。</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="km kn l"/></div><figcaption class="ko kp et er es kq kr bd b be z dx">FixerTube Demo</figcaption></figure></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><p id="9c67" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请在以下社交网络上查看我，我很乐意收到您的来信！——<a class="ae kl" href="https://www.linkedin.com/in/nick-solonyy/" rel="noopener ugc nofollow" target="_blank"><em class="ks">LinkedIn</em></a><em class="ks">，</em> <a class="ae kl" href="https://github.com/nicksolony" rel="noopener ugc nofollow" target="_blank"> <em class="ks"> GitHub </em> </a>，<a class="ae kl" href="https://www.facebook.com/nick.solony" rel="noopener ugc nofollow" target="_blank"> <em class="ks">脸书</em> </a> <em class="ks">。</em></p></div></div>    
</body>
</html>