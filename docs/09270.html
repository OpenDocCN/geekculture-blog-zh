<html>
<head>
<title>How we created a fully automated newsletter for free</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们如何免费创建完全自动化的时事通讯</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-create-an-automated-newsletter-for-free-7522c5646b50?source=collection_archive---------8-----------------------#2021-12-03">https://medium.com/geekculture/how-to-create-an-automated-newsletter-for-free-7522c5646b50?source=collection_archive---------8-----------------------#2021-12-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="4c54" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">构建自动化时事通讯</h2><div class=""/><div class=""><h2 id="4ee4" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">你也可以</h2></div><p id="1aaa" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">本教程涵盖了如何开始一个免费的自动化通讯。要继续下去，你需要一个Github帐户和Python和Git的基础知识。</p><p id="ad62" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">我不想创建一个枯燥的代码列表，所以我把这个教程包装成一个真实的故事，是关于我和我的朋友Joris最近开始的一个风筝冲浪时事通讯。这也让我们对为什么这些特定的技术包含在本教程中有了一点了解。让我们开始吧。</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es kc"><img src="../Images/89a20e9b36862016c5e77fc09fd5cc02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qfbFndyM6CD4d-HSYfCLcQ.jpeg"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx">This tutorial covers how Github Actions, Python, and Gmail can be combined to create a free automated newsletter.</figcaption></figure></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><p id="9e6c" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">“WindSiren”，Joris开始说，“一个应用程序，当预报你附近有好的风筝冲浪天气时，它会给你一个通知。我想让我们建造它，你参加吗？”</p><p id="fc6a" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">我确实喜欢这个概念。它解决了一个特定的问题，很容易复制到其他运动中，很容易实现自动化，并且可以通过几种不同的方式实现货币化。</p><p id="e2af" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">但是，构建一个移动应用程序需要大量的前期编码工作，发布一个需要很多麻烦。<strong class="ji hs">没门。</strong>我们需要更简单的东西。</p><h1 id="2005" class="kz la hi bd lb lc ld le lf lg lh li lj ix lk iy ll ja lm jb ln jd lo je lp lq bi translated">选择创建简讯</h1><p id="cdf8" class="pw-post-body-paragraph jg jh hi ji b jj lr is jl jm ls iv jo jp lt jr js jt lu jv jw jx lv jz ka kb hb bi translated">基本上，我们只需要在天气条件好的时候向用户发送通知。没有手机应用我们也能做到这一点。</p><p id="15a1" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">在考虑了几个不同的通知选项后，我们出于几个原因选择了电子邮件:基本上，每个人都有一个电子邮件帐户(然而，例如在<a class="ae lw" href="https://www.theguardian.com/technology/2021/jan/24/whatsapp-loses-millions-of-users-after-terms-update" rel="noopener ugc nofollow" target="_blank"> WhatsApp上，情况就不再是这样了</a>)。通过代码发送电子邮件很容易(短信不会这么简单)。此外，还可以跟踪有多少用户打开了我们的时事通讯(我们最终做到了——但这是为了以后的文章)。</p><p id="ff17" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">要发送电子邮件，需要一个电子邮件提供商。我们选择了Gmail，主要是因为我们熟悉它，但也因为它是免费的，允许我们每天在T4发送500封电子邮件。</p><p id="f16b" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">自动访问Gmail需要Gmail网站以外的登录方式。为了快速测试，我们决定启用“<a class="ae lw" href="https://myaccount.google.com/u/2/lesssecureapps" rel="noopener ugc nofollow" target="_blank">不太安全的应用程序</a>”登录选项，允许我们的脚本使用电子邮件地址和密码登录Gmail帐户——但随着时间的推移，我们从未放弃这一选项。</p><p id="2891" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">如果你要开始一个时事通讯，<strong class="ji hs">一定要创建一个新的电子邮件帐户</strong>——你使用的电子邮件地址可能会出现在垃圾邮件列表中。我们不希望你的个人账户出现这种情况。</p><h2 id="8846" class="lx la hi bd lb ly lz ma lf mb mc md lj jp me mf ll jt mg mh ln jx mi mj lp ho bi translated">设置时事通讯就绪Gmail帐户的步骤</h2><p id="7c10" class="pw-post-body-paragraph jg jh hi ji b jj lr is jl jm ls iv jo jp lt jr js jt lu jv jw jx lv jz ka kb hb bi mk translated"><span class="l ml mm mn bm mo mp mq mr ms di"> 1 </span>创建新的Gmail帐户。该帐户将成为您未来简讯的“发件人”。</p><p id="edef" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi mk translated"><span class="l ml mm mn bm mo mp mq mr ms di"> 2 </span>点击<a class="ae lw" href="https://myaccount.google.com/u/2/lesssecureapps" rel="noopener ugc nofollow" target="_blank">此链接</a>为Gmail帐户启用“不太安全的应用程序”登录。</p><p id="b95a" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated"><em class="mt">此选项允许任何带有您的电子邮件地址和密码的脚本登录您的帐户。不过只要不跟任何人分享密码，应该是相对安全的。</em></p><h1 id="446f" class="kz la hi bd lb lc ld le lf lg lh li lj ix lk iy ll ja lm jb ln jd lo je lp lq bi translated">从Python发送电子邮件</h1><p id="d166" class="pw-post-body-paragraph jg jh hi ji b jj lr is jl jm ls iv jo jp lt jr js jt lu jv jw jx lv jz ka kb hb bi translated">对于我们的简讯，我们获取了阿姆斯特丹地区(我们位于荷兰)的天气预报，并在下周天气状况良好时发送电子邮件。</p><p id="495f" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">这个过程我们希望使用代码完全自动化。</p><p id="aaa6" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">因为Python是我的首选语言，它可以获取天气预报，发送电子邮件，并且受<em class="mt"> Github Actions </em>支持(稍后会有更多介绍)，所以我们选择它作为我们的脚本语言。</p><p id="a7e5" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">简而言之，我们使用Python字符串生成了一封HTML电子邮件(让它看起来更像✨)和一封基于文本的后备电子邮件(并不是所有的电子邮件阅读器都显示HTML)。然后，使用Gmail地址和密码，我们认证Python的<em class="mt"> smtplib- </em>库来使用我们的Gmail帐户。最后，我们循环所有订户的电子邮件地址，并将新生成的电子邮件发送给每个人。</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es mu"><img src="../Images/a4f897fc2e8a96d0bd5545f71e3b8305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zOv3Tv0STHOB9iyfVFzUlg.png"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx">WindSiren newsletter delivered on 1st of November. Quite minimal, but functional.</figcaption></figure><p id="eca6" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">用Python字符串编辑电子邮件很快就变得乏味了。我们改用<a class="ae lw" href="https://jinja.palletsprojects.com/en/3.0.x/" rel="noopener ugc nofollow" target="_blank"><em class="mt">jinja 2</em></a><em class="mt"/>模板，这大大改善了这种情况。但是使用Python字符串要容易得多，所以在这里我将坚持使用它们。</p><h2 id="7673" class="lx la hi bd lb ly lz ma lf mb mc md lj jp me mf ll jt mg mh ln jx mi mj lp ho bi translated">使用Python发送电子邮件的步骤</h2><p id="8385" class="pw-post-body-paragraph jg jh hi ji b jj lr is jl jm ls iv jo jp lt jr js jt lu jv jw jx lv jz ka kb hb bi mk translated"><span class="l ml mm mn bm mo mp mq mr ms di"> 1 </span>创建一个新的Python脚本和名为<em class="mt">的文件。env </em>在你的项目文件夹中。</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es mv"><img src="../Images/14c3d9ef3fb002933a781fbe4b9953bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*Gz9aHIIoqBIwXxUmWIwQwQ.png"/></div><figcaption class="ko kp et er es kq kr bd b be z dx">Visual Studio Code’s view of the project folder (called automated-newsletter) after creating .env and newsletter.py files.</figcaption></figure><p id="91f1" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi mk translated"><span class="l ml mm mn bm mo mp mq mr ms di"> 2 </span>使用下面的格式，将新的Gmail电子邮件地址和密码添加到。环境文件。</p><figure class="kd ke kf kg fd kh"><div class="bz dy l di"><div class="mw mx l"/></div><figcaption class="ko kp et er es kq kr bd b be z dx">Example content of the .env-file. Do change the address and password to match your new Gmail account.</figcaption></figure><p id="324a" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">拥有Gmail证书。env-file允许您方便地从您的计算机上运行电子邮件脚本。但是 <strong class="ji hs"> <em class="mt">不要</em> </strong> <em class="mt">将这个文件添加到Git中——任何有权访问您的存储库的人都可以读取它</em>。</p><p id="d822" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi mk translated"><span class="l ml mm mn bm mo mp mq mr ms di"> 3 </span>运行<em class="mt"> </em> <code class="du my mz na nb b">pip install python-dotenv</code>安装<em class="mt"> load_dotenv </em>库</p><p id="30f5" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi mk translated"><span class="l ml mm mn bm mo mp mq mr ms di"> 4 </span>使用load_dotenv从加载您的Gmail凭据。env-file到Python脚本。</p><figure class="kd ke kf kg fd kh"><div class="bz dy l di"><div class="mw mx l"/></div><figcaption class="ko kp et er es kq kr bd b be z dx">Loading environmental variables to Python script.</figcaption></figure><p id="ff11" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">很方便的是，os.getenv也加载了Github秘密——我们很快就会用到它们。</p><p id="4ad7" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi mk translated"><span class="l ml mm mn bm mo mp mq mr ms di"> 5 </span>创建(HTML)电子邮件。</p><figure class="kd ke kf kg fd kh"><div class="bz dy l di"><div class="mw mx l"/></div></figure><p id="78e4" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi mk translated"><span class="l ml mm mn bm mo mp mq mr ms di"> 6 </span>将你的Gmail凭证传递给smtplib，登录Gmail的SMTP<strong class="ji hs">(S</strong>imple<strong class="ji hs">M</strong>ail<strong class="ji hs">T</strong>transfer<strong class="ji hs">P</strong>rotocol)服务器，发送邮件。</p><figure class="kd ke kf kg fd kh"><div class="bz dy l di"><div class="mw mx l"/></div></figure><p id="9a17" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated"><em class="mt">最好首先将电子邮件发送给自己，A:查看电子邮件看起来是否正常，B:查看电子邮件是否被标记为垃圾邮件——这种情况最初发生在我们身上，但单击“</em> <strong class="ji hs"> <em class="mt">【标记为非垃圾邮件】</em> </strong> <em class="mt">”解决了这种情况，我们从此可以在收件箱中保持一致。</em></p><p id="13f3" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">下面是完整的Python脚本<strong class="ji hs">,它加载Gmail凭证，构造电子邮件，并向订阅者发送时事通讯。</strong></p><figure class="kd ke kf kg fd kh"><div class="bz dy l di"><div class="mw mx l"/></div><figcaption class="ko kp et er es kq kr bd b be z dx">Python script for constructing and sending the email. Change the email <strong class="ak">alternative </strong>and <strong class="ak">content </strong>to your content, and add subscriber emails to the <strong class="ak"><em class="nc">subscriber_email_addresses</em></strong> list.</figcaption></figure><h1 id="67b0" class="kz la hi bd lb lc ld le lf lg lh li lj ix lk iy ll ja lm jb ln jd lo je lp lq bi translated">自动发送电子邮件</h1><p id="0dc9" class="pw-post-body-paragraph jg jh hi ji b jj lr is jl jm ls iv jo jp lt jr js jt lu jv jw jx lv jz ka kb hb bi translated">因为我们希望项目造成的压力越小越好，所以我们希望我们的简讯脚本可以每天运行，而不用动一根手指。因此，我们求助于<em class="mt"> Github行动</em>。</p><p id="2491" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated"><a class="ae lw" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> Github Actions </a>是开发者自动测试和发布代码的工具。它们可以用来执行复杂且几乎任意的脚本，对我们来说重要的是，它们可以被配置成在设定的时间定期运行。该工具对公共存储库是免费的，私有存储库每月获得2000分钟的免费运行时间。这足以生成和发送每日简讯。</p><p id="0a89" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">每天早上7:15左右，我们的Github动作工作流醒来，并从我们的Github库签出我们的最新代码。它安装必要的需求并运行一个Python脚本，获取天气预报并将其消化成一个风筝冲浪时事通讯。</p><p id="9bbc" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">留给我的唯一事情是检查我的个人电子邮件，看工作流程中是否有任何失败。但是，在初始设置后，没有任何。见鬼，当Github Actions管理我们的项目时，我甚至在没有笔记本电脑的情况下进行了为期3周的旅行。真的让我很欣赏自动化。</p><h2 id="7d40" class="lx la hi bd lb ly lz ma lf mb mc md lj jp me mf ll jt mg mh ln jx mi mj lp ho bi translated">新闻稿自动化的步骤</h2><p id="3f98" class="pw-post-body-paragraph jg jh hi ji b jj lr is jl jm ls iv jo jp lt jr js jt lu jv jw jx lv jz ka kb hb bi mk translated"><span class="l ml mm mn bm mo mp mq mr ms di"> 1 </span>创建文件夹<em class="mt">。github </em>在你的项目文件夹的根目录下。在里面。github-folder创建另一个名为<em class="mt"> workflows </em>的文件夹，在里面创建一个名为<em class="mt"> newsletter.yml </em>的新文件。</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es nd"><img src="../Images/fd124bd92cbe97865474401560b716b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*LpdO-yMMmstjH7quySKanQ.png"/></div><figcaption class="ko kp et er es kq kr bd b be z dx">Visual Studio Code’s view of the project folder after creating newsletter.yml.</figcaption></figure><p id="3a8b" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated"><em class="mt">这个。这个特定文件夹中的yml文件存储了运行Github操作的指令。</em></p><p id="0646" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi mk translated"><span class="l ml mm mn bm mo mp mq mr ms di"> 2 </span>将下面的工作流复制到newsletter.yml，或者按照<a class="ae lw" href="https://docs.github.com/en/actions/learn-github-actions/events-that-trigger-workflows#scheduled-events" rel="noopener ugc nofollow" target="_blank"> Github的文档</a>创建一个cron触发的工作流。将newsletter.yml提交到您的Git。</p><figure class="kd ke kf kg fd kh"><div class="bz dy l di"><div class="mw mx l"/></div></figure><p id="4d32" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi mk translated"><span class="l ml mm mn bm mo mp mq mr ms di"> 3 </span>在Github存储库的设置中，进入“秘密”,将你的Gmail邮箱地址和密码添加为秘密。秘密的名称<strong class="ji hs">需要与您在Python脚本中使用<em class="mt"> os.getenv </em> </strong>加载的变量名相匹配。</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es ne"><img src="../Images/c738fdff1463a5bd423b3c6cdd3181d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L01Npp8W7HA1tGrPl2dPeg.png"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx">Here’s our secrets page. Yes, we use <a class="ae lw" href="https://openweathermap.org/api" rel="noopener ugc nofollow" target="_blank">OpenWeatherMap API</a> for fetching the weather reports. We had a good experience with their API.</figcaption></figure><p id="5436" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated"><em class="mt">将您的凭证存储在这里是安全的，因为您只能看到机密的名称，而不能看到存储在机密中的值。</em></p><p id="044d" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi mk translated"><span class="l ml mm mn bm mo mp mq mr ms di"> 4 </span>将你的项目文件夹推送到你的Github库。</p><p id="67db" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">瞧，你已经设置好了一份自动化的时事通讯。</p><h1 id="143f" class="kz la hi bd lb lc ld le lf lg lh li lj ix lk iy ll ja lm jb ln jd lo je lp lq bi translated">我们的时事通讯怎么了？</h1><p id="1a28" class="pw-post-body-paragraph jg jh hi ji b jj lr is jl jm ls iv jo jp lt jr js jt lu jv jw jx lv jz ka kb hb bi translated">我们希望在这个项目中实现数据驱动，所以我们决定跟踪有多少人打开了我们的时事通讯。我们创建了一个定制的解决方案来跟踪订阅者打开我们的时事通讯的频率。这就是我们开始积累一些“费用”的地方(嗯，谷歌云平台给你300美元的试用信用，所以不是真正的“费用”🤷‍♂️).</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es nf"><img src="../Images/5e063735e4833754a3e282a698356e21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F2IEbzFy5Amvs8DFtLaf0Q.png"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx">The percentage of users that opened the daily newsletter, with a rather clear downwards trend. Do people kitesurf in November? I don’t know, but I’d rather not spam the mailbox of our subscribers.</figcaption></figure><p id="e976" class="pw-post-body-paragraph jg jh hi ji b jj jk is jl jm jn iv jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">通过跟踪打开率，我们了解到越来越少的用户打开我们的简讯，由于我们的跟踪解决方案每月花费约50美元，被动收入的梦想并没有通过这个项目完全实现。所以至少在明年夏天之前，我们的时事通讯会处于冬眠状态。</p></div></div>    
</body>
</html>