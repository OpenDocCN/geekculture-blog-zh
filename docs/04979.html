<html>
<head>
<title>Docker Image Build Process for Novice</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">新手的Docker映像构建过程</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/docker-image-for-novice-b7ee891acb5e?source=collection_archive---------50-----------------------#2021-07-06">https://medium.com/geekculture/docker-image-for-novice-b7ee891acb5e?source=collection_archive---------50-----------------------#2021-07-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/15417120aac8115f90adafc07556bad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*azjitxP97VtpbOx3bdF6eg.png"/></div></div></figure><p id="c34f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将学习如何创建Node.js应用程序/服务的docker映像。已经有很多关于这个主题的文章，但是它们缺乏简单性。当我通过它们来创造我的第一个码头工人形象时。我意识到它们很复杂。但是制作Node.js应用程序的docker映像并不像看起来那么困难。</p><blockquote class="jo jp jq"><p id="db06" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated">Docker是一个开发、发布和运行应用程序的开放平台。Docker使您能够将应用程序从基础设施中分离出来，这样您就可以快速交付软件。</p></blockquote><p id="ea06" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我假设您已经掌握了使用Node.js的知识。代码可以参考这个<a class="ae jv" href="https://github.com/abhishek-asarawa/nodejs_docker" rel="noopener ugc nofollow" target="_blank">回购</a>。</p><p id="b234" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您开始学习Docker时，会出现两个主要术语</p><ol class=""><li id="f094" class="jw jx hi is b it iu ix iy jb jy jf jz jj ka jn kb kc kd ke bi translated">图像</li><li id="c1de" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">容器</li></ol><p id="67e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我们将学习图像。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="608d" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">什么是Docker图像？</h1><p id="7775" class="pw-post-body-paragraph iq ir hi is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">docker镜像是文件的<strong class="is hj">集合，将<strong class="is hj">配置</strong>一个完全可操作的<strong class="is hj">容器</strong>环境所需的所有要素(安装、应用程序代码和依赖项)捆绑在一起。简而言之，它捆绑了运行一个容器所需的所有文件。</strong></p><p id="f9df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了创造码头工人的形象，码头工人需要一本手册。这本手册叫做<strong class="is hj"><em class="jr">docker file</em></strong><em class="jr">。开发者只需要创建这个。听起来很酷！</em></p><p id="ee6b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们为我们的案例创建一个docker文件。</p><h1 id="bf29" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">创建Dockerfile文件</h1><p id="871a" class="pw-post-body-paragraph iq ir hi is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">Dockerfile包含创建图像所需的所有步骤和命令。</p><figure class="lz ma mb mc fd ij"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="9197" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我知道你在想什么…只有六行！创建docker图像并不难。但是决定这些线和优化docker图像需要时间。所以，让我们一条一条地理解这些台词。</p><h2 id="c616" class="mf ks hi bd kt mg mh mi kx mj mk ml lb jb mm mn lf jf mo mp lj jj mq mr ln ms bi translated">1.基础图像</h2><p id="61a6" class="pw-post-body-paragraph iq ir hi is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">Dockerfile中的第一行提到了一个基本图像。基础图像也称为<em class="jr">父图像。最初码头集装箱是空的。它不包含任何软件。</em></p><blockquote class="jo jp jq"><p id="3de7" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated">基本映像包括运行容器所需的所有必要软件。</p></blockquote><p id="386a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们的例子中，<em class="jr"> node:alpine </em>将确保我们可以运行一个node应用程序，因此它将添加node应用程序所需的所有必要文件/软件。所以我们什么都不用担心。</p><p id="8728" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jr">节点基图像有很多版本。你可以选择一个适合你的项目。你可以在这里查看节点基础图片</em><a class="ae jv" href="https://hub.docker.com/_/node" rel="noopener ugc nofollow" target="_blank"><em class="jr"/></a><em class="jr">。</em></p><h2 id="721c" class="mf ks hi bd kt mg mh mi kx mj mk ml lb jb mm mn lf jf mo mp lj jj mq mr ln ms bi translated">我为什么用node:alpine？</h2><p id="ec6c" class="pw-post-body-paragraph iq ir hi is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">在docker中，要让自己的形象尽可能的小。节点:删除所有不必要的文件/软件。它显著减小了节点图像大小。它也是针对节点应用程序优化的生产级映像。想要了解更多关于阿尔卑斯山的图片，你可以参考这篇文章。让我们转到文件的第二行。</p><h2 id="dc7d" class="mf ks hi bd kt mg mh mi kx mj mk ml lb jb mm mn lf jf mo mp lj jj mq mr ln ms bi translated">2.工作目录</h2><p id="dd1d" class="pw-post-body-paragraph iq ir hi is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated"><strong class="is hj"> WORKDIR </strong>命令在docker容器中定义一个工作目录。如果WORKDIR命令没有写入Docker文件，它将由Docker编译器自动创建。任何RUN，CMD，COPY，ADD和ENTERYPOINT命令都将被执行到指定的工作目录。为你的应用程序定义一个工作目录被认为是一个好的实践。这里，我们将/app指定为工作目录。</p><p id="a2f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从第三行到第五行，命令是相互连接的。它们与将我们的项目代码移动到容器中有关。</p><h2 id="946e" class="mf ks hi bd kt mg mh mi kx mj mk ml lb jb mm mn lf jf mo mp lj jj mq mr ln ms bi translated">3.<strong class="ak">应对文件进入Docker </strong></h2><p id="a41c" class="pw-post-body-paragraph iq ir hi is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">对于不同的语言，将项目移入docker是不同的。在node.js中，我们首先将package.json文件复制到docker，然后在安装所有包后，我们将复制app的其他文件。为什么？</p><p id="251f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我相信你会想为什么要增加线路？为什么不把所有文件都复制到一起，然后再安装包。这将删除一个额外的行。我来快速回答一下。</p><blockquote class="mt"><p id="0aef" class="mu mv hi bd mw mx my mz na nb nc jn dx translated">对于Dockerfile中写入的每一行，docker都会构建一个<strong class="ak">中间映像</strong>并将其保存在缓存中。</p></blockquote><p id="51b5" class="pw-post-body-paragraph iq ir hi is b it nd iv iw ix ne iz ja jb nf jd je jf ng jh ji jj nh jl jm jn hb bi translated">它这样做，所以下一次如果你建立图像，它将只是获取这些图像，并使用它。这使得构建图像非常快。这就是问题所在，记下台词和顺序。如果任何一行发生变化，docker将为这一行及其后的行创建中间图像。</p><blockquote class="jo jp jq"><p id="7a7f" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated">我们不断更新/更改应用程序文件，但我们很少更改pakcage.json。因此，如果我一次复制所有文件，那么即使package.json没有更改，代码的每次更改都会再次触发安装包，这将使构建docker映像变得缓慢。</p></blockquote><p id="a77d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了解决这个问题，我们遵循以下步骤</p><ol class=""><li id="0ddc" class="jw jx hi is b it iu ix iy jb jy jf jz jj ka jn kb kc kd ke bi translated">复制package.json</li><li id="ec7b" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">安装所有软件包</li><li id="9a4e" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">复制其他代码文件</li></ol><p id="c630" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后但同样重要的是…</p><h2 id="6fa0" class="mf ks hi bd kt mg mh mi kx mj mk ml lb jb mm mn lf jf mo mp lj jj mq mr ln ms bi translated">4.运行容器的命令</h2><p id="d149" class="pw-post-body-paragraph iq ir hi is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">CMD用于运行docker映像中包含的软件。对于节点应用程序，因为我们在index.js处有入口点，所以我们将使用命令<em class="jr"> node index.js </em>。这将在容器启动时立即启动我们的应用程序。</p><blockquote class="jo jp jq"><p id="c5ce" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated"><a class="ae jv" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#cmd" rel="noopener ugc nofollow" target="_blank"> CMD应遵循格式CMD ["executable "，" param1 "，" param2"…]。</a></p></blockquote><p id="f188" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在了解了Dockerfile中的每一行。但这只是一个食谱，不是一道菜。这些都是建立我们想要的形象所需要的步骤。现在让我们来看看如何构建这个非常简单的图像。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="5b3c" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">建立码头形象</h1><p id="46a1" class="pw-post-body-paragraph iq ir hi is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">为了构建docker图像，我们使用以下命令。</p><pre class="lz ma mb mc fd ni nj nk nl aw nm bi"><span id="dde9" class="mf ks hi nj b fi nn no l np nq">docker build .</span></pre><p id="a373" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Docker build命令需要一个Docker文件来构建映像。您必须在创建Dockerfile的目录级别使用上述命令。</p><p id="e413" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Docker为docker build命令提供了许多参数。解释这些命令将超出本文的范围。你可以在这里看到它们。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="b2b6" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">参考资料:</h1><ol class=""><li id="38e9" class="jw jx hi is b it lp ix lq jb nr jf ns jj nt jn kb kc kd ke bi translated"><a class="ae jv" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#general-guidelines-and-recommendations" rel="noopener ugc nofollow" target="_blank">https://docs . docker . com/develop/develop-images/docker file _ best-practices/# general-guidelines-and-suggestions</a></li><li id="0b67" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">【https://docs.docker.com/get-started/overview/ T4】</li></ol></div></div>    
</body>
</html>