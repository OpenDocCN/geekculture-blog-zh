<html>
<head>
<title>Create a Logbook For Your Excel Workbook Using Simple VBA Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用简单的VBA代码为您的Excel工作簿创建日志</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/create-a-logbook-for-your-excel-workbook-using-simple-vba-code-aa612cd4b3ba?source=collection_archive---------31-----------------------#2021-08-18">https://medium.com/geekculture/create-a-logbook-for-your-excel-workbook-using-simple-vba-code-aa612cd4b3ba?source=collection_archive---------31-----------------------#2021-08-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/364e7da18d2cffa26f3a8b0eae2f09ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vKplzg-aQ96i_p30-YeYPA.png"/></div></div></figure><p id="1bd7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">两周前，我的上一篇文章发表在freeCodeCamp上，现在是时候用世界上最可怕的编程语言来写一篇新的教程了。</p><p id="13f4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您在一个团队中工作，并且有多个成员使用同一组文档，那么维护一个记录打开或关闭某个工作簿的人员的工作表可能会很方便。虽然版本控制可能已经在某些云平台上帮了你很多，比如OneDrive，但VBA可以帮助你存储其他信息，这些信息可能与你更相关。</p><p id="c365" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我想让这个解释器尽可能的简单明了，来展示你如何使用简单的VBA代码来完成你想象不到的最简单的任务。为了阅读本教程，我不期望你有任何使用VBA或任何其他编程语言的经验，但它可能更容易理解某些方面。</p><h1 id="515c" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">准备我们的练习册</h1><p id="e224" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我们将首先打开一个新的工作簿，将初始工作表重命名为“Logbook ”,并为我们的日志定义一些标题，如图1所示。</p><p id="dfbe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程中，我将向您展示如何存储日期、用户和操作(无论工作簿是已关闭还是已打开)，但您可以在本教程的末尾使用您的新超能力随意添加自己的标题和数据。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/749b4be61bf7469a7afa270cf874439e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b4Wsj03D7ai2l9FckBv3Ww.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Figure 01: Logbook Worksheet</figcaption></figure><h2 id="6f74" class="lb jq hi bd jr lc ld le jv lf lg lh jz jb li lj kd jf lk ll kh jj lm ln kl lo bi translated">开发者标签</h2><p id="060c" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在我们开始编写代码之前，在您的Excel窗口中提供Developer选项卡是很重要的。关于如何在功能区中使用这些函数的快速提示，可以在本文开头的副标题为“如何使用Visual Basic for Applications构建宏”的文章中找到。</p><h1 id="1b03" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">编写VBA代码</h1><p id="8d8e" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">一旦您做好准备并打开Visual Basic编辑器，就该开始编写一些代码了。</p><p id="ab17" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了开始编写一个宏，你总是要从Sub关键字开始，Sub关键字是subroutine的缩写，它定义了一个函数的开始。如果你为你的宏输入一个名字，用两个圆括号结束并按下回车键，编辑器将以“End Sub”结束子程序。</p><p id="8c21" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">只有在我们输入了两个子关键字中的一些代码之后，宏才会开始执行一些操作，所以现在就开始吧。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="db04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我想在我们的日志工作表第二行的上方添加另一行。初始日志可能不需要这样做，但是可以防止您在以后的插入中覆盖数据。<br/>要这样做，我们可以调用Worksheets对象上的Rows对象，然后调用Insert方法，默认情况下只会在Rows对象中指定的行号之上添加一行。</p><p id="a7e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们有了一个清晰的行，我们可以开始添加实际的信息了。要更改单元格的值，可以直接使用Range对象，该对象将一个或多个单元格作为参数。<br/>由于Value属性是Range对象的默认属性，所以也不需要输入。但是为了方便起见，请理解这两行代码会做完全相同的事情。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="73a0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Now函数内置于Excel中，将返回设备的当前日期和时间。然后，这个时间戳被用作该列中下一个单元格的值。<br/>如果我们现在运行这个宏，将光标放在子程序中等待的地方，点击绿色箭头，您将看到数据被插入到您的日志工作表中。</p><h1 id="6311" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">添加动作数据</h1><p id="f6d2" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">但是，我们之前也定义了一个动作头，为什么我们不使用它呢？让我解释一下。<br/>此时，在数据实际添加到屏幕之前，用户必须手动运行宏。不过，为了防止人们忘记这一点，Excel想出了一些聪明的办法。他们想出了一个在打开和关闭工作簿时自动执行的功能。</p><p id="f629" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">尽管它们看起来像常规函数，但下面的两个宏将根据它们的名称在打开和关闭工作簿时执行。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="91a3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，后者包括一个参数。尽管我们现在不会使用它，但把它留在里面是很重要的，因为没有它你的程序会崩溃。</p><p id="d445" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">除了通过使用硬编码字符串添加动作之外，我们的宏并没有做太多改变。<br/>对于关闭宏，我们还添加了Save方法。这将保存工作簿，并且是一个位于ThisWorkbook对象上的方法。虽然就像前面的Value属性一样，ThisWorkbook是默认的，这意味着没有必要在我们的代码中包含它。省略Save关键字会提示用户他们是否真的想要保存他们的更改，我们希望忽略他们的偏好来跟踪工作簿的使用。</p><p id="26a3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您现在关闭并重新打开工作簿，应插入两行新内容，包括时间戳、您的用户名以及您是否打开或关闭了文档。</p><h1 id="2445" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">使用VBA函数重构</h1><p id="fa93" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">上面的代码应该很容易理解，即使你以前从未编写过代码。如果你有，你可以说我们在两个宏中都重复了很多。</p><p id="7162" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就像在许多其他编程语言中一样，我们可以定义一个可以在宏中调用的函数。如果我们想修改宏，我们不需要在几个地方修改，只需要在一个地方修改。</p><p id="f61b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要定义一个新函数，可以使用function而不是Sub关键字。给新定义的函数起一个你喜欢的名字，我选择写日志。如果在括号后再次按enter键，Excel将使用End Function完成函数定义。在这些括号之间，定义一个名为Action的参数，数据类型为string。复制function语句中以前使用的代码，并将单元格C2的值替换为参数Action。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="f5f7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们有了一个函数，可以用来插入一个新的日志，插入的动作取决于我们作为参数给出的字符串。</p><p id="3739" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要在调用一个函数时给出一个参数，你可以给这个参数命名，后跟:=和你想插入的值。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><h1 id="6b7e" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="0f81" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">上面的代码现在足以在每次关闭和打开工作簿时插入一个包含先前定义的信息的新行。</p><p id="1d88" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">恭喜你，你现在已经用VBA在Excel中为自己制作了一个自动日志！</p><p id="96b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请随意试验这段代码，添加您自己的信息，如果您喜欢本教程，请不要忘记留下一点掌声。</p></div></div>    
</body>
</html>