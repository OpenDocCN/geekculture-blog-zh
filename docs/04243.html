<html>
<head>
<title>Phoenix: Understanding how to seed data.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Phoenix:了解如何播种数据。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/phoenix-understanding-how-to-seed-data-c2be863ddd1d?source=collection_archive---------10-----------------------#2021-06-23">https://medium.com/geekculture/phoenix-understanding-how-to-seed-data-c2be863ddd1d?source=collection_archive---------10-----------------------#2021-06-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9491" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">利用测试夹具，如玛奇纳和Faker来创建高质量的测试和开发数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/ebe0f406ed9c8c6e12fd699954e99a04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RGkPwcQs3QTDRY8u7FqzIA.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://www.pexels.com/@binyaminmellish?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Binyamin Mellish</a> from <a class="ae jt" href="https://www.pexels.com/photo/man-planting-plant-169523/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><h2 id="d950" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">什么是播种？</h2><p id="0ac8" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">播种是数据库中数据的初始创建，通常在测试之前运行，或者创建一个方便的开发人员或QA测试环境。但是，您也可以在生产或其他环境中播种。</p><h2 id="7dc6" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">你为什么要在乎？</h2><p id="1372" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">通过学习如何有效地创建种子数据，您可以极大地提高测试的可靠性、可重用性和可读性。</p><p id="52a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更重要的是，您将提高开发周期的速度和质量，以发布更多的功能和更少的错误。</p><h1 id="4dc2" class="ku jv hi bd jw kv kw kx ka ky kz la ke lb lc ld kh le lf lg kk lh li lj kn lk bi translated">使用<a class="ae jt" href="https://github.com/BrooklinJazz/phoenix_seeding" rel="noopener ugc nofollow" target="_blank">的示例博客应用</a></h1><p id="eb99" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">以下所有概念和示例都可以应用于任何phoenix应用程序。如果您愿意，可以在<a class="ae jt" href="https://github.com/BrooklinJazz/phoenix_seeding" rel="noopener ugc nofollow" target="_blank">示例博客应用程序中看到所有的代码示例。</a></p><h1 id="56f0" class="ku jv hi bd jw kv kw kx ka ky kz la ke lb lc ld kh le lf lg kk lh li lj kn lk bi translated">全局种子数据</h1><p id="be72" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">在任何使用mix生成的phoenix应用程序中，都应该有一个<code class="du ll lm ln lo b">seed.exs</code>文件。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/e54e3b2e4b851a06e594566e4e17dee7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EMluhu87PpYX8l_HTptgCw.png"/></div></div></figure><p id="1985" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以在这个文件中创建您想要在所有测试或开发环境中预先存在的数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lq"><img src="../Images/991b75f2453514e21daafb9e9da6e903.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KBEJaaG9eBa4hCdDXTaOCg.png"/></div></div></figure><p id="7330" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意<code class="du ll lm ln lo b">Repo.delete_all(Post)</code>线。除非您希望种子文件反复重新创建现有数据，否则您可能需要考虑删除任何已经存在的数据，以便种子数据保持一致。</p><p id="e1a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用以下方式运行种子文件:</p><pre class="je jf jg jh fd lr lo ls lt aw lu bi"><span id="269f" class="ju jv hi lo b fi lv lw l lx ly">mix run priv/repo/seeds.exs</span></pre><p id="68a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使您在运行种子数据时处于正确的环境中。</p><pre class="je jf jg jh fd lr lo ls lt aw lu bi"><span id="da6c" class="ju jv hi lo b fi lv lw l lx ly"># on mac or linux:<br/>MIX_ENV="test" mix run priv/repo/seeds.exs # for test env<br/>MIX_ENV="dev" mix run priv/repo/seeds.exs # for dev env</span><span id="6573" class="ju jv hi lo b fi lz lw l lx ly"># On windows you'll have to set the env first using either: $env:MIX_ENV="test"<br/>$env:MIX_ENV="dev"</span><span id="0f70" class="ju jv hi lo b fi lz lw l lx ly"># then run the seed command like normal<br/>mix run priv/repo/seeds.exs</span></pre><h2 id="0f1d" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">配置不同的测试和开发种子文件。</h2><p id="7bdb" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated"><code class="du ll lm ln lo b">seed.exs</code>文件被自动配置为以<code class="du ll lm ln lo b">mix ecto.setup</code>别名运行。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ma"><img src="../Images/b5005f5402233c29284a1ab82dbfb805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RZoG1me9qxgPlXa7X9_llw.png"/></div></div></figure><p id="2634" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以根据您所处的环境使用<code class="du ll lm ln lo b">Mix.env()</code>变量为您的全局种子文件配置不同的行为。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mb"><img src="../Images/ae8acd38435fe2d8a3c1e12def0a24bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fDJjCsCCxI2MxbuVP2z8MQ.png"/></div></div></figure><p id="bfef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想在测试中使用这个全局数据，您可以将运行种子文件的命令添加到您的<code class="du ll lm ln lo b">mix test</code>别名中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mc"><img src="../Images/71eb7565e1315e94c6a09a82f8ed0a50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PilOTjqNku8jtQeBHLvfnw.png"/></div></div></figure><h2 id="c5d6" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">制作其他种子文件。</h2><p id="48b9" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated"><code class="du ll lm ln lo b">seed.exs</code>文件没有什么特别之处，这样您就可以创建其他种子文件。在这个blog应用程序示例中，您可能想要一个不同的种子文件来为您添加五篇文章。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/0aa93f4031ebdf4aa0c4f35c0ff7181f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cp1WU0Tt_7tiJ0X-FiYySg.png"/></div></div></figure><p id="b151" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用以下命令运行该文件:</p><pre class="je jf jg jh fd lr lo ls lt aw lu bi"><span id="178f" class="ju jv hi lo b fi lv lw l lx ly">mix run .\priv\repo\five_blog_posts.exs</span></pre><h1 id="c5b6" class="ku jv hi bd jw kv kw kx ka ky kz la ke lb lc ld kh le lf lg kk lh li lj kn lk bi translated">使用Faker的真实假数据。</h1><p id="8069" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated"><a class="ae jt" href="https://github.com/elixirs/faker" rel="noopener ugc nofollow" target="_blank"> Faker </a>是一个用于创建虚假数据的药剂库。当您想要创建真实的数据来测试您的应用程序时，这很有用。例如，在<a class="ae jt" href="https://github.com/BrooklinJazz/phoenix_seeding" rel="noopener ugc nofollow" target="_blank">演示博客应用程序</a>中，生成长、中和短内容会很方便。</p><ul class=""><li id="2cc5" class="me mf hi ih b ii ij im in iq mg iu mh iy mi jc mj mk ml mm bi translated">安装<a class="ae jt" href="https://github.com/elixirs/faker" rel="noopener ugc nofollow" target="_blank"> Faker </a>:很可能你必须在你的mix依赖项中添加以下的最新版本:</li></ul><pre class="je jf jg jh fd lr lo ls lt aw lu bi"><span id="d7ff" class="ju jv hi lo b fi lv lw l lx ly">{:faker, "~&gt; 0.16", only: :test}</span></pre><p id="429a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Faker建议您在测试环境中只安装faker模块。然而，因为我们正在为开发测试播种数据，所以您可能也希望为开发环境提供数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mn"><img src="../Images/bb49584a7a2cf2476ac2807813d26db0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PnCvgVleo30CukYO4ELFmQ.png"/></div></div></figure><p id="f2fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Faker上的安装步骤也可能会要求将<code class="du ll lm ln lo b">Faker.start()</code>添加到test_helper文件中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mo"><img src="../Images/79592848a76fe209e9548eb22c84ff06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*px--9Jzqbiuc-wnuxZGIAQ.png"/></div></figure><p id="dc54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行<code class="du ll lm ln lo b">mix deps.get.</code>确保安装了faker依赖项</p><p id="0d0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦安装了Faker，你就可以用它方便地生成假数据。我将介绍最有用的模块，但是如果你想了解Faker能做的一切，请查看它们的文档。</p><h2 id="a929" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">Faker Lorem</h2><p id="981f" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">生成单词、句子和段落，完全控制内容的大小。Lorem是“Lorem Ipsum”的简称，是一种常见的生成假文本的方式。</p><pre class="je jf jg jh fd lr lo ls lt aw lu bi"><span id="0d99" class="ju jv hi lo b fi lv lw l lx ly">alias Faker.Lorem </span><span id="b396" class="ju jv hi lo b fi lz lw l lx ly"># fake word with 5 characters<br/>Lorem.characters(5) <br/># fake word with between 5 to 10 characters<br/>Lorem.characters(5..10)</span><span id="fee4" class="ju jv hi lo b fi lz lw l lx ly"># fake sentence with 5 words<br/>Lorem.sentence(5)<br/># fake sentence with between 5 to 10 words<br/>Lorem.sentence(5..10)</span><span id="0a87" class="ju jv hi lo b fi lz lw l lx ly"># fake paragraph with 5 sentences<br/>Lorem.paragraph(5)<br/># fale paragraph with 5 to 10 sentences<br/>Lorem.paragraph(5..10)</span><span id="4350" class="ju jv hi lo b fi lz lw l lx ly"># fake list with 5 paragraphs joined in a string<br/>Lorem.paragraphs(5) |&gt; Enum.join("\n")<br/># fake list with between 5 to 10 paragraphs joined in a string<br/>Lorem.paragraphs(5..10) |&gt; Enum.join("\n")</span></pre><p id="6f97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以用它来改进之前的<code class="du ll lm ln lo b">five_blog_posts.exs</code>种子文件。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mp"><img src="../Images/49f42c6ec13e37d67f6d1ef02fa8672a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9aHnGVcxxKHnDe4VqvZmLQ.png"/></div></div></figure><h2 id="9bc0" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">骗子</h2><p id="6dc2" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">为某人生成姓名</p><pre class="je jf jg jh fd lr lo ls lt aw lu bi"><span id="17a9" class="ju jv hi lo b fi lv lw l lx ly">alias Faker.Person</span><span id="4331" class="ju jv hi lo b fi lz lw l lx ly">Person.first_name() "Elizabeth"<br/>Person.last_name() "Hayes"<br/>Person.name() "Mr. Bianka Ryan"<br/>Faker.Person.prefix() "Mr."<br/>Faker.Person.title() "Dynamic Identity Administrator"</span></pre><h2 id="f5a1" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">伪造者地址</h2><p id="0228" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">生成伪真实地址</p><pre class="je jf jg jh fd lr lo ls lt aw lu bi"><span id="e907" class="ju jv hi lo b fi lv lw l lx ly">alias Faker.Address</span><span id="d18d" class="ju jv hi lo b fi lz lw l lx ly">Address.country() # "Gibraltar"<br/>Address.state() # "Kansas"<br/>Address.city() # "East Casey"<br/>Address.postcode() # "84979"</span></pre><h2 id="4e8c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">Faker互联网</h2><p id="afe3" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">生成与互联网相关的数据，如电子邮件、图像、链接、用户名和IP地址</p><pre class="je jf jg jh fd lr lo ls lt aw lu bi"><span id="463f" class="ju jv hi lo b fi lv lw l lx ly">Faker.Internet.email() "elizabeth2056@rolfson.net"<br/>Faker.Internet.image_url() "https://placehold.it/936x936"<br/>Faker.Internet.url() "http://sipes.com"<br/>Faker.Internet.user_name() "elizabeth2056"</span></pre><h1 id="aba5" class="ku jv hi bd jw kv kw kx ka ky kz la ke lb lc ld kh le lf lg kk lh li lj kn lk bi translated">定制测试夹具模块和测试夹具功能</h1><p id="cd29" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">当您第一次创建phoenix上下文时，您会得到测试夹具功能来帮助您进行测试。</p><p id="96fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，当您运行:</p><pre class="je jf jg jh fd lr lo ls lt aw lu bi"><span id="5b72" class="ju jv hi lo b fi lv lw l lx ly">mix phx.gen.html Posts Post posts title:string content:text</span></pre><p id="2f69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将生成一个如下所示的文件。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mq"><img src="../Images/9ed5dc3fe140db97d7e0922a0d83574e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v0yheWefwAE9llzPz8HhLQ.png"/></div></div></figure><p id="a618" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">测试夹具函数是为同一个测试文件的本地测试创建一些数据的好方法。</p><p id="f5b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ll lm ln lo b">post_fixture</code>函数创建一个帖子，以便您可以测试Posts.list_posts()函数。更好的是，只为这个测试而不是其他测试创建数据。所以对其他测试没有副作用，导致测试交互很难调试。</p><h2 id="3815" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">重用测试夹具功能</h2><p id="08b8" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">这很好，但是如果您有另一个需要post_fixture的测试文件呢？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mr"><img src="../Images/bc5194f71040d564c2894aaa587a1e65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-T3yEvKn5iaWMChfEU4EiA.png"/></div></div></figure><p id="73a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">重写这个会有很多重复！重用测试夹具功能的一个简单方法是将它们移动到一个单独的测试夹具模块中，您可以在您的测试文件中<code class="du ll lm ln lo b">use</code>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/ad3c9aa88cc1a39df126ff0c78739ed6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g832UkIXbs8mCgYwD9wUkA.png"/></div></div></figure><p id="9682" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后<code class="du ll lm ln lo b">use</code>在您想要访问<code class="du ll lm ln lo b">@valid_attrs, @update_attrs, or @invalid_attrs</code>值或<code class="du ll lm ln lo b">post_fixture</code>函数的任何文件中添加后缀。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mt"><img src="../Images/8003195f1c18b6d274abf209ac363f0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*3tvjpEtQVRHZsKVwJ34qng.png"/></div></figure><p id="046b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于<code class="du ll lm ln lo b">use</code>和<code class="du ll lm ln lo b">__using__</code>的解释，请查看<a class="ae jt" href="https://elixirschool.com/en/lessons/basics/modules/#use" rel="noopener ugc nofollow" target="_blank">仙丹学校的课程</a>。</p><h1 id="565c" class="ku jv hi bd jw kv kw kx ka ky kz la ke lb lc ld kh le lf lg kk lh li lj kn lk bi translated">使用Ex玛奇纳的工厂</h1><p id="1f4f" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">如果使用您自己的定制测试夹具和Faker数据还不够，您可以考虑使用Ex玛奇纳elixir库作为一个方便的测试数据基础设施。请注意，Ex玛奇纳使用术语“工厂”而不是“夹具”。</p><ul class=""><li id="6d9f" class="me mf hi ih b ii ij im in iq mg iu mh iy mi jc mj mk ml mm bi translated"><a class="ae jt" href="https://github.com/thoughtbot/ex_machina" rel="noopener ugc nofollow" target="_blank">安装Ex玛奇纳</a>:遵循回购安装说明，了解最新的安装步骤。</li></ul><h2 id="912e" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">玛奇纳工厂交货模块</h2><p id="905a" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">一旦您安装了Ex玛奇纳，您将需要设置一个工厂模块。<br/>工厂模块将<code class="du ll lm ln lo b">use</code>ExMachina模块。</p><pre class="je jf jg jh fd lr lo ls lt aw lu bi"><span id="66d4" class="ju jv hi lo b fi lv lw l lx ly">defmodule Blog.Factory do<br/>     use ExMachina.Ecto, repo: Blog.Repo<br/>end</span></pre><h2 id="7714" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">玛奇纳工厂交货功能</h2><p id="4e5d" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">工厂模块包含的工厂函数必须以<code class="du ll lm ln lo b">_factory</code>结尾，这是由于Ex玛奇纳的工作方式。</p><pre class="je jf jg jh fd lr lo ls lt aw lu bi"><span id="018a" class="ju jv hi lo b fi lv lw l lx ly">def post_factory do<br/>    %Post{<br/>      title: Example Title,<br/>      content: "Example Content"<br/>    }<br/>end</span></pre><p id="7f79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">工厂函数也可以使用<code class="du ll lm ln lo b">struct!</code>从其他工厂函数中派生出来</p><pre class="je jf jg jh fd lr lo ls lt aw lu bi"><span id="6275" class="ju jv hi lo b fi lv lw l lx ly"># derived factory<br/>  def long_post_factory do<br/>    struct!(<br/>      post_factory(),<br/>      %{<br/>        content: Faker.Lorem.paragraphs(5..10) |&gt; Enum.join("\n")<br/>      }<br/>    )<br/> end</span></pre><h2 id="a3ba" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">顺序</h2><p id="bb88" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">Ex玛奇纳提供了<code class="du ll lm ln lo b">sequence</code>函数，用于在每次调用工厂函数时递增您提供的字符串或列表。</p><pre class="je jf jg jh fd lr lo ls lt aw lu bi"><span id="0aae" class="ju jv hi lo b fi lv lw l lx ly">sequence("Name") # Name0<br/>sequence("Name") # Name1</span></pre><p id="fedb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ll lm ln lo b">sequence</code>也可以用一个原子和一个列表来调用，以循环遍历一个值列表。</p><pre class="je jf jg jh fd lr lo ls lt aw lu bi"><span id="de40" class="ju jv hi lo b fi lv lw l lx ly">sequence(:role, ["admin", "member", "superuser"]) # admin<br/>sequence(:role, ["admin", "member", "superuser"]) # member<br/>sequence(:role, ["admin", "member", "superuser"]) # superuser</span></pre><h2 id="5103" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">插入</h2><p id="2cbd" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">在您的测试或种子文件中，这些工厂函数可以与Ex玛奇纳提供的<code class="du ll lm ln lo b">insert</code>函数一起使用。<code class="du ll lm ln lo b">insert </code>以一个原子作为自变量。原子应该匹配<code class="du ll lm ln lo b">_factory</code>前的函数名。比如<code class="du ll lm ln lo b">post_factory</code>和<code class="du ll lm ln lo b">:post</code>一起用。</p><pre class="je jf jg jh fd lr lo ls lt aw lu bi"><span id="1803" class="ju jv hi lo b fi lv lw l lx ly">insert(:post) #  inserts  %Blog.Posts.Post{<br/>                __meta__: #Ecto.Schema.Metadata&lt;:built,"posts"&gt;,<br/>                title: "Example Title0",<br/>                content: "Example Content0",<br/>                inserted_at: nil,<br/>                updated_at: nil<br/>              } into the database</span></pre><h1 id="de7b" class="ku jv hi bd jw kv kw kx ka ky kz la ke lb lc ld kh le lf lg kk lh li lj kn lk bi translated">把所有的放在一起</h1><p id="e0b3" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">把你学到的关于Ex玛奇纳、测试夹具和Faker的所有东西放在一起，这里有一个示例工厂和在测试中的使用。</p><h2 id="93da" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">定义工厂</h2><p id="67f0" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">请注意，<code class="du ll lm ln lo b">sequence</code>可以接受您想要的任何值的列表。在这种情况下，我使用Faker和<code class="du ll lm ln lo b"> sequence</code>在长、中和短内容之间循环。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mu"><img src="../Images/0e11677d7b30e9caae156adf9a4c92a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9VPuYqv0MJxAIZFId-mqDA.png"/></div></div></figure><h2 id="31a5" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">创建一个工厂测试</h2><p id="ae97" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">将工厂导入到您的测试文件中，以访问Ex玛奇纳提供的<code class="du ll lm ln lo b">insert</code>功能。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mv"><img src="../Images/4c06d8fd071d8fb304abe3d92a9d049a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wqW2G8TGO9ogNclGjTAYUQ.png"/></div></div></figure><h1 id="5d9e" class="ku jv hi bd jw kv kw kx ka ky kz la ke lb lc ld kh le lf lg kk lh li lj kn lk bi translated">结论</h1><p id="aa26" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">您已经学会了通过利用定制的测试夹具模块、测试夹具函数(例如玛奇纳和Faker)来提高phoenix数据播种的可靠性、可重用性和可读性。</p><p id="7828" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望你觉得这篇文章很有用，并乐于将你学到的东西应用到你的下一个或当前项目中。</p><p id="a4b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您有任何问题或意见，请通过张贴回复让我知道；我很乐意回复你！</p><h2 id="9382" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">进一步阅读</h2><ul class=""><li id="0681" class="me mf hi ih b ii kp im kq iq mw iu mx iy my jc mj mk ml mm bi translated"><a class="ae jt" href="https://github.com/thoughtbot/ex_machina" rel="noopener ugc nofollow" target="_blank">玛奇纳交货回购</a>和<a class="ae jt" href="https://hexdocs.pm/ex_machina/ExMachina.html" rel="noopener ugc nofollow" target="_blank">玛奇纳交货单据</a></li><li id="387d" class="me mf hi ih b ii mz im na iq nb iu nc iy nd jc mj mk ml mm bi translated"><a class="ae jt" href="https://hexdocs.pm/phoenix/1.3.0-rc.1/seeding_data.html" rel="noopener ugc nofollow" target="_blank">凤凰播种数据文档</a></li><li id="795c" class="me mf hi ih b ii mz im na iq nb iu nc iy nd jc mj mk ml mm bi translated"><a class="ae jt" href="https://hexdocs.pm/faker/api-reference.html" rel="noopener ugc nofollow" target="_blank">伪造文件</a></li><li id="dc2c" class="me mf hi ih b ii mz im na iq nb iu nc iy nd jc mj mk ml mm bi translated"><a class="ae jt" href="https://github.com/BrooklinJazz/phoenix_seeding" rel="noopener ugc nofollow" target="_blank">使用Faker和Ex玛奇纳的博客应用示例</a></li></ul></div></div>    
</body>
</html>