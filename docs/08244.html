<html>
<head>
<title>How to forecast sales with advertising spend in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用R中的广告支出预测销售额</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-forecast-sales-with-advertising-spend-in-r-36e6fc99760a?source=collection_archive---------2-----------------------#2021-10-21">https://medium.com/geekculture/how-to-forecast-sales-with-advertising-spend-in-r-36e6fc99760a?source=collection_archive---------2-----------------------#2021-10-21</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><p id="69db" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">你如何在销售预测中纳入不同的月度广告水平？</p><figure class="jg jh ji jj fe jk es et paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="es et jf"><img src="../Images/532b64703eff93755d99097a61b90b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TfzUJXd2aBS9qkN2kZD7vQ.png"/></div></div><figcaption class="jr js eu es et jt ju bd b be z dy">It takes money to make money! Or does it?</figcaption></figure></div><div class="ab cl jv jw gq jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hc hd he hf hg"><p id="d1ac" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">基于历史数据的销售预测对于任何企业来说都是一个重要且关键的过程。回归对于预测构建非常有用，因为您可以根据独立的因素(如时间)来预测数字输出。但是，如果您想在预测中添加额外的独立变量，如广告支出，该怎么办呢？出现了<strong class="ii hk">动态回归模型。</strong></p><p id="04c1" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">除了数据的历史，动态回归模型还考虑了其他因素。线性回归和动态回归的区别在于误差项是一个<strong class="ii hk">【ARIMA】</strong>的自回归综合移动平均过程。ARIMA模型是一种预测技术，通常提供准确的预测数据，这些数据涉及影响因变量(销售)的多个自变量(广告)。</p><p id="f5c2" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我会用动态回归法预测销售情况，并把广告考虑在内。这个数据集来自Wayne L. Winston的《营销分析:使用Microsoft Excel的数据驱动技术》的第34章。它包含一种减肥产品36个月的销售数据。</p><p id="d653" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我们的数据集有3个变量:</p><ol class=""><li id="4c16" class="kc kd hj ii b ij ik in io ir ke iv kf iz kg jd kh ki kj kk bi translated">月</li><li id="831b" class="kc kd hj ii b ij kl in km ir kn iv ko iz kp jd kh ki kj kk bi translated">销售额(千美元)</li><li id="2db4" class="kc kd hj ii b ij kl in km ir kn iv ko iz kp jd kh ki kj kk bi translated">广告支出(千美元)</li></ol><p id="d572" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">但是在我们深入研究之前，我们需要理解一些关于时间序列数据行为的概念。时间序列数据可以包含特定的模式，包括:</p><p id="7029" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated"><strong class="ii hk">趋势</strong> —观察值随时间增加或减少。<br/> <strong class="ii hk">季节性</strong> —观察值显示日历周期(如季度、月、年等)。<br/> <strong class="ii hk">循环</strong> —观察值上升和下降，但不是由于固定的周期。<br/> <strong class="ii hk">静止的或固定的</strong> —观察不显示任何趋势或季节性。换句话说，没有可预测的模式。</p><p id="bdc1" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">其他需要了解的重要时间序列概念有:</p><p id="6162" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated"><strong class="ii hk">白噪声</strong> —完全随机的时间序列数据。</p><p id="e362" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated"><strong class="ii hk">永格盒测试</strong> —确定数据是否为白噪声的显著性测试。较小的p值表明数据可能不是白噪声。</p><h1 id="6b54" class="kq kr hj bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">浏览数据集</h1><p id="7043" class="pw-post-body-paragraph ig ih hj ii b ij lo il im in lp ip iq ir lq it iu iv lr ix iy iz ls jb jc jd hc bi translated">让我们了解一下数据，我们将运行psych包中的describe()函数。这一步很好地总结了我们的数据集。</p><pre class="jg jh ji jj fe lt lu lv lw aw lx bi"><span id="0a0a" class="ly kr hj lu b fj lz ma l mb mc">#Use describe function from psych package. It gives a good overview of the dataset variables including summary statistics.</span><span id="60a9" class="ly kr hj lu b fj md ma l mb mc">describe(diet)</span></pre><figure class="jg jh ji jj fe jk es et paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="es et me"><img src="../Images/0697c12eb158ed989ec713975e7c1bad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KJQ2j3j3fYHFrfWgvA6X7g.png"/></div></div><figcaption class="jr js eu es et jt ju bd b be z dy">describe() function output</figcaption></figure><figure class="jg jh ji jj fe jk es et paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="es et mf"><img src="../Images/425b00a33cad5d3fbfa756e6664894d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HnzHxzjBEm3lQeQxiZNcvQ.png"/></div></div><figcaption class="jr js eu es et jt ju bd b be z dy">Scatterplot of Advertising and Sales</figcaption></figure><p id="251c" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">首先，销售和广告的散点图。当广告支出高时，销售额通常也高，这也许并不奇怪，但情况并不总是如此。销售和广告之间似乎有很大的可变性，所有的点都离我们的直线很远。</p><figure class="jg jh ji jj fe jk es et paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="es et mg"><img src="../Images/236b7a55a250b6a741a64d7885f7053e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O0ssBVqrCtKl4-WEJ_Lh8A.png"/></div></div><figcaption class="jr js eu es et jt ju bd b be z dy">Line chart of sales</figcaption></figure><p id="e244" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">如果我们查看一段时间内的销售数据，我们可以看到许多高峰和低谷。肯定会有很多下降，有些看起来是随机的，有些在12个月、24个月和现在的36个月左右，这表明销售在圣诞节假期前后下降，但很快回升。这可能是一种减肥产品销售的典型行为，但是因为我们没有这个数据集的实际时间指数，所以我们不会假设这是事实。在其他月份也有其他下跌，但没有明显的模式突出。</p><h1 id="0ad4" class="kq kr hj bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">关于ARIMA模型</h1><p id="c7e1" class="pw-post-body-paragraph ig ih hj ii b ij lo il im in lp ip iq ir lq it iu iv lr ix iy iz ls jb jc jd hc bi translated">ARIMA模型被认为是一种高级预测模型，因为其他时间序列模型不能处理多变量预测。此外，ARIMA模型可以检测趋势，季节性和新近性。ARIMA有三(3)个参数或符号:(p，d，q)。</p><p id="c3dd" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">p =自回归<br/> d =差异(季节性)<br/> q =移动平均</p><p id="ebde" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">自回归模型使用变量过去值的线性组合来预测我们感兴趣的变量(在本例中为销售额)。差异就是连续观察值之间的差异。移动平均模型在类似回归的模型中使用过去的预测误差来预测未来值。</p><h1 id="bee9" class="kq kr hj bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">如何在R中创建一个ARIMA对象</h1><p id="033a" class="pw-post-body-paragraph ig ih hj ii b ij lo il im in lp ip iq ir lq it iu iv lr ix iy iz ls jb jc jd hc bi translated">为了创建ARIMA模型，我们的数据需要是一个时间序列对象，因此我们使用ts()函数来转换我们的数据框架。我们不需要包含列1，因为这是我们的月份变量(作为一个整数序列而不是时间索引，但这是可以的)，所以我们将只包含列2和3的子集。</p><pre class="jg jh ji jj fe lt lu lv lw aw lx bi"><span id="536c" class="ly kr hj lu b fj lz ma l mb mc">#Convert dataframe to time series object using the ts() function<br/>diet_ts &lt;- ts(data = diet[,c(2,3)])</span><span id="49d6" class="ly kr hj lu b fj md ma l mb mc">#Check results of transformation<br/>diet_ts</span></pre><figure class="jg jh ji jj fe jk es et paragraph-image"><div class="es et mh"><img src="../Images/7bdc9ee61c0d67614531545784ff057e.png" data-original-src="https://miro.medium.com/v2/resize:fit:436/format:webp/1*QT29cJxjYICnnUT5sS4RgQ.png"/></div><figcaption class="jr js eu es et jt ju bd b be z dy">The first 16 rows of our time series object</figcaption></figure><p id="a452" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">接下来，让我们创建两个变量的时间图。</p><figure class="jg jh ji jj fe jk es et paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="es et mg"><img src="../Images/06c95f6b1121c2599b891f2c498a18bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f3sH6hRk7EjQboQIxNFMAw.png"/></div></div><figcaption class="jr js eu es et jt ju bd b be z dy">Time plot of sales and advertising</figcaption></figure><p id="dbf8" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">将两个折线图放在一起看，可以揭示出相当多的见解。这两种折线图看起来具有相同的形状(在相同的位置出现最低点和最高点)，但这并不总是正确的。在第30个月，广告支出非常低，但这个月的销售额仍然相对较高。原因之一是过去的广告会影响现在和未来的销售。暴露于6个月前甚至1个月前的广告，可以产生今天的销售。随着时间的推移，可能会产生递减效应的因素，如广告，可以用在回归模型中，但我们将留待以后讨论。</p><h1 id="bdb7" class="kq kr hj bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">动态回归建模</h1><p id="a47b" class="pw-post-body-paragraph ig ih hj ii b ij lo il im in lp ip iq ir lq it iu iv lr ix iy iz ls jb jc jd hc bi translated">现在，我们将使用预测包中的auto.arima()函数来拟合我们的ARIMA模型。auto.arima函数()将决定最佳模型。我们函数中使用的公式是“Sales ”,正如我们的xreg对“Advertising”的解释。出于本练习的目的，我们还将添加参数stationary = TRUE。平稳意味着时间序列在一段时间内是稳定的或者没有趋势。</p><pre class="jg jh ji jj fe lt lu lv lw aw lx bi"><span id="186c" class="ly kr hj lu b fj lz ma l mb mc"># Fit ARIMA model<br/>fit &lt;- auto.arima(diet_ts[, "Sales"], xreg = diet_ts[, "Advertising"], stationary = TRUE)</span><span id="3d89" class="ly kr hj lu b fj md ma l mb mc"># Check model fit<br/>fit</span></pre><figure class="jg jh ji jj fe jk es et paragraph-image"><div class="es et mi"><img src="../Images/d844334963c3d30c1ffa236497d5ecc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*LDA67MRTbHwJzMzCLV6m9A.png"/></div><figcaption class="jr js eu es et jt ju bd b be z dy">ARIMA model output</figcaption></figure><h1 id="b157" class="kq kr hj bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">输出解释</h1><p id="cbdc" class="pw-post-body-paragraph ig ih hj ii b ij lo il im in lp ip iq ir lq it iu iv lr ix iy iz ls jb jc jd hc bi translated">auto.arima()函数拟合了广告变量的线性回归模型和误差的ARIMA (1，0，0)模型(1个自回归参数，0个差异和0个移动平均参数)。我们的广告系数在xreg栏的第一位。因此，解释是，广告支出每增加1000美元，单位销售额增加0.09美元。系数很小，但它是正的。</p><h1 id="f2fe" class="kq kr hj bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">残差</h1><p id="9a13" class="pw-post-body-paragraph ig ih hj ii b ij lo il im in lp ip iq ir lq it iu iv lr ix iy iz ls jb jc jd hc bi translated">我们将使用checkresiduals()函数来获取残差。该函数做两(2)件重要的事情:</p><ol class=""><li id="542e" class="kc kd hj ii b ij ik in io ir ke iv kf iz kg jd kh ki kj kk bi translated">执行永盒测试。</li><li id="492f" class="kc kd hj ii b ij kl in km ir kn iv ko iz kp jd kh ki kj kk bi translated">提供误差的时间图、自相关(ACF)图和残差直方图。</li></ol><pre class="jg jh ji jj fe lt lu lv lw aw lx bi"><span id="fed9" class="ly kr hj lu b fj lz ma l mb mc">#Check Residuals<br/>checkresiduals(fit)</span></pre><figure class="jg jh ji jj fe jk es et paragraph-image"><div class="es et mj"><img src="../Images/a7966d528f555c55a6b3b2e8e2621585.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*Baqvsy1xC711MU55duonhA.png"/></div><figcaption class="jr js eu es et jt ju bd b be z dy">Ljung-Box test output</figcaption></figure><p id="e732" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">p值大于0.05，因此残差是白噪声。</p><figure class="jg jh ji jj fe jk es et paragraph-image"><div class="es et mk"><img src="../Images/20fac7ac82390b2f3857c0308e93d9a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*_JZhp65q04W3YwMHmr4ngQ.png"/></div><figcaption class="jr js eu es et jt ju bd b be z dy">checkresiduals() plot of errors, ACF, &amp; residuals</figcaption></figure><p id="49e5" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">残差看起来接近正态分布。</p><h1 id="eabf" class="kq kr hj bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">预测销售额</h1><p id="2158" class="pw-post-body-paragraph ig ih hj ii b ij lo il im in lp ip iq ir lq it iu iv lr ix iy iz ls jb jc jd hc bi translated">现在我们有了一个模型，我们可以用它来创建我们的预测。</p><pre class="jg jh ji jj fe lt lu lv lw aw lx bi"><span id="d2af" class="ly kr hj lu b fj lz ma l mb mc">#We need to provide forecast with the future value of our predictor which is Advertising. So here, we will spend 5 in month 1, 12 in month 2 and 40 in month 3.</span><span id="7ebf" class="ly kr hj lu b fj md ma l mb mc">#Create a vector to hold advertising spend<br/>adv_spend &lt;- c(5, 12, 40)</span><span id="62f7" class="ly kr hj lu b fj md ma l mb mc">#Let's build the forecast<br/>diet_fc &lt;- forecast(fit, xreg = adv_spend)</span><span id="3236" class="ly kr hj lu b fj md ma l mb mc"># Plot forecast<br/>autoplot(diet_fc) + xlab("Month") + ylab("Sales")</span></pre><figure class="jg jh ji jj fe jk es et paragraph-image"><div class="es et ml"><img src="../Images/3c76ae85f0d8d7025317f2a6be5731f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*-xKXYPd4PfI_3N-y9u_QMA.png"/></div><figcaption class="jr js eu es et jt ju bd b be z dy">Plot of sales data with three (3) month forward forecast</figcaption></figure><p id="6d9c" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">考虑到我们的输入，我们的预测图看起来是合理的。我们还可以通过在控制台中直接调用我们的预测对象来打印出我们的预测(点预测列)和置信区间。</p><pre class="jg jh ji jj fe lt lu lv lw aw lx bi"><span id="f5b3" class="ly kr hj lu b fj lz ma l mb mc">#Print forecast with confidence intervals<br/>diet_fc</span></pre><figure class="jg jh ji jj fe jk es et paragraph-image"><div class="es et mm"><img src="../Images/5c7c29d65e010067f3405f5718d72917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*JaBlzfY1dCVO2s9nPZ8sxg.png"/></div></figure><p id="9e7a" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">但是让我们把我们的预测放到一个漂亮的表格里。我们现在已经计划了下一季度的销售。</p><figure class="jg jh ji jj fe jk es et paragraph-image"><div class="es et mn"><img src="../Images/e5860aafce372661fd41e4f4e4b5f7e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*5FcVHrLiJrlT3PbMmiR5Fg.png"/></div><figcaption class="jr js eu es et jt ju bd b be z dy">Table with our forecasts using ggpubr package</figcaption></figure></div><div class="ab cl jv jw gq jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hc hd he hf hg"><h1 id="0b1e" class="kq kr hj bd ks kt mo kv kw kx mp kz la lb mq ld le lf mr lh li lj ms ll lm ln bi translated">概述:</h1><ol class=""><li id="96ee" class="kc kd hj ii b ij lo in lp ir mt iv mu iz mv jd kh ki kj kk bi translated">我们建立了一个动态回归模型，将广告作为自变量，销售额作为因变量。我们解释了我们的广告系数及其对销售的影响。</li><li id="3ae5" class="kc kd hj ii b ij kl in km ir kn iv ko iz kp jd kh ki kj kk bi translated">我们预测了下一季度的销售额，每个月都有不同程度的广告支出。</li><li id="7a9a" class="kc kd hj ii b ij kl in km ir kn iv ko iz kp jd kh ki kj kk bi translated"><strong class="ii hk">业务用例:</strong>我们可以使用这种技术为营销部门提供短期预测。也许你的营销经理想知道根据不同的广告支出情况，预期的销售额是多少，以便计划营销活动或达到销售目标。</li></ol><p id="76ca" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">完整的代码可以在<a class="ae mw" href="https://github.com/bonheurgirl/Forecasting-in-R/blob/main/How%20to%20Forecast%20Sales%20with%20Advertising%20Spend%20in%20R.Rmd" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。<a class="ae mw" href="https://github.com/bonheurgirl/Forecasting-in-R/blob/main/How%20to%20Forecast%20Sales%20with%20Advertising%20Spend%20in%20R.Rmd" rel="noopener ugc nofollow" target="_blank"> GitHub </a>版本包括一个训练数据集来构建我们的预测模型，并在样本外数据上测试模型。</p><h1 id="88b5" class="kq kr hj bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">参考资料:</h1><p id="619c" class="pw-post-body-paragraph ig ih hj ii b ij lo il im in lp ip iq ir lq it iu iv lr ix iy iz ls jb jc jd hc bi translated">温斯顿W. L. (2014年)。营销分析:微软Excel的数据驱动技术。威利。</p><p id="364e" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">《预测:原理与实践》(第二版)Rob J Hyndman和George Athanasopoulos，澳大利亚莫纳什大学。</p></div></div>    
</body>
</html>