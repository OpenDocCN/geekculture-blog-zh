<html>
<head>
<title>Installing a self signed SSL Certificate on AWS Elastic Beanstalk</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS Elastic Beanstalk上安装自签名SSL证书</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/installing-a-self-signed-ssl-certificate-on-aws-elastic-beanstalk-1d4acd2c0cd?source=collection_archive---------11-----------------------#2021-07-05">https://medium.com/geekculture/installing-a-self-signed-ssl-certificate-on-aws-elastic-beanstalk-1d4acd2c0cd?source=collection_archive---------11-----------------------#2021-07-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c947f871afbb4963cd9f5f3283e78309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B81OiiykzVweCSCNqXfvuQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Self Signed SSL Certificates on AWS Elastic Beanstalk</figcaption></figure><h2 id="cf99" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">概观</h2><p id="0414" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km hb bi translated">在我之前的<a class="ae kn" href="https://praveeng-nair.medium.com/deploy-docker-apps-on-aws-elastic-beanstalk-82a0c6871297" rel="noopener">帖子</a>中，我们已经看到了如何在Elastic Beanstalk上部署我们的docker应用。这篇文章记录了你如何在Elastic Beanstalk上安装一个自签名证书，这将为我们的应用程序启用<strong class="ju hj"> HTTPS </strong> url。</p><p id="fa05" class="pw-post-body-paragraph js jt hi ju b jv ko jx jy jz kp kb kc jf kq ke kf jj kr kh ki jn ks kk kl km hb bi translated">很多时候，业务需求要求所有对API的请求和响应都应该通过HTTPS，这是我们在生产中肯定会考虑的。因此，出于开发和测试的目的，我们可以使用自签名证书并让事情正常运行。</p><p id="2764" class="pw-post-body-paragraph js jt hi ju b jv ko jx jy jz kp kb kc jf kq ke kf jj kr kh ki jn ks kk kl km hb bi translated">HTTPS是一种安全协议，允许浏览器向服务器发送加密信息，反之亦然。为了让HTTPS工作，网站需要有一个SSL证书。该证书验证浏览器正在与实际的域所有者而不是一个假冒的域进行对话。</p><p id="8be4" class="pw-post-body-paragraph js jt hi ju b jv ko jx jy jz kp kb kc jf kq ke kf jj kr kh ki jn ks kk kl km hb bi translated">通常，如果你想要一个SSL证书，你可以从Godaddy，Verisign等公司购买。这些组织为您生成证书并对其进行数字签名。当您的浏览器看到网站上的SSL证书已由这些证书颁发机构之一签名时，它会立即信任该网站，并在您访问该网站时显示绿色锁图标。</p><p id="6671" class="pw-post-body-paragraph js jt hi ju b jv ko jx jy jz kp kb kc jf kq ke kf jj kr kh ki jn ks kk kl km hb bi translated">所以在我们的例子中，我们只需要一个临时证书来测试我们在之前的<a class="ae kn" href="https://praveeng-nair.medium.com/deploy-docker-apps-on-aws-elastic-beanstalk-82a0c6871297" rel="noopener"> post </a>中创建的API。要制作自己的SSL证书，可以使用<a class="ae kn" href="https://www.openssl.org/" rel="noopener ugc nofollow" target="_blank"> OpenSSL </a>。安装OpenSSL后，生成证书有三个步骤:</p><ol class=""><li id="5cbf" class="kt ku hi ju b jv ko jz kp jf kv jj kw jn kx km ky kz la lb bi translated">生成私钥。</li><li id="e75f" class="kt ku hi ju b jv lc jz ld jf le jj lf jn lg km ky kz la lb bi translated">使用私钥创建CSR(证书签名请求)</li><li id="5e8f" class="kt ku hi ju b jv lc jz ld jf le jj lf jn lg km ky kz la lb bi translated">自己签署证书。</li></ol><h2 id="185a" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">生成私钥</h2><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="4327" class="iu iv hi lm b fi lq lr l ls lt">$ openssl genrsa 2048 &gt; privatekey.pem</span></pre><p id="8d88" class="pw-post-body-paragraph js jt hi ju b jv ko jx jy jz kp kb kc jf kq ke kf jj kr kh ki jn ks kk kl km hb bi translated">这将生成一个2048位的RSA私钥，具有很强的加密能力。并将它保存在一个名为<code class="du lu lv lw lm b">privatekey.pem</code>的文件中。这包含加密信息，将用于加密和解密在您的服务器和用户之间发送的信息。</p><h2 id="1312" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">创建CSR</h2><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="9219" class="iu iv hi lm b fi lq lr l ls lt">$ openssl req -new -key privatekey.pem -out csr.pem</span></pre><p id="0918" class="pw-post-body-paragraph js jt hi ju b jv ko jx jy jz kp kb kc jf kq ke kf jj kr kh ki jn ks kk kl km hb bi translated">在您的终端中运行上面的命令。这会生成一个签名请求文件。在此步骤中，您需要输入有关网站和您公司的信息。您在上一步中创建的私钥将用于识别和验证您在此处指定的域。因为我们是为amazon这样做的，所以当提示为您的域输入一个通用名称(CN)时，请输入您的Elastic Beanstalk实例的域。应该是这样的格式:&lt;<strong class="ju hj">你的——环境&gt;。如果仅用于测试目的，您也可以使用通配符，如<strong class="ju hj"> *。&lt;地区&gt; .elasticbeanstalk.com </strong></strong></p><h2 id="fc82" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">签署证书</h2><p id="d1e7" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km hb bi translated">如果您正在为一个生产站点创建一个真实的证书，那么此时您会希望您的SSL证书由一个证书颁发机构(CA)进行签名。由于这是出于开发/测试目的，您可以通过运行以下命令自己签署证书:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="8776" class="iu iv hi lm b fi lq lr l ls lt">$ openssl x509 -req -days 365 -in csr.pem -signkey privatekey.pem -out server.crt</span></pre><p id="eb40" class="pw-post-body-paragraph js jt hi ju b jv ko jx jy jz kp kb kc jf kq ke kf jj kr kh ki jn ks kk kl km hb bi translated">X509是公钥证书的标准格式。公钥证书是将加密数据与网站相关联的数字文档。您在创建证书签名请求时采取的步骤创建了此加密信息。</p><p id="1af0" class="pw-post-body-paragraph js jt hi ju b jv ko jx jy jz kp kb kc jf kq ke kf jj kr kh ki jn ks kk kl km hb bi translated">在上面的命令中，您指定了证书的有效期、包含证书签名请求的文件名、将用于签名证书的密钥以及最终签名证书的文件名。现在您已经有了证书，您可以将它上传到<a class="ae kn" href="https://aws.amazon.com/certificate-manager/?nc=sn&amp;loc=1" rel="noopener ugc nofollow" target="_blank"> AWS证书管理器</a> (ACM)以便与Elastic Beanstalk一起使用。</p><h2 id="024a" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">将证书上传到AWS证书管理器的步骤</h2><ol class=""><li id="5feb" class="kt ku hi ju b jv jw jz ka jf lx jj ly jn lz km ky kz la lb bi translated">在AWS管理控制台中选择ACM，然后单击Import Certificate。将<strong class="ju hj"> server.crt </strong>的内容复制到<em class="ma">证书体</em>中，将<strong class="ju hj"> privatekey.pem </strong>的内容复制到<em class="ma">证书私钥</em>部分中。</li></ol><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/0a911e7671bc83ae7c9f1239f906ed06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wEfsRY94086r2-HNE9dVag.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">AWS Certificate Manager Importing certs.</figcaption></figure><p id="0e54" class="pw-post-body-paragraph js jt hi ju b jv ko jx jy jz kp kb kc jf kq ke kf jj kr kh ki jn ks kk kl km hb bi translated">2.单击“下一步”,回顾您到目前为止所做的一切。完成后，您将看到您的证书被导入到证书管理器中。</p><p id="cf56" class="pw-post-body-paragraph js jt hi ju b jv ko jx jy jz kp kb kc jf kq ke kf jj kr kh ki jn ks kk kl km hb bi translated">3.导航到您的Elastic Beanstalk环境，并选择左侧的<em class="ma">配置</em>菜单。单击<em class="ma">负载平衡器</em>旁边的编辑，添加一个新的监听器，并在端口字段中输入443。将协议设置为HTTPS，并为您的环境选择默认进程。从下拉列表中选择您在上述步骤中上传的SSL证书，并完成设置。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/d377600106113f37d1c78c94705a7365.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*woYvsILCLbCwOj-YfarTCA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">New HTTPS listener on 443</figcaption></figure><p id="9918" class="pw-post-body-paragraph js jt hi ju b jv ko jx jy jz kp kb kc jf kq ke kf jj kr kh ki jn ks kk kl km hb bi translated">您的环境可能会在此时重新启动，但您的证书应该已安装。由于这是一个自签名证书，当您现在使用HTTPS导航到该网站时，您的浏览器将发出一个<strong class="ju hj">警告</strong>，您可以安全地选择忽略并继续。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/52e50007c13a815fb6f6cd1ca00571d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oJjacpHYmo96eNa4gjyLzg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">HTTPS response</figcaption></figure><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="6906" class="iu iv hi lm b fi lq lr l ls lt">$ curl -k https://springbootsample-env.eba-m9amqwhu.ap-southeast-2.elasticbeanstalk.com/</span><span id="860a" class="iu iv hi lm b fi me lr l ls lt">Welcome to Jib sample app</span></pre><h2 id="4724" class="iu iv hi bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">摘要</h2><p id="428c" class="pw-post-body-paragraph js jt hi ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km hb bi translated">我们已经看到了如何在AWS弹性豆杆上安装自签名证书。这适用于运行和测试开发和测试工作负载。对于生产，我们必须购买证书，不应包括自签名证书。当部署在Elastic beanstalk上时，有许多其他方法可以使您的rest api成为HTTPs，例如部署一个AWS api网关来代理我们对Elastic beanstalk的请求，但是这将导致部署API网关的一些成本。</p><p id="7aa4" class="pw-post-body-paragraph js jt hi ju b jv ko jx jy jz kp kb kc jf kq ke kf jj kr kh ki jn ks kk kl km hb bi translated">希望你觉得这篇文章有用。分享你的反馈和你想知道的话题。我会试着写一些关于他们的东西。编码快乐！！</p><p id="ef2e" class="pw-post-body-paragraph js jt hi ju b jv ko jx jy jz kp kb kc jf kq ke kf jj kr kh ki jn ks kk kl km hb bi translated"><strong class="ju hj">参考文献</strong>:</p><p id="042b" class="pw-post-body-paragraph js jt hi ju b jv ko jx jy jz kp kb kc jf kq ke kf jj kr kh ki jn ks kk kl km hb bi translated"><a class="ae kn" href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/configuring-https.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/elastic beanstalk/latest/DG/configuring-https . html</a></p></div></div>    
</body>
</html>