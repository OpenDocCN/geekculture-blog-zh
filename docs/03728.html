<html>
<head>
<title>Activate Account with NodeJs and MongoDB(Final Version)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用NodeJs和MongoDB激活帐户(最终版本)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/activate-account-with-nodejs-and-mongodb-final-version-3e6f646b4f8?source=collection_archive---------45-----------------------#2021-06-14">https://medium.com/geekculture/activate-account-with-nodejs-and-mongodb-final-version-3e6f646b4f8?source=collection_archive---------45-----------------------#2021-06-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a76cf5bbc867c1a052c613f235db0cdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AyfB1HKCLsfjnveC.png"/></div></div></figure><p id="e429" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我将讲述如何用NodeJs激活一个帐户。这和我之前的文章是有联系的，所以如果你看了，你就很容易理解这个项目。链接在这里:</p><div class="jo jp ez fb jq jr"><a rel="noopener follow" target="_blank" href="/geekculture/signup-function-with-nodejs-and-mongodb-final-version-18caa017a3b"><div class="js ab dw"><div class="jt ab ju cl cj jv"><h2 class="bd hj fi z dy jw ea eb jx ed ef hh bi translated">用NodeJs和MongoDB注册函数(最终版本)</h2><div class="jy l"><h3 class="bd b fi z dy jw ea eb jx ed ef dx translated">我写了这个函数和其他函数，但是在我写的时候这个项目还没有完成。所以，我完成项目并想…</h3></div><div class="jz l"><p class="bd b fp z dy jw ea eb jx ed ef dx translated">medium.com</p></div></div><div class="ka l"><div class="kb l kc kd ke ka kf io jr"/></div></div></a></div><p id="8f57" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">开始吧！</p><p id="8e56" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们在请求中有一个电子邮件和一个randomCode。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="a098" class="kp kq hi kl b fi kr ks l kt ku">const { email, randomCodeReq, } = <em class="kv">req</em>.body;</span></pre><p id="19b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">随机代码给了我们注册功能。在这个函数中，我们向用户发送一封电子邮件。在电子邮件中，我们有一个6位数的号码，就像这样:</p><figure class="kg kh ki kj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kw"><img src="../Images/8ab2dc4fb68c8715a87562a2d8e1137b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PpCRjtlCgUpc2p9MSLaiKA.png"/></div></div></figure><p id="b7bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于电子邮件，我们在数据库中搜索一个用户，并将其等同于常量userEmailSearch。如果randomCode等于用户的randomCode，而用户的登录等于false，则我们在If内部。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="3bb0" class="kp kq hi kl b fi kr ks l kt ku">const userEmailSearch = await User.find({ email: email });</span><span id="e583" class="kp kq hi kl b fi kx ks l kt ku">if (randomCodeReq == userEmailSearch[0].randomCode &amp;&amp; userEmailSearch[0].login == false) {}</span></pre><p id="fdb9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在if语句中，我们有一个try/catch。在try部分，我们将创建一个名为user的常量。用户将电子邮件等同于给定的电子邮件。在数据库中，我想在激活后删除randomCode。为此，我会写</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="a4cc" class="kp kq hi kl b fi kr ks l kt ku">user.randomCode = 0;<br/>user.save()</span></pre><p id="6c4e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之后，我将在数据库的模型部分创建一个函数并删除randomCode。但那是在我的下一篇文章中。我就想说这些，所以如果你不明白为什么，你可以直接跳过那部分。</p><p id="3c78" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们有一个用户，这个用户在数据库中有id、refreshToken和其他列。我返回一个响应，在响应中是一个成功:true、用户id和refreshToken。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="c71a" class="kp kq hi kl b fi kr ks l kt ku"><em class="kv">res</em>.status(200).json({</span><span id="a2be" class="kp kq hi kl b fi kx ks l kt ku">success: true,</span><span id="fb13" class="kp kq hi kl b fi kx ks l kt ku">id,</span><span id="6f96" class="kp kq hi kl b fi kx ks l kt ku">refreshToken</span><span id="c883" class="kp kq hi kl b fi kx ks l kt ku">});</span></pre><p id="e9c8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在catch块中，如果有错误，我们将返回状态代码500。</p><p id="e845" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们需要路由这个函数。为此，我转到routes/auth.js文件并添加以下代码:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="242f" class="kp kq hi kl b fi kr ks l kt ku">router.post('/email-activate',activateAccount)</span></pre><p id="e374" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇文章写完了，我会写下一篇文章，所以请关注我。感谢阅读！</p></div></div>    
</body>
</html>