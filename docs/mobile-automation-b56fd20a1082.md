# 移动自动化

> 原文：<https://medium.com/geekculture/mobile-automation-b56fd20a1082?source=collection_archive---------56----------------------->

![](img/eb5988bc73838b1434655162781d7f35.png)

Photo by [Alexandre Debiève](https://unsplash.com/@alexkixa?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

到目前为止，主要的移动自动化是使用 Appium 的黑盒测试。Appium 的优势是支持一长串编程语言。然后有机会在不同的项目中使用 Python 和 Java。Appium 的缺点是，安装步骤较长且复杂，执行速度比 selenium 和市场上的其他自动化工具慢。另一个缺点是片状剥落。然而，同意剥落与设计、数据、环境和许多因素有关。因此，现在是时候转向其他一些工具了，这些工具可能对这些问题有更好的解决方案。

Espresso 来自谷歌，它在 Android 环境中的工作方式很有趣。Espresso 会安装一个与原始 App apk 并行的测试 apk，并发送 UI 事件。通过观察事件的行为，得出比较的结果。因此，称浓缩咖啡测试为黑盒测试可能是不正确的。它应该更好地称为灰盒或白盒测试工具。这种行为的优点是浓缩咖啡可以完全避免同步。Espresso 比市面上很多工具都快；测试脚本更加稳定，也更容易配置。另一个优势是，由于该工具来自 Google，它可以比市场上的开源工具获得更长时间的官方支持。

说到缺点，Espresso 不支持像 Appium 这样的大量语言列表。它只支持 Java 和 Kotlin。Espresso 只能支持 Android 自动化。因此，如果需要测试 Android 和 iOS 应用程序，请坚持使用 Appium。另一方面，假设需求是测试 Android 应用。在这种情况下，Espresso 的优势超过了 Appium 或市场上的任何其他工具。正确的说法应该是“完全取决于业务需求”。Espresso design 只能支持测试一个应用程序。因此，如果条件是在一个工作流程中尝试多个应用程序，则需要与 UIAutomator 或 Appium 集成。

处理同步场景决定了自动化框架的不完整；因此，我觉得应该理解没有同步的测试自动化背后的机制。Android 中的测试主要包括两种类型:它们是单元测试或仪器测试。Espresso 为自动化 UI 测试做仪器测试。换句话说，Espresso 是 Android 编写可靠 UI 测试的原生测试框架。

Espresso 在自动化测试方面使用了一个简单的公式。食谱从在屏幕上定位一个视图开始。简单地说，屏幕上的矩形区域就是我们所说的视图。它负责绘制和处理该区域。确定屏幕上的视图后，就该行动了。在自动化测试中，这可以是点击或滑动或输入文本。这一行动的时机是同步进入画面。浓咖啡不需要被告知时间，可以很好地处理这种情况。最后，它验证动作的性能。该公式的表示如下所示。

```
onView(ViewMatcher). Perform(ViewAction).check(ViewAssertion)
```

ViewMatcher 是匹配视图的 hamcrest 匹配器的集合。ViewAction 负责在标识的视图上执行操作。正如所料，ViewAssertion 负责完成视图中元素的断言。有几个 on*方法是使用 Espresso 框架开始测试的切入点。`onView()`就是一个切入点的例子。`onView()`不适用于适配器视图。*适配器视图*是由包含数据的适配器支持的视图。适配器视图显示项目池中的数据集。适配器视图将重用滚动时从屏幕上消失的项目。从逻辑上来说，为了验证一段数据的显示，我们将滚动到屏幕上出现包含该段数据的项目视图。为了适应这种情况，浓缩咖啡有不同的配方。`onData(ObjectMatcher)` 。DataOptions，后面是上面看到的`Perform()`和`check()`方法。ObjectMatcher 是`onData()`方法的输入，它描述了要搜索的数据。

有一种通过标识符识别视图的方法，就像我们在 selenium 和 Appium 中识别视图一样，叫做`FindViewById()`。然而，Espresso 通常不使用该方法，因为该方法不支持同步。使用`onView()`方法时，Espresso 检查三项检查。

发送事件之前，请检查主线程消息队列。如果消息队列不为空，Espresso 会一直等到队列为空。这种等待通过等待线程消息队列精确来确保应用程序和测试之间的 Espresso 同步。此外，主线程消息队列包含应用程序在屏幕上呈现信息的指令。

Espresso 的另一个内置同步功能是异步任务。Espresso 等待所有异步任务完成后再继续。这种心理检查功能可以防止 Espresso 脚本失败，因为脚本在后台作业运行时执行得更早。

第三个内置特性是确保所有开发人员定义的空闲资源都是空闲的。一个*空闲资源*代表一个异步操作，其结果会影响 UI 测试中的后续操作。使用 Espresso 注册空闲资源可以在测试应用程序时更可靠地验证异步操作。

通过执行这些检查，Espresso 大大增加了在任何给定时间只能发生一个 UI 动作或断言的可能性。这种能力提供了更可靠的测试结果。

我们在进行 android 测试时遇到的重大挑战是

*   在代码改变后生成构建时，确保自动脚本的执行以验证改变。
*   为了模拟今天的网络延迟或任何减速过程，我们必须依赖远程服务器和其他工作站。
*   说到持续集成，需要涉及到持续集成工具。然后，部署和列表可以根据环境进行扩展。
*   测试 android 应用程序的另一个主要挑战是测试支持新平台功能的最新 Android API。为此，我们可能需要在模拟器和真实设备上进行尝试。

当使用 Espresso 自动化框架进行 Android 测试时，处理这些挑战将会很容易。总之，最初的反馈是原生移动自动化可能更具挑战性和令人兴奋，但也会更有回报。