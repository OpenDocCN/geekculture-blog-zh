<html>
<head>
<title>BE SPECIFIC! The key to writing SQL queries that make your app perform well</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具体点！编写SQL查询使你的应用程序运行良好的关键</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/be-specific-the-key-to-writing-sql-queries-that-make-your-app-perform-well-94fdadc19b91?source=collection_archive---------53-----------------------#2021-05-25">https://medium.com/geekculture/be-specific-the-key-to-writing-sql-queries-that-make-your-app-perform-well-94fdadc19b91?source=collection_archive---------53-----------------------#2021-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/0a9baddc30eef15bb72c9f76d3b15e3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ox2sJJn_CtysrA4UKqzBpA.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">My editors tell me serious computer-type pics are best above my title</figcaption></figure><div class=""/><p id="f775" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我最近参加了一些SQL密集型的面试。这迫使我重新审视我的SQL，所以本周我开始创建一个快速博客来实践<code class="du js jt ju jv b">SELECT</code>语句。当我整理这篇文章时，我意识到关于编写SQL还有更重要的事情要回顾。特异性。这个博客的目标读者仍然是刚刚开始使用SQL的读者，但是这个技巧是即使是老程序员也可以忽略的。我仍然是一名初级开发人员，但看起来这一条建议可以决定一个应用程序开发的成败。</p><h2 id="1c4c" class="jw jx hx bd jy jz ka kb kc kd ke kf kg jf kh ki kj jj kk kl km jn kn ko kp kq bi translated">为成功做好准备</h2><p id="d3d5" class="pw-post-body-paragraph iu iv hx iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">练习SQL语句的最好方法是练习数据。在<a class="ae kw" href="https://www.postgresqltutorial.com/postgresql-sample-database/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL教程</a>中提供的样本dvdrental数据集非常健壮，你可以在这里找到关于如何将其加载到Postgres中的<a class="ae kw" href="https://www.postgresqltutorial.com/load-postgresql-sample-database/" rel="noopener ugc nofollow" target="_blank">说明。</a></p><h2 id="2480" class="jw jx hx bd jy jz ka kb kc kd ke kf kg jf kh ki kj jj kk kl km jn kn ko kp kq bi translated">为什么选择PostgreSQL？</h2><p id="a905" class="pw-post-body-paragraph iu iv hx iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">我是PostgreSQL的粉丝，这是一个行业标准，而且它是开源的，可以免费获得。它足够强大和快速，可以在生产服务器上运行，但也足够容易管理，我从未发现自己在一台新机器上尝试设置PostgreSQL。另外<a class="ae kw" href="https://www.pgadmin.org/" rel="noopener ugc nofollow" target="_blank"> pgAdmin是一个神奇的PostgreSQL</a>GUI，我在下面使用它。</p><p id="25ef" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我在我的机器上设置了Postgres。如果你想跟着做，<a class="ae kw" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank">安装postgres </a>，<a class="ae kw" href="https://www.postgresqltutorial.com/load-postgresql-sample-database/" rel="noopener ugc nofollow" target="_blank">获取并导入样本数据</a>，然后在这里见我。</p><h2 id="38b1" class="jw jx hx bd jy jz ka kb kc kd ke kf kg jf kh ki kj jj kk kl km jn kn ko kp kq bi translated">Select语句</h2><p id="fd20" class="pw-post-body-paragraph iu iv hx iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">你已经有了一些数据和一个数据库来运行你的查询，如果你和我一起编码，你应该很好。为了开始我们对特异性如何增强您的查询的研究，让我们看一下<code class="du js jt ju jv b">SELECT</code>语句。<code class="du js jt ju jv b">SELECT</code>语句的一般形式是:</p><pre class="kx ky kz la fd lb jv lc ld aw le bi"><span id="90f9" class="jw jx hx jv b fi lf lg l lh li">SELECT *<br/>FROM table_name<br/>WHERE condition1 AND / OR condition2<br/>ORDER BY column_name ASC / DESC;</span></pre><p id="cdd4" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">SQL保留字在这里全部大写。<code class="du js jt ju jv b">SELECT *</code>是一个从表中选择<em class="lj">所有</em>列的查询，我们可以通过指定列名:<code class="du js jt ju jv b">SELECT column_name_1, column_name_2</code>使我们的查询更加精确</p><p id="5fc4" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用列名而不是选择所有列(<code class="du js jt ju jv b">SELECT *</code>)编写<code class="du js jt ju jv b">SELECT</code>语句是使查询更具体的一个例子。尽可能具体地组织您的查询是一个好主意。查询越具体，数据库的响应时间就越快。如果你正在为一个应用程序编写查询，编写一个特定的查询可能是一个快速响应的应用程序和一个让客户不耐烦等待的应用程序之间的区别。</p><p id="2d25" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们关注<code class="du js jt ju jv b">SELECT</code>查询的另一种方式是<code class="du js jt ju jv b">LIMIT</code>返回的行。例如，我们可能想知道<code class="du js jt ju jv b">dvdrental</code>中<code class="du js jt ju jv b">rental</code>表的模式，即表<code class="du js jt ju jv b">rental</code>中的列名。如果我们尝试<code class="du js jt ju jv b">SELECT * FROM rental;</code>，我们将会看到模式:</p><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lk"><img src="../Images/355e69783b5f7be4a542ce73a833faf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Rz-Mfg-fk2G3Q8VQleIbw.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">The schema is row across the top: rental_id, rental_date, inventory_id, return_date, staff_id, last_update</figcaption></figure><p id="8fbd" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在pgAdmin中，在messages选项卡下，我们可以看到查询运行了115毫秒。</p><figure class="kx ky kz la fd hk er es paragraph-image"><div class="er es ll"><img src="../Images/e4da3db525eafbc7fb5618b89fa33801.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*kGnQDp_JYlLQe15LRi1wRA.jpeg"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">115 milliseconds sounds fast!</figcaption></figure><p id="8d18" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">但是它返回16044行！如果我们只看列名，我们不需要所有的数据。与我们运行<code class="du js jt ju jv b">SELECT * FROM rental LIMIT 1;</code>时相比。我们仍然得到这个模式:</p><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lk"><img src="../Images/991a085722e76caaf837b97d5a8e2109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PsmXS4Jt4CCbBAqTWZo2Pw.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">We get the schema, but only one row returned</figcaption></figure><p id="f98f" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">但它只返回一行。当我们在邮件中检查它的性能时:</p><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lm"><img src="../Images/95986e6cd589f448d2c88e7663da568a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*slIfVltXQLQik86aOBzUvw.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">62 milliseconds is way faster than 115!</figcaption></figure><p id="b7f5" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们将执行时间缩短了将近一半！这里的寓意是当你写SQL的时候，要具体。让我单独重复一遍。</p><h2 id="1d33" class="jw jx hx bd jy jz ka kb kc kd ke kf kg jf kh ki kj jj kk kl km jn kn ko kp kq bi translated">当你写SQL的时候，要具体</h2><p id="ecd9" class="pw-post-body-paragraph iu iv hx iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">想想最后的执行时间。即使最终的性能不是一个问题，如果你把考虑速度和编写高效的SQL作为一种习惯，你可能会避免一个错误，这个错误可能会在将来浪费客户的时间。</p><h2 id="ac2e" class="jw jx hx bd jy jz ka kb kc kd ke kf kg jf kh ki kj jj kk kl km jn kn ko kp kq bi translated">数数</h2><p id="ab51" class="pw-post-body-paragraph iu iv hx iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">Count是一个很好的功能，可以为您的<code class="du js jt ju jv b">SELECT</code>查询增加特异性。我们的<code class="du js jt ju jv b">rental</code>表包含在商店发生的所有dvd租赁。每次顾客租一部电影，就会增加一行。我们可以通过以下方式获得该商店发生的所有租赁的<code class="du js jt ju jv b">COUNT</code>:</p><pre class="kx ky kz la fd lb jv lc ld aw le bi"><span id="6c87" class="jw jx hx jv b fi lf lg l lh li">SELECT COUNT(*)<br/>FROM rental;</span></pre><p id="d99e" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">除非数据集已经被修改，否则您应该得到一个响应<code class="du js jt ju jv b">16044</code>。</p><h2 id="c8b0" class="jw jx hx bd jy jz ka kb kc kd ke kf kg jf kh ki kj jj kk kl km jn kn ko kp kq bi translated"><code class="du js jt ju jv b">MIN and MAX</code></h2><p id="b542" class="pw-post-body-paragraph iu iv hx iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">假设我们想知道第一张dvd是什么时候租的，最后一张是什么时候租的。我们可以像这样使用<code class="du js jt ju jv b">MIN</code>和<code class="du js jt ju jv b">MAX</code>:</p><pre class="kx ky kz la fd lb jv lc ld aw le bi"><span id="c1d2" class="jw jx hx jv b fi lf lg l lh li">SELECT MIN(rental_date), MAX(rental_date) <br/>FROM rental;</span></pre><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ln"><img src="../Images/d6825bf29f6f0878ed89b94ba196b9d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B9-8uex3HieTgGc2h1guTQ.jpeg"/></div></div></figure><h2 id="b97c" class="jw jx hx bd jy jz ka kb kc kd ke kf kg jf kh ki kj jj kk kl km jn kn ko kp kq bi translated">明显的</h2><p id="2adf" class="pw-post-body-paragraph iu iv hx iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">我们可以使用<code class="du js jt ju jv b">rental</code>表上的<code class="du js jt ju jv b">DISTINCT</code>来获取从第一个<code class="du js jt ju jv b">rental_date</code>到最后一个<code class="du js jt ju jv b">rental</code>租借的所有视频的库存数量列表:</p><pre class="kx ky kz la fd lb jv lc ld aw le bi"><span id="951a" class="jw jx hx jv b fi lf lg l lh li">SELECT DISTINCT inventory_id FROM rental;</span></pre><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lo"><img src="../Images/37623fb5bbd4157ce2b39df12d7c4bae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VCstLLJ6rLtuey9fqKiSSg.jpeg"/></div></div></figure><p id="d7ba" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们得到了至少被租过一次的<code class="du js jt ju jv b">inventory_id</code>的列表，所有重复的都被删除了。如果我们想要列表，这很好，但是看看它花费的时间:</p><figure class="kx ky kz la fd hk er es paragraph-image"><div class="er es lp"><img src="../Images/413bcbdf8812d8e147aec14855902d84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*hsz9o7ktN1tZ00zFuina9w.jpeg"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">343 milliseconds</figcaption></figure><p id="65b4" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">虽然343毫秒并不算多，但如果我们只想知道<em class="lj">有多少dvd至少被租借过一次</em>，我们可以通过使用我们的伙伴<code class="du js jt ju jv b">COUNT</code>来节省大量时间。</p><pre class="kx ky kz la fd lb jv lc ld aw le bi"><span id="8f37" class="jw jx hx jv b fi lf lg l lh li">SELECT COUNT(DISTINCT inventory_id) FROM rental;</span></pre><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lq"><img src="../Images/094ba71fb3d62c3081dd3ef04cef9083.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D045ZuJJVlqGfBZKlXIM_w.jpeg"/></div></div></figure><p id="24e8" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们最终得到85毫秒的响应时间:</p><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lr"><img src="../Images/6c9da7bdee83d2365a7efa2c3b45b9dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Ey8LVCqScXLbAapWyWc5A.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">85 milliseconds!</figcaption></figure><p id="b27f" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">再说一次，正是这种特殊性拯救了这一天。如果你所需要的是<em class="lj">计数</em>，在这种情况下，我们可以通过避免中间步骤，只<code class="du js jt ju jv b">SELECT</code>计数<code class="du js jt ju jv b">COUNT</code>来减少75%的时间。</p><figure class="kx ky kz la fd hk"><div class="bz dy l di"><div class="ls lt l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">Wacky gifs of kittycats have been treasured from time immemorial for their palate cleansing abilities</figcaption></figure><h2 id="9008" class="jw jx hx bd jy jz ka kb kc kd ke kf kg jf kh ki kj jj kk kl km jn kn ko kp kq bi translated">您的查询中的细节很重要。</h2><p id="c404" class="pw-post-body-paragraph iu iv hx iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">在这篇博客中，我们研究了如何通过添加SQL子句来增加我们的<code class="du js jt ju jv b">SELECT</code>语句的特异性。使用像<code class="du js jt ju jv b">COUNT</code>和<code class="du js jt ju jv b">DISTINCT</code>这样的子句可以将我们的服务器响应时间减少75%,这对于一个每天预计有数千或数百万用户的网站来说意义重大。要获得更多条款来增强你的选择，请查看postgres文档<a class="ae kw" href="https://www.postgresql.org/docs/9.5/sql-select.html" rel="noopener ugc nofollow" target="_blank">或</a><a class="ae kw" href="https://www.w3schools.com/sql/sql_ref_keywords.asp" rel="noopener ugc nofollow" target="_blank"> w3schools </a>。</p><p id="c95a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">希望这是一个启发性的阅读。下周见！</p></div></div>    
</body>
</html>