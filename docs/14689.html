<html>
<head>
<title>Part 9: Ranking Most Active Guests SQL Question Asked by Airbnb</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第9部分:排名最活跃的客人Airbnb提出的SQL问题</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/part-9-ranking-most-active-guests-sql-question-asked-by-airbnb-cf2897e45d67?source=collection_archive---------10-----------------------#2022-09-15">https://medium.com/geekculture/part-9-ranking-most-active-guests-sql-question-asked-by-airbnb-cf2897e45d67?source=collection_archive---------10-----------------------#2022-09-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="a39b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">让我们解决基于产品的公司提出的SQL问题</h1><p id="36f2" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这是基于产品的公司在面试中提出的一系列SQL问题的第9篇文章。对于本文，我使用StrataScratch平台来获取基于产品的公司中被问到的问题。</p><p id="0e20" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">StataScratch是一个优秀的平台，适合任何希望开始学习数据科学并提高其SQL和Python技能的人。这个平台不仅提供编码题，还提供与数据科学相关的非编码题，比如统计、概率等等。我强烈建议你在StrataScratch网站上注册一个账户，在文章旁边练习这个问题。我将使用Postgres SQL数据库来解决这个问题。</p><p id="3ed9" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">以下是基于产品的公司提出的一系列Postgres SQL问题的链接:</p><p id="a371" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><a class="ae kb" href="https://agupta97.medium.com/list/postgres-interview-problems-asked-in-productbased-comapnies-c4020531504b" rel="noopener">https://agupta 97 . medium . com/list/postgres-interview-problems-asked-in-product-based-com apnies-c 4020531504 b</a></p><p id="26c4" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">如果你从事数据科学工作或者想在数据科学领域开始职业生涯，SQL是最重要的技能之一。<br/>如果你熟悉SQL，你将有更好的机会通过数据科学面试或处理日常任务。本文将集中讨论一个问题以及如何解决它。如果你想提高你的SQL知识和经验，你必须阅读这篇文章。你提出想法和寻找解决方案的方法无疑会有所改进。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/5a90f0209dc3d5a42c15a5adad2ebcd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FFR6toRNopj5iK12.jpeg"/></div></div></figure><p id="87fd" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">这是Yelp 在一次采访中提出的一个难题。可以在这里查看问题<a class="ae kb" href="https://platform.stratascratch.com/coding/10060-top-cool-votes?code_type=1" rel="noopener ugc nofollow" target="_blank">。</a>问题名称为<strong class="jf hj">顶酷投票。</strong>以下是问题的详细内容:</p><h1 id="ebf3" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">排名最活跃的客人</h1><p id="0349" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">根据客人与主人交流的信息数量对客人进行排名。与其他访客具有相同数量消息的访客应该具有相同的等级。如果前面的排名相同，不要跳过排名。输出等级、客人id和他们发送的消息总数。首先按邮件总数的最大值排序。</p><blockquote class="kt ku kv"><p id="16a3" class="jd je kw jf b jg kc ji jj jk kd jm jn kx ke jq jr ky kf ju jv kz kg jy jz ka hb bi translated"><em class="hi">公司:</em> <strong class="jf hj"> <em class="hi"> Airbnb </em> </strong> <em class="hi">，难度:</em> <strong class="jf hj"> <em class="hi">中等</em> </strong> <em class="hi">，面试问题sid:</em><strong class="jf hj"><em class="hi">10159</em></strong><em class="hi">，</em> <strong class="jf hj"> <em class="hi"> </em> </strong> <em class="hi">表格:</em><strong class="jf hj">Airbnb _联系人<em class="hi">，</em> </strong></p><p id="3656" class="jd je kw jf b jg kc ji jj jk kd jm jn kx ke jq jr ky kf ju jv kz kg jy jz ka hb bi translated"><em class="hi">Table _ fields:</em><strong class="jf hj">id _ guest</strong>(varchar)、<strong class="jf hj"> id_host </strong> (varchar)、<strong class="jf hj"> id_listing </strong> (varchar)、<strong class="jf hj">ts _ contact _ at</strong>(datetime)、<strong class="jf hj"> ts_reply_at </strong> (datetime)、<strong class="jf hj">ts _ accepted _ at</strong>(datetime)、<strong class="jf hj">ts _ booking _ at</strong>(datetime)、<strong class="jf hj"> ds_checkin</strong></p></blockquote><p id="4b69" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj">表格airbnb_contacts预览:</strong></p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es la"><img src="../Images/5d57a609e96cc5fd7b222cb410cb94f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gYbYOHCcYK0hF-T268ycvg.jpeg"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx"><strong class="bd ih">Some Records from Table airbnb_contacts</strong></figcaption></figure><p id="6845" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">首先，让我们试着理解这个问题。如问题中所述，我们将按降序查找等级、guest_id以及来宾和主机之间交换的消息数量。本文假设您熟悉select、from、where、order by、dense_rank()和over()窗口函数。如果你想温习一下你的概念，你可以先阅读下面列出的文章，然后回到这里对这个问题有更深入的理解。</p><p id="abcb" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><a class="ae kb" href="https://agupta97.medium.com/list/lets-explore-postgres-in-deep-e9d4985a1413" rel="noopener">https://agupta 97 . medium . com/list/lets-explore-postgres-in-deep-e9d 4985 a 1413</a></p><p id="22a4" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj">方法:使用dense_rank()窗口函数</strong></p><p id="ccb9" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj">步骤1:确定相关列和每个guest_id交换的消息总数</strong></p><p id="9ccb" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">首先，<strong class="jf hj">我</strong>首先确定需要回答这个问题的字段。我们需要id_guest和n_messages来回答查询。如问题中所问，我们需要找到特定来宾和其他主机之间交换的消息的总和。因此，我们对guest_id字段进行分组，并找到guest_id交换的消息总数。</p><pre class="ki kj kk kl fd lf lg lh li aw lj bi"><span id="16ac" class="lk ig hi lg b fi ll lm l ln lo"><strong class="lg hj">select  id_guest, sum(n_messages) from airbnb_contacts group by id_guest;</strong></span></pre><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es lp"><img src="../Images/060e959a2b991a85a6e27cde90fe83aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*Tv1EzoAepSV4K7DErMrBBA.jpeg"/></div><figcaption class="lb lc et er es ld le bd b be z dx"><strong class="bd ih">Few Records from the Output of Above Query</strong></figcaption></figure><p id="fe29" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj">第二步:使用Dense_rank()为guest_id分配等级</strong></p><p id="33f0" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">我们需要再输出一个名为rank的列，它将根据每个客人交换的消息总数列出他们的等级，并按降序排序。考虑到问题中明确提出了为具有相同数量消息的来宾分配相同等级并防止跳过等级的要求，我们可以使用dense rank()窗口函数来实现这一点。在over()内部，我们不会给出任何partition by子句，因为我们必须将整个结果集视为一个分区。我们将只使用order by子句对邮件总数进行降序排列来分配等级。</p><pre class="ki kj kk kl fd lf lg lh li aw lj bi"><span id="7503" class="lk ig hi lg b fi ll lm l ln lo"><strong class="lg hj">select  dense_rank() over(order by sum(n_messages) desc) ,<br/>        id_guest,<br/>        sum(n_messages)<br/>        from airbnb_contacts<br/>        group by id_guest;</strong></span></pre><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es lq"><img src="../Images/fb4fa1853493038d865fadabb7806621.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*rh1aSubqbaO6AjsQ4yjKAQ.jpeg"/></div></figure></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><p id="97e9" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">实际上，需要将问题分解成更小的问题。在阅读问题两遍后，决定使用哪些列来计算期望的结果。之后，确定计算每个子问题所需的函数，然后尝试连接子问题的解决方案。使用这种方法，你可以快速解决任何问题。接触将提高你开发解决问题的新方法和途径的能力。<br/>感谢你阅读我的帖子并回复我；这对我意义重大。如果你喜欢它，竖起大拇指，点击“关注”在媒体上关注我，以便在我发布新内容时得到通知。</p></div></div>    
</body>
</html>