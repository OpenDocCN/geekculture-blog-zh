<html>
<head>
<title>Graph Databases Comparison: NebulaGraph vs. Dgraph vs. JanusGraph</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">图表数据库比较:nebula graph vs . Dgraph vs . Janus graph</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/graph-databases-comparison-nebulagraph-vs-dgraph-vs-janusgraph-bb785db819fe?source=collection_archive---------5-----------------------#2022-09-07">https://medium.com/geekculture/graph-databases-comparison-nebulagraph-vs-dgraph-vs-janusgraph-bb785db819fe?source=collection_archive---------5-----------------------#2022-09-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/aebe5f224d948ae6456cedabd23d3eab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*onPn15XTjDQvL5W_.png"/></div></div></figure><p id="6e69" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">深度学习和知识图谱技术近年来发展迅速。与深度学习的“黑盒”相比，知识图具有高度的可解释性，因此在搜索推荐、智能客户支持和金融风险管理等场景中被广泛采用。美团在过去几年中一直在深入挖掘隐藏在海量商业数据中的联系，并逐步开发了近十个领域的知识图表，包括美食图表、旅游图表和商品图表。最终目标是提升智能本地生活。</p><p id="52d8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">与传统的关系数据库相比，图数据库可以有效地存储和查询知识图。选择图数据库作为存储引擎在多跳查询中具有明显的性能优势。目前，市场上有几十种图形数据库解决方案。美团团队当务之急是选择一个能够满足业务需求的图数据库解决方案，并将该解决方案作为美团的图存储和图学习平台的基础。该团队根据我们的业务现状概述了以下基本要求:</p><ol class=""><li id="c30d" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">这应该是一个开源项目，也是商业友好的，通过控制源代码，美团团队可以确保数据安全和服务可用性。</li><li id="9145" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">它应该支持聚类，并且应该能够在存储和计算能力方面进行水平扩展。美团中的知识图数据大小总共可以达到数千亿个顶点和边，吞吐量可以达到数万个QPS。话虽如此，单节点部署无法满足美团的存储需求。</li><li id="ef6a" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">它应该在OLTP场景下工作，具有毫秒级的多跳查询能力。为了确保美团用户的最佳搜索体验，团队严格限制了所有路径链的超时值。因此，在第二级响应查询是不可接受的。</li><li id="5d7c" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">它应该能够批量导入数据知识图数据通常存储在像Hive这样的数据仓库中。图形数据库应该具备将数据从这些仓库快速导入图形存储的能力，以确保服务的有效性。</li></ol><p id="8518" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">美团团队在<a class="ae kc" href="https://db-engines.com/" rel="noopener ugc nofollow" target="_blank"> DB-Engines </a>上尝试了排名前30的图数据库，发现大多数知名的图数据库只支持其开源版本的单节点部署，例如Neo4j、ArangoDB、Virtuoso、TigerGraph、RedisGraph。这意味着存储服务无法横向扩展，无法满足存储大规模知识图数据的需求。经过彻底的研究和比较，该团队为最后一轮选择了以下图形数据库:NebulaGraph、Dgraph和HugeGraph。</p><h1 id="9658" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">测试过程的总结</h1><h2 id="a9be" class="lb ke hi bd kf lc ld le kj lf lg lh kn jb li lj kr jf lk ll kv jj lm ln kz lo bi translated">硬件配置</h2><ol class=""><li id="7d19" class="jo jp hi is b it lp ix lq jb lr jf ls jj lt jn jt ju jv jw bi translated">数据库实例:运行在不同机器上的Docker容器</li><li id="a75a" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">单实例资源:32个内核、64 GB内存、1 TB固态硬盘(英特尔至强金牌5218 CPU @ 2.30 GHz)</li><li id="96be" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">实例数量:三个</li></ol><h2 id="20fe" class="lb ke hi bd kf lc ld le kj lf lg lh kn jb li lj kr jf lk ll kv jj lm ln kz lo bi translated">部署计划</h2><p id="d75e" class="pw-post-body-paragraph iq ir hi is b it lp iv iw ix lq iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">星云图1.0.1版</p><p id="e4e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">元服务负责管理集群元数据。查询服务负责查询的执行。存储服务负责存储分片数据。RocksDB充当存储后端。请参见下面的详细信息:</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div class="er es lx"><img src="../Images/94dcd3db5fc02524dff9a6c898843029.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*EiSeO72KkBf1SBthNRmuGA.png"/></div></figure><p id="89ec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">图表v20.07.0</p><p id="ac3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Zero负责集群元数据管理。Alpha负责查询执行和数据存储。存储后端由Dgraph开发。请参见下面的详细信息:</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/9d08c7057f22c0cc40ed844dd7324b0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*tjCvUrWB4aJeglmwc28rbg.png"/></div></figure><p id="4c30" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">HugeGraph v0.10.4</p><p id="bb6d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">HugeServer负责集群元数据管理和查询执行。尽管HugeGraph支持RocksDB作为存储后端，但它不支持RocksDB作为集群的存储后端。因此，该团队选择HBase作为存储后端。请参见下面的详细信息:</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div class="er es md"><img src="../Images/ec97be0a6c8fe2fa0c201ad943a2d1e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*T9r-5uYoCiXbAYmMvDXo1Q.png"/></div></figure></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><p id="6943" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用于基准测试的数据集</p><p id="bc58" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该团队使用<a class="ae kc" href="https://github.com/ldbc" rel="noopener ugc nofollow" target="_blank"> LDBC </a>数据集进行基准测试。</p><figure class="ly lz ma mb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/bb1c36660d89a6ec9c4650dc68ae67cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cGW-i6byVmLzqTlk.png"/></div></div></figure><p id="758f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下是对数据集中数据的简要介绍:</p><ol class=""><li id="d0bd" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">数据生成参数:分支=稳定，版本=0.3.3，规模=1000</li><li id="9c54" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">实体:四类26亿个实体</li><li id="449d" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">关系:19种类型的177亿个关系</li><li id="6977" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">数据格式:CSV</li><li id="af74" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">压缩后的数据大小:194 GB</li></ol><h1 id="9231" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">基准测试结果</h1><p id="3614" class="pw-post-body-paragraph iq ir hi is b it lp iv iw ix lq iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">基准测试从三个角度进行，即批量数据导入、实时数据写入和数据查询。</p><h2 id="0dd5" class="lb ke hi bd kf lc ld le kj lf lg lh kn jb li lj kr jf lk ll kv jj lm ln kz lo bi translated">批量数据导入</h2><p id="cfc9" class="pw-post-body-paragraph iq ir hi is b it lp iv iw ix lq iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">批量导入数据的步骤如下:</p><ol class=""><li id="aab2" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">在配置单元中生成CSV文件</li><li id="e52d" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">图形数据库支持的中间文件</li><li id="8281" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">将数据导入图形数据库</li></ol><p id="62a2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每个图形数据库中的数据导入过程描述如下:</p><ul class=""><li id="593a" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn mm ju jv jw bi translated">敬星云图。在Hive中执行Spark任务，在RocksDB中生成SST文件；然后把SST文件上传到NebulaGraph。</li><li id="2f40" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn mm ju jv jw bi translated">敬Dgraph。在Hive中执行Spark任务，生成RDF文件；然后执行批量加载操作，为集群的每个节点生成持久文件。</li><li id="41d4" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn mm ju jv jw bi translated">敬HugeGraph。执行loader直接将数据从Hive插入CSV文件中的HugeGraph。</li></ul><p id="4980" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">数据导入检测结果</strong></p><p id="1439" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据库|导入方式|每一步消耗的时间|导入前占用(gziped)|导入后占用|空间放大比|节点间负载均衡-|-|-|-|-|-|-星云|1。Hive-&gt;sst文件<br/> 2。sst文件- &gt; DB|1。3.0h <br/> 2。0.4h | 194g | 518g | 2.67 x | 176g/171g/171g<br/>节点间均衡Dgraph|1。Hive- &gt; rdf文件<br/> 2。rdf文件- &gt; DB |1。4.0h <br/> 2。8.7h <br/> OOM |4.2G <br/>不能全尺寸进口。|24G <br/>导入的用户关系仅用于空间放大测试|5.71x|1G/1G/22G <br/>节点间不平衡HugeGraph|1。蜂巢- &gt; csv <br/> 2。csv- &gt; DB|1。2.0h <br/> 2。9.1h <br/>磁盘空间不足|4.2G <br/>无法以完整大小导入。|41G <br/>导入的用户关系仅用于空间放大测试|9.76x|11G/5G/25G <br/>节点间不平衡</p><p id="64fa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从上面的结果可以看出，该团队发现NebulaGraph的性能最好，因为它的时间消耗最低，存储放大比最小。数据按主键散列分布，存储在节点间平衡。</p><p id="4d1e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在Dgraph中，原始数据大小为194 GB，服务器内存为392 GB由于OOM，大容量装载操作在8.7小时后暂停，导致部分成功。RDF模型中的数据由谓词分布，一种类型的关系只能存储在同一个节点上，这导致了节点间存储和计算的严重不平衡。</p><p id="7917" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在HugeGraph中，原始数据大小为194GB。执行数据导入操作时，1000GB的节点已满，导入部分成功。HugeGraph中存储放大倍数最大，节点间数据分布严重不平衡。</p><h2 id="81f2" class="lb ke hi bd kf lc ld le kj lf lg lh kn jb li lj kr jf lk ll kv jj lm ln kz lo bi translated">实时数据写入</h2><p id="8b7b" class="pw-post-body-paragraph iq ir hi is b it lp iv iw ix lq iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">该测试旨在实时向图形数据库插入顶点和边，并测试每个数据库的写入性能。下面是如何定义指标的简要描述。</p><ol class=""><li id="0d3e" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated"><strong class="is hj">响应时间。</strong>以固定的QPS发送50，000个写请求，记录成功发送所有请求所用的时间。根据avg、p99和p999，获得从发送请求到在客户端收到响应所消耗的时间。</li><li id="4b4b" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><strong class="is hj">最大吞吐量。</strong>以逐渐增加的QPS发送1，000，000个写请求，并持续查询数据。一分钟内的峰值QPS(成功的请求)是最大的吞吐量。</li></ol><p id="ec85" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">如何将节点插入图形数据库</strong></p><p id="8549" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">星云图</p><pre class="ly lz ma mb fd mn mo mp mq aw mr bi"><span id="9d31" class="lb ke hi mo b fi ms mt l mu mv">INSERT VERTEX t_rich_node (creation_date, first_name, last_name, gender, birthday, location_ip, browser_used) VALUES ${mid}:('2012-07-18T01:16:17.119+0000', 'Rodrigo', 'Silva', 'female', '1984-10-11', '84.194.222.86', 'Firefox')</span></pre></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><p id="d265" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据图表</p><pre class="ly lz ma mb fd mn mo mp mq aw mr bi"><span id="0280" class="lb ke hi mo b fi ms mt l mu mv">{<br/>    set {<br/>        &lt;${mid}&gt; &lt;creation_date&gt; "2012-07-18T01:16:17.119+0000" .<br/>        &lt;${mid}&gt; &lt;first_name&gt; "Rodrigo" .<br/>        &lt;${mid}&gt; &lt;last_name&gt; "Silva" .<br/>        &lt;${mid}&gt; &lt;gender&gt; "female" .<br/>        &lt;${mid}&gt; &lt;birthday&gt; "1984-10-11" .<br/>        &lt;${mid}&gt; &lt;location_ip&gt; "84.194.222.86" .<br/>        &lt;${mid}&gt; &lt;browser_used&gt; "Firefox" .<br/>    }<br/>}</span></pre></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><p id="3573" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">胡格格拉夫</p><pre class="ly lz ma mb fd mn mo mp mq aw mr bi"><span id="368f" class="lb ke hi mo b fi ms mt l mu mv">g.addVertex(T.label, "t_rich_node", T.id, ${mid}, "creation_date", "2012-07-18T01:16:17.119+0000", "first_name", "Rodrigo", "last_name", "Silva", "gender", "female", "birthday", "1984-10-11", "location_ip", "84.194.222.86", "browser_used", "Firefox")</span></pre><p id="6304" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">如何在图形数据库中插入边</strong></p><p id="7010" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">星云图</p><pre class="ly lz ma mb fd mn mo mp mq aw mr bi"><span id="c827" class="lb ke hi mo b fi ms mt l mu mv">INSERT EDGE t_edge () VALUES ${mid1}-&gt;${mid2}:();</span></pre></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><p id="bb53" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据图表</p><pre class="ly lz ma mb fd mn mo mp mq aw mr bi"><span id="8e6c" class="lb ke hi mo b fi ms mt l mu mv">{<br/>    set {<br/>        &lt;${mid1}&gt; &lt;link&gt; &lt;${mid2}&gt; .<br/>    }<br/>}</span></pre></div><div class="ab cl me mf gp mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hb hc hd he hf"><p id="349f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">胡格格拉夫</p><pre class="ly lz ma mb fd mn mo mp mq aw mr bi"><span id="2679" class="lb ke hi mo b fi ms mt l mu mv">g.V(${mid1}).as('src').V(${mid2}).addE('t_edge').from('src')</span></pre><p id="a5a0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">实时写入测试结果</strong></p><p id="0fe4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">响应时间</strong></p><p id="57e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">实时写入<br/>响应时间(毫秒)|在QPS插入顶点= 100<br/>avg/p99/p999 |在QPS插入边=100 <br/> avg / p99 / p999 -|-|-星云| 3/10/38 | 3/10/34 DGraph | 5/13/54 | 5/9/43 huge graph | 37/159/1590 | 28/93/1896</p><p id="73e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">最大吞吐量</strong></p><p id="ab04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">实时写<br/>最大吞吐量|插入顶点<br/>QPS |插入边缘<br/> QPS -|-|-星云| 84000 | 76000 DGraph | 10138 | 9600 huge graph | 410 | 457</p><p id="70b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">实时写测试结果分析</strong></p><p id="cba4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从上面的结果可以看出，NebulaGraph的响应时间和吞吐量在测试中处于领先地位，因为由于其架构，写请求可以分布到多个存储节点。</p><p id="3df4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在Dgraph中，响应时间和吞吐量与NebulaGraph相比并不好，因为一种类型的关系可以按照其结构存储在相同的节点上。</p><p id="f51e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">HugeGraph在响应时间和吞吐量方面表现最差，因为存储后端是HBase，其并发读写能力低于RocksDB(Nebula Graph采用)和BadgerDB(d Graph采用)。</p><h2 id="b8cd" class="lb ke hi bd kf lc ld le kj lf lg lh kn jb li lj kr jf lk ll kv jj lm ln kz lo bi translated">数据查询</h2><p id="cc96" class="pw-post-body-paragraph iq ir hi is b it lp iv iw ix lq iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">数据查询基准测试是为了测试候选图形数据库的读取性能，它基于以下常见查询:返回ID的n跳查询、返回属性的n跳查询和共享朋友查询。下面是如何定义指标的简要描述。</p><ol class=""><li id="48f8" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated"><strong class="is hj">响应时间</strong>。以固定的QPS发送50，000个读取请求，并记录发送所有请求所用的时间。根据avg、p99和p999，获得从发送请求到在客户端收到响应所消耗的时间。如果在发送读取请求后60秒内没有收到响应，则返回超时错误。</li><li id="0107" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><strong class="is hj">最大吞吐量。</strong>以逐渐增加的QPS发送1，000，000个读取请求，并持续查询数据。一分钟内的峰值QPS(成功的请求)是最大的吞吐量。</li><li id="7230" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><strong class="is hj">缓存配置</strong>。该测试中的所有图形数据库都支持从高速缓存中读取，并且该特性在默认情况下是打开的。每次进行测试之前，团队都会清理服务器缓存。</li></ol><p id="575a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">返回ID为的N跳查询示例代码</strong></p><p id="1a1b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">星云图</p><pre class="ly lz ma mb fd mn mo mp mq aw mr bi"><span id="28dd" class="lb ke hi mo b fi ms mt l mu mv">GO ${n} STEPS FROM ${mid} OVER person_knows_person</span></pre><p id="f435" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据图表</p><pre class="ly lz ma mb fd mn mo mp mq aw mr bi"><span id="babf" class="lb ke hi mo b fi ms mt l mu mv">{<br/> q(func:uid(${mid})) {<br/>   uid<br/>   person_knows_person { #${n}Hops = Embedded layers<br/>     uid<br/>   }<br/> }<br/>}</span></pre><p id="578a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">胡格格拉夫</p><pre class="ly lz ma mb fd mn mo mp mq aw mr bi"><span id="6498" class="lb ke hi mo b fi ms mt l mu mv">g.V(${mid}).out().id() #${n}Hops = out()Length of the link</span></pre><p id="7eca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">返回属性的N跳查询示例代码</strong></p><p id="b8e6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">星云图</p><pre class="ly lz ma mb fd mn mo mp mq aw mr bi"><span id="7ef3" class="lb ke hi mo b fi ms mt l mu mv">GO ${n} STEPS FROM ${mid} OVER person_knows_person YIELDperson_knows_person.creation_date, $$.person.first_name, $$.person.last_name, $$.person.gender, $$.person.birthday, $$.person.location_ip, $$.person.browser_used</span></pre><p id="6278" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据图表</p><pre class="ly lz ma mb fd mn mo mp mq aw mr bi"><span id="8a4f" class="lb ke hi mo b fi ms mt l mu mv">{<br/>  q(func:uid(${mid})) {<br/>    uid first_name last_name gender birthday location_ip browser_used<br/>    person_knows_person { #${n}Hops = Embedded layers<br/>      uid first_name last_name gender birthday location_ip browser_used<br/>    }<br/>  }<br/>}</span></pre><p id="c50f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">胡格格拉夫</p><pre class="ly lz ma mb fd mn mo mp mq aw mr bi"><span id="e0df" class="lb ke hi mo b fi ms mt l mu mv">g.V(${mid}).out()  #${n}Hops = out()Length of the link</span></pre><p id="3143" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">共享好友查询示例代码</strong></p><p id="711c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">星云图</p><pre class="ly lz ma mb fd mn mo mp mq aw mr bi"><span id="c4d6" class="lb ke hi mo b fi ms mt l mu mv">GO FROM ${mid1} OVER person_knows_person INTERSECT GO FROM ${mid2} OVER person_knows_person</span></pre><p id="567d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据图表</p><pre class="ly lz ma mb fd mn mo mp mq aw mr bi"><span id="2fae" class="lb ke hi mo b fi ms mt l mu mv">{<br/>  var(func: uid(${mid1})) {<br/>    person_knows_person {<br/>      M1 as uid<br/>    }<br/>  }<br/>  var(func: uid(${mid2})) {<br/>    person_knows_person {<br/>      M2 as uid<br/>    }<br/>  }<br/>  in_common(func: uid(M1)) @filter(uid(M2)){<br/>    uid<br/>  }<br/>}</span></pre><p id="b380" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">胡格格拉夫</p><pre class="ly lz ma mb fd mn mo mp mq aw mr bi"><span id="d498" class="lb ke hi mo b fi ms mt l mu mv">g.V(${mid1}).out().id().aggregate('x').V(${mid2}).out().id().where(within('x')).dedup()</span></pre><p id="7710" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">返回ID为的N跳查询的测试结果</strong></p><p id="31fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ID为的N跳查询返回<br/>响应时间(毫秒)|N = 1，QPS = 100 <br/> avg / p99 / p999|N = 2，QPS = 100 <br/> avg / p99 / p999|N = 3，QPS = 10 <br/> avg / p99 / p999 -|-|-|-星云| 4/13/45 | 24/160/268 | 1908/11304/11304d graph</p><p id="9a49" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ID为的N跳查询返回了<br/>最大吞吐量(QPS)|N = 1 <br/>返回的平均邻居数= 62|N = 2 <br/>返回的平均邻居数= 3844|N = 3 <br/>返回的平均邻居数= 238328-|-|-|-Nebula | 80830 | 6950 | 32 Dgraph | 8558 | 100 | time out huge graph | 804 | time out | time out</p><p id="de19" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">返回了属性的N跳查询的测试结果</strong></p><p id="6631" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">单个顶点上属性的平均大小是200字节。</p><p id="dd87" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">返回属性的N跳查询<br/>响应时间(毫秒)|N = 1，QPS = 100 <br/> avg / p99 / p999|N = 2，QPS = 100 <br/> avg / p99 / p999|N = 3，QPS = 10 <br/> avg / p99 / p999 -|-|-|-星云| 5/20/49 | 99/475/1645 | 48052/&gt;60s/&gt;60s DG</p><p id="450d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ID为的N跳查询返回了<br/>最大吞吐量(QPS)|N = 1 <br/>返回的平均邻居数= 62|N = 2 <br/>返回的平均邻居数= 3844|N = 3 <br/>返回的平均邻居数= 238328-|-|-|-Nebula | 36400 | 730 | 2dgraph | 80 | time out | time out huge graph | 802 | time out | time out</p><p id="68c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">共享好友查询的测试结果</strong></p><p id="bc83" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mw">该测试不包括最大吞吐量。</em></p><p id="1a15" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">共享好友查询<br/>响应时间(毫秒)| QPS = 100 <br/> avg / p99 / p999 -|-|-星云| 4/20/42 Dgraph | 4/13/36 huge graph | 39/366/1630</p><p id="374b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">数据查询检测结果分析</strong></p><p id="d5d9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在返回ID的一跳查询的响应时间(延迟)测试中，NebulaGraph和Dgraph需要搜索一次外出边。由于Dgraph中的存储架构，相同类型的边存储在同一个节点中。因此，Dgraph中的一跳查询不存在网络消耗。在星云图中，边被分布到多个节点，这就是为什么Dgraph在这次测试中比星云图表现得稍微好一点。</p><p id="beb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在返回ID的一跳查询的吞吐量(QPS)测试中，集群的CPU负载受到存储边的单个节点的限制，导致集群的CPU占用率较低。所以Dgraph的最大吞吐量只有那个od星云图的11%。</p><p id="9624" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在返回ID的两跳查询的响应时间(延迟)测试中，由于上述相同的原因，当QPS设置为100时，Dgraph中的实际负载几乎达到了集群的上限。因此，Dgraph中的潜伏期显著延长至星云图中的3.9x。</p><p id="67ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在返回属性的单跳查询测试中，NebulaGraph将顶点上的所有属性作为数据结构存储在单个节点中。因此，搜索的次数等于输出边y的数量。在Dgraph中，顶点上的属性被视为输出边，并被分配给不同的节点。因此，搜索的数量等于X(即属性的数量)和Y(即输出边的数量)的乘积。正因如此，Dgraph的性能比星云图差。同样的规则也适用于多级跳查询。</p><p id="510c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">共享好友查询的测试与返回ID的两个单跳查询的测试几乎相同。因此，两次测试的结果非常相似。</p><p id="fa36" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">HugeGraph的存储后端是HBase，并发读写能力低于RocksDB(星云图采用)和BadgerDB(DG Graph采用)。因此，在响应时间和吞吐量方面，HugeGraph的表现比其他两个要差。</p><h1 id="72d8" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论</h1><p id="0c58" class="pw-post-body-paragraph iq ir hi is b it lp iv iw ix lq iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">美团团队最终选择了NebulaGraph作为我们的图形存储引擎，因为它在批量数据导入速度、实时写入性能和n跳查询性能方面优于其他两个候选引擎。</p><h1 id="9e96" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">参考</h1><ul class=""><li id="5ae2" class="jo jp hi is b it lp ix lq jb lr jf ls jj lt jn mm ju jv jw bi translated">NebulaGraph基准:<a class="ae kc" href="https://discuss.nebula-graph.io/t/nebula-graph-1-0-benchmark-report/581" rel="noopener ugc nofollow" target="_blank">https://discuse . nebula-graph . io/t/nebula-graph-1-0-Benchmark-report/581</a></li><li id="ea47" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn mm ju jv jw bi translated">腾讯云团队的图形数据库性能对比:<a class="ae kc" href="https://discuss.nebula-graph.io/t/performance-comparison-neo4j-vs-nebula-graph-vs-janusgraph/619" rel="noopener ugc nofollow" target="_blank">https://discuse . nebula-graph . io/t/Performance-Comparison-neo4j-vs-nebula-graph-vs-Janus graph/619</a></li><li id="fb0c" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn mm ju jv jw bi translated">Dgraph基准:【https://dgraph.io/blog/tags/benchmark/ T4】</li><li id="3203" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn mm ju jv jw bi translated">TigerGraph基准:<a class="ae kc" href="https://www.tigergraph.com/benchmark/" rel="noopener ugc nofollow" target="_blank">https://www.tigergraph.com/benchmark/</a></li><li id="394e" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn mm ju jv jw bi translated">RedisGraph Benchmark:<a class="ae kc" href="https://redislabs.com/blog/new-redisgraph-1-0-achieves-600x-faster-performance-graph-databases/" rel="noopener ugc nofollow" target="_blank">https://redis labs . com/blog/new-RedisGraph-1-0-achieves-600 x-faster-performance-graph-databases/</a></li></ul><blockquote class="mx my mz"><p id="8784" class="iq ir mw is b it iu iv iw ix iy iz ja na jc jd je nb jg jh ji nc jk jl jm jn hb bi translated"><em class="hi">本次基准测试由美团NLP团队的赵登昌和高晨进行。</em></p></blockquote></div></div>    
</body>
</html>