<html>
<head>
<title>Creating a Reactive CRUD blog app with MongoDB, Quarkus and Panache</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用MongoDB、Quarkus和Panache创建一个反应式CRUD博客应用</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/creating-a-reactive-crud-blog-app-with-mongodb-quarkus-and-panache-54d659cf8dcb?source=collection_archive---------4-----------------------#2021-07-01">https://medium.com/geekculture/creating-a-reactive-crud-blog-app-with-mongodb-quarkus-and-panache-54d659cf8dcb?source=collection_archive---------4-----------------------#2021-07-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/cddefebd677514c64f8314941b518249.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8L7StZNIv0-iZhGRTOCKQA.jpeg"/></div></div></figure><div class=""/><p id="f9a5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> MongoDB </strong>是一个广为人知的<strong class="is hu"> NoSQL </strong>数据库，使用它的原始API有不同的方式，这可能很麻烦，因为你通常需要将你的实体和查询表示为<strong class="is hu"> MongoDB </strong> <code class="du jo jp jq jr b"><a class="ae js" href="https://mongodb.github.io/mongo-java-driver/3.11/bson/documents/#document" rel="noopener ugc nofollow" target="_blank">Document</a></code>。幸运的是，有了<strong class="is hu"> Panache MongoDB </strong>扩展和<strong class="is hu"> Quarkus </strong>，很多查询已经被简化了，因为它是建立在<a class="ae js" href="https://quarkus.io/guides/mongodb" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> MongoDB客户端</strong> </a>扩展之上的。</p><p id="c361" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> MongoDB </strong>和<strong class="is hu"> Panache </strong>提供了<strong class="is hu">活动记录风格的实体</strong>(和<strong class="is hu">存储库</strong>),就像你在<a class="ae js" href="https://quarkus.io/guides/hibernate-orm-panache" rel="noopener ugc nofollow" target="_blank"> Hibernate ORM和Panache </a>中拥有的一样，并且专注于使实体更加无缝地编写查询。</p><p id="65ab" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">凭借<strong class="is hu">的派头</strong> , <strong class="is hu"> Quarkus </strong>社区采取了一种自以为是的方法来解决许多不同的问题，以增强开发人员的体验。以下是其中的几个。</p><figure class="ju jv jw jx fd hk er es paragraph-image"><div class="er es jt"><img src="../Images/a40ce78656a4025f1e08250c5545a8b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*22goUt9KrlEaHuyftgjjUQ.png"/></div></figure><blockquote class="jy jz ka"><p id="15e0" class="iq ir kb is b it iu iv iw ix iy iz ja kc jc jd je kd jg jh ji ke jk jl jm jn hb bi translated">使您的实体扩展<code class="du jo jp jq jr b">PanacheMongoEntity</code>:它有一个自动生成的ID字段。如果你需要一个定制的ID策略，你可以扩展<code class="du jo jp jq jr b">PanacheMongoEntityBase</code>,自己处理ID。</p><p id="5577" class="iq ir kb is b it iu iv iw ix iy iz ja kc jc jd je kd jg jh ji ke jk jl jm jn hb bi translated">使用公共字段。去掉愚蠢getter和setter。在幕后，我们将生成所有缺少的getters和setters，并重写对这些字段的每个访问以使用访问器方法。通过这种方式，您仍然可以在需要时编写<em class="ht">有用的</em>访问器，即使您的实体用户仍然使用字段访问，这些访问器也会被使用。</p><p id="f592" class="iq ir kb is b it iu iv iw ix iy iz ja kc jc jd je kd jg jh ji ke jk jl jm jn hb bi translated">使用活动记录模式:将所有实体逻辑放在实体类的静态方法中，不要创建Dao。您的实体超类附带了许多非常有用的静态方法，您可以在您的实体类中添加自己的方法。用户只需输入<code class="du jo jp jq jr b">Person.</code>就可以开始使用你的实体<code class="du jo jp jq jr b">Person</code>，并在一个地方完成所有操作。</p><p id="0236" class="iq ir kb is b it iu iv iw ix iy iz ja kc jc jd je kd jg jh ji ke jk jl jm jn hb bi translated">不要编写查询中不需要的部分:编写<code class="du jo jp jq jr b">Person.find("order by name")</code>或<code class="du jo jp jq jr b">Person.find("name = ?1 and status = ?2", "Loïc", Status.Alive)</code>或者更好的<code class="du jo jp jq jr b">Person.find("name", "Loïc")</code>。</p></blockquote><p id="be98" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">只是深入研究之前的一个旁注。</p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="3bb0" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">处理</h1><blockquote class="jy jz ka"><p id="fb21" class="iq ir kb is b it iu iv iw ix iy iz ja kc jc jd je kd jg jh ji ke jk jl jm jn hb bi translated">MongoDB从4.0版本开始提供ACID事务。Panache的MongoDB不支持它们。</p></blockquote><h1 id="1e17" class="km kn ht bd ko kp lk kr ks kt ll kv kw kx lm kz la lb ln ld le lf lo lh li lj bi translated">问题域</h1><p id="3e79" class="pw-post-body-paragraph iq ir ht is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">对于这个crud应用程序，我们将把<strong class="is hu">帖子</strong>和<strong class="is hu">评论</strong>作为一种通用的博客格式来管理。典型的1:N关系。</p><p id="14ca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由于在<strong class="is hu"> MongoDB </strong>中没有级联，我们在自己的场景中管理集合和它们在不同操作中的引用。在这个场景中，我们将使用包含实体方法的活动记录模式。然而，由于我们在NoSQL域中，我已经将注释隔离在它们自己的集合中，以便能够在它们自己的资源端点中查询。人们可能会考虑将引用id放在包含实体的数组中以节省空间，但这是另一个不同的讨论。</p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="5cc8" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">先决条件</h1><ul class=""><li id="25bc" class="lu lv ht is b it lp ix lq jb lw jf lx jj ly jn lz ma mb mc bi translated">MongoDB≥ 4(在Docker中)</li><li id="3ee5" class="lu lv ht is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">Java 8+</li><li id="1dfe" class="lu lv ht is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">龙目岛≥ 1.18.18</li><li id="f9ce" class="lu lv ht is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">Maven ≥ 3.6.2</li></ul></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="b642" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Quarkus扩展</h1><pre class="ju jv jw jx fd mi jr mj mk aw ml bi"><span id="7ad0" class="mm kn ht jr b fi mn mo l mp mq">$ ./mvnw quarkus:add-extension -Dextensions="quarkus-mongodb-panache,quarkus-resteasy-reactive-jsonb"</span></pre></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="9319" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Decaring后派头反应蒙古实体</h1><p id="daae" class="pw-post-body-paragraph iq ir ht is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">这里我们扩展了<code class="du jo jp jq jr b">PanacheMongoEntity</code>:它有一个自动生成的ID字段。如果您需要一个定制的ID策略，您可以扩展<code class="du jo jp jq jr b">PanacheMongoEntityBase</code>并相应地处理ID。我们使用公共字段代替getter和setter。</p><p id="1e23" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有了活动记录模式，我们可以将所有的实体逻辑放在实体类的静态方法中，而不用创建Dao。如果需要的话，Mongo实体超类附带了许多非常有用的静态方法。这样，我们可以减少很多样板文件，使用提供给我们的完整方法。</p><p id="3d4a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Quarkus处理一些基本的日期类型转换:所有类型为<code class="du jo jp jq jr b">Date</code>、<code class="du jo jp jq jr b">LocalDate</code>、<code class="du jo jp jq jr b">LocalDateTime</code>或<code class="du jo jp jq jr b">Instant</code>的字段将使用<code class="du jo jp jq jr b">ISODate</code>类型(UTC datetime)映射到<a class="ae js" href="https://docs.mongodb.com/manual/reference/bson-types/#document-bson-type-date" rel="noopener ugc nofollow" target="_blank"> BSON日期</a>。MongoDB POJO编解码器不支持<code class="du jo jp jq jr b">ZonedDateTime</code>和<code class="du jo jp jq jr b">OffsetDateTime</code>，所以您应该在使用之前转换它们。</p><figure class="ju jv jw jx fd hk"><div class="bz dy l di"><div class="mr ms l"/></div></figure></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="daaf" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">声明注释Panache反应Mongo实体</h1><p id="77f4" class="pw-post-body-paragraph iq ir ht is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">同样的<strong class="is hu">活动记录</strong>原则也适用于上述情况。</p><figure class="ju jv jw jx fd hk"><div class="bz dy l di"><div class="mr ms l"/></div></figure></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="bb94" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">API发布资源端点</h1><p id="35d2" class="pw-post-body-paragraph iq ir ht is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">在<code class="du jo jp jq jr b">search2</code>调用中，查询时有几个选项可供选择。有一种普通文档查询、raw JSON查询或PancheQL查询，它们可以让人想起JPA查询语言。</p><figure class="ju jv jw jx fd hk"><div class="bz dy l di"><div class="mr ms l"/></div></figure></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="bf90" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">API注释资源端点</h1><figure class="ju jv jw jx fd hk"><div class="bz dy l di"><div class="mr ms l"/></div></figure></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="181e" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">运转</h1><p id="243c" class="pw-post-body-paragraph iq ir ht is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">运行MongoDB数据库。</p><pre class="ju jv jw jx fd mi jr mj mk aw ml bi"><span id="30d7" class="mm kn ht jr b fi mn mo l mp mq">$ docker run -ti --rm -p 27017:27017 mongo:4.0</span></pre><p id="89c8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用实时编码预览运行quarkus应用程序。</p><pre class="ju jv jw jx fd mi jr mj mk aw ml bi"><span id="9fe1" class="mm kn ht jr b fi mn mo l mp mq">$ ./mvnw compile quarkus:dev</span></pre></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="6261" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">API调用</h1><p id="49c2" class="pw-post-body-paragraph iq ir ht is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">为我们的博客创建帖子</p><pre class="ju jv jw jx fd mi jr mj mk aw ml bi"><span id="260d" class="mm kn ht jr b fi mn mo l mp mq">$ curl <!-- -->-X<!-- --> POST "localhost:8080/posts"<br/><br/>{<br/>"title":"A new title",<br/>"content":"This is some sample content",<br/>"author":"John Doe",<br/>}</span></pre><p id="9f93" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">给帖子添加评论</p><pre class="ju jv jw jx fd mi jr mj mk aw ml bi"><span id="a958" class="mm kn ht jr b fi mn mo l mp mq">$ curl <!-- -->-X <!-- -->PUT "localhost:8080/posts/60db336deb401c61ad7c559c"<br/><br/>{<br/>    "content":"This is a comment"<br/>}</span></pre><p id="50a4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">给定时间间隔搜索帖子</p><pre class="ju jv jw jx fd mi jr mj mk aw ml bi"><span id="216a" class="mm kn ht jr b fi mn mo l mp mq">$ curl "localhost:8080/posts/search?dateFrom=2021-06-17T00:00:00.000Z&amp;dateTo=2022-06-17T00:00:00.000Z"</span></pre></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="5e02" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">API响应</h1><p id="1677" class="pw-post-body-paragraph iq ir ht is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">获得所有帖子的回复</p><pre class="ju jv jw jx fd mi jr mj mk aw ml bi"><span id="e4f0" class="mm kn ht jr b fi mn mo l mp mq">[<br/>   {<br/>      "id":"60dc9301971c0d514f62792e",<br/>      "author":"John Doe",<br/>      "comments":[<br/>         {<br/>            "id":"60dc930f971c0d514f62792f",<br/>            "content":"This is a comment",<br/>            "creationDate":"2021-06-30T17:51:43.781"<br/>         }<br/>      ],<br/>      "content":"This is some sample content",<br/>      "creationDate":"2021-06-30T17:51:29.812",<br/>      "title":"A new title"<br/>   }<br/>]</span></pre></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="0f28" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">测试</h1><p id="5b82" class="pw-post-body-paragraph iq ir ht is b it lp iv iw ix lq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">现在我们可以开始深入细节，添加适当的<strong class="is hu">错误处理</strong>、<strong class="is hu">测试</strong>和<strong class="is hu">故障场景</strong>。Quarkus在测试具有活动记录模式的实体时提供了一组辅助方法。这里是依赖性。</p><pre class="ju jv jw jx fd mi jr mj mk aw ml bi"><span id="03e8" class="mm kn ht jr b fi mn mo l mp mq">&lt;dependency&gt;<br/>    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;<br/>    &lt;artifactId&gt;quarkus-panache-mock&lt;/artifactId&gt;<br/>    &lt;scope&gt;test&lt;/scope&gt;<br/>&lt;/dependency&gt;</span></pre><p id="4c63" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更多关于使用模仿方法的信息可以在这里找到。有了Quarkus 2.0，我们可以添加测试并在实时重新加载期间运行它们，因此不需要在开发模式下单独运行测试。</p><div class="hh hi ez fb hj mt"><a href="https://quarkus.io/guides/mongodb-panache#using-the-active-record-pattern" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab dw"><div class="mv ab mw cl cj mx"><h2 class="bd hu fi z dy my ea eb mz ed ef hs bi translated">Quarkus -简化的MongoDB</h2><div class="na l"><h3 class="bd b fi z dy my ea eb mz ed ef dx translated">Kotlin数据类是定义数据载体类的一种非常方便的方式，使它们成为定义数据载体类的一个很好的匹配</h3></div><div class="nb l"><p class="bd b fp z dy my ea eb mz ed ef dx translated">quarkus.io</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh hp mt"/></div></div></a></div><p id="bf7e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请记住，<strong class="is hu"> Panache </strong>的主要意图是通过使用查询和API来简化事情，但是如果需要，总是可以选择使用<strong class="is hu"> MongoDB客户端扩展</strong>，因为Panache正在幕后使用它。</p><p id="3693" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想看完整的源代码，可以在GitHub上找到。</p><p id="bb4e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae js" href="https://github.com/dvddhln/quarkus-crud-reactive-mongodb" rel="noopener ugc nofollow" target="_blank">在这里找到GitHub源码项目</a></p><p id="aa1c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">其他有用的资源可以在下面的链接中找到。</p><p id="4dc1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">祝你好运！</p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><div class="ju jv jw jx fd mt"><a href="https://quarkus.io/guides/mongodb-panache" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab dw"><div class="mv ab mw cl cj mx"><h2 class="bd hu fi z dy my ea eb mz ed ef hs bi translated">Quarkus -简化的MongoDB</h2><div class="na l"><h3 class="bd b fi z dy my ea eb mz ed ef dx translated">Kotlin数据类是定义数据载体类的一种非常方便的方式，使它们成为定义数据载体类的一个很好的匹配</h3></div><div class="nb l"><p class="bd b fp z dy my ea eb mz ed ef dx translated">quarkus.io</p></div></div><div class="nc l"><div class="ni l ne nf ng nc nh hp mt"/></div></div></a></div><div class="hh hi ez fb hj mt"><a href="https://quarkus.io/guides/mongodb" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab dw"><div class="mv ab mw cl cj mx"><h2 class="bd hu fi z dy my ea eb mz ed ef hs bi translated">quar kus——使用MongoDB客户端</h2><div class="na l"><h3 class="bd b fi z dy my ea eb mz ed ef dx translated">首先，我们需要一个新项目。使用以下命令创建一个新项目:该命令生成一个Maven结构…</h3></div><div class="nb l"><p class="bd b fp z dy my ea eb mz ed ef dx translated">quarkus.io</p></div></div><div class="nc l"><div class="nj l ne nf ng nc nh hp mt"/></div></div></a></div></div></div>    
</body>
</html>