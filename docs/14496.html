<html>
<head>
<title>CTEs(COMMON TABLE EXPRESSIONS) IN SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL中的cte(公共表表达式)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/ctes-common-table-expressions-in-sql-f68ff26bb5b9?source=collection_archive---------6-----------------------#2022-09-06">https://medium.com/geekculture/ctes-common-table-expressions-in-sql-f68ff26bb5b9?source=collection_archive---------6-----------------------#2022-09-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/21531878af83fa285424b4652eb44d33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y6m9d87iTsrdHH-ICjwAUA.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Image from this <a class="ae hv" href="https://mode.com/blog/use-common-table-expressions-to-keep-your-sql-clean/" rel="noopener ugc nofollow" target="_blank">Blog</a></figcaption></figure><div class=""/><p id="1795" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">公共表表达式(通常称为cte)类似于临时表，它在查询执行期间创建，在查询完成后删除，并且可以在SELECT、INSERT、UPDATE和DELETE中引用。</p><blockquote class="jt ju jv"><p id="7305" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated"><strong class="ix hz">如何使用CTEs: </strong></p></blockquote><p id="7d9e" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">cte由SELECT、INSERT、UPDATE和DELETE子句之前的WITH子句定义，多个cte由逗号分隔。</p><blockquote class="jt ju jv"><p id="3b2e" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated"><strong class="ix hz">举例:</strong></p></blockquote><p id="73c6" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们看看如何将CTEs用于奥运会数据库。</p><figure class="kb kc kd ke fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ka"><img src="../Images/0bac1e1153fe3db46298cce19d1826f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PxhuvLakkNL47BW62yCvvQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">snippet from the Olympics Table</figcaption></figure><p id="438a" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们假设我们想要得到某届奥运会中年龄超过所有运动员平均年龄的运动员的数量。(例如，2016年奥运会中年龄超过2016年奥运会运动员平均年龄的运动员人数。)</p><figure class="kb kc kd ke fd hk er es paragraph-image"><div class="er es kf"><img src="../Images/d8009b031a4ef6d887fa8a2fdd79604f.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*kw5JfkDr0HslnjPwc5S8Cw.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">The name after with denotes the name of that temporary table and inside the brackets are columns of that temporary table</figcaption></figure><p id="28e8" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个CTE存储这些数据，</p><figure class="kb kc kd ke fd hk er es paragraph-image"><div class="er es kg"><img src="../Images/4c6677bbd31f966c150af93818e8136b.png" data-original-src="https://miro.medium.com/v2/resize:fit:394/format:webp/1*wo7WOjstCJV86GcBXappZA.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">result of the query inside the above defined CTE.</figcaption></figure><p id="26ca" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在一张临时桌子上。</p><p id="b848" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">可以通过放置逗号来定义多个cte。我们甚至可以通过使用两个单独的cte来改进上面的查询，一个用于夏季，另一个用于冬季。</p><figure class="kb kc kd ke fd hk er es paragraph-image"><div class="er es kh"><img src="../Images/eba3f0fbd825e36a63facd3794b3f742.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*k8YZV_0wEROCBEWzbsUdyQ.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx">Defining Multiple CTEs</figcaption></figure><p id="0d9d" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，如果我们想知道2012年冬奥会中，年龄超过该届奥运会所有运动员平均年龄的运动员人数。</p><figure class="kb kc kd ke fd hk er es paragraph-image"><div class="er es ki"><img src="../Images/5d47f1b99957c54dbe7c822999e7e013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*tP86DXL0twtubIHx3Xp8Iw.png"/></div></figure><blockquote class="jt ju jv"><p id="49de" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated"><strong class="ix hz">为什么要用CTEs: </strong></p></blockquote><p id="3a01" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用cte有几个优点，其中一些是:</p><p id="44cb" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz"> <em class="jw">提高代码的可读性:</em> </strong></p><p id="541c" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">CTEs没有使用太多的子查询并造成混乱，而是提高了SQL查询的可读性。</p><p id="f60d" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz"> <em class="jw">易于调试，易于重用:</em> </strong></p><p id="adbf" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于减少了子查询的使用并提高了可读性，所以在数据库或查询出现问题时进行调试变得更加容易。</p><p id="9b8f" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，视图和<a class="ae hv" href="https://blog.devops.dev/how-using-materialized-view-can-improve-your-query-bc13b59b68ae?source=your_stories_page-------------------------------------" rel="noopener ugc nofollow" target="_blank">物化视图</a>做同样的事情，那么为什么要使用cte以及何时使用cte。</p><blockquote class="jt ju jv"><p id="3b19" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated"><strong class="ix hz">视图和cte:</strong></p></blockquote><p id="d008" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如前所述，cte就像一个临时表，只在查询执行时存在于内存中，如果您想在其他地方使用它，就必须再次定义它，但是视图存在于内存中，可以在查询中的任何地方使用，因此它有助于避免创建不必要的元数据。</p><p id="b6ce" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">cte没有索引，而视图有索引。</p><blockquote class="jt ju jv"><p id="0bea" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated"><strong class="ix hz">总结:</strong></p></blockquote><p id="26fc" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我们已经了解了一些关于cte(公共表表达式)以及如何利用它，还了解了它如何提高代码的可读性。</p><p id="215a" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢您的阅读……..</p></div></div>    
</body>
</html>