<html>
<head>
<title>Integrate Puppeteer as a plugin in Cypress.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将木偶师作为插件集成到Cypress中。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/integrate-puppeteer-as-a-plugin-in-cypress-1f0912d8e265?source=collection_archive---------3-----------------------#2022-01-12">https://medium.com/geekculture/integrate-puppeteer-as-a-plugin-in-cypress-1f0912d8e265?source=collection_archive---------3-----------------------#2022-01-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="6417" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">使用Cypress时需要通过不同的域登录吗？</h2><div class=""/><div class=""><h2 id="18bd" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">请继续阅读，了解如何管理这些登录密码。</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/a97a7beb77c7213ac3a2d7cee5a8cf69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3hBbk0TnycSoY3nM8Z2POQ.jpeg"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx">Photo by <a class="ae jw" href="https://unsplash.com/@pinewatt?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">pine watt</a> on <a class="ae jw" href="https://unsplash.com/s/photos/merge?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="35c7" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">在我之前的一篇文章中，我曾讨论过与木偶师合作是多么容易。这一次，我需要木偶师来解决另一个网络自动化问题。</p><p id="5114" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">我和<a class="ae jw" rel="noopener" href="/technogise/adopting-cypress-again-97eddcdc4ea2"> Cypress一起工作来自动化</a>一个功能健全的套件，它不允许跨域导航——需要登录。</p><p id="db0d" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs">T5】问题定义:T7】</strong></p><p id="8784" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">网站需要经过认证的用户，因此自动化功能测试也需要经过认证的用户。在我们的案例中，身份认证和授权由身份提供商(IdP)维护。</p><p id="0ae2" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">自然，我们想避免GUI登录，因为这超出了我们的测试范围。然而，我们尝试使用一个永久的JWT令牌——只能从自动化概要文件中接受——这次<a class="ae jw" href="https://www.linkedin.com/pulse/containerised-user-journey-automation-using-cypress-karishma-sharma/" rel="noopener ugc nofollow" target="_blank">没有成功</a>。</p><p id="2b76" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">使用IdP意味着被测应用程序(AUT)将重定向到IdP的域，而不是AUT的域。我们知道这在赛普拉斯是不允许的。所以，我们决定使用一个木偶脚本作为插件。</p><blockquote class="ku"><p id="d66e" class="kv kw hi bd kx ky kz la lb lc ld ks dx translated">他的脚本将使用Chromium登录到应用程序，并在Cypress测试使用的浏览器的本地存储中复制令牌。</p></blockquote><p id="4d10" class="pw-post-body-paragraph jx jy hi jz b ka le is kc kd lf iv kf kg lg ki kj kk lh km kn ko li kq kr ks hb bi translated"><strong class="jz hs"> <em class="kt">配置:</em> </strong></p><ul class=""><li id="f55c" class="lj lk hi jz b ka kb kd ke kg ll kk lm ko ln ks lo lp lq lr bi translated">木偶师的npm包被添加为一个依赖项。</li><li id="a080" class="lj lk hi jz b ka ls kd lt kg lu kk lv ko lw ks lo lp lq lr bi translated">这个文件有逻辑</li></ul><pre class="jh ji jj jk fd lx ly lz ma aw mb bi"><span id="c48c" class="mc md hi ly b fi me mf l mg mh">cypress/plugins/puppeteer/login.js</span></pre><ul class=""><li id="6162" class="lj lk hi jz b ka kb kd ke kg ll kk lm ko ln ks lo lp lq lr bi translated">为了让Cypress使用这个插件，配置了以下文件:</li></ul><pre class="jh ji jj jk fd lx ly lz ma aw mb bi"><span id="c43e" class="mc md hi ly b fi me mf l mg mh">plugin/index.js<br/>cypress/support/commands.ts</span></pre><ul class=""><li id="ff9f" class="lj lk hi jz b ka kb kd ke kg ll kk lm ko ln ks lo lp lq lr bi translated">在<em class="kt">cypress/support/index . js</em>中导入命令文件(如上)</li></ul><pre class="jh ji jj jk fd lx ly lz ma aw mb bi"><span id="fa66" class="mc md hi ly b fi me mf l mg mh">import ‘./commands.ts’;</span></pre><ul class=""><li id="c076" class="lj lk hi jz b ka kb kd ke kg ll kk lm ko ln ks lo lp lq lr bi translated">我们在<em class="kt">cypress/support/index . d . ts .</em>中添加了login作为可链接的接口</li></ul><p id="b2c4" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">带有使用示例的示例代码:</p><figure class="jh ji jj jk fd jl"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="ae6f" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><strong class="jz hs"> <em class="kt">管理机密:</em> </strong></p><p id="5699" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated"><a class="ae jw" href="https://docs.cypress.io/guides/guides/environment-variables#Option-5-Plugins" rel="noopener ugc nofollow" target="_blank"> Cypress </a>推荐的一种处理秘密的方式是使用插件，我选择了这个方式。下面是我如何实现它的。</p><p id="c0e4" class="pw-post-body-paragraph jx jy hi jz b ka kb is kc kd ke iv kf kg kh ki kj kk kl km kn ko kp kq kr ks hb bi translated">你可能已经注意到了，我在Cypress上使用了Typescript。你可以在这里阅读更多关于它的信息。</p></div></div>    
</body>
</html>