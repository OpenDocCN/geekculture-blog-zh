<html>
<head>
<title>Track user location in react native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在react native中跟踪用户位置</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/track-user-location-in-react-native-204bc489ed6b?source=collection_archive---------3-----------------------#2021-10-04">https://medium.com/geekculture/track-user-location-in-react-native-204bc489ed6b?source=collection_archive---------3-----------------------#2021-10-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9b4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大家好！在本文中，我们将介绍如何使用react-native-maps库跟踪react native/expo中的用户位置。</p><p id="c5ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上一篇文章中，我们解释了如何开始使用react native的react-native-maps以及基本用法。如果你没有读过，现在就去读，然后回到这一页。</p><p id="f31f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" rel="noopener" href="/geekculture/mapview-in-expo-react-native-5aa69eb81519">https://medium . com/geek culture/mapview-in-Expo-react-native-5aa 69 EB 81519</a></p><p id="7c03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将从基本设置开始</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="0e72" class="jn jo hi jj b fi jp jq l jr js">import React, { useState } from 'react';<br/>import { View, StyleSheet } from 'react-native';<br/>import MapView from 'react-native-maps';<br/>const App = () =&gt; {<br/>  const [mapRegion, setmapRegion] = useState({<br/>    latitude: 37.78825,<br/>    longitude: -122.4324,<br/>    latitudeDelta: 0.0922,<br/>    longitudeDelta: 0.0421,<br/>  }); <br/> return (<br/>    &lt;View style={styles.container}&gt;<br/>      &lt;MapView<br/>        style={{ alignSelf: 'stretch', height: '100%' }}<br/>        region={mapRegion}<br/>      /&gt;<br/>    &lt;/View&gt;<br/>  );<br/>};<br/>export default App;<br/>const styles = StyleSheet.create({<br/>  container: {<br/>    flex: 1,<br/>  },<br/>});</span></pre><p id="797a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这段代码用变量mapRegion中的坐标在屏幕上显示一幅地图，并占据设备的整个屏幕。</p><p id="0a7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们需要有权限观看当前用户的位置。为此，我们需要安装包expo-location</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="a54d" class="jn jo hi jj b fi jp jq l jr js">expo install expo-location</span></pre><p id="3712" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了在屏幕加载时请求权限，我们需要实现在屏幕加载时执行的钩子useEffect。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="0ef8" class="jn jo hi jj b fi jp jq l jr js">useEffect(() =&gt; {<br/>    (async () =&gt; {<br/>      let { status } = await  Location.requestForegroundPermissionsAsync();<br/>     if (status !== 'granted') {<br/>        setStatus('Permission to access location was denied');<br/>        return;<br/>     } else {<br/>       console.log('Access granted!!')<br/>       setStatus(status)</span><span id="4078" class="jn jo hi jj b fi jt jq l jr js">     }<br/>    <br/>    })();<br/>  }, []);</span></pre><p id="90af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们询问权限，如果我们获得授权的状态，我们就可以监视用户的位置。</p><p id="f665" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要实现这个函数watchPositionAsync</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="13bc" class="jn jo hi jj b fi jp jq l jr js">const watch_location = async () =&gt; {</span><span id="7777" class="jn jo hi jj b fi jt jq l jr js">  if (status === 'granted') {</span><span id="6915" class="jn jo hi jj b fi jt jq l jr js">     let location = await Location.watchPositionAsync({<br/>       accuracy:Location.Accuracy.High,<br/>       timeInterval: 10000,<br/>       distanceInterval: 80,<br/>       }, <br/>       false</span><span id="831a" class="jn jo hi jj b fi jt jq l jr js">       ,(location_update) =&gt; {</span><span id="1935" class="jn jo hi jj b fi jt jq l jr js">      console.log('update location!', location_update.coords)<br/>     }</span><span id="238d" class="jn jo hi jj b fi jt jq l jr js">   })}}</span></pre><p id="d84a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用这个函数，我们传递我们想要的精度，每次更新之间的时间间隔(以毫秒计)，用户必须移动的距离间隔(以米计)来更新位置。然后我们在mayShowUserSettingsDialog中传递false，最后我们有一个返回位置的回调函数。</p><p id="b2b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要知道，这个功能只在前台工作，如果用户关闭应用程序，将不会工作这个功能。为此，我们需要实现任务管理器库。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="590e" class="jn jo hi jj b fi jp jq l jr js">import React from 'react';<br/>import { Text, TouchableOpacity } from 'react-native';<br/>import * as TaskManager from 'expo-task-manager';<br/>import * as Location from 'expo-location';<br/><br/>const LOCATION_TASK_NAME = 'background-location-task';</span><span id="0d0d" class="jn jo hi jj b fi jt jq l jr js">TaskManager.defineTask(LOCATION_TASK_NAME, ({ data, error }) =&gt; {<br/>  if (error) {<br/>    // Error occurred - check `error.message` for more details.<br/>    return;<br/>  }<br/>  if (data) {<br/>    const { locations } = data;<br/>    // do something with the locations captured in the background<br/>  }<br/>});</span><span id="0b90" class="jn jo hi jj b fi jt jq l jr js">const requestPermissions = async () =&gt; {<br/> const {status} = awaitLocation.<!-- -->requestBackgroundPermissionsAsync<!-- -->();<br/>  if (status === 'granted') {<br/>    await Location.startLocationUpdatesAsync(LOCATION_TASK_NAME, {<br/>     <!-- -->accuracy:Location.Accuracy.High,<br/>       timeInterval: 10000,<br/>       distanceInterval: 80,<br/>    });<br/>  }<br/>};<br/><br/>const PermissionsButton = () =&gt; (<br/>  &lt;TouchableOpacity onPress={requestPermissions}&gt;<br/>    &lt;Text&gt;Enable background location&lt;/Text&gt;<br/>  &lt;/TouchableOpacity&gt;<br/>);<br/><br/><br/>export default PermissionsButton;</span></pre><p id="23e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个例子中，我们首先需要请求在背景中观看位置的许可。然后，我们执行函数startLocationUpdatesAsync，并传递任务的名称以及精度、时间间隔和距离间隔的参数。</p><p id="8928" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们关闭应用程序，defineTask将执行，我们可以在后台获得用户的位置，请记住，我们需要始终拥有位置权限。</p><p id="eb57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一部分中，我们将把用户正在做的路线添加到mapview中。</p><p id="fc1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">敬请期待！</p></div></div>    
</body>
</html>