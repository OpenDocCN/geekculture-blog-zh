<html>
<head>
<title>Build a Cloudinary Image Uploader with ReactJS and NodeJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用ReactJS和NodeJS构建一个Cloudinary图像上传器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/build-a-cloudinary-image-uploader-with-reactjs-and-nodejs-b2cb6bb33239?source=collection_archive---------22-----------------------#2021-05-06">https://medium.com/geekculture/build-a-cloudinary-image-uploader-with-reactjs-and-nodejs-b2cb6bb33239?source=collection_archive---------22-----------------------#2021-05-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/11d619ac435cd959c0c997f972afcb1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-eWNNIucwl_KSA-KXU2_iQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Cloudinary</figcaption></figure><p id="d0c9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这篇文章中，我们将构建一个Cloudinary上传程序，通过它我们将能够通过我们的应用程序将图像上传到cloudinary。我们将在项目中使用ReactJS和NodeJS。</p><p id="1f70" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，打开您的终端并创建一个新文件夹，在该文件夹中创建一个名为frontend的新react应用程序。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es js"><img src="../Images/73a2926835dcbd0fbbeb1091ece86c13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cOaambkmgiBhu0LvI7weFw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Initialization</figcaption></figure><p id="3d8e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们将删除项目中不需要的不必要的文件。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jx"><img src="../Images/2afd44649ef95752c5914bc9e9fb4225.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mI2XBSd2ncKozaOmXnPQMA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Remove</figcaption></figure><p id="c1a3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">从<strong class="iw hj"> index.js </strong>文件中删除，更新后的文件包含以下内容。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="0df2" class="kd ke hi jz b fi kf kg l kh ki">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import './index.css';<br/>import './base.css';<br/>import App from './App';</span><span id="bb8a" class="kd ke hi jz b fi kj kg l kh ki">ReactDOM.render(<br/>  &lt;React.StrictMode&gt;<br/>    &lt;App /&gt;<br/>  &lt;/React.StrictMode&gt;,<br/>  document.getElementById('root')<br/>);</span></pre><p id="adae" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，在<strong class="iw hj"> src </strong>文件夹中创建一个文件<strong class="iw hj"> base.css </strong>。它将包含我们的小应用程序的大部分风格。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="d306" class="kd ke hi jz b fi kf kg l kh ki">:root {<br/>    --text-color: #333;<br/>    --accent-color: rgb(15, 73, 54);<br/>    --btn-text-color: #f9f9f9;<br/>    --alert-success-bg-color: #d4edda;<br/>    --alert-success-text-color: #073813;<br/>    --alert-danger-bg-color: #dbb1b6;<br/>    --alert-danger-text-color: #3a070c;<br/>}</span><span id="6abd" class="kd ke hi jz b fi kj kg l kh ki">* {<br/>    box-sizing: border-box;<br/>    color: var(--text-color);<br/>}<br/>.container {<br/>    margin: 0 auto;<br/>    max-width: 1200px;<br/>    padding: 2rem;<br/>}</span><span id="55e9" class="kd ke hi jz b fi kj kg l kh ki">img {<br/>    border-radius: 5px;<br/>}</span><span id="9be6" class="kd ke hi jz b fi kj kg l kh ki">.nav {<br/>    display: flex;<br/>    justify-content: space-between;<br/>    align-items: center;<br/>}</span><span id="0094" class="kd ke hi jz b fi kj kg l kh ki">.nav-brand {<br/>    font-size: 24px;<br/>}</span><span id="06df" class="kd ke hi jz b fi kj kg l kh ki">.nav-items {<br/>    list-style: none;<br/>    display: flex;<br/>}</span><span id="e64f" class="kd ke hi jz b fi kj kg l kh ki">.nav-item &gt; a {<br/>    margin: 0 1rem;<br/>    text-decoration: none;<br/>    font-size: 16px;<br/>    color: #333;<br/>    padding-bottom: 2px;<br/>    font-weight: 500;<br/>    text-transform: uppercase;<br/>}<br/>.nav-item &gt; a:hover {<br/>    border-bottom: 4px solid var(--accent-color);<br/>}</span><span id="a804" class="kd ke hi jz b fi kj kg l kh ki">.title {<br/>    text-align: center;<br/>    margin-bottom: 4rem;<br/>}</span><span id="861c" class="kd ke hi jz b fi kj kg l kh ki">.btn {<br/>    padding: 0.5rem 1rem;<br/>    border: 1px solid var(--accent-color);<br/>    background-color: var(--accent-color);<br/>    color: var(--btn-text-color);<br/>    border-radius: 5px;<br/>    transition: 250ms;<br/>    cursor: pointer;<br/>    font-size: 16px;<br/>}</span><span id="aa43" class="kd ke hi jz b fi kj kg l kh ki">.btn:hover {<br/>    border: 1px solid var(--accent-color);<br/>    background-color: var(--btn-text-color);<br/>    color: var(--acent-color);<br/>}</span><span id="8624" class="kd ke hi jz b fi kj kg l kh ki">.form {<br/>    margin-bottom: 2rem;<br/>}</span><span id="fd96" class="kd ke hi jz b fi kj kg l kh ki">.form-input {<br/>    display: block;<br/>    margin-bottom: 10px;<br/>}</span><span id="e64b" class="kd ke hi jz b fi kj kg l kh ki">.alert {<br/>    padding: 1rem 2rem;<br/>    border-radius: 5px;<br/>    position: fixed;<br/>    top: 2rem;<br/>    right: 0rem;<br/>    min-width: 200px;<br/>}</span><span id="57ba" class="kd ke hi jz b fi kj kg l kh ki">.alert-success {<br/>    background-color: var(--alert-success-bg-color);<br/>    color: var(--alert-success-text-color);<br/>}</span><span id="2c3a" class="kd ke hi jz b fi kj kg l kh ki">.alert-danger {<br/>    background-color: var(--alert-danger-bg-color);<br/>    color: var(--alert-danger-text-color);<br/>}</span></pre><p id="3096" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，在<strong class="iw hj">前端</strong>文件夹中安装react路由器。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="ecdc" class="kd ke hi jz b fi kf kg l kh ki">npm i react-router-dom</span></pre><p id="6d79" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">之后更新<strong class="iw hj"> App.js </strong>文件如下。我们在这里使用路由器，有两条路径用于<strong class="iw hj">/上传</strong>和<strong class="iw hj"> / </strong>，分别加载<strong class="iw hj"> Home </strong>和<strong class="iw hj"> Upload </strong>组件。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="c48e" class="kd ke hi jz b fi kf kg l kh ki">import React from 'react';<br/>import './App.css';<br/>import { BrowserRouter as Router, Link, Switch, Route } from 'react-router-dom';<br/>import Upload from './pages/Upload.js';<br/>import Home from './pages/Home.js';</span><span id="624c" class="kd ke hi jz b fi kj kg l kh ki">function App() {<br/>    return (<br/>        &lt;div className="container"&gt;<br/>            &lt;Router&gt;<br/>                &lt;nav className="nav"&gt;<br/>                    &lt;div className="nav-brand"&gt;Cloudinary React&lt;/div&gt;<br/>                    &lt;ul className="nav-items"&gt;<br/>                        &lt;li className="nav-item"&gt;<br/>                            &lt;Link to="/"&gt;Gallery&lt;/Link&gt;<br/>                        &lt;/li&gt;<br/>                        &lt;li className="nav-item"&gt;<br/>                            &lt;Link to="/upload"&gt;Upload&lt;/Link&gt;<br/>                        &lt;/li&gt;<br/>                    &lt;/ul&gt;<br/>                &lt;/nav&gt;<br/>                &lt;Switch&gt;<br/>                    &lt;Route component={Upload} path="/upload" /&gt;<br/>                    &lt;Route component={Home} path="/" /&gt;<br/>                &lt;/Switch&gt;<br/>            &lt;/Router&gt;<br/>        &lt;/div&gt;<br/>    );<br/>}</span><span id="7b50" class="kd ke hi jz b fi kj kg l kh ki">export default App;</span></pre><p id="47cf" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">另外，删除<strong class="iw hj"> App.css </strong>中的所有内容，并更新以下内容。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="25f7" class="kd ke hi jz b fi kf kg l kh ki">.gallery {<br/>  display: grid;<br/>  grid-template-columns: repeat(auto-fit, 300px);<br/>  grid-gap: 2rem;<br/>  justify-content: center;<br/>}</span><span id="a136" class="kd ke hi jz b fi kj kg l kh ki">@media (max-width: 786px) {<br/>  .gallery {<br/>      grid-template-columns: 1fr;<br/>      justify-items: center;<br/>  }<br/>}</span></pre><p id="b16c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，在<strong class="iw hj"> src </strong>中创建一个<strong class="iw hj"> pages </strong>文件夹，并在其中创建两个文件<strong class="iw hj"> Home.js </strong>和<strong class="iw hj"> Upload.js </strong>。现在它们将只包含一个功能组件。</p><p id="1679" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Home.js 的内容如下。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="073d" class="kd ke hi jz b fi kf kg l kh ki">import React from 'react'</span><span id="1f6c" class="kd ke hi jz b fi kj kg l kh ki">const Home = () =&gt; {<br/>    return (<br/>        &lt;div&gt;<br/>            &lt;h1&gt;Home&lt;/h1&gt;<br/>        &lt;/div&gt;<br/>    )<br/>}</span><span id="5fe3" class="kd ke hi jz b fi kj kg l kh ki">export default Home</span></pre><p id="4995" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> Upload.js </strong>的内容如下。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="315a" class="kd ke hi jz b fi kf kg l kh ki">import React from 'react'</span><span id="ba45" class="kd ke hi jz b fi kj kg l kh ki">const Upload = () =&gt; {<br/>    return (<br/>        &lt;div&gt;<br/>            &lt;h1&gt;Upload&lt;/h1&gt;<br/>        &lt;/div&gt;<br/>    )<br/>}</span><span id="134c" class="kd ke hi jz b fi kj kg l kh ki">export default Upload</span></pre><p id="6cf2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，我们的基本应用程序在localhost中将如下所示。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/63f6177513972b01dbcbfd0291715a85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-iVFlmTtXpVImLn59MveWg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">localhost</figcaption></figure><p id="b7f4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，我们将开始向我们的to <strong class="iw hj"> Upload.js </strong>文件添加逻辑。这里我们添加了一个输入类型文件，它的<strong class="iw hj"> onChange </strong>调用一个函数<strong class="iw hj"> handleFileInputChange </strong>。</p><p id="a060" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，在<strong class="iw hj"> handleFileInputChange </strong>()中，我们正在调用另一个函数<strong class="iw hj"> previewFile </strong>，它在浏览器中显示所选文件的预览。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="04f4" class="kd ke hi jz b fi kf kg l kh ki">import React, { useState } from 'react'</span><span id="bf44" class="kd ke hi jz b fi kj kg l kh ki">const Upload = () =&gt; {<br/>    const [fileInputState, setFileInputState] = useState('');<br/>    const [previewSource, setPreviewSource] = useState('');</span><span id="a4d6" class="kd ke hi jz b fi kj kg l kh ki">const handleFileInputChange = (e) =&gt; {<br/>        const file = e.target.files[0];<br/>        previewFile(file);<br/>        setFileInputState(e.target.value);<br/>    };</span><span id="dccf" class="kd ke hi jz b fi kj kg l kh ki">const previewFile = (file) =&gt; {<br/>        const reader = new FileReader();<br/>        reader.readAsDataURL(file);<br/>        reader.onloadend = () =&gt; {<br/>            setPreviewSource(reader.result);<br/>        };<br/>    };</span><span id="30b8" class="kd ke hi jz b fi kj kg l kh ki">return (<br/>        &lt;div&gt;<br/>            &lt;h1&gt;Upload&lt;/h1&gt;<br/>            &lt;form&gt;<br/>                &lt;input<br/>                    id="fileInput"<br/>                    type="file"<br/>                    name="image"<br/>                    onChange={handleFileInputChange}<br/>                    value={fileInputState}<br/>                    className="form-input"<br/>                /&gt;<br/>                &lt;button className="btn" type="submit"&gt;<br/>                    Submit<br/>                &lt;/button&gt;<br/>            &lt;/form&gt;<br/>            {previewSource &amp;&amp; (<br/>                &lt;img<br/>                    src={previewSource}<br/>                    alt="chosen"<br/>                    style={{ height: '300px' }}<br/>                /&gt;<br/>            )}<br/>        &lt;/div&gt;<br/>    )<br/>}</span><span id="64eb" class="kd ke hi jz b fi kj kg l kh ki">export default Upload</span></pre><p id="af81" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，在localhost中，如果我们上传一个图像，我们将得到这个漂亮的预览。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/cfcd1b4163e85f28bdb25926ae56b994.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_f95ueeaumD35WvocYcYPg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Nice Preview</figcaption></figure><p id="b33f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，我们将把<strong class="iw hj"> onSubmit </strong>功能添加到<strong class="iw hj"> Upload.js </strong>中的表单，该表单调用函数<strong class="iw hj"> handleSubmitFile </strong>。我们还为样式添加了一个类，我们已经在<strong class="iw hj"> base.css </strong>文件中添加了这个类。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="0105" class="kd ke hi jz b fi kf kg l kh ki">&lt;form onSubmit={handleSubmitFile} className="form"&gt;</span></pre><p id="0beb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们将为<strong class="iw hj"> Upload.js </strong>文件中的<strong class="iw hj"> handleSubmitFile </strong>添加函数。这里，我们还创建了一个新的状态<strong class="iw hj"> selectedFile </strong>，我们正在handleFileInputChange()中设置它。</p><p id="6e67" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在中，我们首先读取文件并将其发送给另一个函数<strong class="iw hj"> uploadImage </strong>()，该函数获取base64编码的图像并将其传递给一个API端点<strong class="iw hj"> /api/upload </strong>，这是我们尚未创建的。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es km"><img src="../Images/6a426fdd51cd0893a4d0f0a7d542fef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ghIB_NIe48uEWVA8SNgtg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Upload.js</figcaption></figure><p id="4c3c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，在移动到后端之前，我们需要将前端与它连接起来。因此，转到<strong class="iw hj"> package.json </strong>文件并添加后端代理。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jx"><img src="../Images/364122ce61cabe2e488bcf3a2d21a371.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4-pWVEWw2zNoGnnMqd4DfA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">package.json</figcaption></figure><p id="3a92" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，在我们的项目中创建一个文件夹<strong class="iw hj">后端</strong>，并对其进行修改。之后发出命令<strong class="iw hj"> npm init </strong>。除了入口点是<strong class="iw hj"> server.js </strong>之外，您可以对所有东西按enter键</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/170a3fe7c68487c924a437394f6c3617.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mGBRD1dHasdHphSik5hF1A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">npm init</figcaption></figure><p id="2fd5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">之后，在<strong class="iw hj">后端</strong>文件夹中，我们需要安装我们的依赖项。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="d97b" class="kd ke hi jz b fi kf kg l kh ki">npm i cloudinary cors dotenv express nodemon</span></pre><p id="6b4b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，在<strong class="iw hj">后端</strong>文件夹中创建一个<strong class="iw hj"> server.js </strong>文件，并将以下内容放入其中。</p><p id="dbdc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里，我们正在做基本的节点工作，并创建一个post route，我们从前端获取base64编码的图像。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="dd09" class="kd ke hi jz b fi kf kg l kh ki">const express = require('express');<br/>const app = express();<br/>var cors = require('cors');</span><span id="4d0c" class="kd ke hi jz b fi kj kg l kh ki">app.use(express.json({ limit: '50mb' }));<br/>app.use(express.urlencoded({ limit: '50mb', extended: true }));<br/>app.use(cors());</span><span id="0de4" class="kd ke hi jz b fi kj kg l kh ki">app.post('/api/upload', async (req, res) =&gt; {<br/>    try {<br/>        const fileStr = req.body.data;<br/>        console.log(fileStr);<br/>    } catch (err) {<br/>        console.error(err);<br/>        res.status(500).json({ err: 'Something went wrong' });<br/>    }<br/>});</span><span id="62c6" class="kd ke hi jz b fi kj kg l kh ki">const port = process.env.PORT || 3001;<br/>app.listen(port, () =&gt; {<br/>    console.log('listening on 3001');<br/>});</span></pre><p id="5bb3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，用<strong class="iw hj"> nodemon server.js </strong>命令启动后端。之后，回到前端，提交一个文件，我们会看到一个大的控制台日志。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/487f5c31f4ad10f4ed1b9064d6531758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_C-4Z4Xv3qQQaVr_z1jEqQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">nodemon</figcaption></figure><p id="1e74" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，我们将配置我们的云阵列。因此，在<strong class="iw hj">后端</strong>文件夹中创建一个<strong class="iw hj"> utils </strong>文件夹，并在其中创建一个<strong class="iw hj"> cloudinary.js </strong>文件。把下面的内容放进去。在这里，我们只是做进口和使用云的秘密。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="e8b9" class="kd ke hi jz b fi kf kg l kh ki">require('dotenv').config();</span><span id="3785" class="kd ke hi jz b fi kj kg l kh ki">const cloudinary = require('cloudinary').v2;</span><span id="d182" class="kd ke hi jz b fi kj kg l kh ki">cloudinary.config({<br/>    cloud_name: process.env.CLOUDINARY_NAME,<br/>    api_key: process.env.CLOUDINARY_API_KEY,<br/>    api_secret: process.env.CLOUDINARY_API_SECRET,<br/>});</span><span id="0cc0" class="kd ke hi jz b fi kj kg l kh ki">module.exports = { cloudinary };</span></pre><p id="1eca" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，登录cloudinary.com并创建你的账户，如果你没有的话。在仪表板上，你会得到我们项目所需的三个秘密。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/ee1ad5cf724e39e5bf4c9e7088f6d96e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GIVGE7PiZGkPVS4Szq6fXQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Cloudinary</figcaption></figure><p id="1c23" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，在后端文件夹中创建一个. env文件，并将这三个秘密。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="eb09" class="kd ke hi jz b fi kf kg l kh ki">CLOUDINARY_API_KEY=4xxxxxxxxxxxxxx9<br/>CLOUDINARY_API_SECRET=rxxxxxxxxxxxxxxxxxxxxxxxxs<br/>CLOUDINARY_NAME=dxxxxxxxxxo</span></pre><p id="1ddf" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在server.js文件中创建我们的代码之前，我们需要在cloudinary中进行设置。所以，在cloudinary站点点击右上角的<strong class="iw hj">设置</strong>图标。然后点击<strong class="iw hj">上传</strong>标签。向下滚动一点，您会找到<strong class="iw hj">上传预设</strong>，在这里点击<strong class="iw hj">添加上传预设</strong>链接。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/57149d5adb0dbe005d01115be8eb7302.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9sXUGzXOUF03C1qAXZakmw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Upload</figcaption></figure><p id="6163" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在下一个屏幕中，给上传预设一个名称，签名模式为已签名，以及一个文件夹，图像将保存在其中。之后点击保存按钮。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/9b42506760eaaa1e896160ff8d581bce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fr99cDcaNW_4Q9favyuJGQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Save</figcaption></figure><p id="c8a5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在下一个屏幕中，您将获得新的预设。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/11b688ec0cf7f28c728af563d5343e64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JsW_bQheK4fJsONJogNdng.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">New presets</figcaption></figure><p id="2250" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，回到我们的<strong class="iw hj"> server.js </strong>文件中，我们将首先为cloudinary添加导入，然后在我们的帖子中，我们将使用cloudinary <strong class="iw hj">上传器</strong>将我们的图像上传到cloudinary中的<strong class="iw hj"> cloudinary_react </strong>文件夹。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/09bb4befc372eb67a15ffd94d5169201.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4U-uCtJwf04CGQF4MkoMPg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">server.js</figcaption></figure><p id="7524" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，从前端上传任何文件，它将被上传到cloudinary。注意，我们没有手动创建文件夹<strong class="iw hj"> cloudinary_react </strong>，它是由cloudinary创建的。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/312d59cd0bf098272834dc45384a24cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t-Jb-uqybD62VTsnbLI2UQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Cloudinary image</figcaption></figure><p id="14f2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们将添加一个GET请求，从我们的cloudinary文件夹中获取所有图像。因此，在我们的<strong class="iw hj"> server.js </strong>文件中添加<strong class="iw hj"> /api/images </strong>端点。</p><p id="edef" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里，我们使用inbuild cloudinary方法从我们的<strong class="iw hj"> cloudinary_react </strong>中获取文件，并将它们发送回去。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/d450b57b7853b2ca3fa53937c87b3da9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7qb5lj5je3XAYRW4v2pqAw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">server.js</figcaption></figure><p id="c3a2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，我已经从前端添加了一些图像，现在如果我们去<a class="ae ks" href="http://localhost:3001/api/images" rel="noopener ugc nofollow" target="_blank">http://localhost:3001/API/images</a>端点，我们将获得我们所有的图像。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/5b344a98692b1d141367152f4a031d35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X4YDWzOC6dF2bArze0L8Jw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">All images</figcaption></figure><p id="5085" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，在前端文件夹中用下面的命令安装cloudinary的包。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="8fd9" class="kd ke hi jz b fi kf kg l kh ki">npm i cloudinary-react</span></pre><p id="933d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，在<strong class="iw hj"> Home.js </strong>文件中更新以下内容。在这里，我们首先进行所需的导入。之后，我们从useEffect调用一个<strong class="iw hj"> loadImages </strong>()，这个函数只被调用一次。</p><p id="f5fe" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在<strong class="iw hj"> loadImages </strong>函数中，我们对/api/images进行API调用，并将数据设置为<strong class="iw hj"> imageIds </strong>状态。</p><p id="1b3e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在我们的return语句中，我们循环遍历imageIds数组，并使用来自cloudinary-react的图像来显示图像。注意，我们还需要云的名称，我们再次将它保存在一个环境变量中。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="c45f" class="kd ke hi jz b fi kf kg l kh ki">import React, { useEffect, useState } from 'react';<br/>import { Image } from 'cloudinary-react';</span><span id="9cbb" class="kd ke hi jz b fi kj kg l kh ki">export default function Home() {<br/>    const [imageIds, setImageIds] = useState();<br/>    const loadImages = async () =&gt; {<br/>        try {<br/>            const res = await fetch('/api/images');<br/>            const data = await res.json();<br/>            setImageIds(data);<br/>        } catch (err) {<br/>            console.error(err);<br/>        }<br/>    };</span><span id="837f" class="kd ke hi jz b fi kj kg l kh ki">useEffect(() =&gt; {<br/>        loadImages();<br/>    }, []);</span><span id="619b" class="kd ke hi jz b fi kj kg l kh ki">return (<br/>        &lt;div&gt;<br/>            &lt;h1 className="title"&gt;Cloudinary Gallery&lt;/h1&gt;<br/>            &lt;div className="gallery"&gt;<br/>                {imageIds &amp;&amp;<br/>                    imageIds.map((imageId, index) =&gt; (<br/>                        &lt;Image<br/>                            key={index}<br/>                            cloudName={process.env.REACT_APP_CLOUDINARY_NAME}<br/>                            publicId={imageId}<br/>                            width="300"<br/>                            height="200"<br/>                            crop="scale"<br/>                        /&gt;<br/>                    ))}<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    );<br/>}</span></pre><p id="12aa" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，创建一个<strong class="iw hj">。env </strong>文件放在<strong class="iw hj">前端</strong>文件夹中，并将我们的云名添加到其中。</p><pre class="jt ju jv jw fd jy jz ka kb aw kc bi"><span id="cc24" class="kd ke hi jz b fi kf kg l kh ki">REACT_APP_CLOUDINARY_NAME=dxxxxxxxo</span></pre><p id="ed90" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们也将它包含在<strong class="iw hj">中。gitignore </strong>文件。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jx"><img src="../Images/745e52d0174dcab43c4c8451a1d23782.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jVth0zQ22y7uVjA1PLORsw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">.gitignore</figcaption></figure><p id="cf0e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我也忘了创建一个<strong class="iw hj">。后端文件夹中的gitignore </strong>。因此，创建了相同的，并把我们的环境文件和node_modules放在其中，因为我们不想把它们推到github。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/2e2943ad7bead5faf3b2b5c562329285.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*60S3iVb64CwVx0NrMlNU7Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">.gitignore</figcaption></figure><p id="6dba" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们的应用程序现在已经完成，所有图像的上传和显示工作。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/5a27c548a8ed0946390aa60dd5e109c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*fJ-rSAdCcF38HNnI80IRRQ.gif"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">App complete</figcaption></figure><p id="a34d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你可以在<a class="ae ks" href="https://github.com/nabendu82/cloudinary-react-uploader" rel="noopener ugc nofollow" target="_blank">这个</a> github回购中找到相同的代码。</p></div></div>    
</body>
</html>