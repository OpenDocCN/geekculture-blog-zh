<html>
<head>
<title>Parallelizing Cypress with Jenkins, AWS, and Sorry-Cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Jenkins、AWS和Sorry-Cypress并行化Cypress</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/parallelizing-cypress-with-jenkins-aws-and-sorry-cypress-8241331fe50f?source=collection_archive---------1-----------------------#2021-07-01">https://medium.com/geekculture/parallelizing-cypress-with-jenkins-aws-and-sorry-cypress-8241331fe50f?source=collection_archive---------1-----------------------#2021-07-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3f20256d2345f54e9e846aab5d43a1aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tJrnP7IUAOY-jFpKSf3j9A.jpeg"/></div></div></figure><p id="9553" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于任何前端项目来说，Cypress.io都是一个优雅的端到端测试运行程序，并且已经成为行业标准。但是对于许多企业级项目来说，cypress测试会堆积起来，并且会花费很多时间来运行。这可能会减慢您的CI/CD构建，并最终减慢您项目的开发。</p><p id="d817" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您使用的是Jenkins，并且可以访问云计算资源，那么您可以在多个虚拟机上并行运行cypress。这将大大减少你的柏树运行时间。这篇文章是如何做到这一点的诀窍。</p><h1 id="2359" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">你需要什么</h1><ul class=""><li id="492d" class="km kn hi is b it ko ix kp jb kq jf kr jj ks jn kt ku kv kw bi translated">你的项目，包括柏树测试</li><li id="4d08" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">詹金斯服务器</li><li id="3649" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">云计算资源(AWS EC2实例、OpenStack实例等。)</li></ul><figure class="ld le lf lg fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/a49423957a01c931b1c3d44e26fd91be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*HVEwZ3xxd2GGeDfIi4Ycxg.png"/></div></figure><p id="41ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我第一次开始尝试这些工具时，我很难理解它们是如何协同工作的。让我们一步一步地设置它。</p><h1 id="3770" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">创建您的詹金斯代理</h1><p id="bd14" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">Jenkins可以跨不同的代理协调任务，因此您需要创建一些虚拟机并将它们添加为Jenkins节点。</p><h2 id="0e13" class="lk jp hi bd jq ll lm ln ju lo lp lq jy jb lr ls kc jf lt lu kg jj lv lw kk lx bi translated">设置您的虚拟机</h2><p id="ed8f" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">您需要在您首选的云提供商上启动一些实例。启动一个实例，并以您喜欢的方式(ssh、PuTTY等。)，请确保在实例上至少安装以下要求:</p><p id="3cf8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae ly" href="https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/setting-up-node-on-ec2-instance.html" rel="noopener ugc nofollow" target="_blank">节点和NPM</a>(Cypress所要求的，可能是您的项目)<br/><a class="ae ly" href="https://www3.ntu.edu.sg/home/ehchua/programming/howto/JDK_Howto.html" rel="noopener ugc nofollow" target="_blank">Java(Jenkins所要求的)</a><br/><a class="ae ly" href="https://docs.cypress.io/guides/getting-started/installing-cypress#System-requirements" rel="noopener ugc nofollow" target="_blank">Cypress的要求</a> <br/>您的项目需要运行的任何其他系统要求</p><p id="ec41" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我建议设置一个满足您所有需求的实例，然后创建该实例的快照。您可以从该快照启动更多实例，从而非常快速地创建新的Jenkins代理。</p><h2 id="2f4f" class="lk jp hi bd jq ll lm ln ju lo lp lq jy jb lr ls kc jf lt lu kg jj lv lw kk lx bi translated">将您的虚拟机作为节点添加到Jenkins</h2><p id="d86f" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">现在您的虚拟机已经准备好了，将它们作为节点添加到Jenkins。要快速阅读如何做到这一点，请查看本教程:</p><div class="lz ma ez fb mb mc"><a href="https://www.jenkins.io/doc/book/using/using-agents/" rel="noopener  ugc nofollow" target="_blank"><div class="md ab dw"><div class="me ab mf cl cj mg"><h2 class="bd hj fi z dy mh ea eb mi ed ef hh bi translated">使用詹金斯代理</h2><div class="mj l"><h3 class="bd b fi z dy mh ea eb mi ed ef dx translated">Jenkins代理可以在物理机、虚拟机、Kubernetes集群以及Docker映像中启动…</h3></div><div class="mk l"><p class="bd b fp z dy mh ea eb mi ed ef dx translated">www.jenkins.io</p></div></div><div class="ml l"><div class="mm l mn mo mp ml mq io mc"/></div></div></a></div><h1 id="806f" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">设置对不起-柏树</h1><p id="1996" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">Cypress.io的文档解释道，要并行运行Cypress测试，您所要做的就是运行命令:</p><pre class="ld le lf lg fd mr ms mt mu aw mv bi"><span id="1b34" class="lk jp hi ms b fi mw mx l my mz">cypress run --record --key=abc123 --parallel</span></pre><p id="8a90" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这暗示了(很少)这需要使用Cypress.io dashboard服务。这是一项付费服务，需要将项目代码上传到第三方云服务。如果这对你不起作用，<a class="ae ly" href="https://docs.sorry-cypress.dev/" rel="noopener ugc nofollow" target="_blank">对不起——柏树</a>来救场了！抱歉——Cypress允许您在自己的云服务上托管一个Cypress仪表板，并使用它来协调并行Cypress测试。对于我们正在采用的基于云的方法，以下是一些快速设置步骤:</p><ol class=""><li id="a024" class="km kn hi is b it iu ix iy jb na jf nb jj nc jn nd ku kv kw bi translated">创建一个新的云实例，专门用于运行Sorry-Cypress应用程序套件。请注意，这不一定需要与其他实例相同的样板文件安装。它不会被用作Jenkins代理，但是你的Jenkins代理和Sorry-Cypress实例必须能够通过http进行通信。</li><li id="f7c5" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn nd ku kv kw bi translated">在您的sory-Cypress实例上安装docker和docker-compose。一旦安装完毕，使用docker-compose脚本<a class="ae ly" href="https://docs.sorry-cypress.dev/guide/dashboard-and-api" rel="noopener ugc nofollow" target="_blank">安装和运行整个sory-Cypress应用程序套件就变得轻而易举了。</a></li></ol><p id="b19f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您有了自己的sorry-cypress仪表盘，它运行在您自己的云资源上。要检查它，请导航到您的-抱歉-cypress-instance-ip:8080，您将看到您的仪表板。</p><h1 id="b622" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">利用柏树</h1><p id="f8b4" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">为了让你的项目实际上<em class="ne">使用</em>对不起cypress，你需要做一些小的改变。在您的cypress.json中，添加一个<code class="du nf ng nh ms b">sorry-cypress</code>的<code class="du nf ng nh ms b">projectId</code>:</p><pre class="ld le lf lg fd mr ms mt mu aw mv bi"><span id="dbe4" class="lk jp hi ms b fi mw mx l my mz">// cypress.json:</span><span id="d992" class="lk jp hi ms b fi ni mx l my mz">{<br/>  "baseUrl": "http://localhost:3000",<br/>  "projectId": "sorry-cypress",<br/>  ...otherOptions<br/>}</span></pre><p id="dc99" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您还需要在您的项目中安装<a class="ae ly" href="https://www.npmjs.com/package/cy2" rel="noopener ugc nofollow" target="_blank"> cy2 </a>，这将有助于将cypress导向您的自定义cypress仪表板URL。有关更多详细信息，请参阅完整的Sorry-Cypress文档:</p><div class="lz ma ez fb mb mc"><a href="https://docs.sorry-cypress.dev/" rel="noopener  ugc nofollow" target="_blank"><div class="md ab dw"><div class="me ab mf cl cj mg"><h2 class="bd hj fi z dy mh ea eb mi ed ef hh bi translated">证明文件</h2><div class="mj l"><h3 class="bd b fi z dy mh ea eb mi ed ef dx translated">抱歉，Cypress是100%开源项目，如果你喜欢管理自己的基础设施，那就去看看吧…</h3></div><div class="mk l"><p class="bd b fp z dy mh ea eb mi ed ef dx translated">docs.sorry-cypress.dev</p></div></div><div class="ml l"><div class="nj l mn mo mp ml mq io mc"/></div></div></a></div><h1 id="e2c8" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">在Jenkins中设置并行化</h1><p id="c8c2" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">现在所有的部分都准备好了，是时候和Jenkins一起编排它们了。假设我们创建了3个实例用作Jenkins代理，命名为“代理1”、“代理2”和“代理3”。我们告诉Jenkins在管道脚本中跨这些代理并行运行cypress:</p><figure class="ld le lf lg fd ij"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="42d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以看到每个并行阶段都在运行相同的步骤，但是在不同的节点上。让我们来分解一下正在运行的步骤:</p><ul class=""><li id="e450" class="km kn hi is b it iu ix iy jb na jf nb jj nc jn kt ku kv kw bi translated"><code class="du nf ng nh ms b">npm install --silent</code> —在代理上安装项目</li><li id="4ac1" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated"><code class="du nf ng nh ms b">npm start &amp; npx wait-on http://localhost:3000</code> —启动项目并等待它在端口3000上可用(您的特定项目可能会有所不同)</li></ul><p id="6b59" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第三个命令更复杂，所以让我们进一步分解它:</p><ul class=""><li id="cb92" class="km kn hi is b it iu ix iy jb na jf nb jj nc jn kt ku kv kw bi translated"><code class="du nf ng nh ms b">CYPRESS_API_URL=\"http:Sorry-Cypress-Instance-IP:1234/\"</code> —将cypress api url环境变量设置为我们个人的sorry-cypress目录url。当然，使用您的Sorry-Cypress实例IP</li><li id="6905" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated"><code class="du nf ng nh ms b">cy2</code> —一个利用<code class="du nf ng nh ms b">CYPRESS_API_URL</code>环境变量的<code class="du nf ng nh ms b">cy</code>备选方案</li><li id="76b0" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated"><code class="du nf ng nh ms b">run --record --key XXX --parallel</code>——标准的cypress并行化命令——<code class="du nf ng nh ms b">key</code>可以是任何东西，抱歉——cypress实际上没有使用它</li><li id="26d6" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated"><code class="du nf ng nh ms b">--ci-build-id env.BUILD_ID</code> —所有并行阶段将使用相同的<code class="du nf ng nh ms b">BUILD_ID</code>，这允许Sorry-Cypress director将不同的并行阶段与相同的构建相关联，并且不会跨节点重复相同的测试</li></ul><p id="e37d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，当您的Jenkins作业运行时，它将在您定义的任意多个节点上并行运行cypress测试。让我们以一种更有条理的方式修改我们所有的作品:</p><figure class="ld le lf lg fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nm"><img src="../Images/291aa750013c9689d6be37eaaae515ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*BIZrFch6R8yCI_jgGAdU_A.png"/></div></div></figure><h1 id="3e56" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="dee2" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">Cypress测试是一个很好的方法来确保你的UI如预期的那样运行，但是测试蛋糕需要时间并且减慢你的开发过程。如果你有云资源，使用它们。通过使用Jenkins对资源进行精心的编排，您可以大大减少测试时间。</p><h1 id="5582" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">更多资源:</h1><div class="lz ma ez fb mb mc"><a href="https://docs.cypress.io/guides/guides/parallelization#Overview" rel="noopener  ugc nofollow" target="_blank"><div class="md ab dw"><div class="me ab mf cl cj mg"><h2 class="bd hj fi z dy mh ea eb mi ed ef hh bi translated">并行化| Cypress文档</h2><div class="mj l"><h3 class="bd b fi z dy mh ea eb mi ed ef dx translated">如何并行化测试运行如何对测试运行进行分组测试运行分组策略测试的负载平衡如何工作…</h3></div><div class="mk l"><p class="bd b fp z dy mh ea eb mi ed ef dx translated">docs.cypress.io</p></div></div><div class="ml l"><div class="nn l mn mo mp ml mq io mc"/></div></div></a></div><div class="lz ma ez fb mb mc"><a rel="noopener follow" target="_blank" href="/@adityahbk/cypress-parallelization-on-jenkins-using-sorry-cypress-197a86ad8ed1"><div class="md ab dw"><div class="me ab mf cl cj mg"><h2 class="bd hj fi z dy mh ea eb mi ed ef hh bi translated">使用sory-Cypress在Jenkins上实现Cypress并行化</h2><div class="mj l"><h3 class="bd b fi z dy mh ea eb mi ed ef dx translated">我最喜欢的编写e2e测试的方法之一是使用cypress。</h3></div><div class="mk l"><p class="bd b fp z dy mh ea eb mi ed ef dx translated">medium.com</p></div></div><div class="ml l"><div class="no l mn mo mp ml mq io mc"/></div></div></a></div></div></div>    
</body>
</html>