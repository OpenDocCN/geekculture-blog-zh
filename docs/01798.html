<html>
<head>
<title>Plotting Maps With Geopandas and Contextily</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Geopandas和Contextily绘制地图</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/plotting-maps-with-geopandas-and-contextily-8d4b1f02603d?source=collection_archive---------4-----------------------#2021-04-24">https://medium.com/geekculture/plotting-maps-with-geopandas-and-contextily-8d4b1f02603d?source=collection_archive---------4-----------------------#2021-04-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ff80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们都不时需要一张地图。在Python中处理地理数据时，我有一些代码片段，可以放在几乎任何地方来检查shapefile、在上下文中查看它，以及在彼此之上绘制多个数据层。</p><h1 id="fc8a" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">看，一个shapefile！</h1><p id="eaaf" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">使用<a class="ae kg" href="https://geopandas.org/docs/user_guide/mapping.html" rel="noopener ugc nofollow" target="_blank"> Geopandas </a>，我们可以使用内置的Matplotlib功能，用几行代码绘制地理数据框架。在这里，我们将使用来自伦敦辉煌的<a class="ae kg" href="https://www.london.gov.uk/what-we-do/arts-and-culture/cultural-infrastructure-toolbox/cultural-infrastructure-map" rel="noopener ugc nofollow" target="_blank">文化基础设施地图</a>的样本数据。首先，我们将伦敦行政区的shapefile加载到地理数据框架中并对其进行检查。</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="ef79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是结果:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es ko"><img src="../Images/9b8850c7451b6704043e513b480fd35f.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*OeyjWdMuXpwYPgf0T3LKBQ.png"/></div><figcaption class="kr ks et er es kt ku bd b be z dx">Boundaries of London boroughs. Image by author (shapefile: GLA / <a class="ae kg" href="https://data.london.gov.uk/" rel="noopener ugc nofollow" target="_blank">London Datastore</a>)</figcaption></figure><h1 id="fad1" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">它在哪里？</h1><p id="26b8" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">如果我们想显示更多的地理背景，并在此基础上绘制一些数据，会怎么样？我们可以使用<a class="ae kg" href="https://contextily.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">上下文</a>提供动态底图，查看我们的地理数据在世界上的位置:</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="945e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用与之前相同的shapefile，结果看起来比我们的第一张地图更复杂，显示了环境中的行政区边界:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es kv"><img src="../Images/0ff1ec763b7fcd981c4214f48470329c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TPBEAMDFIIi739XhC74Q8Q.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx">Image by author (shapefile from London Datastore)</figcaption></figure><h1 id="d371" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">给我做个三明治</h1><p id="2041" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">但是如果我们想在基础地图上显示多层数据呢？对于多层地图，我们需要一个函数来汇集数据框，设置坐标参考系统(CRS ),以便它们在底图上匹配，并使它们看起来更漂亮。最重要的是，我们需要控制每一层的格式，指定颜色、透明度和其他功能:</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="9aa6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是结果:底图之上的两个地理数据图层显示了伦敦行政区边界及其内的主要街道区域。地图上分散的城镇中心群是村庄和街区的当代遗迹，它们逐渐融入了我们今天所知道的伦敦。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es kv"><img src="../Images/d8ff1a28fa0c4f17e10bbf1586b4fedb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4EX2tCTlRrM2Yv8DmbD46g.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx">London boroughs and high street areas. Image by author (all data from GLA London Datastore)</figcaption></figure><h1 id="5b38" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">更多层？</h1><p id="9aba" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">为了给上面的<code class="du la lb lc ld b">makeLayeredMap</code>函数添加第三层，我们所要做的就是添加一行来绘制和格式化第三层。红点代表创意工作区(截至2019年4月)，其中大部分位于哈克尼:</p><pre class="kh ki kj kk fd le ld lf lg aw lh bi"><span id="6ffa" class="li je hi ld b fi lj lk l ll lm"># Layer 3: Plot creative workspaces data</span><span id="2684" class="li je hi ld b fi ln lk l ll lm">args[2].plot(ax=ax, color='red', alpha=1, zorder=3)</span></pre><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es kv"><img src="../Images/dc045f9bb625d4a34067aa4fef7cbdad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vZ14qCaa-ZlHWdNVZ6emqQ.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx">Camden, Islington and Hackney high street areas and creative workspaces. Image by author (data from GLA London Datastore)</figcaption></figure><p id="6dc4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了“放大”该地图的相关数据，我使用区边界通过空间连接函数<code class="du la lb lc ld b">sjoin</code>过滤基础数据框。这是一个很棒的功能，它像lassoo一样有效地使用区边界来捕捉其他数据帧中的要素:</p><pre class="kh ki kj kk fd le ld lf lg aw lh bi"><span id="9cb4" class="li je hi ld b fi lj lk l ll lm"># Filter gdf (containing all London Boroughs) by list:</span><span id="26a5" class="li je hi ld b fi ln lk l ll lm">LB_list = ['Camden', 'Islington', 'Hackney']</span><span id="c7dc" class="li je hi ld b fi ln lk l ll lm">LB_selected = gdf[gdf['NAME'].isin(LB_list)]</span><span id="05ec" class="li je hi ld b fi ln lk l ll lm"># Select high street polygons located within the selected boroughs Store the result in separate geodataframe:</span><span id="f650" class="li je hi ld b fi ln lk l ll lm">high_streets_selected = gpd.sjoin(high_streets, LB_selected, how='inner', op='intersects')</span></pre><p id="32b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于<code class="du la lb lc ld b">sjoin</code>的完整指南在geopandas文档的<a class="ae kg" href="https://geopandas.org/docs/user_guide/mergingdata.html" rel="noopener ugc nofollow" target="_blank">合并数据部分。</a></p><p id="3d79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们已经到了三层，但是<code class="du la lb lc ld b">makeLayeredMap</code>函数可以处理你需要的任意多的层。享受适应你自己的使用！</p></div></div>    
</body>
</html>