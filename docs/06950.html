<html>
<head>
<title>Generate and test RESTful APIs in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Swift中生成和测试RESTful APIs</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/generate-and-test-restful-apis-in-swift-767a0bd7ea48?source=collection_archive---------14-----------------------#2021-09-02">https://medium.com/geekculture/generate-and-test-restful-apis-in-swift-767a0bd7ea48?source=collection_archive---------14-----------------------#2021-09-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="955f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不要花几个小时为客户端API编写代码来与服务器交互。如果您支持使用不同编程语言的各种客户端，编写这样的代码是单调乏味和重复的。</p><p id="2ef5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不要等着开始开发一个可能还不存在的服务，或者你正在等待访问的服务。</p><p id="7428" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">借助一些优秀的开源工具，您可以在几分钟内创建一个全功能的客户端API，并用一个模拟的后端进行测试！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/1b2a31e093281b6ef0d56aca1f59308e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*13PBY59jft_6nZpa"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Swagger and Mockoon</figcaption></figure><p id="8d53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基于一个真实的例子，使用现有的<a class="ae jt" href="https://www.abstractapi.com/ip-geolocation-api#docs" rel="noopener ugc nofollow" target="_blank"> IP地理定位API </a>，我将解释并向您展示如何</p><ol class=""><li id="4afb" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">获取后端的RESTful API定义</li><li id="4b62" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">嘲笑后端</li><li id="4604" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">生成Swift客户库</li><li id="8641" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">在应用程序中使用Swift客户端库</li></ol><h1 id="517e" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">获取后端的RESTful API定义</h1><p id="1210" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">RESTful APIs可以用一种标准的、与语言无关的方式来描述。这允许人类和计算机在不访问源代码、文档或通过网络流量检查的情况下发现和理解服务的能力。这个标准叫做<a class="ae jt" href="https://swagger.io/specification/" rel="noopener ugc nofollow" target="_blank"> OpenAPI规范</a>，以前叫做<strong class="ih hj"> Swagger </strong>。今天，术语Swagger仍然存在，但是它描述了一组实现OpenAPI规范的工具，例如</p><ul class=""><li id="f4e4" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc ll ka kb kc bi translated"><a class="ae jt" href="https://swagger.io/swagger-editor/" rel="noopener ugc nofollow" target="_blank"> Swagger Editor </a>:让你在浏览器中编辑YAML的OpenAPI规范，并实时预览文档。</li><li id="2366" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc ll ka kb kc bi translated"><a class="ae jt" href="https://swagger.io/swagger-codegen/" rel="noopener ugc nofollow" target="_blank"> Swagger Codegen </a>:允许基于OpenAPI规范生成API客户端库(SDK生成)、服务器存根和文档。</li></ul><p id="10f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jt" href="https://apis.guru/" rel="noopener ugc nofollow" target="_blank">浏览</a>现有RESTful API定义的存储库。你也可以为这个“Web APIs维基百科”做贡献，因为API大师们把它发表在了GitHub上。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/157a6125c870f03e25e9c679129685b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ENCBav-7U2Kof07i"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">OpenAPI directory of apigurus.com</figcaption></figure><p id="6759" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为一个例子，我将以<a class="ae jt" href="https://api.apis.guru/v2/specs/abstractapi.com/geolocation/1.0.0/openapi.yaml" rel="noopener ugc nofollow" target="_blank">IP地理定位API </a>的这个特定规范为例。来自<a class="ae jt" href="https://www.abstractapi.com" rel="noopener ugc nofollow" target="_blank"> AbstractAPI </a>的人们允许开发者检索全球任何IP背后的地区、国家和城市。尚不存在Swift客户库。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ln"><img src="../Images/2e777b8d9e459ff01dcf247739c91c59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KVYqnzXhXxn3BUEs"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">IP Geolocation API</figcaption></figure><p id="d01c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们通过Swagger编辑器在浏览器中打开规范。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/b4ee7e5ef5673c3d75b332c94415dcc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FhFZnfA7bgqmGQOG"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Swagger Editor</figcaption></figure><p id="bd14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对<code class="du lo lp lq lr b">v1</code>端点的一个HTTP GET请求允许我们基于IP地址检索大量地理位置信息。</p><p id="1317" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我没有注册，所以我不能访问后端。</p><h1 id="38c6" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">嘲笑后端</h1><p id="da18" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">Mockoon 是一个很好的应用程序，可以很容易地在本地运行模拟API。不需要远程部署，没有帐户管理的麻烦。而且是<a class="ae jt" href="https://github.com/mockoon/mockoon" rel="noopener ugc nofollow" target="_blank">开源</a>多平台支持:</p><p id="b3c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以从mockoon.com<a class="ae jt" href="https://mockoon.com/" rel="noopener ugc nofollow" target="_blank">下载。Mockoon也可以通过家酿<code class="du lo lp lq lr b">brew install --cask mockoon</code>获得。</a></p><p id="ced9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装后，您可以导入一个OpenAPI规范。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/594266a2fb486ed070d67d7f91f540b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*18aB393SKM8w26uh"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Import specification into Mockoon</figcaption></figure><p id="5981" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，被模仿的服务使用Mokoon的模板系统来创建动态响应。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/d8be2231003657765665fca80b8decf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sfCyjpcq2nksao1i"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Running a mock server with Mockoon</figcaption></figure><p id="54f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此您可以启动您的服务器并立即测试它。对于简单的HTTP请求，可以使用curl。对于更复杂的HTTP请求，我推荐像<a class="ae jt" href="https://www.postman.com/downloads/" rel="noopener ugc nofollow" target="_blank"> Postman </a>或<a class="ae jt" href="https://paw.cloud/" rel="noopener ugc nofollow" target="_blank"> Paw </a>这样的应用</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/60250391153db4b3fc20e1305f34b2ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7xneb6V0ZDfxRJTw"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Testing mock server with curl</figcaption></figure><p id="7d95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个特殊的例子中，我手动做了一个小改动来改善模拟响应。我利用<a class="ae jt" href="https://github.com/Marak/faker.js" rel="noopener ugc nofollow" target="_blank"> Faker.js </a>和<a class="ae jt" href="https://handlebarsjs.com/" rel="noopener ugc nofollow" target="_blank">手柄</a>来伪造地址相关信息，例如<code class="du lo lp lq lr b">"city": "{{faker 'address.city'}}"</code></p><h1 id="4b16" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">生成Swift客户库</h1><p id="9c5d" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">有多种选择可以方便地为后端服务生成客户端库。</p><ul class=""><li id="bcd4" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc ll ka kb kc bi translated"><a class="ae jt" href="https://github.com/swagger-api/swagger-codegen" rel="noopener ugc nofollow" target="_blank"> Swagger Codegen </a>:从Swagger 2.0或OpenAPI 3.0 spec生成模型和API。依赖流行的网络库<a class="ae jt" href="https://github.com/Alamofire/Alamofire" rel="noopener ugc nofollow" target="_blank"> Alamofire </a></li><li id="af69" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc ll ka kb kc bi translated"><a class="ae jt" href="https://github.com/yonaskolb/SwagGen" rel="noopener ugc nofollow" target="_blank"> SwagGen </a>:从OpenAPI/Swagger 3.0规范生成代码的命令行工具。它是官方的Swagger-Codegen Java代码生成器的替代品，并“增加了一些改进，如速度、可配置性、简单性、可扩展性和改进的模板语言”。</li></ul><p id="d127" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将使用usw Swagger Codegen，因为可以通过浏览器中的Swagger编辑器生成代码。在我的本地机器上不需要安装任何工具:)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/9a8e051dd3fb9049ba8c0e8a32506333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sDNcfxkNo1VqbCw7"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Generate Swift code straight out of the browser</figcaption></figure><p id="c617" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">即使你不是一个Swift开发人员，Swagger Codegen也很有可能加速你的开发过程。因为API客户端库和服务器存根的生成可能使用多种语言，例如C#、C++、Go、Java、Python等等。</p><p id="9f3f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是我知道由于对Alamofire的依赖，Swagger Codegen可能不适合你的需要。事实上，在撰写本文时，Swagger Codegen依赖于Alamofire 4.x，而使用Alamofire 5.x(2020年2月发布)将需要您修复生成的代码，使其与alamo fire 5 . x兼容。</p><p id="db3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你没有一个开放的API规范，只有一个代表HTTP响应模型的JSON，那么使用<a class="ae jt" href="https://quicktype.io/" rel="noopener ugc nofollow" target="_blank"> quicktype </a>。在浏览器中或作为命令行工具尝试一下，它会在Swift中为您生成强类型模型和序列化程序。此外，这里支持多种目标语言。</p><h1 id="3d66" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">在应用程序中使用Swift客户端库</h1><p id="dee8" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">使用这样一个由Swagger Codegen生成的客户端库需要以下步骤:</p><ul class=""><li id="4c46" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc ll ka kb kc bi translated">将Alamofire 4.x添加到您的Xcode项目中，例如通过Swift Package Manager</li><li id="be90" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc ll ka kb kc bi translated">解压、复制并添加<code class="du lo lp lq lr b">Swagger Client</code>文件夹到你的Xcode项目</li><li id="2354" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc ll ka kb kc bi translated">使用位于<code class="du lo lp lq lr b">APIs</code>和<code class="du lo lp lq lr b">Models</code>文件夹中的所需API及其模型</li></ul><p id="7813" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于IP地理位置API，生成的API代码如下所示</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lu"><img src="../Images/c99e03461c4e4365bf8dc1e1a319f92d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XpJMM85SbYbnDi3JbWKM7g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">API model to initiate a URL request to v1 endpoint</figcaption></figure><p id="107a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是反应模型:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lu"><img src="../Images/b6d67db10d30db006bc9fc9cc8485fab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aZeTJQG8ARTfHu5Ke8kLiA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Response model for v1 endpoint</figcaption></figure><p id="a956" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要连接到由Mockoon支持的模拟服务器，您必须替换<code class="du lo lp lq lr b">SwaggerClientAPI</code>中的basePath。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lu"><img src="../Images/5cfd187d9838129900ce7809e7c3e948.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qT5LD193mx3Opyjf8JSpSg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">SwaggerClientAPI with basePath</figcaption></figure><p id="d68d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后一个例子是如何调用客户端API来触发对被模仿的后端的HTTP请求并接收响应。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lu"><img src="../Images/aef5f3c81354be69b513ca2abe932e2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rVsPu2LH9SX4-fDGSd6Ftg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">How to send a URL request to mock server</figcaption></figure><p id="9643" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">包含在SwiftUI应用程序中的所有源代码都可以在<a class="ae jt" href="https://github.com/MarcoEidinger/swift-swagger-mockoon-tutorial" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p></div><div class="ab cl lv lw gp lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hb hc hd he hf"><p id="f0e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mc">最初发布于</em><a class="ae jt" href="https://blog.eidinger.info/generate-and-test-restful-apis-in-swift" rel="noopener ugc nofollow" target="_blank"><em class="mc">https://blog . ei dinger . info</em></a><em class="mc">。</em></p></div></div>    
</body>
</html>