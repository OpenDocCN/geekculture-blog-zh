<html>
<head>
<title>Rust for NDK development</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">铁锈促进NDK发展</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/the-following-are-examples-to-render-fractal-images-in-android-bitmap-with-rust-22a9fb5d648b?source=collection_archive---------12-----------------------#2021-07-05">https://medium.com/geekculture/the-following-are-examples-to-render-fractal-images-in-android-bitmap-with-rust-22a9fb5d648b?source=collection_archive---------12-----------------------#2021-07-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d4f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是用Rust渲染Android位图中的<a class="ae jd" href="https://en.wikipedia.org/wiki/Fractal" rel="noopener ugc nofollow" target="_blank">分形</a>图像的例子。</p><p id="a925" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了进行Android开发，我们需要设置我们的Android环境。首先，我们需要安装<a class="ae jd" href="https://developer.android.com/studio/index.html" rel="noopener ugc nofollow" target="_blank">安卓工作室</a>。一旦安装了Android Studio，我们就需要安装<a class="ae jd" href="https://developer.android.com/ndk" rel="noopener ugc nofollow" target="_blank"> NDK </a>(本地开发套件)。</p><p id="ee2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">首先，为您的应用程序创建一个新的Kotlin Android项目</strong> <br/> <em class="je">打开Android Studio，在欢迎屏幕或文件|新建|新建项目中单击开始一个新的Android Studio项目。</em></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/ea6334023ab31a829a0760f0686479d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uO-pt0Yw7B7Df_BK.png"/></div></div></figure><blockquote class="jr js jt"><p id="8873" class="if ig je ih b ii ij ik il im in io ip ju ir is it jv iv iw ix jw iz ja jb jc hb bi translated"><em class="hi">选择一个定义应用程序行为的</em> <a class="ae jd" href="https://developer.android.com/guide/components/activities/intro-activities" rel="noopener ugc nofollow" target="_blank"> <em class="hi">活动</em> </a> <em class="hi">。对于您的第一个“Hello world”应用程序，选择只显示一个屏幕的空活动，然后单击Next。</em></p></blockquote><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jx"><img src="../Images/093b1eb3833e38ba7cacba17a26d4fdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5RJexdB2pANoxAZp.png"/></div></div></figure><p id="dbd9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">建设和运行项目</em></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es jy"><img src="../Images/83b47c3e7dbe52804ce24db68b2efe21.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*wZNcG8HPnLXq5Rj3.png"/></div></figure><p id="807d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">打开安卓工作室。从工具栏进入</em> <strong class="ih hj"> Android Studio &gt;首选项&gt;外观&amp;行为&gt; Android SDK &gt; SDK工具。</strong> <em class="je">勾选以下安装选项，点击确定。</em></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="c2c4" class="ke kf hi ka b fi kg kh l ki kj">* Android SDK Tools<br/>* NDK<br/>* CMake<br/>* LLDB</span></pre><p id="2438" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦安装了NDK和相关工具，我们需要设置一些环境变量，第一个是SDK路径，第二个是NDK路径。设置以下环境变量</p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="7757" class="ke kf hi ka b fi kg kh l ki kj">export ANDROID_HOME=/Users/$USER/Library/Android/sdk<br/>export NDK_HOME=$ANDROID_HOME/ndk-bundle</span></pre><p id="70c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">如果您还没有安装Rust，我们需要现在就安装。为此，我们将使用rustup。rustup从官方发布渠道安装Rust，让你轻松在不同发布版本之间切换。这对你以后所有的Rust开发都是有用的，不仅仅是这里。rustup也可以和家酿一起使用。</em></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="4631" class="ke kf hi ka b fi kg kh l ki kj">curl https://sh.rustup.rs -sSf | sh</span></pre><p id="8445" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">创建铁锈项目</em></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="ac66" class="ke kf hi ka b fi kg kh l ki kj">cargo new rust-lib &amp;&amp; cd rust-lib</span></pre><p id="e291" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是创建NDK的独立版本供我们编译。我们需要为每一个我们想要编译的架构做这件事。我们将使用主Android NDK中的 <code class="du kk kl km ka b"><em class="je">make_standalone_toolchain.py</em></code> <em class="je">脚本来完成这个</em> <em class="je">现在让我们创建独立的NDK。一旦创建了NDK目录，就不需要在里面做这些了。</em></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="fe79" class="ke kf hi ka b fi kg kh l ki kj">mkdir NDK &amp;&amp; cd NDK<br/>${NDK_HOME}/build/tools/make_standalone_toolchain.py --api 26 --arch arm64 --install-dir arm64<br/>${NDK_HOME}/build/tools/make_standalone_toolchain.py --api 26 --arch arm --install-dir arm<br/>${NDK_HOME}/build/tools/make_standalone_toolchain.py --api 26 --arch x86 --install-dir x86</span></pre><p id="4968" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">创建一个新文件，</em> <code class="du kk kl km ka b"><em class="je">cargo-config.toml</em></code> <em class="je">该文件将告诉cargo在交叉编译期间在哪里寻找ndk。将以下内容添加到文件中，记住用项目目录的路径替换</em> <code class="du kk kl km ka b"><em class="je">&lt;project path&gt;</em></code> <em class="je">的实例。</em></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="5b7f" class="ke kf hi ka b fi kg kh l ki kj">[target.aarch64-linux-android]<br/>ar = "&lt;project path&gt;/rust-lib/NDK/arm64/bin/aarch64-linux-android-ar"<br/>linker = "&lt;project path&gt;/greetings/NDK/arm64/bin/aarch64-linux-android-clang"</span><span id="cfe0" class="ke kf hi ka b fi kn kh l ki kj">[target.armv7-linux-androideabi]<br/>ar = "&lt;project path&gt;/rust-lib/NDK/arm/bin/arm-linux-androideabi-ar"<br/>linker = "&lt;project path&gt;/greetings/NDK/arm/bin/arm-linux-androideabi-clang"</span><span id="1b10" class="ke kf hi ka b fi kn kh l ki kj">[target.i686-linux-android]<br/>ar = "&lt;project path&gt;rust-lib/rust-lib/NDK/x86/bin/i686-linux-android-ar"<br/>linker = "&lt;project path&gt;/greetings/NDK/x86/bin/i686-linux-android-clang"</span></pre><p id="e5fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">为了让cargo看到我们的新SDK，我们需要将此配置文件复制到我们的。货物目录是这样的:</em></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="edfc" class="ke kf hi ka b fi kg kh l ki kj">cp cargo-config.toml ~/.cargo/config</span></pre><p id="f9f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们继续将我们新创建的Android架构添加到rustup，这样我们就可以在交叉编译期间使用它们:</p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="4f44" class="ke kf hi ka b fi kg kh l ki kj">rustup target add aarch64-linux-android armv7-linux-androideabi i686-linux-android</span></pre><p id="89d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">打开</em> <code class="du kk kl km ka b"><em class="je">rust-lib/Cargo.toml</em></code> <em class="je">并修改config。</em></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="45c7" class="ke kf hi ka b fi kg kh l ki kj"><strong class="ka hj">[dependencies]</strong><br/><strong class="ka hj">[target.'cfg(target_os="android")'.dependencies]</strong><br/>jni = { version = "0.5", default-features = false }</span><span id="c117" class="ke kf hi ka b fi kn kh l ki kj"><strong class="ka hj">[lib]</strong><br/>name = "rust"<br/>crate-type = ["dylib"]</span></pre><p id="f0f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">打开</em> <code class="du kk kl km ka b"><em class="je">rust-lib/src/lib.rs</em></code> <em class="je">。在文件底部添加以下代码:</em></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="ed1c" class="ke kf hi ka b fi kg kh l ki kj">/// Expose the JNI interface for android below<br/>#[cfg(target_os = "android")]<br/>#[allow(non_snake_case)]<br/><strong class="ka hj">pub</strong> <strong class="ka hj">mod</strong> android {<br/>    <strong class="ka hj">extern</strong> <strong class="ka hj">crate</strong> jni;</span><span id="5c4f" class="ke kf hi ka b fi kn kh l ki kj">    <strong class="ka hj">use</strong> super::*;<br/>    <strong class="ka hj">use</strong> self::jni::JNIEnv;<br/>    <strong class="ka hj">use</strong> self::jni::objects::{JString, JClass};<br/>    <strong class="ka hj">use</strong> self::jni::sys::jstring;<br/>    <strong class="ka hj">use</strong> std::ffi::CString;</span><span id="2dd6" class="ke kf hi ka b fi kn kh l ki kj">    #[no_mangle]<br/>    <strong class="ka hj">pub</strong> <strong class="ka hj">unsafe</strong> <strong class="ka hj">extern</strong> <strong class="ka hj">fn</strong> <strong class="ka hj">Java_com_example_myktapp_MainActivity_greeting</strong>(env: JNIEnv, _: JClass) -&gt; jstring {<br/>        <strong class="ka hj">let</strong> world_ptr = CString::new("Hello world from Rust world").unwrap();<br/>        <strong class="ka hj">let</strong> output = env.new_string(world_ptr.to_str().unwrap()).expect("Couldn't create java string!");<br/>        output.into_inner()<br/>    }<br/>}</span></pre><p id="bc0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">为Android x86(模拟器)构建库</em></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="49d1" class="ke kf hi ka b fi kg kh l ki kj">cargo build --target i686-linux-android --release</span></pre><p id="0440" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">将动态库链接到Android项目</em></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="8426" class="ke kf hi ka b fi kg kh l ki kj">cd app/src/main<br/>ln -s &lt;project_path&gt;/rust-lib/target/i686-linux-android/release/librust.so jniLibs/x86/librust.so</span></pre><p id="eff9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">编辑布局</em> <code class="du kk kl km ka b"><em class="je">activity_main.xml</em></code> <em class="je">为文本视图添加id</em></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="4180" class="ke kf hi ka b fi kg kh l ki kj">&lt;<strong class="ka hj">TextView</strong><br/>        android:id="@+id/txtHello"<br/>        android:layout_width="wrap_content"<br/>        android:layout_height="wrap_content"<br/>        android:text="Hello World!"<br/>        app:layout_constraintBottom_toBottomOf="parent"<br/>        app:layout_constraintLeft_toLeftOf="parent"<br/>        app:layout_constraintRight_toRightOf="parent"<br/>        app:layout_constraintTop_toTopOf="parent" /&gt;</span></pre><p id="d110" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">在</em> <code class="du kk kl km ka b"><em class="je">MainActivity.kt</em></code> <em class="je">文件中，添加以下代码。这里我们定义了Rust的本地接口。这个</em> <code class="du kk kl km ka b"><em class="je">greeting</em></code> <em class="je">方法简单地调用了那个本地函数</em> <code class="du kk kl km ka b"><em class="je">Java_com_example_myktapp_MainActivity_greeting</em></code></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="389d" class="ke kf hi ka b fi kg kh l ki kj"><strong class="ka hj">private</strong> external fun <strong class="ka hj">greeting</strong>(): String</span></pre><p id="afb9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">我们需要调用函数从Rust获取消息并加载我们的Rust库</em></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="76d0" class="ke kf hi ka b fi kg kh l ki kj"><strong class="ka hj">class</strong> <strong class="ka hj">MainActivity</strong> : <strong class="ka hj">AppCompatActivity</strong>() {</span><span id="faac" class="ke kf hi ka b fi kn kh l ki kj">    <strong class="ka hj">private</strong> external fun <strong class="ka hj">greeting</strong>(): String</span><span id="3fe0" class="ke kf hi ka b fi kn kh l ki kj">    override fun <strong class="ka hj">onCreate</strong>(savedInstanceState: Bundle?) {<br/>        <strong class="ka hj">super</strong>.onCreate(savedInstanceState)<br/>        setContentView(R.layout.activity_main)<br/>        val textView: TextView = findViewById(R.id.txtHello)<br/>        textView.text = greeting()<br/>    }</span><span id="a06f" class="ke kf hi ka b fi kn kh l ki kj">    companion object {<br/>        init {<br/>            System.loadLibrary("rust")<br/>        }<br/>    }</span><span id="3126" class="ke kf hi ka b fi kn kh l ki kj">}</span></pre><blockquote class="jr js jt"><p id="ad3b" class="if ig je ih b ii ij ik il im in io ip ju ir is it jv iv iw ix jw iz ja jb jc hb bi translated"><em class="hi">再次构建并运行项目</em></p></blockquote><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es jy"><img src="../Images/8fde99bef9ddd7deeefc856ce3b5b0b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*FsHdb-ANpWJrXYIr.png"/></div></figure><p id="1dc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">编辑布局</em> <code class="du kk kl km ka b"><em class="je">main_activity.xml</em></code> <em class="je">添加</em> <code class="du kk kl km ka b"><em class="je">BitmapView</em></code></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="623e" class="ke kf hi ka b fi kg kh l ki kj">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;<strong class="ka hj">androidx.constraintlayout.widget.ConstraintLayout</strong> xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent"<br/>    tools:context=".MainActivity"&gt;</span><span id="11be" class="ke kf hi ka b fi kn kh l ki kj">    &lt;<strong class="ka hj">ImageView</strong><br/>        android:id="@+id/imageView"<br/>        android:layout_width="match_parent"<br/>        android:layout_height="match_parent"<br/>        app:layout_constraintBottom_toBottomOf="parent"<br/>        app:layout_constraintLeft_toLeftOf="parent"<br/>        app:layout_constraintRight_toRightOf="parent"<br/>        app:layout_constraintTop_toTopOf="parent" /&gt;</span><span id="5c21" class="ke kf hi ka b fi kn kh l ki kj">&lt;/<strong class="ka hj">androidx.constraintlayout.widget.ConstraintLayout</strong>&gt;</span></pre><p id="75df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">在</em> <code class="du kk kl km ka b"><em class="je">MainActivity.kt</em></code> <em class="je">文件中，添加以下代码。这里我们定义了Rust的本地接口。</em> <code class="du kk kl km ka b"><em class="je">renderFractal</em></code> <em class="je">方法简单地调用本地函数并创建新的</em> <code class="du kk kl km ka b"><em class="je">Bitmap</em></code> <em class="je">，它将被本地函数</em>修改</p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="a948" class="ke kf hi ka b fi kg kh l ki kj"><strong class="ka hj">package</strong> com.example.myktapp</span><span id="8fc6" class="ke kf hi ka b fi kn kh l ki kj"><strong class="ka hj">import</strong> android.graphics.Bitmap<br/><strong class="ka hj">import</strong> android.os.Bundle<br/><strong class="ka hj">import</strong> android.widget.ImageView<br/><strong class="ka hj">import</strong> androidx.appcompat.app.AppCompatActivity</span><span id="3ee6" class="ke kf hi ka b fi kn kh l ki kj"><strong class="ka hj">class</strong> <strong class="ka hj">MainActivity</strong> : <strong class="ka hj">AppCompatActivity</strong>() {</span><span id="3721" class="ke kf hi ka b fi kn kh l ki kj"><strong class="ka hj">private</strong> external fun <strong class="ka hj">renderFractal</strong>(bitmap: Bitmap)</span><span id="3a8a" class="ke kf hi ka b fi kn kh l ki kj">override fun <strong class="ka hj">onCreate</strong>(savedInstanceState: Bundle?) {<br/>        <strong class="ka hj">super</strong>.onCreate(savedInstanceState)<br/>        setContentView(R.layout.activity_main)<br/>        val bitmap = Bitmap.createBitmap(800, 800, Bitmap.Config.ARGB_8888)<br/>        renderFractal(bitmap)<br/>        val imageView: ImageView = findViewById(R.id.imageView)<br/>        imageView.setImageBitmap(bitmap)<br/>    }</span><span id="d1f8" class="ke kf hi ka b fi kn kh l ki kj">companion object {<br/>        init {<br/>            System.loadLibrary("rust")<br/>        }<br/>    }</span><span id="00e9" class="ke kf hi ka b fi kn kh l ki kj">}</span><span id="8cb8" class="ke kf hi ka b fi kn kh l ki kj">}</span></pre><p id="823f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">打开</em> <code class="du kk kl km ka b"><em class="je">rust-lib/Cargo.toml</em></code> <em class="je">，添加</em> <code class="du kk kl km ka b"><a class="ae jd" href="https://docs.rs/image/0.22.3/image/" rel="noopener ugc nofollow" target="_blank"><em class="je">image</em></a></code> <em class="je">和</em> <code class="du kk kl km ka b"><a class="ae jd" href="https://github.com/rust-num/num-complex" rel="noopener ugc nofollow" target="_blank"><em class="je">num-complex</em></a></code> <em class="je">货箱到依赖</em></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="607f" class="ke kf hi ka b fi kg kh l ki kj"><strong class="ka hj">[dependencies]</strong><br/><strong class="ka hj">[target.'cfg(target_os="android")'.dependencies]</strong><br/>jni = { version = "0.5", default-features = false }<br/>image = "0.22.0"<br/>num-complex = "0.2"</span></pre><p id="f8ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">打开</em> <code class="du kk kl km ka b"><em class="je">rust-lib/lib.rs</em></code> <em class="je">，在</em> <code class="du kk kl km ka b"><em class="je">android</em></code> <em class="je"> mod、</em> <code class="du kk kl km ka b"><em class="je">graphic</em></code> <em class="je">模块里面添加下面的代码只是一个</em> <a class="ae jd" href="https://developer.android.com/ndk/reference/group/bitmap" rel="noopener ugc nofollow" target="_blank"> <em class="je"> NDK C++位图头</em> </a> <em class="je">，你可以在</em> <a class="ae jd" href="https://github.com/hoangpq/rust-ndk-example/blob/master/rust-lib/src/android/fractal.rs" rel="noopener ugc nofollow" target="_blank"> <em class="je">分形. rs </em> </a>上找到 <code class="du kk kl km ka b"><em class="je">fractal::render</em></code> <em class="je">的代码</em></p><pre class="jg jh ji jj fd jz ka kb kc aw kd bi"><span id="469e" class="ke kf hi ka b fi kg kh l ki kj">#[no_mangle]<br/><strong class="ka hj">pub</strong> <strong class="ka hj">unsafe</strong> <strong class="ka hj">extern</strong> <strong class="ka hj">fn</strong> <strong class="ka hj">Java_com_example_myktapp_MainActivity_renderFractal</strong>(env: JNIEnv, _: JClass, bmp: JObject) {<br/>    <strong class="ka hj">let</strong> <strong class="ka hj">mut</strong> info = graphic::AndroidBitmapInfo::new();<br/>    <strong class="ka hj">let</strong> raw_env = env.get_native_interface();</span><span id="9201" class="ke kf hi ka b fi kn kh l ki kj">    <strong class="ka hj">let</strong> bmp = bmp.into_inner();</span><span id="fc48" class="ke kf hi ka b fi kn kh l ki kj">    // Read bitmap info<br/>    graphic::bitmap_get_info(raw_env, bmp, &amp;<strong class="ka hj">mut</strong> info);<br/>    <strong class="ka hj">let</strong> <strong class="ka hj">mut</strong> pixels = 0 <strong class="ka hj">as</strong> *<strong class="ka hj">mut</strong> c_void;</span><span id="0a87" class="ke kf hi ka b fi kn kh l ki kj">    // Lock pixel for draw<br/>    graphic::bitmap_lock_pixels(raw_env, bmp, &amp;<strong class="ka hj">mut</strong> pixels);</span><span id="e077" class="ke kf hi ka b fi kn kh l ki kj">    <strong class="ka hj">let</strong> pixels =<br/>        std::slice::from_raw_parts_mut(pixels <strong class="ka hj">as</strong> *<strong class="ka hj">mut</strong> u8, (info.stride * info.height) <strong class="ka hj">as</strong> usize);</span><span id="6529" class="ke kf hi ka b fi kn kh l ki kj">    fractal::render(pixels, info.width <strong class="ka hj">as</strong> u32, info.height <strong class="ka hj">as</strong> u32);<br/>    graphic::bitmap_unlock_pixels(raw_env, bmp);<br/>}</span></pre><blockquote class="jr js jt"><p id="3eb4" class="if ig je ih b ii ij ik il im in io ip ju ir is it jv iv iw ix jw iz ja jb jc hb bi translated"><em class="hi">构建并再次运行项目</em></p></blockquote><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es jy"><img src="../Images/ed33ca5c6c05a549ba2ad2753b9c5f42.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*a-idqvUG0x1Gfred.png"/></div></figure><p id="c8dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://github.com/hoangpq/rust-ndk-example" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">找到代码</strong> </a></p></div></div>    
</body>
</html>