<html>
<head>
<title>Strong-typed I18N in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React中的强类型I18N</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/strong-typed-i18n-in-react-c43281de720c?source=collection_archive---------2-----------------------#2021-10-18">https://medium.com/geekculture/strong-typed-i18n-in-react-c43281de720c?source=collection_archive---------2-----------------------#2021-10-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5827" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将i18n支持添加到您的应用程序可能会很痛苦。将所有文本字符串从JSX提取到翻译文件，并用密钥替换它们是一项细致单调的工作。一个小小的拼写错误和哎呀你得到了一个错误。但是如果我告诉你，你可以使用TypeScript来验证翻译呢？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/b3a3b822ab78da057889d6ae05f65817.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*vqEMAvtZN_LrJi85Q3kzlQ.jpeg"/></div></figure><p id="8e43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个想法非常简单:翻译以键值字典的形式存储在JSON文件中，TypeScript能够解析它们并确定翻译字典的类型，我们称这种类型为<code class="du jl jm jn jo b">Translation</code>。任何流行的i18n解决方案都提供了一个通过key获取翻译后的字符串的函数，姑且称之为<code class="du jl jm jn jo b">t</code>。所以，你唯一需要做的就是确保传递给<code class="du jl jm jn jo b">t</code>函数的键具有<code class="du jl jm jn jo b">keyof Translation</code>类型。因此，TypeScript将验证所有转换键，并在您的IDE中自动完成它们。</p><p id="6b62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我展示一个如何在<code class="du jl jm jn jo b">react-i18next</code>库中使用这种技术的例子。</p><h1 id="8b96" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">react-i18接下来</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es kn"><img src="../Images/f39bf0e3b68a16026ae32ffcbde06752.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EHEs25cD-p9lgu0uSmRJHw.jpeg"/></div></div></figure><p id="b08d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ks" href="https://react.i18next.com/" rel="noopener ugc nofollow" target="_blank"> React-i18next </a>是<a class="ae ks" href="https://www.i18next.com/" rel="noopener ugc nofollow" target="_blank"> i18next框架</a>的React包装器。它支持国际化所需的所有特性，如翻译模板、名称空间、动态翻译加载等等。另外<code class="du jl jm jn jo b">i18next</code>有其他前端框架的适配器，如VueJS、AngularJS和许多后端框架，你可以在这里找到完整的列表<a class="ae ks" href="https://www.i18next.com/overview/supported-frameworks" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="17d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好，让我们先创建一个支持TypeScript的React应用程序:</p><pre class="je jf jg jh fd kt jo ku kv aw kw bi"><span id="0279" class="kx jq hi jo b fi ky kz l la lb">yarn create react-app my-app --template typescript</span></pre><p id="fc01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们有了一个标准的Create React应用程序项目。让我们添加<code class="du jl jm jn jo b">i18next</code>库:</p><pre class="je jf jg jh fd kt jo ku kv aw kw bi"><span id="a623" class="kx jq hi jo b fi ky kz l la lb">yarn add react-i18next i18next i18next-browser-languagedetector</span></pre><p id="363a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们为英语和德语添加两个翻译文件:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lc ld l"/></div></figure><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="20b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以初始化<code class="du jl jm jn jo b">i18next</code>:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="838e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如你所见，我已经添加了<code class="du jl jm jn jo b">LanguageDetector</code>插件。这是一个非常有用的工具来检测用户的首选语言。如果你想定制它的行为，请点击查看文档<a class="ae ks" href="https://github.com/i18next/i18next-browser-languageDetector" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="bff5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后一步，加入<code class="du jl jm jn jo b">i18next</code>反应组分。让我们修改一下<code class="du jl jm jn jo b">App.tsx</code>:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="33b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jl jm jn jo b">i18next</code>可通过<code class="du jl jm jn jo b">useTranslation</code>挂钩接近。在这个例子中，我用本地化值替换了“Learn React ”,并添加了一个非常简单的语言选择器。</p><h1 id="1ba1" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">打字稿魔术</h1><p id="903d" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">现在是时候通过将该文件添加到<code class="du jl jm jn jo b">./src</code>来配置TypeScript以检查翻译键了:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="4519" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里发生了什么？我已经重载了<code class="du jl jm jn jo b">react-i18next</code>typing，现在TypeScript知道翻译文件的格式了。如果我们试图使用一个不正确的翻译键，例如<code class="du jl jm jn jo b">learnReac</code>，我们会得到这个错误:</p><pre class="je jf jg jh fd kt jo ku kv aw kw bi"><span id="4bd6" class="kx jq hi jo b fi ky kz l la lb">Failed to compile.</span><span id="89b4" class="kx jq hi jo b fi lj kz l la lb">/blog/typed-i18n/src/App.tsx<br/>TypeScript error in /blog/typed-i18n/src/App.tsx(21,14):<br/>No overload matches this call.<br/>  Overload 1 of 2, '(key: "learnReact" | TemplateStringsArray | ("learnReact" | TemplateStringsArray)[], options?: string | TOptions&lt;StringMap&gt; | undefined): string', gave the following error.<br/>    Argument of type '"learnReac"' is not assignable to parameter of type '"learnReact" | TemplateStringsArray | ("learnReact" | TemplateStringsArray)[]'.<br/>  Overload 2 of 2, '(key: "learnReact" | TemplateStringsArray | ("learnReact" | TemplateStringsArray)[], defaultValue?: string | undefined, options?: string | ... 1 more ... | undefined): string', gave the following error.<br/>    Argument of type '"learnReac"' is not assignable to parameter of type '"learnReact" | TemplateStringsArray | ("learnReact" | TemplateStringsArray)[]'.  TS2769</span><span id="9c3d" class="kx jq hi jo b fi lj kz l la lb">19 |           rel="noopener noreferrer"<br/>    20 |         &gt;<br/>  &gt; 21 |           {t('learnReac')}<br/>       |              ^<br/>    22 |         &lt;/a&gt;<br/>    23 |         &lt;select defaultValue={i18n.language} onChange={(e) =&gt; i18n.changeLanguage(e.target.value)}&gt;<br/>    24 |           {availableLanguages.map((language) =&gt; (</span></pre><p id="d267" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，IDE将建议自动完成选项，在这种情况下:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lk"><img src="../Images/ab76b30c5e8805d5de89e55eccce995b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qxCPc90KbujgMn-eYhwkkg.png"/></div></div></figure><h1 id="ec97" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="ae5b" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">老实说，在我开始使用<code class="du jl jm jn jo b">react-i18next</code>之前，我不知道有可能使翻译类型安全。这是一个惊人而有用的特性，它使得国际化过程变得更加简单。在本文中，我分享了一个简单的概念证明，它可以通过使用任何<code class="du jl jm jn jo b">react-i18next</code>特性进行扩展，比如名称空间和插值。示例源代码可在<a class="ae ks" href="https://github.com/lucky-libora/blog-typed-react-i18n" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><p id="1d8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这个话题对你有帮助。如果你有任何问题，请随意写评论。</p><p id="a38c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ll">下次见！Servus！</em></p></div></div>    
</body>
</html>