<html>
<head>
<title>Use Meeting URLs for an Agora Video Call with the React Native UIKit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过React原生UIKit将会议URL用于Agora视频通话</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/use-meeting-urls-for-an-agora-video-call-with-the-react-native-uikit-d289dc5d9aa2?source=collection_archive---------4-----------------------#2022-04-04">https://medium.com/geekculture/use-meeting-urls-for-an-agora-video-call-with-the-react-native-uikit-d289dc5d9aa2?source=collection_archive---------4-----------------------#2022-04-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2a495af5a107bdc1378c8a81ea799da1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xSOE0wy6-1JbOJguOTL1ZQ.jpeg"/></div></div></figure><p id="10be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">更新20-3-22</strong>:博客已经更新，可以与Agora React Native UIKit的4.0.0版协同工作。</p><p id="4ee8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">加入视频通话最简单的方法是分享一个独特的链接。在本教程中，我们将学习如何使用React Native的通用链接来打开您的视频通话或使用React Native UIKit构建的直播应用程序。</p><p id="cc6b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要了解更多关于React Native UIKit的信息，您可以阅读<a class="ae jo" href="https://www.agora.io/en/creating-a-react-native-video-chat-app-in-a-few-lines-of-code-using-agora-uikit/" rel="noopener ugc nofollow" target="_blank">发布博客</a>或访问<a class="ae jo" href="https://github.com/AgoraIO-Community/ReactNative-UIKit/" rel="noopener ugc nofollow" target="_blank"> GitHub </a>。你也可以在这里找到这篇博文<a class="ae jo" href="https://github.com/EkaanshArora/Agora-RN-UIKit-Universal-Link" rel="noopener ugc nofollow" target="_blank">的完成项目。</a></p><h1 id="67a5" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">先决条件</h1><ul class=""><li id="32e0" class="kn ko hi is b it kp ix kq jb kr jf ks jj kt jn ku kv kw kx bi translated">一个Agora开发者账号(免费！<a class="ae jo" href="https://sso.agora.io/en/signup?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=use-meeting-urls-for-an-agora-video-call-with-the-react-native-uikit" rel="noopener ugc nofollow" target="_blank">在这里报名</a></li><li id="f8ba" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx bi translated">Node.js LTS版本</li><li id="2bad" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx bi translated">世博会CLI ( <code class="du ld le lf lg b">npm i -g expo-cli</code></li><li id="a431" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx bi translated">对React Native和Expo的理解</li></ul><p id="a455" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了让我们快速了解基本的样板文件，我使用<code class="du ld le lf lg b">expo-cli</code>来创建一个使用<code class="du ld le lf lg b">tabs (TypeScript)</code>模板的项目。当提示输入模板时，您可以通过执行<code class="du ld le lf lg b">expo-cli init</code>并选择制表符选项来使用相同的起点。你可以在任何使用<a class="ae jo" href="https://reactnavigation.org/" rel="noopener ugc nofollow" target="_blank">反应导航</a>库的应用上遵循同样的步骤。</p><p id="18db" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要在Expo项目中使用UIKit，我们需要安装<code class="du ld le lf lg b">expo-dev-client</code>包(<code class="du ld le lf lg b">expo install expo-dev-client</code>)和Agora React Native UIKit包(<code class="du ld le lf lg b">yarn add react-native-agora agora-react-native-rtm agora-rn-uikit</code>)。</p><h1 id="c232" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">使用Expo的链接</h1><p id="ded4" class="pw-post-body-paragraph iq ir hi is b it kp iv iw ix kq iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">链接一个app有两种方式:深度链接和通用链接。深度链接是这样的:<code class="du ld le lf lg b">exp://com.uikit/screen-one?data=hello</code>。它不是使用http/https协议，而是以一个方案开始，在Expo应用程序的情况下，该方案被设置为<code class="du ld le lf lg b">exp</code>。您可以将其更改为您的应用程序的任何内容。我们就用<code class="du ld le lf lg b">uikit://</code>。</p><p id="be8c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通用链接是您的应用程序也支持的普通web URLs。例如，像<code class="du ld le lf lg b">https://myapp.com/screen-one?data=hello</code>这样的URL可以在你的网站上打开，但如果支持的话，也可以直接打开你的应用。我们将讨论如何使用深层链接和通用链接。如果你对这里描述的任何概念感到困惑，世博会文件是一个很好的资源。</p><p id="144d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们更新<code class="du ld le lf lg b">app.json</code>文件来定义对我们的通用链接的支持。让我们把<code class="du ld le lf lg b">example.com</code>作为我们的主机名称:</p><pre class="lk ll lm ln fd lo lg lp lq aw lr bi"><span id="7ecd" class="ls jq hi lg b fi lt lu l lv lw">"scheme": "uikit",<br/>...<br/>"ios": {<br/>	"supportsTablet": true<br/>	"supportsTablet": true,<br/>	"bundleIdentifier": "com.ekaansh.uikitlink",<br/>	"infoPlist": {<br/>		"LSApplicationQueriesSchemes": ["uikit"],<br/>		"NSCameraUsageDescription": "camera perm",<br/>		"NSMicrophoneUsageDescription": "mic perm"<br/>	},<br/>	"associatedDomains": ["applinks:example.com"]<br/>},<br/>...<br/>"android": {<br/>	...<br/>	"package": "com.ekaansh.uikitlink",<br/>	"intentFilters": [<br/>	{<br/>		"action": "VIEW",<br/>		"data":{<br/>			"scheme": "https",<br/>			"host": "*.example.com"<br/>		},<br/>		"category": [<br/>			"BROWSABLE",<br/>			"DEFAULT"<br/>		]<br/>	}<br/>	]<br/>},</span></pre><p id="d63d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">保存更改，然后执行<code class="du ld le lf lg b">expo prebuild</code>。这将修改本地项目文件(如<code class="du ld le lf lg b">AndoidManifest.xml</code>和<code class="du ld le lf lg b">info.plist</code>)来添加我们的域配置。</p><h1 id="aa07" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">设置域</h1><h2 id="67d2" class="ls jq hi bd jr lx ly lz jv ma mb mc jz jb md me kd jf mf mg kh jj mh mi kl mj bi translated">iOS的AASA配置</h2><p id="fd3b" class="pw-post-body-paragraph iq ir hi is b it kp iv iw ix kq iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">要在iOS上实现通用链接，您必须首先通过从您的web服务器提供苹果应用程序站点协会(AASA)文件来设置验证您拥有您的域名。文件应该从<code class="du ld le lf lg b">/.well-known/apple-app-site-association</code>开始提供(没有扩展名)。向您的CDN添加适当的头文件，以确保该文件使用了<code class="du ld le lf lg b">Content-Type=application/pkcs7-mime</code>头文件。<br/>AASA文件示例如下:</p><pre class="lk ll lm ln fd lo lg lp lq aw lr bi"><span id="0d04" class="ls jq hi lg b fi lt lu l lv lw">{<br/>  "applinks": {<br/>    "apps": [],<br/>    "details": [{<br/>      <!-- -->"appID": "&lt;APPLE_TEAM_ID.APP_BUNDLE_ID&gt;",<br/>      "paths": ["*"]<br/>    }]<br/>  }<br/>}</span></pre><p id="6731" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要设置vercel的头，您可以使用以下示例vercel.json文件:</p><pre class="lk ll lm ln fd lo lg lp lq aw lr bi"><span id="8d10" class="ls jq hi lg b fi lt lu l lv lw">{<br/>  "headers": [{<br/>    "source": "/apple-app-site-association"<br/>    "headers" : [{<br/>      "key" : "Content-Type",<br/>      "value" : "application/pkcs7-mime"<br/>    }]<br/>  }]<br/>}</span></pre><p id="6076" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">访问<a class="ae jo" href="https://developer.apple.com/documentation/bundleresources/applinks" rel="noopener ugc nofollow" target="_blank">苹果文档</a>了解更多关于AASA格式的细节。</p><h2 id="be74" class="ls jq hi bd jr lx ly lz jv ma mb mc jz jb md me kd jf mf mg kh jj mh mi kl mj bi translated">验证Android的域(可选)</h2><p id="3a60" class="pw-post-body-paragraph iq ir hi is b it kp iv iw ix kq iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">默认情况下，使用通用链接时，您会看到选择应用程序对话框。如果您希望您的链接总是打开您的应用程序而不显示选择应用程序对话框，您必须在<code class="du ld le lf lg b">/.well-known/assetlinks.json</code>发布一个JSON文件，指定您的Android应用程序id以及您的应用程序应该打开哪些链接。详见<a class="ae jo" href="https://developer.android.com/training/app-links/verify-site-associations" rel="noopener ugc nofollow" target="_blank">安卓文档</a>。</p><h1 id="0953" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">设置链接</h1><p id="c89a" class="pw-post-body-paragraph iq ir hi is b it kp iv iw ix kq iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">在<code class="du ld le lf lg b">navigation/LinkingConfiguration.tsx</code>文件中，我们将更新前缀以支持通用链接:</p><pre class="lk ll lm ln fd lo lg lp lq aw lr bi"><span id="e610" class="ls jq hi lg b fi lt lu l lv lw">prefixes: [‘https://example.com', Linking.createURL(‘/’)]</span></pre><p id="9b1b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这使得应用路由器可以处理通用链接和深层链接。</p><p id="ab88" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们修改第二个屏幕(<code class="du ld le lf lg b">./screens/TabTwoScreen.tsx</code>)来打开UIKit。我们将通道存储为状态变量。我们将为URL添加一个监听器，从查询中提取通道并更新我们的状态:</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="1949" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们将创建一个<code class="du ld le lf lg b">useEffect</code>钩子，当应用程序从通用链接打开时，从查询中获取频道。我们将使用<code class="du ld le lf lg b">getInitialUrl</code>和<code class="du ld le lf lg b">parse</code>方法提取通道并更新状态:</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="2478" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们可以渲染UIKit。你可以在这里阅读更多关于如何设置<a class="ae jo" href="https://www.agora.io/en/creating-a-react-native-video-chat-app-in-a-few-lines-of-code-using-agora-uikit/" rel="noopener ugc nofollow" target="_blank">的信息。确保将您自己的应用ID添加到<code class="du ld le lf lg b">rtcProps</code>:</a></p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="e761" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要从应用程序中打开UIKit屏幕，我们可以使用expo中的<code class="du ld le lf lg b">Linking</code>并调用deeplink <code class="du ld le lf lg b">uikit://two?channel=test</code>。我将添加一个<code class="du ld le lf lg b">&lt;Text&gt;</code>组件来导航到<code class="du ld le lf lg b">./screens/TabOneScreen.tsx</code>中的UIKit:</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="mk ml l"/></div></figure><h1 id="cf7c" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">奖励:生成链接</h1><p id="3ff6" class="pw-post-body-paragraph iq ir hi is b it kp iv iw ix kq iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">生成唯一链接的一种快速方法是使用JavaScript中的<code class="du ld le lf lg b">Date</code>对象使用当前时间戳。这里有一个创建新房间的简单函数:</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="mk ml l"/></div></figure><h1 id="bff1" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="7e65" class="pw-post-body-paragraph iq ir hi is b it kp iv iw ix kq iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">相对而言，这是一种使用React Native和Expo在Android和iOS中设置通用链接的无痛方式。你可以阅读<a class="ae jo" href="https://docs.expo.dev/guides/linking/#aasa-configuration" rel="noopener ugc nofollow" target="_blank"> Expo </a>和<a class="ae jo" href="https://reactnavigation.org/docs/deep-linking/" rel="noopener ugc nofollow" target="_blank"> React导航</a>文档了解更多信息。</p><p id="43ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您在使用Agora React Native UIKit时有任何问题，我邀请您加入<a class="ae jo" href="https://agora.io/en/join-slack" rel="noopener ugc nofollow" target="_blank"> Agora开发者Slack社区</a>，您可以在<code class="du ld le lf lg b">#react-native-help-me</code>频道中提问。欢迎提出功能请求或在<a class="ae jo" href="https://github.com/AgoraIO-Community/ReactNative-UIKit/issues" rel="noopener ugc nofollow" target="_blank"> GitHub Repo </a>上报告错误。</p></div></div>    
</body>
</html>