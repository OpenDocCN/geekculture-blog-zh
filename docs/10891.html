<html>
<head>
<title>How To Use Monaco Editor In VueJS: The missing guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用VueJS中的摩纳哥编辑器:失踪的指南</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-use-monaco-editor-in-vuejs-the-missing-guide-1aa7ac61ed12?source=collection_archive---------1-----------------------#2022-02-21">https://medium.com/geekculture/how-to-use-monaco-editor-in-vuejs-the-missing-guide-1aa7ac61ed12?source=collection_archive---------1-----------------------#2022-02-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/589b5b48b7b1842162666953519c59dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vbvF1xkLzJ32hFU-riIDow.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Monaco Port Hercule, Photo by <a class="ae iu" href="https://unsplash.com/@matthiasmullie?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Matthias Mullie</a> on <a class="ae iu" href="https://unsplash.com/s/photos/monaco?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b7f1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你知道你在找什么或看到一些代码，立即检查这个 git repo。</p><p id="09c3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">随着教育技术平台的蓬勃发展，有一天你可能会在一个有人想教编码的网站上找到一份工作，这并不奇怪。编码教学是一个互动的过程。你必须展示代码，让学生写代码，代码需要在某个地方测试，还有各种各样的麻烦。</p><p id="c394" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">今天，我想重点介绍如何在浏览器中的强大代码编辑器中显示/编写代码。能够在浏览器上提供类似vs-code的功能，包括语法高亮、自动缩进，甚至自动完成，这难道不好吗？</p><p id="ceb9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">是的，这可以通过<a class="ae iu" href="https://microsoft.github.io/monaco-editor/" rel="noopener ugc nofollow" target="_blank">摩纳哥-编辑</a>来完成。这是一件很棒的事情。但我挣扎过。我努力想融入Vue-js。是的，已经有很多第三方插件使得使用monaco-editor和Vue变得轻而易举。但是使用它们，我无法启用自动完成、文档字符串可视化、定位定义等功能。所以我采取了强硬手段。</p><p id="f57b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本文是多日来浏览SO、medium帖子、github问题的总结。我终于能让它工作了。但我毫不惭愧地承认，我仍然对一些部分感到困惑，如果你知道/发现任何更好的方法，请提出建议。让我们开始吧:</p><h1 id="97f4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">前端</h1><p id="49f5" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我假设你已经有一个vue js项目启动并运行。我正在使用一个空的vue项目，并且刚刚创建了一个空的组件，如下所示:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="1238" class="lf ju hi lb b fi lg lh l li lj">&lt;template&gt;<br/>    &lt;div&gt;&lt;/div&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/>export default {<br/>    name: 'Editor'<br/>}<br/>&lt;/script&gt;</span></pre><p id="84d8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下一件事你需要做的是，安装摩纳哥编辑器和其他一些依赖工作与vue js。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="727d" class="lf ju hi lb b fi lg lh l li lj">npm install monaco-editor monaco-editor-webpack-plugin monaco-languageclient @monaco-editor/loader</span></pre><p id="1d78" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在您需要添加一些配置来使这些库与您的vue项目一起工作。如果您的项目中没有<strong class="ix hj"> vue.config.js </strong>文件，请在<strong class="ix hj"> package.json </strong>所在的同一级别创建，并将以下内容放入其中:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="2a6b" class="lf ju hi lb b fi lg lh l li lj">const MonacoWebpackPlugin = require("monaco-editor-webpack-plugin");<br/>const path = require("path");<br/>module.exports = {<br/>  configureWebpack: {<br/>    plugins: [<br/>      new MonacoWebpackPlugin({<br/>        languages: ["python"],//configure your languages here<br/>        features: ["coreCommands", "find"],<br/>      }), // Place it here<br/>    ],<br/>  },<br/>  chainWebpack: (config) =&gt; {<br/>    config.resolve.alias.set(<br/>      "vscode",<br/>      path.resolve(<br/>        "./node_modules/monaco-languageclient/lib/vscode-compatibility"<br/>      )<br/>    );<br/>  },<br/>};</span></pre><p id="93d6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以看到我只是为<strong class="ix hj"> python </strong>配置它，你应该可以用任何支持的语言来做。</p><p id="7810" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们可以去组件那里初始化一个编辑器。</p><p id="a5ec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们给模板中的div一个id，并设置高度和宽度。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="6046" class="lf ju hi lb b fi lg lh l li lj">&lt;template&gt;<br/>    &lt;div id="editor" style="width: 500px; height: 500px"&gt;&lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="da9e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个高度和宽度不一定要固定成这样。您也可以通过编程来设置它们。但是你必须设置它们，否则编辑器是不可见的。</p><p id="9080" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在在<strong class="ix hj">脚本</strong>部分，你必须像这样初始化编辑器:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="f749" class="lf ju hi lb b fi lg lh l li lj">import loader from "@monaco-editor/loader";<br/><br/>export default {<br/> name: "Editor",<br/> async mounted() {<br/><br/>   loader.init().then((monaco) =&gt; {<br/><br/>     monaco.editor.create(document.getElementById("editor"));<br/>    <br/>   });<br/>  <br/> },<br/>};</span></pre><p id="8fab" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，loader将做一些幕后工作，使编辑器在浏览器中工作，并给你一个<strong class="ix hj"> monaco </strong>的实例，你需要根据你的需要调整它。</p><p id="5d30" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这一步之后，如果你重新加载浏览器，你会看到一个编辑器，在那里你可以写代码。下面是编辑器的一个片段，我在其中粘贴了一些代码:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/a9a3744b154dab9b01822f0d3b2fe328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/0*2hgOfeVcy5NJAskE"/></div><figcaption class="iq ir et er es is it bd b be z dx">Editor on browser fist look</figcaption></figure><p id="6b9e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">哦耶！有一个很好看的带有行号的编辑器，右边还有我们在vs代码中经常看到的小地图。但是嘿！语法高亮在哪里？如果你试着自己写而不是粘贴，你会注意到所有python编辑器支持的自动缩进也不起作用。</p><p id="74af" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们要做的是，在初始化期间，我们必须提到编辑器正在处理哪种语言，就像这样:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="1c68" class="lf ju hi lb b fi lg lh l li lj">export default {<br/>  name: "Editor",<br/>  async mounted() {<br/><br/>    loader.init().then((monaco) =&gt; {<br/>      const editorOptions = {<br/>           language: "python",<br/>           minimap: { enabled: false },<br/>       };<br/><br/>      monaco.editor.create(document.getElementById("editor"),   editorOptions);<br/>      <br/>    });<br/>    <br/>  },<br/>};</span></pre><p id="0e90" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们看看编辑器是什么样子的:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/18c36f094c45a091417e82186a90ae2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/0*aR1_GSTMUn1vnPbS"/></div><figcaption class="iq ir et er es is it bd b be z dx">Editor looks great with syntax highlighting!</figcaption></figure><p id="f62b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">是的。现在有了语法高亮和自动缩进功能。我选择禁用小地图来证明这是可能的。在这里你可以找到所有可用的选项。我们创建了一个包含选项的对象，并在编辑器初始化期间将它传递给工厂。</p><p id="a58a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是仍然缺少一样东西。即代码建议、自动完成等。浏览器本身不能做到这一点。现在你必须有一个后端语言服务器。</p><h1 id="f798" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">后端</h1><p id="1540" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">在你电脑的某个地方，最好是在你的vue项目的文件夹旁边，创建一个名为<strong class="ix hj"> lang-server </strong>或者其他有意义的目录。<strong class="ix hj"> Cd </strong>到这个目录，用这个初始化一个npm包:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="f8db" class="lf ju hi lb b fi lg lh l li lj">npm init</span></pre><p id="b69c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将在lang-server文件夹中创建一个<strong class="ix hj"> packages.json </strong>和<strong class="ix hj"> node_modules </strong>。这将有助于将依赖项与计算机中的基本节点安装分开。现在，使用以下命令安装所需的库:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="2959" class="lf ju hi lb b fi lg lh l li lj">npm install  vscode-ws-jsonrpc vscode-languageserver ws</span></pre><p id="721b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在你需要安装一个名为python-language-server<strong class="ix hj"/>的python库，它将真正提供python的自动完成、建议等功能。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="6aa8" class="lf ju hi lb b fi lg lh l li lj">pip install python-language-server</span></pre><p id="9e05" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我假设您的机器上已经安装了python。如果没有，您必须这样做，但这超出了本文的范围。</p><p id="5323" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您必须创建一个中间件来确保您的前端和python语言服务器之间的通信。在<strong class="ix hj"> lang-server </strong>目录下创建一个名为<strong class="ix hj"> py-ls-middleware.js </strong>的文件，内容如下:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="0958" class="lf ju hi lb b fi lg lh l li lj">const rpc = require('vscode-ws-jsonrpc')<br/>const server = require('vscode-ws-jsonrpc/lib/server')<br/>const lsp = require('vscode-languageserver')<br/><br/>const WebSocket = require('ws');<br/><br/>const wss = new WebSocket.Server({ port: 8989 });<br/><br/>function launch (socket) {<br/>  const reader = new rpc.WebSocketMessageReader(socket)<br/>  const writer = new rpc.WebSocketMessageWriter(socket)<br/>  const socketConnection = server.createConnection(reader, writer, () =&gt; socket.dispose())<br/>  const serverConnection = server.createServerProcess('JSON', 'pyls')<br/>  server.forward(socketConnection, serverConnection, message =&gt; {<br/>    console.log(message)<br/>    if (rpc.isRequestMessage(message)) {<br/>      if (message.method === lsp.InitializeRequest.type.method) {<br/>        const initializeParams = message.params<br/>        initializeParams.processId = process.pid<br/>      }<br/>    }<br/>    return message<br/>  })<br/>}<br/><br/>wss.on('connection', function connection(ws) {<br/>  const socket = {<br/>    send:(content)=&gt;ws.send(content,(error)=&gt;{<br/>      if(error){<br/>        console.log(error)<br/>      }<br/>    }),<br/>    onMessage:(cb)=&gt;ws.on('message',cb),<br/>    onError:(cb)=&gt;ws.on('error',cb),<br/>    onClose:(cb)=&gt;ws.on('close',cb),<br/>    dispose:(cb)=&gt;ws.close()<br/>  }<br/>  launch(socket)<br/>})</span></pre><p id="d6ea" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它在端口8989公开一个websocket连接，并在语言客户端和语言服务器之间传递消息。</p><p id="bf46" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在只剩下一件事了。也就是在vue app和这个中间件之间建立通信。</p><h1 id="0dea" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">前端…又来了</h1><p id="2ece" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">为此，我们现在必须在我们的vue应用程序中安装monaco-languageclient和vscode-ws-jsonrpc。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="033c" class="lf ju hi lb b fi lg lh l li lj">npm install monaco-languageclient vscode-ws-jsonrpc</span></pre><p id="556e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，在脚本标记中执行以下导入操作:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="54ed" class="lf ju hi lb b fi lg lh l li lj">import { listen } from "vscode-ws-jsonrpc";<br/><br/>window.setImmediate = window.setTimeout;<br/><br/>import {<br/>  MonacoLanguageClient,<br/>  CloseAction,<br/>  ErrorAction,<br/>  createConnection,<br/>  MonacoServices,<br/>} from "monaco-languageclient";</span></pre><p id="24b2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后在loader的init方法的回调函数的末尾添加以下两行:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="30fa" class="lf ju hi lb b fi lg lh l li lj">MonacoServices.install(monaco);<br/>this.connectToLangServer();</span></pre><p id="f736" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第一行将使语言客户端能够使用编辑器实例。第二行是我们必须写的方法调用。我们将把它写在vue的方法中。</p><p id="8983" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">看起来是这样的:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="948c" class="lf ju hi lb b fi lg lh l li lj">connectToLangServer: function () {<br/>      const webSocket = new WebSocket("ws://127.0.0.1:8989");<br/><br/>      listen({<br/>        webSocket: webSocket,<br/>        onConnection: (connection) =&gt; {<br/>          var languageClient = this.createLanguageClient(connection);<br/>          var disposable = languageClient.start();<br/><br/>          connection.onClose(function () {<br/>            return disposable.dispose();<br/>          });<br/>          <br/>          connection.onError(function (error) {<br/>            console.log(error);<br/>          });<br/>        },<br/>      });<br/>    },</span></pre><p id="c4e0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里我们连接到由lang-server中间件打开的套接字，然后用所需的参数覆盖vscode-ws-jsonrpc的listen方法。我们必须编写另一个在<strong class="ix hj"> connectToLangServer，</strong>内部调用的方法，就是这个:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="da45" class="lf ju hi lb b fi lg lh l li lj">createLanguageClient: function (connection) {<br/><br/>      return new MonacoLanguageClient({<br/>        name: "Monaco language client",<br/>        clientOptions: {<br/>          documentSelector: ["python"],<br/>          errorHandler: {<br/>            error: () =&gt; ErrorAction.Continue,<br/>            closed: () =&gt; CloseAction.DoNotRestart,<br/>          },<br/>        },<br/><br/>        connectionProvider: {<br/>          get: (errorHandler, closeHandler) =&gt; {<br/>            return Promise.resolve(<br/>              createConnection(connection, errorHandler, closeHandler)<br/>            );<br/>          },<br/>        },<br/>      });<br/>    },</span></pre><p id="2fbb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在要运行整个系统，您必须运行中间件和开发服务器。像这样运行中间件:</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="17a7" class="lf ju hi lb b fi lg lh l li lj">node py-ls-middleware.js</span></pre><p id="6a06" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在检查编辑器，它显示建议:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/f1a9b2c6bcc4c81f7357fa046571fd4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/0*Sy-InWtwReCB7LvD"/></div></figure><p id="975b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">还显示了文档字符串和类签名:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/1d91c33aaabb2f6e496c1e7a4508b064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/0*OidugvoPyJv7VYFr"/></div></figure><p id="d1cf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">也显示了一个类的其他属性！</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/073769a2c534578abafef44debc0818c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/0*V0ihW1jiys84Lez8"/></div></figure><p id="b066" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是你开始的全部。这只是一些玩具代码。可能需要许多层次强化和重构。比如处理与lang服务器的突然断开，模块化vue组件等等。我也计划尝试其他语言服务器。密切关注提到的回购下文。</p><p id="3755" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">https://github.com/Ruhshan/Vue-monaco-demo<a class="ae iu" href="https://github.com/Ruhshan/Vue-monaco-demo" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>