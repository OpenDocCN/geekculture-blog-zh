<html>
<head>
<title>5 Key Elements of Azure Cosmos DB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure Cosmos DB的5个关键元素</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/5-key-items-to-know-about-azure-cosmos-db-57da048ad328?source=collection_archive---------18-----------------------#2021-11-04">https://medium.com/geekculture/5-key-items-to-know-about-azure-cosmos-db-57da048ad328?source=collection_archive---------18-----------------------#2021-11-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a463" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们先介绍一下微软Azure的完全托管的NoSQL数据库——Azure Cosmos DB。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/958cf9c9fc7a4f3c13d53fa1d4a82185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*btEy0NMH8CJQraEC"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/@homajob?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Scott Graham</a> on <a class="ae jt" href="https://unsplash.com/s/photos/cloud-computing?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e1d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Azure Cosmos DB具有以下(但不是全部)优势:</p><ol class=""><li id="9ca0" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">任何规模的保证速度</li><li id="71b0" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">关键任务就绪(确保99.999%的可用性和企业级安全性)</li><li id="b28d" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">全面管理且经济高效(自动扩展和端到端数据库管理)</li></ol><p id="74b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ki">您可以在这里</em>  <em class="ki">阅读更多详情和其他优惠</em> <a class="ae jt" href="https://docs.microsoft.com/en-us/azure/cosmos-db/introduction" rel="noopener ugc nofollow" target="_blank"> <em class="ki">。</em></a></p><h2 id="4f33" class="kj kk hi bd kl km kn ko kp kq kr ks kt iq ku kv kw iu kx ky kz iy la lb lc ld bi translated"><strong class="ak">Azure Cosmos DB有哪些可用的容量模式？</strong></h2><p id="72c6" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated"><strong class="ih hj">无服务器<br/> </strong>基于消耗，只对数据库操作和存储消耗的请求单元(ru)收费。这对于您还不知道用途的原型或小型应用程序来说可能是好的。</p><p id="c23f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">调配吞吐量<br/> </strong>您可以在数据库级别或容器级别应用。即使您没有使用，也会按照您提供的金额向您收费。如果您的应用程序对数据库有稳定的高消耗需求，建议您这样做。</p><p id="db11" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，两种不同模式的存储/速率限制可能不同。我在下面强调了一些关键的问题。</p><p id="c15d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还不确定选择哪种模式？看看微软的这个 <a class="ae jt" href="https://docs.microsoft.com/en-us/azure/cosmos-db/throughput-serverless" rel="noopener ugc nofollow" target="_blank"> <em class="ki">例子</em> </a> <em class="ki">。</em></p><h2 id="5c93" class="kj kk hi bd kl km kn ko kp kq kr ks kt iq ku kv kw iu kx ky kz iy la lb lc ld bi translated"><strong class="ak">什么是分区键？</strong></h2><p id="2fa3" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">Azure Cosmos DB需要一种方法来“切割”我们的数据，以便进行缩放，它使用您在此操作中选择的分区键。</p><p id="bcf1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分区键告诉Azure Cosmos DB如何将数据分组到一个<code class="du lj lk ll lm b">Logical Partition</code>中，因此同一逻辑分区中的所有项目都具有相同的分区键值。例如，在一个超市场景中，一个容器容纳它出售的所有类型的商品。每个项目都有项目Id和项目类型(如水果、蔬菜或饮料)。如果选择 <code class="du lj lk ll lm b"><em class="ki">itemType</em></code> <em class="ki">作为分区键，所有水果项将在一个逻辑分区中，所有蔬菜项将在另一个逻辑分区中，以此类推。</em></p><p id="07ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您必须在容器的供应阶段预先指定分区键，此后不允许进行任何更改。任何改变都需要数据迁移，这将是另一个话题。分区键的选择将影响cosmos db的性能。因此，在开始Azure Cosmos DB之旅之前，理解分区键应该考虑的不同因素是非常重要的。不要担心，我会分享另一篇关于一个人必须考虑的关键因素的文章！</p><h2 id="850a" class="kj kk hi bd kl km kn ko kp kq kr ks kt iq ku kv kw iu kx ky kz iy la lb lc ld bi translated"><strong class="ak">关于逻辑分区的更多信息</strong></h2><p id="b6e5" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">逻辑分区由一组具有相同分区键的项目组成。每个条目都有一个id，该id只能在逻辑分区中是唯一的。<em class="ki">以同一个超市为例，你可以有一个id = 1，itemType =水果的商品，另一个id = 1，itemType =蔬菜的商品。</em></p><p id="99c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据库事务的范围位于同一个逻辑分区内。因此，如果您的应用程序需要批量操作，或者您可能需要运行存储过程/触发器，您必须仔细考虑需要执行的项目，并尝试将它们组合在一起(<em class="ki">这是考虑的因素之一</em>)。</p><p id="46ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然容器中的逻辑分区数量没有限制，但是每个逻辑分区的最大存储容量为20GB ( <em class="ki">这是另一个考虑因素</em>..</p><h2 id="66b4" class="kj kk hi bd kl km kn ko kp kq kr ks kt iq ku kv kw iu kx ky kz iy la lb lc ld bi translated"><strong class="ak">关于物理分区的更多信息</strong></h2><p id="7d8a" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">您可能到处听说过物理分区，但它可能非常简短。基本上，物理分区是Azure Cosmos DB服务器的实际物理存储。容器通过在物理分区之间分布数据(逻辑分区)和吞吐量来扩展。以下是决定物理分区数量的两个因素:</p><ol class=""><li id="d9e8" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">总数据存储量。物理分区的最大存储容量为50GB。</li><li id="782e" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">调配的吞吐量数量。物理分区的最大吞吐量为10，000 RU /秒。因为逻辑分区被映射到物理分区，所以逻辑分区也具有相同的吞吐量限制。</li></ol><p id="c776" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就像逻辑分区一样，容器可以拥有的物理分区的数量没有限制。Azure Cosmos DB是一个托管数据库，我们不需要担心它，因为这些是内部实现，由Azure Cosmos DB本身控制。我们所要关心的是分区键，因为它被用来分配数据和吞吐量。分区键决策不当可能会导致热分区——当大多数请求被重定向到一小部分分区时，会导致调配的吞吐量使用效率低下(如果这是您选择的计划)、速率受限，当然还有高成本。</p><h2 id="5834" class="kj kk hi bd kl km kn ko kp kq kr ks kt iq ku kv kw iu kx ky kz iy la lb lc ld bi translated"><strong class="ak">限制</strong></h2><p id="93ea" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">除了我在前面几节中分享的逻辑和物理分区的标准最大存储大小之外，这里还有一些其他限制，根据您选择的消费计划，这些限制可能会有所不同。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="221c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个请求的限制</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="be8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ki">你可以在这里</em>  <em class="ki">找到更多关于其他极限</em> <a class="ae jt" href="https://docs.microsoft.com/en-us/azure/cosmos-db/concepts-limits" rel="noopener ugc nofollow" target="_blank"> <em class="ki">。</em></a></p><h2 id="741d" class="kj kk hi bd kl km kn ko kp kq kr ks kt iq ku kv kw iu kx ky kz iy la lb lc ld bi translated">摘要</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/11585d299d8600f7a21498a1993ab526.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X10ylhNOu8CB0kOs9PYMdw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Overview of Azure Cosmos DB Components (Shared throughput by container)</figcaption></figure><p id="2d36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上图描述了所有不同组件的概要，以及它们在Azure Cosmos DB中的连接方式。它演示了在容器共享吞吐量的情况下，逻辑分区到物理分区的映射。但是，如果改为在数据库上设置吞吐量，映射可能会有所不同，因为物理分区可以在不同的容器之间共享。</p><p id="948b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章在很高的层次上介绍了Azure Cosmos DB，我希望这些核心信息可以帮助您开始为应用程序设计数据库。感谢您的阅读，敬请关注下一篇关于选择<a class="ae jt" rel="noopener" href="/@mariochiadev/how-to-select-a-partition-key-in-azure-cosmos-db-partition-key-strategies-f44ba134790e">分区键</a>的文章！如果你喜欢这篇文章/觉得它有帮助，如果你能为我鼓掌或喜欢这篇文章以示支持和喜爱，我将不胜感激。</p></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><h2 id="6488" class="kj kk hi bd kl km kn ko kp kq kr ks kt iq ku kv kw iu kx ky kz iy la lb lc ld bi translated">参考</h2><p id="17ae" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated"><a class="ae jt" href="https://docs.microsoft.com/en-us/azure/cosmos-db/" rel="noopener ugc nofollow" target="_blank">微软官方文档</a></p></div></div>    
</body>
</html>