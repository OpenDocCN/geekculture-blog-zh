<html>
<head>
<title>Stripe Integration with Flutter and Firebase Cloud Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带颤振和火焰基云功能的条纹集成</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/stripe-integration-with-flutter-and-firebase-cloud-functions-1caac8d70166?source=collection_archive---------11-----------------------#2021-05-31">https://medium.com/geekculture/stripe-integration-with-flutter-and-firebase-cloud-functions-1caac8d70166?source=collection_archive---------11-----------------------#2021-05-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/a7933fce5400e78dfad8b609f0bc8adb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j0B-9xioEenugvy1E0DTww.png"/></div></div></figure><div class=""/><p id="7aea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我最近的一个Flutter项目中，我被要求为支付集成Stripe SDK，我在后端使用Firebase。对我来说，这是一个相当具有挑战性的任务，因为没有太多的在线资源可以为这样的框架清晰地设置云功能。因此，我想写下并分享我在这方面的经验。</p><p id="dcaf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们继续深入这个话题之前，你应该已经掌握了一些关于颤振和火焰基的知识。</p><p id="5532" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以，我们开始吧，好吗？😊</p><p id="ff17" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们从创建一个样本Flutter项目开始。您可以将其命名为<strong class="is hu"> StripeFlutterProject </strong>并设置您的main.dart文件。</p><p id="3506" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您需要将这两个包添加到您的<strong class="is hu"> <em class="jo"> pubspec.yml </em> </strong>文件中:</p><blockquote class="jp jq jr"><p id="4bd2" class="iq ir jo is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated">条纹_支付:^1.0.6</p><p id="f90c" class="iq ir jo is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated">云_功能:^0.7.2</p></blockquote><p id="5625" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在此之前，您必须创建一个Stripe SDK和Firebase帐户。我不打算详细说明，但是这里有一些链接，你可以通过它们来创建你的账户。</p><div class="hh hi ez fb hj jv"><a href="https://stripe.com/en-sg" rel="noopener  ugc nofollow" target="_blank"><div class="jw ab dw"><div class="jx ab jy cl cj jz"><h2 class="bd hu fi z dy ka ea eb kb ed ef hs bi translated">互联网企业的在线支付处理— Stripe</h2><div class="kc l"><h3 class="bd b fi z dy ka ea eb kb ed ef dx translated">互联网业务的在线支付处理。Stripe是一套支付API，支持在线商务…</h3></div><div class="kd l"><p class="bd b fp z dy ka ea eb kb ed ef dx translated">stripe.com</p></div></div></div></a></div><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="7415" class="kn ko ht kj b fi kp kq l kr ks"><a class="ae kt" href="https://firebase.google.com/docs/projects/learn-more#setting_up_a_firebase_project_and_registering_apps" rel="noopener ugc nofollow" target="_blank">https://firebase.google.com/docs/projects/learn-more#setting_up_a_firebase_project_and_registering_apps</a></span></pre><p id="07c4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，你需要在控制台建立一个Firebase项目和数据库。然后，您可以添加更多的包(下面提供的版本是我在我的项目中使用的版本。或者，您可以将最新的稳定包添加到您的Flutter项目中，用于下面列出的Firebase配置；</p><blockquote class="jp jq jr"><p id="9f80" class="iq ir jo is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated">燃烧基地核心:^0.5.3</p><p id="7ded" class="iq ir jo is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated">火情_消息:^6.0.16</p><p id="c219" class="iq ir jo is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated">数据库:^4.4.0</p></blockquote><p id="211b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步是从Firebase控制台下载<strong class="is hu"><em class="jo">Google service-info . plist</em></strong>文件，并添加到Android和iOS文件夹中。</p><p id="8bce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，对于后端(云函数)，您将必须创建一个节点项目，我们在其中编写所有的条带函数。将您的条形密钥和功能存储在后端更加安全，它允许您执行所有与支付相关的繁重任务。</p><p id="8f50" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我正在添加基本的支付云功能。我一个一个解释。要设置云函数，请创建一个node.is项目。或者，你也可以在谷歌云控制台中添加云功能。我将创建一个单独的云函数项目，让我们命名为<em class="jo">条纹云函数</em>。</p><p id="16e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在此之前，请安装Firebase工具，并使用命令行登录到您的Firebase帐户。</p><blockquote class="jp jq jr"><p id="b795" class="iq ir jo is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated">NPM install-g fire base-工具</p></blockquote><p id="d882" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以通过以下链接设置您的云功能项目:</p><div class="hh hi ez fb hj jv"><a href="https://firebase.google.com/docs/functions/get-started" rel="noopener  ugc nofollow" target="_blank"><div class="jw ab dw"><div class="jx ab jy cl cj jz"><h2 class="bd hu fi z dy ka ea eb kb ed ef hs bi translated">开始:编写、测试和部署您的第一个功能| Firebase</h2><div class="kc l"><h3 class="bd b fi z dy ka ea eb kb ed ef dx translated">编辑描述</h3></div><div class="kd l"><p class="bd b fp z dy ka ea eb kb ed ef dx translated">firebase.google.com</p></div></div><div class="ku l"><div class="kv l kw kx ky ku kz hp jv"/></div></div></a></div><p id="148e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以在index.ts中添加以下函数:</p><figure class="ke kf kg kh fd hk"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="0e6a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您需要在firebase控制台上部署这些云功能。下一步是从你的flutter应用程序中调用这个云函数，让我们在你的flutter应用程序中添加代码，通过http从你的应用程序中触发上述云函数。</p><p id="411c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">注意</strong>:在你的<em class="jo"> pubspec.yaml </em>文件中添加云函数包；</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="8470" class="kn ko ht kj b fi kp kq l kr ks">cloud_functions: ^0.9.0</span></pre><p id="2020" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不要忘记运行<strong class="is hu"> <em class="jo"> flutter pub get </em> </strong>一旦你在项目中添加了新的包，现在在你的flutter项目中创建一个<strong class="is hu"><em class="jo">firebase service . dart</em></strong>文件，这个dart文件应该基本上可以处理你的firebase调用和引用。你可以用下面的意图添加你的云函数引用，这里要注意的一点是你需要在你的可调用实例中传递云函数名。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="75c5" class="kn ko ht kj b fi kp kq l kr ks">//Cloud functions reference</span><span id="314a" class="kn ko ht kj b fi lc kq l kr ks">static final HttpsCallable CREATE_INTENT =   FirebaseFunctions.instance.httpsCallable('createPaymentIntent');</span><span id="44b3" class="kn ko ht kj b fi lc kq l kr ks">static final HttpsCallable GET_PAYMENT_INTENT =<br/>FirebaseFunctions.instance.httpsCallable('getUserPaymentIntent');</span><span id="3b85" class="kn ko ht kj b fi lc kq l kr ks">static final HttpsCallable CONFIRM_PAYMENT_INTENT = FirebaseFunctions.instance.httpsCallable('confirmPaymentIntent');</span><span id="03dc" class="kn ko ht kj b fi lc kq l kr ks">static final HttpsCallable CREATE_CUSTOMER_CHARGE = FirebaseFunctions.instance.httpsCallable('createCustomerCharge');<br/></span></pre><p id="4a61" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从你的flutter应用程序调用这些意图，它将基本上触发相应的云功能，你应该始终在后端处理支付业务逻辑(在这种情况下是云功能)，因为它更安全，并由stripe推荐。</p><p id="ae57" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要触发这些意图，您需要从相关的dart文件中调用它们(在我的例子中，它是显示我的卡的详细信息并要求用户付款的页面),如下所示:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="47cd" class="kn ko ht kj b fi kp kq l kr ks">FirebaseService.CREATE_INTENT.call(&lt;String, dynamic&gt;{ 'methodId':paymentMethod.id, 'amount': nAmount, 'currency': 'sgd', 'application_fee_amount':fee, 'stripeId':  widget.cardModel.stripe_account}).then((response) {</span><span id="53e2" class="kn ko ht kj b fi lc kq l kr ks">   print("itent response: " + response.data.toString());<br/>   hideLoading();       </span><span id="752e" class="kn ko ht kj b fi lc kq l kr ks">confirmDialog(response.data["client_secret"],response.data["payment_method"], response.data["id"]); //function for confirmation for payment</span><span id="534b" class="kn ko ht kj b fi lc kq l kr ks">}).catchError((error) {</span><span id="9eb1" class="kn ko ht kj b fi lc kq l kr ks">   print("intent error: " + error.toString());<br/>   hideLoading();</span><span id="dd05" class="kn ko ht kj b fi lc kq l kr ks">});</span></pre><p id="65d5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦您调用这个firebase服务意图，您的后端逻辑将运行，并在确认付款意图，用户的付款方式将被收费。在我的情况下，我使用卡支付方式，并在我的应用程序中提供的任何特定服务上收取用户卡的费用。</p><p id="5a58" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是现在，你们可以试试这个，如果我错过了什么，请在评论中告诉我，或者如果你们有更好的方法，请告诉我。</p><p id="8727" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">希望你喜欢阅读这篇文章😊。编码快乐，干杯！🍻</p></div></div>    
</body>
</html>