<html>
<head>
<title>Turn-Based Tactical Command System, Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">回合制战术指挥系统，第二部分</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/turn-based-tactical-command-system-part-2-f8c57abaec74?source=collection_archive---------14-----------------------#2021-08-06">https://medium.com/geekculture/turn-based-tactical-command-system-part-2-f8c57abaec74?source=collection_archive---------14-----------------------#2021-08-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="4b61" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">利用链表实现轻量级循环</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/7486b6c874000cbfaa4e6746c61a2c20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qol5ay3NamkaQEklOpg7tg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Poor Yellow.</figcaption></figure><p id="77f0" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">欢迎来到第二部分。摆在我们面前的目标:利用我们在<a class="ae kj" rel="noopener" href="/geekculture/roll-initiative-ec1343797da1">前四篇文章</a>(主动列表、回合列表、行动列表)中收集的所有信息，并使用这些数据在地图上以正确的顺序移动正确的棋子。</p><p id="51f1" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这个过程的大部分发生在这里，在ProcessRoundRoutine协程中:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kk"><img src="../Images/4f0fdb6bc7e930f09d05c7c1c3f90b4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3RK8-cmpcFA1EuyptEMtPw.png"/></div></div></figure><p id="b2a1" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这可以很容易地分成三个阶段:</p><h2 id="e356" class="kl km hi bd kn ko kp kq kr ks kt ku kv jw kw kx ky ka kz la lb ke lc ld le lf bi translated">找到每个列表的前面</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kk"><img src="../Images/604f976b9e81556a5238bb2a319cf424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o0QpyqPkhQQan5GmWquFpw.png"/></div></div></figure><p id="4fe2" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这是不言自明的。在这一轮开始时，我们需要被索引到每个列表的前面。</p><p id="5fa2" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">然后我们开始一个<em class="lg"> while </em>循环，这将一直持续到循环列表为空。在里面，我们做两件事:</p><h2 id="ed96" class="kl km hi bd kn ko kp kq kr ks kt ku kv jw kw kx ky ka kz la lb ke lc ld le lf bi translated">执行当前操作</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kk"><img src="../Images/e4dcf6aff171b45f72b5c7d9e58544f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cz1wOdADXx6i4_Fx04egdg.png"/></div></div></figure><p id="d11a" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在这里，我们检查传递给我们的是什么类型的信息，并向ExecuteAction()方法发送适当的重载:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kk"><img src="../Images/4c37babf07c5b70e02050523dab5b818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mLL-JeOZgk4K80kFgW3UDA.png"/></div></div></figure><p id="4cfb" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果我们得到一个专长和一个目标，那么这就是三个目标专长之一:移动一个可移动的物体，打碎一个易碎的物体，拯救一个可拯救的物体。现在，我只定义了移动。</p><p id="22d7" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果我们获得了一个没有目标的专长，那么这就是两个没有目标的专长之一:原地恐慌，或者不顾当前的危险花点时间去尝试掠夺一个物品。现在我们在调试日志中表达这些行为。</p><p id="82bc" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">最后，如果我们只传递了一个目标，那必须是玩家请求移动一个演员。我们需要做的就是给被选中的演员发信号来完成这个动作。</p><h2 id="ea04" class="kl km hi bd kn ko kp kq kr ks kt ku kv jw kw kx ky ka kz la lb ke lc ld le lf bi translated">遍历列表</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kk"><img src="../Images/63aa7282f86b40e09633405049351f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kmH4gI0gkl_m0LXsBKGUmg.png"/></div></div></figure><p id="0091" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">最后，我们到了列表。这是我做出来的伪代码:</p><blockquote class="lh li lj"><p id="64ce" class="jn jo lg jp b jq jr ij js jt ju im jv lk jx jy jz ll kb kc kd lm kf kg kh ki hb bi translated">将当前动作索引设置为下一个动作节点<br/>如果动作节点不为空，我们有另一个动作<br/>…从动作列表中删除上一个动作节点<br/>如果动作节点为空，我们在动作列表的末尾<br/>…清除动作列表<br/>…将当前转弯索引设置为下一个转弯节点<br/>…advance turn()<br/>…如果当前转弯节点不为空， 我们还有另一个回合<br/>……从回合列表中删除前一个回合节点<br/>……将当前动作索引设置为新回合动作列表的第一个节点<br/>……如果当前回合节点为空，我们就都出局了<br/>……清除回合列表</p></blockquote><p id="53d2" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果在调用下一个节点时位于LinkedList的末尾，则会得到一个空值。因此，我们只需推动列表索引，直到它出现空值，当它出现时，我们清除列表。当两个列表都清空时，这一轮结束。</p><h2 id="e34e" class="kl km hi bd kn ko kp kq kr ks kt ku kv jw kw kx ky ka kz la lb ke lc ld le lf bi translated">把所有的放在一起</h2><p id="f3dc" class="pw-post-body-paragraph jn jo hi jp b jq ln ij js jt lo im jv jw lp jy jz ka lq kc kd ke lr kg kh ki hb bi translated">为了让它运行起来，我们将整个过程封装在一个协程中。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kk"><img src="../Images/26ee51ffdf38ce4dc16154bec3b0b271.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n-b61BWgeswsiYwt3DETQg.png"/></div></div></figure><p id="da10" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">让我们来看看这一切是如何运作的:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ls"><img src="../Images/d347eb80b8d9078362b844b186cf3bf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MuFWH8fA684vGEtmoX87wg.gif"/></div></div></figure><p id="a937" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">你可以在底部看到一些调试信息。我还没有做很多工作来显示界面上发生了什么，但这将会改变。重要的是，我们可以将来自多个参与者的多个动作排队，并让它们按顺序播放。正是我们想要的。</p><p id="e226" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">目前就这些。下一篇文章将重点介绍如何将这个实现变得更加优雅和简化。</p><p id="198d" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">感谢阅读！</p></div></div>    
</body>
</html>