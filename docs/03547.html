<html>
<head>
<title>Naïve Bayes Classifier Implementation with Spark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Spark实现朴素贝叶斯分类器</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/naive-bayes-classifier-with-spark-561ff322d8?source=collection_archive---------6-----------------------#2021-06-10">https://medium.com/geekculture/naive-bayes-classifier-with-spark-561ff322d8?source=collection_archive---------6-----------------------#2021-06-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7890" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文将通过一个很棒的例子引导您了解朴素贝叶斯分类器的基本实现。</p><blockquote class="jd je jf"><p id="96fb" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">本文包括了朴素贝叶斯分类器的一个基本实现，以及一个很好的例子，有助于更好地理解朴素贝叶斯分类器的理论和应用。</p></blockquote><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jk"><img src="../Images/5679848420eef8e2a6d6de7c83f634b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m9JE9YIbM57DkBU49SsoLA.jpeg"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx">Photo by <a class="ae ka" href="https://www.flickr.com/photos/mattbuck007/" rel="noopener ugc nofollow" target="_blank">Matt Buck</a> on <a class="ae ka" href="https://www.flickr.com/" rel="noopener ugc nofollow" target="_blank">Flickr</a></figcaption></figure><p id="ad2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">朴素贝叶斯算法</strong></p><blockquote class="jd je jf"><p id="eee4" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">朴素贝叶斯算法是一种监督学习算法，它基于贝叶斯定理，用于解决分类问题。</p></blockquote><p id="e5f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">贝叶斯定理</strong></p><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es kb"><img src="../Images/35e40e90b7257d765653239b1e3d6ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*tcdW2y9LJmh4X9LizB2V5Q.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx">Naïve Bayes<strong class="bd kc"> </strong>Equation</figcaption></figure><ul class=""><li id="9a63" class="kd ke hi ih b ii ij im in iq kf iu kg iy kh jc ki kj kk kl bi translated">a、B:事件</li><li id="0f75" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">P(A)，P(B):A和B的独立概率</li><li id="98f3" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">P(A|B)是后验概率:给定事件B已经发生，事件A发生的概率。</li><li id="b177" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">P(B|A)是似然概率:给定事件A已经发生，事件B发生的概率。</li></ul><p id="8462" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">朴素贝叶斯分类器假设所有的特征都是互不相关的。一个特征的存在与否不影响任何其他特征的存在与否。</strong></p><h1 id="94a9" class="kr ks hi bd kc kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">朴素贝叶斯分类器示例</h1><p id="03c0" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">让我们通过这个例子来更好地理解朴素贝叶斯分类器。</p><p id="7982" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设我们有一个被盗车辆的数据集，如下所示。使用这个数据集，我们必须能够根据特定的品牌、颜色和时间来分类汽车是否被盗。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es lt"><img src="../Images/c6b18a88424327889fb42b606ba98d5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*9e9UKeretgYOJGVAj9Cffw.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx">Dataset</figcaption></figure><p id="b6a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们找出白天蓝色的VEGA车，能不能被偷。</p><blockquote class="jd je jf"><p id="ce12" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated"><strong class="ih hj">我们假设所有的品牌、颜色和时间特征都是彼此不相关的</strong></p></blockquote><p id="9faf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们创建频率表和可能性表。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es lu"><img src="../Images/e8fe00b195673fe744bff6f66ad3b672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*6liHI-_HSIOkGijn29YQgg.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx">Frequency Table and Likelihood Table for Brand</figcaption></figure><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es lv"><img src="../Images/fe0850af5ae9fda0aafb9b02bf737a9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*yCo3EOoUS4mf3mAl5x8LvA.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx">Frequency Table and Likelihood Table for Color</figcaption></figure><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es lw"><img src="../Images/6d2bef018034082fd3f5e52b7ee588db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*M5_GAhfLmTxKYZHyeauY-Q.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx">Frequency Table and Likelihood Table for Time</figcaption></figure><ul class=""><li id="4dd4" class="kd ke hi ih b ii ij im in iq kf iu kg iy kh jc ki kj kk kl bi translated">p(是)= 3/5</li><li id="8e58" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">p(否)= 2/5</li></ul><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es lx"><img src="../Images/956223a9e66616847ee8ac68c0c44570.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*c74mocAHtGilxV15zNB0GA.png"/></div></figure><p id="82cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，</p><ul class=""><li id="7753" class="kd ke hi ih b ii ij im in iq kf iu kg iy kh jc ki kj kk kl bi translated">x =织女星，蓝色，白天</li><li id="4b59" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">y =是，否</li></ul><div class="jl jm jn jo fd ab cb"><figure class="ly jp lz ma mb mc md paragraph-image"><img src="../Images/e6b285f824797d3daa5243047e058064.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*47VjqrP0PgTY-1ihW6Le8w.png"/></figure><figure class="ly jp me ma mb mc md paragraph-image"><img src="../Images/caf460e8c99c7a55c0db528df0ba2dfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*qJedANTYeoOw-daDLsCoiA.png"/></figure></div><p id="2973" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 0.0250 &gt; 0.0222 <em class="jg">因此，这被归类为未被盗的“否”类。</em>T13】</strong></p><p id="c321" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">这暗示蓝色织女星车在白天不会被盗。</strong></p></div><div class="ab cl mf mg gp mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hb hc hd he hf"><h1 id="85be" class="kr ks hi bd kc kt mm kv kw kx mn kz la lb mo ld le lf mp lh li lj mq ll lm ln bi translated"><strong class="ak">朴素贝叶斯分类器实现</strong></h1><blockquote class="jd je jf"><p id="59b0" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">Spark自带Python、Java、Scala等支持语言。这里我们将使用pyspark来实现。</p></blockquote><p id="8295" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ka" href="https://www.kaggle.com/lasindudemel/vehicle-stolen-dataset" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">数据集</strong> </a> <strong class="ih hj"> : </strong>数据集是关于汽车被盗场景的，其属性为车牌、品牌、颜色、时间和被盗状态(数据集与上述示例的数据集相同)。</p><p id="d6af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤</strong>中的朴素贝叶斯分类器实现</p><blockquote class="jd je jf"><p id="f2a4" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">为了更好地理解，让我们一步一步地看代码，看看每一步的特定输出。</p></blockquote><pre class="jl jm jn jo fd mr ms mt mu aw mv bi"><span id="741a" class="mw ks hi ms b fi mx my l mz na">from pyspark.sql import SparkSession <br/>from pyspark.sql.functions import * <br/>from pyspark.ml import Pipeline <br/>from pyspark.ml.feature import VectorAssembler <br/>from pyspark.ml.feature import StringIndexer <br/>from pyspark.ml.classification import NaiveBayes <br/>from pyspark.ml.evaluation import MulticlassClassificationEvaluator</span><span id="3ddf" class="mw ks hi ms b fi nb my l mz na"># Read data from the vehicle_stolen_dataset.csv <br/>vehicle_data = pd.read_csv(“./vehicle_stolen_dataset.csv”, header=None) </span><span id="ae2a" class="mw ks hi ms b fi nb my l mz na">#Sets the Spark master URL to run locally. <br/>spark = SparkSession.builder.master("local[*]").getOrCreate() </span><span id="beac" class="mw ks hi ms b fi nb my l mz na">#Create DataFrame <br/>vehicle_df = spark.createDataFrame(vehicle_data) vehicle_df.show(5)</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es nc"><img src="../Images/cc6cf0aac0b3616483baa5f680d34903.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*vQ9Gm3U6Sg1lBKxyk2pPtA.png"/></div></figure><blockquote class="jd je jf"><p id="36d2" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">重命名列</p></blockquote><pre class="jl jm jn jo fd mr ms mt mu aw mv bi"><span id="4d10" class="mw ks hi ms b fi mx my l mz na"><br/>vehicle_df = vehicle_df.select(col("0").alias("number_plate"),  col("1").alias("brand"),  <br/>col("2").alias("color"),  <br/>col("3").alias("time"),  <br/>col("4").alias("stoled"))</span></pre><blockquote class="jd je jf"><p id="f6f7" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">将标签的字符串列映射到标签索引的ML列。</p></blockquote><pre class="jl jm jn jo fd mr ms mt mu aw mv bi"><span id="fb57" class="mw ks hi ms b fi mx my l mz na">indexers = [<br/>StringIndexer(inputCol="brand", outputCol = "brand_index"),  <br/>StringIndexer(inputCol="color", outputCol = "color_index"),  StringIndexer(inputCol="time", outputCol = "time_index"),  StringIndexer(inputCol="stoled", outputCol = "label")]</span><span id="076a" class="mw ks hi ms b fi nb my l mz na">pipeline = Pipeline(stages=indexers) </span><span id="8a3a" class="mw ks hi ms b fi nb my l mz na">#Fitting a model to the input dataset. <br/>indexed_vehicle_df = ipeline.fit(vehicle_df).transform(vehicle_df) </span><span id="aed1" class="mw ks hi ms b fi nb my l mz na">indexed_vehicle_df.show(5,False) <br/>#We have given False for turn off default truncation<br/></span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es nd"><img src="../Images/4e81a819d121b4608f193f339e52fc79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*MwvIuWfcn-h4SlIFhLrtcQ.png"/></div></figure><blockquote class="jd je jf"><p id="4dd9" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">将列转换为特征</p></blockquote><pre class="jl jm jn jo fd mr ms mt mu aw mv bi"><span id="d9c5" class="mw ks hi ms b fi mx my l mz na">vectorAssembler = VectorAssembler(inputCols = [“brand_index”, “color_index”, “tim e_index”],outputCol = “features”) vindexed_vehicle_df = ectorAssembler.transform(indexed_vehicle_df) vindexed_vehicle_df.show(5, False)</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ne"><img src="../Images/2320078e6043060f3fa2ee081903fc49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*uYIwMkabmlC6OmhrEV5Mkw.png"/></div></div></figure><blockquote class="jd je jf"><p id="d143" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">用于培训和测试的拆分</p></blockquote><pre class="jl jm jn jo fd mr ms mt mu aw mv bi"><span id="30f4" class="mw ks hi ms b fi mx my l mz na">splits = vindexed_vehicle_df.randomSplit([0.6,0.4], 42) <br/># optional value 42 is seed for sampling <br/>train_df = splits[0] <br/>test_df = splits[1]</span></pre><blockquote class="jd je jf"><p id="7d1d" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">应用朴素贝叶斯分类器</p></blockquote><pre class="jl jm jn jo fd mr ms mt mu aw mv bi"><span id="a433" class="mw ks hi ms b fi mx my l mz na">nb = NaiveBayes(modelType=”multinomial”)</span></pre><blockquote class="jd je jf"><p id="b47b" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">训练模型</p></blockquote><pre class="jl jm jn jo fd mr ms mt mu aw mv bi"><span id="e7b0" class="mw ks hi ms b fi mx my l mz na">nbmodel = nb.fit(train_df)</span></pre><blockquote class="jd je jf"><p id="beb5" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">让我们用测试数据来预测。</p></blockquote><pre class="jl jm jn jo fd mr ms mt mu aw mv bi"><span id="949a" class="mw ks hi ms b fi mx my l mz na">predictions_df = nbmodel.transform(test_df)<br/>predictions_df.show(5, True)</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es nf"><img src="../Images/5ed256bcc07268523f00c5a954af0080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YinWlVkkUZC9F2ikUHiF7Q.png"/></div></div></figure><blockquote class="jd je jf"><p id="75fb" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">计算测试集的准确度</p></blockquote><pre class="jl jm jn jo fd mr ms mt mu aw mv bi"><span id="4b5e" class="mw ks hi ms b fi mx my l mz na">evaluator = MulticlassClassificationEvaluator(labelCol="label", predictionCol="pr ediction", metricName="accuracy") <br/>nbaccuracy = evaluator.evaluate(predictions_df) <br/>print("Test accuracy = " + str(nbaccuracy))</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es ng"><img src="../Images/8d916b5a8e5936d1088f923f39952003.png" data-original-src="https://miro.medium.com/v2/resize:fit:376/format:webp/1*hgeUo7E7ZGFJHNzqTO1PIA.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx">Final Output</figcaption></figure><h1 id="8424" class="kr ks hi bd kc kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">结论</h1><blockquote class="jd je jf"><p id="d4bf" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">我的朴素贝叶斯分类器实现是为了更好地理解实现基础和理论，在为现实世界场景开发时，它需要许多改进和修改。</p></blockquote><p id="9022" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您的阅读！快乐编码..</p><p id="e15d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jg">你也可以找到完整的:</em></p><ul class=""><li id="6665" class="kd ke hi ih b ii ij im in iq kf iu kg iy kh jc ki kj kk kl bi translated"><em class="jg"> Colab笔记本</em> <a class="ae ka" href="https://colab.research.google.com/drive/18EcEjqhKp4WDG2LAeZAUtlu5igs969SA?usp=sharing" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="jg">此处</em> </strong> </a></li><li id="5d13" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated"><em class="jg">数据集</em> <a class="ae ka" href="https://www.kaggle.com/lasindudemel/vehicle-stolen-dataset" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="jg">此处</em> </strong> </a></li></ul></div></div>    
</body>
</html>