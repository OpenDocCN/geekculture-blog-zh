<html>
<head>
<title>Dogfooding at RudderStack: Our Data Stack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">舵栈的狗食:我们的数据栈</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/dogfooding-at-rudderstack-our-data-stack-42823a452c89?source=collection_archive---------63-----------------------#2021-08-03">https://medium.com/geekculture/dogfooding-at-rudderstack-our-data-stack-42823a452c89?source=collection_archive---------63-----------------------#2021-08-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1816a0fc0ac6db5fe46db34abcef22ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gzlnGKcyHAfGrBbvPAyoXA.png"/></div></div></figure><p id="87d9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里有一个关于我们如何利用RudderStack应用程序功能的快速指南。</p><h1 id="4756" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">概观</h1><p id="28db" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我们利用我们的事件流和云提取管道从我们的应用、网站和云工具中获取数据。这为我们提供了整个堆栈的全面覆盖，以及跨每个数字接触点的用户旅程和用户档案的完整视图。事件流实时向云工具提供数据，每30分钟向雪花和S3转储一次行为数据。Cloud Extract从我们的云营销和销售工具以及广告平台中提取数据，并将数据加载到雪花中，使我们可以轻松获得仓库中的完整图片。随着我们更多地了解我们的客户并丰富仓库中的各种数据，我们通过仓库操作将这些有价值的数据聚合回云工具。</p><p id="11de" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是我们在管道以及如何使用管道方面的堆栈的高级分类。在这篇文章中，我们将简要概述如何使用每个管道，在下一篇文章中，我们将深入探讨我们的云和仓库目的地。</p><h1 id="ff80" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">客户数据管道</h1><ul class=""><li id="5aa2" class="kr ks hi is b it km ix kn jb kt jf ku jj kv jn kw kx ky kz bi translated"><a class="ae la" href="https://rudderstack.com/product/event-stream" rel="noopener ugc nofollow" target="_blank">事件流</a> —分析、转化、第三方SDK(标签)管理</li><li id="fa8e" class="kr ks hi is b it lb ix lc jb ld jf le jj lf jn kw kx ky kz bi translated"><a class="ae la" href="https://rudderstack.com/product/cloud-extract" rel="noopener ugc nofollow" target="_blank">云提取</a> —针对云数据的ETL，实现更丰富的分析</li><li id="ea91" class="kr ks hi is b it lb ix lc jb ld jf le jj lf jn kw kx ky kz bi translated"><a class="ae la" href="https://rudderstack.com/product/warehouse-actions" rel="noopener ugc nofollow" target="_blank">仓库动作</a> —向堆栈发送丰富的数据和受众</li></ul><p id="36b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们还向我们的内部团队征求了一些“专业建议”,告诉他们在使用RudderStack执行特定功能时最有用的一两件事。</p><h1 id="8edc" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">事件流—实时</h1><h1 id="d9ef" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">营销网站和web应用前端</h1><p id="cdf2" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">当我们说你可以在5分钟内开始流媒体活动时，我们是认真的，从你的网站上设置一个直播流是非常简单的。以我们自己的营销网站为例，它是用<a class="ae la" href="https://www.gatsbyjs.com/" rel="noopener ugc nofollow" target="_blank"> Gatsby </a>编写的，运行在Sanity上，当用户浏览网站、提交演示请求表格和注册参加网络研讨会时，我们收集各种客户端事件(页面、跟踪和识别)。这些事件都是客户端的，通过Javascript SDK源传递给RudderStack。4行代码和简单的JavaScript来执行页面，跟踪和识别呼叫，我们开始比赛。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="9e1d" class="lp jp hi ll b fi lq lr l ls lt">&lt;script&gt; <br/>rudderanalytics=window.rudderanalytics=[];for(var methods=["load","page","track","identify","alias","group","ready","reset","getAnonymousId","setAnonymousId"],i=0;i&lt;methods.length;i++){var method=methods[i];rudderanalytics[method]=function(a){return function(){rudderanalytics.push([a].concat(Array.prototype.slice.call(arguments)))}}(method)}rudderanalytics.load(&lt;YOUR_WRITE_KEY&gt;,&lt;DATA_PLANE_URL&gt;),rudderanalytics.page();<br/>&lt;/script&gt;<br/><br/>&lt;script src="https://cdn.rudderlabs.com/v1/rudder-analytics.min.js"&gt;&lt;/script&gt;</span></pre><p id="a1d9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些事件被实时传输到RudderStack数据平面，然后传输到各种不同的下游目的地，包括Salesforce (CRM)、Snowflake(数据仓库)、Customer.io(电子邮件营销)和Google Analytics等(我们将在下一篇文章中详细介绍我们的云工具)。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="6b7e" class="lp jp hi ll b fi lq lr l ls lt">window.rudderanalytics.track(<br/>        "form_submit",<br/>        {<br/>          page: document.title,<br/>          page_URL: window.location.href,<br/>          form_id: form_id,<br/>          label: form_id,<br/>          category: section_id,<br/>          conversion_page: document.title,<br/>          utm_source: params.get("utm_source"),<br/>          utm_medium: params.get("utm_medium"),<br/>          utm_campaign: params.get("utm_campaign"),<br/>          utm_content: params.get("utm_content"),<br/>          utm_term: params.get("utm_term"),<br/>          raid: params.get("raid"),<br/>          test_user: params.get("test_user"),<br/>        },<br/>        {<br/>          traits: {<br/>            ...data,<br/>            form_id: form_id,<br/>            conversion_page: document.title,<br/>          },<br/>        }<br/>      )</span></pre><p id="4505" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="lu">专业提示</em> </strong>:我们的营销部门使用来自RudderStack的独特匿名ID，作为比他们从谷歌分析(因为眼见为实)获得的更准确的网站流量和转换计数。他们也发送。跟踪客户端和服务器端向广告平台的转换，他们说这比摆弄谷歌标签管理器方便一百倍。</p><h1 id="2acd" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">Rudderstack web应用程序注册和帐户创建</h1><p id="2536" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">除了在web应用程序中捕获客户端事件，我们还使用Node.js SDK在用户确认初始登录时生成服务器端事件。这些跟踪和识别调用包含的上下文数据比客户端事件少，但不容易受到广告拦截器和其他浏览器工具的影响，这些工具可能会阻止RudderStack事件到达RudderStack源。错过注册的情况很少，但这是客户旅程中最重要的事件之一，因此我们不会冒任何风险。</p><p id="9594" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="lu">专业提示</em> </strong>:我们的产品和营销团队都使用Customer.io进行信息传递。同时拥有服务器端和客户端活动使他们能够协作，并轻松地为行为触发的交易电子邮件(即跟踪电话)以及营销电子邮件活动(即注册后3天内未创建来源)构建细分市场。</p><h1 id="0f95" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">云提取物</h1><p id="66b3" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我们使用Cloud Extract从多个来源提取数据，包括Salesforce、Customer.io、谷歌广告、脸书广告和Stripe。在本概述中，我们将让您大致了解我们如何使用Salesforce数据。</p><p id="e21a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Salesforce </strong> —我们每24小时使用RudderStack云提取将各种Salesforce对象加载到雪花中。有了雪花中更新的销售信息，我们可以通过使用仓库操作(下面将详细介绍仓库操作)将特定线索和帐户状态的变化通知堆栈中的其他工具。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/c3dd9c10ff5e9fcfd3f36821219513e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iStqxI7qS32brxxb.png"/></div></div></figure><p id="01fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="lu">专业提示</em> </strong>:提取销售线索和业务机会的变更历史日志，通过来自您仓库中Salesforce的类似事件的数据提供非凡的洞察力。您不仅可以看到所有的销售互动和时间表，还可以跟踪带有用户和日期时间戳的现场级编辑，这让法规遵从性部门非常高兴！</p><h1 id="902b" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">仓库活动</h1><p id="9ad4" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated"><strong class="is hj">雪花</strong> —仓库行动是我们堆栈中的无名英雄。我们的客户喜欢使用这个特性，但我们自己也喜欢，因为它实在太有用了。由于我们所有的客户数据都是在Snowflake中捕获的，仓库操作使我们所有的工具保持最新。例如，当用户成为客户时，销售团队会更新帐户类型和业务机会状态。然后每天运行一个更新Customer.io和其他营销工具的作业，以便这些用户退出某些营销活动和细分市场。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/90c846de5c013dc873e2c7cc4d93d300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kRDWWbrLdEiOdLIw.png"/></div></div></figure><p id="dda6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="lu">亲提示</em> </strong>:我们从哪里开始！选择退出状态标志是每个企业都非常关心的问题。为您的所有客户及其每个通信渠道的退出状态创建一个统一的视图是至关重要的，而Warehouse Actions可以轻松地更新堆栈中每个工具和数据存储的状态</p><h1 id="0fc7" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">实时转换</h1><p id="fe50" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我们开发了许多用户转换来支持各种不同的流程，包括在将用户特征发送到云目的地之前对其进行映射和重命名，以及阻止匿名页面调用流向Customer.io。我们还使用转换来增强事件，并在将它们传递到最终目的地之前修改有效负载。例如，当用户提交一个企业报价请求时，我们调用Clearbit API来收集基于电子邮件域的特定业务的额外帐户信息。</p><p id="1276" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="lu"> Pro提示</em> </strong>:为了保持转换代码的整洁，利用转换库来存储适用于多个目的地的函数。例如，我们的营销和产品团队不断测试新的注册流量和转化率，因此我们阻止所有rudderstack.com电子邮件流向下游目的地，这让我们的营销和销售团队非常高兴。</p><p id="f9c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">库:</strong></p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="7a62" class="lp jp hi ll b fi lq lr l ls lt">/***<br/>* Docs: https://docs.rudderstack.com/getting-started/adding-a-new-user-library-in-rudderstack<br/>* Examples: https://github.com/rudderlabs/sample-user-transformers<br/>***/<br/>export function rudderEmail(email) {<br/>    return /@(rudderlabs|rudderstack)|\+ruddertest/.test(email);<br/>};<br/>export function rudder_email(arg) {<br/>    return;<br/>}</span></pre><p id="ab87" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">将库加载到转换中:</strong></p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="c18b" class="lp jp hi ll b fi lq lr l ls lt">/***<br/>* Docs: https://docs.rudderstack.com/getting-started/adding-a-new-user-transformation-in-rudderstack<br/>* Examples: https://github.com/rudderlabs/sample-user-transformers<br/>***/<br/>// Load the Library <br/>import {rudderEmail} from 'isRudderEmail';<br/>// Transform Event Here<br/>export function transformEvent(event) {<br/>        // Evaluate the email address<br/>        const notRudderEmail = !rudderEmail(event.context.traits.email);<br/>  if (<br/>            // Ignore Rudder Emails <br/>            notRudderEmail<br/>            )  {   <br/>                  // do some code here <br/>                ];<br/>                // Because Not Rudder Email, return event    <br/>                return event;<br/>        }<br/>    return;<br/>}</span></pre><h1 id="de29" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">目标转换</h1><p id="2e34" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">您在UI中看不到这些，但是我们在数据平面中的目的地转换会自动地将RudderStack有效负载转换成适合每个下游工具的格式。换句话说，我们的集成团队已经为我们做了艰苦的工作，因此一个简单的identify调用就可以在Salesforce、Customer.io Intercom中创建一个用户，并在雪花中填充users表。</p><p id="8dc5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="lu"> Pro提示</em> </strong>:您可以通过将integrations对象添加到您的有效负载来配置事件将被发送到哪个目的地。如果Salesforce是目标，则integrations对象需要包含Salesforce: true。默认情况下，我们会自动发送到所有其他目的地，除非您特别将该值设置为false(即Customer.io: false)。</p><h1 id="39a2" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">通过Grafana的系统可观测性</h1><p id="04b6" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">系统性能指标存储在InfluxDB中，我们通过Grafana监控所有管道的健康状况，这为我们提供了关于RudderStack云实例的性能和状态的详细信息。Grafana为我们提供了摄取、处理和交付事件的实时视图，以及各种其他指标，如负载下的性能、错误和交付统计数据。我们的SRE团队也将Grafana连接到我们的警报系统。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/a704b374a2f25889c895589973e9b4c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KVOc4aq29RmZoEDE.png"/></div></div></figure><p id="4c4d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"/></p><p id="7d4a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本博客最初发表于:<br/><a class="ae la" href="https://rudderstack.com/blog/dogfooding-at-rudderstack-our-data-stack" rel="noopener ugc nofollow" target="_blank">https://rudder stack . com/blog/dogfooding-at-rudder stack-our-data-stack</a></p></div></div>    
</body>
</html>