<html>
<head>
<title>Versioning and File Management in Java Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java应用程序中的版本控制和文件管理</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/versioning-and-file-management-in-java-application-56eeb4520e76?source=collection_archive---------19-----------------------#2021-06-16">https://medium.com/geekculture/versioning-and-file-management-in-java-application-56eeb4520e76?source=collection_archive---------19-----------------------#2021-06-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9fa30337dbae495d4b2ddfc922876ef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HKEnchnvsXjW_NRWy4Z9xA.png"/></div></div></figure><p id="875c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">管理一个文件的不同文件版本可能会很麻烦。它会成为存储猪，还会使文件管理变得困难。为了解决这样的问题，使用了版本控制系统。这是一种跟踪文件中的变化并从中制作版本的方法，允许我们根据需要恢复到特定的版本。git就是这样一个版本工具，它可以用来管理文件夹中的文件版本。在本文中，您将了解如何将git集成到您的软件中，以便从java应用程序内部管理版本。</p><p id="cddf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在深入研究技术细节之前，您需要了解一些关于git的基本知识。在git中，存储库是管理文件版本的文件夹。每个版本都通过提交保存在git中。此外，可以创建一个完全不同的版本行，我们称之为分支。可以从任何提交或任何其他分支创建分支。要了解更多关于git如何工作的信息，你可以点击这里查看。</p><p id="4e08" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程中，我们将使用git的Java接口JGit，这是一个eclipse支持的社区。</p><p id="624a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">JGit有两个基本级别的API: <em class="jp">管道</em>和<em class="jp">瓷器</em>。这些术语来自Git本身。JGit分为相同的区域:</p><ul class=""><li id="b6e6" class="jq jr hi is b it iu ix iy jb js jf jt jj ju jn jv jw jx jy bi translated"><em class="jp">瓷瓶</em>API——常见用户级操作的前端(类似于Git命令行工具)</li><li id="05a9" class="jq jr hi is b it jz ix ka jb kb jf kc jj kd jn jv jw jx jy bi translated"><em class="jp">管道</em>API—直接访问低级存储库对象</li></ul><p id="6b4f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面的代码可以用来使用JGit创建一个存储库</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="7aa7" class="kn ko hi kj b fi kp kq l kr ks">public Repository createNewRepository(String dirPath) {<br/>    // prepare a new folder<br/>  Path path = Paths.<em class="jp">get</em>("path/to/folder");<br/>    try {<br/>        if (!Files.<em class="jp">exists</em>(root)) {<br/>            Files.<em class="jp">createDirectory</em>(root);<br/>        }<br/>        if (!Files.<em class="jp">exists</em>(path)) {<br/>            Files.<em class="jp">createDirectory</em>(path);<br/>        }<br/>        // create the directory<br/>        Repository repository = FileRepositoryBuilder.<em class="jp">create<br/>                        </em>(new File(path.toFile(), ".git"));<br/>        try {<br/>            repository.create();<br/>        } catch (IllegalStateException repositoryExists) {<br/>            repositoryExists.printStackTrace();<br/>        }<br/>        System.<em class="jp">out</em>.println(repository.getDirectory());<br/>        return repository;<br/><br/>    } catch (IOException e) {<br/>        throw new RuntimeException("Could not initialize folder");<br/>    }<br/><br/>}</span></pre><p id="173c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要获取存储库，可以使用以下代码:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="d2cb" class="kn ko hi kj b fi kp kq l kr ks">public Repository getRepository(String dirPath) throws IOException {<br/>    Path path = Paths.<em class="jp">get</em>(dirPath);<br/>    Repository repository = Git.<em class="jp">open</em>(new File(path.toFile(),".git"))<br/>                               .getRepository();<br/>    return repository;<br/>}</span></pre><p id="26cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下代码可用于在暂存中添加文件</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="2c76" class="kn ko hi kj b fi kp kq l kr ks">public Message addOutputFiles(String fileName) {<br/>    String dir = "path/to/directory"; <br/>    <br/>    String branchName = "branchName";<br/><br/>    try {<br/>        Repository repository = getRepository<br/>                           (root.toString() + File.<em class="jp">separator </em>+ dir);<br/>        try (Git git = new Git(repository)) {<br/><br/>            // checkout of branch if needed<br/>       if(!git.getRepository().getBranch().equalsIgnoreCase(branchName)) {<br/>                git.checkout().setName(branchName).call();<br/>            }<br/>           // add file in staging<br/>            git.add()<br/>                    .addFilepattern(approval)<br/>                    .call();<br/>       } catch (Exception e) {<br/>            e.printStackTrace();<br/>        }<br/><br/>    } catch (Exception e) {<br/>   throw new RuntimeException("Could not store the file. Error: " );<br/>    }<br/> <br/><br/>}</span></pre><p id="36f6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jp">注意</em> </strong> <em class="jp"> JGit到目前为止还不支持regex模式或“*”将文件添加到staging，就像git CLI提供的选项一样。</em></p><p id="06c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了提交暂存文件，可以利用以下代码:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="563a" class="kn ko hi kj b fi kp kq l kr ks">public Message commitModelRepository( String fileName) <br/>throws IOException {<br/>        String dir = "path/to/directory";<br/>        try {<br/>            Repository repository = getRepository("path/to/repo");<br/>            try (Git git = new Git(repository)) {<br/><br/>                // checkout branch if needed<br/>                 if(!git.getRepository().getBranch().equalsIgnoreCase("master"))<br/> {<br/>                    git.checkout().setName("master").call();<br/>                }<br/><br/>                // and then commit the changes<br/>                String commit = git.commit()<br/>                        .setMessage("Added " + fileName)<br/>                        .call().getName();<br/>            } catch (Exception e) {<br/>                e.printStackTrace();<br/>            }<br/><br/>        } catch (Exception e) {<br/>    throw new RuntimeException("Could not store the file. Error: ");<br/>        }<br/>    <br/>    }</span></pre><p id="f863" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本教程只是冰山一角。在很多用例中，我们可以在任何其他类型的应用程序中利用JGit进行文件版本控制。它允许像git一样管理版本，git允许开发人员利用Jgit轻松开发基于版本的特性。如果您想进一步了解，可以在下面的<a class="ae jo" href="https://www.baeldung.com/jgit" rel="noopener ugc nofollow" target="_blank">链接</a>和<a class="ae jo" href="https://git-scm.com/book/pl/v2/Appendix-B%3A-Embedding-Git-in-your-Applications-JGit" rel="noopener ugc nofollow" target="_blank">链接</a>中找到关于JGit的详细信息。要在Jgit examples上找到一个例子，你可以查看这个<a class="ae jo" href="https://github.com/centic9/jgit-cookbook" rel="noopener ugc nofollow" target="_blank">链接</a></p></div></div>    
</body>
</html>