<html>
<head>
<title>Building Your First Spring Native Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建您的第一个Spring本地应用程序</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/building-your-first-spring-native-application-ae169136e544?source=collection_archive---------7-----------------------#2021-04-09">https://medium.com/geekculture/building-your-first-spring-native-application-ae169136e544?source=collection_archive---------7-----------------------#2021-04-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8e10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://spring.io/blog/2021/03/11/announcing-spring-native-beta" rel="noopener ugc nofollow" target="_blank"> Spring Native beta发布</a>，这对Spring开发者来说是个好消息。Quarkus从诞生之日起就得到了GraalVM原生映像和Kubernetes的支持，micro姨妈和Oracle Helidon也在很长一段时间内加入了GraalVM支持。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/a5a6562225ecabec69696ccbe99914e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*840X1gBH6J1ZrRzdyMnwKQ.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">The image is from <a class="ae jd" href="https://unsplash.com/photos/sBNx8CBj12w" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/sBNx8CBj12w</a></figcaption></figure><p id="5f8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如在<a class="ae jd" href="https://www.graalvm.org/docs/introduction/" rel="noopener ugc nofollow" target="_blank"> GraalVM介绍页面</a>，<em class="ju">中所解释的，GraalVM是一个高性能的JDK发行版，旨在加速用Java和其他JVM语言编写的应用程序的执行，同时支持JavaScript、Ruby、Python和许多其他流行语言。GraalVM的多语言功能使得在一个应用程序中混合多种编程语言成为可能，同时消除了外语调用成本。</em></p><p id="314b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用GraalVM本机映像，Java应用程序可以在系统本机可执行文件或共享库中编译，并且在运行时不需要Java虚拟机。</p><p id="671b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本帖中，我们将把<a class="ae jd" href="https://github.com/hantsy/spring-reactive-sample" rel="noopener ugc nofollow" target="_blank">hantsy/Spring-reactive-sample</a>资源库中的一个简单的现有<a class="ae jd" href="https://github.com/hantsy/spring-reactive-sample/tree/master/boot-data-mongo-auditing" rel="noopener ugc nofollow" target="_blank"> reactive mongo示例</a>转换成一个原生应用程序，以体验Spring Native project带来的新特性。</p><blockquote class="jv jw jx"><p id="3142" class="if ig ju ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated"><em class="hi">目前，Spring Native是一个实验项目，0.9.1版本与确切的Spring Boot 2.4.4兼容。</em></p></blockquote><h1 id="3916" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">生成项目</h1><p id="71d2" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">假设您已经安装了以下软件。</p><ul class=""><li id="261e" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated">Java 11</li><li id="ce0f" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">Apache Maven 3.8.1</li><li id="b9a1" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">Docker，使用<code class="du ls lt lu lv b">spring-boot:build-image</code>构建应用程序时需要</li><li id="f8b5" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">graal VM 21.0.0.2，通过本机映像maven插件直接构建本机映像时需要。</li></ul><p id="0d1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开浏览器，导航到<a class="ae jd" href="https://start.spring.io" rel="noopener ugc nofollow" target="_blank">https://start . spring . io</a>。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lw"><img src="../Images/0c855aec6ba1ce352e0fef3038afba51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9Esfdipj9eil4qZ5.png"/></div></div></figure><p id="c644" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">生成一个带有依赖关系的WebFlux项目框架:Spring Native，Lombok，Spring Reactive Web，Spring Data Reactive MongoDB。</p><p id="f98d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从下载的档案中提取文件，并导入到您的IDE中，例如Intellij IDEA。</p><h1 id="39d5" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">构建应用程序</h1><p id="bd0c" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">默认情况下，Spring initializr已经配置了一个maven AOT插件来生成GraalVM在编译阶段所需的元数据，并且配置了一个spring boot maven插件来使用<a class="ae jd" href="https://paketo.io/" rel="noopener ugc nofollow" target="_blank">paketo build pack</a>builder<code class="du ls lt lu lv b">paketobuildpacks/builder:tiny</code>将您的源代码转换为云原生应用程序(Docker映像)。</p><p id="d621" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只需运行以下命令，将应用程序构建到Docker映像中。</p><pre class="jf jg jh ji fd lx lv ly lz aw ma bi"><span id="a530" class="mb kc hi lv b fi mc md l me mf">mvn clean package spring-boot:build-image</span></pre><p id="f4ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://docs.spring.io/spring-native/docs/current/reference/htmlsingle/index.html#getting-started-native-image" rel="noopener ugc nofollow" target="_blank"> Spring原生引用</a>也引入了通过原生image maven插件构建原生应用。</p><p id="9c54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将来自<a class="ae jd" href="https://github.com/hantsy/spring-reactive-sample/tree/master/boot-data-mongo-auditing" rel="noopener ugc nofollow" target="_blank"> reactive mongo示例</a>的源代码复制到这个项目中，重构<code class="du ls lt lu lv b">pom.xml</code>并引入多个maven概要文件，使其适用于这两种情况。</p><pre class="jf jg jh ji fd lx lv ly lz aw ma bi"><span id="a378" class="mb kc hi lv b fi mc md l me mf">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;project  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br/>         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;<br/>    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br/>    &lt;parent&gt;<br/>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;<br/>        &lt;version&gt;2.4.4&lt;/version&gt;<br/>        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;<br/>    &lt;/parent&gt;<br/>    &lt;groupId&gt;com.example&lt;/groupId&gt;<br/>    &lt;artifactId&gt;spring-native-demo&lt;/artifactId&gt;<br/>    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br/>    &lt;name&gt;demo&lt;/name&gt;<br/>    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;<br/>    &lt;properties&gt;<br/>        &lt;java.version&gt;11&lt;/java.version&gt;<br/>        &lt;spring-native.version&gt;0.9.1&lt;/spring-native.version&gt;<br/>    &lt;/properties&gt;<br/>    &lt;dependencies&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-starter-data-mongodb-reactive&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br/>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br/>            &lt;optional&gt;true&lt;/optional&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;io.projectreactor&lt;/groupId&gt;<br/>            &lt;artifactId&gt;reactor-test&lt;/artifactId&gt;<br/>            &lt;scope&gt;test&lt;/scope&gt;<br/>        &lt;/dependency&gt;<br/>    &lt;/dependencies&gt;</span><span id="0f72" class="mb kc hi lv b fi mg md l me mf">    &lt;build&gt;<br/>        &lt;plugins&gt;<br/>            &lt;plugin&gt;<br/>                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;<br/>                &lt;configuration&gt;<br/>                    &lt;excludes&gt;<br/>                        &lt;exclude&gt;<br/>                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br/>                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br/>                        &lt;/exclude&gt;<br/>                    &lt;/excludes&gt;<br/>                &lt;/configuration&gt;<br/>            &lt;/plugin&gt;<br/>        &lt;/plugins&gt;<br/>    &lt;/build&gt;<br/>    &lt;profiles&gt;<br/>        &lt;profile&gt;<br/>            &lt;id&gt;default&lt;/id&gt;<br/>            &lt;activation&gt;<br/>                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;<br/>            &lt;/activation&gt;<br/>            &lt;build&gt;<br/>                &lt;plugins&gt;<br/>                    &lt;plugin&gt;<br/>                        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>                        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;<br/>                        &lt;version&gt;3.0.0-M5&lt;/version&gt;<br/>                        &lt;configuration&gt;<br/>                            &lt;excludes&gt;<br/>                                &lt;exclude&gt;**/FunctionalTests.*&lt;/exclude&gt;<br/>                            &lt;/excludes&gt;<br/>                        &lt;/configuration&gt;<br/>                    &lt;/plugin&gt;<br/>                &lt;/plugins&gt;<br/>            &lt;/build&gt;<br/>        &lt;/profile&gt;<br/>        &lt;profile&gt;<br/>            &lt;id&gt;spring-native&lt;/id&gt;<br/>            &lt;dependencies&gt;<br/>                &lt;dependency&gt;<br/>                    &lt;groupId&gt;org.springframework.experimental&lt;/groupId&gt;<br/>                    &lt;artifactId&gt;spring-native&lt;/artifactId&gt;<br/>                    &lt;version&gt;${spring-native.version}&lt;/version&gt;<br/>                &lt;/dependency&gt;<br/>            &lt;/dependencies&gt;<br/>            &lt;build&gt;<br/>                &lt;plugins&gt;<br/>                    &lt;plugin&gt;<br/>                        &lt;groupId&gt;org.springframework.experimental&lt;/groupId&gt;<br/>                        &lt;artifactId&gt;spring-aot-maven-plugin&lt;/artifactId&gt;<br/>                        &lt;version&gt;${spring-native.version}&lt;/version&gt;<br/>                        &lt;executions&gt;<br/>                            &lt;execution&gt;<br/>                                &lt;id&gt;test-generate&lt;/id&gt;<br/>                                &lt;goals&gt;<br/>                                    &lt;goal&gt;test-generate&lt;/goal&gt;<br/>                                &lt;/goals&gt;<br/>                            &lt;/execution&gt;<br/>                            &lt;execution&gt;<br/>                                &lt;id&gt;generate&lt;/id&gt;<br/>                                &lt;goals&gt;<br/>                                    &lt;goal&gt;generate&lt;/goal&gt;<br/>                                &lt;/goals&gt;<br/>                            &lt;/execution&gt;<br/>                        &lt;/executions&gt;<br/>                    &lt;/plugin&gt;<br/>                &lt;/plugins&gt;<br/>            &lt;/build&gt;<br/>        &lt;/profile&gt;<br/>        &lt;profile&gt;<br/>            &lt;id&gt;build-docker-image&lt;/id&gt;<br/>            &lt;build&gt;<br/>                &lt;plugins&gt;<br/>                    &lt;plugin&gt;<br/>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>                        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;<br/>                        &lt;configuration&gt;<br/>                            &lt;image&gt;<br/>                                &lt;name&gt;hantsy/${project.artifactId}:latest&lt;/name&gt;<br/>                                &lt;builder&gt;paketobuildpacks/builder:tiny&lt;/builder&gt;<br/>                                &lt;env&gt;<br/>                                    &lt;BP_NATIVE_IMAGE&gt;true&lt;/BP_NATIVE_IMAGE&gt;<br/>                                &lt;/env&gt;<br/>                            &lt;/image&gt;<br/>                        &lt;/configuration&gt;<br/>                    &lt;/plugin&gt;<br/>                &lt;/plugins&gt;<br/>            &lt;/build&gt;<br/>        &lt;/profile&gt;<br/>        &lt;profile&gt;<br/>            &lt;id&gt;build-native-image&lt;/id&gt;<br/>            &lt;build&gt;<br/>                &lt;plugins&gt;<br/>                    &lt;plugin&gt;<br/>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>                        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;<br/>                        &lt;configuration&gt;<br/>                            &lt;classifier&gt;exec&lt;/classifier&gt;<br/>                        &lt;/configuration&gt;<br/>                    &lt;/plugin&gt;<br/>                    &lt;plugin&gt;<br/>                        &lt;groupId&gt;org.graalvm.nativeimage&lt;/groupId&gt;<br/>                        &lt;artifactId&gt;native-image-maven-plugin&lt;/artifactId&gt;<br/>                        &lt;version&gt;21.0.0.2&lt;/version&gt;<br/>                        &lt;configuration&gt;<br/>                            &lt;!-- The native image build needs to know the entry point to your application --&gt;<br/>                            &lt;mainClass&gt;com.example.demo.DemoApplication&lt;/mainClass&gt;<br/>                        &lt;/configuration&gt;<br/>                        &lt;executions&gt;<br/>                            &lt;execution&gt;<br/>                                &lt;goals&gt;<br/>                                    &lt;goal&gt;native-image&lt;/goal&gt;<br/>                                &lt;/goals&gt;<br/>                                &lt;phase&gt;package&lt;/phase&gt;<br/>                            &lt;/execution&gt;<br/>                        &lt;/executions&gt;<br/>                    &lt;/plugin&gt;</span><span id="6b50" class="mb kc hi lv b fi mg md l me mf">                &lt;/plugins&gt;<br/>            &lt;/build&gt;<br/>        &lt;/profile&gt;<br/>        &lt;profile&gt;<br/>            &lt;id&gt;functional-test&lt;/id&gt;<br/>            &lt;build&gt;<br/>                &lt;plugins&gt;<br/>                    &lt;plugin&gt;<br/>                        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>                        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;<br/>                        &lt;version&gt;3.0.0-M5&lt;/version&gt;<br/>                        &lt;configuration&gt;<br/>                            &lt;includes&gt;<br/>                                &lt;include&gt;**/FunctionalTests.*&lt;/include&gt;<br/>                            &lt;/includes&gt;<br/>                        &lt;/configuration&gt;<br/>                    &lt;/plugin&gt;<br/>                &lt;/plugins&gt;<br/>            &lt;/build&gt;<br/>        &lt;/profile&gt;<br/>    &lt;/profiles&gt;<br/>    &lt;repositories&gt;<br/>        &lt;repository&gt;<br/>            &lt;id&gt;spring-releases&lt;/id&gt;<br/>            &lt;name&gt;Spring Releases&lt;/name&gt;<br/>            &lt;url&gt;https://repo.spring.io/release&lt;/url&gt;<br/>        &lt;/repository&gt;<br/>    &lt;/repositories&gt;<br/>    &lt;pluginRepositories&gt;<br/>        &lt;pluginRepository&gt;<br/>            &lt;id&gt;spring-releases&lt;/id&gt;<br/>            &lt;name&gt;Spring Releases&lt;/name&gt;<br/>            &lt;url&gt;https://repo.spring.io/release&lt;/url&gt;<br/>        &lt;/pluginRepository&gt;<br/>    &lt;/pluginRepositories&gt;</span><span id="6743" class="mb kc hi lv b fi mg md l me mf">&lt;/project&gt;</span></pre><p id="3645" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，我们不包含任何Spring本地工具，当运行应用程序时，它就像一个通用的Spring Boot应用程序一样工作。</p><ul class=""><li id="611e" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated"><code class="du ls lt lu lv b">spring-native</code>概要文件包含AOT maven插件的构建进度。</li><li id="f9e0" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><code class="du ls lt lu lv b">build-docker-image</code>将通过<code class="du ls lt lu lv b">paketobuildpacks/builder:tiny</code>构建器将应用程序构建成docker映像。</li><li id="4ebc" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><code class="du ls lt lu lv b">build-native-image</code>将使用GraalVM本机映像来构建应用程序作为系统本机可执行文件。</li><li id="f999" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><code class="du ls lt lu lv b">functional-test</code>包括一个简单的<code class="du ls lt lu lv b">FunctionalTests</code>来验证应用程序是否按照客户端的预期工作。</li></ul><h1 id="c780" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">使用Paket构建包构建</h1><p id="382e" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">Paket BuildPacks需要docker环境，<a class="ae jd" href="https://docs.docker.com/engine/install/" rel="noopener ugc nofollow" target="_blank">首先安装它</a>。</p><pre class="jf jg jh ji fd lx lv ly lz aw ma bi"><span id="835f" class="mb kc hi lv b fi mc md l me mf">mvn clean package spring-boot:build-image -Pspring-native,build-docker-image -DskipTests</span></pre><p id="da2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应用程序在运行时需要一个正在运行的MongoDB。有一个<a class="ae jd" href="https://github.com/hantsy/spring-native-example/blob/master/docker-compose.yml" rel="noopener ugc nofollow" target="_blank"> docker-compose.yml </a>可以在几秒钟内引导一个MongoDB服务。</p><pre class="jf jg jh ji fd lx lv ly lz aw ma bi"><span id="74c8" class="mb kc hi lv b fi mc md l me mf">docker-compose up mongodb</span></pre><p id="1e48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在像运行其他Docker应用程序一样运行该应用程序。</p><pre class="jf jg jh ji fd lx lv ly lz aw ma bi"><span id="173d" class="mb kc hi lv b fi mc md l me mf">docker run -rm hantsy/spring-native-demo</span></pre><h1 id="28a4" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">使用本机映像maven插件构建</h1><p id="76c8" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">首先确保您已经安装了GraalVM，按照<a class="ae jd" href="https://www.graalvm.org/docs/getting-started/" rel="noopener ugc nofollow" target="_blank">入门指南</a>进行安装。</p><blockquote class="jv jw jx"><p id="5cb1" class="if ig ju ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated"><em class="hi">在Windows下，GraalVM还是实验性的。考虑安装到一个WSL2系统中，IDEA和VSCode都有很大的WSL支持。</em></p></blockquote><pre class="jf jg jh ji fd lx lv ly lz aw ma bi"><span id="a77c" class="mb kc hi lv b fi mc md l me mf">mvn clean package spring-boot:build-image -Pspring-native,build-native-image -DskipTests</span></pre><p id="69b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当<em class="ju">目标</em>文件夹中有可执行文件时。注意在运行这个命令之前，确保有一个正在运行的Mongo服务。</p><pre class="jf jg jh ji fd lx lv ly lz aw ma bi"><span id="5662" class="mb kc hi lv b fi mc md l me mf">./target/com.example.demo.demoapplication</span></pre><p id="141a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你会觉得原生应用程序的构建过程相当缓慢和繁琐，两种方式都会消耗几分钟(而不是几秒钟)，这对开发阶段的开发者来说是很可怕的。我想将它转移到CI(持续集成)服务中，为您构建它。</p><h1 id="2239" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">持续集成</h1><p id="aa06" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">我准备了<a class="ae jd" href="https://github.com/hantsy/spring-native-example/tree/master/.github/workflows" rel="noopener ugc nofollow" target="_blank"> 3个Github actions工作流文件</a>来构建项目。</p><ul class=""><li id="642d" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated">像一般的Spring Boot应用程序一样构建和运行测试代码。</li><li id="96c8" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><code class="du ls lt lu lv b">build-docker-image</code> -通过<code class="du ls lt lu lv b">spring-boot:build-image</code>目标将应用构建成分层docker镜像，并使用上述<code class="du ls lt lu lv b">FunctionalTests</code>启动应用并验证。</li><li id="e977" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><code class="du ls lt lu lv b">build-native-image</code>——通过GraalVM原生映像将应用程序构建为系统原生可执行文件，并通过运行<code class="du ls lt lu lv b">FunctionalTests</code>启动应用程序并验证其功能。</li></ul><p id="326c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">理想情况下，在构建Spring原生应用时，我们只需要像构建一个通用的Spring Boot应用一样专注于开发，让CI来移交构建原生应用的繁琐工作。</p><p id="a818" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但不幸的是，目前的版本有很多限制，请查看<a class="ae jd" href="https://docs.spring.io/spring-native/docs/current/reference/htmlsingle/index.html#support" rel="noopener ugc nofollow" target="_blank">支持</a>部分，以获得目前支持的功能列表。要使用那些不在支持列表中的特性，你可能不得不放弃Spring Native并切换回JVM。</p><blockquote class="jv jw jx"><p id="59a0" class="if ig ju ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated"><em class="hi">我还尝试启用Data Mongo审计功能，它在本机模式下无法工作。</em></p></blockquote><h2 id="ca53" class="mb kc hi bd kd mh mi mj kh mk ml mm kl iq mn mo kp iu mp mq kt iy mr ms kx mt bi translated"><em class="mu">从</em><a class="ae jd" href="https://github.com/hantsy/spring-native-example/" rel="noopener ugc nofollow" target="_blank"><em class="mu">hantsy/spring-native-example</em></a><em class="mu">中抓取一份源代码自己体验一下。</em></h2><h1 id="89c6" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">最后的话</h1><p id="3b83" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">Quarkus发明了Arc容器，它为开发人员提供了CDI APIs的子集，但它在编译时为beans生成静态代码，而不是在运行时生成动态代理。</p><p id="ddb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我看来，我希望在Spring Native中看到一些类似的机制，提供编译时字节码增强，以取代Spring内置的beans动态代理，并使其成为当前Spring IOC容器的替代方案。我个人有点失望。</p></div></div>    
</body>
</html>