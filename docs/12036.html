<html>
<head>
<title>Creating your own free and secure cloud lab using Oracle Cloud, Kubernetes, Traefik and Rancher</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Oracle Cloud、Kubernetes、Traefik和Rancher创建您自己的免费安全的云实验室</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/creating-your-own-free-and-secure-cloud-lab-using-oracle-cloud-kubernetes-traefik-and-rancher-efadd4c65975?source=collection_archive---------1-----------------------#2022-04-22">https://medium.com/geekculture/creating-your-own-free-and-secure-cloud-lab-using-oracle-cloud-kubernetes-traefik-and-rancher-efadd4c65975?source=collection_archive---------1-----------------------#2022-04-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1c81dcfcc0c1da90248f1489b8d3af4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e2JcUpgKWzO38n5UqxIazw.jpeg"/></div></div></figure><p id="77ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">在我担任</em> <a class="ae jp" href="https://www.hooligan.co.za/" rel="noopener ugc nofollow" target="_blank"> <em class="jo">小流氓开发</em> </a> <em class="jo">的首席技术官期间，我努力每周掌握至少2项新的技术技能，并鼓励我招募、培训和管理的开发人员也这样做。这篇文章是我关于Homelabs、Cloudlabs和微服务系列的一部分——欢迎关注我的更多内容。</em></p><h1 id="3477" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">介绍</h1><p id="4bcf" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">我知道很多开发人员梦想着使用一些最新的工具和基于云的技术，但是经常面临有限的自由层或者非常复杂的设置。有些人没有多余的PC或笔记本电脑来创建自己的本地家庭实验室，或者根本负担不起必要的维护和电费。</p><p id="be9b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我最近发现，Oracle提供了一个非常慷慨的免费层，非常适合创建您自己的“云实验室”——与AWS不同，它承诺永远免费<strong class="is hj"/>！</p><p id="8c68" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那么，让我们来看看你如何自己设置一个…</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="a2f6" class="jq jr hi bd js jt la jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj le kl km kn bi translated">什么是Homelab/Cloudlab？</h1><p id="3795" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">如果您从未听说过这个术语，Homelab是一个服务器(或多个服务器设置)的名称，它驻留在您家中或云中(因此有Cloudlab这个词),您在云中托管几个应用程序和虚拟化系统，用于测试和开发或家庭和功能使用。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="d888" class="jq jr hi bd js jt la jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj le kl km kn bi translated">你为什么需要一个？</h1><p id="2b65" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">你不知道。不是每个人都必须有一个实验室设置。但是有一个实验室有它的优势。</p><p id="ee92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您是Linux服务器的新手，它为您提供了一个学习和破坏东西的平台。</p><p id="05b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">作为一名软件、sysadmin或devops工程师，它让您能够工作并试验在远程环境或低功率笔记本电脑或PC上可能难以完成的项目和技术。</p><p id="4b95" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你想学习Terraform、Ansible，了解微服务如何通过服务网格、反向代理进行通信，一个实验室就能让你学会！</p><p id="7298" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">云和家庭实验室是为任何给定项目创建或模拟任何特定环境的绝佳选择，展示它，然后简单地丢弃，而不必投资金钱或每月花费。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="38f7" class="jq jr hi bd js jt la jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj le kl km kn bi translated">先决条件</h1><h2 id="9777" class="lf jr hi bd js lg lh li jw lj lk ll ka jb lm ln ke jf lo lp ki jj lq lr km ls bi translated">Oracle云帐户<strong class="ak">:使用</strong>很容易创建一个</h2><p id="d781" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated"><a class="ae jp" href="https://signup.cloud.oracle.com/?sourceType=_ref_coc-asset-opcSignIn&amp;language=en_US" rel="noopener ugc nofollow" target="_blank">https://signup.cloud.oracle.com/?source type = _ ref _ COC-asset-OPC sign in&amp;language = en _ US</a></p><h2 id="9e5e" class="lf jr hi bd js lg lh li jw lj lk ll ka jb lm ln ke jf lo lp ki jj lq lr km ls bi translated">安装OCI Cli</h2><p id="65b6" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated"><a class="ae jp" href="https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/cliinstall.htm" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/en-us/iaas/Content/API/SDK docs/CLI install . htm</a></p><h2 id="960f" class="lf jr hi bd js lg lh li jw lj lk ll ka jb lm ln ke jf lo lp ki jj lq lr km ls bi translated">安装Kubectl</h2><p id="c8ff" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">通过以下链接安装Kubectl<a class="ae jp" href="https://kubernetes.io/docs/tasks/tools/" rel="noopener ugc nofollow" target="_blank">https://kubernetes.io/docs/tasks/tools/</a></p><h2 id="7a8f" class="lf jr hi bd js lg lh li jw lj lk ll ka jb lm ln ke jf lo lp ki jj lq lr km ls bi translated">安装舵</h2><p id="5eab" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">你可以在linux和mac上运行下面的脚本，或者访问这个网站了解更多细节【https://helm.sh/docs/intro/install/ T2】</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="a211" class="lf jr hi ly b fi mc md l me mf">curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash</span></pre><h2 id="066d" class="lf jr hi bd js lg lh li jw lj lk ll ka jb lm ln ke jf lo lp ki jj lq lr km ls bi translated">安装VSCode Kubernetes扩展</h2><p id="f9ed" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">【https://marketplace.visualstudio.com/items? T4】itemName = ms-kubernetes-tools . vs code-kubernetes-tools</p><h2 id="1393" class="lf jr hi bd js lg lh li jw lj lk ll ka jb lm ln ke jf lo lp ki jj lq lr km ls bi translated">拥有一个域名</h2><p id="9e01" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">你可以使用任何你想要的域名。我使用了Cloudflare域，因为它可能是用Traefik设置的最简单的域，我们稍后将使用它。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="b5ed" class="jq jr hi bd js jt la jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj le kl km kn bi translated">创建Oracle云帐户</h1><p id="37c6" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">在<a class="ae jp" href="http://oraclecloud.com" rel="noopener ugc nofollow" target="_blank">oraclecloud.com</a>创建一个账户，除了从你的信用卡中收取一点临时费用以使其生效之外，创建账户是免费的。这个月您还将获得250欧元的免费积分。你可以在这里<a class="ae jp" href="https://www.oracle.com/za/cloud/free/#always-free" rel="noopener ugc nofollow" target="_blank">https://www.oracle.com/za/cloud/free/#always-free</a>看到甲骨文提供的免费云服务的完整列表。</p><h2 id="a509" class="lf jr hi bd js lg lh li jw lj lk ll ka jb lm ln ke jf lo lp ki jj lq lr km ls bi translated">著名的自由层基础设施</h2><p id="f311" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">2个基于AMD的计算虚拟机，每个具有1/8 OCPU**和1 GB内存<br/> 4个基于Arm的Ampere A1内核和24 GB内存，可用作一个虚拟机或最多4个虚拟机<br/> 2个块卷存储，总共200 GB<br/>10 GB对象存储—标准<br/> NoSQL数据库和其他选项<br/>灵活的负载平衡器:1个实例，10 Mbps <br/>灵活的网络负载平衡器</p><p id="7145" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我选择了英国地区uk-london-1</p><p id="d86a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jp" href="https://cloud.oracle.com/?region=uk-london-1" rel="noopener ugc nofollow" target="_blank">https://cloud.oracle.com/?region=uk-london-1</a></p><p id="a36c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您看到崭新闪亮的Oracle云平台时。您最初可能有一个VCN设置，如果有，请立即删除您的<a class="ae jp" href="https://www.oracle.com/cloud/sign-in.html?redirect_uri=https://cloud.oracle.com/networking/vcns" rel="noopener ugc nofollow" target="_blank"> VCN(虚拟云网络)</a>这样做的原因是，我们仍然可以坚持使用我们的免费资源，还可以从头开始设置一个集群，而不是有两个VCN。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="20cc" class="jq jr hi bd js jt la jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj le kl km kn bi translated">创建您的Kubernetes集群</h1><p id="e4ab" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">在菜单中的开发者服务下，选择<a class="ae jp" href="https://cloud.oracle.com/containers/clusters?region=uk-london-1" rel="noopener ugc nofollow" target="_blank"> Kubernetes集群(OKE) </a>选项，并选择<strong class="is hj">创建集群</strong></p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/4d2a30b6a0eeb7a239a342fc118d14f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hs3yh5wm1trhweDEDa5TRQ.png"/></div></div></figure><p id="4481" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">选择<strong class="is hj">快速创建</strong>选项并启动工作流程。</p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/10777c5ad282e94ea29ed732c5d15540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oLZQK3ix0yM8U9WxiC2jig.png"/></div></div></figure><p id="b6a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以随意命名您的集群。</p><p id="720d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">确保您选择的形状是VM。Standard.A1.Flex形状，否则您将不会在自由层</strong>中。形状只是一种实例类型，对于空闲层，您可以在一个虚拟机上或在4个虚拟机之间分配多达4个容量高达24 GB的A1 vCPU。</p><p id="3b45" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我选择了3个节点，每个节点有1OCPU和6GB内存。</p><p id="0f09" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<strong class="is hj">高级选项</strong>下，生成您的SSH私有和公共密钥，并将它们保存在安全的地方。</p><p id="982c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">单击下一步，检查并创建集群。这可能需要几分钟时间，请耐心等待。</p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/7f20019fdfa3bda1843487f9a739790b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mPOOW97yHzlfQuHR9khvIA.jpeg"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">Active kubernetes cluster</figcaption></figure><p id="cca8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完成后，您应该有一个绿色的活动集群。应该有一个活动节点池，并且该节点池应该有3个活动和就绪节点。</p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/6696b2e0191bb4e5e10ff440295109be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p7iwGGzlBaN_kEYZ2lknrg.jpeg"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">Active node pool</figcaption></figure><p id="8ca6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在你可能想知道我们究竟如何访问这个集群？这就是kubectl派上用场的地方，在集群细节页面上单击Access Cluster按钮。这将给我们两个选择。</p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/a9cd58f734bea293a57bfe53322e4501.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rcrNbfwS7EyY4bGjjCeQuA.jpeg"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">Access Cluster</figcaption></figure><ol class=""><li id="17fd" class="mp mq hi is b it iu ix iy jb mr jf ms jj mt jn mu mv mw mx bi translated">云外壳访问(这超出了本文的范围)</li><li id="b94c" class="mp mq hi is b it my ix mz jb na jf nb jj nc jn mu mv mw mx bi translated">局部访问</li></ol><p id="6084" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">选择<strong class="is hj">本地访问</strong>并按照指示进行操作。确保安装了OCI Cli和其他先决条件，并通过粘贴提供给您的VCN本地公共端点命令来设置kubeconfig。</p><p id="2664" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您应该能够在命令行中使用kubectl或VSCode中的<strong class="is hj"> Visual Studio Code Kubernetes工具本地连接到您的集群。</strong>我同时使用了终端和VSCode，但是现在让我们继续使用终端。</p><p id="63fb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您运行<strong class="is hj"> kubectl cluster-info </strong>，您应该会得到类似下面这样的结果。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="efdf" class="lf jr hi ly b fi mc md l me mf">kubectl cluster-info</span></pre><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nd"><img src="../Images/f7c0d4680568b8bc73ba6f6144aa4389.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D-dE6qD_0QaUu4IACMCCvw.jpeg"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">kubectl cluster-info output</figcaption></figure><p id="d183" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果<strong class="is hj"> kubectl cluster-info </strong>表示无法连接到集群，请执行以下步骤:</p><ul class=""><li id="c6e2" class="mp mq hi is b it iu ix iy jb mr jf ms jj mt jn ne mv mw mx bi translated">检查群集和节点是否处于活动状态并准备就绪</li><li id="702d" class="mp mq hi is b it my ix mz jb na jf nb jj nc jn ne mv mw mx bi translated">检查您的$HOME/。kube/config文件存在，并且包含Oracle中Access Your Cluster给我们的命令中的内容。确保运行VCN公共端点命令</li><li id="9518" class="mp mq hi is b it my ix mz jb na jf nb jj nc jn ne mv mw mx bi translated">再次运行访问您的集群VCN公共端点命令</li></ul><p id="6ce4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们应该可以进行下一步了！</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="c57b" class="jq jr hi bd js jt la jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj le kl km kn bi translated">安装Kubernetes仪表板</h1><p id="f63a" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">我们应该做的第一件事是安装Kubernetes Dashboard UI。要安装它，请运行以下命令</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="e018" class="lf jr hi ly b fi mc md l me mf">kubectl apply -f <a class="ae jp" href="https://raw.githubusercontent.com/kubernetes/dashboard/v2.5.1/aio/deploy/recommended.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/kubernetes/dashboard/v2.5.1/aio/deploy/recommended.yaml</a></span></pre><p id="aaa4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了访问浏览器的UI，我们需要运行代理命令</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="8f99" class="lf jr hi ly b fi mc md l me mf">kubectl proxy</span></pre><p id="f73b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将使用一个HTTP代理来公开Kubernetes API。现在，您可以使用以下URL访问仪表板API。</p><p id="b509" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jp" href="http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/workloads?namespace=default" rel="noopener ugc nofollow" target="_blank">http://localhost:8001/API/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/workloads？名称空间=默认</a></p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nf"><img src="../Images/7a656cef5aa93035618c2c135dd7f982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QdwjRCkd1TsLqjxfxfeO9Q.png"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">Kubernetes dashboard login</figcaption></figure><p id="108d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您应该会看到一个要求您进行身份验证的屏幕。</p><h2 id="36b1" class="lf jr hi bd js lg lh li jw lj lk ll ka jb lm ln ke jf lo lp ki jj lq lr km ls bi translated">Kubernetes仪表板验证</h2><p id="c2bf" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">有两种方法可以验证我们的Kubernetes dashboard帐户；使用令牌或kubeconfig方法。出于本教程的目的，我们将使用令牌身份验证方法。</p><p id="5955" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">令牌身份验证方法要求我们为Kubernetes仪表板创建一个新的服务帐户。我们将这个服务帐户绑定到集群管理角色，这将使我们能够访问仪表板上的所有Kubernetes资源。然后，我们可以使用服务帐户的不记名令牌来登录仪表板。</p><h2 id="a7fd" class="lf jr hi bd js lg lh li jw lj lk ll ka jb lm ln ke jf lo lp ki jj lq lr km ls bi translated">创建仪表板服务帐户</h2><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="88df" class="lf jr hi ly b fi mc md l me mf">kubectl create serviceaccount dashboard-admin-sa</span></pre><p id="c4c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将在默认名称空间中创建一个名为dashboard-admin-sa的服务帐户</p><p id="c4bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，将dashboard-admin-service-account服务帐户绑定到群集管理角色</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="3fb5" class="lf jr hi ly b fi mc md l me mf">kubectl create clusterrolebinding dashboard-admin-sa --clusterrole=cluster-admin --serviceaccount=default:dashboard-admin-sa</span></pre><p id="9000" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我们创建dashboard-admin-sa服务帐户时，Kubernetes也为它创建了一个秘密。</p><p id="d627" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">列出机密使用:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="7014" class="lf jr hi ly b fi mc md l me mf">kubectl get secrets</span></pre><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ng"><img src="../Images/a8d6ab8ceba2efeb572d82899df59ad8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QyE017iITQS4TS-20vp9QA.jpeg"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">Kubernetes Secret</figcaption></figure><p id="769d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以在上面的截图中看到dashboard-admin-sa服务帐户机密。你的名字后面会有一个不同的数字，在这个例子中，我的名字是- <strong class="is hj"> 6b8xx </strong>。</p><p id="643c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用kubectl describe获取访问令牌:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="2fff" class="lf jr hi ly b fi mc md l me mf">kubectl describe secret dashboard-admin-sa-token-6b8xx</span></pre><p id="507e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制令牌并将其输入到Kubernetes仪表板登录页面上的令牌字段中。</p><p id="8910" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在可以访问Kubernetes仪表板，并进入默认名称空间的概述页面。</p><p id="7701" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Kubernetes仪表板有四个主要部分:</p><ul class=""><li id="981f" class="mp mq hi is b it iu ix iy jb mr jf ms jj mt jn ne mv mw mx bi translated">串</li><li id="bb2a" class="mp mq hi is b it my ix mz jb na jf nb jj nc jn ne mv mw mx bi translated">工作量</li><li id="5745" class="mp mq hi is b it my ix mz jb na jf nb jj nc jn ne mv mw mx bi translated">发现和负载平衡以及</li><li id="7d22" class="mp mq hi is b it my ix mz jb na jf nb jj nc jn ne mv mw mx bi translated">配置和存储</li></ul><p id="8e40" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程中，我们不会过多地使用仪表板，因为我们将使用Rancher。事实上还有很多其他的Kubernetes GUI客户端，你可以看看<a class="ae jp" href="https://octant.dev/" rel="noopener ugc nofollow" target="_blank"> Octant </a>或者<a class="ae jp" href="https://k8slens.dev/" rel="noopener ugc nofollow" target="_blank"> Lens </a>都是非常好的GUI管理工具。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="1202" class="jq jr hi bd js jt la jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj le kl km kn bi translated">安装Traefik作为我们的反向代理</h1><p id="a05b" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated"><a class="ae jp" href="https://traefik.io/traefik/" rel="noopener ugc nofollow" target="_blank"> Traefik </a>是<strong class="is hj">一款领先的反向代理和负载平衡器，适用于云原生操作和容器化工作负载</strong>。它作为一个边缘路由器，将您的服务发布到互联网上。Traefik通过匹配请求属性(如域、URL和端口)将请求路由到您的容器。我们还将为我们的let加密证书使用Traefik，允许我们为我们将来要创建的所有服务使用通配符SSL证书。我在本地的家庭实验室环境中广泛使用了它，发现它相当简单易用。</p><p id="7219" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了安装Traefik，我们使用Helm，它是Kubernetes的一个包管理器。</p><p id="eb9b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用以下命令安装Traefik，并通过traefik-values.yml文件进行其他配置。</p><p id="ec24" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们需要将回购添加到helm，然后我们可以在更新helm回购后安装Traefik。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="3805" class="lf jr hi ly b fi mc md l me mf">helm repo add traefik https://helm.traefik.io/traefik <br/>helm repo update <br/>helm install traefik traefik/traefik --values=traefik-values.yml</span></pre><p id="46c0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">在运行脚本之前，用您的值替换</strong><a class="ae jp" href="http://example.com" rel="noopener ugc nofollow" target="_blank"><strong class="is hj"/></a><strong class="is hj">以及您的Cloudflare电子邮件和api密钥。</strong>如果您没有使用Cloudflare，请查看以下关于如何配置其他提供商的链接，<a class="ae jp" href="https://doc.traefik.io/traefik/https/acme/" rel="noopener ugc nofollow" target="_blank">https://doc.traefik.io/traefik/https/acme/</a></p><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="nh ni l"/></div><figcaption class="mj mk et er es ml mm bd b be z dx">traefik-values.yml</figcaption></figure><p id="0a6c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装Traefik后，我们可以使用以下命令代理进入仪表板</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="81b5" class="lf jr hi ly b fi mc md l me mf">kubectl port-forward $(kubectl get pods --selector "<a class="ae jp" href="http://app.kubernetes.io/name=traefik" rel="noopener ugc nofollow" target="_blank">app.kubernetes.io/name=traefik</a>" --output=name) 9000:9000</span></pre><p id="ee14" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您现在可以通过访问以下url浏览Traefik的仪表板<a class="ae jp" href="http://localhost:9000/dashboard/#/http/routers" rel="noopener ugc nofollow" target="_blank">http://localhost:9000/dashboard/#/http/routers</a></p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nj"><img src="../Images/4f7ca2858b9e15216e60ea073b5cbd5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p8kveB1J7eohNWQQZ6hA1A.jpeg"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">Traefik dashboard</figcaption></figure><p id="e680" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦Helm安装了Traefik，我们需要转到Oracle云控制台并进行一些更改。因为我们已经安装了Traefik，Kubernetes会自动检测到需要一个负载平衡器，并在Oracle中为我们设置一个。</p><p id="3836" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们转到控制台<a class="ae jp" href="https://cloud.oracle.com/load-balancer/load-balancers?region=uk-london-1" rel="noopener ugc nofollow" target="_blank">https://cloud.oracle.com/load-balancer/load-balancers?中的负载平衡器区域=英国-伦敦-1 </a></p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nk"><img src="../Images/6d0af5ea50616d81133303ec6cdc556d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UL6LYQeP0DMGf6ebYmAgCg.jpeg"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">Load Balancer console</figcaption></figure><p id="65b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Oracle cloud有一个永久免费层，为了确保在创建Kubernetes集群和配置负载平衡器时始终免费，请确保负载平衡器设置为10mb/s网络，而不是100mb/s</p><p id="d769" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过单击详细视图上的更新形状按钮来更新负载平衡器形状，从而更改这一点。</p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nl"><img src="../Images/3629cb1ff1908fa2db1a245d5a7e81ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ClLeUyMEqhLKPdr4TeRWiQ.jpeg"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">Load Balancer detail view</figcaption></figure><figure class="lt lu lv lw fd ij er es paragraph-image"><div class="er es nm"><img src="../Images/9e9649be27330d88f139cf3a3c379da0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*m2iYcq_7cswMoyevrY1_hg.png"/></div><figcaption class="mj mk et er es ml mm bd b be z dx">Update shape</figcaption></figure><p id="ea32" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在还应该有一个负载平衡器的公共IP地址。浏览到这个ip地址应该显示404 not found错误，这意味着负载平衡器正在路由到Traefik。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="a7e1" class="jq jr hi bd js jt la jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj le kl km kn bi translated">设置Cloudflare</h1><p id="22fa" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">我们现在需要将我们的域指向我们新创建的负载平衡器。登录到Cloudflare，创建一个指向我们的负载平衡器的公共IP地址的A记录。</p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nn"><img src="../Images/eb7cc2cba0813d78495c2273a5ac4dc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UI_3GaFeS8hfUWzSxXtljw.jpeg"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">Cloudflare DNS</figcaption></figure><p id="5b68" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以建立一个指向牧场主的CNAME记录。<your domain="">我们稍后将需要它来访问牧场主界面。</your></p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es no"><img src="../Images/9c34636ce41913352cf2bb1abd969753.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Liv_x4fF4Y6v9yA0L15SvA.png"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">Cloudflare CNAME record</figcaption></figure><blockquote class="np nq nr"><p id="bf51" class="iq ir jo is b it iu iv iw ix iy iz ja ns jc jd je nt jg jh ji nu jk jl jm jn hb bi translated">A记录开始路由可能需要几分钟到48小时。对我来说，大约需要2-5分钟。</p></blockquote><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nv"><img src="../Images/0edecb03d184e053bfc5eab46fdcf42c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k7HTTfVzhNm_SwSe8NZHuw.png"/></div></div></figure><p id="5f14" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">确保您为您的域打开SSL/TLS的完全(严格)模式</strong>，否则当您在接下来的步骤中浏览到您的域时，您可能会得到一个错误，指出有许多重定向。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="4bd9" class="jq jr hi bd js jt la jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj le kl km kn bi translated">Whoami应用程序</h1><p id="c33e" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">现在，为了测试我们的域和Traefik是否正常工作和路由，让我们在端口80上创建一个whoami应用程序，我们将使用我们的域来浏览它。</p><p id="5cae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行以下命令:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="cfd1" class="lf jr hi ly b fi mc md l me mf">kubectl apply -f whoami.yml</span></pre><p id="f8d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在与<strong class="is hj"> whoami.yml </strong>相同的目录下运行，以部署我们的whoami应用程序。<strong class="is hj">确保用您的域名替换example.com</strong></p><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="nh ni l"/></div><figcaption class="mj mk et er es ml mm bd b be z dx">whoami.yml</figcaption></figure><p id="7a5c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，使用<a class="ae jp" href="https://gist.github.com/marcelo-ochoa/58b58b273b33ae44a11c0470d1895635" rel="noopener ugc nofollow" target="_blank"> w </a> hoami-tls.yml检查是否为我们的应用程序生成了LetsEncrypt证书</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="a0ac" class="lf jr hi ly b fi mc md l me mf">kubectl apply -f whoami-tls.yml</span></pre><p id="4d6d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在与<strong class="is hj"> whoami-tls.yml </strong>相同的目录下运行，以部署我们的入口路由。<strong class="is hj">确保你用你的域名取代example.com</strong></p><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="nh ni l"/></div><figcaption class="mj mk et er es ml mm bd b be z dx">whoami-tls.yml</figcaption></figure><p id="2574" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您浏览您的域名时，您应该会看到如下内容:</p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nw"><img src="../Images/a41e0ea1a213a9852c225a6bd2019e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yik64BUA8PbPhqoWHUGLOQ.jpeg"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">Whoami service</figcaption></figure><p id="cb24" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Traefik现在正在为我们创建一个证书，因此我们现在有了安全的通配符SSL证书来支持我们的服务！</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="7b6b" class="jq jr hi bd js jt la jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj le kl km kn bi translated">牧场主Kubernetes管理</h1><p id="3d1f" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">Rancher是为采用容器的团队提供的一个完整的软件栈。它解决了跨任何基础设施管理多个Kubernetes集群的运营和安全挑战，同时为DevOps团队提供了运行容器化工作负载的集成工具。</p><p id="6566" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">虽然我们可以从终端和Kubernetes仪表板单独管理Kubernetes</p><p id="a882" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Rancher是一个直观的界面，为所有集群和集中式策略控制和监控提供单点联系。Rancher使管理容器和集群变得非常容易。</p><p id="f1b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">与Traefik一样，我们将使用helm安装Rancher，为此我们需要在helm中添加rancher repo</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="8685" class="lf jr hi ly b fi mc md l me mf">helm repo add rancher-stable <a class="ae jp" href="https://releases.rancher.com/server-charts/stable" rel="noopener ugc nofollow" target="_blank">https://releases.rancher.com/server-charts/stable</a><br/>helm repo update</span></pre><p id="f673" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您遵循Kubernetes的Ranchers安装指南<a class="ae jp" href="https://rancher.com/docs/rancher/v2.6/en/installation/install-rancher-on-k8s/" rel="noopener ugc nofollow" target="_blank">的话，您有3个SSL配置选项，我们将使用的选项是不需要证书管理器的来自文件的证书选项</a></p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nx"><img src="../Images/fc1bc2715b1512079da5a0e75e977042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CU9yFedG46hBz1VXLJJXzw.png"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">Rancher TLS Options</figcaption></figure><p id="b789" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用Helm安装rancher并为Rancher创建一个名称空间</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="d425" class="lf jr hi ly b fi mc md l me mf">kubectl create namespace cattle-system</span></pre><p id="d298" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">请确保您将主机名更改为您的域</strong><a class="ae jp" href="http://rancher.example.com" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">rancher.example.com</strong></a><strong class="is hj">，并确保您之前在Cloudflare中创建了一个CNAME条目。</strong></p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="3e54" class="lf jr hi ly b fi mc md l me mf">helm install rancher rancher-latest/rancher \<br/>  --namespace cattle-system \<br/>  --set hostname=rancher.example.com \<br/>  --set bootstrapPassword=admin \<br/>  --set ingress.tls.source=secret</span></pre><p id="7bfc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意bootstrapPassword=admin </strong>这会将rancher的初始密码设置为“<strong class="is hj"> admin </strong>”，但您需要更改密码。</p><p id="924f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">检查部署的首次展示</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="ea09" class="lf jr hi ly b fi mc md l me mf">kubectl -n cattle-system rollout status deploy/rancher</span></pre><p id="8f82" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您应该看到以下输出，请耐心等待，这可能需要一两分钟的时间</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="3cc5" class="lf jr hi ly b fi mc md l me mf">Waiting for deployment "rancher" rollout to finish: 0 of 3 updated replicas are available...<br/>Waiting for deployment "rancher" rollout to finish: 1 of 3 updated replicas are available...<br/>Waiting for deployment "rancher" rollout to finish: 2 of 3 updated replicas are available...<br/>deployment "rancher" successfully rolled out</span></pre><p id="c863" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不幸的是，如果你浏览到你的牧场主域名<a class="ae jp" href="https://rancher.example.com" rel="noopener ugc nofollow" target="_blank">https://rancher.example.com</a>，你会得到一个错误。这是因为没有Traefik指向Rancher域的IngressRoute，并且证书无法正确解析。</p><p id="cd85" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行以下命令:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="d863" class="lf jr hi ly b fi mc md l me mf">kubectl apply -f rancher.yml</span></pre><p id="3d1e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在与<strong class="is hj"> rancher.yml </strong>相同的目录中运行，以部署我们的IngressRoute。<strong class="is hj">确保用你的域名替换example.com</strong></p><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="nh ni l"/></div><figcaption class="mj mk et er es ml mm bd b be z dx">rancher-tls.yml</figcaption></figure><p id="a479" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果到目前为止一切都很成功，那么如果你浏览到你的<a class="ae jp" href="https://rancher.mydomain.com" rel="noopener ugc nofollow" target="_blank">https://rancher.example.com</a>你应该会看到牧场主开始运行了！</p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ny"><img src="../Images/61c35737a3f04e589d15bf9820a2378c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f6KgAsyZRtorvf4KbZAG6g.jpeg"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">Rancher UI</figcaption></figure><p id="2658" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦您登录并更改了密码，您应该会看到您的仪表板。一定要改成黑暗模式！</p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nz"><img src="../Images/ea02cfc5d79ae3f3151f2b4ddeaf1f7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oiY8KTl85P_CiHoNYZeWsA.png"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">Rancher Admin Dashboard</figcaption></figure><p id="2048" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们可以开始使用Rancher作为我们的Kubernetes管理门户，允许我们轻松地运行容器和扩展服务！！</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="6b43" class="jq jr hi bd js jt la jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj le kl km kn bi translated">附加安全性</h1><p id="304a" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">我们在互联网上公开了一些敏感的服务，我们可以使用Cloudflare的<strong class="is hj"> WAF (Web应用防火墙)提供的一些额外的预防措施。</strong>我们可以在这里添加一些规则，将我们的域名锁定到特定的IP地址、国家或所需的Cookie。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h1 id="2324" class="jq jr hi bd js jt la jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj le kl km kn bi translated">结论</h1><p id="2f18" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">我知道一个相当长的帖子，配置很多！但是你现在已经为你的Cloudlab打下了良好的基础，最棒的是，它是完全免费的！</p><p id="2e0b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo"> Malcolm McMorran是</em> <a class="ae jp" href="https://www.hooligan.co.za/" rel="noopener ugc nofollow" target="_blank"> <em class="jo">流氓开发</em> </a> <em class="jo">的联合创始人兼首席技术官，这是一家提供按需开发的专业OTT软件开发公司。凭借超过10年的经验和可靠的跟踪记录，这些流氓已经成为应对复杂VOD和OTT挑战的最佳人选。</em></p></div></div>    
</body>
</html>