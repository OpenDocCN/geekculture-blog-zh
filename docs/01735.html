<html>
<head>
<title>Step by Step Guide to Build and Publish a Real World Npm Package</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建和发布真实世界Npm包的分步指南</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/step-by-step-guide-to-build-and-publish-a-real-world-npm-package-446037af582c?source=collection_archive---------22-----------------------#2021-04-21">https://medium.com/geekculture/step-by-step-guide-to-build-and-publish-a-real-world-npm-package-446037af582c?source=collection_archive---------22-----------------------#2021-04-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5103" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">又一个如何构建npm包的指南？是也不是。我将涵盖一堆东西，但不是<code class="du jd je jf jg b">npm</code>命令和<code class="du jd je jf jg b">package.json</code>字段，也不是为了在npm上发布一些愚蠢的helloworld。我相信npm是人们发布对他人有用的东西的地方，也许你也想发布有用的东西，我希望这篇文章能给你带来一些想法</p><p id="9607" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我会报道的事情</p><ul class=""><li id="6db6" class="jh ji hi ih b ii ij im in iq jj iu jk iy jl jc jm jn jo jp bi translated">定义问题并解决它</li><li id="78a3" class="jh ji hi ih b ii jq im jr iq js iu jt iy ju jc jm jn jo jp bi translated">抽象并参数化它以供通用</li><li id="cb0a" class="jh ji hi ih b ii jq im jr iq js iu jt iy ju jc jm jn jo jp bi translated">选择语言、框架和构建工具</li><li id="cbc9" class="jh ji hi ih b ii jq im jr iq js iu jt iy ju jc jm jn jo jp bi translated">编码、测试和返回编码</li><li id="312a" class="jh ji hi ih b ii jq im jr iq js iu jt iy ju jc jm jn jo jp bi translated">记录并发布给国家预防机制</li></ul><p id="1cb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您没有看过npm命令和package.json字段，我真的建议您看一看</p><ul class=""><li id="d718" class="jh ji hi ih b ii ij im in iq jj iu jk iy jl jc jm jn jo jp bi translated"><a class="ae jv" href="https://docs.npmjs.com/cli/v7/commands" rel="noopener ugc nofollow" target="_blank">https://docs.npmjs.com/cli/v7/commands</a></li><li id="c275" class="jh ji hi ih b ii jq im jr iq js iu jt iy ju jc jm jn jo jp bi translated"><a class="ae jv" href="https://docs.npmjs.com/cli/v7/configuring-npm/package-json" rel="noopener ugc nofollow" target="_blank">https://docs.npmjs.com/cli/v7/configuring-npm/package-json</a></li></ul><p id="cccc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你需要我在本文中作为例子使用的水面膜库的代码/文档，你可以在这里找到。</p><div class="jw jx ez fb jy jz"><a href="https://github.com/postor/text-water-mask" rel="noopener  ugc nofollow" target="_blank"><div class="ka ab dw"><div class="kb ab kc cl cj kd"><h2 class="bd hj fi z dy ke ea eb kf ed ef hh bi translated">post or/text-水面膜</h2><div class="kg l"><h3 class="bd b fi z dy ke ea eb kf ed ef dx">单元素实现页面水印，支持 react | single element text water mask, that supports react — postor/text-water-mask</h3></div><div class="kh l"><p class="bd b fp z dy ke ea eb kf ed ef dx translated">github.com</p></div></div><div class="ki l"><div class="kj l kk kl km ki kn ko jz"/></div></div></a></div></div><div class="ab cl kp kq gp kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="hb hc hd he hf"><h1 id="af9e" class="kw kx hi bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">定义问题并解决它</h1><p id="d3e7" class="pw-post-body-paragraph if ig hi ih b ii lu ik il im lv io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated">假设问题是在页面上放置一些文本作为水印</p><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es lz"><img src="../Images/c3921608e632c8fd26a369726237e0aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-WwuTe_U08eMNFG2"/></div></div></figure><p id="99c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了解决这个问题，我选择在页面顶部使用一个<code class="du jd je jf jg b">div</code>覆盖，它使用一个<code class="du jd je jf jg b">svg</code>作为它的背景，它不会阻止用户与页面内容的交互，这需要浏览器的支持</p><ul class=""><li id="5044" class="jh ji hi ih b ii ij im in iq jj iu jk iy jl jc jm jn jo jp bi translated"><a class="ae jv" href="https://caniuse.com/svg" rel="noopener ugc nofollow" target="_blank">https://caniuse.com/svg</a></li><li id="656a" class="jh ji hi ih b ii jq im jr iq js iu jt iy ju jc jm jn jo jp bi translated"><a class="ae jv" href="https://caniuse.com/pointer-events" rel="noopener ugc nofollow" target="_blank">https://caniuse.com/pointer-events</a></li></ul><figure class="ma mb mc md fd me er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es mk"><img src="../Images/1be313c75a0898e58882585dada26aa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*db6acMZWFZmP0h9k37pTig.png"/></div></div></figure><h1 id="e4bf" class="kw kx hi bd ky kz ml lb lc ld mm lf lg lh mn lj lk ll mo ln lo lp mp lr ls lt bi translated">抽象并参数化它以供通用</h1><p id="0c9e" class="pw-post-body-paragraph if ig hi ih b ii lu ik il im lv io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated">如果我们想让它对其他人有用，<code class="du jd je jf jg b">div</code>和<code class="du jd je jf jg b">css</code>可能帮不上忙，所以让我们把它变成一个函数。出于本能，它是这样来的，给一些<code class="du jd je jf jg b">element</code>添加遮罩，用<code class="du jd je jf jg b">maskOptions</code>你可以配置遮罩的样子</p><pre class="ma mb mc md fd mq jg mr ms aw mt bi"><span id="8e6a" class="mu kx hi jg b fi mv mw l mx my">function addMaskTo(element,maskOptions){}</span></pre><p id="5607" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是一旦它被添加了，你怎么能删除它呢？所以我把它改成只返回一个元素</p><pre class="ma mb mc md fd mq jg mr ms aw mt bi"><span id="51f4" class="mu kx hi jg b fi mv mw l mx my">function getMask(maskOptions){}<br/>let el = getMask()<br/>document.body.appendChild(el)<br/>// el.remove() // when you nolonger need it</span></pre><p id="e732" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有几点你需要考虑</p><ul class=""><li id="9a0e" class="jh ji hi ih b ii ij im in iq jj iu jk iy jl jc jm jn jo jp bi translated">是纯函数吗？(不要修改输入参数)</li><li id="0827" class="jh ji hi ih b ii jq im jr iq js iu jt iy ju jc jm jn jo jp bi translated">全局名称空间污染(当这无法避免时，请确保键是唯一的)</li><li id="be73" class="jh ji hi ih b ii jq im jr iq js iu jt iy ju jc jm jn jo jp bi translated">内存泄漏(当您绑定侦听器并一起使用closer时，要小心)</li><li id="5f12" class="jh ji hi ih b ii jq im jr iq js iu jt iy ju jc jm jn jo jp bi translated">违反直觉(人们看到名字就知道怎么用)</li></ul><h1 id="5c5d" class="kw kx hi bd ky kz ml lb lc ld mm lf lg lh mn lj lk ll mo ln lo lp mp lr ls lt bi translated">选择语言、框架和构建工具</h1><p id="d115" class="pw-post-body-paragraph if ig hi ih b ii lu ik il im lv io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated">当你写一个库的时候，我推荐TypeScript，它更方便，IDEs会填充代码或者让你选择，而不是强迫开发者全部输入，但是TypeScript有它的代价，你需要学习，有时你会发现它不够成熟。这里我选择TypeScript。</p><p id="5831" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以为React之类的框架编写一个库，但也可能是其他的或者根本不是。在这里，我在普通JavaScript中选择了React和function</p><p id="edd3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于捆绑工具，TypeScript已经可以编译es5，我为UMD捆绑添加webpack</p><p id="4466" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在github上创建一个repo，签出repo，用TypeScript、webpack和React在这个项目中运行命令</p><pre class="ma mb mc md fd mq jg mr ms aw mt bi"><span id="1f59" class="mu kx hi jg b fi mv mw l mx my">npm init -y<br/>npm i typescript webpack webpack-cli react -D</span></pre><p id="69ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此处为考虑列表添加更多内容</p><ul class=""><li id="4c09" class="jh ji hi ih b ii ij im in iq jj iu jk iy jl jc jm jn jo jp bi translated">开发者体验</li><li id="c87a" class="jh ji hi ih b ii jq im jr iq js iu jt iy ju jc jm jn jo jp bi translated">项目复杂性</li><li id="5cf2" class="jh ji hi ih b ii jq im jr iq js iu jt iy ju jc jm jn jo jp bi translated">支撑框架工程</li></ul><h1 id="d621" class="kw kx hi bd ky kz ml lb lc ld mm lf lg lh mn lj lk ll mo ln lo lp mp lr ls lt bi translated">编码、测试和返回编码</h1><p id="9cf6" class="pw-post-body-paragraph if ig hi ih b ii lu ik il im lv io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated">我使用了这样一个结构</p><figure class="ma mb mc md fd me er es paragraph-image"><div class="er es mz"><img src="../Images/e9c6df6df1f4b466800b38db1cb5648c.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*eDbBMyrKpSIBoGY9asdF_g.png"/></div></figure><p id="4bbc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并且默认导出一个函数，增加了开发者只需要修改文本时的支持</p><pre class="ma mb mc md fd mq jg mr ms aw mt bi"><span id="9435" class="mu kx hi jg b fi mv mw l mx my">export default function <strong class="jg hj">getWaterMask</strong>(config: <strong class="jg hj">Config</strong> | string): <strong class="jg hj">HTMLElement</strong> {<br/>  ...<br/>}</span></pre><p id="a52c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当测试时，我发现当<code class="du jd je jf jg b">"</code>或<code class="du jd je jf jg b">'</code>出现在svg样式中时，它会因为冲突而停止工作，所以我使用base64编码的svg，而不是普通的xml svg</p><pre class="ma mb mc md fd mq jg mr ms aw mt bi"><span id="7845" class="mu kx hi jg b fi mv mw l mx my">export function <strong class="jg hj">getBackgroundImageStr</strong>(text: string, svgProps: <strong class="jg hj">Props</strong>, textProps: <strong class="jg hj">Props</strong>): string {  <br/>  return `url("data:image/svg+xml;base64,${base64.<strong class="jg hj">encode</strong>(`&lt;svg ${<strong class="jg hj">props2str</strong>(svgProps)}&gt;${`&lt;text ${<strong class="jg hj">props2str</strong>(textProps)}&gt;${text}&lt;/text&gt;`}&lt;/svg&gt;`)}")`<br/>}</span></pre><p id="fe7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用base64 lib还是用<code class="du jd je jf jg b">window.btoa</code>？您需要考虑它是否在节点和浏览器中都工作，并且导入库很可能会增大最终的包大小，所以还需要更多的考虑。</p><ul class=""><li id="85ca" class="jh ji hi ih b ii ij im in iq jj iu jk iy jl jc jm jn jo jp bi translated">同构(节点中未定义窗口)</li><li id="4bd5" class="jh ji hi ih b ii jq im jr iq js iu jt iy ju jc jm jn jo jp bi translated">包装尺寸(意味着最终用户体验)</li></ul><p id="034f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用例子和测试</p><pre class="ma mb mc md fd mq jg mr ms aw mt bi"><span id="2138" class="mu kx hi jg b fi mv mw l mx my">&lt;script <em class="na">src</em>="../../dist/text-water-mask.umd.js"&gt;&lt;/script&gt;<br/>&lt;script&gt;document.body.<strong class="jg hj">appendChild</strong>(TextWaterMask.<strong class="jg hj">default</strong>({ text: 'hello world!!' }))&lt;/script&gt;</span></pre><p id="1590" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">记录并发布给国家预防机制</strong></p><p id="8f72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">写一个<code class="du jd je jf jg b">README.md</code>告诉人们你的库，并使用github页面制作一个现场演示会很棒！我用<code class="du jd je jf jg b">next export</code>和<code class="du jd je jf jg b">html-inline</code>生成了demo，看起来是这样的</p><figure class="ma mb mc md fd me er es paragraph-image"><div class="er es nb"><img src="../Images/321a6740c0eea07821e727643ad39afe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*FrWKvmeP2g_uGgbh39f7Eg.png"/></div></figure><p id="38bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后只剩下两件事，发表和测试发表，希望你的包工作正常。</p></div></div>    
</body>
</html>