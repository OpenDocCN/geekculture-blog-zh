<html>
<head>
<title>How to integrate your app with GraphQL server without writing code.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在不编写代码的情况下将您的应用程序与GraphQL server集成。</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/how-to-integrate-your-app-with-graphql-server-without-writing-code-fb665a2537f2?source=collection_archive---------5-----------------------#2021-07-22">https://medium.com/geekculture/how-to-integrate-your-app-with-graphql-server-without-writing-code-fb665a2537f2?source=collection_archive---------5-----------------------#2021-07-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4663" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GraphQL现在越来越受欢迎，这并不奇怪。GraphQL比REST API灵活得多，您可以在一个请求中从后端接收所有需要的数据。今天我将展示如何不用写一行代码就为GraphQL服务器创建一个客户端，好吧，好吧，不完全不用写代码，只用几行代码:)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/309d5e2554767aa2fb43e02587cdacad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*elGAYAPOGSpTVCNgHdGi0Q.jpeg"/></div></div></figure><h1 id="d691" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">代码生成</h1><p id="1c44" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">这是一个相当古老且不言自明的概念。您将一些模式定义传递给代码生成器，它会在某种编程语言上创建现成的代码。例如:您可以从数据库模式生成ORM实体代码或迁移代码。这个概念在Golang中变得非常流行，因为Golang不支持泛型。但是GraphQL呢？</p><h1 id="ff9b" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">GraphQL代码生成器</h1><p id="1e18" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">来自<a class="ae ks" href="https://the-guild.dev/" rel="noopener ugc nofollow" target="_blank">公会</a> <em class="kt"> </em>的家伙们创造了一个很棒的工具——<a class="ae ks" href="https://www.graphql-code-generator.com/" rel="noopener ugc nofollow" target="_blank">GraphQL代码生成器</a>(我不是在推广公会组织，我不知道他们是谁)，这个工具从graph QL模式生成代码。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ku"><img src="../Images/bb279fae35cd4356d9e6f373479770c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HLN-0SS8zkPYix51gJlb9Q.jpeg"/></div></div></figure><p id="9548" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GraphQL代码生成器支持<a class="ae ks" href="https://www.graphql-code-generator.com/docs/plugins/typescript" rel="noopener ugc nofollow" target="_blank">类型脚本</a>、<a class="ae ks" href="https://www.graphql-code-generator.com/docs/plugins/flow" rel="noopener ugc nofollow" target="_blank">流程</a>、<a class="ae ks" href="https://www.graphql-code-generator.com/docs/plugins/reason-client" rel="noopener ugc nofollow" target="_blank">原因</a>、<a class="ae ks" href="https://www.graphql-code-generator.com/docs/plugins/java" rel="noopener ugc nofollow" target="_blank"> Java </a>、<a class="ae ks" href="https://www.graphql-code-generator.com/docs/plugins/kotlin" rel="noopener ugc nofollow" target="_blank"> Kotlin </a>和<a class="ae ks" href="https://www.graphql-code-generator.com/docs/plugins/c-sharp" rel="noopener ugc nofollow" target="_blank"> C# </a>。这意味着你可以使用它进行web、后端、iOS和Android开发。让我们试着为网络应用创造一些东西。如果我们打开docs中的<a class="ae ks" href="https://www.graphql-code-generator.com/docs/plugins/typescript" rel="noopener ugc nofollow" target="_blank"> TypeScript部分</a>，我们可以看到有几个不同框架的插件，比如React、Vue、Angular和Svelte。但是我更感兴趣的是不与某些框架紧密耦合的通用解决方案。最受欢迎的GraphQL客户端是<code class="du kv kw kx ky b"><a class="ae ks" href="https://www.npmjs.com/package/@apollo/client" rel="noopener ugc nofollow" target="_blank">apollo-client</a></code>和<code class="du kv kw kx ky b"><a class="ae ks" href="https://www.npmjs.com/package/graphql-request" rel="noopener ugc nofollow" target="_blank">graphql-request</a></code>，根据NPM的数据，它们每周的下载量几乎相等，你可以在前端和后端下载。我更喜欢<code class="du kv kw kx ky b">graphql-request</code>，因为它非常简单、轻便。而且不用担心缓存失效，因为<code class="du kv kw kx ky b">graphql-request</code>不支持任何缓存。</p><h1 id="abd3" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">类型生成</h1><p id="f982" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">让我们安装所有必需的依赖项:</p><pre class="je jf jg jh fd kz ky la lb aw lc bi"><span id="c7cc" class="ld jq hi ky b fi le lf l lg lh">yarn add graphql graphql-tag<br/>yarn add --dev @graphql-codegen/cli @graphql-codegen/typescript</span></pre><p id="0aa3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kv kw kx ky b">graphql</code>，<code class="du kv kw kx ky b">graphql-tag</code>将用于在运行时发出GraphQL请求，<code class="du kv kw kx ky b">@graphql-codegen</code>包仅用于开发目的。</p><p id="246e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了测试，我们可以使用一些公共的GraphQL服务器，例如<a class="ae ks" href="https://api.spacex.land/graphql/" rel="noopener ugc nofollow" target="_blank">https://api.spacex.land/graphql/</a>。让我们用GraphQL代码生成器配置创建<code class="du kv kw kx ky b">codegen.yaml</code>:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="0fa5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并运行它:</p><pre class="je jf jg jh fd kz ky la lb aw lc bi"><span id="f8f0" class="ld jq hi ky b fi le lf l lg lh">yarn graphql-codegen</span></pre><p id="1023" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">成功执行后，GraphQL代码生成器会创建一个巨大的TypeScript文件，其中包含所有已定义模式类型的类型定义。它有1321行，所以我在这里只添加了一部分:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="a684" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kv kw kx ky b">Maybe</code>、<code class="du kv kw kx ky b">Exact</code>、<code class="du kv kw kx ky b">MakeOptional</code>和<code class="du kv kw kx ky b">MakeMaybe</code>是实用程序类型，它们将在生成的代码中广泛使用。下一个类型是<code class="du kv kw kx ky b">Scalars</code>，实际上它不作为类型使用，它是一个以GraphQL标量类型作为键，以TypeScript类型作为值的映射。如你所见，有些错误:<code class="du kv kw kx ky b">Date</code>、<code class="du kv kw kx ky b">ObjectID</code>、<code class="du kv kw kx ky b">timestamptz</code>、<code class="du kv kw kx ky b">uuid</code>映射为<code class="du kv kw kx ky b">any</code>，但实际上是字符串。让我们通过添加类型映射来修复它:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="6e32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">再次运行<code class="du kv kw kx ky b">yarn codegen</code>后<code class="du kv kw kx ky b">Scalars</code>变为:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="6d98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<code class="du kv kw kx ky b">Scalars</code>之后是型号类型。好了，我们有类型了，接下来呢？</p><h1 id="e3ac" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">SDK生成</h1><p id="b618" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">现在，我们将尝试生成一些用于访问GraphQL API服务器的代码。首先，我们需要安装所需的插件:</p><pre class="je jf jg jh fd kz ky la lb aw lc bi"><span id="10ad" class="ld jq hi ky b fi le lf l lg lh">yarn add --dev <a class="ae ks" href="http://twitter.com/graphql" rel="noopener ugc nofollow" target="_blank">@graphql</a>-codegen/typescript-operations <a class="ae ks" href="http://twitter.com/graphql" rel="noopener ugc nofollow" target="_blank">@graphql</a>-codegen/typescript-graphql-request</span></pre><p id="c6cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">向<code class="du kv kw kx ky b">codegen.yaml</code>添加新插件:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="8d19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并运行<code class="du kv kw kx ky b">yarn graphql-codegen</code>，在脚本执行后这段代码被添加到<code class="du kv kw kx ky b">graphql.sdk.ts</code>的末尾:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="1304" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kv kw kx ky b">getSdk</code>函数返回空对象，为了用有用的东西填充它，我们需要用GraphQL查询创建一个文件。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="1b04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">重要:GraphQL查询必须有名称，否则GraphQL代码生成器会忽略它。</p><p id="f4ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并重新配置<code class="du kv kw kx ky b">codegen.yaml</code>来扫描GraphQL查询文件:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="ef44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在运行<code class="du kv kw kx ky b">yarn graphql-codegen</code>之后，我们得到这个:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="51ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GraphQL代码生成器已经自动为GraphQL查询变量和响应创建了类型，并将其包装到方法<code class="du kv kw kx ky b">TestQuery</code>。最后一步，将SDK挂载到<code class="du kv kw kx ky b">graphql-request</code>实例。先别忘了<code class="du kv kw kx ky b">graphql-request</code>:</p><pre class="je jf jg jh fd kz ky la lb aw lc bi"><span id="536a" class="ld jq hi ky b fi le lf l lg lh">yarn add graphql-request</span></pre><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="a7f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就这样，SDK就可以用了！要添加新的GraphQL查询，只需添加一个文件并重新运行<code class="du kv kw kx ky b">yarn graphql-codegen</code>。正如我所承诺的，我们只写了4行代码，其他部分是配置和GraphQL查询。</p><h1 id="a9dc" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">奖金</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lk"><img src="../Images/9286c7afde1e64a17ba1474331509138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q9vGV5MAVd9ykinPYVfU8A.jpeg"/></div></div></figure><p id="77de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">生成的代码可能不符合你的linter规则，你可以将它标记为忽略，或者你可以自动将<code class="du kv kw kx ky b">/* eslint-disable */</code>添加到生成文件的顶部。通过安装特殊插件:</p><pre class="je jf jg jh fd kz ky la lb aw lc bi"><span id="34f0" class="ld jq hi ky b fi le lf l lg lh">yarn add --dev @graphql-codegen/add</span></pre><p id="3b27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并补充到<code class="du kv kw kx ky b">codegen.yaml</code>:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="0d6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了简化生成的代码，你可以去掉<code class="du kv kw kx ky b">__typename</code>，当然如果你不使用它的话。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="4d7d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GraphQL代码生成器可以在手表模式下运行，方法是将<code class="du kv kw kx ky b">watch: true</code>添加到<code class="du kv kw kx ky b">codegen.yaml</code>:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="f969" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，您可以在开发服务器上同时运行GraphQL代码生成器。创建React应用程序的示例:</p><pre class="je jf jg jh fd kz ky la lb aw lc bi"><span id="00c9" class="ld jq hi ky b fi le lf l lg lh">"start": "yarn codegen &amp; react-scripts start"</span></pre><h1 id="1f45" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="ad65" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">开发人员应该自动化他们的开发过程。为外部服务编写类型是一个耗费精力和时间的过程。节省你的时间！配置自动代码生成，并使用它，直到你被解雇。</p><p id="fcd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kt">今天就到这里吧！下次见！Servus！</em></p></div></div>    
</body>
</html>