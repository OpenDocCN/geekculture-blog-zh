<html>
<head>
<title>Custom Data Augmentation using Keras ImageDataGenerator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Keras ImageDataGenerator的自定义数据扩充</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/custom-data-augmentation-using-keras-imagedatagenerator-7cfd58e54171?source=collection_archive---------5-----------------------#2022-11-08">https://medium.com/geekculture/custom-data-augmentation-using-keras-imagedatagenerator-7cfd58e54171?source=collection_archive---------5-----------------------#2022-11-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3a1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在训练神经网络时经常会遇到麻烦，因为我们没有足够的数据来训练它。众所周知，大多数机器学习模型，尤其是深度学习模型，都只能达到给定的训练数据的水平。现在我们可以尝试收集更多的数据，但收集数据是一项耗时且繁琐的任务。这个问题的解决方案是数据扩充。</p><p id="d532" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">本博客内容如下:</strong></p><ol class=""><li id="72fa" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">什么是数据增强？</li><li id="1b45" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">Keras图像数据生成器</li><li id="16de" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">创建自定义转换的步骤</li></ol><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es jr"><img src="../Images/2ac34b9bfe5540309a1d1bd379cee508.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tn5OQOMmetl1XxBWsEiF8w.png"/></div></div></figure><h1 id="e577" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">什么是数据增强？</h1><p id="a776" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">扩充是一种通过对现有数据应用不同的变换并使用它们创建新样本来增加数据集大小的技术。如图1所示，可以使用旋转和裁剪等变换来放大一张狗的图像。增强的目的不仅仅是增加数据集中的样本数量，还可以在数据集中产生变化，这将防止过度拟合，并帮助模型在看不见的图像上更好地概括。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es lg"><img src="../Images/b8658f3cfecb180df46d89478d50fd0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_LOOgcnxzk1wfOTiMlwCg.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx">Figure 1. Augmented Images of a Dog</figcaption></figure><h1 id="08bf" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">Keras图像数据生成器</h1><p id="6845" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">增加数据而不产生大量开销的一种简单方法是使用Keras ImageDataGenerator。ImageDataGenerator通过实时数据扩充生成批量张量图像数据。这确保了我们的模型将接收每个时期的数据变化，这有助于防止过度拟合。同时，ImageDataGenerator使用更少的内存，因为它分批加载所有图像，而不是一次加载所有图像。</p><p id="f5b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ImageDataGenerator还提供了广泛的转换:</p><ol class=""><li id="910b" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">旋转</li><li id="a7a3" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">聪明</li><li id="b926" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">剪(羊毛)</li><li id="a683" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">一款云视频会议软件</li><li id="5b9c" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">水平和垂直翻转</li></ol><p id="8fc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是如果你想添加更多的转换呢？如何保留ImageDataGenerator的所有出色特性，并向其中添加您的自定义转换呢？因此，在这篇博客中，我将向您解释如何向ImageDataGenerator添加自定义转换。</p><h1 id="1956" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">创建自定义转换的步骤</h1><p id="8160" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">创建自定义转换的最有效方法是创建一个从原始Image Data Generator类继承的自定义图像数据生成器类。这个类可以很容易地扩展，以便在将来添加新的扩展。现在让我们进入代码。</p><p id="5459" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将实现2个自定义转换:垂直和水平运动模糊。这将帮助我们理解如何实现多重转换。</p><h2 id="73f1" class="ll ke hi bd kf lm ln lo kj lp lq lr kn iq ls lt kr iu lu lv kv iy lw lx kz ly bi translated">步骤0:导入库</h2><pre class="js jt ju jv fd lz ma mb mc aw md bi"><span id="8f2f" class="ll ke hi ma b fi me mf l mg mh">import cv2<br/>import numpy as np<br/>from tensorflow.keras.preprocessing.image import ImageDataGenerator<br/>import matplotlib.pyplot as plt</span></pre><h2 id="fa87" class="ll ke hi bd kf lm ln lo kj lp lq lr kn iq ls lt kr iu lu lv kv iy lw lx kz ly bi translated">步骤1:声明CustomDataGenerator类</h2><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="lh li et er es lj lk bd b be z dx">Figure 2. Skeleton Code for CustomDataGenerator</figcaption></figure><p id="fef5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，我们扩展了ImageDataGenerator，这样我们可以在<strong class="ih hj"> __init__() </strong>方法中指定我们的参数。我们将<strong class="ih hj">处理_函数</strong>声明为<strong class="ih hj">动作</strong>，我们将把我们的变换称为水平和垂直运动模糊。现在让我们在<strong class="ih hj"> __init__() </strong>函数中定义我们的参数。</p><h2 id="8a72" class="ll ke hi bd kf lm ln lo kj lp lq lr kn iq ls lt kr iu lu lv kv iy lw lx kz ly bi translated">第二步:__init__()函数</h2><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="lh li et er es lj lk bd b be z dx">Figure 3. Declaring parameters in __init__()</figcaption></figure><p id="dff6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在这里声明了两个参数，<strong class="ih hj"> v_kernel_size </strong>和<strong class="ih hj"> h_kernel_size，</strong>分别用于垂直运动模糊和水平运动模糊。</p><h2 id="e0cb" class="ll ke hi bd kf lm ln lo kj lp lq lr kn iq ls lt kr iu lu lv kv iy lw lx kz ly bi translated">步骤3:编写转换逻辑</h2><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="lh li et er es lj lk bd b be z dx">Figure 4. Logic for Transformations</figcaption></figure><p id="4dd4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这不是实现这些变换的最有效的方法，但是为了实现多重变换，我们为运动模糊创建了两个不同的函数。请注意，这种转换也可以使用单个函数来完成。你可以看看这个<a class="ae mk" href="https://www.geeksforgeeks.org/opencv-motion-blur-in-python/#:~:text=Horizontal%3A,vector%20to%20create%20the%20filter." rel="noopener ugc nofollow" target="_blank">运动模糊的实现。</a></p><h2 id="2e90" class="ll ke hi bd kf lm ln lo kj lp lq lr kn iq ls lt kr iu lu lv kv iy lw lx kz ly bi translated">步骤4:动作功能逻辑</h2><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="lh li et er es lj lk bd b be z dx">Figure 5. Action Function</figcaption></figure><p id="e85b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我们称之为我们的转变。我们需要随机选择一个转换，为其创建一个转换列表，并生成0到1范围内的随机值，对应于每个转换。然后，我们选择具有最高值的转换。</p><h2 id="9069" class="ll ke hi bd kf lm ln lo kj lp lq lr kn iq ls lt kr iu lu lv kv iy lw lx kz ly bi translated">第5步:将所有功能放在一起</h2><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="lh li et er es lj lk bd b be z dx">Figure 6. Complete CustomDataGenrator Script</figcaption></figure><p id="2461" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们的CustomDataGenerator的外观。现在是时候执行这个数据生成器了，看看输出是什么样子。请注意，我们仍然可以使用ImageDataGenerator中存在的转换，因为我们将它们继承到我们的自定义数据生成器中。</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="lh li et er es lj lk bd b be z dx">Figure 7. Executing the CustomDataGenerator</figcaption></figure><p id="fe2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个脚本的输出可以在图8中看到。这里要注意的一点是，我们还包含了ImageDataGenerator类的默认参数<strong class="ih hj"> horizontal_flip </strong>，可以在子情节1、2和9中看到。我们的自定义变换应用于支线剧情3、4、5、6、7和8。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div class="er es ml"><img src="../Images/11ec3ee8b04e1d65fa4afb6faea5f790.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*xg5Hx9a7tDIAaOTzTRzzbg.png"/></div><figcaption class="lh li et er es lj lk bd b be z dx">Figure 8. Output of CustomDataGenerator</figcaption></figure><h1 id="9f1e" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论</h1><p id="6207" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">我们最终用我们的自定义转换构建了一个CustomDataGenerator，而且只用了几行代码。你可以尝试实现其他的变换，比如分块随机补丁和添加高斯噪声。我希望这篇博客能帮助你使用Keras ImageDataGenerator创建定制的增强，没有任何问题。如果你喜欢阅读这篇博客，请考虑在Medium上关注我的类似内容，并在LinkedIn上与我联系！</p><p id="3541" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击这里查看我的其他文章！</p><p id="2cd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参考资料:</p><div class="mm mn ez fb mo mp"><a href="https://www.analyticsvidhya.com/blog/2020/08/image-augmentation-on-the-fly-using-keras-imagedatagenerator/" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab dw"><div class="mr ab ms cl cj mt"><h2 class="bd hj fi z dy mu ea eb mv ed ef hh bi translated">图像增强Keras</h2><div class="mw l"><h3 class="bd b fi z dy mu ea eb mv ed ef dx translated">了解图像增强使用深度学习时使用Keras ImageDataGenerator学习图像增强…</h3></div><div class="mx l"><p class="bd b fp z dy mu ea eb mv ed ef dx translated">www.analyticsvidhya.com</p></div></div><div class="my l"><div class="mz l na nb nc my nd kb mp"/></div></div></a></div><div class="mm mn ez fb mo mp"><a href="https://stepup.ai/custom_data_augmentation_keras/" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab dw"><div class="mr ab ms cl cj mt"><h2 class="bd hj fi z dy mu ea eb mv ed ef hh bi translated">教程:Jeras中的自定义数据扩充</h2><div class="mw l"><h3 class="bd b fi z dy mu ea eb mv ed ef dx translated">开箱即用，Keras提供了许多优秀的数据增强技术，您可能已经在之前的…</h3></div><div class="mx l"><p class="bd b fp z dy mu ea eb mv ed ef dx translated">stepup.ai</p></div></div><div class="my l"><div class="ne l na nb nc my nd kb mp"/></div></div></a></div><div class="mm mn ez fb mo mp"><a href="https://www.tensorflow.org/api_docs/python/tf/keras/preprocessing/image/ImageDataGenerator" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab dw"><div class="mr ab ms cl cj mt"><h2 class="bd hj fi z dy mu ea eb mv ed ef hh bi translated">TF . keras . preprocessing . image . image data generator | tensor flow v 2 . 10 . 0</h2><div class="mw l"><h3 class="bd b fi z dy mu ea eb mv ed ef dx translated">通过实时数据扩充生成批量张量图像数据。</h3></div><div class="mx l"><p class="bd b fp z dy mu ea eb mv ed ef dx translated">www.tensorflow.org</p></div></div></div></a></div></div></div>    
</body>
</html>