<html>
<head>
<title>Generate Release APK with ReactNative CLI (Errors Fixed)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用反应式CLI生成发布APK(错误已修复)</h1>
<blockquote>原文：<a href="https://medium.com/geekculture/generate-apk-with-reactnative-cli-errors-fixed-db00375d9bce?source=collection_archive---------2-----------------------#2022-02-07">https://medium.com/geekculture/generate-apk-with-reactnative-cli-errors-fixed-db00375d9bce?source=collection_archive---------2-----------------------#2022-02-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="62b5" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如何在React Native CLI中为android移动应用程序生成android APK文件</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/3f272be38c524d138271cfdecc1b3baf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zE65lxvddLmwXe0EVYmw3A.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Figure 01: Artwork by <a class="ae jn" href="https://pawara73.medium.com/" rel="noopener">Author</a> (Image source: <a class="ae jn" href="https://www.canva.com/" rel="noopener ugc nofollow" target="_blank">https://www.canva.com/</a>, <a class="ae jn" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/</a>)</figcaption></figure><p id="bc58" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在android移动应用程序开发中，在真实设备上测试应用程序是开发人员的基本职责。对于使用<a class="ae jn" href="https://reactnative.dev/" rel="noopener ugc nofollow" target="_blank"> React-Native-CLI </a>开发的应用程序，在真实设备上测试应用程序的最佳方法之一是生成APK文件，在任何android移动设备上安装并运行它。由于各种错误和bug，有时APK生成会相当忙乱。本文是一个全方位的指南，将帮助任何不熟悉React-Native-CLI移动应用程序开发的人快速构建APK文件，同时轻松解决可能的错误。</p><p id="de45" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">但是，在遵循本文中的过程之前，请确保您的项目运行正常，没有任何错误或缺陷。</p><p id="18c0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了便于参考，我将04小节下的内容介绍如下:</p><ol class=""><li id="67f8" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated"><a class="ae jn" href="#bbe8" rel="noopener ugc nofollow">生成密钥库</a></li><li id="727c" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated"><a class="ae jn" href="#7b3a" rel="noopener ugc nofollow">将Keystore添加到项目中并构建App Bundle </a></li><li id="9f99" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated"><a class="ae jn" href="#53b9" rel="noopener ugc nofollow">发布APK一代</a></li><li id="0000" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated"><a class="ae jn" href="#51b6" rel="noopener ugc nofollow">可能错误的一般解决方案</a></li><li id="cd63" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated"><a class="ae jn" href="#bf31" rel="noopener ugc nofollow">总结</a></li><li id="a6b1" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated"><a class="ae jn" href="#1f5d" rel="noopener ugc nofollow">参考文献</a></li></ol></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><h1 id="bbe8" class="lf lg hi bd lh li lj lk ll lm ln lo lp io lq ip lr ir ls is lt iu lu iv lv lw bi translated">1.生成密钥库</h1><p id="c95b" class="pw-post-body-paragraph jo jp hi jq b jr lx ij jt ju ly im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">第一步是生成一个Keystore文件，它是Java生成的签名密钥。它将用于为Android创建反应性可执行二进制文件。要生成Keystore，请在项目中打开PowerShell终端(VS代码)并运行以下命令。将字段'<em class="mc"> key_name </em>'和'<em class="mc"> key-alias </em>'替换为您希望的名称。</p><pre class="iy iz ja jb fd md me mf mg aw mh bi"><span id="b101" class="mi lg hi me b fi mj mk l ml mm">keytool -genkey -v -keystore key_name.keystore -alias key_alias -keyalg RSA -keysize 2048 -validity 10000</span></pre><p id="78cc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后会要求您提供密钥库的密码，并在生成密钥库之前填写一些字段[图2]。(记住密码字段是隐藏的。因此您可能无法查看您键入的内容。并保存好您的'<em class="mc">键名</em>'、<em class="mc">键名别名</em>'和'<em class="mc">密码</em>，因为以后您还会用到它们。)</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mn"><img src="../Images/64a73756637f40a5ace2864809f8c840.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-IlhV-N_wdGSwUg621irWQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Figure 02: Screenshot of the VS Code PowerShell</figcaption></figure><p id="3758" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以为上述字段添加一些虚拟值。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mo"><img src="../Images/315cbf6fb0ca74bcf8221e7bfa5b866d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mc04UodFeUHcP5BnQqhDhA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Figure 03: Screenshot of the VS Code PowerShell</figcaption></figure><p id="2c4c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以为<em class="mc">‘test-key-alias’</em>添加另一个密码，或者直接按enter键来生成密钥库文件[图03]。Keystore文件将在根目录下创建，但是您必须将它复制并粘贴到路径:'<em class="mc"> android/app/' </em>,如图04所示。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mp"><img src="../Images/c1a008bae00a93905a9932bb8dcdc409.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*DiLOJ3EA_nDiNYyngIcJLg.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Figure 04: Screenshot of the project directories</figcaption></figure><h1 id="7b3a" class="lf lg hi bd lh li mq lk ll lm mr lo lp io ms ip lr ir mt is lt iu mu iv lv lw bi translated">2.将密钥库添加到项目中并构建应用程序包</h1><p id="3b84" class="pw-post-body-paragraph jo jp hi jq b jr lx ij jt ju ly im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">接下来，您必须用Keystore配置项目。为此，在路径:<em class="mc"> '/android/app' </em>(与您之前保存密钥库的路径相同)中打开<em class="mc"> 'build.gradle' </em>文件。将<em class="mc">‘发布’</em>添加到<em class="mc">‘签名配置’</em>块中，并将<em class="mc">‘构建类型’</em>块中的<em class="mc">‘发布’</em>修改如下。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mv mw l"/></div></figure><p id="c739" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">用您的密码替换<em class="mc">密钥库名称</em>、<em class="mc">别名</em>和<em class="mc">密码</em>(记得我在第01节告诉您保存它们吗🙂).你可以看到上面的方法很容易配置，但是你的密码被直接放入代码库，这是不可接受的。为了避免这种情况，您可以使用以下替代方法来配置<em class="mc">‘build . gradle’</em>字段，如下所示。这样更安全，以后运行命令构建包时，会提示您输入密码。您可以使用上述方法或以下方式将密钥库配置到项目中。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mv mw l"/></div></figure><p id="0547" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">注意:</strong>始终将<em class="mc">‘signing configs’</em>放在<em class="mc">‘buildType’</em>模块之前，以避免可能的错误。</p><p id="2e47" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在构建包之前，你必须检查在路径<em class="mc">‘Android/app/src/main’中是否有一个名为‘assets’的目录。</em>如果没有assets文件夹，那么在上面的路径中创建一个名为‘assets’的文件夹[图5]。这是保存应用程序包的目录。</p><p id="c5b7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要创建app bundle，请在同一终端上运行以下命令。</p><p id="782f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">注意:</strong>该命令是单行代码。因此，您可以复制以下内容并粘贴到记事本中，然后在直接粘贴到终端之前删除任何换行符。</p><pre class="iy iz ja jb fd md me mf mg aw mh bi"><span id="d038" class="mi lg hi me b fi mj mk l ml mm">react-native bundle --platform android --dev false --entry-file index.js --bundle-output android/app/src/main/assets/index.android.bundle --assets-dest android/app/src/main/res/</span></pre><p id="9c0e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">注意:</strong>上述命令中的文件名<em class="mc">‘index . js’</em>是项目中的入口文件。在您的项目中，如果您有一个不同的条目文件(例如:<em class="mc"> 'index.android.js' </em>)，那么用相关的文件名替换它。</p><p id="224c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果构建成功，您可以在资产目录中看到新创建的名为<em class="mc">‘index . Android . bundle’</em>的包文件[图05]。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mx"><img src="../Images/ff72df6d66c6a7ff1cb98959ac4e3171.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*UU1rs-4FozauDi_Rr6d-1A.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Figure 05: Screenshot of the project directories</figcaption></figure><h1 id="53b9" class="lf lg hi bd lh li mq lk ll lm mr lo lp io ms ip lr ir mt is lt iu mu iv lv lw bi translated">3.发布APK一代</h1><p id="6bb6" class="pw-post-body-paragraph jo jp hi jq b jr lx ij jt ju ly im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">这是生成APK文件的最后一道关卡。请仔细遵循下面给出的步骤，以避免任何可能的错误:</p><p id="7313" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">首先，转到项目中的android目录。您可以手动转到目录并打开终端，或者运行以下命令(如果您在根目录中)。</p><pre class="iy iz ja jb fd md me mf mg aw mh bi"><span id="f1f3" class="mi lg hi me b fi mj mk l ml mm">cd android</span></pre><p id="1322" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">接下来，运行以下命令来生成APK文件。</p><pre class="iy iz ja jb fd md me mf mg aw mh bi"><span id="dd2b" class="mi lg hi me b fi mj mk l ml mm">./gradlew assembleRelease</span></pre><p id="9567" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在某些地方，我注意到建议在Windows上使用'<em class="mc">grad Lew assembler release</em>'，但是上面的命令在所有03平台Windows、Mac和Linux上都有效。如果它在Windows中抛出如下所示的错误[图06],您可以使用bash终端，而不是PowerShell或命令提示符。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es my"><img src="../Images/d8e49863e83192fec469c30f781cc9f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c7QisVcSl4tGYijvtWGapA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Figure 06: Screenshot of the error thrown in Windows PowerShell terminal in VS Code</figcaption></figure><p id="27f2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果上面的命令运行成功，那么做得很好👏，那么它将在路径:'<em class="mc">Android/app/build/outputs/apk/release '</em>'中创建名为'<em class="mc"> app-release.apk </em>'的APK文件[图07]。您可以将生成的APK文件复制并安装到您的android手机上并运行它。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mz"><img src="../Images/d44787463637516b152c060f824c2574.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*d-TWmeRZrOi3umBxaXtlCw.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">Figure 07: Path of the generated APK file</figcaption></figure><p id="b7df" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">但不幸的是，APK的产生并不总是一蹴而就的。在尝试运行上述命令时，您可能至少会遇到一次“构建失败”。接下来，我们将讨论一些可以避免此类错误的解决方案。</p><h1 id="51b6" class="lf lg hi bd lh li mq lk ll lm mr lo lp io ms ip lr ir mt is lt iu mu iv lv lw bi translated">4.可能错误的一般解决方案</h1><p id="7a0c" class="pw-post-body-paragraph jo jp hi jq b jr lx ij jt ju ly im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">如果您在第1步和第2步中创建app bundle时遇到任何错误/问题，很可能是由于使用了错误的终端或您运行的命令输入错误。因此，再次仔细阅读说明，尤其是“注意事项”，以避免这种小错误。</p><h2 id="b198" class="mi lg hi bd lh na nb nc ll nd ne nf lp jx ng nh lr kb ni nj lt kf nk nl lv nm bi translated">错误01:应用:validateSigningRelease失败</h2><p id="04d0" class="pw-post-body-paragraph jo jp hi jq b jr lx ij jt ju ly im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">以下错误是由于缺少密钥库文件造成的。当然，您可能将密钥库放在了不同的位置，或者文件名不同于在<em class="mc">‘build . gradle’中配置的文件名。</em>有可能在构建apk时抛出这个错误。</p><pre class="iy iz ja jb fd md me mf mg aw mh bi"><span id="f21f" class="mi lg hi me b fi mj mk l ml mm">Task :app:validateSigningRelease FAILED<br/>…<br/>BUILD FAILED</span></pre><h2 id="f9e6" class="mi lg hi bd lh na nb nc ll nd ne nf lp jx ng nh lr kb ni nj lt kf nk nl lv nm bi translated">错误02 &amp; 03:应用程序:mergeReleaseResources &amp;应用程序:mergereleasesources</h2><p id="f9b3" class="pw-post-body-paragraph jo jp hi jq b jr lx ij jt ju ly im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">大多数构建错误发生在最后一步:释放APK。构建APK时，某些任务的执行可能会失败，从而导致整个APK构建失败。</p><pre class="iy iz ja jb fd md me mf mg aw mh bi"><span id="6b66" class="mi lg hi me b fi mj mk l ml mm">Execution failed for task ‘:app:processReleaseResources’.<br/>...<br/>BUILD FAILED</span></pre><p id="9ba6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">或者</p><pre class="iy iz ja jb fd md me mf mg aw mh bi"><span id="3a4b" class="mi lg hi me b fi mj mk l ml mm">Execution failed for task ‘:app:mergeReleaseResources’.<br/>… <br/>BUILD FAILED</span></pre><p id="68b2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">有两种方法可以解决此类错误:</p><p id="268b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> 1。清理“可绘制”和“原始”目录。</strong></p><p id="9976" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以运行以下命令来删除它们:</p><pre class="iy iz ja jb fd md me mf mg aw mh bi"><span id="9e17" class="mi lg hi me b fi mj mk l ml mm">rm -rf android/app/src/main/res/drawable-* <br/>rm -rf android/app/src/main/raw</span></pre><p id="a1de" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">或者手动删除，分别到路径:'<em class="mc">Android \ app \ src \ main \ RES \ drawable</em>'和'<em class="mc">Android \ app \ src \ main \ raw</em>'中的目录<em class="mc"> 'drawable </em>'和<em class="mc"> 'raw' </em>。并删除<strong class="jq hj">所有</strong>每个目录中的内容【图08】。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nn"><img src="../Images/e5c3a0da9c87b7f731037421be9fd3bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y5Ifa3a0KB9leBug6c7O-w.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Figure 08: Screenshot of the ‘drawable’ and ‘raw’ directories</figcaption></figure><p id="8fd4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> 2。重新配置包发布</strong></p><p id="f4d6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您可以通过运行以下命令来重新配置条目文件名、所创建的包输出的路径以及APK资产的目的地。打开根目录(项目文件夹)中的bash终端并运行以下命令。</p><pre class="iy iz ja jb fd md me mf mg aw mh bi"><span id="8609" class="mi lg hi me b fi mj mk l ml mm">react-native bundle --platform android --dev false --entry-file index.js --bundle-output android/app/src/main/assets/index.android.bundle --assets-dest android/app/build/intermediates/res/merged/release/</span></pre><p id="49f5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">之后，再次移动到android目录并运行。/gredlew assembler请再次使用'命令。它将成功生成APK文件。</p><h1 id="bf31" class="lf lg hi bd lh li mq lk ll lm mr lo lp io ms ip lr ir mt is lt iu mu iv lv lw bi translated">5.摘要</h1><p id="08da" class="pw-post-body-paragraph jo jp hi jq b jr lx ij jt ju ly im jw jx lz jz ka kb ma kd ke kf mb kh ki kj hb bi translated">在为一个反应性项目生成APK文件之前，第一步也是最重要的一步是确保代码库没有错误，并且在Android模拟器中正常工作。除此之外，为一个反应性项目生成APK文件的基本步骤包括03个主要步骤:生成密钥库文件，用项目配置密钥库并构建app bundle，最后发布APK版本。这个过程中可能会有一些错误，但是通过对项目进行一些修改和一些额外的命令就可以很容易地解决这些错误。</p><h1 id="1f5d" class="lf lg hi bd lh li mq lk ll lm mr lo lp io ms ip lr ir mt is lt iu mu iv lv lw bi translated">6.参考</h1><div class="no np ez fb nq nr"><a href="https://reactnative.dev/docs/signed-apk-android" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab dw"><div class="nt ab nu cl cj nv"><h2 class="bd hj fi z dy nw ea eb nx ed ef hh bi translated">出版到谷歌Play商店反应本土</h2><div class="ny l"><h3 class="bd b fi z dy nw ea eb nx ed ef dx translated">Android要求所有应用程序在安装前都要用证书进行数字签名。为了…</h3></div><div class="nz l"><p class="bd b fp z dy nw ea eb nx ed ef dx translated">反应性发展</p></div></div><div class="oa l"><div class="ob l oc od oe oa of jh nr"/></div></div></a></div></div></div>    
</body>
</html>